<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>æ˜é‡‘æ–‡ç« æ¨è</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>ä¸€ä¸ªå¸®åŠ©å¼€å‘è€…æˆé•¿çš„ç¤¾åŒº</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[2025ã€Œå¹´ç»ˆæ€»ç»“ã€â€”â€” äººç”Ÿç™¾æ€ï¼Œæœ‰æƒŠå–œã€æœ‰é—æ†¾]]></title>    <link>https://juejin.cn/post/7604786493640065051</link>    <guid>https://juejin.cn/post/7604786493640065051</guid>    <pubDate>2026-02-10T06:17:31.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604786493640065051" data-draft-id="7587335187072483354" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="2025ã€Œå¹´ç»ˆæ€»ç»“ã€â€”â€” äººç”Ÿç™¾æ€ï¼Œæœ‰æƒŠå–œã€æœ‰é—æ†¾"/> <meta itemprop="keywords" content="å¹´ç»ˆæ€»ç»“"/> <meta itemprop="datePublished" content="2026-02-10T06:17:31.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å°–æ¤’åœŸè±†sss"/> <meta itemprop="url" content="https://juejin.cn/user/2041110775208184"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            2025ã€Œå¹´ç»ˆæ€»ç»“ã€â€”â€” äººç”Ÿç™¾æ€ï¼Œæœ‰æƒŠå–œã€æœ‰é—æ†¾
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2041110775208184/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å°–æ¤’åœŸè±†sss
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T06:17:31.000Z" title="Tue Feb 10 2026 06:17:31 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å‰è¨€</h2>
<p>æ—¶å…‰é£é€ï¼Œ2025å¹´ä¹Ÿæ¥è¿‘äº†å°¾å£°ï¼Œå½“æˆ‘å¼€å§‹æ‰“ç®—å†™è¿™ç¯‡æ–‡ç« æ—¶å·²ç»æ˜¯ 12 æœˆ 25 æ—¥ã€‚ è„‘æµ·é‡Œå¿«é€Ÿå›å¿†äº†ä¸€ä¸‹ä»Šå¹´å‘ç”Ÿçš„ä¸€äº›äº‹ï¼Œæ„Ÿè§‰è¿™ä¸€å¹´æ—¶é—´è¿‡å¾—å¾ˆå¿«ï¼Œè™½ç„¶ä»Šå¹´æ—¶é—´å¾ˆé•¿ï¼Œä½†éšç€å¹´é¾„çš„å¢é•¿æ„Ÿè§‰æ—¥å­è¿‡çš„å¾ˆå¿«ã€‚</p>
<p>å›æƒ³äº†ä¸€ä¸‹åˆè§‰å¾—è¿™ä¸€å¹´æ²¡åšä»€ä¹ˆäº‹ï¼Œç®€å•åšä¸ªæµæ°´è´¦æ€»ç»“å§ã€‚äººç”Ÿéœ€è¦ä¸æ–­çš„æ€»ç»“ï¼Œå¤ç›˜ï¼Œåªæœ‰é‡æ–°å®¡è§†è‡ªå·±æ‰ä¼šå˜å¾—æ›´å¥½ï¼</p>
<h2 data-id="heading-1">å·¥ä½œ</h2>
<p>å·¥ä½œæ–¹é¢çš„è¯æ²¡å•¥è¯´çš„ï¼Œä¸»è¦æ˜¯æ–°é¡¹ç›®å¼€å·¥ï¼Œæ—¥å¸¸å¼€å‘å’Œè¿­ä»£ï¼ŒæŠ€æœ¯æ ˆçš„è¯æ˜¯ vue3ã€tsã€‚</p>
<p>è¿™ä¸€å¹´åœ¨å·¥ä½œä¸­å‘ç°è‡ªå·±å¯¹é‡åˆ°çš„æŠ€æœ¯é—®é¢˜åˆ¤æ–­ã€ç†è§£å’Œè§£å†³çš„èƒ½åŠ›æœ‰äº†æé«˜ã€‚</p>
<p>æ¯”å¦‚åœ¨æ—¥å¸¸å·¥ä½œä¸­å…¶ä»–åŒäº‹è§£å†³ä¸äº†çš„é—®é¢˜äº¤ç»™æˆ‘åï¼Œæˆ‘ä¼šæ ¹æ®é—®é¢˜å¤šé—®è‡ªå·±å‡ ä¸ªä¸ºä»€ä¹ˆï¼Ÿ ç„¶åæ ¹æ®æƒ³æ³•å’Œæ€è·¯é€æ­¥å°è¯•è§£å†³ã€‚</p>
<p>æˆ‘ä¸€ç›´æ²¡æœ‰å…»æˆä¸€é‡åˆ°é—®é¢˜å°±é—®èº«è¾¹äººçš„ä¹ æƒ¯ï¼ˆé™¤éæ˜¯å®åœ¨æä¸å®šï¼‰ï¼Œä»¥å‰é‡åˆ°é—®é¢˜æ€è€ƒçš„éƒ½ä¸å¤Ÿå…¨é¢ï¼Œæƒ³é—®é¢˜çš„è§’åº¦å•ä¸€æ­»æ¿ï¼Œä»Šå¹´æ„Ÿè§‰è‡ªå·±å­¦ä¼šäº†ä¸€ç‚¹æ€è€ƒã€‚</p>
<h2 data-id="heading-2">ç”Ÿæ´»</h2>
<p>ä»Šå¹´å¾ˆå¼€å¿ƒçš„æ˜¯æ™‹å‡ä¸ºäº†å®çˆ¸ï¼Œä¹Ÿç®—æ˜¯å®Œæˆäº†ä¸€ä»¶äººç”Ÿå¤§äº‹ï¼Œä¹Ÿä»£è¡¨æˆ‘éœ€è¦è‚©è´Ÿçš„è´£ä»»æ›´å¤§ã€‚</p>
<ul>
<li>
<p>åœ¨åŒ»é™¢é™ªäº§<br/>
ä»æ¥æ²¡æœ‰ä½è¿‡é™¢çš„æˆ‘åœ¨åŒ»é™¢é™ªäº§æœŸé—´ï¼Œçœ‹åˆ°å½¢å½¢è‰²è‰²çš„äººçœŸçš„æ˜¯äººç”Ÿç™¾æ€ã€‚ç›®ç¹äº†åª³å¦‡çš„åˆ†å¨©ä¹‹ç—›å¥¹çœŸçš„å¤ªå‹‡æ•¢ã€åšå¼ºã€ä¼Ÿå¤§ã€‚ä¹ŸçœŸçš„å¾ˆä¸å®¹æ˜“ï¼<br/>
ä»¥åç”Ÿæ´»ä¸­å’Œè€å©†æœ‰äº†äº‰æ‰§ä¸€å®šè¦å†·é™ã€å†·é™ã€å†å†·é™ï¼Œå¤šæƒ³æƒ³å¥¹çš„ä¸å®¹æ˜“ï¼</p>
</li>
<li>
<p>åœ¨å®¶é™ªåª³å¦‡åæœˆå­ï¼Œå¸¦å¨ƒ</p>
</li>
<li>
<p>å‚åŠ äº†2åœºå©šç¤¼
èº«è¾¹çš„å¥½æœ‹å‹ä¹Ÿéƒ½é™†ç»­æ‰¾åˆ°äº†è‡ªå·±çš„å¹¸ç¦é€æ­¥å®Œæˆäººç”Ÿå¤§äº‹ã€‚</p>
</li>
<li>
<p>10æœˆè‡ªé©¾2å¤©å»äº†è¶Ÿå¤ªåŸã€11æœˆè‡ªé©¾2å¤©å»äº†è¶Ÿè¥¿å®‰</p>
</li>
</ul>
<p>ä»Šå¹´ä¸»è¦æ—¶é—´è¿˜æ˜¯å›å®¶é™ªè€å©†å­©å­ï¼Œæ¥å›å¥”æ³¢åœ¨è·¯ä¸Šï¼Œæ„Ÿè§‰å¾ˆç´¯ä½†æ˜¯ä¸ºäº†ç”Ÿæ´»åˆæ²¡æœ‰åŠæ³•ï¼Œåªèƒ½ç¡¬ç€å¤´çš®å»é¢å¯¹ã€‚</p>
<h3 data-id="heading-3">å­¦ä¹ </h3>
<p>å»å¹´å­¦ä¹ è®¡åˆ’å®æ–½æƒ…å†µï¼š</p>
<ul>
<li>
<p><del>three.js æ²¡èƒ½èŠ±æ—¶é—´ç»§ç»­å­¦ä¹ å®Œå–„3dåœ°å›¾ demo</del>ã€‚</p>
</li>
<li>
<p>uniApp<br/>
å…¶å®ä¹Ÿæ²¡æ€ä¹ˆå­¦ï¼Œä¹‹å‰å†™è¿‡åŸç”Ÿå°ç¨‹åºï¼Œè¯­æ³•å°±æ˜¯vueç›´æ¥ä¸Šæ‰‹äº†ã€‚ å†™äº†å‡ ä¸ªç®€å•çš„å°å·¥å…·é¡µé¢å‘å¸ƒä¸Šçº¿äº†å°ç¨‹åºç†Ÿæ‚‰äº†ä¸€ä¸‹æµç¨‹ã€‚ æœ€ä¸»è¦æ˜¯ä¸ç†Ÿæ‚‰å„ç§apiï¼Œä»¥åŠh5ã€å°ç¨‹åºã€å®‰å“ã€ios çš„ç¯å¢ƒå·®åˆ«ï¼Œè¿˜æœ‰ä¸€äº›å¸¸è§çš„å‘ã€‚<br/>
è¿™å—æ„Ÿè§‰å®æˆ˜é¡¹ç›®åš1-2ä¸ªå°±å¤§å·®ä¸å·®äº†ï¼Œç„¶åç†Ÿæ‚‰ä¸‹åˆ†åŒ…ã€å‘å¸ƒå„ç«¯å…¼å®¹æ€§é—®é¢˜ã€æŠ€æœ¯å±‚é¢çš„è¯ä¸»è¦è¿˜å¾—ç»“åˆå®é™…ä¸šåŠ¡æ¥å·©å›ºå·©å›ºã€‚</p>
</li>
<li>
<p>react+ts é¡¹ç›®æ²¡æœ‰ä¸“é—¨æŠ½æ—¶é—´æï¼Œä½†æ˜¯æ¥è§¦äº†ä¸€ä¸ª <code>next</code> é¡¹ç›®å°±æ˜¯ <code>jsx</code> è¯­æ³•ï¼Œç®—æ˜¯å˜ç›¸æµ…å­¦äº†ä¸€å°éƒ¨åˆ†ã€‚è¿˜æ˜¯éœ€è¦æ ¹æ®å®é™…éœ€æ±‚åœºæ™¯å»å®ç°åŠŸèƒ½ï¼Œæ›´å¥½çš„ç†Ÿæ‚‰reactç›¸å…³apiï¼Œä»£ç æŠ€å·§ç­‰ã€‚</p>
</li>
<li>
<p>ç»ƒå­—çš„è¯å¶å°”å†™äº†å‡ è¡Œï¼Œè®°ç¬”è®°çš„æ—¶å€™ä¹Ÿç®—æ˜¯ç»ƒäº†ï¼Œä½†æ•´ä½“æ²¡æœ‰å¤ªå¤§æå‡ï¼Œæ³¨æ„åŠ›ä¸å¤Ÿé›†ä¸­ã€‚</p>
</li>
</ul>
<p>ä»Šå¹´çš„å·¥ä½œæ–¹é¢ç®—æ˜¯å¿™äº†ä¸€æ®µæ—¶é—´ï¼Œæœ‰æ®µæ—¶é—´æ¯å¤©ä¸‹ç­å›å®¶å°±ä¸€ç‚¹éƒ½ä¸æƒ³åŠ¨äº†ï¼Œå°†è¿‘ä¿©æœˆæ¯å‘¨åŠ ç­å•ä¼‘ï¼Œæ„Ÿè§‰æ•´ä¸ªäººå¾ˆç–²æƒ«ã€‚</p>
<p>ç„¶åä»Šå¹´ä¸»è¦åšäº†å¦‚ä¸‹å‡ ä»¶äº‹:</p>
<ul>
<li>æ˜é‡‘ä¸Šè¾“å‡ºäº†ä¸€äº›å«é‡‘é‡ä¸é«˜çš„æ–‡ç« </li>
<li>ä¸»è¦å¤‡è€ƒäº†ä¸€ä¸‹è½¯è€ƒï¼ŒA4 çº¸å†™äº†ä¸å°‘ç¬”è®°ï¼Œä½†å†…å®¹å¤ªå¤šäº†è®°ä¸ä½ï¼Œæ³¨æ„åŠ›ä¸å¤Ÿé›†ä¸­ï¼Œ11æœˆä»½è€ƒè¯•2é—¨éƒ½æ²¡èƒ½é€šè¿‡</li>
<li>å­¦ä¹ äº†è§£äº†ä¸€ä¸‹web3ï¼Œæœ¬åœ°å†™äº†ä¸ªç®€å•çš„åˆçº¦ demo</li>
</ul>
<p>æ•´ä½“æ¥è¯´ï¼Œä»Šå¹´åœ¨å­¦ä¹ æ–¹é¢æ²¡æœ‰ä»€ä¹ˆæ”¶è·ï¼Œå…¶å®ä¹Ÿæ˜¯è‡ªå·±æ²¡èƒ½é™ä¸‹å¿ƒå»å­¦ä¹ ï¼Œæ„Ÿè§‰æœ‰ç‚¹é¢“åºŸäº†ã€‚</p>
<h3 data-id="heading-4">ç¯®çƒ</h3>
<p>ä»Šå¹´æ‰“çƒæ¬¡æ•°ç®—æ˜¯æ¯”è¾ƒå¤šï¼ŒåŸºæœ¬ä¸Šåªè¦å‘¨æœ«æœ‰æ—¶é—´å°±å»æ‰“çƒã€‚ç¯®çƒæ˜¯æˆ‘çƒ­çˆ±çš„è¿åŠ¨ï¼Œä¹Ÿæ˜¯æ„¿æ„èŠ±æ—¶é—´å»åšçš„äº‹æƒ…ã€‚æ¯ä¸€åœºçƒéƒ½ä¼šå¯¹ç¯®çƒæœ‰æ–°çš„æ„Ÿæ‚Ÿï¼Œæ¯æŠ•è¿›ä¸€æ¬¡ç¯®éƒ½ä¼šå¢åŠ è‡ªä¿¡å¿ƒï¼ŒåŒæ—¶æ‰“çƒä¹Ÿä¼šé‡Šæ”¾æˆ‘å·¥ä½œç”Ÿæ´»çš„å‹åŠ›ã€‚</p>
<p>ä»Šå¹´çš„è¯æœ‰å¹¸åœ¨8æœˆåˆã€8æœˆåº•ã€11æœˆåº•ã€12æœˆåˆåˆ†åˆ«å¸¦äº†å‡ ä¸ªå­¦å‘˜ï¼Œæœ‰0åŸºç¡€çš„æˆå¹´äººã€0åŸºç¡€çš„å­©å­ã€æœ‰åŸºç¡€çš„åˆä¸­ç”Ÿã€‚æˆ‘å¾ˆäº«å—ç»™åˆ«äººåˆ†äº«ç¯®çƒæŠ€å·§ã€ç¯®çƒçŸ¥è¯†çš„è¿™ä¸ªè¿‡ç¨‹ã€‚</p>
<p>æŠŠæˆ‘å¯¹ç¯®çƒçš„ä¸€äº›è®¤çŸ¥ã€å¿ƒå¾·è®²ç»™ä»–äººæ—¢åšåˆ°äº†ç¯®çƒçš„å¯è’™ï¼ŒåŒæ—¶æˆ‘ä¹Ÿå¾ˆå¥½çš„é”»ç‚¼äº†è‡ªå·±çš„è¡¨è¾¾èƒ½åŠ›ï¼Œä¼šè®©äººå˜å¾—æ›´åŠ è‡ªä¿¡ï¼Œä¹Ÿç®—æ˜¯æœ‰ä¸å°çš„æ”¶è·å§ï¼Œå¾ˆå¼€å¿ƒã€‚</p>
<h2 data-id="heading-5">æ€»ç»“</h2>
<p>2025å¹´æ€»çš„æ¥è¯´å¾ˆå¿™ï¼Œä¸€ç›´åœ¨è·¯ä¸Šï¼Œæœ‰æƒŠå–œæœ‰åå·ä¹Ÿæœ‰é—æ†¾ï¼Œå¯èƒ½äººç”Ÿå°±æ˜¯è¿™æ ·ã€‚ ç”Ÿæ´»å¾ˆéš¾ä½†æ˜¯è‡ªå·±è¦å­¦ä¼šç»™è‡ªå·±é™å¿ƒï¼Œç´¯äº†å¯ä»¥ä¼‘æ¯ï¼Œä½†ä¸èƒ½é¢“åºŸï¼åŠ æ²¹ï¼åŠªåŠ›è°ƒæ•´è‡ªå·±çš„å¿ƒæ€ã€‚</p>
<h2 data-id="heading-6">å±•æœ›2026</h2>
<ul>
<li>å®¶äººèº«ä½“å¥åº·ã€å®è´å¥åº·æˆé•¿</li>
<li>é™å¿ƒã€è°ƒæ•´å¿ƒæ€</li>
<li>å·¥ä½œé¡ºåˆ©</li>
<li>å­¦ä¹ ä¸€äº›æ–°çŸ¥è¯†</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vibe Coding å·²æ­»ï¼ŒKarpathy è¯´æœªæ¥å« Agentic Engineering]]></title>    <link>https://juejin.cn/post/7604801893529419819</link>    <guid>https://juejin.cn/post/7604801893529419819</guid>    <pubDate>2026-02-10T06:20:49.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604801893529419819" data-draft-id="7604793276906864703" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vibe Coding å·²æ­»ï¼ŒKarpathy è¯´æœªæ¥å« Agentic Engineering"/> <meta itemprop="keywords" content="AIç¼–ç¨‹,AIGC,OpenAI"/> <meta itemprop="datePublished" content="2026-02-10T06:20:49.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å­Ÿå¥AIç¼–ç¨‹"/> <meta itemprop="url" content="https://juejin.cn/user/4212984287073895"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vibe Coding å·²æ­»ï¼ŒKarpathy è¯´æœªæ¥å« Agentic Engineering
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4212984287073895/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å­Ÿå¥AIç¼–ç¨‹
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T06:20:49.000Z" title="Tue Feb 10 2026 06:20:49 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯å­Ÿå¥ã€‚</p>
<p><strong>é€ "Vibe Coding"è¿™ä¸ªè¯çš„äººï¼Œäº²æ‰‹å®£å¸ƒå®ƒè¿‡æ—¶äº†ã€‚</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/125f5b0cd9c54647beddd79c74adddf9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771309253&amp;x-signature=3CGI7uZlknlY9kLkExLYPFygb6A%3D" alt="" loading="lazy"/></p>
<p>2 æœˆ 4 æ—¥ï¼ŒAndrej Karpathyï¼ˆOpenAI è”åˆåˆ›å§‹äººï¼Œå‰ Tesla AI è´Ÿè´£äººï¼‰åœ¨ X ä¸Šå‘äº†ä¸€æ¡é•¿å¸–ï¼Œçºªå¿µ Vibe Coding è¯ç”Ÿä¸€å‘¨å¹´ã€‚ä½†ä»–ä¸æ˜¯æ¥åº†ç¥çš„ï¼Œä»–æ˜¯æ¥"æ”¹å"çš„â€”â€”</p>
<p>ä»–è¯´ï¼Œç°åœ¨è¯¥å« <strong>Agentic Engineering</strong> äº†ã€‚</p>
<p>è¿™ä¸æ˜¯æ–‡å­—æ¸¸æˆã€‚è¿™èƒŒåæ˜¯ AI ç¼–ç¨‹é¢†åŸŸè¿‡å»ä¸€å¹´æœ€é‡è¦çš„èŒƒå¼è½¬ç§»ã€‚</p>
<hr/>
<h2 data-id="heading-0"><strong>01 Karpathy åˆ°åº•è¯´äº†ä»€ä¹ˆ</strong></h2>
<p>å…ˆè¿˜åŸåŸæ–‡å…³é”®ä¿¡æ¯ã€‚</p>
<p>Karpathy æ‰¿è®¤ï¼Œä¸€å¹´å‰ä»–éšæ‰‹å‘çš„é‚£æ¡æ¨æ–‡ï¼Œæ²¡æƒ³åˆ°"Vibe Coding"èƒ½ç«æˆè¿™æ ·â€”â€”ä¸Šäº†ç»´åŸºç™¾ç§‘ï¼Œè¢«æ‰€æœ‰ç§‘æŠ€å…¬å¸å¼•ç”¨ï¼Œç”šè‡³ Sam Altman éƒ½åœ¨ç”¨è¿™ä¸ªè¯ã€‚</p>
<p>ä½†ä»–è¯é”‹ä¸€è½¬ï¼š</p>
<blockquote>
<p>*"ä¸€å¹´å‰æˆ‘è¯´ Vibe Coding çš„æ—¶å€™ï¼Œ*<em>LLM</em> <em>çš„èƒ½åŠ›è¿˜å¾ˆæœ‰é™ï¼Œä½ åªèƒ½æ‹¿å®ƒåšä¸€äº›ç©å…·é¡¹ç›®ã€demo å’Œæ¢ç´¢æ€§çš„ä¸œè¥¿ã€‚"</em></p>
</blockquote>
<p>ç°åœ¨ä¸ä¸€æ ·äº†ã€‚ä»–åŸè¯ï¼š</p>
<blockquote>
<p><em>"'agentic' because the new default is that you are not writing the code directly 99% of the time, you are orchestrating agents who do and acting as oversight."</em></p>
</blockquote>
<blockquote>
<p><em>"'engineering' to emphasize that there is an art &amp; science and expertise to it."</em></p>
</blockquote>
<p>ç¿»è¯‘æˆäººè¯ï¼š<strong>ä½ ä¸å†æ˜¯"å†™ä»£ç çš„äºº"ï¼Œä½ æ˜¯"æŒ‡æŒ¥ AI Agent å†™ä»£ç çš„äºº"ã€‚è€Œè¿™ä»¶äº‹æœ¬èº«ï¼Œæ˜¯ä¸€é—¨éœ€è¦å­¦ä¹ çš„æŠ€æœ¯ã€‚</strong></p>
<hr/>
<h2 data-id="heading-1"><strong>02 Vibe Coding å’Œ Agentic Engineering çš„æœ¬è´¨åŒºåˆ«</strong></h2>
<p>å¾ˆå¤šäººè§‰å¾—è¿™å°±æ˜¯æ¢äº†ä¸ªåå­—ã€‚ä¸æ˜¯ã€‚</p>
<p><strong>Vibe Coding</strong>ï¼šä½ å¯¹ç€ AI è¯´"å¸®æˆ‘å†™ä¸€ä¸ªç™»å½•é¡µé¢"ï¼Œå®ƒåå‡ºä»£ç ï¼Œä½ å¤åˆ¶ç²˜è´´ï¼Œè·‘èµ·æ¥å°±è¡Œã€‚ä¸è¡Œå°±å†è¯•ä¸€æ¬¡ã€‚æ ¸å¿ƒä½“éªŒæ˜¯â€”â€”ç¢°è¿æ°”ã€‚</p>
<p><strong>Agentic Engineering</strong>ï¼šä½ ä¸å†ä¸€å¥ä¸€å¥åœ°"æç¤º"AIã€‚ä½ å¯åŠ¨ä¸€ä¸ª Agentï¼Œç»™å®ƒä¸€ä¸ªç›®æ ‡ã€ä¸€å¥—ä¸Šä¸‹æ–‡ã€ä¸€ç»„å·¥å…·ï¼Œç„¶åå®ƒè‡ªå·±å»è§„åˆ’ã€æ‰§è¡Œã€è°ƒè¯•ã€æµ‹è¯•ã€‚ä½ è´Ÿè´£çš„æ˜¯â€”â€”å®¡æŸ¥å’Œå†³ç­–ã€‚</p>



































<table><thead><tr><th>ç»´åº¦</th><th>Vibe Coding</th><th>Agentic Engineering</th></tr></thead><tbody><tr><td>äººçš„è§’è‰²</td><td>å†™æç¤ºè¯</td><td>æ¶æ„å¸ˆ+å®¡æŸ¥è€…</td></tr><tr><td>AI çš„è§’è‰²</td><td>è¡¥å…¨ä»£ç </td><td>è‡ªä¸»è§„åˆ’+æ‰§è¡Œ</td></tr><tr><td>äº¤äº’æ–¹å¼</td><td>ä¸€é—®ä¸€ç­”</td><td>ä¸‹å‘ä»»åŠ¡ï¼ŒæŒç»­ç›‘æ§</td></tr><tr><td>è´¨é‡æ§åˆ¶</td><td>ç¢°è¿æ°”</td><td>ç³»ç»ŸåŒ– Review</td></tr><tr><td>é€‚ç”¨åœºæ™¯</td><td>Demoã€å°å·¥å…·</td><td>ç”Ÿäº§çº§é¡¹ç›®</td></tr></tbody></table>
<p><strong>beforeï¼š</strong> ä½ èŠ± 2 å°æ—¶å†™ 20 æ¡æç¤ºè¯ï¼Œä¸€æ®µä¸€æ®µæ‹¼å‡‘å‡ºä¸€ä¸ªåŠŸèƒ½ã€‚</p>
<p><strong>afterï¼š</strong> ä½ èŠ± 10 åˆ†é’Ÿå†™ä¸€ä»½éœ€æ±‚æ–‡æ¡£ï¼ŒAgent ç”¨ 30 åˆ†é’Ÿè‡ªå·±è·‘å®Œï¼Œä½ èŠ± 20 åˆ†é’Ÿ Reviewã€‚</p>
<p>è¿™ä¸æ˜¯æ•ˆç‡æå‡ 10%ã€‚è¿™æ˜¯å·¥ä½œæ–¹å¼çš„æ ¹æœ¬å˜åŒ–ã€‚</p>
<hr/>
<h2 data-id="heading-2"><strong>03 æˆ‘è‡ªå·±çš„ä½“æ„Ÿ</strong></h2>
<p>è¯´å®è¯ï¼ŒKarpathy è¿™æ¬¡æ˜¯åœ¨"è¿½è®¤"ä¸€ä¸ªå·²ç»å‘ç”Ÿçš„äº‹å®ã€‚</p>
<p>è¿‡å»ä¸‰ä¸ªæœˆï¼Œæˆ‘å›¢é˜Ÿåšäº† 30 å¤šä¸ªå‡ºæµ·å°äº§å“ã€‚å¦‚æœè¿˜åœ¨"Vibe Coding"æ¨¡å¼â€”â€”ä¸€è¡Œä¸€è¡Œæç¤º AI å†™â€”â€”æ ¹æœ¬ä¸å¯èƒ½åšåˆ°è¿™ä¸ªé€Ÿåº¦ã€‚</p>
<p>æˆ‘ç°åœ¨çš„å®é™…å·¥ä½œæµæ˜¯è¿™æ ·çš„ï¼š</p>
<p><strong>1ï¼‰éœ€æ±‚é˜¶æ®µï¼š</strong> æˆ‘å†™æ¸…æ¥šè¦åšä»€ä¹ˆï¼ˆä¸æ˜¯æ€ä¹ˆåšï¼‰ï¼ŒåŒ…æ‹¬æŠ€æœ¯é€‰å‹ã€ç›®æ ‡ç”¨æˆ·ã€æ ¸å¿ƒåŠŸèƒ½ã€‚</p>
<p><strong>2ï¼‰æ‰§è¡Œé˜¶æ®µï¼š</strong> ä¸¢ç»™ Claude Code æˆ– Cursor Agentï¼Œè®©å®ƒè‡ªå·±å»å»ºé¡¹ç›®ã€å†™ä»£ç ã€è£…ä¾èµ–ã€è·‘æµ‹è¯•ã€‚æˆ‘å»å–æ¯å’–å•¡ã€‚</p>
<p><strong>3ï¼‰Review é˜¶æ®µï¼š</strong> å›æ¥çœ‹ diffï¼Œæ£€æŸ¥æ¶æ„åˆä¸åˆç†ã€æœ‰æ²¡æœ‰å®‰å…¨é—®é¢˜ã€ä»£ç é£æ ¼å¯¹ä¸å¯¹ã€‚ä¸è¡Œçš„åœ°æ–¹æŒ‡å‡ºæ¥ï¼Œè®© Agent æ”¹ã€‚</p>
<p><strong>4ï¼‰è¿­ä»£é˜¶æ®µï¼š</strong> Agent æ”¹å®Œï¼Œæˆ‘å†çœ‹ä¸€è½®ã€‚ç›´åˆ°æ»¡æ„ã€‚</p>
<p>æ•´ä¸ªè¿‡ç¨‹é‡Œï¼Œæˆ‘æ‰‹åŠ¨å†™çš„ä»£ç å¯èƒ½ä¸åˆ° 1%ã€‚ä½†æˆ‘åšçš„å†³ç­–â€”â€”æŠ€æœ¯é€‰å‹ã€æ¶æ„è®¾è®¡ã€è´¨é‡æŠŠå…³â€”â€”è¿™äº›å äº† 90%çš„ä»·å€¼ã€‚</p>
<p><strong>è¿™å°±æ˜¯ Agentic Engineeringã€‚ä½ ä¸å†™ä»£ç ï¼Œä½†ä½ è¦æ¯”ä»¥å‰æ›´æ‡‚ä»£ç ã€‚</strong></p>
<hr/>
<h2 data-id="heading-3"><strong>04 å¯¹ç¨‹åºå‘˜æ„å‘³ç€ä»€ä¹ˆ</strong></h2>
<p>å…ˆè¯´ä¸€ä¸ªæ•°æ®ï¼šAnthropic çš„ CPO Mike Krieger ä¸Šå‘¨é€éœ²ï¼ŒClaude å·²ç»å†™äº†ä»–ä»¬å…¬å¸æ¥è¿‘ 100%çš„ä»£ç ã€‚å¾®è½¯åŒä¸€å‘¨è®¾ç«‹äº†ä¸€ä¸ªæ–°å²—ä½â€”â€”å·¥ç¨‹è´¨é‡è´Ÿè´£äººï¼ˆEngineering Quality Leadï¼‰ï¼Œä¸“é—¨ç›¯ AI ç”Ÿæˆä»£ç çš„è´¨é‡ã€‚</p>
<p>è¿™ä¸¤ä»¶äº‹æ‹¼åœ¨ä¸€èµ·çœ‹ï¼Œä¿¡å·éå¸¸æ˜ç¡®ï¼š</p>
<p><strong>AI å†™ä»£ç çš„é‡çº§å·²ç»ä¸å¯é€†äº†ã€‚ä½†"è°æ¥ä¿è¯è´¨é‡"æˆäº†æ–°çš„æ ¸å¿ƒé—®é¢˜ã€‚</strong></p>
<p>GitClear çš„æ•°æ®ä¹Ÿå°è¯äº†è¿™ç‚¹ï¼šAI ç”Ÿæˆä»£ç çš„ code churnï¼ˆå†™äº†åˆæ”¹ã€æ”¹äº†åˆåˆ çš„æ¯”ä¾‹ï¼‰æ¯”äººå·¥ä»£ç é«˜äº†è¿‘ä¸€å€ã€‚ä»£ç å†™å¾—å¤šâ‰ ä»£ç å†™å¾—å¥½ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3164a289cab44169823a25fca3f3c19b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771309253&amp;x-signature=ygESVdTp6J4U3I63CF7qWDDI8QY%3D" alt="" loading="lazy"/></p>
<p>æ‰€ä»¥ï¼Œæœªæ¥ç¨‹åºå‘˜çš„æ ¸å¿ƒèƒ½åŠ›ä¸æ˜¯"å†™ä»£ç å¿«"ï¼Œè€Œæ˜¯ï¼š</p>
<ul>
<li>
<p><strong>æ¶æ„èƒ½åŠ›</strong>ï¼šå‘Šè¯‰ Agent æ€ä¹ˆæ‹†åˆ†æ¨¡å—ã€é€‰ä»€ä¹ˆæ–¹æ¡ˆ</p>
</li>
<li>
<p><strong>Review èƒ½åŠ›</strong>ï¼šä¸€çœ¼çœ‹å‡º Agent ç”Ÿæˆä»£ç çš„é—®é¢˜</p>
</li>
<li>
<p><strong>ç³»ç»Ÿè®¾è®¡</strong>ï¼šAgent ä¸ä¼šå¸®ä½ åšå–èˆï¼Œä½ å¾—è‡ªå·±å†³å®š</p>
</li>
<li>
<p><strong>äº§å“ sense</strong>ï¼šçŸ¥é“è¯¥åšä»€ä¹ˆæ¯”çŸ¥é“æ€ä¹ˆåšæ›´å€¼é’±</p>
</li>
</ul>
<hr/>
<h2 data-id="heading-4">05 ä¸€ä¸ªå¯èƒ½è®©ä½ ä¸èˆ’æœçš„åˆ¤æ–­</h2>
<p><strong>Vibe Coding é™ä½äº†ç¼–ç¨‹çš„é—¨æ§›ã€‚Agentic Engineering ä¼šæ‹‰å¼€å·¥ç¨‹å¸ˆä¹‹é—´çš„å·®è·ã€‚</strong></p>
<p>å› ä¸º Vibe Coding æ—¶ä»£ï¼Œå¤§å®¶æ¯”çš„æ˜¯"è°çš„æç¤ºè¯å†™å¾—å¥½"ï¼Œé—¨æ§›ä¸é«˜ã€‚</p>
<p>ä½† Agentic Engineering æ—¶ä»£ï¼Œä½ å¾—æ‡‚æ¶æ„ã€æ‡‚ç³»ç»Ÿè®¾è®¡ã€æ‡‚å·¥ç¨‹è´¨é‡ã€æ‡‚äº§å“é€»è¾‘ã€‚Agent è¶Šå¼ºï¼Œå¯¹æ“æ§ Agent çš„äººè¦æ±‚è¶Šé«˜ã€‚</p>
<p>è¿™å°±åƒâ€”â€”è‡ªåŠ¨é©¾é©¶è¶Šå…ˆè¿›ï¼Œå¯¹è®¾è®¡è‡ªåŠ¨é©¾é©¶ç³»ç»Ÿçš„å·¥ç¨‹å¸ˆè¦æ±‚è¶Šé«˜ï¼Œè€Œä¸æ˜¯è¶Šä½ã€‚</p>
<p>Karpathy è‡ªå·±ä¹Ÿè¯´äº†ï¼š"It's something you can learn and become better atï¼Œ with its own depth of a different kindã€‚"</p>
<p>è¿™æ˜¯ä¸€é—¨æ–°çš„æ‰‹è‰ºã€‚å­¦ä¸å­¦ï¼Œä½ è‡ªå·±å®šã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/86c35fa2959146debd7b6442c76f98f8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771309253&amp;x-signature=lpYfM%2FhM5sGWGiJYACLqTop%2BlqU%3D" alt="" loading="lazy"/></p>
<hr/>
<p><strong>2025 å¹´ï¼Œäººäººéƒ½åœ¨ Vibe Codingã€‚2026 å¹´ï¼Œèƒ½åš Agentic Engineering çš„äººï¼Œæ‰æ˜¯çœŸæ­£çš„ç¨€ç¼ºèµ„æºã€‚</strong></p>
<hr/>
<p>å¦‚æœè¿™ç¯‡å¯¹ä½ æœ‰å¸®åŠ©ï¼Œæ¬¢è¿ç‚¹èµã€æ”¶è—ã€å…³æ³¨ï¼Œä½ çš„æ”¯æŒæ˜¯æˆ‘æŒç»­è¾“å‡ºçš„åŠ¨åŠ› âœ¨</p>
<hr/>
<p>æˆ‘çš„å…¶ä»–å¹³å°è´¦å·å’Œå¼€æºé¡¹ç›®åœ¨ä¸ªäººä¸»é¡µä¸­ï¼Œæ¬¢è¿äº¤æµ ğŸ¤</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[IntelliJ IDEA 2026.1 EAP 3 å‘å¸ƒï¼šè¢«å¼€å‘è€…å‚¬äº† 6 å¹´ï¼Œè¿™ä¸ªç»†èŠ‚ç»ˆäºä¿®äº†ï¼]]></title>    <link>https://juejin.cn/post/7604775190212919306</link>    <guid>https://juejin.cn/post/7604775190212919306</guid>    <pubDate>2026-02-10T06:36:14.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604775190212919306" data-draft-id="7604786493640212507" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="IntelliJ IDEA 2026.1 EAP 3 å‘å¸ƒï¼šè¢«å¼€å‘è€…å‚¬äº† 6 å¹´ï¼Œè¿™ä¸ªç»†èŠ‚ç»ˆäºä¿®äº†ï¼"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2026-02-10T06:36:14.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç¥å¥‡å°æ±¤åœ†"/> <meta itemprop="url" content="https://juejin.cn/user/1151943919285431"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            IntelliJ IDEA 2026.1 EAP 3 å‘å¸ƒï¼šè¢«å¼€å‘è€…å‚¬äº† 6 å¹´ï¼Œè¿™ä¸ªç»†èŠ‚ç»ˆäºä¿®äº†ï¼
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1151943919285431/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç¥å¥‡å°æ±¤åœ†
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T06:36:14.000Z" title="Tue Feb 10 2026 06:36:14 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>JetBrains å‘å¸ƒäº†Â <strong>IntelliJ IDEA 2026.1 EAP 3</strong>ã€‚ è¿™æ¬¡æ›´æ–°çš„æ”¹åŠ¨å¾ˆå¤šï¼Œä½†æœ€å€¼å¾—é‡ç‚¹è¯´çš„ï¼Œå…¶å®æ˜¯ä¸€ä¸ªè¢«å¼€å‘è€…åæ§½äº†æ•´æ•´Â <strong>6 å¹´</strong>Â çš„åŸºç¡€åŠŸèƒ½ï¼Œç»ˆäºè½åœ°ï¼š</p>
<blockquote>
<p>åœ¨ IDE ä¸­åˆ é™¤æ–‡ä»¶æ—¶ï¼Œå°†ç§»åŠ¨åˆ°ç³»ç»Ÿå›æ”¶ç«™/åƒåœ¾æ¡¶ï¼Œè€Œä¸æ˜¯ç›´æ¥æ°¸ä¹…åˆ é™¤ã€‚</p>
</blockquote>
<p>åœ¨ JetBrains çš„ issue ä¸­ï¼Œè¿™ä¸ªéœ€æ±‚æœ€æ—©åœ¨ 6 å¹´å‰æå‡ºã€‚è¿‡å» JetBrains IDE çš„è¡Œä¸ºæ˜¯ï¼š</p>
<ul>
<li>åœ¨ Project è§†å›¾ä¸­åˆ é™¤æ–‡ä»¶</li>
<li><strong>ç›´æ¥æ°¸ä¹…åˆ é™¤</strong></li>
<li>ä¸è¿›å…¥ç³»ç»Ÿå›æ”¶ç«™</li>
<li>åªèƒ½é Â Local History**Â æˆ– Git æ‰¾å›</li>
</ul>
<p>è¿™å’Œ VS Codeã€Visual Studioã€Finder/Explorer ç­‰ä¸»æµå·¥å…·å®Œå…¨ä¸åŒã€‚</p>
<p>è€Œåœ¨Â <strong>2026.1 EAP 3</strong>Â ä¸­ï¼Œè¿™ä¸ª issue å·²è¢«æ­£å¼æ ‡è®°ä¸ºï¼š</p>
<ul>
<li><strong>State: Fixed</strong></li>
<li>Available in: 2026.1 EAP 3</li>
</ul>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼š</p>
<blockquote>
<p>ç°åœ¨åˆ é™¤æ–‡ä»¶çš„è¡Œä¸ºå˜ä¸ºÂ <strong>ç§»åŠ¨åˆ°å›æ”¶ç«™</strong>ï¼Œè€Œä¸æ˜¯Â <strong>ç›´æ¥æ°¸ä¹…åˆ é™¤</strong>ã€‚</p>
</blockquote>
<p>å¾ˆå¤šäººä¼šè¯´ï¼š</p>
<blockquote>
<p>æœ‰ Git å°±å¤Ÿäº†ã€‚</p>
</blockquote>
<p>ä½†ç°å®æƒ…å†µæ˜¯ï¼š</p>
<blockquote>
<p>å¹¶ä¸æ˜¯æ‰€æœ‰æ–‡ä»¶éƒ½åœ¨ Git ä¸­ã€‚</p>
</blockquote>
<ul>
<li>æ–°å»ºæœªæäº¤æ–‡ä»¶</li>
<li>æœ¬åœ°è„šæœ¬</li>
<li>SQL</li>
<li>scratch</li>
<li>ä¸´æ—¶ä»£ç </li>
<li>é…ç½®æ–‡ä»¶</li>
</ul>
<p>è¿™äº›æ–‡ä»¶ä¸€æ—¦è¯¯åˆ ï¼Œ<strong>Git å®Œå…¨å¸®ä¸ä¸Šå¿™</strong>ã€‚</p>
<p>JetBrains ä¸€ç›´æ¨èä½¿ç”¨ Local Historyï¼Œä½†å®ƒå¹¶ä¸å®Œç¾ï¼š</p>
<ul>
<li>ä¼šè¢«æ¸…ç†</li>
<li>å‡çº§å¯èƒ½ä¸¢</li>
<li>æŸ¥æ‰¾æˆæœ¬é«˜</li>
<li>Undo ä¸ä¸€å®šå¯ç”¨</li>
<li>æ–°æ‰‹ä¸çŸ¥é“åœ¨å“ª</li>
</ul>
<p>è€Œç³»ç»Ÿå›æ”¶ç«™çš„ä¼˜åŠ¿éå¸¸æ˜æ˜¾ï¼š</p>
<ul>
<li>ç”¨æˆ·ä¹ æƒ¯ä¸€è‡´</li>
<li>å¯è§†åŒ–</li>
<li>è·¨åº”ç”¨</li>
<li>ä¸ä¾èµ– IDE</li>
<li>100% ç›´è§‰</li>
</ul>
<p>è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå‡ ä¹æ‰€æœ‰ç¼–è¾‘å™¨éƒ½é»˜è®¤è¿™ä¹ˆåšã€‚</p>
<p>å®ƒè§£å†³çš„æ˜¯ï¼š</p>
<blockquote>
<p>æœ€å¸¸è§ã€æœ€è‡´å‘½ã€æœ€å®¹æ˜“å‘ç”Ÿçš„ IDE äº‹æ•…ä¹‹ä¸€ã€‚</p>
</blockquote>
<p>é™¤äº†å›æ”¶ç«™ï¼Œ2026.1 EAP 3 è¿˜æœ‰ä¸å°‘å€¼å¾—å…³æ³¨çš„æ”¹è¿›ï¼š</p>
<h2 data-id="heading-0">1. Spring ç›¸å…³</h2>
<ul>
<li>æ˜¾ç¤ºæ³¨å…¥Â Bean inlay**</li>
<li>Debugger è¿è¡Œæ—¶ Bean æç¤º</li>
<li>API versioning é…ç½®æ”¹è¿›</li>
<li>è‡ªåŠ¨æ£€æµ‹ SQL æ–¹è¨€</li>
</ul>
<h2 data-id="heading-1">2. Java</h2>
<ul>
<li>æ”¯æŒæ›´å¤šÂ <code>javac</code>Â å‚æ•°è¡¥å…¨</li>
<li>pattern matching è¯Šæ–­ä¿®å¤</li>
<li>import æ€§èƒ½ä¼˜åŒ–</li>
</ul>
<h2 data-id="heading-2">3. Kotlin</h2>
<ul>
<li>K1 API**Â å¼€å§‹åºŸå¼ƒ</li>
<li>æ–°è§£æ„è¯­æ³•å¯¼èˆªæ”¯æŒ</li>
<li>ç¼–è¯‘å™¨ç”Ÿæˆå£°æ˜Â inlay æç¤º**</li>
</ul>
<h2 data-id="heading-3">4. ç¼–è¾‘å™¨ä½“éªŒ</h2>
<ul>
<li>å…‰æ ‡å¹³æ»‘åŠ¨ç”»</li>
<li>åœ†è§’å…‰æ ‡</li>
<li>ç»ˆç«¯ä½“éªŒä¿®å¤</li>
<li>æ’ä»¶ç®¡ç†æ”¹è¿›</li>
</ul>
<h2 data-id="heading-4">5. AI ä¸å‘½ä»¤è¡¥å…¨</h2>
<ul>
<li><code>replace_text_in_file</code>Â ä¿®å¤ç©ºæ–‡æœ¬æ›¿æ¢é—®é¢˜</li>
<li>AI command completion å›¾æ ‡æ›´æ–°</li>
<li>JavaMemberNameCompletionContributor æ”¹ä¸º ModCommand completion</li>
<li>ä¿®å¤æ–°è¡Œ + tab åœºæ™¯ä¸‹å‘½ä»¤ç”Ÿæˆå¤±æ•ˆ</li>
<li>æ”¯æŒè·³è¿‡æŸäº›æ— æ„ä¹‰å‘½ä»¤è¡¥å…¨</li>
<li>MCP Server å¤šé¡¹ä¿®å¤ï¼ˆLLM å·¥ä½œæµç›¸å…³ï¼‰</li>
</ul>
<h2 data-id="heading-5">6. å¹³å°æ¶æ„</h2>
<ul>
<li>ç§»é™¤ ProjectExtension</li>
<li>AI assistant æ’ä»¶å‰ç«¯åŒ–</li>
<li>LSP null safety**Â ä¿®å¤</li>
<li>æ”¯æŒåå° write actions</li>
<li>æ¸…ç† CachedValuesManager</li>
</ul>
<p>è¿™äº›éƒ½æ˜¯ï¼š</p>
<blockquote>
<p>ä¸ºâ€œè¿œç¨‹ IDE + AI IDE + åˆ†å¸ƒå¼ IDEâ€åšå‡†å¤‡ã€‚</p>
</blockquote>
<h2 data-id="heading-6">7. æ€§èƒ½ä¸ç¨³å®šæ€§</h2>
<ul>
<li>Gradle sync æ–‡ä»¶æ³„æ¼</li>
<li>VFS é€’å½’åŠ è½½é—®é¢˜</li>
<li>Debugger CPU å†²çª</li>
<li>åˆ†æ”¯åˆ‡æ¢å¡æ­»</li>
<li>Git å¤±æ•ˆ</li>
<li>æ’ä»¶å…¼å®¹è¯¯æŠ¥</li>
<li>å…¶ä»– 70+ ä¸ªå·²çŸ¥é—®é¢˜ä¿®å¤</li>
</ul>
<blockquote>
<p>ä¾†æºï¼šxxyå¼€æº</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[è¢« Seedance 2.0 çš„æµå¼å“åº”å‘äº†ä¸€æ•´æ™šï¼šå…³äº SSE æ•°æ®åŒ…æˆªæ–­çš„æš´åŠ›è§£æ³• (é™„ Python è„šæœ¬)]]></title>    <link>https://juejin.cn/post/7604775190212771850</link>    <guid>https://juejin.cn/post/7604775190212771850</guid>    <pubDate>2026-02-10T06:11:12.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604775190212771850" data-draft-id="7604805226696425510" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="è¢« Seedance 2.0 çš„æµå¼å“åº”å‘äº†ä¸€æ•´æ™šï¼šå…³äº SSE æ•°æ®åŒ…æˆªæ–­çš„æš´åŠ›è§£æ³• (é™„ Python è„šæœ¬)"/> <meta itemprop="keywords" content="Python,äººå·¥æ™ºèƒ½"/> <meta itemprop="datePublished" content="2026-02-10T06:11:12.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ä¸ƒç‰›äº‘è¡Œä¸šåº”ç”¨"/> <meta itemprop="url" content="https://juejin.cn/user/3722267698664140"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            è¢« Seedance 2.0 çš„æµå¼å“åº”å‘äº†ä¸€æ•´æ™šï¼šå…³äº SSE æ•°æ®åŒ…æˆªæ–­çš„æš´åŠ›è§£æ³• (é™„ Python è„šæœ¬)
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3722267698664140/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ä¸ƒç‰›äº‘è¡Œä¸šåº”ç”¨
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T06:11:12.000Z" title="Tue Feb 10 2026 06:11:12 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>å…„å¼Ÿä»¬ï¼Œå¿ƒæ€å´©äº†ã€‚</p>
<p>æ˜¨æ™šæœ¬æ¥æƒ³è¶ç€å­—èŠ‚ Seedance 2.0 åˆšå‡ºï¼Œèµ¶ç´§æ¥ä¸ª API è·‘ä¸ª Demo çœ‹çœ‹æ•ˆæœã€‚å®˜æ–¹æ–‡æ¡£å†™å¾—å€’æ˜¯æŒºâ€œç®€æ´â€ï¼Œå°±ç»™äº†ä¸ª curl ç¤ºä¾‹ã€‚æˆ‘å¯»æ€è¿™è¿˜ä¸ç®€å•ï¼Ÿç›´æ¥ç”¨ requests åº“ä¸€æŠŠæ¢­ã€‚</p>
<p>ç»“æœï¼Œä»£ç è·‘èµ·æ¥ï¼Œè¿™æŠ¥é”™ç›´æ¥ç»™æˆ‘æ•´ä¸ä¼šäº†ï¼š json.decoder.JSONDecodeError: Expecting value: line 1 column 1 (char 0)</p>
<p>æ’æŸ¥äº†ä¸¤ä¸ªå°æ—¶ï¼Œæ‰å‘ç°è¿™ API çš„æµå¼å“åº”ï¼ˆSSEï¼‰ç®€ç›´æ˜¯ç¾éš¾ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/089f210a0a4543b2b7b4d6418d006c7a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiD54mb5LqR6KGM5Lia5bqU55So:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771308674&amp;x-signature=9irqFHMETNwgtmi8FYlxFZy54bk%3D" alt="jimeng-2026-02-10-7384-ä¸€å¼ çœŸå®æ„Ÿåè¶³çš„ç»ˆç«¯æŠ¥é”™æˆªå›¾ï¼ŒèƒŒæ™¯ä¸ºæ·±é»‘è‰²ã€‚å±å¹•ä¸Šè¿è¡Œç€ä¸€ä¸ªæ•°æ®å¤„ç†ç¨‹åºï¼Œçªç„¶ä¸­....png" loading="lazy"/></p>
<ol>
<li>è¸©å‘ç°åœº</li>
</ol>
<p>Seedance çš„ API æ˜¯æµå¼è¿”å›è¿›åº¦çš„ (stream=True)ã€‚é—®é¢˜åœ¨äºï¼Œå®ƒåå‡ºæ¥çš„ chunks ä¸æ˜¯æŒ‰ JSON è¾¹ç•Œåˆ‡å‰²çš„ï¼</p>
<p>æœ‰æ—¶å€™ç½‘ç»œä¸€æŠ–ï¼Œä¸€ä¸ªå®Œæ•´çš„ JSON å¯¹è±¡ä¼šè¢«åˆ‡æˆä¸¤åŠï¼š</p>
<p>â—Â Chunk 1: data: {"status": "processing", "progre</p>
<p>â—Â Chunk 2: ss": 45}</p>
<p>ä½ ç›´æ¥å¯¹ Chunk 1 åš json.loadsï¼Œå¿…æŒ‚æ— ç–‘ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/078703cfde8b45ab9d9c7e5d37ddfe7b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiD54mb5LqR6KGM5Lia5bqU55So:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771308674&amp;x-signature=Jp2yOTmLoTI4rPP7r0Fed92koX0%3D" alt="jimeng-2026-02-10-4472-ä¸€å¼ æ‰‹ç»˜é£æ ¼çš„æµå¼æ‹¼æ¥åŸç†è‰å›¾ã€‚ç”»é¢åˆ†ä¸ºå·¦ã€ä¸­ã€å³ä¸‰éƒ¨åˆ†ã€‚å·¦ä¾§æ˜¯ä¸¤ä¸ªç ´ç¢çš„æ•°æ®å—....png" loading="lazy"/></p>
<ol start="2">
<li>æš´åŠ›è§£æ³• (Python)</li>
</ol>
<p>å®˜æ–¹ SDK è¿˜æ²¡å‡ºï¼Œåªèƒ½è‡ªå·±æ‰‹æ’¸ä¸€ä¸ª Buffer ç¼“å†²æ± ã€‚é€»è¾‘å¾ˆç®€å•ï¼šæ‹¼ï¼ æ‹¼å®Œäº†å†è¯•ç€è§£ï¼Œè§£ä¸å¼€å°±ç»§ç»­æ‹¼ä¸‹ä¸€ä¸ª chunkã€‚</p>
<p>åºŸè¯ä¸å¤šè¯´ï¼Œç›´æ¥ä¸Šä»£ç ã€‚è¿™æ®µä»£ç å¯ä»¥ç›´æ¥ copy ç”¨ï¼Œäº²æµ‹ç¨³å¾—ä¸€åŒ¹ã€‚</p>
<p>Python</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> requests
<span class="hljs-keyword">import</span> json
Â 
<span class="hljs-keyword">def</span> <span class="hljs-title function_">generate_video_safe</span>(<span class="hljs-params">prompt</span>):
    url = <span class="hljs-string">"https://api.seedance.byte/v2/video/generate"</span>
    headers = {<span class="hljs-string">"Authorization"</span>: <span class="hljs-string">"Bearer YOUR_API_KEY"</span>}
    payload = {<span class="hljs-string">"prompt"</span>: prompt, <span class="hljs-string">"stream"</span>: <span class="hljs-literal">True</span>}
Â 
    <span class="hljs-keyword">try</span>:
        <span class="hljs-comment"># å¿…é¡»å¼€å¯ stream=True</span>
        response = requests.post(url, json=payload, headers=headers, stream=<span class="hljs-literal">True</span>)
        
        buffer = <span class="hljs-string">""</span> <span class="hljs-comment"># å®šä¹‰ä¸€ä¸ªç¼“å†²æ± </span>
        
        <span class="hljs-keyword">for</span> chunk <span class="hljs-keyword">in</span> response.iter_content(chunk_size=<span class="hljs-number">1024</span>):
            <span class="hljs-keyword">if</span> chunk:
                <span class="hljs-comment"># 1. è§£ç å½“å‰ chunk å¹¶æ‹¼æ¥åˆ° buffer</span>
                part = chunk.decode(<span class="hljs-string">'utf-8'</span>)
                buffer += part
                
                <span class="hljs-comment"># 2. å°è¯•æŒ‰è¡Œåˆ†å‰² (SSE é€šå¸¸ä»¥ \n\n åˆ†éš”)</span>
                <span class="hljs-keyword">while</span> <span class="hljs-string">"\n\n"</span> <span class="hljs-keyword">in</span> buffer:
                    message, buffer = buffer.split(<span class="hljs-string">"\n\n"</span>, <span class="hljs-number">1</span>)
                    
                    <span class="hljs-keyword">if</span> message.startswith(<span class="hljs-string">"data: "</span>):
                        json_str = message.replace(<span class="hljs-string">"data: "</span>, <span class="hljs-string">""</span>)
                        <span class="hljs-keyword">try</span>:
                            <span class="hljs-comment"># 3. å°è¯•è§£æ JSON</span>
                            data = json.loads(json_str)
                            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"è¿›åº¦: <span class="hljs-subst">{data.get(<span class="hljs-string">'progress'</span>)}</span>%"</span>)
                            
                            <span class="hljs-comment"># 4. è·å–æœ€ç»ˆè§†é¢‘åœ°å€</span>
                            <span class="hljs-keyword">if</span> data.get(<span class="hljs-string">'status'</span>) == <span class="hljs-string">'succeeded'</span>:
                                video_url = data.get(<span class="hljs-string">'output_url'</span>)
                                <span class="hljs-keyword">return</span> optimize_url(video_url)
                                
                        <span class="hljs-keyword">except</span> json.JSONDecodeError:
                            <span class="hljs-comment"># è§£æå¤±è´¥è¯´æ˜æ•°æ®ä¸å®Œæ•´ï¼Œè·³è¿‡ï¼Œç­‰å¾…ä¸‹ä¸€ä¸ª chunk æ‹¼æ¥</span>
                            <span class="hljs-keyword">continue</span>
                            
    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"è¯·æ±‚ç‚¸äº†: <span class="hljs-subst">{e}</span>"</span>)
Â 
<span class="hljs-comment"># ã€ä¼˜åŒ–ç‚¹ã€‘</span>
<span class="hljs-comment"># Seedance åŸç”Ÿå‡ºæ¥çš„è§†é¢‘ URLï¼ˆS3 é“¾æ¥ï¼‰åœ¨å›½å†…è®¿é—®å·¨æ…¢ï¼Œç»å¸¸å¡é¡¿</span>
<span class="hljs-comment"># å»ºè®®åœ¨é…ç½®é‡Œå¥—ä¸€å±‚ä¸ƒç‰›äº‘çš„ CDN æˆ–è€…æ˜¯ Kodo çš„å›æºåœ°å€</span>
<span class="hljs-comment"># å¦åˆ™å‰ç«¯ img æ ‡ç­¾åŠ è½½ä¼šè½¬åœˆè½¬åˆ°æ­»</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">optimize_url</span>(<span class="hljs-params">origin_url</span>):
    <span class="hljs-comment"># è¿™é‡Œè®°å¾—æ¢æˆä½ è‡ªå·±çš„ä¸ƒç‰› CDN åŸŸå</span>
    cdn_host = <span class="hljs-string">"https://cdn-video.your-domain.com"</span> 
    <span class="hljs-comment"># ç®€å•çš„å­—ç¬¦ä¸²æ›¿æ¢ï¼Œç”Ÿäº§ç¯å¢ƒå»ºè®®ç”¨æ­£åˆ™</span>
    <span class="hljs-keyword">return</span> origin_url.replace(<span class="hljs-string">"https://tos-source.byte.com"</span>, cdn_host)
Â 
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    final_url = generate_video_safe(<span class="hljs-string">"ä¸€åªåœ¨æ•²ä»£ç çš„çŒ«ï¼Œèµ›åšæœ‹å…‹é£æ ¼"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"ç”Ÿæˆå®Œæ¯•ï¼ŒåŠ é€Ÿé“¾æ¥: <span class="hljs-subst">{final_url}</span>"</span>)
</code></pre>
<p>Â </p>
<ol start="3">
<li>é¿å‘æ€»ç»“</li>
</ol>
<p>1.Â Â ä¸è¦ä¿¡ curl ç¤ºä¾‹ï¼š ç”Ÿäº§ç¯å¢ƒå¿…é¡»å¤„ç† TCP æ‹†åŒ…ç²˜åŒ…é—®é¢˜ã€‚</p>
<p>2.Â Â Buffer æ˜¯å¿…é¡»çš„ï¼š åˆ«æƒ³ç€ç”¨ response.json() ç›´æ¥æ‹¿ç»“æœï¼Œé‚£æ˜¯åŒæ­¥æ¥å£æ‰é…äº«æœ‰çš„å¾…é‡ã€‚</p>
<p>3.Â Â æºç«™å¾ˆæ…¢ï¼š å¦‚æœä½ çš„åº”ç”¨æ˜¯é¢å‘å›½å†…ç”¨æˆ·çš„ï¼Œåƒä¸‡åˆ«ç›´æ¥ä¸‹å‘æºç«™ URLã€‚æˆ‘åœ¨ä»£ç é‡ŒåŠ äº†ä¸ª optimize_url å‡½æ•°ï¼ŒæŠŠåŸŸåæ›¿æ¢æˆäº†ä¸ƒç‰›äº‘çš„ CDN é“¾æ¥ï¼ŒåŠ è½½é€Ÿåº¦ä» 10s å˜æˆäº† 300msï¼Œè¿™æ‰æ˜¯ç”¨æˆ·èƒ½æ¥å—çš„ä½“éªŒã€‚</p>
<p>ä»£ç æ‹¿èµ°ä¸è°¢ï¼Œè®°å¾—ç‚¹ä¸ªèµï¼Œä»Šæ™šåˆ«é€šå®µäº†ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä¸€çœ‹å°±æ‡‚çš„ Haskell æ•™ç¨‹ - æ ‡å‡†åº“ç±»å‹ç±»]]></title>    <link>https://juejin.cn/post/7604769326224015396</link>    <guid>https://juejin.cn/post/7604769326224015396</guid>    <pubDate>2026-02-10T06:28:10.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604769326224015396" data-draft-id="7604757482004283455" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä¸€çœ‹å°±æ‡‚çš„ Haskell æ•™ç¨‹ - æ ‡å‡†åº“ç±»å‹ç±»"/> <meta itemprop="keywords" content="Haskell"/> <meta itemprop="datePublished" content="2026-02-10T06:28:10.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Anita_Sun"/> <meta itemprop="url" content="https://juejin.cn/user/1811635884786839"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä¸€çœ‹å°±æ‡‚çš„ Haskell æ•™ç¨‹ - æ ‡å‡†åº“ç±»å‹ç±»
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1811635884786839/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Anita_Sun
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T06:28:10.000Z" title="Tue Feb 10 2026 06:28:10 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä¸€ã€Haskellæ ‡å‡†åº“ç±»å‹ç±»çš„å®˜æ–¹æŸ¥é˜…æ¸ é“</h2>
<p>Haskellæ ‡å‡†åº“çš„ç±»å‹ç±»ä¸»è¦é›†ä¸­åœ¨ <code>base</code> åŒ…ä¸­ï¼Œä»¥ä¸‹æ˜¯è·å–<strong>å®Œæ•´ç±»å‹ç±»æ¸…å•</strong>çš„æƒå¨é€”å¾„ï¼š</p>
<h3 data-id="heading-1">1. å®˜æ–¹æ–‡æ¡£ï¼ˆæœ€å…¨é¢ï¼‰</h3>
<ul>
<li>
<p><strong>æ ¸å¿ƒå…¥å£</strong>ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fhackage.haskell.org%2Fpackage%2Fbase" target="_blank" title="https://hackage.haskell.org/package/base" ref="nofollow noopener noreferrer">Haskell base åŒ…æ–‡æ¡£</a>ï¼ˆé€‰æ‹©å¯¹åº”ç‰ˆæœ¬ï¼Œå¦‚<code>base-4.19.0.0</code>ï¼Œè¿™æ˜¯GHC 9.8çš„é»˜è®¤ç‰ˆæœ¬ï¼‰ï¼›</p>
</li>
<li>
<p><strong>åˆ†ç±»å¯¼èˆª</strong>ï¼šç‚¹å‡»æ–‡æ¡£ä¸­çš„ã€ŒModulesã€ï¼Œæ ¸å¿ƒç±»å‹ç±»åˆ†å¸ƒåœ¨ä»¥ä¸‹æ¨¡å—ä¸­ï¼š</p>
<ul>
<li>

































































<table><thead><tr><th>æ¨¡å—å</th><th>æ ¸å¿ƒç±»å‹ç±»</th><th>ç”¨é€”</th></tr></thead><tbody><tr><td><code>Prelude</code></td><td>Eqã€Ordã€Showã€Readã€Numã€Functorã€Monadç­‰</td><td>é¢„åŠ è½½æ ¸å¿ƒç±»å‹ç±»ï¼ˆæ— éœ€å¯¼å…¥ï¼‰</td></tr><tr><td><code>Data.Eq</code></td><td>Eq</td><td>ç›¸ç­‰æ€§åˆ¤æ–­</td></tr><tr><td><code>Data.Ord</code></td><td>Ordã€Ordering</td><td>å¤§å°æ¯”è¾ƒ</td></tr><tr><td><code>Data.Foldable</code></td><td>Foldable</td><td>å¯æŠ˜å å®¹å™¨ï¼ˆéå†/èšåˆï¼‰</td></tr><tr><td><code>Data.Traversable</code></td><td>Traversable</td><td>å¯éå†å®¹å™¨ï¼ˆå¸¦å‰¯ä½œç”¨æ˜ å°„ï¼‰</td></tr><tr><td><code>Control.Monad</code></td><td>Monadã€MonadPlusã€MonadIOç­‰</td><td>å•å­ï¼ˆé¡ºåºè®¡ç®—ï¼‰</td></tr><tr><td><code>Control.Applicative</code></td><td>Applicativeã€Alternative</td><td>åº”ç”¨å‡½å­ï¼ˆå¤šå‚æ•°æ˜ å°„ï¼‰</td></tr><tr><td><code>Data.Functor</code></td><td>Functorã€Contravariant</td><td>å‡½å­ï¼ˆå•å‚æ•°æ˜ å°„ï¼‰</td></tr><tr><td><code>Numeric.Num</code></td><td>Numã€Fractionalã€Integralç­‰</td><td>æ•°å€¼è¿ç®—</td></tr><tr><td><code>Data.Semigroup</code></td><td>Semigroup</td><td>åŠç¾¤ï¼ˆç»“åˆå¾‹äºŒå…ƒæ“ä½œï¼‰</td></tr><tr><td><code>Data.Monoid</code></td><td>Monoid</td><td>å¹ºåŠç¾¤ï¼ˆåŠç¾¤+å•ä½å…ƒï¼‰</td></tr></tbody></table>
</li>
</ul>
</li>
</ul>
<h3 data-id="heading-2">2. GHCiäº¤äº’å¼æŸ¥è¯¢</h3>
<p>åœ¨GHCiä¸­å¯ç›´æ¥æŸ¥è¯¢ç±»å‹ç±»çš„å®šä¹‰ã€å®ä¾‹å’Œæ–‡æ¡£ï¼š</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">--</span> <span class="hljs-number">1</span>. æŸ¥çœ‹ç±»å‹ç±»çš„å®šä¹‰ï¼ˆå¦‚<span class="hljs-selector-tag">Functor</span>ï¼‰
<span class="hljs-selector-tag">ghci</span>&gt; :<span class="hljs-selector-tag">info</span> <span class="hljs-selector-tag">Functor</span>
<span class="hljs-selector-tag">class</span> <span class="hljs-selector-tag">Functor</span> (<span class="hljs-attribute">f </span>:: * -&gt; *) <span class="hljs-selector-tag">where</span>
  <span class="hljs-selector-tag">fmap</span> :: (a -&gt; b) <span class="hljs-selector-tag">-</span>&gt; <span class="hljs-selector-tag">f</span> <span class="hljs-selector-tag">a</span> <span class="hljs-selector-tag">-</span>&gt; <span class="hljs-selector-tag">f</span> <span class="hljs-selector-tag">b</span>
  (&lt;$) :: <span class="hljs-selector-tag">a</span> <span class="hljs-selector-tag">-</span>&gt; <span class="hljs-selector-tag">f</span> <span class="hljs-selector-tag">b</span> <span class="hljs-selector-tag">-</span>&gt; <span class="hljs-selector-tag">f</span> <span class="hljs-selector-tag">a</span>
  {<span class="hljs-selector-tag">-</span># <span class="hljs-selector-tag">MINIMAL</span> <span class="hljs-selector-tag">fmap</span> <span class="hljs-selector-id">#-</span>}
        <span class="hljs-selector-tag">--</span> <span class="hljs-selector-tag">Defined</span> <span class="hljs-selector-tag">in</span> â€˜<span class="hljs-selector-tag">GHC</span><span class="hljs-selector-class">.Base</span>â€™
<span class="hljs-selector-tag">instance</span> <span class="hljs-selector-tag">Functor</span> <span class="hljs-selector-attr">[]</span> <span class="hljs-selector-tag">--</span> <span class="hljs-selector-tag">Defined</span> <span class="hljs-selector-tag">in</span> â€˜<span class="hljs-selector-tag">GHC</span><span class="hljs-selector-class">.Base</span>â€™
<span class="hljs-selector-tag">instance</span> <span class="hljs-selector-tag">Functor</span> <span class="hljs-selector-tag">Maybe</span> <span class="hljs-selector-tag">--</span> <span class="hljs-selector-tag">Defined</span> <span class="hljs-selector-tag">in</span> â€˜<span class="hljs-selector-tag">GHC</span><span class="hljs-selector-class">.Base</span>â€™
...

<span class="hljs-selector-tag">--</span> <span class="hljs-number">2</span>. æŸ¥çœ‹ç±»å‹ç±»çš„<span class="hljs-selector-tag">Haddock</span>æ–‡æ¡£ï¼ˆéœ€è”ç½‘ï¼‰
<span class="hljs-selector-tag">ghci</span>&gt; :<span class="hljs-selector-tag">doc</span> <span class="hljs-selector-tag">Functor</span>
</code></pre>
<h3 data-id="heading-3">3. ç¦»çº¿æ–‡æ¡£</h3>
<p>å®‰è£…Haskellå¹³å°åï¼Œå¯é€šè¿‡ä»¥ä¸‹å‘½ä»¤ç”Ÿæˆæœ¬åœ°æ–‡æ¡£ï¼š</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-meta"># ç”ŸæˆbaseåŒ…çš„æœ¬åœ°HTMLæ–‡æ¡£</span>
cabal haddock <span class="hljs-keyword">base</span> --html
<span class="hljs-meta"># æˆ–ç”¨stack</span>
stack haddock <span class="hljs-keyword">base</span>
</code></pre>
<p>ç”Ÿæˆçš„æ–‡æ¡£ä¼šä¿å­˜åœ¨æœ¬åœ°ç›®å½•ï¼Œå¯ç¦»çº¿æµè§ˆæ‰€æœ‰ç±»å‹ç±»ã€‚</p>
<h2 data-id="heading-4">äºŒã€Haskellæ ‡å‡†åº“æ ¸å¿ƒç±»å‹ç±»å…¨åˆ†ç±»è§£æ</h2>
<p><code>base</code> åŒ…ä¸­çš„ç±»å‹ç±»å¯æŒ‰â€œåŠŸèƒ½åœºæ™¯â€åˆ†ä¸º8å¤§ç±»ï¼Œä»¥ä¸‹æ˜¯<strong>å®Œæ•´æ ¸å¿ƒæ¸…å•</strong> + æ ¸å¿ƒç”¨é€”è§£æï¼š</p>
<h3 data-id="heading-5">1. åŸºç¡€è¡Œä¸ºç±»ï¼ˆPreludeé»˜è®¤åŠ è½½ï¼‰</h3>















































<table><thead><tr><th>ç±»å‹ç±»</th><th>æ ¸å¿ƒæ–¹æ³•</th><th>æ ¸å¿ƒç”¨é€”</th><th>å…¸å‹å®ä¾‹</th></tr></thead><tbody><tr><td><code>Eq</code></td><td><code>(==)</code>ã€<code>(/=)</code></td><td>åˆ¤æ–­ä¸¤ä¸ªå€¼æ˜¯å¦ç›¸ç­‰</td><td>Intã€Stringã€Maybe a</td></tr><tr><td><code>Ord</code></td><td><code>compare</code>ã€<code>&lt;</code>ã€<code>&lt;=</code>ç­‰</td><td>å¤§å°æ¯”è¾ƒï¼ˆæ’åº/æŸ¥æ‰¾ï¼‰</td><td>æ‰€æœ‰Eqå®ä¾‹ + å¯æ¯”è¾ƒç±»å‹</td></tr><tr><td><code>Show</code></td><td><code>show</code>ã€<code>showList</code></td><td>ç±»å‹è½¬å­—ç¬¦ä¸²ï¼ˆåºåˆ—åŒ–ï¼‰</td><td>å‡ ä¹æ‰€æœ‰æ ‡å‡†ç±»å‹</td></tr><tr><td><code>Read</code></td><td><code>readsPrec</code>ã€<code>readList</code></td><td>å­—ç¬¦ä¸²è½¬ç±»å‹ï¼ˆååºåˆ—åŒ–ï¼‰</td><td>å‡ ä¹æ‰€æœ‰æ ‡å‡†ç±»å‹</td></tr><tr><td><code>Enum</code></td><td><code>succ</code>ã€<code>pred</code>ã€<code>enumFrom</code></td><td>æšä¸¾ç±»å‹ï¼ˆè¿ç»­å€¼ç”Ÿæˆï¼‰</td><td>Intã€Charã€Bool</td></tr><tr><td><code>Bounded</code></td><td><code>minBound</code>ã€<code>maxBound</code></td><td>æœ‰ä¸Šä¸‹ç•Œçš„ç±»å‹</td><td>Intã€Boolã€Char</td></tr></tbody></table>
<h3 data-id="heading-6">2. æ•°å€¼è¿ç®—ç±»ï¼ˆNumericæ¨¡å—ï¼‰</h3>





















































<table><thead><tr><th>ç±»å‹ç±»</th><th>æ ¸å¿ƒæ–¹æ³•</th><th>æ ¸å¿ƒç”¨é€”</th><th>å…¸å‹å®ä¾‹</th></tr></thead><tbody><tr><td><code>Num</code></td><td><code>(+)</code>ã€<code>(-)</code>ã€<code>(*)</code>ã€<code>fromInteger</code></td><td>åŸºç¡€æ•°å€¼è¿ç®—</td><td>Intã€Doubleã€Integer</td></tr><tr><td><code>Fractional</code></td><td><code>(/)</code>ã€<code>fromRational</code></td><td>åˆ†æ•°è¿ç®—ï¼ˆé™¤æ³•ï¼‰</td><td>Doubleã€Floatã€Rational</td></tr><tr><td><code>Floating</code></td><td><code>sin</code>ã€<code>cos</code>ã€<code>exp</code>ç­‰</td><td>æµ®ç‚¹æ•°ä¸“ç”¨è¿ç®—</td><td>Doubleã€Float</td></tr><tr><td><code>Integral</code></td><td><code>div</code>ã€<code>mod</code>ã€<code>toInteger</code></td><td>æ•´æ•°ä¸“ç”¨è¿ç®—</td><td>Intã€Integer</td></tr><tr><td><code>Real</code></td><td><code>toRational</code></td><td>å®æ•°è½¬æ¢ï¼ˆè¿æ¥æ•´æ•°/åˆ†æ•°ï¼‰</td><td>Intã€Doubleã€Rational</td></tr><tr><td><code>RealFrac</code></td><td><code>properFraction</code></td><td>å®æ•°è½¬åˆ†æ•°ï¼ˆå–æ•´/å°æ•°éƒ¨åˆ†ï¼‰</td><td>Doubleã€Float</td></tr><tr><td><code>RealFloat</code></td><td><code>floatRadix</code>ã€<code>exponent</code></td><td>æµ®ç‚¹æ•°åº•å±‚æ“ä½œ</td><td>Doubleã€Float</td></tr></tbody></table>
<h3 data-id="heading-7">3. å‡½å­ç±»ï¼ˆFunctorä½“ç³»ï¼‰</h3>







































































<table><thead><tr><th>ç±»å‹ç±»</th><th>æ ¸å¿ƒæ–¹æ³•</th><th>æ ¸å¿ƒç”¨é€”</th><th>å…¸å‹å®ä¾‹</th></tr></thead><tbody><tr><td><code>Functor</code></td><td><code>fmap</code>ã€<code>&lt;$&gt;</code></td><td>å•å‚æ•°å®¹å™¨æ˜ å°„ï¼ˆæ— å‰¯ä½œç”¨ï¼‰</td><td>[]ã€Maybeã€IOã€Either e</td></tr><tr><td><code>Contravariant</code></td><td><code>contramap</code></td><td>é€†å˜å‡½å­ï¼ˆåå‘æ˜ å°„ï¼‰</td><td>Predicateã€Comparison</td></tr><tr><td><code>Applicative</code></td><td><code>pure</code>ã€<code>&lt;*&gt;</code></td><td>å¤šå‚æ•°å®¹å™¨æ˜ å°„ï¼ˆæ— ä¾èµ–ï¼‰</td><td>[]ã€Maybeã€IO</td></tr><tr><td><code>Alternative</code></td><td><code>empty</code>ã€`&lt;</td><td>&gt;`</td><td>Applicativeçš„â€œå¯é€‰/å¤šå€¼â€æ‰©å±•</td></tr><tr><td><code>Monad</code></td><td><code>(&gt;&gt;=)</code>ã€<code>return</code></td><td>å•å­ï¼ˆé¡ºåºä¾èµ–è®¡ç®—ï¼‰</td><td>[]ã€Maybeã€IOã€Either e</td></tr><tr><td><code>MonadPlus</code></td><td><code>mzero</code>ã€<code>mplus</code></td><td>Monadçš„â€œå¯é€‰/å¤šå€¼â€æ‰©å±•</td><td>[]ã€Maybe</td></tr><tr><td><code>MonadIO</code></td><td><code>liftIO</code></td><td>åµŒå…¥IOæ“ä½œçš„Monad</td><td>IOã€ReaderT r IO</td></tr><tr><td><code>MonadReader</code></td><td><code>ask</code>ã€<code>local</code></td><td>åªè¯»ç¯å¢ƒçš„Monad</td><td>Reader r</td></tr><tr><td><code>MonadWriter</code></td><td><code>tell</code>ã€<code>listen</code></td><td>å†™æ—¥å¿—çš„Monad</td><td>Writer w</td></tr><tr><td><code>MonadState</code></td><td><code>get</code>ã€<code>put</code></td><td>å¸¦çŠ¶æ€çš„Monad</td><td>State s</td></tr></tbody></table>
<h3 data-id="heading-8">4. å®¹å™¨éå†/èšåˆç±»</h3>





























<table><thead><tr><th>ç±»å‹ç±»</th><th>æ ¸å¿ƒæ–¹æ³•</th><th>æ ¸å¿ƒç”¨é€”</th><th>å…¸å‹å®ä¾‹</th></tr></thead><tbody><tr><td><code>Foldable</code></td><td><code>foldMap</code>ã€<code>foldr</code></td><td>å®¹å™¨æŠ˜å ï¼ˆèšåˆ/éå†ï¼‰</td><td>[]ã€Maybeã€Treeã€Map k</td></tr><tr><td><code>Traversable</code></td><td><code>traverse</code>ã€<code>sequenceA</code></td><td>å¸¦å‰¯ä½œç”¨çš„å®¹å™¨éå†</td><td>[]ã€Maybeã€Tree</td></tr><tr><td><code>Traversable1</code></td><td><code>traverse1</code></td><td>éç©ºå®¹å™¨çš„Traversable</td><td>NonEmptyã€Vector</td></tr></tbody></table>
<h3 data-id="heading-9">5. ä»£æ•°ç»“æ„ç±»ï¼ˆSemigroup/Monoidï¼‰</h3>





























<table><thead><tr><th>ç±»å‹ç±»</th><th>æ ¸å¿ƒæ–¹æ³•</th><th>æ ¸å¿ƒç”¨é€”</th><th>å…¸å‹å®ä¾‹</th></tr></thead><tbody><tr><td><code>Semigroup</code></td><td><code>(&lt;&gt;)</code></td><td>ç»“åˆå¾‹äºŒå…ƒæ“ä½œï¼ˆæ— å•ä½å…ƒï¼‰</td><td>Stringã€[a]ã€Sum Int</td></tr><tr><td><code>Monoid</code></td><td><code>mempty</code>ã€<code>mappend</code></td><td>å¹ºåŠç¾¤ï¼ˆSemigroup + å•ä½å…ƒï¼‰</td><td>Stringã€[a]ã€Sum Int</td></tr><tr><td><code>Group</code></td><td><code>invert</code></td><td>ç¾¤ï¼ˆMonoid + é€†å…ƒï¼‰</td><td>Sum Intã€Product Int</td></tr></tbody></table>
<h3 data-id="heading-10">6. å‡½æ•°æ“ä½œç±»</h3>





























<table><thead><tr><th>ç±»å‹ç±»</th><th>æ ¸å¿ƒæ–¹æ³•</th><th>æ ¸å¿ƒç”¨é€”</th><th>å…¸å‹å®ä¾‹</th></tr></thead><tbody><tr><td><code>Arrow</code></td><td><code>arr</code>ã€<code>(&gt;&gt;&gt;)</code></td><td>ç®­å¤´ï¼ˆå‡½æ•°çš„æŠ½è±¡æ‰©å±•ï¼‰</td><td>(-&gt;)ã€Kleisli m</td></tr><tr><td><code>Applicative</code></td><td>ï¼ˆåŒå‰ï¼‰</td><td>å‡½æ•°ä½œä¸ºå®¹å™¨çš„å¤šå‚æ•°æ˜ å°„</td><td>(-&gt;) r</td></tr><tr><td><code>Monad</code></td><td>ï¼ˆåŒå‰ï¼‰</td><td>å‡½æ•°ä½œä¸ºå®¹å™¨çš„é¡ºåºè®¡ç®—</td><td>(-&gt;) r</td></tr></tbody></table>
<h3 data-id="heading-11">7. é”™è¯¯å¤„ç†ç±»</h3>























<table><thead><tr><th>ç±»å‹ç±»</th><th>æ ¸å¿ƒæ–¹æ³•</th><th>æ ¸å¿ƒç”¨é€”</th><th>å…¸å‹å®ä¾‹</th></tr></thead><tbody><tr><td><code>MonadError</code></td><td><code>throwError</code>ã€<code>catchError</code></td><td>å¸¦é”™è¯¯å¤„ç†çš„Monad</td><td>Either eã€ExceptT e m</td></tr><tr><td><code>Exception</code></td><td><code>toException</code>ã€<code>fromException</code></td><td>å¼‚å¸¸ç±»å‹ï¼ˆIOé”™è¯¯ï¼‰</td><td>IOExceptionã€ArithException</td></tr></tbody></table>
<h3 data-id="heading-12">8. å…¶ä»–å®ç”¨ç±»</h3>





























<table><thead><tr><th>ç±»å‹ç±»</th><th>æ ¸å¿ƒæ–¹æ³•</th><th>æ ¸å¿ƒç”¨é€”</th><th>å…¸å‹å®ä¾‹</th></tr></thead><tbody><tr><td><code>IsString</code></td><td><code>fromString</code></td><td>å­—ç¬¦ä¸²å­—é¢é‡è½¬æ¢ï¼ˆOverloadedStringsæ‰©å±•ï¼‰</td><td>Stringã€Textã€ByteString</td></tr><tr><td><code>Generic</code></td><td><code>from</code>ã€<code>to</code></td><td>æ³›å‹ç¼–ç¨‹ï¼ˆè‡ªåŠ¨æ´¾ç”Ÿå®ä¾‹ï¼‰</td><td>æ‰€æœ‰è‡ªå®šä¹‰æ•°æ®ç±»å‹</td></tr><tr><td><code>Lift</code></td><td><code>lift</code></td><td>æ¨¡æ¿Haskellä¸­çš„ç±»å‹æå‡</td><td>åŸºæœ¬ç±»å‹ã€å®¹å™¨ç±»å‹</td></tr></tbody></table>
<h2 data-id="heading-13">ä¸‰ã€å…³é”®è¡¥å……è¯´æ˜</h2>
<h3 data-id="heading-14">1. â€œæ‰€æœ‰ç±»å‹ç±»â€çš„èŒƒå›´ç•Œå®š</h3>
<ul>
<li><strong>æ ‡å‡†åº“æ ¸å¿ƒ</strong>ï¼šä¸Šè¿°æ¸…å•è¦†ç›–äº†<code>base</code>åŒ…ä¸­99%çš„å¸¸ç”¨ç±»å‹ç±»ï¼Œæ˜¯Haskellç¼–ç¨‹çš„æ ¸å¿ƒåŸºç¡€ï¼›</li>
<li><strong>æ‰©å±•ç±»å‹ç±»</strong>ï¼šéƒ¨åˆ†ç±»å‹ç±»ï¼ˆå¦‚<code>MonadTrans</code>ã€<code>MonadCont</code>ï¼‰åœ¨<code>transformers</code>åŒ…ä¸­ï¼Œå±äºæ ‡å‡†åº“çš„æ‰©å±•ï¼Œéœ€æ‰‹åŠ¨å¯¼å…¥ï¼›</li>
<li><strong>è‡ªå®šä¹‰ç±»å‹ç±»</strong>ï¼šå¼€å‘è€…å¯åŸºäºä¸Šè¿°è®¾è®¡æ¨¡å¼è‡ªå®šä¹‰ç±»å‹ç±»ï¼ˆå¦‚ä¸šåŠ¡ç›¸å…³çš„<code>ToJSON</code>/<code>FromJSON</code>åœ¨<code>aeson</code>åŒ…ä¸­ï¼‰ã€‚</li>
</ul>
<h3 data-id="heading-15">2. å­¦ä¹ ä¼˜å…ˆçº§å»ºè®®</h3>
<p>æ— éœ€ä¸€æ¬¡æ€§æŒæ¡æ‰€æœ‰ç±»å‹ç±»ï¼ŒæŒ‰ä»¥ä¸‹é¡ºåºå­¦ä¹ ï¼š</p>
<ol>
<li>åŸºç¡€ç±»ï¼ˆEq/Ord/Show/Readï¼‰â†’ æ•°å€¼ç±»ï¼ˆNum/Fractionalï¼‰â†’ å‡½å­ç±»ï¼ˆFunctor/Applicative/Monadï¼‰ï¼›</li>
<li>å®¹å™¨ç±»ï¼ˆFoldable/Traversableï¼‰â†’ ä»£æ•°ç»“æ„ç±»ï¼ˆSemigroup/Monoidï¼‰â†’ é«˜çº§Monadï¼ˆMonadReader/MonadStateï¼‰ã€‚</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Canvas é«˜æ€§èƒ½è¡¨æ ¼ç»„ä»¶æŠ€æœ¯è¯¦è§£]]></title>    <link>https://juejin.cn/post/7604757482004070463</link>    <guid>https://juejin.cn/post/7604757482004070463</guid>    <pubDate>2026-02-10T05:49:00.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604757482004070463" data-draft-id="7604757482003988543" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Canvas é«˜æ€§èƒ½è¡¨æ ¼ç»„ä»¶æŠ€æœ¯è¯¦è§£"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2026-02-10T05:49:00.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Hashan"/> <meta itemprop="url" content="https://juejin.cn/user/3523276916662526"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Canvas é«˜æ€§èƒ½è¡¨æ ¼ç»„ä»¶æŠ€æœ¯è¯¦è§£
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3523276916662526/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Hashan
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T05:49:00.000Z" title="Tue Feb 10 2026 05:49:00 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»20åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Canvas é«˜æ€§èƒ½è¡¨æ ¼ç»„ä»¶æŠ€æœ¯è¯¦è§£</h2>
<h3 data-id="heading-1">å‰è¨€</h3>
<p>åœ¨å‰ç«¯å¼€å‘ä¸­ï¼Œå½“éœ€è¦æ¸²æŸ“å¤§é‡æ•°æ®çš„è¡¨æ ¼æ—¶ï¼Œä¼ ç»Ÿçš„ DOM æ¸²æŸ“æ–¹æ¡ˆä¼šé‡åˆ°ä¸¥é‡çš„æ€§èƒ½ç“¶é¢ˆã€‚æ¯ä¸ªå•å…ƒæ ¼éƒ½æ˜¯ä¸€ä¸ª DOM èŠ‚ç‚¹ï¼Œå½“æ•°æ®é‡è¾¾åˆ°æ•°ä¸‡è¡Œæ—¶ï¼Œé¡µé¢ä¼šå˜å¾—å¡é¡¿ç”šè‡³å´©æºƒã€‚</p>
<p>æœ¬æ–‡å°†æ·±å…¥å‰–æä¸€ä¸ªåŸºäº Canvas çš„é«˜æ€§èƒ½è™šæ‹Ÿè¡¨æ ¼ç»„ä»¶ â€”â€” <code>CanvasTable</code>ï¼Œå¸¦ä½ ç†è§£å…¶è®¾è®¡åŸç†ã€å®ç°ç»†èŠ‚å’Œæ€§èƒ½ä¼˜åŒ–ç­–ç•¥ã€‚</p>
<hr/>
<h3 data-id="heading-2">ä¸€ã€ä¸ºä»€ä¹ˆé€‰æ‹© Canvas æ¸²æŸ“è¡¨æ ¼ï¼Ÿ</h3>
<h4 data-id="heading-3">1.1 DOM æ–¹æ¡ˆçš„ç“¶é¢ˆ</h4>
<p>ä¼ ç»Ÿ DOM è¡¨æ ¼æ¸²æŸ“å­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š</p>

























<table><thead><tr><th>é—®é¢˜</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>DOM èŠ‚ç‚¹è¿‡å¤š</td><td>10000 è¡Œ Ã— 10 åˆ— = 100000 ä¸ª DOM èŠ‚ç‚¹</td></tr><tr><td>å†…å­˜å ç”¨é«˜</td><td>æ¯ä¸ª DOM èŠ‚ç‚¹éƒ½æºå¸¦å¤§é‡å±æ€§å’Œæ–¹æ³•</td></tr><tr><td>é‡æ’é‡ç»˜ä»£ä»·å¤§</td><td>æ»šåŠ¨æ—¶é¢‘ç¹è§¦å‘å¸ƒå±€è®¡ç®—</td></tr><tr><td>äº‹ä»¶ç»‘å®šå¼€é”€</td><td>éœ€è¦ä¸ºå¤§é‡å…ƒç´ ç»‘å®šäº‹ä»¶æˆ–ä½¿ç”¨äº‹ä»¶å§”æ‰˜</td></tr></tbody></table>
<h4 data-id="heading-4">1.2 Canvas æ–¹æ¡ˆçš„ä¼˜åŠ¿</h4>
<p>Canvas æœ¬è´¨ä¸Šæ˜¯ä¸€å—ã€Œç”»å¸ƒã€ï¼Œæ‰€æœ‰å†…å®¹éƒ½æ˜¯åƒç´ çº§ç»˜åˆ¶ï¼š</p>
<ul>
<li><strong>å•ä¸€ DOM èŠ‚ç‚¹</strong>ï¼šä¸ç®¡å¤šå°‘æ•°æ®ï¼ŒCanvas å§‹ç»ˆæ˜¯ä¸€ä¸ª <code>&lt;canvas&gt;</code> å…ƒç´ </li>
<li><strong>æŒ‰éœ€ç»˜åˆ¶</strong>ï¼šåªç»˜åˆ¶å¯è§†åŒºåŸŸå†…çš„å•å…ƒæ ¼ï¼ˆè™šæ‹Ÿæ»šåŠ¨ï¼‰</li>
<li><strong>é«˜æ•ˆæ›´æ–°</strong>ï¼šé€šè¿‡ <code>requestAnimationFrame</code> æ‰¹é‡æ›´æ–°</li>
<li><strong>åˆ†å±‚æ¸²æŸ“</strong>ï¼šä¸åŒæ›´æ–°é¢‘ç‡çš„å†…å®¹åˆ†å¼€ç»˜åˆ¶ï¼Œå‡å°‘é‡ç»˜èŒƒå›´</li>
</ul>
<h4 data-id="heading-5">1.3 æ¶æ„è®¾è®¡å›¾</h4>
<pre><code class="hljs language-scss" lang="scss">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Â  Â  Â  Â  Â  Â  Â  Â  Â   CanvasTable ç»„ä»¶ Â  Â  Â  Â  Â  Â  Â  Â  Â  Â   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” Â  â”‚
â”‚  â”‚ Â  Â  Â  Â  Â  Â  Interaction Layer (z-index: <span class="hljs-number">3</span>) Â  Â  Â  â”‚ Â  â”‚
â”‚  â”‚ Â  Â  Â  Â  Â  Â  é€‰ä¸­æ¡†ã€Hover é«˜äº®æ•ˆæœ Â  Â  Â  Â  Â  Â  Â  â”‚ Â  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ Â  â”‚
â”‚  â”‚ Â  Â  Â  Â  Â  Â  <span class="hljs-attribute">Content</span> Layer (z-index: <span class="hljs-number">2</span>) Â  Â  Â  Â  Â  â”‚ Â  â”‚
â”‚  â”‚ Â  Â  Â  Â  Â  Â  å•å…ƒæ ¼æ–‡æœ¬ã€è¡¨å¤´ã€å†»ç»“åˆ— Â  Â  Â  Â  Â  Â  â”‚ Â  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ Â  â”‚
â”‚  â”‚ Â  Â  Â  Â  Â  Â  Base Layer (z-index: <span class="hljs-number">1</span>) Â  Â  Â  Â  Â  Â   â”‚ Â  â”‚
â”‚  â”‚ Â  Â  Â  Â  Â  Â  èƒŒæ™¯è‰²ã€æ–‘é©¬çº¹ã€ç½‘æ ¼çº¿ Â  Â  Â  Â  Â  Â  Â  â”‚ Â  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ Â  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” Â  â”‚
â”‚  â”‚ Â  Â  Â  Â  Â  Â  Scroll Container (z-index: <span class="hljs-number">4</span>) Â  Â  Â   â”‚ Â  â”‚
â”‚  â”‚ Â  Â  Â  Â  Â  Â  æ»šåŠ¨äº‹ä»¶æ•è· + åŸç”Ÿæ»šåŠ¨æ¡ Â  Â  Â  Â  Â   â”‚ Â  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ Â  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<hr/>
<h3 data-id="heading-6">äºŒã€Template ç»“æ„è§£æ</h3>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
 Â  Â <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"canvas-container"</span>&gt;</span>
 Â  Â  Â  Â <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"containerRef"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"canvas-table-container"</span> <span class="hljs-attr">:style</span>=<span class="hljs-string">"containerStyle"</span>&gt;</span>
 Â  Â  Â  Â  Â  Â <span class="hljs-comment">&lt;!-- åº•å±‚ Canvasï¼šèƒŒæ™¯ã€ç½‘æ ¼çº¿ï¼ˆå¾ˆå°‘å˜åŒ–ï¼‰ --&gt;</span>
 Â  Â  Â  Â  Â  Â <span class="hljs-tag">&lt;<span class="hljs-name">canvas</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"baseCanvasRef"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"layer-base"</span> /&gt;</span>
â€‹
 Â  Â  Â  Â  Â  Â <span class="hljs-comment">&lt;!-- ä¸­å±‚ Canvasï¼šå•å…ƒæ ¼å†…å®¹ï¼ˆæ»šåŠ¨æ—¶æ›´æ–°ï¼‰ --&gt;</span>
 Â  Â  Â  Â  Â  Â <span class="hljs-tag">&lt;<span class="hljs-name">canvas</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"contentCanvasRef"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"layer-content"</span> /&gt;</span>
â€‹
 Â  Â  Â  Â  Â  Â <span class="hljs-comment">&lt;!-- é¡¶å±‚ Canvasï¼šé€‰åŒºã€hoverï¼ˆé¢‘ç¹æ›´æ–°ï¼‰ --&gt;</span>
 Â  Â  Â  Â  Â  Â <span class="hljs-tag">&lt;<span class="hljs-name">canvas</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"interactionCanvasRef"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"layer-interaction"</span> /&gt;</span>
â€‹
 Â  Â  Â  Â  Â  Â <span class="hljs-comment">&lt;!-- æ»šåŠ¨å ä½å±‚ï¼ˆäº§ç”ŸåŸç”Ÿæ»šåŠ¨æ¡ï¼‰ --&gt;</span>
 Â  Â  Â  Â  Â  Â <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"scrollerRef"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"scroll-container"</span> @<span class="hljs-attr">scroll</span>=<span class="hljs-string">"handleScroll"</span>&gt;</span>
 Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"scroll-phantom"</span> <span class="hljs-attr">:style</span>=<span class="hljs-string">"phantomStyle"</span> /&gt;</span>
 Â  Â  Â  Â  Â  Â <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
â€‹
 Â  Â  Â  Â  Â  Â <span class="hljs-comment">&lt;!-- ç¼–è¾‘è¾“å…¥æ¡†ï¼ˆç‚¹å‡»å•å…ƒæ ¼æ—¶æ˜¾ç¤ºï¼‰ --&gt;</span>
 Â  Â  Â  Â  Â  Â <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"editingCell"</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"editorRef"</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">"editValue"</span> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="hljs-attr">class</span>=<span class="hljs-string">"cell-editor"</span> <span class="hljs-attr">:style</span>=<span class="hljs-string">"editorStyle"</span> /&gt;</span>
 Â  Â  Â  Â <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
 Â  Â <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
</code></pre>
<h4 data-id="heading-7">2.1 å››å±‚ç»“æ„è¯¦è§£</h4>



































<table><thead><tr><th>å±‚çº§</th><th>å…ƒç´ </th><th>èŒè´£</th><th>z-index</th></tr></thead><tbody><tr><td>Base Layer</td><td><code>&lt;canvas class="layer-base"&gt;</code></td><td>ç»˜åˆ¶èƒŒæ™¯ã€æ–‘é©¬çº¹ã€ç½‘æ ¼çº¿</td><td>1</td></tr><tr><td>Content Layer</td><td><code>&lt;canvas class="layer-content"&gt;</code></td><td>ç»˜åˆ¶å•å…ƒæ ¼å†…å®¹ã€è¡¨å¤´ã€å†»ç»“åˆ—</td><td>2</td></tr><tr><td>Interaction Layer</td><td><code>&lt;canvas class="layer-interaction"&gt;</code></td><td>ç»˜åˆ¶é€‰ä¸­æ•ˆæœã€æ‚¬åœé«˜äº®</td><td>3</td></tr><tr><td>Scroll Container</td><td><code>&lt;div class="scroll-container"&gt;</code></td><td>æ•è·æ»šåŠ¨äº‹ä»¶ã€æ˜¾ç¤ºåŸç”Ÿæ»šåŠ¨æ¡</td><td>4</td></tr></tbody></table>
<h4 data-id="heading-8">2.2 æ»šåŠ¨å¹½çµå±‚åŸç†</h4>
<p>Canvas æœ¬èº«ä¸ä¼šäº§ç”Ÿæ»šåŠ¨æ¡ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªã€Œå¹½çµå±‚ã€æ¥æ’‘å¼€æ»šåŠ¨åŒºåŸŸï¼š</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"scrollerRef"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"scroll-container"</span>&gt;</span>
 Â  Â <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"scroll-phantom"</span> <span class="hljs-attr">:style</span>=<span class="hljs-string">"phantomStyle"</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<ul>
<li><code>scroll-container</code>: è®¾ç½® <code>overflow: auto</code>ï¼Œä¼šæ ¹æ®å†…éƒ¨å†…å®¹äº§ç”Ÿæ»šåŠ¨æ¡</li>
<li><code>scroll-phantom</code>: ä¸€ä¸ªç©ºçš„ divï¼Œå…¶å°ºå¯¸ç­‰äºè¡¨æ ¼çš„æ€»å®½é«˜ï¼ˆ<code>totalWidth Ã— totalHeight</code>ï¼‰</li>
<li>ç”¨æˆ·æ»šåŠ¨æ—¶ï¼Œæˆ‘ä»¬ç›‘å¬ <code>scroll</code> äº‹ä»¶ï¼Œè·å– <code>scrollLeft</code> å’Œ <code>scrollTop</code>ï¼Œç„¶åé‡æ–°ç»˜åˆ¶ Canvas</li>
</ul>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> phantomStyle = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> ({
 Â  Â <span class="hljs-attr">width</span>: <span class="hljs-string">`<span class="hljs-subst">${totalWidth.value}</span>px`</span>, Â  <span class="hljs-comment">// æ‰€æœ‰åˆ—å®½ä¹‹å’Œ</span>
 Â  Â <span class="hljs-attr">height</span>: <span class="hljs-string">`<span class="hljs-subst">${totalHeight.value}</span>px`</span> Â <span class="hljs-comment">// æ•°æ®è¡Œæ•° Ã— è¡Œé«˜ + è¡¨å¤´é«˜åº¦</span>
}))
</code></pre>
<h4 data-id="heading-9">2.3 ä¸ºä»€ä¹ˆä½¿ç”¨åŸç”Ÿæ»šåŠ¨æ¡ï¼Ÿ</h4>
<ul>
<li><strong>ä¸€è‡´çš„ç”¨æˆ·ä½“éªŒ</strong>ï¼šåŸç”Ÿæ»šåŠ¨æ¡ç¬¦åˆç”¨æˆ·ä¹ æƒ¯</li>
<li><strong>ç§»åŠ¨ç«¯æ”¯æŒ</strong>ï¼šåŸç”Ÿæ»šåŠ¨æ”¯æŒè§¦æ‘¸æ»‘åŠ¨å’Œæƒ¯æ€§æ»šåŠ¨</li>
<li><strong>æ— éœ€è‡ªå®ç°</strong>ï¼šä¸ç”¨æ‰‹åŠ¨è®¡ç®—æ»šåŠ¨æ¡ä½ç½®å’Œæ‹–æ‹½é€»è¾‘</li>
</ul>
<hr/>
<h3 data-id="heading-10">ä¸‰ã€Props ä¸ç±»å‹å®šä¹‰</h3>
<h4 data-id="heading-11">3.1 Column æ¥å£</h4>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Column</span> {
 Â  Â <span class="hljs-attr">key</span>: <span class="hljs-built_in">string</span> Â  Â  Â  Â  Â  Â  Â <span class="hljs-comment">// æ•°æ®å­—æ®µå</span>
 Â  Â <span class="hljs-attr">title</span>: <span class="hljs-built_in">string</span> Â  Â  Â  Â  Â  Â <span class="hljs-comment">// è¡¨å¤´æ˜¾ç¤ºæ–‡å­—</span>
 Â  Â <span class="hljs-attr">width</span>: <span class="hljs-built_in">number</span> Â  Â  Â  Â  Â  Â <span class="hljs-comment">// åˆ—å®½ï¼ˆåƒç´ ï¼‰</span>
 Â  Â align?: <span class="hljs-string">'left'</span> | <span class="hljs-string">'center'</span> | <span class="hljs-string">'right'</span> Â <span class="hljs-comment">// æ–‡æœ¬å¯¹é½æ–¹å¼</span>
 Â  Â formatter?: <span class="hljs-function">(<span class="hljs-params">value: <span class="hljs-built_in">any</span>, row: <span class="hljs-built_in">any</span></span>) =&gt;</span> <span class="hljs-built_in">string</span> Â <span class="hljs-comment">// æ ¼å¼åŒ–å‡½æ•°</span>
 Â  Â editable?: <span class="hljs-built_in">boolean</span> Â  Â  Â  <span class="hljs-comment">// æ˜¯å¦å¯ç¼–è¾‘</span>
}
</code></pre>
<h4 data-id="heading-12">3.2 Props å‚æ•°è¯´æ˜</h4>



























































<table><thead><tr><th>å‚æ•°</th><th>ç±»å‹</th><th>é»˜è®¤å€¼</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>columns</code></td><td><code>Column[]</code></td><td>-</td><td>åˆ—é…ç½®æ•°ç»„ï¼ˆå¿…å¡«ï¼‰</td></tr><tr><td><code>data</code></td><td><code>any[]</code></td><td>-</td><td>æ•°æ®æºï¼ˆå¿…å¡«ï¼‰</td></tr><tr><td><code>width</code></td><td><code>number</code></td><td>800</td><td>è¡¨æ ¼å®½åº¦</td></tr><tr><td><code>height</code></td><td><code>number</code></td><td>400</td><td>è¡¨æ ¼é«˜åº¦</td></tr><tr><td><code>rowHeight</code></td><td><code>number</code></td><td>36</td><td>è¡Œé«˜</td></tr><tr><td><code>headerHeight</code></td><td><code>number</code></td><td>40</td><td>è¡¨å¤´é«˜åº¦</td></tr><tr><td><code>frozenColumns</code></td><td><code>number</code></td><td>1</td><td>å†»ç»“åˆ—æ•°é‡</td></tr><tr><td><code>theme</code></td><td><code>Partial&lt;ThemeConfig&gt;</code></td><td>{}</td><td>ä¸»é¢˜é…ç½®</td></tr></tbody></table>
<h4 data-id="heading-13">3.3 ThemeConfig ä¸»é¢˜é…ç½®</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">interface</span> <span class="hljs-title">ThemeConfig</span> {
 Â  Â headerBgColor: <span class="hljs-built_in">string</span> Â  Â <span class="hljs-comment">// è¡¨å¤´èƒŒæ™¯è‰²ï¼Œé»˜è®¤ #f5f7fa</span>
 Â  Â headerTextColor: <span class="hljs-built_in">string</span> Â <span class="hljs-comment">// è¡¨å¤´æ–‡å­—é¢œè‰²ï¼Œé»˜è®¤ #606266</span>
 Â  Â cellBgColor: <span class="hljs-built_in">string</span> Â  Â  Â <span class="hljs-comment">// å•å…ƒæ ¼èƒŒæ™¯è‰²ï¼Œé»˜è®¤ #ffffff</span>
 Â  Â cellTextColor: <span class="hljs-built_in">string</span> Â  Â <span class="hljs-comment">// å•å…ƒæ ¼æ–‡å­—é¢œè‰²ï¼Œé»˜è®¤ #303133</span>
 Â  Â borderColor: <span class="hljs-built_in">string</span> Â  Â  Â <span class="hljs-comment">// è¾¹æ¡†é¢œè‰²ï¼Œé»˜è®¤ #ebeef5</span>
 Â  Â hoverColor: <span class="hljs-built_in">string</span> Â  Â  Â  <span class="hljs-comment">// æ‚¬åœé¢œè‰²ï¼Œé»˜è®¤ rgba(64, 158, 255, 0.1)</span>
 Â  Â selectedColor: <span class="hljs-built_in">string</span> Â  Â <span class="hljs-comment">// é€‰ä¸­é¢œè‰²ï¼Œé»˜è®¤ rgba(64, 158, 255, 0.15)</span>
}
</code></pre>
<hr/>
<h3 data-id="heading-14">å››ã€è®¡ç®—å±æ€§è¯¦è§£</h3>
<h4 data-id="heading-15">4.1 totalWidth - æ€»å®½åº¦</h4>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">const</span> totalWidth = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span>
 Â  Â props.<span class="hljs-property">columns</span>.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">sum, col</span>) =&gt;</span> sum + col.<span class="hljs-property">width</span>, <span class="hljs-number">0</span>)
)
</code></pre>
<p>å°†æ‰€æœ‰åˆ—çš„å®½åº¦ç´¯åŠ ï¼Œå¾—åˆ°è¡¨æ ¼çš„æ€»å®½åº¦ã€‚è¿™ä¸ªå€¼ç”¨äºï¼š</p>
<ul>
<li>è®¾ç½®å¹½çµå±‚çš„å®½åº¦</li>
<li>è®¡ç®—æ°´å¹³æ»šåŠ¨èŒƒå›´</li>
</ul>
<h4 data-id="heading-16">4.2 totalHeight - æ€»é«˜åº¦</h4>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">const</span> totalHeight = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span>
 Â  Â props.<span class="hljs-property">data</span>.<span class="hljs-property">length</span> * props.<span class="hljs-property">rowHeight</span> + props.<span class="hljs-property">headerHeight</span>
)
</code></pre>
<p>è®¡ç®—å…¬å¼ï¼š<code>æ•°æ®è¡Œæ•° Ã— è¡Œé«˜ + è¡¨å¤´é«˜åº¦</code></p>
<h4 data-id="heading-17">4.3 frozenWidth - å†»ç»“åˆ—å®½åº¦</h4>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">const</span> frozenWidth = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> {
 Â  Â <span class="hljs-keyword">let</span> width = <span class="hljs-number">0</span>
 Â  Â <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; props.<span class="hljs-property">frozenColumns</span> &amp;&amp; i &lt; props.<span class="hljs-property">columns</span>.<span class="hljs-property">length</span>; i++) {
 Â  Â  Â  Â <span class="hljs-keyword">const</span> column = props.<span class="hljs-property">columns</span>[i]
 Â  Â  Â  Â <span class="hljs-keyword">if</span> (column) width += column.<span class="hljs-property">width</span>
 Â   }
 Â  Â <span class="hljs-keyword">return</span> width
})
</code></pre>
<p>å†»ç»“åˆ—çš„æ€»å®½åº¦ï¼Œç”¨äºï¼š</p>
<ul>
<li>ç¡®å®šå†»ç»“åŒºåŸŸçš„ç»˜åˆ¶èŒƒå›´</li>
<li>åˆ¤æ–­ç‚¹å‡»ä½ç½®æ˜¯å¦åœ¨å†»ç»“åŒºåŸŸ</li>
</ul>
<h4 data-id="heading-18">4.4 editorStyle - ç¼–è¾‘æ¡†å®šä½</h4>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">const</span> editorStyle = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> {
 Â  Â <span class="hljs-keyword">if</span> (!editingCell.<span class="hljs-property">value</span>) <span class="hljs-keyword">return</span> {}
â€‹
 Â  Â <span class="hljs-keyword">const</span> { row, col } = editingCell.<span class="hljs-property">value</span>
 Â  Â <span class="hljs-keyword">const</span> column = props.<span class="hljs-property">columns</span>[col]
 Â  Â <span class="hljs-keyword">if</span> (!column) <span class="hljs-keyword">return</span> {}
â€‹
 Â  Â <span class="hljs-keyword">let</span> x = <span class="hljs-title function_">getColumnX</span>(col)
 Â  Â <span class="hljs-keyword">const</span> y = row * props.<span class="hljs-property">rowHeight</span> + props.<span class="hljs-property">headerHeight</span>
â€‹
 Â  Â <span class="hljs-comment">// å†»ç»“åˆ—å¤–çš„å•å…ƒæ ¼éœ€è¦å‡å»æ»šåŠ¨åç§»</span>
 Â  Â <span class="hljs-keyword">if</span> (col &gt;= props.<span class="hljs-property">frozenColumns</span>) {
 Â  Â  Â  Â x -= scrollLeft.<span class="hljs-property">value</span>
 Â   }
â€‹
 Â  Â <span class="hljs-keyword">return</span> {
 Â  Â  Â  Â <span class="hljs-attr">left</span>: <span class="hljs-string">`<span class="hljs-subst">${x}</span>px`</span>,
 Â  Â  Â  Â <span class="hljs-attr">top</span>: <span class="hljs-string">`<span class="hljs-subst">${y - scrollTop.value}</span>px`</span>,
 Â  Â  Â  Â <span class="hljs-attr">width</span>: <span class="hljs-string">`<span class="hljs-subst">${column.width}</span>px`</span>,
 Â  Â  Â  Â <span class="hljs-attr">height</span>: <span class="hljs-string">`<span class="hljs-subst">${props.rowHeight}</span>px`</span>
 Â   }
})
</code></pre>
<p>ç¼–è¾‘æ¡†éœ€è¦ç²¾ç¡®è¦†ç›–åœ¨è¢«ç¼–è¾‘çš„å•å…ƒæ ¼ä¸Šæ–¹ï¼Œå…³é”®ç‚¹ï¼š</p>
<ul>
<li>è®¡ç®—å•å…ƒæ ¼çš„ X åæ ‡ï¼ˆé€šè¿‡ <code>getColumnX</code>ï¼‰</li>
<li>è®¡ç®—å•å…ƒæ ¼çš„ Y åæ ‡ï¼ˆ<code>è¡Œå· Ã— è¡Œé«˜ + è¡¨å¤´é«˜åº¦</code>ï¼‰</li>
<li>éå†»ç»“åˆ—éœ€è¦å‡å» <code>scrollLeft</code>ï¼Œæ‰€æœ‰è¡Œéœ€è¦å‡å» <code>scrollTop</code></li>
</ul>
<hr/>
<h3 data-id="heading-19">äº”ã€ç”Ÿå‘½å‘¨æœŸä¸åˆå§‹åŒ–</h3>
<h4 data-id="heading-20">5.1 Canvas åˆå§‹åŒ–</h4>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> {
 Â  Â <span class="hljs-keyword">if</span> (!containerRef.<span class="hljs-property">value</span>) <span class="hljs-keyword">return</span>
â€‹
 Â  Â dpr = <span class="hljs-variable language_">window</span>.<span class="hljs-property">devicePixelRatio</span> || <span class="hljs-number">1</span>
â€‹
 Â  Â <span class="hljs-title function_">initCanvas</span>()
 Â  Â <span class="hljs-title function_">bindEvents</span>()
 Â  Â <span class="hljs-title function_">renderAll</span>()
})
</code></pre>
<h5 data-id="heading-21">é«˜æ¸…å±é€‚é…</h5>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">function</span> <span class="hljs-title function_">initCanvas</span>(<span class="hljs-params"/>) {
 Â  Â <span class="hljs-keyword">const</span> canvases = [
 Â  Â  Â   { <span class="hljs-attr">ref</span>: baseCanvasRef.<span class="hljs-property">value</span>, <span class="hljs-attr">key</span>: <span class="hljs-string">'base'</span> <span class="hljs-keyword">as</span> <span class="hljs-keyword">const</span> },
 Â  Â  Â   { <span class="hljs-attr">ref</span>: contentCanvasRef.<span class="hljs-property">value</span>, <span class="hljs-attr">key</span>: <span class="hljs-string">'content'</span> <span class="hljs-keyword">as</span> <span class="hljs-keyword">const</span> },
 Â  Â  Â   { <span class="hljs-attr">ref</span>: interactionCanvasRef.<span class="hljs-property">value</span>, <span class="hljs-attr">key</span>: <span class="hljs-string">'interaction'</span> <span class="hljs-keyword">as</span> <span class="hljs-keyword">const</span> }
 Â   ]
â€‹
 Â  Â canvases.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">{ ref: canvas, key }</span>) =&gt;</span> {
 Â  Â  Â  Â <span class="hljs-keyword">if</span> (!canvas) <span class="hljs-keyword">return</span>
â€‹
 Â  Â  Â  Â <span class="hljs-comment">// è®¾ç½® Canvas å®é™…å°ºå¯¸ï¼ˆç‰©ç†åƒç´ ï¼‰</span>
 Â  Â  Â  Â canvas.<span class="hljs-property">width</span> = props.<span class="hljs-property">width</span> * dpr
 Â  Â  Â  Â canvas.<span class="hljs-property">height</span> = props.<span class="hljs-property">height</span> * dpr
â€‹
 Â  Â  Â  Â <span class="hljs-comment">// è®¾ç½® Canvas æ˜¾ç¤ºå°ºå¯¸ï¼ˆCSS åƒç´ ï¼‰</span>
 Â  Â  Â  Â canvas.<span class="hljs-property">style</span>.<span class="hljs-property">width</span> = <span class="hljs-string">`<span class="hljs-subst">${props.width}</span>px`</span>
 Â  Â  Â  Â canvas.<span class="hljs-property">style</span>.<span class="hljs-property">height</span> = <span class="hljs-string">`<span class="hljs-subst">${props.height}</span>px`</span>
â€‹
 Â  Â  Â  Â <span class="hljs-keyword">const</span> ctx = canvas.<span class="hljs-title function_">getContext</span>(<span class="hljs-string">'2d'</span>)
 Â  Â  Â  Â <span class="hljs-keyword">if</span> (ctx) {
 Â  Â  Â  Â  Â  Â <span class="hljs-comment">// ç¼©æ”¾ä¸Šä¸‹æ–‡ï¼Œä½¿ç»˜åˆ¶å†…å®¹è‡ªåŠ¨é€‚é…é«˜æ¸…å±</span>
 Â  Â  Â  Â  Â  Â ctx.<span class="hljs-title function_">scale</span>(dpr, dpr)
 Â  Â  Â  Â  Â  Â contexts[key] = ctx
 Â  Â  Â   }
 Â   })
}
</code></pre>
<p><strong>ä¸ºä»€ä¹ˆéœ€è¦è¿™æ ·å¤„ç†ï¼Ÿ</strong></p>
<p>åœ¨ Retina ç­‰é«˜æ¸…å±ä¸Šï¼Œ<code>devicePixelRatio</code> é€šå¸¸ä¸º 2 æˆ– 3ã€‚å¦‚æœ Canvas çš„å®é™…å°ºå¯¸ç­‰äº CSS å°ºå¯¸ï¼Œå†…å®¹ä¼šæ˜¾å¾—æ¨¡ç³Šã€‚è§£å†³æ–¹æ¡ˆï¼š</p>
<ol>
<li>Canvas çš„ <code>width/height</code> å±æ€§è®¾ä¸º CSS å°ºå¯¸çš„ <code>dpr</code> å€</li>
<li>é€šè¿‡ CSS å°† Canvas ç¼©å°åˆ°åŸå§‹å°ºå¯¸</li>
<li>åœ¨ç»‘å®šä¸Šä¸‹æ–‡æ—¶ <code>scale(dpr, dpr)</code>ï¼Œè¿™æ ·ç»˜åˆ¶ä»£ç æ— éœ€å…³å¿ƒ dpr</li>
</ol>
<h4 data-id="heading-22">5.2 äº‹ä»¶ç»‘å®šä¸è§£ç»‘</h4>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">function</span> <span class="hljs-title function_">bindEvents</span>(<span class="hljs-params"/>) {
 Â  Â <span class="hljs-keyword">const</span> scroller = scrollerRef.<span class="hljs-property">value</span>
 Â  Â <span class="hljs-keyword">if</span> (!scroller) <span class="hljs-keyword">return</span>
â€‹
 Â  Â scroller.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, handleClick)
 Â  Â scroller.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'dblclick'</span>, handleDoubleClick)
 Â  Â scroller.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'mousemove'</span>, handleMouseMove)
 Â  Â scroller.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'mouseleave'</span>, handleMouseLeave)
}
â€‹
<span class="hljs-keyword">function</span> <span class="hljs-title function_">unbindEvents</span>(<span class="hljs-params"/>) {
 Â  Â <span class="hljs-keyword">const</span> scroller = scrollerRef.<span class="hljs-property">value</span>
 Â  Â <span class="hljs-keyword">if</span> (!scroller) <span class="hljs-keyword">return</span>
â€‹
 Â  Â scroller.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">'click'</span>, handleClick)
 Â  Â scroller.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">'dblclick'</span>, handleDoubleClick)
 Â  Â scroller.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">'mousemove'</span>, handleMouseMove)
 Â  Â scroller.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">'mouseleave'</span>, handleMouseLeave)
}
</code></pre>
<p><strong>é‡è¦</strong>: åœ¨ <code>onUnmounted</code> ä¸­å¿…é¡»è§£ç»‘äº‹ä»¶ï¼Œå¦åˆ™ä¼šé€ æˆå†…å­˜æ³„æ¼ã€‚</p>
<h4 data-id="heading-23">5.3 æ•°æ®ç›‘å¬</h4>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-title function_">watch</span>(<span class="hljs-function">() =&gt;</span> props.<span class="hljs-property">data</span>, <span class="hljs-function">() =&gt;</span> {
 Â  Â <span class="hljs-title function_">markDirty</span>(<span class="hljs-string">'base'</span>, <span class="hljs-string">'content'</span>, <span class="hljs-string">'interaction'</span>)
 Â  Â <span class="hljs-title function_">requestRender</span>()
}, { <span class="hljs-attr">deep</span>: <span class="hljs-literal">true</span> })
â€‹
<span class="hljs-title function_">watch</span>(<span class="hljs-function">() =&gt;</span> props.<span class="hljs-property">columns</span>, <span class="hljs-function">() =&gt;</span> {
 Â  Â <span class="hljs-title function_">markDirty</span>(<span class="hljs-string">'base'</span>, <span class="hljs-string">'content'</span>, <span class="hljs-string">'interaction'</span>)
 Â  Â <span class="hljs-title function_">requestRender</span>()
}, { <span class="hljs-attr">deep</span>: <span class="hljs-literal">true</span> })
</code></pre>
<p>å½“æ•°æ®æˆ–åˆ—é…ç½®å˜åŒ–æ—¶ï¼Œæ ‡è®°æ‰€æœ‰å±‚ä¸ºã€Œè„ã€ï¼Œè¯·æ±‚é‡æ–°æ¸²æŸ“ã€‚</p>
<hr/>
<h3 data-id="heading-24">å…­ã€æ ¸å¿ƒæ¸²æŸ“æ–¹æ³•è¯¦è§£</h3>
<h4 data-id="heading-25">6.1 æ¸²æŸ“æµç¨‹å›¾</h4>
<pre><code class="hljs language-scss" lang="scss"> Â  Â  Â   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 Â  Â  Â   â”‚ Â  <span class="hljs-built_in">requestRender</span>() Â   â”‚
 Â  Â  Â   â”‚  (RAF èŠ‚æµæ§åˆ¶) Â  Â  Â  â”‚
 Â  Â  Â   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 Â  Â  Â  Â  Â  Â  Â  Â  Â  â”‚
 Â  Â  Â  Â  Â  Â  Â  Â  Â  â–¼
 Â  Â  Â   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 Â  Â  Â   â”‚ Â  Â  <span class="hljs-built_in">renderAll</span>() Â  Â   â”‚
 Â  Â  Â   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 Â  Â  Â  Â  Â  Â  Â  Â  Â  â”‚
 Â  Â  Â  Â  Â  Â  Â  Â  Â  â–¼
 Â  Â  Â   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 Â  Â  Â   â”‚ calculateVisibleRangeâ”‚
 Â  Â  Â   â”‚ Â  è®¡ç®—å¯è§†èŒƒå›´ Â  Â  Â   â”‚
 Â  Â  Â   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 Â  Â  Â  Â  Â  Â  Â  Â  Â  â”‚
 Â  Â  Â   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 Â  Â  Â   â”‚ Â  Â  Â  Â   â”‚ Â  Â  Â  Â   â”‚
 Â  Â  Â   â–¼ Â  Â  Â  Â   â–¼ Â  Â  Â  Â   â–¼
 Â  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 Â  â”‚ Base Â   â”‚ â”‚ <span class="hljs-attribute">Content</span> â”‚ â”‚ Interaction â”‚
 Â  â”‚ Layer Â  â”‚ â”‚ Layer Â  â”‚ â”‚ Layer Â  Â  Â  â”‚
 Â  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 Â  â”‚èƒŒæ™¯ Â  Â  â”‚ â”‚å•å…ƒæ ¼ Â  â”‚ â”‚é€‰ä¸­æ¡† Â  Â  Â  â”‚
 Â  â”‚ç½‘æ ¼çº¿ Â  â”‚ â”‚è¡¨å¤´ Â  Â  â”‚ â”‚æ‚¬åœé«˜äº® Â  Â  â”‚
 Â  â”‚ Â  Â  Â  Â  â”‚ â”‚å†»ç»“åˆ— Â  â”‚ â”‚ Â  Â  Â  Â  Â  Â  â”‚
 Â  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h4 data-id="heading-26">6.2 è„æ ‡è®°ä¸æŒ‰éœ€æ¸²æŸ“</h4>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">const</span> dirtyFlags = {
 Â  Â <span class="hljs-attr">base</span>: <span class="hljs-literal">true</span>,
 Â  Â <span class="hljs-attr">content</span>: <span class="hljs-literal">true</span>,
 Â  Â <span class="hljs-attr">interaction</span>: <span class="hljs-literal">true</span>
}
â€‹
<span class="hljs-keyword">function</span> <span class="hljs-title function_">markDirty</span>(<span class="hljs-params">...layers: <span class="hljs-built_in">Array</span>&lt;<span class="hljs-string">'base'</span> | <span class="hljs-string">'content'</span> | <span class="hljs-string">'interaction'</span>&gt;</span>) {
 Â  Â layers.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">layer</span> =&gt;</span> {
 Â  Â  Â  Â dirtyFlags[layer] = <span class="hljs-literal">true</span>
 Â   })
}
â€‹
<span class="hljs-keyword">function</span> <span class="hljs-title function_">renderAll</span>(<span class="hljs-params"/>) {
 Â  Â <span class="hljs-keyword">const</span> range = <span class="hljs-title function_">calculateVisibleRange</span>()
â€‹
 Â  Â <span class="hljs-keyword">if</span> (dirtyFlags.<span class="hljs-property">base</span>) {
 Â  Â  Â  Â <span class="hljs-title function_">renderBaseLayer</span>(range)
 Â  Â  Â  Â dirtyFlags.<span class="hljs-property">base</span> = <span class="hljs-literal">false</span>
 Â   }
â€‹
 Â  Â <span class="hljs-keyword">if</span> (dirtyFlags.<span class="hljs-property">content</span>) {
 Â  Â  Â  Â <span class="hljs-title function_">renderContentLayer</span>(range)
 Â  Â  Â  Â dirtyFlags.<span class="hljs-property">content</span> = <span class="hljs-literal">false</span>
 Â   }
â€‹
 Â  Â <span class="hljs-keyword">if</span> (dirtyFlags.<span class="hljs-property">interaction</span>) {
 Â  Â  Â  Â <span class="hljs-title function_">renderInteractionLayer</span>()
 Â  Â  Â  Â dirtyFlags.<span class="hljs-property">interaction</span> = <span class="hljs-literal">false</span>
 Â   }
}
</code></pre>
<p><strong>ä¸åŒæ“ä½œè§¦å‘ä¸åŒå±‚çš„é‡ç»˜</strong>ï¼š</p>















































<table><thead><tr><th>æ“ä½œ</th><th>Base</th><th>Content</th><th>Interaction</th></tr></thead><tbody><tr><td>åˆå§‹åŒ–</td><td>âœ“</td><td>âœ“</td><td>âœ“</td></tr><tr><td>æ»šåŠ¨</td><td>âœ“</td><td>âœ“</td><td>âœ“</td></tr><tr><td>æ•°æ®å˜åŒ–</td><td>âœ“</td><td>âœ“</td><td>âœ“</td></tr><tr><td>é¼ æ ‡æ‚¬åœ</td><td>-</td><td>-</td><td>âœ“</td></tr><tr><td>é€‰ä¸­å•å…ƒæ ¼</td><td>-</td><td>-</td><td>âœ“</td></tr><tr><td>ç¼–è¾‘å®Œæˆ</td><td>-</td><td>âœ“</td><td>-</td></tr></tbody></table>
<h4 data-id="heading-27">6.3 calculateVisibleRange - å¯è§†èŒƒå›´è®¡ç®—</h4>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">function</span> <span class="hljs-title function_">calculateVisibleRange</span>(<span class="hljs-params"/>): <span class="hljs-title class_">VisibleRange</span> {
 Â  Â <span class="hljs-keyword">const</span> { rowHeight, headerHeight, columns, data } = props
 Â  Â <span class="hljs-keyword">const</span> bodyHeight = props.<span class="hljs-property">height</span> - headerHeight
â€‹
 Â  Â <span class="hljs-comment">// è¡ŒèŒƒå›´è®¡ç®—</span>
 Â  Â <span class="hljs-keyword">const</span> startRow = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(scrollTop.<span class="hljs-property">value</span> / rowHeight)
 Â  Â <span class="hljs-keyword">const</span> endRow = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(
 Â  Â  Â  Â startRow + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">ceil</span>(bodyHeight / rowHeight) + <span class="hljs-number">2</span>, Â <span class="hljs-comment">// +2 ä½œä¸ºç¼“å†²</span>
 Â  Â  Â  Â data.<span class="hljs-property">length</span>
 Â   )
â€‹
 Â  Â <span class="hljs-comment">// åˆ—èŒƒå›´è®¡ç®—</span>
 Â  Â <span class="hljs-keyword">let</span> accWidth = <span class="hljs-number">0</span>
 Â  Â <span class="hljs-keyword">let</span> startCol = <span class="hljs-number">0</span>
 Â  Â <span class="hljs-keyword">let</span> endCol = columns.<span class="hljs-property">length</span>
â€‹
 Â  Â <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; columns.<span class="hljs-property">length</span>; i++) {
 Â  Â  Â  Â <span class="hljs-keyword">const</span> column = columns[i]
 Â  Â  Â  Â <span class="hljs-keyword">if</span> (!column) <span class="hljs-keyword">continue</span>
â€‹
 Â  Â  Â  Â <span class="hljs-keyword">const</span> colWidth = column.<span class="hljs-property">width</span>
â€‹
 Â  Â  Â  Â <span class="hljs-comment">// æ‰¾åˆ°ç¬¬ä¸€ä¸ªå¯è§åˆ—</span>
 Â  Â  Â  Â <span class="hljs-keyword">if</span> (accWidth + colWidth &gt; scrollLeft.<span class="hljs-property">value</span> &amp;&amp; startCol === <span class="hljs-number">0</span>) {
 Â  Â  Â  Â  Â  Â startCol = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(<span class="hljs-number">0</span>, i - <span class="hljs-number">1</span>) Â <span class="hljs-comment">// -1 ä½œä¸ºç¼“å†²</span>
 Â  Â  Â   }
â€‹
 Â  Â  Â  Â <span class="hljs-comment">// æ‰¾åˆ°æœ€åä¸€ä¸ªå¯è§åˆ—</span>
 Â  Â  Â  Â <span class="hljs-keyword">if</span> (accWidth &gt; scrollLeft.<span class="hljs-property">value</span> + props.<span class="hljs-property">width</span>) {
 Â  Â  Â  Â  Â  Â endCol = i + <span class="hljs-number">1</span>
 Â  Â  Â  Â  Â  Â <span class="hljs-keyword">break</span>
 Â  Â  Â   }
â€‹
 Â  Â  Â  Â accWidth += colWidth
 Â   }
â€‹
 Â  Â <span class="hljs-keyword">return</span> { startRow, endRow, startCol, endCol }
}
</code></pre>
<p><strong>è®¡ç®—åŸç†å›¾è§£</strong>ï¼š</p>
<pre><code class="hljs language-erlang" lang="erlang"> Â  Â  Â   scrollTop
 Â  Â  Â  Â  Â   â”‚
 Â  Â  Â  Â  Â   â–¼
 Â  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 Â  â”‚ Â  Â  Â   ä¸å¯è§åŒºåŸŸ Â  Â  Â  Â  Â  Â  Â  â”‚ row <span class="hljs-number">0</span> ~ startRow-<span class="hljs-number">1</span>
 Â  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â—„â”€â”€ startRow
 Â  â”‚ Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â   â”‚
 Â  â”‚ Â  Â  Â   å¯è§†åŒºåŸŸ Â  Â  Â  Â  Â  Â  Â  Â  â”‚ éœ€è¦ç»˜åˆ¶çš„è¡Œ
 Â  â”‚ Â  Â  Â   (bodyHeight) Â  Â  Â  Â  Â   â”‚
 Â  â”‚ Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â   â”‚
 Â  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â—„â”€â”€ <span class="hljs-keyword">end</span>Row
 Â  â”‚ Â  Â  Â   ä¸å¯è§åŒºåŸŸ Â  Â  Â  Â  Â  Â  Â  â”‚ <span class="hljs-keyword">end</span>Row ~ data.length
 Â  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â€‹
 Â  scrollLeft
 Â  Â  Â  â”‚
 Â  Â  Â  â–¼
  â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”
  â”‚ä¸å¯â”‚ Â  Â   å¯è§†åŒºåŸŸ Â  Â  Â  â”‚ä¸å¯â”‚
  â”‚è§  â”‚ Â  Â  (props.width) Â  â”‚è§  â”‚
  â”‚ Â   â”‚ Â  Â  Â  Â  Â  Â  Â  Â  Â   â”‚ Â   â”‚
  â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”˜
 Â  col col Â  Â  Â  Â  Â  Â  Â  Â  Â  col
 Â  <span class="hljs-number">0</span>~  startCol Â  Â  Â  Â  Â  Â   <span class="hljs-keyword">end</span>Col~
 Â  start-<span class="hljs-number">1</span> Â  Â  Â  Â  Â  Â  Â  Â  Â  length
</code></pre>
<h4 data-id="heading-28">6.4 renderBaseLayer - åº•å±‚æ¸²æŸ“</h4>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">function</span> <span class="hljs-title function_">renderBaseLayer</span>(<span class="hljs-params">range: VisibleRange</span>) {
 Â  Â <span class="hljs-keyword">const</span> ctx = contexts.<span class="hljs-property">base</span>
 Â  Â <span class="hljs-keyword">if</span> (!ctx) <span class="hljs-keyword">return</span>
â€‹
 Â  Â ctx.<span class="hljs-title function_">clearRect</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, props.<span class="hljs-property">width</span>, props.<span class="hljs-property">height</span>)
â€‹
 Â  Â <span class="hljs-title function_">drawBackground</span>(ctx, range)
 Â  Â <span class="hljs-title function_">drawGridLines</span>(ctx, range)
}
</code></pre>
<h5 data-id="heading-29">èƒŒæ™¯ç»˜åˆ¶ï¼ˆå«æ–‘é©¬çº¹ï¼‰</h5>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">function</span> <span class="hljs-title function_">drawBackground</span>(<span class="hljs-params">ctx: CanvasRenderingContext2D, range: VisibleRange</span>) {
 Â  Â <span class="hljs-keyword">const</span> { startRow, endRow, startCol, endCol } = range
 Â  Â <span class="hljs-keyword">const</span> { rowHeight, headerHeight, columns } = props
â€‹
 Â  Â <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> row = startRow; row &lt; endRow; row++) {
 Â  Â  Â  Â <span class="hljs-keyword">let</span> x = <span class="hljs-title function_">getColumnX</span>(startCol) - scrollLeft.<span class="hljs-property">value</span>
 Â  Â  Â  Â <span class="hljs-keyword">const</span> y = row * rowHeight + headerHeight - scrollTop.<span class="hljs-property">value</span>
â€‹
 Â  Â  Â  Â <span class="hljs-comment">// å¥‡å¶è¡Œä¸åŒé¢œè‰²ï¼Œå½¢æˆæ–‘é©¬çº¹</span>
 Â  Â  Â  Â <span class="hljs-keyword">const</span> bgColor = row % <span class="hljs-number">2</span> === <span class="hljs-number">0</span> ? theme.<span class="hljs-property">value</span>.<span class="hljs-property">cellBgColor</span> : <span class="hljs-variable constant_">ZEBRA_COLOR</span>
â€‹
 Â  Â  Â  Â <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> col = startCol; col &lt; endCol; col++) {
 Â  Â  Â  Â  Â  Â <span class="hljs-keyword">const</span> column = columns[col]
 Â  Â  Â  Â  Â  Â <span class="hljs-keyword">if</span> (!column) <span class="hljs-keyword">continue</span>
â€‹
 Â  Â  Â  Â  Â  Â ctx.<span class="hljs-property">fillStyle</span> = bgColor
 Â  Â  Â  Â  Â  Â ctx.<span class="hljs-title function_">fillRect</span>(x, y, column.<span class="hljs-property">width</span>, rowHeight)
 Â  Â  Â  Â  Â  Â x += column.<span class="hljs-property">width</span>
 Â  Â  Â   }
 Â   }
}
</code></pre>
<h5 data-id="heading-30">ç½‘æ ¼çº¿ç»˜åˆ¶</h5>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">function</span> <span class="hljs-title function_">drawGridLines</span>(<span class="hljs-params">ctx: CanvasRenderingContext2D, range: VisibleRange</span>) {
 Â  Â <span class="hljs-keyword">const</span> { startRow, endRow, startCol, endCol } = range
 Â  Â <span class="hljs-keyword">const</span> { rowHeight, headerHeight, columns } = props
â€‹
 Â  Â ctx.<span class="hljs-property">strokeStyle</span> = theme.<span class="hljs-property">value</span>.<span class="hljs-property">borderColor</span>
 Â  Â ctx.<span class="hljs-property">lineWidth</span> = <span class="hljs-number">1</span>
â€‹
 Â  Â <span class="hljs-comment">// æ°´å¹³çº¿ï¼šæ¯è¡Œåº•éƒ¨ç”»ä¸€æ¡çº¿</span>
 Â  Â ctx.<span class="hljs-title function_">beginPath</span>()
 Â  Â <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> row = startRow; row &lt;= endRow; row++) {
 Â  Â  Â  Â <span class="hljs-comment">// +0.5 ç¡®ä¿çº¿æ¡åœ¨åƒç´ è¾¹ç•Œä¸Šï¼Œé¿å…æ¨¡ç³Š</span>
 Â  Â  Â  Â <span class="hljs-keyword">const</span> y = row * rowHeight + headerHeight - scrollTop.<span class="hljs-property">value</span> + <span class="hljs-number">0.5</span>
 Â  Â  Â  Â ctx.<span class="hljs-title function_">moveTo</span>(<span class="hljs-number">0</span>, y)
 Â  Â  Â  Â ctx.<span class="hljs-title function_">lineTo</span>(props.<span class="hljs-property">width</span>, y)
 Â   }
 Â  Â ctx.<span class="hljs-title function_">stroke</span>()
â€‹
 Â  Â <span class="hljs-comment">// å‚ç›´çº¿ï¼šæ¯åˆ—å³ä¾§ç”»ä¸€æ¡çº¿</span>
 Â  Â ctx.<span class="hljs-title function_">beginPath</span>()
 Â  Â <span class="hljs-keyword">let</span> x = <span class="hljs-title function_">getColumnX</span>(startCol) - scrollLeft.<span class="hljs-property">value</span> + <span class="hljs-number">0.5</span>
 Â  Â <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> col = startCol; col &lt;= endCol; col++) {
 Â  Â  Â  Â ctx.<span class="hljs-title function_">moveTo</span>(x, headerHeight)
 Â  Â  Â  Â ctx.<span class="hljs-title function_">lineTo</span>(x, props.<span class="hljs-property">height</span>)
 Â  Â  Â  Â <span class="hljs-keyword">const</span> column = columns[col]
 Â  Â  Â  Â x += column?.<span class="hljs-property">width</span> || <span class="hljs-number">0</span>
 Â   }
 Â  Â ctx.<span class="hljs-title function_">stroke</span>()
}
</code></pre>
<p><strong>ä¸ºä»€ä¹ˆè¦ +0.5ï¼Ÿ</strong></p>
<p>Canvas çš„åæ ‡ç³»æ˜¯ä»¥åƒç´ ä¸­å¿ƒä¸ºåŸç‚¹çš„ã€‚å½“ä½ åœ¨æ•´æ•°åæ ‡ç”» 1px çš„çº¿æ—¶ï¼Œçº¿æ¡ä¼šæ¨ªè·¨ä¸¤ä¸ªåƒç´ ï¼Œå¯¼è‡´æ¨¡ç³Šã€‚åŠ  0.5 åï¼Œçº¿æ¡æ­£å¥½è½åœ¨åƒç´ è¾¹ç•Œä¸Šï¼Œæ˜¾å¾—æ¸…æ™°ã€‚</p>
<pre><code class="hljs">æ•´æ•°åæ ‡ï¼ˆæ¨¡ç³Šï¼‰ï¼š Â  Â   +0.5 åæ ‡ï¼ˆæ¸…æ™°ï¼‰ï¼š
 Â  â”‚â–“â–“â”‚ Â  Â  Â  Â  Â  Â  Â  Â  Â   â”‚â–ˆâ–ˆâ”‚
 Â  â”‚â–“â–“â”‚ Â  Â  Â  Â  Â  Â  Â  Â  Â   â”‚  â”‚
</code></pre>
<h4 data-id="heading-31">6.5 renderContentLayer - å†…å®¹å±‚æ¸²æŸ“</h4>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">function</span> <span class="hljs-title function_">renderContentLayer</span>(<span class="hljs-params">range: VisibleRange</span>) {
 Â  Â <span class="hljs-keyword">const</span> ctx = contexts.<span class="hljs-property">content</span>
 Â  Â <span class="hljs-keyword">if</span> (!ctx) <span class="hljs-keyword">return</span>
â€‹
 Â  Â ctx.<span class="hljs-title function_">clearRect</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, props.<span class="hljs-property">width</span>, props.<span class="hljs-property">height</span>)
â€‹
 Â  Â <span class="hljs-title function_">drawCells</span>(ctx, range)
 Â  Â <span class="hljs-title function_">drawHeader</span>(ctx, range)
â€‹
 Â  Â <span class="hljs-keyword">if</span> (props.<span class="hljs-property">frozenColumns</span> &gt; <span class="hljs-number">0</span>) {
 Â  Â  Â  Â <span class="hljs-title function_">drawFrozenColumns</span>(ctx, range)
 Â   }
}
</code></pre>
<h5 data-id="heading-32">å•å…ƒæ ¼å†…å®¹ç»˜åˆ¶</h5>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">function</span> <span class="hljs-title function_">drawCells</span>(<span class="hljs-params">ctx: CanvasRenderingContext2D, range: VisibleRange</span>) {
 Â  Â <span class="hljs-keyword">const</span> { startRow, endRow, startCol, endCol } = range
 Â  Â <span class="hljs-keyword">const</span> { rowHeight, headerHeight, columns, data } = props
â€‹
 Â  Â ctx.<span class="hljs-property">fillStyle</span> = theme.<span class="hljs-property">value</span>.<span class="hljs-property">cellTextColor</span>
 Â  Â ctx.<span class="hljs-property">font</span> = <span class="hljs-variable constant_">DEFAULT_FONT</span>
 Â  Â ctx.<span class="hljs-property">textBaseline</span> = <span class="hljs-string">'middle'</span> Â <span class="hljs-comment">// å‚ç›´å±…ä¸­</span>
â€‹
 Â  Â <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> row = startRow; row &lt; endRow; row++) {
 Â  Â  Â  Â <span class="hljs-keyword">const</span> rowData = data[row]
 Â  Â  Â  Â <span class="hljs-keyword">if</span> (!rowData) <span class="hljs-keyword">continue</span>
â€‹
 Â  Â  Â  Â <span class="hljs-keyword">let</span> x = <span class="hljs-title function_">getColumnX</span>(startCol) - scrollLeft.<span class="hljs-property">value</span>
â€‹
 Â  Â  Â  Â <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> col = startCol; col &lt; endCol; col++) {
 Â  Â  Â  Â  Â  Â <span class="hljs-keyword">const</span> column = columns[col]
 Â  Â  Â  Â  Â  Â <span class="hljs-keyword">if</span> (!column) <span class="hljs-keyword">continue</span>
â€‹
 Â  Â  Â  Â  Â  Â <span class="hljs-keyword">const</span> value = rowData[column.<span class="hljs-property">key</span>]
 Â  Â  Â  Â  Â  Â <span class="hljs-keyword">const</span> cellY = row * rowHeight + headerHeight - scrollTop.<span class="hljs-property">value</span>
â€‹
 Â  Â  Â  Â  Â  Â <span class="hljs-comment">// è·å–æ˜¾ç¤ºæ–‡æœ¬</span>
 Â  Â  Â  Â  Â  Â <span class="hljs-keyword">let</span> displayText = value?.<span class="hljs-title function_">toString</span>() || <span class="hljs-string">''</span>
 Â  Â  Â  Â  Â  Â <span class="hljs-keyword">if</span> (column.<span class="hljs-property">formatter</span>) {
 Â  Â  Â  Â  Â  Â  Â  Â displayText = column.<span class="hljs-title function_">formatter</span>(value, rowData)
 Â  Â  Â  Â  Â   }
â€‹
 Â  Â  Â  Â  Â  Â <span class="hljs-comment">// æ–‡æœ¬æˆªæ–­</span>
 Â  Â  Â  Â  Â  Â displayText = <span class="hljs-title function_">ellipsisText</span>(ctx, displayText, column.<span class="hljs-property">width</span> - <span class="hljs-variable constant_">CELL_PADDING</span> * <span class="hljs-number">2</span>)
â€‹
 Â  Â  Â  Â  Â  Â <span class="hljs-comment">// è®¡ç®—æ–‡æœ¬ X åæ ‡</span>
 Â  Â  Â  Â  Â  Â ctx.<span class="hljs-property">fillStyle</span> = theme.<span class="hljs-property">value</span>.<span class="hljs-property">cellTextColor</span>
 Â  Â  Â  Â  Â  Â <span class="hljs-keyword">const</span> textX = <span class="hljs-title function_">getTextX</span>(x, column.<span class="hljs-property">width</span>, column.<span class="hljs-property">align</span>)
 Â  Â  Â  Â  Â  Â <span class="hljs-keyword">const</span> textY = cellY + rowHeight / <span class="hljs-number">2</span> Â <span class="hljs-comment">// å‚ç›´å±…ä¸­</span>
â€‹
 Â  Â  Â  Â  Â  Â ctx.<span class="hljs-property">textAlign</span> = column.<span class="hljs-property">align</span> || <span class="hljs-string">'left'</span>
 Â  Â  Â  Â  Â  Â ctx.<span class="hljs-title function_">fillText</span>(displayText, textX, textY)
â€‹
 Â  Â  Â  Â  Â  Â x += column.<span class="hljs-property">width</span>
 Â  Â  Â   }
 Â   }
}
</code></pre>
<h5 data-id="heading-33">è¡¨å¤´ç»˜åˆ¶</h5>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">function</span> <span class="hljs-title function_">drawHeader</span>(<span class="hljs-params">ctx: CanvasRenderingContext2D, range: VisibleRange</span>) {
 Â  Â <span class="hljs-keyword">const</span> { startCol, endCol } = range
 Â  Â <span class="hljs-keyword">const</span> { headerHeight, columns } = props
â€‹
 Â  Â <span class="hljs-comment">// èƒŒæ™¯</span>
 Â  Â ctx.<span class="hljs-property">fillStyle</span> = theme.<span class="hljs-property">value</span>.<span class="hljs-property">headerBgColor</span>
 Â  Â ctx.<span class="hljs-title function_">fillRect</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, props.<span class="hljs-property">width</span>, headerHeight)
â€‹
 Â  Â <span class="hljs-comment">// æ–‡å­—</span>
 Â  Â ctx.<span class="hljs-property">fillStyle</span> = theme.<span class="hljs-property">value</span>.<span class="hljs-property">headerTextColor</span>
 Â  Â ctx.<span class="hljs-property">font</span> = <span class="hljs-variable constant_">HEADER_FONT</span> Â <span class="hljs-comment">// åŠ ç²—å­—ä½“</span>
 Â  Â ctx.<span class="hljs-property">textBaseline</span> = <span class="hljs-string">'middle'</span>
 Â  Â ctx.<span class="hljs-property">textAlign</span> = <span class="hljs-string">'center'</span>
â€‹
 Â  Â <span class="hljs-keyword">let</span> x = <span class="hljs-title function_">getColumnX</span>(startCol) - scrollLeft.<span class="hljs-property">value</span>
â€‹
 Â  Â <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> col = startCol; col &lt; endCol; col++) {
 Â  Â  Â  Â <span class="hljs-keyword">const</span> column = columns[col]
 Â  Â  Â  Â <span class="hljs-keyword">if</span> (!column) <span class="hljs-keyword">continue</span>
â€‹
 Â  Â  Â  Â <span class="hljs-keyword">const</span> textX = x + column.<span class="hljs-property">width</span> / <span class="hljs-number">2</span> Â <span class="hljs-comment">// æ°´å¹³å±…ä¸­</span>
 Â  Â  Â  Â <span class="hljs-keyword">const</span> textY = headerHeight / <span class="hljs-number">2</span> Â  Â  Â  <span class="hljs-comment">// å‚ç›´å±…ä¸­</span>
â€‹
 Â  Â  Â  Â ctx.<span class="hljs-title function_">fillText</span>(column.<span class="hljs-property">title</span>, textX, textY)
 Â  Â  Â  Â x += column.<span class="hljs-property">width</span>
 Â   }
â€‹
 Â  Â <span class="hljs-comment">// åº•éƒ¨è¾¹æ¡†</span>
 Â  Â ctx.<span class="hljs-property">strokeStyle</span> = theme.<span class="hljs-property">value</span>.<span class="hljs-property">borderColor</span>
 Â  Â ctx.<span class="hljs-property">lineWidth</span> = <span class="hljs-number">1</span>
 Â  Â ctx.<span class="hljs-title function_">beginPath</span>()
 Â  Â ctx.<span class="hljs-title function_">moveTo</span>(<span class="hljs-number">0</span>, headerHeight + <span class="hljs-number">0.5</span>)
 Â  Â ctx.<span class="hljs-title function_">lineTo</span>(props.<span class="hljs-property">width</span>, headerHeight + <span class="hljs-number">0.5</span>)
 Â  Â ctx.<span class="hljs-title function_">stroke</span>()
}
</code></pre>
<h5 data-id="heading-34">å†»ç»“åˆ—ç»˜åˆ¶</h5>
<p>å†»ç»“åˆ—çš„å…³é”®åœ¨äºï¼š<strong>å®ƒä»¬ä¸éšæ°´å¹³æ»šåŠ¨è€Œç§»åŠ¨</strong>ã€‚</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">function</span> <span class="hljs-title function_">drawFrozenColumns</span>(<span class="hljs-params">ctx: CanvasRenderingContext2D, range: VisibleRange</span>) {
 Â  Â <span class="hljs-keyword">const</span> { startRow, endRow } = range
 Â  Â <span class="hljs-keyword">const</span> { rowHeight, headerHeight, columns, data, frozenColumns } = props
â€‹
 Â  Â <span class="hljs-comment">// 1. æ¸…ç©ºå†»ç»“åŒºåŸŸï¼ˆè¦†ç›–ä¹‹å‰ç»˜åˆ¶çš„å†…å®¹ï¼‰</span>
 Â  Â ctx.<span class="hljs-title function_">clearRect</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, frozenWidth.<span class="hljs-property">value</span>, props.<span class="hljs-property">height</span>)
â€‹
 Â  Â <span class="hljs-comment">// 2. ç»˜åˆ¶å†»ç»“åˆ—çš„èƒŒæ™¯</span>
 Â  Â <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> row = startRow; row &lt; endRow; row++) {
 Â  Â  Â  Â <span class="hljs-keyword">const</span> y = row * rowHeight + headerHeight - scrollTop.<span class="hljs-property">value</span>
 Â  Â  Â  Â <span class="hljs-keyword">const</span> bgColor = row % <span class="hljs-number">2</span> === <span class="hljs-number">0</span> ? theme.<span class="hljs-property">value</span>.<span class="hljs-property">cellBgColor</span> : <span class="hljs-variable constant_">ZEBRA_COLOR</span>
 Â  Â  Â  Â ctx.<span class="hljs-property">fillStyle</span> = bgColor
 Â  Â  Â  Â ctx.<span class="hljs-title function_">fillRect</span>(<span class="hljs-number">0</span>, y, frozenWidth.<span class="hljs-property">value</span>, rowHeight)
 Â   }
â€‹
 Â  Â <span class="hljs-comment">// 3. ç»˜åˆ¶å†»ç»“åˆ—çš„å†…å®¹</span>
 Â  Â <span class="hljs-comment">// ... (ä»£ç çœç•¥ï¼Œä¸æ™®é€šå•å…ƒæ ¼ç±»ä¼¼ï¼Œä½† x ä» 0 å¼€å§‹ï¼Œä¸å‡ scrollLeft)</span>
â€‹
 Â  Â <span class="hljs-comment">// 4. ç»˜åˆ¶å†»ç»“åˆ—çš„è¡¨å¤´</span>
 Â  Â ctx.<span class="hljs-property">fillStyle</span> = theme.<span class="hljs-property">value</span>.<span class="hljs-property">headerBgColor</span>
 Â  Â ctx.<span class="hljs-title function_">fillRect</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, frozenWidth.<span class="hljs-property">value</span>, headerHeight)
 Â  Â <span class="hljs-comment">// ...</span>
â€‹
 Â  Â <span class="hljs-comment">// 5. å³ä¾§é˜´å½±æ•ˆæœï¼ˆæ»šåŠ¨æ—¶æ˜¾ç¤ºï¼‰</span>
 Â  Â <span class="hljs-keyword">if</span> (scrollLeft.<span class="hljs-property">value</span> &gt; <span class="hljs-number">0</span>) {
 Â  Â  Â  Â <span class="hljs-keyword">const</span> gradient = ctx.<span class="hljs-title function_">createLinearGradient</span>(
 Â  Â  Â  Â  Â  Â frozenWidth.<span class="hljs-property">value</span>, <span class="hljs-number">0</span>, Â  Â  Â  Â  Â  <span class="hljs-comment">// èµ·ç‚¹</span>
 Â  Â  Â  Â  Â  Â frozenWidth.<span class="hljs-property">value</span> + <span class="hljs-number">10</span>, <span class="hljs-number">0</span> Â  Â  Â  <span class="hljs-comment">// ç»ˆç‚¹</span>
 Â  Â  Â   )
 Â  Â  Â  Â gradient.<span class="hljs-title function_">addColorStop</span>(<span class="hljs-number">0</span>, <span class="hljs-string">'rgba(0, 0, 0, 0.08)'</span>)
 Â  Â  Â  Â gradient.<span class="hljs-title function_">addColorStop</span>(<span class="hljs-number">1</span>, <span class="hljs-string">'rgba(0, 0, 0, 0)'</span>)
 Â  Â  Â  Â ctx.<span class="hljs-property">fillStyle</span> = gradient
 Â  Â  Â  Â ctx.<span class="hljs-title function_">fillRect</span>(frozenWidth.<span class="hljs-property">value</span>, <span class="hljs-number">0</span>, <span class="hljs-number">10</span>, props.<span class="hljs-property">height</span>)
 Â   }
â€‹
 Â  Â <span class="hljs-comment">// 6. ç»˜åˆ¶ç½‘æ ¼çº¿</span>
 Â  Â <span class="hljs-comment">// ...</span>
}
</code></pre>
<p><strong>å†»ç»“åˆ—ä¸æ™®é€šåˆ—çš„åæ ‡å·®å¼‚</strong>ï¼š</p>




















<table><thead><tr><th>ç±»å‹</th><th>X åæ ‡è®¡ç®—</th><th>Y åæ ‡è®¡ç®—</th></tr></thead><tbody><tr><td>æ™®é€šåˆ—</td><td><code>getColumnX(col) - scrollLeft</code></td><td><code>row * rowHeight + headerHeight - scrollTop</code></td></tr><tr><td>å†»ç»“åˆ—</td><td><code>getColumnX(col)</code>ï¼ˆä¸å‡ scrollLeftï¼‰</td><td><code>row * rowHeight + headerHeight - scrollTop</code></td></tr></tbody></table>
<h4 data-id="heading-35">6.6 renderInteractionLayer - äº¤äº’å±‚æ¸²æŸ“</h4>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">function</span> <span class="hljs-title function_">renderInteractionLayer</span>(<span class="hljs-params"/>) {
 Â  Â <span class="hljs-keyword">const</span> ctx = contexts.<span class="hljs-property">interaction</span>
 Â  Â <span class="hljs-keyword">if</span> (!ctx) <span class="hljs-keyword">return</span>
â€‹
 Â  Â ctx.<span class="hljs-title function_">clearRect</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, props.<span class="hljs-property">width</span>, props.<span class="hljs-property">height</span>)
â€‹
 Â  Â <span class="hljs-title function_">drawHover</span>(ctx) Â  Â  Â <span class="hljs-comment">// å…ˆç»˜åˆ¶æ‚¬åœæ•ˆæœ</span>
 Â  Â <span class="hljs-title function_">drawSelection</span>(ctx) Â <span class="hljs-comment">// å†ç»˜åˆ¶é€‰ä¸­æ•ˆæœï¼ˆè¦†ç›–åœ¨æ‚¬åœä¹‹ä¸Šï¼‰</span>
}
</code></pre>
<h5 data-id="heading-36">é€‰ä¸­æ•ˆæœç»˜åˆ¶</h5>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">function</span> <span class="hljs-title function_">drawSelection</span>(<span class="hljs-params">ctx: CanvasRenderingContext2D</span>) {
 Â  Â <span class="hljs-keyword">if</span> (!selectedCell.<span class="hljs-property">value</span>) <span class="hljs-keyword">return</span>
â€‹
 Â  Â <span class="hljs-keyword">const</span> { row, col } = selectedCell.<span class="hljs-property">value</span>
 Â  Â <span class="hljs-keyword">const</span> { rowHeight, headerHeight, columns, frozenColumns } = props
â€‹
 Â  Â <span class="hljs-keyword">const</span> column = columns[col]
 Â  Â <span class="hljs-keyword">if</span> (!column) <span class="hljs-keyword">return</span>
â€‹
 Â  Â <span class="hljs-keyword">let</span> x = <span class="hljs-title function_">getColumnX</span>(col)
 Â  Â <span class="hljs-keyword">const</span> y = row * rowHeight + headerHeight
â€‹
 Â  Â <span class="hljs-comment">// éå†»ç»“åˆ—éœ€è¦å‡å»æ»šåŠ¨åç§»</span>
 Â  Â <span class="hljs-keyword">if</span> (col &gt;= frozenColumns) {
 Â  Â  Â  Â x -= scrollLeft.<span class="hljs-property">value</span>
 Â   }
â€‹
 Â  Â <span class="hljs-keyword">const</span> canvasY = y - scrollTop.<span class="hljs-property">value</span>
 Â  Â <span class="hljs-keyword">const</span> width = column.<span class="hljs-property">width</span>
 Â  Â <span class="hljs-keyword">const</span> height = rowHeight
â€‹
 Â  Â <span class="hljs-comment">// é€‰ä¸­èƒŒæ™¯</span>
 Â  Â ctx.<span class="hljs-property">fillStyle</span> = theme.<span class="hljs-property">value</span>.<span class="hljs-property">selectedColor</span>
 Â  Â ctx.<span class="hljs-title function_">fillRect</span>(x, canvasY, width, height)
â€‹
 Â  Â <span class="hljs-comment">// é€‰ä¸­è¾¹æ¡†ï¼ˆå†…ç¼© 1pxï¼Œé¿å…è¦†ç›–ç½‘æ ¼çº¿ï¼‰</span>
 Â  Â ctx.<span class="hljs-property">strokeStyle</span> = <span class="hljs-variable constant_">SELECTION_BORDER_COLOR</span>
 Â  Â ctx.<span class="hljs-property">lineWidth</span> = <span class="hljs-number">2</span>
 Â  Â ctx.<span class="hljs-title function_">strokeRect</span>(x + <span class="hljs-number">1</span>, canvasY + <span class="hljs-number">1</span>, width - <span class="hljs-number">2</span>, height - <span class="hljs-number">2</span>)
}
</code></pre>
<h5 data-id="heading-37">æ‚¬åœæ•ˆæœç»˜åˆ¶</h5>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">function</span> <span class="hljs-title function_">drawHover</span>(<span class="hljs-params">ctx: CanvasRenderingContext2D</span>) {
 Â  Â <span class="hljs-comment">// å¦‚æœæ²¡æœ‰æ‚¬åœè¡Œï¼Œæˆ–æ‚¬åœè¡Œä¸é€‰ä¸­è¡Œç›¸åŒï¼Œä¸ç»˜åˆ¶</span>
 Â  Â <span class="hljs-keyword">if</span> (hoverRow.<span class="hljs-property">value</span> &lt; <span class="hljs-number">0</span> || selectedCell.<span class="hljs-property">value</span>?.<span class="hljs-property">row</span> === hoverRow.<span class="hljs-property">value</span>) <span class="hljs-keyword">return</span>
â€‹
 Â  Â <span class="hljs-keyword">const</span> { rowHeight, headerHeight } = props
 Â  Â <span class="hljs-keyword">const</span> y = hoverRow.<span class="hljs-property">value</span> * rowHeight + headerHeight - scrollTop.<span class="hljs-property">value</span>
â€‹
 Â  Â ctx.<span class="hljs-property">fillStyle</span> = theme.<span class="hljs-property">value</span>.<span class="hljs-property">hoverColor</span>
 Â  Â ctx.<span class="hljs-title function_">fillRect</span>(<span class="hljs-number">0</span>, y, props.<span class="hljs-property">width</span>, rowHeight) Â <span class="hljs-comment">// æ•´è¡Œé«˜äº®</span>
}
</code></pre>
<hr/>
<h3 data-id="heading-38">ä¸ƒã€äº‹ä»¶å¤„ç†æœºåˆ¶</h3>
<h4 data-id="heading-39">7.1 åæ ‡è½¬æ¢ï¼šgetCellFromEvent</h4>
<p>Canvas åªæ˜¯ä¸€å¼ å›¾ç‰‡ï¼Œæœ¬èº«æ— æ³•çŸ¥é“ç”¨æˆ·ç‚¹å‡»äº†å“ªä¸ªå•å…ƒæ ¼ã€‚æˆ‘ä»¬éœ€è¦æ ¹æ®é¼ æ ‡åæ ‡è®¡ç®—å‡ºå•å…ƒæ ¼ä½ç½®ï¼š</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">function</span> <span class="hljs-title function_">getCellFromEvent</span>(<span class="hljs-params">e: MouseEvent</span>): { <span class="hljs-attr">row</span>: <span class="hljs-built_in">number</span>; <span class="hljs-attr">col</span>: <span class="hljs-built_in">number</span>; <span class="hljs-attr">isHeader</span>: <span class="hljs-built_in">boolean</span> } {
 Â  Â <span class="hljs-keyword">const</span> canvas = interactionCanvasRef.<span class="hljs-property">value</span>
 Â  Â <span class="hljs-keyword">if</span> (!canvas) <span class="hljs-keyword">return</span> { <span class="hljs-attr">row</span>: -<span class="hljs-number">1</span>, <span class="hljs-attr">col</span>: -<span class="hljs-number">1</span>, <span class="hljs-attr">isHeader</span>: <span class="hljs-literal">false</span> }
â€‹
 Â  Â <span class="hljs-comment">// 1. è·å– Canvas ç›¸å¯¹äºè§†å£çš„ä½ç½®</span>
 Â  Â <span class="hljs-keyword">const</span> rect = canvas.<span class="hljs-title function_">getBoundingClientRect</span>()
â€‹
 Â  Â <span class="hljs-comment">// 2. è®¡ç®—é¼ æ ‡åœ¨ Canvas ä¸Šçš„åæ ‡</span>
 Â  Â <span class="hljs-keyword">const</span> canvasX = e.<span class="hljs-property">clientX</span> - rect.<span class="hljs-property">left</span>
 Â  Â <span class="hljs-keyword">const</span> canvasY = e.<span class="hljs-property">clientY</span> - rect.<span class="hljs-property">top</span>
â€‹
 Â  Â <span class="hljs-keyword">const</span> { headerHeight, rowHeight, columns, data, frozenColumns } = props
â€‹
 Â  Â <span class="hljs-comment">// 3. åˆ¤æ–­æ˜¯å¦åœ¨è¡¨å¤´åŒºåŸŸ</span>
 Â  Â <span class="hljs-keyword">const</span> isHeader = canvasY &lt; headerHeight
â€‹
 Â  Â <span class="hljs-comment">// 4. è®¡ç®—è¡Œå·</span>
 Â  Â <span class="hljs-keyword">let</span> row = -<span class="hljs-number">1</span>
 Â  Â <span class="hljs-keyword">if</span> (!isHeader) {
 Â  Â  Â  Â <span class="hljs-comment">// åŠ ä¸Š scrollTop å¾—åˆ°æ•°æ®åæ ‡</span>
 Â  Â  Â  Â <span class="hljs-keyword">const</span> dataY = canvasY - headerHeight + scrollTop.<span class="hljs-property">value</span>
 Â  Â  Â  Â row = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(dataY / rowHeight)
 Â  Â  Â  Â <span class="hljs-keyword">if</span> (row &lt; <span class="hljs-number">0</span> || row &gt;= data.<span class="hljs-property">length</span>) row = -<span class="hljs-number">1</span>
 Â   }
â€‹
 Â  Â <span class="hljs-comment">// 5. è®¡ç®—åˆ—å·</span>
 Â  Â <span class="hljs-keyword">let</span> col = -<span class="hljs-number">1</span>
 Â  Â <span class="hljs-keyword">const</span> isFrozenArea = canvasX &lt; frozenWidth.<span class="hljs-property">value</span>
â€‹
 Â  Â <span class="hljs-comment">// å†»ç»“åŒºåŸŸä¸éœ€è¦åŠ  scrollLeft</span>
 Â  Â <span class="hljs-keyword">const</span> dataX = isFrozenArea ? canvasX : canvasX + scrollLeft.<span class="hljs-property">value</span>
â€‹
 Â  Â <span class="hljs-keyword">let</span> accWidth = <span class="hljs-number">0</span>
 Â  Â <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; columns.<span class="hljs-property">length</span>; i++) {
 Â  Â  Â  Â <span class="hljs-keyword">const</span> column = columns[i]
 Â  Â  Â  Â <span class="hljs-keyword">if</span> (!column) <span class="hljs-keyword">continue</span>
â€‹
 Â  Â  Â  Â accWidth += column.<span class="hljs-property">width</span>
 Â  Â  Â  Â <span class="hljs-keyword">if</span> (dataX &lt; accWidth) {
 Â  Â  Â  Â  Â  Â col = i
 Â  Â  Â  Â  Â  Â <span class="hljs-keyword">break</span>
 Â  Â  Â   }
 Â   }
â€‹
 Â  Â <span class="hljs-keyword">return</span> { row, col, isHeader }
}
</code></pre>
<h4 data-id="heading-40">7.2 ç‚¹å‡»å¤„ç†</h4>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">function</span> <span class="hljs-title function_">handleClick</span>(<span class="hljs-params">e: MouseEvent</span>) {
 Â  Â <span class="hljs-keyword">const</span> { row, col, isHeader } = <span class="hljs-title function_">getCellFromEvent</span>(e)
â€‹
 Â  Â <span class="hljs-keyword">if</span> (row === -<span class="hljs-number">1</span> || col === -<span class="hljs-number">1</span>) <span class="hljs-keyword">return</span>
â€‹
 Â  Â <span class="hljs-keyword">const</span> column = props.<span class="hljs-property">columns</span>[col]
 Â  Â <span class="hljs-keyword">if</span> (!column) <span class="hljs-keyword">return</span>
â€‹
 Â  Â <span class="hljs-keyword">if</span> (isHeader) {
 Â  Â  Â  Â <span class="hljs-title function_">emit</span>(<span class="hljs-string">'header-click'</span>, col, column)
 Â   } <span class="hljs-keyword">else</span> {
 Â  Â  Â  Â selectedCell.<span class="hljs-property">value</span> = { row, col }
 Â  Â  Â  Â <span class="hljs-title function_">emit</span>(<span class="hljs-string">'cell-click'</span>, row, col, props.<span class="hljs-property">data</span>[row])
 Â  Â  Â  Â <span class="hljs-title function_">markDirty</span>(<span class="hljs-string">'interaction'</span>) Â <span class="hljs-comment">// åªéœ€é‡ç»˜äº¤äº’å±‚</span>
 Â  Â  Â  Â <span class="hljs-title function_">requestRender</span>()
 Â   }
}
</code></pre>
<h4 data-id="heading-41">7.3 åŒå‡»ç¼–è¾‘</h4>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">function</span> <span class="hljs-title function_">handleDoubleClick</span>(<span class="hljs-params">e: MouseEvent</span>) {
 Â  Â <span class="hljs-keyword">const</span> { row, col, isHeader } = <span class="hljs-title function_">getCellFromEvent</span>(e)
â€‹
 Â  Â <span class="hljs-keyword">if</span> (row === -<span class="hljs-number">1</span> || col === -<span class="hljs-number">1</span> || isHeader) <span class="hljs-keyword">return</span>
â€‹
 Â  Â <span class="hljs-keyword">const</span> column = props.<span class="hljs-property">columns</span>[col]
 Â  Â <span class="hljs-keyword">if</span> (!column) <span class="hljs-keyword">return</span>
â€‹
 Â  Â <span class="hljs-keyword">if</span> (column.<span class="hljs-property">editable</span> !== <span class="hljs-literal">false</span>) {
 Â  Â  Â  Â editingCell.<span class="hljs-property">value</span> = { row, col }
 Â  Â  Â  Â <span class="hljs-keyword">const</span> rowData = props.<span class="hljs-property">data</span>[row]
 Â  Â  Â  Â editValue.<span class="hljs-property">value</span> = rowData?.[column.<span class="hljs-property">key</span>]?.<span class="hljs-title function_">toString</span>() || <span class="hljs-string">''</span>
â€‹
 Â  Â  Â  Â <span class="hljs-comment">// ç­‰å¾… DOM æ›´æ–°åèšç„¦è¾“å…¥æ¡†</span>
 Â  Â  Â  Â <span class="hljs-title function_">nextTick</span>(<span class="hljs-function">() =&gt;</span> {
 Â  Â  Â  Â  Â  Â editorRef.<span class="hljs-property">value</span>?.<span class="hljs-title function_">focus</span>()
 Â  Â  Â  Â  Â  Â editorRef.<span class="hljs-property">value</span>?.<span class="hljs-title function_">select</span>()
 Â  Â  Â   })
 Â   }
â€‹
 Â  Â <span class="hljs-title function_">emit</span>(<span class="hljs-string">'cell-double-click'</span>, row, col, props.<span class="hljs-property">data</span>[row])
}
</code></pre>
<hr/>
<h3 data-id="heading-42">å…«ã€æ€§èƒ½ä¼˜åŒ–ä¸“é¢˜</h3>
<h4 data-id="heading-43">8.1 Canvas åˆ†å±‚æ¸²æŸ“</h4>
<p>è¿™æ˜¯æœ¬ç»„ä»¶æœ€æ ¸å¿ƒçš„ä¼˜åŒ–ç­–ç•¥ã€‚ä¸åŒå†…å®¹çš„æ›´æ–°é¢‘ç‡å·®å¼‚å¾ˆå¤§ï¼š</p>

























<table><thead><tr><th>å±‚çº§</th><th>å†…å®¹</th><th>æ›´æ–°é¢‘ç‡</th></tr></thead><tbody><tr><td>Base Layer</td><td>èƒŒæ™¯ã€ç½‘æ ¼çº¿</td><td>æä½ï¼ˆresize æ—¶ï¼‰</td></tr><tr><td>Content Layer</td><td>æ–‡å­—å†…å®¹</td><td>ä¸­ç­‰ï¼ˆæ»šåŠ¨æ—¶ï¼‰</td></tr><tr><td>Interaction Layer</td><td>é€‰ä¸­ã€æ‚¬åœ</td><td>é«˜ï¼ˆé¼ æ ‡ç§»åŠ¨æ—¶ï¼‰</td></tr></tbody></table>
<p><strong>ä¼˜åŒ–æ•ˆæœ</strong>ï¼šå½“ç”¨æˆ·ç§»åŠ¨é¼ æ ‡æ—¶ï¼Œåªéœ€è¦æ¸…ç©ºå¹¶é‡ç»˜ Interaction Layerï¼ŒèƒŒæ™¯å’Œæ–‡å­—å†…å®¹ä¿æŒä¸å˜ã€‚è¿™æ¯”æ¯æ¬¡éƒ½é‡ç»˜æ•´ä¸ª Canvas å¿«å¾—å¤šã€‚</p>
<h4 data-id="heading-44">8.2 requestAnimationFrame èŠ‚æµ</h4>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">function</span> <span class="hljs-title function_">requestRender</span>(<span class="hljs-params"/>) {
 Â  Â <span class="hljs-keyword">if</span> (rafId) <span class="hljs-keyword">return</span> Â <span class="hljs-comment">// å¦‚æœå·²æœ‰å¾…æ‰§è¡Œçš„æ¸²æŸ“è¯·æ±‚ï¼Œè·³è¿‡</span>
â€‹
 Â  Â rafId = <span class="hljs-title function_">requestAnimationFrame</span>(<span class="hljs-function">() =&gt;</span> {
 Â  Â  Â  Â <span class="hljs-title function_">renderAll</span>()
 Â  Â  Â  Â rafId = <span class="hljs-literal">null</span>
 Â   })
}
</code></pre>
<p><strong>ä¸ºä»€ä¹ˆä½¿ç”¨ RAFï¼Ÿ</strong></p>
<ul>
<li>æµè§ˆå™¨ä¼šåœ¨ä¸‹ä¸€å¸§å¼€å§‹å‰æ‰§è¡Œ RAF å›è°ƒ</li>
<li>å¤šæ¬¡è°ƒç”¨ <code>requestRender()</code> åªä¼šæ‰§è¡Œä¸€æ¬¡æ¸²æŸ“</li>
<li>ä¸å±å¹•åˆ·æ–°ç‡åŒæ­¥ï¼Œé¿å…æ— æ•ˆæ¸²æŸ“</li>
</ul>
<h4 data-id="heading-45">8.3 æ–‡æœ¬æˆªæ–­äºŒåˆ†æŸ¥æ‰¾</h4>
<p>åŸå§‹å®ç°ï¼ˆO(nÂ²) å¤æ‚åº¦ï¼‰ï¼š</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// âŒ ä½æ•ˆå®ç°</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">ellipsisText</span>(<span class="hljs-params">text: <span class="hljs-built_in">string</span>, maxWidth: <span class="hljs-built_in">number</span></span>): <span class="hljs-built_in">string</span> {
 Â  Â <span class="hljs-keyword">let</span> truncated = text
 Â  Â <span class="hljs-keyword">while</span> (ctx.<span class="hljs-title function_">measureText</span>(truncated + <span class="hljs-string">'...'</span>).<span class="hljs-property">width</span> &gt; maxWidth) {
 Â  Â  Â  Â truncated = truncated.<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>, -<span class="hljs-number">1</span>) Â <span class="hljs-comment">// æ¯æ¬¡åˆ é™¤ä¸€ä¸ªå­—ç¬¦</span>
 Â   }
 Â  Â <span class="hljs-keyword">return</span> truncated + <span class="hljs-string">'...'</span>
}
</code></pre>
<p>ä¼˜åŒ–å®ç°ï¼ˆO(n log n) å¤æ‚åº¦ï¼‰ï¼š</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// âœ… äºŒåˆ†æŸ¥æ‰¾ä¼˜åŒ–</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">ellipsisText</span>(<span class="hljs-params">ctx: CanvasRenderingContext2D, text: <span class="hljs-built_in">string</span>, maxWidth: <span class="hljs-built_in">number</span></span>): <span class="hljs-built_in">string</span> {
 Â  Â <span class="hljs-keyword">if</span> (ctx.<span class="hljs-title function_">measureText</span>(text).<span class="hljs-property">width</span> &lt;= maxWidth) <span class="hljs-keyword">return</span> text
â€‹
 Â  Â <span class="hljs-keyword">const</span> ellipsis = <span class="hljs-string">'...'</span>
 Â  Â <span class="hljs-keyword">const</span> ellipsisWidth = ctx.<span class="hljs-title function_">measureText</span>(ellipsis).<span class="hljs-property">width</span>
â€‹
 Â  Â <span class="hljs-keyword">if</span> (maxWidth &lt;= ellipsisWidth) <span class="hljs-keyword">return</span> ellipsis
â€‹
 Â  Â <span class="hljs-comment">// äºŒåˆ†æŸ¥æ‰¾æœ€ä½³æˆªæ–­ä½ç½®</span>
 Â  Â <span class="hljs-keyword">let</span> left = <span class="hljs-number">0</span>
 Â  Â <span class="hljs-keyword">let</span> right = text.<span class="hljs-property">length</span>
 Â  Â <span class="hljs-keyword">let</span> result = <span class="hljs-string">''</span>
â€‹
 Â  Â <span class="hljs-keyword">while</span> (left &lt; right) {
 Â  Â  Â  Â <span class="hljs-keyword">const</span> mid = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>((left + right + <span class="hljs-number">1</span>) / <span class="hljs-number">2</span>)
 Â  Â  Â  Â <span class="hljs-keyword">const</span> truncated = text.<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>, mid)
â€‹
 Â  Â  Â  Â <span class="hljs-keyword">if</span> (ctx.<span class="hljs-title function_">measureText</span>(truncated).<span class="hljs-property">width</span> + ellipsisWidth &lt;= maxWidth) {
 Â  Â  Â  Â  Â  Â result = truncated
 Â  Â  Â  Â  Â  Â left = mid
 Â  Â  Â   } <span class="hljs-keyword">else</span> {
 Â  Â  Â  Â  Â  Â right = mid - <span class="hljs-number">1</span>
 Â  Â  Â   }
 Â   }
â€‹
 Â  Â <span class="hljs-keyword">return</span> result + ellipsis
}
</code></pre>
<p><strong>æ€§èƒ½å¯¹æ¯”</strong>ï¼ˆå‡è®¾æ–‡æœ¬é•¿åº¦ 100ï¼‰ï¼š</p>

















<table><thead><tr><th>æ–¹æ³•</th><th>measureText è°ƒç”¨æ¬¡æ•°</th></tr></thead><tbody><tr><td>é€å­—ç¬¦åˆ é™¤</td><td>æœ€å¤š 100 æ¬¡</td></tr><tr><td>äºŒåˆ†æŸ¥æ‰¾</td><td>æœ€å¤š 7 æ¬¡ (logâ‚‚100 â‰ˆ 7)</td></tr></tbody></table>
<h4 data-id="heading-46">8.4 å¸¸é‡æå–</h4>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// âœ… é¿å…é­”æ³•æ•°å­—ï¼Œä¾¿äºç»´æŠ¤å’Œå¤ç”¨</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">CELL_PADDING</span> = <span class="hljs-number">8</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">DEFAULT_FONT</span> = <span class="hljs-string">'14px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">HEADER_FONT</span> = <span class="hljs-string">'bold 14px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">ZEBRA_COLOR</span> = <span class="hljs-string">'#fafafa'</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">SELECTION_BORDER_COLOR</span> = <span class="hljs-string">'rgba(64, 158, 255, 0.8)'</span>
</code></pre>
<h4 data-id="heading-47">8.5 äº‹ä»¶è§£ç»‘</h4>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-title function_">onUnmounted</span>(<span class="hljs-function">() =&gt;</span> {
 Â  Â <span class="hljs-keyword">if</span> (rafId) <span class="hljs-title function_">cancelAnimationFrame</span>(rafId)
 Â  Â <span class="hljs-title function_">unbindEvents</span>() Â <span class="hljs-comment">// ç§»é™¤äº‹ä»¶ç›‘å¬ï¼Œé˜²æ­¢å†…å­˜æ³„æ¼</span>
})
</code></pre>
<hr/>
<h3 data-id="heading-48">æ¼”ç¤º</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3f54aab8fc9842bbb168d14d438b1b7f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGFzaGFu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771307449&amp;x-signature=IAyEECrtyT2CsugBVWMgYuDEss4%3D" alt="lovegif_1770702484032.gif" loading="lazy"/></p>
<h3 data-id="heading-49">æ€»ç»“</h3>
<p>Canvas é«˜æ€§èƒ½è¡¨æ ¼çš„æ ¸å¿ƒæŠ€æœ¯è¦ç‚¹ï¼š</p>
<ol start="0">
<li><strong>è™šæ‹Ÿæ»šåŠ¨</strong>ï¼šåªæ¸²æŸ“å¯è§†åŒºåŸŸå†…çš„å•å…ƒæ ¼</li>
<li><strong>åˆ†å±‚æ¸²æŸ“</strong>ï¼šæŒ‰æ›´æ–°é¢‘ç‡åˆ†ç¦»ä¸º Base/Content/Interaction ä¸‰å±‚</li>
<li><strong>RAF èŠ‚æµ</strong>ï¼šä½¿ç”¨ requestAnimationFrame æ‰¹é‡æ›´æ–°</li>
<li><strong>é«˜æ¸…å±é€‚é…</strong>ï¼šé€šè¿‡ devicePixelRatio å¤„ç† Retina å±å¹•</li>
<li><strong>åæ ‡è½¬æ¢</strong>ï¼šæ­£ç¡®å¤„ç†æ»šåŠ¨åç§»å’Œå†»ç»“åˆ—çš„åæ ‡å·®å¼‚</li>
<li><strong>ç®—æ³•ä¼˜åŒ–</strong>ï¼šæ–‡æœ¬æˆªæ–­ä½¿ç”¨äºŒåˆ†æŸ¥æ‰¾</li>
</ol>
<p>é€šè¿‡è¿™äº›æŠ€æœ¯ï¼ŒCanvas è¡¨æ ¼å¯ä»¥è½»æ¾å¤„ç† 10 ä¸‡+ è¡Œæ•°æ®ï¼ŒåŒæ—¶ä¿æŒ 60fps çš„æµç•…æ»šåŠ¨ä½“éªŒã€‚</p>
<hr/>
<h3 data-id="heading-50">é™„å½•ï¼šæš´éœ²çš„æ–¹æ³•</h3>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-title function_">defineExpose</span>({
 Â  Â <span class="hljs-comment">// æ»šåŠ¨åˆ°æŒ‡å®šä½ç½®</span>
 Â  Â <span class="hljs-attr">scrollTo</span>: <span class="hljs-function">(<span class="hljs-params">left?: <span class="hljs-built_in">number</span>, top?: <span class="hljs-built_in">number</span></span>) =&gt;</span> { ... },
 Â  Â 
 Â  Â <span class="hljs-comment">// æ»šåŠ¨åˆ°æŒ‡å®šè¡Œ</span>
 Â  Â <span class="hljs-attr">scrollToRow</span>: <span class="hljs-function">(<span class="hljs-params">rowIndex: <span class="hljs-built_in">number</span></span>) =&gt;</span> { ... },
 Â  Â 
 Â  Â <span class="hljs-comment">// å¼ºåˆ¶åˆ·æ–°</span>
 Â  Â <span class="hljs-attr">refresh</span>: <span class="hljs-function">() =&gt;</span> { ... }
})
</code></pre>
<p><strong>ä½¿ç”¨ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-ts" lang="ts">&lt;script setup&gt;
<span class="hljs-keyword">const</span> tableRef = <span class="hljs-title function_">ref</span>()
â€‹
<span class="hljs-comment">// æ»šåŠ¨åˆ°ç¬¬ 100 è¡Œ</span>
tableRef.<span class="hljs-property">value</span>?.<span class="hljs-title function_">scrollToRow</span>(<span class="hljs-number">100</span>)
â€‹
<span class="hljs-comment">// æ»šåŠ¨åˆ°æŒ‡å®šä½ç½®</span>
tableRef.<span class="hljs-property">value</span>?.<span class="hljs-title function_">scrollTo</span>(<span class="hljs-number">200</span>, <span class="hljs-number">500</span>)
â€‹
<span class="hljs-comment">// å¼ºåˆ¶åˆ·æ–°</span>
tableRef.<span class="hljs-property">value</span>?.<span class="hljs-title function_">refresh</span>()
&lt;/script&gt;
â€‹
&lt;template&gt;
 Â  Â <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">CanvasTable</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"tableRef"</span> <span class="hljs-attr">:columns</span>=<span class="hljs-string">"columns"</span> <span class="hljs-attr">:data</span>=<span class="hljs-string">"data"</span> /&gt;</span></span>
&lt;/template&gt;
</code></pre>
<h3 data-id="heading-51">å®Œæ•´ä»£ç </h3>
<pre><code class="hljs language-Vue3" lang="Vue3">
&lt;template&gt;
    &lt;div class="canvas-container"&gt;
        &lt;div ref="containerRef" class="canvas-table-container" :style="containerStyle"&gt;
            &lt;!-- åº•å±‚ Canvasï¼šèƒŒæ™¯ã€ç½‘æ ¼çº¿ï¼ˆå¾ˆå°‘å˜åŒ–ï¼‰ --&gt;
            &lt;canvas ref="baseCanvasRef" class="layer-base" /&gt;

            &lt;!-- ä¸­å±‚ Canvasï¼šå•å…ƒæ ¼å†…å®¹ï¼ˆæ»šåŠ¨æ—¶æ›´æ–°ï¼‰ --&gt;
            &lt;canvas ref="contentCanvasRef" class="layer-content" /&gt;

            &lt;!-- é¡¶å±‚ Canvasï¼šé€‰åŒºã€hoverï¼ˆé¢‘ç¹æ›´æ–°ï¼‰ --&gt;
            &lt;canvas ref="interactionCanvasRef" class="layer-interaction" /&gt;

            &lt;!-- æ»šåŠ¨å ä½å±‚ï¼ˆäº§ç”ŸåŸç”Ÿæ»šåŠ¨æ¡ï¼‰ --&gt;
            &lt;div ref="scrollerRef" class="scroll-container" @scroll="handleScroll"&gt;
                &lt;div class="scroll-phantom" :style="phantomStyle" /&gt;
            &lt;/div&gt;

            &lt;!-- ç¼–è¾‘è¾“å…¥æ¡†ï¼ˆç‚¹å‡»å•å…ƒæ ¼æ—¶æ˜¾ç¤ºï¼‰ --&gt;
            &lt;input v-if="editingCell" ref="editorRef" v-model="editValue" class="cell-editor" :style="editorStyle"
                @blur="finishEdit" @keydown.enter="finishEdit" @keydown.escape="cancelEdit" /&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/template&gt;

&lt;script lang="ts" setup&gt;
import { ref, computed, onMounted, onUnmounted, watch, nextTick } from 'vue'

// ==================== ç±»å‹å®šä¹‰ ====================

/** åˆ—é…ç½®æ¥å£ */
interface Column {
    key: string
    title: string
    width: number
    align?: 'left' | 'center' | 'right'
    formatter?: (value: any, row: any) =&gt; string
    editable?: boolean
}

/** ç»„ä»¶ Props æ¥å£ */
interface Props {
    columns: Column[]
    data: any[]
    width?: number
    height?: number
    rowHeight?: number
    headerHeight?: number
    frozenColumns?: number
    theme?: Partial&lt;ThemeConfig&gt;
}

/** ä¸»é¢˜é…ç½®æ¥å£ */
interface ThemeConfig {
    headerBgColor: string
    headerTextColor: string
    cellBgColor: string
    cellTextColor: string
    borderColor: string
    hoverColor: string
    selectedColor: string
}

/** å¯è§†èŒƒå›´æ¥å£ */
interface VisibleRange {
    startRow: number
    endRow: number
    startCol: number
    endCol: number
}

/** Canvas å±‚çº§ä¸Šä¸‹æ–‡ */
interface CanvasContexts {
    base: CanvasRenderingContext2D | null
    content: CanvasRenderingContext2D | null
    interaction: CanvasRenderingContext2D | null
}

// ==================== å¸¸é‡å®šä¹‰ ====================

/** å•å…ƒæ ¼å†…è¾¹è· */
const CELL_PADDING = 8

/** é»˜è®¤å­—ä½“ */
const DEFAULT_FONT = '14px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'
const HEADER_FONT = 'bold 14px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'

/** æ–‘é©¬çº¹é¢œè‰² */
const ZEBRA_COLOR = '#fafafa'

/** é€‰ä¸­è¾¹æ¡†é¢œè‰² */
const SELECTION_BORDER_COLOR = 'rgba(64, 158, 255, 0.8)'

// ==================== Props å®šä¹‰ ====================

const props = withDefaults(defineProps&lt;Props&gt;(), {
    width: 800,
    height: 400,
    rowHeight: 36,
    headerHeight: 40,
    frozenColumns: 1,
    theme: () =&gt; ({})
})

// ==================== äº‹ä»¶å®šä¹‰ ====================

const emit = defineEmits&lt;{
    (e: 'cell-click', row: number, col: number, data: any): void
    (e: 'cell-double-click', row: number, col: number, data: any): void
    (e: 'header-click', col: number, column: Column): void
    (e: 'selection-change', selection: any): void
    (e: 'scroll', scrollLeft: number, scrollTop: number): void
}&gt;()

// ==================== é»˜è®¤ä¸»é¢˜ ====================

const defaultTheme: ThemeConfig = {
    headerBgColor: '#f5f7fa',
    headerTextColor: '#606266',
    cellBgColor: '#ffffff',
    cellTextColor: '#303133',
    borderColor: '#ebeef5',
    hoverColor: 'rgba(64, 158, 255, 0.1)',
    selectedColor: 'rgba(64, 158, 255, 0.15)'
}

const theme = computed(() =&gt; ({ ...defaultTheme, ...props.theme }))

// ==================== DOM å¼•ç”¨ ====================

const containerRef = ref&lt;HTMLDivElement&gt;()
const baseCanvasRef = ref&lt;HTMLCanvasElement&gt;()
const contentCanvasRef = ref&lt;HTMLCanvasElement&gt;()
const interactionCanvasRef = ref&lt;HTMLCanvasElement&gt;()
const scrollerRef = ref&lt;HTMLDivElement&gt;()
const editorRef = ref&lt;HTMLInputElement&gt;()

// ==================== çŠ¶æ€ ====================

const scrollLeft = ref(0)
const scrollTop = ref(0)
const hoverRow = ref(-1)
const selectedCell = ref&lt;{ row: number; col: number } | null&gt;(null)
const editingCell = ref&lt;{ row: number; col: number } | null&gt;(null)
const editValue = ref('')

// ==================== Canvas ä¸Šä¸‹æ–‡ ====================

const contexts: CanvasContexts = {
    base: null,
    content: null,
    interaction: null
}
let dpr = 1
let rafId: number | null = null

// è„æ ‡è®°ï¼šæ ‡è¯†å“ªäº›å±‚éœ€è¦é‡ç»˜
const dirtyFlags = {
    base: true,
    content: true,
    interaction: true
}

// ==================== è®¡ç®—å±æ€§ ====================

/** æ€»å®½åº¦ */
const totalWidth = computed(() =&gt;
    props.columns.reduce((sum, col) =&gt; sum + col.width, 0)
)

/** æ€»é«˜åº¦ */
const totalHeight = computed(() =&gt;
    props.data.length * props.rowHeight + props.headerHeight
)

/** å®¹å™¨æ ·å¼ */
const containerStyle = computed(() =&gt; ({
    width: `${props.width}px`,
    height: `${props.height}px`
}))

/** å¹½çµå±‚æ ·å¼ï¼ˆæ’‘å¼€æ»šåŠ¨åŒºåŸŸï¼‰ */
const phantomStyle = computed(() =&gt; ({
    width: `${totalWidth.value}px`,
    height: `${totalHeight.value}px`
}))

/** å†»ç»“åˆ—å®½åº¦ */
const frozenWidth = computed(() =&gt; {
    let width = 0
    for (let i = 0; i &lt; props.frozenColumns &amp;&amp; i &lt; props.columns.length; i++) {
        const column = props.columns[i]
        if (column) width += column.width
    }
    return width
})

/** ç¼–è¾‘æ¡†æ ·å¼ */
const editorStyle = computed(() =&gt; {
    if (!editingCell.value) return {}

    const { row, col } = editingCell.value
    const column = props.columns[col]
    if (!column) return {}

    let x = getColumnX(col)
    const y = row * props.rowHeight + props.headerHeight

    // å¦‚æœåœ¨å†»ç»“åˆ—å¤–ï¼Œå‡å»æ»šåŠ¨åç§»
    if (col &gt;= props.frozenColumns) {
        x -= scrollLeft.value
    }

    return {
        left: `${x}px`,
        top: `${y - scrollTop.value}px`,
        width: `${column.width}px`,
        height: `${props.rowHeight}px`
    }
})

// ==================== ç”Ÿå‘½å‘¨æœŸ ====================

onMounted(() =&gt; {
    if (!containerRef.value) return

    dpr = window.devicePixelRatio || 1

    initCanvas()
    bindEvents()
    renderAll()
})

onUnmounted(() =&gt; {
    if (rafId) cancelAnimationFrame(rafId)
    unbindEvents()
})

// ==================== æ•°æ®ç›‘å¬ ====================

watch(() =&gt; props.data, () =&gt; {
    markDirty('base', 'content', 'interaction')
    requestRender()
}, { deep: true })

watch(() =&gt; props.columns, () =&gt; {
    markDirty('base', 'content', 'interaction')
    requestRender()
}, { deep: true })

// ==================== åˆå§‹åŒ–æ–¹æ³• ====================

/**
 * åˆå§‹åŒ–æ‰€æœ‰ Canvas å±‚
 */
function initCanvas() {
    const canvases = [
        { ref: baseCanvasRef.value, key: 'base' as const },
        { ref: contentCanvasRef.value, key: 'content' as const },
        { ref: interactionCanvasRef.value, key: 'interaction' as const }
    ]

    canvases.forEach(({ ref: canvas, key }) =&gt; {
        if (!canvas) return

        // è®¾ç½® Canvas å°ºå¯¸ï¼ˆå¤„ç†é«˜æ¸…å±ï¼‰
        canvas.width = props.width * dpr
        canvas.height = props.height * dpr
        canvas.style.width = `${props.width}px`
        canvas.style.height = `${props.height}px`

        const ctx = canvas.getContext('2d')
        if (ctx) {
            ctx.scale(dpr, dpr)
            contexts[key] = ctx
        }
    })
}

/**
 * ç»‘å®šäº‹ä»¶
 */
function bindEvents() {
    const scroller = scrollerRef.value
    if (!scroller) return

    scroller.addEventListener('click', handleClick)
    scroller.addEventListener('dblclick', handleDoubleClick)
    scroller.addEventListener('mousemove', handleMouseMove)
    scroller.addEventListener('mouseleave', handleMouseLeave)
}

/**
 * è§£ç»‘äº‹ä»¶ï¼ˆé˜²æ­¢å†…å­˜æ³„æ¼ï¼‰
 */
function unbindEvents() {
    const scroller = scrollerRef.value
    if (!scroller) return

    scroller.removeEventListener('click', handleClick)
    scroller.removeEventListener('dblclick', handleDoubleClick)
    scroller.removeEventListener('mousemove', handleMouseMove)
    scroller.removeEventListener('mouseleave', handleMouseLeave)
}

// ==================== æ¸²æŸ“æ§åˆ¶ ====================

/**
 * æ ‡è®°è„å±‚
 */
function markDirty(...layers: Array&lt;'base' | 'content' | 'interaction'&gt;) {
    layers.forEach(layer =&gt; {
        dirtyFlags[layer] = true
    })
}

/**
 * è¯·æ±‚æ¸²æŸ“ï¼ˆä½¿ç”¨ RAF èŠ‚æµï¼‰
 */
function requestRender() {
    if (rafId) return

    rafId = requestAnimationFrame(() =&gt; {
        renderAll()
        rafId = null
    })
}

/**
 * æ¸²æŸ“æ‰€æœ‰è„å±‚
 */
function renderAll() {
    const range = calculateVisibleRange()

    if (dirtyFlags.base) {
        renderBaseLayer(range)
        dirtyFlags.base = false
    }

    if (dirtyFlags.content) {
        renderContentLayer(range)
        dirtyFlags.content = false
    }

    if (dirtyFlags.interaction) {
        renderInteractionLayer()
        dirtyFlags.interaction = false
    }
}

// ==================== å¯è§†èŒƒå›´è®¡ç®— ====================

/**
 * è®¡ç®—å¯è§†èŒƒå›´
 */
function calculateVisibleRange(): VisibleRange {
    const { rowHeight, headerHeight, columns, data } = props
    const bodyHeight = props.height - headerHeight

    // è¡ŒèŒƒå›´ï¼ˆå¤šæ¸²æŸ“2è¡Œä½œä¸ºç¼“å†²ï¼‰
    const startRow = Math.floor(scrollTop.value / rowHeight)
    const endRow = Math.min(
        startRow + Math.ceil(bodyHeight / rowHeight) + 2,
        data.length
    )

    // åˆ—èŒƒå›´
    let accWidth = 0
    let startCol = 0
    let endCol = columns.length

    for (let i = 0; i &lt; columns.length; i++) {
        const column = columns[i]
        if (!column) continue

        const colWidth = column.width

        if (accWidth + colWidth &gt; scrollLeft.value &amp;&amp; startCol === 0) {
            startCol = Math.max(0, i - 1)
        }

        if (accWidth &gt; scrollLeft.value + props.width) {
            endCol = i + 1
            break
        }

        accWidth += colWidth
    }

    return { startRow, endRow, startCol, endCol }
}

// ==================== åº•å±‚æ¸²æŸ“ï¼ˆèƒŒæ™¯ã€ç½‘æ ¼çº¿ï¼‰ ====================

/**
 * æ¸²æŸ“åº•å±‚ï¼šèƒŒæ™¯å’Œç½‘æ ¼çº¿
 */
function renderBaseLayer(range: VisibleRange) {
    const ctx = contexts.base
    if (!ctx) return

    ctx.clearRect(0, 0, props.width, props.height)

    drawBackground(ctx, range)
    drawGridLines(ctx, range)
}

/**
 * ç»˜åˆ¶èƒŒæ™¯ï¼ˆå«æ–‘é©¬çº¹ï¼‰
 */
function drawBackground(ctx: CanvasRenderingContext2D, range: VisibleRange) {
    const { startRow, endRow, startCol, endCol } = range
    const { rowHeight, headerHeight, columns } = props

    for (let row = startRow; row &lt; endRow; row++) {
        let x = getColumnX(startCol) - scrollLeft.value
        const y = row * rowHeight + headerHeight - scrollTop.value

        // æ–‘é©¬çº¹æ•ˆæœ
        const bgColor = row % 2 === 0 ? theme.value.cellBgColor : ZEBRA_COLOR

        for (let col = startCol; col &lt; endCol; col++) {
            const column = columns[col]
            if (!column) continue

            ctx.fillStyle = bgColor
            ctx.fillRect(x, y, column.width, rowHeight)
            x += column.width
        }
    }
}

/**
 * ç»˜åˆ¶ç½‘æ ¼çº¿
 */
function drawGridLines(ctx: CanvasRenderingContext2D, range: VisibleRange) {
    const { startRow, endRow, startCol, endCol } = range
    const { rowHeight, headerHeight, columns } = props

    ctx.strokeStyle = theme.value.borderColor
    ctx.lineWidth = 1

    // æ°´å¹³çº¿
    ctx.beginPath()
    for (let row = startRow; row &lt;= endRow; row++) {
        const y = row * rowHeight + headerHeight - scrollTop.value + 0.5
        ctx.moveTo(0, y)
        ctx.lineTo(props.width, y)
    }
    ctx.stroke()

    // å‚ç›´çº¿
    ctx.beginPath()
    let x = getColumnX(startCol) - scrollLeft.value + 0.5
    for (let col = startCol; col &lt;= endCol; col++) {
        ctx.moveTo(x, headerHeight)
        ctx.lineTo(x, props.height)
        const column = columns[col]
        x += column?.width || 0
    }
    ctx.stroke()
}

// ==================== ä¸­å±‚æ¸²æŸ“ï¼ˆå•å…ƒæ ¼å†…å®¹ï¼‰ ====================

/**
 * æ¸²æŸ“ä¸­å±‚ï¼šå•å…ƒæ ¼å†…å®¹ã€è¡¨å¤´ã€å†»ç»“åˆ—
 */
function renderContentLayer(range: VisibleRange) {
    const ctx = contexts.content
    if (!ctx) return

    ctx.clearRect(0, 0, props.width, props.height)

    drawCells(ctx, range)
    drawHeader(ctx, range)

    if (props.frozenColumns &gt; 0) {
        drawFrozenColumns(ctx, range)
    }
}

/**
 * ç»˜åˆ¶å•å…ƒæ ¼å†…å®¹
 */
function drawCells(ctx: CanvasRenderingContext2D, range: VisibleRange) {
    const { startRow, endRow, startCol, endCol } = range
    const { rowHeight, headerHeight, columns, data } = props

    ctx.fillStyle = theme.value.cellTextColor
    ctx.font = DEFAULT_FONT
    ctx.textBaseline = 'middle'

    for (let row = startRow; row &lt; endRow; row++) {
        const rowData = data[row]
        if (!rowData) continue

        let x = getColumnX(startCol) - scrollLeft.value

        for (let col = startCol; col &lt; endCol; col++) {
            const column = columns[col]
            if (!column) continue

            const value = rowData[column.key]
            const cellY = row * rowHeight + headerHeight - scrollTop.value

            // è·å–æ˜¾ç¤ºæ–‡æœ¬
            let displayText = value?.toString() || ''
            if (column.formatter) {
                displayText = column.formatter(value, rowData)
            }

            // æ–‡æœ¬æˆªæ–­ï¼ˆä½¿ç”¨äºŒåˆ†æŸ¥æ‰¾ä¼˜åŒ–ï¼‰
            displayText = ellipsisText(ctx, displayText, column.width - CELL_PADDING * 2)

            // ç»˜åˆ¶æ–‡æœ¬
            ctx.fillStyle = theme.value.cellTextColor
            const textX = getTextX(x, column.width, column.align)
            const textY = cellY + rowHeight / 2

            ctx.textAlign = column.align || 'left'
            ctx.fillText(displayText, textX, textY)

            x += column.width
        }
    }
}

/**
 * ç»˜åˆ¶è¡¨å¤´
 */
function drawHeader(ctx: CanvasRenderingContext2D, range: VisibleRange) {
    const { startCol, endCol } = range
    const { headerHeight, columns } = props

    // èƒŒæ™¯
    ctx.fillStyle = theme.value.headerBgColor
    ctx.fillRect(0, 0, props.width, headerHeight)

    // æ–‡å­—
    ctx.fillStyle = theme.value.headerTextColor
    ctx.font = HEADER_FONT
    ctx.textBaseline = 'middle'
    ctx.textAlign = 'center'

    let x = getColumnX(startCol) - scrollLeft.value

    for (let col = startCol; col &lt; endCol; col++) {
        const column = columns[col]
        if (!column) continue

        const textX = x + column.width / 2
        const textY = headerHeight / 2

        ctx.fillText(column.title, textX, textY)
        x += column.width
    }

    // åº•éƒ¨è¾¹æ¡†
    ctx.strokeStyle = theme.value.borderColor
    ctx.lineWidth = 1
    ctx.beginPath()
    ctx.moveTo(0, headerHeight + 0.5)
    ctx.lineTo(props.width, headerHeight + 0.5)
    ctx.stroke()
}

/**
 * ç»˜åˆ¶å†»ç»“åˆ—
 */
function drawFrozenColumns(ctx: CanvasRenderingContext2D, range: VisibleRange) {
    const { startRow, endRow } = range
    const { rowHeight, headerHeight, columns, data, frozenColumns } = props

    // æ¸…ç©ºå†»ç»“åŒºåŸŸ
    ctx.clearRect(0, 0, frozenWidth.value, props.height)

    // ç»˜åˆ¶èƒŒæ™¯
    for (let row = startRow; row &lt; endRow; row++) {
        const y = row * rowHeight + headerHeight - scrollTop.value
        const bgColor = row % 2 === 0 ? theme.value.cellBgColor : ZEBRA_COLOR
        ctx.fillStyle = bgColor
        ctx.fillRect(0, y, frozenWidth.value, rowHeight)
    }

    // ç»˜åˆ¶å†…å®¹
    ctx.fillStyle = theme.value.cellTextColor
    ctx.font = DEFAULT_FONT
    ctx.textBaseline = 'middle'

    for (let row = startRow; row &lt; endRow; row++) {
        const rowData = data[row]
        if (!rowData) continue

        let x = 0
        const y = row * rowHeight + headerHeight - scrollTop.value

        for (let col = 0; col &lt; frozenColumns &amp;&amp; col &lt; columns.length; col++) {
            const column = columns[col]
            if (!column) continue

            const value = rowData[column.key]
            let displayText = value?.toString() || ''

            if (column.formatter) {
                displayText = column.formatter(value, rowData)
            }

            displayText = ellipsisText(ctx, displayText, column.width - CELL_PADDING * 2)

            const textX = getTextX(x, column.width, column.align)
            ctx.textAlign = column.align || 'left'
            ctx.fillText(displayText, textX, y + rowHeight / 2)

            x += column.width
        }
    }

    // ç»˜åˆ¶è¡¨å¤´
    ctx.fillStyle = theme.value.headerBgColor
    ctx.fillRect(0, 0, frozenWidth.value, headerHeight)

    ctx.fillStyle = theme.value.headerTextColor
    ctx.font = HEADER_FONT
    ctx.textAlign = 'center'

    let headerX = 0
    for (let col = 0; col &lt; frozenColumns &amp;&amp; col &lt; columns.length; col++) {
        const column = columns[col]
        if (!column) continue

        ctx.fillText(column.title, headerX + column.width / 2, headerHeight / 2)
        headerX += column.width
    }

    // å³ä¾§é˜´å½±æ•ˆæœ
    if (scrollLeft.value &gt; 0) {
        const gradient = ctx.createLinearGradient(frozenWidth.value, 0, frozenWidth.value + 10, 0)
        gradient.addColorStop(0, 'rgba(0, 0, 0, 0.08)')
        gradient.addColorStop(1, 'rgba(0, 0, 0, 0)')
        ctx.fillStyle = gradient
        ctx.fillRect(frozenWidth.value, 0, 10, props.height)
    }

    // ç»˜åˆ¶ç½‘æ ¼çº¿
    ctx.strokeStyle = theme.value.borderColor
    ctx.lineWidth = 1

    // å‚ç›´çº¿
    ctx.beginPath()
    let lineX = 0.5
    for (let col = 0; col &lt;= frozenColumns &amp;&amp; col &lt; columns.length; col++) {
        ctx.moveTo(lineX, 0)
        ctx.lineTo(lineX, props.height)
        const column = columns[col]
        lineX += column?.width || 0
    }
    ctx.stroke()

    // æ°´å¹³çº¿
    ctx.beginPath()
    for (let row = startRow; row &lt;= endRow; row++) {
        const lineY = row * rowHeight + headerHeight - scrollTop.value + 0.5
        ctx.moveTo(0, lineY)
        ctx.lineTo(frozenWidth.value, lineY)
    }
    ctx.stroke()
}

// ==================== é¡¶å±‚æ¸²æŸ“ï¼ˆäº¤äº’çŠ¶æ€ï¼‰ ====================

/**
 * æ¸²æŸ“é¡¶å±‚ï¼šé€‰ä¸­æ•ˆæœå’Œæ‚¬åœæ•ˆæœ
 */
function renderInteractionLayer() {
    const ctx = contexts.interaction
    if (!ctx) return

    ctx.clearRect(0, 0, props.width, props.height)

    drawHover(ctx)
    drawSelection(ctx)
}

/**
 * ç»˜åˆ¶é€‰ä¸­æ•ˆæœ
 */
function drawSelection(ctx: CanvasRenderingContext2D) {
    if (!selectedCell.value) return

    const { row, col } = selectedCell.value
    const { rowHeight, headerHeight, columns, frozenColumns } = props

    const column = columns[col]
    if (!column) return

    let x = getColumnX(col)
    const y = row * rowHeight + headerHeight

    // éå†»ç»“åˆ—éœ€è¦å‡å»æ»šåŠ¨åç§»
    if (col &gt;= frozenColumns) {
        x -= scrollLeft.value
    }

    const canvasY = y - scrollTop.value
    const width = column.width
    const height = rowHeight

    // é€‰ä¸­èƒŒæ™¯
    ctx.fillStyle = theme.value.selectedColor
    ctx.fillRect(x, canvasY, width, height)

    // é€‰ä¸­è¾¹æ¡†
    ctx.strokeStyle = SELECTION_BORDER_COLOR
    ctx.lineWidth = 2
    ctx.strokeRect(x + 1, canvasY + 1, width - 2, height - 2)
}

/**
 * ç»˜åˆ¶æ‚¬åœæ•ˆæœ
 */
function drawHover(ctx: CanvasRenderingContext2D) {
    if (hoverRow.value &lt; 0 || selectedCell.value?.row === hoverRow.value) return

    const { rowHeight, headerHeight } = props
    const y = hoverRow.value * rowHeight + headerHeight - scrollTop.value

    ctx.fillStyle = theme.value.hoverColor
    ctx.fillRect(0, y, props.width, rowHeight)
}

// ==================== äº‹ä»¶å¤„ç† ====================

/**
 * æ»šåŠ¨å¤„ç†
 */
function handleScroll(e: Event) {
    const target = e.target as HTMLDivElement
    scrollLeft.value = target.scrollLeft
    scrollTop.value = target.scrollTop

    emit('scroll', scrollLeft.value, scrollTop.value)

    // æ»šåŠ¨æ—¶åªéœ€è¦é‡ç»˜å†…å®¹å±‚å’Œäº¤äº’å±‚
    markDirty('base', 'content', 'interaction')
    requestRender()
}

/**
 * ç‚¹å‡»äº‹ä»¶
 */
function handleClick(e: MouseEvent) {
    const { row, col, isHeader } = getCellFromEvent(e)

    if (row === -1 || col === -1) return

    const column = props.columns[col]
    if (!column) return

    if (isHeader) {
        emit('header-click', col, column)
    } else {
        selectedCell.value = { row, col }
        emit('cell-click', row, col, props.data[row])
        markDirty('interaction')
        requestRender()
    }
}

/**
 * åŒå‡»äº‹ä»¶ï¼ˆè¿›å…¥ç¼–è¾‘ï¼‰
 */
function handleDoubleClick(e: MouseEvent) {
    const { row, col, isHeader } = getCellFromEvent(e)

    if (row === -1 || col === -1 || isHeader) return

    const column = props.columns[col]
    if (!column) return

    if (column.editable !== false) {
        editingCell.value = { row, col }
        const rowData = props.data[row]
        editValue.value = rowData?.[column.key]?.toString() || ''

        nextTick(() =&gt; {
            editorRef.value?.focus()
            editorRef.value?.select()
        })
    }

    emit('cell-double-click', row, col, props.data[row])
}

/**
 * é¼ æ ‡ç§»åŠ¨
 */
function handleMouseMove(e: MouseEvent) {
    const { row } = getCellFromEvent(e)

    if (hoverRow.value !== row) {
        hoverRow.value = row
        markDirty('interaction')
        requestRender()
    }
}

/**
 * é¼ æ ‡ç¦»å¼€
 */
function handleMouseLeave() {
    hoverRow.value = -1
    markDirty('interaction')
    requestRender()
}

/**
 * å®Œæˆç¼–è¾‘
 */
function finishEdit() {
    if (!editingCell.value) return

    const { row, col } = editingCell.value
    const column = props.columns[col]
    if (!column) return

    // æ›´æ–°æ•°æ®
    props.data[row][column.key] = editValue.value

    editingCell.value = null
    markDirty('content')
    requestRender()
}

/**
 * å–æ¶ˆç¼–è¾‘
 */
function cancelEdit() {
    editingCell.value = null
}

// ==================== å·¥å…·æ–¹æ³• ====================

/**
 * ä»äº‹ä»¶è·å–å•å…ƒæ ¼ä½ç½®
 */
function getCellFromEvent(e: MouseEvent): { row: number; col: number; isHeader: boolean } {
    const canvas = interactionCanvasRef.value
    if (!canvas) return { row: -1, col: -1, isHeader: false }

    const rect = canvas.getBoundingClientRect()
    const canvasX = e.clientX - rect.left
    const canvasY = e.clientY - rect.top

    const { headerHeight, rowHeight, columns, data, frozenColumns } = props

    // æ˜¯å¦åœ¨è¡¨å¤´
    const isHeader = canvasY &lt; headerHeight

    // è®¡ç®—è¡Œ
    let row = -1
    if (!isHeader) {
        const dataY = canvasY - headerHeight + scrollTop.value
        row = Math.floor(dataY / rowHeight)
        if (row &lt; 0 || row &gt;= data.length) row = -1
    }

    // è®¡ç®—åˆ—
    let col = -1
    const isFrozenArea = canvasX &lt; frozenWidth.value
    const dataX = isFrozenArea ? canvasX : canvasX + scrollLeft.value

    let accWidth = 0
    for (let i = 0; i &lt; columns.length; i++) {
        const column = columns[i]
        if (!column) continue

        accWidth += column.width
        if (dataX &lt; accWidth) {
            col = i
            break
        }
    }

    return { row, col, isHeader }
}

/**
 * è·å–åˆ— X åæ ‡
 */
function getColumnX(colIndex: number): number {
    let x = 0
    for (let i = 0; i &lt; colIndex &amp;&amp; i &lt; props.columns.length; i++) {
        const column = props.columns[i]
        if (column) x += column.width
    }
    return x
}

/**
 * è·å–æ–‡æœ¬ X åæ ‡
 */
function getTextX(cellX: number, cellWidth: number, align?: string): number {
    switch (align) {
        case 'center': return cellX + cellWidth / 2
        case 'right': return cellX + cellWidth - CELL_PADDING
        default: return cellX + CELL_PADDING
    }
}

/**
 * æ–‡æœ¬æˆªæ–­ï¼ˆä½¿ç”¨äºŒåˆ†æŸ¥æ‰¾ä¼˜åŒ–ï¼‰
 */
function ellipsisText(ctx: CanvasRenderingContext2D, text: string, maxWidth: number): string {
    if (ctx.measureText(text).width &lt;= maxWidth) return text

    const ellipsis = '...'
    const ellipsisWidth = ctx.measureText(ellipsis).width

    if (maxWidth &lt;= ellipsisWidth) return ellipsis

    // äºŒåˆ†æŸ¥æ‰¾æœ€ä½³æˆªæ–­ä½ç½®
    let left = 0
    let right = text.length
    let result = ''

    while (left &lt; right) {
        const mid = Math.floor((left + right + 1) / 2)
        const truncated = text.slice(0, mid)

        if (ctx.measureText(truncated).width + ellipsisWidth &lt;= maxWidth) {
            result = truncated
            left = mid
        } else {
            right = mid - 1
        }
    }

    return result + ellipsis
}

// ==================== æš´éœ²æ–¹æ³• ====================

defineExpose({
    /** æ»šåŠ¨åˆ°æŒ‡å®šä½ç½® */
    scrollTo: (left?: number, top?: number) =&gt; {
        if (left !== undefined &amp;&amp; scrollerRef.value) {
            scrollerRef.value.scrollLeft = left
        }
        if (top !== undefined &amp;&amp; scrollerRef.value) {
            scrollerRef.value.scrollTop = top
        }
    },

    /** æ»šåŠ¨åˆ°æŒ‡å®šè¡Œ */
    scrollToRow: (rowIndex: number) =&gt; {
        if (scrollerRef.value) {
            scrollerRef.value.scrollTop = rowIndex * props.rowHeight
        }
    },

    /** å¼ºåˆ¶åˆ·æ–° */
    refresh: () =&gt; {
        markDirty('base', 'content', 'interaction')
        requestRender()
    }
})
&lt;/script&gt;

&lt;style scoped&gt;
.canvas-table-container {
    position: relative;
    overflow: hidden;
    background: #fff;
    border: 1px solid #ebeef5;
    border-radius: 4px;
}

/* Canvas å±‚çº§æ ·å¼ */
.layer-base,
.layer-content,
.layer-interaction {
    position: absolute;
    top: 0;
    left: 0;
    pointer-events: none;
}

.layer-base {
    z-index: 1;
}

.layer-content {
    z-index: 2;
}

.layer-interaction {
    z-index: 3;
}

/* æ»šåŠ¨å®¹å™¨ */
.scroll-container {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    overflow: auto;
    z-index: 4;
}

.scroll-phantom {
    pointer-events: none;
}

/* ç¼–è¾‘å™¨ */
.cell-editor {
    position: absolute;
    z-index: 10;
    padding: 0 8px;
    border: 2px solid #409eff;
    border-radius: 0;
    outline: none;
    font-size: 14px;
    font-family: inherit;
    box-sizing: border-box;
    background: #fff;
}
&lt;/style&gt;

</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å¾®å‰ç«¯æ¶æ„ä¸‹çš„ TypeScript ç±»å‹æ²»ç†å®è·µ]]></title>    <link>https://juejin.cn/post/7604786493639983131</link>    <guid>https://juejin.cn/post/7604786493639983131</guid>    <pubDate>2026-02-10T06:10:58.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604786493639983131" data-draft-id="7604761524977238025" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å¾®å‰ç«¯æ¶æ„ä¸‹çš„ TypeScript ç±»å‹æ²»ç†å®è·µ"/> <meta itemprop="keywords" content="å‰ç«¯,æ¶æ„"/> <meta itemprop="datePublished" content="2026-02-10T06:10:58.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å¤§è±¡çš„é¼»å­é‚£ä¹ˆé•¿"/> <meta itemprop="url" content="https://juejin.cn/user/2277843821926871"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å¾®å‰ç«¯æ¶æ„ä¸‹çš„ TypeScript ç±»å‹æ²»ç†å®è·µ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2277843821926871/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å¤§è±¡çš„é¼»å­é‚£ä¹ˆé•¿
  </span> <!----> <!----> <div class="vip-level" data-v-cd7d0a50="" data-v-292f6e48=""><span class="tooltip" data-v-cd7d0a50=""><div class="byte-tooltip byte-tooltip--dark" style="display:none;">
        VIP.4 èä¼šè´¯é€š
      </div><span class="byte-tooltip__wrapper"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8AQMAAAAAMksxAAAAA1BMVEUAAACnej3aAAAAAXRSTlMAQObYZgAAAA5JREFUKM9jGAWjAAcAAAIcAAE27nY6AAAAAElFTkSuQmCC" alt="VIP.4 èä¼šè´¯é€š" title="VIP.4 èä¼šè´¯é€š" class="lazy" style="aspect-ratio:NaN;" data-v-5244ef91="" data-v-cd7d0a50=""/></span></span></div> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T06:10:58.000Z" title="Tue Feb 10 2026 06:10:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p><strong>æ—¥æœŸ</strong>: 2026-02-10<br/>
<strong>æ ‡ç­¾</strong>: TypeScript, å¾®å‰ç«¯, æ¶æ„æ²»ç†, DX<br/>
<strong>é˜…è¯»æ—¶é—´</strong>: çº¦ 12 åˆ†é’Ÿ</p>
</blockquote>
<hr/>
<h2 data-id="heading-0">å†™åœ¨å‰é¢</h2>
<p>ä½ æœ‰æ²¡æœ‰é‡åˆ°è¿‡è¿™æ ·çš„åœºæ™¯ï¼š</p>
<ul>
<li>æ‰“å¼€ä¸€ä¸ª <code>.ts</code> æ–‡ä»¶ï¼ŒIDE ç–¯ç‹‚æŠ¥çº¢ <code>æ‰¾ä¸åˆ°åç§°"Recordable"</code>ï¼Œä½†æ„å»ºåˆèƒ½è¿‡ï¼Ÿ</li>
<li>åŒä¸€ä¸ª <code>PageParam</code> æ¥å£ï¼Œåœ¨ <code>shims-vue.d.ts</code>ã€<code>@cmclink/api</code>ã€<code>@cmclink/types</code> ä¸‰ä¸ªåœ°æ–¹å„å®šä¹‰äº†ä¸€éï¼Ÿ</li>
<li>æƒ³ç»™ä¸€ä¸ªç±»å‹åŠ ä¸ªå­—æ®µï¼Œä¸çŸ¥é“è¯¥æ”¹å“ªä¸ªæ–‡ä»¶ï¼Œæ”¹å®Œå‘ç°å¦ä¸€ä¸ªåœ°æ–¹è¿˜æ˜¯æ—§çš„ï¼Ÿ</li>
</ul>
<p>è¿™äº›éƒ½æ˜¯æˆ‘ä»¬ CMCLink ä¸»åº”ç”¨åœ¨ç±»å‹ç®¡ç†ä¸Šè¸©è¿‡çš„å‘ã€‚æœ¬æ–‡è®°å½•äº†ä¸€æ¬¡å®Œæ•´çš„ç±»å‹æ²»ç†è¿‡ç¨‹â€”â€”ä»æ··ä¹±åˆ°æœ‰åºï¼Œä» 10 ä¸ªæ•£è½çš„ç±»å‹æ–‡ä»¶åˆ° 3 ä¸ªèŒè´£æ¸…æ™°çš„æ–‡ä»¶ï¼Œä»¥åŠèƒŒåçš„è®¾è®¡æ€æƒ³ã€‚</p>
<hr/>
<h2 data-id="heading-1">ä¸€ã€æ²»ç†å‰ï¼šé—®é¢˜å…¨æ™¯</h2>
<h3 data-id="heading-2">1.1 types ç›®å½•çš„"åƒåœ¾æŠ½å±‰"</h3>
<p>æ²»ç†å‰ï¼Œ<code>apps/main/src/types/</code> ç›®å½•æœ‰ 10 ä¸ªæ–‡ä»¶ï¼Œæ‰¿æ‹…äº†è¿œè¶…å…¶èŒè´£çš„å·¥ä½œï¼š</p>
<pre><code class="hljs language-css" lang="css">types/
â”œâ”€â”€ auto-imports<span class="hljs-selector-class">.d</span><span class="hljs-selector-class">.ts</span>    â† è‡ªåŠ¨ç”Ÿæˆï¼Œæ²¡é—®é¢˜
â”œâ”€â”€ shims-vue<span class="hljs-selector-class">.d</span><span class="hljs-selector-class">.ts</span>       â† <span class="hljs-number">121</span> è¡Œï¼å¡äº† <span class="hljs-selector-class">.vue</span> å£°æ˜ + store ç±»å‹ + <span class="hljs-number">50</span> è¡Œå…¨å±€å·¥å…·ç±»å‹
â”œâ”€â”€ container<span class="hljs-selector-class">.d</span><span class="hljs-selector-class">.ts</span>       â† <span class="hljs-number">249</span> è¡Œç®±ç®¡ç±»å‹ï¼Œé›¶å¼•ç”¨ï¼ˆå±äºç®±ç®¡å­åº”ç”¨ï¼‰
â”œâ”€â”€ user<span class="hljs-selector-class">.ts</span>              â† ä»… store å’Œ <span class="hljs-number">1</span> ä¸ªç»„ä»¶ä½¿ç”¨
â”œâ”€â”€ <span class="hljs-attribute">flow</span><span class="hljs-selector-class">.ts</span>              â† ä»…é¦–é¡µä½¿ç”¨
â”œâ”€â”€ msg<span class="hljs-selector-class">.ts</span>               â† ä»…é¦–é¡µä½¿ç”¨
â”œâ”€â”€ marketing<span class="hljs-selector-class">.ts</span>         â† ä»…é¦–é¡µä½¿ç”¨
â”œâ”€â”€ <span class="hljs-selector-tag">form</span><span class="hljs-selector-class">.d</span><span class="hljs-selector-class">.ts</span>            â† <span class="hljs-selector-tag">Form</span> ç»„ä»¶ä¸“å±
â”œâ”€â”€ components<span class="hljs-selector-class">.d</span><span class="hljs-selector-class">.ts</span>      â† <span class="hljs-selector-tag">Form</span> ç»„ä»¶ä¸“å±
â””â”€â”€ tabs<span class="hljs-selector-class">.ts</span>              â† ä¸»åº”ç”¨è·¯ç”±/èœå•ç±»å‹
</code></pre>
<p><strong>æ ¸å¿ƒé—®é¢˜</strong>ï¼šæ²¡æœ‰åˆ†ç±»æ ‡å‡†ï¼Œä»€ä¹ˆç±»å‹éƒ½å¾€ <code>types/</code> é‡Œæ‰”ã€‚</p>
<h3 data-id="heading-3">1.2 å…¨å±€ç±»å‹çš„"ä¸‰é‡å½±åˆ†èº«"</h3>
<p><code>PageParam</code> è¿™ä¸ªæ¥å£ï¼ŒåŒæ—¶å­˜åœ¨äºï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 1ï¸âƒ£ shims-vue.d.tsï¼ˆå…¨å±€éšå¼å£°æ˜ï¼‰</span>
<span class="hljs-keyword">declare</span> <span class="hljs-variable language_">global</span> {
  <span class="hljs-keyword">interface</span> <span class="hljs-title class_">PageParam</span> { pageSize?: <span class="hljs-built_in">number</span>; pageNo?: <span class="hljs-built_in">number</span> }
}

<span class="hljs-comment">// 2ï¸âƒ£ @cmclink/api/types.tsï¼ˆå…¬å…±åŒ…æ˜¾å¼å¯¼å‡ºï¼‰</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">PageParam</span> { <span class="hljs-attr">pageNo</span>: <span class="hljs-built_in">number</span>; <span class="hljs-attr">pageSize</span>: <span class="hljs-built_in">number</span> }

<span class="hljs-comment">// 3ï¸âƒ£ @cmclink/types/global.d.tsï¼ˆå…¬å…±ç±»å‹åŒ…å…¨å±€å£°æ˜ï¼‰</span>
<span class="hljs-keyword">declare</span> <span class="hljs-variable language_">global</span> {
  <span class="hljs-keyword">interface</span> <span class="hljs-title class_">PageParam</span> { pageSize?: <span class="hljs-built_in">number</span>; pageNo?: <span class="hljs-built_in">number</span> }
}
</code></pre>
<p>ä¸‰ä»½å®šä¹‰ï¼Œå­—æ®µè¿˜æœ‰å¾®å¦™å·®å¼‚ï¼ˆ<code>pageNo</code> æ˜¯å¦å¯é€‰ï¼‰ã€‚æ”¹ä¸€å¤„ï¼Œå¦å¤–ä¸¤å¤„ä¸ä¼šåŒæ­¥ã€‚</p>
<h3 data-id="heading-4">1.3 å…¬å…±ç±»å‹åŒ…çš„"ç©ºåŸè®¡"</h3>
<p><code>@cmclink/types</code> åŒ…å·²ç»åˆ›å»ºå¥½äº†ï¼ŒREADME å†™å¾—å¾ˆæ¼‚äº®ï¼Œ9 ä¸ªæ¨¡å—æ–‡ä»¶ä¸€åº”ä¿±å…¨ã€‚ä½†æ˜¯ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æœç´¢æ•´ä¸ª monorepoï¼Œè°åœ¨ç”¨ @cmclink/typesï¼Ÿ</span>
$ grep -r <span class="hljs-string">"@cmclink/types"</span> --include=<span class="hljs-string">"*.ts"</span> --include=<span class="hljs-string">"*.vue"</span> .
<span class="hljs-comment"># ç»“æœï¼š0 æ¡</span>
</code></pre>
<p><strong>é›¶æ¶ˆè´¹è€…</strong>ã€‚åŒ…æ­å¥½äº†ï¼Œæ²¡äººæ¥å…¥ã€‚</p>
<hr/>
<h2 data-id="heading-5">äºŒã€è®¾è®¡æ€æƒ³</h2>
<h3 data-id="heading-6">2.1 ç±»å‹å½’å±ä¸‰é—®</h3>
<p>æ¯é‡åˆ°ä¸€ä¸ªç±»å‹å®šä¹‰ï¼Œé—®ä¸‰ä¸ªé—®é¢˜ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">Q1: å‡ ä¸ªå­åº”ç”¨åœ¨ç”¨ï¼Ÿ
    â”œâ”€â”€ â‰¥2 ä¸ª â†’ æ”¾å…¬å…±åŒ…
    â””â”€â”€ 1 ä¸ª  â†’ æ”¾å½“å‰åº”ç”¨

Q2: å®ƒè·Ÿä»€ä¹ˆç»‘å®šï¼Ÿ
    â”œâ”€â”€ API è¯·æ±‚ â†’ @cmclink/api
    â”œâ”€â”€ å·¥å…·å‡½æ•° â†’ @cmclink/utils
    â””â”€â”€ çº¯ç±»å‹   â†’ @cmclink/types

Q3: åœ¨åº”ç”¨å†…ï¼Œå®ƒå±äºè°ï¼Ÿ
    â”œâ”€â”€ ç»„ä»¶ä¸“å± â†’ å°±è¿‘æ”¾ç»„ä»¶ç›®å½•
    â”œâ”€â”€ Store ä¸“å± â†’ stores/types.ts
    â””â”€â”€ é¡µé¢ä¸“å± â†’ views/xxx/types.ts
</code></pre>
<p>è¿™ä¸‰ä¸ªé—®é¢˜å½¢æˆäº†ä¸€ä¸ª<strong>å†³ç­–æ ‘</strong>ï¼Œä»»ä½•ç±»å‹éƒ½èƒ½æ‰¾åˆ°å”¯ä¸€å½’å±ã€‚</p>
<h3 data-id="heading-7">2.2 æ˜¾å¼ä¼˜äºéšå¼</h3>
<p>å…¨å±€ç±»å‹ï¼ˆ<code>declare global</code>ï¼‰çš„æœ€å¤§é—®é¢˜æ˜¯<strong>æ¥æºä¸å¯è¿½æº¯</strong>ã€‚å½“ä½ åœ¨ä»£ç é‡Œå†™ <code>params: PageParam</code>ï¼ŒIDE å’Œä»£ç å®¡æŸ¥è€…éƒ½ä¸çŸ¥é“è¿™ä¸ª <code>PageParam</code> ä»å“ªæ¥ã€‚</p>
<p>æˆ‘ä»¬çš„åŸåˆ™ï¼š</p>




















<table><thead><tr><th>ç±»å‹ç§ç±»</th><th>ç­–ç•¥</th><th>ç†ç”±</th></tr></thead><tbody><tr><td>å·¥å…·ç±»å‹ï¼ˆ<code>Recordable</code>/<code>Nullable</code>ï¼‰</td><td>å…¨å±€å£°æ˜ âœ…</td><td>é«˜é¢‘ä½¿ç”¨ï¼Œç±»ä¼¼ <code>Promise</code>/<code>Record</code>ï¼Œæ˜¾å¼å¯¼å…¥åè€Œå¢åŠ å™ªéŸ³</td></tr><tr><td>ä¸šåŠ¡ç±»å‹ï¼ˆ<code>PageParam</code>/<code>TokenType</code>ï¼‰</td><td>æ˜¾å¼å¯¼å…¥ âœ…</td><td>æ¥æºå¯è¿½æº¯ï¼ŒIDE è·³è½¬å¯ç”¨ï¼Œé‡æ„å®‰å…¨</td></tr></tbody></table>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// âœ… å·¥å…·ç±»å‹ï¼šå…¨å±€ä½¿ç”¨ï¼Œæ— éœ€å¯¼å…¥</span>
<span class="hljs-keyword">const</span> <span class="hljs-attr">data</span>: <span class="hljs-title class_">Recordable</span> = {}
<span class="hljs-keyword">const</span> <span class="hljs-attr">el</span>: <span class="hljs-title class_">Nullable</span>&lt;<span class="hljs-title class_">HTMLElement</span>&gt; = <span class="hljs-literal">null</span>

<span class="hljs-comment">// âœ… ä¸šåŠ¡ç±»å‹ï¼šæ˜¾å¼å¯¼å…¥ï¼Œæ¥æºæ¸…æ™°</span>
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">PageParam</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@cmclink/api'</span>
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">FormSchema</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@cmclink/types/form'</span>
</code></pre>
<h3 data-id="heading-8">2.3 å°±è¿‘åŸåˆ™</h3>
<p>ç±»å‹åº”è¯¥ç¦»ä½¿ç”¨å®ƒçš„ä»£ç å°½å¯èƒ½è¿‘ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">âŒ è¿œè·ç¦»ï¼štypes/flow.ts â†’ views/home/index.vueï¼ˆè·¨ 3 å±‚ç›®å½•ï¼‰
âœ… å°±è¿‘åŒ–ï¼šviews/home/types.ts â†’ views/home/index.vueï¼ˆåŒç›®å½•ï¼‰
</code></pre>
<p>å¥½å¤„ï¼š</p>
<ul>
<li><strong>åˆ é™¤é¡µé¢æ—¶ç±»å‹è·Ÿç€åˆ </strong>ï¼Œä¸ä¼šç•™ä¸‹å­¤å„¿æ–‡ä»¶</li>
<li><strong>ä»£ç å®¡æŸ¥æ—¶ä¸€ç›®äº†ç„¶</strong>ï¼Œä¸ç”¨è·³æ¥è·³å»</li>
<li><strong>IDE è‡ªåŠ¨è¡¥å…¨æ›´ç²¾å‡†</strong>ï¼Œå› ä¸ºä½œç”¨åŸŸæ›´å°</li>
</ul>
<h3 data-id="heading-9">2.4 å•ä¸€æ¥æºï¼ˆSingle Source of Truthï¼‰</h3>
<p>æ¯ä¸ªç±»å‹åªåœ¨ä¸€ä¸ªåœ°æ–¹å®šä¹‰ï¼Œå…¶ä»–åœ°æ–¹ re-exportï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// ğŸ“ å”¯ä¸€å®šä¹‰ï¼špackages/types/src/form.ts</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> <span class="hljs-title class_">FormSchema</span> = { ... }

<span class="hljs-comment">// ğŸ“ re-exportï¼šapps/main/src/components/Form/src/types.ts</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">FormSchema</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@cmclink/types/form'</span>
</code></pre>
<p>ä¿®æ”¹æ—¶åªæ”¹ä¸€å¤„ï¼Œæ‰€æœ‰æ¶ˆè´¹è€…è‡ªåŠ¨åŒæ­¥ã€‚</p>
<hr/>
<h2 data-id="heading-10">ä¸‰ã€å®æ–½è¿‡ç¨‹</h2>
<h3 data-id="heading-11">3.1 Phase 0ï¼štypes ç›®å½•æ¸…ç†</h3>






























<table><thead><tr><th>æ“ä½œ</th><th>æ–‡ä»¶</th><th>æ•ˆæœ</th></tr></thead><tbody><tr><td>åˆ é™¤</td><td><code>container.d.ts</code> (249 è¡Œ)</td><td>é›¶å¼•ç”¨çš„ç®±ç®¡ç±»å‹ï¼Œä¸å±äºä¸»åº”ç”¨</td></tr><tr><td>åˆå¹¶</td><td><code>user.ts</code> â†’ <code>stores/types.ts</code></td><td><code>UserRoleType</code> ä»… store å’Œ 1 ä¸ªç»„ä»¶ä½¿ç”¨</td></tr><tr><td>å°±è¿‘åŒ–</td><td><code>flow.ts</code>/<code>msg.ts</code>/<code>marketing.ts</code> â†’ <code>views/home/types.ts</code></td><td>é¦–é¡µä¸“å± UI ç±»å‹</td></tr><tr><td>åˆå¹¶</td><td><code>form.d.ts</code> + <code>components.d.ts</code> â†’ <code>components/Form/src/types.ts</code></td><td>Form ç»„ä»¶ä¸“å±</td></tr></tbody></table>
<p><strong>ç»“æœ</strong>ï¼š10 ä¸ªæ–‡ä»¶ â†’ 3 ä¸ªæ–‡ä»¶ï¼Œåˆ é™¤ 406 è¡Œã€‚</p>
<h3 data-id="heading-12">3.2 Phase 1 (P0)ï¼šæ¥å…¥ @cmclink/types</h3>
<pre><code class="hljs language-jsonc" lang="jsonc">// tsconfig.app.json â€” å¼•å…¥å…¬å…±å…¨å±€ç±»å‹
{
  "include": [
    "src/**/*",
    "../../packages/types/src/global.d.ts",   // æ–°å¢
    "../../packages/types/src/env.d.ts",       // æ–°å¢
    "../../packages/types/src/router.d.ts"     // æ–°å¢
  ]
}
</code></pre>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// shims-vue.d.ts â€” ä» 121 è¡Œç˜¦èº«åˆ° 18 è¡Œ</span>
<span class="hljs-comment">// åˆ é™¤æ•´ä¸ª declare global å—ï¼Œå…¨å±€ç±»å‹ç”± @cmclink/types ç»Ÿä¸€æä¾›</span>
<span class="hljs-keyword">declare</span> <span class="hljs-variable language_">module</span> <span class="hljs-string">"*.vue"</span> {
  <span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">DefineComponent</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"vue"</span>;
  <span class="hljs-keyword">const</span> <span class="hljs-attr">component</span>: <span class="hljs-title class_">DefineComponent</span>&lt;<span class="hljs-built_in">object</span>, <span class="hljs-built_in">object</span>, <span class="hljs-built_in">unknown</span>&gt;;
  <span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> component;
}
</code></pre>
<h3 data-id="heading-13">3.3 Phase 2 (P1)ï¼šæ¶ˆé™¤éšå¼ä¾èµ–</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// âŒ æ²»ç†å‰ï¼šPageParam ä»å¤©ä¸Šæ‰ä¸‹æ¥</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">getMessageLists</span> = (<span class="hljs-params">params: PageParam</span>) =&gt; { ... }

<span class="hljs-comment">// âœ… æ²»ç†åï¼šæ¥æºæ¸…æ™°</span>
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">PageParam</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@cmclink/api'</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">getMessageLists</span> = (<span class="hljs-params">params: PageParam</span>) =&gt; { ... }
</code></pre>
<h3 data-id="heading-14">3.4 Phase 3 (P2)ï¼šå…¬å…±åŒ…å‡çº§ + API ç±»å‹è§„èŒƒåŒ–</h3>
<p><strong>Form ç±»å‹</strong>ï¼šå°† <code>@cmclink/types/form</code> ä»ç²¾ç®€ç‰ˆï¼ˆ75 è¡Œï¼‰å‡çº§ä¸ºå®Œæ•´ç‰ˆï¼ˆ169 è¡Œï¼‰ï¼Œä¸»åº”ç”¨æ”¹ä¸º re-exportï¼ˆ152 è¡Œ â†’ 21 è¡Œï¼‰ã€‚</p>
<p><strong>Profile ç±»å‹</strong>ï¼š6 ä¸ªå†…è” interface ä» API æ–‡ä»¶æå–åˆ°åŒç›®å½• <code>types.ts</code>ï¼ŒAPI æ–‡ä»¶åªä¿ç•™è¯·æ±‚é€»è¾‘ã€‚</p>
<hr/>
<h2 data-id="heading-15">å››ã€æ”¶ç›Šåˆ†æ</h2>
<h3 data-id="heading-16">4.1 å¯é‡åŒ–æ”¶ç›Š</h3>



























































<table><thead><tr><th>æŒ‡æ ‡</th><th>æ²»ç†å‰</th><th>æ²»ç†å</th><th>å˜åŒ–</th></tr></thead><tbody><tr><td><code>types/</code> æ–‡ä»¶æ•°</td><td>10</td><td>3</td><td><strong>-70%</strong></td></tr><tr><td><code>types/</code> æ€»è¡Œæ•°</td><td>~630</td><td>~120</td><td><strong>-81%</strong></td></tr><tr><td><code>shims-vue.d.ts</code> è¡Œæ•°</td><td>121</td><td>18</td><td><strong>-85%</strong></td></tr><tr><td>é‡å¤ç±»å‹å®šä¹‰</td><td>3 å¤„ï¼ˆPageParam ç­‰ï¼‰</td><td>0</td><td><strong>-100%</strong></td></tr><tr><td>æ­»æ–‡ä»¶/é›¶å¼•ç”¨</td><td>1 ä¸ªï¼ˆcontainer.d.ts 249 è¡Œï¼‰</td><td>0</td><td><strong>-100%</strong></td></tr><tr><td><code>@cmclink/types</code> æ¶ˆè´¹è€…</td><td>0</td><td>1ï¼ˆä¸»åº”ç”¨ï¼‰</td><td>ä»é›¶åˆ°ä¸€</td></tr><tr><td>Form types.ts è¡Œæ•°</td><td>152ï¼ˆæœ¬åœ°å®šä¹‰ï¼‰</td><td>21ï¼ˆre-exportï¼‰</td><td><strong>-86%</strong></td></tr><tr><td>profile.ts è¡Œæ•°</td><td>84ï¼ˆæ··åˆï¼‰</td><td>34ï¼ˆçº¯è¯·æ±‚ï¼‰</td><td><strong>-60%</strong></td></tr></tbody></table>
<h3 data-id="heading-17">4.2 ä¸å¯é‡åŒ–æ”¶ç›Š</h3>
<ul>
<li><strong>IDE ä½“éªŒæå‡</strong>ï¼šå…¨å±€ç±»å‹ç”± tsconfig include ç»Ÿä¸€æä¾›ï¼Œ<code>Recordable</code>/<code>ComponentRef</code> ç­‰ä¸å†æ—¶æœ‰æ—¶æ— åœ°æŠ¥çº¢</li>
<li><strong>é‡æ„å®‰å…¨æ€§</strong>ï¼šç±»å‹å•ä¸€æ¥æºï¼Œæ”¹ä¸€å¤„å…¨å±€ç”Ÿæ•ˆï¼Œä¸ä¼šå‡ºç°"æ”¹äº† A å¿˜äº† B"</li>
<li><strong>æ–°äººä¸Šæ‰‹æˆæœ¬é™ä½</strong>ï¼šç±»å‹å½’å±æœ‰æ˜ç¡®è§„åˆ™ï¼Œä¸ç”¨çŒœ"è¿™ä¸ªç±»å‹è¯¥æ”¾å“ª"</li>
<li><strong>ä»£ç å®¡æŸ¥æ•ˆç‡</strong>ï¼šAPI æ–‡ä»¶åªæœ‰è¯·æ±‚é€»è¾‘ï¼Œç±»å‹å®šä¹‰åœ¨ç‹¬ç«‹æ–‡ä»¶ï¼ŒèŒè´£åˆ†ç¦»</li>
<li><strong>è·¨å­åº”ç”¨ä¸€è‡´æ€§</strong>ï¼šå…¶ä»–å­åº”ç”¨æ¥å…¥ <code>@cmclink/types</code> åªéœ€ 3 æ­¥ï¼Œç±»å‹å®šä¹‰å¤©ç„¶ç»Ÿä¸€</li>
</ul>
<h3 data-id="heading-18">4.3 ä¸ºåç»­å­åº”ç”¨é“ºè·¯</h3>
<p>ç°åœ¨ä»»ä½•æ–°å­åº”ç”¨æ¥å…¥å…¬å…±ç±»å‹åªéœ€ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># Step 1: æ·»åŠ ä¾èµ–</span>
pnpm add -D @cmclink/types

<span class="hljs-comment"># Step 2: tsconfig include å…¨å±€ç±»å‹ï¼ˆå¤åˆ¶ 3 è¡Œï¼‰</span>

<span class="hljs-comment"># Step 3: åˆ é™¤æœ¬åœ°é‡å¤å£°æ˜ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰</span>
</code></pre>
<hr/>
<h2 data-id="heading-19">äº”ã€æˆæœ¬åˆ†æ</h2>
<h3 data-id="heading-20">5.1 ä¸€æ¬¡æ€§æˆæœ¬</h3>








































<table><thead><tr><th>é¡¹ç›®</th><th>è€—æ—¶</th><th>é£é™©</th></tr></thead><tbody><tr><td>types ç›®å½•æ¸…ç† + å°±è¿‘åŒ–</td><td>~30 min</td><td>ä½ï¼ˆçº¯é‡æ„ï¼Œä¸æ”¹é€»è¾‘ï¼‰</td></tr><tr><td>æ¥å…¥ @cmclink/types + åˆ é™¤é‡å¤å£°æ˜</td><td>~10 min</td><td>ä½ï¼ˆtsconfig + åˆ ä»£ç ï¼‰</td></tr><tr><td>æ¶ˆé™¤éšå¼å…¨å±€ç±»å‹</td><td>~15 min</td><td>ä½ï¼ˆæ·»åŠ  import è¯­å¥ï¼‰</td></tr><tr><td>Form ç±»å‹å‡çº§ + re-export</td><td>~30 min</td><td>ä¸­ï¼ˆå…¬å…±åŒ…å˜æ›´ï¼Œéœ€éªŒè¯ï¼‰</td></tr><tr><td>Profile ç±»å‹æå–</td><td>~15 min</td><td>ä½ï¼ˆçº¯æå–ï¼Œä¸æ”¹é€»è¾‘ï¼‰</td></tr><tr><td><strong>åˆè®¡</strong></td><td><strong>~100 min</strong></td><td>â€”</td></tr></tbody></table>
<h3 data-id="heading-21">5.2 æŒç»­æˆæœ¬</h3>

























<table><thead><tr><th>é¡¹ç›®</th><th>æˆæœ¬</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>æ–°å¢ç±»å‹æ—¶çš„å†³ç­–</td><td>æä½</td><td>æŒ‰å†³ç­–æ ‘èµ°ï¼Œ30 ç§’å†…ç¡®å®šå½’å±</td></tr><tr><td>å…¬å…±åŒ…ç±»å‹å˜æ›´</td><td>ä½</td><td>æ”¹ä¸€å¤„ï¼Œæ‰€æœ‰æ¶ˆè´¹è€…è‡ªåŠ¨åŒæ­¥</td></tr><tr><td>ä»£ç å®¡æŸ¥</td><td>é™ä½</td><td>ç±»å‹å’Œé€»è¾‘åˆ†ç¦»ï¼Œå®¡æŸ¥æ›´èšç„¦</td></tr></tbody></table>
<h3 data-id="heading-22">5.3 é£é™©ä¸ç¼“è§£</h3>





















<table><thead><tr><th>é£é™©</th><th>ç¼“è§£æªæ–½</th></tr></thead><tbody><tr><td>å…¬å…±åŒ…æ”¹ç±»å‹å½±å“å¤šä¸ªå­åº”ç”¨</td><td>å…¬å…±åŒ…ç±»å‹å˜æ›´éœ€ CR å®¡æ‰¹ + å…¨é‡æ„å»ºéªŒè¯</td></tr><tr><td>IDE å…¨å±€ç±»å‹å¶å°”ä¸è¯†åˆ«</td><td>tsconfig include è·¯å¾„æ˜ç¡®ï¼Œé‡å¯ TS Server å³å¯</td></tr><tr><td>å›¢é˜Ÿæˆå‘˜ä¸çŸ¥é“æ–°è§„èŒƒ</td><td>æœ¬æ–‡ + <code>å…¬å…±TSç±»å‹ç®¡ç†æ–¹æ¡ˆ.md</code> + ä»£ç å®¡æŸ¥æŠŠå…³</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-23">å…­ã€è§„èŒƒé€ŸæŸ¥å¡</h2>
<p>è´´åœ¨å·¥ä½ä¸Šï¼ˆæˆ–è€… bookmark è¿™ç¯‡æ–‡ç« ï¼‰ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           ç±»å‹æ”¾å“ªé‡Œï¼Ÿé€ŸæŸ¥è¡¨                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                              â”‚
â”‚  â‰¥2 ä¸ªå­åº”ç”¨ç”¨ï¼Ÿ                              â”‚
â”‚    â”œâ”€â”€ è·Ÿ API ç»‘å®š â†’ @cmclink/api            â”‚
â”‚    â”œâ”€â”€ è·Ÿå·¥å…·å‡½æ•°ç»‘å®š â†’ @cmclink/utils        â”‚
â”‚    â””â”€â”€ çº¯ç±»å‹ â†’ @cmclink/types               â”‚
â”‚                                              â”‚
â”‚  ä»… 1 ä¸ªå­åº”ç”¨ç”¨ï¼Ÿ                            â”‚
â”‚    â”œâ”€â”€ ç»„ä»¶ä¸“å± â†’ ç»„ä»¶ç›®å½•/types.ts           â”‚
â”‚    â”œâ”€â”€ Store ä¸“å± â†’ stores/types.ts          â”‚
â”‚    â”œâ”€â”€ é¡µé¢ä¸“å± â†’ views/xxx/types.ts         â”‚
â”‚    â””â”€â”€ API ä¸“å± â†’ api/xxx/types.ts           â”‚
â”‚                                              â”‚
â”‚  å…¨å±€å·¥å…·ç±»å‹ï¼ˆRecordable ç­‰ï¼‰ï¼Ÿ               â”‚
â”‚    â†’ @cmclink/types/global.d.ts              â”‚
â”‚    â†’ tsconfig include å¼•å…¥ï¼Œæ— éœ€ import       â”‚
â”‚                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  âŒ ç¦æ­¢ï¼š                                    â”‚
â”‚  â€¢ shims-vue.d.ts é‡ŒåŠ ä¸šåŠ¡ç±»å‹               â”‚
â”‚  â€¢ API æ–‡ä»¶é‡Œå†…è” interface                  â”‚
â”‚  â€¢ è·¨å­åº”ç”¨ç›´æ¥ import ç±»å‹                   â”‚
â”‚  â€¢ @cmclink/types é‡Œå¼•å…¥è¿è¡Œæ—¶ä¾èµ–            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<hr/>
<h2 data-id="heading-24">ä¸ƒã€æ€»ç»“</h2>
<p>è¿™æ¬¡ç±»å‹æ²»ç†çš„æœ¬è´¨æ˜¯<strong>å»ºç«‹ç§©åº</strong>ã€‚ä»£ç åº“åƒä¸€åº§åŸå¸‚ï¼Œç±»å‹å®šä¹‰æ˜¯åŸå¸‚çš„åœ°å€ç³»ç»Ÿã€‚å½“åœ°å€ç³»ç»Ÿæ··ä¹±æ—¶ï¼Œæ¯ä¸ªäººéƒ½åœ¨èŠ±æ—¶é—´æ‰¾è·¯ï¼›å½“åœ°å€ç³»ç»Ÿæ¸…æ™°æ—¶ï¼Œæ‰€æœ‰äººéƒ½èƒ½å¿«é€Ÿåˆ°è¾¾ç›®çš„åœ°ã€‚</p>
<p>ä¸‰ä¸ªæ ¸å¿ƒåŸåˆ™ï¼š</p>
<ol>
<li><strong>å•ä¸€æ¥æº</strong> â€” æ¯ä¸ªç±»å‹åªå®šä¹‰ä¸€æ¬¡</li>
<li><strong>æ˜¾å¼ä¼˜äºéšå¼</strong> â€” ä¸šåŠ¡ç±»å‹å¿…é¡» importï¼Œæ¥æºå¯è¿½æº¯</li>
<li><strong>å°±è¿‘åŸåˆ™</strong> â€” ç±»å‹ç¦»ä½¿ç”¨å®ƒçš„ä»£ç è¶Šè¿‘è¶Šå¥½</li>
</ol>
<p>100 åˆ†é’Ÿçš„æŠ•å…¥ï¼Œæ¢æ¥çš„æ˜¯æ•´ä¸ªå›¢é˜Ÿåœ¨ç±»å‹ç®¡ç†ä¸Šçš„é•¿æœŸæ•ˆç‡æå‡ã€‚å€¼å¾—ã€‚</p>
<hr/>
<p><em>å¦‚æœ‰ç–‘é—®ï¼Œæ¬¢è¿åœ¨ Code Review ä¸­è®¨è®ºï¼Œæˆ–ç›´æ¥æ‰¾æˆ‘èŠã€‚</em></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æ€ä¹ˆä½¿ç”¨Vueæ¸è¿›å¼åœ°å¢å¼ºåŸç”Ÿhtmlé¡¹ç›®]]></title>    <link>https://juejin.cn/post/7604779604125581312</link>    <guid>https://juejin.cn/post/7604779604125581312</guid>    <pubDate>2026-02-10T06:32:33.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604779604125581312" data-draft-id="7604741630449467426" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æ€ä¹ˆä½¿ç”¨Vueæ¸è¿›å¼åœ°å¢å¼ºåŸç”Ÿhtmlé¡¹ç›®"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2026-02-10T06:32:33.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="è¶…ç»å¤§å¸…å“¥"/> <meta itemprop="url" content="https://juejin.cn/user/1074701161733898"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æ€ä¹ˆä½¿ç”¨Vueæ¸è¿›å¼åœ°å¢å¼ºåŸç”Ÿhtmlé¡¹ç›®
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1074701161733898/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    è¶…ç»å¤§å¸…å“¥
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T06:32:33.000Z" title="Tue Feb 10 2026 06:32:33 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    14
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»11åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">SFC</h2>
<p>æˆ‘ä»¬å¦‚æœæ˜¯æ‰“ç®—ä½¿ç”¨vueå®Œæ•´çš„å†™å®Œæ•´ä¸ªé¡¹ç›®ï¼Œ å°±å¾ˆé€‚åˆä½¿ç”¨å•æ–‡ä»¶ç»„ä»¶ï¼Œä¹Ÿå°±æ˜¯<code>.vue</code>æ–‡ä»¶, å®ƒçš„è‹±æ–‡åå­—æ˜¯<code>Single-File Components</code>,å°±æ˜¯SFCçš„ç¼©å†™,ä¹Ÿå°±æ˜¯ä¸€ä¸ªæ–‡ä»¶ä»£è¡¨ç€ä¸€ä¸ªç»„ä»¶ï¼Œæˆ‘ä»¬æŠŠç»„ä»¶çš„æ¨¡æ¿ï¼Œæ ·å¼ï¼Œé€»è¾‘éƒ½å†™åœ¨è¿™ä¸€ä¸ªæ–‡ä»¶å†…,åœ¨ä½¿ç”¨viteè¿™æ ·çš„æ„å»ºå·¥å…·çš„æ—¶å€™ï¼Œå½“ä¸‹è½½å®Œæ‰€æœ‰ä¾èµ–åï¼Œå¯ä»¥åœ¨æˆ‘ä»¬çš„<code>node_module</code>é‡Œçœ‹åˆ°ä¸‹è½½çš„vueï¼Œæœ‰å‡ ä¸ªä¾èµ–æ’ä»¶, å…¶ä¸­ä¸€ä¸ªåä¸º<code>@vue/compiler-sfc</code>,è¿™ä¸ªå°±æ˜¯ç”¨äºè§£ææˆ‘ä»¬çš„å•æ–‡ä»¶ç»„ä»¶çš„ï¼Œå…¶ä¸­è¿˜åŒ…å«ä¸€ä¸ªåä¸º<code>@vue/compiler-dom</code>çš„ä¾èµ–åº“,ä¸‹é¢è§£é‡Šè¿™ä¸ªåº“çš„ä½œç”¨</p>
<h2 data-id="heading-1">CDNä½¿ç”¨vue</h2>
<p>CDNå¼•å…¥çš„vueçš„jsæ–‡ä»¶éƒ½éœ€è¦èƒ½å¤Ÿè§£æhtmlæ–‡ä»¶ä¸­å“ªäº›åŒ…å«vueçš„è¯­æ³•éƒ¨åˆ†å¹¶ä¸”æ›¿æ¢æ‰ä»–ä»¬ï¼Œä¸Šè¿°çš„<code>@vue/compiler-dom</code>å°±æ˜¯ç”¨æ¥å¹²è¿™ä¸ªçš„ï¼Œä½†æ˜¯CDNçš„jsæ–‡ä»¶åŒ…å«ç¼–è¯‘å™¨, è€Œç»è¿‡Viteè¿™ç§æ¶æ„å·¥å…·æ‰“åŒ…åå®Œå…¨å¯ä»¥å»æ‰ç¼–è¯‘å™¨,åªç•™è¿è¡Œæ—¶vueæ–‡ä»¶å°±å¯ä»¥äº†</p>
<h2 data-id="heading-2">é€‰é¡¹å¼API</h2>
<p>vueæä¾›ä¸€ç§åŸºäºç»„åˆå¼Apiä¹‹ä¸Šçš„é€‰é¡¹å¼api,ä½¿ç”¨è¦æ¯”ç»„åˆå¼å†™æ³•ç®€å•å¾ˆå¤šï¼Œä¹Ÿæ›´é€‚åˆä¹ æƒ¯é¢å‘å¯¹è±¡ç¼–ç¨‹çš„ä½¿ç”¨è€…,è¯·çœ‹ä¸‹é¢çš„ä¾‹å­</p>
<pre><code class="hljs language-html" lang="html">//è¿™é‡Œå°†htmlçš„éƒ¨åˆ†å‡å»ä¸€äº›ï¼Œé¿å…ä¸€äº›æ— å…³ç´§è¦çš„å†…å®¹
//æ ·å¼éƒ¨åˆ†å¦‚ä¸‹
<span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
    <span class="hljs-selector-class">.counter</span> {
        <span class="hljs-attribute">display</span>: flex;
        <span class="hljs-attribute">align-items</span>: center;
        <span class="hljs-attribute">justify-content</span>: center;
        <span class="hljs-attribute">column-gap</span>: <span class="hljs-number">15px</span>;
        <span class="hljs-attribute">width</span>: <span class="hljs-number">120px</span>;
        <span class="hljs-attribute">margin</span>: <span class="hljs-number">100px</span>;
        <span class="hljs-attribute">padding</span>: <span class="hljs-number">10px</span>;
        <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">8px</span>;
        <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#f5f5f5</span>;
        user-select: none;
        <span class="hljs-attribute">cursor</span>: pointer;
    }
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"app"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"counter"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">span</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"decrement"</span>&gt;</span>-<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>{{count}}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">span</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"increment"</span>&gt;</span>+<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://unpkg.com/vue@3/dist/vue.global.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"./index.js"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"module"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
</code></pre>
<p>ä¸‹é¢æ˜¯index.jsæ–‡ä»¶</p>
<pre><code class="hljs language-javascript" lang="javascript">
<span class="hljs-keyword">const</span> <span class="hljs-title class_">App</span> = {
  <span class="hljs-title function_">data</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">count</span>: <span class="hljs-number">0</span>
    }
  },
  <span class="hljs-attr">methods</span>: {
    <span class="hljs-title function_">increment</span>(<span class="hljs-params"/>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span>++;
    },
    <span class="hljs-title function_">decrement</span>(<span class="hljs-params"/>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span>--;
    }
  },
  <span class="hljs-title function_">mounted</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"æŒ‚è½½"</span>);
  }
};

<span class="hljs-keyword">const</span> app = <span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">createApp</span>(<span class="hljs-title class_">App</span>);

app.<span class="hljs-title function_">mount</span>(<span class="hljs-string">"#app"</span>);
<span class="hljs-comment">//createAppä¼ å…¥çš„æ ¹ç»„ä»¶ï¼Œè¦æ˜¯è¿™ä¸ªç»„ä»¶æ²¡æœ‰è‡ªå·±çš„templateéƒ¨åˆ†ï¼Œå°±ä¼šæŠŠè·Ÿå®¹å™¨(åœ¨è¿™é‡Œæ˜¯#app)çš„`innerHTML`ä½œä¸ºå®ƒçš„æ¨¡æ¿,ä¹Ÿå¯ä»¥å†™æˆä¸‹é¢è¿™æ ·</span>

<span class="hljs-keyword">const</span> <span class="hljs-title class_">App</span> = {
  <span class="hljs-title function_">data</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">count</span>: <span class="hljs-number">0</span>
    }
  },
  <span class="hljs-attr">template</span>: <span class="hljs-string">`&lt;div class="counter"&gt;
      &lt;span @click="decrement"&gt;-&lt;/span&gt;
      &lt;p&gt;{{count}}&lt;/p&gt;
      &lt;span @click="increment"&gt;+&lt;/span&gt;
    &lt;/div&gt;`</span>,
  <span class="hljs-attr">methods</span>: {
    <span class="hljs-title function_">increment</span>(<span class="hljs-params"/>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span>++;
    },
    <span class="hljs-title function_">decrement</span>(<span class="hljs-params"/>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span>--;
    }
  },
  <span class="hljs-title function_">mounted</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"æŒ‚è½½"</span>);
  }
};

<span class="hljs-keyword">const</span> app = <span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">createApp</span>(<span class="hljs-title class_">App</span>);

<span class="hljs-keyword">const</span> rootComponents = app.<span class="hljs-title function_">mount</span>(<span class="hljs-string">"#app"</span>);

<span class="hljs-keyword">const</span> app = <span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">createApp</span>(<span class="hljs-title class_">App</span>);

app.<span class="hljs-title function_">mount</span>(<span class="hljs-string">"#app"</span>);
</code></pre>

<h2 data-id="heading-3">renderå’Œtemplate</h2>
<h3 data-id="heading-4">render</h3>
<p>åƒä¸Šè¿°ä»£ç ä¸­ï¼Œæˆ‘ä»¬æ˜¯åœ¨domä¸­å†…åµŒäº†vueè¯­æ³•ï¼Œé‚£ä¹ˆå°±ä¸€å®šè¦ç»è¿‡ç¼–è¯‘çš„é˜¶æ®µäº†, æˆ‘ä»¬å¯ä»¥å®šä¹‰renderå‡½æ•°ï¼Œç›´æ¥å†™renderå‡½æ•°å¯ä»¥ä¸ç»è¿‡ç¼–è¯‘ç›´æ¥è¿è¡Œï¼Œåœ¨æè¿°è¿™ç‚¹å‰ï¼Œæˆ‘ä»¬å…ˆä»‹ç»ä¸€ä¸‹<code>render</code>ï¼Œ æŒ‰vueå®˜æ–¹æ–‡æ¡£æ¥è¯´,<code>renderæ˜¯å­—ç¬¦ä¸²æ¨¡æ¿çš„ä¸€ç§æ›¿ä»£ï¼Œå¯ä»¥è®©ä½ åˆ©ç”¨JavaScriptçš„ä¸°å¯Œè¡¨è¾¾åŠ›æ¥å®Œå…¨ç¼–ç¨‹å¼åœ°å£°æ˜ç»„ä»¶æœ€ç»ˆçš„æ¸²æŸ“è¾“å‡º, é¢„ç¼–è¯‘çš„æ¨¡æ¿å¦‚æœå•æ–‡ä»¶ç»„ä»¶ä¸­çš„æ¨¡æ¿ï¼Œä¼šåœ¨æ„å»ºæ—¶è¢«ç¼–è¯‘ä¸ºrenderé€‰é¡¹,å¦‚æœä¸€ä¸ªç»„ä»¶ä¸­åŒæ—¶å­˜åœ¨renderå’Œtemplate,åˆ™renderå°†å…·æœ‰æ›´é«˜çš„ä¼˜å…ˆçº§</code>,</p>
<p>æˆ‘ä»¬å¯ä»¥çœ‹ï¼Œå¦‚æœæ˜¯è®©vueå®æ—¶çš„ç¼–è¯‘å†…åµŒvueè¯­æ³•çš„dom,ä¼šè¢«ç¼–è¯‘æˆä»€ä¹ˆæ ·å­,</p>
<p><img alt="" src="" loading="lazy"/></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œå½“ä½ åœ¨domåµŒå…¥vueè¯­æ³•çš„æ—¶å€™,æ²¡æœ‰ç”Ÿæˆrenderå‡½æ•°ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦ä½ å¼•å…¥çš„cdnçš„vueç‰ˆæœ¬ä¸­åŒ…å«ç¼–è¯‘å™¨,å¦‚æœæ˜¯ç¼–è¯‘çš„SFCæ¨¡æ¿ç»“æœæ˜¯ä»€ä¹ˆæ ·çš„?</p>
<p><img alt="" src="" loading="lazy"/></p>
<p>å¯ä»¥çœ‹åˆ°ç”Ÿæˆäº†renderå‡½æ•°ï¼Œè¿™ä¸ªrenderå‡½æ•°æ˜¯å¯ä»¥ç›´æ¥è¢«è¿è¡Œæ—¶çš„vueåŒ…æ‰§è¡Œçš„ï¼Œä¸éœ€è¦åŠ å…¥ç¼–è¯‘å™¨,æ‰€ä»¥å¯ä»¥çœ‹åˆ°æœ‰æ²¡æœ‰renderæ˜¯ä¸¤å›äº‹ï¼Œæœ‰renderå°±ç›´æ¥ä½¿ç”¨render,æ²¡æœ‰renderï¼Œé‚£ä¹ˆå°±ä¼šè¯»å–templateå­—ç¬¦ä¸²ï¼Œ è¿™ä¸ªæ—¶å€™å°±éœ€è¦ç¼–è¯‘å™¨äº† , æˆ‘ä»¬åœ¨è¿™é‡Œå°è¯•æŠŠä¸Šé¢åœ¨é€‰é¡¹å¼APIéƒ¨åˆ†é‡Œå†™çš„ä¾‹å­ç”¨renderå‡½æ•°å†™ä¸€é, <code>vue</code>ç»™æˆ‘ä»¬æä¾›äº†ä¸€ä¸ªåä¸ºhå‡½æ•°çš„api,ä¸“é—¨ç”¨äºç»™å¼€å‘è€…æ‰‹åŠ¨çš„ç¼–å†™renderå‡½æ•°ï¼Œå…·ä½“å¯ä»¥çœ‹ [hå‡½æ•°](<a href="https://link.juejin.cn?target=https%3A%2F%2Fcn.vuejs.org%2Fapi%2Foptions-rendering.html%23render" target="_blank" title="https://cn.vuejs.org/api/options-rendering.html#render" ref="nofollow noopener noreferrer">æ¸²æŸ“é€‰é¡¹ | Vue.js</a>), æ”¹å†™åçš„ä¾‹å­å¦‚ä¸‹</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> h = <span class="hljs-title class_">Vue</span>.<span class="hljs-property">h</span>;

<span class="hljs-keyword">const</span> <span class="hljs-title class_">App</span> = {
  <span class="hljs-title function_">data</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">count</span>: <span class="hljs-number">0</span>
    }
  },
  <span class="hljs-title function_">render</span>(<span class="hljs-params"/>){
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">h</span>(<span class="hljs-string">"div"</span>, {
      <span class="hljs-attr">class</span>: <span class="hljs-string">"counter"</span>
    },  [
      <span class="hljs-title function_">h</span>(<span class="hljs-string">"span"</span>, {
        <span class="hljs-attr">onClick</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">decrement</span>()
      }, <span class="hljs-string">"-"</span>),
      <span class="hljs-title function_">h</span>(<span class="hljs-string">"p"</span>, <span class="hljs-literal">null</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span>),
      <span class="hljs-title function_">h</span>(<span class="hljs-string">"span"</span>, {
        <span class="hljs-attr">onClick</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">increment</span>()
      }, <span class="hljs-string">"+"</span>)
    ]);
  },
  <span class="hljs-attr">methods</span>: {
    <span class="hljs-title function_">increment</span>(<span class="hljs-params"/>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span>++;
    },
    <span class="hljs-title function_">decrement</span>(<span class="hljs-params"/>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span>--;
    }
  },
  <span class="hljs-title function_">mounted</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"æŒ‚è½½"</span>);
  }
};

<span class="hljs-keyword">const</span> app = <span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">createApp</span>(<span class="hljs-title class_">App</span>);


app.<span class="hljs-title function_">mount</span>(<span class="hljs-string">"#app"</span>);

<span class="hljs-comment">//index.js</span>
</code></pre>
<p>æˆ‘ä»¬å¯ä»¥çœ‹å®ƒåœ¨SFCä¸­ç¼–è¯‘åçš„ç»“æœæ˜¯ä»€ä¹ˆæ ·çš„,</p>
<p><img alt="" src="" loading="lazy"/></p>
<p>å¯ä»¥çœ‹åˆ°ï¼ŒSFCç¼–è¯‘æ’ä»¶åŸºäºæ²¡æœ‰åšä»€ä¹ˆæ›´æ”¹ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥æŠŠè¿™ä¸ªAppç»„ä»¶é…åˆvueè¿è¡Œæ—¶çš„ç‰ˆæœ¬ä½¿ç”¨ï¼Œçœ‹ä¸‹é¢çš„htmlä»£ç </p>
<pre><code class="hljs language-html" lang="html">  <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
    <span class="hljs-selector-class">.counter</span> {
      <span class="hljs-attribute">display</span>: flex;
      <span class="hljs-attribute">align-items</span>: center;
      <span class="hljs-attribute">justify-content</span>: center;
      <span class="hljs-attribute">column-gap</span>: <span class="hljs-number">15px</span>;
      <span class="hljs-attribute">width</span>: <span class="hljs-number">120px</span>;
      <span class="hljs-attribute">margin</span>: <span class="hljs-number">100px</span>;
      <span class="hljs-attribute">padding</span>: <span class="hljs-number">10px</span>;
      <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">8px</span>;
      <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#f5f5f5</span>;
      user-select: none;
      <span class="hljs-attribute">cursor</span>: pointer;
    }
  </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"app"</span>&gt;</span>

  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://cdn.bootcdn.net/ajax/libs/vue/3.5.22/vue.runtime.global.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"./index.js"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"module"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
</code></pre>
<h3 data-id="heading-5">template</h3>
<p>åœ¨ä¸Šé¢æˆ‘ä»¬æˆ‘ä»¬è®¨è®ºtemplateçš„æ—¶å€™è¯´ï¼Œå¦‚æœæ ¹ç»„ä»¶æ²¡æœ‰templateå’Œrender, é‚£ä¹ˆæ ¹ç»„ä»¶ä¼šæŠŠapp.mount("#app")ä¸­#appä»£è¡¨çš„å…ƒç´ çš„innerHTMLä½œä¸ºæ ¹ç»„ä»¶çš„template,é‚£ä¹ˆéæ ¹ç»„ä»¶å‘¢ï¼Œéæ ¹ç»„ä»¶å°±æ²¡æœ‰templateäº†ï¼Œé‚£ä¹ˆéæ ¹ç»„ä»¶æ€ä¹ˆä»htmlæ¨¡æ¿ä¸Šè·å¾—templateå­—ç¬¦ä¸²å‘¢,templateæ¥å—ä¸¤ç§å½¢å¼ï¼Œä¸€ç§å°±æ˜¯å†…åµŒvueè¯­æ³•çš„æè¿°domçš„å­—ç¬¦ä¸²ï¼Œä¸€ç§å…è®¸ä½ å°†å­—ç¬¦ä¸²ä»¥<code>#</code>å¼€å¤´ï¼Œå®ƒä¼šè¢«vueä½œä¸ºquerySelectoré€‰æ‹©å™¨ä½¿ç”¨ï¼Œ<code>å°†é€‰ä¸­çš„å…ƒç´ çš„innerHTMLä½œä¸ºæ¨¡æ¿å­—ç¬¦å­—ç¬¦ä¸²ï¼Œè¿™å°±è®©æˆ‘ä»¬å¯ä»¥ä½¿ç”¨åŸç”Ÿçš„templateå…ƒç´ çš„ä¹¦å†™æºæ¨¡æ¿</code>å¦‚ä¸‹</p>
<pre><code class="hljs language-html" lang="html">  <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
    <span class="hljs-selector-class">.counter</span> {
      <span class="hljs-attribute">display</span>: flex;
      <span class="hljs-attribute">align-items</span>: center;
      <span class="hljs-attribute">justify-content</span>: center;
      <span class="hljs-attribute">column-gap</span>: <span class="hljs-number">15px</span>;
      <span class="hljs-attribute">width</span>: <span class="hljs-number">120px</span>;
      <span class="hljs-attribute">margin</span>: <span class="hljs-number">100px</span>;
      <span class="hljs-attribute">padding</span>: <span class="hljs-number">10px</span>;
      <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">8px</span>;
      <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#f5f5f5</span>;
      user-select: none;
      <span class="hljs-attribute">cursor</span>: pointer;
    }
  </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"app"</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"temp"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"temp"</span>&gt;</span>å½“å‰çš„countä¸º: {{count}}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"./node_modules/vue/dist/vue.global.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"./index.js"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"module"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> <span class="hljs-title class_">Compo</span> = {
  <span class="hljs-attr">props</span>:{
      <span class="hljs-attr">count</span>: <span class="hljs-number">0</span>
  },
  <span class="hljs-attr">template</span>: <span class="hljs-string">"#temp"</span>
};


<span class="hljs-keyword">const</span> <span class="hljs-title class_">App</span> = {
  <span class="hljs-title function_">data</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">count</span>: <span class="hljs-number">0</span>
    }
  },
  <span class="hljs-attr">template</span>: <span class="hljs-string">`&lt;div class="counter"&gt;
      &lt;span @click="decrement"&gt;-&lt;/span&gt;
      &lt;p&gt;{{count}}&lt;/p&gt;
      &lt;span @click="increment"&gt;+&lt;/span&gt;
    &lt;/div&gt;
    &lt;Compo :count&gt;&lt;/Compo&gt;`</span>,
  <span class="hljs-attr">components</span>: {
    <span class="hljs-title class_">Compo</span>
  },
  <span class="hljs-attr">methods</span>: {
    <span class="hljs-title function_">increment</span>(<span class="hljs-params"/>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span>++;
    },
    <span class="hljs-title function_">decrement</span>(<span class="hljs-params"/>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span>--;
    }
  },
  <span class="hljs-title function_">mounted</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"æŒ‚è½½"</span>);
  }
};



<span class="hljs-keyword">const</span> app = <span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">createApp</span>(<span class="hljs-title class_">App</span>);


app.<span class="hljs-title function_">mount</span>(<span class="hljs-string">"#app"</span>);
</code></pre>
<p>è¿™å°±è®©ä½ åœ¨åŸç”Ÿçš„HTMLä¸Šä¹Ÿå…·æœ‰äº†ç»„ä»¶åŒ–çš„èƒ½åŠ›ï¼Œæˆ‘ä»¬ç»§ç»­é‡æ„ä¸Šé¢çš„ä»£ç ï¼Œçœ‹çœ‹å¦‚æœæ˜¯åœ¨htmlä¸Šä½¿ç”¨ç»„ä»¶åŒ–æ˜¯æ€æ ·çš„, æŸ¥çœ‹ä»¥ä¸‹çš„ä¾‹å­</p>
<pre><code class="hljs language-html" lang="html">  <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
    <span class="hljs-selector-class">.counter</span> {
      <span class="hljs-attribute">display</span>: flex;
      <span class="hljs-attribute">align-items</span>: center;
      <span class="hljs-attribute">justify-content</span>: center;
      <span class="hljs-attribute">column-gap</span>: <span class="hljs-number">15px</span>;
      <span class="hljs-attribute">width</span>: <span class="hljs-number">120px</span>;
      <span class="hljs-attribute">margin</span>: <span class="hljs-number">100px</span>;
      <span class="hljs-attribute">padding</span>: <span class="hljs-number">10px</span>;
      <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">8px</span>;
      <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#f5f5f5</span>;
      user-select: none;
      <span class="hljs-attribute">cursor</span>: pointer;
    }
  </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"app"</span>&gt;</span>

  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

  <span class="hljs-comment">&lt;!-- Appç»„ä»¶ --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"appTemplate"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"counter"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">span</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"decrement"</span>&gt;</span>-<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>{{count}}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">span</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"increment"</span>&gt;</span>+<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">Compo</span> <span class="hljs-attr">:count</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">Compo</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>


  <span class="hljs-comment">&lt;!-- Compo ç»„ä»¶ --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"temp"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"temp"</span>&gt;</span>å½“å‰çš„countä¸º: {{count}}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>


  <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"./node_modules/vue/dist/vue.global.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"./index.js"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"module"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> <span class="hljs-title class_">Compo</span> = {
  <span class="hljs-attr">props</span>:{
      <span class="hljs-attr">count</span>: <span class="hljs-number">0</span>
  },
  <span class="hljs-attr">template</span>: <span class="hljs-string">"#temp"</span>
};

<span class="hljs-keyword">const</span> <span class="hljs-title class_">App</span> = {
  <span class="hljs-title function_">data</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">count</span>: <span class="hljs-number">0</span>
    }
  },
  <span class="hljs-attr">template</span>: <span class="hljs-string">"#appTemplate"</span>,
  <span class="hljs-attr">components</span>: {
    <span class="hljs-title class_">Compo</span>
  },
  <span class="hljs-attr">methods</span>: {
    <span class="hljs-title function_">increment</span>(<span class="hljs-params"/>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span>++;
    },
    <span class="hljs-title function_">decrement</span>(<span class="hljs-params"/>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span>--;
    }
  },
  <span class="hljs-title function_">mounted</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"æŒ‚è½½"</span>);
  }
};

<span class="hljs-keyword">const</span> app = <span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">createApp</span>(<span class="hljs-title class_">App</span>);

app.<span class="hljs-title function_">mount</span>(<span class="hljs-string">"#app"</span>);
</code></pre>
<h2 data-id="heading-6">SFC</h2>
<p>æˆ‘ä»¬å¦‚æœæ˜¯æ‰“ç®—ä½¿ç”¨vueå®Œæ•´çš„å†™å®Œæ•´ä¸ªé¡¹ç›®ï¼Œ å°±å¾ˆé€‚åˆä½¿ç”¨å•æ–‡ä»¶ç»„ä»¶ï¼Œä¹Ÿå°±æ˜¯<code>.vue</code>æ–‡ä»¶, å®ƒçš„è‹±æ–‡åå­—æ˜¯<code>Single-File Components</code>,å°±æ˜¯SFCçš„ç¼©å†™,ä¹Ÿå°±æ˜¯ä¸€ä¸ªæ–‡ä»¶ä»£è¡¨ç€ä¸€ä¸ªç»„ä»¶ï¼Œæˆ‘ä»¬æŠŠç»„ä»¶çš„æ¨¡æ¿ï¼Œæ ·å¼ï¼Œé€»è¾‘éƒ½å†™åœ¨è¿™ä¸€ä¸ªæ–‡ä»¶å†…,åœ¨ä½¿ç”¨viteè¿™æ ·çš„æ„å»ºå·¥å…·çš„æ—¶å€™ï¼Œå½“ä¸‹è½½å®Œæ‰€æœ‰ä¾èµ–åï¼Œå¯ä»¥åœ¨æˆ‘ä»¬çš„<code>node_module</code>é‡Œçœ‹åˆ°ä¸‹è½½çš„vueï¼Œæœ‰å‡ ä¸ªä¾èµ–æ’ä»¶, å…¶ä¸­ä¸€ä¸ªåä¸º<code>@vue/compiler-sfc</code>,è¿™ä¸ªå°±æ˜¯ç”¨äºè§£ææˆ‘ä»¬çš„å•æ–‡ä»¶ç»„ä»¶çš„ï¼Œå…¶ä¸­è¿˜åŒ…å«ä¸€ä¸ªåä¸º<code>@vue/compiler-dom</code>çš„ä¾èµ–åº“,ä¸‹é¢è§£é‡Šè¿™ä¸ªåº“çš„ä½œç”¨</p>
<h2 data-id="heading-7">CDNä½¿ç”¨vue</h2>
<p>CDNå¼•å…¥çš„vueçš„jsæ–‡ä»¶éƒ½éœ€è¦èƒ½å¤Ÿè§£æhtmlæ–‡ä»¶ä¸­å“ªäº›åŒ…å«vueçš„è¯­æ³•éƒ¨åˆ†å¹¶ä¸”æ›¿æ¢æ‰ä»–ä»¬ï¼Œä¸Šè¿°çš„<code>@vue/compiler-dom</code>å°±æ˜¯ç”¨æ¥å¹²è¿™ä¸ªçš„ï¼Œä½†æ˜¯CDNçš„jsæ–‡ä»¶åŒ…å«ç¼–è¯‘å™¨, è€Œç»è¿‡Viteè¿™ç§æ¶æ„å·¥å…·æ‰“åŒ…åå®Œå…¨å¯ä»¥å»æ‰ç¼–è¯‘å™¨,åªç•™è¿è¡Œæ—¶vueæ–‡ä»¶å°±å¯ä»¥äº†</p>
<h2 data-id="heading-8">é€‰é¡¹å¼API</h2>
<p>vueæä¾›ä¸€ç§åŸºäºç»„åˆå¼Apiä¹‹ä¸Šçš„é€‰é¡¹å¼api,ä½¿ç”¨è¦æ¯”ç»„åˆå¼å†™æ³•ç®€å•å¾ˆå¤šï¼Œä¹Ÿæ›´é€‚åˆä¹ æƒ¯é¢å‘å¯¹è±¡ç¼–ç¨‹çš„ä½¿ç”¨è€…,è¯·çœ‹ä¸‹é¢çš„ä¾‹å­</p>
<pre><code class="hljs language-html" lang="html">//è¿™é‡Œå°†htmlçš„éƒ¨åˆ†å‡å»ä¸€äº›ï¼Œé¿å…ä¸€äº›æ— å…³ç´§è¦çš„å†…å®¹
//æ ·å¼éƒ¨åˆ†å¦‚ä¸‹
<span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
    <span class="hljs-selector-class">.counter</span> {
        <span class="hljs-attribute">display</span>: flex;
        <span class="hljs-attribute">align-items</span>: center;
        <span class="hljs-attribute">justify-content</span>: center;
        <span class="hljs-attribute">column-gap</span>: <span class="hljs-number">15px</span>;
        <span class="hljs-attribute">width</span>: <span class="hljs-number">120px</span>;
        <span class="hljs-attribute">margin</span>: <span class="hljs-number">100px</span>;
        <span class="hljs-attribute">padding</span>: <span class="hljs-number">10px</span>;
        <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">8px</span>;
        <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#f5f5f5</span>;
        user-select: none;
        <span class="hljs-attribute">cursor</span>: pointer;
    }
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"app"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"counter"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">span</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"decrement"</span>&gt;</span>-<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>{{count}}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">span</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"increment"</span>&gt;</span>+<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://unpkg.com/vue@3/dist/vue.global.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"./index.js"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"module"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
</code></pre>
<p>ä¸‹é¢æ˜¯index.jsæ–‡ä»¶</p>
<pre><code class="hljs language-javascript" lang="javascript">
<span class="hljs-keyword">const</span> <span class="hljs-title class_">App</span> = {
  <span class="hljs-title function_">data</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">count</span>: <span class="hljs-number">0</span>
    }
  },
  <span class="hljs-attr">methods</span>: {
    <span class="hljs-title function_">increment</span>(<span class="hljs-params"/>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span>++;
    },
    <span class="hljs-title function_">decrement</span>(<span class="hljs-params"/>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span>--;
    }
  },
  <span class="hljs-title function_">mounted</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"æŒ‚è½½"</span>);
  }
};

<span class="hljs-keyword">const</span> app = <span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">createApp</span>(<span class="hljs-title class_">App</span>);

app.<span class="hljs-title function_">mount</span>(<span class="hljs-string">"#app"</span>);
<span class="hljs-comment">//createAppä¼ å…¥çš„æ ¹ç»„ä»¶ï¼Œè¦æ˜¯è¿™ä¸ªç»„ä»¶æ²¡æœ‰è‡ªå·±çš„templateéƒ¨åˆ†ï¼Œå°±ä¼šæŠŠè·Ÿå®¹å™¨(åœ¨è¿™é‡Œæ˜¯#app)çš„`innerHTML`ä½œä¸ºå®ƒçš„æ¨¡æ¿,ä¹Ÿå¯ä»¥å†™æˆä¸‹é¢è¿™æ ·</span>

<span class="hljs-keyword">const</span> <span class="hljs-title class_">App</span> = {
  <span class="hljs-title function_">data</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">count</span>: <span class="hljs-number">0</span>
    }
  },
  <span class="hljs-attr">template</span>: <span class="hljs-string">`&lt;div class="counter"&gt;
      &lt;span @click="decrement"&gt;-&lt;/span&gt;
      &lt;p&gt;{{count}}&lt;/p&gt;
      &lt;span @click="increment"&gt;+&lt;/span&gt;
    &lt;/div&gt;`</span>,
  <span class="hljs-attr">methods</span>: {
    <span class="hljs-title function_">increment</span>(<span class="hljs-params"/>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span>++;
    },
    <span class="hljs-title function_">decrement</span>(<span class="hljs-params"/>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span>--;
    }
  },
  <span class="hljs-title function_">mounted</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"æŒ‚è½½"</span>);
  }
};

<span class="hljs-keyword">const</span> app = <span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">createApp</span>(<span class="hljs-title class_">App</span>);

<span class="hljs-keyword">const</span> rootComponents = app.<span class="hljs-title function_">mount</span>(<span class="hljs-string">"#app"</span>);

<span class="hljs-keyword">const</span> app = <span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">createApp</span>(<span class="hljs-title class_">App</span>);

app.<span class="hljs-title function_">mount</span>(<span class="hljs-string">"#app"</span>);
</code></pre>

<h2 data-id="heading-9">renderå’Œtemplate</h2>
<h3 data-id="heading-10">render</h3>
<p>åƒä¸Šè¿°ä»£ç ä¸­ï¼Œæˆ‘ä»¬æ˜¯åœ¨domä¸­å†…åµŒäº†vueè¯­æ³•ï¼Œé‚£ä¹ˆå°±ä¸€å®šè¦ç»è¿‡ç¼–è¯‘çš„é˜¶æ®µäº†, æˆ‘ä»¬å¯ä»¥å®šä¹‰renderå‡½æ•°ï¼Œç›´æ¥å†™renderå‡½æ•°å¯ä»¥ä¸ç»è¿‡ç¼–è¯‘ç›´æ¥è¿è¡Œï¼Œåœ¨æè¿°è¿™ç‚¹å‰ï¼Œæˆ‘ä»¬å…ˆä»‹ç»ä¸€ä¸‹<code>render</code>ï¼Œ æŒ‰vueå®˜æ–¹æ–‡æ¡£æ¥è¯´,<code>renderæ˜¯å­—ç¬¦ä¸²æ¨¡æ¿çš„ä¸€ç§æ›¿ä»£ï¼Œå¯ä»¥è®©ä½ åˆ©ç”¨JavaScriptçš„ä¸°å¯Œè¡¨è¾¾åŠ›æ¥å®Œå…¨ç¼–ç¨‹å¼åœ°å£°æ˜ç»„ä»¶æœ€ç»ˆçš„æ¸²æŸ“è¾“å‡º, é¢„ç¼–è¯‘çš„æ¨¡æ¿å¦‚æœå•æ–‡ä»¶ç»„ä»¶ä¸­çš„æ¨¡æ¿ï¼Œä¼šåœ¨æ„å»ºæ—¶è¢«ç¼–è¯‘ä¸ºrenderé€‰é¡¹,å¦‚æœä¸€ä¸ªç»„ä»¶ä¸­åŒæ—¶å­˜åœ¨renderå’Œtemplate,åˆ™renderå°†å…·æœ‰æ›´é«˜çš„ä¼˜å…ˆçº§</code>,</p>
<p>æˆ‘ä»¬å¯ä»¥çœ‹ï¼Œå¦‚æœæ˜¯è®©vueå®æ—¶çš„ç¼–è¯‘å†…åµŒvueè¯­æ³•çš„dom,ä¼šè¢«ç¼–è¯‘æˆä»€ä¹ˆæ ·å­,</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7976b1d5193b40f4b56863e2bf17c15a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LaF57ud5aSn5biF5ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771311405&amp;x-signature=tYA1UcVeVxBFZHDRf0Jj96GXg8U%3D" alt="è”æƒ³æˆªå›¾_20260210120439.png" loading="lazy"/></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œå½“ä½ åœ¨domåµŒå…¥vueè¯­æ³•çš„æ—¶å€™,æ²¡æœ‰ç”Ÿæˆrenderå‡½æ•°ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦ä½ å¼•å…¥çš„cdnçš„vueç‰ˆæœ¬ä¸­åŒ…å«ç¼–è¯‘å™¨,å¦‚æœæ˜¯ç¼–è¯‘çš„SFCæ¨¡æ¿ç»“æœæ˜¯ä»€ä¹ˆæ ·çš„?</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/61637bf728274b368fe3dda6a93eec32~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LaF57ud5aSn5biF5ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771311405&amp;x-signature=4%2BSHViZkbidqNFo8R7kDvScKsO0%3D" alt="è”æƒ³æˆªå›¾_20260210120639.png" loading="lazy"/></p>
<p>å¯ä»¥çœ‹åˆ°ç”Ÿæˆäº†renderå‡½æ•°ï¼Œè¿™ä¸ªrenderå‡½æ•°æ˜¯å¯ä»¥ç›´æ¥è¢«è¿è¡Œæ—¶çš„vueåŒ…æ‰§è¡Œçš„ï¼Œä¸éœ€è¦åŠ å…¥ç¼–è¯‘å™¨,æ‰€ä»¥å¯ä»¥çœ‹åˆ°æœ‰æ²¡æœ‰renderæ˜¯ä¸¤å›äº‹ï¼Œæœ‰renderå°±ç›´æ¥ä½¿ç”¨render,æ²¡æœ‰renderï¼Œé‚£ä¹ˆå°±ä¼šè¯»å–templateå­—ç¬¦ä¸²ï¼Œ è¿™ä¸ªæ—¶å€™å°±éœ€è¦ç¼–è¯‘å™¨äº† , æˆ‘ä»¬åœ¨è¿™é‡Œå°è¯•æŠŠä¸Šé¢åœ¨é€‰é¡¹å¼APIéƒ¨åˆ†é‡Œå†™çš„ä¾‹å­ç”¨renderå‡½æ•°å†™ä¸€é, <code>vue</code>ç»™æˆ‘ä»¬æä¾›äº†ä¸€ä¸ªåä¸ºhå‡½æ•°çš„api,ä¸“é—¨ç”¨äºç»™å¼€å‘è€…æ‰‹åŠ¨çš„ç¼–å†™renderå‡½æ•°ï¼Œå…·ä½“å¯ä»¥çœ‹ [hå‡½æ•°](<a href="https://link.juejin.cn?target=https%3A%2F%2Fcn.vuejs.org%2Fapi%2Foptions-rendering.html%23render" target="_blank" title="https://cn.vuejs.org/api/options-rendering.html#render" ref="nofollow noopener noreferrer">æ¸²æŸ“é€‰é¡¹ | Vue.js</a>), æ”¹å†™åçš„ä¾‹å­å¦‚ä¸‹</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> h = <span class="hljs-title class_">Vue</span>.<span class="hljs-property">h</span>;

<span class="hljs-keyword">const</span> <span class="hljs-title class_">App</span> = {
  <span class="hljs-title function_">data</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">count</span>: <span class="hljs-number">0</span>
    }
  },
  <span class="hljs-title function_">render</span>(<span class="hljs-params"/>){
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">h</span>(<span class="hljs-string">"div"</span>, {
      <span class="hljs-attr">class</span>: <span class="hljs-string">"counter"</span>
    },  [
      <span class="hljs-title function_">h</span>(<span class="hljs-string">"span"</span>, {
        <span class="hljs-attr">onClick</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">decrement</span>()
      }, <span class="hljs-string">"-"</span>),
      <span class="hljs-title function_">h</span>(<span class="hljs-string">"p"</span>, <span class="hljs-literal">null</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span>),
      <span class="hljs-title function_">h</span>(<span class="hljs-string">"span"</span>, {
        <span class="hljs-attr">onClick</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">increment</span>()
      }, <span class="hljs-string">"+"</span>)
    ]);
  },
  <span class="hljs-attr">methods</span>: {
    <span class="hljs-title function_">increment</span>(<span class="hljs-params"/>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span>++;
    },
    <span class="hljs-title function_">decrement</span>(<span class="hljs-params"/>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span>--;
    }
  },
  <span class="hljs-title function_">mounted</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"æŒ‚è½½"</span>);
  }
};

<span class="hljs-keyword">const</span> app = <span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">createApp</span>(<span class="hljs-title class_">App</span>);


app.<span class="hljs-title function_">mount</span>(<span class="hljs-string">"#app"</span>);

<span class="hljs-comment">//index.js</span>
</code></pre>
<p>æˆ‘ä»¬å¯ä»¥çœ‹å®ƒåœ¨SFCä¸­ç¼–è¯‘åçš„ç»“æœæ˜¯ä»€ä¹ˆæ ·çš„,
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7348d6c57827411a83ddb53c3acb2daa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LaF57ud5aSn5biF5ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771311405&amp;x-signature=A0uJ8gFPk4oYydlCwkUk3zAclHw%3D" alt="è”æƒ³æˆªå›¾_20260210125956.png" loading="lazy"/></p>
<p>å¯ä»¥çœ‹åˆ°ï¼ŒSFCç¼–è¯‘æ’ä»¶åŸºäºæ²¡æœ‰åšä»€ä¹ˆæ›´æ”¹ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥æŠŠè¿™ä¸ªAppç»„ä»¶é…åˆvueè¿è¡Œæ—¶çš„ç‰ˆæœ¬ä½¿ç”¨ï¼Œçœ‹ä¸‹é¢çš„htmlä»£ç </p>
<pre><code class="hljs language-html" lang="html">  <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
    <span class="hljs-selector-class">.counter</span> {
      <span class="hljs-attribute">display</span>: flex;
      <span class="hljs-attribute">align-items</span>: center;
      <span class="hljs-attribute">justify-content</span>: center;
      <span class="hljs-attribute">column-gap</span>: <span class="hljs-number">15px</span>;
      <span class="hljs-attribute">width</span>: <span class="hljs-number">120px</span>;
      <span class="hljs-attribute">margin</span>: <span class="hljs-number">100px</span>;
      <span class="hljs-attribute">padding</span>: <span class="hljs-number">10px</span>;
      <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">8px</span>;
      <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#f5f5f5</span>;
      user-select: none;
      <span class="hljs-attribute">cursor</span>: pointer;
    }
  </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"app"</span>&gt;</span>

  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://cdn.bootcdn.net/ajax/libs/vue/3.5.22/vue.runtime.global.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"./index.js"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"module"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
</code></pre>
<h3 data-id="heading-11">template</h3>
<p>åœ¨ä¸Šé¢æˆ‘ä»¬æˆ‘ä»¬è®¨è®ºtemplateçš„æ—¶å€™è¯´ï¼Œå¦‚æœæ ¹ç»„ä»¶æ²¡æœ‰templateå’Œrender, é‚£ä¹ˆæ ¹ç»„ä»¶ä¼šæŠŠapp.mount("#app")ä¸­#appä»£è¡¨çš„å…ƒç´ çš„innerHTMLä½œä¸ºæ ¹ç»„ä»¶çš„template,é‚£ä¹ˆéæ ¹ç»„ä»¶å‘¢ï¼Œéæ ¹ç»„ä»¶å°±æ²¡æœ‰templateäº†ï¼Œé‚£ä¹ˆéæ ¹ç»„ä»¶æ€ä¹ˆä»htmlæ¨¡æ¿ä¸Šè·å¾—templateå­—ç¬¦ä¸²å‘¢,templateæ¥å—ä¸¤ç§å½¢å¼ï¼Œä¸€ç§å°±æ˜¯å†…åµŒvueè¯­æ³•çš„æè¿°domçš„å­—ç¬¦ä¸²ï¼Œä¸€ç§å…è®¸ä½ å°†å­—ç¬¦ä¸²ä»¥<code>#</code>å¼€å¤´ï¼Œå®ƒä¼šè¢«vueä½œä¸ºquerySelectoré€‰æ‹©å™¨ä½¿ç”¨ï¼Œ<code>å°†é€‰ä¸­çš„å…ƒç´ çš„innerHTMLä½œä¸ºæ¨¡æ¿å­—ç¬¦å­—ç¬¦ä¸²ï¼Œè¿™å°±è®©æˆ‘ä»¬å¯ä»¥ä½¿ç”¨åŸç”Ÿçš„templateå…ƒç´ çš„ä¹¦å†™æºæ¨¡æ¿</code>å¦‚ä¸‹</p>
<pre><code class="hljs language-html" lang="html">  <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
    <span class="hljs-selector-class">.counter</span> {
      <span class="hljs-attribute">display</span>: flex;
      <span class="hljs-attribute">align-items</span>: center;
      <span class="hljs-attribute">justify-content</span>: center;
      <span class="hljs-attribute">column-gap</span>: <span class="hljs-number">15px</span>;
      <span class="hljs-attribute">width</span>: <span class="hljs-number">120px</span>;
      <span class="hljs-attribute">margin</span>: <span class="hljs-number">100px</span>;
      <span class="hljs-attribute">padding</span>: <span class="hljs-number">10px</span>;
      <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">8px</span>;
      <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#f5f5f5</span>;
      user-select: none;
      <span class="hljs-attribute">cursor</span>: pointer;
    }
  </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"app"</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"temp"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"temp"</span>&gt;</span>å½“å‰çš„countä¸º: {{count}}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"./node_modules/vue/dist/vue.global.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"./index.js"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"module"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> <span class="hljs-title class_">Compo</span> = {
  <span class="hljs-attr">props</span>:{
      <span class="hljs-attr">count</span>: <span class="hljs-number">0</span>
  },
  <span class="hljs-attr">template</span>: <span class="hljs-string">"#temp"</span>
};


<span class="hljs-keyword">const</span> <span class="hljs-title class_">App</span> = {
  <span class="hljs-title function_">data</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">count</span>: <span class="hljs-number">0</span>
    }
  },
  <span class="hljs-attr">template</span>: <span class="hljs-string">`&lt;div class="counter"&gt;
      &lt;span @click="decrement"&gt;-&lt;/span&gt;
      &lt;p&gt;{{count}}&lt;/p&gt;
      &lt;span @click="increment"&gt;+&lt;/span&gt;
    &lt;/div&gt;
    &lt;Compo :count&gt;&lt;/Compo&gt;`</span>,
  <span class="hljs-attr">components</span>: {
    <span class="hljs-title class_">Compo</span>
  },
  <span class="hljs-attr">methods</span>: {
    <span class="hljs-title function_">increment</span>(<span class="hljs-params"/>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span>++;
    },
    <span class="hljs-title function_">decrement</span>(<span class="hljs-params"/>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span>--;
    }
  },
  <span class="hljs-title function_">mounted</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"æŒ‚è½½"</span>);
  }
};



<span class="hljs-keyword">const</span> app = <span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">createApp</span>(<span class="hljs-title class_">App</span>);


app.<span class="hljs-title function_">mount</span>(<span class="hljs-string">"#app"</span>);
</code></pre>
<p>è¿™å°±è®©ä½ åœ¨åŸç”Ÿçš„HTMLä¸Šä¹Ÿå…·æœ‰äº†ç»„ä»¶åŒ–çš„èƒ½åŠ›ï¼Œæˆ‘ä»¬ç»§ç»­é‡æ„ä¸Šé¢çš„ä»£ç ï¼Œçœ‹çœ‹å¦‚æœæ˜¯åœ¨htmlä¸Šä½¿ç”¨ç»„ä»¶åŒ–æ˜¯æ€æ ·çš„, æŸ¥çœ‹ä»¥ä¸‹çš„ä¾‹å­</p>
<pre><code class="hljs language-html" lang="html">  <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
    <span class="hljs-selector-class">.counter</span> {
      <span class="hljs-attribute">display</span>: flex;
      <span class="hljs-attribute">align-items</span>: center;
      <span class="hljs-attribute">justify-content</span>: center;
      <span class="hljs-attribute">column-gap</span>: <span class="hljs-number">15px</span>;
      <span class="hljs-attribute">width</span>: <span class="hljs-number">120px</span>;
      <span class="hljs-attribute">margin</span>: <span class="hljs-number">100px</span>;
      <span class="hljs-attribute">padding</span>: <span class="hljs-number">10px</span>;
      <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">8px</span>;
      <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#f5f5f5</span>;
      user-select: none;
      <span class="hljs-attribute">cursor</span>: pointer;
    }
  </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"app"</span>&gt;</span>

  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

  <span class="hljs-comment">&lt;!-- Appç»„ä»¶ --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"appTemplate"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"counter"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">span</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"decrement"</span>&gt;</span>-<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>{{count}}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">span</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"increment"</span>&gt;</span>+<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">Compo</span> <span class="hljs-attr">:count</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">Compo</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>


  <span class="hljs-comment">&lt;!-- Compo ç»„ä»¶ --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"temp"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"temp"</span>&gt;</span>å½“å‰çš„countä¸º: {{count}}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>


  <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"./node_modules/vue/dist/vue.global.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"./index.js"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"module"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> <span class="hljs-title class_">Compo</span> = {
  <span class="hljs-attr">props</span>:{
      <span class="hljs-attr">count</span>: <span class="hljs-number">0</span>
  },
  <span class="hljs-attr">template</span>: <span class="hljs-string">"#temp"</span>
};

<span class="hljs-keyword">const</span> <span class="hljs-title class_">App</span> = {
  <span class="hljs-title function_">data</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">count</span>: <span class="hljs-number">0</span>
    }
  },
  <span class="hljs-attr">template</span>: <span class="hljs-string">"#appTemplate"</span>,
  <span class="hljs-attr">components</span>: {
    <span class="hljs-title class_">Compo</span>
  },
  <span class="hljs-attr">methods</span>: {
    <span class="hljs-title function_">increment</span>(<span class="hljs-params"/>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span>++;
    },
    <span class="hljs-title function_">decrement</span>(<span class="hljs-params"/>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span>--;
    }
  },
  <span class="hljs-title function_">mounted</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"æŒ‚è½½"</span>);
  }
};

<span class="hljs-keyword">const</span> app = <span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">createApp</span>(<span class="hljs-title class_">App</span>);

app.<span class="hljs-title function_">mount</span>(<span class="hljs-string">"#app"</span>);
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å‰ç«¯ä»£ç†æ¥å£æŠ¥é”™é—®é¢˜æ’æŸ¥]]></title>    <link>https://juejin.cn/post/7604701848151310336</link>    <guid>https://juejin.cn/post/7604701848151310336</guid>    <pubDate>2026-02-10T06:35:10.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604701848151310336" data-draft-id="7604779604125564928" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å‰ç«¯ä»£ç†æ¥å£æŠ¥é”™é—®é¢˜æ’æŸ¥"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2026-02-10T06:35:10.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="web_bee"/> <meta itemprop="url" content="https://juejin.cn/user/428665740231"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å‰ç«¯ä»£ç†æ¥å£æŠ¥é”™é—®é¢˜æ’æŸ¥
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/428665740231/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    web_bee
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T06:35:10.000Z" title="Tue Feb 10 2026 06:35:10 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong>éœ€æ±‚æè¿°ï¼š</strong></p>
<p>æœ€è¿‘åœ¨çœ‹ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼Œæƒ³å‰ç«¯æœ¬åœ°è°ƒè¯•ï¼Œè°ƒç”¨å®ƒçº¿ä¸Šåœ°å€ï¼š<code>https://****.ai/apps</code></p>
<p><strong>å®ç°æ–¹æ¡ˆï¼š</strong></p>
<p>å‰ç«¯ç›´æ¥é…ç½®ï¼Œä»£ç†å®ƒçº¿ä¸Šåœ°å€</p>
<h2 data-id="heading-0">å®ç°ï¼š</h2>
<p>å‰ç«¯ <code>next.config.ts</code> é…ç½®ï¼š</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">const</span> nextConfig: NextConfig = {
 Â <span class="hljs-comment">// ...</span>
 Â <span class="hljs-function"><span class="hljs-keyword">async</span> <span class="hljs-title">rewrites</span>()</span> {
 Â  Â <span class="hljs-keyword">return</span> [
 Â  Â   {
 Â  Â  Â  Â source: <span class="hljs-string">'/console/api/:path*'</span>,
 Â  Â  Â  Â destination: `https:<span class="hljs-comment">//cloud.dify.ai/console/api/:path*`,</span>
 Â  Â   }
 Â   ]
  }
}
</code></pre>
<p>ä»£ç†çš„ç»“æœæ˜¯ ç›¸å…³æ¥å£ä½¿ç”¨è°ƒç”¨ä¸æˆåŠŸï¼›</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d8b8108483e843329c08aef6c4a2f169~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd2ViX2JlZQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771310533&amp;x-signature=3i%2BcUqlpCy1uIB5bFJgTn3fxMBE%3D" alt="diy1.png" loading="lazy"/></p>
<p>ç†è®ºä¸Š çœŸå®çš„ä»£ç†åœ°å€æ˜¯ï¼š</p>
<p><code>https://cloud.dify.ai/console/api/system-features</code></p>
<p>åœ¨é¡¹ç›®ä¸­è®¿é—® æ— æ³•æ­£å¸¸è°ƒç”¨ï¼›</p>
<p><strong>ç„¶åæˆ‘é€šè¿‡æµè§ˆå™¨ç›´æ¥è®¿é—®ï¼›</strong></p>
<p>é€šè¿‡æµè§ˆå™¨æ˜¯å¯ä»¥æ­£å¸¸è®¿é—®çš„ï¼›âœ…</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5a37f63e2f8043919a2d1cb636eb9d63~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd2ViX2JlZQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771310533&amp;x-signature=3hJetJleW%2FHUBT18ckUG5iblklc%3D" alt="dify2.png" loading="lazy"/></p>
<p><strong>é—®é¢˜ï¼š</strong></p>
<p>æµè§ˆå™¨å¯ä»¥è®¿é—®ï¼Œå‰ç«¯é¡¹ç›®ä¸­ä»£ç†æ—¶ä¸èƒ½è®¿é—®</p>
<p><strong>ç¯å¢ƒï¼š</strong></p>
<p>æœ¬åœ°ç½‘ç»œç¯å¢ƒæ˜¯ï¼Œå¼€å¯äº†ç›¸å…³ç½‘ç»œç¯å¢ƒ</p>
<p><strong>æœ€ç»ˆé—®é¢˜ç¡®è®¤ï¼š</strong></p>
<p><strong>Next.js çš„ <code>rewrites</code> ä»£ç†è¯·æ±‚æ²¡æœ‰èµ°æœ¬åœ° Clash ä»£ç†</strong>ã€‚è¿™æ˜¯å› ä¸º Next.js åœ¨æœåŠ¡ç«¯ï¼ˆNode.js ç¯å¢ƒï¼‰æ‰§è¡Œ <code>rewrites</code> æ—¶ï¼Œå…¶åº•å±‚ä½¿ç”¨çš„æ˜¯æ ‡å‡†çš„ HTTP/HTTPS å®¢æˆ·ç«¯ï¼ˆå¦‚ <code>http</code>ã€<code>https</code> æ¨¡å—æˆ– <code>undici</code>ï¼‰ï¼Œè€Œ <strong>è¿™äº›å®¢æˆ·ç«¯é»˜è®¤ä¸ä¼šè‡ªåŠ¨ä½¿ç”¨ç³»ç»Ÿæˆ–æœ¬åœ°çš„ HTTP/HTTPS ä»£ç†ï¼ˆå¦‚ Clashï¼‰</strong> ï¼Œé™¤éæ˜¾å¼é…ç½®</p>
<p>æ‰€ä»¥ï¼Œæˆ‘ä»¬çš„å‰ç«¯é¡¹ç›®æ²¡æœ‰èµ°ç³»ç»Ÿä»£ç†ï¼Œæ‰€ä»¥è®¿é—®ä¸äº†æ¥å£ï¼›</p>
<h2 data-id="heading-1">è§£å†³æ–¹æ¡ˆï¼š</h2>
<h3 data-id="heading-2">æ–¹æ¡ˆä¸€ï¼š</h3>
<p><strong>ä½¿ç”¨</strong> <code>http-proxy-agent</code> <strong>+ è‡ªå®šä¹‰</strong> <code>fetch</code> <strong>ï¼ˆæ¨èç”¨äº Next.js 13+ App Routerï¼‰</strong></p>
<p>ä½†æ³¨æ„ï¼š<strong><code>rewrites</code> æ˜¯ Next.js å†…ç½®åŠŸèƒ½ï¼Œæ— æ³•ç›´æ¥æ³¨å…¥è‡ªå®šä¹‰ä»£ç†é€»è¾‘</strong>ã€‚æ‰€ä»¥æ›´å¯è¡Œçš„åšæ³•æ˜¯ï¼š</p>
<blockquote>
<p>âŒ <strong>ä¸è¦ç”¨ <code>rewrites</code> åšè·¨åŸŸä»£ç†åˆ°éœ€è¦èµ°ä»£ç†çš„å¤–éƒ¨ API</strong> âœ… <strong>æ”¹ç”¨ API Routeï¼ˆ<code>pages/api/proxy.ts</code>ï¼‰åšä¸­è½¬ï¼Œå¹¶åœ¨è¯¥è·¯ç”±ä¸­æ˜¾å¼é…ç½®ä»£ç†</strong></p>
</blockquote>
<p><strong>æ¨èåšæ³•ï¼šç”¨ API è·¯ç”±ä¸­è½¬ + é…ç½®ä»£ç†</strong></p>
<ol>
<li><strong>åˆ é™¤ <code>next.config.js</code> ä¸­çš„ <code>rewrites</code></strong></li>
<li><strong>åˆ›å»ºä¸€ä¸ª API è·¯ç”±</strong>ï¼š<code>pages/api/console/[...path].ts</code></li>
</ol>

<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// pages/api/console/[...path].ts</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">NextApiRequest</span>, <span class="hljs-title class_">NextApiResponse</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'next'</span>;
<span class="hljs-keyword">import</span> { createProxyMiddleware } <span class="hljs-keyword">from</span> <span class="hljs-string">'http-proxy-middleware'</span>;
â€‹
<span class="hljs-comment">// æ³¨æ„ï¼šhttp-proxy-middleware åœ¨ Vercel ä¸Šä¸å·¥ä½œï¼Œä»…é€‚ç”¨äºæœ¬åœ°å¼€å‘æˆ–è‡ªæ‰˜ç®¡</span>
<span class="hljs-keyword">const</span> proxy = <span class="hljs-title function_">createProxyMiddleware</span>({
 Â <span class="hljs-attr">target</span>: <span class="hljs-string">'https://cloud.dify.ai'</span>,
 Â <span class="hljs-attr">changeOrigin</span>: <span class="hljs-literal">true</span>,
 Â <span class="hljs-attr">pathRewrite</span>: {
 Â  Â <span class="hljs-string">'^/api/console'</span>: <span class="hljs-string">'/console'</span>, <span class="hljs-comment">// å°† /api/console/foo â†’ /console/foo</span>
  },
 Â <span class="hljs-attr">agent</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span> === <span class="hljs-string">'development'</span> 
 Â  Â ? <span class="hljs-keyword">new</span> (<span class="hljs-built_in">require</span>(<span class="hljs-string">'https-proxy-agent'</span>))(<span class="hljs-string">'http://127.0.0.1:7890'</span>)
 Â   : <span class="hljs-literal">undefined</span>,
});
â€‹
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">handler</span>(<span class="hljs-params">req: NextApiRequest, res: NextApiResponse</span>) {
 Â <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
 Â   (proxy <span class="hljs-keyword">as</span> <span class="hljs-built_in">any</span>)(req, res, <span class="hljs-function">(<span class="hljs-params">result: <span class="hljs-built_in">unknown</span></span>) =&gt;</span> {
 Â  Â  Â <span class="hljs-keyword">if</span> (result <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Error</span>) {
 Â  Â  Â  Â <span class="hljs-title function_">reject</span>(result);
 Â  Â   } <span class="hljs-keyword">else</span> {
 Â  Â  Â  Â <span class="hljs-title function_">resolve</span>(result);
 Â  Â   }
 Â   });
  });
}
â€‹
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> config = {
 Â <span class="hljs-attr">api</span>: {
 Â  Â <span class="hljs-attr">bodyParser</span>: <span class="hljs-literal">false</span>,
 Â  Â <span class="hljs-attr">externalResolver</span>: <span class="hljs-literal">true</span>,
  },
};
</code></pre>
<ol>
<li><strong>å®‰è£…ä¾èµ–</strong>ï¼š</li>
</ol>

<pre><code class="hljs">npm install http-proxy-middleware https-proxy-agent
</code></pre>
<ol>
<li><strong>å‰ç«¯ä»£ç ä¸­å°†è¯·æ±‚æŒ‡å‘ä½ çš„æœ¬åœ° API è·¯ç”±</strong>ï¼š</li>
</ol>
<p>åŸæ¥å¯èƒ½è¯·æ±‚ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">/console/api/workspaces
</code></pre>
<p>ç°åœ¨æ”¹ä¸ºï¼š</p>
<pre><code class="hljs language-bash" lang="bash">/api/console/api/workspaces
</code></pre>
<p>æˆ–è€…ä½ åœ¨å‰ç«¯ç»Ÿä¸€é…ç½® baseURL ä¸º <code>/api/console</code>ã€‚</p>
<p><strong>æ³¨æ„äº‹é¡¹</strong></p>
<ul>
<li><code>http-proxy-middleware</code> å’Œ <code>https-proxy-agent</code> <strong>åªé€‚ç”¨äº Node.js ç¯å¢ƒ</strong>ï¼Œä¸èƒ½åœ¨æµè§ˆå™¨ä¸­è¿è¡Œã€‚</li>
<li>å¦‚æœä½ éƒ¨ç½²åˆ° Vercelï¼ŒClash ä»£ç†ä¸å¯ç”¨ï¼Œè¿™ç§ä»£ç†æ–¹å¼åªé€‚åˆ <strong>æœ¬åœ°å¼€å‘</strong>ã€‚</li>
<li>å¦‚æœä½ åªæ˜¯æœ¬åœ°å¼€å‘ï¼Œä¹Ÿå¯ä»¥è€ƒè™‘ <strong>è®© Clash å…¨å±€æ¥ç®¡æµé‡ï¼ˆTUN æ¨¡å¼ï¼‰</strong> ï¼Œè¿™æ · Node.js è¯·æ±‚ä¹Ÿä¼šè¢«é€æ˜ä»£ç†ã€‚ä½†ä¸æ˜¯æ‰€æœ‰ Clash å®¢æˆ·ç«¯éƒ½é»˜è®¤å¼€å¯ TUNã€‚</li>
</ul>
<h3 data-id="heading-3">æ–¹æ¡ˆäºŒï¼š</h3>
<p><strong>æ›¿ä»£æ€è·¯ï¼šå¼€å¯ Clash çš„ TUN æ¨¡å¼ï¼ˆé€æ˜ä»£ç†ï¼‰</strong></p>
<p>å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ <strong>Clash Verge / Clash Meta</strong> ç­‰æ”¯æŒ TUN æ¨¡å¼çš„å®¢æˆ·ç«¯ï¼š</p>
<ul>
<li>å¼€å¯ <strong>TUN æ¨¡å¼ï¼ˆæˆ–â€œå¢å¼ºæ¨¡å¼â€ï¼‰</strong></li>
<li>è¿™æ ·æ‰€æœ‰æœ¬åœ°åº”ç”¨ï¼ˆåŒ…æ‹¬ Node.jsï¼‰çš„ç½‘ç»œè¯·æ±‚éƒ½ä¼šè¢«å¼ºåˆ¶èµ°ä»£ç†</li>
<li>æ­¤æ—¶ Next.js çš„ <code>rewrites</code> å°±èƒ½è‡ªåŠ¨èµ° Clashï¼Œæ— éœ€æ”¹ä»£ç </li>
</ul>
<blockquote>
<p>âœ… ä¼˜ç‚¹ï¼šæ— éœ€æ”¹ä»£ç  âŒ ç¼ºç‚¹ï¼šä¾èµ–å®¢æˆ·ç«¯é…ç½®ï¼Œä¸”å¯èƒ½å½±å“å…¶ä»–ç½‘ç»œè¯·æ±‚</p>
</blockquote>
<h3 data-id="heading-4"><strong>æ€»ç»“</strong></h3>

























<table><thead><tr><th>æ–¹æ¡ˆ</th><th>æ˜¯å¦æ¨è</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>æ”¹ç”¨ API è·¯ç”± + <code>https-proxy-agent</code></td><td>âœ… å¼ºçƒˆæ¨èï¼ˆå¯æ§ï¼‰</td><td>æ˜¾å¼æŒ‡å®šä»£ç†ï¼Œé€‚åˆå¼€å‘</td></tr><tr><td>å¼€å¯ Clash TUN æ¨¡å¼</td><td>âœ… ç®€å•å¿«æ·</td><td>é€‚åˆçº¯æœ¬åœ°å¼€å‘ï¼Œä½†å…¨å±€ç”Ÿæ•ˆ</td></tr><tr><td>ç»§ç»­ç”¨ <code>rewrites</code></td><td>âŒ ä¸å¯è¡Œ</td><td>Node.js ä¸ä¼šè‡ªåŠ¨èµ° HTTP ä»£ç†</td></tr></tbody></table>
<p>ä¸ªäººä½¿ç”¨çš„æ˜¯æ–¹æ¡ˆäºŒã€æœ€ç»ˆæ¥å£èƒ½è®¿é—®äº†ï¼›</p>
<p>ä¸è¿‡ç™»å½•ä¹‹åçš„æ¥å£è¿˜æ˜¯æŠ¥é”™ï¼Œtokené—®é¢˜ï¼› åº”è¯¥æ˜¯åç«¯æ¥å£åšäº†é™åˆ¶ï¼Œå¼€å‘ä¸­ä¸èƒ½ç›´æ¥ä½¿ç”¨çº¿ä¸Šåœ°å€ï¼›</p>
<p>æœ€åè¿˜æ˜¯éœ€è¦è‡ªå·±æœ¬åœ°å¯åŠ¨ä¸€ä¸‹å®ƒçš„åç«¯æœåŠ¡ï¼›</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[IntelliJ IDEA 2026.1 EAP 3 ç´§æ€¥å‘å¸ƒï¼ŒAI èƒ½åŠ›å†æ¬¡åŠ å¼ºï¼Œå›æ”¶ç«™ç»ˆäºæœ‰äº†ï¼]]></title>    <link>https://juejin.cn/post/7604775190213001226</link>    <guid>https://juejin.cn/post/7604775190213001226</guid>    <pubDate>2026-02-10T06:47:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604775190213001226" data-draft-id="7604761524977434633" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="IntelliJ IDEA 2026.1 EAP 3 ç´§æ€¥å‘å¸ƒï¼ŒAI èƒ½åŠ›å†æ¬¡åŠ å¼ºï¼Œå›æ”¶ç«™ç»ˆäºæœ‰äº†ï¼"/> <meta itemprop="keywords" content="IntelliJ IDEA,Java"/> <meta itemprop="datePublished" content="2026-02-10T06:47:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="JavaGuide"/> <meta itemprop="url" content="https://juejin.cn/user/166781497383294"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            IntelliJ IDEA 2026.1 EAP 3 ç´§æ€¥å‘å¸ƒï¼ŒAI èƒ½åŠ›å†æ¬¡åŠ å¼ºï¼Œå›æ”¶ç«™ç»ˆäºæœ‰äº†ï¼
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/166781497383294/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    JavaGuide
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T06:47:48.000Z" title="Tue Feb 10 2026 06:47:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯ Guideã€‚IntelliJ IDEA 2026.1 EAP 3 ç´§æ€¥å‘å¸ƒäº†ä¸¤ç‰ˆï¼Œå¸¦æ¥çš„å®ç”¨æ›´æ–°çœŸçš„ä¸å°‘ï¼Œä¸€å®šè¦çœ‹çœ‹ï¼</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ceb486095e904acfa45d20cea03328e5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YUd1aWRl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771310924&amp;x-signature=KoQ1odVs8dF1mrnQJmAktzo%2B6tw%3D" alt="" loading="lazy"/></p>
<p>æœ€å€¼å¾—å…³æ³¨çš„æ˜¯ï¼šåˆ é™¤æ–‡ä»¶ç°åœ¨ä¼šå…ˆç§»åˆ°ç³»ç»Ÿå›æ”¶ç«™ã€‚æ­¤å¤–è¿˜æœ‰ MCP åè®®ä¼˜åŒ–ã€Git Worktree æ”¯æŒã€Spring å¼€å‘ä½“éªŒå‡çº§ç­‰æ”¹åŠ¨ã€‚</p>
<p>å®è¯è¯´ï¼Œè¿™æ¬¡ IDEA åšçš„ç¡®å®ä¸é”™ï¼Œè™½è¿Ÿä½†åˆ°ï¼ä¸è¿‡ï¼Œè¿˜æ˜¯å¸Œæœ› IDEA åœ¨<strong>å†…å­˜å ç”¨ã€ç¨³å®šæ€§å’Œ AI</strong> ä¸Šé¢å¤šå¤šåŠ æ²¹ï¼</p>
<p>ä¸‹é¢ Guide ç»™å¤§å®¶è¯¦ç»†è§£è¯»ä¸€ä¸‹è¿™æ¬¡æ›´æ–°ã€‚</p>
<h2 data-id="heading-0"><strong>åˆ é™¤æ–‡ä»¶è¿›å›æ”¶ç«™</strong></h2>
<p>JetBrains ä¸€ç›´æ¨ Local Historyï¼Œä½†å®ƒåœ¨å®é™…ä½¿ç”¨ä¸­æœ‰å‡ ä¸ªç¡¬ä¼¤ï¼š</p>





























<table><thead><tr><th align="left">Local History</th><th align="left">ç³»ç»Ÿå›æ”¶ç«™</th></tr></thead><tbody><tr><td align="left">ä¼šè‡ªåŠ¨æ¸…ç†</td><td align="left">ä¿ç•™åˆ°ç”¨æˆ·æ¸…ç©º</td></tr><tr><td align="left">IDE å‡çº§å¯èƒ½ä¸¢å¤±</td><td align="left">è·¨ç‰ˆæœ¬ä¿ç•™</td></tr><tr><td align="left">æŸ¥æ‰¾æˆæœ¬é«˜</td><td align="left">å¯è§†åŒ–ï¼Œç›´è§‚</td></tr><tr><td align="left">Undo ä¸ä¸€å®šå¯ç”¨</td><td align="left">ç¬¦åˆç”¨æˆ·ç›´è§‰</td></tr><tr><td align="left">æ–°æ‰‹ä¸çŸ¥é“åœ¨å“ª</td><td align="left">ç³»ç»Ÿçº§æ“ä½œ</td></tr></tbody></table>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3d17953d583a40b18715c44ec2e756ef~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YUd1aWRl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771310924&amp;x-signature=aqSGV7PdJntQ37By%2BdElquNbilI%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c0dce887c2904deeb925025fe8678994~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YUd1aWRl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771310924&amp;x-signature=wcMnjdMB8Vmpv8ICPZLd5ZH%2FbnQ%3D" alt="" loading="lazy"/></p>
<p>VS Codeã€Sublime Text éƒ½é»˜è®¤èµ°ç³»ç»Ÿå›æ”¶ç«™â€”â€”å®ƒè§£å†³çš„æ˜¯æœ€å¸¸è§çš„ IDE äº‹æ•…ï¼šè¯¯åˆ æ–‡ä»¶ã€‚</p>
<p>ç°åœ¨ IDEA åˆ é™¤æ–‡ä»¶æ—¶ç›´æ¥ç§»åˆ°ç³»ç»Ÿå›æ”¶ç«™ï¼Œé…åˆ Local History å’Œ Git å½¢æˆä¸‰å±‚ä¿æŠ¤ï¼š</p>
<pre><code class="hljs language-sql" lang="sql">è¯¯åˆ æ–‡ä»¶ â†’ å›æ”¶ç«™
ç»†ç²’åº¦å›æ»š â†’ <span class="hljs-keyword">Local</span> History
é•¿æœŸç‰ˆæœ¬ â†’ Git
</code></pre>
<h2 data-id="heading-1"><strong>MCP æ·±åº¦é›†æˆ</strong></h2>
<p>è¿™æ¬¡æ›´æ–°å¯¹ Claude Code ç­‰ AI åŠ©æ‰‹ç”¨æˆ·å¾ˆé‡è¦ã€‚</p>
<p><strong>Roots å®¢æˆ·ç«¯èƒ½åŠ›</strong>ï¼šåœ¨å¤§å‹é¡¹ç›®ï¼ˆå°¤å…¶æ˜¯ Monorepoï¼‰ä¸­ï¼ŒAI åŠ©æ‰‹ä¼šå› è·¯å¾„æ·±åº¦è¿‡å¤§è€Œ"è¿·å¤±"ã€‚Roots èƒ½åŠ›è®© IDE å‘Šè¯‰ AI åŠ©æ‰‹å“ªäº›ç›®å½•æ˜¯é¡¹ç›®æ ¹ï¼Œå“ªäº›æ˜¯è¾¹ç•Œã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/83c2eb3f91004c389a87273c33bb2ca2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YUd1aWRl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771310924&amp;x-signature=m4A4jEXiWGCpCxAkp7SPlyrIscc%3D" alt="" loading="lazy"/></p>
<p>å¦å¤–ï¼Œ<code>replace_text_in_file</code> ä¿®å¤äº†å¤„ç†ç©ºæ–‡æœ¬æ—¶å¤±è´¥çš„é—®é¢˜â€”â€”è¿™æ”¹å–„äº† LLM "å…ˆåˆ›å»ºåå¡«å……"çš„å·¥ä½œæµç¨³å®šæ€§ã€‚</p>
<p><code>get_file_problems</code> å·¥å…·ä¹Ÿåšäº†ä¼˜åŒ–ï¼Œä¸å†æ¯æ¬¡è°ƒç”¨éƒ½è§¦å‘å…¨é‡é¡¹ç›®åˆ·æ–°ï¼Œå¤§å‹ Java é¡¹ç›®é‡Œå¡é¡¿æ„Ÿä¼šå°‘å¾ˆå¤šã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/701c86a34cb242da88b56cff4b7a6e19~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YUd1aWRl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771310924&amp;x-signature=vKrNIiPXZR1z9Acp7Y3waUo4oCA%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-2"><strong>Spring å¼€å‘ä½“éªŒ</strong></h2>
<h3 data-id="heading-3"><strong>SQL æ–¹è¨€è‡ªåŠ¨æ£€æµ‹</strong></h3>
<p>ä¹‹å‰å†™ MyBatis æˆ– JPAï¼ŒSQL è¯­æ³•é«˜äº®ç»å¸¸"å¤±çµ"ã€‚ç°åœ¨ IDEA èƒ½æ ¹æ®é¡¹ç›®ä¾èµ–è‡ªåŠ¨è¯†åˆ« SQL æ–¹è¨€ã€‚</p>
<h3 data-id="heading-4"><strong>Bean å†…è”æ˜¾ç¤º</strong></h3>
<p>è°ƒè¯•ä½“éªŒæœ‰æ”¹è¿›ã€‚ä¹‹å‰è¦çœ‹ Bean æ³¨å…¥äº†å“ªä¸ªå®ç°ç±»ï¼Œå¿…é¡»æ‰“æ–­ç‚¹æš‚åœã€‚ç°åœ¨éæš‚åœæ¨¡å¼ä¸‹ IDE ä¹Ÿèƒ½é€šè¿‡è°ƒè¯•å™¨åè®®è¯»å–è¿è¡Œæ—¶å®šä¹‰ï¼Œç›´æ¥åœ¨ä»£ç é‡Œæ˜¾ç¤ºã€‚</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> {
    <span class="hljs-comment">// æ³¨å…¥çš„ Bean ç°åœ¨å¯ä»¥ç›´æ¥çœ‹åˆ°ç±»å‹å’Œæ¥æº</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> UserRepository userRepository;
    <span class="hljs-comment">//                          ^^^^^^^^^^^^^^</span>
    <span class="hljs-comment">//                          [å†…è”æ˜¾ç¤ºBeanä¿¡æ¯]</span>
}
</code></pre>
<h3 data-id="heading-5"><strong>API ç‰ˆæœ¬æ§åˆ¶</strong></h3>
<p>ä¸º Spring API ç‰ˆæœ¬æ§åˆ¶æä¾›äº†é€‰æ‹©ç‰ˆæœ¬è§£æå™¨çš„èƒ½åŠ›ï¼Œå¤šç‰ˆæœ¬ API ç»´æŠ¤åœºæ™¯ä¼šç”¨åˆ°ã€‚</p>
<h2 data-id="heading-6"><strong>Git Worktree æ”¯æŒ</strong></h2>
<h3 data-id="heading-7"><strong>Worktree æ˜¯ä»€ä¹ˆ</strong></h3>
<p>ä¼ ç»Ÿ <code>git checkout</code> åˆ‡æ¢åˆ†æ”¯ä¼šæ”¹åŠ¨å½“å‰ <code>src</code> ç›®å½•ï¼Œç¼–è¯‘å™¨é¢‘ç¹é‡æ–°ç´¢å¼•ã€‚</p>
<pre><code class="hljs language-perl" lang="perl">git checkout hotfix â†’ æ”¹ä»£ç  â†’ commit â†’ stash
git checkout feature â†’ git stash <span class="hljs-keyword">pop</span>
</code></pre>
<p>æ¥å›åˆ‡ï¼Œå®¹æ˜“ stash å¿˜è®° popã€‚</p>
<p>Git Worktree åœ¨åŒä¸€ä¸ªä»“åº“ä¸‹åˆ›å»ºå¤šä¸ªå·¥ä½œç›®å½•ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ce61fa3d0ecf4b4fb7397c483f8762b4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YUd1aWRl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771310924&amp;x-signature=TFMpE%2Bi6hoYzkKs5U3t7zXR2mxk%3D" alt="" loading="lazy"/></p>
<pre><code class="hljs language-bash" lang="bash">git worktree add ../project-hotfix hotfix-branch
git worktree add ../project-feature feature-branch
</code></pre>
<p>ç°åœ¨ä½ æœ‰ä¸‰ä¸ªç›®å½•ï¼Œå„è‡ªç‹¬ç«‹ï¼Œåˆ‡æ¢æˆæœ¬æ¥è¿‘é›¶ã€‚</p>
<pre><code class="hljs language-bash" lang="bash">project/          <span class="hljs-comment"># ä¸»åˆ†æ”¯</span>
project-hotfix/   <span class="hljs-comment"># hotfix åˆ†æ”¯</span>
project-feature/  <span class="hljs-comment"># feature åˆ†æ”¯</span>
</code></pre>
<h3 data-id="heading-8"><strong>IDEA çš„é›†æˆ</strong></h3>
<p>2026.1 EAP 3 å¢åŠ äº† Git Worktree æ³¨å†Œè¡¨å¼€å…³ï¼Œæ”¯æŒåœ¨ Git å†å²è§†å›¾ä¸­ç›´æ¥è¿›è¡Œ "fixup" æ“ä½œã€‚</p>

























<table><thead><tr><th align="left">åœºæ™¯</th><th align="left">ä¼ ç»Ÿæ–¹å¼</th><th align="left">Worktree</th></tr></thead><tbody><tr><td align="left">çƒ­ä¿® + å¼€å‘</td><td align="left">stash/commit åˆ‡æ¢</td><td align="left">ä¸¤ä¸ªç›®å½•ï¼Œäº’ä¸å¹²æ‰°</td></tr><tr><td align="left">ä»£ç è¯„å®¡</td><td align="left">åˆ‡åˆ†æ”¯çœ‹</td><td align="left">å•ç‹¬ worktree éªŒè¯</td></tr><tr><td align="left">å¤šç‰ˆæœ¬ç¼–è¯‘</td><td align="left">å¤šæ¬¡å…‹éš†</td><td align="left">å…±äº« .gitï¼Œçœç©ºé—´</td></tr></tbody></table>
<p>é…åˆ Claude Code ç­‰å·¥å…·æ—¶ï¼ŒWorktree æ›´æœ‰ç”¨â€”â€”æ¯ä¸ªä¼šè¯å¯¹åº”ä¸€ä¸ª worktreeï¼Œä¸Šä¸‹æ–‡å®Œå…¨éš”ç¦»ã€‚</p>
<p>è¿™æ„å‘³ç€åç»­ä¸éœ€è¦å†é¢å¤–å®‰è£… IDEA Git Worktree æ’ä»¶äº†ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f6be08c68ad24159a9a58d6394fbdb49~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YUd1aWRl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771310924&amp;x-signature=FfQVxtvUNZrcs%2BSh0gOeuqY9WN4%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-9"><strong>ç¼–è¾‘å™¨ä½“éªŒ</strong></h2>
<p>è¿™æ¬¡åŠ å…¥äº†å¹³æ»‘å…‰æ ‡åŠ¨ç”»å’Œåœ†è§’è®¾è®¡ã€‚æ¸²æŸ“å±‚é¢çš„ä¼˜åŒ–ï¼Œè¿ç»­ç¼–ç å‡ å°æ—¶åçœ¼ç›ç–²åŠ³æ„Ÿä¼šå°‘ä¸€äº›ã€‚</p>
<p><strong>ç»ˆç«¯ä¿®å¤</strong>ï¼š</p>
<ul>
<li>Esc é”®é€»è¾‘ï¼šåœ¨ç»ˆç«¯ç”¨ Claude Code æ—¶æŒ‰ Esc ä¸ä¼šå†è·³è½¬ç„¦ç‚¹å›ç¼–è¾‘å™¨</li>
<li>Vi æ¨¡å¼ï¼šIDE ç»ˆç«¯çš„ Vi æ¨¡å¼ç°åœ¨èƒ½æ­£ç¡®æ¿€æ´»</li>
</ul>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fjavaguide.cn%2Fzhuanlan%2Finterview-guide.html" target="_blank" title="https://javaguide.cn/zhuanlan/interview-guide.html" ref="nofollow noopener noreferrer">ã€ŠSpringAI æ™ºèƒ½é¢è¯•å¹³å°+RAG çŸ¥è¯†åº“ã€‹</a>é…å¥—å®æˆ˜é¡¹ç›®æ•™ç¨‹æ­£åœ¨æ›´æ–°ï¼Œæ¶‰åŠåˆ° Prompt Engineeringã€å¤§æ¨¡å‹é›†æˆã€RAGï¼ˆæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰ã€é«˜æ€§èƒ½å¯¹è±¡å­˜å‚¨ä¸å‘é‡æ•°æ®åº“ã€‚åç»­çš„è¯ï¼Œè¿˜ä¼šåŒæ­¥ä¸ŠAgent é¡¹ç›®ã€‚</p>
<p>å†…å®¹éå¸¸å…¨é¢ï¼Œéå¸¸é€‚åˆæƒ³è¦å®æˆ˜ AI é¡¹ç›®æˆ–è€…å‡†å¤‡ AI å¤§æ¨¡å‹åº”ç”¨å¼€å‘å²—ä½é¢è¯•çš„æœ‹å‹ï¼Œæ¥ä¸€å¼ åˆšå†™å®Œçš„<strong>3.4w å­—+35 é“é¢˜ç›®</strong>çš„ RAG é¢è¯•é¢˜æ€»ç»“ï¼Œå¤§å®¶æ„Ÿå—ä¸€ä¸‹ï¼ˆç‚¹æ­¤é“¾æ¥äº†è§£ï¼š <a href="https://link.juejin.cn?target=https%3A%2F%2Fjavaguide.cn%2Fabout-the-author%2Fzhishixingqiu-two-years.html" target="_blank" title="https://javaguide.cn/about-the-author/zhishixingqiu-two-years.html" ref="nofollow noopener noreferrer">æ˜Ÿçƒ</a>ï¼‰ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a2af5100c5b24c3ab16f7594c526b1e3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YUd1aWRl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771310924&amp;x-signature=Xuj3ozj0KU1HiwACU5bq8uLqITY%3D" alt="RAG é¢è¯•é¢˜" loading="lazy"/></p>
<h2 data-id="heading-10"><strong>å…¶ä»–æ”¹åŠ¨</strong></h2>
<h3 data-id="heading-11"><strong>HTTP Client</strong></h3>
<ul>
<li>ä¿®å¤äº† Multipart è¯·æ±‚å¤šä¸ªæ–‡ä»¶åŒåçš„é—®é¢˜</li>
<li>RSA/DSA ç®—æ³•ç¼ºå¤±å‚æ•°æ—¶æœ‰æ¸…æ™°æŠ¥é”™</li>
<li>RS512 JWT ç­¾åæ”¯æŒä¿®å¤</li>
</ul>
<h3 data-id="heading-12"><strong>å®¹å™¨ä¸äº‘</strong></h3>
<ul>
<li>Docker over SSH è¿æ¥å¤±è´¥é—®é¢˜ä¿®å¤</li>
<li>Docker Compose Linux ä¸‹ UID æ›´æ–°é—®é¢˜ä¿®å¤</li>
<li>Kubernetes æµ®åŠ¨å·¥å…·æ æ”¯æŒæ”¶è—å‘½åç©ºé—´ç½®é¡¶</li>
</ul>
<h3 data-id="heading-13"><strong>Java &amp; Kotlin</strong></h3>
<ul>
<li>ç»ˆç«¯ javac è¡¥å…¨æ”¯æŒæ ‡å‡†å’Œé¢å¤–é€‰é¡¹</li>
<li>ImportHelper ä¼˜åŒ–ï¼Œå¯¼å…¥é€Ÿåº¦æå‡</li>
<li>Kotlin Maven å¯ç”¨å•ä¸€å±æ€§æŒ‡å®šç‰ˆæœ¬</li>
<li>K2 IDE å¢åŠ æ„é€ å‡½æ•°å‚æ•°å±æ€§æ£€æŸ¥</li>
</ul>
<h2 data-id="heading-14"><strong>æ€»ç»“</strong></h2>
<p>è¿™æ¬¡ 2026.1 EAP 3 æ²¡æœ‰ä»€ä¹ˆ"å¤§åŠŸèƒ½"ï¼Œä½†æ¯é¡¹æ”¹åŠ¨éƒ½è§£å†³äº†ä¸€ä¸ªçœŸå®ç—›ç‚¹ã€‚</p>
<p>åˆ é™¤æ–‡ä»¶èµ°å›æ”¶ç«™ï¼Œè¿™ä¸ªæ”¹åŠ¨ JetBrains æƒ³äº†äºŒåå¹´æ‰åšã€‚æœ‰æ—¶å€™ï¼Œæœ€å¥½çš„åˆ›æ–°ä¸æ˜¯æ·»åŠ æ–°åŠŸèƒ½ï¼Œè€Œæ˜¯ä¿®æ­£ä¸€ä¸ªé•¿æœŸå­˜åœ¨çš„é”™è¯¯å†³ç­–ã€‚</p>
<p>å¦‚æœä½ åœ¨ç”¨ EAPï¼Œè¿™æ¬¡å€¼å¾—å‡çº§ã€‚ç¨³å®šç‰ˆç”¨æˆ·å¯ä»¥ç­‰ 2026.1 æ­£å¼ç‰ˆã€‚</p>
<p><strong>â­ï¸æ¨è</strong>:</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fjavaguide.cn%2Fhome.html" target="_blank" title="https://javaguide.cn/home.html" ref="nofollow noopener noreferrer">Java é¢è¯• &amp; åç«¯é€šç”¨é¢è¯•æŒ‡å—</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fjavaguide.cn%2Fzhuanlan%2Finterview-guide.html" target="_blank" title="https://javaguide.cn/zhuanlan/interview-guide.html" ref="nofollow noopener noreferrer">ã€ŠSpringAI æ™ºèƒ½é¢è¯•å¹³å°+RAG çŸ¥è¯†åº“ã€‹</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fjavaguide.cn%2Finterview-preparation%2Fjava-roadmap.html" target="_blank" title="https://javaguide.cn/interview-preparation/java-roadmap.html" ref="nofollow noopener noreferrer">Java å­¦ä¹ è·¯çº¿(æœ€æ–°ç‰ˆï¼Œ4w+å­—)</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fjavaguide.cn%2Finterview-preparation%2Fpdf-interview-javaguide.html" target="_blank" title="https://javaguide.cn/interview-preparation/pdf-interview-javaguide.html" ref="nofollow noopener noreferrer">åç«¯é¢è¯• PDF æœ€æ–°ç‰ˆ</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ç¾å›¢å‘å¸ƒåŸºäº N-gram å…¨æ–°æ¨¡å‹ï¼šåµŒå…¥æ‰©å±•æ–°èŒƒå¼ï¼Œå®ç°è½»é‡åŒ– MoE é«˜æ•ˆè¿›åŒ–]]></title>    <link>https://juejin.cn/post/7604801893529616427</link>    <guid>https://juejin.cn/post/7604801893529616427</guid>    <pubDate>2026-02-10T06:59:36.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604801893529616427" data-draft-id="7604775190213050378" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ç¾å›¢å‘å¸ƒåŸºäº N-gram å…¨æ–°æ¨¡å‹ï¼šåµŒå…¥æ‰©å±•æ–°èŒƒå¼ï¼Œå®ç°è½»é‡åŒ– MoE é«˜æ•ˆè¿›åŒ–"/> <meta itemprop="keywords" content="ç®—æ³•"/> <meta itemprop="datePublished" content="2026-02-10T06:59:36.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç¾å›¢æŠ€æœ¯å›¢é˜Ÿ"/> <meta itemprop="url" content="https://juejin.cn/user/3509296845313741"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ç¾å›¢å‘å¸ƒåŸºäº N-gram å…¨æ–°æ¨¡å‹ï¼šåµŒå…¥æ‰©å±•æ–°èŒƒå¼ï¼Œå®ç°è½»é‡åŒ– MoE é«˜æ•ˆè¿›åŒ–
            <!----> <!----></h1> <div class="container team-follow" data-v-d326b38e="" data-v-61fb5e44=""><div class="left" data-v-d326b38e=""><a href="/team/6930512966122995712/posts" data-v-d326b38e=""><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/47ccb42d726640a7889ba1e64ae203e6~tplv-k3u1fbpfcp-watermark.image" class="icon" data-v-d326b38e=""/></a> <div class="content" data-v-d326b38e=""><div style="display: flex" data-v-d326b38e=""><a href="/team/6930512966122995712/posts" data-v-d326b38e=""><p class="title-line" data-v-d326b38e=""><span title="ç¾å›¢æŠ€æœ¯å›¢é˜Ÿ" class="title" data-v-d326b38e="">ç¾å›¢æŠ€æœ¯å›¢é˜Ÿ</span> <img src="//lf-web-assets.juejin.cn/obj/juejin-web/xitu_juejin_web/255e400027b783cbad76dc41527e7695.svg" alt="team icon" class="team-icon" data-v-d326b38e=""/></p></a></div> <div class="meta-box team" data-v-d326b38e="" data-v-61fb5e44=""><time datetime="2026-02-10T06:59:36.000Z" title="Tue Feb 10 2026 06:59:36 GMT+0000 (Coordinated Universal Time)" class="time" data-v-d326b38e="" data-v-61fb5e44="">
                2026-02-10
              </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-d326b38e="" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-d326b38e="" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-d326b38e="" data-v-61fb5e44=""/></svg> <span class="views-count" style="display:none;" data-v-d326b38e="" data-v-61fb5e44="">
                0
              </span> <span class="read-time" data-v-d326b38e="" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-d326b38e="" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-d326b38e="" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-d326b38e="" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-d326b38e="" data-v-61fb5e44=""/></svg>
                é˜…è¯»7åˆ†é’Ÿ
              </span> <!----> <!----></div></div></div> <button class="jj-follow-button follow-btn" style="display:none;" data-v-b60b2868="" data-v-d326b38e=""><span data-v-b60b2868="" data-v-d326b38e=""><i class="byte-icon byte-icon--plus" data-v-d326b38e=""><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 48 48"><path fill="none" d="M0 0h48v48H0z"/><path d="M24.7 4c.4 0 .6 0 .8.1.2.1.3.2.4.4.1.2.1.3.1.8V22h16.7c.4 0 .6 0 .8.1.2.1.3.2.4.4.1.2.1.3.1.8v1.4c0 .4 0 .6-.1.8-.1.2-.2.3-.4.4-.2.1-.3.1-.8.1H26v16.7c0 .4 0 .6-.1.8-.1.2-.2.3-.4.4-.2.1-.3.1-.8.1h-1.4c-.4 0-.6 0-.8-.1-.2-.1-.3-.2-.4-.4-.1-.2-.1-.3-.1-.8V26H5.3c-.4 0-.6 0-.8-.1-.2-.1-.3-.2-.4-.4-.1-.2-.1-.3-.1-.8v-1.4c0-.4 0-.6.1-.8.1-.2.2-.3.4-.4.2-.1.3-.1.8-.1H22V5.3c0-.4 0-.6.1-.8.1-.2.2-.3.4-.4.2-.1.3-.1.8-.1h1.4z"/></svg></i>
        å…³æ³¨
      </span></button></div> <div class="team-user block-hidden" data-v-61fb5e44=""><div class="avatar jj-avatar avatar" data-v-03256cc6="" data-v-61fb5e44=""><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8AQMAAAAAMksxAAAAA1BMVEUAAACnej3aAAAAAXRSTlMAQObYZgAAAA5JREFUKM9jGAWjAAcAAAIcAAE27nY6AAAAAElFTkSuQmCC" alt="avatar" class="lazy avatar-img" data-v-5244ef91="" data-v-03256cc6=""/> </div> <!----> <span class="position ellipsis" data-v-61fb5e44="">
              ç¾å›¢å°ç¼– @ç¾å›¢
            </span></div> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/80e0ae807d9d41adb63a6211ab993b57~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg576O5Zui5oqA5pyv5Zui6Zif:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771311578&amp;x-signature=F1XHf3Ypzo4AFxaxP8v3wPrT2WQ%3D" alt="" loading="lazy"/></p>
<p>ä¼ ç»Ÿ MoE æ¶æ„é€šå¸¸é€šè¿‡å¢åŠ ä¸“å®¶æ•°é‡æ¥æå‡æ¨¡å‹èƒ½åŠ›ï¼Œä½†éšç€ä¸“å®¶æ•°é‡å¢åŠ ï¼Œä¼šé¢ä¸´è¾¹é™…æ”¶ç›Šé€’å‡å’Œç³»ç»Ÿé€šä¿¡å¼€é”€ä¸Šå‡ç­‰é—®é¢˜ã€‚ç¾å›¢ LongCat å›¢é˜Ÿé€šè¿‡å…¨é¢çš„åˆ†æä¸å®éªŒå‘ç°ï¼šåµŒå…¥æ‰©å±•ç›¸æ¯”ä¸“å®¶æ‰©å±•èƒ½è·å¾—æ›´ä¼˜çš„å¸•ç´¯æ‰˜å‰æ²¿ã€‚è¿™æ„å‘³ç€åµŒå…¥æ‰©å±•åœ¨ç‰¹å®šæ¡ä»¶ä¸‹ç›¸æ¯”ä¸“å®¶æ‰©å±•èƒ½å®ç°æ›´ä¼˜çš„æ•ˆèƒ½è¾¹ç•Œã€‚</p>
<p>åŸºäºè¿™äº›æ´è§ï¼Œæˆ‘ä»¬æ­£å¼æ¨å‡ºÂ LongCat-Flash-Liteâ€”â€”ä¸€æ¬¾æ‹¥æœ‰ 685 äº¿å‚æ•°ï¼Œæ¯æ¬¡æ¨ç†ä»…æ¿€æ´»29äº¿ ~ 45äº¿å‚æ•°çš„è½»é‡åŒ– MoE æ¨¡å‹ã€‚é€šè¿‡å°†è¶…è¿‡ 300 äº¿å‚æ•°é«˜æ•ˆç”¨äºåµŒå…¥å±‚ï¼ŒLongCat-Flash-Lite ä¸ä»…è¶…è¶Šäº†å‚æ•°é‡ç­‰æ•ˆçš„ MoE åŸºçº¿æ¨¡å‹ï¼Œè¿˜åœ¨ä¸åŒè§„æ¨¡ç°æœ‰æ¨¡å‹çš„å¯¹æ¯”ä¸­å±•ç°å‡ºå“è¶Šçš„ç«äº‰åŠ›ï¼Œå°¤å…¶åœ¨æ™ºèƒ½ä½“ä¸ä»£ç é¢†åŸŸè¡¨ç°çªå‡ºï¼Œå¹¶ä¾æ‰˜ YARN æŠ€æœ¯å¯æ”¯æŒæœ€é•¿ 256 Kä¸Šä¸‹æ–‡ï¼Œèƒ½é«˜æ•ˆå¤„ç†é•¿æ–‡æ¡£ã€å¤§è§„æ¨¡ä»£ç åˆ†æç­‰åœºæ™¯ã€‚åŒæ—¶ï¼Œè¯¥æ¨¡å‹åŸºäºåµŒå…¥æ‰©å±•çš„åº”ç”¨ä¸ç³»ç»Ÿçº§ä¼˜åŒ–ï¼Œè®©æ¨¡å‹æ¨ç†æ•ˆç‡å¤§å¹…æå‡ï¼Œåœ¨è¾“å…¥ 4Kï¼Œè¾“å‡º 1k çš„å…¸å‹è´Ÿè½½ä¸‹ï¼ŒLongCat APIÂ å¯æä¾› 500-700 token/s çš„ç”Ÿæˆé€Ÿåº¦ã€‚</p>
<h2 data-id="heading-0">01 æ›´ä¼˜çš„æ‰©å±•æ•ˆç‡ï¼šä»â€œå †ä¸“å®¶â€åˆ°â€œæ‰©åµŒå…¥â€</h2>
<p>N-gramåµŒå…¥å±‚çš„æ ¸å¿ƒä½œç”¨åœ¨äºå¢å¼ºæ¨¡å‹å¯¹å±€éƒ¨ä¸Šä¸‹æ–‡è¯­ä¹‰çš„æ•è·èƒ½åŠ›ã€‚å®ƒé€šè¿‡å“ˆå¸Œå‡½æ•°ï¼Œå°†å½“å‰tokenåŠå…¶å‰åºçš„N-1ä¸ªtokenæ‰€æ„æˆçš„åºåˆ—æ˜ å°„ä¸ºä¸€ä¸ªæ•´ä½“çš„N-gramåµŒå…¥å‘é‡ï¼Œå¹¶ä¸è¯¥tokençš„åŸºç¡€åµŒå…¥å‘é‡èåˆã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå½“æ¨¡å‹çœ‹åˆ° â€œæ‰“å¼€ç»ˆç«¯è¾“å…¥å‘½ä»¤â€ï¼Œå°±ä¸ä¼šè¯¯è§£æˆæ—¥å¸¸çš„ â€œæ‰“å¼€æ–‡ä»¶â€ï¼Œè€Œæ˜¯èƒ½ç²¾å‡†é”å®š â€œç¼–ç¨‹â€ è¿™ä¸ªåœºæ™¯ï¼Œæ˜¾è‘—æå‡äº†è¯­ä¹‰ç†è§£çš„ç²¾å‡†åº¦ã€‚</p>
<p>åœ¨ç”ŸæˆN-gramåµŒå…¥å‘é‡çš„è¿‡ç¨‹ä¸­ï¼Œå…³é”®æŒ‘æˆ˜åœ¨äºé¿å…å“ˆå¸Œå†²çªï¼Œå³ä¸åŒçš„N-gramåºåˆ—è¢«æ˜ å°„åˆ°åŒä¸€ä¸ªå‘é‡ã€‚ä¸ºæ­¤ï¼ŒLongCatå›¢é˜Ÿé‡‡ç”¨äº†ä¸¤ä¸ªå…³é”®è®¾è®¡ï¼š</p>
<ul>
<li><strong>å­è¡¨åˆ†è§£ä¸çº¿æ€§æŠ•å½±</strong>ï¼šå°†å¤§å‹çš„N-gramåµŒå…¥è¡¨æ‹†åˆ†ä¸ºå¤šä¸ªå­è¡¨ï¼Œå¹¶åˆ†åˆ«è¿›è¡Œçº¿æ€§æŠ•å½±å˜æ¢ï¼Œæ­¤ä¸¾å¯å¤§å¹…é™ä½å“ˆå¸Œç¢°æ’çš„æ¦‚ç‡ã€‚</li>
<li><strong>è¯æ±‡è¡¨å¤§å°é¿å‘</strong>ï¼šN-gramåµŒå…¥è¡¨çš„è¯æ±‡è¡¨å¤§å°éœ€è¦ä»”ç»†è®¾è®¡ä»¥é™ä½å“ˆå¸Œç¢°æ’ç‡ã€‚æ­¤å¤–ï¼Œé€šè¿‡å¼•å…¥åµŒå…¥æ”¾å¤§æŠ€æœ¯ï¼ˆå¦‚åœ¨è¾“å‡ºå‰æ·»åŠ ç¼©æ”¾å› å­æˆ–å±‚å½’ä¸€åŒ–ï¼‰ï¼Œç¡®ä¿äº†åµŒå…¥å±‚æä¾›çš„è¯­ä¹‰ä¿¡å·åœ¨æ·±å±‚ç½‘ç»œçš„æ®‹å·®è¿æ¥ä¸­ä¸ä¼šè¢«æ³¨æ„åŠ›æ¨¡å—çš„è¾“å‡ºæ‰€æ·¹æ²¡ï¼Œä»è€Œä¿éšœäº†å…¶è´¡çŒ®åœ¨æ•´ä¸ªå‰å‘ä¼ æ’­è¿‡ç¨‹ä¸­çš„æœ‰æ•ˆæ€§ã€‚</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/672908fdd97842119c94923601ad0770~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg576O5Zui5oqA5pyv5Zui6Zif:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771311578&amp;x-signature=Sm3ktzB7QqRV%2BOK4kLu6IRPWZa8%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-1">02 å“è¶Šçš„æ¨ç†æ•ˆç‡ï¼šä¸‰é‡ä¼˜åŒ–å®ç°æè‡´åŠ é€Ÿ</h2>
<p>N-gram åµŒå…¥å±‚ä¸ä»…èƒ½æå‡æ¨¡å‹èƒ½åŠ›ï¼Œå…¶ç»“æ„ç‰¹æ€§è¿˜ä¸ºæ¨ç†åŠ é€Ÿæä¾›äº†æ–°æ–¹å‘ã€‚å°½ç®¡æ¨¡å‹æ€»å‚æ•°é‡è¾¾ 685 äº¿ï¼Œä½†é€šè¿‡åŠ¨æ€æ¿€æ´»æœºåˆ¶ï¼Œæ¯æ¬¡æ¨ç†ä»…æ¿€æ´»29äº¿ï½45äº¿å‚æ•°ã€‚ä¸ºè¿›ä¸€æ­¥æ”¾å¤§è¿™ä¸€ç¨€ç–ä¼˜åŠ¿ï¼Œæˆ‘ä»¬åœ¨ç³»ç»Ÿå±‚é¢è¿›è¡Œäº†ä¸‰é‡æ ¸å¿ƒä¼˜åŒ–ï¼š</p>
<ul>
<li><strong>å‚æ•°æ™ºèƒ½åˆ†é…</strong>ï¼šæˆ‘ä»¬å°† 31.4B å‚æ•°ï¼ˆå æ€»å‚æ•° 46%ï¼‰æŠ•å…¥ N-gram åµŒå…¥å±‚ã€‚ç›¸è¾ƒäºå•çº¯å¢åŠ  MoE ä¸“å®¶æ•°é‡ï¼Œæ­¤æ–¹æ¡ˆåœ¨è¾¾åˆ°é«˜æ¨¡å‹ç¨€ç–åº¦åï¼Œæ—¢èƒ½æœ‰æ•ˆå‡å°‘ä¸“å®¶æ¨¡å—é—´çš„é€šä¿¡ä¸è°ƒåº¦å¼€é”€ï¼Œåˆå¾—ç›ŠäºåµŒå…¥å±‚ O(1) çš„æŸ¥æ‰¾å¤æ‚åº¦ï¼Œé¿å…äº†å‚æ•°æ‰©å®¹å¸¦æ¥çš„è®¡ç®—çº¿æ€§å¢é•¿ã€‚</li>
<li><strong>ä¸“ç”¨ç¼“å­˜ä¸å†…æ ¸ä¼˜åŒ–</strong>ï¼šæˆ‘ä»¬è®¾è®¡äº† N-gram Cache ä¸“ç”¨ç¼“å­˜æœºåˆ¶ï¼ˆçµæ„ŸæºäºKV Cacheï¼‰ï¼Œç›´æ¥åœ¨GPUè®¾å¤‡ä¸Šç®¡ç† N-gram IDï¼Œä¸æ¨ç†æ¡†æ¶ä¸­å¤æ‚çš„åŠ¨æ€è°ƒåº¦é€»è¾‘å®ç°ä½å¼€é”€åŒæ­¥ï¼Œå¤§å¹…é™ä½åµŒå…¥æŸ¥æ‰¾çš„I/Oå»¶è¿Ÿã€‚åŒæ—¶ï¼Œé€šè¿‡å®šåˆ¶CUDAå†…æ ¸åŠå¹¿æ³›çš„å†…æ ¸èåˆï¼ˆå¦‚ AllReduce+Residual Add+RMSNormã€è·¯ç”±å™¨Logitsçš„Softmax+TopK+Scalingèåˆï¼‰ä¸ PDLï¼ˆProgrammatic Dependent Launchï¼‰ ç­‰æŠ€æœ¯ï¼Œæå‡GPUå ç”¨ç‡ï¼Œå‡å°‘å†…æ ¸å¯åŠ¨é—´éš™ã€‚</li>
<li><strong>æ¨æµ‹è§£ç ååŒ</strong>ï¼šä¸ºå……åˆ†å‘æŒ¥ç¨€ç–æ¿€æ´»ä¼˜åŠ¿ï¼Œæˆ‘ä»¬å°†å…¶ä¸ æ¨æµ‹è§£ç  ç­–ç•¥æ·±åº¦ååŒã€‚é€šè¿‡3æ­¥çš„æŠ•æœºæ¨ç†ï¼Œæ‰©å¤§äº†å®é™…çš„æ‰¹æ¬¡å¤§å°ï¼Œåˆ©ç”¨åˆ°äº†ä½æ¿€æ´»æ€»å‚çš„ç‰¹æ€§ï¼ŒåŒæ—¶é’ˆå¯¹è‰æ¡ˆæ¨¡å‹ï¼ˆdraft modelï¼‰å»¶è¿Ÿæ•æ„Ÿçš„ç‰¹æ€§ï¼Œè®©å…¶ä½¿ç”¨å¸¸è§„åµŒå…¥å±‚ä»¥è§„é¿N-gramæŸ¥æ‰¾è®¡ç®—çš„å¼€é”€ï¼Œè¿›ä¸€æ­¥æå‡äº†æ¨ç†æ€§èƒ½ã€‚</li>
</ul>
<p>æ€»ç»“è€Œè¨€ï¼Œé€šè¿‡å‚æ•°é‡åˆ†é…å¥ å®šç¨€ç–åŸºç¡€ã€ä¸“ç”¨ç¼“å­˜ä¸å†…æ ¸ä¼˜åŒ–æ¶ˆé™¤ç³»ç»Ÿå¼€é”€ã€ä¸æ¨æµ‹è§£ç ç­–ç•¥æ·±åº¦ååŒï¼ŒLongCat-Flash-Lite å®ç°äº†ä»æ¨¡å‹ç»“æ„åˆ°è¿è¡Œæ—¶ç³»ç»Ÿçš„å‚ç›´ä¼˜åŒ–ï¼Œæœ€ç»ˆå°† N-gram åµŒå…¥å¸¦æ¥çš„ç†è®ºä¼˜åŠ¿ï¼Œæœ‰æ•ˆè½¬åŒ–ä¸ºé«˜ååã€ä½å»¶è¿Ÿçš„å®é™…æ¨ç†æ€§èƒ½ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/350367a6592b4caf959cdeef1f39dc87~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg576O5Zui5oqA5pyv5Zui6Zif:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771311578&amp;x-signature=CnlawPkKuFAXHJPcEKiAG0Q5Rek%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-2">03 æ€§èƒ½è¡¨ç°ï¼šæ™ºèƒ½ä½“å·¥å…·ä½¿ç”¨ä¸ç¼–ç¨‹èƒ½åŠ›åŒé¢†å…ˆ</h2>
<p>LongCat-Flash-Lite åœ¨æ™ºèƒ½ä½“å·¥å…·ä½¿ç”¨ä¸ç¼–ç¨‹ä»»åŠ¡ä¸Šå‡å±•ç°å‡ºé¢†å…ˆæ€§èƒ½ï¼šÏ„Â²-Bench ä¸‰å¤§è¡Œä¸šåœºæ™¯é«˜åˆ†é¢†å…ˆï¼Œç¼–ç¨‹é¢†åŸŸè¦†ç›–å…¨é“¾è·¯èƒ½åŠ›ï¼Œåœ¨ä»£ç ä¿®å¤ã€ç»ˆç«¯æ‰§è¡Œã€å¤šè¯­è¨€å¼€å‘ç­‰ä»»åŠ¡ä¸Šè¡¨ç°ä¼˜å¼‚ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ef32e62b2a2b4c1f91bc57b2c3e64908~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg576O5Zui5oqA5pyv5Zui6Zif:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771311578&amp;x-signature=tIzDYhZYDkJ2F50weSuyxsAVo5Y%3D" alt="" loading="lazy"/></p>
<p><strong>æ™ºèƒ½ä½“ä»»åŠ¡è¡¨ç°</strong></p>
<p>åœ¨è¯„ä¼°å¤æ‚å·¥å…·ä½¿ç”¨ä¸å·¥ä½œæµæ‰§è¡Œçš„åŸºå‡†ä¸Šï¼Œæ¨¡å‹è¡¨ç°çªå‡ºï¼š</p>
<ul>
<li><strong>Ï„Â²-Benchè¡Œä¸šåœºæ™¯</strong>ï¼šåœ¨ç”µä¿¡ï¼ˆ72.8åˆ†ï¼‰ã€é›¶å”®ï¼ˆ73.1åˆ†ï¼‰ã€èˆªç©ºï¼ˆ58.0åˆ†ï¼‰ä¸‰å¤§å­åœºæ™¯ä¸­å‡å–å¾—æœ€é«˜åˆ†ï¼Œè¡¨æ˜å…¶èƒ½æœ‰æ•ˆç†è§£å¹¶æ‰§è¡Œæ¶‰åŠä¸“ä¸šå·¥å…·çš„å¤æ‚æŒ‡ä»¤ã€‚</li>
<li><strong>VitaBenché€šç”¨åœºæ™¯</strong>ï¼šä»¥7.0åˆ†é¢†å…ˆäºå¯¹æ¯”æ¨¡å‹ï¼ŒéªŒè¯äº†å…¶åœ¨å¤šæ ·åŒ–ç°å®ä»»åŠ¡ä¸­çš„å®ç”¨å·¥å…·è°ƒç”¨èƒ½åŠ›ã€‚</li>
</ul>
<p><strong>ä»£ç ä»»åŠ¡è¡¨ç°</strong></p>
<p>åœ¨è¡¡é‡ç¼–ç¨‹å®ç”¨æŠ€èƒ½çš„åŸºå‡†ä¸Šï¼Œæ¨¡å‹å±•ç°å‡ºå¼ºåŠ²çš„é—®é¢˜è§£å†³èƒ½åŠ›ï¼š</p>
<ul>
<li><strong>ä»£ç ä¿®å¤ï¼ˆSWE-Benchï¼‰</strong>ï¼š54.4%çš„å‡†ç¡®ç‡æ˜¾è‘—é¢†å…ˆäºåŒè§„æ¨¡å¯¹æ¯”æ¨¡å‹ï¼Œè¯æ˜å…¶å¤„ç†çœŸå®è½¯ä»¶å·¥ç¨‹é—®é¢˜ï¼ˆå¦‚ä¿®å¤bugã€å®ç°ç‰¹æ€§ï¼‰çš„æœ‰æ•ˆæ€§ã€‚</li>
<li><strong>ç»ˆç«¯å‘½ä»¤æ‰§è¡Œï¼ˆTerminalBenchï¼‰</strong>ï¼š33.75åˆ†çš„è¡¨ç°è¿œè¶…å¯¹æ¯”æ¨¡å‹æ‰€å¤„çš„15-20åˆ†åŒºé—´ï¼Œä½“ç°äº†å¯¹å¼€å‘è€…å·¥ä½œæµä¸­å‘½ä»¤è¡Œæ“ä½œçš„é«˜ç²¾åº¦ç†è§£ã€‚</li>
<li><strong>å¤šè¯­è¨€ä»£ç ç”Ÿæˆï¼ˆSWE-Bench Multilingualï¼‰</strong>ï¼š38.10%çš„å‡†ç¡®ç‡å±•ç°äº†è·¨ç¼–ç¨‹è¯­è¨€ä¸è½¯ä»¶ç”Ÿæ€çš„è¾ƒå¥½æ³›åŒ–èƒ½åŠ›ã€‚</li>
</ul>
<p><strong>é€šç”¨çŸ¥è¯†åŠæ¨ç†èƒ½åŠ›</strong></p>
<p>æ¨¡å‹åœ¨ç»¼åˆè¯„ä¼°ä¸­ä¿æŒäº†ä¸è§„æ¨¡ç›¸åŒ¹é…çš„å‡è¡¡æ€§èƒ½ï¼š</p>
<ul>
<li><strong>ç»¼åˆçŸ¥è¯†ï¼ˆMMLUï¼‰</strong>ï¼š85.52åˆ†ï¼Œä¸Gemini 2.5 Flash-Liteï¼ˆ84.68ï¼‰ç›¸å½“ã€‚</li>
<li><strong>ä¸­æ–‡ç†è§£ï¼ˆC-Eval &amp; CMMLUï¼‰</strong>ï¼šåˆ†åˆ«å–å¾—86.55åˆ†ä¸82.48åˆ†ï¼Œåœ¨ä¸­æ–‡è¯„ä¼°ä¸­å…·å¤‡ä¸€å®šä¼˜åŠ¿ã€‚</li>
<li><strong>å¤æ‚æ¨ç†ï¼ˆMMLU-Pro, GPQA-Diamondï¼‰</strong>ï¼š78.29åˆ†ä¸66.78åˆ†çš„è¡¨ç°ï¼Œæ˜¾ç¤ºäº†å¤„ç†é«˜é˜¶ã€å¤šå­¦ç§‘é—®é¢˜çš„èƒ½åŠ›ã€‚</li>
<li><strong>æ•°å­¦æ¨ç†ï¼ˆMATH500, AIMEï¼‰</strong>ï¼šåœ¨åŸºç¡€ï¼ˆ96.80%ï¼‰ä¸ç«èµ›çº§æ•°å­¦é—®é¢˜ï¼ˆAIME24:72.19; AIME25:63.23ï¼‰ä¸Šå‡è¡¨ç°ç¨³å¥ï¼Œæ“…é•¿å¤šæ­¥æ¨æ¼”ã€‚</li>
</ul>
<h2 data-id="heading-3">è½»é‡ï¼Œä¸â€œè½»â€æ€§èƒ½ï¼šå¼€æºä¸ä½“éªŒï¼Œå³åˆ»å¼€å§‹</h2>
<p>LongCat-Flash-Lite çš„å®è·µï¼Œä¸ºå¤§æ¨¡å‹çš„é«˜æ•ˆæ‰©å±•æä¾›äº†ä¸€ç§æ–°çš„å¯èƒ½æ€§ï¼šé€šè¿‡Â <strong>N-gram åµŒå…¥</strong>ä¸<strong>ç³»ç»Ÿçº§ä¼˜åŒ–</strong>çš„ååŒè®¾è®¡ï¼Œæˆ‘ä»¬å¾—ä»¥ç”¨29äº¿ï½45äº¿çš„åŠ¨æ€æ¿€æ´»å‚æ•°ï¼Œåœ¨æ™ºèƒ½ä½“ä¸ç¼–ç ç­‰å…³é”®ä»»åŠ¡ä¸Šï¼Œå®ç°ä¸æ›´å¤§æ¨¡å‹æ¯”è‚©çš„ç«äº‰åŠ›ã€‚</p>
<p>æŠ€æœ¯çš„ç”Ÿå‘½åŠ›æºäºå¼€æ”¾ä¸åä½œã€‚å› æ­¤ï¼Œæˆ‘ä»¬å·²å…¨é¢å¼€æºæ¨¡å‹æƒé‡åŠæŠ€æœ¯ç»†èŠ‚ï¼Œè¯šé‚€æ¯ä¸€ä½å¼€å‘è€…ä½“éªŒã€ç ”ç©¶ä¸å…±å»ºã€‚</p>
<p><strong>å¼€æºå¹³å°</strong></p>
<ul>
<li><strong>Hugging Face</strong>ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fhuggingface.co%2Fmeituan-longcat%2FLongCat-Flash-Lite" target="_blank" title="https://huggingface.co/meituan-longcat/LongCat-Flash-Lite" ref="nofollow noopener noreferrer">huggingface.co/meituan-lonâ€¦</a></li>
<li><strong>Modelscope</strong>ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.modelscope.cn%2Fmodels%2Fmeituan-longcat%2FLongCat-Flash-Lite" target="_blank" title="https://www.modelscope.cn/models/meituan-longcat/LongCat-Flash-Lite" ref="nofollow noopener noreferrer">www.modelscope.cn/models/meitâ€¦</a></li>
<li>æŠ€æœ¯æŠ¥å‘Šï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2601.21204" target="_blank" title="https://arxiv.org/abs/2601.21204" ref="nofollow noopener noreferrer">arxiv.org/abs/2601.21â€¦</a></li>
</ul>
<p>LongCat ç³»åˆ—æ¨¡å‹ä¸€ç›´éµå¾ªçš„æ˜¯ Model System Co-Design çš„è®¾è®¡åŸåˆ™ï¼Œå› æ­¤å¯¹äºè®­ç»ƒå’Œæ¨ç†ç³»ç»Ÿéƒ½æå‡ºäº†ç‹¬ç‰¹çš„æŒ‘æˆ˜ã€‚ä¸ºäº†è®©ç¤¾åŒºèƒ½å¤Ÿæ›´å¥½åœ°ä½¿ç”¨ LongCat æ¨¡å‹ï¼Œ<strong>æˆ‘ä»¬å¯¹æ¨ç†å¼•æ“çš„éƒ¨åˆ†åŠŸèƒ½ï¼ˆSGLang-FluentLLMï¼‰å’Œéƒ¨åˆ†ç®—å­ä¹ŸåŒæ­¥è¿›è¡Œäº†å¼€æº</strong>ï¼Œæ¬¢è¿ä½“éªŒï¼š</p>
<ul>
<li>Githubï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmeituan-longcat%2FSGLang-FluentLLM" target="_blank" title="https://github.com/meituan-longcat/SGLang-FluentLLM" ref="nofollow noopener noreferrer">github.com/meituan-lonâ€¦</a></li>
</ul>
<p><strong>åœ¨çº¿ä½“éªŒä¸è°ƒç”¨</strong></p>
<p>æˆ‘ä»¬å·²å‘å¼€å‘è€…å¼€æ”¾ LongCat-Flash-Lite ç‰ˆæœ¬ API æ¥å£ï¼Œå¯ç™»å½• LongCat API å¼€æ”¾å¹³å°ç”³è¯·ï¼Œæ¯æ—¥å…è´¹é¢åº¦é«˜è¾¾5000ä¸‡tokensã€‚ï¼ˆç›®å‰æš‚ä¸é™é¢ï¼Œæ¬¢è¿è¯•ç”¨ï¼‰</p>
<ul>
<li><strong>å®˜ç½‘</strong>ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Flongcat.ai" target="_blank" title="https://longcat.ai" ref="nofollow noopener noreferrer">longcat.ai</a></li>
<li><strong>APIå¼€æ”¾å¹³å°</strong>ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Flongcat.chat%2Fplatform%2Fusage" target="_blank" title="https://longcat.chat/platform/usage" ref="nofollow noopener noreferrer">longcat.chat/platform/usâ€¦</a></li>
</ul>
<p>æˆ‘ä»¬æœŸå¾…ä¸ç¤¾åŒºä¸€èµ·ï¼Œæ¢ç´¢å¤§æ¨¡å‹é«˜æ•ˆè½åœ°çš„æ›´å¤šå¯èƒ½ã€‚æ¬¢è¿ Starã€Forkã€åé¦ˆä¸åˆä½œã€‚</p>
<p>| å…³æ³¨ã€Œç¾å›¢æŠ€æœ¯å›¢é˜Ÿã€å¾®ä¿¡å…¬ä¼—å·ï¼Œé˜…è¯»æ›´å¤šæŠ€æœ¯å¹²è´§ï¼</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9c6d2e8c31c6479b941043a2a47f1369~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg576O5Zui5oqA5pyv5Zui6Zif:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771311578&amp;x-signature=IfeDXuhzGl%2F4NEIxDb%2BkfKM6ftI%3D" alt="" loading="lazy"/></p>
<p>| æœ¬æ–‡ç³»ç¾å›¢æŠ€æœ¯å›¢é˜Ÿå‡ºå“ï¼Œè‘—ä½œæƒå½’å±ç¾å›¢ã€‚æ¬¢è¿å‡ºäºåˆ†äº«å’Œäº¤æµç­‰éå•†ä¸šç›®çš„è½¬è½½æˆ–ä½¿ç”¨æœ¬æ–‡å†…å®¹ï¼Œæ•¬è¯·æ³¨æ˜â€œå†…å®¹è½¬è½½è‡ªç¾å›¢æŠ€æœ¯å›¢é˜Ÿâ€ã€‚æœ¬æ–‡æœªç»è®¸å¯ï¼Œä¸å¾—è¿›è¡Œå•†ä¸šæ€§è½¬è½½æˆ–è€…ä½¿ç”¨ã€‚ä»»ä½•å•†ç”¨è¡Œä¸ºï¼Œè¯·å‘é€é‚®ä»¶è‡³ <a href="https://link.juejin.cn?target=mailto%3Atech%40meituan.com" target="_blank" title="mailto:tech@meituan.com" ref="nofollow noopener noreferrer">tech@meituan.com</a> ç”³è¯·æˆæƒã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Transformer å…¥é—¨ï¼šä»é›¶ç†è§£ AI å¤§æ¨¡å‹çš„æ ¸å¿ƒåŸç†]]></title>    <link>https://juejin.cn/post/7604175912480866310</link>    <guid>https://juejin.cn/post/7604175912480866310</guid>    <pubDate>2026-02-09T05:01:57.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604175912480866310" data-draft-id="7604093823958630419" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" Transformer å…¥é—¨ï¼šä»é›¶ç†è§£ AI å¤§æ¨¡å‹çš„æ ¸å¿ƒåŸç†"/> <meta itemprop="keywords" content="ç®—æ³•,æ¶æ„,äººå·¥æ™ºèƒ½"/> <meta itemprop="datePublished" content="2026-02-09T05:01:57.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ‚Ÿç©ºä¸æ‰“ç™½éª¨ç²¾"/> <meta itemprop="url" content="https://juejin.cn/user/3667626521275272"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             Transformer å…¥é—¨ï¼šä»é›¶ç†è§£ AI å¤§æ¨¡å‹çš„æ ¸å¿ƒåŸç†
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3667626521275272/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ‚Ÿç©ºä¸æ‰“ç™½éª¨ç²¾
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-09T05:01:57.000Z" title="Mon Feb 09 2026 05:01:57 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    79
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ç¬¬ä¸€éƒ¨åˆ†ï¼šæ•°å­¦åŸºç¡€é“ºå«</h2>
<p>åœ¨å¼€å§‹ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å…ˆäº†è§£ä¸€äº›åŸºç¡€æ¦‚å¿µã€‚ä¸ç”¨æ‹…å¿ƒï¼Œæˆ‘ä¼šç”¨æœ€ç®€å•çš„æ–¹å¼æ¥è§£é‡Šã€‚</p>
<h3 data-id="heading-1">å‘é‡ã€çŸ©é˜µã€å¼ é‡</h3>
<h4 data-id="heading-2">ä»€ä¹ˆæ˜¯å‘é‡ï¼ˆVectorï¼‰ï¼Ÿ</h4>
<p>å‘é‡å°±æ˜¯ä¸€æ’æ•°å­—çš„é›†åˆã€‚</p>
<p>æƒ³è±¡ä½ è¦æè¿°ä¸€ä¸ªäººçš„ç‰¹å¾ï¼š</p>
<ul>
<li>èº«é«˜ï¼š175cm</li>
<li>ä½“é‡ï¼š70kg</li>
<li>å¹´é¾„ï¼š25å²</li>
</ul>
<p>æˆ‘ä»¬å¯ä»¥æŠŠè¿™äº›æ•°å­—æ’æˆä¸€æ’ï¼š<code>[175, 70, 25]</code>ï¼Œè¿™å°±æ˜¯ä¸€ä¸ªå‘é‡ï¼</p>
<pre><code class="hljs language-arduino" lang="arduino">å‘é‡å°±åƒä¸€å¼ <span class="hljs-string">"ç‰¹å¾èº«ä»½è¯"</span>
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [<span class="hljs-number">175</span>, <span class="hljs-number">70</span>, <span class="hljs-number">25</span>]      â”‚
â”‚   â†‘    â†‘    â†‘       â”‚
â”‚  èº«é«˜ ä½“é‡  å¹´é¾„     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<p>å‘é‡çš„ç»´åº¦ï¼šå‘é‡ä¸­æœ‰å¤šå°‘ä¸ªæ•°å­—ï¼Œå°±æ˜¯å¤šå°‘ç»´ã€‚<code>[175, 70, 25]</code> æ˜¯ 3 ç»´å‘é‡ã€‚</p>
<p>ä¸ºä»€ä¹ˆè®¡ç®—æœºéœ€è¦å‘é‡ï¼Ÿ å› ä¸ºè®¡ç®—æœºä¸è®¤è¯†"è‹¹æœ"ã€"å¿«ä¹"è¿™æ ·çš„æ–‡å­—ï¼Œä½†å®ƒè®¤è¯†æ•°å­—ï¼å‘é‡å°±æ˜¯æŠŠæ–‡å­—"ç¿»è¯‘"æˆæ•°å­—çš„æ–¹å¼ã€‚</p>
<h4 data-id="heading-3">ä»€ä¹ˆæ˜¯çŸ©é˜µï¼ˆMatrixï¼‰ï¼Ÿ</h4>
<p>çŸ©é˜µå°±æ˜¯æŠŠå¤šä¸ªå‘é‡å †åœ¨ä¸€èµ·ï¼Œå½¢æˆä¸€ä¸ªæ•°å­—è¡¨æ ¼ã€‚</p>
<p>æ¯”å¦‚æˆ‘ä»¬æœ‰3ä¸ªäººçš„ä¿¡æ¯ï¼š</p>
<pre><code class="hljs language-css" lang="css">         èº«é«˜  ä½“é‡  å¹´é¾„
å°æ˜ â†’   <span class="hljs-selector-attr">[175,  70,  25]</span>
å°çº¢ â†’   <span class="hljs-selector-attr">[165,  55,  23]</span>
å°åˆš â†’   <span class="hljs-selector-attr">[180,  85,  30]</span>
</code></pre>
<p>è¿™å°±æ˜¯ä¸€ä¸ª 3Ã—3 çš„çŸ©é˜µï¼ˆ3è¡Œ3åˆ—ï¼‰ï¼ä½ å¯ä»¥æŠŠå®ƒæƒ³è±¡æˆ Excel è¡¨æ ¼ã€‚</p>
<p>çŸ©é˜µçš„å½¢çŠ¶ç”¨ <code>(è¡Œæ•°, åˆ—æ•°)</code> è¡¨ç¤ºï¼š</p>
<ul>
<li>ä¸Šé¢çš„ä¾‹å­æ˜¯ <code>(3, 3)</code> çŸ©é˜µ</li>
<li>GPT-2 çš„è¯æ±‡åµŒå…¥çŸ©é˜µæ˜¯ <code>(50257, 768)</code> â€”â€” 50257 ä¸ªè¯ï¼Œæ¯ä¸ªè¯ 768 ç»´</li>
</ul>
<h4 data-id="heading-4">ä»€ä¹ˆæ˜¯å¼ é‡ï¼ˆTensorï¼‰ï¼Ÿ</h4>
<p>å¼ é‡æ˜¯æ›´é«˜ç»´åº¦çš„æ•°æ®ç»“æ„ã€‚</p>
<ul>
<li>ä¸€ä¸ªæ•°å­—ï¼ˆå¦‚ <code>5</code>ï¼‰ï¼šæ ‡é‡ = 0ç»´å¼ é‡</li>
<li>ä¸€æ’æ•°å­—ï¼ˆå¦‚ <code>[1,2,3]</code>ï¼‰ï¼šå‘é‡ = 1ç»´å¼ é‡</li>
<li>ä¸€ä¸ªè¡¨æ ¼ï¼šçŸ©é˜µ = 2ç»´å¼ é‡</li>
<li>ä¸€å è¡¨æ ¼ï¼š3ç»´å¼ é‡</li>
</ul>
<p>æƒ³è±¡ä¸€æœ¬ä¹¦ï¼š</p>
<pre><code class="hljs">ğŸ“– ä¹¦æœ¬ç±»æ¯”ï¼š
â”œâ”€â”€ ä¸€ä¸ªå­— = æ ‡é‡ï¼ˆ0ç»´ï¼‰
â”œâ”€â”€ ä¸€è¡Œå­— = å‘é‡ï¼ˆ1ç»´ï¼‰
â”œâ”€â”€ ä¸€é¡µçº¸ = çŸ©é˜µï¼ˆ2ç»´ï¼‰
â””â”€â”€ æ•´æœ¬ä¹¦ = 3ç»´å¼ é‡

ğŸ§Š ç«‹ä½“ç±»æ¯”ï¼š
â”œâ”€â”€ ç‚¹ = æ ‡é‡
â”œâ”€â”€ çº¿ = å‘é‡
â”œâ”€â”€ é¢ = çŸ©é˜µ
â””â”€â”€ ä½“ = 3ç»´å¼ é‡
</code></pre>
<h3 data-id="heading-5">çŸ©é˜µè¿ç®—</h3>
<h4 data-id="heading-6">1. çŸ©é˜µè½¬ç½®ï¼ˆTransposeï¼‰</h4>
<p>è½¬ç½®å°±æ˜¯æŠŠçŸ©é˜µ"ç¿»è½¬"ï¼Œè¡Œå˜æˆåˆ—ï¼Œåˆ—å˜æˆè¡Œã€‚</p>
<pre><code class="hljs language-css" lang="css">åŸçŸ©é˜µ <span class="hljs-selector-tag">A</span>:          è½¬ç½®å Aáµ€:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ <span class="hljs-number">1</span>  <span class="hljs-number">2</span>  <span class="hljs-number">3</span> â”‚        â”‚ <span class="hljs-number">1</span>  <span class="hljs-number">4</span>    â”‚
â”‚ <span class="hljs-number">4</span>  <span class="hljs-number">5</span>  <span class="hljs-number">6</span> â”‚   â†’    â”‚ <span class="hljs-number">2</span>  <span class="hljs-number">5</span>    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚ <span class="hljs-number">3</span>  <span class="hljs-number">6</span>    â”‚
 (<span class="hljs-number">2</span>Ã—<span class="hljs-number">3</span>)             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    (<span class="hljs-number">3</span>Ã—<span class="hljs-number">2</span>)
</code></pre>
<p>è®°å¿†æŠ€å·§ï¼šæƒ³è±¡æ²¿ç€å¯¹è§’çº¿æŠ˜å çº¸å¼ ã€‚</p>
<p>åœ¨ Transformer ä¸­çš„åº”ç”¨ï¼šè®¡ç®—æ³¨æ„åŠ›åˆ†æ•°æ—¶ï¼ŒQuery çŸ©é˜µéœ€è¦å’Œ Key çŸ©é˜µçš„è½¬ç½®ç›¸ä¹˜ã€‚</p>
<h4 data-id="heading-7">2. çŸ©é˜µä¹˜æ³•ï¼ˆMatrix Multiplicationï¼‰</h4>
<p>çŸ©é˜µä¹˜æ³•æ˜¯ Transformer çš„æ ¸å¿ƒè¿ç®—ï¼</p>
<h5 data-id="heading-8">è§„åˆ™ï¼šè¡Œ Ã— åˆ—ï¼Œé€ä¸ªç›¸ä¹˜å†ç›¸åŠ </h5>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-tag">A</span> (<span class="hljs-number">2</span>Ã—<span class="hljs-number">3</span>)          <span class="hljs-selector-tag">B</span> (<span class="hljs-number">3</span>Ã—<span class="hljs-number">2</span>)          C = <span class="hljs-selector-tag">A</span> Ã— <span class="hljs-selector-tag">B</span> (<span class="hljs-number">2</span>Ã—<span class="hljs-number">2</span>)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ <span class="hljs-number">1</span>  <span class="hljs-number">2</span>  <span class="hljs-number">3</span> â”‚  Ã—   â”‚ <span class="hljs-number">7</span>   <span class="hljs-number">8</span> â”‚   =    â”‚ <span class="hljs-number">58</span>   <span class="hljs-number">64</span> â”‚
â”‚ <span class="hljs-number">4</span>  <span class="hljs-number">5</span>  <span class="hljs-number">6</span> â”‚      â”‚ <span class="hljs-number">9</span>  <span class="hljs-number">10</span> â”‚        â”‚<span class="hljs-number">139</span>  <span class="hljs-number">154</span> â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚<span class="hljs-number">11</span>  <span class="hljs-number">12</span> â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â””â”€â”€â”€â”€â”€â”€â”€â”˜

è®¡ç®—è¿‡ç¨‹ï¼ˆä»¥ C<span class="hljs-selector-attr">[0,0]</span> = <span class="hljs-number">58</span> ä¸ºä¾‹ï¼‰ï¼š
C<span class="hljs-selector-attr">[0,0]</span> = <span class="hljs-number">1</span>Ã—<span class="hljs-number">7</span> + <span class="hljs-number">2</span>Ã—<span class="hljs-number">9</span> + <span class="hljs-number">3</span>Ã—<span class="hljs-number">11</span> = <span class="hljs-number">7</span> + <span class="hljs-number">18</span> + <span class="hljs-number">33</span> = <span class="hljs-number">58</span>
         â†‘     â†‘     â†‘
       <span class="hljs-selector-tag">A</span>ç¬¬<span class="hljs-number">1</span>è¡Œçš„æ¯ä¸ªå…ƒç´  Ã— <span class="hljs-selector-tag">B</span>ç¬¬<span class="hljs-number">1</span>åˆ—çš„å¯¹åº”å…ƒç´ ï¼Œå†ç›¸åŠ 
</code></pre>
<h5 data-id="heading-9">å½¢çŠ¶è§„åˆ™</h5>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-selector-tag">A</span> çš„å½¢çŠ¶ï¼š(m, n)  â† n å¿…é¡»ç›¸ç­‰
<span class="hljs-selector-tag">B</span> çš„å½¢çŠ¶ï¼š(n, p)  â† n å¿…é¡»ç›¸ç­‰
ç»“æœå½¢çŠ¶ï¼š(m, p)

ä¾‹å¦‚ï¼š(<span class="hljs-number">2</span>, <span class="hljs-number">3</span>) Ã— (<span class="hljs-number">3</span>, <span class="hljs-number">4</span>) = (<span class="hljs-number">2</span>, <span class="hljs-number">4</span>)  âœ…
      (<span class="hljs-number">2</span>, <span class="hljs-number">3</span>) Ã— (<span class="hljs-number">4</span>, <span class="hljs-number">5</span>) = é”™è¯¯ï¼  âŒ (<span class="hljs-number">3</span> â‰  <span class="hljs-number">4</span>)
</code></pre>
<h5 data-id="heading-10">åœ¨ Transformer ä¸­çš„åº”ç”¨</h5>
<pre><code class="hljs language-scss" lang="scss">Token åµŒå…¥è®¡ç®—ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Token ID      â”‚  Ã—  â”‚   åµŒå…¥çŸ©é˜µ        â”‚  =  â”‚   åµŒå…¥å‘é‡        â”‚
â”‚  (<span class="hljs-number">1</span>, <span class="hljs-number">50257</span>)    â”‚     â”‚ (<span class="hljs-number">50257</span>, <span class="hljs-number">768</span>)     â”‚     â”‚   (<span class="hljs-number">1</span>, <span class="hljs-number">768</span>)        â”‚
â”‚  <span class="hljs-selector-attr">[0,0,...,1,0]</span> â”‚     â”‚                  â”‚     â”‚  <span class="hljs-selector-attr">[0.23, -0.45,...]</span>â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   One-hot ç¼–ç             æŸ¥è¡¨                    è¯¥è¯çš„å‘é‡è¡¨ç¤º
</code></pre>
<h4 data-id="heading-11">3. ç‚¹ç§¯ï¼ˆDot Productï¼‰</h4>
<p>ç‚¹ç§¯æ˜¯ä¸¤ä¸ªå‘é‡çš„"ç›¸ä¼¼åº¦è®¡ç®—å™¨"ã€‚</p>
<h5 data-id="heading-12">è®¡ç®—æ–¹æ³•</h5>
<pre><code class="hljs language-ini" lang="ini">å‘é‡ <span class="hljs-attr">A</span> = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]
å‘é‡ <span class="hljs-attr">B</span> = [<span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>]

ç‚¹ç§¯ = 1Ã—4 + 2Ã—5 + 3Ã—<span class="hljs-attr">6</span> = <span class="hljs-number">4</span> + <span class="hljs-number">10</span> + <span class="hljs-number">18</span> = <span class="hljs-number">32</span>
       â†‘     â†‘     â†‘
     å¯¹åº”ä½ç½®ç›¸ä¹˜ï¼Œç„¶åå…¨éƒ¨ç›¸åŠ 
</code></pre>
<h5 data-id="heading-13">å‡ ä½•æ„ä¹‰</h5>
<p>ç‚¹ç§¯åæ˜ ä¸¤ä¸ªå‘é‡çš„ç›¸ä¼¼ç¨‹åº¦ï¼š</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-tag">A</span>Â·<span class="hljs-selector-tag">B</span> = |<span class="hljs-selector-tag">A</span>| Ã— |<span class="hljs-selector-tag">B</span>| Ã— cos(Î¸)

å…¶ä¸­ Î¸ æ˜¯ä¸¤ä¸ªå‘é‡çš„å¤¹è§’ï¼š
â€¢ Î¸ = <span class="hljs-number">0</span>Â°   â†’ cos(Î¸) = <span class="hljs-number">1</span>  â†’ å®Œå…¨åŒæ–¹å‘ï¼Œç‚¹ç§¯æœ€å¤§
â€¢ Î¸ = <span class="hljs-number">90</span>Â°  â†’ cos(Î¸) = <span class="hljs-number">0</span>  â†’ å‚ç›´ï¼Œç‚¹ç§¯ä¸º <span class="hljs-number">0</span>
â€¢ Î¸ = <span class="hljs-number">180</span>Â° â†’ cos(Î¸) = -<span class="hljs-number">1</span> â†’ å®Œå…¨åæ–¹å‘ï¼Œç‚¹ç§¯æœ€å°

å›¾ç¤ºï¼š
        <span class="hljs-selector-tag">B</span> â†—
         /
        /  Î¸ = <span class="hljs-number">45</span>Â°ï¼ˆç›¸ä¼¼ï¼‰
       /
  <span class="hljs-selector-tag">A</span> â†’â†’â†’â†’â†’â†’

        <span class="hljs-selector-tag">B</span> â†‘
        â”‚
        â”‚  Î¸ = <span class="hljs-number">90</span>Â°ï¼ˆä¸ç›¸å…³ï¼‰
        â”‚
  <span class="hljs-selector-tag">A</span> â†’â†’â†’â†’â†’â†’
</code></pre>
<h5 data-id="heading-14">åœ¨ Transformer æ³¨æ„åŠ›ä¸­çš„åº”ç”¨</h5>
<pre><code class="hljs language-vbnet" lang="vbnet">Query å‘é‡ï¼ˆ<span class="hljs-string">"å¥¹"</span>ï¼‰ï¼š[<span class="hljs-number">0.5</span>, <span class="hljs-number">0.3</span>, <span class="hljs-number">0.8</span>, ...]
<span class="hljs-keyword">Key</span> å‘é‡ï¼ˆ<span class="hljs-string">"å°çº¢"</span>ï¼‰ï¼š[<span class="hljs-number">0.4</span>, <span class="hljs-number">0.2</span>, <span class="hljs-number">0.9</span>, ...]   â† ç›¸ä¼¼ï¼ç‚¹ç§¯å¤§
<span class="hljs-keyword">Key</span> å‘é‡ï¼ˆ<span class="hljs-string">"è‹¹æœ"</span>ï¼‰ï¼š[-<span class="hljs-number">0.2</span>, <span class="hljs-number">0.7</span>, -<span class="hljs-number">0.1</span>, ...]  â† ä¸ç›¸ä¼¼ï¼Œç‚¹ç§¯å°

æ³¨æ„åŠ›åˆ†æ•° = Query Â· <span class="hljs-keyword">Key</span>
<span class="hljs-string">"å¥¹"</span> å…³æ³¨ <span class="hljs-string">"å°çº¢"</span> çš„åˆ†æ•° = <span class="hljs-number">0.5</span>Ã—<span class="hljs-number">0.4</span> + <span class="hljs-number">0.3</span>Ã—<span class="hljs-number">0.2</span> + <span class="hljs-number">0.8</span>Ã—<span class="hljs-number">0.9</span> + ... = è¾ƒå¤§
<span class="hljs-string">"å¥¹"</span> å…³æ³¨ <span class="hljs-string">"è‹¹æœ"</span> çš„åˆ†æ•° = <span class="hljs-number">0.5</span>Ã—(-<span class="hljs-number">0.2</span>) + <span class="hljs-number">0.3</span>Ã—<span class="hljs-number">0.7</span> + <span class="hljs-number">0.8</span>Ã—(-<span class="hljs-number">0.1</span>) + ... = è¾ƒå°
</code></pre>
<h4 data-id="heading-15">4. ç¼©æ”¾ï¼ˆScalingï¼‰</h4>
<p>ä¸ºä»€ä¹ˆæ³¨æ„åŠ›åˆ†æ•°è¦é™¤ä»¥ âˆšdï¼Ÿ</p>
<p>åœ¨è®¡ç®—æ³¨æ„åŠ›æ—¶ï¼Œå…¬å¼æ˜¯ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">Attention</span> = softmax(QÂ·Káµ€ / âˆšd)
                      â†‘
                   ç¼©æ”¾å› å­
</code></pre>
<h5 data-id="heading-16">é—®é¢˜ï¼šç‚¹ç§¯å¯èƒ½å˜å¾—å¾ˆå¤§</h5>
<p>å‡è®¾å‘é‡ç»´åº¦ <code>d = 768</code>ï¼š</p>
<ul>
<li>æ¯ä¸ªå…ƒç´ å¤§çº¦åœ¨ <code>[-1, 1]</code> èŒƒå›´</li>
<li>ç‚¹ç§¯ = 768 ä¸ªæ•°ç›¸åŠ ï¼Œå¯èƒ½å˜æˆå¾ˆå¤§çš„æ•°ï¼ˆå¦‚ Â±100ï¼‰</li>
<li>å¾ˆå¤§çš„æ•°ç»è¿‡ softmax ä¼šå˜æˆæç«¯å€¼ï¼ˆæ¥è¿‘ 0 æˆ– 1ï¼‰</li>
</ul>
<h5 data-id="heading-17">è§£å†³ï¼šé™¤ä»¥ âˆš768 â‰ˆ 27.7</h5>
<pre><code class="hljs language-css" lang="css">åŸå§‹ç‚¹ç§¯ï¼š  <span class="hljs-selector-attr">[-100, 50, 30, -20]</span>
é™¤ä»¥ âˆš<span class="hljs-number">768</span>ï¼š<span class="hljs-selector-attr">[-3.6, 1.8, 1.1, -0.7]</span>  â† æ•°å€¼æ›´æ¸©å’Œ

è¿™æ · softmax è¾“å‡ºæ›´å¹³æ»‘ï¼Œæ¨¡å‹æ›´å®¹æ˜“å­¦ä¹ 
</code></pre>
<h5 data-id="heading-18">ç›´è§‚ç†è§£</h5>
<pre><code class="hljs language-css" lang="css">ğŸŒ¡ï¸ æ¸©åº¦è®¡ç±»æ¯”ï¼š
åŸå§‹ç‚¹ç§¯å°±åƒæµ‹é‡ç«å±±æ¸©åº¦ï¼Œæ•°å€¼å¤ªæç«¯
ç¼©æ”¾åå°±åƒæµ‹é‡å®¤æ¸©ï¼Œæ•°å€¼æ›´åˆç†

ğŸ“Š è€ƒè¯•åˆ†æ•°ç±»æ¯”ï¼š
åŸå§‹ï¼š<span class="hljs-selector-attr">[0åˆ†, 1000åˆ†, 500åˆ†]</span>  â† å·®å¼‚å¤ªå¤§ï¼Œéš¾ä»¥æ¯”è¾ƒ
ç¼©æ”¾ï¼š<span class="hljs-selector-attr">[0åˆ†, 36åˆ†, 18åˆ†]</span>     â† å·®å¼‚åˆç†ï¼Œå®¹æ˜“æ¯”è¾ƒ
</code></pre>
<h3 data-id="heading-19">å½’ä¸€åŒ–ï¼ˆNormalizationï¼‰</h3>
<h4 data-id="heading-20">ä¸ºä»€ä¹ˆéœ€è¦å½’ä¸€åŒ–ï¼Ÿ</h4>
<p>å½’ä¸€åŒ–è®©æ•°æ®ä¿æŒåœ¨åˆç†çš„èŒƒå›´å†…ï¼Œå¸®åŠ©æ¨¡å‹æ›´ç¨³å®šåœ°å­¦ä¹ ã€‚</p>
<p>æƒ³è±¡ä¸€ä¸‹ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">ä¸å½’ä¸€åŒ–çš„æ•°æ®ï¼š
ç‰¹å¾<span class="hljs-number">1</span>ï¼ˆå¹´é¾„ï¼‰ï¼š   <span class="hljs-number">25</span>, <span class="hljs-number">30</span>, <span class="hljs-number">35</span>      èŒƒå›´ï¼š<span class="hljs-number">25</span><span class="hljs-number">-35</span>
ç‰¹å¾<span class="hljs-number">2</span>ï¼ˆæ”¶å…¥ï¼‰ï¼š   <span class="hljs-number">50000</span>, <span class="hljs-number">80000</span>    èŒƒå›´ï¼š<span class="hljs-number">50000</span><span class="hljs-number">-80000</span>

é—®é¢˜ï¼šæ”¶å…¥çš„æ•°å€¼æ¯”å¹´é¾„å¤§å‡ åƒå€ï¼
      æ¨¡å‹ä¼šè®¤ä¸ºæ”¶å…¥<span class="hljs-string">"æ›´é‡è¦"</span>ï¼Œä½†è¿™åªæ˜¯å•ä½ä¸åŒé€ æˆçš„å‡è±¡
</code></pre>
<h4 data-id="heading-21">å±‚å½’ä¸€åŒ–ï¼ˆLayer Normalizationï¼‰</h4>
<p>Transformer ä½¿ç”¨çš„æ˜¯å±‚å½’ä¸€åŒ–ï¼Œå®ƒåœ¨æ¯ä¸€å±‚å¯¹æ•°æ®è¿›è¡Œæ ‡å‡†åŒ–ï¼š</p>
<h5 data-id="heading-22">è®¡ç®—æ­¥éª¤</h5>
<pre><code class="hljs language-ini" lang="ini">è¾“å…¥å‘é‡ï¼š<span class="hljs-attr">x</span> = [<span class="hljs-number">2</span>, <span class="hljs-number">4</span>, <span class="hljs-number">6</span>, <span class="hljs-number">8</span>]

Step 1: è®¡ç®—å‡å€¼ Î¼
Î¼ = (2 + 4 + 6 + 8) / <span class="hljs-attr">4</span> = <span class="hljs-number">5</span>

Step 2: è®¡ç®—æ–¹å·® ÏƒÂ²
ÏƒÂ² = <span class="hljs-section">[(2-5)Â² + (4-5)Â² + (6-5)Â² + (8-5)Â²]</span> / <span class="hljs-attr">4</span>
   = <span class="hljs-section">[9 + 1 + 1 + 9]</span> / <span class="hljs-attr">4</span> = <span class="hljs-number">5</span>

Step 3: æ ‡å‡†åŒ–
<span class="hljs-attr">x_norm</span> = (x - Î¼) / âˆš(ÏƒÂ² + Îµ)
       = (x - 5) / âˆš5.0001     (Îµ æ˜¯ä¸€ä¸ªå¾ˆå°çš„æ•°ï¼Œé˜²æ­¢é™¤ä»¥0)
       = <span class="hljs-section">[-1.34, -0.45, 0.45, 1.34]</span>

Step 4: ç¼©æ”¾å’Œåç§»ï¼ˆå¯å­¦ä¹ å‚æ•°ï¼‰
<span class="hljs-attr">output</span> = Î³ Ã— x_norm + Î²
</code></pre>
<h5 data-id="heading-23">æ•ˆæœ</h5>
<pre><code class="hljs language-css" lang="css">å½’ä¸€åŒ–å‰ï¼š<span class="hljs-selector-attr">[100, 200, -50, 0, 300]</span>  â† æ•°å€¼èŒƒå›´å¤§ï¼Œä¸ç¨³å®š
å½’ä¸€åŒ–åï¼š<span class="hljs-selector-attr">[-0.2, 0.5, -1.1, -0.4, 1.2]</span>  â† æ•°å€¼åœ¨å°èŒƒå›´å†…ï¼Œç¨³å®š
</code></pre>
<h5 data-id="heading-24">åœ¨ Transformer ä¸­çš„ä½ç½®</h5>
<pre><code class="hljs">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       è¾“å…¥ x                â”‚
â”‚          â†“                  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚   â”‚ Layer Norm 1 â”‚ â†â”€â”€â”€â”€â”€â”€â”€â”€â”¤ ç¬¬ä¸€æ¬¡å½’ä¸€åŒ–
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚          â†“                  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚   â”‚  æ³¨æ„åŠ›å±‚     â”‚          â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚          â†“                  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚   â”‚ Layer Norm 2 â”‚ â†â”€â”€â”€â”€â”€â”€â”€â”€â”¤ ç¬¬äºŒæ¬¡å½’ä¸€åŒ–
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚          â†“                  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚   â”‚   MLP å±‚     â”‚          â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚          â†“                  â”‚
â”‚       è¾“å‡º                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h3 data-id="heading-25">Softmax å‡½æ•°</h3>
<p>Softmax æŠŠä»»æ„æ•°å­—è½¬æ¢æˆæ¦‚ç‡åˆ†å¸ƒã€‚</p>
<h4 data-id="heading-26">å…¬å¼</h4>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">softmax</span>(xáµ¢) = e^xáµ¢ / Î£â±¼ e^xâ±¼

å…¶ä¸­ e â‰ˆ <span class="hljs-number">2.718</span>ï¼ˆè‡ªç„¶å¸¸æ•°ï¼‰
</code></pre>
<h4 data-id="heading-27">è®¡ç®—ç¤ºä¾‹</h4>
<pre><code class="hljs language-ini" lang="ini">è¾“å…¥åˆ†æ•°ï¼š<span class="hljs-section">[2.0, 1.0, 0.1]</span>

Step 1: è®¡ç®— e çš„å¹‚æ¬¡
e^<span class="hljs-attr">2.0</span> = <span class="hljs-number">7.39</span>
e^<span class="hljs-attr">1.0</span> = <span class="hljs-number">2.72</span>
e^<span class="hljs-attr">0.1</span> = <span class="hljs-number">1.11</span>
æ€»å’Œ = 7.39 + 2.72 + <span class="hljs-attr">1.11</span> = <span class="hljs-number">11.22</span>

Step 2: é™¤ä»¥æ€»å’Œå¾—åˆ°æ¦‚ç‡
7.39 / <span class="hljs-attr">11.22</span> = <span class="hljs-number">0.66</span> = <span class="hljs-number">66</span>%
2.72 / <span class="hljs-attr">11.22</span> = <span class="hljs-number">0.24</span> = <span class="hljs-number">24</span>%
1.11 / <span class="hljs-attr">11.22</span> = <span class="hljs-number">0.10</span> = <span class="hljs-number">10</span>%

è¾“å‡ºæ¦‚ç‡ï¼š<span class="hljs-section">[0.66, 0.24, 0.10]</span>
           â†‘
         æ€»å’Œ = 1ï¼ˆè¿™å°±æ˜¯æ¦‚ç‡åˆ†å¸ƒï¼ï¼‰
</code></pre>
<h4 data-id="heading-28">Softmax çš„ç‰¹æ€§</h4>
<pre><code class="hljs language-css" lang="css">ç‰¹æ€§ <span class="hljs-number">1</span>ï¼šæ‰€æœ‰è¾“å‡ºéƒ½æ˜¯æ­£æ•°ï¼ˆå› ä¸º e^x &gt; <span class="hljs-number">0</span>ï¼‰
ç‰¹æ€§ <span class="hljs-number">2</span>ï¼šæ‰€æœ‰è¾“å‡ºåŠ èµ·æ¥ç­‰äº <span class="hljs-number">1</span>ï¼ˆæ¦‚ç‡åˆ†å¸ƒï¼‰
ç‰¹æ€§ <span class="hljs-number">3</span>ï¼šä¿æŒç›¸å¯¹å¤§å°å…³ç³»ï¼ˆè¾“å…¥å¤§çš„ï¼Œè¾“å‡ºä¹Ÿå¤§ï¼‰
ç‰¹æ€§ <span class="hljs-number">4</span>ï¼šæ”¾å¤§å·®å¼‚ï¼ˆå¤§çš„æ›´å¤§ï¼Œå°çš„æ›´å°ï¼‰

ç¤ºä¾‹ï¼š
è¾“å…¥ï¼š  <span class="hljs-selector-attr">[3, 1, 1]</span>     å·®è·ï¼š<span class="hljs-number">2</span>
è¾“å‡ºï¼š  <span class="hljs-selector-attr">[0.82, 0.09, 0.09]</span>  å·®è·è¢«æ”¾å¤§ï¼
</code></pre>
<h4 data-id="heading-29">å›¾å½¢åŒ–ç†è§£</h4>
<pre><code class="hljs language-erlang" lang="erlang">     åˆ†æ•°                    æ¦‚ç‡
   â”Œâ”€â”€â”€â”€â”€â”€â”               â”Œâ”€â”€â”€â”€â”€â”€â”
 <span class="hljs-number">3</span> â”‚â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ”‚             <span class="hljs-number">82</span><span class="hljs-comment">%â”‚â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ”‚â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ</span>
   â”œâ”€â”€â”€â”€â”€â”€â”¤     â†’         â”œâ”€â”€â”€â”€â”€â”€â”¤
 <span class="hljs-number">1</span> â”‚â–ˆâ–ˆ    â”‚              <span class="hljs-number">9</span><span class="hljs-comment">%â”‚â–ˆâ–ˆ    â”‚â–ˆâ–ˆ</span>
   â”œâ”€â”€â”€â”€â”€â”€â”¤               â”œâ”€â”€â”€â”€â”€â”€â”¤
 <span class="hljs-number">1</span> â”‚â–ˆâ–ˆ    â”‚              <span class="hljs-number">9</span><span class="hljs-comment">%â”‚â–ˆâ–ˆ    â”‚â–ˆâ–ˆ</span>
   â””â”€â”€â”€â”€â”€â”€â”˜               â””â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h4 data-id="heading-30">æ¸©åº¦å¯¹ Softmax çš„å½±å“</h4>
<pre><code class="hljs language-ini" lang="ini">å¸¦æ¸©åº¦çš„ Softmaxï¼šsoftmax(xáµ¢ / T)

<span class="hljs-attr">T</span> = æ¸©åº¦å‚æ•°
</code></pre>
<p>æ¸©åº¦ T</p>
<p>æ•ˆæœ</p>
<p>è¾“å…¥ [3,1,1] çš„è¾“å‡º</p>
<p>T = 0.5</p>
<p>æ›´å°–é”ï¼ˆæ›´ç¡®å®šï¼‰</p>
<p>[0.95, 0.02, 0.02]</p>
<p>T = 1.0</p>
<p>æ ‡å‡†</p>
<p>[0.82, 0.09, 0.09]</p>
<p>T = 2.0</p>
<p>æ›´å¹³æ»‘ï¼ˆæ›´éšæœºï¼‰</p>
<p>[0.58, 0.21, 0.21]</p>
<pre><code class="hljs language-ini" lang="ini">ğŸŒ¡ï¸ æ¸©åº¦è¶Šä½ï¼Œåˆ†å¸ƒè¶Š"å°–"ï¼Œæœ€å¤§å€¼å ä¸»å¯¼
ğŸŒ¡ï¸ æ¸©åº¦è¶Šé«˜ï¼Œåˆ†å¸ƒè¶Š"å¹³"ï¼Œé€‰æ‹©æ›´éšæœº

å›¾ç¤ºï¼ˆTä»ä½åˆ°é«˜ï¼‰ï¼š
<span class="hljs-attr">T</span>=<span class="hljs-number">0.5</span>:  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘    â† å‡ ä¹åªé€‰æœ€å¤§çš„
<span class="hljs-attr">T</span>=<span class="hljs-number">1.0</span>:  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘    â† åå‘æœ€å¤§çš„
<span class="hljs-attr">T</span>=<span class="hljs-number">2.0</span>:  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘    â† æ›´å‡åŒ€çš„åˆ†å¸ƒ
</code></pre>
<h3 data-id="heading-31">æ®‹å·®è¿æ¥ï¼ˆResidual Connectionï¼‰</h3>
<p>æ®‹å·®è¿æ¥è®©ä¿¡æ¯å¯ä»¥"è·³è¿‡"æŸäº›å±‚ç›´æ¥ä¼ é€’ã€‚</p>
<h4 data-id="heading-32">å…¬å¼</h4>
<pre><code class="hljs language-ini" lang="ini">è¾“å‡º = å±‚çš„è¾“å‡º + åŸå§‹è¾“å…¥

æˆ–å†™æˆï¼š<span class="hljs-attr">y</span> = F(x) + x
</code></pre>
<h4 data-id="heading-33">ä¸ºä»€ä¹ˆéœ€è¦æ®‹å·®ï¼Ÿ</h4>
<pre><code class="hljs language-arduino" lang="arduino">é—®é¢˜ï¼šæ·±åº¦ç½‘ç»œçš„<span class="hljs-string">"æ¢¯åº¦æ¶ˆå¤±"</span>

æƒ³è±¡ä¼ è¯æ¸¸æˆï¼š
ç¬¬<span class="hljs-number">1</span>ä¸ªäºº â†’ ç¬¬<span class="hljs-number">2</span>ä¸ªäºº â†’ ... â†’ ç¬¬<span class="hljs-number">12</span>ä¸ªäºº
æ¯ä¼ ä¸€æ¬¡ï¼Œä¿¡æ¯å°±æŸå¤±ä¸€ç‚¹
ä¼ åˆ°ç¬¬<span class="hljs-number">12</span>ä¸ªäººæ—¶ï¼ŒåŸå§‹ä¿¡æ¯å¯èƒ½å®Œå…¨å¤±çœŸäº†

æ®‹å·®è¿æ¥ = ç»™æ¯ä¸ªäººä¸€æ¡<span class="hljs-string">"ç›´é€šçƒ­çº¿"</span>
å³ä½¿ä¸­é—´ä¼ è¯æœ‰æŸå¤±ï¼ŒåŸå§‹ä¿¡æ¯ä¹Ÿèƒ½ç›´æ¥åˆ°è¾¾
</code></pre>
<h4 data-id="heading-34">å›¾ç¤º</h4>
<pre><code class="hljs language-scss" lang="scss">æ²¡æœ‰æ®‹å·®è¿æ¥ï¼š                æœ‰æ®‹å·®è¿æ¥ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è¾“å…¥ x â”‚                   â”‚ è¾“å…¥ x â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                   â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜          â”‚
    â†“                            â†“               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  <span class="hljs-built_in">F</span>(x)  â”‚                   â”‚  <span class="hljs-built_in">F</span>(x)  â”‚          â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                   â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜          â”‚
    â†“                            â†“               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚ è¾“å‡º   â”‚                   â”‚   +    â”‚â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ (ç›¸åŠ )
â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
                                 â†“
                             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
                             â”‚ <span class="hljs-built_in">F</span>(x)+x â”‚ â† è¾“å‡ºåŒ…å«åŸå§‹ä¿¡æ¯ï¼
                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h4 data-id="heading-35">åœ¨ Transformer ä¸­çš„åº”ç”¨</h4>
<pre><code class="hljs language-scss" lang="scss">æ¯ä¸ª Transformer Block æœ‰ä¸¤å¤„æ®‹å·®è¿æ¥ï¼š

x â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          â”‚
â†“                          â”‚
<span class="hljs-selector-attr">[Layer Norm]</span> â†’ <span class="hljs-selector-attr">[æ³¨æ„åŠ›]</span> â”€â”€â”€â”¼â†’ (+) â†’ xâ‚
                           â”‚
xâ‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          â”‚
â†“                          â”‚
<span class="hljs-selector-attr">[Layer Norm]</span> â†’ <span class="hljs-selector-attr">[MLP]</span> â”€â”€â”€â”€â”€â”€â”¼â†’ (+) â†’ xâ‚‚ï¼ˆè¾“å‡ºï¼‰
</code></pre>
<h3 data-id="heading-36">æ¿€æ´»å‡½æ•°ï¼šGELU</h3>
<p>æ¿€æ´»å‡½æ•°ç»™ç¥ç»ç½‘ç»œå¸¦æ¥"éçº¿æ€§"ï¼Œè®©å®ƒèƒ½å­¦ä¹ å¤æ‚æ¨¡å¼ã€‚</p>
<h4 data-id="heading-37">ä¸ºä»€ä¹ˆéœ€è¦éçº¿æ€§ï¼Ÿ</h4>
<pre><code class="hljs language-ini" lang="ini">å¦‚æœåªæœ‰çº¿æ€§è¿ç®—ï¼š
<span class="hljs-attr">y</span> = ax + b
<span class="hljs-attr">y</span> = cy + d = c(ax + b) + d = acx + (bc + d)

æ— è®ºå¤šå°‘å±‚ï¼Œæœ€ç»ˆè¿˜æ˜¯ <span class="hljs-attr">y</span> = å¸¸æ•°Ã—x + å¸¸æ•°
è¿™å°±åªèƒ½å­¦ä¹ ç›´çº¿å…³ç³»ï¼

åŠ å…¥éçº¿æ€§ï¼š
<span class="hljs-attr">y</span> = æ¿€æ´»å‡½æ•°(ax + b)

å¯ä»¥å­¦ä¹ ä»»æ„å¤æ‚çš„æ›²çº¿ï¼
</code></pre>
<h4 data-id="heading-38">GELU vs ReLU</h4>
<pre><code class="hljs language-scss" lang="scss">ReLUï¼ˆä¼ ç»Ÿæ–¹æ³•ï¼‰ï¼š
        â”‚    â•±
        â”‚   â•±
        â”‚  â•±
â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â•±â”€â”€â”€â”€â”€â”€
        â”‚
å…¬å¼ï¼š<span class="hljs-built_in">max</span>(<span class="hljs-number">0</span>, x)
ç‰¹ç‚¹ï¼šx&lt;<span class="hljs-number">0</span> è¾“å‡º<span class="hljs-number">0</span>ï¼Œx&gt;<span class="hljs-number">0</span> è¾“å‡ºxï¼Œåœ¨<span class="hljs-number">0</span>å¤„æœ‰"å°–è§’"

GELUï¼ˆTransformer ä½¿ç”¨ï¼‰ï¼š
        â”‚    â•±
        â”‚   â•±
        â”‚  â•±
â”€â”€â”€â”€â”€â”€â”€â”€â”¼â•±â”€â”€â”€â”€â”€â”€â”€
       â•±â”‚
å…¬å¼ï¼šx Ã— Î¦(x)ï¼Œå…¶ä¸­ Î¦ æ˜¯æ ‡å‡†æ­£æ€åˆ†å¸ƒçš„ç´¯ç§¯åˆ†å¸ƒå‡½æ•°
ç‰¹ç‚¹ï¼šå¹³æ»‘æ›²çº¿ï¼Œæ²¡æœ‰å°–è§’
</code></pre>
<h4 data-id="heading-39">GELU çš„ç›´è§‚ç†è§£</h4>
<pre><code class="hljs language-erlang" lang="erlang">GELU å¯ä»¥ç†è§£ä¸º<span class="hljs-string">"æ¦‚ç‡æ€§é—¨æ§"</span>ï¼š

å¯¹äºè¾“å…¥ xï¼š
â€¢ å½“ x å¾ˆå¤§ï¼ˆæ­£æ•°ï¼‰æ—¶ï¼šå‡ ä¹ <span class="hljs-number">100</span><span class="hljs-comment">% è®©å®ƒé€šè¿‡ â†’ è¾“å‡º â‰ˆ x</span>
â€¢ å½“ x å¾ˆå°ï¼ˆè´Ÿæ•°ï¼‰æ—¶ï¼šå‡ ä¹ <span class="hljs-number">0</span><span class="hljs-comment">% è®©å®ƒé€šè¿‡ â†’ è¾“å‡º â‰ˆ 0</span>
â€¢ å½“ x æ¥è¿‘ <span class="hljs-number">0</span> æ—¶ï¼šæœ‰ä¸€å®šæ¦‚ç‡é€šè¿‡ â†’ è¾“å‡ºåœ¨ <span class="hljs-number">0</span> å’Œ x ä¹‹é—´

è¿™æ¯” ReLU çš„<span class="hljs-string">"é0å³1"</span>æ›´å¹³æ»‘ï¼Œæœ‰åŠ©äºæ¨¡å‹è®­ç»ƒ
</code></pre>
<h2 data-id="heading-40">ç¬¬äºŒéƒ¨åˆ†ï¼šè¯­è¨€æ¨¡å‹åŸºç¡€æ¦‚å¿µ</h2>
<h3 data-id="heading-41">ä»€ä¹ˆæ˜¯ Tokenï¼ˆè¯å…ƒï¼‰ï¼Ÿ</h3>
<p>Token æ˜¯ AI å¤„ç†æ–‡æœ¬çš„æœ€å°å•ä½ï¼Œå¯ä»¥æ˜¯ä¸€ä¸ªè¯ï¼Œä¹Ÿå¯ä»¥æ˜¯è¯çš„ä¸€éƒ¨åˆ†ã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œå½“ä½ è¾“å…¥ <code>"I love programming"</code> æ—¶ï¼š</p>
<pre><code class="hljs language-css" lang="css">åŸæ–‡ï¼š      "<span class="hljs-selector-tag">I</span> love programming"
           â†“ åˆ†è¯ï¼ˆTokenizationï¼‰
Tokenï¼š    <span class="hljs-selector-attr">[<span class="hljs-string">"I"</span>, <span class="hljs-string">"love"</span>, <span class="hljs-string">"program"</span>, <span class="hljs-string">"ming"</span>]</span>
            â†‘    â†‘       â†‘          â†‘
           å®Œæ•´è¯ å®Œæ•´è¯   è¯çš„å‰åŠéƒ¨åˆ†  è¯çš„ååŠéƒ¨åˆ†
</code></pre>
<p>ä¸ºä»€ä¹ˆè¦è¿™æ ·åˆ†ï¼Ÿ</p>
<ul>
<li>å¦‚æœæ¯ä¸ªè¯éƒ½æ˜¯ä¸€ä¸ª Tokenï¼Œè¯æ±‡è¡¨ä¼šéå¸¸åºå¤§</li>
<li>æŠŠé•¿è¯æ‹†æˆå°å—ï¼Œå¯ä»¥ç”¨æ›´å°‘çš„"ç§¯æœ¨"æ‹¼å‡ºæ›´å¤šçš„è¯</li>
<li>GPT-2 çš„è¯æ±‡è¡¨æœ‰ 50,257 ä¸ª Tokenï¼Œå°±åƒæœ‰ 50,257 å—ä¹é«˜ç§¯æœ¨</li>
</ul>
<p>ä¸­æ–‡çš„ä¾‹å­ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">åŸæ–‡ï¼š     <span class="hljs-string">"æ•°æ®å¯è§†åŒ–"</span>
Tokenï¼š   [<span class="hljs-string">"æ•°æ®"</span>, <span class="hljs-string">"å¯è§†"</span>, <span class="hljs-string">"åŒ–"</span>]
</code></pre>
<h3 data-id="heading-42">ä»€ä¹ˆæ˜¯åµŒå…¥å‘é‡ï¼ˆEmbeddingï¼‰ï¼Ÿ</h3>
<p>åµŒå…¥å‘é‡æ˜¯æŠŠæ–‡å­—å˜æˆæ•°å­—çš„"é­”æ³•"ï¼Œè®©æ„æ€ç›¸è¿‘çš„è¯åœ¨æ•°å­—ç©ºé—´é‡Œä¹Ÿé å¾—è¿‘ã€‚</p>
<p>æƒ³è±¡ä¸€ä¸ªäºŒç»´å¹³é¢ï¼š</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-code">        ç¾å‘³ç¨‹åº¦ â†‘
              â”‚    ğŸè‹¹æœ
              â”‚         ğŸŠæ©™å­
              â”‚    
              â”‚              ğŸ•æŠ«è¨
              â”‚         ğŸ”æ±‰å ¡
              â”‚
        â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ ç”œåº¦
              â”‚
              â”‚    ğŸ¥¦è¥¿å…°èŠ±
              â”‚         ğŸ¥¬ç™½èœ
</span></code></pre>
<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼š</p>
<ul>
<li>è‹¹æœå’Œæ©™å­éƒ½æ˜¯æ°´æœï¼Œä½ç½®é è¿‘</li>
<li>æŠ«è¨å’Œæ±‰å ¡éƒ½æ˜¯å¿«é¤ï¼Œä½ç½®é è¿‘</li>
<li>è”¬èœåœ¨å¦ä¸€ä¸ªåŒºåŸŸ</li>
</ul>
<p>çœŸæ­£çš„åµŒå…¥å‘é‡ä¸æ˜¯2ç»´ï¼Œè€Œæ˜¯ 768ç»´ï¼ˆGPT-2ï¼‰ï¼äººç±»æ— æ³•æƒ³è±¡768ç»´ç©ºé—´ï¼Œä½†å¯¹è®¡ç®—æœºæ¥è¯´æ²¡é—®é¢˜ã€‚</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-string">"è‹¹æœ"</span> â†’ [<span class="hljs-number">0.23</span>, <span class="hljs-number">-0.45</span>, <span class="hljs-number">0.12</span>, <span class="hljs-number">0.67</span>, ..., <span class="hljs-number">0.34</span>]  â† <span class="hljs-number">768</span>ä¸ªæ•°å­—
<span class="hljs-string">"æ©™å­"</span> â†’ [<span class="hljs-number">0.21</span>, <span class="hljs-number">-0.43</span>, <span class="hljs-number">0.15</span>, <span class="hljs-number">0.65</span>, ..., <span class="hljs-number">0.32</span>]  â† å¾ˆç›¸ä¼¼ï¼
<span class="hljs-string">"æ±½è½¦"</span> â†’ [<span class="hljs-number">0.89</span>, <span class="hljs-number">0.12</span>, <span class="hljs-number">-0.78</span>, <span class="hljs-number">0.03</span>, ..., <span class="hljs-number">-0.56</span>] â† å¾ˆä¸åŒï¼
</code></pre>
<h2 data-id="heading-43">ç¬¬ä¸‰éƒ¨åˆ†ï¼šTransformer æ¶æ„è¯¦è§£</h2>
<p>ç°åœ¨ä½ å·²ç»äº†è§£äº†æ•°å­¦åŸºç¡€å’Œè¯­è¨€æ¨¡å‹æ¦‚å¿µï¼Œè®©æˆ‘ä»¬æ¥çœ‹ Transformer æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼</p>
<h3 data-id="heading-44">Transformer çš„ç›®æ ‡</h3>
<p>Transformer çš„æ ¸å¿ƒä»»åŠ¡ï¼šé¢„æµ‹ä¸‹ä¸€ä¸ªè¯ã€‚</p>
<pre><code class="hljs language-erlang" lang="erlang">è¾“å…¥ï¼š  <span class="hljs-string">"ä»Šå¤©å¤©æ°”çœŸ"</span>
          â†“
    [Transformer é­”æ³•ç›’å­]
          â†“
è¾“å‡ºï¼š  <span class="hljs-string">"å¥½"</span> (æ¦‚ç‡ <span class="hljs-number">85</span><span class="hljs-comment">%)</span>
        <span class="hljs-string">"ç³Ÿ"</span> (æ¦‚ç‡ <span class="hljs-number">10</span><span class="hljs-comment">%)</span>
        <span class="hljs-string">"çš„"</span> (æ¦‚ç‡ <span class="hljs-number">3</span><span class="hljs-comment">%)</span>
        ...
</code></pre>
<p>å°±åƒä½ å’Œæœ‹å‹èŠå¤©ï¼Œå¯¹æ–¹è¯´äº†åŠå¥è¯ï¼Œä½ å¯ä»¥çŒœå‡ºä¸‹ä¸€ä¸ªè¯æ˜¯ä»€ä¹ˆã€‚Transformer å°±æ˜¯åœ¨åšåŒæ ·çš„äº‹æƒ…ï¼</p>
<h3 data-id="heading-45">ä¸‰å¤§æ ¸å¿ƒç»„ä»¶</h3>
<p>Transformer ç”±ä¸‰ä¸ªæ ¸å¿ƒéƒ¨åˆ†ç»„æˆï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           è¾“å…¥ï¼š<span class="hljs-string">"Data visualization"</span>     â”‚
â”‚                    â†“                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  <span class="hljs-number">1</span>ï¸âƒ£ Embeddingï¼ˆåµŒå…¥å±‚ï¼‰          â”‚   â”‚  â† æ–‡å­—å˜æ•°å­—
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                    â†“                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  <span class="hljs-number">2</span>ï¸âƒ£ Transformer Blockï¼ˆÃ—<span class="hljs-number">12</span>ï¼‰    â”‚   â”‚  â† ç†è§£è¯­ä¹‰å…³ç³»
â”‚  â”‚     â€¢ æ³¨æ„åŠ›æœºåˆ¶                  â”‚   â”‚
â”‚  â”‚     â€¢ MLP å±‚                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                    â†“                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  <span class="hljs-number">3</span>ï¸âƒ£ Outputï¼ˆè¾“å‡ºå±‚ï¼‰             â”‚   â”‚  â† é¢„æµ‹ä¸‹ä¸€ä¸ªè¯
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                    â†“                    â”‚
â”‚           è¾“å‡ºï¼š<span class="hljs-string">"empowers"</span>               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h3 data-id="heading-46">åµŒå…¥å±‚ï¼ˆEmbedding Layerï¼‰</h3>
<p>åµŒå…¥å±‚è´Ÿè´£æŠŠæ–‡å­—"ç¿»è¯‘"æˆæ•°å­—ï¼Œåˆ†å››æ­¥å®Œæˆï¼š</p>
<h4 data-id="heading-47">æ­¥éª¤ 1ï¼šåˆ†è¯ï¼ˆTokenizationï¼‰</h4>
<pre><code class="hljs language-less" lang="less">"<span class="hljs-selector-tag">Data</span> <span class="hljs-selector-tag">visualization</span> <span class="hljs-selector-tag">empowers</span> <span class="hljs-selector-tag">users</span> <span class="hljs-selector-tag">to</span>"
         â†“ åˆ†è¯
<span class="hljs-selector-attr">[<span class="hljs-string">"Data"</span>, <span class="hljs-string">"visual"</span>, <span class="hljs-string">"ization"</span>, <span class="hljs-string">"emp"</span>, <span class="hljs-string">"owers"</span>, <span class="hljs-string">"users"</span>, <span class="hljs-string">"to"</span>]</span>
   <span class="hljs-selector-id">#1</span>      <span class="hljs-selector-id">#2</span>        <span class="hljs-selector-id">#3</span>       <span class="hljs-selector-id">#4</span>      <span class="hljs-selector-id">#5</span>      <span class="hljs-selector-id">#6</span>      <span class="hljs-selector-id">#7</span>
</code></pre>
<p>æ³¨æ„ <code>"empowers"</code> è¢«æ‹†æˆäº† <code>"emp"</code> å’Œ <code>"owers"</code> ä¸¤ä¸ª Tokenï¼</p>
<h4 data-id="heading-48">æ­¥éª¤ 2ï¼šToken åµŒå…¥ï¼ˆçŸ©é˜µæŸ¥è¡¨ï¼‰</h4>
<pre><code class="hljs language-ini" lang="ini">è¿™æ˜¯ä¸€ä¸ªçŸ©é˜µä¹˜æ³•æ“ä½œï¼

One-hot å‘é‡ Ã— åµŒå…¥çŸ©é˜µ = åµŒå…¥å‘é‡

<span class="hljs-section">[0,0,0,1,0,...,0]</span>  Ã—  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   =  <span class="hljs-section">[0.12, -0.34, ...]</span>
    (1Ã—50257)         â”‚ (50257 Ã— 768)   â”‚        (1Ã—768)
   Token <span class="hljs-attr">ID</span>=<span class="hljs-number">3</span>         â”‚  åµŒå…¥çŸ©é˜µ        â”‚      <span class="hljs-string">"Data"</span>çš„å‘é‡
                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h4 data-id="heading-49">æ­¥éª¤ 3ï¼šä½ç½®ç¼–ç </h4>
<p>é—®é¢˜ï¼š "æˆ‘çˆ±ä½ " å’Œ "ä½ çˆ±æˆ‘" æ„æ€å®Œå…¨ä¸åŒï¼Œä½†åŒ…å«ç›¸åŒçš„è¯ï¼</p>
<p>è§£å†³ï¼š ç»™æ¯ä¸ªä½ç½®åŠ ä¸Šä¸€ä¸ª"ä½ç½®ä¿¡æ¯"ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">ä½ç½®<span class="hljs-number">0</span> â†’ <span class="hljs-selector-attr">[0.01, 0.02, 0.03, ...]</span>  (<span class="hljs-number">768</span>ç»´)
ä½ç½®<span class="hljs-number">1</span> â†’ <span class="hljs-selector-attr">[0.04, 0.05, 0.06, ...]</span>  (<span class="hljs-number">768</span>ç»´)
ä½ç½®<span class="hljs-number">2</span> â†’ <span class="hljs-selector-attr">[0.07, 0.08, 0.09, ...]</span>  (<span class="hljs-number">768</span>ç»´)
...
</code></pre>
<h4 data-id="heading-50">æ­¥éª¤ 4ï¼šæœ€ç»ˆåµŒå…¥ï¼ˆå‘é‡ç›¸åŠ ï¼‰</h4>
<pre><code class="hljs language-css" lang="css">æœ€ç»ˆåµŒå…¥ = TokenåµŒå…¥ + ä½ç½®ç¼–ç 

<span class="hljs-selector-attr">[0.12, -0.34, 0.56, ...]</span> + <span class="hljs-selector-attr">[0.01, 0.02, 0.03, ...]</span> = <span class="hljs-selector-attr">[0.13, -0.32, 0.59, ...]</span>
     TokenåµŒå…¥                  ä½ç½®ç¼–ç                   æœ€ç»ˆåµŒå…¥
</code></pre>
<h3 data-id="heading-51">æ³¨æ„åŠ›æœºåˆ¶è¯¦è§£</h3>
<p>è¿™æ˜¯ Transformer æœ€æ ¸å¿ƒçš„åˆ›æ–°ï¼</p>
<h4 data-id="heading-52">æ³¨æ„åŠ›æœºåˆ¶ â€”â€” "è°è·Ÿè°ç›¸å…³ï¼Ÿ"</h4>
<p>æ³¨æ„åŠ›æœºåˆ¶è®©æ¯ä¸ªè¯éƒ½èƒ½"çœ‹åˆ°"å…¶ä»–è¯ï¼Œç†è§£å®ƒä»¬ä¹‹é—´çš„å…³ç³»ã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-string">"å°æ˜æŠŠè‹¹æœç»™äº†å°çº¢ï¼Œå¥¹å¾ˆå¼€å¿ƒ"</span>
</code></pre>
<p>å½“ AI è¯»åˆ° "å¥¹" æ—¶ï¼Œéœ€è¦çŸ¥é“ "å¥¹" æŒ‡çš„æ˜¯è°ã€‚æ³¨æ„åŠ›æœºåˆ¶ä¼šè®¡ç®—ï¼š</p>
<pre><code class="hljs language-erlang" lang="erlang"><span class="hljs-string">"å¥¹"</span> åº”è¯¥å…³æ³¨è°ï¼Ÿ
  â”œâ”€â”€ <span class="hljs-string">"å°æ˜"</span> â†’ ç›¸å…³åº¦ <span class="hljs-number">10</span><span class="hljs-comment">%  ï¼ˆç”·æ€§åå­—ï¼Œä¸å¤ªå¯èƒ½ï¼‰</span>
  â”œâ”€â”€ <span class="hljs-string">"è‹¹æœ"</span> â†’ ç›¸å…³åº¦ <span class="hljs-number">5</span><span class="hljs-comment">%   ï¼ˆæ°´æœï¼Œä¸æ˜¯äººï¼‰</span>
  â”œâ”€â”€ <span class="hljs-string">"å°çº¢"</span> â†’ ç›¸å…³åº¦ <span class="hljs-number">80</span><span class="hljs-comment">%  ï¼ˆå¥³æ€§åå­—ï¼Œå¾ˆå¯èƒ½ï¼ï¼‰</span>
  â””â”€â”€ <span class="hljs-string">"å¼€å¿ƒ"</span> â†’ ç›¸å…³åº¦ <span class="hljs-number">5</span><span class="hljs-comment">%   ï¼ˆå½¢å®¹è¯ï¼Œä¸æ˜¯äººï¼‰</span>
</code></pre>
<h4 data-id="heading-53">Qã€Kã€V æ˜¯ä»€ä¹ˆï¼Ÿï¼ˆæœç´¢å¼•æ“ç±»æ¯”ï¼‰</h4>
<p>æ³¨æ„åŠ›æœºåˆ¶ä½¿ç”¨ä¸‰ä¸ªçŸ©é˜µæ¥è®¡ç®—å…³ç³»ï¼š</p>
<p>åç§°</p>
<p>ç±»æ¯”</p>
<p>ä½œç”¨</p>
<p>Query (Q) æŸ¥è¯¢</p>
<p>ä½ åœ¨æœç´¢æ¡†è¾“å…¥çš„å†…å®¹</p>
<p>"æˆ‘æƒ³æ‰¾ä»€ä¹ˆï¼Ÿ"</p>
<p>Key (K) é”®</p>
<p>æ¯ä¸ªç½‘é¡µçš„æ ‡é¢˜</p>
<p>"æˆ‘æ˜¯ä»€ä¹ˆï¼Ÿ"</p>
<p>Value (V) å€¼</p>
<p>ç½‘é¡µçš„å®é™…å†…å®¹</p>
<p>"æˆ‘åŒ…å«ä»€ä¹ˆä¿¡æ¯ï¼Ÿ"</p>
<pre><code class="hljs language-markdown" lang="markdown">æœç´¢è¿‡ç¨‹ï¼š
<span class="hljs-bullet">1.</span> ä½ è¾“å…¥æœç´¢è¯ï¼ˆQueryï¼‰ï¼š"è‹¹æœæ‰‹æœº"
<span class="hljs-bullet">2.</span> æœç´¢å¼•æ“åŒ¹é…æ ‡é¢˜ï¼ˆKeyï¼‰ï¼šæ‰¾åˆ°ç›¸å…³ç½‘é¡µ
<span class="hljs-bullet">3.</span> è¿”å›å†…å®¹ï¼ˆValueï¼‰ï¼šæ˜¾ç¤ºç½‘é¡µå†…å®¹

æ³¨æ„åŠ›è¿‡ç¨‹ï¼š
<span class="hljs-bullet">1.</span> "å¥¹" çš„ Query é—®ï¼š"æˆ‘åº”è¯¥æŒ‡ä»£è°ï¼Ÿ"
<span class="hljs-bullet">2.</span> æ¯ä¸ªè¯çš„ Key å›ç­”ï¼š"æˆ‘æ˜¯ [å°æ˜/è‹¹æœ/å°çº¢/...]"
<span class="hljs-bullet">3.</span> åŒ¹é…æœ€é«˜çš„ Valueï¼ˆå°çº¢çš„ä¿¡æ¯ï¼‰è¢«é‡ç‚¹å…³æ³¨
</code></pre>
<h4 data-id="heading-54">Step 1: è®¡ç®— Qã€Kã€V çŸ©é˜µ</h4>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">Q</span> = X Ã— Wq + bq    (æŸ¥è¯¢çŸ©é˜µ)
<span class="hljs-attr">K</span> = X Ã— Wk + bk    (é”®çŸ©é˜µ)
<span class="hljs-attr">V</span> = X Ã— Wv + bv    (å€¼çŸ©é˜µ)

å…¶ä¸­ï¼š
â€¢ X æ˜¯è¾“å…¥åµŒå…¥ï¼Œå½¢çŠ¶ (åºåˆ—é•¿åº¦, 768)
â€¢ Wq, Wk, Wv æ˜¯å¯å­¦ä¹ çš„æƒé‡çŸ©é˜µï¼Œå½¢çŠ¶ (768, 768)
â€¢ bq, bk, bv æ˜¯åç½®å‘é‡

ä¾‹å¦‚ 7 ä¸ª Token çš„è¾“å…¥ï¼š
X:  (7, 768)
Wq: (768, 768)
Q:  (7, 768)  â† æ¯ä¸ª Token æœ‰ä¸€ä¸ª 768 ç»´çš„ Query å‘é‡
</code></pre>
<h4 data-id="heading-55">Step 2: è®¡ç®—æ³¨æ„åŠ›åˆ†æ•°ï¼ˆçŸ©é˜µä¹˜æ³• + ç¼©æ”¾ï¼‰</h4>
<pre><code class="hljs language-scss" lang="scss">æ³¨æ„åŠ›åˆ†æ•° = (Q Ã— Káµ€) / âˆš<span class="hljs-number">768</span>

è®¡ç®—è¿‡ç¨‹ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   <span class="hljs-selector-tag">Q</span> (<span class="hljs-number">7</span>Ã—<span class="hljs-number">768</span>)  â”‚  Ã—  â”‚  Káµ€ (<span class="hljs-number">768</span>Ã—<span class="hljs-number">7</span>)  â”‚  Ã·  âˆš<span class="hljs-number">768</span>
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Score (<span class="hljs-number">7</span>Ã—<span class="hljs-number">7</span>) â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Score<span class="hljs-selector-attr">[i]</span><span class="hljs-selector-attr">[j]</span> = ç¬¬ <span class="hljs-selector-tag">i</span> ä¸ªè¯å¯¹ç¬¬ j ä¸ªè¯çš„å…³æ³¨ç¨‹åº¦
</code></pre>
<h4 data-id="heading-56">Step 3: åº”ç”¨æ©ç ï¼ˆMaskï¼‰</h4>
<p>åœ¨ç”Ÿæˆæ–‡æœ¬æ—¶ï¼ŒAI ä¸èƒ½"å·çœ‹"æœªæ¥çš„å†…å®¹ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">æ©ç çŸ©é˜µï¼ˆä¸‹ä¸‰è§’ä¸º<span class="hljs-number">0</span>ï¼Œä¸Šä¸‰è§’ä¸º-âˆï¼‰ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  <span class="hljs-number">0</span>    -âˆ   -âˆ   -âˆ   -âˆ   â”‚  â† è¯<span class="hljs-number">1</span>åªèƒ½çœ‹è¯<span class="hljs-number">1</span>
â”‚  <span class="hljs-number">0</span>     <span class="hljs-number">0</span>   -âˆ   -âˆ   -âˆ   â”‚  â† è¯<span class="hljs-number">2</span>èƒ½çœ‹è¯<span class="hljs-number">1</span>,<span class="hljs-number">2</span>
â”‚  <span class="hljs-number">0</span>     <span class="hljs-number">0</span>    <span class="hljs-number">0</span>   -âˆ   -âˆ   â”‚  â† è¯<span class="hljs-number">3</span>èƒ½çœ‹è¯<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>
â”‚  <span class="hljs-number">0</span>     <span class="hljs-number">0</span>    <span class="hljs-number">0</span>    <span class="hljs-number">0</span>   -âˆ   â”‚  â† è¯<span class="hljs-number">4</span>èƒ½çœ‹è¯<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>
â”‚  <span class="hljs-number">0</span>     <span class="hljs-number">0</span>    <span class="hljs-number">0</span>    <span class="hljs-number">0</span>    <span class="hljs-number">0</span>   â”‚  â† è¯<span class="hljs-number">5</span>èƒ½çœ‹æ‰€æœ‰
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Score + Maskï¼š
-âˆ ç»è¿‡ softmax åå˜æˆ <span class="hljs-number">0</span>ï¼Œç›¸å½“äº<span class="hljs-string">"çœ‹ä¸è§"</span>
</code></pre>
<h4 data-id="heading-57">Step 4: Softmax å½’ä¸€åŒ–</h4>
<pre><code class="hljs language-erlang" lang="erlang">Attention Weights = softmax(Score + Mask)

æ¯ä¸€è¡ŒåŠ èµ·æ¥ = <span class="hljs-number">1</span>ï¼ˆæ¦‚ç‡åˆ†å¸ƒï¼‰

ä¾‹å¦‚ç¬¬ <span class="hljs-number">3</span> è¡Œï¼š[<span class="hljs-number">0.2</span>, <span class="hljs-number">0.3</span>, <span class="hljs-number">0.5</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>]
è¡¨ç¤ºç¬¬ <span class="hljs-number">3</span> ä¸ªè¯ï¼š
â€¢ <span class="hljs-number">20</span><span class="hljs-comment">% æ³¨æ„åŠ›ç»™è¯1</span>
â€¢ <span class="hljs-number">30</span><span class="hljs-comment">% æ³¨æ„åŠ›ç»™è¯2  </span>
â€¢ <span class="hljs-number">50</span><span class="hljs-comment">% æ³¨æ„åŠ›ç»™è¯3ï¼ˆè‡ªå·±ï¼‰</span>
â€¢ <span class="hljs-number">0</span><span class="hljs-comment">% ç»™è¯4,5ï¼ˆè¢«æ©ç æŒ¡ä½äº†ï¼‰</span>
</code></pre>
<h4 data-id="heading-58">Step 5: åŠ æƒæ±‚å’Œï¼ˆè¾“å‡ºï¼‰</h4>
<pre><code class="hljs language-scss" lang="scss">Output = Attention_Weights Ã— V

(<span class="hljs-number">7</span>Ã—<span class="hljs-number">7</span>) Ã— (<span class="hljs-number">7</span>Ã—<span class="hljs-number">768</span>) = (<span class="hljs-number">7</span>Ã—<span class="hljs-number">768</span>)

æ¯ä¸ªè¯çš„è¾“å‡º = å®ƒå…³æ³¨çš„æ‰€æœ‰è¯çš„ V å‘é‡çš„åŠ æƒå¹³å‡
</code></pre>
<h4 data-id="heading-59">å®Œæ•´æ³¨æ„åŠ›å…¬å¼</h4>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">Attention</span>(Q, K, V) = <span class="hljs-built_in">softmax</span>(Q Ã— Káµ€ / âˆšdâ‚–) Ã— V

å…¶ä¸­ dâ‚– = <span class="hljs-number">768</span>ï¼ˆKey çš„ç»´åº¦ï¼‰
</code></pre>
<h3 data-id="heading-60">å¤šå¤´æ³¨æ„åŠ›ï¼ˆMulti-Head Attentionï¼‰</h3>
<h4 data-id="heading-61">ä¸ºä»€ä¹ˆè¦"å¤šå¤´"ï¼Ÿ</h4>
<pre><code class="hljs language-erlang" lang="erlang">å•å¤´æ³¨æ„åŠ›ï¼šä¸€ä¸ªä¸“å®¶çœ‹é—®é¢˜
å¤šå¤´æ³¨æ„åŠ›ï¼š<span class="hljs-number">12</span>ä¸ªä¸“å®¶ä»ä¸åŒè§’åº¦çœ‹é—®é¢˜ï¼Œç„¶åç»¼åˆæ„è§

å°±åƒï¼š
â€¢ å¤´<span class="hljs-number">1</span>ï¼šå…³æ³¨è¯­æ³•å…³ç³»ï¼ˆä¸»è°“å®¾ï¼‰
â€¢ å¤´<span class="hljs-number">2</span>ï¼šå…³æ³¨è¯­ä¹‰å…³ç³»ï¼ˆè¿‘ä¹‰è¯ï¼‰
â€¢ å¤´<span class="hljs-number">3</span>ï¼šå…³æ³¨ä½ç½®å…³ç³»ï¼ˆç›¸é‚»è¯ï¼‰
â€¢ ...
â€¢ å¤´<span class="hljs-number">12</span>ï¼šå…³æ³¨å…¶ä»–æ¨¡å¼
</code></pre>
<h4 data-id="heading-62">å®ç°æ–¹å¼ï¼šåˆ†å‰²ç»´åº¦</h4>
<pre><code class="hljs language-less" lang="less">åŸå§‹ï¼š<span class="hljs-selector-tag">Q</span>, <span class="hljs-selector-tag">K</span>, <span class="hljs-selector-tag">V</span> éƒ½æ˜¯ (<span class="hljs-number">7</span>, <span class="hljs-number">768</span>)

åˆ†æˆ <span class="hljs-number">12</span> å¤´åï¼š
å¤´<span class="hljs-number">1</span>: <span class="hljs-selector-tag">Q</span>â‚(<span class="hljs-number">7</span>, <span class="hljs-number">64</span>), <span class="hljs-selector-tag">K</span>â‚(<span class="hljs-number">7</span>, <span class="hljs-number">64</span>), <span class="hljs-selector-tag">V</span>â‚(<span class="hljs-number">7</span>, <span class="hljs-number">64</span>)
å¤´<span class="hljs-number">2</span>: <span class="hljs-selector-tag">Q</span>â‚‚(<span class="hljs-number">7</span>, <span class="hljs-number">64</span>), <span class="hljs-selector-tag">K</span>â‚‚(<span class="hljs-number">7</span>, <span class="hljs-number">64</span>), <span class="hljs-selector-tag">V</span>â‚‚(<span class="hljs-number">7</span>, <span class="hljs-number">64</span>)
...
å¤´<span class="hljs-number">12</span>: <span class="hljs-selector-tag">Q</span>â‚â‚‚(<span class="hljs-number">7</span>, <span class="hljs-number">64</span>), <span class="hljs-selector-tag">K</span>â‚â‚‚(<span class="hljs-number">7</span>, <span class="hljs-number">64</span>), <span class="hljs-selector-tag">V</span>â‚â‚‚(<span class="hljs-number">7</span>, <span class="hljs-number">64</span>)

<span class="hljs-number">768</span> Ã· <span class="hljs-number">12</span> = <span class="hljs-number">64</span>ï¼ˆæ¯ä¸ªå¤´å¤„ç† <span class="hljs-number">64</span> ç»´ï¼‰
</code></pre>
<h4 data-id="heading-63">åˆå¹¶è¾“å‡º</h4>
<pre><code class="hljs language-scss" lang="scss">æ¯ä¸ªå¤´è¾“å‡ºï¼š(<span class="hljs-number">7</span>, <span class="hljs-number">64</span>)
<span class="hljs-number">12</span> ä¸ªå¤´æ‹¼æ¥ï¼š(<span class="hljs-number">7</span>, <span class="hljs-number">768</span>)
å†ç»è¿‡ä¸€ä¸ªçº¿æ€§å˜æ¢ï¼š(<span class="hljs-number">7</span>, <span class="hljs-number">768</span>)
</code></pre>
<h3 data-id="heading-64">MLP å±‚</h3>
<p>MLPï¼ˆå¤šå±‚æ„ŸçŸ¥æœºï¼‰å¯¹æ¯ä¸ªè¯è¿›è¡Œç‹¬ç«‹çš„æ·±åº¦åŠ å·¥ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">è¾“å…¥ (<span class="hljs-number">7</span>, <span class="hljs-number">768</span>)
      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç¬¬ä¸€å±‚çº¿æ€§å˜æ¢ï¼š(<span class="hljs-number">768</span> â†’ <span class="hljs-number">3072</span>)         â”‚  â† æ‰©å±• <span class="hljs-number">4</span> å€
â”‚ çŸ©é˜µä¹˜æ³• + åç½®                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â†“ (<span class="hljs-number">7</span>, <span class="hljs-number">3072</span>)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ GELU æ¿€æ´»å‡½æ•°                        â”‚  â† æ·»åŠ éçº¿æ€§
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â†“ (<span class="hljs-number">7</span>, <span class="hljs-number">3072</span>)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç¬¬äºŒå±‚çº¿æ€§å˜æ¢ï¼š(<span class="hljs-number">3072</span> â†’ <span class="hljs-number">768</span>)         â”‚  â† å‹ç¼©å›æ¥
â”‚ çŸ©é˜µä¹˜æ³• + åç½®                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â†“
è¾“å‡º (<span class="hljs-number">7</span>, <span class="hljs-number">768</span>)
</code></pre>
<p>ä¸ºä»€ä¹ˆè¦å…ˆæ‰©å±•å†å‹ç¼©ï¼Ÿ</p>
<p>å°±åƒå†™ä½œæ–‡ï¼š</p>
<ol>
<li>æ‰©å±•ï¼šå…ˆæŠŠæ‰€æœ‰æƒ³æ³•éƒ½å†™å‡ºæ¥ï¼ˆå¤´è„‘é£æš´ï¼‰</li>
<li>å‹ç¼©ï¼šå†ç²¾ç®€æˆæœ€é‡è¦çš„è§‚ç‚¹ï¼ˆæç‚¼ç²¾åï¼‰</li>
</ol>
<h3 data-id="heading-65">è¾“å‡ºå±‚</h3>
<p>ç»è¿‡ 12 å±‚ Transformer Block å¤„ç†åï¼ŒAI éœ€è¦é¢„æµ‹ä¸‹ä¸€ä¸ªè¯ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">æœ€åä¸€ä¸ª Token çš„è¡¨ç¤º (<span class="hljs-number">1</span>, <span class="hljs-number">768</span>)
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ çº¿æ€§å˜æ¢ï¼š(<span class="hljs-number">768</span> â†’ <span class="hljs-number">50257</span>)             â”‚
â”‚ å¾—åˆ°æ¯ä¸ªè¯çš„"åˆ†æ•°"ï¼ˆlogitsï¼‰         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“ (<span class="hljs-number">1</span>, <span class="hljs-number">50257</span>)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Softmaxï¼šè½¬æ¢ä¸ºæ¦‚ç‡åˆ†å¸ƒ             â”‚
â”‚ æ‰€æœ‰æ¦‚ç‡åŠ èµ·æ¥ = <span class="hljs-number">1</span>                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é‡‡æ ·ï¼šæ ¹æ® temperature, <span class="hljs-attribute">top</span>-k, <span class="hljs-attribute">top</span>-<span class="hljs-selector-tag">p</span>â”‚
â”‚ é€‰æ‹©ä¸‹ä¸€ä¸ª Token                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h2 data-id="heading-66">ç¬¬å››éƒ¨åˆ†ï¼šé‡‡æ ·ç­–ç•¥</h2>
<h3 data-id="heading-67">Temperatureï¼ˆæ¸©åº¦ï¼‰</h3>
<p>æ¸©åº¦æ§åˆ¶è¾“å‡ºçš„"éšæœºæ€§"ï¼š</p>
<p>æ¸©åº¦</p>
<p>æ•ˆæœ</p>
<p>æ¯”å–»</p>
<p><code>&lt; 1</code></p>
<p>æ›´ç¡®å®šã€ä¿å®ˆ</p>
<p>è€ƒè¯•æ—¶é€‰æœ€ç¨³å¦¥çš„ç­”æ¡ˆ</p>
<p><code>= 1</code></p>
<p>æ­£å¸¸çŠ¶æ€</p>
<p>å¹³å¸¸å¿ƒåšé€‰æ‹©</p>
<p><code>&gt; 1</code></p>
<p>æ›´éšæœºã€æœ‰åˆ›æ„</p>
<p>å¤§èƒ†å°è¯•æ–°é€‰é¡¹</p>
<pre><code class="hljs language-erlang" lang="erlang">æ¸©åº¦ = <span class="hljs-number">0.2</span>ï¼ˆä½æ¸©ï¼‰ï¼š
  <span class="hljs-string">"ä»Šå¤©å¤©æ°”çœŸ___"</span>  â†’  <span class="hljs-string">"å¥½"</span>ï¼ˆ<span class="hljs-number">99</span><span class="hljs-comment">%ç¡®å®šé€‰è¿™ä¸ªï¼‰</span>

æ¸©åº¦ = <span class="hljs-number">1.5</span>ï¼ˆé«˜æ¸©ï¼‰ï¼š
  <span class="hljs-string">"ä»Šå¤©å¤©æ°”çœŸ___"</span>  â†’  <span class="hljs-string">"å¥‡æ€ª/çƒ­/å†·/å¥½"</span>ï¼ˆæ›´å¤šå¯èƒ½æ€§ï¼‰
</code></pre>
<h3 data-id="heading-68">Top-k å’Œ Top-p é‡‡æ ·</h3>
<p>Top-kï¼šåªè€ƒè™‘æ¦‚ç‡æœ€é«˜çš„ k ä¸ªè¯</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">k</span> = <span class="hljs-number">3</span>ï¼šåªä» [<span class="hljs-string">"å¥½"</span>, <span class="hljs-string">"ç³Ÿ"</span>, <span class="hljs-string">"çƒ­"</span>] ä¸­é€‰æ‹©
</code></pre>
<p>Top-pï¼šé€‰æ‹©ç´¯è®¡æ¦‚ç‡è¾¾åˆ° p çš„è¯</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">p</span> = <span class="hljs-number">0.9</span>ï¼šé€‰æ‹©ç´¯è®¡æ¦‚ç‡è¾¾åˆ° <span class="hljs-number">90</span>% çš„è¯
å¦‚æœ <span class="hljs-attr">"å¥½"</span>=<span class="hljs-number">70</span>%, <span class="hljs-string">"ç³Ÿ"</span>=<span class="hljs-number">15</span>%, <span class="hljs-string">"çƒ­"</span>=<span class="hljs-number">10</span>%ï¼Œç´¯è®¡å·²è¾¾ <span class="hljs-number">95</span>%
å°±åªä»è¿™ä¸‰ä¸ªè¯ä¸­é€‰
</code></pre>
<h2 data-id="heading-69">ç¬¬äº”éƒ¨åˆ†ï¼šæ€»ç»“</h2>
<h3 data-id="heading-70">ä¿¡æ¯æµæ€»è§ˆ</h3>
<pre><code class="hljs language-scss" lang="scss">"ä»Šå¤©å¤©æ°”" 
    â†“ åˆ†è¯
<span class="hljs-selector-attr">[Token IDs]</span> 
    â†“ åµŒå…¥æŸ¥è¡¨ + ä½ç½®ç¼–ç 
<span class="hljs-selector-attr">[åµŒå…¥çŸ©é˜µ 7Ã—768]</span>
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Ã— <span class="hljs-number">12</span> å±‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â†“ Layer Norm                                  â”‚
â”‚  â†“ å¤šå¤´æ³¨æ„åŠ› (QÃ—Káµ€/âˆšd â†’ softmax â†’ Ã—V)        â”‚
â”‚  â†“ + æ®‹å·®è¿æ¥                                  â”‚
â”‚  â†“ Layer Norm                                  â”‚
â”‚  â†“ MLP (æ‰©å±•â†’GELUâ†’å‹ç¼©)                        â”‚
â”‚  â†“ + æ®‹å·®è¿æ¥                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
<span class="hljs-selector-attr">[è¾“å‡ºè¡¨ç¤º 7Ã—768]</span>
    â†“ å–æœ€åä¸€ä¸ª Token
<span class="hljs-selector-attr">[1Ã—768]</span>
    â†“ çº¿æ€§å˜æ¢
<span class="hljs-selector-attr">[1Ã—50257]</span> æ¯ä¸ªè¯çš„åˆ†æ•°
    â†“ Softmax
<span class="hljs-selector-attr">[æ¦‚ç‡åˆ†å¸ƒ]</span>
    â†“ é‡‡æ ·
"çœŸ" (ä¸‹ä¸€ä¸ªè¯)
</code></pre>
<h3 data-id="heading-71">æ•°å­¦æ“ä½œæ€»ç»“è¡¨</h3>
<p>æ“ä½œ</p>
<p>æ•°å­¦å…¬å¼</p>
<p>åœ¨ Transformer ä¸­çš„ä½œç”¨</p>
<p>çŸ©é˜µä¹˜æ³•</p>
<p>C = A Ã— B</p>
<p>çº¿æ€§å˜æ¢ã€Q/K/V è®¡ç®—</p>
<p>è½¬ç½®</p>
<p>Aáµ€</p>
<p>æ³¨æ„åŠ›åˆ†æ•°è®¡ç®—éœ€è¦ Káµ€</p>
<p>ç‚¹ç§¯</p>
<p>aÂ·b = Î£aáµ¢báµ¢</p>
<p>è®¡ç®—ä¸¤ä¸ªå‘é‡çš„ç›¸ä¼¼åº¦</p>
<p>ç¼©æ”¾</p>
<p>x / âˆšd</p>
<p>é˜²æ­¢ç‚¹ç§¯è¿‡å¤§</p>
<p>Softmax</p>
<p>eË£â± / Î£eË£Ê²</p>
<p>å°†åˆ†æ•°è½¬æ¢ä¸ºæ¦‚ç‡</p>
<p>Layer Norm</p>
<p>(x-Î¼)/Ïƒ</p>
<p>ç¨³å®šè®­ç»ƒè¿‡ç¨‹</p>
<p>æ®‹å·®è¿æ¥</p>
<p>y = F(x) + x</p>
<p>å¸®åŠ©æ¢¯åº¦æµåŠ¨</p>
<p>GELU</p>
<p>x Ã— Î¦(x)</p>
<p>æ·»åŠ éçº¿æ€§</p>
<h3 data-id="heading-72">å…³é”®æ¦‚å¿µå›é¡¾</h3>
<p>æ¦‚å¿µ</p>
<p>ä¸€å¥è¯è§£é‡Š</p>
<p>Token</p>
<p>AI å¤„ç†æ–‡æœ¬çš„æœ€å°å•ä½ï¼Œå¯ä»¥æ˜¯è¯æˆ–è¯çš„ä¸€éƒ¨åˆ†</p>
<p>åµŒå…¥å‘é‡</p>
<p>æŠŠæ–‡å­—å˜æˆæ•°å­—çš„"ç¿»è¯‘"æ–¹å¼</p>
<p>æ³¨æ„åŠ›æœºåˆ¶</p>
<p>è®©è¯èƒ½"çœ‹åˆ°"å…¶ä»–è¯ï¼Œç†è§£å…³ç³»</p>
<p>Q/K/V</p>
<p>æŸ¥è¯¢/é”®/å€¼ï¼Œç”¨æœç´¢å¼•æ“æ¥ç†è§£</p>
<p>å¤šå¤´æ³¨æ„åŠ›</p>
<p>å¤šä¸ªä¸“å®¶ä»ä¸åŒè§’åº¦åˆ†æ</p>
<p>MLP</p>
<p>å¯¹æ¯ä¸ªè¯è¿›è¡Œæ·±åº¦åŠ å·¥</p>
<p>æ¸©åº¦</p>
<p>æ§åˆ¶è¾“å‡ºçš„éšæœºç¨‹åº¦</p>
<h3 data-id="heading-73">GPT-2 å‚æ•°é‡è®¡ç®—</h3>
<p>ä»¥ GPT-2 (small) ä¸ºä¾‹ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">åµŒå…¥å±‚ï¼š
â€¢ Token åµŒå…¥ï¼š50,257 Ã— <span class="hljs-attr">768</span> = <span class="hljs-number">38</span>,<span class="hljs-number">597</span>,<span class="hljs-number">376</span>
â€¢ ä½ç½®åµŒå…¥ï¼š1,024 Ã— <span class="hljs-attr">768</span> = <span class="hljs-number">786</span>,<span class="hljs-number">432</span>

æ¯ä¸ª Transformer Blockï¼ˆÃ—12ï¼‰ï¼š
â€¢ æ³¨æ„åŠ› Wq, Wk, Wv, Woï¼š4 Ã— 768 Ã— <span class="hljs-attr">768</span> = <span class="hljs-number">2</span>,<span class="hljs-number">359</span>,<span class="hljs-number">296</span>
â€¢ MLP å±‚ï¼š768 Ã— 3072 + 3072 Ã— <span class="hljs-attr">768</span> = <span class="hljs-number">4</span>,<span class="hljs-number">718</span>,<span class="hljs-number">592</span>
â€¢ Layer Normï¼š2 Ã— 768 Ã— <span class="hljs-attr">2</span> = <span class="hljs-number">3</span>,<span class="hljs-number">072</span>

è¾“å‡ºå±‚ï¼š
â€¢ 768 Ã— 50,<span class="hljs-attr">257</span> = <span class="hljs-number">38</span>,<span class="hljs-number">597</span>,<span class="hljs-number">376</span>

æ€»è®¡çº¦ 124Mï¼ˆ1.24 äº¿ï¼‰å‚æ•°
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Claude CLI èœ‚ç¾¤æ¨¡å¼: å½“ AI å­¦ä¼š"å¸¦å›¢é˜Ÿ"]]></title>    <link>https://juejin.cn/post/7604037348608016422</link>    <guid>https://juejin.cn/post/7604037348608016422</guid>    <pubDate>2026-02-08T18:05:04.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604037348608016422" data-draft-id="7604039449467502642" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" Claude CLI èœ‚ç¾¤æ¨¡å¼: å½“ AI å­¦ä¼š&quot;å¸¦å›¢é˜Ÿ&quot;"/> <meta itemprop="keywords" content="å‰ç«¯,äººå·¥æ™ºèƒ½"/> <meta itemprop="datePublished" content="2026-02-08T18:05:04.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Hhang"/> <meta itemprop="url" content="https://juejin.cn/user/1994944446213274"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             Claude CLI èœ‚ç¾¤æ¨¡å¼: å½“ AI å­¦ä¼š"å¸¦å›¢é˜Ÿ"
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1994944446213274/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Hhang
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-08T18:05:04.000Z" title="Sun Feb 08 2026 18:05:04 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»8åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body cache result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Claude CLI èœ‚ç¾¤æ¨¡å¼: å½“ AI å­¦ä¼š"å¸¦å›¢é˜Ÿ"</h2>
<blockquote>
<p>ä»å•å…µä½œæˆ˜åˆ°å¤šæ™ºèƒ½ä½“åä½œ, Claude Code çš„èœ‚ç¾¤æ¨¡å¼æ­£åœ¨é‡æ–°å®šä¹‰ AI è¾…åŠ©å¼€å‘çš„è¾¹ç•Œã€‚</p>
</blockquote>
<h3 data-id="heading-1">å¼•è¨€</h3>
<p>ä½ æœ‰æ²¡æœ‰æƒ³è¿‡, è®© AI ä¸åªæ˜¯ä¸€ä¸ª"å†™ä»£ç çš„åŠ©æ‰‹", è€Œæ˜¯ä¸€ä¸ªèƒ½æ‹†è§£ä»»åŠ¡ã€åˆ†é…è§’è‰²ã€åè°ƒå›¢é˜Ÿçš„"æŠ€æœ¯è´Ÿè´£äºº"?</p>
<p>2026 å¹´ 2 æœˆ, Anthropic æ­£å¼å‘å¸ƒäº† Claude Code çš„èœ‚ç¾¤æ¨¡å¼(Swarm Mode)ã€‚è¿™ä¸ªåŠŸèƒ½å°† Claude Code ä»å•ä¸€ AI åŠ©æ‰‹å‡çº§ä¸ºå¤šæ™ºèƒ½ä½“ç¼–æ’ç³»ç»Ÿ -- ä½ ä¸å†æ˜¯åœ¨å’Œä¸€ä¸ª AI å¯¹è¯, è€Œæ˜¯åœ¨å’Œä¸€ä¸ª AI å›¢é˜Ÿåä½œã€‚</p>
<p>æœ¬æ–‡å°†ä»æŠ€æœ¯æ¶æ„ã€å·¥ä½œåŸç†ã€å®æˆ˜æ¡ˆä¾‹ä¸‰ä¸ªç»´åº¦, æ·±å…¥å‰–æè¿™ä¸€ç‰¹æ€§ã€‚</p>
<h3 data-id="heading-2">ä¸€ã€ä»å•æ™ºèƒ½ä½“åˆ°èœ‚ç¾¤: æ¼”è¿›ä¹‹è·¯</h3>
<p>AI è¾…åŠ©ç¼–ç¨‹ç»å†äº†å››ä¸ªé˜¶æ®µ:</p>






























<table><thead><tr><th>é˜¶æ®µ</th><th>ä»£è¡¨äº§å“</th><th>èƒ½åŠ›è¾¹ç•Œ</th></tr></thead><tbody><tr><td>ä»£ç è¡¥å…¨</td><td>GitHub Copilot</td><td>é¢„æµ‹ä¸‹ä¸€è¡Œä»£ç </td></tr><tr><td>å¯¹è¯å¼ç¼–ç¨‹</td><td>ChatGPT</td><td>å“åº”å•æ¬¡è¯·æ±‚</td></tr><tr><td>è‡ªä¸»æ™ºèƒ½ä½“</td><td>Claude Code / Cursor</td><td>æ‰§è¡Œå¤šæ­¥éª¤ä»»åŠ¡</td></tr><tr><td>èœ‚ç¾¤åä½œ</td><td>Claude Code Swarm</td><td>å¤šæ™ºèƒ½ä½“å¹¶è¡Œåè°ƒ</td></tr></tbody></table>
<p>å•æ™ºèƒ½ä½“çš„æ ¸å¿ƒç“¶é¢ˆåœ¨äº<strong>ä¸Šä¸‹æ–‡çª—å£</strong>ã€‚å½“ä¸€ä¸ª Claude å®ä¾‹é¢å¯¹å¤§å‹ä»£ç åº“æ—¶, å…‰æ˜¯åŠ è½½è¶³å¤Ÿçš„ä¸Šä¸‹æ–‡æ¥ç†è§£æ¶æ„, å°±å·²ç»æ¶ˆè€—äº†å¤§éƒ¨åˆ†å·¥ä½œè®°å¿†ã€‚èœ‚ç¾¤æ¨¡å¼çš„è§£å†³æ€è·¯å¾ˆç›´æ¥: <strong>åˆ†è€Œæ²»ä¹‹, å„å¸å…¶èŒ</strong>ã€‚</p>
<h3 data-id="heading-3">äºŒã€èœ‚ç¾¤æ¨¡å¼çš„æ ¸å¿ƒæ¶æ„</h3>
<h4 data-id="heading-4">2.1 è§’è‰²æ¨¡å‹</h4>
<p>èœ‚ç¾¤æ¨¡å¼é‡‡ç”¨ç»å…¸çš„ Leader-Worker æ¶æ„:</p>
<pre><code class="hljs language-scss" lang="scss">                    +------------------+
                    |    Team Lead     |
                    |  (è§„åˆ’/åè°ƒ/ç»¼åˆ) |
                    +--------+---------+
                             |
              +--------------+--------------+
              |              |              |
     +------<span class="hljs-attr">--v---</span>+  +----<span class="hljs-attr">--v-----</span>+  +---<span class="hljs-attr">--v------</span>+
     | Worker <span class="hljs-selector-tag">A</span>   |  | Worker <span class="hljs-selector-tag">B</span>   |  | Worker C   |
     | (å‰ç«¯ä¸“å®¶)  |  | (åç«¯ä¸“å®¶)  |  | (æµ‹è¯•ä¸“å®¶)  |
     +------------+  +------------+  +------------+
</code></pre>
<ul>
<li><strong>Team Lead</strong>: ä¸ç›´æ¥å†™ä»£ç , è´Ÿè´£ä»»åŠ¡æ‹†è§£ã€åˆ†é…ã€è¿›åº¦è·Ÿè¸ªå’Œç»“æœç»¼åˆ</li>
<li><strong>Worker</strong>: æ¯ä¸ª Worker æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ Claude ä¼šè¯, æ‹¥æœ‰ç‹¬ç«‹çš„ä¸Šä¸‹æ–‡çª—å£, ä¸“æ³¨äºç‰¹å®šä»»åŠ¡</li>
</ul>
<h4 data-id="heading-5">2.2 ä¸ƒä¸ªæ ¸å¿ƒåŸè¯­</h4>
<p>èœ‚ç¾¤æ¨¡å¼çš„åè°ƒå±‚ç”±ä¸ƒä¸ªå·¥å…·è°ƒç”¨(Tool Call)æ„æˆ:</p>
<pre><code class="hljs language-diff" lang="diff"><span class="hljs-addition">+-----------------------------------------------------------+</span>
|                    TEAM PRIMITIVES                         |
<span class="hljs-addition">+-----------------------------------------------------------+</span>
|  SETUP          |  WORK            |  COMMUNICATE          |
|  TeamCreate     |  TaskCreate      |  SendMessage          |
|  TeamDelete     |  TaskUpdate      |  (agent-to-agent)     |
|                 |  TaskList        |                       |
<span class="hljs-addition">+-----------------------------------------------------------+</span>
</code></pre>













































<table><thead><tr><th>åŸè¯­</th><th>èŒè´£</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>TeamCreate</code></td><td>åˆ›å»ºå›¢é˜Ÿ</td><td>ç”Ÿæˆå›¢é˜Ÿé…ç½®å’Œä»»åŠ¡ç›®å½•</td></tr><tr><td><code>TaskCreate</code></td><td>å®šä¹‰ä»»åŠ¡</td><td>æ¯ä¸ªä»»åŠ¡æ˜¯ç£ç›˜ä¸Šçš„ä¸€ä¸ª JSON æ–‡ä»¶</td></tr><tr><td><code>TaskUpdate</code></td><td>è®¤é¢†/å®Œæˆä»»åŠ¡</td><td>é€šè¿‡ status å­—æ®µé˜²æ­¢é‡å¤è®¤é¢†</td></tr><tr><td><code>TaskList</code></td><td>æŸ¥è¯¢ä»»åŠ¡çŠ¶æ€</td><td>å»ä¸­å¿ƒåŒ–è°ƒåº¦, æ¯ä¸ª Worker è‡ªè¡Œè½®è¯¢</td></tr><tr><td><code>Task</code></td><td>ç”Ÿæˆ Worker</td><td>é€šè¿‡ <code>team_name</code> å‚æ•°å°†å­æ™ºèƒ½ä½“å‡çº§ä¸ºå›¢é˜Ÿæˆå‘˜</td></tr><tr><td><code>SendMessage</code></td><td>æ™ºèƒ½ä½“é—´é€šä¿¡</td><td>æ”¯æŒç›´æ¥æ¶ˆæ¯ã€å¹¿æ’­ã€å…³é—­è¯·æ±‚ç­‰ç±»å‹</td></tr><tr><td><code>TeamDelete</code></td><td>æ¸…ç†å›¢é˜Ÿ</td><td>ç§»é™¤æ‰€æœ‰é…ç½®å’Œä»»åŠ¡æ–‡ä»¶</td></tr></tbody></table>
<h4 data-id="heading-6">2.3 ä¸å­æ™ºèƒ½ä½“(Subagent)çš„æœ¬è´¨åŒºåˆ«</h4>
<p>å­æ™ºèƒ½ä½“æ˜¯"å‘å°„åä¸ç®¡"çš„å·¥ä½œè€…, èœ‚ç¾¤æˆå‘˜æ˜¯<strong>åä½œè€…</strong>ã€‚</p>
<pre><code class="hljs language-css" lang="css">å­æ™ºèƒ½ä½“æ¨¡å¼ (å•å‘æ±‡æŠ¥)          èœ‚ç¾¤æ¨¡å¼ (å…¨å‘é€šä¿¡)

  <span class="hljs-selector-tag">Main</span> Agent                      Team Lead
   /  |  \                         /  |  \
  S1  S2  S3                      T1  T2  T3
                                   \  |  /
  S1 çœ‹ä¸åˆ° S2 çš„å‘ç°              T1 å¯ä»¥è¯»å– T2 çš„å‘ç°
  S2 æ— æ³•å‘ S3 æ±‚åŠ©               T2 å¯ä»¥å‘ T3 è¯·æ±‚ååŠ©
  <span class="hljs-selector-tag">Main</span> è´Ÿè´£æ‰€æœ‰ç»¼åˆå·¥ä½œ            Lead å¯ä»¥å§”æ‰˜ç»¼åˆå·¥ä½œ
</code></pre>
<p>è¿™æ„å‘³ç€: å½“ API Worker å®Œæˆäº†ç±»å‹å®šä¹‰, å®ƒå¯ä»¥<strong>ç›´æ¥é€šçŸ¥</strong> UI Worker, æ— éœ€ç»è¿‡ Lead ä¸­è½¬ã€‚æµ‹è¯• Worker å¯ä»¥<strong>ä¸»åŠ¨è¯¢é—®</strong> API Worker æ˜¯å¦å¯åŠ¨äº†å¼€å‘æœåŠ¡å™¨ã€‚è¿™ç§ç‚¹å¯¹ç‚¹é€šä¿¡å¤§å¹…å‡å°‘äº†åè°ƒå¼€é”€ã€‚</p>
<h3 data-id="heading-7">ä¸‰ã€ä»»åŠ¡ç”Ÿå‘½å‘¨æœŸä¸è°ƒåº¦æœºåˆ¶</h3>
<h4 data-id="heading-8">3.1 ä»»åŠ¡çŠ¶æ€æµè½¬</h4>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">PENDING</span>  <span class="hljs-string">â”€â”€&gt;</span>  <span class="hljs-string">IN_PROGRESS</span>  <span class="hljs-string">â”€â”€&gt;</span>  <span class="hljs-string">COMPLETED</span>
  <span class="hljs-string">|</span>               <span class="hljs-string">|
  |  Worker è‡ªè¡Œ   |  Worker å®Œæˆ
  |  è®¤é¢†æˆ– Lead   |  ä»»åŠ¡åæ›´æ–°
  |  åˆ†é…          |  çŠ¶æ€
</span></code></pre>
<h4 data-id="heading-9">3.2 ä¾èµ–æ„ŸçŸ¥çš„æ³¢æ¬¡æ‰§è¡Œ</h4>
<p>èœ‚ç¾¤æ¨¡å¼æ”¯æŒä»»åŠ¡é—´çš„ä¾èµ–å…³ç³», è‡ªåŠ¨æŒ‰æ³¢æ¬¡è°ƒåº¦:</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">Wave</span> <span class="hljs-number">1</span> <span class="hljs-string">(æ— ä¾èµ–):</span>    <span class="hljs-string">T1</span>  <span class="hljs-string">T2</span>  <span class="hljs-string">T3</span>    <span class="hljs-string">â”€â”€</span> <span class="hljs-string">å¹¶è¡Œæ‰§è¡Œ</span>
                     <span class="hljs-string">|</span>   <span class="hljs-string">|</span>   <span class="hljs-string">|
                     v   v   v
</span><span class="hljs-string">Wave</span> <span class="hljs-number">2</span> <span class="hljs-string">(ä¾èµ–</span> <span class="hljs-string">W1):</span>   <span class="hljs-string">T4</span>  <span class="hljs-string">T5</span>        <span class="hljs-string">â”€â”€</span> <span class="hljs-string">T1/T2/T3</span> <span class="hljs-string">å®Œæˆåå¯åŠ¨</span>
                      <span class="hljs-string">|</span>   <span class="hljs-string">|
                      v   v
</span><span class="hljs-string">Wave</span> <span class="hljs-number">3</span> <span class="hljs-string">(ä¾èµ–</span> <span class="hljs-string">W2):</span>    <span class="hljs-string">T6</span>            <span class="hljs-string">â”€â”€</span> <span class="hljs-string">T4/T5</span> <span class="hljs-string">å®Œæˆåå¯åŠ¨</span>
</code></pre>
<p>æ–‡ä»¶é”æœºåˆ¶ç¡®ä¿ä¸ä¼šæœ‰ä¸¤ä¸ª Worker åŒæ—¶è®¤é¢†åŒä¸€ä¸ªä»»åŠ¡ã€‚</p>
<h4 data-id="heading-10">3.3 ç£ç›˜ä¸Šçš„åè°ƒ</h4>
<p>æ‰€æœ‰åè°ƒçŠ¶æ€éƒ½æŒä¹…åŒ–åœ¨ç£ç›˜ä¸Š:</p>
<pre><code class="hljs language-ruby" lang="ruby">~<span class="hljs-regexp">/.claude/teams</span><span class="hljs-regexp">/{team-name}/config</span>.json    <span class="hljs-comment"># å›¢é˜Ÿé…ç½®</span>
~<span class="hljs-regexp">/.claude/tasks</span><span class="hljs-regexp">/{team-name}/</span><span class="hljs-number">1</span>.json         <span class="hljs-comment"># ä»»åŠ¡æ–‡ä»¶</span>
~<span class="hljs-regexp">/.claude/tasks</span><span class="hljs-regexp">/{team-name}/</span><span class="hljs-number">2</span>.json
...
</code></pre>
<p>ä»»åŠ¡æ–‡ä»¶ç¤ºä¾‹:</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"subject"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"å®ç°ä¿„ç½—æ–¯æ–¹å—æ¸¸æˆæ ¸å¿ƒé€»è¾‘"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"è´Ÿè´£æ–¹å—ç”Ÿæˆã€æ—‹è½¬ã€ç¢°æ’æ£€æµ‹ã€è¡Œæ¶ˆé™¤ç­‰æ ¸å¿ƒæ¸¸æˆæœºåˆ¶..."</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"status"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"in_progress"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"owner"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"game-developer"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-11">å››ã€å®æˆ˜æ¡ˆä¾‹: èœ‚ç¾¤å¼€å‘ä¿„ç½—æ–¯æ–¹å—</h3>
<p>é¦–å…ˆè¦å¼€å¯claudeçš„Agent teamåœ¨ç”¨æˆ·çš„.caudleçš„settings.json ä¸­è®¾ç½®</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-attr">"env"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"CLAUDE_CODE_EXPERIMENTAL_AGENT_TEAMS"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"true"</span>
  <span class="hljs-punctuation">}</span>
</code></pre>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªçœŸå®çš„èœ‚ç¾¤æ¨¡å¼è¿è¡Œæˆªå›¾:</p>
<p>ç”¨æˆ·è¾“å…¥äº†ä¸€æ¡ç®€å•çš„æŒ‡ä»¤:</p>
<blockquote>
<p>"å¸®æˆ‘å†™ä¸€ä¸ªä¿„ç½—æ–¯æ–¹å—, ä¸€ä¸ªè®¾è®¡ UI, ä¸€ä¸ªç­–åˆ’æ€ä¹ˆç•™ä½ç©å®¶, ä¸€ä¸ªå†™ä»£ç "
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/80a70f9c6fe94888b3bbc3198d4db113~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGhhbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771178703&amp;x-signature=a%2Bd57pCjD3Xh0VE5AfyuM51XXuc%3D" alt="image.png" loading="lazy"/></p>
</blockquote>
<p>Claude ç«‹å³ç†è§£äº†æ„å›¾, åˆ›å»ºäº†ä¸€ä¸ªèœ‚ç¾¤å›¢é˜Ÿ, åˆ†é…äº†ä¸‰ä¸ªä¸“ä¸šè§’è‰²:</p>
<h4 data-id="heading-12">4.1 å›¢é˜Ÿç»„æˆ</h4>





























<table><thead><tr><th>è§’è‰²</th><th>èŒè´£</th><th>å·¥å…·è°ƒç”¨</th><th>Token æ¶ˆè€—</th></tr></thead><tbody><tr><td>UI è®¾è®¡å¸ˆ</td><td>è´Ÿè´£è®¾è®¡ä¿„ç½—æ–¯æ–¹å—æ¸¸æˆçš„è§†è§‰ç•Œé¢</td><td>3 tool uses</td><td>18.6k tokens</td></tr><tr><td>æ¸¸æˆç­–åˆ’</td><td>è´Ÿè´£è®¾è®¡ç•™å­˜æœºåˆ¶å’Œæ¸¸æˆç©æ³•</td><td>1 tool use</td><td>18.4k tokens</td></tr><tr><td>å¼€å‘å·¥ç¨‹å¸ˆ</td><td>è´Ÿè´£å®ç°ä¿„ç½—æ–¯æ–¹å—æ¸¸æˆä»£ç </td><td>32 tool uses</td><td>19.0k tokens</td></tr></tbody></table>
<h4 data-id="heading-13">4.2 æ‰§è¡Œæµç¨‹</h4>
<pre><code class="hljs language-sql" lang="sql">ç”¨æˆ·: "å¸®æˆ‘å†™ä¸€ä¸ªä¿„ç½—æ–¯æ–¹å—..."
  <span class="hljs-operator">|</span>
  v
Lead Agent:
  <span class="hljs-number">1.</span> TeamCreate("tetris-dev")
  <span class="hljs-number">2.</span> TaskCreate x <span class="hljs-number">3</span> (UI<span class="hljs-operator">/</span>ç­–åˆ’<span class="hljs-operator">/</span>å¼€å‘)
  <span class="hljs-number">3.</span> Task(spawn) x <span class="hljs-number">3</span> (ç”Ÿæˆä¸‰ä¸ª Worker)
  <span class="hljs-operator">|</span>
  <span class="hljs-operator">+</span><span class="hljs-comment">---&gt; UI è®¾è®¡å¸ˆ</span>
  <span class="hljs-operator">|</span>     <span class="hljs-operator">-</span> Searching <span class="hljs-keyword">for</span> <span class="hljs-number">1</span> <span class="hljs-keyword">pattern</span>, reading <span class="hljs-number">2</span> files
  <span class="hljs-operator">|</span>     <span class="hljs-operator">-</span> è¾“å‡ºè§†è§‰è®¾è®¡æ–¹æ¡ˆ
  <span class="hljs-operator">|</span>
  <span class="hljs-operator">+</span><span class="hljs-comment">---&gt; æ¸¸æˆç­–åˆ’</span>
  <span class="hljs-operator">|</span>     <span class="hljs-operator">-</span> Bash: ç¡®è®¤å½“å‰å·¥ä½œç›®å½•
  <span class="hljs-operator">|</span>     <span class="hljs-operator">-</span> è¾“å‡ºç•™å­˜æœºåˆ¶è®¾è®¡æ–‡æ¡£
  <span class="hljs-operator">|</span>
  <span class="hljs-operator">+</span><span class="hljs-comment">---&gt; å¼€å‘å·¥ç¨‹å¸ˆ</span>
  <span class="hljs-operator">|</span>     <span class="hljs-operator">-</span> <span class="hljs-number">32</span> æ¬¡å·¥å…·è°ƒç”¨
  <span class="hljs-operator">|</span>     <span class="hljs-operator">-</span> Write: tetris.html
  <span class="hljs-operator">|</span>     <span class="hljs-operator">-</span> å®ç°å®Œæ•´æ¸¸æˆä»£ç 
  <span class="hljs-operator">|</span>
  v
Lead: ç»¼åˆä¸‰æ–¹äº§å‡º, äº¤ä»˜æœ€ç»ˆç»“æœ
æ€»è€—æ—¶: <span class="hljs-number">1</span>m <span class="hljs-number">6</span>s <span class="hljs-operator">|</span> æ€» Token: <span class="hljs-number">86</span>,<span class="hljs-number">258</span>
</code></pre>
<p>ä¸‰ä¸ªæ™ºèƒ½ä½“<strong>å¹¶è¡Œè¿è¡Œ</strong>, å„è‡ªåœ¨ç‹¬ç«‹çš„ä¸Šä¸‹æ–‡çª—å£ä¸­å·¥ä½œã€‚UI è®¾è®¡å¸ˆå‚è€ƒäº†ç°æœ‰æ–‡ä»¶æ¥ç¡®å®šè®¾è®¡é£æ ¼, æ¸¸æˆç­–åˆ’ç‹¬ç«‹æ€è€ƒç•™å­˜ç­–ç•¥, å¼€å‘å·¥ç¨‹å¸ˆåˆ™å¤§é‡è°ƒç”¨å·¥å…·æ¥ç¼–å†™å’Œæµ‹è¯•ä»£ç ã€‚</p>
<h4 data-id="heading-14">4.3 æˆæœ¬åˆ†æ</h4>
<p>èœ‚ç¾¤æ¨¡å¼çš„ Token æ¶ˆè€—æ˜¾è‘—é«˜äºå•æ™ºèƒ½ä½“:</p>
<pre><code class="hljs language-java" lang="java">å•æ™ºèƒ½ä½“å®ŒæˆåŒæ ·ä»»åŠ¡:  ~30k tokens
èœ‚ç¾¤æ¨¡å¼ (<span class="hljs-number">3</span> Workers):  ~86k <span class="hljs-title function_">tokens</span> <span class="hljs-params">(çº¦ <span class="hljs-number">2.</span>8x)</span>
</code></pre>
<p>ä½†æ¢æ¥çš„æ˜¯:</p>
<ul>
<li>æ‰§è¡Œæ—¶é—´ä»çº¦ 3 åˆ†é’Ÿå‹ç¼©åˆ°çº¦ 1 åˆ†é’Ÿ</li>
<li>æ¯ä¸ª Worker çš„ä¸Šä¸‹æ–‡åˆ©ç”¨ç‡æ›´é«˜(çº¦ 40% vs å•æ™ºèƒ½ä½“çš„ 80-90%)</li>
<li>äº§å‡ºè´¨é‡æ›´é«˜ -- ä¸“ä¸šåˆ†å·¥å¸¦æ¥æ›´æ·±å…¥çš„æ€è€ƒ</li>
</ul>
<h3 data-id="heading-15">äº”ã€Git Worktree éš”ç¦»</h3>
<p>èœ‚ç¾¤æ¨¡å¼çš„ä¸€ä¸ªç²¾å¦™è®¾è®¡: æ¯ä¸ª Worker åœ¨ç‹¬ç«‹çš„ Git Worktree ä¸­å·¥ä½œã€‚</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-selector-tag">main</span> branch (Lead)
  |
  +-- worktree/worker-<span class="hljs-selector-tag">a</span>  (UI è®¾è®¡å¸ˆ)
  +-- worktree/worker-<span class="hljs-selector-tag">b</span>  (æ¸¸æˆç­–åˆ’)
  +-- worktree/worker-c  (å¼€å‘å·¥ç¨‹å¸ˆ)
</code></pre>
<p>è¿™æ„å‘³ç€å¤šä¸ªæ™ºèƒ½ä½“å¯ä»¥åŒæ—¶ä¿®æ”¹ä¸åŒæ–‡ä»¶, ä¸ä¼šäº§ç”Ÿå†²çªã€‚åªæœ‰å½“æµ‹è¯•é€šè¿‡å, ä»£ç æ‰ä¼šåˆå¹¶å›ä¸»åˆ†æ”¯ã€‚è¿™ç§éš”ç¦»æœºåˆ¶è®©å¹¶è¡Œå¼€å‘çœŸæ­£å®‰å…¨å¯é ã€‚</p>
<h3 data-id="heading-16">å…­ã€æœ€ä½³å®è·µ</h3>
<h4 data-id="heading-17">6.1 å¯ç”¨èœ‚ç¾¤æ¨¡å¼</h4>
<p>åœ¨ <code>.claude/settings.json</code> ä¸­æ·»åŠ :</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"env"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"CLAUDE_CODE_EXPERIMENTAL_AGENT_TEAMS"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-18">6.2 æ¨èå·¥ä½œæµ: å…ˆè§„åˆ’, å†å¹¶è¡Œ</h4>
<p>æœ€é«˜æ•ˆçš„æ¨¡å¼ä¸æ˜¯ç›´æ¥å¯åŠ¨èœ‚ç¾¤, è€Œæ˜¯<strong>ä¸¤æ­¥èµ°</strong>:</p>
<ol>
<li><strong>Plan é˜¶æ®µ</strong>: ä½¿ç”¨ <code>/plan</code> æ¨¡å¼è®© Claude åˆ†æä»£ç åº“, äº§å‡ºå®æ–½è®¡åˆ’ã€‚è¿™ä¸€æ­¥æˆæœ¬ä½, åªè¯»å–æ–‡ä»¶ã€‚</li>
<li><strong>Execute é˜¶æ®µ</strong>: å®¡æ ¸è®¡åˆ’å, è®© Claude ä»¥èœ‚ç¾¤æ¨¡å¼å¹¶è¡Œæ‰§è¡Œã€‚è®¡åˆ’å·²ç»åŒ…å«äº†ä»»åŠ¡æ‹†è§£, èœ‚ç¾¤åªéœ€æŒ‰å›¾æ–½å·¥ã€‚</li>
</ol>
<h4 data-id="heading-19">6.3 æˆæœ¬ä¼˜åŒ–</h4>
<ul>
<li>Lead ä½¿ç”¨ Opus æ¨¡å‹(å¼ºæ¨ç†), Worker ä½¿ç”¨ Sonnet æ¨¡å‹(é«˜æ€§ä»·æ¯”)</li>
<li>ç®€å•ä»»åŠ¡ç”¨å•æ™ºèƒ½ä½“, å¤æ‚ä»»åŠ¡æ‰å¯ç”¨èœ‚ç¾¤</li>
<li>ä»»åŠ¡æè¿°è¶Šè¯¦ç»†, Worker çš„æ‰§è¡Œæ•ˆç‡è¶Šé«˜, å‡å°‘æ— æ•ˆ Token æ¶ˆè€—</li>
</ul>
<h4 data-id="heading-20">6.4 é€‚ç”¨åœºæ™¯åˆ¤æ–­</h4>
<pre><code class="hljs language-lua" lang="lua">å° Bug ä¿®å¤?           <span class="hljs-comment">--&gt; å•æ™ºèƒ½ä½“</span>
éœ€è¦è°ƒç ”/æ¢ç´¢?          <span class="hljs-comment">--&gt; å­æ™ºèƒ½ä½“</span>
å¤šæ–‡ä»¶å¹¶è¡Œå¼€å‘?         <span class="hljs-comment">--&gt; å­æ™ºèƒ½ä½“ + Task ç³»ç»Ÿ</span>
Worker ä¹‹é—´éœ€è¦é€šä¿¡?    <span class="hljs-comment">--&gt; èœ‚ç¾¤æ¨¡å¼</span>
</code></pre>
<h3 data-id="heading-21">ä¸ƒã€èœ‚ç¾¤æ¨¡å¼çš„å±€é™æ€§</h3>
<p>ä»»ä½•æŠ€æœ¯éƒ½æœ‰è¾¹ç•Œ, èœ‚ç¾¤æ¨¡å¼ä¹Ÿä¸ä¾‹å¤–:</p>

























<table><thead><tr><th>å±€é™</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Token æˆæœ¬é«˜</td><td>æ¯ä¸ª Worker æ˜¯å®Œæ•´ä¼šè¯, 3 ä¸ª Worker çº¦ 2-3x æˆæœ¬</td></tr><tr><td>å®éªŒæ€§è´¨</td><td>ç›®å‰ä»ä¸º Research Preview, ä¸å»ºè®®ç”¨äºç”Ÿäº§æµç¨‹</td></tr><tr><td>åè°ƒå¼€é”€</td><td>Worker æ•°é‡è¿‡å¤šæ—¶, é€šä¿¡å’Œè°ƒåº¦æœ¬èº«ä¼šæ¶ˆè€—å¤§é‡ Token</td></tr><tr><td>ç®€å•ä»»åŠ¡ä¸é€‚ç”¨</td><td>å¯¹äºå°å‹ä¿®æ”¹, èœ‚ç¾¤æ¨¡å¼æ˜¯"æ€é¸¡ç”¨ç‰›åˆ€"</td></tr></tbody></table>
<h3 data-id="heading-22">å…«ã€å±•æœ›</h3>
<p>èœ‚ç¾¤æ¨¡å¼ä»£è¡¨äº† AI è¾…åŠ©å¼€å‘çš„ä¸€ä¸ªé‡è¦æ–¹å‘: <strong>ä» AI åŠ©æ‰‹åˆ° AI å›¢é˜Ÿ</strong>ã€‚</p>
<p>Gartner æŠ¥å‘Šæ˜¾ç¤º, ä» 2024 Q1 åˆ° 2025 Q2, å¤šæ™ºèƒ½ä½“ç³»ç»Ÿçš„å’¨è¯¢é‡å¢é•¿äº† 1445%ã€‚é¢„è®¡åˆ° 2026 å¹´åº•, 40% çš„ä¼ä¸šåº”ç”¨å°†åŒ…å«ç‰¹å®šä»»åŠ¡çš„ AI æ™ºèƒ½ä½“ã€‚</p>
<p>å½“å‰çš„èœ‚ç¾¤æ¨¡å¼è¿˜åªæ˜¯èµ·ç‚¹ã€‚æœªæ¥å¯ä»¥æœŸå¾…çš„æ–¹å‘åŒ…æ‹¬:</p>
<ul>
<li>è·¨å›¢é˜Ÿåä½œ: å¤šä¸ªèœ‚ç¾¤ä¹‹é—´çš„åè°ƒ</li>
<li>æŒä¹…åŒ–è®°å¿†: Worker åœ¨å¤šæ¬¡ä¼šè¯é—´ä¿ç•™å­¦ä¹ æˆæœ</li>
<li>è‡ªé€‚åº”ä¸“ä¸šåŒ–: æ™ºèƒ½ä½“æ ¹æ®å†å²è¡¨ç°è‡ªåŠ¨ä¼˜åŒ–è§’è‰²åˆ†é…</li>
</ul>
<p>AI è¾…åŠ©å¼€å‘çš„æœªæ¥, ä¸æ˜¯ä¸€ä¸ªæ›´å¼ºå¤§çš„æ¨¡å‹, è€Œæ˜¯ä¸€ç¾¤å„æœ‰æ‰€é•¿çš„æ™ºèƒ½ä½“ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[SwiftUI View ç»§æ‰¿æ‰©å±•ï¼šåˆ«å†æ‰§ç€äº UIKit çš„â€œå­æ‰¿çˆ¶ä¸šâ€å•¦ï¼]]></title>    <link>https://juejin.cn/post/7604786493639835675</link>    <guid>https://juejin.cn/post/7604786493639835675</guid>    <pubDate>2026-02-10T05:59:33.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604786493639835675" data-draft-id="7604786493639802907" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="SwiftUI View ç»§æ‰¿æ‰©å±•ï¼šåˆ«å†æ‰§ç€äº UIKit çš„â€œå­æ‰¿çˆ¶ä¸šâ€å•¦ï¼"/> <meta itemprop="keywords" content="SwiftUI"/> <meta itemprop="datePublished" content="2026-02-10T05:59:33.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="SwiftUIå¤§å”"/> <meta itemprop="url" content="https://juejin.cn/user/203859213960105"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            SwiftUI View ç»§æ‰¿æ‰©å±•ï¼šåˆ«å†æ‰§ç€äº UIKit çš„â€œå­æ‰¿çˆ¶ä¸šâ€å•¦ï¼
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/203859213960105/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    SwiftUIå¤§å”
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T05:59:33.000Z" title="Tue Feb 10 2026 05:59:33 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»8åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åš iOS å¼€å‘çš„ï¼Œè°æ²¡åœ¨ UIKit é‡Œäº«å—è¿‡â€œç»§æ‰¿çš„å¿«ä¹â€ï¼Ÿæ¯”å¦‚å†™ä¸ª <code>BaseViewController</code>ï¼ŒæŠŠå¯¼èˆªæ æ ·å¼ã€åŠ è½½åŠ¨ç”»ã€ç©ºç™½é¡µç»Ÿä¸€å°è£…å¥½ï¼Œåé¢æ‰€æœ‰é¡µé¢ç›´æ¥ <code>: BaseViewController</code>ï¼Œä¸€é¡¿æ“ä½œçŒ›å¦‚è™ï¼Œä¸ç”¨é‡å¤å†™ä»£ç â€”â€”ä¸»æ‰“ä¸€ä¸ªâ€œçˆ¶å€ºå­è¿˜â€ï¼ˆä¸æ˜¯ï¼‰ï¼Œâ€œçˆ¶åŠŸå­äº«â€æ‰å¯¹ï¼</p>
<p>å¯ç­‰å’±ä»¬å…´å†²å†²è½¬åˆ° SwiftUIï¼Œæƒ³ä¾è‘«èŠ¦ç”»ç“¢å†™ä¸ª <code>BaseView</code>ï¼Œå†è®© <code>HomeView: BaseView</code> æ—¶ï¼ŒXcode ç›´æ¥ç»™ä½ æ³¼ä¸€ç›†å†·æ°´ï¼šâ€œå…„å¼Ÿï¼Œä½ æ€•ä¸æ˜¯å–å¤šäº†ï¼ŸView æ˜¯åè®®ï¼Œä¸æ˜¯ç±»ï¼Œä¸èƒ½ç»§æ‰¿ï¼â€</p>
<p>é‚£ä¸€åˆ»ï¼Œå¤šå°‘å¼€å‘è€…çš„å†…å¿ƒæ˜¯å´©æºƒçš„ï¼šâ€œSwiftUI ä½ ç©æˆ‘å‘¢ï¼ŸUIKit èƒ½è¡Œçš„äº‹ï¼Œä½ å‡­å•¥ä¸è¡Œï¼Ÿæˆ‘å°±æƒ³çœç‚¹åŠ²ï¼Œæœ‰é”™å—ï¼Ÿâ€</p>
<p>åˆ«æ€¥åˆ«æ€¥ï¼Œä»Šå¤©å°±ç”¨å” å—‘çš„æ–¹å¼ï¼Œæ‰’ä¸€æ‰’ SwiftUI ä¸ºå•¥â€œåéª¨â€ä¸æ”¯æŒ View ç»§æ‰¿ï¼Œä»¥åŠå®ƒåˆ°åº•è—äº†å•¥â€œéªšæ“ä½œâ€ï¼Œèƒ½æ¯” UIKit çš„ç»§æ‰¿æ›´çœå¿ƒï¼ˆå¶å°”ä¹Ÿæ›´é—¹å¿ƒï¼‰ã€‚</p>
<h2 data-id="heading-0">å…ˆåæ§½ï¼šUIKit çš„ç»§æ‰¿æœ‰å¤šé¦™ï¼ŒSwiftUI çš„â€œæ‹’ç»â€å°±æœ‰å¤šç¦»è°±ï¼Ÿ</h2>
<p>å’±ä»¬å…ˆå›å‘³ä¸‹ UIKit çš„â€œç»§æ‰¿çˆ½ç‚¹â€ï¼š</p>
<ul>
<li>ã€Œä¸€è„‰ç›¸æ‰¿ã€ï¼šBaseVC å†™å¥½å¯¼èˆªæ éšè—ã€è¿”å›æŒ‰é’®è‡ªå®šä¹‰ï¼Œæ‰€æœ‰å­ç±»è‡ªåŠ¨ç»§æ‰¿ï¼Œä¸ç”¨é‡å¤å†™ä¸€è¡Œä»£ç ï¼›</li>
<li>ã€ŒæŒ‰éœ€ä¿®æ”¹ã€ï¼šå­ç±»æƒ³æ”¹ä¸ªå¯¼èˆªæ é¢œè‰²ï¼Ÿé‡å†™ä¸ªæ–¹æ³•å°±è¡Œï¼Œä¸å½±å“å…¶ä»–å­ç±»ï¼Œä¸»æ‰“ä¸€ä¸ªâ€œä¸ªæ€§åŒ–ä¸ç ´åå…¨å±€â€ï¼›</li>
<li>ã€Œæ–°äººå‹å¥½ã€ï¼šæ–°äººæ¥æ‰‹é¡¹ç›®ï¼Œåªè¦æ‡‚ BaseVC çš„å°è£…ï¼Œæ‰€æœ‰é¡µé¢çš„åŸºç¡€é€»è¾‘ä¸€ç›®äº†ç„¶ï¼Œä¸ç”¨åˆ°å¤„æ‰¾é‡å¤ä»£ç ã€‚</li>
</ul>
<p>åè§‚ SwiftUIï¼Œä¸€ä¸Šæ¥å°±æ–­äº†â€œç»§æ‰¿â€è¿™æ¡è·¯â€”â€”æ ¸å¿ƒåŸå› å¾ˆç®€å•ï¼ˆè™½ç„¶å¬ç€æœ‰ç‚¹ç»•ï¼‰ï¼š<strong>SwiftUI çš„ View æ˜¯â€œåè®®â€ï¼Œä¸æ˜¯â€œç±»â€</strong> ï¼Œè€Œ Swift é‡Œçš„åè®®ï¼Œæœ¬èº«å°±ä¸æ”¯æŒâ€œç»§æ‰¿â€ï¼ˆåªèƒ½éµå¾ªï¼‰ï¼›å†åŠ ä¸Š SwiftUI é‡Œçš„ View è½½ä½“éƒ½æ˜¯ Structï¼ˆå€¼ç±»å‹ï¼‰ï¼Œå€¼ç±»å‹ä¹Ÿä¸èƒ½ç»§æ‰¿ï¼ˆåªæœ‰ç±»æ˜¯å¼•ç”¨ç±»å‹ï¼Œèƒ½ç»§æ‰¿ï¼‰ã€‚</p>
<p>è‹¹æœçˆ¸çˆ¸çš„å¿ƒæ€å…¶å®å¾ˆæ­ªï¼šâ€œæˆ‘å°±æ˜¯è¦é€¼ä½ ä»¬æ”¾å¼ƒâ€˜ç»§æ‰¿ä¾èµ–â€™ï¼Œå€¼ç±»å‹+åè®®çš„ç»„åˆï¼Œçº¿ç¨‹å®‰å…¨åˆè½»é‡ï¼Œä¸é¦™å—ï¼Ÿâ€ é¦™æ˜¯é¦™ï¼Œä½†åˆšå¼€å§‹ç¡®å®æµ‘èº«ä¸è‡ªåœ¨ï¼Œå°±åƒä¹ æƒ¯äº†ç”¨ç­·å­åƒé¥­ï¼Œçªç„¶è®©ä½ ç”¨å‰å­ï¼Œæ€ä¹ˆéƒ½è§‰å¾—åˆ«æ‰­ã€‚</p>
<h2 data-id="heading-1">é‡ç‚¹æ¥äº†ï¼šSwiftUI æ²¡æœ‰ç»§æ‰¿ï¼Œæ€ä¹ˆå®ç°â€œå¤ç”¨+æ‰©å±•â€ï¼Ÿ</h2>
<p>åˆ«æ…Œï¼ŒSwiftUI è™½ç„¶å µæ­»äº†â€œç»§æ‰¿â€è¿™ä¸€æ¡è·¯ï¼Œä½†å¼€äº† N æ¡â€œåé—¨â€ï¼Œæ¯ä¸€æ¡éƒ½æ¯”ç»§æ‰¿æ›´çµæ´»ï¼ˆå°±æ˜¯å¾—é€‚åº”é€‚åº”ï¼‰ï¼Œå’±ä»¬ä¸€æ¡æ¡å” ï¼Œç»“åˆåæ§½è®²æ˜ç™½ã€‚</p>
<h3 data-id="heading-2">æ–¹æ¡ˆ1ï¼šåè®®æ‰©å±• â€”â€” ç»™æ‰€æœ‰ View å‘â€œé€šç”¨ç¦åˆ©â€ï¼ˆæœ€çœå¿ƒï¼‰</h3>
<p>UIKit é‡Œ BaseVC çš„â€œå…¨å±€ç»Ÿä¸€æ ·å¼â€ï¼Œåœ¨ SwiftUI é‡Œç”¨ã€Œåè®®æ‰©å±•ã€å°±èƒ½å®ç°ï¼Œç›¸å½“äºç»™æ‰€æœ‰éµå¾ª View åè®®çš„â€œæ‰“å·¥äººâ€ï¼Œç»Ÿä¸€å‘ç¦åˆ©ï¼Œä¸ç”¨ä¸€ä¸ªä¸ªå•ç‹¬ç»™ã€‚</p>
<p>ä¸¾ä¸ªæ —å­ï¼šå’±ä»¬æƒ³è®©æ‰€æœ‰æŒ‰é’®éƒ½æœ‰ç»Ÿä¸€çš„åœ†è§’ã€èƒŒæ™¯è‰²ï¼Œä¸ç”¨æ¯ä¸ªæŒ‰é’®éƒ½å†™ <code>.cornerRadius(8).background(Color.blue)</code>ï¼Œç›´æ¥ç»™ View å†™ä¸ªåè®®æ‰©å±•ï¼š</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// è‡ªå®šä¹‰åè®®ï¼ˆå¯é€‰ï¼Œä¹Ÿå¯ä»¥ç›´æ¥æ‰©å±• Viewï¼‰</span>
protocol CommonButtonStyle: View {}

<span class="hljs-comment">// ç»™åè®®å†™æ‰©å±•ï¼Œå®ç°ç»Ÿä¸€æ ·å¼ï¼ˆç›¸å½“äº BaseVC çš„ç»Ÿä¸€é…ç½®ï¼‰</span>
extension CommonButtonStyle {
    func <span class="hljs-built_in">commonButton</span>() -&gt; some View {
        self
            <span class="hljs-selector-class">.cornerRadius</span>(<span class="hljs-number">8</span>) <span class="hljs-comment">// ç»Ÿä¸€åœ†è§’</span>
            <span class="hljs-selector-class">.background</span>(Color.blue) <span class="hljs-comment">// ç»Ÿä¸€èƒŒæ™¯è‰²</span>
            <span class="hljs-selector-class">.foregroundColor</span>(.white) <span class="hljs-comment">// ç»Ÿä¸€æ–‡å­—è‰²</span>
            <span class="hljs-selector-class">.padding</span>(.horizontal, <span class="hljs-number">16</span>) <span class="hljs-comment">// ç»Ÿä¸€æ°´å¹³å†…è¾¹è·</span>
            <span class="hljs-selector-class">.padding</span>(.vertical, <span class="hljs-number">8</span>)
    }
}

<span class="hljs-comment">// è®©æ‰€æœ‰ View éƒ½èƒ½â€œé¢†å–â€è¿™ä¸ªç¦åˆ©ï¼ˆéµå¾ªåè®®ï¼‰</span>
extension View: CommonButtonStyle {}

<span class="hljs-comment">// ä½¿ç”¨æ—¶ï¼Œä¸€å¥è¯æå®šï¼Œæ¯”ç»§æ‰¿è¿˜ç®€å•ï¼</span>
<span class="hljs-selector-tag">Button</span>("æˆ‘æ˜¯ç»Ÿä¸€æ ·å¼æŒ‰é’®") {
    <span class="hljs-built_in">print</span>("ç‚¹å‡»å•¦")
}
<span class="hljs-selector-class">.commonButton</span>() <span class="hljs-comment">// ç›´æ¥è°ƒç”¨æ‰©å±•æ–¹æ³•</span>
</code></pre>
<p>åæ§½ç‚¹ï¼šè¿™ç§æ–¹å¼ç¡®å®é¦™ï¼Œä½†æ˜¯ï¼åªèƒ½åŠ â€œé€šç”¨æ ·å¼/é€šç”¨æ–¹æ³•â€ï¼Œä¸èƒ½åŠ â€œä¸ªæ€§åŒ–çŠ¶æ€â€â€”â€”æ¯”å¦‚ä½ æƒ³è®©æŸä¸ªå­ç±»æŒ‰é’®æœ‰ä¸ªä¸“å±çš„åŠ è½½åŠ¨ç”»ï¼Œå…‰é åè®®æ‰©å±•å°±ä¸å¤Ÿäº†ï¼Œå¾—æ­é…å…¶ä»–æ–¹æ¡ˆã€‚</p>
<p>ä¼˜ç‚¹ï¼šé›¶è€¦åˆã€å…¨å±€å¯ç”¨ï¼Œæ”¹ä¸€å¤„ï¼Œæ‰€æœ‰ç”¨åˆ°çš„åœ°æ–¹éƒ½åŒæ­¥æ”¹ï¼Œæ¯” UIKit ç»§æ‰¿è¿˜çœå¿ƒï¼ˆä¸ç”¨ç»´æŠ¤ BaseView å­ç±»ï¼‰ã€‚</p>
<h3 data-id="heading-3">æ–¹æ¡ˆ2ï¼šç»„åˆå°è£… â€”â€” æŠŠâ€œé‡å¤ Viewâ€åšæˆâ€œä¹é«˜é›¶ä»¶â€ï¼ˆæœ€å¸¸ç”¨ï¼‰</h3>
<p>UIKit é‡Œï¼Œæˆ‘ä»¬ç»§æ‰¿ BaseVC æ˜¯ä¸ºäº†å¤ç”¨â€œå¯¼èˆªæ ã€ç©ºç™½é¡µâ€è¿™äº›é‡å¤ç»„ä»¶ï¼›è€Œ SwiftUI é‡Œï¼Œæ›´æ¨èâ€œç»„åˆä¼˜äºç»§æ‰¿â€â€”â€”æŠŠé‡å¤çš„ View æŠ½æˆä¸€ä¸ªç‹¬ç«‹çš„ Structï¼Œç”¨åˆ°çš„æ—¶å€™ç›´æ¥â€œæ‹¼â€ä¸Šå»ï¼Œå°±åƒæ­ä¹é«˜ï¼Œæƒ³è¦å“ªä¸ªé›¶ä»¶å°±æ”¾å“ªä¸ªï¼Œä¸ç”¨ç»§æ‰¿æ•´ä¸ªâ€œåº•åº§â€ã€‚</p>
<p>ä¸¾ä¸ªæ —å­ï¼šAPP æ‰€æœ‰é¡µé¢éƒ½æœ‰ç»Ÿä¸€çš„â€œæ ‡é¢˜æ â€ï¼ˆå·¦è¾¹è¿”å›æŒ‰é’®ï¼Œä¸­é—´æ ‡é¢˜ï¼‰ï¼ŒUIKit é‡Œæˆ‘ä»¬ä¼šåœ¨ BaseVC é‡Œå†™å¥½æ ‡é¢˜æ ï¼›SwiftUI é‡Œï¼Œç›´æ¥æŠŠæ ‡é¢˜æ åšæˆä¸€ä¸ªç‹¬ç«‹ Viewï¼š</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// å°è£…é€šç”¨æ ‡é¢˜æ ï¼ˆç›¸å½“äº BaseVC é‡Œçš„æ ‡é¢˜æ é€»è¾‘ï¼‰</span>
struct CommonNavigationBar: View {
    let title: String // å¯é…ç½®æ ‡é¢˜ï¼ˆä¸ªæ€§åŒ–å‚æ•°ï¼‰
    let onBack: () -&gt; Void // å¯é…ç½®è¿”å›äº‹ä»¶ï¼ˆä¸ªæ€§åŒ–å›è°ƒï¼‰
    
    var body: some View {
        HStack {
            <span class="hljs-comment">// è¿”å›æŒ‰é’®</span>
            <span class="hljs-selector-tag">Button</span>(action: onBack) {
                <span class="hljs-built_in">Image</span>(systemName: "chevron.left")
                    <span class="hljs-selector-class">.foregroundColor</span>(.black)
            }
            <span class="hljs-built_in">Spacer</span>()
            <span class="hljs-comment">// æ ‡é¢˜</span>
            Text(title)
                <span class="hljs-selector-class">.font</span>(.title2)
                <span class="hljs-selector-class">.fontWeight</span>(.bold)
            <span class="hljs-built_in">Spacer</span>()
            <span class="hljs-comment">// å ä½ï¼ˆå’Œè¿”å›æŒ‰é’®å¯¹ç§°ï¼Œç¾è§‚ï¼‰</span>
            <span class="hljs-attribute">Color</span><span class="hljs-selector-class">.clear</span><span class="hljs-selector-class">.frame</span>(width: <span class="hljs-number">24</span>)
        }
        <span class="hljs-selector-class">.padding</span>(.horizontal, <span class="hljs-number">16</span>)
        <span class="hljs-selector-class">.padding</span>(.vertical, <span class="hljs-number">12</span>)
    }
}

<span class="hljs-comment">// é¡µé¢ä½¿ç”¨ï¼šç›´æ¥ç»„åˆï¼Œä¸ç”¨ç»§æ‰¿ï¼Œæƒ³æ”¹å°±æ”¹</span>
struct HomeView: View {
    <span class="hljs-selector-tag">var</span> <span class="hljs-selector-tag">body</span>: some View {
        VStack {
            <span class="hljs-comment">// ç»„åˆæ ‡é¢˜æ ï¼Œä¼ å…¥ä¸ªæ€§åŒ–å‚æ•°</span>
            <span class="hljs-built_in">CommonNavigationBar</span>(title: "é¦–é¡µ") {
                <span class="hljs-built_in">print</span>("è¿”å›ä¸Šä¸€é¡µ")
            }
            <span class="hljs-built_in">Spacer</span>()
            Text("é¦–é¡µå†…å®¹")
            <span class="hljs-built_in">Spacer</span>()
        }
    }
}

struct MineView: View {
    <span class="hljs-selector-tag">var</span> <span class="hljs-selector-tag">body</span>: some View {
        VStack {
            <span class="hljs-comment">// åŒä¸€ä¸ªæ ‡é¢˜æ ï¼Œæ¢ä¸ªæ ‡é¢˜å’Œå›è°ƒï¼Œå°±æ˜¯è‡ªå·±çš„æ ·å¼</span>
            <span class="hljs-built_in">CommonNavigationBar</span>(title: "æˆ‘çš„") {
                <span class="hljs-built_in">print</span>("è¿”å›é¦–é¡µ")
            }
            <span class="hljs-built_in">Spacer</span>()
            Text("æˆ‘çš„å†…å®¹")
            <span class="hljs-built_in">Spacer</span>()
        }
    }
}
</code></pre>
<p>åæ§½ç‚¹ï¼šè¿™ç§æ–¹å¼æ¯”ç»§æ‰¿æ›´çµæ´»ï¼Œä½†å¦‚æœé‡å¤ç»„ä»¶å¤ªå¤šï¼ˆæ¯”å¦‚æ ‡é¢˜æ ã€åŠ è½½æ¡†ã€ç©ºç™½é¡µã€é”™è¯¯é¡µï¼‰ï¼Œæ¯ä¸ªé¡µé¢éƒ½è¦æ‰‹åŠ¨â€œæ‹¼â€ï¼Œç¡®å®æœ‰ç‚¹ç¹çâ€”â€”ä¸è¿‡æ€»æ¯”é‡å¤å†™ä»£ç å¼ºï¼Œè€Œä¸”å¯ä»¥è‡ªç”±ç»„åˆï¼Œä¸æƒ³ç”¨æŸä¸ªé›¶ä»¶å°±ç›´æ¥åˆ æ‰ï¼Œæ¯”ç»§æ‰¿çš„â€œæ†ç»‘é”€å”®â€èˆ’æœå¤šäº†ã€‚</p>
<p>ä¼˜ç‚¹ï¼šé«˜åº¦è§£è€¦ï¼Œæ¯ä¸ªç»„ä»¶éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œä¿®æ”¹ä¸€ä¸ªç»„ä»¶ä¸ä¼šå½±å“å…¶ä»–ç»„ä»¶ï¼›å¯å®šåˆ¶æ€§å¼ºï¼Œä¼ å…¥ä¸åŒå‚æ•°å°±èƒ½å®ç°ä¸åŒæ•ˆæœï¼Œæ¯” UIKit ç»§æ‰¿çš„â€œé‡å†™æ–¹æ³•â€æ›´ç®€å•ã€‚</p>
<h3 data-id="heading-4">æ–¹æ¡ˆ3ï¼šModifier ä¿®é¥°å™¨ â€”â€” ç»™ View è´´â€œä¸ªæ€§åŒ–æ ‡ç­¾â€ï¼ˆæœ€çµæ´»ï¼‰</h3>
<p>å¦‚æœè¯´åè®®æ‰©å±•æ˜¯â€œå…¨å±€ç»Ÿä¸€ç¦åˆ©â€ï¼Œç»„åˆå°è£…æ˜¯â€œä¹é«˜é›¶ä»¶â€ï¼Œé‚£ Modifier å°±æ˜¯â€œä¸ªæ€§åŒ–è´´çº¸â€â€”â€”å¯ä»¥ç»™ä»»æ„ View è´´ä¸åŒçš„è´´çº¸ï¼Œå®ç°ä¸åŒçš„æ ·å¼/åŠŸèƒ½ï¼Œè€Œä¸”å¯ä»¥å åŠ ä½¿ç”¨ï¼Œæ¯”ç»§æ‰¿çš„â€œé‡å†™â€çµæ´»ä¸€ç™¾å€ã€‚</p>
<p>å…¶å® SwiftUI è‡ªå¸¦çš„ <code>.cornerRadius()</code>ã€<code>.background()</code> éƒ½æ˜¯ Modifierï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è‡ªå®šä¹‰ Modifierï¼Œå®ç°è‡ªå·±çš„â€œæ‰©å±•é€»è¾‘â€ï¼Œç›¸å½“äºç»™ View åŠ â€œä¸“å±æŠ€èƒ½â€ã€‚</p>
<p>ä¸¾ä¸ªæ —å­ï¼šæˆ‘ä»¬æƒ³ç»™æŸäº› View åŠ ä¸€ä¸ªâ€œåŠ è½½ä¸­é®ç½©â€ï¼ŒUIKit é‡Œå¯èƒ½è¦åœ¨ BaseVC é‡Œå†™ä¸ª <code>showLoading()</code> æ–¹æ³•ï¼Œå­ç±»è°ƒç”¨ï¼›SwiftUI é‡Œï¼Œè‡ªå®šä¹‰ä¸€ä¸ª Modifier å°±è¡Œï¼š</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-comment">// è‡ªå®šä¹‰ Modifierï¼šåŠ è½½ä¸­é®ç½©</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">LoadingModifier</span>: <span class="hljs-title class_">ViewModifier</span> {
    <span class="hljs-keyword">let</span> isLoading: <span class="hljs-type">Bool</span> <span class="hljs-comment">// æ§åˆ¶æ˜¯å¦æ˜¾ç¤ºï¼ˆä¸ªæ€§åŒ–å‚æ•°ï¼‰</span>
    
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">body</span>(<span class="hljs-params">content</span>: <span class="hljs-type">Content</span>) -&gt; <span class="hljs-keyword">some</span> <span class="hljs-type">View</span> {
        content
            .overlay {
                <span class="hljs-keyword">if</span> isLoading {
                    <span class="hljs-comment">// é®ç½©+åŠ è½½åŠ¨ç”»</span>
                    <span class="hljs-type">ZStack</span> {
                        <span class="hljs-type">Color</span>.black.opacity(<span class="hljs-number">0.3</span>)
                            .ignoresSafeArea()
                        <span class="hljs-type">ProgressView</span>(<span class="hljs-string">"åŠ è½½ä¸­..."</span>)
                            .foregroundColor(.white)
                            .padding()
                            .background(<span class="hljs-type">Color</span>.black.opacity(<span class="hljs-number">0.5</span>))
                            .cornerRadius(<span class="hljs-number">8</span>)
                    }
                }
            }
    }
}

<span class="hljs-comment">// æ‰©å±• Viewï¼Œè®©æ‰€æœ‰ View éƒ½èƒ½ä½¿ç”¨è¿™ä¸ª Modifier</span>
<span class="hljs-keyword">extension</span> <span class="hljs-title class_">View</span> {
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">loading</span>(<span class="hljs-params">isLoading</span>: <span class="hljs-type">Bool</span>) -&gt; <span class="hljs-keyword">some</span> <span class="hljs-type">View</span> {
        <span class="hljs-keyword">self</span>.modifier(<span class="hljs-type">LoadingModifier</span>(isLoading: isLoading))
    }
}

<span class="hljs-comment">// ä½¿ç”¨æ—¶ï¼Œä»»æ„ View éƒ½èƒ½åŠ åŠ è½½é®ç½©ï¼Œä¸ç”¨ç»§æ‰¿ï¼</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">DetailView</span>: <span class="hljs-title class_">View</span> {
    <span class="hljs-meta">@State</span> <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> isLoading <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>
    
    <span class="hljs-keyword">var</span> body: <span class="hljs-keyword">some</span> <span class="hljs-type">View</span> {
        <span class="hljs-type">Text</span>(<span class="hljs-string">"è¯¦æƒ…é¡µå†…å®¹"</span>)
            .loading(isLoading: isLoading) <span class="hljs-comment">// ç›´æ¥è´´â€œåŠ è½½è´´çº¸â€</span>
            .onAppear {
                <span class="hljs-comment">// æ¨¡æ‹ŸåŠ è½½å®Œæˆ</span>
                <span class="hljs-type">DispatchQueue</span>.main.asyncAfter(deadline: .now() <span class="hljs-operator">+</span> <span class="hljs-number">2</span>) {
                    isLoading <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>
                }
            }
    }
}
</code></pre>
<p>åæ§½ç‚¹ï¼šModifier ç¡®å®çµæ´»ï¼Œä½†å†™å¤šäº†å®¹æ˜“ä¹±ï¼Œæ¯”å¦‚ä¸€ä¸ª View å åŠ äº†äº”å…­ä¸ª Modifierï¼Œå¯è¯»æ€§å°±å˜å·®äº†â€”â€”ä¸è¿‡æ¯”èµ· UIKit é‡Œç»§æ‰¿å±‚å±‚åµŒå¥—ã€é‡å†™æ–¹æ³•æ··ä¹±çš„é—®é¢˜ï¼Œè¿™ç‚¹ä¹±çœŸä¸ç®—å•¥ã€‚</p>
<p>ä¼˜ç‚¹ï¼šå¯å åŠ ã€å¯å¤ç”¨ã€å¯å®šåˆ¶ï¼Œä»»æ„ View éƒ½èƒ½ä½¿ç”¨ï¼Œä¸ç”¨å—ç»§æ‰¿å…³ç³»é™åˆ¶ï¼›è€Œä¸” Modifier æ˜¯â€œæ— ä¾µå…¥â€çš„ï¼Œä¸ä¼šæ”¹å˜ View æœ¬èº«çš„ç»“æ„ï¼Œæ¯”ç»§æ‰¿æ›´å®‰å…¨ã€‚</p>
<h3 data-id="heading-5">æ–¹æ¡ˆ4ï¼š@ViewBuilder â€”â€” å°è£…â€œå¯å˜å†…å®¹â€çš„ç»„åˆï¼ˆè¿›é˜¶éªšæ“ä½œï¼‰</h3>
<p>æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬æƒ³å°è£…ä¸€ä¸ªâ€œå®¹å™¨ Viewâ€ï¼Œé‡Œé¢çš„å†…å®¹æ˜¯å¯å˜çš„ï¼ˆæ¯”å¦‚ BaseVC é‡Œçš„ <code>contentView</code>ï¼‰ï¼Œè¿™æ—¶å€™å°±å¯ä»¥ç”¨ <code>@ViewBuilder</code>ï¼Œç›¸å½“äºç»™â€œä¹é«˜åº•åº§â€ç•™äº†ä¸ªâ€œè‡ªå®šä¹‰å‡¹æ§½â€ï¼Œæƒ³æ”¾ä»€ä¹ˆå†…å®¹å°±æ”¾ä»€ä¹ˆå†…å®¹ï¼Œæ¯”ç»§æ‰¿æ›´çµæ´»ã€‚</p>
<p>ä¸¾ä¸ªæ —å­ï¼šå°è£…ä¸€ä¸ªâ€œå¸¦æ ‡é¢˜æ +åº•éƒ¨æŒ‰é’®â€çš„å®¹å™¨ Viewï¼Œä¸­é—´å†…å®¹ç”±å­ç±»ï¼ˆé¡µé¢ï¼‰è‡ªå®šä¹‰ï¼š</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// å°è£…å®¹å™¨ Viewï¼Œç”¨ @ViewBuilder æ¥æ”¶å¯å˜å†…å®¹</span>
struct ContainerView&lt;<span class="hljs-attribute">Content</span>: View&gt;: View {
    let title: String
    let bottomButtonTitle: String
    let onBottomButtonClick: () -&gt; Void
    // ç”¨ @ViewBuilder æ¥æ”¶è‡ªå®šä¹‰å†…å®¹
    @ViewBuilder let content: () -&gt; Content
    
    var body: some View {
        VStack {
            <span class="hljs-comment">// é€šç”¨æ ‡é¢˜æ </span>
            <span class="hljs-built_in">CommonNavigationBar</span>(title: title) {
                <span class="hljs-built_in">print</span>("è¿”å›")
            }
            <span class="hljs-comment">// è‡ªå®šä¹‰å†…å®¹ï¼ˆé¡µé¢è‡ªå·±çš„å†…å®¹ï¼‰</span>
            <span class="hljs-attribute">content</span>()
                <span class="hljs-selector-class">.flexibleFrame</span>(maxWidth: .infinity, maxHeight: .infinity)
            <span class="hljs-comment">// é€šç”¨åº•éƒ¨æŒ‰é’®</span>
            <span class="hljs-selector-tag">Button</span>(action: onBottomButtonClick) {
                Text(bottomButtonTitle)
                    <span class="hljs-selector-class">.commonButton</span>() <span class="hljs-comment">// å¤ç”¨ä¹‹å‰çš„åè®®æ‰©å±•</span>
            }
            <span class="hljs-selector-class">.padding</span>(.bottom, <span class="hljs-number">16</span>)
        }
    }
}

<span class="hljs-comment">// é¡µé¢ä½¿ç”¨ï¼šä¼ å…¥è‡ªå®šä¹‰å†…å®¹ï¼Œä¸ç”¨ç»§æ‰¿</span>
struct EditView: View {
    <span class="hljs-selector-tag">var</span> <span class="hljs-selector-tag">body</span>: some View {
        <span class="hljs-built_in">ContainerView</span>(
            title: "ç¼–è¾‘é¡µé¢",
            bottomButtonTitle: "ä¿å­˜",
            onBottomButtonClick: {
                print("ä¿å­˜æˆåŠŸ")
            }
        ) {
            <span class="hljs-comment">// è‡ªå®šä¹‰å†…å®¹ï¼Œæƒ³æ”¾ä»€ä¹ˆå°±æ”¾ä»€ä¹ˆ</span>
            <span class="hljs-built_in">VStack</span>(spacing: <span class="hljs-number">20</span>) {
                <span class="hljs-built_in">TextField</span>("è¯·è¾“å…¥å†…å®¹", text: .constant(""))
                    <span class="hljs-selector-class">.padding</span>()
                    <span class="hljs-selector-class">.border</span>(Color.gray)
                Text("ç¼–è¾‘é¡µé¢çš„è‡ªå®šä¹‰å†…å®¹")
            }
            <span class="hljs-selector-class">.padding</span>()
        }
    }
}
</code></pre>
<p>åæ§½ç‚¹ï¼šè¿™ä¸ªæ–¹æ¡ˆç¨å¾®æœ‰ç‚¹è¿›é˜¶ï¼Œåˆšå¼€å§‹å†™çš„æ—¶å€™å®¹æ˜“ææ·· <code>@ViewBuilder</code> çš„ç”¨æ³•ï¼Œæ¯”å¦‚å¿˜è®°åŠ  <code>() -&gt; Content</code>ï¼ŒXcode æŠ¥é”™èƒ½è®©ä½ æ€€ç–‘äººç”Ÿâ€”â€”ä½†ä¸€æ—¦å­¦ä¼šï¼Œå°è£…å¤æ‚å®¹å™¨ View ç®€ç›´çˆ½åˆ°é£èµ·ï¼Œæ¯” UIKit é‡Œç»§æ‰¿ BaseVC å†é‡å†™ <code>contentView</code> ç®€å•å¤šäº†ã€‚</p>
<h2 data-id="heading-6">æœ€åæ€»ç»“ï¼šåˆ«å†æ‰§å¿µäºç»§æ‰¿äº†ï¼ŒSwiftUI çš„â€œå¥—è·¯â€æ›´é¦™ï¼</h2>
<p>å…¶å® SwiftUI ä¸æ˜¯â€œåç»§æ‰¿â€ï¼Œè€Œæ˜¯å®ƒçš„è®¾è®¡æ€è·¯å’Œ UIKit å®Œå…¨ä¸åŒï¼šUIKit æ˜¯â€œé¢å‘ç±»çš„ç»§æ‰¿â€ï¼Œä¸»æ‰“ä¸€ä¸ªâ€œä¸€è„‰ç›¸æ‰¿â€ï¼›SwiftUI æ˜¯â€œé¢å‘åè®®çš„ç»„åˆâ€ï¼Œä¸»æ‰“ä¸€ä¸ªâ€œçµæ´»æ‹¼æ¥â€ã€‚</p>
<p>ç”¨ä¸€å¥è¯åæ§½æ€»ç»“ï¼š</p>
<blockquote>
<p>UIKit é‡Œçš„ç»§æ‰¿ï¼Œå°±åƒâ€œç»§æ‰¿å®¶äº§â€ï¼Œå¥½å¤„æ˜¯çœå¿ƒï¼Œä½†å®¹æ˜“è¢«â€œå®¶äº§â€ç»‘å®šï¼Œæƒ³æ”¹ç‚¹ä¸œè¥¿è¿˜è¦é¡¾åŠç¥–å®—è§„çŸ©ï¼›SwiftUI é‡Œçš„æ‰©å±•ï¼Œå°±åƒâ€œæ­ä¹é«˜â€ï¼Œè™½ç„¶æ¯ä¸ªé›¶ä»¶éƒ½è¦è‡ªå·±æ‹¼ï¼Œä½†æƒ³æ€ä¹ˆæ­å°±æ€ä¹ˆæ­ï¼Œæ‹†äº†é‡æ‹¼ä¹Ÿä¸å¿ƒç–¼ï¼Œçµæ´»åˆ°é£èµ·ï¼</p>
</blockquote>
<p>æœ€åç»™å¤§å®¶ä¸€ä¸ªå°å»ºè®®ï¼šåˆšä» UIKit è½¬åˆ° SwiftUI æ—¶ï¼Œåˆ«æ€»æƒ³ç€â€œæ€ä¹ˆç»§æ‰¿â€ï¼Œè€Œæ˜¯å¤šæƒ³æƒ³â€œæ€ä¹ˆç»„åˆã€æ€ä¹ˆå°è£…â€â€”â€”ç”¨åè®®æ‰©å±•åšå…¨å±€ç»Ÿä¸€ï¼Œç”¨ç»„åˆå°è£…åšé‡å¤ç»„ä»¶ï¼Œç”¨ Modifier åšä¸ªæ€§åŒ–æ‰©å±•ï¼Œç”¨ @ViewBuilder åšçµæ´»å®¹å™¨ï¼Œæ…¢æ…¢ä½ å°±ä¼šå‘ç°ï¼ŒSwiftUI çš„æ‰©å±•æ–¹å¼ï¼Œæ¯” UIKit çš„ç»§æ‰¿é¦™å¤šäº†ï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ã€è½¬è½½ã€‘Claude Code Swarms - Agent Teams]]></title>    <link>https://juejin.cn/post/7604715051463344143</link>    <guid>https://juejin.cn/post/7604715051463344143</guid>    <pubDate>2026-02-10T05:32:25.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604715051463344143" data-draft-id="7604715051463327759" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ã€è½¬è½½ã€‘Claude Code Swarms - Agent Teams"/> <meta itemprop="keywords" content="Claude"/> <meta itemprop="datePublished" content="2026-02-10T05:32:25.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ˜¯é­”ä¸¸å•Š"/> <meta itemprop="url" content="https://juejin.cn/user/3217622495411292"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ã€è½¬è½½ã€‘Claude Code Swarms - Agent Teams
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3217622495411292/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ˜¯é­”ä¸¸å•Š
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T05:32:25.000Z" title="Tue Feb 10 2026 05:32:25 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»14åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><a href="https://link.juejin.cn?target=https%3A%2F%2Faddyosmani.com%2Fblog%2Fclaude-code-agent-teams%2F" target="_blank" title="https://addyosmani.com/blog/claude-code-agent-teams/" ref="nofollow noopener noreferrer">è½¬è½½</a></p>
<p><strong>Claude Code ç°å·²æ”¯æŒ agent teamsï¼ˆç¾¤ç»„ï¼‰ã€‚</strong> ä¸å†æ˜¯å•ä¸ª agent é¡ºåºåœ°å¤„ç†ä»»åŠ¡ï¼Œä¸€ä¸ª lead agent å¯ä»¥å§”æ‰˜ç»™å¤šä¸ª teammates å¹¶è¡Œå·¥ä½œâ€”â€”è¿›è¡Œç ”ç©¶ã€è°ƒè¯•å’Œæ„å»ºï¼ŒåŒæ—¶ç›¸äº’åè°ƒã€‚åœ¨æ‚¨çš„ <code>settings.json</code> ä¸­å¯ç”¨ agent teams æ¥è¯•è¯•çœ‹ã€‚å¦‚æœæ‚¨ä¸€ç›´åœ¨é€šè¿‡ Conductorã€Gas Town æˆ–ç±»ä¼¼å·¥å…·è¿›è¡Œ multi-agent orchestration çš„å®éªŒï¼Œè¿™ä¸ªæ¶ˆæ¯ä¼šè®©æ‚¨å…´å¥‹ä¸å·²ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/12acae9d28524b60a8887e0fd2f58354~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5piv6a2U5Li45ZWK:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771306350&amp;x-signature=87284Q4SIItZp9xkL7QYXpbPDmE%3D" alt="" loading="lazy"/></p>
<p>ç¤¾åŒºå°†è¿™äº›æ¨¡å¼ç§°ä¸º <strong>swarmsï¼ˆç¾¤ç»„ï¼‰</strong>â€”â€”åè°ƒçš„ AI agent å›¢é˜Ÿï¼Œæ¯ä¸ªéƒ½æœ‰ä¸“é—¨çš„è§’è‰²ï¼Œé€šè¿‡ç»“æ„åŒ–é€šä¿¡å¹¶è¡Œå·¥ä½œã€‚ä»å¼€å‘è€…åœ¨ Claude Code äºŒè¿›åˆ¶æ–‡ä»¶ä¸­å‘ç° feature-flagged åŠŸèƒ½å¼€å§‹ï¼Œé€šè¿‡ subagents å’Œ bash è„šæœ¬æ„å»ºå˜é€šæ–¹æ¡ˆï¼Œç°åœ¨è¿™å·²ç»æ˜¯ä¸€ä¸ªä¸€ç­‰ç‰¹æ€§ã€‚TeammateToolã€åŸºäº inbox çš„é€šä¿¡ã€tmux åˆ†å‰²çª—æ ¼â€”â€”æ‰€æœ‰ä¸œè¥¿éƒ½åœ¨è¿™é‡Œäº†ã€‚</p>
<p>è¿™å¾ˆé‡è¦ï¼Œå› ä¸ºå®ƒä¸æˆ‘ä»¬å¤§å¤šæ•°äººä¸€ç›´åœ¨ä½¿ç”¨çš„ single-agent æ¨¡å‹æœ‰ç€æ ¹æœ¬ä¸åŒçš„æ¶æ„ã€‚å¦‚æœæ‚¨ä¸€ç›´åœ¨å…³æ³¨ä» conductor åˆ° orchestrator çš„è½¬å˜ï¼Œæˆ–è€…è¯•éªŒå¹¶è¡Œ agent workflowsï¼Œagent teams å°±æ˜¯è¿™äº›æƒ³æ³•å˜å¾—å…·ä½“çš„åœ°æ–¹ã€‚</p>
<h2 data-id="heading-0">ä¸ºä»€ä¹ˆ multi-agent coordination å¾ˆé‡è¦</h2>
<p>Single-agent æ¨¡å‹æœ‰ä¸€ä¸ªä¼—æ‰€å‘¨çŸ¥çš„å¤±è´¥æ¨¡å¼ã€‚æ‚¨è®© Claude åšä¸€äº›å¤æ‚çš„äº‹æƒ…â€”â€”æ¯”å¦‚é‡æ„ä¸‰ä¸ªæœåŠ¡çš„è®¤è¯â€”â€”å®ƒå¯èƒ½åœ¨ä¸Šä¸‹æ–‡é€€åŒ–ä¹‹å‰å®Œæˆ 60%ã€‚ç¬¬ 2 æ­¥çš„ç»†èŠ‚æ¨¡ç³Šåˆ°ç¬¬ 5 æ­¥ä¸­ã€‚æ‚¨ <code>/clear</code> å¹¶é‡æ–°å¼€å§‹ã€‚é‡å¤ç›´åˆ°æ²®ä¸§ã€‚</p>
<p>Swarms èƒŒåçš„æ ¸å¿ƒè§è§£å¾ˆç®€å•ï¼š<strong>éšç€ä¸Šä¸‹æ–‡çš„æ‰©å±•ï¼ŒLLM çš„æ€§èƒ½ä¼šä¸‹é™ã€‚</strong> è¿™ä¸ä»…ä»…æ˜¯å…³äºè¾¾åˆ° token é™åˆ¶ï¼Œè€Œæ˜¯ä¸Šä¸‹æ–‡çª—å£ä¸­çš„ä¿¡æ¯è¶Šå¤šï¼Œæ¨¡å‹å°±è¶Šéš¾ä¸“æ³¨äºç°åœ¨é‡è¦çš„äº‹æƒ…ã€‚å°†é¡¹ç›®ç»ç†çš„æˆ˜ç•¥ç¬”è®°æ·»åŠ åˆ°æ­£åœ¨ä¿®å¤ CSS bug çš„ä¸Šä¸‹æ–‡ä¸­ä¼šæŸå®³æ€§èƒ½ã€‚</p>
<p>äººç±»å›¢é˜Ÿä»¥ç±»ä¼¼çš„æ–¹å¼å·¥ä½œã€‚æˆ‘ä»¬ä¸è®©åç«¯å·¥ç¨‹å¸ˆå‚åŠ å‰ç«¯ä»£ç å®¡æŸ¥ã€‚æˆ‘ä»¬ä¸ä¼šåœ¨æ¯æ¡ Slack çº¿ç¨‹ä¸­æŠ„é€æ•´ä¸ªå…¬å¸ã€‚ä¸“ä¸šåŒ–æ˜¯ä¸ºäº†ä¸“æ³¨ã€‚</p>
<p>Multi-agent patterns å°†æ­¤å½¢å¼åŒ–ã€‚é€šè¿‡ç»™æ¯ä¸ª agent ä¸€ä¸ªç‹­çª„çš„èŒƒå›´å’Œæ¸…æ™°çš„ä¸Šä¸‹æ–‡ï¼Œæ‚¨å¯ä»¥åœ¨æ¯ä¸ªé¢†åŸŸå†…è·å¾—æ›´å¥½çš„æ¨ç†ã€ç‹¬ç«‹çš„è´¨é‡æ£€æŸ¥ã€é˜¶æ®µä¹‹é—´çš„è‡ªç„¶æ£€æŸ¥ç‚¹ï¼Œä»¥åŠå½“ä¸€ä¸ª agent å¤±è´¥æ—¶çš„ä¼˜é›…é™çº§ã€‚æµ‹è¯• agent çš„ä¸Šä¸‹æ–‡ä¸­æœ‰æµ‹è¯•ï¼Œè€Œä¸æ˜¯ä¸‰å°æ—¶çš„è§„åˆ’è®¨è®ºã€‚å®‰å…¨å®¡æŸ¥è€…ä¸éœ€è¦é€šè¿‡æ€§èƒ½ä¼˜åŒ–ç¬”è®°ã€‚</p>
<p>è­¦å‘Šæ˜¯è¿™ä»…åœ¨ä»»åŠ¡æ­£ç¡®èŒƒå›´åŒ–æ—¶æ‰æœ‰æ•ˆã€‚"ç»™æˆ‘æ„å»ºä¸€ä¸ªåº”ç”¨ç¨‹åº"ä¼šæ¶ˆè€— tokens è€Œ agents å¾’åŠ³æ— åŠŸã€‚"æ ¹æ®æ­¤è§„èŒƒå®ç°è¿™äº”ä¸ªæ˜ç¡®å®šä¹‰çš„ API ç«¯ç‚¹"ä¼šäº§ç”Ÿå¥½çš„ç»“æœã€‚</p>
<h2 data-id="heading-1">Agent teams æ˜¯ä»€ä¹ˆ</h2>
<p>æ¶æ„å¾ˆç®€å•ã€‚ä¸€ä¸ª Claude Code ä¼šè¯æˆä¸º <strong>team lead</strong>ã€‚å®ƒç”Ÿæˆ <strong>teammates</strong>â€”â€”æ¯ä¸ªéƒ½æ˜¯ä¸€ä¸ªå®Œæ•´çš„ã€ç‹¬ç«‹çš„ Claude Code å®ä¾‹ï¼Œæœ‰è‡ªå·±çš„å¤§å‹ token ä¸Šä¸‹æ–‡çª—å£ã€‚æœ‰ä¸€ä¸ªå…±äº«çš„ä»»åŠ¡åˆ—è¡¨ï¼Œå…·æœ‰ä¾èµ–å…³ç³»è·Ÿè¸ªï¼Œä¸€ä¸ªåŸºäº inbox çš„æ¶ˆæ¯ä¼ é€’ç³»ç»Ÿç”¨äº agent é—´é€šä¿¡ï¼Œteammates å¯ä»¥åœ¨å®Œæˆä»»åŠ¡æ—¶è‡ªå·±è®¤é¢†å·¥ä½œã€‚</p>

























<table><thead><tr><th>ç»„ä»¶</th><th>è§’è‰²</th></tr></thead><tbody><tr><td><strong>Team lead</strong></td><td>åˆ›å»ºå›¢é˜Ÿã€ç”Ÿæˆ teammatesã€åè°ƒå·¥ä½œ</td></tr><tr><td><strong>Teammates</strong></td><td>åœ¨åˆ†é…çš„ä»»åŠ¡ä¸Šå·¥ä½œçš„ç‹¬ç«‹ Claude Code å®ä¾‹</td></tr><tr><td><strong>Task list</strong></td><td>å…·æœ‰ä¾èµ–å…³ç³»è·Ÿè¸ªå’Œè‡ªåŠ¨è§£é™¤é˜»æ­¢çš„å…±äº«å·¥ä½œé¡¹</td></tr><tr><td><strong>Mailbox</strong></td><td>agent ä¹‹é—´çš„ç›´æ¥æ¶ˆæ¯ä¼ é€’â€”â€”ä¸ä»…ä»…æ˜¯å‘ lead æŠ¥å‘Š</td></tr></tbody></table>
<p>è¿™ä¸ Claude Code ç°æœ‰çš„ subagents ä¸åŒã€‚Subagents æ˜¯å‘å•ä¸ªçˆ¶çº§æŠ¥å‘Šç»“æœçš„ä¸“æ³¨å·¥ä½œè€…â€”â€”å®ƒä»¬ä¸èƒ½ç›¸äº’äº¤è°ˆã€‚Agent teams æ˜¯çœŸæ­£çš„åä½œâ€”â€”teammates åˆ†äº«å‘ç°ã€æŒ‘æˆ˜å½¼æ­¤çš„æ–¹æ³•å¹¶ç‹¬ç«‹åè°ƒã€‚æƒè¡¡æ˜¯ token æˆæœ¬â€”â€”æ¯ä¸ª teammate éƒ½æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ Claude å®ä¾‹ã€‚</p>



































<table><thead><tr><th/><th>Subagents</th><th>Agent teams</th></tr></thead><tbody><tr><td><strong>ä¸Šä¸‹æ–‡</strong></td><td>è‡ªå·±çš„çª—å£ï¼›ç»“æœè¿”å›ç»™è°ƒç”¨è€…</td><td>è‡ªå·±çš„çª—å£ï¼›å®Œå…¨ç‹¬ç«‹</td></tr><tr><td><strong>é€šä¿¡</strong></td><td>ä»…å‘ä¸» agent æŠ¥å‘Š</td><td>Teammates ç›´æ¥ç›¸äº’æ¶ˆæ¯ä¼ é€’</td></tr><tr><td><strong>åè°ƒ</strong></td><td>ä¸» agent ç®¡ç†ä¸€åˆ‡</td><td>å…·æœ‰è‡ªæˆ‘åè°ƒçš„å…±äº«ä»»åŠ¡åˆ—è¡¨</td></tr><tr><td><strong>æœ€é€‚åˆ</strong></td><td>åªå…³æ³¨ç»“æœçš„ä¸“æ³¨ä»»åŠ¡</td><td>éœ€è¦è®¨è®ºå’Œåä½œçš„å¤æ‚å·¥ä½œ</td></tr><tr><td><strong>Token æˆæœ¬</strong></td><td>è¾ƒä½</td><td>è¾ƒé«˜â€”â€”æ¯ä¸ª teammate éƒ½æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„å®ä¾‹</td></tr></tbody></table>
<p>å½“æ‚¨éœ€è¦å¿«é€Ÿã€ä¸“æ³¨çš„å·¥ä½œè€…æ—¶ä½¿ç”¨ subagentsã€‚å½“ teammates éœ€è¦åˆ†äº«å‘ç°ã€ç›¸äº’æŒ‘æˆ˜å¹¶ç‹¬ç«‹åè°ƒæ—¶ä½¿ç”¨ agent teamsã€‚</p>
<blockquote>
<p>Claude Code ç°å·²æ”¯æŒ agent teamsï¼ˆç ”ç©¶é¢„è§ˆç‰ˆï¼‰</p>
<p>ä¸æ˜¯å•ä¸ª agent é¡ºåºåœ°å¤„ç†ä»»åŠ¡ï¼Œlead agent å¯ä»¥å§”æ‰˜ç»™å¤šä¸ª teammates å¹¶è¡Œå·¥ä½œï¼Œè¿›è¡Œç ”ç©¶ã€è°ƒè¯•å’Œæ„å»ºï¼ŒåŒæ—¶ç›¸äº’åè°ƒã€‚</p>
<p>ä»Šå¤©å°±è¯•è¯•çœ‹... pic.twitter.com/vi7lUJDOTi</p>
<p>â€” Lydia Hallie âœ¨ (@lydiahallie) 2026å¹´2æœˆ5æ—¥</p>
</blockquote>
<h2 data-id="heading-2">å…¥é—¨</h2>
<p>é€šè¿‡åœ¨è®¾ç½®ä¸­æ·»åŠ å®éªŒæ ‡å¿—æ¥å¯ç”¨ agent teamsï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-comment">// settings.json</span>
<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"env"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"CLAUDE_CODE_EXPERIMENTAL_AGENT_TEAMS"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>ç„¶åç”¨è‡ªç„¶è¯­è¨€å‘Šè¯‰ Claude æ‚¨æƒ³è¦ä»€ä¹ˆå›¢é˜Ÿã€‚å®ƒä»é‚£é‡Œå¤„ç†ç”Ÿæˆå’Œåè°ƒï¼š</p>
<pre><code class="hljs language-objectivec" lang="objectivec">æˆ‘æ­£åœ¨è®¾è®¡ä¸€ä¸ª <span class="hljs-built_in">CLI</span> å·¥å…·ï¼Œå¸®åŠ©å¼€å‘è€…åœ¨å…¶ä»£ç åº“ä¸­è·Ÿè¸ª TODO æ³¨é‡Šã€‚
åˆ›å»ºä¸€ä¸ª agent team ä»ä¸åŒè§’åº¦æ¢ç´¢è¿™ä¸ªé—®é¢˜ï¼šä¸€ä¸ª teammate è´Ÿè´£ UXï¼Œ
ä¸€ä¸ªè´Ÿè´£æŠ€æœ¯æ¶æ„ï¼Œä¸€ä¸ªæ‰®æ¼”å”±åè°ƒçš„è§’è‰²ã€‚
</code></pre>
<p>Claude åˆ›å»ºå…·æœ‰å…±äº«ä»»åŠ¡åˆ—è¡¨çš„å›¢é˜Ÿï¼Œä¸ºæ¯ä¸ªè§’åº¦ç”Ÿæˆ teammatesï¼Œè®©å®ƒä»¬æ¢ç´¢é—®é¢˜ï¼Œå¹¶ç»¼åˆå‘ç°ã€‚Lead çš„ç»ˆç«¯åˆ—å‡ºäº†æ‰€æœ‰ teammates åŠå®ƒä»¬æ­£åœ¨å¤„ç†çš„å·¥ä½œã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d4b0cec381e44b90ad4f1270af49e53c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5piv6a2U5Li45ZWK:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771306350&amp;x-signature=J6pcQgwSy%2FK%2BYT1h8IAJKMYZ%2Fr4%3D" alt="" loading="lazy"/></p>
<p>æ‚¨ä¹Ÿå¯ä»¥æ˜ç¡®å›¢é˜Ÿç»“æ„ï¼š</p>
<pre><code class="hljs">åˆ›å»ºä¸€ä¸ªæœ‰ 4 ä¸ª teammates çš„å›¢é˜Ÿæ¥å¹¶è¡Œé‡æ„è¿™äº›æ¨¡å—ã€‚
æ¯ä¸ª teammate ä½¿ç”¨ Opusã€‚
</code></pre>
<h2 data-id="heading-3">åœ¨å“ªäº›æ–¹é¢è¡¨ç°å‡ºè‰²</h2>
<p>è¿™æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„æ¨¡å¼ï¼š<strong>å¹¶è¡Œæ¢ç´¢çœŸæ­£æœ‰ä»·å€¼ä¸” teammates å¯ä»¥å¾ˆå¤§ç¨‹åº¦ä¸Šç‹¬ç«‹æ“ä½œçš„ä»»åŠ¡ã€‚</strong></p>
<p><strong>ç”¨äºè°ƒè¯•çš„ç«äº‰å‡è®¾ã€‚</strong> ç”Ÿæˆäº”ä¸ª teammatesï¼Œæ¯ä¸ªè°ƒæŸ¥ä¸€ä¸ªå…³äºä¸ºä»€ä¹ˆåº”ç”¨ç¨‹åºåœ¨ä¸€æ¡æ¶ˆæ¯åé€€å‡ºçš„ä¸åŒç†è®ºã€‚è®©å®ƒä»¬ç›¸äº’äº¤è°ˆæ¥åé©³å½¼æ­¤çš„ç†è®ºï¼Œå°±åƒç§‘å­¦è¾©è®ºä¸€æ ·ã€‚è¿™ç¡®å®æ¯”é¡ºåºè°ƒæŸ¥æ›´å¥½ï¼Œé¡ºåºè°ƒæŸ¥ä¼šå—åˆ°é”šå®šçš„å½±å“â€”â€”ä¸€æ—¦æ‚¨æ¢ç´¢äº†ä¸€ä¸ªç†è®ºï¼Œéšåçš„è°ƒæŸ¥å°±ä¼šåå‘å®ƒã€‚å¤šä¸ªè°ƒæŸ¥è€…è¿›è¡Œå¯¹æŠ—æ€§è¾©è®ºæ›´å¿«åœ°æ”¶æ•›åˆ°æ ¹æœ¬åŸå› ã€‚</p>
<p><strong>ä½¿ç”¨ä¸åŒé•œå¤´çš„å¹¶è¡Œä»£ç å®¡æŸ¥ã€‚</strong> ä¸€ä¸ª teammate è´Ÿè´£å®‰å…¨å½±å“ï¼Œä¸€ä¸ªæ£€æŸ¥æ€§èƒ½å½±å“ï¼Œä¸€ä¸ªéªŒè¯æµ‹è¯•è¦†ç›–ç‡ã€‚å•ä¸ªå®¡æŸ¥è€…å€¾å‘äºä¸€æ¬¡ä¸“æ³¨äºä¸€ç§ç±»å‹çš„é—®é¢˜ã€‚å°†å®¡æŸ¥æ ‡å‡†æ‹†åˆ†ä¸ºç‹¬ç«‹é¢†åŸŸæ„å‘³ç€æ¯ä¸ªé¢†åŸŸåŒæ—¶å¾—åˆ°å½»åº•å…³æ³¨ã€‚</p>
<p><strong>è·¨å±‚åŠŸèƒ½å·¥ä½œã€‚</strong> è·¨è¶Š frontendã€backend å’Œ tests çš„å˜æ›´â€”â€”æ¯ä¸ªç”±ä¸åŒçš„ teammate æ‹¥æœ‰ã€‚è€Œä¸æ˜¯ä¸€ä¸ª agent åœ¨å±‚ä¹‹é—´ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œä¸‰ä¸ª agents å¹¶è¡Œå·¥ä½œï¼Œå®Œå…¨ä¸“æ³¨äºå…¶é¢†åŸŸã€‚</p>
<p><strong>ç ”ç©¶å’Œæ¢ç´¢ã€‚</strong> å¤šä¸ª teammates åŒæ—¶è°ƒæŸ¥ä¸åŒçš„æ–¹æ³•ï¼Œåˆ†äº«å®ƒä»¬å‘ç°çš„å†…å®¹ï¼Œå¹¶æ”¶æ•›åˆ°æœ€ä½³å‰è¿›è·¯å¾„ã€‚ç ”ç©¶å‘ç°ç›´æ¥æµå…¥å®ç°ä¸Šä¸‹æ–‡â€”â€”æ²¡æœ‰ç”µè¯æ¸¸æˆã€‚</p>
<h2 data-id="heading-4">æ§åˆ¶å›¢é˜Ÿ</h2>
<p>æ‚¨é€šè¿‡ lead çš„ç»ˆç«¯ä¸ agent teams äº¤äº’ã€‚ä¸€äº›åœ¨å®è·µä¸­é‡è¦çš„æ§ä»¶ï¼š</p>
<h3 data-id="heading-5">æ˜¾ç¤ºæ¨¡å¼</h3>
<p>ä¸¤ä¸ªé€‰é¡¹ã€‚<strong>In-process</strong>ï¼ˆé»˜è®¤ï¼‰ï¼šæ‰€æœ‰ teammates åœ¨æ‚¨çš„ä¸»ç»ˆç«¯å†…è¿è¡Œã€‚ä½¿ç”¨ <code>Shift+Up/Down</code> é€‰æ‹©ä¸€ä¸ª teammate å¹¶è¾“å…¥ä»¥ç›´æ¥å‘å®ƒä»¬å‘é€æ¶ˆæ¯ã€‚æŒ‰ <code>Enter</code> æŸ¥çœ‹ teammate çš„ä¼šè¯ï¼Œ<code>Escape</code> ä¸­æ–­å®ƒä»¬çš„å›åˆï¼Œ<code>Ctrl+T</code> åˆ‡æ¢ä»»åŠ¡åˆ—è¡¨ã€‚é€‚ç”¨äºä»»ä½•ç»ˆç«¯ã€‚</p>
<p><strong>Split panes</strong>ï¼šæ¯ä¸ª teammate é€šè¿‡ tmux æˆ– iTerm2 è·å¾—è‡ªå·±çš„çª—æ ¼ã€‚æ‚¨åŒæ—¶çœ‹åˆ°æ¯ä¸ªäººçš„è¾“å‡ºï¼Œå¹¶ç‚¹å‡»çª—æ ¼ç›´æ¥äº¤äº’ã€‚åœ¨è®¾ç½®ä¸­æˆ–æŒ‰ä¼šè¯è®¾ç½®ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"teammateMode"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"tmux"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>æˆ–ä¸ºå•ä¸ªä¼šè¯è¦†ç›–ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">claude --teammate-mode in-process
</code></pre>
<h3 data-id="heading-6">è®¡åˆ’æ‰¹å‡†</h3>
<p>å¯¹äºæœ‰é£é™©çš„å·¥ä½œï¼Œè¦æ±‚ teammates åœ¨å®æ–½ä¹‹å‰å…ˆè®¡åˆ’ã€‚Teammate åœ¨åªè¯»æ¨¡å¼ä¸‹å·¥ä½œï¼Œç›´åˆ° lead æ‰¹å‡†å®ƒä»¬çš„æ–¹æ³•ï¼š</p>
<pre><code class="hljs">ç”Ÿæˆä¸€ä¸ªæ¶æ„å¸ˆ teammate æ¥é‡æ„è®¤è¯æ¨¡å—ã€‚
è¦æ±‚å®ƒä»¬åœ¨è¿›è¡Œä»»ä½•æ›´æ”¹ä¹‹å‰è·å¾—è®¡åˆ’æ‰¹å‡†ã€‚
</code></pre>
<p>å¦‚æœè¢«æ‹’ç»ï¼Œå®ƒä»¬ä¼šä¿®æ”¹å¹¶é‡æ–°æäº¤ã€‚æ‚¨å¯ä»¥ä½¿ç”¨æ ‡å‡†å½±å“ lead çš„åˆ¤æ–­ï¼š"ä»…æ‰¹å‡†åŒ…å«æµ‹è¯•è¦†ç›–çš„è®¡åˆ’"æˆ–"æ‹’ç»ä¿®æ”¹æ•°æ®åº“æ¶æ„çš„è®¡åˆ’"ã€‚</p>
<h3 data-id="heading-7">å§”æ‰˜æ¨¡å¼</h3>
<p>æŒ‰ <code>Shift+Tab</code> å°† lead é™åˆ¶ä¸ºä»…åè°ƒâ€”â€”ç”Ÿæˆã€æ¶ˆæ¯ä¼ é€’ã€å…³é—­ teammates å’Œç®¡ç†ä»»åŠ¡ã€‚ä¸æ¥è§¦ä»£ç ã€‚è¿™åœæ­¢äº†ä¸€ä¸ªå¸¸è§é—®é¢˜ï¼šlead åˆ†å¿ƒå¹¶è‡ªå·±å®ç°äº‹æƒ…ï¼Œè€Œä¸æ˜¯ç­‰å¾… teammatesã€‚</p>
<h3 data-id="heading-8">ç›´æ¥ teammate äº¤äº’</h3>
<p>æ¯ä¸ª teammate éƒ½æ˜¯ä¸€ä¸ªå®Œæ•´çš„ Claude Code ä¼šè¯ã€‚æ‚¨å¯ä»¥å‘å…¶ä¸­ä»»ä½•ä¸€ä¸ªç›´æ¥å‘é€æ¶ˆæ¯ä»¥æä¾›é¢å¤–æŒ‡ä»¤ã€æå‡ºåç»­é—®é¢˜æˆ–é‡å®šå‘å…¶æ–¹æ³•â€”â€”æ— éœ€é€šè¿‡ leadã€‚</p>
<h3 data-id="heading-9">ä»»åŠ¡ç®¡ç†</h3>
<p>å…±äº«ä»»åŠ¡åˆ—è¡¨åè°ƒæ•´ä¸ªå›¢é˜Ÿçš„å·¥ä½œã€‚ä»»åŠ¡æœ‰ä¸‰ç§çŠ¶æ€ï¼špendingã€in progress å’Œ completedã€‚ä»»åŠ¡å¯ä»¥ä¾èµ–äºå…¶ä»–ä»»åŠ¡â€”â€”å…·æœ‰æœªè§£å†³ä¾èµ–å…³ç³»çš„ pending ä»»åŠ¡åœ¨é‚£äº›ä¾èµ–å®Œæˆä¹‹å‰ä¸èƒ½è¢«è®¤é¢†ã€‚å½“é˜»æ­¢ä»»åŠ¡å®Œæˆæ—¶ï¼Œè‡ªåŠ¨è§£é™¤é˜»æ­¢å‘ç”Ÿã€‚</p>
<p>Lead å¯ä»¥æ˜¾å¼åˆ†é…ä»»åŠ¡ï¼Œæˆ–è€… teammates å¯ä»¥åœ¨å®Œæˆæ—¶è‡ªå·±è®¤é¢†ä¸‹ä¸€ä¸ªæœªåˆ†é…ã€æœªé˜»æ­¢çš„ä»»åŠ¡ã€‚ä»»åŠ¡è®¤é¢†ä½¿ç”¨æ–‡ä»¶é”å®šæ¥é˜²æ­¢ç«äº‰æ¡ä»¶ã€‚</p>
<p>Teams å’Œ tasks æœ¬åœ°å­˜å‚¨ï¼š</p>
<pre><code class="hljs language-ruby" lang="ruby">~<span class="hljs-regexp">/.claude/teams</span><span class="hljs-regexp">/{team-name}/config</span>.json    <span class="hljs-comment"># Team metadata + members</span>
~<span class="hljs-regexp">/.claude/tasks</span><span class="hljs-regexp">/{team-name}/</span>               <span class="hljs-comment"># Task list</span>
</code></pre>
<p>Teammates å¯ä»¥è¯»å–é…ç½®æ–‡ä»¶æ¥å‘ç°å…¶ä»–å›¢é˜Ÿæˆå‘˜ã€‚</p>
<h3 data-id="heading-10">å…³é—­</h3>
<p>è¦æ±‚ lead å…³é—­ç‰¹å®šçš„ teammatesâ€”â€”å®ƒä»¬å¯ä»¥æ‰¹å‡†æˆ–æ‹’ç»è¯·æ±‚å¹¶æä¾›è§£é‡Šã€‚è¦æ¸…ç†æ•´ä¸ªå›¢é˜Ÿï¼š</p>
<pre><code class="hljs language-bash" lang="bash">/cleanup
</code></pre>
<p>å§‹ç»ˆä½¿ç”¨ lead è¿›è¡Œæ¸…ç†ã€‚Teammates ä¸åº”è¯¥è¿è¡Œå®ƒï¼Œå› ä¸ºå®ƒä»¬çš„å›¢é˜Ÿä¸Šä¸‹æ–‡å¯èƒ½æ— æ³•æ­£ç¡®è§£æï¼Œå¯èƒ½ä¼šä½¿èµ„æºå¤„äºä¸ä¸€è‡´çŠ¶æ€ã€‚Lead æ£€æŸ¥æ´»è·ƒçš„ teammatesï¼Œå¦‚æœä»åœ¨è¿è¡Œåˆ™å¤±è´¥ï¼Œå› æ­¤å…ˆå…³é—­å®ƒä»¬ã€‚</p>
<h2 data-id="heading-11">è¿™é‡Œæœ‰ç®¡ç†å­¦çš„ç±»æ¯”</h2>
<p>æˆ‘ä¸æ–­å›åˆ°è¿™ä¸€ç‚¹ï¼šä½¿æŸäººæˆä¸ºå¼ºå¤§çš„å·¥ç¨‹ç»ç†çš„æŠ€èƒ½ç›´æ¥è½¬åŒ–ä¸ºæœ‰æ•ˆçš„ agent orchestrationã€‚Agent teams ä½¿è¿™æ›´åŠ æ˜ç¡®ã€‚</p>
<p><strong>ä»»åŠ¡å¤§å°å¾ˆé‡è¦ã€‚</strong> å¤ªå°è€Œåè°ƒå¼€é”€å ä¸»å¯¼åœ°ä½ã€‚å¤ªå¤§è€Œ teammates å·¥ä½œæ—¶é—´å¤ªé•¿è€Œæ²¡æœ‰æ£€æŸ¥ï¼Œå†’ç€æµªè´¹ç²¾åŠ›çš„é£é™©ã€‚æœ€ä½³ç‚¹æ˜¯äº§ç”Ÿæ¸…æ™°äº¤ä»˜æˆæœçš„è‡ªåŒ…å«å•å…ƒã€‚æ¯ä¸ª teammate æœ‰ 5-6 ä¸ªä»»åŠ¡ä¿æŒæ¯ä¸ªäººçš„ç”Ÿäº§åŠ›ï¼Œå¹¶è®© lead åœ¨æŸäººè¢«å¡ä½æ—¶é‡æ–°åˆ†é…å·¥ä½œã€‚</p>
<p><strong>æ–‡ä»¶æ‰€æœ‰æƒå¾ˆé‡è¦ã€‚</strong> ä¸¤ä¸ª teammates ç¼–è¾‘åŒä¸€ä¸ªæ–‡ä»¶ä¼šå¯¼è‡´è¦†ç›–ã€‚åˆ†è§£å·¥ä½œï¼Œä½¿æ¯ä¸ª teammate æ‹¥æœ‰ä¸åŒçš„æ–‡ä»¶é›†ã€‚ä¸äººç±»å›¢é˜Ÿç›¸åŒçš„è¾¹ç•Œè®¾ç½®ä»¥é¿å…åˆå¹¶å†²çªã€‚</p>
<p><strong>ä¸Šä¸‹æ–‡åŠ è½½å¾ˆé‡è¦ã€‚</strong> Teammates è‡ªåŠ¨è·å–æ‚¨é¡¹ç›®çš„ <code>CLAUDE.md</code>ã€MCP æœåŠ¡å™¨å’ŒæŠ€èƒ½ï¼Œä½†å®ƒä»¬ä¸ç»§æ‰¿ lead çš„å¯¹è¯å†å²ã€‚åœ¨ç”Ÿæˆæç¤ºä¸­åŒ…å«ç‰¹å®šäºä»»åŠ¡çš„è¯¦ç»†ä¿¡æ¯ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">ç”Ÿæˆä¸€ä¸ªå®‰å…¨å®¡æŸ¥è€… teammateï¼Œæç¤ºä¸ºï¼š<span class="hljs-string">"å®¡æŸ¥ src/auth/ å¤„çš„è®¤è¯æ¨¡å—
æ˜¯å¦å­˜åœ¨å®‰å…¨æ¼æ´ã€‚ä¸“æ³¨äºä»¤ç‰Œå¤„ç†ã€ä¼šè¯ç®¡ç†å’Œè¾“å…¥éªŒè¯ã€‚
åº”ç”¨ç¨‹åºä½¿ç”¨å­˜å‚¨åœ¨ httpOnly cookies ä¸­çš„ JWT ä»¤ç‰Œã€‚æŠ¥å‘Šä»»ä½•å¸¦æœ‰
ä¸¥é‡æ€§è¯„çº§çš„é—®é¢˜ã€‚"</span>
</code></pre>
<p>ç®€æŠ¥è¶Šå…·ä½“ï¼Œè¾“å‡ºè¶Šå¥½ã€‚å’Œå¾€å¸¸ä¸€æ ·â€”â€”ä½†ç°åœ¨æ‚¨æ˜¯ä¸ºä¸€ä¸ªå›¢é˜Ÿè€Œä¸æ˜¯å•ä¸ª agent ç¼–å†™ç®€æŠ¥ã€‚</p>
<h2 data-id="heading-12">éœ€è¦æ³¨æ„ä»€ä¹ˆ</h2>
<p>è¿™æ˜¯å®éªŒæ€§çš„ã€‚ç²—ç³™çš„è¾¹ç¼˜æ˜¯çœŸå®çš„ï¼Œå€¼å¾—äº†è§£ã€‚</p>
<p><strong>Lead æœ‰æ—¶ä¼šå®ç°è€Œä¸æ˜¯å§”æ‰˜ã€‚</strong> å‘Šè¯‰å®ƒç­‰å¾…ï¼š"åœ¨ç»§ç»­ä¹‹å‰ç­‰å¾…æ‚¨çš„ teammates å®Œæˆä»–ä»¬çš„ä»»åŠ¡ã€‚"æˆ–ä½¿ç”¨å§”æ‰˜æ¨¡å¼ï¼ˆ<code>Shift+Tab</code>ï¼‰å°† lead é™åˆ¶ä¸ºä»…åè°ƒå·¥å…·ã€‚</p>
<p><strong>In-process teammates æ²¡æœ‰ä¼šè¯æ¢å¤ã€‚</strong> <code>/resume</code> å’Œ <code>/rewind</code> ä¸ä¼šæ¢å¤ in-process teammatesã€‚æ¢å¤åï¼Œlead å¯èƒ½ä¼šå°è¯•å‘ä¸å†å­˜åœ¨çš„ teammates å‘é€æ¶ˆæ¯ã€‚ç”Ÿæˆæ–°çš„ã€‚</p>
<p><strong>ä»»åŠ¡çŠ¶æ€å¯èƒ½æ»åã€‚</strong> Teammates æœ‰æ—¶æœªèƒ½å°†ä»»åŠ¡æ ‡è®°ä¸ºå®Œæˆï¼Œé˜»æ­¢ä¾èµ–ä»»åŠ¡ã€‚æ£€æŸ¥å·¥ä½œæ˜¯å¦å®é™…å®Œæˆå¹¶æ¨åŠ¨ lead æˆ–æ‰‹åŠ¨æ›´æ–°ã€‚</p>
<p><strong>æ¯ä¸ªä¼šè¯ä¸€ä¸ªå›¢é˜Ÿï¼Œæ²¡æœ‰åµŒå¥—å›¢é˜Ÿã€‚</strong> Lead ä¸€æ¬¡ç®¡ç†ä¸€ä¸ªå›¢é˜Ÿã€‚Teammates ä¸èƒ½ç”Ÿæˆè‡ªå·±çš„å›¢é˜Ÿæˆ– teammatesã€‚åªæœ‰ lead ç®¡ç†å›¢é˜Ÿã€‚è¿™æ˜¯æ•…æ„çš„â€”â€”é˜²æ­¢æ— é™é€’å½’ã€å¤±æ§çš„ token æˆæœ¬å’Œå¤±å»äººç±»ç›‘ç£ã€‚åœ¨å¼€å§‹æ–°å›¢é˜Ÿä¹‹å‰æ¸…ç†å½“å‰å›¢é˜Ÿã€‚</p>
<p><strong>Token æˆæœ¬éš teammates æ‰©å±•ã€‚</strong> æ¯ä¸ª teammate éƒ½æ˜¯ä¸€ä¸ªå…·æœ‰è‡ªå·±ä¸Šä¸‹æ–‡çª—å£çš„ç‹¬ç«‹ Claude å®ä¾‹ã€‚å¯¹äºå¸¸è§„ä»»åŠ¡ï¼Œå•ä¸ªä¼šè¯æ›´å…·æˆæœ¬æ•ˆç›Šã€‚Multi-agent patterns åœ¨æ›´å¤§çš„ã€å¯å¹¶è¡Œçš„å·¥ä½œä¸Šå¾—åˆ°å›æŠ¥â€”â€”è€Œä¸æ˜¯ä¿®å¤æ‹¼å†™é”™è¯¯ã€‚</p>
<p><strong>Split panes éœ€è¦ tmux æˆ– iTerm2ã€‚</strong> åœ¨ VS Code çš„é›†æˆç»ˆç«¯ã€Windows Terminal æˆ– Ghostty ä¸­ä¸æ”¯æŒã€‚é»˜è®¤çš„ in-process æ¨¡å¼åœ¨ä»»ä½•åœ°æ–¹éƒ½æœ‰æ•ˆã€‚</p>
<p><strong>æƒé™ä» lead ä¼ æ’­ã€‚</strong> æ‰€æœ‰ teammates ä» lead çš„æƒé™è®¾ç½®å¼€å§‹ã€‚å¦‚æœ lead ä½¿ç”¨ <code>--dangerously-skip-permissions</code> è¿è¡Œï¼Œæ‰€æœ‰ teammates ä¹Ÿæ˜¯å¦‚æ­¤ã€‚æ‚¨å¯ä»¥åœ¨ç”Ÿæˆåæ›´æ”¹å„ä¸ª teammate æ¨¡å¼ï¼Œä½†ä¸èƒ½åœ¨ç”Ÿæˆæ—¶è®¾ç½®æ¯ä¸ª teammate çš„æ¨¡å¼ã€‚</p>
<p><strong>å…³é—­å¯èƒ½å¾ˆæ…¢ã€‚</strong> Teammates åœ¨å…³é—­ä¹‹å‰å®Œæˆå½“å‰çš„è¯·æ±‚æˆ–å·¥å…·è°ƒç”¨ï¼Œè¿™å¯èƒ½éœ€è¦æ—¶é—´ã€‚</p>
<h2 data-id="heading-13">è­¦å‘Š</h2>
<p>è§‚çœ‹ agents å¹¶è¡Œå·¥ä½œæœ‰ä¸€ç§è¯±äººçš„ç‰¹è´¨ã€‚æ´»åŠ¨æŒ‡æ ‡ä»¤äººå°è±¡æ·±åˆ»â€”â€”æ¯å°æ—¶æäº¤ã€å¹¶è¡Œä»»åŠ¡å®Œæˆã€æ¥è§¦çš„ä»£ç è¡Œæ•°ã€‚</p>
<p>ä½†æ´»åŠ¨å¹¶ä¸æ€»æ˜¯è½¬åŒ–ä¸ºä»·å€¼ã€‚</p>
<p>Multi-agent systems çš„é£é™©åœ¨äºå®ƒä»¬ä½¿å¿«é€Ÿç”Ÿæˆå¤§é‡ä»£ç å˜å¾—å®¹æ˜“ã€‚è¿™äº›ä»£ç ä»ç„¶éœ€è¦æ­£ç¡®ã€å¯ç»´æŠ¤å¹¶ä¸”çœŸæ­£è§£å†³é—®é¢˜ã€‚æˆ‘çœ‹åˆ°å¼€å‘è€…å¤±å»äº†æƒ…èŠ‚ï¼ŒèŠ±æ›´å¤šæ—¶é—´é…ç½® orchestration patterns è€Œä¸æ˜¯æ€è€ƒä»–ä»¬åœ¨æ„å»ºä»€ä¹ˆã€‚</p>
<p><strong>è®©é—®é¢˜æŒ‡å¯¼å·¥å…·ï¼Œè€Œä¸æ˜¯ç›¸åã€‚</strong> å¦‚æœä¸“æ³¨ä¼šè¯ä¸­çš„å•ä¸ª agent æ›´å¿«åœ°è®©æ‚¨åˆ°è¾¾é‚£é‡Œï¼Œè¯·ä½¿ç”¨å®ƒã€‚å¦‚æœæ‚¨éœ€è¦å¹¶è¡Œä¸“å®¶ï¼Œè¯·ä½¿ç”¨ agent teamsã€‚Agent teams å¢åŠ åè°ƒå¼€é”€å¹¶ä½¿ç”¨æ˜æ˜¾æ¯”å•ä¸ªä¼šè¯æ›´å¤šçš„ tokensã€‚å½“ teammates å¯ä»¥ç‹¬ç«‹æ“ä½œæ—¶ï¼Œå®ƒä»¬æ•ˆæœæœ€å¥½ã€‚å¯¹äºé¡ºåºä»»åŠ¡ã€åŒæ–‡ä»¶ç¼–è¾‘æˆ–å…·æœ‰è®¸å¤šä¾èµ–çš„å·¥ä½œï¼Œå•ä¸ªä¼šè¯æˆ– subagents æ›´æœ‰æ•ˆã€‚</p>
<h2 data-id="heading-14">ä½¿ç”¨ Compound Engineering æœ€å¤§åŒ–æ‚¨çš„ swarms</h2>
<p>å¦‚æœæ‚¨æƒ³è¦å›´ç»• agent teams çš„æ›´ç»“æ„åŒ–çš„å·¥ä½œæµï¼ŒEvery çš„ Compound Engineering Plugin å¯èƒ½å€¼å¾—ä¸€çœ‹ã€‚å®ƒæ˜¯ä¸€ä¸ª Claude Code æ’ä»¶ï¼Œæ·»åŠ äº†ä¸“é—¨çš„å®¡æŸ¥ agents å’Œ plan â†’ work â†’ review â†’ compound å¾ªç¯ï¼Œè®¾è®¡å›´ç»•æ¯ä¸ªå·¥ç¨‹å·¥ä½œå•å…ƒåº”è¯¥ä½¿åç»­å•å…ƒæ›´å®¹æ˜“çš„æƒ³æ³•ã€‚</p>
<p>ç›´æ¥åœ¨ Claude Code ä¸­å®‰è£…ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">/plugin marketplace add https://github.com/EveryInc/compound-engineering-plugin
/plugin install compound-engineering
</code></pre>
<p>ä¸ agent teams æœ€ç›¸å…³çš„éƒ¨åˆ†ï¼š<code>/workflows:plan</code> å°†åŠŸèƒ½æƒ³æ³•è½¬åŒ–ä¸ºè¯¦ç»†çš„å®æ–½è®¡åˆ’ï¼ˆæ­£æ˜¯ä½¿ agent å§”æ‰˜å·¥ä½œè‰¯å¥½çš„é‚£ç§å‰æœŸè§„èŒƒï¼‰ï¼Œ<code>/workflows:review</code> åœ¨åˆå¹¶ä¹‹å‰è¿è¡Œ multi-agent ä»£ç å®¡æŸ¥ï¼ˆå®‰å…¨ã€æ€§èƒ½ã€æ¶æ„å’Œå¤æ‚æ€§â€”â€”æ¯ä¸ªéƒ½æœ‰è‡ªå·±çš„ä¸“é—¨å®¡æŸ¥è€…ï¼‰ï¼Œ<code>/workflows:compound</code> è®°å½•å­¦ä¹ ï¼Œä»¥ä¾¿æœªæ¥çš„ agents ä»è¿‡å»çš„å·¥ä½œä¸­å—ç›Šã€‚</p>
<p>æœ€åä¸€éƒ¨åˆ†æ˜¯æœ‰è¶£çš„éƒ¨åˆ†ã€‚æ’ä»¶çš„å“²å­¦â€”â€”80% çš„è§„åˆ’å’Œå®¡æŸ¥ï¼Œ20% çš„æ‰§è¡Œâ€”â€”æ¸…æ™°åœ°æ˜ å°„åˆ°ä½¿ agent teams æœ‰æ•ˆçš„å†…å®¹ã€‚æ‚¨çš„è§„èŒƒè¶Šå¥½ï¼Œagent è¾“å‡ºè¶Šå¥½ã€‚æ‚¨å°†å­¦ä¹ å½¢å¼åŒ–çš„è¶Šå¤šï¼Œæ¯ä¸ªåç»­ agent å¾’åŠ³çš„æ—¶é—´è¶Šå°‘ã€‚è¿™ä¸æˆ‘ç”¨ AGENTS.md å’ŒæŒä¹…ä¸Šä¸‹æ–‡æè¿°çš„å¤åˆåŠ¨æ€ç›¸åŒï¼Œä½†æ‰“åŒ…æˆå¯é‡å¤çš„å·¥ä½œæµã€‚</p>
<p>å¦‚æœæ‚¨ä¸ä¸“é—¨ä½¿ç”¨ Claude Codeï¼Œå®ƒä¹Ÿå¯ä»¥ä¸ OpenCode å’Œ Codex ä¸€èµ·ä½¿ç”¨ï¼ˆå®éªŒæ€§åœ°ï¼‰ã€‚</p>
<h2 data-id="heading-15">å…¥é—¨â€”â€”æˆ‘ä¼šè¿™æ ·åš</h2>
<p>å¦‚æœæ‚¨æ˜¯ multi-agent coordination çš„æ–°æ‰‹ï¼Œä»å°å¤„ç€æ‰‹ã€‚</p>
<p><strong>ä»ç ”ç©¶å’Œå®¡æŸ¥å¼€å§‹ã€‚</strong> å…·æœ‰æ¸…æ™°è¾¹ç•Œä¸”ä¸éœ€è¦ç¼–å†™ä»£ç çš„ä»»åŠ¡â€”â€”ä»ä¸‰ä¸ªè§’åº¦å®¡æŸ¥ PRã€ç ”ç©¶åº“ã€ä½¿ç”¨ç«äº‰ç†è®ºè°ƒæŸ¥ bugã€‚è¿™äº›å±•ç¤ºäº†å¹¶è¡Œæ¢ç´¢çš„ä»·å€¼ï¼Œè€Œæ²¡æœ‰å¹¶è¡Œä»£ç æ›´æ”¹çš„åè°ƒå¤æ‚æ€§ã€‚</p>
<p><strong>ç„¶åå°è¯•è·¨å±‚åŠŸèƒ½ã€‚</strong> Frontendã€backend å’Œ tests å„ç”±ä¸åŒçš„ teammate æ‹¥æœ‰ã€‚æ¸…æ™°çš„è¾¹ç•Œã€æ¸…æ™°çš„äº¤ä»˜æˆæœã€‚</p>
<p><strong>ç„¶åæ‰©å±•åˆ°æ›´å¤§çš„é‡æ„ã€‚</strong> å¤šä¸ªæœåŠ¡ã€å…±äº«è®¾è®¡é˜¶æ®µåçš„å¹¶è¡Œå®ç°ã€‚è¿™å°±æ˜¯æ—¶é—´å‹ç¼©å˜å¾—æˆå‰§æ€§çš„åœ°æ–¹â€”â€”å¯èƒ½éœ€è¦æ•°å¤©é¡ºåºå·¥ä½œçš„ä¸œè¥¿å‹ç¼©æˆå‡ ä¸ªå°æ—¶çš„å¹¶è¡Œæ‰§è¡ŒåŠ ä¸Šå®¡æŸ¥ã€‚</p>
<p>æ ¸å¿ƒæŠ€èƒ½ä¸æ˜¯å†™æ›´å°‘çš„ä»£ç ã€‚å®ƒæ˜¯<strong>å°†é—®é¢˜åˆ†è§£ä¸º agent teams å¯ä»¥æ‰§è¡Œçš„ç»“æ„</strong>â€”â€”çŸ¥é“è¦æ„å»ºä»€ä¹ˆã€æ­£ç¡®æ€§æ„å‘³ç€ä»€ä¹ˆä»¥åŠå¦‚ä½•éªŒè¯ç»“æœã€‚å®æ–½è¶Šæ¥è¶Šå˜æˆä¸€ä¸ªå……åˆ†ç²¾ç¡®è§„èŒƒçš„é—®é¢˜ã€‚</p>
<p>è¿™å°±æ˜¯å½“ agents å®é™…å¯ä»¥åè°ƒæ—¶çš„ agentic engineering çš„æ ·å­ã€‚åè°ƒ AI agent systems çš„æ¶æ„å°±åœ¨è¿™é‡Œã€‚æ˜æ™ºåœ°ä½¿ç”¨å®ƒã€‚</p>
<p>å®Œæ•´çš„ Claude Code agent teams æ–‡æ¡£æœ‰å®Œæ•´çš„è®¾ç½®å’Œä½¿ç”¨æŒ‡å—ã€‚</p>
<hr/>
<p><em>æˆ‘åœ¨æˆ‘çš„ Elevate newsletter å’Œæˆ‘çš„ O'Reilly ä¹¦ç± Beyond Vibe Coding ä¸­æ’°å†™å…³äº agentic coding workflows çš„æ¼”å˜ã€‚å¦‚æœæ‚¨æ­£åœ¨è¯•éªŒ agent teams æˆ– multi-agent workflowsï¼Œæˆ‘å¾ˆä¹æ„å¬åˆ°ä»€ä¹ˆå¯¹æ‚¨æœ‰æ•ˆã€‚</em></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[go å…¨æ–°å­˜å‚¨æ–¹å¼çš„mapçš„è§£è¯»]]></title>    <link>https://juejin.cn/post/7604715051463180303</link>    <guid>https://juejin.cn/post/7604715051463180303</guid>    <pubDate>2026-02-10T04:21:57.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604715051463180303" data-draft-id="7604779604124991488" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" go å…¨æ–°å­˜å‚¨æ–¹å¼çš„mapçš„è§£è¯»"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2026-02-10T04:21:57.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="jzzzzz"/> <meta itemprop="url" content="https://juejin.cn/user/2631550499038236"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             go å…¨æ–°å­˜å‚¨æ–¹å¼çš„mapçš„è§£è¯»
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2631550499038236/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    jzzzzz
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T04:21:57.000Z" title="Tue Feb 10 2026 04:21:57 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»38åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Map</h2>
<p>åœ¨go 1.24ä¸­ï¼Œå¯¹äºmapçš„å­˜å‚¨æ›´æ¢äº†æ–°çš„å­˜å‚¨æ–¹æ³•ï¼Œä½¿ç”¨Swiss tableçš„æ–¹å¼å­˜å‚¨æ•°æ®ï¼Œä¼˜åŒ–äº†mapçš„æ“ä½œï¼Œä¸‹é¢æˆ‘ä»¬å±•å¼€è®¨è®ºmapçš„å®ç°ï¼Œä»¥ä¸‹è¡¨è¿°é»˜è®¤ 64 ä½æ¶æ„</p>
<p>é¦–å…ˆæ˜¯ç®€ä»‹å¯¹hashå†²çªçš„è§£å†³æ–¹æ³•ï¼Œå› ä¸ºæŸä¸ª key åº”è¯¥è½åœ¨å“ªä¸ªæ§½ä½ï¼Œä¸»è¦ç”±å“ˆå¸Œå‡½æ•° hash(key) å†³å®šã€‚å“ˆå¸Œå‡½æ•°æŠŠæ¯ä¸ª key æ˜ å°„ä¸ºä¸€ä¸ªæ•´æ•°ï¼šåŒä¸€ä¸ª key æ€»æ˜¯æ˜ å°„åˆ°åŒä¸€ä¸ªæ•´æ•°ï¼›æ‰€ä»¥ä¼šå­˜åœ¨hashå†²çªé—®é¢˜ï¼Œä¸‹é¢æˆ‘ä»¬ç®€å•ä»‹ç»å¼€æ”¾å¯»å€å“ˆå¸Œè¡¨æ–¹æ³•ã€‚</p>
<h3 data-id="heading-1">å¼€æ”¾å¯»å€å“ˆå¸Œè¡¨</h3>
<p>åœ¨<strong>å¼€æ”¾å¯»å€å“ˆå¸Œè¡¨</strong>ä¸­ï¼Œæ‰€æœ‰æ¡ç›®éƒ½å­˜æ”¾åœ¨åŒä¸€ä¸ªåº•å±‚æ•°ç»„ä¸­ã€‚æ•°ç»„ä¸­çš„æ¯ä¸ªä½ç½®ç§°ä¸ºä¸€ä¸ª slotï¼ˆæ§½ä½ï¼‰ã€‚ä¸åŒ key ç†æƒ³æƒ…å†µä¸‹åº”å½“éµå¾ªå‡åŒ€éšæœºçš„æ•´æ•°åˆ†å¸ƒã€‚å¼€æ”¾å¯»å€å“ˆå¸Œè¡¨çš„å®šä¹‰æ€§ç‰¹å¾åœ¨äºï¼šå®ƒé€šè¿‡æŠŠ key å­˜åˆ°æ•°ç»„ä¸­çš„å…¶ä»–ä½ç½®æ¥è§£å†³ç¢°æ’ã€‚å› æ­¤ï¼Œå¦‚æœç›®æ ‡ slot å·²ç»æ»¡äº†ï¼ˆå‘ç”Ÿç¢°æ’ï¼‰ï¼Œå°±ä½¿ç”¨æ¢æµ‹åºåˆ—ï¼ˆprobe sequenceï¼‰å»å°è¯•å…¶ä»– slotï¼Œç›´åˆ°æ‰¾åˆ°ä¸€ä¸ªç©º slotã€‚</p>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6e61baa87f3949b1823ccc0c0541ffeb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAganp6enp6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771302119&amp;x-signature=b0jPx6j42jo1Ix4A3wKk%2Fho2yxQ%3D" alt="xz.png" loading="lazy"/></p>
<h3 data-id="heading-2">swiss table</h3>
<p>Swiss Table åŒæ ·æ˜¯å¼€æ”¾å¯»å€å“ˆå¸Œè¡¨çš„ä¸€ç§å½¢å¼ã€‚ä»ç„¶ä½¿ç”¨å•ä¸€åº•å±‚æ•°ç»„è¿›è¡Œå­˜å‚¨ï¼Œä½†ä¼šæŠŠæ•°ç»„æŒ‰é€»è¾‘åˆ’åˆ†ä¸ºæ¯ç»„ 8 ä¸ª slot çš„ groupï¼ˆç»„ï¼‰ã€‚æ­¤å¤–ï¼Œæ¯ä¸ª group è¿˜æœ‰ä¸€ä¸ª 64 ä½æ§åˆ¶å­—ï¼ˆcontrol wordï¼‰ä½œä¸ºå…ƒæ•°æ®ã€‚æ§åˆ¶å­—çš„ 8 ä¸ªå­—èŠ‚åˆ†åˆ«å¯¹åº”è¯¥ group çš„ 8 ä¸ª slotã€‚æ¯ä¸ªå­—èŠ‚çš„å€¼è¡¨ç¤ºå¯¹åº” slot æ˜¯ç©ºã€å·²åˆ é™¤ï¼Œè¿˜æ˜¯æ­£åœ¨ä½¿ç”¨ã€‚å¦‚æœæ­£åœ¨ä½¿ç”¨ï¼Œè¯¥å­—èŠ‚è¿˜åŒ…å«è¯¥ slot çš„ key çš„å“ˆå¸Œå€¼ä½ 7 ä½ï¼ˆç§°ä¸º h2ï¼‰ã€‚ä¾‹å¦‚ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3db2fae49f504896a931d21238cd2344~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAganp6enp6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771302119&amp;x-signature=5VQWYWTbinI001XD5alSVVr52JY%3D" alt="example.png" loading="lazy"/></p>
<p>åœ¨Swiss Tablesä¸­ä¼šå¯¹hash(key)å¾—åˆ°çš„å€¼ï¼Œå¹¶æŠŠå“ˆå¸Œæ‹†æˆä¸¤éƒ¨åˆ†ï¼Œåˆ†åˆ«ä¸º<strong>h1(é«˜ 57 ä½)å’Œh2(ä½ 7 ä½)</strong></p>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/257d9f9fcdfe4cda86f202c92d8865fb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAganp6enp6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771302119&amp;x-signature=xq%2B1Efh%2BglzK9fZOkDu9TcS0r3o%3D" alt="key.png" loading="lazy"/></p>
<p>åœ¨æ’å…¥æ“ä½œä¸­ï¼š</p>
<ol>
<li>hash(key)è®¡ç®—æ‹†åˆ†å¾—åˆ°h1å’Œh2</li>
<li>æ ¹æ®h1è®¡ç®—é¦–å…ˆéœ€è¦æŸ¥è¯¢çš„groupï¼Œ h1 % groupçš„æ•°é‡</li>
<li>åœ¨groupå†…ï¼Œåˆ¤æ–­slotæ˜¯å¦å¯ä»¥æ’å…¥oråŒ…å«keyï¼ˆæ­¤æ—¶ä¸ºæ›´æ–°æ“ä½œï¼‰</li>
<li>å¦‚æœæ²¡æœ‰slotåŒ…å«keyï¼Œåˆ™å¯»æ‰¾empty æ’å…¥key</li>
<li>å¦‚æœæ²¡emptyï¼Œåˆ™æ²¿æ¢æµ‹åºåˆ—ç»§ç»­æœç´¢ä¸‹ä¸€ä¸ª group</li>
</ol>
<p>åœ¨ç¬¬ä¸‰æ­¥å°±æ˜¯swiss tableåšçš„ä¼˜åŒ–ï¼Œä¸€ä¸ª groupæœ‰8ä¸ªslotï¼Œæ­£å¸¸æ˜¯çº¿æ€§æ‰«æå¹¶æ¯”è¾ƒ 8 ä¸ª keyï¼Œä½†å­˜åœ¨æ§åˆ¶å­—å¯ä»¥è¿›è¡Œå¿«é€Ÿæ¯”è¾ƒï¼Œé€šè¿‡æ¯”è¾ƒæ§åˆ¶å­—ä¸­çš„æ¯ä¸ªå­—èŠ‚ä¸ºæˆ‘ä»¬çš„h2,å¾—åˆ°å€™é€‰ï¼ˆä¸€æ¬¡æ¯”è¾ƒåŒä¸€ group çš„ 8 ä¸ª slot æ§åˆ¶å­—èŠ‚ï¼Œä»è€Œä¼˜åŒ–ï¼‰</p>
<p>ä¾‹å¦‚æŸ¥æ‰¾ key 36ï¼Œå¹¶ä¸” h2 = 23ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/35b31468f07343c4af5f0e0d92743cfd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAganp6enp6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771302119&amp;x-signature=xGzN73XEQLfw0r9uWaBTjq61kqM%3D" alt="compare.png" loading="lazy"/></p>
<h3 data-id="heading-3">mapçš„åŸºæœ¬ä½¿ç”¨</h3>
<h4 data-id="heading-4">åˆ›å»ºmap</h4>
<p>æœ‰ä¸¤ç§åˆ›å»ºæ–¹å¼åˆ†åˆ«æ˜¯å¸¦å®¹é‡å’Œä¸å¸¦å®¹é‡çš„åˆ›å»ºï¼š</p>
<pre><code class="hljs language-go" lang="go">m := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">map</span>[<span class="hljs-type">int</span>]<span class="hljs-type">int</span>, <span class="hljs-built_in">cap</span>)

m2 := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">map</span>[<span class="hljs-type">int</span>]<span class="hljs-type">int</span>)
</code></pre>
<h4 data-id="heading-5">mapå†™å…¥æ•°æ®</h4>
<pre><code class="hljs language-go" lang="go">m[key] = val
</code></pre>
<h4 data-id="heading-6">mapè¯»å–æ•°æ®</h4>
<ol>
<li>ç¬¬ä¸€ç§æ–¹å¼å¦‚æœkeyä¸å­˜åœ¨è¿”å›0å€¼ï¼Œå­˜åœ¨è¿”å›å¯¹åº”val</li>
<li>ç¬¬äºŒç§æ–¹å¼å¯ä»¥æ ¹æ®è¿”å›çš„boolå€¼åˆ¤æ–­æ˜¯å¦çœŸçš„å–åˆ°å€¼</li>
</ol>
<pre><code class="hljs language-go" lang="go">v1 := m[key]
v2, ok := m[key]
</code></pre>
<h4 data-id="heading-7">mapåˆ é™¤æ•°æ®</h4>
<pre><code class="hljs language-go" lang="go"><span class="hljs-built_in">delete</span>(m, key)
</code></pre>
<h3 data-id="heading-8">mapæ•°æ®ç»“æ„</h3>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/207978eb6dc04d11ad7e33bd9dfe7a9c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAganp6enp6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771302119&amp;x-signature=LxSLDiHKHVG5kOdGjDk%2BYE7MqSw%3D" alt="map-structure.png" width="70%" loading="lazy"/>
<p><strong>internal/runtime/maps/map.go</strong></p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">type</span> Map <span class="hljs-keyword">struct</span> {
	used <span class="hljs-type">uint64</span>
	seed <span class="hljs-type">uintptr</span>
	dirPtr unsafe.Pointer
	dirLen <span class="hljs-type">int</span> <span class="hljs-comment">//*[dirLen]*table</span>
	globalDepth <span class="hljs-type">uint8</span>
	globalShift <span class="hljs-type">uint8</span>
	writing <span class="hljs-type">uint8</span>
	clearSeq <span class="hljs-type">uint64</span>
}
</code></pre>
<ol>
<li>used å·²ç»å¡«å……çš„slotçš„æ•°é‡ï¼ˆæ‰€æœ‰tableä¸­çš„å…ƒç´ çš„æ€»æ•°ï¼‰</li>
<li>seed ç”¨äºhashè®¡ç®—ä½¿ç”¨</li>
<li>dirPtr é€šå¸¸æƒ…å†µä¸‹ï¼ŒdirPtr æŒ‡å‘ä¸€ä¸ªç”± table æŒ‡é’ˆç»„æˆçš„æ•°ç»„ï¼Œå¦‚æœmapä¸­å…ƒç´ æ•°é‡ä¸è¶…è¿‡ 8 æ­¤æ—¶ dirPtr ç›´æ¥æŒ‡å‘ä¸€ä¸ªå•ç‹¬çš„ group</li>
<li>globalDepth åœ¨tableç›®å½•æŸ¥æ‰¾æ—¶è¦ä½¿ç”¨çš„æ¯”ç‰¹æ•°</li>
<li>globalShift åœ¨è¿›è¡Œç›®å½•æŸ¥æ‰¾æ—¶ï¼Œéœ€è¦ä»å“ˆå¸Œå€¼ä¸­å³ç§»æ‰çš„æ¯”ç‰¹æ•°</li>
<li>writing æ˜¯ä¸€ä¸ªæ ‡å¿—ä½ï¼šå½“ map æ­£åœ¨è¢«å†™å…¥æ—¶ï¼Œä¼šé€šè¿‡å¼‚æˆ– 1ï¼ˆXOR 1ï¼‰çš„æ–¹å¼ç¿»è½¬ã€‚</li>
<li>clearSeq æ˜¯å¯¹ Clear è°ƒç”¨æ¬¡æ•°çš„åºåˆ—è®¡æ•°å™¨ï¼Œç”¨äºåœ¨è¿­ä»£æœŸé—´æ£€æµ‹ map æ˜¯å¦è¢«æ¸…ç©ºã€‚</li>
</ol>
<p><strong>internal/runtime/maps/table.go</strong></p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">type</span> table <span class="hljs-keyword">struct</span> {
	used <span class="hljs-type">uint16</span>
	capacity <span class="hljs-type">uint16</span>
	growthLeft <span class="hljs-type">uint16</span>
	localDepth <span class="hljs-type">uint8</span>
	index <span class="hljs-type">int</span>
	groups groupsReference
}
</code></pre>
<ol>
<li>used è¯¥tableå·²å¡«å……çš„çš„å…ƒç´ ï¼ˆslotï¼‰æ•°é‡</li>
<li>capacity è¯¥tableçš„å®¹é‡ï¼Œslotçš„ä¸Šé™</li>
<li>growthLeft åœ¨æ— éœ€rehashçš„æƒ…å†µä¸‹ï¼Œè¿˜èƒ½ç»§ç»­å¡«å……çš„ slot æ•°é‡ã€‚ï¼ˆused + tombstones &gt; loadFactor*capacity æ—¶ä¼šè§¦å‘ rehashï¼‰</li>
<li>localDepth åœ¨è¯¥ table ä¹‹ä¸Šï¼Œç”¨äºç›®å½•æŸ¥æ‰¾ï¼ˆdirectory lookupsï¼‰çš„æ¯”ç‰¹æ•°ã€‚ï¼ˆå¦‚æœç›®å½•æ‰©å®¹ä½†è¯¥tableæœªæ‹†åˆ†å¯èƒ½ä¼šå°äºm.globalDepthï¼‰</li>
<li>index è¯¥ table åœ¨ Map ç›®å½•ä¸­çš„ç´¢å¼•ã€‚è¿™æ˜¯ç›®å½•ä¸­è¯¥ table å‡ºç°çš„â€œç¬¬ä¸€ä¸ªâ€ä½ç½®çš„ç´¢å¼•ã€‚åŒä¸€ä¸ª table å¯èƒ½ä¼šåœ¨ç›®å½•ä¸­è¿ç»­å‡ºç°å¤šä¸ªç´¢å¼•ä½ç½®ã€‚å¦‚æœindexä¸º-1åˆ™å·²è¿‡æœŸä¸å†ä½¿ç”¨</li>
<li>groups  table è‡ªå·±æŒæœ‰çš„ä¸€ä¸ª group æ•°ç»„</li>
</ol>
<p><strong>internal/runtime/maps/group.go</strong></p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">type</span> groupsReference <span class="hljs-keyword">struct</span> {
	data unsafe.Pointer <span class="hljs-comment">// data *[length]typ.Group</span>
	lengthMask <span class="hljs-type">uint64</span>
}
</code></pre>
<ol>
<li>data æŒ‡å‘ä¸€ä¸ª group æ•°ç»„</li>
<li>lengthMask ç­‰äº data ä¸­ group çš„æ•°é‡å‡ä¸€ï¼Œæ–¹ä¾¿æŒ‰ä½</li>
</ol>
<p><strong>internal/rutime/maps/group.go</strong></p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">type</span> groupReference <span class="hljs-keyword">struct</span> {
	<span class="hljs-comment">// data points to the group, which is described by typ.Group and has</span>
	<span class="hljs-comment">// layout:</span>
	<span class="hljs-comment">// groupç”± abi.SwissMapGroupSlotsï¼ˆ8ï¼‰ä¸ª slot åŠ ä¸Šä¸€ä¸ªæ§åˆ¶å­—ç»„æˆçš„ä¸€ç»„ã€‚</span>
	<span class="hljs-comment">// type group struct {</span>
	<span class="hljs-comment">// 	ctrls ctrlGroup // æ§åˆ¶å­—èŠ‚ç»„ï¼Œæ¯ä¸ª slot 1 ä¸ªæ§åˆ¶å­—èŠ‚ï¼Œæ§åˆ¶å­—èŠ‚æœ€é«˜ä½åŒºåˆ†ç©º/åˆ é™¤/å ç”¨ï¼›å ç”¨æ—¶å…¶ä½™ 7 ä½å­˜ H2ï¼ˆhash(key)çš„ä½7ä½ï¼‰ã€‚</span>
	<span class="hljs-comment">// 	slots [abi.SwissMapGroupSlots]slot</span>
	<span class="hljs-comment">// }</span>
	<span class="hljs-comment">//</span>
	<span class="hljs-comment">// type slot struct {</span>
	<span class="hljs-comment">// 	key  typ.Key </span>
	<span class="hljs-comment">// 	elem typ.Elem</span>
	<span class="hljs-comment">// }</span>
	data unsafe.Pointer <span class="hljs-comment">// data *typ.Group</span>
}
</code></pre>
<p>ç”¨æ¥è¡¨ç¤ºå­˜æ”¾åœ¨ data ä¸­çš„å•ä¸ª slot group, ä¸€ä¸ªgroupåŒ…å« abi.SwissMapGroupSlots ï¼ˆ8ï¼‰ä¸ª slotï¼ˆkey/elem å¯¹ï¼‰ï¼Œä»¥åŠå®ƒä»¬çš„æ§åˆ¶å­—ã€‚</p>
<h3 data-id="heading-9">åˆ›å»ºmap</h3>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/04dce541bf5e4feea0b97e255e149568~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAganp6enp6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771302119&amp;x-signature=Yn9bJ3DKKC4BIMwTxjyOv1O%2B6So%3D" alt="newmap.png" loading="lazy"/></p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewMap</span><span class="hljs-params">(mt *abi.SwissMapType, hint <span class="hljs-type">uintptr</span>, m *Map, maxAlloc <span class="hljs-type">uintptr</span>)</span></span> *Map {
	<span class="hljs-keyword">if</span> m == <span class="hljs-literal">nil</span> {
		m = <span class="hljs-built_in">new</span>(Map)
	}
	m.seed = <span class="hljs-type">uintptr</span>(rand())
	<span class="hljs-keyword">if</span> hint &lt;= abi.SwissMapGroupSlots {
		<span class="hljs-keyword">return</span> m
	}
	targetCapacity := (hint * abi.SwissMapGroupSlots) / maxAvgGroupLoad
	<span class="hljs-keyword">if</span> targetCapacity &lt; hint { 
		<span class="hljs-keyword">return</span> m <span class="hljs-comment">// return an empty map.</span>
	}
	dirSize := (<span class="hljs-type">uint64</span>(targetCapacity) + maxTableCapacity - <span class="hljs-number">1</span>) / maxTableCapacity
	dirSize, overflow := alignUpPow2(dirSize)
	<span class="hljs-keyword">if</span> overflow || dirSize &gt; <span class="hljs-type">uint64</span>(math.MaxUintptr) {
		<span class="hljs-keyword">return</span> m <span class="hljs-comment">// return an empty map.</span>
	}
	groups, overflow := math.MulUintptr(<span class="hljs-type">uintptr</span>(dirSize), maxTableCapacity)
	<span class="hljs-keyword">if</span> overflow {
		<span class="hljs-keyword">return</span> m <span class="hljs-comment">// return an empty map.</span>
	} <span class="hljs-keyword">else</span> {
		mem, overflow := math.MulUintptr(groups, mt.GroupSize)
		<span class="hljs-keyword">if</span> overflow || mem &gt; maxAlloc {
			<span class="hljs-keyword">return</span> m <span class="hljs-comment">// return an empty map.</span>
		}
	}
	m.globalDepth = <span class="hljs-type">uint8</span>(sys.TrailingZeros64(dirSize))
	m.globalShift = depthToShift(m.globalDepth)
	directory := <span class="hljs-built_in">make</span>([]*table, dirSize)
	<span class="hljs-keyword">for</span> i := <span class="hljs-keyword">range</span> directory {
		
		directory[i] = newTable(mt, <span class="hljs-type">uint64</span>(targetCapacity)/dirSize, i, m.globalDepth)
	}
	m.dirPtr = unsafe.Pointer(&amp;directory[<span class="hljs-number">0</span>])
	m.dirLen = <span class="hljs-built_in">len</span>(directory)
	<span class="hljs-keyword">return</span> m
}
</code></pre>
<p>è¯¥æ–¹æ³•æœ‰å››ä¸ªå‚æ•°ï¼Œmt *abi.SwissMapTypeï¼šmap çš„ç±»å‹å…ƒæ•°æ®ï¼Œhint uintptrï¼šæ¥è‡ª make(map[K]V, hint) çš„æœŸæœ›å®¹é‡ï¼Œm *Mapï¼šå¯å¤ç”¨/é¢„åˆ†é…çš„ Map å¤´éƒ¨æŒ‡é’ˆï¼›maxAlloc uintptrï¼šæœ¬æ¬¡åˆ†é…å…è®¸çš„æœ€å¤§å†…å­˜ä¸Šé™ï¼›</p>
<p>ç”±äºä»£ç è¿‡é•¿ä¸”åˆ¤æ–­æ¡ä»¶è¾ƒå¤šæ‰€ä»¥å°±åˆ’åˆ†è®²è§£ï¼š</p>
<p><strong>step1:</strong></p>
<ol>
<li>ç¼–è¯‘å™¨åˆ¤æ–­ map é€ƒé€¸ï¼Œå°±ä¸åœ¨æ ˆä¸Šé¢„åˆ†é…ï¼Œç›´æ¥ä¼  nilï¼ŒNewMap ä¼š new(Map)ï¼Œä¸”å› ä¸ºæŒ‡é’ˆè¦è¿”å›ç»™è°ƒç”¨æ–¹ï¼Œè¿™ä¸ª Map ä¼šé€ƒé€¸ï¼Œå®é™…åˆ†é…åœ¨å †ä¸Šã€‚</li>
<li>ç¼–è¯‘å™¨åˆ¤æ–­ map ä¸é€ƒé€¸ï¼Œå°±åœ¨è°ƒç”¨æ–¹æ ˆä¸Šæ”¾ä¸€ä¸ªä¸´æ—¶ Map å¤´éƒ¨ï¼Œå¹¶æŠŠå®ƒçš„åœ°å€ä¼ ç»™ NewMap å¤ç”¨ã€‚</li>
</ol>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewMap</span><span class="hljs-params">(mt *abi.SwissMapType, hint <span class="hljs-type">uintptr</span>, m *Map, maxAlloc <span class="hljs-type">uintptr</span>)</span></span> *Map {
	<span class="hljs-keyword">if</span> m == <span class="hljs-literal">nil</span> {
		m = <span class="hljs-built_in">new</span>(Map)
	}
	<span class="hljs-comment">//..</span>
	<span class="hljs-keyword">return</span> m
}
</code></pre>
<p><strong>step2:</strong>
å¯¹mçš„seedèµ‹å€¼ï¼Œå¹¶æ ¹æ®hintå¤§å°ï¼šåˆ¤æ–­å½“hint &lt;= abi.SwissMapGroupSlots(=8) ï¼Œæ­¤æ—¶ä¸€ä¸ªgroupå³å¯æ»¡è¶³ï¼Œå‡½æ•°ç›´æ¥è¿”å›ä¸åˆ†é…;åœ¨å¯¹mapé¦–æ¬¡å†™å…¥æ—¶ä¼šåˆ†é…ä¸€ä¸ª 8-slot group</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewMap</span><span class="hljs-params">(mt *abi.SwissMapType, hint <span class="hljs-type">uintptr</span>, m *Map, maxAlloc <span class="hljs-type">uintptr</span>)</span></span> *Map {
	<span class="hljs-comment">//..</span>
	m.seed = <span class="hljs-type">uintptr</span>(rand())
	<span class="hljs-keyword">if</span> hint &lt;= abi.SwissMapGroupSlots {
		<span class="hljs-keyword">return</span> m
	}
	<span class="hljs-comment">//..</span>
}
</code></pre>
<p><strong>step3:</strong>
è®¡ç®— targetCapacity = hint * slotsPerGroup / maxAvgGroupLoadï¼Œç­‰ä»·äº hint / è´Ÿè½½å› å­(7/8)ï¼Œé˜²æ­¢åˆšåˆ›å»ºåå°±è§¦å‘æ‰©å®¹ï¼Œå¦‚æœè®¡ç®—åˆ†é…çš„é¢„æœŸå®¹é‡æº¢å‡ºè½¬ä¸ºåˆ™ç›´æ¥è¿”å›ç©ºmapã€‚</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewMap</span><span class="hljs-params">(mt *abi.SwissMapType, hint <span class="hljs-type">uintptr</span>, m *Map, maxAlloc <span class="hljs-type">uintptr</span>)</span></span> *Map {
	<span class="hljs-comment">//..</span>
	targetCapacity := (hint * abi.SwissMapGroupSlots) / maxAvgGroupLoad
	<span class="hljs-keyword">if</span> targetCapacity &lt; hint { <span class="hljs-comment">// overflow</span>
		<span class="hljs-keyword">return</span> m <span class="hljs-comment">// return an empty map.</span>
	}
	<span class="hljs-comment">//..</span>
}
</code></pre>
<p><strong>step4:</strong>
è®¡ç®— table ä¸ªæ•°dirSize = ceil(targetCapacity / maxTableCapacity) ï¼Œéšåå‘ä¸Šå–æ•´åˆ° 2 çš„å¹‚ï¼›æº¢å‡ºåˆ™è¿”å›ç©º map</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewMap</span><span class="hljs-params">(mt *abi.SwissMapType, hint <span class="hljs-type">uintptr</span>, m *Map, maxAlloc <span class="hljs-type">uintptr</span>)</span></span> *Map {
	<span class="hljs-comment">//..</span>
	dirSize := (<span class="hljs-type">uint64</span>(targetCapacity) + maxTableCapacity - <span class="hljs-number">1</span>) / maxTableCapacity
	dirSize, overflow := alignUpPow2(dirSize)
	<span class="hljs-keyword">if</span> overflow || dirSize &gt; <span class="hljs-type">uint64</span>(math.MaxUintptr) {
		<span class="hljs-keyword">return</span> m <span class="hljs-comment">// return an empty map.</span>
	}
	<span class="hljs-comment">//..</span>
}
</code></pre>
<p><strong>step5:</strong>
è¿›è¡Œè¿‡å¤§ hint çš„å†…å­˜ä¸Šé™æ£€æŸ¥ï¼šç”¨ dirSize*maxTableCapacity å¾—åˆ°æ€» groups ä¸Šç•Œï¼Œå†ä¹˜ mt.GroupSize å¾—åˆ°å†…å­˜ä¸Šç•Œï¼›ä»»ä¸€å¤„æº¢å‡ºæˆ–è¶… maxAlloc åˆ™è¿”å›</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewMap</span><span class="hljs-params">(mt *abi.SwissMapType, hint <span class="hljs-type">uintptr</span>, m *Map, maxAlloc <span class="hljs-type">uintptr</span>)</span></span> *Map {
	<span class="hljs-comment">//..</span>
	groups, overflow := math.MulUintptr(<span class="hljs-type">uintptr</span>(dirSize), maxTableCapacity)
	<span class="hljs-keyword">if</span> overflow {
		<span class="hljs-keyword">return</span> m <span class="hljs-comment">// return an empty map.</span>
	} <span class="hljs-keyword">else</span> {
		mem, overflow := math.MulUintptr(groups, mt.GroupSize)
		<span class="hljs-keyword">if</span> overflow || mem &gt; maxAlloc {
			<span class="hljs-keyword">return</span> m <span class="hljs-comment">// return an empty map.</span>
		}
	}
	<span class="hljs-comment">//..</span>
}
</code></pre>
<pre><code class="hljs language-go" lang="go">è®¡ç®—ç›®å½•éœ€è¦ç”¨çš„ä½æ•°ï¼Œä»¥åŠå–å‡ºè¿™ globalDepth ä½ï¼Œå“ˆå¸Œå€¼éœ€è¦å³ç§»å¤šå°‘ä½ã€‚ç„¶ååˆ›å»ºtableï¼ˆå®¹é‡ä¸ºé¢„æœŸå®¹é‡ / tableä¸ªæ•°ï¼‰å¹¶åˆ†é…ç›®å½•æ•°ç»„ï¼Œè®°å½•ç›®å½•é•¿åº¦ï¼Œåˆå§‹åŒ–å®Œæˆè¿”å›
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewMap</span><span class="hljs-params">(mt *abi.SwissMapType, hint <span class="hljs-type">uintptr</span>, m *Map, maxAlloc <span class="hljs-type">uintptr</span>)</span></span> *Map {
	<span class="hljs-comment">//..</span>
	m.globalDepth = <span class="hljs-type">uint8</span>(sys.TrailingZeros64(dirSize))
	m.globalShift = depthToShift(m.globalDepth)
	directory := <span class="hljs-built_in">make</span>([]*table, dirSize)
	<span class="hljs-keyword">for</span> i := <span class="hljs-keyword">range</span> directory {
		directory[i] = newTable(mt, <span class="hljs-type">uint64</span>(targetCapacity)/dirSize, i, m.globalDepth)
	}
	m.dirPtr = unsafe.Pointer(&amp;directory[<span class="hljs-number">0</span>])
	m.dirLen = <span class="hljs-built_in">len</span>(directory)
	<span class="hljs-keyword">return</span> m
}
</code></pre>
<p>æ¥ä¸‹æ¥çœ‹ä¸Šé¢è°ƒç”¨åˆ°çš„åˆ›å»ºtableçš„æ–¹æ³•newTable()</p>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/af3cdce427c14f1c83cf1b29e782a4b0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAganp6enp6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771302119&amp;x-signature=VHoFmXMrCxeEn1i5qwohsS9fHqQ%3D" alt="newtable.png" width="50%" loading="lazy"/></p>
<p><strong>internal/rutime/maps/table.go  newTable()</strong></p>
<ol>
<li>é¦–å…ˆæ ¹æ®capacityå¤§å°è¿›è¡Œå…œåº•ï¼Œé¿å…ä¸å¤Ÿä¸€ä¸ªgroupçš„slotå®¹é‡ï¼Œç„¶åå¯¹tableèµ‹å€¼</li>
<li>å¦‚æœcapacity &gt; maxTableCapacityï¼ˆ1024ï¼‰åˆ™panic</li>
<li>ç„¶åå°†capacityå¯¹é½åˆ° 2 çš„å¹‚ï¼Œå¦‚æœå¯¹é½åæº¢å‡ºpanic</li>
<li>è°ƒç”¨reset æ–¹æ³•ä¼šæŒ‰å®¹é‡åˆ†é… groups æ•°ç»„ã€è®¾ç½® capacity/ growthLeftï¼Œå¹¶æŠŠ control å­—èŠ‚åˆå§‹åŒ–ä¸º emptyã€‚</li>
<li>è¿”å›åˆ›å»ºå¥½çš„table</li>
</ol>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">newTable</span><span class="hljs-params">(typ *abi.SwissMapType, capacity <span class="hljs-type">uint64</span>, index <span class="hljs-type">int</span>, localDepth <span class="hljs-type">uint8</span>)</span></span> *table {
	<span class="hljs-keyword">if</span> capacity &lt; abi.SwissMapGroupSlots {
		capacity = abi.SwissMapGroupSlots
	}
	t := &amp;table{
		index:      index,
		localDepth: localDepth,
	}

	<span class="hljs-keyword">if</span> capacity &gt; maxTableCapacity {
		<span class="hljs-built_in">panic</span>(<span class="hljs-string">"initial table capacity too large"</span>)
	}
	capacity, overflow := alignUpPow2(capacity)
	<span class="hljs-keyword">if</span> overflow {
		<span class="hljs-built_in">panic</span>(<span class="hljs-string">"rounded-up capacity overflows uint64"</span>)
	}

	t.reset(typ, <span class="hljs-type">uint16</span>(capacity))
	<span class="hljs-keyword">return</span> t
}
</code></pre>
<p>å¯¹tableåˆ†é…groupæ•°ç»„</p>
<p><strong>table.reset()</strong></p>
<ol>
<li>æ ¹æ®capacityè®¡ç®—å‡ºgroupCount</li>
<li>newGroups(typ, groupCount)åˆ›å»ºäº†ä¸€ä¸ªgroupsReferenceåˆ†é…ä¸€æ®µè¿ç»­çš„ group æ•°ç»„å¹¶è¿”å›ï¼Œå¯¹tableèµ‹å€¼</li>
<li>ç„¶åè°ƒç”¨resetGrowthLeftè®¡ç®—growthLeft</li>
<li>æœ€åæ¸…ç©ºæ•´å¼ groupsè¡¨çš„ control å­—èŠ‚</li>
</ol>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(t *table)</span></span> reset(typ *abi.SwissMapType, capacity <span class="hljs-type">uint16</span>) {
	groupCount := <span class="hljs-type">uint64</span>(capacity) / abi.SwissMapGroupSlots
	t.groups = newGroups(typ, groupCount)
	t.capacity = capacity
	t.resetGrowthLeft()

	<span class="hljs-keyword">for</span> i := <span class="hljs-type">uint64</span>(<span class="hljs-number">0</span>); i &lt;= t.groups.lengthMask; i++ {
		g := t.groups.group(typ, i) <span class="hljs-comment">//æ ¹æ®indexè¿”å›å¯¹åº”çš„group</span>
		g.ctrls().setEmpty()
	}
}
</code></pre>
<p>è¯¥æ–¹æ³•æ ¹æ®capacityè®¡ç®—å½“å‰tableä¸æ‰©å®¹æƒ…å†µä¸‹è¿˜å¯ä»¥æ”¾å¤šå°‘æ•°æ®</p>
<p><strong>table.resetGrowthLeft()</strong></p>
<ol>
<li>å¦‚æœ capacity ä¸º0åˆ™ç›´æ¥panicï¼Œä¸€ä¸ªtableå¿…é¡»æœ‰ä¸€ä¸ªæœ‰æ•ˆçš„å®¹é‡</li>
<li>æ ¹æ® capacity è®¡ç®—å‡ºgrowthLeftï¼Œå¯¹äºå• group è¡¨éœ€è¦è‡³å°‘ç•™ 1 ä¸ªç©ºæ§½æ¥ä¿è¯æ¢æµ‹ç»ˆæ­¢</li>
<li>å¯¹äºå¤šä¸ª group è´Ÿè½½å› å­æ˜¯ maxAvgGroupLoad / SwissMapGroupSlotsï¼ˆ7/8ï¼‰ï¼Œå…ˆåšæº¢å‡ºæ£€æŸ¥ï¼št.capacity*maxAvgGroupLoad å¦‚æœæº¢å‡ºä¼španicã€‚æœ€ç»ˆå¯ç”¨æ§½æ•° = capacity * 7 / 8ã€‚</li>
<li>è¿”å›</li>
</ol>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(t *table)</span></span> resetGrowthLeft() {
	<span class="hljs-keyword">var</span> growthLeft <span class="hljs-type">uint16</span>
	<span class="hljs-keyword">if</span> t.capacity == <span class="hljs-number">0</span> {
		<span class="hljs-built_in">panic</span>(<span class="hljs-string">"table must have positive capacity"</span>)
	} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> t.capacity &lt;= abi.SwissMapGroupSlots {
		growthLeft = t.capacity - <span class="hljs-number">1</span>
	} <span class="hljs-keyword">else</span> {
		<span class="hljs-keyword">if</span> t.capacity*maxAvgGroupLoad &lt; t.capacity {
			<span class="hljs-built_in">panic</span>(<span class="hljs-string">"overflow"</span>)
		}
		growthLeft = (t.capacity * maxAvgGroupLoad) / abi.SwissMapGroupSlots
	}
	t.growthLeft = growthLeft
}
</code></pre>
<p>åˆ†é…ä¸€æ®µè¿ç»­çš„ group æ•°ç»„åŠ åˆå§‹åŒ–lengthMaskæ–¹ä¾¿å¿«é€ŸæŸ¥æ‰¾</p>
<p><strong>newGroups()</strong></p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">newGroups</span><span class="hljs-params">(typ *abi.SwissMapType, length <span class="hljs-type">uint64</span>)</span></span> groupsReference {
	<span class="hljs-keyword">return</span> groupsReference{
		data:       newarray(typ.Group, <span class="hljs-type">int</span>(length)),
		lengthMask: length - <span class="hljs-number">1</span>,
	}
}
</code></pre>
<h3 data-id="heading-10">mapä¸­è¯»æ•°æ®</h3>
<p>åœ¨internal/runtime/maps/runtime_swiss.goä¸­å¯ä»¥æŸ¥çœ‹å®ç°æ–¹æ³•</p>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a5024a84b8c7482c8eb3be04b6b607f4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAganp6enp6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771302119&amp;x-signature=c8PQuuvf%2FaIyRnCRnvuAnbZqmgc%3D" alt="readmap.png" width="70%" loading="lazy"/></p>
**runtime\_mapaccess1()**
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">runtime_mapaccess1</span><span class="hljs-params">(typ *abi.SwissMapType, m *Map, key unsafe.Pointer)</span></span> unsafe.Pointer {
	<span class="hljs-keyword">if</span> m == <span class="hljs-literal">nil</span> || m.Used() == <span class="hljs-number">0</span> {
		<span class="hljs-keyword">if</span> err := mapKeyError(typ, key); err != <span class="hljs-literal">nil</span> {
			<span class="hljs-built_in">panic</span>(err) <span class="hljs-comment">// see issue 23734</span>
		}
		<span class="hljs-keyword">return</span> unsafe.Pointer(&amp;zeroVal[<span class="hljs-number">0</span>])
	}

	<span class="hljs-keyword">if</span> m.writing != <span class="hljs-number">0</span> {
		fatal(<span class="hljs-string">"concurrent map read and map write"</span>)
	}

	hash := typ.Hasher(key, m.seed)

	<span class="hljs-keyword">if</span> m.dirLen &lt;= <span class="hljs-number">0</span> {
		_, elem, ok := m.getWithKeySmall(typ, hash, key)
		<span class="hljs-keyword">if</span> !ok {
			<span class="hljs-keyword">return</span> unsafe.Pointer(&amp;zeroVal[<span class="hljs-number">0</span>])
		}
		<span class="hljs-keyword">return</span> elem
	}

	<span class="hljs-comment">// Select table.</span>
	idx := m.directoryIndex(hash)
	t := m.directoryAt(idx)

	<span class="hljs-comment">// Probe table.</span>
	seq := makeProbeSeq(h1(hash), t.groups.lengthMask)
	<span class="hljs-keyword">for</span> ; ; seq = seq.next() {
		g := t.groups.group(typ, seq.offset)

		match := g.ctrls().matchH2(h2(hash))

		<span class="hljs-keyword">for</span> match != <span class="hljs-number">0</span> {
			i := match.first()

			slotKey := g.key(typ, i)
			slotKeyOrig := slotKey
			<span class="hljs-keyword">if</span> typ.IndirectKey() {
				slotKey = *((*unsafe.Pointer)(slotKey))
			}
			<span class="hljs-keyword">if</span> typ.Key.Equal(key, slotKey) {
				slotElem := unsafe.Pointer(<span class="hljs-type">uintptr</span>(slotKeyOrig) + typ.ElemOff)
				<span class="hljs-keyword">if</span> typ.IndirectElem() {
					slotElem = *((*unsafe.Pointer)(slotElem))
				}
				<span class="hljs-keyword">return</span> slotElem
			}
			match = match.removeFirst()
		}

		match = g.ctrls().matchEmpty()
		<span class="hljs-keyword">if</span> match != <span class="hljs-number">0</span> {
			<span class="hljs-comment">// Finding an empty slot means we've reached the end of</span>
			<span class="hljs-comment">// the probe sequence.</span>
			<span class="hljs-keyword">return</span> unsafe.Pointer(&amp;zeroVal[<span class="hljs-number">0</span>])
		}
	}
}
</code></pre>
<p><strong>step1:</strong></p>
<p>å¦‚æœmapä¸ºnilï¼Œæˆ–è€…mapä¸­æ— å·²å¡«å……çš„æ•°æ®ï¼Œé¦–å…ˆå¯¹keyçš„åˆæ³•æ€§è¿›è¡Œåˆ¤æ–­ï¼Œå¦‚æœkeyä¸åˆæ³•åˆ™ç›´æ¥panicï¼Œå¦åˆ™è¿”å›ä¸€ä¸ªé›¶å€¼ï¼›</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">if</span> m == <span class="hljs-literal">nil</span> || m.Used() == <span class="hljs-number">0</span> {
		<span class="hljs-keyword">if</span> err := mapKeyError(typ, key); err != <span class="hljs-literal">nil</span> {
			<span class="hljs-built_in">panic</span>(err) <span class="hljs-comment">// see issue 23734</span>
		}
		<span class="hljs-keyword">return</span> unsafe.Pointer(&amp;zeroVal[<span class="hljs-number">0</span>])
	}
</code></pre>
<p><strong>step2ï¼š</strong></p>
<p>æ­¤æ—¶å­˜åœ¨å…¶ä»–goroutineåœ¨å†™è¯¥mapï¼Œåˆ™ç›´æ¥fatal</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">if</span> m.writing != <span class="hljs-number">0</span> {
		fatal(<span class="hljs-string">"concurrent map read and map write"</span>)
	}
</code></pre>
<p><strong>step3ï¼š</strong></p>
<p>ä½¿ç”¨typç±»å‹å¯¹åº”çš„hasherå‡½æ•°å¾—åˆ°keyå¯¹åº”çš„hashï¼Œå¦‚æœm.dirLen &lt;= 0è¯´æ˜æ˜¯ä¸€ä¸ªå°map
åˆ™è°ƒç”¨getWithKeySmallæ–¹æ³•å–å€¼å¹¶è¿”å›ï¼Œè‹¥æ²¡å–åˆ°è¿”å›é›¶å€¼</p>
<pre><code class="hljs language-go" lang="go">hash := typ.Hasher(key, m.seed)
	<span class="hljs-keyword">if</span> m.dirLen &lt;= <span class="hljs-number">0</span> {
		_, elem, ok := m.getWithKeySmall(typ, hash, key)
		<span class="hljs-keyword">if</span> !ok {
			<span class="hljs-keyword">return</span> unsafe.Pointer(&amp;zeroVal[<span class="hljs-number">0</span>])
		}
		<span class="hljs-keyword">return</span> elem
	}
</code></pre>
<p><strong>step4ï¼š</strong></p>
<ol>
<li>æ ¹æ®hashå€¼å³ç§»globalShiftè·å–åˆ°tableçš„indexï¼Œç„¶åæ ¹æ®indexå–å‡ºå¯¹åº”çš„tableæŒ‡é’ˆ</li>
<li>æ ¹æ®h1(hash)å’Œgroupçš„lengthMaskè®¡ç®—å‡ºï¼Œèµ·å§‹ offset å’Œæ­¥è¿›åºåˆ—</li>
<li>ç„¶åæ ¹æ®å–å‡ºseqï¼Œå¼€å¯forå¾ªç¯ï¼Œæ¯æ¬¡seq.next()ä¼šç»™å‡ºä¸‹ä¸€ä¸ªè¦æ¢æµ‹çš„ group ä½ç½®ã€‚</li>
<li>åœ¨forå¾ªç¯å†…éƒ¨ï¼Œæ ¹æ®h2(hash)ä¸æ§åˆ¶å­—åŒ¹é…ï¼Œå¾—åˆ°ä½å›¾ï¼ˆå“ªäº› slot çš„ h2 åŒ¹é…ï¼‰ä¾‹å¦‚ï¼šmask = 0b00001001</li>
<li>å½“matchå¤§äº0ï¼Œå¼€å¯ç¬¬äºŒä¸ªforéå†ï¼ŒæŒ‰ä½å›¾é€ä¸ªå–ï¼Œmask.first() å–æœ€ä½ä½çš„ 1ï¼Œå¦‚æœkeyå­˜çš„æ˜¯æŒ‡å‘keyçš„æŒ‡é’ˆæ‰è§£æŒ‡é’ˆ</li>
<li>å¦‚æœtyp.Key.Equal(key, slotKey)æˆç«‹ï¼Œåˆ™å–å‡ºå¯¹åº”æ§½ä½çš„elemï¼Œå¹¶ä¸”å¦‚æœelemå­˜çš„æ˜¯æŒ‡å‘elemçš„æŒ‡é’ˆæ‰è§£æŒ‡é’ˆï¼Œæœ€åè¿”å›</li>
<li>å¦‚æœæ²¡é…å¯¹åˆ™ä»matchä¸­ mask.removeFirst()æŠŠæœ€ä½ä½çš„ 1 æ¸…æ‰ï¼Œç»§ç»­éå†ç›´åˆ°å–å‡ºæˆ–ï¼Œmatchä¸ºç©º</li>
<li>å¦‚æœç¬¬äºŒä¸ªforå¾ªç¯æ²¡å–å‡ºå€¼ï¼Œä¸”å½“å‰ç»„æœ‰emptyslotï¼Œè¯´æ˜æ¢æµ‹åºåˆ—ç»“æŸï¼Œç›´æ¥è¿”å›é›¶å€¼ã€‚</li>
<li>å¦åˆ™ç»§ç»­æ‰§è¡Œç¬¬ä¸€ä¸ªforå¾ªç¯å–å‡ºæ ¹æ®æ­¥è¿›åºåˆ—å¾—å‡ºè¦æ¢æµ‹çš„ group ä½ç½®ç»§ç»­æ‰§è¡Œ 4 - 8æ“ä½œ</li>
</ol>
<pre><code class="hljs language-go" lang="go">	idx := m.directoryIndex(hash)
	t := m.directoryAt(idx)

	seq := makeProbeSeq(h1(hash), t.groups.lengthMask)
	<span class="hljs-keyword">for</span> ; ; seq = seq.next() {
		g := t.groups.group(typ, seq.offset)

		match := g.ctrls().matchH2(h2(hash))

		<span class="hljs-keyword">for</span> match != <span class="hljs-number">0</span> {
			i := match.first()

			slotKey := g.key(typ, i)
			slotKeyOrig := slotKey
			<span class="hljs-keyword">if</span> typ.IndirectKey() {
				slotKey = *((*unsafe.Pointer)(slotKey))
			}
			<span class="hljs-keyword">if</span> typ.Key.Equal(key, slotKey) {
				slotElem := unsafe.Pointer(<span class="hljs-type">uintptr</span>(slotKeyOrig) + typ.ElemOff)
				<span class="hljs-keyword">if</span> typ.IndirectElem() {
					slotElem = *((*unsafe.Pointer)(slotElem))
				}
				<span class="hljs-keyword">return</span> slotElem
			}
			match = match.removeFirst()
		}

		match = g.ctrls().matchEmpty()
		<span class="hljs-keyword">if</span> match != <span class="hljs-number">0</span> {
			<span class="hljs-keyword">return</span> unsafe.Pointer(&amp;zeroVal[<span class="hljs-number">0</span>])
		}
	}
</code></pre>
<p>æ¥ä¸‹æ¥çœ‹ä¸€ä¸‹é‡Œé¢ç”¨åˆ°çš„æ–¹æ³•çš„å®ç°é¦–å…ˆæ˜¯getWithKeySmall,è¯¥æ–¹æ³•ç”¨äº<strong>å°mapçš„keyå–å¯¹åº”çš„elem</strong></p>
<p><strong>Map.getWithKeySmall()</strong></p>
<p>é¦–å…ˆæ ¹æ®m.dirptrå°è£…äº†ä¸€ä¸ªgroupï¼Œå‰é¢ä¹Ÿæåˆ°å°mapæ— tableåªæœ‰ä¸€ä¸ªgroup</p>
<ol>
<li>å–å‡ºh2(hash)å’Œgroupçš„æ§åˆ¶å­—</li>
<li>å¼€å¯forå¾ªç¯éå†ï¼ˆç»“æŸæ¡ä»¶ï¼š1.i == SwissMapGroupSlotsï¼›2.æ‰¾åˆ°keyå¯¹åº”elemè¿”å›ï¼‰ï¼Œå…ˆå–ä½8ä½çš„ç¬¬ä¸€ä¸ªå­—èŠ‚çš„æ§åˆ¶ä½ï¼Œç„¶åå°†ctrlså³ç§»8ä½</li>
<li>å¦‚æœå–å‡ºçš„æ§åˆ¶ä½!=h2åˆ™ç»§ç»­å¾ªç¯å–ä¸‹ä¸€ä¸ªæ§åˆ¶ä½</li>
<li>å¦‚æœæ§åˆ¶ä½==h2ï¼Œé¦–å…ˆå–å‡ºindex åç§»é‡å¯¹åº”çš„slot keyï¼Œå¹¶ä¸”å½“å­˜æ”¾çš„keyä¸ºæŒ‡å‘keyæŒ‡é’ˆæ—¶è§£æŒ‡é’ˆ</li>
<li>æ¥ç€åˆ¤æ–­slot key æ˜¯å¦ç­‰äº keyï¼Œå¦‚æœç­‰äºå–å‡ºindex åç§»é‡å¯¹åº”çš„slot Elemï¼Œå¹¶ä¸”å½“å­˜æ”¾çš„Elemä¸ºæŒ‡å‘ElemæŒ‡é’ˆæ—¶è§£æŒ‡é’ˆï¼Œè¿”å›å€¼ç»“æŸï¼›å¦åˆ™ç»§ç»­forå¾ªç¯ç›´åˆ°å–å‡º</li>
<li>å¦‚æœåˆ°æœ€åè¿˜æ²¡æœ‰æ‰¾åˆ°é…å¯¹çš„å°±ç›´æ¥return false</li>
</ol>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(m *Map)</span></span> getWithKeySmall(typ *abi.SwissMapType, hash <span class="hljs-type">uintptr</span>, key unsafe.Pointer) (unsafe.Pointer, unsafe.Pointer, <span class="hljs-type">bool</span>) {
	g := groupReference{
		data: m.dirPtr,
	}
	h2 := <span class="hljs-type">uint8</span>(h2(hash))
	ctrls := *g.ctrls()
	<span class="hljs-keyword">for</span> i := <span class="hljs-type">uintptr</span>(<span class="hljs-number">0</span>); i &lt; abi.SwissMapGroupSlots; i++ {
		c := <span class="hljs-type">uint8</span>(ctrls)
		ctrls &gt;&gt;= <span class="hljs-number">8</span>
		<span class="hljs-keyword">if</span> c != h2 {
			<span class="hljs-keyword">continue</span>
		}

		slotKey := g.key(typ, i)
		<span class="hljs-keyword">if</span> typ.IndirectKey() {
			slotKey = *((*unsafe.Pointer)(slotKey))
		}

		<span class="hljs-keyword">if</span> typ.Key.Equal(key, slotKey) {
			slotElem := g.elem(typ, i)
			<span class="hljs-keyword">if</span> typ.IndirectElem() {
				slotElem = *((*unsafe.Pointer)(slotElem))
			}
			<span class="hljs-keyword">return</span> slotKey, slotElem, <span class="hljs-literal">true</span>
		}
	}
	<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, <span class="hljs-literal">nil</span>, <span class="hljs-literal">false</span>
}
</code></pre>
<p>ç„¶åæ˜¯å–tableçš„æ“ä½œï¼Œæ­¤æ—¶ä¸æ˜¯å°map
<strong>Map.directoryIndex å’Œ Map.directoryAt</strong></p>
<p>directoryIndexè´Ÿè´£è®¡ç®—tableçš„indexï¼ŒdirectoryAè´Ÿè´£å–å‡ºå¯¹åº”çš„tableçš„æŒ‡é’ˆ
directoryIndexï¼Œå¦‚æœdirLen == 1è¯´æ˜åªæœ‰ä¸€ä¸ªtableç›´æ¥è¿”å›0ï¼Œå¦åˆ™å°†hashå³ç§»globalShiftä½è¿”å›
directoryAtæ ¹æ®ä¼ è¿›æ¥çš„indexè®¡ç®—å‡ºtableçš„æŒ‡é’ˆåœ°å€ï¼Œè¿”å›</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(m *Map)</span></span> directoryIndex(hash <span class="hljs-type">uintptr</span>) <span class="hljs-type">uintptr</span> {
	<span class="hljs-keyword">if</span> m.dirLen == <span class="hljs-number">1</span> {
		<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>
	}
	<span class="hljs-keyword">return</span> hash &gt;&gt; (m.globalShift &amp; <span class="hljs-number">63</span>)
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(m *Map)</span></span> directoryAt(i <span class="hljs-type">uintptr</span>) *table {
	<span class="hljs-keyword">return</span> *(**table)(unsafe.Pointer(<span class="hljs-type">uintptr</span>(m.dirPtr) + goarch.PtrSize*i))
}
</code></pre>
<p>æ¥ç€æ˜¯å–æ¢æµ‹èµ·å§‹ä½ç½®å’Œæ¢æµ‹åºåˆ—å‡½æ•°ï¼›è®¡ç®—æ¢æµ‹èµ·å§‹ä½ç½®ä½¿ç”¨åˆ°makeProbeSeqå‡½æ•°ï¼Œåˆ©ç”¨hashå’Œgroupçš„lengthMaskæŒ‰ä½ä¸å¾—å‡ºèµ·å§‹ä½ç½®ï¼Œè®¾ç½®indexä¸º0å¹¶å°è£…ä¸ºprobeSeqè¿”å›è®¡ç®—ä¸‹ä¸€ä¸ªæ¢æµ‹ä½ç½®ç”¨åˆ°next()å‡½æ•°ï¼Œé‡‡ç”¨äºŒæ¬¡æ¢æµ‹çš„æ–¹æ³•ï¼Œæ¯æ¬¡ next()ï¼šindex++ï¼Œç„¶å offset = (offset + index) &amp; mask</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">makeProbeSeq</span><span class="hljs-params">(hash <span class="hljs-type">uintptr</span>, mask <span class="hljs-type">uint64</span>)</span></span> probeSeq {
	<span class="hljs-keyword">return</span> probeSeq{
		mask:   mask,
		offset: <span class="hljs-type">uint64</span>(hash) &amp; mask,
		index:  <span class="hljs-number">0</span>,
	}
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(s probeSeq)</span></span> next() probeSeq {
	s.index++
	s.offset = (s.offset + s.index) &amp; s.mask
	<span class="hljs-keyword">return</span> s
}
</code></pre>
<p>ç„¶åçœ‹matchH2()ç”¨æ¥åˆ¤æ–­è¯¥groupä¸­é‚£äº›slotæ˜¯å€™é€‰
<strong>ctrlGroup.matchH2()</strong></p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(g ctrlGroup)</span></span> matchH2(h <span class="hljs-type">uintptr</span>) bitset {
	<span class="hljs-keyword">return</span> ctrlGroupMatchH2(g, h)
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">ctrlGroupMatchH2</span><span class="hljs-params">(g ctrlGroup, h <span class="hljs-type">uintptr</span>)</span></span> bitset {
	v := <span class="hljs-type">uint64</span>(g) ^ (bitsetLSB * <span class="hljs-type">uint64</span>(h)) <span class="hljs-comment">// bitsetLSB = 0x0101010101010101</span>
	<span class="hljs-keyword">return</span> bitset(((v - bitsetLSB) &amp;^ v) &amp; bitsetMSB) <span class="hljs-comment">//bitsetMSB = 0x8080808080808080</span>
}
</code></pre>
<ol>
<li>bitsetLSB * h æŠŠ 8 ä½çš„ h å¤åˆ¶åˆ° 8 ä¸ªå­—èŠ‚é‡Œï¼Œä¾‹å¦‚ ï¼š hä¸º00100010ï¼Œè®¡ç®—åä¸º 0x22 22 22 22 22 22 22 22</li>
<li>g ^ ç”¨äºæŒ‰ä½å¼‚æˆ–ï¼Œ æ­¤æ—¶vä¸­æ¯ä¸ªå­—èŠ‚ä¸º 0 çš„ä½ç½®å°±è¡¨ç¤º g çš„å¯¹åº”å­—èŠ‚ ç­‰äº hï¼›ä¾‹å¦‚å‰é¢è®¡ç®—å¾—åˆ°0x22 22 22 22 22 22 22 22 gä¸º0x21 22 11 33 44 22 22 22ï¼Œåˆ™å¾—åˆ°0x03 00 33 11 66 00 00 00</li>
<li>v - bitsetLSB å°†æ¯ä¸ªå­—èŠ‚å‡ä¸€ï¼Œä¾‹å¦‚0x03 00 33 11 66 00 00 00å¾—åˆ°ï¼š0x01 FF 32 10 64 FE FE FF</li>
<li>((v - bitsetLSB) &amp;^ v) æŒ‰ä½æ¸…é™¤ï¼ˆvä¸º1çš„ä¸ºï¼Œä¼šæŠŠ(v - bitsetLSB)çš„å¯¹åº”ä½æ¸…0ï¼‰ï¼Œå¾—åˆ°0x00 ff 00 00 00 fe fe ff</li>
<li>æœ€åäºbitsetMSBæŒ‰ä½ä¸ å¾—åˆ°  0x00 80 00 00 00 80 80 80 è¿”å›éå†éœ€è¦çš„ä½å›¾</li>
</ol>
<p>matchEmpty()ç”¨æ¥åˆ¤æ–­è¯¥groupä¸­æ˜¯å¦æœ‰empty slotï¼Œæœ‰çš„è¯è¯´æ˜æ¢æµ‹ç»“æŸï¼Œåé¢æ— slot
<strong>ctrlGroup.matchEmpty()</strong></p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(g ctrlGroup)</span></span> matchEmpty() bitset {
	<span class="hljs-keyword">return</span> ctrlGroupMatchEmpty(g)
}
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">ctrlGroupMatchEmpty</span><span class="hljs-params">(g ctrlGroup)</span></span> bitset {
	<span class="hljs-comment">// An empty slot is   1000 0000</span>
	<span class="hljs-comment">// A deleted slot is  1111 1110</span>
	<span class="hljs-comment">// A full slot is     0??? ????</span>
	v := <span class="hljs-type">uint64</span>(g)
	<span class="hljs-keyword">return</span> bitset((v &amp;^ (v &lt;&lt; <span class="hljs-number">6</span>)) &amp; bitsetMSB)
}
</code></pre>
<p>goå®˜æ–¹å®šä¹‰ç¬¬ 7 ä½è¢«ç½® 1 ä¸”ç¬¬ 1 ä½æœªç½®ä½æ—¶åˆ™è¯¥slotæ˜¯ä¸€ä¸ªempty slot</p>
<ol>
<li>v &lt;&lt; 6 ä¼šæŠŠ æ¯ä¸ªå­—èŠ‚çš„ bit1ï¼ˆ0x02ï¼‰ç§»åŠ¨åˆ°è¯¥å­—èŠ‚çš„ bit7 ä½ç½®ã€‚</li>
<li>v &amp;^ (v&lt;&lt;6) ä¼šåœ¨ v çš„ bit7 ä¸Š æ¸…æ‰ é‚£äº›åŸæœ¬ bit1 ä¸º 1çš„å­—èŠ‚ã€‚</li>
<li>ç„¶åä½¿ç”¨bitsetMSB æŒ‰ä½ä¸ç¡®ä¿æ¯ä¸ªå­—èŠ‚åªä¿ç•™æœ€é«˜ä½ï¼Œæ­¤æ—¶0x80çš„å­—èŠ‚å°±æ˜¯ç©ºempty slot</li>
</ol>
<h3 data-id="heading-11">å‘mapä¸­å†™æ•°æ®</h3>
<p>é¦–å…ˆæ€»ç»“ä¸€ä¸‹mapå†™æ•°æ®çš„å¤§è‡´æµç¨‹ï¼š</p>
<ol>
<li>m == nilï¼ˆnil mapï¼‰å†™å…¥ä¼š panicï¼›è¿›å…¥å†™å‰è‹¥ m.writing != 0 ä¼š fatalã€‚</li>
<li>è®¡ç®— hash åæŠŠ m.writing ^= 1ï¼ˆé€šå¸¸ 0 -&gt; 1ï¼‰ã€‚</li>
<li>è‹¥ m.dirPtr == nilï¼Œå…ˆ growToSmall åˆ†é…é¦–ä¸ª groupã€‚</li>
<li>è‹¥ m.dirLen == 0ï¼ˆå° mapï¼‰ï¼šæœªæ»¡ï¼šç›´æ¥ small putï¼›å·²æ»¡ï¼šgrowToTable è½¬æˆ table å†èµ°å¤§ map æµç¨‹ã€‚</li>
<li>å¤§ mapï¼šæŒ‰ hash æ‰¾ tableï¼Œæ²¿ probe åºåˆ—å…ˆæ‰¾â€œåŒ keyâ€æ§½ä½ï¼ˆæ‰¾åˆ°å°±æ˜¯æ›´æ–°å¹¶è¿”å›ï¼‰ã€‚
æ²¡æ‰¾åˆ°æ—¶ï¼šé‡åˆ° empty è¡¨ç¤º probe ç»“æŸï¼›è‹¥ä¹‹å‰è®°è¿‡ deleted æ§½ä½åˆ™<strong>ä¼˜å…ˆç”¨ deletedï¼Œå¦åˆ™ç”¨ empty</strong>ï¼›è‹¥ growthLeft == 0 åˆ™ rehash å continue outer é‡è¯•ã€‚</li>
<li>è¿”å›å‰å†åšå¹¶å‘æ ¡éªŒï¼šè‹¥ m.writing == 0 åˆ™ fatalï¼Œå¦åˆ™å† ^= 1ï¼ˆ1 -&gt; 0ï¼‰æ¢å¤ã€‚</li>
</ol>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/79c821e2d0a047528479bd85387355fb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAganp6enp6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771302119&amp;x-signature=v1gviu8NNSgIEr6jVN9DWpfmkfY%3D" alt="putmap.png" width="80%" loading="lazy"/></p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">runtime_mapassign</span><span class="hljs-params">(typ *abi.SwissMapType, m *Map, key unsafe.Pointer)</span></span> unsafe.Pointer {
	<span class="hljs-keyword">if</span> m == <span class="hljs-literal">nil</span> {
		<span class="hljs-built_in">panic</span>(errNilAssign)
	}
	<span class="hljs-keyword">if</span> m.writing != <span class="hljs-number">0</span> {
		fatal(<span class="hljs-string">"concurrent map writes"</span>)
	}
	hash := typ.Hasher(key, m.seed)
	m.writing ^= <span class="hljs-number">1</span> 
	<span class="hljs-keyword">if</span> m.dirPtr == <span class="hljs-literal">nil</span> {
		m.growToSmall(typ)
	}
	<span class="hljs-keyword">if</span> m.dirLen == <span class="hljs-number">0</span> {
		<span class="hljs-keyword">if</span> m.used &lt; abi.SwissMapGroupSlots {
			elem := m.putSlotSmall(typ, hash, key)
			<span class="hljs-keyword">if</span> m.writing == <span class="hljs-number">0</span> {
				fatal(<span class="hljs-string">"concurrent map writes"</span>)
			}
			m.writing ^= <span class="hljs-number">1</span>
			<span class="hljs-keyword">return</span> elem
		}
		m.growToTable(typ)
	}
	<span class="hljs-keyword">var</span> slotElem unsafe.Pointer
outer:
	<span class="hljs-keyword">for</span> {
		idx := m.directoryIndex(hash)
		t := m.directoryAt(idx)
		seq := makeProbeSeq(h1(hash), t.groups.lengthMask)
		<span class="hljs-keyword">var</span> firstDeletedGroup groupReference
		<span class="hljs-keyword">var</span> firstDeletedSlot <span class="hljs-type">uintptr</span>

		<span class="hljs-keyword">for</span> ; ; seq = seq.next() {
			g := t.groups.group(typ, seq.offset)
			match := g.ctrls().matchH2(h2(hash))
			<span class="hljs-keyword">for</span> match != <span class="hljs-number">0</span> {
				i := match.first()
				slotKey := g.key(typ, i)
				slotKeyOrig := slotKey
				<span class="hljs-keyword">if</span> typ.IndirectKey() {
					slotKey = *((*unsafe.Pointer)(slotKey))
				}
				<span class="hljs-keyword">if</span> typ.Key.Equal(key, slotKey) {
					<span class="hljs-keyword">if</span> typ.NeedKeyUpdate() {
						typedmemmove(typ.Key, slotKey, key)
					}
					slotElem = unsafe.Pointer(<span class="hljs-type">uintptr</span>(slotKeyOrig) + typ.ElemOff)
					<span class="hljs-keyword">if</span> typ.IndirectElem() {
						slotElem = *((*unsafe.Pointer)(slotElem))
					}
					t.checkInvariants(typ, m)
					<span class="hljs-keyword">break</span> outer
				}
				match = match.removeFirst()
			}
			match = g.ctrls().matchEmpty()
			<span class="hljs-keyword">if</span> match != <span class="hljs-number">0</span> {
				<span class="hljs-keyword">var</span> i <span class="hljs-type">uintptr</span>
				<span class="hljs-keyword">if</span> firstDeletedGroup.data != <span class="hljs-literal">nil</span> {
					g = firstDeletedGroup
					i = firstDeletedSlot
					t.growthLeft++ 
				} <span class="hljs-keyword">else</span> {
					i = match.first()
				}
				<span class="hljs-keyword">if</span> t.growthLeft &gt; <span class="hljs-number">0</span> {
					slotKey := g.key(typ, i)
					slotKeyOrig := slotKey
					<span class="hljs-keyword">if</span> typ.IndirectKey() {
						kmem := newobject(typ.Key)
						*(*unsafe.Pointer)(slotKey) = kmem
						slotKey = kmem
					}
					typedmemmove(typ.Key, slotKey, key)

					slotElem = unsafe.Pointer(<span class="hljs-type">uintptr</span>(slotKeyOrig) + typ.ElemOff)
					<span class="hljs-keyword">if</span> typ.IndirectElem() {
						emem := newobject(typ.Elem)
						*(*unsafe.Pointer)(slotElem) = emem
						slotElem = emem
					}
					g.ctrls().set(i, ctrl(h2(hash)))
					t.growthLeft--
					t.used++
					m.used++

					t.checkInvariants(typ, m)
					<span class="hljs-keyword">break</span> outer
				}
				t.rehash(typ, m)
				<span class="hljs-keyword">continue</span> outer
			}
			<span class="hljs-keyword">if</span> firstDeletedGroup.data == <span class="hljs-literal">nil</span> {
				match = g.ctrls().matchEmptyOrDeleted()
				<span class="hljs-keyword">if</span> match != <span class="hljs-number">0</span> {
					firstDeletedGroup = g
					firstDeletedSlot = match.first()
				}
			}
		}
	}

	<span class="hljs-keyword">if</span> m.writing == <span class="hljs-number">0</span> {
		fatal(<span class="hljs-string">"concurrent map writes"</span>)
	}
	m.writing ^= <span class="hljs-number">1</span>
	<span class="hljs-keyword">return</span> slotElem
}
</code></pre>
<p>è¯¥æ–¹æ³•è¾ƒé•¿åˆ†ä¸ºå‡ æ­¥æ¥è¿›è¡Œé˜è¿°</p>
<p><strong>step1:</strong></p>
<p>å‘æœªåˆå§‹åŒ– mapå†™å…¥ä¼španicï¼›å¦‚æœè¯¥mapæ­¤æ—¶è¢«å…¶ä»–åç¨‹å†™åˆ™fatal
å¦‚æœæ­¤æ—¶å·²åˆå§‹åŒ–ä¸”æ²¡æœ‰å…¶ä»–åç¨‹å†™åˆ™è®¡ç®—hashå¹¶å°†writingä¸1åšå¼‚æˆ–ï¼ˆm.writing ^= 1ï¼ˆ 0 -&gt; 1ï¼‰ï¼‰</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">if</span> m == <span class="hljs-literal">nil</span> {
		<span class="hljs-built_in">panic</span>(errNilAssign)
	}

	<span class="hljs-keyword">if</span> m.writing != <span class="hljs-number">0</span> {
		fatal(<span class="hljs-string">"concurrent map writes"</span>)
	}
	hash := typ.Hasher(key, m.seed)
	m.writing ^= <span class="hljs-number">1</span> 
</code></pre>
<p><strong>step2:</strong></p>
<ol>
<li>è‹¥dirpträ¸ºnilæ­¤æ—¶mapè¿˜æœªåˆ†é…groupï¼Œè°ƒç”¨growToSmallåˆå§‹åŒ–ä¸€ä¸ªgroupä¾›mapä½¿ç”¨</li>
<li>è‹¥dirLenä¸º0åˆ™ä»¥ä¸ºç€è¯¥mapä¸ºå°mapï¼Œæ­¤æ—¶æœ‰ä¸¤ç§æƒ…å†µ1ï¼šå½“å‰å°mapæœªå¡«æ»¡åˆ™è¿›å…¥putæµç¨‹ï¼›2ï¼šå°mapå¡«æ»¡äº†æ­¤æ—¶å°†å°mapæ‰©å®¹ï¼Œåˆ›å»ºä¸€ä¸ªtableä¾›å½“å‰mapä½¿ç”¨</li>
<li>put æˆåŠŸè¿”å›å‰å†æ£€æŸ¥ï¼šå¦‚æœ m.writing == 0 åˆ™ fatalï¼ˆè¯´æ˜è¢«å…¶ä»–åç¨‹å¹¶å‘å†™ä¿®æ”¹ï¼‰ï¼›å¦åˆ™å† ï¼ˆm.writing ^= 1ï¼ˆ 1 -&gt; 0ï¼‰ï¼‰å†è¿”å›ã€‚</li>
</ol>
<pre><code class="hljs language-go" lang="go">	<span class="hljs-keyword">if</span> m.dirPtr == <span class="hljs-literal">nil</span> {
		m.growToSmall(typ)
	}

	<span class="hljs-keyword">if</span> m.dirLen == <span class="hljs-number">0</span> {
		<span class="hljs-keyword">if</span> m.used &lt; abi.SwissMapGroupSlots {
			elem := m.putSlotSmall(typ, hash, key)

			<span class="hljs-keyword">if</span> m.writing == <span class="hljs-number">0</span> {
				fatal(<span class="hljs-string">"concurrent map writes"</span>)
			}
			m.writing ^= <span class="hljs-number">1</span>

			<span class="hljs-keyword">return</span> elem
		}
		m.growToTable(typ)
	}
</code></pre>
<p><strong>step3ï¼š</strong> åœ¨å‰é¢æ²¡æœ‰è¿”å›è¯´æ˜ä¸æ˜¯å°mapï¼Œæˆ–è€…å°mapè¢«å¡«æ»¡è§¦å‘æ‰©å®¹äº†ï¼Œè¿›å…¥ä¸‹é¢çš„outer æ ‡ç­¾çš„ forå¾ªç¯</p>
<ol>
<li>å…ˆç”¨ hash è®¡ç®—ç›®å½•ç´¢å¼•æ‹¿åˆ° tableï¼Œå†å¾—åˆ° probe åºåˆ—å’Œèµ·å§‹ groupã€‚</li>
</ol>
<pre><code class="hljs language-go" lang="go">	<span class="hljs-keyword">var</span> slotElem unsafe.Pointer
outer:
	<span class="hljs-keyword">for</span> {
		idx := m.directoryIndex(hash)
		t := m.directoryAt(idx)
		seq := makeProbeSeq(h1(hash), t.groups.lengthMask)
		<span class="hljs-keyword">var</span> firstDeletedGroup groupReference <span class="hljs-comment">//ç¬¬ä¸€ä¸ªå­˜åœ¨åˆ é™¤slotçš„group</span>
		<span class="hljs-keyword">var</span> firstDeletedSlot <span class="hljs-type">uintptr</span> <span class="hljs-comment">//ç¬¬ä¸€ä¸ªè¢«åˆ é™¤çš„slot</span>
		<span class="hljs-comment">//..</span>
	}
</code></pre>
<p><strong>step4:</strong></p>
<ol>
<li>è¿›å…¥å†…å±‚for æŒ‰ probe åºåˆ—ç»§ç»­æ¢æµ‹ï¼ˆä¸å‰é¢è¯»è·¯å¾„ç›¸ä¼¼ï¼‰ã€‚</li>
<li>å†…å±‚forå¾ªç¯é‡Œï¼Œé¦–å…ˆè·å¾—èµ·å§‹groupç„¶åæ ¹æ®h2(hash)ä¸æ§åˆ¶å­—åŒ¹é…ï¼Œå¾—åˆ°ä½å›¾ï¼ˆå“ªäº› slot çš„ h2 åŒ¹é…ï¼‰ï¼›ï¼ˆä¸å‰é¢è¯»è·¯å¾„ç›¸ä¼¼ï¼‰ã€‚</li>
<li>å¦‚æœè¯¥groupæœ‰ä¸h2åŒ¹é…çš„slotåˆ™ï¼šé¦–å…ˆå–å¾—ç¬¬ä¸€ä¸ªåŒ¹é…çš„keyï¼Œå€˜è‹¥æ˜¯æŒ‡å‘keyçš„æŒ‡é’ˆçš„åˆ™è§£å¼•ç”¨ï¼›å€˜è‹¥ä¸å­˜åœ¨ä¸è¿›å…¥for match != 0 å¾ªç¯</li>
<li>åˆ¤æ–­ä¸ä¼ å…¥çš„keyæ˜¯å¦equalï¼šequalåˆ™åˆ¤æ–­æ˜¯å¦éœ€è¦æ›´æ–°keyéœ€è¦çš„è¯ç›´æ¥åŸºäºtypedmemmoveå°†keyèµ‹ç»™slotkeyï¼Œä¸éœ€è¦è¿›å…¥å–elemï¼ˆå€˜è‹¥æ˜¯æŒ‡å‘elemçš„æŒ‡é’ˆçš„åˆ™è§£å¼•ç”¨ï¼‰å¹¶å¤åˆ¶ç»™slotElemï¼Œç›´æ¥ç»“æŸouterå¾ªç¯ï¼›</li>
<li>è‹¥ä¸equalåˆ™å–ä¸‹ä¸€ä¸ªä¸h2åŒ¹é…çš„keyï¼›ç›´åˆ°è¯¥groupæ²¡æœ‰ä¸h2åŒ¹é…çš„slot</li>
</ol>
<pre><code class="hljs language-go" lang="go">	<span class="hljs-comment">//..</span>
	<span class="hljs-keyword">for</span> ; ; seq = seq.next() {
			g := t.groups.group(typ, seq.offset)
			match := g.ctrls().matchH2(h2(hash))
			<span class="hljs-comment">// Look for an existing slot containing this key.</span>
			<span class="hljs-keyword">for</span> match != <span class="hljs-number">0</span> {
				i := match.first()

				slotKey := g.key(typ, i)
				slotKeyOrig := slotKey
				<span class="hljs-keyword">if</span> typ.IndirectKey() {
					slotKey = *((*unsafe.Pointer)(slotKey))
				}
				<span class="hljs-keyword">if</span> typ.Key.Equal(key, slotKey) {
					<span class="hljs-keyword">if</span> typ.NeedKeyUpdate() {
						typedmemmove(typ.Key, slotKey, key)
					}

					slotElem = unsafe.Pointer(<span class="hljs-type">uintptr</span>(slotKeyOrig) + typ.ElemOff)
					<span class="hljs-keyword">if</span> typ.IndirectElem() {
						slotElem = *((*unsafe.Pointer)(slotElem))
					}

					t.checkInvariants(typ, m)
					<span class="hljs-keyword">break</span> outer
				}
				match = match.removeFirst()
			}
			<span class="hljs-comment">//..</span>
	}
</code></pre>
<p><strong>step5:</strong></p>
<p>æ­¤æ—¶è¯¥groupæ²¡æœ‰åŒ¹é…åˆ°keyå¯¹åº”çš„slot</p>
<ol>
<li>å–å‡ºå½“å‰groupçš„ç©ºslotï¼Œè‹¥æ²¡æœ‰åˆ™ä¸è¿›å…¥</li>
<li>å€˜è‹¥æœ‰ç©ºslotï¼ˆè¯´æ˜æ¢æµ‹åºåˆ—è¦ç»“æŸäº†ï¼‰ï¼Œé¦–å…ˆæŸ¥çœ‹firstDeletedGroupæ˜¯å¦ä¸ºç©ºï¼Œä¸ä¸ºç©ºè¯´æ˜å·²ç»æ‰¾åˆ°ç¬¬ä¸€ä¸ªåˆ é™¤çš„slotå’Œå¯¹åº”å¾—Groupå¹¶å°†t.growthLeft++ï¼Œå¦åˆ™å–å‡ºå½“å‰groupä¸­ç¬¬ä¸€ä½ç©ºçš„slot</li>
<li>æ¥ç€åˆ¤æ–­å½“å‰t.growthLeftæ˜¯å¦å¤§äº0.å¤§äº0åˆ™è¯´æ˜å¯ç›´æ¥æ’å…¥æ— éœ€æ‰©å®¹ï¼Œå¦åˆ™è¯´æ˜å½“å‰tableéœ€è¦æ‰©å®¹æ‰èƒ½ç»§ç»­æ’å…¥</li>
<li>å€˜è‹¥å¯ç›´æ¥æ’å…¥å–å‡ºç©ºslotçš„åœ°å€ï¼Œå¦‚æœ key æ˜¯é—´æ¥å­˜å‚¨ï¼ˆæ§½é‡Œæ”¾æŒ‡é’ˆï¼‰ï¼Œé¦–å…ˆåˆ†é…ç»™keyå†…å­˜ï¼ŒæŠŠæŒ‡é’ˆå†™è¿›æ§½ä½ï¼Œæ¥ç€æŠŠä¼ å…¥ key æ‹·è´åˆ°æœ€ç»ˆ key å­˜å‚¨ä½ç½®ã€‚</li>
<li>ç”¨æ§½ä½åŸå§‹åœ°å€ + åç§»ï¼Œå®šä½åˆ°è¯¥æ§½ä½çš„ elem å­—æ®µã€‚å¦‚æœ elem ä¹Ÿé—´æ¥å­˜å‚¨ï¼Œå°±åˆ†é… elem å†…å­˜ï¼ŒæŠŠæŒ‡é’ˆå†™è¿›æ§½ä½ï¼Œå¹¶è®© slotElem æŒ‡å‘æ–°å†…å­˜ã€‚</li>
<li>å°†æ§åˆ¶ä½å†™å…¥gçš„æ§åˆ¶å­—å¹¶ä¸”å°†gå’Œtçš„used++ï¼Œå°†t.growthLeft--ï¼Œ è°ƒç”¨checkInvariantsï¼Œç»“æŸouterå¾ªç¯</li>
<li>å€˜è‹¥å½“å‰æ’å…¥éœ€è¦rehashåˆ™rehash åé‡è¯•outer forå¾ªç¯</li>
</ol>
<pre><code class="hljs language-go" lang="go">		<span class="hljs-comment">//..</span>
		match = g.ctrls().matchEmpty()
		<span class="hljs-keyword">if</span> match != <span class="hljs-number">0</span> {
			<span class="hljs-keyword">var</span> i <span class="hljs-type">uintptr</span>
			<span class="hljs-keyword">if</span> firstDeletedGroup.data != <span class="hljs-literal">nil</span> {
				g = firstDeletedGroup
				i = firstDeletedSlot
				t.growthLeft++ <span class="hljs-comment">// will be decremented below tobecome a no-op.</span>
			} <span class="hljs-keyword">else</span> {
				<span class="hljs-comment">// Otherwise, use the empty slot.</span>
				i = match.first()
			}
			<span class="hljs-keyword">if</span> t.growthLeft &gt; <span class="hljs-number">0</span> {
				slotKey := g.key(typ, i)
				slotKeyOrig := slotKey
				<span class="hljs-keyword">if</span> typ.IndirectKey() {
					kmem := newobject(typ.Key)
					*(*unsafe.Pointer)(slotKey) = kmem
					slotKey = kmem
				}
				typedmemmove(typ.Key, slotKey, key)
				slotElem = unsafe.Pointer(<span class="hljs-type">uintptr</span>(slotKeyOrig) + typElemOff)
				<span class="hljs-keyword">if</span> typ.IndirectElem() {
					emem := newobject(typ.Elem)
					*(*unsafe.Pointer)(slotElem) = emem
					slotElem = emem
				}
				g.ctrls().set(i, ctrl(h2(hash)))
				t.growthLeft--
				t.used++
				m.used++
				t.checkInvariants(typ, m)
				<span class="hljs-keyword">break</span> outer
			}
			t.rehash(typ, m)
			<span class="hljs-keyword">continue</span> outer
		}
			
</code></pre>
<p><strong>step6:</strong>
æ­¤æ—¶è¯¥groupæ²¡æœ‰é…å¯¹çš„keyä¹Ÿæ²¡æœ‰ç»“æŸæ¢å¯»</p>
<ol>
<li>å¦‚æœæ­¤æ—¶æ²¡æœ‰æ‰¾åˆ°ç¬¬ä¸€ä¸ªå­˜åœ¨åˆ é™¤çš„groupï¼Œåˆ™æ£€æŸ¥å½“å‰groupæ˜¯å¦å­˜åœ¨è¢«åˆ é™¤å¾—slotï¼Œå­˜åœ¨çš„è¯åˆ™è¿›è¡Œèµ‹å€¼ï¼Œä¸å­˜åœ¨åˆ™ç»§ç»­æ¢æµ‹åºåˆ—å¾ªç¯</li>
</ol>
<pre><code class="hljs language-go" lang="go">			<span class="hljs-keyword">if</span> firstDeletedGroup.data == <span class="hljs-literal">nil</span> {
				match = g.ctrls().matchEmptyOrDeleted()
				<span class="hljs-keyword">if</span> match != <span class="hljs-number">0</span> {
					firstDeletedGroup = g
					firstDeletedSlot = match.first()
				}
			}
</code></pre>
<p><strong>step7:</strong>
æ­¤æ—¶æ‰¾åˆ°å¯ä»¥å†™å…¥çš„ä½ç½®</p>
<ol>
<li>å…ˆæ£€æŸ¥ï¼šå¦‚æœ m.writing == 0 åˆ™ fatalï¼ˆè¯´æ˜è¢«å…¶ä»–åç¨‹å¹¶å‘å†™ä¿®æ”¹ï¼‰ï¼›å¦åˆ™å† ï¼ˆm.writing ^= 1ï¼ˆ 1 -&gt; 0ï¼‰ï¼‰å†è¿”å›slotElemã€‚</li>
</ol>
<pre><code class="hljs language-go" lang="go">	<span class="hljs-keyword">if</span> m.writing == <span class="hljs-number">0</span> {
		fatal(<span class="hljs-string">"concurrent map writes"</span>)
	}
	m.writing ^= <span class="hljs-number">1</span>
	<span class="hljs-keyword">return</span> slotElem
</code></pre>
<p>å†™å…¥æ“ä½œç»“æŸï¼Œæ¥ä¸‹æ¥é˜è¿°å…¶ä¸­ç”¨åˆ°çš„å…³é”®æ–¹æ³•ï¼š</p>
<p><strong>Map.growToSmall()</strong></p>
<p>è¯¥æ–¹æ³•ç”¨äºå° map è·¯å¾„ä¸‹é¦–æ¬¡ä¸º m åˆ†é…å­˜å‚¨</p>
<ol>
<li>åˆ›å»ºä¸€ä¸ªåŒ…å«ä¸€ä¸ªgroupçš„groupsReferenceï¼Œå°†mçš„dirPtræŒ‡å‘è¯¥groupçš„åœ°å€,å¹¶å°†æ§åˆ¶ä½å…¨éƒ¨ç½®ä¸º emptyã€‚</li>
</ol>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(m *Map)</span></span> growToSmall(typ *abi.SwissMapType) {
	grp := newGroups(typ, <span class="hljs-number">1</span>)
	m.dirPtr = grp.data

	g := groupReference{
		data: m.dirPtr,
	}
	g.ctrls().setEmpty()
}
</code></pre>
<p><strong>Map.putSlotSmall()</strong>
è¯¥æ–¹æ³•ç”¨äºå‘å°mapå†™å…¥æ•°æ®ï¼Œè¯¥æ–¹æ³•ä¸»è¦æœ‰ä¸¤ä¸ªæµç¨‹</p>
<p>ç¬¬ä¸€æ­¥ï¼šå½“å‰groupæœ‰ä¸h2åŒ¹é…çš„slot</p>
<ol>
<li>é¦–å…ˆå°è£…ä¸€ä¸ªgroupæŒ‡å‘å½“å‰mçš„groupçš„åœ°å€</li>
<li>åœ¨å½“å‰groupå¾—åˆ°æ§åˆ¶ä½ä¸h2(hash)åŒ¹é…çš„ä½å›¾</li>
<li>å¦‚æœæœ‰åŒ¹é…çš„ï¼Œåˆ™é¦–å…ˆå–å¾—ç¬¬ä¸€ä¸ªåŒ¹é…çš„keyï¼Œå€˜è‹¥æ˜¯æŒ‡å‘keyçš„æŒ‡é’ˆçš„åˆ™è§£å¼•ç”¨ï¼›å€˜è‹¥ä¸å­˜åœ¨ä¸è¿›å…¥for match != 0 å¾ªç¯</li>
<li>åˆ¤æ–­ä¸ä¼ å…¥çš„keyæ˜¯å¦equalï¼šequalåˆ™åˆ¤æ–­æ˜¯å¦éœ€è¦æ›´æ–°keyéœ€è¦çš„è¯ç›´æ¥åŸºäºtypedmemmoveå°†keyèµ‹ç»™slotkeyï¼Œä¸éœ€è¦è¿›å…¥å–elemï¼ˆå¦‚æœelemå­˜æ”¾çš„æ˜¯æŒ‡å‘elemçš„æŒ‡é’ˆåˆ™è§£å¼•ç”¨ï¼‰å¹¶å¤åˆ¶ç»™slotElemï¼Œè¿”å› slotelemï¼›</li>
<li>è‹¥ä¸equalåˆ™å–ä¸‹ä¸€ä¸ªä¸h2åŒ¹é…çš„keyï¼›ç›´åˆ°è¯¥groupæ²¡æœ‰ä¸h2åŒ¹é…çš„slot</li>
</ol>
<p>ç¬¬äºŒæ­¥ï¼šå½“å‰groupæ²¡æœ‰ä¸h2åŒ¹é…çš„slot</p>
<ol start="6">
<li>å¦‚æœå½“å‰groupæ²¡åŒ¹é…çš„slotåˆ™è·å–ä¸ºç©ºorå·²åˆ é™¤çš„slotä½å›¾</li>
<li>å¦‚æœä½å›¾ä¸ºç©ºåˆ™fatalï¼ˆå› ä¸ºåœ¨è¿›å…¥è¯¥å‡½æ•°å‰ç¡®ä¿äº†å­˜åœ¨ä½ç½®ä¾›æ’å…¥ï¼‰</li>
<li>å¦åˆ™å–ç¬¬ä¸€ä¸ªslotï¼Œå¦‚æœ key æ˜¯é—´æ¥å­˜å‚¨ï¼ˆæ§½é‡Œæ”¾æŒ‡é’ˆï¼‰ï¼Œé¦–å…ˆåˆ†é…ç»™keyå†…å­˜ï¼ŒæŠŠæŒ‡é’ˆå†™è¿›æ§½ä½ï¼Œæ¥ç€æŠŠä¼ å…¥ key æ‹·è´åˆ°æœ€ç»ˆ key å­˜å‚¨ä½ç½®ã€‚</li>
<li>ç”¨æ§½ä½åŸå§‹åœ°å€ + åç§»ï¼Œå®šä½åˆ°è¯¥æ§½ä½çš„ elem å­—æ®µã€‚å¦‚æœ elem ä¹Ÿé—´æ¥å­˜å‚¨ï¼Œå°±åˆ†é… elem å†…å­˜ï¼ŒæŠŠæŒ‡é’ˆå†™è¿›æ§½ä½ï¼Œå¹¶è®© slotElem æŒ‡å‘æ–°å†…å­˜</li>
<li>æœ€åå°†æ§åˆ¶ä½å†™å…¥h2(hash)ï¼Œm.used++å¹¶ä¸”è¿”å›slotElem</li>
</ol>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(m *Map)</span></span> putSlotSmall(typ *abi.SwissMapType, hash <span class="hljs-type">uintptr</span>, key unsafe.Pointer) unsafe.Pointer {
	g := groupReference{
		data: m.dirPtr,
	}
	match := g.ctrls().matchH2(h2(hash))
	<span class="hljs-keyword">for</span> match != <span class="hljs-number">0</span> {
		i := match.first()
		slotKey := g.key(typ, i)
		<span class="hljs-keyword">if</span> typ.IndirectKey() {
			slotKey = *((*unsafe.Pointer)(slotKey))
		}
		<span class="hljs-keyword">if</span> typ.Key.Equal(key, slotKey) {
			<span class="hljs-keyword">if</span> typ.NeedKeyUpdate() {
				typedmemmove(typ.Key, slotKey, key)
			}
			slotElem := g.elem(typ, i)
			<span class="hljs-keyword">if</span> typ.IndirectElem() {
				slotElem = *((*unsafe.Pointer)(slotElem))
			}
			<span class="hljs-keyword">return</span> slotElem
		}
		match = match.removeFirst()
	}
	match = g.ctrls().matchEmptyOrDeleted()
	<span class="hljs-keyword">if</span> match == <span class="hljs-number">0</span> {
		fatal(<span class="hljs-string">"small map with no empty slot (concurrent map writes?)"</span>)
		<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
	}
	i := match.first()
	slotKey := g.key(typ, i)
	<span class="hljs-keyword">if</span> typ.IndirectKey() {
		kmem := newobject(typ.Key)
		*(*unsafe.Pointer)(slotKey) = kmem
		slotKey = kmem
	}
	typedmemmove(typ.Key, slotKey, key)

	slotElem := g.elem(typ, i)
	<span class="hljs-keyword">if</span> typ.IndirectElem() {
		emem := newobject(typ.Elem)
		*(*unsafe.Pointer)(slotElem) = emem
		slotElem = emem
	}
	g.ctrls().set(i, ctrl(h2(hash)))
	m.used++
	<span class="hljs-keyword">return</span> slotElem
}
</code></pre>
<p><strong>table.checkInvariants()</strong> table çš„è°ƒè¯•è‡ªæ£€å‡½æ•°ï¼ˆåªåœ¨ debugLog=true æ—¶è¿è¡Œï¼‰ï¼Œç”¨æ¥éªŒè¯å“ˆå¸Œè¡¨å†…éƒ¨çŠ¶æ€æ²¡åã€‚</p>
<h3 data-id="heading-12">mapæ‰©å®¹</h3>
<p>ç®€è¿°æ‰©å®¹çš„æµç¨‹ï¼š
å°mapçš„æ‰©å®¹ï¼šç›´æ¥åˆ›å»ºä¸€ä¸ª2 * SwissMapGroupSlotsçš„tableï¼Œå°†éç©ºæ—§slotæ’å…¥æ–°tableï¼ŒåŠ å…¥åˆ°mçš„ç›®å½•é‡Œ</p>
<p>å¤§mapçš„æ‰©å®¹ï¼š
é¦–å…ˆæ–°å®¹é‡è®¾ä¸ºæ—§å®¹é‡çš„2å€ï¼Œå¦‚æœ æ–°å®¹é‡ä¸å¤§äºmaxTableCapacityåˆ™æ ¹æ®æ–°å®¹é‡åˆ›å»ºä¸€ä¸ªtableï¼Œå°†éç©ºæ—§slotæ’å…¥æ–°tableï¼ŒåŠ å…¥åˆ°mçš„ç›®å½•é‡Œï¼Œå¹¶å°†æ—§tableçš„è®¾ä¸ºå¼ƒç”¨ï¼›</p>
<p>å¦‚æœæ–°å®¹é‡è¶…é™åˆ¶åˆ™å°†tableåˆ†ä¸ºä¸¤ä¸ªå®¹é‡ä¸ºmaxTableCapacityçš„tableï¼Œå¹¶å°†éç©ºæ—§slotæ ¹æ®hashæ’å…¥åˆ†åˆ«ä¸¤ä¸ªtable,å¹¶ä¸”æ ¹æ®tableçš„localDepthå’Œmçš„globalDepthå†³å®šå¯¹ç›®å½•çš„æ“ä½œæœ€åå°†tableåŠ å…¥åˆ°mçš„ç›®å½•é¡¹ï¼›</p>
<p><strong>åŸºäºextendible hashing çš„å¢é‡æ‰©å®¹</strong></p>
<ol>
<li>ç›®å½•ï¼ˆglobalDepthï¼‰è´Ÿè´£æŠŠ key è·¯ç”±åˆ°æŸä¸ª tableã€‚</li>
<li>æ¯ä¸ª table æœ‰è‡ªå·±çš„ localDepthã€‚</li>
<li>å†™å…¥å†²çªæ—¶ï¼Œåªæ‰©å‘½ä¸­çš„é‚£ä¸€ä¸ª tableï¼šgrow æˆ– splitã€‚</li>
<li>å¦‚æœè¯¥ table çš„ localDepth == globalDepthï¼Œå…ˆæŠŠç›®å½•ç¿»å€ï¼Œå† split è¿™ä¸ª tableã€‚</li>
<li>å…¶ä»– table ä¸æ¬è¿ï¼Œåç»­å†æŒ‰éœ€æ‰©ã€‚</li>
</ol>
<h4 data-id="heading-13">å°å®¹é‡mapæ‰©å®¹</h4>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/774436b68dcf4577af1458a659ac96a4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAganp6enp6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771302119&amp;x-signature=44iFnpRVCzsiY35QBf4H6a2hQ9U%3D" alt="å°mapæ‰©å®¹.png" loading="lazy"/></p>
<p>è¯¥æ–¹æ³•ç”¨äºå°mapæ’å…¥slotæ—¶æ‰©å®¹ä½¿ç”¨ï¼Œ</p>
<ol>
<li>é¦–å…ˆåˆ›å»ºä¸€ä¸ªå®¹é‡ä¸º2ä¸ªgroupæ•°é‡æ§½ä½çš„table</li>
<li>å°è£…ä¸€ä¸ªgroupæŒ‡å‘å½“å‰mçš„groupçš„åœ°å€</li>
<li>ç´§æ¥ç€å¼€å¯å¾ªç¯å¤„ç†groupä¸­çš„slotï¼Œå¦‚æœé‡åˆ°empty slotåˆ™continue,å¯¹éç©ºæ§½ä½å–å‡º key/elemï¼Œé‡æ–°ç®— hash åæ’å…¥æ–° table</li>
<li>å¤„ç†å®Œå½“å‰mçš„slotï¼Œå¯¹mçš„è¿›è¡Œé‡æ–°èµ‹å€¼ï¼Œç»“æŸï¼Œè¿›å…¥å¤§mapè·¯å¾„</li>
</ol>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(m *Map)</span></span> growToTable(typ *abi.SwissMapType) {
	tab := newTable(typ, <span class="hljs-number">2</span>*abi.SwissMapGroupSlots, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>)
	g := groupReference{
		data: m.dirPtr,
	}
	<span class="hljs-keyword">for</span> i := <span class="hljs-type">uintptr</span>(<span class="hljs-number">0</span>); i &lt; abi.SwissMapGroupSlots; i++ {
		<span class="hljs-keyword">if</span> (g.ctrls().get(i) &amp; ctrlEmpty) == ctrlEmpty {
			<span class="hljs-keyword">continue</span>
		}
		key := g.key(typ, i)
		<span class="hljs-keyword">if</span> typ.IndirectKey() {
			key = *((*unsafe.Pointer)(key))
		}
		elem := g.elem(typ, i)
		<span class="hljs-keyword">if</span> typ.IndirectElem() {
			elem = *((*unsafe.Pointer)(elem))
		}
		hash := typ.Hasher(key, m.seed)
		tab.uncheckedPutSlot(typ, hash, key, elem)
	}
	directory := <span class="hljs-built_in">make</span>([]*table, <span class="hljs-number">1</span>)
	directory[<span class="hljs-number">0</span>] = tab
	m.dirPtr = unsafe.Pointer(&amp;directory[<span class="hljs-number">0</span>])
	m.dirLen = <span class="hljs-built_in">len</span>(directory)
	m.globalDepth = <span class="hljs-number">0</span>
	m.globalShift = depthToShift(m.globalDepth)
}
</code></pre>
<p>æ¥ç€çœ‹å¯¹å°mapæ‰©å®¹çš„æ—¶å€™slotæ˜¯æ€ä¹ˆæ’å…¥åˆ°æ–°tableçš„</p>
<p><strong>table.uncheckedPutSlot()</strong></p>
<ol>
<li>å¦‚æœtableçš„growthLeftä¸º0 è¿ååˆ™ç›´æ¥panic</li>
<li>é¦–å…ˆä¹Ÿæ˜¯è·å–æ¢æµ‹åºåˆ—å’Œèµ·å§‹groupï¼Œå¹¶è¿›å…¥æ¢æµ‹è¿­ä»£</li>
<li>åœ¨å¾ªç¯é‡Œï¼Œé¦–å…ˆè·å¾—groupçš„ç©ºæˆ–è€…å·²ç»åˆ é™¤çš„slotçš„ä½å›¾ï¼ˆä½†å®˜æ–¹è§„å®šè¯¥å‡½æ•°è¦æ±‚tableä¸­ä¸å­˜åœ¨å·²åˆ é™¤çš„slotï¼Œæ‰€ä»¥å¤§æ¦‚ç‡å†™å…¥empty slotï¼‰</li>
<li>å¦‚æœæœ‰åˆ™å–ç¬¬ä¸€ä¸ªslotï¼Œå¹¶æ‹¿åˆ°ç¬¬ i æ§½ä½çš„ key å­—æ®µåœ°å€ï¼Œtyp.IndirectKey() ä¸ºçœŸï¼šæ§½ä½é‡Œå­˜â€œæŒ‡é’ˆâ€ï¼Œç›´æ¥æŠŠ key æŒ‡é’ˆå†™è¿›å»ï¼›å¦åˆ™typedmemmove æŠŠ key å†…å®¹æ‹·è´è¿›æ§½ä½ï¼› elemåŒç†</li>
<li>å†™å…¥è¿‡åt.growthLeft--ï¼Œt.used++å¹¶å°†è¯¥groupçš„æ§åˆ¶ä½å†™å…¥å½“å‰keyçš„h2ï¼ˆhashï¼‰è¿”å›</li>
<li>å¦‚æœå½“å‰groupä¸å­˜åœ¨å·²åˆ é™¤æˆ–è€…ç©ºslotåˆ™å»ä¸‹ä¸€ä¸ªæ¢æµ‹ä½ç½®çš„group</li>
</ol>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(t *table)</span></span> uncheckedPutSlot(typ *abi.SwissMapType, hash <span class="hljs-type">uintptr</span>, key, elem unsafe.Pointer) {
	<span class="hljs-keyword">if</span> t.growthLeft == <span class="hljs-number">0</span> {
		<span class="hljs-built_in">panic</span>(<span class="hljs-string">"invariant failed: growthLeft is unexpectedly 0"</span>)
	}
	seq := makeProbeSeq(h1(hash), t.groups.lengthMask)
	<span class="hljs-keyword">for</span> ; ; seq = seq.next() {
		g := t.groups.group(typ, seq.offset)

		match := g.ctrls().matchEmptyOrDeleted()
		<span class="hljs-keyword">if</span> match != <span class="hljs-number">0</span> {
			i := match.first()

			slotKey := g.key(typ, i)
			<span class="hljs-keyword">if</span> typ.IndirectKey() {
				*(*unsafe.Pointer)(slotKey) = key
			} <span class="hljs-keyword">else</span> {
				typedmemmove(typ.Key, slotKey, key)
			}

			slotElem := g.elem(typ, i)
			<span class="hljs-keyword">if</span> typ.IndirectElem() {
				*(*unsafe.Pointer)(slotElem) = elem
			} <span class="hljs-keyword">else</span> {
				typedmemmove(typ.Elem, slotElem, elem)
			}

			t.growthLeft--
			t.used++
			g.ctrls().set(i, ctrl(h2(hash)))
			<span class="hljs-keyword">return</span>
		}
	}
}
</code></pre>
<h4 data-id="heading-14">å¤§å®¹é‡mapæ‰©å®¹</h4>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0d6b7e0c32514d48ab23ec564027ed4c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAganp6enp6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771302119&amp;x-signature=vO5yaI22gcs5PJzkYdu1uoNQJPQ%3D" alt="å¤§mapæ‰©å®¹.png" width="70%" loading="lazy"/></p>
è¯¥æ–¹æ³•ç”¨äºå¤§mapæ’å…¥æ—¶æ‰©å®¹
<ol>
<li>å°†æ–°newCapacityè®¾ä¸ºè€å®¹é‡çš„ä¸¤å€ï¼Œæ²¡è¶…é™åˆ¶çš„è¯è°ƒç”¨t.grow(typ, m, newCapacity)ç„¶åè¿”å›</li>
<li>è¶…é™åˆ¶åˆ™è°ƒç”¨t.split(typ, m)</li>
</ol>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(t *table)</span></span> rehash(typ *abi.SwissMapType, m *Map) {
	newCapacity := <span class="hljs-number">2</span> * t.capacity
	<span class="hljs-keyword">if</span> newCapacity &lt;= maxTableCapacity {
		t.grow(typ, m, newCapacity)
		<span class="hljs-keyword">return</span>
	}

	t.split(typ, m)
}
</code></pre>
<p>é¦–å…ˆçœ‹æ–°å®¹é‡æ²¡è¶…é™åˆ¶çš„æƒ…å†µï¼š</p>
<ol>
<li>é¦–å…ˆæ ¹æ®æ–°å®¹é‡åˆ›å»ºä¸€ä¸ªtable</li>
<li>é¦–å…ˆåˆ¤æ–­t.capacityæ˜¯å¦å¤§äº0ï¼Œé˜²æ­¢capacity==0ï¼ˆé›¶å€¼/å¼‚å¸¸çŠ¶æ€ï¼‰æ—¶å»éå†æ—§ groups å¯¼è‡´é”™è¯¯ã€‚åªæœ‰å½“t.capacityå¤§äº0æ‰ä¼šè¿›å…¥å¤„ç†æ—§æ•°æ®</li>
<li>å¤„ç†æ—§æ•°æ®è·Ÿå°mapæ‰©å®¹ç±»ä¼¼ï¼Œä¸è¿‡å¤§mapæ—¶éå†groupsï¼Œå¯¹groupsä¸­çš„æ¯ä¸ªgroupçš„slotè¿›è¡Œå¤„ç†ï¼Œç©ºslotä¸ç®¡ï¼Œæœ‰æ•°æ®é‡æ–°hashçš„æ’å…¥æ–°tableï¼Œå…·ä½“çœ‹å°mapçš„è§£é‡Š</li>
<li>ç»“æŸå‰é¢æ“ä½œé¦–å…ˆæ£€æŸ¥tableçš„å†…éƒ¨çŠ¶æ€ï¼Œç„¶åå°†mçš„tableæ¢ä¸ºæ–°table</li>
<li>æ—§tableçš„indexè®¾ä¸º-1ä»£è¡¨å·²å¤±æ•ˆï¼Œè¿”å›
<strong>table.grow()</strong></li>
</ol>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(t *table)</span></span> grow(typ *abi.SwissMapType, m *Map, newCapacity <span class="hljs-type">uint16</span>) {
	newTable := newTable(typ, <span class="hljs-type">uint64</span>(newCapacity), t.index, t.localDepth)
	<span class="hljs-keyword">if</span> t.capacity &gt; <span class="hljs-number">0</span> {
		<span class="hljs-keyword">for</span> i := <span class="hljs-type">uint64</span>(<span class="hljs-number">0</span>); i &lt;= t.groups.lengthMask; i++ {
			g := t.groups.group(typ, i)
			<span class="hljs-keyword">for</span> j := <span class="hljs-type">uintptr</span>(<span class="hljs-number">0</span>); j &lt; abi.SwissMapGroupSlots; j++ {
				<span class="hljs-keyword">if</span> (g.ctrls().get(j) &amp; ctrlEmpty) == ctrlEmpty {
					<span class="hljs-keyword">continue</span>
				}
				key := g.key(typ, j)
				<span class="hljs-keyword">if</span> typ.IndirectKey() {
					key = *((*unsafe.Pointer)(key))
				}

				elem := g.elem(typ, j)
				<span class="hljs-keyword">if</span> typ.IndirectElem() {
					elem = *((*unsafe.Pointer)(elem))
				}

				hash := typ.Hasher(key, m.seed)

				newTable.uncheckedPutSlot(typ, hash, key, elem)
			}
		}
	}
	newTable.checkInvariants(typ, m)
	m.replaceTable(newTable)
	t.index = <span class="hljs-number">-1</span>
}
</code></pre>
<p><strong>table.split()</strong>
è¯¥æ–¹æ³•ç”¨äºåœ¨å¤§mapæ‰©å®¹æ—¶æ–°å®¹é‡è¶…å‡ºtableçš„é™åˆ¶æ—¶å°†ä¸€ä¸ªtableåˆ†ä¸ºä¸¤ä¸ª</p>
<ol>
<li>é¦–å…ˆå°†å–å‡ºtableçš„localDepthèµ‹å€¼ç»™ä¸€ä¸ªå˜é‡ï¼Œå¹¶å¯¹è¯¥å˜é‡++ï¼Œè¡¨ç¤º split åæ–°è¡¨æ·±åº¦ +1</li>
<li>ç„¶ååˆ†åˆ«åˆ›å»ºleftå’Œrightä¸¤ä¸ªtableï¼Œå®¹é‡æ—¶maxTableCapacityï¼Œindexä¸º-1</li>
<li>è°ƒç”¨localDepthMaskè¿”å›ä¸€ä¸ªæ©ç ï¼Œç”¨äºå–å“ˆå¸Œå€¼ä¸­å½“å‰ localDepth æ–°å¢å‡ºæ¥çš„é‚£ä¸€ä½ï¼ˆç”¨äº split æ—¶é€‰ left/rightï¼‰ã€‚</li>
<li>åœ¨å¤„ç†æ—§çš„slotæ•°æ®æ—¶ï¼Œä¸ç›´æ¥ç¿»å€å®¹é‡æ‰©å®¹å¤„ç†ç›¸ä¼¼ï¼Œåªä¸è¿‡å¤šäº†ä¸€ä¸ªhash&amp;maskè®¡ç®—è½åœ¨é‚£ä¸€ä¸ªtableï¼Œå¤„ç†ç»“æŸåè°ƒç”¨m.installTableSplit(t, left, right) æŠŠå·¦å³è¡¨åŠ å…¥ç›®å½•ï¼ˆå¿…è¦æ—¶å…ˆæ‰©ç›®å½•ï¼‰ã€‚</li>
<li>æœ€åå°†å½“å‰tableçš„indexè®¾ä¸º-1ï¼Œè¿”å›</li>
</ol>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(t *table)</span></span> split(typ *abi.SwissMapType, m *Map) {
	localDepth := t.localDepth
	localDepth++

	left := newTable(typ, maxTableCapacity, <span class="hljs-number">-1</span>, localDepth)
	right := newTable(typ, maxTableCapacity, <span class="hljs-number">-1</span>, localDepth)

	mask := localDepthMask(localDepth)

	<span class="hljs-keyword">for</span> i := <span class="hljs-type">uint64</span>(<span class="hljs-number">0</span>); i &lt;= t.groups.lengthMask; i++ {
		g := t.groups.group(typ, i)
		<span class="hljs-keyword">for</span> j := <span class="hljs-type">uintptr</span>(<span class="hljs-number">0</span>); j &lt; abi.SwissMapGroupSlots; j++ {
			<span class="hljs-keyword">if</span> (g.ctrls().get(j) &amp; ctrlEmpty) == ctrlEmpty {
				<span class="hljs-keyword">continue</span>
			}
			key := g.key(typ, j)
			<span class="hljs-keyword">if</span> typ.IndirectKey() {
				key = *((*unsafe.Pointer)(key))
			}

			elem := g.elem(typ, j)
			<span class="hljs-keyword">if</span> typ.IndirectElem() {
				elem = *((*unsafe.Pointer)(elem))
			}

			hash := typ.Hasher(key, m.seed)
			<span class="hljs-keyword">var</span> newTable *table
			<span class="hljs-keyword">if</span> hash&amp;mask == <span class="hljs-number">0</span> {
				newTable = left
			} <span class="hljs-keyword">else</span> {
				newTable = right
			}
			newTable.uncheckedPutSlot(typ, hash, key, elem)
		}
	}
	m.installTableSplit(t, left, right)
	t.index = <span class="hljs-number">-1</span>
}
</code></pre>
<p><strong>Map.installTableSplit()</strong>
è¯¥æ–¹æ³•ç”¨äºå°†splitåçš„leftå’Œright tableåŠ å…¥ç›®å½•é¡¹</p>
<ol>
<li>å¦‚æœold.localDepth == m.globalDepthï¼Œè¯´æ˜å½“å‰ç›®å½•é¡¹ä¸å¤Ÿå†å¯¹tableè¿›è¡Œç»†åˆ†éœ€è¦å¯¹ç›®å½•è¿›è¡Œç¿»å€ï¼ˆ<strong>æŠŠæ‰€æœ‰ç›®å½•é¡¹å¤åˆ¶æ‰©å±•ï¼Œä½†ä¸ä¼šç«‹åˆ»æŠŠå…¶ä»– table ä¹Ÿä¸€èµ· split</strong>ï¼‰</li>
<li>é¦–å…ˆåˆ›å»ºä¸€ä¸ªm.dirLen*2é•¿åº¦çš„ *tableåˆ‡ç‰‡ï¼Œç„¶åå°†æ¯ä¸ªtableçš„æ—§ç´¢å¼• i æ‰©æˆæ–°ç´¢å¼• 2 * i å’Œ 2 * i+1ã€‚t.index å­˜çš„æ˜¯è¯¥ table åœ¨ç›®å½•ä¸­çš„ç¬¬ä¸€ä¸ªä½ç½®ã€‚åŒä¸€ä¸ª table å¯èƒ½åœ¨ç›®å½•é‡Œå‡ºç°å¤šæ¬¡ï¼Œæ‰€ä»¥åªåœ¨é‡åˆ°å®ƒåŸæ¥çš„èµ·å§‹ä½ç½®ï¼ˆt.index == iï¼‰æ—¶æ›´æ–°ä¸€æ¬¡ä¸º 2 * iï¼Œé¿å…é‡å¤æ”¹é”™ã€‚ï¼ˆç¡®ä¿åªæ›´æ–°ä¸€æ¬¡æ¯ä¸ª table çš„èµ·å§‹ç´¢å¼•ï¼‰</li>
<li>å¹¶å¯¹mçš„ä¸€äº›å‚æ•°è¿›è¡Œå¯¹åº”çš„ä¿®æ”¹</li>
<li>è°ƒç”¨replaceTableå°†leftå’Œrightæ’å…¥åˆ°ç›®å½•é¡¹é‡Œï¼Œentriesè¡¨ç¤ºè¯¥ table éœ€è¦è¢«å¤šå°‘ä¸ªç›®å½•é¡¹å…±äº«å¼•ç”¨ã€‚å½“ m.globalDepth - left.localDepth == 1 æ—¶ï¼Œentries=2ï¼Œæ‰€ä»¥ replaceTable ä¼šæŠŠ leftï¼ˆæˆ– rightï¼‰å†™å…¥è¿ç»­ 2 ä¸ªç›®å½•é¡¹ã€‚</li>
<li>æ­¤æ—¶rightçš„ç›®å½•é¡¹ç´§æŒ¨ç€leftçš„ç›®å½•é¡¹</li>
</ol>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(m *Map)</span></span> installTableSplit(old, left, right *table) {
	<span class="hljs-keyword">if</span> old.localDepth == m.globalDepth {
		newDir := <span class="hljs-built_in">make</span>([]*table, m.dirLen*<span class="hljs-number">2</span>)
		<span class="hljs-keyword">for</span> i := <span class="hljs-keyword">range</span> m.dirLen {
			t := m.directoryAt(<span class="hljs-type">uintptr</span>(i))
			newDir[<span class="hljs-number">2</span>*i] = t
			newDir[<span class="hljs-number">2</span>*i+<span class="hljs-number">1</span>] = t
			<span class="hljs-keyword">if</span> t.index == i {
				t.index = <span class="hljs-number">2</span> * i
			}
		}
		m.globalDepth++
		m.globalShift--
		m.dirPtr = unsafe.Pointer(&amp;newDir[<span class="hljs-number">0</span>])
		m.dirLen = <span class="hljs-built_in">len</span>(newDir)
	}
	left.index = old.index
	m.replaceTable(left)
	entries := <span class="hljs-number">1</span> &lt;&lt; (m.globalDepth - left.localDepth)
	right.index = left.index + entries
	m.replaceTable(right)
}
</code></pre>
<p><strong>Map.replaceTable()</strong>
ç”¨æ¥å®ç°åŒä¸€ä¸ª table è¢«å¤šä¸ªç›®å½•é¡¹å…±äº«å¼•ç”¨</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(m *Map)</span></span> replaceTable(nt *table) {
	<span class="hljs-comment">// The number of entries that reference the same table doubles for each</span>
	<span class="hljs-comment">// time the globalDepth grows without the table splitting.</span>
	entries := <span class="hljs-number">1</span> &lt;&lt; (m.globalDepth - nt.localDepth)
	<span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; entries; i++ {
		<span class="hljs-comment">//m.directory[nt.index+i] = nt</span>
		m.directorySet(<span class="hljs-type">uintptr</span>(nt.index+i), nt)
	}
}
</code></pre>
<h3 data-id="heading-15">ä»mapä¸­åˆ é™¤æ•°æ®</h3>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5ed55f33bee14215b44859679263ee97~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAganp6enp6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771302119&amp;x-signature=Ok5WRpnqXCWAryhpWNtwKWlTbJQ%3D" alt="delmap.png" width="70%" loading="lazy"/></p>
<ol>
<li>å¦‚æœmapä¸ºnilï¼Œæˆ–è€…mapä¸­æ— å·²å¡«å……çš„æ•°æ®ï¼Œé¦–å…ˆå¯¹keyçš„åˆæ³•æ€§è¿›è¡Œåˆ¤æ–­ï¼Œå¦‚æœkeyä¸åˆæ³•åˆ™ç›´æ¥panicï¼Œå¦åˆ™è¿”å›ï¼›</li>
<li>åˆ¤æ–­æ˜¯å¦æœ‰å…¶ä»–åç¨‹å†å†™mapï¼Œæœ‰çš„è¯fatal</li>
<li>å¦‚æ²¡æœ‰å…¶ä»–åç¨‹å†™ä¸”mapä¸ä¸ºç©ºåˆ™å…ˆè®¡ç®—keyçš„hashï¼Œå¹¶å°†	m.writing ^= 1</li>
<li>æ¥ç€è¿›å…¥åˆ é™¤æ“ä½œï¼Œå°mapå’Œå¤§mapæ‰§è¡Œä¸åŒæ“ä½œ</li>
<li>åˆ é™¤ç»“æŸï¼Œå¦‚æœ m.used == 0ï¼Œè¯´æ˜ map å·²ç»ç©ºäº†ã€‚é‡æ–°è®¾ç½® m.seed = uintptr(rand())ï¼Œå¹¶åˆ¤æ–­æ˜¯å¦æœ‰å…¶ä»–åç¨‹åœ¨è¿‡ç¨‹ä¸­è¿›è¡Œå¹¶å‘å†™ï¼Œæœ‰çš„è¯fatalï¼Œå¦åˆ™m.writing ^= 1è¿”å›
<strong>Map.Delete()</strong></li>
</ol>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(m *Map)</span></span> Delete(typ *abi.SwissMapType, key unsafe.Pointer) {
	<span class="hljs-keyword">if</span> m == <span class="hljs-literal">nil</span> || m.Used() == <span class="hljs-number">0</span> {
		<span class="hljs-keyword">if</span> err := mapKeyError(typ, key); err != <span class="hljs-literal">nil</span> {
			<span class="hljs-built_in">panic</span>(err) 
		}
		<span class="hljs-keyword">return</span>
	}
	<span class="hljs-keyword">if</span> m.writing != <span class="hljs-number">0</span> {
		fatal(<span class="hljs-string">"concurrent map writes"</span>)
	}
	hash := typ.Hasher(key, m.seed)
	m.writing ^= <span class="hljs-number">1</span> 
	<span class="hljs-keyword">if</span> m.dirLen == <span class="hljs-number">0</span> {
		m.deleteSmall(typ, hash, key)
	} <span class="hljs-keyword">else</span> {
		idx := m.directoryIndex(hash)
		m.directoryAt(idx).Delete(typ, m, hash, key)
	}
	<span class="hljs-keyword">if</span> m.used == <span class="hljs-number">0</span> {
		m.seed = <span class="hljs-type">uintptr</span>(rand())
	}
	<span class="hljs-keyword">if</span> m.writing == <span class="hljs-number">0</span> {
		fatal(<span class="hljs-string">"concurrent map writes"</span>)
	}
	m.writing ^= <span class="hljs-number">1</span>
}
</code></pre>
<p>æ¥ç€çœ‹å°mapåˆ é™¤çš„å…·ä½“å®ç°
<strong>Map.deleteSmall()</strong></p>
<ol>
<li>é¦–å…ˆå°è£…ä¸€ä¸ªgroupæŒ‡å‘m.dirPtrï¼ˆå³å­˜æ”¾slotçš„åœ°å€ï¼‰</li>
<li>å¾—åˆ°groupä¸­ä¸h2(hash)åŒ¹é…çš„slotçš„ä½å›¾ï¼Œå¦‚æœæ²¡æœ‰ç›´æ¥ç»“æŸdeleteSmallï¼ˆï¼‰</li>
<li>é¦–å…ˆå–å‡ºç¬¬ä¸€ä¸ªä¸h2åŒ¹é…çš„slotçš„slotKeyï¼Œå¹¶èµ‹å€¼å˜é‡æ–¹ä¾¿æ¸…é™¤elemï¼Œå¦‚æœslotkeyå­˜æ”¾çš„æ˜¯æŒ‡å‘ key çš„æŒ‡é’ˆåˆ™è§£å¼•ç”¨</li>
<li>æ¥ç€åˆ¤æ–­Equal(key, slotKey)ï¼Œä¸ç›¸ç­‰çš„è¯åˆ™ç»§ç»­å–ä¸‹ä¸€ä¸ªåŒ¹é…çš„slot</li>
<li>åŒ¹é…çš„è¯è¿›å…¥æ¸…é™¤æ•°æ®ï¼Œé¦–å…ˆå°†m.used--,ç„¶ååˆ¤æ–­keyæ˜¯å¦æ˜¯å­˜æ”¾çš„æ˜¯æŒ‡å‘ key çš„æŒ‡é’ˆï¼Œæ˜¯çš„è¯æ¸…ç©ºæŒ‡é’ˆï¼Œåˆ‡æ–­å¯¹keyçš„å¼•ç”¨ï¼›typ.Key.Pointers() ä¸ºçœŸè¯´æ˜ key æœ¬èº«åŒ…å«æŒ‡é’ˆå­—æ®µã€‚è¿™æ—¶ç”¨ typedmemclr æŒ‰ç±»å‹æ¸…é›¶ï¼ŒæŠŠ key é‡Œçš„æŒ‡é’ˆå­—æ®µæ¸…æ‰ï¼Œé˜²æ­¢æ®‹ç•™å¼•ç”¨ã€‚ä¸Šè¿°ä¸¤æ­¥éƒ½æ˜¯ä¸ºäº†æ–¹ä¾¿gcå›æ”¶</li>
<li>å¯¹elemåˆ¤æ–­elemæ˜¯å¦æ˜¯å­˜æ”¾çš„æ˜¯æŒ‡å‘ elemçš„æŒ‡é’ˆï¼Œæ˜¯çš„è¯æ¸…ç©ºæŒ‡é’ˆï¼Œåˆ‡æ–­å¯¹elemçš„å¼•ç”¨ï¼Œå¦åˆ™ç›´æ¥æŒ‰ç±»å‹æ¸…ç©ºï¼Œè¿”å›</li>
</ol>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(m *Map)</span></span> deleteSmall(typ *abi.SwissMapType, hash <span class="hljs-type">uintptr</span>, key unsafe.Pointer) {
	g := groupReference{
		data: m.dirPtr,
	}
	match := g.ctrls().matchH2(h2(hash))
	<span class="hljs-keyword">for</span> match != <span class="hljs-number">0</span> {
		i := match.first()
		slotKey := g.key(typ, i)
		origSlotKey := slotKey
		<span class="hljs-keyword">if</span> typ.IndirectKey() {
			slotKey = *((*unsafe.Pointer)(slotKey))
		}
		<span class="hljs-keyword">if</span> typ.Key.Equal(key, slotKey) {
			m.used--
			<span class="hljs-keyword">if</span> typ.IndirectKey() {
				*(*unsafe.Pointer)(origSlotKey) = <span class="hljs-literal">nil</span>
			} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> typ.Key.Pointers() {
				typedmemclr(typ.Key, slotKey)
			}
			slotElem := g.elem(typ, i)
			<span class="hljs-keyword">if</span> typ.IndirectElem() {
				*(*unsafe.Pointer)(slotElem) = <span class="hljs-literal">nil</span>
			} <span class="hljs-keyword">else</span> {
				typedmemclr(typ.Elem, slotElem)
			}
			g.ctrls().set(i, ctrlEmpty)
			<span class="hljs-keyword">return</span>
		}
		match = match.removeFirst()
	}
}
</code></pre>
<p>æœ€åçœ‹å¤§mapåˆ é™¤çš„å…·ä½“å®ç°</p>
<ol>
<li>é¦–å…ˆå–æ¢æµ‹åºåˆ—å’Œèµ·å§‹groupä½ç½®ï¼Œè¿›å…¥æ¢æµ‹å¾ªç¯</li>
<li>å–èµ·å§‹groupï¼Œé¦–å…ˆå¾—åˆ°groupä¸­ä¸h2(hash)åŒ¹é…çš„slotçš„ä½å›¾ï¼Œå¦‚æœmatchH2 ä¸ºç©ºåï¼Œå†çœ‹ æ˜¯å¦å­˜åœ¨ç©º slotï¼›å¦‚æœæœ‰ç©º slotï¼Œæ¢æµ‹åºåˆ—åˆ°æ­¤ç»“æŸç›´æ¥è¿”å›ï¼›å¦‚æœæ²¡æœ‰ç©º slotï¼Œç»§ç»­ä¸‹ä¸€ä¸ª groupã€‚</li>
<li>ä¸‹é¢ä¸»è¦æµç¨‹ä¸å°mapä¸€æ ·ï¼Œä¸»è¦è¯´åœ¨groupæŸ¥æ‰¾ä¸å°mapä¸ä¸€æ ·çš„åœ°æ–¹</li>
<li>å¤§ map åˆ é™¤æ—¶ä¼š t.used-- å’Œ m.used--ï¼›å¦‚æœè¯¥ group é‡Œå·²æœ‰ç©º slotï¼Œåˆ é™¤ä½ä¼šè¢«è®¾ä¸º ctrlEmptyï¼Œå¹¶ä¸” t.growthLeft++ï¼›å¦åˆ™è®¾ä¸º ctrlDeletedã€‚</li>
<li>å¹¶ä¸”tableä¼šæœ‰å¤šä¸ªgroupï¼Œç¬¬ä¸€ä¸ªgroupæ²¡æ¢æµ‹åˆ°ä¼šæ¢æµ‹ä¸‹ä¸€ä¸ªç›´åˆ°ç»“æŸ
<strong>table.Delete()</strong></li>
</ol>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(t *table)</span></span> Delete(typ *abi.SwissMapType, m *Map, hash <span class="hljs-type">uintptr</span>, key unsafe.Pointer) {
	seq := makeProbeSeq(h1(hash), t.groups.lengthMask)
	<span class="hljs-keyword">for</span> ; ; seq = seq.next() {
		g := t.groups.group(typ, seq.offset)
		match := g.ctrls().matchH2(h2(hash))
		<span class="hljs-keyword">for</span> match != <span class="hljs-number">0</span> {
			i := match.first()
			slotKey := g.key(typ, i)
			origSlotKey := slotKey
			<span class="hljs-keyword">if</span> typ.IndirectKey() {
				slotKey = *((*unsafe.Pointer)(slotKey))
			}
			<span class="hljs-keyword">if</span> typ.Key.Equal(key, slotKey) {
				t.used--
				m.used--
				<span class="hljs-keyword">if</span> typ.IndirectKey() {
					*(*unsafe.Pointer)(origSlotKey) = <span class="hljs-literal">nil</span>
				} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> typ.Key.Pointers() {
					typedmemclr(typ.Key, slotKey)
				}

				slotElem := g.elem(typ, i)
				<span class="hljs-keyword">if</span> typ.IndirectElem() {
					*(*unsafe.Pointer)(slotElem) = <span class="hljs-literal">nil</span>
				} <span class="hljs-keyword">else</span> {
					typedmemclr(typ.Elem, slotElem)
				}
				<span class="hljs-keyword">if</span> g.ctrls().matchEmpty() != <span class="hljs-number">0</span> {
					g.ctrls().set(i, ctrlEmpty)
					t.growthLeft++
				} <span class="hljs-keyword">else</span> {
					g.ctrls().set(i, ctrlDeleted)
				}

				t.checkInvariants(typ, m)
				<span class="hljs-keyword">return</span>
			}
			match = match.removeFirst()
		}
		match = g.ctrls().matchEmpty()
		<span class="hljs-keyword">if</span> match != <span class="hljs-number">0</span> {
			<span class="hljs-keyword">return</span>
		}
	}
}
</code></pre>
<h3 data-id="heading-16">è¿­ä»£å™¨</h3>
<p><strong>mapä¿è¯åœ¨éå†è¿‡ç¨‹ä¸­åŒä¸€ goroutine ä¸‹å¯æ”¹ï¼›å¹¶å‘å†™ä¼šè§¦å‘ fatalå¯¹è¡¨è¿›è¡Œä¿®æ”¹ï¼Œä½†ä¸ä¿è¯è¿™äº›ä¿®æ”¹ä¼šåœ¨éå†ä¸­å¯è§ã€‚</strong>
ä¸‹é¢é¦–å…ˆçœ‹è¿­ä»£å™¨çš„æ•°æ®ç»“æ„ï¼›</p>
<h4 data-id="heading-17">è¿­ä»£å™¨æ•°æ®ç»“æ„</h4>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">type</span> Iter <span class="hljs-keyword">struct</span> {
	key  unsafe.Pointer 
	elem unsafe.Pointer
	typ  *abi.SwissMapType
	m    *Map
	entryOffset <span class="hljs-type">uint64</span>
	dirOffset   <span class="hljs-type">uint64</span>
	clearSeq <span class="hljs-type">uint64</span>
	globalDepth <span class="hljs-type">uint8</span>
	dirIdx <span class="hljs-type">int</span>
	tab *table
	group groupReference
	entryIdx <span class="hljs-type">uint64</span>
}
</code></pre>
<ol>
<li>key æ§½ä½å¯¹åº”çš„key</li>
<li>elem æ§½ä½å¯¹åº”çš„elem</li>
<li>entryOffset ä¸€ä¸ªéšæœº slot åç§»å¼€å§‹éå†æ¥æ‰“ä¹±éå†é¡ºåº</li>
<li>dirOffset ç›®å½•çš„åç§»é‡ä½¿ç”¨ä¸€ä¸ªç‹¬ç«‹çš„ offsetï¼Œå› ä¸ºç›®å½•å¢é•¿æ—¶éœ€è¦è°ƒæ•´</li>
<li>clearSeq ç”¨äºæ£€æµ‹éå†æœŸé—´æ˜¯å¦å‘ç”Ÿäº† Clear</li>
<li>globalDepth ä¸Šä¸€æ¬¡è°ƒç”¨ Next æ—¶ Map.globalDepth çš„å€¼ï¼Œç”¨äºæ£€æµ‹éå†æœŸé—´ç›®å½•æ˜¯å¦å¢é•¿</li>
<li>dirIdx å½“å‰ç›®å½•ç´¢å¼•ï¼Œå°šæœªåº”ç”¨ dirOffset çš„è°ƒæ•´ã€‚</li>
<li>tab  ä¸Šä¸€æ¬¡è°ƒç”¨ Next æ—¶ dirIdx å¯¹åº”çš„ tableã€‚</li>
<li>group ä¸Šä¸€æ¬¡è°ƒç”¨ Next æ—¶ entryIdx å¯¹åº”çš„ groupã€‚</li>
<li>entryIdx æ˜¯å½“å‰ entry çš„ç´¢å¼•ï¼Œå°šæœªåº”ç”¨ entryOffset çš„è°ƒæ•´ã€‚index çš„ä½ 3 ä½æ˜¯ slot ç´¢å¼•ï¼Œé«˜ä½æ˜¯ group ç´¢å¼•ã€‚</li>
</ol>
<h4 data-id="heading-18">è¿­ä»£çš„ä¸»æµç¨‹å¦‚ä¸‹</h4>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">mapIterStart</span><span class="hljs-params">(t *abi.SwissMapType, m *maps.Map, it *maps.Iter)</span></span> {
	it.Init(t, m)
	it.Next()
}
</code></pre>
<p>åœ¨mapéå†æ—¶é¦–å…ˆåˆå§‹åŒ–ä¸€ä¸ªè¿­ä»£å™¨</p>
<ol>
<li>å½“mapä¸ºnilï¼Œæˆ–è€…ä¸ºç©ºæ—¶ç›´æ¥ç»“æŸ</li>
<li>å¦‚æœmapæ—¶å°mapæ—¶ï¼Œå°†dirIdxè®¾ä¸º-1ï¼Œå¹¶å°†groupè®¾ä¸ºmapçš„dirPtrå­˜æ”¾çš„æ•°æ®</li>
<li>ç„¶ååˆ©ç”¨rand()åˆ†åˆ«è®¾ç½®entryOffsetå’ŒdirOffsetåç§»å’Œä»¥åŠåˆå§‹åŒ–å…¶å®ƒå‚æ•°
<strong>Iter.Init()</strong></li>
</ol>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(it *Iter)</span></span> Init(typ *abi.SwissMapType, m *Map) {
	it.typ = typ

	<span class="hljs-keyword">if</span> m == <span class="hljs-literal">nil</span> || m.used == <span class="hljs-number">0</span> {
		<span class="hljs-keyword">return</span>
	}

	dirIdx := <span class="hljs-number">0</span>
	<span class="hljs-keyword">var</span> groupSmall groupReference
	<span class="hljs-keyword">if</span> m.dirLen &lt;= <span class="hljs-number">0</span> {
		<span class="hljs-comment">// Use dirIdx == -1 as sentinel for small maps.</span>
		dirIdx = <span class="hljs-number">-1</span>
		groupSmall.data = m.dirPtr
	}

	it.m = m
	it.entryOffset = rand()
	it.dirOffset = rand()
	it.globalDepth = m.globalDepth
	it.dirIdx = dirIdx
	it.group = groupSmall
	it.clearSeq = m.clearSeq
}
</code></pre>
<p>åˆå§‹åŒ–è¿­ä»£å™¨ç»“æŸåè¿›å…¥è¿­ä»£å‡½æ•°
è¯¥æ–¹æ³•è¾ƒé•¿æ‹†åˆ†è§£é‡Šï¼š
é¦–å…ˆçœ‹é”™è¯¯æƒ…å†µ</p>
<ol>
<li>é¦–å…ˆçœ‹mæ˜¯å¦ä¸ºnilï¼Œå¦‚æœä¸ºnilåˆ™å°†è¿­ä»£å™¨çš„keyå’Œeleméƒ½è®¾ä¸ºnilï¼Œè¿”å›</li>
<li>å¦‚æœåœ¨è¿­ä»£è¿‡ç¨‹æœ‰å…¶ä»–çš„åç¨‹åœ¨å†™mapï¼Œåˆ™ç›´æ¥fatalè¿”å›</li>
</ol>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(it *Iter)</span></span> Next() {
	<span class="hljs-keyword">if</span> it.m == <span class="hljs-literal">nil</span> {
		it.key = <span class="hljs-literal">nil</span>
		it.elem = <span class="hljs-literal">nil</span>
		<span class="hljs-keyword">return</span>
	}
	<span class="hljs-keyword">if</span> it.m.writing != <span class="hljs-number">0</span> {
		fatal(<span class="hljs-string">"concurrent map iteration and map write"</span>)
		<span class="hljs-keyword">return</span>
	}
	
	<span class="hljs-comment">//å°mapçš„è¿­ä»£å¯¹åº”step1</span>
	<span class="hljs-keyword">if</span> it.dirIdx &lt; <span class="hljs-number">0</span> {
		<span class="hljs-comment">// Map was small at Init.</span>
		<span class="hljs-keyword">for</span> ; it.entryIdx &lt; abi.SwissMapGroupSlots; it.entryIdx++ {
			k := <span class="hljs-type">uintptr</span>(it.entryIdx+it.entryOffset) % abi.SwissMapGroupSlots

			<span class="hljs-keyword">if</span> (it.group.ctrls().get(k) &amp; ctrlEmpty) == ctrlEmpty {
				<span class="hljs-keyword">continue</span>
			}

			key := it.group.key(it.typ, k)
			<span class="hljs-keyword">if</span> it.typ.IndirectKey() {
				key = *((*unsafe.Pointer)(key))
			}

			grown := it.m.dirLen &gt; <span class="hljs-number">0</span>
			<span class="hljs-keyword">var</span> elem unsafe.Pointer
			<span class="hljs-keyword">if</span> grown {
				<span class="hljs-keyword">var</span> ok <span class="hljs-type">bool</span>
				newKey, newElem, ok := it.m.getWithKey(it.typ, key)
				<span class="hljs-keyword">if</span> !ok {
					<span class="hljs-keyword">if</span> it.clearSeq == it.m.clearSeq &amp;&amp; !it.typ.Key.Equal(key, key) {
						elem = it.group.elem(it.typ, k)
						<span class="hljs-keyword">if</span> it.typ.IndirectElem() {
							elem = *((*unsafe.Pointer)(elem))
						}
					} <span class="hljs-keyword">else</span> {
						<span class="hljs-keyword">continue</span>
					}
				} <span class="hljs-keyword">else</span> {
					key = newKey
					elem = newElem
				}
			} <span class="hljs-keyword">else</span> {
				elem = it.group.elem(it.typ, k)
				<span class="hljs-keyword">if</span> it.typ.IndirectElem() {
					elem = *((*unsafe.Pointer)(elem))
				}
			}

			it.entryIdx++
			it.key = key
			it.elem = elem
			<span class="hljs-keyword">return</span>
		}
		it.key = <span class="hljs-literal">nil</span>
		it.elem = <span class="hljs-literal">nil</span>
		<span class="hljs-keyword">return</span>
	}

	<span class="hljs-comment">//å¤§mapåœ¨è¿­ä»£æœŸé—´æ‰©å®¹å¯¹åº”step2</span>
	<span class="hljs-keyword">if</span> it.globalDepth != it.m.globalDepth {
		orders := it.m.globalDepth - it.globalDepth
		it.dirIdx &lt;&lt;= orders
		it.dirOffset &lt;&lt;= orders
		it.globalDepth = it.m.globalDepth
	}

	<span class="hljs-comment">//å¤§mapçš„è¿­ä»£å¯¹åº”step3</span>
	<span class="hljs-keyword">for</span> ; it.dirIdx &lt; it.m.dirLen; it.nextDirIdx() {
		<span class="hljs-keyword">if</span> it.tab == <span class="hljs-literal">nil</span> {
			dirIdx := <span class="hljs-type">int</span>((<span class="hljs-type">uint64</span>(it.dirIdx) + it.dirOffset) &amp; <span class="hljs-type">uint64</span>(it.m.dirLen<span class="hljs-number">-1</span>))
			newTab := it.m.directoryAt(<span class="hljs-type">uintptr</span>(dirIdx))
			<span class="hljs-keyword">if</span> newTab.index != dirIdx {

				diff := dirIdx - newTab.index
				it.dirOffset -= <span class="hljs-type">uint64</span>(diff)
				dirIdx = newTab.index
			}
			it.tab = newTab
		}

		entryMask := <span class="hljs-type">uint64</span>(it.tab.capacity) - <span class="hljs-number">1</span>
		<span class="hljs-keyword">if</span> it.entryIdx &gt; entryMask {
			<span class="hljs-keyword">continue</span>
		}

		entryIdx := (it.entryIdx + it.entryOffset) &amp; entryMask
		slotIdx := <span class="hljs-type">uintptr</span>(entryIdx &amp; (abi.SwissMapGroupSlots - <span class="hljs-number">1</span>))
		<span class="hljs-keyword">if</span> slotIdx == <span class="hljs-number">0</span> || it.group.data == <span class="hljs-literal">nil</span> {

			groupIdx := entryIdx &gt;&gt; abi.SwissMapGroupSlotsBits
			it.group = it.tab.groups.group(it.typ, groupIdx)
		}

		<span class="hljs-keyword">if</span> (it.group.ctrls().get(slotIdx) &amp; ctrlEmpty) == <span class="hljs-number">0</span> {
			key := it.group.key(it.typ, slotIdx)
			<span class="hljs-keyword">if</span> it.typ.IndirectKey() {
				key = *((*unsafe.Pointer)(key))
			}

			grown := it.tab.index == <span class="hljs-number">-1</span>
			<span class="hljs-keyword">var</span> elem unsafe.Pointer
			<span class="hljs-keyword">if</span> grown {
				newKey, newElem, ok := it.grownKeyElem(key, slotIdx)
				<span class="hljs-keyword">if</span> !ok {

					<span class="hljs-keyword">goto</span> next
				} <span class="hljs-keyword">else</span> {
					key = newKey
					elem = newElem
				}
			} <span class="hljs-keyword">else</span> {
				elem = it.group.elem(it.typ, slotIdx)
				<span class="hljs-keyword">if</span> it.typ.IndirectElem() {
					elem = *((*unsafe.Pointer)(elem))
				}
			}

			it.entryIdx++
			it.key = key
			it.elem = elem
			<span class="hljs-keyword">return</span>
		}

	next:
		it.entryIdx++
		<span class="hljs-keyword">var</span> groupMatch bitset
		<span class="hljs-keyword">for</span> it.entryIdx &lt;= entryMask {
			entryIdx := (it.entryIdx + it.entryOffset) &amp; entryMask
			slotIdx := <span class="hljs-type">uintptr</span>(entryIdx &amp; (abi.SwissMapGroupSlots - <span class="hljs-number">1</span>))

			<span class="hljs-keyword">if</span> slotIdx == <span class="hljs-number">0</span> || it.group.data == <span class="hljs-literal">nil</span> {
				groupIdx := entryIdx &gt;&gt; abi.SwissMapGroupSlotsBits
				it.group = it.tab.groups.group(it.typ, groupIdx)
			}

			<span class="hljs-keyword">if</span> groupMatch == <span class="hljs-number">0</span> {
				groupMatch = it.group.ctrls().matchFull()

				<span class="hljs-keyword">if</span> slotIdx != <span class="hljs-number">0</span> {
					groupMatch = groupMatch.removeBelow(slotIdx)
				}

				<span class="hljs-keyword">if</span> groupMatch == <span class="hljs-number">0</span> {
					it.entryIdx += abi.SwissMapGroupSlots - <span class="hljs-type">uint64</span>(slotIdx)
					<span class="hljs-keyword">continue</span>
				}

				i := groupMatch.first()
				it.entryIdx += <span class="hljs-type">uint64</span>(i - slotIdx)
				<span class="hljs-keyword">if</span> it.entryIdx &gt; entryMask {
					<span class="hljs-keyword">continue</span>
				}
				entryIdx += <span class="hljs-type">uint64</span>(i - slotIdx)
				slotIdx = i
			}

			key := it.group.key(it.typ, slotIdx)
			<span class="hljs-keyword">if</span> it.typ.IndirectKey() {
				key = *((*unsafe.Pointer)(key))
			}

			grown := it.tab.index == <span class="hljs-number">-1</span>
			<span class="hljs-keyword">var</span> elem unsafe.Pointer
			<span class="hljs-keyword">if</span> grown {
				newKey, newElem, ok := it.grownKeyElem(key, slotIdx)
				<span class="hljs-keyword">if</span> !ok {
	
					groupMatch = groupMatch.removeFirst()
					<span class="hljs-keyword">if</span> groupMatch == <span class="hljs-number">0</span> {

						it.entryIdx += abi.SwissMapGroupSlots - <span class="hljs-type">uint64</span>(slotIdx)
						<span class="hljs-keyword">continue</span>
					}

					i := groupMatch.first()
					it.entryIdx += <span class="hljs-type">uint64</span>(i - slotIdx)
					<span class="hljs-keyword">continue</span>
				} <span class="hljs-keyword">else</span> {
					key = newKey
					elem = newElem
				}
			} <span class="hljs-keyword">else</span> {
				elem = it.group.elem(it.typ, slotIdx)
				<span class="hljs-keyword">if</span> it.typ.IndirectElem() {
					elem = *((*unsafe.Pointer)(elem))
				}
			}

			groupMatch = groupMatch.removeFirst()
			<span class="hljs-keyword">if</span> groupMatch == <span class="hljs-number">0</span> {

				it.entryIdx += abi.SwissMapGroupSlots - <span class="hljs-type">uint64</span>(slotIdx)
			} <span class="hljs-keyword">else</span> {

				i := groupMatch.first()
				it.entryIdx += <span class="hljs-type">uint64</span>(i - slotIdx)
			}

			it.key = key
			it.elem = elem
			<span class="hljs-keyword">return</span>
		}

	}

	it.key = <span class="hljs-literal">nil</span>
	it.elem = <span class="hljs-literal">nil</span>
	<span class="hljs-keyword">return</span>
}
</code></pre>
<p><strong>step1ï¼š</strong> å°mapçš„è¿­ä»£å¤„ç†é€»è¾‘ï¼š
è¿™æ®µä»£ç å—é€»è¾‘ä¹Ÿæ¯”è¾ƒå¤æ‚æ‹†å¼€æ¥è®²
é¦–å…ˆå¯ä»¥è‚¯å®šçš„æ˜¯it.dirIdx &lt; 0åªæœ‰å°mapæ‰ä¼šå‡ºç°ï¼Œå¹¶ä¸”æ­¤æ—¶entryIdxæ˜¯ä¸º0
é¦–å…ˆæ˜¯è·å¾—è¿­ä»£å™¨å–åˆ°çš„slotçš„keyçš„é€»è¾‘</p>
<ol>
<li>ä½¿ç”¨entryIdxç»“åˆentryOffset éšæœºå–åˆ°ä¸€ä¸ªindexï¼Œå¦‚æœå¯¹åº”slotä¸ºç©ºæˆ–è€…è¢«åˆ é™¤åˆ™è¿›è¡Œä¸‹ä¸€è½®å¾ªç¯</li>
<li>å¦åˆ™å–å‡ºindexå¯¹åº”çš„keyï¼Œå¦‚æœslotkeyå­˜æ”¾çš„æ˜¯æŒ‡å‘keyåœ°å€çš„æŒ‡é’ˆåˆ™è§£å¼•ç”¨</li>
</ol>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">if</span> it.dirIdx &lt; <span class="hljs-number">0</span> {
<span class="hljs-keyword">for</span> ; it.entryIdx &lt; abi.SwissMapGroupSlots; it.entryIdx++ {
	k := <span class="hljs-type">uintptr</span>(it.entryIdx+it.entryOffset) % abi.SwissMapGroupSlots
	<span class="hljs-keyword">if</span> (it.group.ctrls().get(k) &amp; ctrlEmpty) == ctrlEmpty {
		<span class="hljs-keyword">continue</span>
	}
	key := it.group.key(it.typ, k)
	<span class="hljs-keyword">if</span> it.typ.IndirectKey() {
		key = *((*unsafe.Pointer)(key))
	}
</code></pre>
<p>ç„¶åæ˜¯å–slot keyå¯¹åº”çš„slot elemçš„é€»è¾‘</p>
<ol>
<li>grown == false æ—¶ç›´æ¥ä»æ—§ group å– elemï¼ˆå¿…è¦æ—¶è§£å¼•ç”¨ï¼‰ï¼›grown == true æ—¶å¿…é¡» getWithKey å»æ–°è¡¨å– newKey/newElemã€‚</li>
<li>getWithKey å¤±è´¥æ—¶çš„å¤„ç†æ˜¯ï¼šè‹¥ clearSeq å˜äº†ï¼ˆå‘ç”Ÿ Clearï¼‰ç›´æ¥ continueï¼›è‹¥ æ²¡ Clear ä¸” key != keyï¼ˆNaN æƒ…å†µï¼‰æ‰å›é€€ç”¨æ—§ group çš„ elemï¼›å¦åˆ™ continueã€‚</li>
<li>key != key ä¸ä»…é™äºçº¯ float keyï¼Œç»“æ„ä½“/æ•°ç»„é‡Œå« NaN ä¹Ÿä¼šè§¦å‘ã€‚</li>
<li>è¿”å›æ—¶ä¼šæŠŠ it.elem å’Œ it.key è®¾ç½®å¥½ï¼Œå¹¶ entryIdx++ã€‚</li>
<li>å¾ªç¯ç»“æŸç›´æ¥å°†it.elem å’Œ it.key è®¾ç½® nilï¼Œå¹¶è¿”å›</li>
</ol>
<pre><code class="hljs language-go" lang="go">	grown := it.m.dirLen &gt; <span class="hljs-number">0</span>
	<span class="hljs-keyword">var</span> elem unsafe.Pointer
	<span class="hljs-keyword">if</span> grown {
		<span class="hljs-keyword">var</span> ok <span class="hljs-type">bool</span>
		newKey, newElem, ok := it.m.getWithKey(it.typ, key)
		<span class="hljs-keyword">if</span> !ok {
			<span class="hljs-keyword">if</span> it.clearSeq == it.m.clearSeq &amp;&amp; !it.typ.Key.Equal(key, key) {
				elem = it.group.elem(it.typ, k)
				<span class="hljs-keyword">if</span> it.typ.IndirectElem() {
					elem = *((*unsafe.Pointer)(elem))
				}
			} <span class="hljs-keyword">else</span> {
				<span class="hljs-keyword">continue</span>
			}
		} <span class="hljs-keyword">else</span> {
			key = newKey
			elem = newElem
		}
	} <span class="hljs-keyword">else</span> {
		elem = it.group.elem(it.typ, k)
		<span class="hljs-keyword">if</span> it.typ.IndirectElem() {
			elem = *((*unsafe.Pointer)(elem))
		}
	}
	it.entryIdx++
	it.key = key
	it.elem = elem
	<span class="hljs-keyword">return</span>
	}
it.key = <span class="hljs-literal">nil</span>
it.elem = <span class="hljs-literal">nil</span>
<span class="hljs-keyword">return</span>
}
</code></pre>
<p><strong>step2ï¼š</strong> åœ¨è¿­ä»£å¤§mapä¹‹å‰ it.globalDepth != it.m.globalDepth ï¼ˆè¯´æ˜mapåœ¨è¿­ä»£æ—¶æ‰©å®¹ç›®å½•ï¼‰</p>
<ol>
<li>åˆ™å°†ç›®å½•é¡¹å’Œç›®å½•åç§»æŒ‰ä½æ•°å·®å·¦ç§»ï¼Œé€‚é…ç›®å½•æ‰©å®¹åçš„ç´¢å¼•ç©ºé—´ã€‚</li>
<li>å°†è¿­ä»£å™¨çš„globalDepthæ›´æ–°ä¸ºæ–°çš„globalDepth</li>
</ol>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">if</span> it.globalDepth != it.m.globalDepth {
		orders := it.m.globalDepth - it.globalDepth
		it.dirIdx &lt;&lt;= orders
		it.dirOffset &lt;&lt;= orders
		it.globalDepth = it.m.globalDepth
	}
</code></pre>
<p><strong>step3ï¼š</strong> å¤§mapçš„è¿­ä»£</p>
<p>æ­¤ä»£ç å—ä¹Ÿè¾ƒå¤šæ‹†è§£åˆ†æï¼šé¦–å…ˆå¼€å¯ä¸€ä¸ªforå¾ªç¯ï¼Œè¿­ä»£çš„æ—¶å€™ä½¿ç”¨nextDirIdx()è·³è¿‡æ•´ä¸ªé‡å¤åŒºé—´ä¼šæŒ‰è¯¥ table åœ¨ç›®å½•ä¸­å‡ºç°çš„æ¬¡æ•°æ¥è·³è½¬</p>
<ol>
<li>å¦‚æœit.tabä¸ºç©ºåˆ™è¯´æ˜ç¬¬ä¸€æ¬¡è¿­ä»£ï¼Œé¦–å…ˆæ ¹æ®dirIdxå’ŒdirOffsetè®¡ç®—å‡ºtableçš„indexï¼Œç„¶åå¾—åˆ°å¯¹åº”table</li>
<li>å¦‚æœtableçš„indexï¼ˆåœ¨mapçš„é¦–ä¸ªè®°å½•é¡¹ï¼‰ä¸dirIdxä¸åŒè¯´æ˜æ²¡æœ‰è½åœ¨è¯¥tableçš„èµ·å§‹ç›®å½•é¡¹</li>
<li>åˆ™æŠŠ dirIdx è°ƒå›åˆ°è¯¥ table çš„é¦–ä¸ªç´¢å¼•ï¼Œå¹¶åŒæ­¥å›é€€ dirOffsetï¼Œä¿è¯åç»­è¿­ä»£ä¸ä¼šé‡å¤æˆ–é”™ä½ã€‚å¹¶å°†å–å‡ºçš„tableèµ‹å€¼ç»™è¿­ä»£å™¨</li>
</ol>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">for</span> ; it.dirIdx &lt; it.m.dirLen; it.nextDirIdx() {
	<span class="hljs-keyword">if</span> it.tab == <span class="hljs-literal">nil</span> {
		dirIdx := <span class="hljs-type">int</span>((<span class="hljs-type">uint64</span>(it.dirIdx) + it.dirOffset) &amp; <span class="hljs-type">uint64</span>(it.m.dirLen<span class="hljs-number">-1</span>))
		newTab := it.m.directoryAt(<span class="hljs-type">uintptr</span>(dirIdx))
		<span class="hljs-keyword">if</span> newTab.index != dirIdx {
			diff := dirIdx - newTab.index
			it.dirOffset -= <span class="hljs-type">uint64</span>(diff)
			dirIdx = newTab.index
		}
		it.tab = newTab
	}
</code></pre>
<p>å¦‚æœentryidxå·²ç»è¶…è¿‡è¯¥è¡¨çš„æœ€å¤§ entry ç´¢å¼•ï¼Œå°±ç»“æŸè¿™å¼ è¡¨ï¼Œè½¬åˆ°ä¸‹ä¸€å¼ è¡¨ã€‚</p>
<pre><code class="hljs language-go" lang="go">	entryMask := <span class="hljs-type">uint64</span>(it.tab.capacity) - <span class="hljs-number">1</span>
		<span class="hljs-keyword">if</span> it.entryIdx &gt; entryMask {
			<span class="hljs-keyword">continue</span>
		}
</code></pre>
<p>æ¥ç€çœ‹å¿«é€Ÿå¤„ç†è·¯å¾„</p>
<ol>
<li>é¦–å…ˆæ ¹æ®it.entryIdxå’ŒentryOffsetè®¡ç®—entryIdxï¼ˆä½ä¸‰ä½ç”¨äºslotï¼Œé«˜ä½ç”¨äºgroupï¼‰</li>
<li>ç„¶åæ ¹æ®entryIdxè®¡ç®—slotidxï¼Œåœ¨å¼€å§‹éå†è¿™å¼ è¡¨çš„ç¬¬ä¸€æ¬¡è¿­ä»£æ—¶ï¼Œéœ€è¦è®¡ç®—ä¸€æ¬¡groupï¼Œslotidxä»æœ«å°¾ç»•åˆ°é¦–ä½æ—¶è¯´æ˜å¼€å¯ä¸‹ä¸€ç»„ä¹Ÿéœ€è¦è®¡ç®—ä¸€æ¬¡groupï¼Œè®¡ç®—groupä½¿ç”¨åˆ°äº†entryIdx</li>
<li>è·å¾—groupåï¼Œå¯¹slotIdxçš„æ§åˆ¶ä½è¿›è¡Œåˆ¤åˆ«æ˜¯å¦ä¸ºå­˜åœ¨å€¼çš„ï¼Œå¦‚æœä¸æ˜¯åˆ™è¿›å…¥æ…¢è·¯å¾„</li>
<li>å¦‚æœå­˜åœ¨å€¼åˆ™è¿›å…¥ifæ‰§è¡Œï¼Œé¦–å…ˆæ ¹æ®slotIdxåœ¨groupå–å‡ºslotkeyï¼ˆå¦‚æœæ˜¯æŒ‡å‘keyæŒ‡é’ˆè§£å¼•ç”¨ï¼‰</li>
<li>æ¥ç€åˆ¤æ–­tableæ˜¯å¦è§¦å‘æ‰©å®¹ï¼Œå€˜è‹¥è§¦å‘æ‰©å®¹å»æ–°è¡¨æ ¹æ®slotIdxå–å‡ºnewKey, newElemï¼Œå¦‚æœå–åˆ°èµ‹å€¼ç»™keyå’Œelemï¼Œæ²¡å–åˆ°åˆ™è¿›å…¥æ…¢è·¯å¾„</li>
<li>è‹¥æ²¡æ‰©å®¹åˆ™ç›´æ¥å»groupå–elemï¼ˆå¦‚æœæ˜¯æŒ‡å‘elemæŒ‡é’ˆè§£å¼•ç”¨ï¼‰</li>
<li>æœ€åç»™è¿­ä»£å™¨æ›´æ–°å€¼ï¼Œè¿”å›</li>
</ol>
<pre><code class="hljs language-go" lang="go">	entryIdx := (it.entryIdx + it.entryOffset) &amp; entryMask
	slotIdx := <span class="hljs-type">uintptr</span>(entryIdx &amp; (abi.SwissMapGroupSlots - <span class="hljs-number">1</span>))

	<span class="hljs-keyword">if</span> slotIdx == <span class="hljs-number">0</span> || it.group.data == <span class="hljs-literal">nil</span> {
		groupIdx := entryIdx &gt;&gt; abi.SwissMapGroupSlotsBits
		it.group = it.tab.groups.group(it.typ, groupIdx)
	}

	<span class="hljs-keyword">if</span> (it.group.ctrls().get(slotIdx) &amp; ctrlEmpty) == <span class="hljs-number">0</span> {
		key := it.group.key(it.typ, slotIdx)
		<span class="hljs-keyword">if</span> it.typ.IndirectKey() {
			key = *((*unsafe.Pointer)(key))
		}
		grown := it.tab.index == <span class="hljs-number">-1</span>
		<span class="hljs-keyword">var</span> elem unsafe.Pointer
		<span class="hljs-keyword">if</span> grown {
			newKey, newElem, ok := it.grownKeyElem(key, slotIdx)
			<span class="hljs-keyword">if</span> !ok {
				<span class="hljs-keyword">goto</span> next
			} <span class="hljs-keyword">else</span> {
				key = newKey
				elem = newElem
			}
		} <span class="hljs-keyword">else</span> {
			elem = it.group.elem(it.typ, slotIdx)
			<span class="hljs-keyword">if</span> it.typ.IndirectElem() {
				elem = *((*unsafe.Pointer)(elem))
			}
		}
		it.entryIdx++
		it.key = key
		it.elem = elem
		<span class="hljs-keyword">return</span>
	}
</code></pre>
<p>æ¥ç€æˆ‘ä»¬æ¥çœ‹æ…¢è·¯å¾„æ˜¯æ€ä¹ˆå¤„ç†</p>
<ol>
<li>å°†entryIdx++ï¼ˆå› ä¸ºåœ¨å‰é¢æµç¨‹ä¸­entryIdxæ¸¸æ ‡æ²¡æœ‰å–åˆ°å€¼ï¼‰</li>
<li>å¦‚æœit.entryidxå·²ç»è¶…è¿‡è¯¥è¡¨çš„æœ€å¤§ entry ç´¢å¼•ï¼Œå°±ç»“æŸè¿™å¼ è¡¨ï¼Œè½¬åˆ°ä¸‹ä¸€å¼ è¡¨ã€‚</li>
<li>å¦åˆ™è¿›å…¥åŒ¹é…é¦–å…ˆæ ¹æ®it.entryIdxå’ŒentryOffsetè®¡ç®—entryIdxï¼ˆä½ä¸‰ä½ç”¨äºslotï¼Œé«˜ä½ç”¨äºgroupï¼‰</li>
<li>ç„¶åæ ¹æ®entryIdxè®¡ç®—slotidxï¼Œåœ¨å¼€å§‹éå†è¿™å¼ è¡¨çš„ç¬¬ä¸€æ¬¡è¿­ä»£æ—¶ï¼Œéœ€è¦è®¡ç®—ä¸€æ¬¡groupï¼Œslotidxä»æœ«å°¾ç»•åˆ°é¦–ä½æ—¶è¯´æ˜å¼€å¯ä¸‹ä¸€ç»„ä¹Ÿéœ€è¦è®¡ç®—ä¸€æ¬¡groupï¼Œè®¡ç®—groupä½¿ç”¨åˆ°äº†entryIdx</li>
</ol>
<pre><code class="hljs language-go" lang="go">	next:
		it.entryIdx++
		<span class="hljs-keyword">var</span> groupMatch bitset
		<span class="hljs-keyword">for</span> it.entryIdx &lt;= entryMask {
			entryIdx := (it.entryIdx + it.entryOffset) &amp; entryMask
			slotIdx := <span class="hljs-type">uintptr</span>(entryIdx &amp; (abi.SwissMapGroupSlots - <span class="hljs-number">1</span>))

			<span class="hljs-keyword">if</span> slotIdx == <span class="hljs-number">0</span> || it.group.data == <span class="hljs-literal">nil</span> {
				groupIdx := entryIdx &gt;&gt; abi.SwissMapGroupSlotsBits
				it.group = it.tab.groups.group(it.typ, groupIdx)
			}
			<span class="hljs-comment">//..</span>
		
</code></pre>
<ol>
<li>å¯¹groupå¯»æ‰¾ä¸ä¸ºç©ºçš„slotçš„ä½å›¾ï¼ˆå½“ç¬¬ä¸€æ¬¡è¿›å…¥è¿­ä»£æ—¶ï¼‰</li>
<li>å¦‚æœslotidxä¸ä¸º0åˆ™æ¸…é™¤åŒ¹é…å¾—åˆ°ä½å›¾çš„ä½ä½ï¼Œåªç•™ä¸‹ slot i åŠä¹‹åçš„ä½ã€‚</li>
<li>å¦‚æœä½å›¾ä¸º0ï¼ˆæ— å¯ç”¨çš„slotï¼‰ï¼Œåˆ™è·³è¿‡è¯¥groupå‰©ä½™æ§½ä½ï¼Œè½¬åˆ°ä¸‹ä¸€è½®å¾ªç¯</li>
<li>æ‰¾åˆ°ç¬¬ä¸€ä¸ªå¯ç”¨slotï¼ŒæŠŠçº¿æ€§æ¸¸æ ‡å‰è¿›åˆ°è¿™ä¸ªä½ç½®</li>
<li>å¦‚æœæ¸¸æ ‡è¶…è¿‡è¡¨å°¾ï¼Œä¸‹ä¸€è½®å¤„ç†å›ç»•ã€‚</li>
<li>åŒæ­¥æ›´æ–°å¸¦ offset çš„å®é™…ç´¢å¼•ã€‚ä»¥åŠæ›´æ–°slotIdxï¼Œåç»­å°±ç”¨å»å– key/elemã€‚</li>
</ol>
<pre><code class="hljs language-go" lang="go">	<span class="hljs-keyword">if</span> groupMatch == <span class="hljs-number">0</span> {
		groupMatch = it.group.ctrls().matchFull()
		<span class="hljs-keyword">if</span> slotIdx != <span class="hljs-number">0</span> {
			groupMatch = groupMatch.removeBelow(slotIdx)
		}
		<span class="hljs-keyword">if</span> groupMatch == <span class="hljs-number">0</span> {
			it.entryIdx += abi.SwissMapGroupSlots - <span class="hljs-type">uint64</span>(slotIdx)
			<span class="hljs-keyword">continue</span>
		}
		i := groupMatch.first()
		it.entryIdx += <span class="hljs-type">uint64</span>(i - slotIdx)
		<span class="hljs-keyword">if</span> it.entryIdx &gt; entryMask {
			<span class="hljs-keyword">continue</span>
		}
		entryIdx += <span class="hljs-type">uint64</span>(i - slotIdx)
		slotIdx = i
	}
</code></pre>
<ol>
<li>æ ¹æ®slotidxå–åˆ°slotkeyï¼ˆå¦‚æœæ˜¯æŒ‡å‘keyçš„æŒ‡é’ˆåˆ™è§£å¼•ç”¨ï¼‰</li>
<li>æ¥ç€åˆ¤æ–­å½“å‰è¡¨åœ¨è¿­ä»£æ—¶æ˜¯å¦å‘ç”Ÿæ‰©å®¹ï¼Œå³ï¼ˆt.tab.index == -1ï¼ˆå‘ç”Ÿæ‰©å®¹æ—¶ä¼šå°†tableçš„indexè®¾ä¸º-1ï¼‰ï¼‰ï¼Œæ²¡æ‰©å®¹çš„è¯ç›´æ¥åœ¨è¿­ä»£å™¨çš„groupä¸­å–elemï¼ˆå¦‚æœæ˜¯æŒ‡å‘elemæŒ‡é’ˆè§£å¼•ç”¨ï¼‰</li>
<li>æ‰©å®¹çš„è¯ï¼Œå»æ–°tableæŸ¥è¯¢ï¼ŒæŸ¥åˆ°åˆ™ç›´æ¥èµ‹å€¼</li>
<li>æ–°tableæ²¡æŸ¥åˆ°çš„è¯ï¼Œå°†ä½å›¾ç¬¬ä¸€ä¸ªåŒ¹é…çš„slotç§»é™¤ï¼Œæ¥ç€åˆ¤æ–­ä½å›¾æ˜¯å¦è¿˜æœ‰å€¼ï¼Œæ²¡å€¼çš„è¯å°†è·³è¿‡è¯¥groupå‰©ä½™æ§½ä½ï¼Œè½¬åˆ°ä¸‹ä¸€è½®å¾ª;</li>
<li>å¦‚æœä½å›¾è¿˜æœ‰å€¼åˆ™æ¥ç€å–å’Œæ›´æ–°æ¸¸æ ‡</li>
<li>åœ¨å‰é¢å–å®Œå€¼ä»¥åæ‰§è¡Œå’Œæ–°tableæ²¡æŸ¥åˆ°æƒ…å†µç›¸åŒåˆ¤æ–­ï¼Œä¸è¿‡æ­¤æ—¶å·²ç»å»åˆ°å€¼å¯ä»¥ç»™elemå’Œkeyèµ‹å€¼è¿”å›</li>
</ol>
<pre><code class="hljs language-go" lang="go">	key := it.group.key(it.typ, slotIdx)
	<span class="hljs-keyword">if</span> it.typ.IndirectKey() {
		key = *((*unsafe.Pointer)(key))
	}

	grown := it.tab.index == <span class="hljs-number">-1</span>
	<span class="hljs-keyword">var</span> elem unsafe.Pointer
	<span class="hljs-keyword">if</span> grown {
		newKey, newElem, ok := it.grownKeyElem(key, slotIdx)
		<span class="hljs-keyword">if</span> !ok {
			groupMatch = groupMatch.removeFirst()
			<span class="hljs-keyword">if</span> groupMatch == <span class="hljs-number">0</span> {
				it.entryIdx += abi.SwissMapGroupSlots - <span class="hljs-type">uint64</span>(slotIdx)
				<span class="hljs-keyword">continue</span>
			}
			i := groupMatch.first()
			it.entryIdx += <span class="hljs-type">uint64</span>(i - slotIdx)
			<span class="hljs-keyword">continue</span>
		} <span class="hljs-keyword">else</span> {
			key = newKey
			elem = newElem
		}
	} <span class="hljs-keyword">else</span> {
		elem = it.group.elem(it.typ, slotIdx)
		<span class="hljs-keyword">if</span> it.typ.IndirectElem() {
			elem = *((*unsafe.Pointer)(elem))
		}
	}

	groupMatch = groupMatch.removeFirst()
	<span class="hljs-keyword">if</span> groupMatch == <span class="hljs-number">0</span> {
		it.entryIdx += abi.SwissMapGroupSlots - <span class="hljs-type">uint64</span>(slotIdx)
	} <span class="hljs-keyword">else</span> {
		i := groupMatch.first()
		it.entryIdx += <span class="hljs-type">uint64</span>(i - slotIdx)
	}

	it.key = key
	it.elem = elem
	<span class="hljs-keyword">return</span>
	}
</code></pre>
<p>å¦‚æœå¤§mapæ²¡å–åˆ°å€¼åˆ™è¿”å›nilï¼Œå°mapæ²¡å–åˆ°å€¼å¾—æƒ…å†µåœ¨å‰é¢å·²ç»æå‰ç»ˆæ­¢</p>
<pre><code class="hljs language-go" lang="go">	it.key = <span class="hljs-literal">nil</span>
	it.elem = <span class="hljs-literal">nil</span>
	<span class="hljs-keyword">return</span>
}
</code></pre>
<p>go æ–°å­˜å‚¨æ–¹å¼mapçš„è§£è¯»åˆ°æ­¤ç»“æŸï¼Œè°¢è°¢é˜…è¯»ï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å¾®å‰ç«¯æ¶æ„ä¸‹çš„ Axios è¯·æ±‚å°è£…ï¼šä» 336 è¡Œè€¦åˆåˆ° 64 è¡Œè–„ Wrapper çš„é‡æ„ä¹‹è·¯]]></title>    <link>https://juejin.cn/post/7604775190212329482</link>    <guid>https://juejin.cn/post/7604775190212329482</guid>    <pubDate>2026-02-10T04:21:38.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604775190212329482" data-draft-id="7604775190212296714" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å¾®å‰ç«¯æ¶æ„ä¸‹çš„ Axios è¯·æ±‚å°è£…ï¼šä» 336 è¡Œè€¦åˆåˆ° 64 è¡Œè–„ Wrapper çš„é‡æ„ä¹‹è·¯"/> <meta itemprop="keywords" content="å‰ç«¯,æ¶æ„"/> <meta itemprop="datePublished" content="2026-02-10T04:21:38.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å¤§è±¡çš„é¼»å­é‚£ä¹ˆé•¿"/> <meta itemprop="url" content="https://juejin.cn/user/2277843821926871"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å¾®å‰ç«¯æ¶æ„ä¸‹çš„ Axios è¯·æ±‚å°è£…ï¼šä» 336 è¡Œè€¦åˆåˆ° 64 è¡Œè–„ Wrapper çš„é‡æ„ä¹‹è·¯
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2277843821926871/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å¤§è±¡çš„é¼»å­é‚£ä¹ˆé•¿
  </span> <!----> <!----> <div class="vip-level" data-v-cd7d0a50="" data-v-292f6e48=""><span class="tooltip" data-v-cd7d0a50=""><div class="byte-tooltip byte-tooltip--dark" style="display:none;">
        VIP.4 èä¼šè´¯é€š
      </div><span class="byte-tooltip__wrapper"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8AQMAAAAAMksxAAAAA1BMVEUAAACnej3aAAAAAXRSTlMAQObYZgAAAA5JREFUKM9jGAWjAAcAAAIcAAE27nY6AAAAAElFTkSuQmCC" alt="VIP.4 èä¼šè´¯é€š" title="VIP.4 èä¼šè´¯é€š" class="lazy" style="aspect-ratio:NaN;" data-v-5244ef91="" data-v-cd7d0a50=""/></span></span></div> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T04:21:38.000Z" title="Tue Feb 10 2026 04:21:38 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    23
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»9åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p><strong>æ—¥æœŸ</strong>: 2026-02-10<br/>
<strong>é€‚ç”¨åœºæ™¯</strong>: å¾®å‰ç«¯ / Monorepo / å¤šåº”ç”¨å…±äº«è¯·æ±‚å±‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-0">ä¸€ã€é—®é¢˜ï¼šä¸ºä»€ä¹ˆè¦é‡æ„ Axios å°è£…ï¼Ÿ</h2>
<p>åœ¨ä¸€ä¸ªå…¸å‹çš„ä¼ä¸šçº§å¾®å‰ç«¯é¡¹ç›®ä¸­ï¼Œä¸»åº”ç”¨ï¼ˆShellï¼‰å’Œå¤šä¸ªå­åº”ç”¨éƒ½éœ€è¦å‘èµ· HTTP è¯·æ±‚ã€‚æœ€åˆçš„åšæ³•æ˜¯æ¯ä¸ªåº”ç”¨å„è‡ªå°è£…ä¸€å¥— Axios å®ä¾‹ï¼Œä½†éšç€é¡¹ç›®æ¼”è¿›ï¼Œé—®é¢˜é€æ¸æš´éœ²ï¼š</p>
<h3 data-id="heading-1">1.1 é‡å¤ä»£ç </h3>
<p>æ¯ä¸ªå­åº”ç”¨éƒ½è¦å®ç°ä¸€éï¼š</p>
<ul>
<li>Token æ³¨å…¥ï¼ˆBearer Authorizationï¼‰</li>
<li>Token åˆ·æ–° + è¯·æ±‚é˜Ÿåˆ—</li>
<li>é”™è¯¯ç å¤„ç†ï¼ˆ400/401/500/901ï¼‰</li>
<li>å›½é™…åŒ–é”™è¯¯æ¶ˆæ¯</li>
<li>äºŒè¿›åˆ¶å“åº”å¤„ç†ï¼ˆBlob ä¸‹è½½ï¼‰</li>
</ul>
<p>ä¸€ä¸ªå®Œæ•´çš„ Axios å°è£…é€šå¸¸ <strong>300+ è¡Œ</strong>ï¼Œ5 ä¸ªå­åº”ç”¨å°±æ˜¯ 1500+ è¡Œé‡å¤ä»£ç ã€‚</p>
<h3 data-id="heading-2">1.2 æ·±åº¦è€¦åˆ</h3>
<p>ä»¥æˆ‘ä»¬ä¸»åº”ç”¨çš„ <code>service.ts</code>ï¼ˆ336 è¡Œï¼‰ä¸ºä¾‹ï¼Œå®ƒç›´æ¥ä¾èµ–äº†ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">service.ts çš„ä¾èµ–å›¾è°±
â”œâ”€â”€ axios                    â† çº¯åº“ä¾èµ– âœ…
â”œâ”€â”€ qs                       â† çº¯åº“ä¾èµ– âœ…
â”œâ”€â”€ element-plus             â† UI åº“ âŒ
â”‚   â”œâ”€â”€ ElMessage
â”‚   â”œâ”€â”€ ElMessageBox
â”‚   â””â”€â”€ ElNotification
â”œâ”€â”€ vue-i18n                 â† å›½é™…åŒ– âŒ
â”‚   â””â”€â”€ i18n.global.<span class="hljs-built_in">t</span>()
â”œâ”€â”€ @/utils/auth             â† åº”ç”¨çº§ hooks âŒ
â”‚   â”œâ”€â”€ <span class="hljs-built_in">getAccessToken</span>()
â”‚   â”œâ”€â”€ <span class="hljs-built_in">getRefreshToken</span>()
â”‚   â”œâ”€â”€ <span class="hljs-built_in">setToken</span>()
â”‚   â””â”€â”€ <span class="hljs-built_in">removeToken</span>()
â””â”€â”€ @/config/axios/config    â† åº”ç”¨çº§é…ç½® âŒ
    â”œâ”€â”€ baseURL
    â””â”€â”€ result_code
</code></pre>
<p><strong>6 ä¸ªå¤–éƒ¨ä¾èµ–ä¸­æœ‰ 4 ä¸ªæ˜¯åº”ç”¨çº§çš„</strong>ã€‚è¿™æ„å‘³ç€ä½ æ— æ³•æŠŠè¿™ä¸ªæ–‡ä»¶ç›´æ¥æ¬åˆ°å…±äº«åŒ…é‡Œâ€”â€”å®ƒä¼šæŠŠ Element Plusã€vue-i18nã€åº”ç”¨ Store å…¨éƒ¨æ‹–è¿›æ¥ã€‚</p>
<h3 data-id="heading-3">1.3 æˆåŠŸç ä¸ä¸€è‡´</h3>
<p>ä¸»åº”ç”¨åç«¯è¿”å› <code>code === 200</code> è¡¨ç¤ºæˆåŠŸï¼Œè€ŒæŸäº›å¾®æœåŠ¡è¿”å› <code>code === 0</code>ã€‚ç¡¬ç¼–ç åœ¨æ‹¦æˆªå™¨é‡Œçš„æˆåŠŸç åˆ¤æ–­è®©å…±äº«å˜å¾—æ›´åŠ å›°éš¾ã€‚</p>
<hr/>
<h2 data-id="heading-4">äºŒã€è®¾è®¡æ€è·¯ï¼šæ’ä»¶å¼æ‹¦æˆªå™¨æ¶æ„</h2>
<h3 data-id="heading-5">2.1 æ ¸å¿ƒåŸåˆ™</h3>
<blockquote>
<p><strong>Axios å°è£…å±‚åªåš HTTP åè®®çš„äº‹ï¼Œåº”ç”¨é€»è¾‘é€šè¿‡æ’ä»¶æ³¨å…¥ã€‚</strong></p>
</blockquote>
<p>è¿™ä¸ªåŸåˆ™æ¥è‡ª <strong>ä¾èµ–å€’ç½®ï¼ˆDIPï¼‰</strong>ï¼šé«˜å±‚æ¨¡å—ï¼ˆAxios å°è£…ï¼‰ä¸åº”è¯¥ä¾èµ–ä½å±‚æ¨¡å—ï¼ˆElement Plusã€vue-i18nï¼‰ï¼Œä¸¤è€…éƒ½åº”è¯¥ä¾èµ–æŠ½è±¡ï¼ˆæ’ä»¶æ¥å£ï¼‰ã€‚</p>
<pre><code class="hljs language-bash" lang="bash">ä¼ ç»Ÿæ¶æ„ï¼ˆç´§è€¦åˆï¼‰ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         service.ts          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â” â”‚
â”‚  â”‚ElMsg  â”‚ â”‚i18n  â”‚ â”‚authâ”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ’ä»¶å¼æ¶æ„ï¼ˆæ¾è€¦åˆï¼‰ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     @cmclink/api            â”‚
â”‚     createRequest()         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Plugin Interfaces   â”‚   â”‚
â”‚  â”‚  AuthPlugin          â”‚   â”‚
â”‚  â”‚  I18nPlugin          â”‚   â”‚
â”‚  â”‚  UiPlugin            â”‚   â”‚
â”‚  â”‚  LogoutPlugin        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚ æ³¨å…¥
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     apps/main               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â” â”‚
â”‚  â”‚ElMsg  â”‚ â”‚i18n  â”‚ â”‚authâ”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h3 data-id="heading-6">2.2 å››ä¸ªæ’ä»¶æ¥å£</h3>
<p>æˆ‘ä»¬æŠŠ 336 è¡Œ <code>service.ts</code> ä¸­çš„åº”ç”¨çº§ä¾èµ–æŠ½è±¡ä¸º 4 ä¸ªæ’ä»¶æ¥å£ï¼š</p>
<h4 data-id="heading-7">AuthPlugin â€” Token ç®¡ç†</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">AuthPlugin</span> {
  <span class="hljs-attr">getAccessToken</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">string</span> | <span class="hljs-literal">null</span>
  <span class="hljs-attr">getRefreshToken</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">string</span> | <span class="hljs-literal">null</span>
  getTenantId?: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">string</span> | <span class="hljs-literal">null</span>
  <span class="hljs-attr">setToken</span>: <span class="hljs-function">(<span class="hljs-params">token: <span class="hljs-built_in">any</span></span>) =&gt;</span> <span class="hljs-built_in">void</span>
  <span class="hljs-attr">removeToken</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span>
  refreshTokenUrl?: <span class="hljs-built_in">string</span>
}
</code></pre>
<p><strong>è®¾è®¡å†³ç­–</strong>ï¼šä¸ºä»€ä¹ˆä¸ç›´æ¥ä¼  <code>tokenKey</code> è®© Axios è‡ªå·±ä» localStorage è¯»ï¼Ÿ</p>
<p>å› ä¸ºä¸åŒåº”ç”¨çš„ Token å­˜å‚¨ç­–ç•¥ä¸åŒâ€”â€”æœ‰çš„ç”¨ <code>localStorage</code>ï¼Œæœ‰çš„ç”¨ <code>sessionStorage</code>ï¼Œæœ‰çš„ç”¨åŠ å¯†ç¼“å­˜ï¼ˆå¦‚ <code>web-storage-cache</code>ï¼‰ã€‚é€šè¿‡å‡½æ•°æ¥å£ï¼Œè°ƒç”¨æ–¹å®Œå…¨æ§åˆ¶å­˜å‚¨å®ç°ã€‚</p>
<h4 data-id="heading-8">I18nPlugin â€” å›½é™…åŒ–</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">interface</span> I18nPlugin {
  <span class="hljs-attr">getLocale</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">string</span>
  <span class="hljs-attr">t</span>: <span class="hljs-function">(<span class="hljs-params">key: <span class="hljs-built_in">string</span></span>) =&gt;</span> <span class="hljs-built_in">string</span>
}
</code></pre>
<p><strong>è®¾è®¡å†³ç­–</strong>ï¼šä¸ºä»€ä¹ˆåªæš´éœ² <code>getLocale</code> å’Œ <code>t</code>ï¼Ÿ</p>
<p>Axios æ‹¦æˆªå™¨åªéœ€è¦ä¸¤ä¸ªèƒ½åŠ›ï¼šè®¾ç½® <code>Accept-Language</code> è¯·æ±‚å¤´ï¼ˆéœ€è¦ localeï¼‰ï¼Œç¿»è¯‘é”™è¯¯æ¶ˆæ¯ï¼ˆéœ€è¦ <code>t</code>ï¼‰ã€‚ä¸éœ€è¦æš´éœ²æ•´ä¸ª i18n å®ä¾‹ã€‚<strong>æœ€å°æ¥å£åŸåˆ™ï¼ˆISPï¼‰</strong>ã€‚</p>
<h4 data-id="heading-9">UiPlugin â€” é”™è¯¯æç¤º</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">UiPlugin</span> {
  <span class="hljs-attr">showMessage</span>: <span class="hljs-function">(<span class="hljs-params">msg: <span class="hljs-built_in">string</span>, <span class="hljs-keyword">type</span>: <span class="hljs-string">'success'</span> | <span class="hljs-string">'warning'</span> | <span class="hljs-string">'error'</span> | <span class="hljs-string">'info'</span></span>) =&gt;</span> <span class="hljs-built_in">void</span>
  <span class="hljs-attr">showConfirm</span>: <span class="hljs-function">(<span class="hljs-params">msg: <span class="hljs-built_in">string</span>, title: <span class="hljs-built_in">string</span>, options?: Record&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">any</span>&gt;</span>) =&gt;</span> <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">any</span>&gt;
  <span class="hljs-attr">showNotification</span>: <span class="hljs-function">(<span class="hljs-params">msg: <span class="hljs-built_in">string</span>, <span class="hljs-keyword">type</span>: <span class="hljs-string">'success'</span> | <span class="hljs-string">'warning'</span> | <span class="hljs-string">'error'</span> | <span class="hljs-string">'info'</span></span>) =&gt;</span> <span class="hljs-built_in">void</span>
}
</code></pre>
<p><strong>è®¾è®¡å†³ç­–</strong>ï¼šä¸ºä»€ä¹ˆç”¨ <code>showMessage</code> è€Œä¸æ˜¯ç›´æ¥ä¼  <code>ElMessage</code>ï¼Ÿ</p>
<ol>
<li><strong>è§£è€¦ UI åº“</strong>ï¼šå­åº”ç”¨å¯èƒ½ç”¨ Ant Design Vueã€Naive UI æˆ–è‡ªå®šä¹‰ç»„ä»¶</li>
<li><strong>å¯æµ‹è¯•æ€§</strong>ï¼šå•å…ƒæµ‹è¯•æ—¶å¯ä»¥ä¼ å…¥ mock å‡½æ•°</li>
<li><strong>SSR å®‰å…¨</strong>ï¼šæœåŠ¡ç«¯æ¸²æŸ“æ—¶ä¸ä¼šå¼•å…¥æµè§ˆå™¨ API</li>
</ol>
<h4 data-id="heading-10">LogoutPlugin â€” ç™»å‡ºå¤„ç†</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">LogoutPlugin</span> {
  <span class="hljs-attr">onUnauthorized</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span>
  onBeforeLogout?: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span>
}
</code></pre>
<p><strong>è®¾è®¡å†³ç­–</strong>ï¼šä¸ºä»€ä¹ˆè¦ <code>onBeforeLogout</code>ï¼Ÿ</p>
<p>æˆ‘ä»¬çš„ä¸»åº”ç”¨æœ‰ä¸€ä¸ªç«™å†…ä¿¡è½®è¯¢å®šæ—¶å™¨ï¼Œ401 æ—¶éœ€è¦å…ˆåœæ­¢è½®è¯¢å†è·³è½¬ç™»å½•é¡µã€‚è¿™ä¸ª hook è®©åº”ç”¨æœ‰æœºä¼šåšæ¸…ç†å·¥ä½œã€‚</p>
<h3 data-id="heading-11">2.3 é…ç½®é¡¹è®¾è®¡</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">RequestConfig</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AxiosRequestConfig</span> {
  resultCode?: <span class="hljs-built_in">number</span>          <span class="hljs-comment">// ä¸šåŠ¡æˆåŠŸç ï¼Œé»˜è®¤ 200</span>
  tenantEnable?: <span class="hljs-built_in">boolean</span>       <span class="hljs-comment">// ç§Ÿæˆ·åŠŸèƒ½å¼€å…³</span>
  headerTag?: <span class="hljs-built_in">string</span>           <span class="hljs-comment">// ç¯å¢ƒæ ‡è®°</span>
  ignoreMsgs?: <span class="hljs-built_in">string</span>[]        <span class="hljs-comment">// å¿½ç•¥çš„é”™è¯¯æ¶ˆæ¯</span>
  whiteList?: <span class="hljs-built_in">string</span>[]         <span class="hljs-comment">// æ— éœ€ Token çš„ URL</span>
  specialCodeUrls?: <span class="hljs-built_in">string</span>[]   <span class="hljs-comment">// ç‰¹æ®Š code å¤„ç†ç™½åå•</span>
  noPromptPages?: <span class="hljs-built_in">string</span>[]     <span class="hljs-comment">// æ— éœ€å¼¹çª—çš„é¡µé¢è·¯å¾„</span>
  plugins?: <span class="hljs-title class_">RequestPlugins</span>     <span class="hljs-comment">// æ’ä»¶é›†åˆ</span>
}
</code></pre>
<p><strong>å…³é”®è®¾è®¡</strong>ï¼š<code>resultCode</code> å¯é…ç½®ã€‚ä¸»åº”ç”¨ä¼  <code>200</code>ï¼Œå­åº”ç”¨å¯ä»¥ä¼  <code>0</code>ï¼ŒåŒä¸€å¥—æ‹¦æˆªå™¨é€»è¾‘é€‚é…ä¸åŒåç«¯çº¦å®šã€‚</p>
<hr/>
<h2 data-id="heading-12">ä¸‰ã€æŠ€æœ¯ç»†èŠ‚</h2>
<h3 data-id="heading-13">3.1 Token åˆ·æ–° + è¯·æ±‚é˜Ÿåˆ—</h3>
<p>è¿™æ˜¯æ•´ä¸ªå°è£…ä¸­æœ€å¤æ‚çš„éƒ¨åˆ†ã€‚å½“ Token è¿‡æœŸæ—¶ï¼Œæˆ‘ä»¬ä¸èƒ½è®©æ‰€æœ‰å¹¶å‘è¯·æ±‚éƒ½å»åˆ·æ–° Tokenï¼Œéœ€è¦ä¸€ä¸ªé˜Ÿåˆ—æœºåˆ¶ï¼š</p>
<pre><code class="hljs language-css" lang="css">æ—¶é—´çº¿ï¼š
Request <span class="hljs-selector-tag">A</span> â†’ <span class="hljs-number">401</span> â†’ å¼€å§‹åˆ·æ–° Token â†’ åˆ·æ–°æˆåŠŸ â†’ é‡è¯• <span class="hljs-selector-tag">A</span>
Request <span class="hljs-selector-tag">B</span> â†’ <span class="hljs-number">401</span> â†’ åŠ å…¥é˜Ÿåˆ—ç­‰å¾…   â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ é‡è¯• <span class="hljs-selector-tag">B</span>
Request C â†’ <span class="hljs-number">401</span> â†’ åŠ å…¥é˜Ÿåˆ—ç­‰å¾…   â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ é‡è¯• C
</code></pre>
<p>æ ¸å¿ƒå®ç°ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">let</span> isRefreshingToken = <span class="hljs-literal">false</span>
<span class="hljs-keyword">let</span> <span class="hljs-attr">requestQueue</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-function">(<span class="hljs-params">err?: <span class="hljs-built_in">any</span></span>) =&gt;</span> <span class="hljs-built_in">void</span>&gt; = []

<span class="hljs-comment">// å“åº”æ‹¦æˆªå™¨ä¸­</span>
<span class="hljs-keyword">if</span> (code === <span class="hljs-number">401</span>) {
  <span class="hljs-comment">// æ­£åœ¨åˆ·æ–°ï¼ŒåŠ å…¥é˜Ÿåˆ—</span>
  <span class="hljs-keyword">if</span> (isRefreshingToken) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
      requestQueue.<span class="hljs-title function_">push</span>(<span class="hljs-function">(<span class="hljs-params">err?: <span class="hljs-built_in">any</span></span>) =&gt;</span> {
        <span class="hljs-keyword">if</span> (err) <span class="hljs-title function_">reject</span>(err)
        <span class="hljs-keyword">else</span> <span class="hljs-title function_">resolve</span>(<span class="hljs-title function_">instance</span>(reqConfig))  <span class="hljs-comment">// ç”¨æ–° Token é‡è¯•</span>
      })
    })
  }

  <span class="hljs-comment">// æ‰§è¡Œåˆ·æ–°</span>
  <span class="hljs-keyword">try</span> {
    isRefreshingToken = <span class="hljs-literal">true</span>
    <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> instance.<span class="hljs-title function_">post</span>(refreshUrl, {
      <span class="hljs-attr">refreshToken</span>: auth.<span class="hljs-title function_">getRefreshToken</span>()
    })
    auth.<span class="hljs-title function_">setToken</span>(res.<span class="hljs-property">data</span>)
    <span class="hljs-comment">// é€šçŸ¥é˜Ÿåˆ—ä¸­çš„è¯·æ±‚é‡è¯•</span>
    requestQueue.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">cb</span> =&gt;</span> <span class="hljs-title function_">cb</span>())
    requestQueue = []
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">instance</span>(reqConfig)
  } <span class="hljs-keyword">catch</span> (e) {
    requestQueue.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">cb</span> =&gt;</span> <span class="hljs-title function_">cb</span>(e))
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">handleUnauthorized</span>()
  } <span class="hljs-keyword">finally</span> {
    requestQueue = []
    isRefreshingToken = <span class="hljs-literal">false</span>
  }
}
</code></pre>
<p><strong>æ³¨æ„ <code>finally</code> ä¸­çš„åŒé‡æ¸…ç†</strong>ï¼šå³ä½¿ <code>catch</code> ä¸­å·²ç»æ¸…ç†äº†é˜Ÿåˆ—ï¼Œ<code>finally</code> ä»ç„¶è¦å†æ¸…ä¸€æ¬¡ï¼Œé˜²æ­¢å¼‚å¸¸è·¯å¾„é—æ¼ã€‚</p>
<h3 data-id="heading-14">3.2 äºŒè¿›åˆ¶å“åº”å¤„ç†</h3>
<p>æ–‡ä»¶ä¸‹è½½æ¥å£è¿”å› <code>Blob</code>ï¼Œä½†å¦‚æœåç«¯è¿”å›äº† JSON é”™è¯¯ï¼ˆå¦‚æƒé™ä¸è¶³ï¼‰ï¼Œ<code>Blob</code> çš„ <code>type</code> ä¼šæ˜¯ <code>application/json</code>ã€‚æˆ‘ä»¬éœ€è¦æ£€æµ‹è¿™ç§æƒ…å†µï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">if</span> (response.<span class="hljs-property">request</span>.<span class="hljs-property">responseType</span> === <span class="hljs-string">'blob'</span>) {
  <span class="hljs-keyword">if</span> (data <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Blob</span> &amp;&amp; data.<span class="hljs-property">type</span>.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'application/json'</span>)) {
    <span class="hljs-keyword">const</span> text = <span class="hljs-keyword">await</span> data.<span class="hljs-title function_">text</span>()
    <span class="hljs-keyword">const</span> jsonData = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(text)
    <span class="hljs-keyword">if</span> (jsonData.<span class="hljs-property">success</span>) <span class="hljs-keyword">return</span> jsonData
    ui?.<span class="hljs-title function_">showMessage</span>(jsonData.<span class="hljs-property">msg</span> || <span class="hljs-string">'æ–‡ä»¶ä¸‹è½½å¤±è´¥'</span>, <span class="hljs-string">'error'</span>)
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(jsonData.<span class="hljs-property">msg</span>))
  }
  <span class="hljs-keyword">return</span> response.<span class="hljs-property">data</span>  <span class="hljs-comment">// æ­£å¸¸çš„ Blob</span>
}
</code></pre>
<h3 data-id="heading-15">3.3 GET å‚æ•°ç¼–ç </h3>
<p>Axios é»˜è®¤çš„ <code>params</code> åºåˆ—åŒ–å¯¹åµŒå¥—å¯¹è±¡æ”¯æŒä¸å¥½ã€‚æˆ‘ä»¬æ‰‹åŠ¨ç¼–ç ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">if</span> (reqConfig.<span class="hljs-property">method</span>?.<span class="hljs-title function_">toUpperCase</span>() === <span class="hljs-string">'GET'</span> &amp;&amp; params) {
  <span class="hljs-keyword">let</span> url = reqConfig.<span class="hljs-property">url</span> + <span class="hljs-string">'?'</span>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> propName <span class="hljs-keyword">of</span> <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(params)) {
    <span class="hljs-keyword">const</span> value = params[propName]
    <span class="hljs-keyword">if</span> (value !== <span class="hljs-built_in">void</span> <span class="hljs-number">0</span> &amp;&amp; value !== <span class="hljs-literal">null</span>) {
      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> value === <span class="hljs-string">'object'</span>) {
        <span class="hljs-comment">// åµŒå¥—å¯¹è±¡ï¼špropName[key]=value</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> val <span class="hljs-keyword">of</span> <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(value)) {
          url += <span class="hljs-built_in">encodeURIComponent</span>(propName + <span class="hljs-string">'['</span> + val + <span class="hljs-string">']'</span>) + <span class="hljs-string">'='</span>
            + <span class="hljs-built_in">encodeURIComponent</span>(value[val]) + <span class="hljs-string">'&amp;'</span>
        }
      } <span class="hljs-keyword">else</span> {
        url += <span class="hljs-string">`<span class="hljs-subst">${propName}</span>=<span class="hljs-subst">${<span class="hljs-built_in">encodeURIComponent</span>(value)}</span>&amp;`</span>
      }
    }
  }
  reqConfig.<span class="hljs-property">params</span> = {}
  reqConfig.<span class="hljs-property">url</span> = url.<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>, -<span class="hljs-number">1</span>)
}
</code></pre>
<h3 data-id="heading-16">3.4 å¯†ç è¿‡æœŸç‰¹æ®Šå¤„ç†</h3>
<p>ä¸šåŠ¡éœ€æ±‚ï¼šå¯†ç è¿‡æœŸæ—¶ï¼ˆ<code>code === 1002000016</code>ï¼‰ï¼Œä¸å¼¹é”™è¯¯æç¤ºï¼Œè€Œæ˜¯è¿”å›å®Œæ•´ response è®©ä¸šåŠ¡å±‚å¼¹å‡ºä¿®æ”¹å¯†ç å¼¹çª—ã€‚</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">if</span> (code === <span class="hljs-number">1002000016</span>) {
  <span class="hljs-keyword">return</span> response  <span class="hljs-comment">// ä¸èµ°é”™è¯¯å¤„ç†ï¼Œè®©ä¸šåŠ¡å±‚å†³å®š</span>
}
</code></pre>
<p>è¿™ç§"é€ƒç”Ÿèˆ±"è®¾è®¡åœ¨ä¼ä¸šçº§é¡¹ç›®ä¸­å¾ˆå¸¸è§â€”â€”æ€»æœ‰ä¸€äº›ç‰¹æ®Š code éœ€è¦ä¸šåŠ¡å±‚è‡ªå·±å¤„ç†ã€‚<code>specialCodeUrls</code> é…ç½®é¡¹ä¹Ÿæ˜¯åŒæ ·çš„æ€è·¯ã€‚</p>
<hr/>
<h2 data-id="heading-17">å››ã€å·¥å‚æ¨¡å¼ vs å•ä¾‹æ¨¡å¼</h2>
<h3 data-id="heading-18">4.1 ä¸ºä»€ä¹ˆä¸ç”¨å•ä¾‹ï¼Ÿ</h3>
<p>æ—©æœŸç‰ˆæœ¬æˆ‘ä»¬åœ¨ <code>packages/api</code> ä¸­å¯¼å‡ºäº†ä¸€ä¸ªå…¨å±€ <code>request</code> å•ä¾‹ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// âŒ å•ä¾‹æ¨¡å¼ â€” æœ‰é—®é¢˜</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> request = <span class="hljs-title function_">createRequest</span>({ <span class="hljs-attr">baseURL</span>: <span class="hljs-string">''</span>, <span class="hljs-attr">timeout</span>: <span class="hljs-number">30000</span> })
</code></pre>
<p>é—®é¢˜ï¼š</p>
<ol>
<li><strong>é…ç½®æ— æ³•å·®å¼‚åŒ–</strong>ï¼šä¸»åº”ç”¨å’Œå­åº”ç”¨çš„ <code>baseURL</code>ã€<code>resultCode</code>ã€<code>timeout</code> å¯èƒ½ä¸åŒ</li>
<li><strong>æ’ä»¶æ— æ³•æ³¨å…¥</strong>ï¼šå•ä¾‹åœ¨æ¨¡å—åŠ è½½æ—¶å°±åˆ›å»ºäº†ï¼Œæ­¤æ—¶ Element Plusã€i18n è¿˜æ²¡åˆå§‹åŒ–</li>
<li><strong>æµ‹è¯•å›°éš¾</strong>ï¼šæ— æ³•ä¸ºä¸åŒæµ‹è¯•ç”¨ä¾‹åˆ›å»ºç‹¬ç«‹çš„å®ä¾‹</li>
</ol>
<h3 data-id="heading-19">4.2 å·¥å‚æ¨¡å¼</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// âœ… å·¥å‚æ¨¡å¼</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">createRequest</span> = (<span class="hljs-params">config: RequestConfig</span>) =&gt; { ... }
</code></pre>
<p>æ¯ä¸ªåº”ç”¨åœ¨è‡ªå·±çš„å…¥å£æ–‡ä»¶ä¸­è°ƒç”¨ <code>createRequest()</code>ï¼Œä¼ å…¥è‡ªå·±çš„é…ç½®å’Œæ’ä»¶ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// apps/main/src/config/axios/index.ts â€” ä»… 64 è¡Œ</span>
<span class="hljs-keyword">import</span> { createRequest } <span class="hljs-keyword">from</span> <span class="hljs-string">'@cmclink/api'</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">ElMessage</span>, <span class="hljs-title class_">ElMessageBox</span>, <span class="hljs-title class_">ElNotification</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'element-plus'</span>
<span class="hljs-keyword">import</span> { i18n } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/plugins/vueI18n'</span>
<span class="hljs-keyword">import</span> { getAccessToken, getRefreshToken, ... } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/utils/auth'</span>

<span class="hljs-keyword">const</span> request = <span class="hljs-title function_">createRequest</span>({
  <span class="hljs-attr">baseURL</span>: <span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">env</span>.<span class="hljs-property">VITE_API_URL</span>,
  <span class="hljs-attr">timeout</span>: <span class="hljs-number">30000</span>,
  <span class="hljs-attr">resultCode</span>: <span class="hljs-number">200</span>,
  <span class="hljs-attr">plugins</span>: {
    <span class="hljs-attr">auth</span>: { getAccessToken, getRefreshToken, ... },
    <span class="hljs-attr">i18n</span>: { <span class="hljs-attr">getLocale</span>: <span class="hljs-function">() =&gt;</span> i18n.<span class="hljs-property">global</span>.<span class="hljs-property">locale</span>.<span class="hljs-property">value</span>, <span class="hljs-attr">t</span>: <span class="hljs-function">(<span class="hljs-params">k</span>) =&gt;</span> i18n.<span class="hljs-property">global</span>.<span class="hljs-title function_">t</span>(k) },
    <span class="hljs-attr">ui</span>: { <span class="hljs-attr">showMessage</span>: <span class="hljs-function">(<span class="hljs-params">msg, <span class="hljs-keyword">type</span></span>) =&gt;</span> <span class="hljs-title class_">ElMessage</span>[<span class="hljs-keyword">type</span>](msg), ... },
    <span class="hljs-attr">logout</span>: { <span class="hljs-attr">onUnauthorized</span>: <span class="hljs-function">() =&gt;</span> { <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">href</span> = <span class="hljs-string">'/login'</span> } }
  }
})

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> request
</code></pre>
<p><strong>ä» 336 è¡Œåˆ° 64 è¡Œ</strong>ï¼Œå‡å°‘ 81%ï¼Œä¸”æ‰€æœ‰ä¸šåŠ¡é€»è¾‘éƒ½åœ¨è°ƒç”¨æ–¹å¯è§ã€‚</p>
<h3 data-id="heading-20">4.3 API æ¨¡å—ä¹Ÿç”¨å·¥å‚</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// packages/api/src/modules/auth.ts</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">createAuthApi</span> = (<span class="hljs-params">request: RequestInstance</span>) =&gt; ({
  <span class="hljs-attr">login</span>: <span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> request.<span class="hljs-title function_">post</span>({ <span class="hljs-attr">url</span>: <span class="hljs-string">'/system/v1/auth/login'</span>, data }),
  <span class="hljs-attr">logout</span>: <span class="hljs-function">() =&gt;</span> request.<span class="hljs-title function_">post</span>({ <span class="hljs-attr">url</span>: <span class="hljs-string">'/system/v1/auth/logout'</span> }),
})

<span class="hljs-comment">// å­åº”ç”¨ä½¿ç”¨</span>
<span class="hljs-keyword">import</span> { createRequest, createAuthApi } <span class="hljs-keyword">from</span> <span class="hljs-string">'@cmclink/api'</span>
<span class="hljs-keyword">const</span> request = <span class="hljs-title function_">createRequest</span>({ ... })
<span class="hljs-keyword">const</span> authApi = <span class="hljs-title function_">createAuthApi</span>(request)
<span class="hljs-keyword">await</span> authApi.<span class="hljs-title function_">login</span>({ <span class="hljs-attr">username</span>: <span class="hljs-string">'admin'</span>, <span class="hljs-attr">password</span>: <span class="hljs-string">'123'</span> })
</code></pre>
<hr/>
<h2 data-id="heading-21">äº”ã€è¿ç§»ç­–ç•¥ï¼šæ¸è¿›å¼æ›¿æ¢</h2>
<h3 data-id="heading-22">5.1 å…¼å®¹æ€§è®¾è®¡</h3>
<p>æ–°çš„ <code>createRequest()</code> è¿”å›çš„æ–¹æ³•ç­¾åä¸æ—§çš„ <code>config/axios/index.ts</code> <strong>å®Œå…¨ä¸€è‡´</strong>ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// æ—§ APIï¼ˆoption-object é£æ ¼ï¼‰</span>
request.<span class="hljs-title function_">get</span>({ <span class="hljs-attr">url</span>: <span class="hljs-string">'/api/users'</span>, <span class="hljs-attr">params</span>: { <span class="hljs-attr">page</span>: <span class="hljs-number">1</span> } })
request.<span class="hljs-title function_">post</span>({ <span class="hljs-attr">url</span>: <span class="hljs-string">'/api/users'</span>, <span class="hljs-attr">data</span>: { <span class="hljs-attr">name</span>: <span class="hljs-string">'test'</span> } })
request.<span class="hljs-title function_">upload</span>({ <span class="hljs-attr">url</span>: <span class="hljs-string">'/api/file'</span>, <span class="hljs-attr">data</span>: formData })

<span class="hljs-comment">// æ–° API â€” å®Œå…¨ç›¸åŒ</span>
request.<span class="hljs-title function_">get</span>({ <span class="hljs-attr">url</span>: <span class="hljs-string">'/api/users'</span>, <span class="hljs-attr">params</span>: { <span class="hljs-attr">page</span>: <span class="hljs-number">1</span> } })
request.<span class="hljs-title function_">post</span>({ <span class="hljs-attr">url</span>: <span class="hljs-string">'/api/users'</span>, <span class="hljs-attr">data</span>: { <span class="hljs-attr">name</span>: <span class="hljs-string">'test'</span> } })
request.<span class="hljs-title function_">upload</span>({ <span class="hljs-attr">url</span>: <span class="hljs-string">'/api/file'</span>, <span class="hljs-attr">data</span>: formData })
</code></pre>
<p>è¿™æ„å‘³ç€ <strong>62 ä¸ª API æ–‡ä»¶é›¶æ”¹åŠ¨</strong>ã€‚å®ƒä»¬ä»ç„¶ <code>import request from '@/config/axios'</code>ï¼Œåªæ˜¯åº•å±‚å®ç°æ¢äº†ã€‚</p>
<h3 data-id="heading-23">5.2 ç±»å‹å…±äº«</h3>
<p>å…¬å…±ç±»å‹ï¼ˆ<code>DictDataVO</code>ã€<code>FileUploadReqVO</code>ã€<code>UserVO</code>ï¼‰è¿ç§»åˆ° <code>@cmclink/api</code>ï¼Œä¸»åº”ç”¨æ”¹ä¸º re-exportï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// apps/main/src/api/system/dict/dict.data.ts</span>
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">DictDataVO</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@cmclink/api'</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">DictDataVO</span> }  <span class="hljs-comment">// re-exportï¼Œæ¶ˆè´¹æ–¹æ— æ„ŸçŸ¥</span>
</code></pre>
<p>å­åº”ç”¨å¯ä»¥ç›´æ¥ä» <code>@cmclink/api</code> å¯¼å…¥ç±»å‹ï¼Œæ— éœ€é‡å¤å®šä¹‰ã€‚</p>
<h3 data-id="heading-24">5.3 æ¸è¿›å¼è·¯çº¿</h3>









































<table><thead><tr><th>é˜¶æ®µ</th><th>æ”¹åŠ¨èŒƒå›´</th><th>é£é™©</th><th>å¯¹æ¶ˆè´¹æ–¹å½±å“</th></tr></thead><tbody><tr><td>Phase 1</td><td>æ¸…ç†å†—ä½™ API</td><td>ä½</td><td>æ— </td></tr><tr><td>Phase 2</td><td>é‡å†™ <code>packages/api/request.ts</code></td><td>ä½</td><td>æ— ï¼ˆæ–°ä»£ç ï¼‰</td></tr><tr><td>Phase 3</td><td>æ›¿æ¢ <code>config/axios/index.ts</code></td><td><strong>ä¸­</strong></td><td>æ— ï¼ˆæ¥å£ä¸å˜ï¼‰</td></tr><tr><td>Phase 4</td><td>ç±»å‹è¿ç§»åˆ°å…±äº«åŒ…</td><td>ä½</td><td>æ— ï¼ˆre-exportï¼‰</td></tr><tr><td>Phase 5</td><td>å­åº”ç”¨æ¥å…¥</td><td>ä½</td><td>æ–°åº”ç”¨ç›´æ¥ç”¨</td></tr></tbody></table>
<p><strong>Phase 3 æ˜¯é£é™©æœ€é«˜çš„ä¸€æ­¥</strong>â€”â€”æ›¿æ¢äº†è¯·æ±‚å±‚çš„æ ¸å¿ƒå®ç°ã€‚ä½†ç”±äºæ¥å£ç­¾åå®Œå…¨å…¼å®¹ï¼Œå®é™…å½±å“èŒƒå›´å¯æ§ã€‚å»ºè®®åœ¨æ›¿æ¢ååšä»¥ä¸‹éªŒè¯ï¼š</p>
<ol>
<li>ç™»å½• â†’ è·å– Token â†’ é¡µé¢è·³è½¬</li>
<li>Token è¿‡æœŸ â†’ è‡ªåŠ¨åˆ·æ–° â†’ è¯·æ±‚é‡è¯•</li>
<li>åˆ·æ–° Token è¿‡æœŸ â†’ å¼¹çª—æç¤ºé‡æ–°ç™»å½•</li>
<li>æ–‡ä»¶ä¸‹è½½ï¼ˆBlob å“åº”ï¼‰</li>
<li>æ–‡ä»¶ä¸Šä¼ ï¼ˆmultipart/form-dataï¼‰</li>
<li>å¤šè¯­è¨€åˆ‡æ¢åè¯·æ±‚å¤´ <code>Accept-Language</code> å˜åŒ–</li>
</ol>
<hr/>
<h2 data-id="heading-25">å…­ã€å­åº”ç”¨æ¥å…¥æŒ‡å—</h2>
<h3 data-id="heading-26">6.1 å®‰è£…ä¾èµ–</h3>
<pre><code class="hljs language-bash" lang="bash">pnpm add @cmclink/api
</code></pre>
<h3 data-id="heading-27">6.2 åˆ›å»ºè¯·æ±‚å®ä¾‹</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// src/request.ts</span>
<span class="hljs-keyword">import</span> { createRequest } <span class="hljs-keyword">from</span> <span class="hljs-string">'@cmclink/api'</span>

<span class="hljs-keyword">const</span> request = <span class="hljs-title function_">createRequest</span>({
  <span class="hljs-attr">baseURL</span>: <span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">env</span>.<span class="hljs-property">VITE_API_URL</span>,
  <span class="hljs-attr">timeout</span>: <span class="hljs-number">30000</span>,
  <span class="hljs-attr">resultCode</span>: <span class="hljs-number">200</span>,  <span class="hljs-comment">// æ ¹æ®åç«¯çº¦å®šè°ƒæ•´</span>

  <span class="hljs-attr">plugins</span>: {
    <span class="hljs-attr">auth</span>: {
      <span class="hljs-comment">// å¾®å‰ç«¯åœºæ™¯ï¼šä»ä¸»åº”ç”¨è·å– Token</span>
      <span class="hljs-attr">getAccessToken</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">window</span>.<span class="hljs-property">__MICRO_APP_TOKEN__</span>?.<span class="hljs-property">accessToken</span> || <span class="hljs-literal">null</span>,
      <span class="hljs-attr">getRefreshToken</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">window</span>.<span class="hljs-property">__MICRO_APP_TOKEN__</span>?.<span class="hljs-property">refreshToken</span> || <span class="hljs-literal">null</span>,
      <span class="hljs-attr">setToken</span>: <span class="hljs-function">(<span class="hljs-params">token</span>) =&gt;</span> { <span class="hljs-variable language_">window</span>.<span class="hljs-property">__MICRO_APP_TOKEN__</span> = token },
      <span class="hljs-attr">removeToken</span>: <span class="hljs-function">() =&gt;</span> { <span class="hljs-variable language_">window</span>.<span class="hljs-property">__MICRO_APP_TOKEN__</span> = <span class="hljs-literal">null</span> },
    },
    <span class="hljs-comment">// i18n å’Œ ui æ ¹æ®å­åº”ç”¨æŠ€æœ¯æ ˆæ³¨å…¥</span>
    <span class="hljs-attr">i18n</span>: {
      <span class="hljs-attr">getLocale</span>: <span class="hljs-function">() =&gt;</span> navigator.<span class="hljs-property">language</span>,
      <span class="hljs-attr">t</span>: <span class="hljs-function">(<span class="hljs-params">key</span>) =&gt;</span> key,  <span class="hljs-comment">// å­åº”ç”¨å¯ä»¥ä¸åšå›½é™…åŒ–</span>
    },
    <span class="hljs-attr">ui</span>: {
      <span class="hljs-attr">showMessage</span>: <span class="hljs-function">(<span class="hljs-params">msg, <span class="hljs-keyword">type</span></span>) =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">`[<span class="hljs-subst">${<span class="hljs-keyword">type</span>}</span>] <span class="hljs-subst">${msg}</span>`</span>),
      <span class="hljs-attr">showConfirm</span>: <span class="hljs-function">(<span class="hljs-params">msg</span>) =&gt;</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-title function_">confirm</span>(msg)),
      <span class="hljs-attr">showNotification</span>: <span class="hljs-function">(<span class="hljs-params">msg, <span class="hljs-keyword">type</span></span>) =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">`[<span class="hljs-subst">${<span class="hljs-keyword">type</span>}</span>] <span class="hljs-subst">${msg}</span>`</span>),
    },
    <span class="hljs-attr">logout</span>: {
      <span class="hljs-attr">onUnauthorized</span>: <span class="hljs-function">() =&gt;</span> {
        <span class="hljs-comment">// é€šçŸ¥ä¸»åº”ç”¨è·³è½¬ç™»å½•é¡µ</span>
        <span class="hljs-variable language_">window</span>.<span class="hljs-property">parent</span>.<span class="hljs-title function_">postMessage</span>({ <span class="hljs-attr">type</span>: <span class="hljs-string">'UNAUTHORIZED'</span> }, <span class="hljs-string">'*'</span>)
      },
    },
  },
})

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> request
</code></pre>
<h3 data-id="heading-28">6.3 ä½¿ç”¨å…±äº« API æ¨¡å—</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { createSystemApi } <span class="hljs-keyword">from</span> <span class="hljs-string">'@cmclink/api'</span>
<span class="hljs-keyword">import</span> request <span class="hljs-keyword">from</span> <span class="hljs-string">'./request'</span>

<span class="hljs-keyword">const</span> systemApi = <span class="hljs-title function_">createSystemApi</span>(request)

<span class="hljs-comment">// è·å–å­—å…¸æ•°æ®</span>
<span class="hljs-keyword">const</span> dictList = <span class="hljs-keyword">await</span> systemApi.<span class="hljs-title function_">listSimpleDictData</span>()

<span class="hljs-comment">// ä¸Šä¼ æ–‡ä»¶</span>
<span class="hljs-keyword">await</span> systemApi.<span class="hljs-title function_">uploadFile</span>({ file, <span class="hljs-attr">innerServiceName</span>: <span class="hljs-string">'bdt'</span>, <span class="hljs-attr">fileBusinessPoint</span>: <span class="hljs-string">'avatar'</span> })
</code></pre>
<h3 data-id="heading-29">6.4 ä½¿ç”¨å…±äº«ç±»å‹</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">DictDataVO</span>, <span class="hljs-title class_">FileUploadReqVO</span>, <span class="hljs-title class_">SystemUserVO</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@cmclink/api'</span>

<span class="hljs-keyword">const</span> <span class="hljs-attr">dict</span>: <span class="hljs-title class_">DictDataVO</span> = { ... }
</code></pre>
<hr/>
<h2 data-id="heading-30">ä¸ƒã€æ€»ç»“</h2>
<h3 data-id="heading-31">è®¾è®¡åŸåˆ™å›é¡¾</h3>





























<table><thead><tr><th>åŸåˆ™</th><th>ä½“ç°</th></tr></thead><tbody><tr><td><strong>ä¾èµ–å€’ç½®ï¼ˆDIPï¼‰</strong></td><td>Axios å°è£…ä¾èµ–æ’ä»¶æ¥å£ï¼Œä¸ä¾èµ–å…·ä½“ UI åº“</td></tr><tr><td><strong>æ¥å£éš”ç¦»ï¼ˆISPï¼‰</strong></td><td>4 ä¸ªå°æ¥å£è€Œé 1 ä¸ªå¤§æ¥å£</td></tr><tr><td><strong>å¼€é—­åŸåˆ™ï¼ˆOCPï¼‰</strong></td><td>æ–°å¢é”™è¯¯å¤„ç†é€»è¾‘åªéœ€æ‰©å±•æ’ä»¶ï¼Œä¸ä¿®æ”¹æ ¸å¿ƒ</td></tr><tr><td><strong>å•ä¸€èŒè´£ï¼ˆSRPï¼‰</strong></td><td>æ¯ä¸ªæ’ä»¶åªè´Ÿè´£ä¸€ä¸ªå…³åˆ‡ç‚¹</td></tr><tr><td><strong>å·¥å‚æ¨¡å¼</strong></td><td><code>createRequest()</code> æ”¯æŒå¤šå®ä¾‹ã€å·®å¼‚åŒ–é…ç½®</td></tr></tbody></table>
<h3 data-id="heading-32">æ•°æ®å¯¹æ¯”</h3>






























<table><thead><tr><th>æŒ‡æ ‡</th><th>é‡æ„å‰</th><th>é‡æ„å</th></tr></thead><tbody><tr><td>main <code>config/axios/</code> ä»£ç é‡</td><td>5 ä¸ªæ–‡ä»¶ï¼Œ~450 è¡Œ</td><td>2 ä¸ªæ–‡ä»¶ï¼Œ~74 è¡Œ</td></tr><tr><td>åº”ç”¨çº§ä¾èµ–</td><td>4 ä¸ªï¼ˆElement Plus, i18n, auth, configï¼‰</td><td>0 ä¸ªï¼ˆå…¨éƒ¨é€šè¿‡æ’ä»¶æ³¨å…¥ï¼‰</td></tr><tr><td>å­åº”ç”¨å¤ç”¨æˆæœ¬</td><td>å¤åˆ¶ç²˜è´´ + é€‚é…</td><td><code>pnpm add @cmclink/api</code> + 64 è¡Œé…ç½®</td></tr><tr><td>ç±»å‹å…±äº«</td><td>å„åº”ç”¨é‡å¤å®šä¹‰</td><td><code>import type { ... } from '@cmclink/api'</code></td></tr></tbody></table>
<h3 data-id="heading-33">ä¸€å¥è¯æ€»ç»“</h3>
<blockquote>
<p><strong>æŠŠ Axios æ‹¦æˆªå™¨ä¸­çš„ã€Œåšä»€ä¹ˆã€å’Œã€Œæ€ä¹ˆåšã€åˆ†ç¦»ï¼š<code>@cmclink/api</code> å®šä¹‰ã€Œåšä»€ä¹ˆã€ï¼ˆToken æ³¨å…¥ã€é”™è¯¯å¤„ç†ã€åˆ·æ–°é˜Ÿåˆ—ï¼‰ï¼Œåº”ç”¨å±‚é€šè¿‡æ’ä»¶å‘Šè¯‰å®ƒã€Œæ€ä¹ˆåšã€ï¼ˆç”¨ ElMessage è¿˜æ˜¯ console.warnï¼Œä» localStorage è¿˜æ˜¯ sessionStorage è¯» Tokenï¼‰ã€‚</strong></p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å•æœåŠ¡å™¨Docker Redisç¼“å­˜é›†ç¾¤æ­å»ºåŠSpring Booté€‚é…å®è·µ]]></title>    <link>https://juejin.cn/post/7604761524976877577</link>    <guid>https://juejin.cn/post/7604761524976877577</guid>    <pubDate>2026-02-10T04:03:57.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604761524976877577" data-draft-id="7604761524976861193" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å•æœåŠ¡å™¨Docker Redisç¼“å­˜é›†ç¾¤æ­å»ºåŠSpring Booté€‚é…å®è·µ"/> <meta itemprop="keywords" content="Redis"/> <meta itemprop="datePublished" content="2026-02-10T04:03:57.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å…‰è›‹"/> <meta itemprop="url" content="https://juejin.cn/user/3537560778573467"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å•æœåŠ¡å™¨Docker Redisç¼“å­˜é›†ç¾¤æ­å»ºåŠSpring Booté€‚é…å®è·µ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3537560778573467/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å…‰è›‹
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T04:03:57.000Z" title="Tue Feb 10 2026 04:03:57 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    10
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»10åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å•æœåŠ¡å™¨Docker Redisç¼“å­˜é›†ç¾¤æ­å»ºåŠSpring Booté€‚é…å®è·µ</h2>
<p>ç¼“å­˜æ˜¯å¾®æœåŠ¡æ¶æ„ä¸­æå‡æ€§èƒ½ã€å‡è½»æ•°æ®åº“å‹åŠ›çš„æ ¸å¿ƒï¼ŒRediså‡­å€Ÿé«˜æ€§èƒ½æˆä¸ºä¸»æµæ–¹æ¡ˆã€‚å•èŠ‚ç‚¹Rediså­˜åœ¨å•ç‚¹æ•…éšœé£é™©ï¼Œä¸»ä»+å“¨å…µé›†ç¾¤å¯å®ç°è¯»å†™åˆ†ç¦»ä¸æ•…éšœè‡ªåŠ¨è½¬ç§»ï¼Œä¿éšœé«˜å¯ç”¨ã€‚</p>
<p>æœ¬æ–‡é’ˆå¯¹ä¸­å°å‹é¡¹ç›®å•æœåŠ¡å™¨åœºæ™¯ï¼Œè¯¦ç»†ä»‹ç»Dockerå®¹å™¨åŒ–æ­å»ºRedisä¸»ä»+å“¨å…µé›†ç¾¤ï¼ˆç»Ÿä¸€ç›®å½•è¿ç»´ï¼‰ã€Spring Bootç”¨æˆ·ç¼“å­˜é€‚é…ï¼Œè¡¥å……ç¼“å­˜ä¸‰å¤§å¼‚å¸¸è§£å†³æ–¹æ¡ˆåŠæ•…éšœæ’æŸ¥ï¼ŒåŠ©åŠ›å¿«é€Ÿè½åœ°ç”Ÿäº§çº§ç¼“å­˜æ¶æ„ã€‚</p>
<p><strong>æ‘˜è¦</strong>ï¼šé’ˆå¯¹å•æœåŠ¡å™¨éƒ¨ç½²åœºæ™¯ï¼Œæå‡ºDockerå®¹å™¨åŒ–Redisä¸»ä»+å“¨å…µé›†ç¾¤æ–¹æ¡ˆï¼Œè§£å†³å•ç‚¹æ•…éšœã€IPåŠ¨æ€å˜åŒ–ã€é…ç½®å…¼å®¹ç­‰é—®é¢˜ï¼›å®ç°Spring Bootç¼“å­˜æœåŠ¡é€‚é…ï¼Œæä¾›ç¼“å­˜ç©¿é€ã€å‡»ç©¿ã€é›ªå´©è§£å†³æ–¹æ¡ˆï¼Œé€šè¿‡éªŒè¯ç¡®ä¿é›†ç¾¤é«˜å¯ç”¨ã€‚æ–¹æ¡ˆéƒ¨ç½²ç®€å•ã€è¿ç»´ä¾¿æ·ï¼Œé€‚ç”¨äºä¸­å°å‹é¡¹ç›®ç”Ÿäº§è½åœ°ã€‚</p>
<p><strong>å…³é”®è¯</strong>ï¼šDockerï¼›Redisä¸»ä»é›†ç¾¤ï¼›Rediså“¨å…µï¼›Spring Bootï¼›ç¼“å­˜é€‚é…</p>
<hr/>
<h3 data-id="heading-1">ä¸€ã€å•æœåŠ¡å™¨Dockeræ­å»ºRedisä¸»ä»+å“¨å…µé›†ç¾¤ï¼ˆç›®å½•ç»Ÿä¸€ç®¡ç†ï¼‰</h3>
<h4 data-id="heading-2">1. é›†ç¾¤è®¾è®¡æ€è·¯</h4>
<p>å•æœåŠ¡å™¨é‡‡ç”¨â€œä¸åŒç«¯å£æ¨¡æ‹Ÿå¤šèŠ‚ç‚¹â€ï¼Œç»“åˆDocker Composeä¸€é”®ç¼–æ’ï¼Œæ‰€æœ‰é›†ç¾¤ç›®å½•ç»Ÿä¸€è‡³<code>/docker/redis-ha-docker</code>ï¼Œç®€åŒ–è¿ç»´ã€‚èŠ‚ç‚¹è§„åˆ’è´´åˆç”Ÿäº§ç«¯å£è§„èŒƒï¼Œå…·ä½“å¦‚ä¸‹ï¼š</p>
<ul>
<li>ä¸»èŠ‚ç‚¹ï¼ˆmasterï¼‰ï¼š6379ç«¯å£ï¼ˆæ ¸å¿ƒå†™èŠ‚ç‚¹ï¼ŒåŒæ­¥æ•°æ®è‡³ä»èŠ‚ç‚¹ï¼Œè´Ÿè´£æ•°æ®æŒä¹…åŒ–ï¼‰</li>
<li>ä»èŠ‚ç‚¹1ï¼ˆslave1ï¼‰ï¼š6380ç«¯å£ï¼›ä»èŠ‚ç‚¹2ï¼ˆslave2ï¼‰ï¼š6381ç«¯å£ï¼ˆå‡ä¸ºè¯»èŠ‚ç‚¹ï¼Œåˆ†æ‹…å¹¶å‘ã€å†—ä½™å¤‡ä»½ï¼‰</li>
<li>å“¨å…µ1-3ï¼šç«¯å£26379ã€26380ã€26381ï¼ˆç›‘æ§èŠ‚ç‚¹ï¼ŒååŒåˆ¤æ–­æ•…éšœã€æ‰§è¡Œæ•…éšœè½¬ç§»ï¼Œæ»¡è¶³quorum=2ï¼‰</li>
</ul>
<p>æ ¸å¿ƒä¼˜åŠ¿ï¼šå“¨å…µå†—ä½™é¿å…ç›‘æ§å¤±æ•ˆï¼›ä¸»ä»è¯»å†™åˆ†ç¦»æå‡å¹¶å‘ï¼›Dockerç¯å¢ƒéš”ç¦»ï¼›ç›®å½•ç»Ÿä¸€ä¾¿äºè¿ç»´ï¼›é€‚é…ä¸»èŠ‚ç‚¹IPåŠ¨æ€å˜åŒ–ï¼Œè§£å†³å®¹å™¨é‡å¯å¤±è”é—®é¢˜ã€‚</p>
<h4 data-id="heading-3">2. ç¯å¢ƒå‡†å¤‡</h4>
<p>ç¡®ä¿æœåŠ¡å™¨æ»¡è¶³ä»¥ä¸‹è¦æ±‚ï¼Œé¿å…éƒ¨ç½²å¤±è´¥ï¼š</p>
<ul>
<li>ç³»ç»Ÿï¼šCentOS 7/8æˆ–Ubuntu 20.04+ï¼Œå†…å­˜â‰¥2GBï¼›</li>
<li>ç»„ä»¶ï¼šDockerâ‰¥20.10ã€Docker Composeâ‰¥2.10ï¼Œå¯åŠ¨å¹¶è®¾ç½®å¼€æœºè‡ªå¯ï¼›</li>
<li>ç«¯å£ï¼šæ”¾è¡Œ6379ã€6380ã€6381ã€26379ã€26380ã€26381ï¼ˆé˜²ç«å¢™ã€å®‰å…¨ç»„åŒæ­¥é…ç½®ï¼‰ï¼›</li>
<li>ç›®å½•ï¼šæ‰§è¡Œå‘½ä»¤åˆ›å»ºç»Ÿä¸€ç»“æ„ï¼Œè·¯å¾„å¯è°ƒæ•´ä½†éœ€ä¿æŒåç»­é…ç½®ä¸€è‡´ï¼š</li>
</ul>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">mkdir</span> -p /docker/redis-ha-docker/{master,slave1,slave2,sentinel1,sentinel2,sentinel3}
<span class="hljs-built_in">cd</span> /docker/redis-ha-docker
</code></pre>
<h4 data-id="heading-4">3. ç¼–å†™Docker Composeæ–‡ä»¶ï¼ˆæ ¸å¿ƒç¼–æ’ï¼‰</h4>
<p>åœ¨é›†ç¾¤æ ¹ç›®å½•åˆ›å»º<code>docker-compose.yml</code>ï¼Œé€‚é…Redis 7.0.15ï¼Œæ ¸å¿ƒè§£å†³ä¸»èŠ‚ç‚¹IPåŠ¨æ€å˜åŒ–é—®é¢˜ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">'3.8'</span>

<span class="hljs-attr">services:</span>
  <span class="hljs-comment"># ä¸»èŠ‚ç‚¹</span>
  <span class="hljs-attr">redis-master:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">redis:7.0-alpine</span>
    <span class="hljs-attr">container_name:</span> <span class="hljs-string">redis-master</span>
    <span class="hljs-attr">ports:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"6379:6379"</span>
    <span class="hljs-attr">volumes:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">./master/redis.conf:/etc/redis/redis.conf</span>  <span class="hljs-comment"># è·¯å¾„å¯¹åº”redis-ha-dockerä¸‹çš„masterç›®å½•</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">./master/data:/data</span>
    <span class="hljs-attr">command:</span> <span class="hljs-string">redis-server</span> <span class="hljs-string">/etc/redis/redis.conf</span>
    <span class="hljs-attr">restart:</span> <span class="hljs-string">always</span>
    <span class="hljs-attr">networks:</span>
      <span class="hljs-attr">redis-network:</span>
        <span class="hljs-attr">aliases:</span>
          <span class="hljs-bullet">-</span> <span class="hljs-string">redis-master</span>  

  <span class="hljs-comment"># ä»èŠ‚ç‚¹1</span>
  <span class="hljs-attr">redis-slave1:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">redis:7.0-alpine</span>
    <span class="hljs-attr">container_name:</span> <span class="hljs-string">redis-slave1</span>
    <span class="hljs-attr">ports:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"6380:6379"</span>
    <span class="hljs-attr">volumes:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">./slave1/redis.conf:/etc/redis/redis.conf</span>  <span class="hljs-comment"># è·¯å¾„å¯¹åº”redis-ha-dockerä¸‹çš„slave1ç›®å½•</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">./slave1/data:/data</span>
    <span class="hljs-attr">command:</span> <span class="hljs-string">redis-server</span> <span class="hljs-string">/etc/redis/redis.conf</span>
    <span class="hljs-attr">restart:</span> <span class="hljs-string">always</span>
    <span class="hljs-attr">depends_on:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">redis-master</span>
    <span class="hljs-attr">networks:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">redis-network</span>

  <span class="hljs-comment"># ä»èŠ‚ç‚¹2</span>
  <span class="hljs-attr">redis-slave2:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">redis:7.0-alpine</span>
    <span class="hljs-attr">container_name:</span> <span class="hljs-string">redis-slave2</span>
    <span class="hljs-attr">ports:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"6381:6379"</span>
    <span class="hljs-attr">volumes:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">./slave2/redis.conf:/etc/redis/redis.conf</span>  <span class="hljs-comment"># è·¯å¾„å¯¹åº”redis-ha-dockerä¸‹çš„slave2ç›®å½•</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">./slave2/data:/data</span>
    <span class="hljs-attr">command:</span> <span class="hljs-string">redis-server</span> <span class="hljs-string">/etc/redis/redis.conf</span>
    <span class="hljs-attr">restart:</span> <span class="hljs-string">always</span>
    <span class="hljs-attr">depends_on:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">redis-master</span>
    <span class="hljs-attr">networks:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">redis-network</span>

  <span class="hljs-comment"># å“¨å…µ1 æ ¸å¿ƒé€»è¾‘ï¼š1ä¸ªå“¨å…µæ£€æµ‹åˆ°ä¸»èŠ‚ç‚¹æ•…éšœâ†’æ ‡è®°ä¸»è§‚ä¸‹çº¿â†’è¯¢é—®å…¶ä»–å“¨å…µâ†’â‰¥2ä¸ªå“¨å…µç¡®è®¤â†’æ ‡è®°å®¢è§‚ä¸‹çº¿â†’é€‰ä¸¾1ä¸ªä¸»å¯¼å“¨å…µæ‰§è¡Œæ•…éšœè½¬ç§»</span>
  <span class="hljs-attr">redis-sentinel1:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">redis:7.0-alpine</span>
    <span class="hljs-attr">container_name:</span> <span class="hljs-string">redis-sentinel1</span>
    <span class="hljs-attr">ports:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"26379:26379"</span>
    <span class="hljs-attr">volumes:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">./sentinel1/sentinel.conf:/etc/redis/sentinel.conf</span>  <span class="hljs-comment"># è·¯å¾„å¯¹åº”redis-ha-dockerä¸‹çš„sentinel1ç›®å½•</span>
    <span class="hljs-attr">command:</span> <span class="hljs-string">redis-sentinel</span> <span class="hljs-string">/etc/redis/sentinel.conf</span>
    <span class="hljs-attr">restart:</span> <span class="hljs-string">always</span>
    <span class="hljs-attr">depends_on:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">redis-master</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">redis-slave1</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">redis-slave2</span>
    <span class="hljs-attr">networks:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">redis-network</span>

  <span class="hljs-comment"># å“¨å…µ2ï¼ˆä¸å“¨å…µ1ã€3é…ç½®ä¸€è‡´ï¼Œå‚ä¸æŠ•ç¥¨åå•†ï¼Œä¸å•ç‹¬è§¦å‘æ•…éšœè½¬ç§»ï¼‰</span>
  <span class="hljs-attr">redis-sentinel2:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">redis:7.0-alpine</span>
    <span class="hljs-attr">container_name:</span> <span class="hljs-string">redis-sentinel2</span>
    <span class="hljs-attr">ports:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"26380:26379"</span>
    <span class="hljs-attr">volumes:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">./sentinel2/sentinel.conf:/etc/redis/sentinel.conf</span>  <span class="hljs-comment"># è·¯å¾„å¯¹åº”redis-ha-dockerä¸‹çš„sentinel2ç›®å½•</span>
    <span class="hljs-attr">command:</span> <span class="hljs-string">redis-sentinel</span> <span class="hljs-string">/etc/redis/sentinel.conf</span>
    <span class="hljs-attr">restart:</span> <span class="hljs-string">always</span>
    <span class="hljs-attr">depends_on:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">redis-master</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">redis-slave1</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">redis-slave2</span>
    <span class="hljs-attr">networks:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">redis-network</span>

  <span class="hljs-comment"># å“¨å…µ3ï¼ˆä¸å“¨å…µ1ã€2é…ç½®ä¸€è‡´ï¼Œquorum=2ï¼Œéœ€è‡³å°‘2ä¸ªå“¨å…µç¡®è®¤ä¸»èŠ‚ç‚¹æ•…éšœæ‰è§¦å‘è½¬ç§»ï¼‰</span>
  <span class="hljs-attr">redis-sentinel3:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">redis:7.0-alpine</span>
    <span class="hljs-attr">container_name:</span> <span class="hljs-string">redis-sentinel3</span>
    <span class="hljs-attr">ports:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"26381:26379"</span>
    <span class="hljs-attr">volumes:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">./sentinel3/sentinel.conf:/etc/redis/sentinel.conf</span>  <span class="hljs-comment"># è·¯å¾„å¯¹åº”redis-ha-dockerä¸‹çš„sentinel3ç›®å½•</span>
    <span class="hljs-attr">command:</span> <span class="hljs-string">redis-sentinel</span> <span class="hljs-string">/etc/redis/sentinel.conf</span>
    <span class="hljs-attr">restart:</span> <span class="hljs-string">always</span>
    <span class="hljs-attr">depends_on:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">redis-master</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">redis-slave1</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">redis-slave2</span>
    <span class="hljs-attr">networks:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">redis-network</span>

<span class="hljs-attr">networks:</span>
  <span class="hljs-attr">redis-network:</span>
    <span class="hljs-attr">driver:</span> <span class="hljs-string">bridge</span>
</code></pre>
<h4 data-id="heading-5">4. ç¼–å†™å„èŠ‚ç‚¹é…ç½®æ–‡ä»¶</h4>
<p>æ‰€æœ‰é…ç½®æ–‡ä»¶å¯¹åº”æŒ‚è½½ç›®å½•åˆ›å»ºï¼Œé€‚é…Redis 7.0.15ï¼Œåˆ é™¤æ— æ•ˆé…ç½®ï¼Œç¡®ä¿é›†ç¾¤ç¨³å®šè¿è¡Œã€‚</p>
<h5 data-id="heading-6">ï¼ˆ1ï¼‰ä¸»èŠ‚ç‚¹é…ç½®ï¼ˆ./master/redis.confï¼‰</h5>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">bind</span> 0.0.0.0
protected-mode no
port 6379
daemonize no  <span class="hljs-comment"># Dockerç¯å¢ƒå¿…é¡»è®¾ä¸ºnoï¼Œé¿å…å®¹å™¨é€€å‡º</span>
pidfile /var/run/redis_6379.pid
logfile <span class="hljs-string">"redis_6379.log"</span>
<span class="hljs-built_in">dir</span> /data

<span class="hljs-comment"># åŒé‡æŒä¹…åŒ–ï¼Œå…¼é¡¾å®‰å…¨ä¸æ€§èƒ½</span>
rdbcompression <span class="hljs-built_in">yes</span>
save 900 1
save 300 10
save 60 10000
appendonly <span class="hljs-built_in">yes</span>
appendfsync everysec
replica-read-only <span class="hljs-built_in">yes</span>  <span class="hljs-comment"># ä»èŠ‚ç‚¹åªè¯»ï¼Œä¿è¯æ•°æ®ä¸€è‡´</span>
</code></pre>
<h5 data-id="heading-7">ï¼ˆ2ï¼‰ä»èŠ‚ç‚¹é…ç½®ï¼ˆ./slave1/redis.confã€./slave2/redis.confï¼‰</h5>
<p>ä¸¤è€…é…ç½®ä¸€è‡´ï¼Œä»…ç›®å½•ä¸åŒï¼Œæ ¸å¿ƒæ·»åŠ ä¸»èŠ‚ç‚¹æŒ‡å‘ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">bind</span> 0.0.0.0
protected-mode no
port 6379
daemonize no
pidfile /var/run/redis_6379.pid
logfile <span class="hljs-string">"redis_6379.log"</span>
<span class="hljs-built_in">dir</span> /data

replicaof redis-master 6379  <span class="hljs-comment"># æŒ‡å‘ä¸»èŠ‚ç‚¹åˆ«åï¼Œé€‚é…IPåŠ¨æ€å˜åŒ–</span>
replica-read-only <span class="hljs-built_in">yes</span>

<span class="hljs-comment"># æŒä¹…åŒ–é…ç½®ä¸ä¸»èŠ‚ç‚¹ä¸€è‡´</span>
rdbcompression <span class="hljs-built_in">yes</span>
save 900 1
save 300 10
save 60 10000
appendonly <span class="hljs-built_in">yes</span>
appendfsync everysec
</code></pre>
<h5 data-id="heading-8">ï¼ˆ3ï¼‰å“¨å…µé…ç½®ï¼ˆ3ä¸ªå“¨å…µä¸€è‡´ï¼Œä»¥./sentinel1/sentinel.confä¸ºä¾‹ï¼‰</h5>
<pre><code class="hljs language-bash" lang="bash">port 26379
daemonize no
pidfile /var/run/redis-sentinel_26379.pid
logfile <span class="hljs-string">"sentinel_26379.log"</span>
<span class="hljs-built_in">dir</span> /data

<span class="hljs-comment"># ç›‘æ§ä¸»èŠ‚ç‚¹ï¼Œquorum=2ï¼ˆè‡³å°‘2ä¸ªå“¨å…µç¡®è®¤æ•…éšœï¼‰</span>
sentinel monitor mymaster redis-master 6379 2

<span class="hljs-comment"># æ ¸å¿ƒå…¼å®¹é…ç½®ï¼ˆé€‚é…Redis 7.0.15ï¼Œè§£å†³è§£ææŠ¥é”™ï¼‰</span>
protected-mode no
sentinel resolve-hostnames <span class="hljs-built_in">yes</span>  <span class="hljs-comment"># å¼€å¯ä¸»æœºåè§£æ</span>

<span class="hljs-comment"># è¶…æ—¶ä¸æ•…éšœè½¬ç§»é…ç½®</span>
sentinel config-epoch mymaster 0
sentinel leader-epoch mymaster 0
sentinel down-after-milliseconds mymaster 30000  <span class="hljs-comment"># 30ç§’æ— å“åº”æ ‡è®°ä¸»è§‚ä¸‹çº¿</span>
sentinel failover-timeout mymaster 180000  <span class="hljs-comment"># æ•…éšœè½¬ç§»è¶…æ—¶3åˆ†é’Ÿ</span>
sentinel parallel-syncs mymaster 1  <span class="hljs-comment"># æ¯æ¬¡åŒæ­¥1ä¸ªä»èŠ‚ç‚¹ï¼Œé¿å…é›†ç¾¤å‹åŠ›</span>
</code></pre>
<p>è¯´æ˜ï¼š3ä¸ªå“¨å…µé…ç½®åˆ†åˆ«æ”¾å…¥å¯¹åº”ç›®å½•ï¼Œæ— éœ€ä¿®æ”¹IPï¼Œå‡æ²¿ç”¨ä¸»èŠ‚ç‚¹åˆ«åï¼Œå½»åº•è§„é¿é…ç½®å…¼å®¹åŠè§£ææŠ¥é”™ã€‚</p>
<h4 data-id="heading-9">5. é›†ç¾¤å¯åŠ¨ä¸éªŒè¯</h4>
<p>åœ¨<code>/docker/redis-ha-docker</code>ç›®å½•æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œå®Œæˆå¯åŠ¨ä¸éªŒè¯ï¼Œç¡®ä¿é›†ç¾¤æ­£å¸¸è¿è¡Œï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ä¸€é”®å¯åŠ¨æ‰€æœ‰èŠ‚ç‚¹</span>
docker-compose up -d

<span class="hljs-comment"># æŸ¥çœ‹å®¹å™¨çŠ¶æ€ï¼ˆç¡®ä¿æ‰€æœ‰å®¹å™¨Upï¼‰</span>
docker-compose ps

<span class="hljs-comment"># éªŒè¯ä¸»ä»å…³ç³»ï¼ˆä¸»èŠ‚ç‚¹åº”æ˜¾ç¤º2ä¸ªä»èŠ‚ç‚¹ï¼‰</span>
docker <span class="hljs-built_in">exec</span> -it redis-master redis-cli info replication

<span class="hljs-comment"># éªŒè¯å“¨å…µçŠ¶æ€ï¼ˆåº”æ˜¾ç¤ºç›‘æ§1ä¸ªä¸»èŠ‚ç‚¹ã€2ä¸ªä»èŠ‚ç‚¹ã€3ä¸ªå“¨å…µï¼‰</span>
docker <span class="hljs-built_in">exec</span> -it redis-sentinel1 redis-cli -p 26379 info sentinel

<span class="hljs-comment"># éªŒè¯ä¸»èŠ‚ç‚¹IPåŠ¨æ€å˜åŒ–é€‚é…ï¼ˆé‡å¯ä¸»èŠ‚ç‚¹åé‡æ–°éªŒè¯å“¨å…µçŠ¶æ€ï¼‰</span>
docker restart redis-master
<span class="hljs-built_in">sleep</span> 10
docker <span class="hljs-built_in">exec</span> -it redis-sentinel1 redis-cli -p 26379 info sentinel
</code></pre>
<h4 data-id="heading-10">6. æ•…éšœè½¬ç§»æµ‹è¯•</h4>
<p>æµ‹è¯•æ•…éšœè½¬ç§»åŠŸèƒ½ï¼Œç¡®ä¿é›†ç¾¤é«˜å¯ç”¨ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># åœæ­¢ä¸»èŠ‚ç‚¹ï¼Œæ¨¡æ‹Ÿæ•…éšœ</span>
docker stop redis-master

<span class="hljs-comment"># 30ç§’åæŸ¥è¯¢æ–°ä¸»èŠ‚ç‚¹ï¼ˆåº”ä¸ºslave1æˆ–slave2ï¼‰</span>
docker <span class="hljs-built_in">exec</span> -it redis-sentinel1 redis-cli -p 26379 sentinel get-master-addr-by-name mymaster

<span class="hljs-comment"># é‡å¯åŸä¸»èŠ‚ç‚¹ï¼ŒéªŒè¯å…¶ä½œä¸ºä»èŠ‚ç‚¹é‡æ–°åŠ å…¥é›†ç¾¤</span>
docker start redis-master
docker <span class="hljs-built_in">exec</span> -it redis-master redis-cli info replication
</code></pre>
<hr/>
<h3 data-id="heading-11">äºŒã€Spring Bootç”¨æˆ·ç¼“å­˜æœåŠ¡é€‚é…</h3>
<h4 data-id="heading-12">1. é…ç½®æ–‡ä»¶ä¿®æ”¹ï¼ˆapplication.ymlï¼‰</h4>
<p>æ ¸å¿ƒé…ç½®å“¨å…µèŠ‚ç‚¹åœ°å€ï¼Œä¸Redisé›†ç¾¤ç«¯å£å¯¹åº”ï¼Œç¡®ä¿æœåŠ¡æ­£å¸¸è¿æ¥é›†ç¾¤ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">spring:</span>
  <span class="hljs-attr">redis:</span>
    <span class="hljs-attr">sentinel:</span>
      <span class="hljs-attr">master:</span> <span class="hljs-string">mymaster</span>  <span class="hljs-comment"># ä¸å“¨å…µé…ç½®ä¸­ä¸»èŠ‚ç‚¹åç§°ä¸€è‡´</span>
      <span class="hljs-attr">nodes:</span> <span class="hljs-number">192.168</span><span class="hljs-number">.1</span><span class="hljs-number">.10</span><span class="hljs-string">:26379,192.168.1.10:26380,192.168.1.10:26381</span>  <span class="hljs-comment"># æ›¿æ¢ä¸ºæœåŠ¡å™¨IP</span>
    <span class="hljs-attr">lettuce:</span>
      <span class="hljs-attr">pool:</span>
        <span class="hljs-attr">max-active:</span> <span class="hljs-number">8</span>
        <span class="hljs-attr">max-idle:</span> <span class="hljs-number">8</span>
        <span class="hljs-attr">min-idle:</span> <span class="hljs-number">0</span>
    <span class="hljs-attr">timeout:</span> <span class="hljs-string">2000ms</span>

<span class="hljs-attr">user:</span>
  <span class="hljs-attr">cache:</span>
    <span class="hljs-attr">expire:</span> <span class="hljs-number">3600</span>  <span class="hljs-comment"># ç¼“å­˜é»˜è®¤è¿‡æœŸæ—¶é—´1å°æ—¶</span>
    <span class="hljs-attr">hot-user-ids:</span> <span class="hljs-number">1</span><span class="hljs-string">,2,3</span>  <span class="hljs-comment"># çƒ­ç‚¹ç”¨æˆ·IDï¼Œç”¨äºç¼“å­˜ä¼˜åŒ–</span>
</code></pre>
<h4 data-id="heading-13">2. Dockeréƒ¨ç½²Spring BootæœåŠ¡ï¼ˆå¯é€‰ï¼‰</h4>
<p>å®¹å™¨åŒ–éƒ¨ç½²æœåŠ¡ï¼Œä¸Redisé›†ç¾¤ååŒå·¥ä½œï¼Œæ­¥éª¤å¦‚ä¸‹ï¼š</p>
<h5 data-id="heading-14">ï¼ˆ1ï¼‰ç¼–å†™Dockerfile</h5>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">FROM</span> openjdk:<span class="hljs-number">8</span><span class="hljs-operator">-</span>jre<span class="hljs-operator">-</span>alpine
WORKDIR <span class="hljs-operator">/</span>app
<span class="hljs-keyword">COPY</span> target<span class="hljs-operator">/</span>redis<span class="hljs-operator">-</span><span class="hljs-keyword">user</span><span class="hljs-operator">-</span>cache<span class="hljs-number">-1.0</span><span class="hljs-number">.0</span>.jar app.jar
EXPOSE <span class="hljs-number">8080</span>
ENTRYPOINT ["java", "-jar", "app.jar"]
</code></pre>
<h5 data-id="heading-15">ï¼ˆ2ï¼‰æ‰“åŒ…ä¸å¯åŠ¨</h5>
<pre><code class="hljs language-perl" lang="perl"><span class="hljs-comment"># æ‰“åŒ…Spring Booté¡¹ç›®</span>
mvn clean <span class="hljs-keyword">package</span> -DskipTests

<span class="hljs-comment"># æ„å»ºé•œåƒ</span>
docker build -t user-cache-service:<span class="hljs-number">1.0</span> .

<span class="hljs-comment"># å¯åŠ¨å®¹å™¨ï¼ŒåŠ å…¥Redisé›†ç¾¤ç½‘ç»œ</span>
docker run -d --name user-cache -p <span class="hljs-number">8080</span>:<span class="hljs-number">8080</span> &amp;<span class="hljs-comment">#xA  --network redis-network &amp;#xA  -e SPRING_REDIS_SENTINEL_NODES=192.168.1.10:26379,192.168.1.10:26380,192.168.1.10:26381 &amp;#xA  user-cache-service:1.0</span>
</code></pre>
<h4 data-id="heading-16">3. æœåŠ¡éªŒè¯</h4>
<p>è®¿é—®æ¥å£éªŒè¯ç¼“å­˜åŠŸèƒ½æ­£å¸¸ï¼Œç¡®ä¿é€‚é…æ— è¯¯ï¼š</p>
<ul>
<li>ç¼“å­˜å‘½ä¸­/æœªå‘½ä¸­ï¼šè®¿é—®<code>http://æœåŠ¡å™¨IP:8080/user/1</code>ï¼›</li>
<li>ç©ºå€¼ç¼“å­˜ï¼šè®¿é—®<code>http://æœåŠ¡å™¨IP:8080/user/999</code>ï¼›</li>
<li>ç¼“å­˜æ›´æ–°ï¼šè°ƒç”¨æ›´æ–°æ¥å£ï¼ŒéªŒè¯ç¼“å­˜åŒæ­¥æ›´æ–°ã€‚</li>
</ul>
<h4 data-id="heading-17">4. ç¼“å­˜ä¸‰å¤§å¼‚å¸¸è§£å†³æ–¹æ¡ˆï¼ˆé€‚é…å½“å‰é›†ç¾¤ï¼‰</h4>
<p>é’ˆå¯¹ç¼“å­˜ç©¿é€ã€å‡»ç©¿ã€é›ªå´©ï¼Œç»“åˆRedisé›†ç¾¤ç‰¹æ€§ï¼Œæä¾›å¯è½åœ°ã€æ— ä¾µå…¥è§£å†³æ–¹æ¡ˆï¼Œä¸ä¸šåŠ¡é€»è¾‘å…¼å®¹ã€‚</p>
<h5 data-id="heading-18">ï¼ˆ1ï¼‰ç¼“å­˜ç©¿é€</h5>
<p>é—®é¢˜ï¼šè¯·æ±‚ä¸å­˜åœ¨çš„ç”¨æˆ·IDï¼Œç©¿é€ç¼“å­˜ç›´å‡»æ•°æ®åº“ï¼Œå¯¼è‡´æ•°æ®åº“å‹åŠ›æ¿€å¢ã€‚</p>
<p>è§£å†³æ–¹æ¡ˆï¼šç©ºå€¼ç¼“å­˜+å¸ƒéš†è¿‡æ»¤å™¨åŒå…œåº•ï¼š</p>
<ol>
<li>ç©ºå€¼ç¼“å­˜ï¼šæŸ¥è¯¢æ•°æ®åº“æ— ç»“æœæ—¶ï¼Œç¼“å­˜â€œnullâ€æ ‡è®°ï¼ˆè¿‡æœŸ30ç§’ï¼‰ï¼Œé¿å…é‡å¤ç©¿é€ï¼›</li>
<li>å¸ƒéš†è¿‡æ»¤å™¨ï¼šé¡¹ç›®å¯åŠ¨æ—¶åŠ è½½æ‰€æœ‰æœ‰æ•ˆç”¨æˆ·IDè‡³Redis Setï¼Œè¯·æ±‚å…ˆæ ¡éªŒIDæ˜¯å¦å­˜åœ¨ï¼Œä¸å­˜åœ¨ç›´æ¥è¿”å›404ã€‚</li>
</ol>
<h5 data-id="heading-19">ï¼ˆ2ï¼‰ç¼“å­˜å‡»ç©¿</h5>
<p>é—®é¢˜ï¼šçƒ­ç‚¹ç”¨æˆ·ç¼“å­˜è¿‡æœŸç¬é—´ï¼Œå¤§é‡å¹¶å‘è¯·æ±‚ç©¿é€è‡³æ•°æ®åº“ã€‚</p>
<p>è§£å†³æ–¹æ¡ˆï¼šäº’æ–¥é”+çƒ­ç‚¹æ•°æ®æ°¸ä¸è¿‡æœŸï¼š</p>
<ol>
<li>äº’æ–¥é”ï¼šç¼“å­˜æœªå‘½ä¸­æ—¶ï¼Œé€šè¿‡Redis SetNxè·å–åˆ†å¸ƒå¼é”ï¼Œè·å–æˆåŠŸæŸ¥è¯¢æ•°æ®åº“æ›´æ–°ç¼“å­˜ï¼Œå¤±è´¥åˆ™é‡è¯•ï¼›</li>
<li>çƒ­ç‚¹æ•°æ®æ°¸ä¸è¿‡æœŸï¼šé’ˆå¯¹é…ç½®ä¸­çƒ­ç‚¹ç”¨æˆ·ï¼Œåå°å®šæ—¶ï¼ˆæ¯1å°æ—¶ï¼‰åˆ·æ–°ç¼“å­˜ï¼Œç¡®ä¿ç¼“å­˜å§‹ç»ˆæœ‰æ•ˆã€‚</li>
</ol>
<h5 data-id="heading-20">ï¼ˆ3ï¼‰ç¼“å­˜é›ªå´©</h5>
<p>é—®é¢˜ï¼šå¤§é‡ç¼“å­˜åŒæ—¶è¿‡æœŸï¼Œæˆ–Redisé›†ç¾¤æ•…éšœï¼Œå¯¼è‡´æ‰€æœ‰è¯·æ±‚ç©¿é€è‡³æ•°æ®åº“ï¼Œå¼•å‘æ•°æ®åº“é›ªå´©ã€‚</p>
<p>è§£å†³æ–¹æ¡ˆï¼šè¿‡æœŸæ—¶é—´éšæœºåŒ–+é›†ç¾¤é«˜å¯ç”¨+é™çº§ç†”æ–­ï¼š</p>
<ol>
<li>è¿‡æœŸæ—¶é—´éšæœºåŒ–ï¼šç¼“å­˜è®¾ç½®åŸºç¡€è¿‡æœŸæ—¶é—´+éšæœºåç§»é‡ï¼ˆ10-60ç§’ï¼‰ï¼Œé¿å…ç¼“å­˜é›†ä¸­è¿‡æœŸï¼›</li>
<li>é›†ç¾¤é«˜å¯ç”¨ï¼šä¾æ‰˜Redisä¸»ä»+å“¨å…µé›†ç¾¤ï¼Œä¸»èŠ‚ç‚¹æ•…éšœæ—¶å“¨å…µè‡ªåŠ¨åˆ‡æ¢æ–°ä¸»èŠ‚ç‚¹ï¼Œé¿å…ç¼“å­˜æœåŠ¡ä¸­æ–­ï¼›</li>
<li>é™çº§ç†”æ–­ï¼šé€šè¿‡Sentinelç­‰ç»„ä»¶ç›‘æ§æ•°æ®åº“å‹åŠ›ï¼Œå‹åŠ›è¿‡é«˜æ—¶ç†”æ–­ç¼“å­˜ç©¿é€è¯·æ±‚ï¼Œè¿”å›é»˜è®¤æ•°æ®ã€‚</li>
</ol>
<hr/>
<h3 data-id="heading-21">ä¸‰ã€å¸¸è§æ•…éšœæ’æŸ¥ä¸æ³¨æ„äº‹é¡¹</h3>
<h4 data-id="heading-22">1. å¸¸è§æ•…éšœæ’æŸ¥</h4>
<ul>
<li>å“¨å…µå¯åŠ¨æŠ¥é”™ï¼šæ£€æŸ¥é…ç½®æ–‡ä»¶ï¼Œç¡®ä¿æ— Redis 7.0.15ä¸æ”¯æŒçš„é…ç½®ï¼ˆå¦‚resolve-ipã€known-masterï¼‰ï¼›</li>
<li>ä¸»ä»åŒæ­¥å¤±è´¥ï¼šç¡®è®¤ä»èŠ‚ç‚¹é…ç½®ä¸­replicaofæŒ‡å‘ä¸»èŠ‚ç‚¹åˆ«åï¼Œä¸»ä»èŠ‚ç‚¹ç½‘ç»œè¿é€šï¼›</li>
<li>å®¹å™¨å¯åŠ¨å¤±è´¥ï¼šæŸ¥çœ‹å®¹å™¨æ—¥å¿—ï¼ˆdocker logs å®¹å™¨åï¼‰ï¼Œæ’æŸ¥é…ç½®æŒ‚è½½è·¯å¾„é”™è¯¯ã€ç«¯å£å†²çªï¼›</li>
<li>ç¼“å­˜é€‚é…å¤±è´¥ï¼šæ£€æŸ¥Spring Booté…ç½®ä¸­å“¨å…µèŠ‚ç‚¹åœ°å€ã€ä¸»èŠ‚ç‚¹åç§°ï¼Œç¡®ä¿ä¸é›†ç¾¤ä¸€è‡´ã€‚</li>
</ul>
<h4 data-id="heading-23">2. æ³¨æ„äº‹é¡¹</h4>
<ul>
<li>æ‰€æœ‰å“¨å…µé…ç½®éœ€å®Œå…¨ä¸€è‡´ï¼ŒåŒæ­¥æ›´æ–°ï¼Œé¿å…å“¨å…µååŒå¼‚å¸¸ï¼›</li>
<li>ç›®å½•è·¯å¾„ã€ç«¯å£ã€ç½‘ç»œåˆ«åéœ€ä¿æŒç»Ÿä¸€ï¼Œé¿å…é…ç½®æ··ä¹±ï¼›</li>
<li>ç”Ÿäº§ç¯å¢ƒéœ€å®šæœŸå¤‡ä»½Redisæ•°æ®ï¼ˆæŒ‚è½½ç›®å½•å¤‡ä»½ï¼‰ï¼Œé¿å…æ•°æ®ä¸¢å¤±ï¼›</li>
<li>æ ¹æ®ä¸šåŠ¡å‹åŠ›è°ƒæ•´Redisè¿æ¥æ± ã€è¿‡æœŸæ—¶é—´ç­‰å‚æ•°ï¼Œä¼˜åŒ–æ€§èƒ½ã€‚</li>
</ul>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[åˆ«è®©å¹¶å‘ Bug æ¯æ‰ä½ çš„ç³»ç»Ÿï¼šä» HR é¡¹ç›®å®æˆ˜èŠèŠæ•°æ®åº“é”çš„æ­£ç¡®å§¿åŠ¿]]></title>    <link>https://juejin.cn/post/7604786493639589915</link>    <guid>https://juejin.cn/post/7604786493639589915</guid>    <pubDate>2026-02-10T04:45:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604786493639589915" data-draft-id="7604761524977041417" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="åˆ«è®©å¹¶å‘ Bug æ¯æ‰ä½ çš„ç³»ç»Ÿï¼šä» HR é¡¹ç›®å®æˆ˜èŠèŠæ•°æ®åº“é”çš„æ­£ç¡®å§¿åŠ¿"/> <meta itemprop="keywords" content="æ•°æ®åº“"/> <meta itemprop="datePublished" content="2026-02-10T04:45:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ä¸æƒ³èµ·åå­—1111111"/> <meta itemprop="url" content="https://juejin.cn/user/4300945220705486"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            åˆ«è®©å¹¶å‘ Bug æ¯æ‰ä½ çš„ç³»ç»Ÿï¼šä» HR é¡¹ç›®å®æˆ˜èŠèŠæ•°æ®åº“é”çš„æ­£ç¡®å§¿åŠ¿
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4300945220705486/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ä¸æƒ³èµ·åå­—1111111
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T04:45:39.000Z" title="Tue Feb 10 2026 04:45:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://cdn.jsdelivr.net/gh/gxj1134506645/img-bed@main/images/20260210113058246.png" alt="" loading="lazy"/></p>
<hr/>
<p>ä¸Šå‘¨äº”ä¸‹åˆï¼Œæµ‹è¯•åŒäº‹çªç„¶åœ¨ç¾¤é‡Œç”©å‡ºä¸€å¼ æˆªå›¾ï¼š"åŒä¸€ä¸ªå‘˜å·¥ï¼Œæ€ä¹ˆå‡ºç°äº†ä¸¤æ¡è½¬æ­£ç”³è¯·ï¼Ÿ"</p>
<p>æˆ‘å¿ƒé‡Œä¸€æ²‰â€”â€”è¿™ä¸å°±æ˜¯ç»å…¸çš„<strong>å¹¶å‘é‡å¤æäº¤</strong>é—®é¢˜å—ï¼Ÿ</p>
<p>ä¸¤ä¸ªè¯·æ±‚å‡ ä¹åŒæ—¶åˆ°è¾¾æœåŠ¡å™¨ï¼Œå„è‡ªæŸ¥äº†ä¸€é"æœ‰æ²¡æœ‰è¿›è¡Œä¸­çš„ç”³è¯·"ï¼Œéƒ½æŸ¥åˆ°"æ²¡æœ‰"ï¼Œç„¶åå„è‡ªåˆ›å»ºäº†ä¸€æ¡ã€‚ç»“æœå°±æ˜¯ï¼šä¸€ä¸ªå‘˜å·¥ï¼Œä¸¤æ¡è½¬æ­£ç”³è¯·ï¼Œå®¡æ‰¹äººä¸€è„¸æ‡µã€‚</p>
<p>è¿™ä¸ª Bug è®©æˆ‘é‡æ–°å®¡è§†äº†é¡¹ç›®ä¸­æ‰€æœ‰æ¶‰åŠ"å…ˆæŸ¥åå†™"çš„ä¸šåŠ¡é€»è¾‘ï¼Œæœ€ç»ˆç”¨ <code>SELECT ... FOR UPDATE</code> å½»åº•è§£å†³äº†é—®é¢˜ã€‚ä»Šå¤©å°±ç»“åˆæˆ‘ä»¬ HR ç®¡ç†ç³»ç»Ÿçš„çœŸå®ä»£ç ï¼ŒèŠèŠæ•°æ®åº“é”åˆ°åº•æ€ä¹ˆç”¨ã€ä»€ä¹ˆæ—¶å€™ç”¨ã€æœ‰å“ªäº›å‘ã€‚</p>
<hr/>
<h2 data-id="heading-0">ä¸€ã€å…ˆææ¸…æ¥šï¼šä¸ºä»€ä¹ˆ"å…ˆæŸ¥åå†™"ä¼šå‡ºé—®é¢˜ï¼Ÿ</h2>
<p>å¾ˆå¤šä¸šåŠ¡é€»è¾‘éƒ½æœ‰è¿™æ ·çš„æ¨¡å¼ï¼š</p>
<blockquote>
<p>å…ˆæŸ¥è¯¢æ•°æ®åº“ï¼Œåˆ¤æ–­æ¡ä»¶æ˜¯å¦æ»¡è¶³ï¼Œå†æ‰§è¡Œå†™å…¥æ“ä½œã€‚</p>
</blockquote>
<p>æ¯”å¦‚ï¼š</p>
<ul>
<li>æäº¤è½¬æ­£ç”³è¯·å‰ï¼Œå…ˆæŸ¥æœ‰æ²¡æœ‰è¿›è¡Œä¸­çš„ç”³è¯·</li>
<li>æ‰£å‡åº“å­˜å‰ï¼Œå…ˆæŸ¥åº“å­˜å¤Ÿä¸å¤Ÿ</li>
<li>è½¬è´¦å‰ï¼Œå…ˆæŸ¥ä½™é¢æ˜¯å¦å……è¶³</li>
</ul>
<p><strong>åœ¨å•çº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œè¿™å®Œå…¨æ²¡é—®é¢˜ã€‚</strong> ä½†åœ¨å¹¶å‘åœºæ™¯ä¸‹ï¼Œä¸¤ä¸ªè¯·æ±‚å¯èƒ½åœ¨"æŸ¥"å’Œ"å†™"ä¹‹é—´å½¢æˆæ—¶é—´çª—å£ï¼š</p>
<pre><code class="hljs language-css" lang="css">è¯·æ±‚<span class="hljs-selector-tag">A</span>ï¼šæŸ¥è¯¢ â†’ æ²¡æœ‰é‡å¤ç”³è¯· â†’ å‡†å¤‡åˆ›å»º...
è¯·æ±‚<span class="hljs-selector-tag">B</span>ï¼šæŸ¥è¯¢ â†’ æ²¡æœ‰é‡å¤ç”³è¯· â†’ å‡†å¤‡åˆ›å»º...
è¯·æ±‚<span class="hljs-selector-tag">A</span>ï¼š                              â†’ åˆ›å»ºæˆåŠŸ âœ“
è¯·æ±‚<span class="hljs-selector-tag">B</span>ï¼š                              â†’ åˆ›å»ºæˆåŠŸ âœ“  â† é‡å¤äº†ï¼
</code></pre>
<p>è¿™å°±æ˜¯ç»å…¸çš„ <strong>TOCTOUï¼ˆTime of Check to Time of Useï¼‰</strong> é—®é¢˜ã€‚æŸ¥å’Œå†™ä¹‹é—´æ²¡æœ‰åŸå­æ€§ä¿è¯ï¼Œå¹¶å‘ä¸€æ¥å°±ç¿»è½¦ã€‚</p>
<hr/>
<h2 data-id="heading-1">äºŒã€è§£å†³æ–¹æ¡ˆï¼šSELECT ... FOR UPDATE</h2>
<p><code>SELECT ... FOR UPDATE</code> æ˜¯ MySQL InnoDB å¼•æ“æä¾›çš„<strong>æ‚²è§‚é”</strong>æœºåˆ¶ã€‚å®ƒçš„æ ¸å¿ƒè¯­ä¹‰å¾ˆç®€å•ï¼š</p>
<blockquote>
<p>åœ¨äº‹åŠ¡å†…æ‰§è¡Œ SELECT æ—¶ï¼Œå¯¹å‘½ä¸­çš„è¡ŒåŠ æ’ä»–é”ï¼ˆX é”ï¼‰ã€‚å…¶ä»–äº‹åŠ¡å¦‚æœä¹Ÿæƒ³é”è¿™äº›è¡Œï¼Œå¿…é¡»ç­‰å½“å‰äº‹åŠ¡ç»“æŸã€‚</p>
</blockquote>
<p>å…³é”®ç‚¹ï¼š</p>
<ul>
<li>é”çš„æ˜¯<strong>è¡Œ</strong>ï¼Œä¸æ˜¯è¡¨ï¼ˆå‰ææ˜¯å‘½ä¸­äº†ç´¢å¼•ï¼‰</li>
<li>é”çš„é‡Šæ”¾æ—¶æœºæ˜¯<strong>äº‹åŠ¡ç»“æŸ</strong>ï¼ˆCOMMIT / ROLLBACKï¼‰ï¼Œä¸æ˜¯è¯­å¥ç»“æŸ</li>
<li>å¿…é¡»åœ¨äº‹åŠ¡ä¸­ä½¿ç”¨ï¼Œå¦åˆ™è¯­å¥æ‰§è¡Œå®Œé”å°±æ²¡äº†ï¼Œæ¯«æ— æ„ä¹‰</li>
</ul>
<p>åŠ äº†é”ä¹‹åï¼Œå¹¶å‘æµç¨‹å˜æˆäº†è¿™æ ·ï¼š</p>
<pre><code class="hljs language-css" lang="css">è¯·æ±‚<span class="hljs-selector-tag">A</span>ï¼šå¼€å¯äº‹åŠ¡ â†’ FOR UPDATE é”å®šç”¨æˆ·è¡Œ â†’ æŸ¥è¯¢æ— é‡å¤ â†’ åˆ›å»ºç”³è¯· â†’ æäº¤äº‹åŠ¡ï¼Œé‡Šæ”¾é”
è¯·æ±‚<span class="hljs-selector-tag">B</span>ï¼šå¼€å¯äº‹åŠ¡ â†’ FOR UPDATE é”å®šç”¨æˆ·è¡Œ â†’ ç­‰å¾…...ï¼ˆè¢«é˜»å¡ï¼‰
è¯·æ±‚<span class="hljs-selector-tag">B</span>ï¼š                                   â†’ æ‹¿åˆ°é” â†’ æŸ¥è¯¢å‘ç°å·²æœ‰ç”³è¯· â†’ æ‹’ç» â†’ å›æ»š
</code></pre>
<p>"æ ¡éªŒ + åˆ›å»º"è¢«ä¸²è¡ŒåŒ–äº†ï¼Œé—®é¢˜è§£å†³ã€‚</p>
<hr/>
<h2 data-id="heading-2">ä¸‰ã€å®æˆ˜ä»£ç ï¼šHR ç³»ç»Ÿä¸­çš„è½åœ°æ–¹æ¡ˆ</h2>
<p>æˆ‘ä»¬çš„ HR ç³»ç»Ÿåç«¯ä½¿ç”¨ NestJS + Prisma + MySQLï¼Œæ¶‰åŠå¤§é‡ç”³è¯·ç±»ä¸šåŠ¡ï¼šè½¬æ­£ã€ç¦»èŒã€è¯·å‡ã€åŠ ç­ã€å‡ºå·®ã€è¡¥å¡ç­‰ã€‚æ¯ä¸€ç§ç”³è¯·éƒ½æœ‰é˜²é‡å¤æäº¤çš„éœ€æ±‚ã€‚</p>
<p><strong>æ ¸å¿ƒé”æ–¹æ³•</strong>ï¼ˆ<code>application.service.ts</code>ï¼‰ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">/**
 * ç”³è¯·åˆ›å»ºå¹¶å‘é˜²æŠ¤ï¼šé”å®šå½“å‰ç”³è¯·äººè¡Œï¼Œç¡®ä¿"æ ¡éªŒ + åˆ›å»º"ä¸²è¡Œæ‰§è¡Œ
 */</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">async</span> <span class="hljs-title function_">lockApplicantRowForUpdate</span>(<span class="hljs-params">
  tx: Prisma.TransactionClient,
  applicantId: <span class="hljs-built_in">number</span>
</span>) {
  <span class="hljs-keyword">await</span> tx.<span class="hljs-property">$queryRaw</span><span class="hljs-string">`
    SELECT id FROM users WHERE id = <span class="hljs-subst">${<span class="hljs-built_in">BigInt</span>(applicantId)}</span> FOR UPDATE
  `</span>;
}
</code></pre>
<p>åªæœ‰ä¸€è¡Œ SQLï¼Œä½†å®ƒæ˜¯æ•´ä¸ªå¹¶å‘é˜²æŠ¤çš„åŸºçŸ³ã€‚</p>
<p><strong>è½¬æ­£ç”³è¯·ä¸­çš„ä½¿ç”¨</strong>ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">async</span> <span class="hljs-title function_">createRegularizationApplication</span>(<span class="hljs-params">applicantId: <span class="hljs-built_in">number</span>, dto</span>) {
  <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">prisma</span>.$transaction(<span class="hljs-keyword">async</span> (tx) =&gt; {
    <span class="hljs-comment">// ç¬¬ä¸€æ­¥ï¼šé”å®šç”³è¯·äººè¡Œï¼Œé˜»å¡åŒä¸€ç”¨æˆ·çš„å¹¶å‘è¯·æ±‚</span>
    <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">lockApplicantRowForUpdate</span>(tx, applicantId);

    <span class="hljs-comment">// ç¬¬äºŒæ­¥ï¼šä¸šåŠ¡æ ¡éªŒï¼ˆæ­¤æ—¶å·²ç»ä¸²è¡Œï¼Œä¸ä¼šæœ‰å¹¶å‘é—®é¢˜ï¼‰</span>
    <span class="hljs-keyword">const</span> user = <span class="hljs-keyword">await</span> tx.<span class="hljs-property">user</span>.<span class="hljs-title function_">findUnique</span>({ <span class="hljs-attr">where</span>: { <span class="hljs-attr">id</span>: <span class="hljs-title class_">BigInt</span>(applicantId) } });
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">assertEligibleForRegularizationApplication</span>(user);

    <span class="hljs-comment">// ç¬¬ä¸‰æ­¥ï¼šé˜²é‡å¤æ ¡éªŒ</span>
    <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">assertNoDuplicateApplication</span>(tx, applicantId, <span class="hljs-string">'regularization'</span>);

    <span class="hljs-comment">// ç¬¬å››æ­¥ï¼šåˆ›å»ºç”³è¯·è®°å½•</span>
    <span class="hljs-keyword">const</span> application = <span class="hljs-keyword">await</span> tx.<span class="hljs-property">application</span>.<span class="hljs-title function_">create</span>({ ... });
    <span class="hljs-keyword">return</span> application;
  });
  <span class="hljs-keyword">return</span> result;
}
</code></pre>
<p><strong>è¿™ä¸ªæ¨¡å¼åœ¨é¡¹ç›®ä¸­è¢«å¤ç”¨äº† 9 æ¬¡</strong>ï¼Œè¦†ç›–äº†æ‰€æœ‰ç”³è¯·ç±»å‹ï¼š</p>





































<table><thead><tr><th>ç”³è¯·ç±»å‹</th><th>é˜²é‡å£å¾„</th></tr></thead><tbody><tr><td>è½¬æ­£ç”³è¯·</td><td>å­˜åœ¨å¾…å®¡æ‰¹/å®¡æ‰¹ä¸­æ—¶ç¦æ­¢ï¼›å·²é€šè¿‡åˆ™æ°¸ä¹…ç¦æ­¢</td></tr><tr><td>ç¦»èŒç”³è¯·</td><td>å­˜åœ¨å¾…å®¡æ‰¹/å®¡æ‰¹ä¸­/å·²é€šè¿‡æ—¶ç¦æ­¢</td></tr><tr><td>è¯·å‡ç”³è¯·</td><td>å­˜åœ¨å¾…å®¡æ‰¹/å®¡æ‰¹ä¸­æ—¶ç¦æ­¢</td></tr><tr><td>åŠ ç­ç”³è¯·</td><td>å­˜åœ¨å¾…å®¡æ‰¹/å®¡æ‰¹ä¸­æ—¶ç¦æ­¢</td></tr><tr><td>å‡ºå·®ç”³è¯·</td><td>å­˜åœ¨æœªé—­ç¯å‡ºå·®å•æ—¶ç¦æ­¢</td></tr><tr><td>è¡¥å¡ç”³è¯·</td><td>å­˜åœ¨å¾…å®¡æ‰¹/å®¡æ‰¹ä¸­æ—¶ç¦æ­¢</td></tr><tr><td>å…¥èŒç”³è¯·</td><td>èº«ä»½è¯å·ä¸å¯é‡å¤</td></tr></tbody></table>
<p>æ¯ç§ç”³è¯·çš„é˜²é‡è§„åˆ™ä¸åŒï¼Œä½†<strong>é”çš„ç­–ç•¥å®Œå…¨ä¸€è‡´</strong>ï¼šå…ˆé”ç”¨æˆ·è¡Œï¼Œå†åšä¸šåŠ¡æ ¡éªŒï¼Œæœ€åå†™å…¥ã€‚</p>
<hr/>
<h2 data-id="heading-3">å››ã€ä¸ºä»€ä¹ˆé” users è¡¨è€Œä¸æ˜¯ applications è¡¨ï¼Ÿ</h2>
<p>è¿™æ˜¯ä¸€ä¸ªå€¼å¾—æ€è€ƒçš„è®¾è®¡å†³ç­–ã€‚</p>
<p>æˆ‘ä»¬é”çš„æ˜¯ <code>users</code> è¡¨çš„ç”³è¯·äººè¡Œï¼Œè€Œä¸æ˜¯ <code>applications</code> è¡¨ã€‚åŸå› æ˜¯ï¼š</p>
<p><strong>1. é˜²é‡æ ¡éªŒçš„ç»´åº¦æ˜¯"äºº"ï¼Œä¸æ˜¯"ç”³è¯·"</strong></p>
<p>ä¸šåŠ¡è§„åˆ™æ˜¯"åŒä¸€ä¸ªäººä¸èƒ½é‡å¤æäº¤æŸç±»ç”³è¯·"ã€‚é”çš„ç²’åº¦åº”è¯¥å’Œä¸šåŠ¡æ ¡éªŒçš„ç²’åº¦ä¸€è‡´ã€‚</p>
<p><strong>2. ç”³è¯·è®°å½•è¿˜ä¸å­˜åœ¨</strong></p>
<p>å¹¶å‘åœºæ™¯ä¸‹ï¼Œä¸¤ä¸ªè¯·æ±‚éƒ½è¿˜æ²¡åˆ›å»ºç”³è¯·è®°å½•ï¼Œ<code>applications</code> è¡¨é‡Œæ ¹æœ¬æ²¡æœ‰å¯ä»¥é”çš„è¡Œã€‚è€Œ <code>users</code> è¡¨çš„è®°å½•æ˜¯ç¡®å®šå­˜åœ¨çš„ã€‚</p>
<p><strong>3. ä¸»é”®æŸ¥è¯¢ï¼Œé”ç²’åº¦æœ€å°</strong></p>
<p><code>WHERE id = ? FOR UPDATE</code> å‘½ä¸­çš„æ˜¯ä¸»é”®ç´¢å¼•ï¼ŒInnoDB åªä¼šé”å®šè¿™ä¸€è¡Œï¼Œä¸ä¼šå½±å“å…¶ä»–ç”¨æˆ·çš„æ“ä½œã€‚</p>
<hr/>
<h2 data-id="heading-4">äº”ã€è¸©å‘è®°å½•ï¼šè¿™äº›ç»†èŠ‚ä¸æ³¨æ„å°±ç¿»è½¦</h2>
<h3 data-id="heading-5">å‘ 1ï¼šæ²¡æœ‰ç´¢å¼•ï¼Œè¡Œé”å˜è¡¨é”</h3>
<p>InnoDB çš„è¡Œé”æ˜¯åŸºäºç´¢å¼•å®ç°çš„ã€‚å¦‚æœ <code>WHERE</code> æ¡ä»¶æ²¡æœ‰å‘½ä¸­ç´¢å¼•ï¼Œé”çš„èŒƒå›´ä¼šæ€¥å‰§æ‰©å¤§ã€‚</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- å‘½ä¸­ä¸»é”®ç´¢å¼•ï¼Œåªé”ä¸€è¡Œï¼ˆæ¨èï¼‰</span>
<span class="hljs-keyword">SELECT</span> id <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">1001</span> <span class="hljs-keyword">FOR</span> <span class="hljs-keyword">UPDATE</span>;

<span class="hljs-comment">-- æ²¡æœ‰ç´¢å¼•çš„å­—æ®µï¼Œå¯èƒ½é”å¤§é‡è¡Œç”šè‡³å…¨è¡¨ï¼ˆå±é™©ï¼‰</span>
<span class="hljs-keyword">SELECT</span> id <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> phone <span class="hljs-operator">=</span> <span class="hljs-string">'13800138000'</span> <span class="hljs-keyword">FOR</span> <span class="hljs-keyword">UPDATE</span>;
</code></pre>
<p><strong>å»ºè®®ï¼šFOR UPDATE çš„ WHERE æ¡ä»¶åŠ¡å¿…å‘½ä¸­ä¸»é”®æˆ–å”¯ä¸€ç´¢å¼•ã€‚</strong></p>
<h3 data-id="heading-6">å‘ 2ï¼šäº‹åŠ¡å†…åšäº†è€—æ—¶æ“ä½œ</h3>
<p>é”çš„æŒæœ‰æ—¶é—´ = äº‹åŠ¡çš„æŒç»­æ—¶é—´ã€‚å¦‚æœåœ¨äº‹åŠ¡å†…è°ƒç”¨äº†å¤–éƒ¨ APIã€å‘é€é‚®ä»¶ã€åšå¤æ‚è®¡ç®—ï¼Œé”å°±ä¼šè¢«é•¿æ—¶é—´æŒæœ‰ï¼Œå…¶ä»–è¯·æ±‚å…¨éƒ¨æ’é˜Ÿç­‰å¾…ã€‚</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// é”™è¯¯ç¤ºèŒƒï¼šäº‹åŠ¡å†…è°ƒç”¨å¤–éƒ¨æœåŠ¡</span>
<span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">prisma</span>.$transaction(<span class="hljs-keyword">async</span> (tx) =&gt; {
  <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">lockApplicantRowForUpdate</span>(tx, applicantId);
  <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">sendEmailNotification</span>();  <span class="hljs-comment">// å¯èƒ½è€—æ—¶æ•°ç§’ï¼Œé”ä¸€ç›´ä¸é‡Šæ”¾ï¼</span>
  <span class="hljs-keyword">await</span> tx.<span class="hljs-property">application</span>.<span class="hljs-title function_">create</span>({ ... });
});

<span class="hljs-comment">// æ­£ç¡®åšæ³•ï¼šäº‹åŠ¡å†…åªåšæœ€å°å¿…è¦çš„æ•°æ®åº“æ“ä½œ</span>
<span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">prisma</span>.$transaction(<span class="hljs-keyword">async</span> (tx) =&gt; {
  <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">lockApplicantRowForUpdate</span>(tx, applicantId);
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> tx.<span class="hljs-property">application</span>.<span class="hljs-title function_">create</span>({ ... });
});
<span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">sendEmailNotification</span>();  <span class="hljs-comment">// äº‹åŠ¡å¤–å‘é‚®ä»¶</span>
</code></pre>
<p><strong>åŸåˆ™ï¼šé”å†…åªåšæœ€å°å¿…è¦è¯»å†™ã€‚</strong></p>
<h3 data-id="heading-7">å‘ 3ï¼šæ­»é”</h3>
<p>å¤šä¸ªäº‹åŠ¡äº¤å‰é”å®šä¸åŒèµ„æºæ—¶ï¼Œå¯èƒ½äº§ç”Ÿæ­»é”ï¼š</p>
<pre><code class="hljs language-css" lang="css">äº‹åŠ¡<span class="hljs-selector-tag">A</span>ï¼šé”ç”¨æˆ·<span class="hljs-number">1</span> â†’ ç­‰å¾…é”ç”¨æˆ·<span class="hljs-number">2</span>...
äº‹åŠ¡<span class="hljs-selector-tag">B</span>ï¼šé”ç”¨æˆ·<span class="hljs-number">2</span> â†’ ç­‰å¾…é”ç”¨æˆ·<span class="hljs-number">1</span>...
</code></pre>
<p>è§„é¿æ–¹æ³•ï¼š</p>
<ul>
<li><strong>å›ºå®šåŠ é”é¡ºåº</strong>ï¼šæ¯”å¦‚æ€»æ˜¯æŒ‰ç”¨æˆ· ID ä»å°åˆ°å¤§åŠ é”</li>
<li><strong>ç¼©çŸ­äº‹åŠ¡æ—¶é—´</strong>ï¼šå‡å°‘é”æŒæœ‰æ—¶é•¿</li>
<li><strong>åšæ­»é”é‡è¯•</strong>ï¼šæ•è·æ­»é”é”™è¯¯ç ï¼ŒçŸ­æš‚ç­‰å¾…åé‡è¯•</li>
</ul>
<h3 data-id="heading-8">å‘ 4ï¼šRR éš”ç¦»çº§åˆ«ä¸‹çš„é—´éš™é”</h3>
<p>MySQL é»˜è®¤çš„ <code>REPEATABLE READ</code> éš”ç¦»çº§åˆ«ä¸‹ï¼ŒèŒƒå›´æŸ¥è¯¢ + <code>FOR UPDATE</code> ä¼šè§¦å‘ Next-Key Lockï¼Œä¸ä»…é”è®°å½•æœ¬èº«ï¼Œè¿˜ä¼šé”ä½è®°å½•ä¹‹é—´çš„"é—´éš™"ã€‚</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- è¿™æ¡è¯­å¥å¯èƒ½é”ä½çš„ä¸åªæ˜¯ id=1001 çš„è¡Œ</span>
<span class="hljs-comment">-- è¿˜åŒ…æ‹¬ id åœ¨æŸä¸ªèŒƒå›´å†…çš„é—´éš™</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> applications <span class="hljs-keyword">WHERE</span> user_id <span class="hljs-operator">=</span> <span class="hljs-number">1001</span> <span class="hljs-keyword">FOR</span> <span class="hljs-keyword">UPDATE</span>;
</code></pre>
<p><strong>æ‰€ä»¥æˆ‘ä»¬é€‰æ‹©é” users è¡¨çš„ä¸»é”®è¡Œï¼Œç­‰å€¼ä¸»é”®æŸ¥è¯¢çš„é”å®šèŒƒå›´æœ€ç²¾ç¡®ã€‚</strong></p>
<hr/>
<h2 data-id="heading-9">å…­ã€FOR UPDATE ä¸æ˜¯ä¸‡èƒ½çš„</h2>
<p><code>SELECT ... FOR UPDATE</code> å¾ˆå¥½ç”¨ï¼Œä½†å®ƒæœ‰æ˜ç¡®çš„è¾¹ç•Œï¼š</p>
<p><strong>é€‚åˆçš„åœºæ™¯ï¼š</strong></p>
<ul>
<li>å•åº“äº‹åŠ¡å†…çš„èµ„æºç«äº‰</li>
<li>æœ‰æ˜ç¡®ä¸»é”®çš„å¹¶å‘ä¸²è¡ŒåŒ–</li>
<li>åº“å­˜æ‰£å‡ã€ä½™é¢å˜æ›´ã€å¹‚ç­‰é˜²é‡</li>
</ul>
<p><strong>ä¸é€‚åˆçš„åœºæ™¯ï¼š</strong></p>
<ul>
<li>è·¨æ•°æ®åº“ã€è·¨æœåŠ¡çš„åˆ†å¸ƒå¼é” â†’ ç”¨ Redis / ZooKeeper / etcd</li>
<li>é«˜ååå†™çƒ­ç‚¹ï¼ˆå¤§é‡è¯·æ±‚é”åŒä¸€è¡Œï¼‰â†’ è€ƒè™‘ä¹è§‚é”æˆ–é˜Ÿåˆ—å‰Šå³°</li>
<li>å…¨å±€ä»»åŠ¡è°ƒåº¦é” â†’ ç”¨åˆ†å¸ƒå¼é”ä¸­é—´ä»¶</li>
</ul>
<p><strong>é€‰å‹é€ŸæŸ¥ï¼š</strong></p>





















<table><thead><tr><th>åœºæ™¯</th><th>æ¨èæ–¹æ¡ˆ</th></tr></thead><tbody><tr><td>äº‹åŠ¡å†…èµ„æºç«äº‰ï¼Œæœ‰æ˜ç¡®ä¸»é”®</td><td><code>SELECT ... FOR UPDATE</code></td></tr><tr><td>å†²çªæ¦‚ç‡ä½ï¼Œè¿½æ±‚åå</td><td>ä¹è§‚é”ï¼ˆversion å­—æ®µï¼‰</td></tr><tr><td>è·¨æœåŠ¡å…¨å±€äº’æ–¥</td><td>Redis / ZK / etcd åˆ†å¸ƒå¼é”</td></tr></tbody></table>
<p>æœ€ç»ˆåŸåˆ™ï¼š<strong>å…ˆä¿è¯ä¸€è‡´æ€§ï¼Œå†ä¼˜åŒ–æ€§èƒ½ã€‚</strong></p>
<hr/>
<h2 data-id="heading-10">ä¸ƒã€æ€»ç»“</h2>
<p>å›åˆ°å¼€å¤´é‚£ä¸ª Bugã€‚ä¿®å¤æ–¹æ¡ˆå…¶å®å°±ä¸€è¡Œ SQLï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> id <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> ? <span class="hljs-keyword">FOR</span> <span class="hljs-keyword">UPDATE</span>;
</code></pre>
<p>ä½†è¦ç”¨å¥½å®ƒï¼Œéœ€è¦ç†è§£èƒŒåçš„åŸç†ï¼š</p>
<ul>
<li><strong>ä¸ºä»€ä¹ˆè¦é”</strong>ï¼šæ¶ˆé™¤"å…ˆæŸ¥åå†™"çš„å¹¶å‘æ—¶é—´çª—å£</li>
<li><strong>é”ä»€ä¹ˆ</strong>ï¼šé”ä¸šåŠ¡æ ¡éªŒç»´åº¦å¯¹åº”çš„è¡Œï¼Œç”¨ä¸»é”®å‘½ä¸­ç´¢å¼•</li>
<li><strong>é”å¤šä¹…</strong>ï¼šäº‹åŠ¡ç»“æŸæ‰é‡Šæ”¾ï¼Œæ‰€ä»¥äº‹åŠ¡è¦å°½å¯èƒ½çŸ­</li>
<li><strong>ä»€ä¹ˆæ—¶å€™ä¸ç”¨</strong>ï¼šè·¨æœåŠ¡åœºæ™¯ã€é«˜ååçƒ­ç‚¹ã€åˆ†å¸ƒå¼åè°ƒ</li>
</ul>
<p>æ•°æ®åº“é”ä¸æ˜¯ä»€ä¹ˆé«˜æ·±çš„æŠ€æœ¯ï¼Œä½†å®ƒæ˜¯ä¿è¯æ•°æ®ä¸€è‡´æ€§çš„æœ€åä¸€é“é˜²çº¿ã€‚å¸Œæœ›è¿™ç¯‡æ–‡ç« èƒ½å¸®ä½ åœ¨è‡ªå·±çš„é¡¹ç›®ä¸­å°‘è¸©ä¸€ä¸ªå‘ã€‚</p>
<hr/>
<p>æ¬¢è¿å…³æ³¨å…¬ä¼—å·FishTech Notesï¼Œä¸€å—äº¤æµä½¿ç”¨å¿ƒå¾—ï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Gemini CLI ä¸­è½¬ç«™é…ç½®ä½¿ç”¨æ•™ç¨‹]]></title>    <link>https://juejin.cn/post/7604761524976664585</link>    <guid>https://juejin.cn/post/7604761524976664585</guid>    <pubDate>2026-02-10T03:16:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604761524976664585" data-draft-id="7604741630448599074" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Gemini CLI ä¸­è½¬ç«™é…ç½®ä½¿ç”¨æ•™ç¨‹"/> <meta itemprop="keywords" content="AIGC,AIç¼–ç¨‹"/> <meta itemprop="datePublished" content="2026-02-10T03:16:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ›¦å’Œ"/> <meta itemprop="url" content="https://juejin.cn/user/1116759545101406"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Gemini CLI ä¸­è½¬ç«™é…ç½®ä½¿ç”¨æ•™ç¨‹
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1116759545101406/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ›¦å’Œ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T03:16:46.000Z" title="Tue Feb 10 2026 03:16:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    8
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Gemini CLI ä¸­æ–‡ä½¿ç”¨æŒ‡å—</h2>
<h3 data-id="heading-1">åŸºæœ¬ä»‹ç»</h3>
<p>Gemini CLI æ˜¯è°·æ­Œæä¾›çš„å¼€æºå‘½ä»¤è¡Œ AI å·¥å…·ï¼Œå°† Gemini çš„å¼ºå¤§åŠŸèƒ½ç›´æ¥å¸¦å…¥æ‚¨çš„ç»ˆç«¯ã€‚å®ƒæä¾›è½»é‡çº§çš„ Gemini è®¿é—®æ–¹å¼ï¼Œä¸ºæ‚¨æä¾›ä»æç¤ºåˆ°æ¨¡å‹çš„æœ€ç›´æ¥è·¯å¾„ã€‚é€šè¿‡è®¾ç½®ä¸­è½¬ç«™ï¼ˆä»£ç†ï¼‰ï¼Œæ‚¨å¯ä»¥åœ¨ç½‘ç»œå—é™çš„æƒ…å†µä¸‹æ­£å¸¸ä½¿ç”¨ Gemini CLI æœåŠ¡ã€‚</p>
<h3 data-id="heading-2">ğŸš€ ä¸ºä»€ä¹ˆé€‰æ‹© Gemini CLIï¼Ÿ</h3>
<ul>
<li><strong>ğŸ§  å¼ºå¤§çš„ Gemini 2.5 Pro</strong>ï¼šè®¿é—® 100 ä¸‡ token ä¸Šä¸‹æ–‡çª—å£</li>
<li><strong>ğŸ”§ å†…ç½®å·¥å…·</strong>ï¼šGoogle æœç´¢åŸºç¡€åŠŸèƒ½ã€æ–‡ä»¶æ“ä½œã€Shell å‘½ä»¤ã€ç½‘é¡µæŠ“å–</li>
<li><strong>ğŸ”Œ å¯æ‰©å±•</strong>ï¼šæ”¯æŒ MCPï¼ˆæ¨¡å‹ä¸Šä¸‹æ–‡åè®®ï¼‰è¿›è¡Œè‡ªå®šä¹‰é›†æˆ</li>
<li><strong>ğŸ’» ç»ˆç«¯ä¼˜å…ˆ</strong>ï¼šä¸“ä¸ºåœ¨å‘½ä»¤è¡Œä¸­å·¥ä½œçš„å¼€å‘è€…è®¾è®¡</li>
<li><strong>ğŸ›¡ï¸ å¼€æº</strong>ï¼šApache 2.0 è®¸å¯è¯</li>
</ul>
<h3 data-id="heading-3">ğŸ“¦ å®‰è£…æ–¹å¼</h3>
<h4 data-id="heading-4">å¿«é€Ÿå®‰è£…</h4>
<h4 data-id="heading-5">ä½¿ç”¨ npx å³æ—¶è¿è¡Œï¼ˆæ— éœ€å®‰è£…ï¼‰</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ä½¿ç”¨å®˜æ–¹ä»“åº“</span>
npx &lt;https://github.com/google-gemini/gemini-cli&gt;
</code></pre>
<h4 data-id="heading-6">ä½¿ç”¨ npm å…¨å±€å®‰è£…</h4>
<pre><code class="hljs language-bash" lang="bash">npm install -g @google/gemini-cli
</code></pre>
<h4 data-id="heading-7">ä½¿ç”¨ Homebrew å®‰è£…ï¼ˆmacOS/Linuxï¼‰</h4>
<pre><code class="hljs language-bash" lang="bash">brew install gemini-cli
</code></pre>
<h4 data-id="heading-8">ç³»ç»Ÿè¦æ±‚</h4>
<ul>
<li>Node.js ç‰ˆæœ¬ 20 æˆ–æ›´é«˜</li>
<li>macOSã€Linux æˆ– Windows</li>
</ul>
<h3 data-id="heading-9">é…ç½®ä¸­è½¬ç«™ï¼ˆä»£ç†ï¼‰ä½¿ç”¨</h3>
<h4 data-id="heading-10">1. è®¾ç½®ç¯å¢ƒå˜é‡</h4>
<p>åœ¨ä½¿ç”¨ä¸­è½¬ç«™ä¹‹å‰ï¼Œæ‚¨éœ€è¦é…ç½®ä»¥ä¸‹ç¯å¢ƒå˜é‡ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># è®¾ç½® API å¯†é’¥</span>
<span class="hljs-built_in">export</span> GEMINI_API_KEY=sk-xxxxx

<span class="hljs-comment"># è®¾ç½® API ä¸­è½¬ç«™åœ°å€</span>
<span class="hljs-built_in">export</span> GOOGLE_GEMINI_BASE_URL=https://api.88api.chat

<span class="hljs-comment">#cmd ä½¿ç”¨ä¸‹é¢è¿™ä¸ª</span>

<span class="hljs-built_in">set</span> GEMINI_API_KEY=sk-xxxxx
<span class="hljs-built_in">set</span> GOOGLE_GEMINI_BASE_URL=https://api.88api.chat
</code></pre>
<blockquote>
<p>æ³¨æ„ï¼šæ‚¨ä¹Ÿå¯ä»¥å°†è¿™äº›ç¯å¢ƒå˜é‡æ·»åŠ åˆ° <code>.bashrc</code>ã€<code>.zshrc</code> æˆ–å…¶ä»– shell é…ç½®æ–‡ä»¶ä¸­ï¼Œè¿™æ ·æ¯æ¬¡å¯åŠ¨ç»ˆç«¯æ—¶éƒ½ä¼šè‡ªåŠ¨è®¾ç½®è¿™äº›å˜é‡ã€‚</p>
</blockquote>
<h3 data-id="heading-11">ğŸš€ å¿«é€Ÿå¼€å§‹</h3>
<h4 data-id="heading-12">åŸºæœ¬ä½¿ç”¨</h4>
<h4 data-id="heading-13">åœ¨å½“å‰ç›®å½•å¯åŠ¨</h4>
<pre><code class="hljs language-bash" lang="bash">gemini
</code></pre>
<h4 data-id="heading-14">åŒ…å«å¤šä¸ªç›®å½•</h4>
<pre><code class="hljs language-bash" lang="bash">gemini --include-directories ../lib,../docs
</code></pre>
<h4 data-id="heading-15">ä½¿ç”¨ç‰¹å®šæ¨¡å‹</h4>
<pre><code class="hljs language-bash" lang="bash">gemini -m gemini-2.5-flash
</code></pre>
<h4 data-id="heading-16">è„šæœ¬éäº¤äº’æ¨¡å¼</h4>
<p>è·å–ç®€å•æ–‡æœ¬å“åº”ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">gemini -p <span class="hljs-string">"è§£é‡Šè¿™ä¸ªä»£ç åº“çš„æ¶æ„"</span>
</code></pre>
<p>è·å–ç»“æ„åŒ– JSON è¾“å‡ºï¼š</p>
<pre><code class="hljs language-bash" lang="bash">gemini -p <span class="hljs-string">"è§£é‡Šè¿™ä¸ªä»£ç åº“çš„æ¶æ„"</span> --output-format json
</code></pre>
<h4 data-id="heading-17">å¿«é€Ÿç¤ºä¾‹</h4>
<h4 data-id="heading-18">å¯åŠ¨æ–°é¡¹ç›®</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cd</span> new-project/
gemini
&gt; ä¸ºæˆ‘ç¼–å†™ä¸€ä¸ª Discord æœºå™¨äººï¼Œä½¿ç”¨æˆ‘æä¾›çš„ FAQ.md æ–‡ä»¶å›ç­”é—®é¢˜
</code></pre>
<h4 data-id="heading-19">åˆ†æç°æœ‰ä»£ç </h4>
<pre><code class="hljs language-bash" lang="bash">git <span class="hljs-built_in">clone</span> &lt;https://github.com/google-gemini/gemini-cli&gt;
<span class="hljs-built_in">cd</span> gemini-cli
gemini
&gt; ç»™æˆ‘ä¸€ä¸ªæ˜¨å¤©æ‰€æœ‰æ›´æ”¹çš„æ‘˜è¦
</code></pre>
<h3 data-id="heading-20">ğŸ“‹ ä¸»è¦åŠŸèƒ½</h3>
<h4 data-id="heading-21">ä»£ç ç†è§£ä¸ç”Ÿæˆ</h4>
<ul>
<li>æŸ¥è¯¢å’Œç¼–è¾‘å¤§å‹ä»£ç åº“</li>
<li>ä½¿ç”¨å¤šæ¨¡æ€èƒ½åŠ›ä» PDFã€å›¾ç‰‡æˆ–è‰å›¾ç”Ÿæˆæ–°åº”ç”¨</li>
<li>ä½¿ç”¨è‡ªç„¶è¯­è¨€è°ƒè¯•é—®é¢˜å’Œæ•…éšœæ’é™¤</li>
</ul>
<h4 data-id="heading-22">è‡ªåŠ¨åŒ–ä¸é›†æˆ</h4>
<ul>
<li>è‡ªåŠ¨åŒ–æ“ä½œä»»åŠ¡ï¼Œå¦‚æŸ¥è¯¢æ‹‰å–è¯·æ±‚æˆ–å¤„ç†å¤æ‚çš„å˜åŸºæ“ä½œ</li>
<li>ä½¿ç”¨ MCP æœåŠ¡å™¨è¿æ¥æ–°åŠŸèƒ½</li>
<li>åœ¨è„šæœ¬ä¸­éäº¤äº’å¼è¿è¡Œä»¥å®ç°å·¥ä½œæµè‡ªåŠ¨åŒ–</li>
</ul>
<h4 data-id="heading-23">é«˜çº§åŠŸèƒ½</h4>
<ul>
<li>ä½¿ç”¨å†…ç½® Google æœç´¢è·å–å®æ—¶ä¿¡æ¯</li>
<li>å¯¹è¯æ£€æŸ¥ç‚¹ä»¥ä¿å­˜å’Œæ¢å¤å¤æ‚ä¼šè¯</li>
<li>è‡ªå®šä¹‰ä¸Šä¸‹æ–‡æ–‡ä»¶ï¼ˆ<a href="https://link.juejin.cn?target=http%3A%2F%2Fgemini.md%2F" target="_blank" title="http://gemini.md/" ref="nofollow noopener noreferrer">GEMINI.md</a>ï¼‰ä¸ºæ‚¨çš„é¡¹ç›®å®šåˆ¶è¡Œä¸º</li>
</ul>
<h3 data-id="heading-24">å¸¸ç”¨å‘½ä»¤å’ŒåŠŸèƒ½ç¤ºä¾‹</h3>
<h4 data-id="heading-25">æ¢ç´¢ä»£ç åº“</h4>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-quote">&gt; æè¿°è¿™ä¸ªç³»ç»Ÿæ¶æ„çš„ä¸»è¦ç»„æˆéƒ¨åˆ†</span>
<span class="hljs-quote">&gt; æœ‰å“ªäº›å®‰å…¨æœºåˆ¶ï¼Ÿ</span>
<span class="hljs-quote">&gt; ä¸ºæ–°å¼€å‘è€…æä¾›ä¸€ä»½åˆ†æ­¥éª¤çš„å…¥é—¨æ–‡æ¡£</span>
</code></pre>
<h4 data-id="heading-26">å¤„ç†ç°æœ‰ä»£ç </h4>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_">&gt; </span><span class="bash">ä¸º GitHub issue <span class="hljs-comment">#123 å®ç°ä¸€ä¸ªåˆç¨¿</span></span>
<span class="hljs-meta prompt_">&gt; </span><span class="bash">å¸®æˆ‘å°†è¿™ä¸ªä»£ç åº“è¿ç§»åˆ°æœ€æ–°ç‰ˆæœ¬çš„ Javaã€‚å…ˆåˆ¶å®šä¸€ä¸ªè®¡åˆ’</span>
</code></pre>
<h4 data-id="heading-27">è‡ªåŠ¨åŒ–å·¥ä½œæµç¨‹</h4>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-quote">&gt; åˆ¶ä½œä¸€ä¸ªå¹»ç¯ç‰‡ï¼Œå±•ç¤ºè¿‡å» 7 å¤©çš„ git å†å²ï¼ŒæŒ‰åŠŸèƒ½å’Œå›¢é˜Ÿæˆå‘˜åˆ†ç»„</span>
<span class="hljs-quote">&gt; åˆ¶ä½œä¸€ä¸ªå…¨å± Web åº”ç”¨ç”¨äºå¢™ä¸Šæ˜¾ç¤ºï¼Œå±•ç¤ºæˆ‘ä»¬äº’åŠ¨æœ€å¤šçš„ GitHub issues</span>
</code></pre>
<h4 data-id="heading-28">ç³»ç»Ÿäº¤äº’</h4>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-quote">&gt; å°†æ­¤ç›®å½•ä¸­çš„æ‰€æœ‰å›¾åƒè½¬æ¢ä¸º pngï¼Œå¹¶ä½¿ç”¨ exif æ•°æ®ä¸­çš„æ—¥æœŸé‡å‘½åå®ƒä»¬</span>
<span class="hljs-quote">&gt; æŒ‰æ”¯å‡ºæœˆä»½æ•´ç†æˆ‘çš„ PDF å‘ç¥¨</span>
</code></pre>
<h3 data-id="heading-29">GitHub é›†æˆ</h3>
<p>ä½¿ç”¨ <strong>Gemini CLI GitHub Action</strong> å°† Gemini CLI ç›´æ¥é›†æˆåˆ°æ‚¨çš„ GitHub å·¥ä½œæµä¸­ï¼š</p>
<ul>
<li><strong>æ‹‰å–è¯·æ±‚å®¡æŸ¥</strong>ï¼šè‡ªåŠ¨ä»£ç å®¡æŸ¥ï¼Œæä¾›ä¸Šä¸‹æ–‡åé¦ˆå’Œå»ºè®®</li>
<li><strong>Issue åˆ†ç±»</strong>ï¼šåŸºäºå†…å®¹åˆ†æè‡ªåŠ¨æ ‡è®°å’Œä¼˜å…ˆçº§æ’åº GitHub issues</li>
<li><strong>æŒ‰éœ€å¸®åŠ©</strong>ï¼šåœ¨ issues å’Œæ‹‰å–è¯·æ±‚ä¸­æåŠ <code>@gemini-cli</code> è·å–è°ƒè¯•ã€è§£é‡Šæˆ–ä»»åŠ¡å§”æ´¾çš„å¸®åŠ©</li>
<li><strong>è‡ªå®šä¹‰å·¥ä½œæµ</strong>ï¼šæ„å»ºé€‚åˆæ‚¨å›¢é˜Ÿéœ€æ±‚çš„è‡ªåŠ¨åŒ–ã€å®šæ—¶å’ŒæŒ‰éœ€å·¥ä½œæµ</li>
</ul>
<h3 data-id="heading-30">æ•…éšœæ’é™¤</h3>
<p>å¦‚æœæ‚¨åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼Œå¯ä»¥å‚è€ƒä»¥ä¸‹å‡ ç‚¹ï¼š</p>
<ol>
<li>
<p><strong>æ£€æŸ¥ç¯å¢ƒå˜é‡æ˜¯å¦æ­£ç¡®è®¾ç½®</strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">echo</span> <span class="hljs-variable">$GEMINI_API_KEY</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">$GOOGLE_GEMINI_BASE_URL</span>
</code></pre>
</li>
<li>
<p><strong>æ£€æŸ¥ç½‘ç»œè¿æ¥æ˜¯å¦ç¨³å®šï¼Œä¸­è½¬ç«™æ˜¯å¦å¯è®¿é—®</strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">curl -I &lt;https://api.88api.chat&gt;
</code></pre>
</li>
<li>
<p><strong>æŸ¥çœ‹æ˜¯å¦æœ‰é”™è¯¯ä¿¡æ¯è¾“å‡º</strong>ï¼Œè¿™äº›ä¿¡æ¯é€šå¸¸ä¼šæŒ‡ç¤ºé—®é¢˜æ‰€åœ¨</p>
</li>
<li>
<p><strong>å¦‚æœä½¿ç”¨ SOCKS ä»£ç†</strong>ï¼Œç¡®ä¿ä»£ç†æ ¼å¼æ­£ç¡®ï¼Œä¾‹å¦‚ <code>socks5://&lt;user&gt;:&lt;pass&gt;@&lt;proxy&gt;:&lt;port&gt;</code></p>
</li>
<li>
<p><strong>ä½¿ç”¨å†…ç½®å‘½ä»¤æŠ¥å‘Šé—®é¢˜</strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># åœ¨ CLI ä¸­ç›´æ¥æŠ¥å‘Š bug</span>
/bug
</code></pre>
</li>
</ol>
<h3 data-id="heading-31">å‘å¸ƒç‰ˆæœ¬è¯´æ˜</h3>
<h4 data-id="heading-32">é¢„è§ˆç‰ˆï¼ˆPreviewï¼‰</h4>
<p>æ¯å‘¨äºŒ UTC 23:59 å‘å¸ƒæ–°çš„é¢„è§ˆç‰ˆæœ¬ã€‚ä½¿ç”¨ <code>preview</code> æ ‡ç­¾å®‰è£…ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">npm install -g @google/gemini-cli@preview
</code></pre>
<h4 data-id="heading-33">ç¨³å®šç‰ˆï¼ˆStableï¼‰</h4>
<p>æ¯å‘¨äºŒ UTC 20:00 å‘å¸ƒæ–°çš„ç¨³å®šç‰ˆæœ¬ã€‚ä½¿ç”¨ <code>latest</code> æ ‡ç­¾å®‰è£…ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">npm install -g @google/gemini-cli@latest
</code></pre>
<h4 data-id="heading-34">æ¯å¤œç‰ˆï¼ˆNightlyï¼‰</h4>
<p>æ¯å¤© UTC 00:00 å‘å¸ƒæ¯å¤œç‰ˆæœ¬ã€‚ä½¿ç”¨ <code>nightly</code> æ ‡ç­¾å®‰è£…ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">npm install -g @google/gemini-cli@nightly
</code></pre>
<h3 data-id="heading-35">MCP æœåŠ¡å™¨ä½¿ç”¨</h3>
<p>åœ¨ <code>~/.gemini/settings.json</code> ä¸­é…ç½® MCP æœåŠ¡å™¨ä»¥æ‰©å±• Gemini CLI çš„è‡ªå®šä¹‰å·¥å…·ï¼š</p>
<pre><code class="hljs language-perl" lang="perl">&gt; @github åˆ—å‡ºæˆ‘çš„å¼€æ”¾æ‹‰å–è¯·æ±‚
&gt; @slack å‘ <span class="hljs-comment">#dev é¢‘é“å‘é€ä»Šå¤©æäº¤çš„æ‘˜è¦</span>
&gt; @database è¿è¡ŒæŸ¥è¯¢æŸ¥æ‰¾ä¸æ´»è·ƒç”¨æˆ·
</code></pre>
<h3 data-id="heading-36">ğŸ“š ç›¸å…³èµ„æº</h3>
<ul>
<li><strong>å®˜æ–¹è·¯çº¿å›¾</strong>ï¼šæŸ¥çœ‹å³å°†æ¨å‡ºçš„åŠŸèƒ½</li>
<li><strong>NPM åŒ…</strong>ï¼šåŒ…æ³¨å†Œè¡¨</li>
<li><strong>GitHub Issues</strong>ï¼šæŠ¥å‘Š bug æˆ–è¯·æ±‚åŠŸèƒ½</li>
<li><strong>å®‰å…¨å»ºè®®</strong>ï¼šå®‰å…¨æ›´æ–°</li>
</ul>
<h3 data-id="heading-37">å¸è½½</h3>
<p>å¦‚æœæ‚¨éœ€è¦å¸è½½ Gemini CLIï¼Œè¯·å‚è€ƒå®˜æ–¹çš„å¸è½½æŒ‡å—ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[0.5 ç¾å…ƒå‰¥å¤º 3 ä¸‡æœˆè–ªï¼šAgent æ—¶ä»£ï¼Œä½ åªæ˜¯è´¢åŠ¡æŠ¥è¡¨ä¸Šçš„â€œå¸¦å®½å»¶è¿Ÿâ€]]></title>    <link>https://juejin.cn/post/7604805226696228902</link>    <guid>https://juejin.cn/post/7604805226696228902</guid>    <pubDate>2026-02-10T04:40:08.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604805226696228902" data-draft-id="7604786493639573531" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" 0.5 ç¾å…ƒå‰¥å¤º 3 ä¸‡æœˆè–ªï¼šAgent æ—¶ä»£ï¼Œä½ åªæ˜¯è´¢åŠ¡æŠ¥è¡¨ä¸Šçš„â€œå¸¦å®½å»¶è¿Ÿâ€"/> <meta itemprop="keywords" content="Agent,ç¨‹åºå‘˜"/> <meta itemprop="datePublished" content="2026-02-10T04:40:08.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç¨‹åºå‘˜Agions"/> <meta itemprop="url" content="https://juejin.cn/user/360295545187751"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             0.5 ç¾å…ƒå‰¥å¤º 3 ä¸‡æœˆè–ªï¼šAgent æ—¶ä»£ï¼Œä½ åªæ˜¯è´¢åŠ¡æŠ¥è¡¨ä¸Šçš„â€œå¸¦å®½å»¶è¿Ÿâ€
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/360295545187751/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç¨‹åºå‘˜Agions
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T04:40:08.000Z" title="Tue Feb 10 2026 04:40:08 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    7
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#2b2b2b;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(159,219,252,.15) 3%,transparent 0),linear-gradient(1turn,rgba(159,219,252,.15) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin-top:35px;margin-bottom:10px;color:#4dd0e1}.markdown-body h1{font-size:30px;text-align:center;position:relative;width:max-content;margin:0 auto}.markdown-body h1:before{position:absolute;content:"";z-index:-1;top:-20px;height:100%;width:100px;left:0;right:0;margin:0 auto;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA6CAYAAAAOeSEWAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAABkLSURBVGhDtZoHnJ1llcbP3Om9ZiYzmfSQhCQQIbRQVQKI9CYC68qKriJK0UXcZRcINqStIoiIqKCi1NACQihBWiCkkJ5MJlMyvd7p7d759v989/sy34yTbIj48Atz71ff855znvOc971xDrB/EtoGI7a9Z8Aq+wZML0mNj7dE95NZ1OKsj1dHo1GbnJpss9OTbWJyonvun4VP1Njuoagtb+m0it4By0iIt8LEeMvkr8XFWcfgkA1gYDLf47i2PzpsyU7UspKSLDoctagTZ7Vc08MzClMS7awJ2ZaflBB78CeET8TYla1dtrKt2w5KS7YCDGzEoz2RqKUmhGw6x2bhuXyOp2BoRXef1Q1E7Lj8TIsMD1sbxu1kcnYSAX1810RMTUmyMB7f2j1gC7NS7byinNiL/kH8Q8a+2NRh77b32El56VaPAe0YeGR2mh2bm+FdMRqP1rbZe+3dFsHT35qcb/Oz0rwzo7Gxs9feYPLS4kM2h8lawee5hPmlJXneFQeGAzJ2F564v7rFzi7Msu3d/Xgjzq5g8ArX8VCNN2vJ28daey0zZJabmGCLslP5HOf+Oygr3UzDGOf+JxrauXfQjslJt+dbuuyMgiwmk+sPAB/b2Lt2NdoMZnuY21qHIvbvUyZ4Z0ZQiXGrWjvsmPxsK4R0nmHA8ZCTQvxVQn5eRipklIBtcVbV1WtHYsjati47ZWKuTUpP9Z4yGk/xDBGe3v1mW4/dOrvYO7P/2G9jRSjf31FnXyaUXiB8r51WaJkM3kcfOSa2FR6qarIenooTLQHPLcC4mYThyw1tVpKWYlVERlZ8nC3Oz3Jzdn1nn5uvQ8OOHYvhR/CvsqffJbkCkZTvcYZ6Z0WTfTovw5Y1dtjXp+TbFPhgf7FfxpYxuMfr2uwo8rEtMmwXF+d6Z8wGmIR2PLyjo8cqOFffP2SLGexJEJCP9R29thkPXlpa4A5Y3w/jmuVNYYwO2QkY7WMtz3mVcE1hkualJdmSolzX8GnpKd4VZq80d1o7zN0RdWxGaqItgbn3B/+vsasgh/UMNBOvzYMZDxtDKp289KGaVguFQvb1yQWWwuB97GaSXqUUnVaYbSUwrDCEBz/C2CM8EhNrP13fbkeSh3OJgCAe2N1CWXKsGOc6TOr5U4q8MwYhDtkTda02MyPN+nnGBQEH7A37NHYz5KOZVv08qyjbSseEzKauPnsMj98wc6Ibcj5UUv7M8QWZTE52jEwGOVaD8U1Dw1YNWX0qM8VKyb80L/TrOPYOzH4KBJQTrK8M7+7KZjuM63sHBt17FubGoibCuf+tarWFGUmuwWeT8/vCXo1tZOYeZcazCaez8MwEzzM+HqhqtiJI5twxL1jeGLYk7jmKMF1JOCbg6Qj5nAdRqX7q3BYm8VAmQvW1lfcMc58IT95uIA3q+gftrDHPXUXJWkVEHJme5Bp5UmHsvIZ/O3l8ECE/FWcsItX2hr0ae8O2Wjs+J43QTbOZzGYQ/7Wtxq6eXjRK3r0By4YJ6Ty8EiYSJqcm2eGeV4Pox/ANENJR49RiEdfqcLflUJrEBZqgxYHrBjn2ExFURqKdVETN9YirJxKxR2rbrYeQv5ISmB6IsiDGNfZGWPeMgkzr58xnPaJ5p6XDZPKz4T77wayJ7jGhhXLwanOHTWBgq5n5q6YUwNJ7l3kKcRl7OJ7fF56l1GzvHbSD8dghTPi0wIRfv6XafjJ3ssv0PnZQ7nZx/etwzO1zJ3lHR2OETTw8x0tOx1AN3De0D7YV+63oGthjaJQ5Ur7eVVZjcdGInUyuaT73ZWg3efV8fZs7cc2E777Qi5eunVbghvPPymrt/krKGfcLd8ybYjdxrK6333Z09rjHZkNuLYzz0uIc+xWCZzz8nbHbe4dsY1e/XUOY+nimvtUaSazv4jXhaQasSbmYmpuenGwHZ8TKggSEQm08rMD7ahBOoExcMqXQegjnZ+CEvaEa1ZQUQkt39dj0zDS7krq+ARmpdws/nlNqD9WFbWN7l5u3wr9MyrcXKUsqWy3jTOaoML4DdaQ83YIoT4VYpEXvYQZLmbX5SLohBrgOj186Kc/iKTUPUhq+Rrm5ekOl3TWv1Mr6hqwbY0VOQXwEo+Moq4Z47q5qsU489G944LyJOW4LOLZOKtT/iI6+nGe/0dhuEd4ltj2NmiuCU4hnk5fHIi7+RK4uTEu0e+s7rAiRcw1CYy3OejvcYz+eXeI9MYY9nu3lYZl0KavJJ7Vjibzgjp319rUZE20j7CkJqFr5JQYgQ39f3eQaKpQk0afy8nl4uBzvjUUTRk7k3iebOm0pabDiyFn2XGu3dRME41CGVeBVqSiVnc6hIUpekp1VjHLDSOEcQlui5W/U8C7IKREjv1Gabw3wRwUTvpv7jybPtzHmIPZ49q6KRjuccqBQVCOtGvqXhrCFUUXJzOYSHt7Kw5Ix9H08dSje1o1JyL73IYXpEMmE5CRbw6wuykx2pR+Pd6/J4JpLiJKV6N9OnrcQNfQ0Zem6qQX2MmFXyWTE+DMO0kGx4e08DEjnXbsYuOq7niHB8jdY/wQ8Srm2XCZZUrOakF1CY5EKX0h93Tu/1J4kRdbDMT8MamgZK9xe3uDcvrPe++Y4f61rcZr7B53rN1c5N2ytcV5rCrvHt3T2Og19g+5nH7dvq3bqunr4NOwgK2MHA1jeEDuG7HNuLmtw7qpocl5t6nCPvdTQ7v4N4u3WTqeyu9cZHIo4f6lqdFoHh7wzMbzDeeGv3Hvzjlrnh2W1zofhHuftxpFn3VFe7zxS0+p0DlKVPbhhvBxhvwiFMgfP+mjHA08gEC4pybeLyK1iZldh8zC5VJQyUl8l59KZ0WJk2xaiYWxNrkXXJhA8r3PvZRur7ZZZRfadaRPsfiTmX9HGajC2tXd6V8dQTMhX0h8rNdJx9Ra8F8SbRNLzhPRnJmTZIUTYueTyWxyr7uv3rjC3OkzE8495oS+4xq6D5WoI0bO5WVCOSerl8rIeBrOI/Hkaw6ME5W1zSuzx2la3CRdWi3zIG+FDBvUp9LMgI/vggUmE7KkT81yGvOOgEYa/aUahhRAF5xLec3OzbF1r2O17BbVxIi7hzJIC64IYhXdJA+nh/5xVbOmE9J0QqjSxWk0pp37M2YEtgjS8GpimACu7xkqxdKJ6fEXyYl2Lre0ZtC8yELVewtWUnbfCPIhrvgDFz8WI5yhJKgcnFMZWEFrwhgzo5uWDDDA1oGSOzcu0xfx7vTlsv6posIMpJ6cGWPiw/BxL4PU7vbrpjgf8bMdu5OYwOdhm83DARUSa0ELknYIeEAaILuWxlhGa0M8+EuJCrpJT+ymENhN60pXBxa3LZ5TsucnlGaCmIEQ4Evru91yuz0xMtKaeXluI5zdh9Mm8vAlBn4aR07X64EH3vEKdXQkZJXPP/JxMvNRpLxEtHZ5RQgmNewnpouvVTpYTHdfOnmy5kFUGnpRTfEhXD9DiBdFFJB0/YWS9aj6pmc89r0BaQmgTRkgI+EsdKsYasJZOBF+QqTH474NK7LbyBvf7W+RgOxNyxfQY2/2hrp2+NkroxrzrQ55fSZkpJIa28znCgF6rb7H1hOSslATyvNflAh9pvHcX3lVE/Ya8FjTJIexa2Rq77nfU96unTnD7aME3+TAm6BFKYrPnqCNIqV5sq0ZGCiEV+Db+qWMQqpFgb5KPx48R6omeDl2EuP9DTYt9iGA/f1KBS1w/La+H4ktsSmLItvZHXLUkrCeflVtJ9DVVg1H7+sxiGvVM975rZpfabuqHVhuP5F1vewav5O8GamUe91yDanoYw47FWzC929O+DJnKA2opFY1Rjru5CE7kOcO0jJtQVUIynzuZEMeb+1CEOFXN8iFSGeRpCm1BTlJxVg49Azm819SO7Bu0axEbwn27GuxMck+TMQHDP8fn48gfDVIL4R8xKVPJ73MQBUIfA/Z54LMw5vmlE+w+VFo2A78X/SsyPA/RMD0z3e2qVLtfo7aeBslpMX0N0TEnLcUlKym1jyBFqSohmYntI5enBhYB9CY/2kNarhwJhNiMtRGyWnkQdKaCFyQwgydjyNUw4VchKxXv2/DoKdC+lkQbCX1NlKCGvJiBJkSGbCus6jfo4yGBNySgr+u7e20BCsxdVAcFlJ/tHd32+cIsNxSXUULUUx+dg/d47g7OPYFw2MxkSuyMwLHVTI6PBN6dS8Sppw45zHJSgDXV3aQzmz40Z6fDgBfiAXU0uZxby2zejee+j3eltoQMzhV6qSBogXwrEXDj7ElWxUQ8RrnSaoU0dxIsKaiMvMykXTu90NqJsGHP4z78SdLigUrLKat32nFwy/E07pfDFRdQ/7N5r57pQ1482uvWhMGhQcviGkVrKDUp0ToCxfhQal5n4Hs/g1jOgH4LWdwFOd1b1WzHET4vLZppv+Czjxo840OrDlG8jAJzv2tp5mLK1dsU/lfIOeWy5NxFxfl2BoYImlQtx9QF6mJRQKBsQYYuO2yaLYPBUXvu/VqYPxtHhNy7Y4hCkNLGPtKSklzCVKSHtMQxcqm5Kw1DhI2PTGZtcGDAvoLQ/u7MifYtWFBlxz2H9zo8RkwKzC5UYiG+p44ccqE62YAxLeT/TOpf8MXx8Qk0IJFRY1Go+viQVJpE5Ehjf49xfAZeqGIy/7us3nqxwQfCkjZypPxobVr/6YpQHIalUvuCyEwbSXC9PC8QnkFcXlrgLpoLIhIfKuaqlQkYIAwQnr/f3eyu7KttOw2lNpv8/BPHyjzVNER3o72gvEBKqRMTflndbP8BMweRDyeciEj5bFayFXqTLzheivgYJC0jwzwHa0MDDEotm48ndze5BBBElAnxxcRYHAFh3FfZaA9UNRmC354kNwUx8eHkmVj5dcTE5ZMnuEyr1QqlhtaJLuOYZv4v3KNo0TKrGPUZ1NILPKuWcvVn5Trv10SMB6h0j/ARMnlOuafCBIfnSWEx/Raif3HDzofYMM31dOyY9LBaLK3TjoX2fEqT4+2qaUVWSTQvyM6wC8nNJyEetXIyuLKrx04P7MKNnbJZlKUtNAIHo7i2dA/YU3Vtdi5l6jCepXy8hOedSSSsI8/HQg5Q+gxTKXwkMHkbESo+hjG0lbRRzQ3Fc5LOzDuFhs3Ptumpie7ilRDhlEJOq/hjsZljCxjkt7fWuPS/EekpXMggJQIk0G+eN9Xu2VmHWIkJe0nJRN4ptBBit2yutG9ML7J1DHAxebiAMrZ4VZlduqGS8I2tJc2iborUxmIN79c+kTovFxivPvrcSaP3n7RSKYTUmKt4N3rMOcw4JOneD3sP956jNaMglIeTER5Xbdlt15Tm2W10NEsYrA/N5JLCHHsR9tSqwxq08G3bqm1ZTbOtagnbo6SLvH/VzBL7W7jPzqFea0LmMLFzUuLtdwumuO3i1Vtq7OK15Xgw3l1PDmIXak+6QBEkvB9YJIzBcc/L20JIYaSZ/qAzVm5Ut4oowk3QehC+N3xo/1wTqt7zsYawfX9no9XjqdPXVLhrwyo/wucJYQkE1e4j8rLcBuHUItQQKqgMXb6LGvxFQlXw33AdZLR0V5P9Fr29lP73scNnosoyvdWPv4fPJ+uJrLVtMakqaL1M1cTvv0OLIZE6wk2a2IcIRUQh+DaejpdcXepBa7bKDRGM9PIVxTl2EwarZ72rooVuY4RQtMypdk6e1lLLehhY2lt7QEd7WxlCDvdIli6E9B4+ZIodmZEMccUGqgiZOqru9tkR3iJ8nCcXRWRZCSPMLPEjlx2LjQL1OM5qKAm+vhSuRqSfV5Ttrg8FdWcrnhMqCTex7DEM6qTsVEuM1+8hovaHQ6e6a1Fz0xLd3nUt4ToWWuzWNkhcoAIIjUx2ZpxjLzWF9+SYmngR1lok4TEoJxGfuijhI/7OICoFmadl2llcL9b1oRVJtbD+JLlv1KrhHG5811t9ELbzgk14ICUwqE+TDzftqHPz98vUSy3jSIwP8dCpkNqLDPTx+rArz4T5qLG3G2PrvJKKPoLBWE501NC3ilUX5mVjVIb9nIbgWcpPMiSXjbcL8K62UkR86m1/yfkSeMaHFuK04X0CE3J6SWzFUxw0BSNHlSzi3RmIRJwHq5udO3c16quLp6sbnffbupxbt+12vzOrzuvNHc7ycRbIxuJHgYU7YSASdQgxp7qz2ynv6HJeqW91doa7nLruXof+17sqhhu31Xif9o7HalqczV29Dnrb/f5EXZvzdH27U98/6LR5i3N0UM5zjHU71/lwjRWWltU5CAIn7F1MqLp/r9hQ5RoaxG+qmrxP4yNKcfsFLwuiprffeb2l03m2scO5h3Or2rudzjGrhk8x4Cqu2xcexilBvNEcdi5Yu4tKF3Ue4tzPy+td5/1md4tzw5iJ27NuXEYobYUdlb8z6GTWkdxaCvk2zHjd5mpKQ459mv5TkAp6mQb9Aq9HHQ8S6mrZnuc6vUG6WHusIhCJGNXl9byvnJyaiE7+Eoz8c5TYNQiUveENGpJpcIJ+biS8R0+rlcazGNs7pKB+zPLTOSX2KNWhlDAf4r2Spj72JORB5OyHULX+dlD/FOky/HFy5ygYU0sey/i8moeqdunXK1qC3RuaMOYHlI/raQMl3M+EeTV5WxD3Km8a8PkM8nr648sQ9+esKbf5e/nxiKBfAOQkxbv3SU9LYmqPV9V/Pn+V20VwTyVjTqCI6edEQUOFUXs9WmfSll8DyX2dt7GlnwkswaM3l9XZ0oNK3MTXbxpOV2sGk69s6XCJw4cY8KbyRrt9TrHt7Bm0rRBQe1+fHUWNfaapU0KbqxzbORC1M/LS3dJwIl3KOrwykQG/E+61q+isgniztdOKqNOziDgZqZIzFwPvqGiyg5NCtoCqoG5NxHhPZTOsnORulKskjoKMDeLuXQ3OmnC3syxARFXdfc57LR3OrdtrvSOOs55rnqhtcdoGhpxHdjc5EfJUuHZTlftX+G15rXPlhkrnLe59F7Lz8VGHdg8c5y2OLeMZ126qduq9XC3v7nd+FchLvYPJd15gPCu8XQnh/qpm59WGVudZzvvQO97kXTcGxhnEuJvR39tWY8cwK4uhcikk4a3Gdstg9l5B2t0wfaTdWkEou5vCPOV5PH73vFL3+DfXltnh6OxjkJD6Wd5F3g88tMe6CW/7YmI99VIL4u0oqUK8ocW4d8hFrXMVoOQU8s3U97MnjvDD/XRYkyhHM1MT3GVZQR2Tdv70U8EbA5vlo+CaPAaaSWoZXm50otGodxQ6L6txGKxzw5ZYORrBsPPrykZKQIy1n8bTjwb2fO4Te3ue7x6KOKvaYns1wtIddd4nx3mwot55qyl2360cp81zurg+CGqwU8v4/Of5uAVvPgObrwvHomY8jOtZ4fXWLnefdHVXv9044+8ZklCx75DXwcV1Sb27y+vInUQEuVYSaMgRJYfAwtoj0raFxIUW1A8nz35f02qLc9Lc9lG7CBkwtUR7bf+A+5uL6ehnH9Lat+5sIEfj3Cbj3NKRvP7Rjlo7FSmqavKvpSP8MRZ7NVbQYLSkqlC9ZW4sPH18gBTcORjrhMWmQWzFmK2UsvO90qQ1oZcI8UhkCLZPtRqMy0NirobAvjIpb4/sW06qKGyPR2oGIdlazjOOTk+kLYzaaYGSp63Wz6HsXsQ51wd+LTAuZOy+8GBNq7tF+IOdDU4kENJthNID5YRafZtzZ3mDs9LbRgzixcZ2l1h83OKFbDmEd0/FiFp7DWHgp0AQGzq6nf8hPF+oa3EehOz0ziCWcm4NpBRMhX1hn571oR9wqVVSDVPtUi32sQ0vbu7scZdY9aOt2ZSEL9BEBIW+dv20AKDd9/ep09oimYqHpyImkKDuRllS4PrlHNuIqDmCJmNJQba7q1joEaUQJuR/WdXsLrJrq/L6cdJsPOyXscJ7GLKqo8cOpqhrO//yQG6oS3kZwS9xPkRB3wi7diFMtDN+PLk5m1ath+8f0Fy80dbjhvVXub+U5mEqeal27UP+dWpPlknNxW79Ak6/7Tg3UMOF52j1xA1qK7Trd6nXC+8P9ttYQcumIonLSnJtBdJNa77axw1C2x3qR4Wqnj73x9f6MbV+CCYFBZO6y51aSh3gzVrsmwzJnULEbCJC1oZ7vIZ/9Iqmfvn2u5oWO5n8fApxcuWUApum5diPgY9lrA9EtvUNOzYf8vqAcJPsU5iOh7XtXQgt2uZhjKU2amF7HQyfEYWcZk5yQ1RDKNrLcq02k/9IGmldrB93KiokPw8EB2SsoKWXO5FmxXhlckqi+3vEUvLqwok5PHVkIWAszlqzy1p54zuLpnPZ3q9bod08JlLSb5DrNxDm38Sbvsg5EBywsT7oH+3XNW3uasGirFSrxRNdCllKiPZHZzJYLZb5qEcpae3pxMCuu9oibS5/QCOiLcYUrp+MmtJeURjFdVlxzqiae6D4h40NQt54HyGv3JRo10aVfv8YhtC0pSlVKcPFuxIXahr08mzCO4VzMlLSsZuomZ+RaucU0rXsw/sfF5+osUFonWob/7TrLdaUgdpV93fl9X+VIC0Y6tek2uI8OD3J5gT2Vj9ZmP0f4IM4iY7RQ5gAAAAASUVORK5CYII=) no-repeat 50%;background-size:64px 64px;opacity:.84}.markdown-body h1:after{position:absolute;content:"";width:150%;left:-25%;height:50%;bottom:12px;border-radius:50%;background:linear-gradient(transparent 80%,rgba(77,208,225,.8));background-size:400% 200%;opacity:.6;animation:h1Animate 6s linear infinite}@keyframes h1Animate{0%{background-position:100% 100%}50%{background-position:100% 50%}to{background-position:100% 100%}}.markdown-body h2{display:block;border-bottom:4px solid #4dd0e1;position:relative;font-size:24px;padding:12px 32px;margin:30px 0}.markdown-body h2:before{width:24px;height:24px;left:0;top:0;margin:auto;background-size:24px 24px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADGklEQVRYR81X32vTYBQ999s6mFjQgQ+DrbHiVFZYU4cDcQ/6pGhTFVYFEXGi82H+Bz448UnEF1Fx9ccEEcXpZE3d5tP2ooKiTacTHaLNpigMHDgnU9tcSbrWrkwWR0sbyEOSe885ObnfvV8IRT6oyPwoLQHBx+OVM5WJvSyEVAhnBOjt7yU/+/rr6r6l8TMO+F/EN0JQhICqQpD/xaRpcpAc9tS+M+9lBCia/oqBamK+zeDuQogQZaKJk3wcQjxSva7tGQGB2Ke1zIk3DNyMyNL+QpCnMQOaPsDAVuGAp9cjvbYc8Ec/bCYSg0zoiHilk1tHxqsqEsYlML4kjIpT/eurJxRNPweQU5VdrWaOEo1fgKAVbBgXIz73kF3R/ph+ghgdzMYWM29eAWlBJqgZaFlFYtC6nhWpaDqnSGlIlV1WjJ3DloDNgyNLncudqgX//Ucg3LxuStHGuhi8pqKCW3rqV342rwFjRznKm+/LNaN2yC237ThgF2wxcfMLeP6+ncrKzoPoKTGeLQbYbg4TNoC5iZPJY5HGVRdSNZAWYBclD3FzBQzrR8hACAKdzBzKA/4/IYioDQaOskBbpEG6PO8qKKSAEi3CnEb0Pw4oMf0OmKbTDWqh3Lw6EIiNBZi5lxh3wz4puBD5ovqAMvxhHSdFKxE1CQe3m/07TeTX4lcJdAhE+1Sv65Z5P/ByvIGTRowIZ9igbtXnmrOsbTvgj+kHBNMuBu9OdVw8EeU4nC1A0cYmAHZOTRrLhra4Z8ywnSN6vZHAFTA2WnnMfQB3qz73ddsOZM8CACFDIPSgQXqebXEgqgeZcAeEe6pXasm1f8ew3igMtAHWac0Uc/jYdyAaP0xEBwFsmgUPqbJ0NE2UKj4EGcahiOzuyhagaHpnmtgcVgTcCMuua7YdyAHbA3ArQNscVFbb4635aD6fnYaTvxxi9UNP7ddMXaRWVBdAcaLk6bDXPZCNZ9uBXEsDUX1T2Cc9yjig6Z0EHg3LK8/aqf6MwJKchkXfks1+0+JtSq3qLPa23BRR1B+T/6nkfMaW1r9hPt/MLtYfTLEpP+T9FNoAAAAASUVORK5CYII=)}.markdown-body h2:after,.markdown-body h2:before{content:"";display:block;position:absolute;bottom:0}.markdown-body h2:after{right:0;width:400px;height:10px;border-top-right-radius:24px;background:linear-gradient(90deg,#fff,#4dd0e1);max-width:50vw}.markdown-body h3{margin:30px 0;font-size:18px;position:relative;padding:4px 32px;width:max-content}.markdown-body h3:before{border-bottom:2px solid #4dd0e1;width:100%;content:"";display:block;height:28px;position:absolute;left:0;top:0;bottom:-2px;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);background-repeat:no-repeat;animation:h3AnimationBefore 2s infinite alternate}@keyframes h3AnimationBefore{0%{width:28px}25%{width:100%}50%{width:100%}to{width:100%}}.markdown-body h3:after{content:"";display:block;width:28px;height:28px;position:absolute;border:2px solid #4dd0e1;border-radius:50%;right:-15px;top:0;bottom:0;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);animation:h3AnimationAfter 2s infinite alternate}@keyframes h3AnimationAfter{0%{transform:rotate(0)}10%{transform:rotate(0)}50%{transform:rotate(-1turn)}to{transform:rotate(-1turn)}}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin:22px 0;letter-spacing:2px;font-size:14px;word-spacing:2px}.markdown-body img{max-width:80%;border-radius:6px;display:block;margin:20px auto!important;object-fit:contain;box-shadow:0 0 16px hsla(0,0%,43.1%,.45)}.markdown-body figcaption{display:block;font-size:13px;color:#2b2b2b}.markdown-body figcaption:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEVHcExAuPtAuPpAuPtAuPpAuPtAvPxAuPokzOX5AAAAB3RSTlMAkDLqNegkoiUM7wAAAGBJREFUKM9jYBhcgMkBTUDVBE1BeDGqEtXychNUBeXlKEqACsrLQxB8lnCQQClCiWt5OYoSiAIkJVAF5eVBqAqAShTAAs7l5ShKWMwRAmAlSArASpAVgJUkCqIAscESHwCVVjMBK9JnbQAAAABJRU5ErkJggg==);display:inline-block;width:18px;height:18px;background-size:18px;background-repeat:no-repeat;background-position:50%;margin-right:5px;margin-bottom:-5px}.markdown-body hr{border:none;border-top:1px solid #4dd0e1;margin-top:32px;margin-bottom:32px}.markdown-body del{color:#4dd0e1}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(77,208,225,.08);color:#26c6da;padding:.195em .4em}.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#4dd0e1;border-bottom:1px solid #4dd0e1;font-weight:400;text-decoration:none;margin:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(77,208,225,.1)}.markdown-body strong{color:#26c6da}.markdown-body strong:before{content:"ã€Œ"}.markdown-body strong:after{content:"ã€"}.markdown-body em{font-style:normal;color:#4dd0e1;font-weight:700}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(77,208,225,.05)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{margin:2em 0;padding:24px 32px;border-left:4px solid #26c6da;background:rgba(77,208,225,.15);position:relative}.markdown-body blockquote:before{content:"â";top:8px;left:8px;color:#4dd0e1;font-size:30px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"â";font-size:30px;position:absolute;right:8px;bottom:0;color:#4dd0e1;opacity:.7}.markdown-body blockquote p{color:#595959;line-height:2}.markdown-body ol,.markdown-body ul{color:#595959;padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p><strong>500 å€ã€‚</strong>
<strong>è¿™æ˜¯é¡¶çº§ AI Agent (å¦‚ Devin/OpenClaw) ä¸äººç±»åˆçº§å¼€å‘è€…çš„æˆæœ¬å·®ã€‚</strong></p>
<p>åˆ«å†è°ˆä»€ä¹ˆâ€œæƒ…æ„Ÿä»·å€¼â€æˆ–â€œè½¯æŠ€èƒ½â€äº†ã€‚
åœ¨è¿‘æœŸ Q3 è´¢æŠ¥é‡Œï¼ŒKlarna ä»…ç”¨ 350 ä¸‡ç¾å…ƒçš„ AI æŠ•å…¥ï¼Œå°±æ›¿ä»£äº† 700 åå…¨èŒå®¢æœï¼ŒèŠ‚çœäº† 4000 ä¸‡ç¾å…ƒçš„è¿è¥åè´¦ã€‚</p>
<p><strong>æ‰¿è®¤å§ï¼šä½œä¸ºâ€œä¿¡æ¯å€’å–è€…â€çš„ä½ ï¼Œæ­£åœ¨æˆä¸ºå…¬å¸ç³»ç»Ÿé‡Œæœ€æ˜‚è´µçš„ç“¶é¢ˆã€‚</strong></p>
</blockquote>
<hr/>
<h2 data-id="heading-0">ğŸ“‰ 1. ä¸­é—´å•†çš„â€œå¤§æ¸…æ´—â€</h2>
<p>æˆ‘ä»¬æ­£åœ¨ç»å†äººç±»å†å²ä¸Šæœ€æ®‹é…·çš„**â€œè¯­ä¹‰æŠ˜ç°â€<strong>ã€‚
æ‰€è°“çš„ä¸­é—´å•†ï¼Œæœ¬è´¨ä¸Šæ˜¯</strong>åœ¨ä¿¡æ¯å·®ä¸­èµšå–å»¶è¿Ÿè´¹çš„äºº**ã€‚</p>
<ul>
<li><strong>åˆçº§å®¢æœ</strong>ï¼šåœ¨çŸ¥è¯†åº“ä¸æ„¤æ€’çš„ç”¨æˆ·ä¹‹é—´ï¼Œå……å½“ä½é€Ÿçš„è¯­ä¹‰ç½‘å…³ã€‚</li>
<li><strong>CRUD ç¨‹åºå‘˜</strong>ï¼šåœ¨ StackOverflow ä¸ä¸šåŠ¡éœ€æ±‚ä¹‹é—´ï¼Œå……å½“æ˜‚è´µçš„ä»£ç æ¬è¿å·¥ã€‚</li>
<li><strong>åˆçº§æ–‡æ¡ˆ</strong>ï¼šåœ¨å“ç‰Œè°ƒæ€§ä¸ç©ºç™½æ–‡æ¡£ä¹‹é—´ï¼Œå……å½“é«˜æŸè€—çš„å…³é”®è¯è§£é‡Šå™¨ã€‚</li>
</ul>
<p>åœ¨ Agent é¢å‰ï¼Œè¿™äº›äººçš„å¸¦å®½å¤ªä½ã€å»¶è¿Ÿå¤ªé«˜ï¼Œä¸”ç»´æŠ¤æˆæœ¬æå…¶ä¸ç¨³å®šã€‚</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    subgraph Human["ğŸ”´ ä¼ ç»Ÿäººæ•ˆç“¶é¢ˆ"]
        A[éœ€æ±‚å‘èµ·] --&gt; B(äººç±»å‘˜å·¥: æ€è€ƒ/å¼€ä¼š/æ‘¸é±¼)
        B --&gt; C[äº§å‡º/ä»£ç ]
        B -.-&gt;|éšè—æˆæœ¬| D[äº”é™©ä¸€é‡‘/æƒ…ç»ªç®¡ç†]
    end
    
    subgraph Agent["ğŸŸ¢ Agent ç¬æ—¶æ•ˆç‡"]
        E[éœ€æ±‚å‘èµ·] --&gt; F{AI Agent}
        F --&gt; G[çŸ¥è¯†åº“è¯»å†™]
        F --&gt; H[API å·¥å…·è°ƒç”¨]
        G &amp; H --&gt; F
        F --&gt; I[äº§å‡º/ä»£ç ]
    end
    
    style B fill:#ffe6e6,stroke:#ff3333
    style F fill:#e6fffa,stroke:#00cc99
</code></pre>
<p><strong>çœ‹æ‡‚è¿™å¼ å›¾äº†å—ï¼Ÿ</strong>
ä¸­é—´çº¢è‰²çš„æ¡†ï¼ˆäººç±»ï¼‰ï¼Œæ›¾ç»æ˜¯ä¸šåŠ¡æµè½¬çš„å¿…ç„¶ã€‚
ä½†åœ¨ä»Šå¤©ï¼Œé‚£ä¸ªæ¡†å« <strong>â€œæ²Ÿé€šæ‘©æ“¦åŠ›â€ (Communication Friction)</strong>ã€‚</p>
<hr/>
<h2 data-id="heading-1">ğŸŒªï¸ 2. ç®¡ç†æˆæœ¬çš„â€œéçº¿æ€§å´©å¡Œâ€</h2>
<p>å¤§å¤šæ•°äººå¿½ç•¥äº†ä¸€ä¸ªçœŸç›¸ï¼š<strong>ç®¡ç† 1 ä¸ª Agent çš„å¤æ‚åº¦æ˜¯ 0ï¼Œç®¡ç† 1 ä¸ªäººçš„å¤æ‚åº¦æ˜¯æ— ç©·å¤§ã€‚</strong></p>
<p>è¿™å°±æ˜¯ <strong>â€œç®¡ç†æŠ˜æ—§â€ (Management Depreciation)</strong>ï¼š</p>
<ul>
<li><strong>äººç±»å‘˜å·¥</strong>ï¼šä½ éœ€è¦åŒæ­¥ä»–çš„è®¤çŸ¥ã€è€ƒæ ¸ä»–çš„ KPIã€å®‰æŠšä»–çš„æƒ…ç»ªã€å¿å—ä»–çš„ç¦»èŒã€‚è¿™äº›å…¨æ˜¯ä¸šåŠ¡çš„<strong>éšå½¢è´Ÿå€º</strong>ã€‚</li>
<li><strong>AI Agent</strong>ï¼šå®ƒåªéœ€è¦ä¸€ä¸ªå®šä¹‰è‰¯å¥½çš„ <strong>SOP</strong> å’Œä¸€ä»½ <strong>Tool Authorization</strong>ã€‚</li>
</ul>
<p>å½“ Agent çš„ Pull Request é€šè¿‡ç‡è¾¾åˆ° 67% æ—¶ï¼Œå®ƒä¸ä»…ä»…æ˜¯å†™ä»£ç æ¯”ä½ å¿«ï¼Œå®ƒæ˜¯å®ƒçš„<strong>ç”Ÿå‘½å‘¨æœŸç®¡ç†æˆæœ¬ (LCC)</strong> è¶‹è¿‘äºé›¶ã€‚</p>
<hr/>
<h2 data-id="heading-2">ğŸ›¡ï¸ 3. å”¯ä¸€çš„ç”Ÿå­˜æˆ˜ï¼šæˆä¸ºâ€œæ•°å­—ç‰§ç¾Šäººâ€</h2>
<p>è¿™æ˜¯å¦æ„å‘³ç€æˆ‘ä»¬éƒ½è¦å¤±ä¸šï¼Ÿ
<strong>ä¸ã€‚è¿™åªæ˜¯â€œæ‰“å·¥ä»”â€é€»è¾‘çš„ç»ˆç»“ã€‚</strong></p>
<p>æ­£å¦‚é‚£è¡Œè‘—åçš„æ³¨é‡Šï¼š<code>// Agents are powerful, but they need a Driver.</code>
AI æ“…é•¿å¤„ç†<strong>å°é—­ä»»åŠ¡</strong>çš„æé™ä¼˜åŒ–ï¼Œä½†å®ƒåœ¨<strong>å¼€æ”¾æ€§å†³ç­–</strong>ä¸Šä¾ç„¶æ˜¯ç›²ç›®çš„ã€‚</p>
<p><strong>æœªæ¥çš„èŒä¸šæŠ¤åŸæ²³åªæœ‰ä¸‰æ¡ï¼š</strong></p>
<ol>
<li><strong>å®šä¹‰ç›®æ ‡</strong>ï¼šçŸ¥é“â€œä¸ºä»€ä¹ˆâ€è¦ç Œè¿™å µå¢™ï¼Œè€Œä¸æ˜¯â€œå¦‚ä½•â€ç Œç –ã€‚</li>
<li><strong>å·¥ä½œæµé‡å¡‘ (Workflow Architect)</strong>ï¼šå°†å¤æ‚çš„ä¸šåŠ¡é€»è¾‘æ‹†è§£ä¸º Agent å¯æ‰§è¡Œçš„åè®®ï¼ˆProtocolï¼‰ã€‚</li>
<li><strong>æœ€ç»ˆå…œåº• (Human in the Loop)</strong>ï¼šåœ¨ AI äº§ç”Ÿå¹»è§‰ã€é€»è¾‘å†²çªæˆ–æ¶‰åŠæ³•å¾‹ä¼¦ç†æ—¶ï¼Œè¡Œä½¿é‚£ä¸€ç¥¨å¦å†³æƒã€‚</li>
</ol>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant O as ğŸ‘¨â€ğŸ’» è¶…çº§ä¸ªä½“ (You)
    participant A as ğŸ¤– Agent é›†ç¾¤
    participant M as ğŸ’° å¸‚åœºéœ€æ±‚
    
    O-&gt;&gt;A: æˆæƒ &amp; æ³¨å…¥æ´å¯Ÿ (SOP)
    A-&gt;&gt;A: å¤šæœºåä½œ &amp; å¹¶å‘æ‰§è¡Œ
    A--&gt;&gt;O: å¼‚å¸¸ä¸ŠæŠ¥ (Edge Cases)
    O-&gt;&gt;A: å†³ç­– &amp; å…œåº•
    A-&gt;&gt;M: æä½æˆæœ¬äº¤ä»˜
    M--&gt;&gt;O: ç°é‡‘æµç›´è¾¾
    
    Note right of O: ä½ ä¸å†æ˜¯é›¶ä»¶ï¼Œä½ æ˜¯ç³»ç»Ÿçš„é€ ç‰©ä¸»
</code></pre>
<hr/>
<blockquote>
<p><strong>ç»™ä½ çš„æœ€åä¸€ä¸ªè­¦å‘Šï¼š</strong>
<strong>å¦‚æœä½ è¿˜åœ¨è¿½æ±‚â€œæŠŠä»£ç å†™å¾—æ¼‚äº®â€ï¼Œä½ å°±æ˜¯åœ¨é›•ç¢ä¸€å—æ³¨å®šè¦ç¢æ‰çš„å†°ã€‚</strong>
<strong>å»å­¦ä¹ å¦‚ä½•è®¾è®¡é‚£ä¸ªå†»å†°çš„æ¨¡å…·å§ã€‚</strong></p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[è®© AI ç¼–ç¨‹ä¸å†"å¤±å¿†"ï¼šplanning-with-files æ’ä»¶å®Œå…¨æŒ‡å—]]></title>    <link>https://juejin.cn/post/7604805226696245286</link>    <guid>https://juejin.cn/post/7604805226696245286</guid>    <pubDate>2026-02-10T05:04:28.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604805226696245286" data-draft-id="7604784281956859942" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="è®© AI ç¼–ç¨‹ä¸å†&quot;å¤±å¿†&quot;ï¼šplanning-with-files æ’ä»¶å®Œå…¨æŒ‡å—"/> <meta itemprop="keywords" content="AIç¼–ç¨‹,äººå·¥æ™ºèƒ½"/> <meta itemprop="datePublished" content="2026-02-10T05:04:28.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å°ç¢—ç»†é¢"/> <meta itemprop="url" content="https://juejin.cn/user/1618104611770958"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            è®© AI ç¼–ç¨‹ä¸å†"å¤±å¿†"ï¼šplanning-with-files æ’ä»¶å®Œå…¨æŒ‡å—
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1618104611770958/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å°ç¢—ç»†é¢
  </span> <!----> <!----> <div class="vip-level" data-v-cd7d0a50="" data-v-292f6e48=""><span class="tooltip" data-v-cd7d0a50=""><div class="byte-tooltip byte-tooltip--dark" style="display:none;">
        VIP.5 å¦‚é±¼å¾—æ°´
      </div><span class="byte-tooltip__wrapper"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8AQMAAAAAMksxAAAAA1BMVEUAAACnej3aAAAAAXRSTlMAQObYZgAAAA5JREFUKM9jGAWjAAcAAAIcAAE27nY6AAAAAElFTkSuQmCC" alt="VIP.5 å¦‚é±¼å¾—æ°´" title="VIP.5 å¦‚é±¼å¾—æ°´" class="lazy" style="aspect-ratio:NaN;" data-v-5244ef91="" data-v-cd7d0a50=""/></span></span></div> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T05:04:28.000Z" title="Tue Feb 10 2026 05:04:28 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»13åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#2b2b2b;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(159,219,252,.15) 3%,transparent 0),linear-gradient(1turn,rgba(159,219,252,.15) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin-top:35px;margin-bottom:10px;color:#4dd0e1}.markdown-body h1{font-size:30px;text-align:center;position:relative;width:max-content;margin:0 auto}.markdown-body h1:before{position:absolute;content:"";z-index:-1;top:-20px;height:100%;width:100px;left:0;right:0;margin:0 auto;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA6CAYAAAAOeSEWAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAABkLSURBVGhDtZoHnJ1llcbP3Om9ZiYzmfSQhCQQIbRQVQKI9CYC68qKriJK0UXcZRcINqStIoiIqKCi1NACQihBWiCkkJ5MJlMyvd7p7d759v989/sy34yTbIj48Atz71ff855znvOc971xDrB/EtoGI7a9Z8Aq+wZML0mNj7dE95NZ1OKsj1dHo1GbnJpss9OTbWJyonvun4VP1Njuoagtb+m0it4By0iIt8LEeMvkr8XFWcfgkA1gYDLf47i2PzpsyU7UspKSLDoctagTZ7Vc08MzClMS7awJ2ZaflBB78CeET8TYla1dtrKt2w5KS7YCDGzEoz2RqKUmhGw6x2bhuXyOp2BoRXef1Q1E7Lj8TIsMD1sbxu1kcnYSAX1810RMTUmyMB7f2j1gC7NS7byinNiL/kH8Q8a+2NRh77b32El56VaPAe0YeGR2mh2bm+FdMRqP1rbZe+3dFsHT35qcb/Oz0rwzo7Gxs9feYPLS4kM2h8lawee5hPmlJXneFQeGAzJ2F564v7rFzi7Msu3d/Xgjzq5g8ArX8VCNN2vJ28daey0zZJabmGCLslP5HOf+Oygr3UzDGOf+JxrauXfQjslJt+dbuuyMgiwmk+sPAB/b2Lt2NdoMZnuY21qHIvbvUyZ4Z0ZQiXGrWjvsmPxsK4R0nmHA8ZCTQvxVQn5eRipklIBtcVbV1WtHYsjati47ZWKuTUpP9Z4yGk/xDBGe3v1mW4/dOrvYO7P/2G9jRSjf31FnXyaUXiB8r51WaJkM3kcfOSa2FR6qarIenooTLQHPLcC4mYThyw1tVpKWYlVERlZ8nC3Oz3Jzdn1nn5uvQ8OOHYvhR/CvsqffJbkCkZTvcYZ6Z0WTfTovw5Y1dtjXp+TbFPhgf7FfxpYxuMfr2uwo8rEtMmwXF+d6Z8wGmIR2PLyjo8cqOFffP2SLGexJEJCP9R29thkPXlpa4A5Y3w/jmuVNYYwO2QkY7WMtz3mVcE1hkualJdmSolzX8GnpKd4VZq80d1o7zN0RdWxGaqItgbn3B/+vsasgh/UMNBOvzYMZDxtDKp289KGaVguFQvb1yQWWwuB97GaSXqUUnVaYbSUwrDCEBz/C2CM8EhNrP13fbkeSh3OJgCAe2N1CWXKsGOc6TOr5U4q8MwYhDtkTda02MyPN+nnGBQEH7A37NHYz5KOZVv08qyjbSseEzKauPnsMj98wc6Ibcj5UUv7M8QWZTE52jEwGOVaD8U1Dw1YNWX0qM8VKyb80L/TrOPYOzH4KBJQTrK8M7+7KZjuM63sHBt17FubGoibCuf+tarWFGUmuwWeT8/vCXo1tZOYeZcazCaez8MwEzzM+HqhqtiJI5twxL1jeGLYk7jmKMF1JOCbg6Qj5nAdRqX7q3BYm8VAmQvW1lfcMc58IT95uIA3q+gftrDHPXUXJWkVEHJme5Bp5UmHsvIZ/O3l8ECE/FWcsItX2hr0ae8O2Wjs+J43QTbOZzGYQ/7Wtxq6eXjRK3r0By4YJ6Ty8EiYSJqcm2eGeV4Pox/ANENJR49RiEdfqcLflUJrEBZqgxYHrBjn2ExFURqKdVETN9YirJxKxR2rbrYeQv5ISmB6IsiDGNfZGWPeMgkzr58xnPaJ5p6XDZPKz4T77wayJ7jGhhXLwanOHTWBgq5n5q6YUwNJ7l3kKcRl7OJ7fF56l1GzvHbSD8dghTPi0wIRfv6XafjJ3ssv0PnZQ7nZx/etwzO1zJ3lHR2OETTw8x0tOx1AN3De0D7YV+63oGthjaJQ5Ur7eVVZjcdGInUyuaT73ZWg3efV8fZs7cc2E777Qi5eunVbghvPPymrt/krKGfcLd8ybYjdxrK6333Z09rjHZkNuLYzz0uIc+xWCZzz8nbHbe4dsY1e/XUOY+nimvtUaSazv4jXhaQasSbmYmpuenGwHZ8TKggSEQm08rMD7ahBOoExcMqXQegjnZ+CEvaEa1ZQUQkt39dj0zDS7krq+ARmpdws/nlNqD9WFbWN7l5u3wr9MyrcXKUsqWy3jTOaoML4DdaQ83YIoT4VYpEXvYQZLmbX5SLohBrgOj186Kc/iKTUPUhq+Rrm5ekOl3TWv1Mr6hqwbY0VOQXwEo+Moq4Z47q5qsU489G944LyJOW4LOLZOKtT/iI6+nGe/0dhuEd4ltj2NmiuCU4hnk5fHIi7+RK4uTEu0e+s7rAiRcw1CYy3OejvcYz+eXeI9MYY9nu3lYZl0KavJJ7Vjibzgjp319rUZE20j7CkJqFr5JQYgQ39f3eQaKpQk0afy8nl4uBzvjUUTRk7k3iebOm0pabDiyFn2XGu3dRME41CGVeBVqSiVnc6hIUpekp1VjHLDSOEcQlui5W/U8C7IKREjv1Gabw3wRwUTvpv7jybPtzHmIPZ49q6KRjuccqBQVCOtGvqXhrCFUUXJzOYSHt7Kw5Ix9H08dSje1o1JyL73IYXpEMmE5CRbw6wuykx2pR+Pd6/J4JpLiJKV6N9OnrcQNfQ0Zem6qQX2MmFXyWTE+DMO0kGx4e08DEjnXbsYuOq7niHB8jdY/wQ8Srm2XCZZUrOakF1CY5EKX0h93Tu/1J4kRdbDMT8MamgZK9xe3uDcvrPe++Y4f61rcZr7B53rN1c5N2ytcV5rCrvHt3T2Og19g+5nH7dvq3bqunr4NOwgK2MHA1jeEDuG7HNuLmtw7qpocl5t6nCPvdTQ7v4N4u3WTqeyu9cZHIo4f6lqdFoHh7wzMbzDeeGv3Hvzjlrnh2W1zofhHuftxpFn3VFe7zxS0+p0DlKVPbhhvBxhvwiFMgfP+mjHA08gEC4pybeLyK1iZldh8zC5VJQyUl8l59KZ0WJk2xaiYWxNrkXXJhA8r3PvZRur7ZZZRfadaRPsfiTmX9HGajC2tXd6V8dQTMhX0h8rNdJx9Ra8F8SbRNLzhPRnJmTZIUTYueTyWxyr7uv3rjC3OkzE8495oS+4xq6D5WoI0bO5WVCOSerl8rIeBrOI/Hkaw6ME5W1zSuzx2la3CRdWi3zIG+FDBvUp9LMgI/vggUmE7KkT81yGvOOgEYa/aUahhRAF5xLec3OzbF1r2O17BbVxIi7hzJIC64IYhXdJA+nh/5xVbOmE9J0QqjSxWk0pp37M2YEtgjS8GpimACu7xkqxdKJ6fEXyYl2Lre0ZtC8yELVewtWUnbfCPIhrvgDFz8WI5yhJKgcnFMZWEFrwhgzo5uWDDDA1oGSOzcu0xfx7vTlsv6posIMpJ6cGWPiw/BxL4PU7vbrpjgf8bMdu5OYwOdhm83DARUSa0ELknYIeEAaILuWxlhGa0M8+EuJCrpJT+ymENhN60pXBxa3LZ5TsucnlGaCmIEQ4Evru91yuz0xMtKaeXluI5zdh9Mm8vAlBn4aR07X64EH3vEKdXQkZJXPP/JxMvNRpLxEtHZ5RQgmNewnpouvVTpYTHdfOnmy5kFUGnpRTfEhXD9DiBdFFJB0/YWS9aj6pmc89r0BaQmgTRkgI+EsdKsYasJZOBF+QqTH474NK7LbyBvf7W+RgOxNyxfQY2/2hrp2+NkroxrzrQ55fSZkpJIa28znCgF6rb7H1hOSslATyvNflAh9pvHcX3lVE/Ya8FjTJIexa2Rq77nfU96unTnD7aME3+TAm6BFKYrPnqCNIqV5sq0ZGCiEV+Db+qWMQqpFgb5KPx48R6omeDl2EuP9DTYt9iGA/f1KBS1w/La+H4ktsSmLItvZHXLUkrCeflVtJ9DVVg1H7+sxiGvVM975rZpfabuqHVhuP5F1vewav5O8GamUe91yDanoYw47FWzC929O+DJnKA2opFY1Rjru5CE7kOcO0jJtQVUIynzuZEMeb+1CEOFXN8iFSGeRpCm1BTlJxVg49Azm819SO7Bu0axEbwn27GuxMck+TMQHDP8fn48gfDVIL4R8xKVPJ73MQBUIfA/Z54LMw5vmlE+w+VFo2A78X/SsyPA/RMD0z3e2qVLtfo7aeBslpMX0N0TEnLcUlKym1jyBFqSohmYntI5enBhYB9CY/2kNarhwJhNiMtRGyWnkQdKaCFyQwgydjyNUw4VchKxXv2/DoKdC+lkQbCX1NlKCGvJiBJkSGbCus6jfo4yGBNySgr+u7e20BCsxdVAcFlJ/tHd32+cIsNxSXUULUUx+dg/d47g7OPYFw2MxkSuyMwLHVTI6PBN6dS8Sppw45zHJSgDXV3aQzmz40Z6fDgBfiAXU0uZxby2zejee+j3eltoQMzhV6qSBogXwrEXDj7ElWxUQ8RrnSaoU0dxIsKaiMvMykXTu90NqJsGHP4z78SdLigUrLKat32nFwy/E07pfDFRdQ/7N5r57pQ1482uvWhMGhQcviGkVrKDUp0ToCxfhQal5n4Hs/g1jOgH4LWdwFOd1b1WzHET4vLZppv+Czjxo840OrDlG8jAJzv2tp5mLK1dsU/lfIOeWy5NxFxfl2BoYImlQtx9QF6mJRQKBsQYYuO2yaLYPBUXvu/VqYPxtHhNy7Y4hCkNLGPtKSklzCVKSHtMQxcqm5Kw1DhI2PTGZtcGDAvoLQ/u7MifYtWFBlxz2H9zo8RkwKzC5UYiG+p44ccqE62YAxLeT/TOpf8MXx8Qk0IJFRY1Go+viQVJpE5Ehjf49xfAZeqGIy/7us3nqxwQfCkjZypPxobVr/6YpQHIalUvuCyEwbSXC9PC8QnkFcXlrgLpoLIhIfKuaqlQkYIAwQnr/f3eyu7KttOw2lNpv8/BPHyjzVNER3o72gvEBKqRMTflndbP8BMweRDyeciEj5bFayFXqTLzheivgYJC0jwzwHa0MDDEotm48ndze5BBBElAnxxcRYHAFh3FfZaA9UNRmC354kNwUx8eHkmVj5dcTE5ZMnuEyr1QqlhtaJLuOYZv4v3KNo0TKrGPUZ1NILPKuWcvVn5Trv10SMB6h0j/ARMnlOuafCBIfnSWEx/Raif3HDzofYMM31dOyY9LBaLK3TjoX2fEqT4+2qaUVWSTQvyM6wC8nNJyEetXIyuLKrx04P7MKNnbJZlKUtNAIHo7i2dA/YU3Vtdi5l6jCepXy8hOedSSSsI8/HQg5Q+gxTKXwkMHkbESo+hjG0lbRRzQ3Fc5LOzDuFhs3Ptumpie7ilRDhlEJOq/hjsZljCxjkt7fWuPS/EekpXMggJQIk0G+eN9Xu2VmHWIkJe0nJRN4ptBBit2yutG9ML7J1DHAxebiAMrZ4VZlduqGS8I2tJc2iborUxmIN79c+kTovFxivPvrcSaP3n7RSKYTUmKt4N3rMOcw4JOneD3sP956jNaMglIeTER5Xbdlt15Tm2W10NEsYrA/N5JLCHHsR9tSqwxq08G3bqm1ZTbOtagnbo6SLvH/VzBL7W7jPzqFea0LmMLFzUuLtdwumuO3i1Vtq7OK15Xgw3l1PDmIXak+6QBEkvB9YJIzBcc/L20JIYaSZ/qAzVm5Ut4oowk3QehC+N3xo/1wTqt7zsYawfX9no9XjqdPXVLhrwyo/wucJYQkE1e4j8rLcBuHUItQQKqgMXb6LGvxFQlXw33AdZLR0V5P9Fr29lP73scNnosoyvdWPv4fPJ+uJrLVtMakqaL1M1cTvv0OLIZE6wk2a2IcIRUQh+DaejpdcXepBa7bKDRGM9PIVxTl2EwarZ72rooVuY4RQtMypdk6e1lLLehhY2lt7QEd7WxlCDvdIli6E9B4+ZIodmZEMccUGqgiZOqru9tkR3iJ8nCcXRWRZCSPMLPEjlx2LjQL1OM5qKAm+vhSuRqSfV5Ttrg8FdWcrnhMqCTex7DEM6qTsVEuM1+8hovaHQ6e6a1Fz0xLd3nUt4ToWWuzWNkhcoAIIjUx2ZpxjLzWF9+SYmngR1lok4TEoJxGfuijhI/7OICoFmadl2llcL9b1oRVJtbD+JLlv1KrhHG5811t9ELbzgk14ICUwqE+TDzftqHPz98vUSy3jSIwP8dCpkNqLDPTx+rArz4T5qLG3G2PrvJKKPoLBWE501NC3ilUX5mVjVIb9nIbgWcpPMiSXjbcL8K62UkR86m1/yfkSeMaHFuK04X0CE3J6SWzFUxw0BSNHlSzi3RmIRJwHq5udO3c16quLp6sbnffbupxbt+12vzOrzuvNHc7ycRbIxuJHgYU7YSASdQgxp7qz2ynv6HJeqW91doa7nLruXof+17sqhhu31Xif9o7HalqczV29Dnrb/f5EXZvzdH27U98/6LR5i3N0UM5zjHU71/lwjRWWltU5CAIn7F1MqLp/r9hQ5RoaxG+qmrxP4yNKcfsFLwuiprffeb2l03m2scO5h3Or2rudzjGrhk8x4Cqu2xcexilBvNEcdi5Yu4tKF3Ue4tzPy+td5/1md4tzw5iJ27NuXEYobYUdlb8z6GTWkdxaCvk2zHjd5mpKQ459mv5TkAp6mQb9Aq9HHQ8S6mrZnuc6vUG6WHusIhCJGNXl9byvnJyaiE7+Eoz8c5TYNQiUveENGpJpcIJ+biS8R0+rlcazGNs7pKB+zPLTOSX2KNWhlDAf4r2Spj72JORB5OyHULX+dlD/FOky/HFy5ygYU0sey/i8moeqdunXK1qC3RuaMOYHlI/raQMl3M+EeTV5WxD3Km8a8PkM8nr648sQ9+esKbf5e/nxiKBfAOQkxbv3SU9LYmqPV9V/Pn+V20VwTyVjTqCI6edEQUOFUXs9WmfSll8DyX2dt7GlnwkswaM3l9XZ0oNK3MTXbxpOV2sGk69s6XCJw4cY8KbyRrt9TrHt7Bm0rRBQe1+fHUWNfaapU0KbqxzbORC1M/LS3dJwIl3KOrwykQG/E+61q+isgniztdOKqNOziDgZqZIzFwPvqGiyg5NCtoCqoG5NxHhPZTOsnORulKskjoKMDeLuXQ3OmnC3syxARFXdfc57LR3OrdtrvSOOs55rnqhtcdoGhpxHdjc5EfJUuHZTlftX+G15rXPlhkrnLe59F7Lz8VGHdg8c5y2OLeMZ126qduq9XC3v7nd+FchLvYPJd15gPCu8XQnh/qpm59WGVudZzvvQO97kXTcGxhnEuJvR39tWY8cwK4uhcikk4a3Gdstg9l5B2t0wfaTdWkEou5vCPOV5PH73vFL3+DfXltnh6OxjkJD6Wd5F3g88tMe6CW/7YmI99VIL4u0oqUK8ocW4d8hFrXMVoOQU8s3U97MnjvDD/XRYkyhHM1MT3GVZQR2Tdv70U8EbA5vlo+CaPAaaSWoZXm50otGodxQ6L6txGKxzw5ZYORrBsPPrykZKQIy1n8bTjwb2fO4Te3ue7x6KOKvaYns1wtIddd4nx3mwot55qyl2360cp81zurg+CGqwU8v4/Of5uAVvPgObrwvHomY8jOtZ4fXWLnefdHVXv9044+8ZklCx75DXwcV1Sb27y+vInUQEuVYSaMgRJYfAwtoj0raFxIUW1A8nz35f02qLc9Lc9lG7CBkwtUR7bf+A+5uL6ehnH9Lat+5sIEfj3Cbj3NKRvP7Rjlo7FSmqavKvpSP8MRZ7NVbQYLSkqlC9ZW4sPH18gBTcORjrhMWmQWzFmK2UsvO90qQ1oZcI8UhkCLZPtRqMy0NirobAvjIpb4/sW06qKGyPR2oGIdlazjOOTk+kLYzaaYGSp63Wz6HsXsQ51wd+LTAuZOy+8GBNq7tF+IOdDU4kENJthNID5YRafZtzZ3mDs9LbRgzixcZ2l1h83OKFbDmEd0/FiFp7DWHgp0AQGzq6nf8hPF+oa3EehOz0ziCWcm4NpBRMhX1hn571oR9wqVVSDVPtUi32sQ0vbu7scZdY9aOt2ZSEL9BEBIW+dv20AKDd9/ep09oimYqHpyImkKDuRllS4PrlHNuIqDmCJmNJQba7q1joEaUQJuR/WdXsLrJrq/L6cdJsPOyXscJ7GLKqo8cOpqhrO//yQG6oS3kZwS9xPkRB3wi7diFMtDN+PLk5m1ath+8f0Fy80dbjhvVXub+U5mEqeal27UP+dWpPlknNxW79Ak6/7Tg3UMOF52j1xA1qK7Trd6nXC+8P9ttYQcumIonLSnJtBdJNa77axw1C2x3qR4Wqnj73x9f6MbV+CCYFBZO6y51aSh3gzVrsmwzJnULEbCJC1oZ7vIZ/9Iqmfvn2u5oWO5n8fApxcuWUApum5diPgY9lrA9EtvUNOzYf8vqAcJPsU5iOh7XtXQgt2uZhjKU2amF7HQyfEYWcZk5yQ1RDKNrLcq02k/9IGmldrB93KiokPw8EB2SsoKWXO5FmxXhlckqi+3vEUvLqwok5PHVkIWAszlqzy1p54zuLpnPZ3q9bod08JlLSb5DrNxDm38Sbvsg5EBywsT7oH+3XNW3uasGirFSrxRNdCllKiPZHZzJYLZb5qEcpae3pxMCuu9oibS5/QCOiLcYUrp+MmtJeURjFdVlxzqiae6D4h40NQt54HyGv3JRo10aVfv8YhtC0pSlVKcPFuxIXahr08mzCO4VzMlLSsZuomZ+RaucU0rXsw/sfF5+osUFonWob/7TrLdaUgdpV93fl9X+VIC0Y6tek2uI8OD3J5gT2Vj9ZmP0f4IM4iY7RQ5gAAAAASUVORK5CYII=) no-repeat 50%;background-size:64px 64px;opacity:.84}.markdown-body h1:after{position:absolute;content:"";width:150%;left:-25%;height:50%;bottom:12px;border-radius:50%;background:linear-gradient(transparent 80%,rgba(77,208,225,.8));background-size:400% 200%;opacity:.6;animation:h1Animate 6s linear infinite}@keyframes h1Animate{0%{background-position:100% 100%}50%{background-position:100% 50%}to{background-position:100% 100%}}.markdown-body h2{display:block;border-bottom:4px solid #4dd0e1;position:relative;font-size:24px;padding:12px 32px;margin:30px 0}.markdown-body h2:before{width:24px;height:24px;left:0;top:0;margin:auto;background-size:24px 24px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADGklEQVRYR81X32vTYBQ999s6mFjQgQ+DrbHiVFZYU4cDcQ/6pGhTFVYFEXGi82H+Bz448UnEF1Fx9ccEEcXpZE3d5tP2ooKiTacTHaLNpigMHDgnU9tcSbrWrkwWR0sbyEOSe885ObnfvV8IRT6oyPwoLQHBx+OVM5WJvSyEVAhnBOjt7yU/+/rr6r6l8TMO+F/EN0JQhICqQpD/xaRpcpAc9tS+M+9lBCia/oqBamK+zeDuQogQZaKJk3wcQjxSva7tGQGB2Ke1zIk3DNyMyNL+QpCnMQOaPsDAVuGAp9cjvbYc8Ec/bCYSg0zoiHilk1tHxqsqEsYlML4kjIpT/eurJxRNPweQU5VdrWaOEo1fgKAVbBgXIz73kF3R/ph+ghgdzMYWM29eAWlBJqgZaFlFYtC6nhWpaDqnSGlIlV1WjJ3DloDNgyNLncudqgX//Ucg3LxuStHGuhi8pqKCW3rqV342rwFjRznKm+/LNaN2yC237ThgF2wxcfMLeP6+ncrKzoPoKTGeLQbYbg4TNoC5iZPJY5HGVRdSNZAWYBclD3FzBQzrR8hACAKdzBzKA/4/IYioDQaOskBbpEG6PO8qKKSAEi3CnEb0Pw4oMf0OmKbTDWqh3Lw6EIiNBZi5lxh3wz4puBD5ovqAMvxhHSdFKxE1CQe3m/07TeTX4lcJdAhE+1Sv65Z5P/ByvIGTRowIZ9igbtXnmrOsbTvgj+kHBNMuBu9OdVw8EeU4nC1A0cYmAHZOTRrLhra4Z8ywnSN6vZHAFTA2WnnMfQB3qz73ddsOZM8CACFDIPSgQXqebXEgqgeZcAeEe6pXasm1f8ew3igMtAHWac0Uc/jYdyAaP0xEBwFsmgUPqbJ0NE2UKj4EGcahiOzuyhagaHpnmtgcVgTcCMuua7YdyAHbA3ArQNscVFbb4635aD6fnYaTvxxi9UNP7ddMXaRWVBdAcaLk6bDXPZCNZ9uBXEsDUX1T2Cc9yjig6Z0EHg3LK8/aqf6MwJKchkXfks1+0+JtSq3qLPa23BRR1B+T/6nkfMaW1r9hPt/MLtYfTLEpP+T9FNoAAAAASUVORK5CYII=)}.markdown-body h2:after,.markdown-body h2:before{content:"";display:block;position:absolute;bottom:0}.markdown-body h2:after{right:0;width:400px;height:10px;border-top-right-radius:24px;background:linear-gradient(90deg,#fff,#4dd0e1);max-width:50vw}.markdown-body h3{margin:30px 0;font-size:18px;position:relative;padding:4px 32px;width:max-content}.markdown-body h3:before{border-bottom:2px solid #4dd0e1;width:100%;content:"";display:block;height:28px;position:absolute;left:0;top:0;bottom:-2px;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);background-repeat:no-repeat;animation:h3AnimationBefore 2s infinite alternate}@keyframes h3AnimationBefore{0%{width:28px}25%{width:100%}50%{width:100%}to{width:100%}}.markdown-body h3:after{content:"";display:block;width:28px;height:28px;position:absolute;border:2px solid #4dd0e1;border-radius:50%;right:-15px;top:0;bottom:0;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);animation:h3AnimationAfter 2s infinite alternate}@keyframes h3AnimationAfter{0%{transform:rotate(0)}10%{transform:rotate(0)}50%{transform:rotate(-1turn)}to{transform:rotate(-1turn)}}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin:22px 0;letter-spacing:2px;font-size:14px;word-spacing:2px}.markdown-body img{max-width:80%;border-radius:6px;display:block;margin:20px auto!important;object-fit:contain;box-shadow:0 0 16px hsla(0,0%,43.1%,.45)}.markdown-body figcaption{display:block;font-size:13px;color:#2b2b2b}.markdown-body figcaption:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEVHcExAuPtAuPpAuPtAuPpAuPtAvPxAuPokzOX5AAAAB3RSTlMAkDLqNegkoiUM7wAAAGBJREFUKM9jYBhcgMkBTUDVBE1BeDGqEtXychNUBeXlKEqACsrLQxB8lnCQQClCiWt5OYoSiAIkJVAF5eVBqAqAShTAAs7l5ShKWMwRAmAlSArASpAVgJUkCqIAscESHwCVVjMBK9JnbQAAAABJRU5ErkJggg==);display:inline-block;width:18px;height:18px;background-size:18px;background-repeat:no-repeat;background-position:50%;margin-right:5px;margin-bottom:-5px}.markdown-body hr{border:none;border-top:1px solid #4dd0e1;margin-top:32px;margin-bottom:32px}.markdown-body del{color:#4dd0e1}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(77,208,225,.08);color:#26c6da;padding:.195em .4em}.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#4dd0e1;border-bottom:1px solid #4dd0e1;font-weight:400;text-decoration:none;margin:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(77,208,225,.1)}.markdown-body strong{color:#26c6da}.markdown-body strong:before{content:"ã€Œ"}.markdown-body strong:after{content:"ã€"}.markdown-body em{font-style:normal;color:#4dd0e1;font-weight:700}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(77,208,225,.05)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{margin:2em 0;padding:24px 32px;border-left:4px solid #26c6da;background:rgba(77,208,225,.15);position:relative}.markdown-body blockquote:before{content:"â";top:8px;left:8px;color:#4dd0e1;font-size:30px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"â";font-size:30px;position:absolute;right:8px;bottom:0;color:#4dd0e1;opacity:.7}.markdown-body blockquote p{color:#595959;line-height:2}.markdown-body ol,.markdown-body ul{color:#595959;padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="vs2015">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#1e1e1e;color:#dcdcdc}.hljs-keyword,.hljs-link,.hljs-literal,.hljs-name,.hljs-symbol{color:#569cd6}.hljs-link{text-decoration:underline}.hljs-built_in,.hljs-type{color:#4ec9b0}.hljs-class,.hljs-number{color:#b8d7a3}.hljs-meta-string,.hljs-string{color:#d69d85}.hljs-regexp,.hljs-template-tag{color:#9a5334}.hljs-formula,.hljs-function,.hljs-params,.hljs-subst,.hljs-title{color:#dcdcdc}.hljs-comment,.hljs-quote{color:#57a64a;font-style:italic}.hljs-doctag{color:#608b4e}.hljs-meta,.hljs-meta-keyword,.hljs-tag{color:#9b9b9b}.hljs-template-variable,.hljs-variable{color:#bd63c5}.hljs-attr,.hljs-attribute,.hljs-builtin-name{color:#9cdcfe}.hljs-section{color:gold}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-bullet,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-id,.hljs-selector-pseudo,.hljs-selector-tag{color:#d7ba7d}.hljs-addition{background-color:#144212}.hljs-addition,.hljs-deletion{display:inline-block;width:100%}.hljs-deletion{background-color:#600}</style><h2 data-id="heading-0">è®© AI ç¼–ç¨‹ä¸å†"å¤±å¿†"ï¼šplanning-with-files æ’ä»¶å®Œå…¨æŒ‡å—</h2>
<blockquote>
<p><strong>GitHub æš´æ¶¨ 11.7k Starï¼</strong> å¤åˆ» Manus æ ¸å¿ƒç§˜è¯€çš„å¼€æºæ’ä»¶ï¼Œè®©ä½ çš„ AI ç¼–ç¨‹åŠ©æ‰‹æ‹¥æœ‰æŒä¹…åŒ–è®°å¿†èƒ½åŠ›</p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6c93e184786844caa9446179dbb7a595~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP56KX57uG6Z2i:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771304668&amp;x-signature=v8tWv7pBxGetULt%2BblcyAV0IvF8%3D" alt="planning-with-files" loading="lazy"/> <img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e86d38eee7c34d689f033661b86e23b0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP56KX57uG6Z2i:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771304668&amp;x-signature=5cDN3tukMI2i9kajT5W8kxvD29s%3D" alt="version" loading="lazy"/> <img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/11ee6e887be446e7967ffcd290abcc66~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP56KX57uG6Z2i:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771304668&amp;x-signature=vQpMO7T6if%2BmvlaMG8qwPFsM6Jg%3D" alt="stars" loading="lazy"/></p>
<hr/>
<h3 data-id="heading-1">å‰è¨€ï¼šAI ç¼–ç¨‹çš„"å¤±å¿†"å›°å¢ƒ</h3>
<p>ä½ æ˜¯å¦é‡åˆ°è¿‡è¿™æ ·çš„åœºæ™¯ï¼š</p>
<pre><code class="hljs language-vbnet" lang="vbnet">ä½ : <span class="hljs-string">"å¸®æˆ‘æ„å»ºä¸€ä¸ª Next.js åšå®¢ç³»ç»Ÿï¼Œæ”¯æŒ Markdown å’Œæš—é»‘æ¨¡å¼"</span>

<span class="hljs-symbol">AI:</span> <span class="hljs-string">"å¥½çš„ï¼è®©æˆ‘å¼€å§‹..."</span> [è¿›è¡Œ <span class="hljs-number">50</span>+ æ¬¡å·¥å…·è°ƒç”¨]

ä½ : <span class="hljs-string">"ç­‰ä¸€ä¸‹ï¼Œæˆ‘ä»¬çš„ç›®æ ‡æ˜¯æ”¯æŒ Markdown å—ï¼Ÿ"</span>

<span class="hljs-symbol">AI:</span> <span class="hljs-string">"å¯¹ä¸èµ·ï¼Œæˆ‘æœ‰ç‚¹è¿·å¤±äº†...ä½ èƒ½å†æé†’æˆ‘ä¸€ä¸‹è¦åšä»€ä¹ˆå—ï¼Ÿ"</span>
</code></pre>
<p>è¿™å°±æ˜¯ AI ç¼–ç¨‹åŠ©æ‰‹çš„æ ¸å¿ƒé—®é¢˜ï¼š</p>






























<table><thead><tr><th>é—®é¢˜</th><th>ç—‡çŠ¶</th><th>å½±å“</th></tr></thead><tbody><tr><td><strong>æ˜“å¤±è®°å¿†</strong></td><td>TodoWrite å·¥å…·åœ¨ä¸Šä¸‹æ–‡é‡ç½®åæ¶ˆå¤±</td><td>ä¸‹æ¬¡ä¼šè¯ä»å¤´å¼€å§‹</td></tr><tr><td><strong>ç›®æ ‡æ¼‚ç§»</strong></td><td>50+ æ¬¡å·¥å…·è°ƒç”¨åå¿˜è®°åŸå§‹ç›®æ ‡</td><td>åç¦»ç”¨æˆ·éœ€æ±‚</td></tr><tr><td><strong>éšè—é”™è¯¯</strong></td><td>å¤±è´¥æ²¡æœ‰è¢«è®°å½•ï¼Œåå¤è¸©å‘</td><td>æµªè´¹æ—¶é—´å’Œ tokens</td></tr><tr><td><strong>ä¸Šä¸‹æ–‡å †ç Œ</strong></td><td>æ‰€æœ‰ä¿¡æ¯å¡è¿›ä¸Šä¸‹æ–‡</td><td>è¾¾åˆ° token ä¸Šé™</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-2">è§£å†³æ–¹æ¡ˆï¼šManus AI çš„ 20 äº¿ç¾å…ƒç§˜å¯†</h3>
<p>2025 å¹´ 12 æœˆ 29 æ—¥ï¼Œ<strong>Meta ä»¥ 20 äº¿ç¾å…ƒæ”¶è´­äº† Manus AI</strong>ã€‚è¿™å®¶å…¬å¸åœ¨çŸ­çŸ­ 8 ä¸ªæœˆå†…ä»å¯åŠ¨åˆ° 1 äº¿ç¾å…ƒè¥æ”¶ï¼Œä»–ä»¬çš„ç§˜å¯†æ˜¯ä»€ä¹ˆï¼Ÿ</p>
<blockquote>
<p><em>"Markdown æ˜¯æˆ‘çš„'å·¥ä½œè®°å¿†'ç£ç›˜ã€‚ç”±äºæˆ‘è¿­ä»£å¼å¤„ç†ä¿¡æ¯ä¸”æ´»è·ƒä¸Šä¸‹æ–‡æœ‰é™ï¼ŒMarkdown æ–‡ä»¶ä½œä¸ºç¬”è®°çš„è‰ç¨¿çº¸ã€è¿›åº¦çš„æ£€æŸ¥ç‚¹ã€æœ€ç»ˆäº¤ä»˜ç‰©çš„æ„å»ºå—ã€‚"</em>
â€” Manus AI</p>
</blockquote>
<p><strong>æ ¸å¿ƒåŸç†ï¼š</strong></p>
<pre><code class="hljs language-arduino" lang="arduino">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ä¼ ç»Ÿæ¨¡å¼ vs <span class="hljs-number">3</span>-<span class="hljs-built_in">File</span> æ¨¡å¼                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  ä¼ ç»Ÿæ¨¡å¼:                        <span class="hljs-number">3</span>-<span class="hljs-built_in">File</span> æ¨¡å¼:               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ ä¸Šä¸‹æ–‡çª—å£  â”‚ â† å †æ»¡ â†’      â”‚ ä¸Šä¸‹æ–‡çª—å£  â”‚ â† åªæ”¾å½“å‰éœ€è¦â”‚
â”‚  â”‚  (RAM)      â”‚                 â”‚  (RAM)      â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚         â†“                              â†“                    â”‚
â”‚    âŒ æ˜“å¤± (<span class="hljs-keyword">volatile</span>)              âœ… æŒä¹… (persistent)      â”‚
â”‚    âŒ æœ‰é™ (limited)               âœ… æ— é™ (unlimited)       â”‚
â”‚                                                                 â”‚
â”‚                                   â†“                            â”‚
â”‚                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚                            â”‚ æ–‡ä»¶ç³»ç»Ÿ    â”‚                     â”‚
â”‚                            â”‚  (Disk)     â”‚                     â”‚
â”‚                            â”‚ task_plan   â”‚                     â”‚
â”‚                            â”‚ findings    â”‚                     â”‚
â”‚                            â”‚ progress    â”‚                     â”‚
â”‚                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<p><strong>æ ¸å¿ƒå…¬å¼ï¼š</strong></p>
<pre><code class="hljs language-ini" lang="ini">Context <span class="hljs-attr">Window</span> = RAM (æ˜“å¤±ã€æœ‰é™)
<span class="hljs-attr">Filesystem</span> = Disk (æŒä¹…ã€æ— é™)

â†’ ä»»ä½•é‡è¦ä¿¡æ¯éƒ½å†™å…¥ç£ç›˜
</code></pre>
<hr/>
<h3 data-id="heading-3">ä»€ä¹ˆæ˜¯ planning-with-filesï¼Ÿ</h3>
<p><strong>planning-with-files</strong> æ˜¯ä¸€ä¸ªå¼€æº Claude Code æ’ä»¶ï¼Œå®ç°äº† Manus AI çš„<strong>ä¸‰æ–‡ä»¶æŒä¹…åŒ–è§„åˆ’æ¨¡å¼</strong>ã€‚</p>
<h4 data-id="heading-4">æ ¸å¿ƒæœºåˆ¶ï¼š3-File æ¨¡å¼</h4>
<pre><code class="hljs language-scss" lang="scss">your-project/
â”œâ”€â”€ task_plan<span class="hljs-selector-class">.md</span>    â† é˜¶æ®µåˆ’åˆ† + è¿›åº¦è¿½è¸ª (checkbox)
â”œâ”€â”€ findings<span class="hljs-selector-class">.md</span>     â† ç ”ç©¶å‘ç° + æŠ€æœ¯å†³ç­– (çŸ¥è¯†åº“)
â””â”€â”€ progress<span class="hljs-selector-class">.md</span>     â† ä¼šè¯æ—¥å¿— + æµ‹è¯•ç»“æœ (æ—¶é—´çº¿)
</code></pre>
<h4 data-id="heading-5">ä¸‰å¤§æ–‡ä»¶è¯¦è§£</h4>





























<table><thead><tr><th>æ–‡ä»¶</th><th>ä½œç”¨</th><th>æ›´æ–°æ—¶æœº</th><th>ç¤ºä¾‹å†…å®¹</th></tr></thead><tbody><tr><td><strong>task_plan.md</strong></td><td>ä»»åŠ¡åˆ†è§£å’Œè¿›åº¦è¿½è¸ª</td><td>åˆ›å»ºæ—¶ + æ¯æ¬¡å†³ç­–å‰</td><td>Phase 1: åˆå§‹åŒ–<br/>- [x] åˆ›å»ºé¡¹ç›®<br/>- [ ] é…ç½® TS</td></tr><tr><td><strong>findings.md</strong></td><td>ç ”ç©¶å‘ç°å’ŒæŠ€æœ¯å†³ç­–</td><td>æ¯ä¸¤æ¬¡æŸ¥çœ‹æ“ä½œå</td><td>## æŠ€æœ¯é€‰å‹<br/>- é€‰æ‹© @mdx-js/loader<br/>- åŸå› ï¼šéœ€è¦è‡ªå®šä¹‰æ’ä»¶</td></tr><tr><td><strong>progress.md</strong></td><td>ä¼šè¯æ—¥å¿—å’Œæµ‹è¯•ç»“æœ</td><td>ä¼šè¯ç»“æŸæ—¶</td><td>### 2024-02-10<br/>- âœ… Phase 1 å®Œæˆ<br/>- âš ï¸ é‡åˆ° TS é…ç½®é—®é¢˜</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-6">å¿«é€Ÿä¸Šæ‰‹</h3>
<h4 data-id="heading-7">å®‰è£…ï¼ˆä¸‰ç§æ–¹å¼ï¼‰</h4>
<h5 data-id="heading-8">æ–¹å¼ä¸€ï¼šClaude Code æ’ä»¶å¸‚åœºï¼ˆæ¨èï¼‰</h5>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æ·»åŠ æ’ä»¶</span>
/plugin marketplace add OthmanAdi/planning-with-files

<span class="hljs-comment"># å®‰è£…</span>
/plugin install planning-with-files@planning-with-files

<span class="hljs-comment"># å®Œæˆï¼ç°åœ¨å¯ä»¥ä½¿ç”¨ï¼š</span>
/plan          <span class="hljs-comment"># å¼€å§‹è§„åˆ’</span>
/plan:status   <span class="hljs-comment"># æŸ¥çœ‹è¿›åº¦</span>
</code></pre>
<h5 data-id="heading-9">æ–¹å¼äºŒï¼šæ‰‹åŠ¨å®‰è£…åˆ°æœ¬åœ° skills</h5>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># macOS/Linux</span>
<span class="hljs-built_in">cp</span> -r ~/.claude/plugins/cache/planning-with-files/planning-with-files/*/skills/planning-with-files ~/.claude/skills/

<span class="hljs-comment"># Windows (PowerShell)</span>
Copy-Item -Recurse -Path <span class="hljs-string">"<span class="hljs-variable">$env</span>:USERPROFILE\.claude\plugins\cache\planning-with-files\planning-with-files\*\skills\planning-with-files"</span> -Destination <span class="hljs-string">"<span class="hljs-variable">$env</span>:USERPROFILE\.claude\skills\"
</span></code></pre>
<h5 data-id="heading-10">æ–¹å¼ä¸‰ï¼šå…¶ä»– IDE</h5>








































<table><thead><tr><th>IDE</th><th>æ”¯æŒçŠ¶æ€</th><th>å®‰è£…æ–¹å¼</th></tr></thead><tbody><tr><td><strong>Gemini CLI</strong></td><td>âœ… å®Œæ•´æ”¯æŒ</td><td>Agent Skills</td></tr><tr><td><strong>Cursor</strong></td><td>âœ… å®Œæ•´æ”¯æŒ</td><td>Skills + Hooks</td></tr><tr><td><strong>OpenClaw</strong></td><td>âœ… å®Œæ•´æ”¯æŒ</td><td>Workspace Skills</td></tr><tr><td><strong>Kiro</strong></td><td>âœ… å®Œæ•´æ”¯æŒ</td><td>Steering Files</td></tr><tr><td><strong>Continue</strong></td><td>âœ… å®Œæ•´æ”¯æŒ</td><td>Skills + Prompts</td></tr><tr><td><strong>Codex</strong></td><td>âœ… å®Œæ•´æ”¯æŒ</td><td>Personal Skill</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-11">ä½¿ç”¨æ–¹æ³•æ·±åº¦è§£æ</h3>
<h4 data-id="heading-12">1. ä¸‰ç§å¯åŠ¨å‘½ä»¤</h4>
<h5 data-id="heading-13">å‘½ä»¤ä¸€ï¼š<code>/plan</code> - å¼€å§‹æ–°è§„åˆ’ï¼ˆæ¨èï¼‰</h5>
<pre><code class="hljs language-bash" lang="bash">ä½ : /plan

Claude: å¤ªå¥½äº†ï¼è®©æˆ‘ä»¬å¼€å§‹è§„åˆ’ä¼šè¯ã€‚

è¯·æè¿°æ‚¨æƒ³è¦å®Œæˆçš„ä»»åŠ¡ï¼Œæˆ‘ä¼šå¸®æ‚¨ï¼š
1. åˆ›å»ºç»“æ„åŒ–çš„ä»»åŠ¡è®¡åˆ’
2. è·Ÿè¸ªç ”ç©¶å‘ç°å’Œä¸­é—´ç»“æœ
3. è®°å½•è¿›åº¦å’Œæµ‹è¯•ç»“æœ

æ‚¨çš„ä»»åŠ¡æ˜¯ä»€ä¹ˆï¼Ÿ

ä½ : æˆ‘æƒ³ç”¨ Next.js æ„å»ºä¸€ä¸ªåšå®¢ç³»ç»Ÿï¼Œéœ€è¦æ”¯æŒ Markdownã€æš—é»‘æ¨¡å¼å’Œè¯„è®ºåŠŸèƒ½

Claude: æ˜ç™½äº†ï¼æˆ‘å°†å¸®æ‚¨æ„å»º Next.js åšå®¢ç³»ç»Ÿã€‚

æ­£åœ¨åˆ›å»ºè§„åˆ’æ–‡ä»¶...

âœ… task_plan.md - ä»»åŠ¡åˆ†è§£å’Œè¿›åº¦è¿½è¸ª
âœ… findings.md - ç ”ç©¶å‘ç°å’ŒæŠ€æœ¯å†³ç­–
âœ… progress.md - ä¼šè¯æ—¥å¿—å’Œæµ‹è¯•ç»“æœ

ç°åœ¨è®©æˆ‘ä»¬ä» Phase 1 å¼€å§‹...
</code></pre>
<h5 data-id="heading-14">å‘½ä»¤äºŒï¼š<code>/plan:status</code> - æŸ¥çœ‹å½“å‰è¿›åº¦</h5>
<pre><code class="hljs language-bash" lang="bash">ä½ : /plan:status

Claude:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“‹ å½“å‰è§„åˆ’çŠ¶æ€                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ä»»åŠ¡: Next.js åšå®¢ç³»ç»Ÿ                 â”‚
â”‚  è¿›åº¦: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 40%             â”‚
â”‚                                         â”‚
â”‚  âœ… Phase 1: é¡¹ç›®åˆå§‹åŒ–                 â”‚
â”‚  âœ… Phase 2: åŸºç¡€é¡µé¢                   â”‚
â”‚  ğŸ”„ Phase 3: Markdown æ”¯æŒ (è¿›è¡Œä¸­)     â”‚
â”‚  â³ Phase 4: æš—é»‘æ¨¡å¼                   â”‚
â”‚  â³ Phase 5: è¯„è®ºç³»ç»Ÿ                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h5 data-id="heading-15">å‘½ä»¤ä¸‰ï¼š<code>/planning-with-files:start</code> - ä¼ ç»Ÿå¯åŠ¨</h5>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># å…¼å®¹æ—§ç‰ˆæœ¬çš„å¯åŠ¨æ–¹å¼</span>
/planning-with-files:start
<span class="hljs-comment"># æˆ–ç®€å†™</span>
/planning
</code></pre>
<hr/>
<h4 data-id="heading-16">2. é¦–æ¬¡ä½¿ç”¨å®Œæ•´æµç¨‹</h4>
<p><strong>Step 1: å‘½ä»¤è§¦å‘</strong></p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">ä½ : /plan</span>

<span class="hljs-section">Claude: è®©æˆ‘ä»¬è®¾ç½®æ‚¨çš„è§„åˆ’ä¼šè¯ï¼</span>
è¯·æè¿°æ‚¨æƒ³è¦å®Œæˆçš„ä»»åŠ¡...
</code></pre>
<p><strong>Step 2: AI åˆ†æå¹¶åˆ›å»ºæ–‡ä»¶</strong></p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">Claude: æ­£åœ¨åˆ›å»ºè§„åˆ’æ–‡ä»¶...</span>

âœ… task_plan.md - ä»»åŠ¡åˆ†è§£å’Œè¿›åº¦è¿½è¸ª
âœ… findings.md - ç ”ç©¶å‘ç°å’ŒæŠ€æœ¯å†³ç­–
âœ… progress.md - ä¼šè¯æ—¥å¿—å’Œæµ‹è¯•ç»“æœ
</code></pre>
<p><strong>Step 3: æ–‡ä»¶ç»“æ„é¢„è§ˆ</strong></p>
<pre><code class="hljs language-ini" lang="ini">your-project/
â”œâ”€â”€ task_plan.md
â”‚   â”œâ”€â”€ Phase 1: é¡¹ç›®åˆå§‹åŒ–
â”‚   â”‚   â”œâ”€â”€ <span class="hljs-section">[ ]</span> åˆ›å»º Next.js é¡¹ç›®
â”‚   â”‚   â”œâ”€â”€ <span class="hljs-section">[ ]</span> é…ç½® TypeScript
â”‚   â”‚   â””â”€â”€ <span class="hljs-section">[ ]</span> è®¾ç½® ESLint/Prettier
â”‚   â”œâ”€â”€ Phase 2: åŸºç¡€é¡µé¢
â”‚   â”œâ”€â”€ Phase 3: Markdown æ”¯æŒ
â”‚   â””â”€â”€ ...
â”œâ”€â”€ findings.md
â”‚   â””â”€â”€ <span class="hljs-comment">## æŠ€æœ¯é€‰å‹</span>
â”‚       - ä½¿ç”¨ next-mdx-renderer
â”‚       - ä½¿ç”¨ rehype æ’ä»¶
â””â”€â”€ progress.md
    â””â”€â”€ <span class="hljs-comment">### 2024-02-10 14:30</span>
        - âœ… åˆ›å»ºé¡¹ç›®éª¨æ¶
        - ğŸ”„ é…ç½® TypeScript ä¸­...
</code></pre>
<hr/>
<h4 data-id="heading-17">3. Hooks è‡ªåŠ¨åŒ–å·¥ä½œæµï¼ˆæ ¸å¿ƒæœºåˆ¶ï¼‰</h4>
<p>planning-with-files çš„é­”åŠ›æ¥è‡ªä¸‰ä¸ªè‡ªåŠ¨è§¦å‘çš„ Hooksï¼š</p>
<h5 data-id="heading-18">PreToolUse Hook - å†³ç­–å‰é‡è¯»è®¡åˆ’</h5>
<pre><code class="hljs language-arduino" lang="arduino">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     PreToolUse Hook                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  ç”¨æˆ·æ“ä½œ â†’ Hook è§¦å‘ â†’ è¯»å– task_plan.md â†’ AI äº†è§£è¿›åº¦ â†’ æ‰§è¡Œ â”‚
â”‚                                                              â”‚
â”‚  ç¤ºä¾‹åœºæ™¯:                                                   â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  ç”¨æˆ·: <span class="hljs-string">"æ·»åŠ è¯„è®ºåŠŸèƒ½"</span>                                         â”‚
â”‚                                                               â”‚
â”‚  Hook: ğŸ“‹ è¯»å– task_plan.md...                                â”‚
â”‚        Phase <span class="hljs-number">3</span> è¿˜åœ¨è¿›è¡Œä¸­ï¼ŒPhase <span class="hljs-number">5</span> æ˜¯è¯„è®ºåŠŸèƒ½                 â”‚
â”‚        å»ºè®®å…ˆå®Œæˆ Phase <span class="hljs-number">3</span>                                     â”‚
â”‚                                                               â”‚
â”‚  AI: <span class="hljs-string">"æˆ‘æ³¨æ„åˆ° Phase 3 (Markdown æ”¯æŒ) è¿˜æœªå®Œæˆã€‚            â”‚
â”‚       å»ºè®®å…ˆå®Œæˆ Markdown æ¸²æŸ“ï¼Œå†æ·»åŠ è¯„è®ºåŠŸèƒ½ã€‚              â”‚
â”‚       è¦ç»§ç»­ Phase 3 è¿˜æ˜¯ç›´æ¥è·³åˆ° Phase 5ï¼Ÿ"</span>                  â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h5 data-id="heading-19">PostToolUse Hook - æ“ä½œåæé†’ä¿å­˜</h5>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="hljs-string">â”‚</span>                    <span class="hljs-string">PostToolUse</span> <span class="hljs-string">Hook</span>                         <span class="hljs-string">â”‚</span>
<span class="hljs-string">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="hljs-string">â”‚</span>                                                              <span class="hljs-string">â”‚</span>
<span class="hljs-string">â”‚</span>  <span class="hljs-string">AI</span> <span class="hljs-string">æ“ä½œå®Œæˆ</span> <span class="hljs-string">â†’</span> <span class="hljs-string">Hook</span> <span class="hljs-string">æ£€æŸ¥è®¡æ•°</span> <span class="hljs-string">â†’</span> <span class="hljs-string">æé†’ä¿å­˜</span> <span class="hljs-string">findings</span>             <span class="hljs-string">â”‚</span>
<span class="hljs-string">â”‚</span>                                                              <span class="hljs-string">â”‚</span>
<span class="hljs-string">â”‚</span>  <span class="hljs-string">ç¤ºä¾‹åœºæ™¯:</span>                                                   <span class="hljs-string">â”‚</span>
<span class="hljs-string">â”‚</span>  <span class="hljs-string">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>  <span class="hljs-string">â”‚</span>
<span class="hljs-string">â”‚</span>  <span class="hljs-attr">AI:</span> [<span class="hljs-string">è¯»å–äº†</span> <span class="hljs-number">2</span> <span class="hljs-string">ä¸ªæ–‡ä»¶</span>]                                       <span class="hljs-string">â”‚</span>
<span class="hljs-string">â”‚</span>                                                               <span class="hljs-string">â”‚</span>
<span class="hljs-string">â”‚</span>  <span class="hljs-attr">Hook:</span> <span class="hljs-string">ğŸ“</span> <span class="hljs-string">æ£€æµ‹åˆ°è¿ç»­</span> <span class="hljs-number">2</span> <span class="hljs-string">æ¬¡æŸ¥çœ‹æ“ä½œ</span>                             <span class="hljs-string">â”‚</span>
<span class="hljs-string">â”‚</span>        <span class="hljs-string">å»ºè®®å°†å‘ç°ä¿å­˜åˆ°</span> <span class="hljs-string">findings.md</span>                          <span class="hljs-string">â”‚</span>
<span class="hljs-string">â”‚</span>                                                               <span class="hljs-string">â”‚</span>
<span class="hljs-string">â”‚</span>  <span class="hljs-attr">AI:</span> <span class="hljs-string">"æˆ‘æŸ¥çœ‹äº†ä¸¤ä¸ªæ–‡æ¡£é…ç½®æ–‡ä»¶ã€‚                              â”‚
â”‚       æˆ‘å‘ç° next.config.js éœ€è¦ experimental ç‰¹æ€§ã€‚         â”‚
â”‚       è®©æˆ‘å°†è¿™ä¸ªå‘ç°è®°å½•åˆ° findings.md..."</span>                    <span class="hljs-string">â”‚</span>
<span class="hljs-string">â”‚</span>                                                              <span class="hljs-string">â”‚</span>
<span class="hljs-string">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</code></pre>
<h5 data-id="heading-20">Stop Hook - å®Œæˆå‰éªŒè¯</h5>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="hljs-string">â”‚</span>                       <span class="hljs-string">Stop</span> <span class="hljs-string">Hook</span>                             <span class="hljs-string">â”‚</span>
<span class="hljs-string">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="hljs-string">â”‚</span>                                                              <span class="hljs-string">â”‚</span>
<span class="hljs-string">â”‚</span>  <span class="hljs-string">ç”¨æˆ·é€€å‡º</span> <span class="hljs-string">â†’</span> <span class="hljs-string">Hook</span> <span class="hljs-string">è§¦å‘</span> <span class="hljs-string">â†’</span> <span class="hljs-string">æ£€æŸ¥æ‰€æœ‰</span> <span class="hljs-string">Phase</span> <span class="hljs-string">â†’</span> <span class="hljs-string">ç”ŸæˆæŠ¥å‘Š</span>            <span class="hljs-string">â”‚</span>
<span class="hljs-string">â”‚</span>                                                              <span class="hljs-string">â”‚</span>
<span class="hljs-string">â”‚</span>  <span class="hljs-string">ç¤ºä¾‹è¾“å‡º:</span>                                                   <span class="hljs-string">â”‚</span>
<span class="hljs-string">â”‚</span>  <span class="hljs-string">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>  <span class="hljs-string">â”‚</span>
<span class="hljs-string">â”‚</span>  <span class="hljs-string">ğŸ“Š</span> <span class="hljs-string">ä¼šè¯å®ŒæˆæŠ¥å‘Š</span>                                             <span class="hljs-string">â”‚</span>
<span class="hljs-string">â”‚</span>  <span class="hljs-string">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span>                              <span class="hljs-string">â”‚</span>
<span class="hljs-string">â”‚</span>                                                               <span class="hljs-string">â”‚</span>
<span class="hljs-string">â”‚</span>  <span class="hljs-string">ä»»åŠ¡å®Œæˆåº¦:</span> <span class="hljs-number">60</span><span class="hljs-string">%</span>                                             <span class="hljs-string">â”‚</span>
<span class="hljs-string">â”‚</span>                                                               <span class="hljs-string">â”‚</span>
<span class="hljs-string">â”‚</span>  <span class="hljs-string">âœ…</span> <span class="hljs-string">å·²å®Œæˆ:</span>                                                  <span class="hljs-string">â”‚</span>
<span class="hljs-string">â”‚</span>     <span class="hljs-bullet">-</span> <span class="hljs-attr">Phase 1:</span> <span class="hljs-string">é¡¹ç›®åˆå§‹åŒ–</span> <span class="hljs-string">(3/3)</span>                              <span class="hljs-string">â”‚</span>
<span class="hljs-string">â”‚</span>     <span class="hljs-bullet">-</span> <span class="hljs-attr">Phase 2:</span> <span class="hljs-string">åŸºç¡€é¡µé¢</span> <span class="hljs-string">(2/2)</span>                                <span class="hljs-string">â”‚</span>
<span class="hljs-string">â”‚</span>                                                               <span class="hljs-string">â”‚</span>
<span class="hljs-string">â”‚</span>  <span class="hljs-string">ğŸ”„</span> <span class="hljs-string">è¿›è¡Œä¸­:</span>                                                  <span class="hljs-string">â”‚</span>
<span class="hljs-string">â”‚</span>     <span class="hljs-bullet">-</span> <span class="hljs-attr">Phase 3:</span> <span class="hljs-string">Markdown</span> <span class="hljs-string">æ”¯æŒ</span> <span class="hljs-string">(2/4)</span>                           <span class="hljs-string">â”‚</span>
<span class="hljs-string">â”‚</span>       <span class="hljs-string">âœ“</span> <span class="hljs-string">å·²å®‰è£…</span> <span class="hljs-string">next-mdx-renderer</span>                             <span class="hljs-string">â”‚</span>
<span class="hljs-string">â”‚</span>       <span class="hljs-string">âœ“</span> <span class="hljs-string">å·²é…ç½®</span> <span class="hljs-string">rehype</span> <span class="hljs-string">æ’ä»¶</span>                                   <span class="hljs-string">â”‚</span>
<span class="hljs-string">â”‚</span>       <span class="hljs-string">âœ—</span> <span class="hljs-string">å¾…å¤„ç†:</span> <span class="hljs-string">ä»£ç é«˜äº®</span>                                     <span class="hljs-string">â”‚</span>
<span class="hljs-string">â”‚</span>       <span class="hljs-string">âœ—</span> <span class="hljs-string">å¾…å¤„ç†:</span> <span class="hljs-string">å›¾ç‰‡ä¼˜åŒ–</span>                                     <span class="hljs-string">â”‚</span>
<span class="hljs-string">â”‚</span>                                                               <span class="hljs-string">â”‚</span>
<span class="hljs-string">â”‚</span>  <span class="hljs-string">â³</span> <span class="hljs-string">æœªå¼€å§‹:</span>                                                  <span class="hljs-string">â”‚</span>
<span class="hljs-string">â”‚</span>     <span class="hljs-bullet">-</span> <span class="hljs-attr">Phase 4:</span> <span class="hljs-string">æš—é»‘æ¨¡å¼</span>                                      <span class="hljs-string">â”‚</span>
<span class="hljs-string">â”‚</span>     <span class="hljs-bullet">-</span> <span class="hljs-attr">Phase 5:</span> <span class="hljs-string">è¯„è®ºç³»ç»Ÿ</span>                                      <span class="hljs-string">â”‚</span>
<span class="hljs-string">â”‚</span>                                                               <span class="hljs-string">â”‚</span>
<span class="hljs-string">â”‚</span>  <span class="hljs-string">ä¸‹æ¬¡ç»§ç»­æ—¶ä½¿ç”¨:</span> <span class="hljs-string">/plan:status</span>                                <span class="hljs-string">â”‚</span>
<span class="hljs-string">â”‚</span>                                                              <span class="hljs-string">â”‚</span>
<span class="hljs-string">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</code></pre>
<hr/>
<h3 data-id="heading-21">æœ€ä½³å®è·µæ·±åº¦æŒ‡å—</h3>
<h4 data-id="heading-22">å®è·µ 1: ä»»åŠ¡æ‹†åˆ†çš„è‰ºæœ¯</h4>
<p><strong>âŒ é”™è¯¯æ‹†åˆ† - å¤ªç²—ç³™</strong></p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section">## Phase 1: å¼€å‘åšå®¢</span>
<span class="hljs-bullet">-</span> [ ] å®Œæˆæ‰€æœ‰åŠŸèƒ½
</code></pre>
<p><strong>âœ… æ­£ç¡®æ‹†åˆ† - ç²’åº¦é€‚ä¸­</strong></p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section">## Phase 1: é¡¹ç›®åˆå§‹åŒ–</span>
<span class="hljs-bullet">-</span> [ ] åˆ›å»º Next.js é¡¹ç›® (ä½¿ç”¨ <span class="hljs-code">`npx create-next-app@latest`</span>)
<span class="hljs-bullet">-</span> [ ] é…ç½® TypeScript (å¯ç”¨ä¸¥æ ¼æ¨¡å¼)
<span class="hljs-bullet">-</span> [ ] è®¾ç½® ESLint å’Œ Prettier
<span class="hljs-bullet">-</span> [ ] é…ç½® Git (.gitignore, husky)

<span class="hljs-section">## Phase 2: æ ¸å¿ƒå¸ƒå±€</span>
<span class="hljs-bullet">-</span> [ ] åˆ›å»º Layout ç»„ä»¶
<span class="hljs-bullet">-</span> [ ] å®ç°å“åº”å¼å¯¼èˆªæ 
<span class="hljs-bullet">-</span> [ ] æ·»åŠ æš—é»‘æ¨¡å¼åˆ‡æ¢
<span class="hljs-bullet">-</span> [ ] é…ç½®å…¨å±€æ ·å¼

<span class="hljs-section">## Phase 3: Markdown ç³»ç»Ÿ</span>
<span class="hljs-bullet">-</span> [ ] é€‰æ‹© MDX å¤„ç†å™¨
<span class="hljs-bullet">-</span> [ ] å®ç°ä»£ç é«˜äº®
<span class="hljs-bullet">-</span> [ ] æ·»åŠ å›¾ç‰‡ä¼˜åŒ–
<span class="hljs-bullet">-</span> [ ] é…ç½® frontmatter è§£æ
</code></pre>
<p><strong>æ‹†åˆ†åŸåˆ™:</strong></p>
<ul>
<li>æ¯ä¸ª Phase 2-6 ä¸ªä»»åŠ¡</li>
<li>æ¯ä¸ªä»»åŠ¡ 30 åˆ†é’Ÿ - 2 å°æ—¶å¯å®Œæˆ</li>
<li>æŒ‰é€»è¾‘ä¾èµ–é¡ºåºæ’åˆ—</li>
<li>ä½¿ç”¨åŠ¨è¯å¼€å¤´ï¼ˆåˆ›å»ºã€é…ç½®ã€å®ç°ï¼‰</li>
</ul>
<hr/>
<h4 data-id="heading-23">å®è·µ 2: Findings çš„é»„é‡‘ç»“æ„</h4>
<p><strong>æ ‡å‡† findings.md æ¨¡æ¿:</strong></p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section"># Research Findings</span>

<span class="hljs-section">## æŠ€æœ¯é€‰å‹</span>
<span class="hljs-section">### MDX å¤„ç†å™¨å¯¹æ¯”</span>
| æ–¹æ¡ˆ | ä¼˜ç‚¹ | ç¼ºç‚¹ | ç»“è®º |
|------|------|------|------|
| next-mdx | å®˜æ–¹æ”¯æŒ | åŠŸèƒ½æœ‰é™ | âŒ ä¸å¤Ÿçµæ´» |
| next-mdx-enhanced | åŠŸèƒ½ä¸°å¯Œ | ç»´æŠ¤è¾ƒå°‘ | âš ï¸ å¤‡é€‰ |
| @mdx-js/loader | ç”Ÿæ€æˆç†Ÿ | é…ç½®å¤æ‚ | âœ… é€‰æ‹©æ­¤æ–¹æ¡ˆ |

<span class="hljs-strong">**å†³ç­–åŸå› :**</span> éœ€è¦è‡ªå®šä¹‰ rehype/recaka æ’ä»¶

<span class="hljs-section">## å…³é”®å‘ç°</span>
<span class="hljs-section">### Next.js 15 Breaking Changes</span>
<span class="hljs-bullet">-</span> <span class="hljs-code">`next/image`</span> ç°åœ¨éœ€è¦é…ç½® domains
<span class="hljs-bullet">-</span> <span class="hljs-code">`getStaticPaths`</span> æ”¹åä¸º <span class="hljs-code">`generateStaticParams`</span>
<span class="hljs-bullet">-</span> <span class="hljs-code">`next/link`</span> ä¸å†éœ€è¦ <span class="hljs-code">`&lt;a&gt;`</span> åŒ…è£¹

<span class="hljs-section">### æ€§èƒ½ä¼˜åŒ–ç‚¹</span>
<span class="hljs-bullet">-</span> ä½¿ç”¨ <span class="hljs-code">`dynamic`</span> import å‡å°‘åˆå§‹ bundle
<span class="hljs-bullet">-</span> å›¾ç‰‡ä½¿ç”¨ <span class="hljs-code">`next/image`</span> è‡ªåŠ¨ä¼˜åŒ–
<span class="hljs-bullet">-</span> å¯ç”¨ ISR å¢é‡é™æ€å†ç”Ÿ

<span class="hljs-section">## é‡åˆ°çš„é—®é¢˜</span>
<span class="hljs-section">### é—®é¢˜ 1: MDX ä»£ç é«˜äº®ä¸å·¥ä½œ</span>
<span class="hljs-strong">**é”™è¯¯:**</span> SyntaxHighlighter æ— æ³•è§£æ TSX
<span class="hljs-strong">**åŸå› :**</span> rehype-highlight ä¸ shiki å†²çª
<span class="hljs-strong">**è§£å†³:**</span> ç§»é™¤ rehype-highlightï¼Œåªä½¿ç”¨ shiki
<span class="hljs-strong">**å‘½ä»¤:**</span> <span class="hljs-code">`npm uninstall rehype-highlight`</span>

<span class="hljs-section">## å¾…ç ”ç©¶äº‹é¡¹</span>
<span class="hljs-bullet">-</span> [ ] è¯„è®ºç³»ç»Ÿé›†æˆ (Giscus vs Utterances)
<span class="hljs-bullet">-</span> [ ] RSS è®¢é˜…ç”Ÿæˆæ–¹æ¡ˆ
<span class="hljs-bullet">-</span> [ ] æœç´¢åŠŸèƒ½å®ç°
</code></pre>
<p><strong>Findings ä¹¦å†™åŸåˆ™:</strong></p>
<ul>
<li>âœ… ä½¿ç”¨è¡¨æ ¼å¯¹æ¯”ï¼Œä¸€ç›®äº†ç„¶</li>
<li>âœ… è®°å½•å¤±è´¥åŸå› å’Œè§£å†³æ–¹æ¡ˆ</li>
<li>âœ… æ ‡æ³¨å†³ç­–åŸå› </li>
<li>âœ… ä¿ç•™å¾…åŠäº‹é¡¹</li>
</ul>
<hr/>
<h4 data-id="heading-24">å®è·µ 3: è¿›åº¦è®°å½•çš„æœ€ä½³èŠ‚å¥</h4>
<p><strong>ä»€ä¹ˆæ—¶å€™æ›´æ–° progress.md?</strong></p>



































<table><thead><tr><th>è§¦å‘æ¡ä»¶</th><th>åŠ¨ä½œ</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td>å®Œæˆ Phase ä»»åŠ¡</td><td>æ‰“å‹¾å¹¶è®°å½•</td><td><code>âœ… å®Œæˆé¦–é¡µå¸ƒå±€ï¼Œè€—æ—¶ 45 åˆ†é’Ÿ</code></td></tr><tr><td>é‡åˆ°é˜»å¡é—®é¢˜</td><td>è¯¦ç»†è®°å½•é—®é¢˜</td><td><code>âš ï¸ ESLint é…ç½®ä¸ Prettier å†²çªï¼Œéœ€è¦è§£å†³</code></td></tr><tr><td>äº§ç”Ÿæ–°æƒ³æ³•</td><td>è®°å½•åˆ° findings</td><td><code>ğŸ’¡ è€ƒè™‘ä½¿ç”¨ contentlayer æ›¿ä»£ MDX</code></td></tr><tr><td>å‘ç° Bug</td><td>è®°å½•å¤ç°æ­¥éª¤</td><td><code>ğŸ› æš—é»‘æ¨¡å¼åˆ‡æ¢æ—¶é¡µé¢é—ªçƒ</code></td></tr><tr><td>æµ‹è¯•é€šè¿‡</td><td>è®°å½•æµ‹è¯•è¦†ç›–</td><td><code>âœ… å•å…ƒæµ‹è¯•è¦†ç›–ç‡è¾¾åˆ° 80%</code></td></tr></tbody></table>
<p><strong>è¿›åº¦è®°å½•æ¨¡æ¿:</strong></p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section">### 2024-02-10 14:30 - Session 1</span>
<span class="hljs-strong">**ç›®æ ‡:**</span> å®Œæˆé¡¹ç›®åˆå§‹åŒ–

<span class="hljs-strong">**å®Œæˆäº‹é¡¹:**</span>
<span class="hljs-bullet">-</span> âœ… åˆ›å»º Next.js é¡¹ç›® (TypeScript æ¨¡æ¿)
<span class="hljs-bullet">-</span> âœ… é…ç½® Tailwind CSS
<span class="hljs-bullet">-</span> âœ… è®¾ç½® Git ä»“åº“

<span class="hljs-strong">**é‡åˆ°çš„é—®é¢˜:**</span>
<span class="hljs-bullet">-</span> âš ï¸ TypeScript ä¸¥æ ¼æ¨¡å¼ä¸‹ props ç±»å‹æŠ¥é”™
<span class="hljs-bullet">  -</span> è§£å†³: æ·»åŠ  <span class="hljs-code">`interface Props`</span> å®šä¹‰

<span class="hljs-strong">**æ—¶é—´æ¶ˆè€—:**</span> 1.5 å°æ—¶

<span class="hljs-strong">**ä¸‹æ¬¡ç»§ç»­:**</span> Phase 2 - æ ¸å¿ƒå¸ƒå±€å¼€å‘
</code></pre>
<hr/>
<h4 data-id="heading-25">å®è·µ 4: ä¼šè¯æ¢å¤çš„æ­£ç¡®å§¿åŠ¿</h4>
<p><strong>åœºæ™¯ï¼šä¸Šä¸‹æ–‡æ»¡äº†ï¼Œæ‰§è¡Œ <code>/clear</code></strong></p>
<p><strong>è‡ªåŠ¨æ¢å¤æµç¨‹:</strong></p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">Claude:</span> <span class="hljs-string">æ£€æµ‹åˆ°ä¹‹å‰çš„è§„åˆ’ä¼šè¯ï¼</span>

<span class="hljs-string">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span>
<span class="hljs-string">ğŸ“‹</span> <span class="hljs-string">ä¼šè¯æ¢å¤æŠ¥å‘Š</span>
<span class="hljs-string">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span>

<span class="hljs-string">ä¸Šæ¬¡æ´»åŠ¨:</span> <span class="hljs-number">2024-02-10 </span><span class="hljs-number">16</span><span class="hljs-string">:45</span> <span class="hljs-string">(2å°æ—¶å‰)</span>

<span class="hljs-string">ä»»åŠ¡è¿›åº¦:</span> <span class="hljs-string">â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘</span> <span class="hljs-number">40</span><span class="hljs-string">%</span>

<span class="hljs-string">âœ…</span> <span class="hljs-string">å·²å®Œæˆé˜¶æ®µ:</span>
   <span class="hljs-string">â€¢</span> <span class="hljs-attr">Phase 1:</span> <span class="hljs-string">é¡¹ç›®åˆå§‹åŒ–</span> <span class="hljs-string">(4/4)</span>
   <span class="hljs-string">â€¢</span> <span class="hljs-attr">Phase 2:</span> <span class="hljs-string">æ ¸å¿ƒå¸ƒå±€</span> <span class="hljs-string">(3/3)</span>

<span class="hljs-string">ğŸ”„</span> <span class="hljs-string">è¿›è¡Œä¸­é˜¶æ®µ:</span>
   <span class="hljs-string">â€¢</span> <span class="hljs-attr">Phase 3:</span> <span class="hljs-string">Markdown</span> <span class="hljs-string">æ”¯æŒ</span> <span class="hljs-string">(2/4)</span>
     <span class="hljs-string">âœ“</span> <span class="hljs-string">MDX</span> <span class="hljs-string">å¤„ç†å™¨é…ç½®</span>
     <span class="hljs-string">âœ“</span> <span class="hljs-string">ä»£ç é«˜äº®è®¾ç½®</span>
     <span class="hljs-string">âœ—</span> <span class="hljs-string">å›¾ç‰‡ä¼˜åŒ–</span> <span class="hljs-string">(å¾…å¤„ç†)</span>
     <span class="hljs-string">âœ—</span> <span class="hljs-string">Frontmatter</span> <span class="hljs-string">è§£æ</span> <span class="hljs-string">(å¾…å¤„ç†)</span>

<span class="hljs-string">ğŸ’¡</span> <span class="hljs-string">æœ€è¿‘å‘ç°:</span>
   <span class="hljs-string">â€¢</span> <span class="hljs-string">next-mdx-enhanced</span> <span class="hljs-string">å·²åœæ­¢ç»´æŠ¤</span>
   <span class="hljs-string">â€¢</span> <span class="hljs-string">è€ƒè™‘è¿ç§»åˆ°</span> <span class="hljs-string">@mdx-js/loader</span>

<span class="hljs-string">ğŸš§</span> <span class="hljs-string">æœªè§£å†³é—®é¢˜:</span>
   <span class="hljs-string">â€¢</span> <span class="hljs-string">rehype</span> <span class="hljs-string">æ’ä»¶ä¸</span> <span class="hljs-string">Next.js</span> <span class="hljs-string">å†²çª</span>

<span class="hljs-string">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span>

<span class="hljs-string">æ˜¯å¦ç»§ç»­</span> <span class="hljs-string">Phase</span> <span class="hljs-number">3</span> <span class="hljs-string">çš„å·¥ä½œï¼Ÿ</span>
</code></pre>
<p><strong>æ¢å¤åçš„æ™ºèƒ½å»ºè®®:</strong></p>
<pre><code class="hljs language-markdown" lang="markdown">Claude: æ ¹æ®è¿›åº¦è®°å½•ï¼Œæˆ‘å»ºè®®ï¼š

<span class="hljs-bullet">1.</span> ä¼˜å…ˆå¤„ç† rehype æ’ä»¶å†²çª
<span class="hljs-bullet">2.</span> ç„¶åå®Œæˆå›¾ç‰‡ä¼˜åŒ–
<span class="hljs-bullet">3.</span> æœ€åå®ç° frontmatter è§£æ

è¦ç»§ç»­å—ï¼Ÿè¿˜æ˜¯æƒ³å…ˆçœ‹çœ‹ findings.md äº†è§£ä¹‹å‰çš„å‘ç°ï¼Ÿ
</code></pre>
<hr/>
<h4 data-id="heading-26">å®è·µ 5: å¤šé¡¹ç›®å¹¶è¡Œç®¡ç†</h4>
<p><strong>ç›®å½•ç»“æ„:</strong></p>
<pre><code class="hljs language-scss" lang="scss">â”œâ”€â”€ project-<span class="hljs-selector-tag">a</span>/
â”‚   â”œâ”€â”€ task_plan<span class="hljs-selector-class">.md</span>
â”‚   â”œâ”€â”€ findings<span class="hljs-selector-class">.md</span>
â”‚   â””â”€â”€ progress<span class="hljs-selector-class">.md</span>
â”œâ”€â”€ project-<span class="hljs-selector-tag">b</span>/
â”‚   â”œâ”€â”€ task_plan<span class="hljs-selector-class">.md</span>
â”‚   â”œâ”€â”€ findings<span class="hljs-selector-class">.md</span>
â”‚   â””â”€â”€ progress<span class="hljs-selector-class">.md</span>
â””â”€â”€ project-c/
    â”œâ”€â”€ task_plan<span class="hljs-selector-class">.md</span>
    â”œâ”€â”€ findings<span class="hljs-selector-class">.md</span>
    â””â”€â”€ progress<span class="hljs-selector-class">.md</span>
</code></pre>
<p><strong>åˆ‡æ¢é¡¹ç›®æ—¶:</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># é¡¹ç›® A å·¥ä½œä¸­...</span>
ä½ : åˆ‡æ¢åˆ°é¡¹ç›® B

Claude: æ˜ç™½ï¼Œåˆ‡æ¢åˆ° project-bã€‚

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“‚ Project-B çŠ¶æ€
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ä¸Šæ¬¡æ´»åŠ¨: æ˜¨å¤© 10:30

ä»»åŠ¡è¿›åº¦: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘ 80%

ğŸ”„ è¿›è¡Œä¸­: Phase 4 - API é›†æˆ

è¦ç»§ç»­å—ï¼Ÿå…ˆå¿«é€Ÿçœ‹ä¸€ä¸‹ plan è¿˜æ˜¯ findingsï¼Ÿ
</code></pre>
<hr/>
<h4 data-id="heading-27">å®è·µ 6: å›¢é˜Ÿåä½œæ¨¡å¼</h4>
<p><strong>å…±äº« findings.md:</strong></p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section"># Team Findings</span>

<span class="hljs-section">## @Alice - 2024-02-10</span>
å‘ç° Vercel éƒ¨ç½²æ—¶ç¯å¢ƒå˜é‡é—®é¢˜...
[è¯¦ç»†è®°å½•]

<span class="hljs-section">## @Bob - 2024-02-11</span>
ä¿®å¤äº† Alice çš„é—®é¢˜ï¼Œéœ€è¦æ·»åŠ  <span class="hljs-code">`.env.production`</span>...

<span class="hljs-section">## @Charlie - 2024-02-12</span>
åŸºäº Alice å’Œ Bob çš„å‘ç°ï¼Œåˆ›å»ºäº†éƒ¨ç½²è„šæœ¬...
</code></pre>
<p><strong>Git é›†æˆæœ€ä½³å®è·µ:</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># .gitignore</span>
task_plan.md.local  <span class="hljs-comment"># ä¸ªäººä»»åŠ¡é¡ºåº</span>
progress.md.local   <span class="hljs-comment"># ä¸ªäººè¿›åº¦</span>

<span class="hljs-comment"># Git commit å‰æ£€æŸ¥</span>
git diff task_plan.md  <span class="hljs-comment"># æŸ¥çœ‹è®¡åˆ’å˜æ›´</span>
git diff findings.md   <span class="hljs-comment"># æŸ¥çœ‹æ–°å¢å‘ç°</span>
</code></pre>
<hr/>
<h4 data-id="heading-28">å®è·µ 7: æ€§èƒ½ä¼˜åŒ–æŠ€å·§</h4>
<p><strong>å‡å°‘ä¸å¿…è¦çš„æ–‡ä»¶è¯»å–:</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// Hook ä¼˜åŒ–ç¤ºä¾‹</span>
<span class="hljs-keyword">if</span> (action === <span class="hljs-string">'write_file'</span> &amp;&amp; file.<span class="hljs-title function_">endsWith</span>(<span class="hljs-string">'.md'</span>)) {
  <span class="hljs-comment">// åªåœ¨å†™å…¥ Markdown æ—¶æé†’</span>
  <span class="hljs-title function_">remindToUpdateFindings</span>();
}

<span class="hljs-keyword">if</span> (action === <span class="hljs-string">'run_command'</span> &amp;&amp; command.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'test'</span>)) {
  <span class="hljs-comment">// æµ‹è¯•å‘½ä»¤åè®°å½•ç»“æœ</span>
  <span class="hljs-title function_">remindToLogTestResults</span>();
}
</code></pre>
<p><strong>æ™ºèƒ½ç¼“å­˜ç­–ç•¥:</strong></p>
<pre><code class="hljs language-scss" lang="scss">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ–‡ä»¶è¯»å–ç­–ç•¥                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  task_plan<span class="hljs-selector-class">.md</span>    â†’ æ¯æ¬¡å†³ç­–å‰è¯»å– (PreToolUse Hook)          â”‚
â”‚  findings<span class="hljs-selector-class">.md</span>     â†’ æ¯ <span class="hljs-number">2</span> æ¬¡æ“ä½œåè¯»å– (PostToolUse Counter)   â”‚
â”‚  progress<span class="hljs-selector-class">.md</span>     â†’ ä¼šè¯ç»“æŸæ—¶è¯»å– (Stop Hook)                â”‚
â”‚                                                              â”‚
â”‚  é¿å…è¿‡åº¦è¯»å– â†’ èŠ‚çœ tokens                                  â”‚
â”‚  å…³é”®æ—¶åˆ»è¯»å– â†’ ç¡®ä¿ä¸€è‡´æ€§                                  â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<hr/>
<h4 data-id="heading-29">å®è·µ 8: å¸¸è§é™·é˜±ä¸é¿å‘æŒ‡å—</h4>



































<table><thead><tr><th>é™·é˜±</th><th>ç—‡çŠ¶</th><th>è§£å†³æ–¹æ¡ˆ</th></tr></thead><tbody><tr><td><strong>è¿‡åº¦è§„åˆ’</strong></td><td>èŠ± 1 å°æ—¶å†™ planï¼Œä»£ç æ²¡å†™å‡ è¡Œ</td><td>10-15 åˆ†é’Ÿå¿«é€Ÿè§„åˆ’ï¼Œè¾¹åšè¾¹è°ƒæ•´</td></tr><tr><td><strong>å¿½è§† findings</strong></td><td>é‡å¤æœç´¢ç›¸åŒé—®é¢˜</td><td>æ¯æ¬¡æŸ¥èµ„æ–™åç«‹å³è®°å½•</td></tr><tr><td><strong>checkbox ææƒ§</strong></td><td>ä¸æ•¢å¼€å§‹å› ä¸ºä»»åŠ¡å¤ªå¤š</td><td>å…ˆæ‹†æˆ 3 ä¸ªå¤§ Phaseï¼Œç»†åŒ–å†è¯´</td></tr><tr><td><strong>å®Œç¾ä¸»ä¹‰</strong></td><td>findings å†™å¾—åƒåšå®¢</td><td>å…³é”®ä¿¡æ¯ä¼˜å…ˆï¼Œæ ¼å¼å¯ä»¥ç²—ç³™</td></tr><tr><td><strong>ä¸æ£€æŸ¥ status</strong></td><td>å¿˜è®°è¿›åº¦</td><td>æ¯ 30 åˆ†é’Ÿ <code>/plan:status</code> ä¸€æ¬¡</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-30">å®æˆ˜å¯¹ç…§è¡¨ï¼šä¼ ç»Ÿæ–¹å¼ vs 3-File æ¨¡å¼</h3>








































<table><thead><tr><th>åœºæ™¯</th><th>ä¼ ç»Ÿæ–¹å¼</th><th>3-File æ¨¡å¼</th></tr></thead><tbody><tr><td><strong>ä¸­é€”é€€å‡º</strong></td><td>âŒ ä¸‹æ¬¡ä»å¤´è§£é‡Š</td><td>âœ… <code>/plan:status</code> å¿«é€Ÿæ¢å¤</td></tr><tr><td><strong>é‡åˆ°é”™è¯¯</strong></td><td>âŒ é‡å¤çŠ¯ç›¸åŒé”™è¯¯</td><td>âœ… findings.md è®°å½•è§£å†³æ–¹æ¡ˆ</td></tr><tr><td><strong>å¤šæ­¥ä»»åŠ¡</strong></td><td>âŒ AI å¿˜è®°åŸå§‹ç›®æ ‡</td><td>âœ… task_plan.md æŒç»­è¿½è¸ª</td></tr><tr><td><strong>ç ”ç©¶å‘ç°</strong></td><td>âŒ æ•£è½åœ¨ä¸Šä¸‹æ–‡ä¸­</td><td>âœ… findings.md ç»“æ„åŒ–å­˜å‚¨</td></tr><tr><td><strong>è¿›åº¦å¯è§†åŒ–</strong></td><td>âŒ æ— æ³•ç›´è§‚çœ‹åˆ°</td><td>âœ… checkbox è¿›åº¦æ¡</td></tr><tr><td><strong>å›¢é˜Ÿäº¤æ¥</strong></td><td>âŒ å£å¤´è§£é‡Šå¾ˆç´¯</td><td>âœ… å…±äº« findings æ–‡æ¡£</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-31">ä½¿ç”¨åœºæ™¯å†³ç­–æ ‘</h3>
<pre><code class="hljs language-bash" lang="bash">                    å¼€å§‹ä»»åŠ¡
                       â”‚
                       â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ ä»»åŠ¡æ˜¯å¦å¤æ‚ï¼Ÿ   â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚          â”‚
                å¦          æ˜¯
                 â”‚          â”‚
                 â–¼          â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚ ç›´æ¥æ‰§è¡Œ  â”‚  â”‚ æ˜¯å¦ &gt;3 æ­¥éª¤ï¼Ÿ   â”‚
          â”‚ ä¸ç”¨ plan â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚          â”‚
                          å¦          æ˜¯
                           â”‚          â”‚
                           â–¼          â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ ç®€å•è®°å½•  â”‚  â”‚ å¯åŠ¨ /plan  â”‚
                    â”‚ todo list â”‚  â”‚ 3-File æ¨¡å¼ â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç¤ºä¾‹åˆ¤æ–­:
â€¢ <span class="hljs-string">"ä¿®å¤ä¸€ä¸ª bug"</span>        â†’ ç›´æ¥æ‰§è¡Œ
â€¢ <span class="hljs-string">"æ·»åŠ ä¸€ä¸ªæŒ‰é’®"</span>        â†’ ç›´æ¥æ‰§è¡Œ
â€¢ <span class="hljs-string">"é‡æ„ä¸€ä¸ªç»„ä»¶"</span>        â†’ ç®€å•è®°å½•
â€¢ <span class="hljs-string">"æ„å»ºå®Œæ•´åŠŸèƒ½æ¨¡å—"</span>    â†’ /plan
â€¢ <span class="hljs-string">"ç ”ç©¶æ–°æŠ€æœ¯å¹¶å®ç°"</span>    â†’ /plan
â€¢ <span class="hljs-string">"å¤šæ­¥éª¤ç³»ç»Ÿé›†æˆ"</span>      â†’ /plan
</code></pre>
<hr/>
<h3 data-id="heading-32">ç¤¾åŒºç”Ÿæ€ä¸æ‰©å±•</h3>
<p><strong>planning-with-files</strong> å·²å‚¬ç”Ÿå¤šä¸ªç¤¾åŒº Fork é¡¹ç›®ï¼š</p>

























<table><thead><tr><th>é¡¹ç›®</th><th>ä½œè€…</th><th>ç‰¹è‰²åŠŸèƒ½</th></tr></thead><tbody><tr><td><strong>devis</strong></td><td>@st01cs</td><td>é¢è¯•ä¼˜å…ˆå·¥ä½œæµï¼Œ<code>/devis:intv</code> å’Œ <code>/devis:impl</code> å‘½ä»¤</td></tr><tr><td><strong>multi-manus-planning</strong></td><td>@kmichels</td><td>å¤šé¡¹ç›®æ”¯æŒï¼ŒSessionStart git åŒæ­¥</td></tr><tr><td><strong>plan-cascade</strong></td><td>@Taoidle</td><td>å¤šçº§ä»»åŠ¡ç¼–æ’ï¼Œå¹¶è¡Œæ‰§è¡Œï¼Œå¤šä»£ç†åä½œ</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-33">å¸¸è§é—®é¢˜è§£ç­”</h3>
<p><strong>Q: å’Œå†…ç½® <code>/plan</code> å‘½ä»¤æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</strong></p>
<blockquote>
<p>A: å†…ç½®å‘½ä»¤è¿›å…¥ plan mode åé€€å‡ºï¼Œæœ¬æ’ä»¶æŒä¹…åŒ–åˆ°æ–‡ä»¶ï¼Œæ”¯æŒä¼šè¯æ¢å¤å’Œè¿›åº¦è¿½è¸ªã€‚</p>
</blockquote>
<p><strong>Q: æ”¯æŒ Windows å—ï¼Ÿ</strong></p>
<blockquote>
<p>A: å®Œå…¨æ”¯æŒï¼v2.2.0 å¼€å§‹æä¾› PowerShell è„šæœ¬ã€‚</p>
</blockquote>
<p><strong>Q: ä¼šå¢åŠ å¾ˆå¤š token æ¶ˆè€—å—ï¼Ÿ</strong></p>
<blockquote>
<p>A: ä¸ä¼šã€‚Hooks åªåœ¨å…³é”®æ—¶åˆ»ï¼ˆå†³ç­–å‰ã€å†™æ–‡ä»¶åã€é€€å‡ºæ—¶ï¼‰è¯»å–æ–‡ä»¶ï¼Œç›¸æ¯”ä¼ ç»Ÿæ¨¡å¼åè€Œæ›´èŠ‚çœ tokensã€‚</p>
</blockquote>
<p><strong>Q: å¯ä»¥è‡ªå®šä¹‰æ¨¡æ¿å—ï¼Ÿ</strong></p>
<blockquote>
<p>A: å¯ä»¥ï¼ä¿®æ”¹ <code>~/.claude/plugins/.../templates/</code> ä¸‹çš„æ¨¡æ¿æ–‡ä»¶å³å¯ã€‚</p>
</blockquote>
<p><strong>Q: å¦‚ä½•æŸ¥çœ‹å½“å‰è¿›åº¦ï¼Ÿ</strong></p>
<blockquote>
<p>A: ä½¿ç”¨ <code>/plan:status</code> å‘½ä»¤å¿«é€ŸæŸ¥çœ‹è¿›åº¦æŠ¥å‘Šã€‚</p>
</blockquote>
<hr/>
<h3 data-id="heading-34">å¿«é€Ÿå‚è€ƒå¡ç‰‡</h3>
<pre><code class="hljs language-bash" lang="bash">â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘           planning-with-files å¿«é€Ÿå‚è€ƒ                        â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                               â•‘
â•‘  ğŸš€ å¯åŠ¨å‘½ä»¤                                                  â•‘
â•‘     /plan          å¼€å§‹æ–°è§„åˆ’                                â•‘
â•‘     /plan:status   æŸ¥çœ‹å½“å‰è¿›åº¦                              â•‘
â•‘                                                               â•‘
â•‘  ğŸ“ ä¸‰ä¸ªæ–‡ä»¶                                                  â•‘
â•‘     task_plan.md    â† ä»»åŠ¡åˆ†è§£ + checkbox è¿›åº¦               â•‘
â•‘     findings.md     â† ç ”ç©¶å‘ç° + æŠ€æœ¯å†³ç­–                     â•‘
â•‘     progress.md     â† ä¼šè¯æ—¥å¿— + æ—¶é—´è®°å½•                     â•‘
â•‘                                                               â•‘
â•‘  ğŸ”„ Hooks è‡ªåŠ¨åŒ–                                              â•‘
â•‘     PreToolUse    â†’ å†³ç­–å‰é‡è¯» plan                          â•‘
â•‘     PostToolUse   â†’ æ“ä½œåæé†’ä¿å­˜                           â•‘
â•‘     Stop          â†’ é€€å‡ºå‰éªŒè¯å®Œæˆåº¦                         â•‘
â•‘                                                               â•‘
â•‘  âš¡ å…³é”®è§„åˆ™                                                  â•‘
â•‘     1. å…ˆåˆ›å»º Planï¼Œå†å¼€å§‹æ‰§è¡Œ                               â•‘
â•‘     2. æ¯ä¸¤æ¬¡æŸ¥çœ‹æ“ä½œä¿å­˜ findings                           â•‘
â•‘     3. æ‰€æœ‰é”™è¯¯å¿…é¡»è®°å½•åŸå›                                   â•‘
â•‘     4. å¤±è´¥åæ”¹å˜æ–¹æ³•ï¼Œä¸è¦é‡å¤                              â•‘
â•‘                                                               â•‘
â•‘  âœ… é€‚åˆåœºæ™¯                                                 â•‘
â•‘     âœ“ å¤šæ­¥éª¤ä»»åŠ¡ (3+)                                        â•‘
â•‘     âœ“ ç ”ç©¶æ€§ä»»åŠ¡                                             â•‘
â•‘     âœ“ é•¿å‘¨æœŸé¡¹ç›®                                             â•‘
â•‘     âœ“ å¤šæ¬¡ä¼šè¯å®Œæˆ                                           â•‘
â•‘                                                               â•‘
â•‘  âŒ ä¸é€‚åˆåœºæ™¯                                               â•‘
â•‘     âœ— ç®€å•é—®ç­”                                               â•‘
â•‘     âœ— å•æ–‡ä»¶ç¼–è¾‘                                             â•‘
â•‘     âœ— å¿«é€ŸæŸ¥æ‰¾                                               â•‘
â•‘                                                               â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
</code></pre>
<hr/>
<h3 data-id="heading-35">æ€»ç»“</h3>
<p><strong>planning-with-files</strong> é€šè¿‡ Manus AI çš„ä¸‰æ–‡ä»¶æ¨¡å¼ï¼Œè§£å†³äº† AI ç¼–ç¨‹åŠ©æ‰‹çš„æ ¸å¿ƒç—›ç‚¹ï¼š</p>
<ol>
<li><strong>æŒä¹…åŒ–è®°å¿†</strong> - ç”¨æ–‡ä»¶ç³»ç»Ÿä½œä¸º AI çš„å¤–éƒ¨è®°å¿†</li>
<li><strong>è¿›åº¦å¯è§†åŒ–</strong> - checkbox è¿›åº¦æ¡æ¸…æ™°å±•ç¤ºä»»åŠ¡çŠ¶æ€</li>
<li><strong>è‡ªåŠ¨æ¢å¤</strong> - ä¸Šä¸‹æ–‡é‡ç½®åæ— ç¼æ¥ç»­å·¥ä½œ</li>
<li><strong>çŸ¥è¯†æ²‰æ·€</strong> - findings.md ç§¯ç´¯æŠ€æœ¯å†³ç­–å’Œç»éªŒ</li>
<li>** Hooks è‡ªåŠ¨åŒ–** - æ— éœ€æ‰‹åŠ¨å¹²é¢„ï¼Œæ™ºèƒ½è¿½è¸ªè¿›åº¦</li>
</ol>
<p><strong>æ ¸å¿ƒç†å¿µï¼š</strong></p>
<pre><code class="hljs language-ini" lang="ini">Context <span class="hljs-attr">Window</span> = RAM (æ˜“å¤±ã€æœ‰é™)
<span class="hljs-attr">Filesystem</span> = Disk (æŒä¹…ã€æ— é™)
â†’ ä»»ä½•é‡è¦ä¿¡æ¯éƒ½å†™å…¥ç£ç›˜
</code></pre>
<p><strong>ç«‹å³å¼€å§‹ï¼š</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ä¸€é”®å®‰è£…</span>
/plugin marketplace add OthmanAdi/planning-with-files
/plugin install planning-with-files@planning-with-files

<span class="hljs-comment"># å¼€å§‹ä½ çš„ç¬¬ä¸€ä¸ªè§„åˆ’ä¼šè¯</span>
/plan
</code></pre>
<p><strong>ç›¸å…³é“¾æ¥ï¼š</strong></p>
<ul>
<li>ğŸ“¦ GitHub: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FOthmanAdi%2Fplanning-with-files" target="_blank" title="https://github.com/OthmanAdi/planning-with-files" ref="nofollow noopener noreferrer">OthmanAdi/planning-with-files</a></li>
<li>ğŸ“– æ–‡æ¡£: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FOthmanAdi%2Fplanning-with-files%2Ftree%2Fmain%2Fdocs" target="_blank" title="https://github.com/OthmanAdi/planning-with-files/tree/main/docs" ref="nofollow noopener noreferrer">å®Œæ•´æ–‡æ¡£</a></li>
<li>ğŸ’¬ ç¤¾åŒº: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FOthmanAdi%2Fplanning-with-files%2Fissues" target="_blank" title="https://github.com/OthmanAdi/planning-with-files/issues" ref="nofollow noopener noreferrer">æäº¤ Issue åˆ†äº«ä½¿ç”¨ç»éªŒ</a></li>
</ul>
<hr/>
<p><strong>æ–‡ç« æ ‡ç­¾ï¼š</strong> <code>#ClaudeCode</code> <code>#AIç¼–ç¨‹</code> <code>#å¼€å‘å·¥å…·</code> <code>#æ•ˆç‡æå‡</code> <code>#Manus</code> <code>#ä¸Šä¸‹æ–‡å·¥ç¨‹</code> <code>#å¼€æºé¡¹ç›®</code></p>
<p><strong>å¦‚æœè¿™ç¯‡æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©ï¼Œæ¬¢è¿ç‚¹èµæ”¶è—ï¼Œä¹Ÿæ¬¢è¿åœ¨è¯„è®ºåŒºåˆ†äº«ä½ çš„ä½¿ç”¨ç»éªŒï¼</strong></p>
<hr/>
<blockquote>
<p><strong>ä½œè€…ç®€ä»‹ï¼š</strong> å…¨æ ˆå¼€å‘è€…ï¼Œä¸“æ³¨äº AI è¾…åŠ©ç¼–ç¨‹å·¥å…·çš„ç ”ç©¶ä¸å®è·µã€‚</p>
<p><strong>ç‰ˆæƒå£°æ˜ï¼š</strong> æœ¬æ–‡åŸåˆ›ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[åŸºäºDWSçš„å‘é‡è®¡ç®—åŠŸèƒ½å®ç°ç®€å•çš„å•†å“æœç´¢æ¨èç³»ç»Ÿ]]></title>    <link>https://juejin.cn/post/7604693038440218630</link>    <guid>https://juejin.cn/post/7604693038440218630</guid>    <pubDate>2026-02-10T03:33:57.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604693038440218630" data-draft-id="7604666872128110611" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="åŸºäºDWSçš„å‘é‡è®¡ç®—åŠŸèƒ½å®ç°ç®€å•çš„å•†å“æœç´¢æ¨èç³»ç»Ÿ"/> <meta itemprop="keywords" content="å‰ç«¯,åç«¯,ç¨‹åºå‘˜"/> <meta itemprop="datePublished" content="2026-02-10T03:33:57.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="åä¸ºäº‘å¼€å‘è€…è”ç›Ÿ"/> <meta itemprop="url" content="https://juejin.cn/user/3966693685605143"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            åŸºäºDWSçš„å‘é‡è®¡ç®—åŠŸèƒ½å®ç°ç®€å•çš„å•†å“æœç´¢æ¨èç³»ç»Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3966693685605143/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    åä¸ºäº‘å¼€å‘è€…è”ç›Ÿ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T03:33:57.000Z" title="Tue Feb 10 2026 03:33:57 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>æœ¬æ–‡åˆ†äº«è‡ªåä¸ºäº‘ç¤¾åŒºã€Š<a href="https://link.juejin.cn?target=https%3A%2F%2Fbbs.huaweicloud.com%2Fblogs%2F470986%3Futm_source%3Djuejin%26utm_medium%3Dbbs-ex%26utm_campaign%3Dother%26utm_content%3Dcontent" target="_blank" title="https://bbs.huaweicloud.com/blogs/470986?utm_source=juejin&amp;utm_medium=bbs-ex&amp;utm_campaign=other&amp;utm_content=content" ref="nofollow noopener noreferrer">åŸºäºDWSçš„å‘é‡è®¡ç®—åŠŸèƒ½å®ç°ç®€å•çš„å•†å“æœç´¢æ¨èç³»ç»Ÿ</a>ã€‹</p>
<h2 data-id="heading-0">1. å‰è¨€</h2>
<ul>
<li>é€‚ç”¨ç‰ˆæœ¬ï¼šã€9.1.1.200ï¼ˆåŠä»¥ä¸Šï¼‰ã€‘</li>
</ul>
<p>åœ¨ç”Ÿæˆå¼ AI ä¸å¤§æ¨¡å‹ï¼ˆLLMï¼‰é‡å¡‘æŠ€æœ¯æ ˆçš„ä»Šå¤©ï¼Œæ•°æ®å¤„ç†çš„éœ€æ±‚å·²ç»ä»å•ä¸€çš„â€œç²¾ç¡®åŒ¹é…â€è½¬å‘äº†â€œè¯­ä¹‰ç†è§£â€ã€‚ä¼ ç»Ÿçš„æ•°æ®åº“ç³»ç»Ÿåœ¨å¤„ç†ç»“æ„åŒ–æ•°æ®ï¼ˆå¦‚è®¢å•é‡‘é¢ã€ç”¨æˆ·IDï¼‰æ–¹é¢è¡¨ç°å®Œç¾ï¼Œä½†åœ¨é¢å¯¹ AI æ—¶ä»£çˆ†å‘çš„éç»“æ„åŒ–æ•°æ®ï¼ˆæ–‡æœ¬ã€å›¾åƒã€éŸ³è§†é¢‘ï¼‰æ—¶ï¼ŒåŸºäºå…³é”®è¯æœç´¢çš„ä¼ ç»Ÿæ–¹å¼ç”±äºæ— æ³•ç†è§£æ•°æ®æœ¬èº«èƒŒåçš„â€œ<strong>æ„æ€</strong>â€ä»è€Œæ˜¾å¾—åŠ›ä¸ä»å¿ƒã€‚</p>
<p><strong>æ ¸å¿ƒç—›ç‚¹</strong>ï¼šä¼ ç»Ÿæ•°æ®åº“æœ¬è´¨ä¸Šä¾èµ–ç²¾ç¡®åŒ¹é…ï¼ˆexact matchï¼‰æˆ–å­—æ®µç´¢å¼•æŸ¥è¯¢ï¼Œç¼ºå°‘ä»¥â€œ<strong>å«ä¹‰</strong>â€ä¸ºä¸­å¿ƒçš„æ¨¡ç³Šç›¸ä¼¼æœç´¢èƒ½åŠ›ã€‚AIç›¸å…³åº”ç”¨ä¸æ¨èç³»ç»Ÿåœºæ™¯å¸¦æ¥äº†æµ·é‡å‘é‡æ£€ç´¢éœ€æ±‚ï¼Œç›¸ä¼¼æ€§æœç´¢æ˜¯æ ¸å¿ƒéœ€æ±‚ï¼Œå¯¹å‘é‡æ•°æ®åº“å¸¸è§åº”ç”¨åœºæ™¯ï¼š</p>
<ul>
<li>
<p>ä»¥æ–‡æœå›¾/ä»¥å›¾æœå›¾ï¼š æ‰¾åˆ°ä¸è¾“å…¥å›¾ç‰‡æœ€ç›¸ä¼¼çš„å›¾ç‰‡</p>
</li>
<li>
<p>æ™ºèƒ½é—®ç­”/RAGï¼šåœ¨çŸ¥è¯†åº“ä¸­æ‰¾åˆ°ä¸ç”¨æˆ·é—®é¢˜æœ€ç›¸å…³çš„æ–‡æ¡£ç‰‡æ®µ</p>
</li>
<li>
<p>æ¨èç³»ç»Ÿï¼šæ‰¾åˆ°ä¸ç”¨æˆ·å…´è¶£å‘é‡æœ€ç›¸ä¼¼çš„å•†å“</p>
</li>
</ul>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼šDWSé›†æˆ pgvector(0.8.0) æ’ä»¶ï¼Œå¯æ’æ‹”å¼åŠ è½½ï¼Œå®ç°åº“å†…å‘é‡è®¡ç®—æ£€ç´¢èƒ½åŠ›ã€‚</p>
<p><strong>å®šä¹‰</strong>ï¼š DWSå‘é‡è®¡ç®—å¹¶éç‹¬ç«‹çš„æ•°æ®åº“ç³»ç»Ÿï¼Œè€Œæ˜¯é€šè¿‡æ’ä»¶å½¢å¼æ‰©å±•ä¼ ç»Ÿæ•°æ®åº“åŠŸèƒ½ï¼Œä½¿å…¶èƒ½å¤Ÿå¤„ç†é«˜ç»´å‘é‡æ•°æ®ï¼Œæ— éœ€ç”¨æˆ·è¿å¾™æ•°æ®æˆ–é‡æ„åº”ç”¨æ¶æ„ï¼Œå³å¯åœ¨ç°æœ‰ç³»ç»Ÿä¸­å®ç°å‘é‡æ£€ç´¢ç›¸å…³åŠŸèƒ½ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8e24ff525f904d07952ac318a1fa47b4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2O5Li65LqR5byA5Y-R6ICF6IGU55uf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771299239&amp;x-signature=cfx7MSdJQj7Aot7oF%2FV2I97I56Q%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-1">2. DWSå‘é‡è®¡ç®—åŠŸèƒ½ç®€ä»‹</h2>
<p>1ã€å‘é‡æ•°æ®ç±»å‹ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a16a404052d24cab850e0159c3326d5a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2O5Li65LqR5byA5Y-R6ICF6IGU55uf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771299239&amp;x-signature=uIqOsx4NXYY0UKv8dzE3p6wiYvE%3D" alt="" loading="lazy"/></p>
<p>2ã€å‘é‡è·ç¦»/ç›¸ä¼¼åº¦æ“ä½œç¬¦</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ae3e5e05399a4753b31d7d679d855a81~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2O5Li65LqR5byA5Y-R6ICF6IGU55uf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771299239&amp;x-signature=obwM2RaZGRjRUmnoYN4pcRDmcKk%3D" alt="" loading="lazy"/></p>
<p>3ã€ç´¢å¼•ç±»å‹ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9f83382b508e4e40bfd0d363d0cfd689~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2O5Li65LqR5byA5Y-R6ICF6IGU55uf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771299239&amp;x-signature=d%2Fey3jWA9v%2BODco9%2BBVJx8iKdcY%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-2">3. å®Œæ•´ç¤ºä¾‹</h2>
<p>å‡è®¾æˆ‘ä»¬æ­£åœ¨åšä¸€ä¸ªå•†å“æ¨èæœç´¢ç³»ç»Ÿï¼š</p>
<ul>
<li>
<p>å•†å“æœ¬èº«æœ‰æ ‡é¢˜ã€æè¿°ã€åˆ†ç±»ã€ä»·æ ¼ç­‰å­—æ®µ</p>
</li>
<li>
<p>å€ŸåŠ©å¤§æ¨¡å‹embeddingèƒ½åŠ›ï¼Œæˆ‘ä»¬èƒ½å¤Ÿå°†å•†å“æè¿°ç¼–ç ä¸ºå‘é‡</p>
</li>
<li>
<p>åŒæ ·çš„ï¼Œå°†ç”¨æˆ·çš„æœç´¢å…³é”®å­—ä¹Ÿè½¬åŒ–ä¸ºå‘é‡</p>
</li>
<li>
<p><strong>ç›®çš„</strong>ï¼šé€šè¿‡<strong>ç›¸ä¼¼æ€§</strong>æœç´¢æ‰¾å‡ºæœ€ç¬¦åˆç”¨æˆ·<strong>æœç´¢æ„å›¾</strong>çš„å•†å“</p>
</li>
</ul>
<blockquote>
<p>å¦‚éœ€ä½¿ç”¨å‘é‡è®¡ç®—åŠŸèƒ½ï¼Œè¯·è”ç³»æŠ€æœ¯æ”¯æŒä¿®æ”¹feature_support_optionså‚æ•°, å¼€å¯enable_pgvectoré€‰é¡¹ã€‚è¯¦ç»†è¯­æ³•ä»‹ç»ï¼Œè¯·å‚è€ƒDWSäº§å“æ–‡æ¡£ <a href="https://link.juejin.cn?target=https%3A%2F%2Fsupport.huaweicloud.com%2Fdevg-911-dws%2Fdws_04_1462.html" target="_blank" title="https://support.huaweicloud.com/devg-911-dws/dws_04_1462.html" ref="nofollow noopener noreferrer">å‘é‡è®¡ç®—</a>ç« èŠ‚</p>
</blockquote>
<h3 data-id="heading-3">3.1 åŸºç¡€æŸ¥è¯¢</h3>
<ol>
<li>
<p>å®‰è£…æ‰©å±•ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">create extension pgvector<span class="hljs-comment">;</span>
</code></pre>
</li>
<li>
<p>åˆ›å»ºå•†å“è¡¨ï¼Œå‚¨å­˜å‘é‡embeddingï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> products (    id bigserial <span class="hljs-keyword">PRIMARY</span> KEY,    title text,    description text,    price <span class="hljs-type">numeric</span>,    embedding vector(<span class="hljs-number">768</span>)   <span class="hljs-comment">--768ç»´å‘é‡ï¼Œç”±å•†å“æè¿°(description)ç”Ÿæˆ);</span>
</code></pre>
</li>
<li>
<p>æ’å…¥æ•°æ®</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> products (title, description, price, embedding) <span class="hljs-keyword">VALUES</span>(<span class="hljs-string">'Wireless Earbuds'</span>, <span class="hljs-string">'Bluetooth wireless earbuds with charging case'</span>, <span class="hljs-number">59.9</span>, <span class="hljs-string">'[0.12, 0.34, -0.21, ...]'</span>),(<span class="hljs-string">'Noise Cancelling Headphones'</span>, <span class="hljs-string">'Over-ear headphones with active noise cancellation'</span>, <span class="hljs-number">129.9</span>, <span class="hljs-string">'[0.11, 0.36, -0.19, ...]'</span>),(<span class="hljs-string">'Gaming Headset'</span>, <span class="hljs-string">'Wired gaming headset with microphone'</span>, <span class="hljs-number">79.9</span>, <span class="hljs-string">'[0.10, 0.33, -0.25, ...]'</span>),(<span class="hljs-string">'Smartphone Stand'</span>, <span class="hljs-string">'Adjustable phone stand for desk use'</span>, <span class="hljs-number">12.9</span>, <span class="hljs-string">'[0.45, -0.12, 0.08, ...]'</span>),(<span class="hljs-string">'USB-C Charger'</span>, <span class="hljs-string">'Fast charging USB-C power adapter'</span>, <span class="hljs-number">19.9</span>, <span class="hljs-string">'[0.42, -0.15, 0.05, ...]'</span>),(<span class="hljs-string">'Mechanical Keyboard'</span>, <span class="hljs-string">'Mechanical keyboard with blue switches'</span>, <span class="hljs-number">89.9</span>, <span class="hljs-string">'[0.55, 0.02, -0.31, ...]'</span>),(<span class="hljs-string">'Wireless Mouse'</span>, <span class="hljs-string">'Ergonomic wireless mouse'</span>, <span class="hljs-number">29.9</span>, <span class="hljs-string">'[0.53, 0.01, -0.28, ...]'</span>),(<span class="hljs-string">'Laptop Backpack'</span>, <span class="hljs-string">'Water-resistant laptop backpack'</span>, <span class="hljs-number">49.9</span>, <span class="hljs-string">'[0.60, -0.05, -0.10, ...]'</span>),(<span class="hljs-string">'4K Monitor'</span>, <span class="hljs-string">'27-inch 4K UHD computer monitor'</span>, <span class="hljs-number">299.9</span>, <span class="hljs-string">'[0.58, 0.04, -0.35, ...]'</span>),(<span class="hljs-string">'Webcam'</span>, <span class="hljs-string">'HD webcam for video conferencing'</span>, <span class="hljs-number">39.9</span>, <span class="hljs-string">'[0.52, -0.01, -0.20, ...]'</span>),(<span class="hljs-string">'Bluetooth Speaker'</span>, <span class="hljs-string">'Portable Bluetooth speaker with deep bass'</span>, <span class="hljs-number">45.9</span>, <span class="hljs-string">'[0.14, 0.30, -0.18, ...]'</span>),(<span class="hljs-string">'Smart Watch'</span>, <span class="hljs-string">'Fitness tracking smart watch'</span>, <span class="hljs-number">99.9</span>, <span class="hljs-string">'[0.20, 0.40, -0.22, ...]'</span>),(<span class="hljs-string">'Fitness Tracker'</span>, <span class="hljs-string">'Lightweight activity and sleep tracker'</span>, <span class="hljs-number">49.9</span>, <span class="hljs-string">'[0.22, 0.38, -0.24, ...]'</span>),(<span class="hljs-string">'Tablet Stylus'</span>, <span class="hljs-string">'Stylus pen for tablets'</span>, <span class="hljs-number">25.9</span>, <span class="hljs-string">'[0.48, -0.10, 0.12, ...]'</span>),(<span class="hljs-string">'Laptop Cooling Pad'</span>, <span class="hljs-string">'Cooling pad with dual fans'</span>, <span class="hljs-number">34.9</span>, <span class="hljs-string">'[0.57, -0.02, -0.15, ...]'</span>);
</code></pre>
</li>
<li>
<p>ç›¸ä¼¼åº¦æŸ¥è¯¢ï¼š</p>
<p>é€šè¿‡ä»¥ä¸‹æŸ¥è¯¢ï¼Œèƒ½å¤Ÿè·å–ä¸ç”¨æˆ·å‘é‡ç›¸ä¼¼åº¦æœ€é«˜/è·ç¦»æœ€è¿‘çš„topkä¸ªå•†å“</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> id, title, priceFROM productsORDER <span class="hljs-keyword">BY</span> embedding <span class="hljs-operator">&lt;</span><span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span> <span class="hljs-string">'[0.091, -0.054, 0.92, ...]'</span>   <span class="hljs-comment">-- ç”¨æˆ·å‘é‡, é€šè¿‡L2è·ç¦»è®¡ç®—ç›¸ä¼¼åº¦LIMIT 10;</span>
</code></pre>
</li>
<li>
<p>æ··åˆæŸ¥è¯¢:</p>
<p>DWSå‘é‡è®¡ç®—æ”¯æŒä¼ ç»Ÿè¿‡æ»¤æ–¹å¼åŠè¯­ä¹‰ç›¸ä¼¼åº¦æŸ¥è¯¢çš„æ··åˆä½¿ç”¨</p>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-keyword">SELECT</span> id,title,priceFROM productsWHERE price &lt; <span class="hljs-number">2000</span><span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> embedding &lt;-&gt; <span class="hljs-comment">'[0.091, -0.054, 0.92, ...]'LIMIT 10;</span>
</code></pre>
</li>
</ol>
<h3 data-id="heading-4">3.2 ä½¿ç”¨ç´¢å¼•</h3>
<p>DWSå‘é‡è®¡ç®—é»˜è®¤ä½¿ç”¨ç²¾ç¡®è¿‘é‚»æœç´¢ï¼Œæä¾›ç™¾åˆ†ä¹‹ç™¾å¬å›ç‡ä½†æŸ¥è¯¢é€Ÿåº¦è¾ƒæ…¢ã€‚å¯ä»¥æŒ‰éœ€ä½¿ç”¨è¿‘ä¼¼ç›¸é‚»æœç´¢ç´¢å¼•æ¥ç‰ºç‰²éƒ¨åˆ†å¬å›ç‡ä»¥æé«˜æŸ¥è¯¢é€Ÿåº¦ã€‚ä¸åŒäºä¼ ç»Ÿç´¢å¼•ï¼Œè¿‘ä¼¼æœç´¢ç´¢å¼•å¯èƒ½ä¼šè¿”å›ä¸åŒçš„æŸ¥è¯¢ç»“æœã€‚DWSå‘é‡è®¡ç®—ç›®å‰æ”¯æŒçš„ç´¢å¼•ç±»å‹åŒ…æ‹¬HNSWå’ŒIVFFlatã€‚</p>
<ol>
<li>
<p>åˆ›å»ºç´¢å¼•</p>
<pre><code class="hljs language-vbnet" lang="vbnet">-- HNSW ç´¢å¼•CREATE INDEX <span class="hljs-keyword">ON</span> products <span class="hljs-keyword">USING</span> hnsw (embedding vector_l2_ops) <span class="hljs-keyword">WITH</span> (m = <span class="hljs-number">16</span>, ef_construction = <span class="hljs-number">200</span>);-- æˆ–è€… IVFFlat ç´¢å¼•CREATE INDEX <span class="hljs-keyword">ON</span> products <span class="hljs-keyword">USING</span> ivfflat (embedding vector_l2_ops) <span class="hljs-keyword">WITH</span> (lists = <span class="hljs-number">100</span>);
</code></pre>
</li>
<li>
<p>ä½¿ç”¨ç´¢å¼• åˆ›å»ºç´¢å¼•åæ‰§è¡ŒtopkæŸ¥è¯¢ï¼Œåœ¨è·ç¦»æ“ä½œç¬¦åŒ¹é…çš„åœºæ™¯ä¸‹ä¼šä½¿ç”¨index scanï¼Œå¯ä»¥é€šè¿‡explainè§‚å¯Ÿè®¡åˆ’</p>
<pre><code class="hljs language-rust" lang="rust"> id |                            operation                             ----+------------------------------------------------------------------  <span class="hljs-number">1</span> | <span class="hljs-punctuation">-&gt;</span>  Limit                                                          <span class="hljs-number">2</span> |    <span class="hljs-punctuation">-&gt;</span>  <span class="hljs-title function_ invoke__">Streaming</span> (<span class="hljs-keyword">type</span>: GATHER)                                    <span class="hljs-number">3</span> |       <span class="hljs-punctuation">-&gt;</span>  Limit                                                    <span class="hljs-number">4</span> |          <span class="hljs-punctuation">-&gt;</span>  Index Scan using products_embedding_idx on products
</code></pre>
</li>
</ol>
<h3 data-id="heading-5">3.3 ç»“æœè§£è¯»</h3>
<ul>
<li>
<p>ç”¨æˆ·æœç´¢è¯ä¸º <code>wireless audio headset</code></p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> id, title    <span class="hljs-keyword">FROM</span> products    <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> embedding <span class="hljs-operator">&lt;</span><span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span> <span class="hljs-string">'[0.13, 0.35, -0.20, ...]'</span>   <span class="hljs-comment">--ç”¨æˆ·æœç´¢è¯çš„embedding    LIMIT 10;</span>
</code></pre>
</li>
</ul>
<p>æŸ¥è¯¢ç»“æœï¼š å•†å“åä¸ºè€³æœºã€éŸ³å“ç±»å‹çš„æ•°æ®ç›¸è¾ƒäºè¡¨ä¸­å…¶ä»–å•†å“ç±»åˆ«ä¸ç”¨æˆ·æœç´¢è¯åœ¨è¯­ä¹‰ä¸Šæ›´ä¸ºæ¥è¿‘ï¼Œå³ä¾¿æ²¡æœ‰ç²¾ç¡®åŒ…å«<code>headset</code>ä»ç„¶ä¼šåœ¨ç»“æœä¸­æ’åºæ›´é å‰</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2a6d7a8f2cad4ba89cc139d9e683dd28~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2O5Li65LqR5byA5Y-R6ICF6IGU55uf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771299239&amp;x-signature=W7BsELu3GzkDaoqTFianWnqDUnA%3D" alt="" loading="lazy"/></p>
<ul>
<li>
<p>ç”¨æˆ·æ­£åœ¨æµè§ˆ <code>Noise Cancelling Headphones</code> å•†å“ï¼Œæ ¹æ®ç›¸å…³æ€§è¿›è¡Œæ¨èï¼š</p>
<p>SELECT p2.title, p2.priceFROM products p1JOIN products p2 ON p1.id &lt;&gt; p2.idWHERE p1.title = 'Noise Cancelling Headphones'ORDER BY p2.embedding &lt;-&gt; p1.embeddingLIMIT 10;</p>
</li>
</ul>
<p>æŸ¥è¯¢ç»“æœï¼š è€³æœºéŸ³å“ç±»å•†å“ä¸ç”¨æˆ·æ­£åœ¨æµè§ˆçš„ <code>Noise Cancelling Headphones</code> äº§å“ç›¸å…³æ€§æ›´é«˜Â </p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1419bc4e28fd47d3afa8648bfed5e2ea~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2O5Li65LqR5byA5Y-R6ICF6IGU55uf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771299239&amp;x-signature=NZHSadf1UqWUo0fwO58unVud%2FvY%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-6">4 æ€§èƒ½</h2>
<p>ä»¥ä¸‹å›¾ç¤ºå±•ç¤ºäº†dws pgvectoræ’ä»¶åœ¨ä¸åŒæ•°æ®é›†åŠç´¢å¼•ä¸‹çš„æ£€ç´¢æ€§èƒ½</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d06a5fdc48e04959b3bc2d3b61f09f2d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2O5Li65LqR5byA5Y-R6ICF6IGU55uf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771299239&amp;x-signature=w4b%2BUZf4ZY30KhoyTl4pIZyhZY8%3D" alt="" loading="lazy"/></p>
<p>å®æµ‹è¡¨æ˜ï¼Œdws pgvectoræ’ä»¶èƒ½å¤Ÿåšåˆ°åƒä¸‡çº§å‘é‡æ•°æ®ï¼š</p>
<ol>
<li>
<p>ä½äºå°æ—¶çº§ç´¢å¼•æ„å»ºæ—¶é—´</p>
</li>
<li>
<p>æ¯«ç§’çº§æŸ¥è¯¢</p>
</li>
<li>
<p>ç¨³å®šé«˜å¬å›ç‡ï¼ŒæŒ‰éœ€è°ƒå‚æ§åˆ¶</p>
</li>
</ol>
<p>å¯¹æ¯”ä¸¤ç§ç´¢å¼•ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ï¼š</p>
<ul>
<li>
<p>hnswç´¢å¼•æ„å»ºæ—¶é—´ä¸æ•°æ®é‡å’Œç»´åº¦å¼ºç›¸å…³ã€‚ç›¸åŒæ•°æ®é‡å’Œç»´åº¦åœºæ™¯ä¸‹æ„å»ºæ—¶é—´ç›¸è¾ƒivfflatæ˜¾è‘—å¢åŠ ï¼Œæ¢å–æ›´å¿«å¾—æŸ¥è¯¢é€Ÿåº¦å’Œæ›´å¥½çš„å¬å›ç‡</p>
</li>
<li>
<p>ivfflatç´¢å¼•æ„å»ºæ—¶é—´æ›´çŸ­ï¼Œä¸»è¦å—æ„å»ºå‚æ•°listså½±å“ï¼Œå¯¹æ•°æ®é‡ä¸æ•æ„Ÿã€‚ç›¸åŒæ•°æ®é‡å’Œç»´åº¦åœºæ™¯ä¸‹æŸ¥è¯¢è€—æ—¶åŠå¬å›ç‡è¡¨ç°ä½äºhnsw</p>
</li>
</ul>
<p>å› æ­¤ï¼Œä¸¤è€…çš„æ¨èä½¿ç”¨åœºæ™¯åˆ†åˆ«ä¸ºï¼š HNSW</p>
<ul>
<li>
<p>çº¿ä¸Šå®æ—¶æ£€ç´¢ æœç´¢ / æ¨è / RAG</p>
</li>
<li>
<p>é«˜å¬å›è¦æ±‚ Recall â‰¥ 0.9</p>
</li>
<li>
<p>å¤šç§Ÿæˆ·/é•¿æœŸè¿ç»´ç³»ç»Ÿ</p>
</li>
</ul>
<p>IVFFLAT</p>
<ul>
<li>
<p>ç¦»çº¿ / æ‰¹é‡æ£€ç´¢</p>
</li>
<li>
<p>æ£€ç´¢æˆæœ¬ä¼˜å…ˆ</p>
</li>
<li>
<p>ä½œä¸ºå¤šçº§æ£€ç´¢çš„ç¬¬ä¸€å±‚ç²—ç­›</p>
</li>
</ul>
<h2 data-id="heading-7">5 æ€»ç»“</h2>
<p>é€šè¿‡åœ¨ DWS å‘é‡è®¡ç®—æ‰©å±•èƒ½åŠ›ï¼Œæˆ‘ä»¬å°†ä¼ ç»Ÿä»¥ç»“æ„åŒ–æŸ¥è¯¢ä¸ºæ ¸å¿ƒçš„æ•°æ®åº“ç³»ç»Ÿå‡çº§ä¸ºèƒ½å¤Ÿå…·å¤‡è¯­ä¹‰ç†è§£ä¸ç›¸ä¼¼åº¦è®¡ç®—èƒ½åŠ›çš„ç»Ÿä¸€æ•°æ®åº•åº§ã€‚ç³»ç»Ÿä¸ä»…æ”¯æŒå‘é‡æ•°æ®çš„å­˜å‚¨ä¸é«˜æ•ˆç›¸ä¼¼åº¦æ£€ç´¢ï¼Œè¿˜å…è®¸ä¸šåŠ¡æ–¹ç›´æ¥é€šè¿‡æ ‡å‡† SQL å®Œæˆè¯­ä¹‰æœç´¢ã€æ¨èä¸ç›¸ä¼¼å†…å®¹åŒ¹é…ï¼Œæ— éœ€å¼•å…¥é¢å¤–çš„å‘é‡å¼•æ“æˆ–å¤æ‚çš„æ•°æ®åŒæ­¥é“¾è·¯ã€‚</p>
<p>ä¾æ‰˜ HNSWã€IVFFlat è¿‘ä¼¼æœ€è¿‘é‚»ç´¢å¼•ï¼Œå‘é‡æŸ¥è¯¢åœ¨å¤§è§„æ¨¡æ•°æ®åœºæ™¯ä¸‹ä¾ç„¶å…·å¤‡å¯æ§çš„æ€§èƒ½ä¸ç¨³å®šçš„å“åº”èƒ½åŠ›ã€‚åŒæ—¶ï¼Œå‘é‡æ£€ç´¢èƒ½åŠ›ä¸ä¼ ç»Ÿç»“æ„åŒ–æŸ¥è¯¢ã€è¿‡æ»¤æ¡ä»¶ã€JOIN é€»è¾‘çš„æ·±åº¦èåˆï¼Œä½¿å¾—æœç´¢æ¨èã€ä¸ªæ€§åŒ–åˆ†æä»¥åŠ RAG ç­‰ AI åº”ç”¨å¯ä»¥è‡ªç„¶è½åœ°åœ¨ç°æœ‰æ•°ä»“ä¸ä¸šåŠ¡ä½“ç³»ä¹‹ä¸Šã€‚</p>
<p>æœ€ç»ˆï¼Œè¿™ä¸€èƒ½åŠ›æ‰©å±•ä¸ä»…é™ä½äº†ç³»ç»Ÿæ¶æ„å¤æ‚åº¦ï¼Œä¹Ÿæ˜¾è‘—æå‡äº†æ•°æ®å¹³å°å¯¹æ–°ä¸€ä»£æ™ºèƒ½åº”ç”¨çš„æ”¯æ’‘èƒ½åŠ›ï¼Œå®ç°äº†ä»â€œæ•°æ®æŸ¥è¯¢â€å‘â€œè¯­ä¹‰è®¡ç®—ä¸ä¸šåŠ¡å†³ç­–æ”¯æŒâ€çš„æ¼”è¿›ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ArkTSåŸºç¡€è¯­æ³• |ï¼ˆ2ï¼‰å‡½æ•°]]></title>    <link>https://juejin.cn/post/7604805226696343590</link>    <guid>https://juejin.cn/post/7604805226696343590</guid>    <pubDate>2026-02-10T05:36:57.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604805226696343590" data-draft-id="7604694326519365683" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ArkTSåŸºç¡€è¯­æ³• |ï¼ˆ2ï¼‰å‡½æ•°"/> <meta itemprop="keywords" content="ArkTS"/> <meta itemprop="datePublished" content="2026-02-10T05:36:57.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Lee_xiaoming"/> <meta itemprop="url" content="https://juejin.cn/user/3775072660106464"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ArkTSåŸºç¡€è¯­æ³• |ï¼ˆ2ï¼‰å‡½æ•°
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3775072660106464/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Lee_xiaoming
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T05:36:57.000Z" title="Tue Feb 10 2026 05:36:57 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»8åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ArkTSåŸºç¡€è¯­æ³• |ï¼ˆ2ï¼‰å‡½æ•°</h2>
<p>åœ¨å­¦ä¹ HarmonyOSå¼€å‘çš„æ ¸å¿ƒè¯­è¨€ArkTSæ—¶ï¼Œæ•´ç†äº†ä¸€ä»½åŸºç¡€è¯­æ³•ç¬”è®°ï¼Œæ–¹ä¾¿æ—¥åå›é¡¾ã€‚
<br/>
<br/></p>
<p>å‡½æ•°èƒ½å¤Ÿå°è£…é‡å¤çš„ä¸šåŠ¡é€»è¾‘ï¼ˆä»£ç å—ï¼‰ï¼Œéµå¾ª<strong>å…ˆå®šä¹‰ã€åè°ƒç”¨</strong>çš„åŸºæœ¬åŸåˆ™ï¼Œå¤§å¹…æå‡ä»£ç çš„å¤ç”¨ç‡å’Œå¯ç»´æŠ¤æ€§ã€‚
<br/></p>
<h3 data-id="heading-1">ä¸€ã€å‡½æ•°å£°æ˜</h3>
<p>ArkTSä¸­å£°æ˜å‡½æ•°éœ€æ˜ç¡®<strong>å‡½æ•°åã€å‚æ•°åˆ—è¡¨ã€è¿”å›ç±»å‹ï¼ˆå¯é€‰ï¼‰å’Œå‡½æ•°ä½“</strong></p>
<ul>
<li>å£°æ˜å‡½æ•°çš„æ ¸å¿ƒè§„åˆ™ï¼š</li>
</ul>
<ol>
<li>
<p>å½¢å‚å¿…é¡»æ˜¾å¼æ ‡è®°ç±»å‹ï¼Œå®å‚çš„æ•°é‡ã€ç±»å‹éœ€ä¸å½¢å‚ä¸€ä¸€å¯¹åº”ã€‚</p>
</li>
<li>
<p>ä»…å®šä¹‰å‡½æ•°ä¸è°ƒç”¨ï¼Œå‡½æ•°ä½“ä»£ç ä¸ä¼šæ‰§è¡Œã€‚</p>
</li>
<li>
<p>æ”¯æŒæ— å‚æ— è¿”å›å€¼ã€å¸¦å‚å¸¦è¿”å›å€¼ç­‰å¤šç§å½¢å¼ã€‚</p>
</li>
<li>
<p>å¯é€šè¿‡<code>return</code>å…³é”®å­—è¿”å›å¤„ç†ç»“æœï¼Œæ— è¿”å›å€¼æ—¶å¯çœç•¥<code>return</code> ã€‚</p>
</li>
</ol>
<h5 data-id="heading-2">1. æ— å‚æ— è¿”å›å€¼å‡½æ•°</h5>
<p>æœ€åŸºç¡€çš„å‡½æ•°å½¢å¼ï¼Œæ— å‚æ•°ä¼ å…¥ï¼Œä¹Ÿæ— ç»“æœè¿”å›ï¼Œé€‚ç”¨äºæ‰§è¡Œç®€å•çš„å›ºå®šé€»è¾‘ã€‚</p>
<pre><code class="hljs language-TypeScript" lang="TypeScript"><span class="hljs-comment">// å®šä¹‰è¯­æ³•</span>
<span class="hljs-keyword">function</span> å‡½æ•°å() {
  å‡½æ•°ä½“
}
<span class="hljs-comment">// è°ƒç”¨è¯­æ³•</span>
å‡½æ•°å()

<span class="hljs-comment">// ç¤ºä¾‹</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">sayHello</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Hello ArkTS!'</span>);   <span class="hljs-comment">// æ‰§è¡Œç®€å•çš„æ‰“å°é€»è¾‘</span>
}
<span class="hljs-title function_">sayHello</span>();   <span class="hljs-comment">// è°ƒç”¨åè¾“å‡ºï¼šHello ArkTS!</span>
</code></pre>
<h5 data-id="heading-3">2. å¸¦å‚å¸¦è¿”å›å€¼å‡½æ•°</h5>
<p>é€‚ç”¨äºéœ€è¦ä¼ å…¥å‚æ•°å¹¶è¿”å›å¤„ç†ç»“æœçš„åœºæ™¯ï¼Œéœ€æŒ‡å®š<strong>å½¢å‚ç±»å‹</strong>å’Œ<strong>å‡½æ•°è¿”å›ç±»å‹</strong>ã€‚</p>
<ul>
<li>
<p><strong>å½¢å‚</strong>ï¼šå‡½æ•°å®šä¹‰æ—¶çš„å‚æ•°ï¼Œå¿…é¡»æŒ‡å®šç±»å‹ã€‚</p>
</li>
<li>
<p><strong>å®å‚</strong>ï¼šå‡½æ•°è°ƒç”¨æ—¶ä¼ å…¥çš„å‚æ•°ï¼Œéœ€ä¸å½¢å‚æ•°é‡ã€ç±»å‹ä¸¥æ ¼åŒ¹é…ã€‚</p>
</li>
<li>
<p><strong>return</strong> ï¼šç”¨äºè¿”å›å¤„ç†ç»“æœï¼Œæ‰§è¡Œåˆ°<code>return</code>åå‡½æ•°ä½“ç«‹å³ç»ˆæ­¢ã€‚</p>
</li>
</ul>
<pre><code class="hljs language-TypeScript" lang="TypeScript"><span class="hljs-comment">// ç¤ºä¾‹ï¼šå®šä¹‰æ±‚å’Œå‡½æ•°ï¼Œæ¥æ”¶ä¸¤ä¸ªnumberç±»å‹å‚æ•°ï¼Œè¿”å›numberç±»å‹ç»“æœã€‚</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">sum</span>(<span class="hljs-params">num1: <span class="hljs-built_in">number</span>, num2: <span class="hljs-built_in">number</span></span>): <span class="hljs-built_in">number</span> {
  <span class="hljs-keyword">return</span> num1 + num2;   <span class="hljs-comment">// è¿”å›ä¸¤æ•°ä¹‹å’Œ</span>
}
<span class="hljs-comment">// è°ƒç”¨å‡½æ•°ï¼Œæ¥æ”¶è¿”å›å€¼å¹¶æ‰“å°ã€‚</span>
<span class="hljs-keyword">let</span> <span class="hljs-attr">result</span>: <span class="hljs-built_in">number</span> = <span class="hljs-title function_">sum</span>(<span class="hljs-number">10</span>, <span class="hljs-number">20</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(result);   <span class="hljs-comment">// è¾“å‡ºï¼š30</span>
</code></pre>
<br/>
<h3 data-id="heading-4">äºŒã€å‡½æ•°å‚æ•°</h3>
<p>ArkTSå¯¹å‡½æ•°å‚æ•°åšäº†çµæ´»æ‰©å±•ï¼Œæ”¯æŒ<strong>å¿…é€‰å‚æ•°ã€å¯é€‰å‚æ•°ã€é»˜è®¤å€¼å‚æ•°ã€restå‚æ•°</strong>ï¼Œå…¶ä¸­å¯é€‰å‚æ•°ã€é»˜è®¤å€¼å‚æ•°ã€restå‚æ•°å‡éœ€éµå¾ªç‰¹å®šçš„è¯­æ³•è§„åˆ™ï¼Œä¸”<strong>åªèƒ½å‡ºç°åœ¨å¿…é€‰å‚æ•°ä¹‹å</strong>ã€‚</p>
<h5 data-id="heading-5">1. å¯é€‰å‚æ•°</h5>
<p>è°ƒç”¨å‡½æ•°æ—¶å¯çœç•¥çš„å‚æ•°
è¯­æ³•ï¼š<code>å‚æ•°å?: ç±»å‹</code>
çœç•¥æ—¶å‚æ•°å€¼ä¸º<code>undefined</code>ï¼Œéœ€åœ¨å‡½æ•°ä½“å†…åšåˆ¤ç©ºå¤„ç†ã€‚</p>
<ul>
<li>æ³¨æ„ï¼šå¯é€‰å‚æ•°å¿…é¡»è·Ÿåœ¨å¿…é€‰å‚æ•°åé¢ï¼Œä¸èƒ½æ”¾åœ¨å¿…é€‰å‚æ•°ä¹‹å‰ã€‚</li>
</ul>
<pre><code class="hljs language-TypeScript" lang="TypeScript"><span class="hljs-comment">// ç¤ºä¾‹</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">hello</span>(<span class="hljs-params">name?: <span class="hljs-built_in">string</span></span>) {
  <span class="hljs-keyword">if</span> (name == <span class="hljs-literal">undefined</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Hello!'</span>);   <span class="hljs-comment">// çœç•¥å‚æ•°æ—¶æ‰§è¡Œ</span>
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`Hello, <span class="hljs-subst">${name}</span>!`</span>);   <span class="hljs-comment">// ä¼ å…¥å‚æ•°æ—¶æ‰§è¡Œ</span>
  }
}
<span class="hljs-title function_">hello</span>();   <span class="hljs-comment">// çœç•¥å‚æ•° è¾“å‡ºï¼šHello!</span>
<span class="hljs-title function_">hello</span>(<span class="hljs-string">'ArkTS'</span>);   <span class="hljs-comment">// ä¼ å…¥å‚æ•° è¾“å‡ºï¼šHello, ArkTS!</span>
</code></pre>
<h5 data-id="heading-6">2. é»˜è®¤å€¼å‚æ•°</h5>
<p>å¯é€‰å‚æ•°çš„å¦ä¸€ç§å½¢å¼ï¼Œä¸ºå‚æ•°è®¾ç½®é»˜è®¤å€¼ï¼Œè°ƒç”¨æ—¶è‹¥çœç•¥è¯¥å‚æ•°ï¼Œä¼šè‡ªåŠ¨ä½¿ç”¨é»˜è®¤å€¼ä½œä¸ºå®å‚.
è¯­æ³•:<code>å‚æ•°å: ç±»å‹ = é»˜è®¤å€¼</code></p>
<ul>
<li>æ³¨æ„ï¼šé»˜è®¤å€¼å‚æ•°ä¹Ÿéœ€è·Ÿåœ¨å¿…é€‰å‚æ•°ä¹‹åï¼Œè‹¥è°ƒç”¨æ—¶ä¼ å…¥æ–°å€¼ï¼Œä¼šè¦†ç›–é»˜è®¤å€¼ã€‚</li>
</ul>
<pre><code class="hljs language-TypeScript" lang="TypeScript"><span class="hljs-comment">// ç¤ºä¾‹ï¼šå®šä¹‰ä¹˜æ³•å‡½æ•°ï¼Œç³»æ•°coeffè®¾ç½®é»˜è®¤å€¼2ã€‚</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">multiply</span>(<span class="hljs-params">n: <span class="hljs-built_in">number</span>, coeff: <span class="hljs-built_in">number</span> = <span class="hljs-number">2</span></span>): <span class="hljs-built_in">number</span> {
  <span class="hljs-keyword">return</span> n * coeff;
}
<span class="hljs-title function_">multiply</span>(<span class="hljs-number">2</span>);   <span class="hljs-comment">// çœç•¥coeffï¼Œä½¿ç”¨é»˜è®¤å€¼2ï¼Œè¿”å›ï¼š4ã€‚</span>
<span class="hljs-title function_">multiply</span>(<span class="hljs-number">2</span>, <span class="hljs-number">3</span>);   <span class="hljs-comment">// ä¼ å…¥coeff=3ï¼Œè¦†ç›–é»˜è®¤å€¼ï¼Œè¿”å›ï¼š6ã€‚</span>
</code></pre>
<h5 data-id="heading-7">3. restå‚æ•°</h5>
<p>ç”¨äºå¤„ç†<strong>ä¸å®šæ•°é‡çš„å‚æ•°è¾“å…¥</strong>ï¼Œå…è®¸å‡½æ•°æ¥æ”¶ä¸€ä¸ªä¸å®šé•¿çš„æ•°ç»„ã€‚
è¯­æ³•<code>...restå‚æ•°å: ç±»å‹[]</code>
æ ¸å¿ƒè§„åˆ™ï¼š</p>
<ol>
<li>restå‚æ•°<strong>åªèƒ½æ˜¯å‡½æ•°çš„æœ€åä¸€ä¸ªå‚æ•°</strong></li>
<li>restå‚æ•°çš„ç±»å‹å¿…é¡»æ˜¯<strong>æ•°ç»„ç±»å‹</strong></li>
<li>è°ƒç”¨æ—¶å¯ä¼ å…¥0ä¸ªã€1ä¸ªæˆ–å¤šä¸ªåŒç±»å‹å‚æ•°ï¼Œå‡ä¼šè¢«å°è£…ä¸ºæ•°ç»„ã€‚</li>
</ol>
<pre><code class="hljs language-TypeScript" lang="TypeScript"><span class="hljs-comment">// ç¤ºä¾‹ï¼šå®šä¹‰æ±‚å’Œå‡½æ•°ï¼Œæ”¯æŒä¼ å…¥ä»»æ„å¤šä¸ªnumberç±»å‹å‚æ•°.</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">sum</span>(<span class="hljs-params">...numbers: <span class="hljs-built_in">number</span>[]</span>): <span class="hljs-built_in">number</span> {
  <span class="hljs-keyword">let</span> res = <span class="hljs-number">0</span>;
  <span class="hljs-comment">// éå†restå‚æ•°æ•°ç»„ï¼Œç´¯åŠ æ±‚å’Œ</span>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> n <span class="hljs-keyword">of</span> numbers) {
    res += n;
  }
  <span class="hljs-keyword">return</span> res;
}
<span class="hljs-title function_">sum</span>();   <span class="hljs-comment">// ä¼ å…¥0ä¸ªå‚æ•° è¿”å›ï¼š0</span>
<span class="hljs-title function_">sum</span>(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>);   <span class="hljs-comment">// ä¼ å…¥3ä¸ªå‚æ•° è¿”å›ï¼š6</span>
<span class="hljs-title function_">sum</span>(<span class="hljs-number">10</span>, <span class="hljs-number">20</span>, <span class="hljs-number">30</span>, <span class="hljs-number">40</span>);   <span class="hljs-comment">// ä¼ å…¥4ä¸ªå‚æ•° è¿”å›ï¼š100</span>
</code></pre>
<br/>
<h3 data-id="heading-8">ä¸‰ã€å‡½æ•°è¿”å›ç±»å‹</h3>
<p>ArkTSä¸­å‡½æ•°çš„è¿”å›ç±»å‹æ”¯æŒ<strong>æ˜¾å¼æŒ‡å®š</strong>å’Œ<strong>è‡ªåŠ¨æ¨æ–­</strong>ï¼Œæ— è¿”å›å€¼æ—¶å¯æŒ‡å®šä¸º<code>void</code>ç±»å‹.
æ ¸å¿ƒè§„åˆ™ï¼š</p>
<ol>
<li>è‹¥å‡½æ•°ä½“çš„è¿”å›ç»“æœå¯è¢«ç¼–è¯‘å™¨æ¨æ–­ï¼Œå¯çœç•¥è¿”å›ç±»å‹æ ‡æ³¨ã€‚</li>
<li>æ— è¿”å›å€¼çš„å‡½æ•°ï¼Œå¯æ˜¾å¼æŒ‡å®š<code>void</code>æˆ–çœç•¥è¿”å›ç±»å‹ã€‚</li>
<li>æ˜¾å¼æŒ‡å®šè¿”å›ç±»å‹åï¼Œå‡½æ•°è¿”å›çš„ç»“æœå¿…é¡»ä¸è¯¥ç±»å‹åŒ¹é…ï¼Œå¦åˆ™ç¼–è¯‘æŠ¥é”™ã€‚</li>
</ol>
<h5 data-id="heading-9">1. æ˜¾å¼æŒ‡å®šè¿”å›ç±»å‹</h5>
<p>é€‚ç”¨äºéœ€è¦æ˜ç¡®å‡½æ•°è¿”å›å€¼ç±»å‹çš„åœºæ™¯ï¼Œæå‡ä»£ç çš„å¯è¯»æ€§å’Œè§„èŒƒæ€§ã€‚</p>
<pre><code class="hljs language-TypeScript" lang="TypeScript"><span class="hljs-comment">// æ˜¾å¼æŒ‡å®šè¿”å›stringç±»å‹</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">foo</span>(<span class="hljs-params"/>): <span class="hljs-built_in">string</span> { 
  <span class="hljs-keyword">return</span> <span class="hljs-string">'foo'</span>; 
}
<span class="hljs-comment">// æ˜¾å¼æŒ‡å®šè¿”å›numberç±»å‹</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">getNum</span>(<span class="hljs-params"/>): <span class="hljs-built_in">number</span> {
  <span class="hljs-keyword">return</span> <span class="hljs-number">100</span>;
}
</code></pre>
<h5 data-id="heading-10">2. è‡ªåŠ¨æ¨æ–­è¿”å›ç±»å‹</h5>
<p>ç¼–è¯‘å™¨å¯æ ¹æ®å‡½æ•°ä½“çš„<code>return</code>è¯­å¥è‡ªåŠ¨æ¨æ–­è¿”å›ç±»å‹ï¼Œå¯çœç•¥è¿”å›ç±»å‹æ ‡æ³¨ï¼Œç®€åŒ–ä»£ç ã€‚</p>
<pre><code class="hljs language-TypeScript" lang="TypeScript"><span class="hljs-comment">// è‡ªåŠ¨æ¨æ–­è¿”å›ç±»å‹ä¸ºstring</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">goo</span>(<span class="hljs-params"/>) { 
  <span class="hljs-keyword">return</span> <span class="hljs-string">'goo'</span>; 
}
<span class="hljs-comment">// è‡ªåŠ¨æ¨æ–­è¿”å›ç±»å‹ä¸ºboolean</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">isTrue</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> <span class="hljs-number">1</span> &gt; <span class="hljs-number">0</span>;
}
</code></pre>
<h5 data-id="heading-11">3. æ— è¿”å›å€¼ï¼ˆvoidç±»å‹ï¼‰</h5>
<p>è¡¨ç¤ºå‡½æ•°æ— ä»»ä½•è¿”å›ç»“æœï¼Œå³ä½¿å†™<code>return</code>ä¹Ÿä¸èƒ½æºå¸¦å€¼ï¼Œä¸¤ç§å£°æ˜æ–¹å¼å‡å¯ï¼Œæ•ˆæœä¸€è‡´ã€‚</p>
<pre><code class="hljs language-TypeScript" lang="TypeScript"><span class="hljs-comment">// æ–¹å¼1ï¼šçœç•¥è¿”å›ç±»å‹æ ‡æ³¨ï¼ˆç®€æ´å†™æ³•ï¼‰</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">hi1</span>(<span class="hljs-params"/>) { 
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'hi'</span>); 
}

<span class="hljs-comment">// æ–¹å¼2ï¼šæ˜¾å¼æŒ‡å®švoidç±»å‹ï¼ˆè§„èŒƒå†™æ³•ï¼‰</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">hi2</span>(<span class="hljs-params"/>): <span class="hljs-built_in">void</span> { 
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'hi'</span>); 
  <span class="hljs-comment">// æ— è¿”å›å€¼çš„å‡½æ•°å¯å†™ç©ºreturnï¼Œä¸å¯å†™return 123ï¼ˆç¼–è¯‘æŠ¥é”™ï¼‰ã€‚</span>
  <span class="hljs-keyword">return</span>;
}
</code></pre>
<h5 data-id="heading-12">4. æ‹“å±•ï¼šneverç±»å‹</h5>
<p>è¡¨ç¤ºå‡½æ•°<strong>æ°¸è¿œä¸ä¼šæ‰§è¡Œå®Œæˆ</strong>ï¼ˆå¦‚å‡½æ•°å†…æŠ›å‡ºå¼‚å¸¸ã€æ— é™å¾ªç¯ï¼‰ï¼Œæ˜¯æ¯”<code>void</code>æ›´ä¸¥æ ¼çš„è¿”å›ç±»å‹ï¼ŒåŸºç¡€å¼€å‘ä¸­ä½¿ç”¨è¾ƒå°‘ï¼Œåšç®€å•äº†è§£å³å¯ã€‚</p>
<pre><code class="hljs language-TypeScript" lang="TypeScript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">errorFunc</span>(<span class="hljs-params"/>): <span class="hljs-built_in">never</span> {
  <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'ç¨‹åºæ‰§è¡Œå¼‚å¸¸'</span>);
}
</code></pre>
<br/>
<h3 data-id="heading-13">å››ã€å‡½æ•°çš„ä½œç”¨åŸŸ</h3>
<p>ArkTSä¸­å‡½æ•°éµå¾ª<strong>å—çº§ä½œç”¨åŸŸ</strong>è§„åˆ™ï¼Œå‡½æ•°å†…å®šä¹‰çš„å˜é‡/å®ä¾‹ä¸º<strong>å±€éƒ¨å˜é‡</strong>ï¼Œå‡½æ•°å¤–å®šä¹‰çš„ä¸º<strong>å…¨å±€å˜é‡</strong>ã€‚
æ ¸å¿ƒè§„åˆ™ï¼š</p>
<ol>
<li>å±€éƒ¨å˜é‡ä»…èƒ½åœ¨å‡½æ•°å†…éƒ¨è®¿é—®ï¼Œå¤–éƒ¨æ— æ³•è®¿é—®ã€‚</li>
<li>è‹¥å‡½æ•°å†…çš„å±€éƒ¨å˜é‡ä¸å…¨å±€å˜é‡åŒåï¼Œ<strong>å±€éƒ¨å˜é‡ä¼šè¦†ç›–å…¨å±€å˜é‡</strong>ï¼ˆå‡½æ•°å†…ä¼˜å…ˆä½¿ç”¨å±€éƒ¨å˜é‡ï¼‰ã€‚</li>
<li>å‡½æ•°å†…å®šä¹‰å˜é‡æ—¶ï¼Œå¿…é¡»ä½¿ç”¨<code>let/const</code>ï¼Œå¦åˆ™ä¼šè¢«æå‡ä¸ºå…¨å±€å˜é‡ã€‚</li>
</ol>
<pre><code class="hljs language-TypeScript" lang="TypeScript"><span class="hljs-comment">// å®šä¹‰å…¨å±€å˜é‡</span>
<span class="hljs-keyword">let</span> outerVar = <span class="hljs-string">'I am outer '</span>;
<span class="hljs-keyword">function</span> <span class="hljs-title function_">func</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// å®šä¹‰åŒåå±€éƒ¨å˜é‡ï¼Œè¦†ç›–å…¨å±€å˜é‡ã€‚</span>
    <span class="hljs-keyword">let</span> outerVar = <span class="hljs-string">'I am inside'</span>;
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(outerVar);   <span class="hljs-comment">// è¾“å‡ºï¼šI am insideï¼ˆä½¿ç”¨å±€éƒ¨å˜é‡ï¼‰</span>
}
<span class="hljs-title function_">func</span>();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(outerVar);   <span class="hljs-comment">// è¾“å‡ºï¼šI am outerï¼ˆå…¨å±€å˜é‡æœªè¢«ä¿®æ”¹ï¼‰</span>

<span class="hljs-comment">// æ˜“é”™ç‚¹ï¼šå‡½æ•°å†…æœªç”¨let/constå®šä¹‰çš„å˜é‡ï¼Œä¼šæˆä¸ºå…¨å±€å˜é‡ã€‚</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">badFunc</span>(<span class="hljs-params"/>) {
  testVar = <span class="hljs-string">'å…¨å±€å˜é‡'</span>;   <span class="hljs-comment">// æœªç”¨let/constï¼Œæå‡ä¸ºå…¨å±€å˜é‡</span>
}
<span class="hljs-title function_">badFunc</span>();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(testVar);   <span class="hljs-comment">// è¾“å‡ºï¼šå…¨å±€å˜é‡</span>
</code></pre>
<br/>
<h3 data-id="heading-14">äº”ã€å‡½æ•°çš„è°ƒç”¨</h3>
<p>å‡½æ•°å®šä¹‰åï¼Œéœ€é€šè¿‡ <code>å‡½æ•°å(å®å‚)</code> çš„æ–¹å¼è°ƒç”¨ï¼Œæ‰èƒ½æ‰§è¡Œå‡½æ•°ä½“ä»£ç ã€‚
æ ¸å¿ƒè§„åˆ™ï¼š</p>
<ol>
<li>å®å‚çš„æ•°é‡ã€ç±»å‹éœ€ä¸å½¢å‚ä¸¥æ ¼åŒ¹é…ï¼ˆå¯é€‰å‚æ•°ã€restå‚æ•°é™¤å¤–ï¼‰ã€‚</li>
<li>å‡½æ•°è°ƒç”¨æ—¶ï¼Œå®å‚ä¼šæŒ‰é¡ºåºèµ‹å€¼ç»™å½¢å‚ã€‚</li>
<li>å¸¦è¿”å›å€¼çš„å‡½æ•°ï¼Œè°ƒç”¨æ—¶å¯é€šè¿‡å˜é‡æ¥æ”¶è¿”å›ç»“æœï¼Œä¹Ÿå¯ç›´æ¥è°ƒç”¨ï¼ˆå¿½ç•¥è¿”å›ç»“æœï¼‰ã€‚</li>
</ol>
<pre><code class="hljs language-TypeScript" lang="TypeScript"><span class="hljs-comment">// å®šä¹‰å‡½æ•°ï¼šæ‹¼æ¥ä¸¤ä¸ªå­—ç¬¦ä¸²</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">join</span>(<span class="hljs-params">x: <span class="hljs-built_in">string</span>, y: <span class="hljs-built_in">string</span></span>): <span class="hljs-built_in">string</span> {
  <span class="hljs-keyword">let</span> <span class="hljs-attr">z</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">`<span class="hljs-subst">${x}</span> <span class="hljs-subst">${y}</span>`</span>;
  <span class="hljs-keyword">return</span> z;
}

<span class="hljs-comment">// æ–¹å¼1ï¼šæ¥æ”¶è¿”å›å€¼ï¼ˆæ¨èï¼‰</span>
<span class="hljs-keyword">let</span> res = <span class="hljs-title function_">join</span>(<span class="hljs-string">'hello'</span>, <span class="hljs-string">'world'</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(res);   <span class="hljs-comment">// è¾“å‡º: hello world</span>

<span class="hljs-comment">// æ–¹å¼2ï¼šç›´æ¥è°ƒç”¨ï¼Œå¿½ç•¥è¿”å›ç»“æœã€‚</span>
<span class="hljs-title function_">join</span>(<span class="hljs-string">'Hi'</span>, <span class="hljs-string">'ArkTS'</span>);
</code></pre>
<h5 data-id="heading-15">æ‹“å±•ï¼šå‚æ•°çš„ä¼ é€’æ–¹å¼</h5>
<p>ArkTSä¸­å‚æ•°ä¼ é€’åˆ†ä¸º<strong>å€¼ä¼ é€’</strong>å’Œ<strong>å¼•ç”¨ä¼ é€’</strong>ï¼Œå–å†³äºå‚æ•°çš„ç±»å‹ã€‚</p>
<ul>
<li><strong>å€¼ä¼ é€’</strong>ï¼šé€‚ç”¨äº<strong>åŸºæœ¬ç±»å‹</strong>ï¼ˆnumberã€stringã€booleanã€undefinedã€nullï¼‰ï¼Œä¼ é€’çš„æ˜¯å˜é‡çš„å‰¯æœ¬ï¼Œå‡½æ•°å†…ä¿®æ”¹å‰¯æœ¬ä¸ä¼šå½±å“åŸå˜é‡ã€‚</li>
<li><strong>å¼•ç”¨ä¼ é€’</strong>ï¼šé€‚ç”¨äº<strong>å¼•ç”¨ç±»å‹</strong>ï¼ˆå¯¹è±¡ã€æ•°ç»„ï¼‰ï¼Œä¼ é€’çš„æ˜¯å˜é‡çš„å†…å­˜åœ°å€ï¼Œå‡½æ•°å†…ä¿®æ”¹å¯¹è±¡/æ•°ç»„çš„å±æ€§ï¼Œä¼šå½±å“åŸå˜é‡ã€‚</li>
</ul>
<pre><code class="hljs language-TypeScript" lang="TypeScript"><span class="hljs-comment">// å€¼ä¼ é€’ï¼ˆåŸºæœ¬ç±»å‹ï¼‰</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">changeNum</span>(<span class="hljs-params">num: <span class="hljs-built_in">number</span></span>) {
  num = <span class="hljs-number">100</span>;
}
<span class="hljs-keyword">let</span> a = <span class="hljs-number">10</span>;
<span class="hljs-title function_">changeNum</span>(a);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(a);   <span class="hljs-comment">// è¾“å‡ºï¼š10ï¼ˆåŸå˜é‡æœªè¢«ä¿®æ”¹ï¼‰</span>

<span class="hljs-comment">// å¼•ç”¨ä¼ é€’ï¼ˆå¼•ç”¨ç±»å‹ï¼‰</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">changeObj</span>(<span class="hljs-params">obj: {name: <span class="hljs-built_in">string</span>}</span>) {
  obj.<span class="hljs-property">name</span> = <span class="hljs-string">'ArkTS'</span>;
}
<span class="hljs-keyword">let</span> person = {<span class="hljs-attr">name</span>: <span class="hljs-string">'é¸¿è’™'</span>};
<span class="hljs-title function_">changeObj</span>(person);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(person.<span class="hljs-property">name</span>);   <span class="hljs-comment">// è¾“å‡ºï¼šArkTSï¼ˆåŸå¯¹è±¡è¢«ä¿®æ”¹ï¼‰</span>
</code></pre>
<br/>
<h3 data-id="heading-16">å…­ã€å‡½æ•°ç±»å‹</h3>
<p>ArkTSä¸­å‡½æ•°ä¹Ÿæ˜¯ä¸€ç§æ•°æ®ç±»å‹ï¼Œå¯é€šè¿‡<code>type</code>å…³é”®å­—å®šä¹‰<strong>å‡½æ•°ç±»å‹</strong>ï¼Œç”¨äºçº¦æŸå‡½æ•°çš„<strong>å‚æ•°åˆ—è¡¨</strong>å’Œ<strong>è¿”å›ç±»å‹</strong>ï¼Œ<strong>æœ€å¸¸ç”¨çš„åœºæ™¯æ˜¯å®šä¹‰å›è°ƒå‡½æ•°</strong>ï¼Œè®©ä»£ç çš„ç±»å‹çº¦æŸæ›´ä¸¥æ ¼ã€‚</p>
<h6 data-id="heading-17">å‡½æ•°ç±»å‹çš„å®šä¹‰è¯­æ³•</h6>
<pre><code class="hljs language-TypeScript" lang="TypeScript"><span class="hljs-keyword">type</span> å‡½æ•°ç±»å‹å = <span class="hljs-function">(<span class="hljs-params">å‚æ•°<span class="hljs-number">1</span>: ç±»å‹<span class="hljs-number">1</span>, å‚æ•°<span class="hljs-number">2</span>: ç±»å‹<span class="hljs-number">2</span>, ...</span>) =&gt;</span> è¿”å›ç±»å‹;   <span class="hljs-comment">// è¯­æ³•æ ¼å¼</span>
</code></pre>
<h6 data-id="heading-18">ç¤ºä¾‹ï¼šå®šä¹‰å›è°ƒå‡½æ•°</h6>
<pre><code class="hljs language-TypeScript" lang="TypeScript"><span class="hljs-comment">// å®šä¹‰å‡½æ•°ç±»å‹ï¼šæ¥æ”¶2ä¸ªnumberç±»å‹å‚æ•°ï¼Œè¿”å›numberç±»å‹ç»“æœã€‚</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">AddFunc</span> = <span class="hljs-function">(<span class="hljs-params">a: <span class="hljs-built_in">number</span>, b: <span class="hljs-built_in">number</span></span>) =&gt;</span> <span class="hljs-built_in">number</span>;

<span class="hljs-comment">// å®šä¹‰å‡½æ•°ï¼Œå‚æ•°æ˜¯AddFuncç±»å‹çš„å›è°ƒå‡½æ•°ã€‚</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">calculate</span>(<span class="hljs-params">a: <span class="hljs-built_in">number</span>, b: <span class="hljs-built_in">number</span>, back: AddFunc</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">back</span>(a, b);   <span class="hljs-comment">// è°ƒç”¨å›è°ƒå‡½æ•° ä¼ å…¥aå’Œb</span>
}

<span class="hljs-comment">// ä¼ å…¥ç¬¦åˆAddFuncç±»å‹çš„å‡½æ•°ä½œä¸ºå®å‚ï¼ˆæ±‚å’Œï¼‰</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">add</span> = (<span class="hljs-params">x: <span class="hljs-built_in">number</span>, y: <span class="hljs-built_in">number</span></span>) =&gt; x + y;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">calculate</span>(<span class="hljs-number">2</span>, <span class="hljs-number">3</span>, add));   <span class="hljs-comment">// è¾“å‡ºï¼š5ï¼ˆç¬¦åˆè§„çŸ© æ­£å¸¸æ‰§è¡Œï¼‰</span>

<span class="hljs-comment">// è‹¥ä¼ ä¸ç¬¦åˆè§„çŸ©çš„å‡½æ•°ï¼ˆæ¯”å¦‚è¿”å›stringï¼‰ï¼Œç¼–è¯‘ç›´æ¥æŠ¥é”™ï¼ˆè¿™å°±æ˜¯å‡½æ•°ç±»å‹çš„ä½œç”¨ï¼ï¼‰ã€‚</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">badAdd</span> = (<span class="hljs-params">x: <span class="hljs-built_in">number</span>, y: <span class="hljs-built_in">number</span></span>) =&gt; <span class="hljs-string">'${x+y}'</span>;
<span class="hljs-title function_">calculate</span>(<span class="hljs-number">2</span>,<span class="hljs-number">3</span>, badAdd);   <span class="hljs-comment">// æŠ¥é”™ï¼šè¿”å›ç±»å‹stringä¸ç¬¦åˆAddFuncçš„numberç±»å‹</span>
</code></pre>
<h6 data-id="heading-19">å‡½æ•°ç±»å‹çš„èµ‹å€¼</h6>
<p>å®šä¹‰å‡½æ•°ç±»å‹åï¼Œå¯å°†ç¬¦åˆè¯¥ç±»å‹çš„å‡½æ•°èµ‹å€¼ç»™å˜é‡ï¼Œçº¦æŸå˜é‡çš„å‡½æ•°å½¢æ€ã€‚</p>
<pre><code class="hljs language-TypeScript" lang="TypeScript"><span class="hljs-comment">// å®šä¹‰å‡½æ•°ç±»å‹</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">AddFunc</span> = <span class="hljs-function">(<span class="hljs-params">a: <span class="hljs-built_in">number</span>, b: <span class="hljs-built_in">number</span></span>) =&gt;</span> <span class="hljs-built_in">number</span>;

<span class="hljs-comment">// å®šä¹‰ç¬¦åˆè¯¥ç±»å‹çš„å‡½æ•°</span>
<span class="hljs-keyword">let</span> <span class="hljs-attr">add</span>: <span class="hljs-title class_">AddFunc</span> = <span class="hljs-function">(<span class="hljs-params">x, y</span>) =&gt;</span> x + y;

<span class="hljs-comment">// è°ƒç”¨</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">add</span>(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>));   <span class="hljs-comment">// è¾“å‡ºï¼š3</span>
</code></pre>
<br/>
<h3 data-id="heading-20">ä¸ƒã€ç®­å¤´å‡½æ•°ï¼ˆLambdaå‡½æ•°ï¼‰</h3>
<p>ç®­å¤´å‡½æ•°æ˜¯<strong>æ™®é€šå‡½æ•°çš„ç®€æ´å†™æ³•</strong>ï¼Œè¯­æ³•æ›´ç²¾ç‚¼ã€ä»£ç æ›´ç®€æ´ï¼Œé€‚åˆç¼–å†™çŸ­å°çš„å‡½æ•°é€»è¾‘ï¼Œä¹Ÿæ˜¯é¸¿è’™å¼€å‘ä¸­é«˜é¢‘ä½¿ç”¨çš„å†™æ³•ã€‚</p>
<ul>
<li>æ ¸å¿ƒç‰¹ç‚¹ï¼š<strong>æ— è‡ªå·±çš„this</strong>ï¼ˆç»§æ‰¿å¤–å±‚ä½œç”¨åŸŸçš„thisï¼‰</li>
</ul>
<h5 data-id="heading-21">1. åŸºæœ¬è¯­æ³•</h5>
<pre><code class="hljs language-TypeScript" lang="TypeScript"><span class="hljs-comment">// å®Œæ•´è¯­æ³•</span>
<span class="hljs-keyword">let</span> å‡½æ•°å = <span class="hljs-function">(<span class="hljs-params">å½¢å‚<span class="hljs-number">1</span>: ç±»å‹<span class="hljs-number">1</span>, å½¢å‚<span class="hljs-number">2</span>: ç±»å‹<span class="hljs-number">2</span></span>) =&gt;</span> {
  å‡½æ•°ä½“;
  <span class="hljs-keyword">return</span> ç»“æœ;
}
</code></pre>
<p>ç®€å†™è§„åˆ™ï¼š</p>
<ol>
<li>å•è¡¨è¾¾å¼å‡½æ•°ä½“ï¼Œå¯çœç•¥å¤§æ‹¬å·<code>{}</code>å’Œ<code>return</code> ã€‚</li>
<li>å•ä¸ªå½¢å‚ï¼Œå¯çœç•¥å°æ‹¬å·<code>()</code> ã€‚</li>
<li>æ— å‚æˆ–å¤šä¸ªå½¢å‚ï¼Œå¿…é¡»ä¿ç•™å°æ‹¬å·<code>()</code> ã€‚</li>
<li>è¿”å›ç±»å‹å¯çœç•¥ï¼Œç”±ç¼–è¯‘å™¨è‡ªåŠ¨æ¨æ–­ã€‚</li>
</ol>
<h5 data-id="heading-22">2. å¸¸è§ä½¿ç”¨å½¢å¼</h5>
<h6 data-id="heading-23">ï¼ˆ1ï¼‰æ— å‚ç®­å¤´å‡½æ•°</h6>
<pre><code class="hljs language-TypeScript" lang="TypeScript"><span class="hljs-comment">// å®Œæ•´å†™æ³•</span>
<span class="hljs-keyword">let</span> <span class="hljs-title function_">sayHi</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Hi, ç®­å¤´å‡½æ•°'</span>);
};
<span class="hljs-comment">// è°ƒç”¨</span>
<span class="hljs-title function_">sayHi</span>();   <span class="hljs-comment">// è¾“å‡ºï¼šHi,ç®­å¤´å‡½æ•°</span>

<span class="hljs-comment">// æ— å‚+å•è¡¨è¾¾å¼ï¼ˆè‹¥æœ‰è¿”å›å€¼ï¼‰</span>
<span class="hljs-keyword">let</span> <span class="hljs-title function_">getStr</span> = (<span class="hljs-params"/>) =&gt; <span class="hljs-string">'Hello Arrow Function'</span>;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">getStr</span>());   <span class="hljs-comment">// è¾“å‡ºï¼šHello Arrow Function</span>
</code></pre>
<h6 data-id="heading-24">ï¼ˆ2ï¼‰å¸¦å‚ç®­å¤´å‡½æ•°</h6>
<pre><code class="hljs language-TypeScript" lang="TypeScript"><span class="hljs-comment">// å¤šä¸ªå½¢å‚å®Œæ•´å†™æ³•</span>
<span class="hljs-keyword">let</span> multiply = (<span class="hljs-attr">num1</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">num2</span>: <span class="hljs-built_in">number</span>): <span class="hljs-function"><span class="hljs-params">number</span> =&gt;</span> {
  <span class="hljs-keyword">return</span> num1 * num2;
};
<span class="hljs-keyword">let</span> res = <span class="hljs-title function_">multiply</span>(<span class="hljs-number">5</span>, <span class="hljs-number">6</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(res);   <span class="hljs-comment">// è¾“å‡ºï¼š30</span>

<span class="hljs-comment">// å•ä¸ªå½¢å‚ç®€å†™ï¼ˆçœç•¥å°æ‹¬å·ã€å¤§æ‹¬å·ã€returnï¼‰</span>
<span class="hljs-keyword">let</span> <span class="hljs-title function_">double</span> = (<span class="hljs-params">n: <span class="hljs-built_in">number</span></span>) =&gt; n * <span class="hljs-number">2</span>;   <span class="hljs-comment">// æ ‡å‡†ç®€å†™ï¼ˆæ¨èå†™æ³•ï¼‰</span>
<span class="hljs-keyword">let</span> <span class="hljs-title function_">double2</span> = n =&gt; n * <span class="hljs-number">2</span>;   <span class="hljs-comment">// ä¸æ¨èå†™æ³•</span>

<span class="hljs-comment">// å¤šä¸ªå½¢å‚ å•è¡¨è¾¾å¼ ç®€å†™</span>
<span class="hljs-keyword">let</span> <span class="hljs-title function_">sum</span> = (<span class="hljs-params">a: <span class="hljs-built_in">number</span>, b: <span class="hljs-built_in">number</span></span>) =&gt; a + b;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">sum</span>(<span class="hljs-number">3</span>,<span class="hljs-number">4</span>));   <span class="hljs-comment">// è¾“å‡ºï¼š7</span>
</code></pre>
<h5 data-id="heading-25">3. ç®­å¤´å‡½æ•°çš„æ ¸å¿ƒç‰¹æ€§</h5>
<p>ç®­å¤´å‡½æ•°çš„æ ¸å¿ƒå·®å¼‚æ˜¯<strong>æ— è‡ªèº«çš„this</strong>ï¼Œé¸¿è’™å¼€å‘ä¸­åœ¨ç»„ä»¶ç”Ÿå‘½å‘¨æœŸã€äº‹ä»¶å›è°ƒä¸­ä½¿ç”¨æ—¶éœ€ç‰¹åˆ«æ³¨æ„ï¼š</p>
<ol>
<li>ç®­å¤´å‡½æ•°çš„ <code>this</code> <strong>ç»§æ‰¿è‡ªå¤–å±‚ä½œç”¨åŸŸ</strong>ï¼Œä¸ä¼šéšè°ƒç”¨æ–¹å¼æ”¹å˜ã€‚ï¼ˆå¤–å±‚æ— ç›®æ ‡å±æ€§åˆ™è¾“å‡ºundefinedï¼‰</li>
<li>æ™®é€šå‡½æ•°çš„ <code>this</code> <strong>æŒ‡å‘è°ƒç”¨è€…</strong>ï¼Œè°ƒç”¨æ–¹å¼ä¸åŒï¼Œ<code>this</code> æŒ‡å‘ä¸åŒã€‚ï¼ˆè°ƒç”¨è€…æ— ç›®æ ‡å±æ€§ä¹Ÿå¯èƒ½è¾“å‡ºundefinedï¼‰</li>
<li>ç®­å¤´å‡½æ•°ä¸èƒ½ä½œä¸ºæ„é€ å‡½æ•°ï¼Œä¸èƒ½ä½¿ç”¨<code>new</code>å…³é”®å­—è°ƒç”¨ã€‚</li>
</ol>
<pre><code class="hljs language-TypeScript" lang="TypeScript"><span class="hljs-comment">// ç¤ºä¾‹ï¼šç®­å¤´å‡½æ•°ç»§æ‰¿å¤–å±‚this</span>
<span class="hljs-keyword">let</span> obj = {
  <span class="hljs-attr">name</span>: <span class="hljs-string">'ArkTS'</span>,
  <span class="hljs-attr">fn1</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// æ™®é€šå‡½æ•°ï¼šthisæŒ‡å‘obj</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>);
  },
  <span class="hljs-attr">fn2</span>: <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-comment">// ç®­å¤´å‡½æ•°ï¼šthisç»§æ‰¿å¤–å±‚ï¼ˆå…¨å±€ä½œç”¨åŸŸï¼‰ï¼ˆæ— nameå±æ€§ï¼‰</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>);
  }
};
obj.<span class="hljs-title function_">fn1</span>();   <span class="hljs-comment">// è°ƒç”¨æ™®é€šå‡½æ•°fn1  è¾“å‡ºï¼šArkTS</span>
obj.<span class="hljs-title function_">fn2</span>();   <span class="hljs-comment">// è°ƒç”¨ç®­å¤´å‡½æ•°fn2  è¾“å‡ºï¼šundefined</span>
</code></pre>
<br/>
<h3 data-id="heading-26">å…«ã€é—­åŒ…</h3>
<p>é—­åŒ…æ˜¯ç”±<strong>å‡½æ•°</strong>å’Œ<strong>å£°æ˜è¯¥å‡½æ•°çš„ç¯å¢ƒ</strong>ç»„åˆè€Œæˆçš„æ•´ä½“ï¼Œè¯¥ç¯å¢ƒåŒ…å«äº†é—­åŒ…åˆ›å»ºæ—¶ä½œç”¨åŸŸå†…çš„æ‰€æœ‰å±€éƒ¨å˜é‡ã€‚</p>
<ul>
<li>æ ¸å¿ƒç‰¹æ€§ï¼š<strong>é—­åŒ…å¯ä»¥è®¿é—®å¹¶ä¿ç•™å¤–å±‚å‡½æ•°çš„å±€éƒ¨å˜é‡ï¼Œå³ä½¿å¤–å±‚å‡½æ•°æ‰§è¡Œå®Œæ¯•ï¼Œå±€éƒ¨å˜é‡ä¹Ÿä¸ä¼šè¢«é”€æ¯</strong>ã€‚</li>
</ul>
<h5 data-id="heading-27">1. é—­åŒ…çš„å®æ“ç¤ºä¾‹</h5>
<pre><code class="hljs language-TypeScript" lang="TypeScript"><span class="hljs-comment">// å¤–å±‚å‡½æ•°f</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">f</span>(<span class="hljs-params"/>): <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">number</span> {
  <span class="hljs-keyword">let</span> count = <span class="hljs-number">0</span>;   <span class="hljs-comment">// å¤–å±‚å‡½æ•°çš„å±€éƒ¨å˜é‡</span>
  <span class="hljs-comment">// å†…å±‚ç®­å¤´å‡½æ•°g å½¢æˆé—­åŒ…</span>
  <span class="hljs-keyword">let</span> g = (): <span class="hljs-function"><span class="hljs-params">number</span> =&gt;</span> { 
    count++;   <span class="hljs-comment">// è®¿é—®å¤–å±‚å‡½æ•°çš„å±€éƒ¨å˜é‡count</span>
    <span class="hljs-keyword">return</span> count; 
  };
  <span class="hljs-keyword">return</span> g;   <span class="hljs-comment">// è¿”å›å†…å±‚å‡½æ•°g</span>
}

<span class="hljs-keyword">let</span> z = <span class="hljs-title function_">f</span>();   <span class="hljs-comment">// å¤–å±‚å‡½æ•°æ‰§è¡Œå®Œæ¯• è¿”å›å†…å±‚å‡½æ•°g</span>
<span class="hljs-comment">// å¤šæ¬¡è°ƒç”¨z é—­åŒ…ä¿ç•™countçš„çŠ¶æ€ æŒç»­é€’å¢</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">z</span>());   <span class="hljs-comment">// è¿”å›ï¼š1</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">z</span>());   <span class="hljs-comment">// è¿”å›ï¼š2</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">z</span>());   <span class="hljs-comment">// è¿”å›ï¼š3</span>
</code></pre>
<h5 data-id="heading-28">2. é—­åŒ…çš„ä½¿ç”¨åœºæ™¯</h5>
<ol>
<li><strong>å°è£…ç§æœ‰å˜é‡</strong>ï¼šéšè—å†…éƒ¨å˜é‡ï¼Œä»…é€šè¿‡é—­åŒ…æš´éœ²æ“ä½œæ–¹æ³•ï¼Œé¿å…å…¨å±€å˜é‡æ±¡æŸ“ã€‚</li>
<li><strong>ä¿ç•™å‡½æ•°æ‰§è¡ŒçŠ¶æ€</strong>ï¼šå¦‚é—­åŒ…å®æ“ç¤ºä¾‹ä¸­çš„è®¡æ•°å™¨ï¼Œå¤šæ¬¡è°ƒç”¨å¯ä¿ç•™ä¸Šä¸€æ¬¡çš„æ‰§è¡Œç»“æœã€‚</li>
<li><strong>é¸¿è’™å¼€å‘ä¸­</strong>ï¼šç»„ä»¶äº‹ä»¶å›è°ƒã€å®šæ—¶å™¨ä¸­ä¿ç•™ä¸Šä¸‹æ–‡çŠ¶æ€ã€‚</li>
</ol>
<h5 data-id="heading-29">3. é—­åŒ…çš„æ³¨æ„äº‹é¡¹</h5>
<p>é—­åŒ…ä¼šä¿ç•™å¤–å±‚å‡½æ•°çš„å˜é‡ï¼Œå¯¼è‡´<strong>å˜é‡ä¸ä¼šè¢«åƒåœ¾å›æ”¶</strong>ï¼Œè‹¥è¿‡åº¦ä½¿ç”¨æˆ–ä¸å½“ä½¿ç”¨ï¼Œä¼šé€ æˆ<strong>å†…å­˜æ³„æ¼</strong>ã€‚
æ³¨æ„äº‹é¡¹ï¼š</p>
<ol>
<li>é¿å…åœ¨å¾ªç¯ä¸­åˆ›å»ºé—­åŒ…ã€‚</li>
<li>ä¸éœ€è¦ä½¿ç”¨é—­åŒ…æ—¶ï¼ŒåŠæ—¶è§£é™¤å¼•ç”¨ï¼ˆå¦‚å°†é—­åŒ…å˜é‡èµ‹å€¼ä¸º<code>null</code>ï¼‰ã€‚</li>
</ol>
<h5 data-id="heading-30">4. é—­åŒ…å°è£…ç§æœ‰å˜é‡ç¤ºä¾‹</h5>
<pre><code class="hljs language-TypeScript" lang="TypeScript"><span class="hljs-comment">// å°è£…è®¡æ•°å™¨ ä»…æš´éœ²å¢/å‡æ–¹æ³• éšè—countå˜é‡</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">createCounter</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">let</span> count = <span class="hljs-number">0</span>;   <span class="hljs-comment">// ç§æœ‰å˜é‡ å¤–éƒ¨æ— æ³•è®¿é—®</span>
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">add</span>: <span class="hljs-function">() =&gt;</span> count++,   <span class="hljs-comment">// é—­åŒ…ï¼šå¢åŠ è®¡æ•°</span>
    <span class="hljs-attr">sub</span>: <span class="hljs-function">() =&gt;</span> count--,   <span class="hljs-comment">// é—­åŒ…ï¼šå‡å°‘è®¡æ•°</span>
    <span class="hljs-attr">get</span>: <span class="hljs-function">() =&gt;</span> count      <span class="hljs-comment">// é—­åŒ…ï¼šè·å–è®¡æ•°</span>
  };
}

<span class="hljs-keyword">let</span> counter = <span class="hljs-title function_">createCounter</span>();
counter.<span class="hljs-title function_">add</span>();
counter.<span class="hljs-title function_">add</span>();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(counter.<span class="hljs-title function_">get</span>());   <span class="hljs-comment">// è¾“å‡ºï¼š2</span>
counter.<span class="hljs-title function_">sub</span>();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(counter.<span class="hljs-title function_">get</span>());   <span class="hljs-comment">// è¾“å‡ºï¼š1</span>
<span class="hljs-comment">// å¤–éƒ¨æ— æ³•ç›´æ¥ä¿®æ”¹count é¿å…å˜é‡æ±¡æŸ“</span>
</code></pre>
<br/>
<h3 data-id="heading-31">ä¹ã€å‡½æ•°é‡è½½</h3>
<p>å‡½æ•°é‡è½½æŒ‡<strong>ä¸ºåŒä¸€ä¸ªå‡½æ•°å®šä¹‰å¤šä¸ªä¸åŒçš„ç­¾åï¼ˆå‚æ•°åˆ—è¡¨/è¿”å›ç±»å‹ä¸åŒï¼‰</strong>ï¼Œè®©åŒä¸€ä¸ªå‡½æ•°æ”¯æŒå¤šç§è°ƒç”¨æ–¹å¼ã€‚
åœ¨ArkTSä¸­ç¼–è¯‘å™¨ä¼šæ ¹æ®<strong>å®å‚çš„ç±»å‹/æ•°é‡</strong>ï¼ŒåŒ¹é…å¯¹åº”çš„é‡è½½ç­¾åæ‰§è¡Œã€‚</p>
<h5 data-id="heading-32">1. å‡½æ•°é‡è½½çš„è¯­æ³•è§„åˆ™</h5>
<ol>
<li>å…ˆç¼–å†™<strong>å¤šä¸ªé‡è½½å£°æ˜</strong>ï¼ˆåŒåã€ä¸åŒç­¾åã€æ— å‡½æ•°ä½“ï¼‰</li>
<li>æœ€åç¼–å†™<strong>ä¸€ä¸ªå‡½æ•°å®ç°</strong>ï¼ˆå¿…é¡»åŒ…å«æ‰€æœ‰é‡è½½å£°æ˜çš„å‚æ•°/è¿”å›ç±»å‹ï¼Œç”¨è”åˆç±»å‹è¡¨ç¤ºï¼‰ã€‚</li>
<li>é‡è½½å£°æ˜çš„å‚æ•°åˆ—è¡¨ä¸èƒ½ç›¸åŒï¼Œå¦åˆ™ç¼–è¯‘æŠ¥é”™ã€‚</li>
<li>å‡½æ•°å®ç°çš„å‚æ•°ç±»å‹éœ€<strong>è¦†ç›–æ‰€æœ‰é‡è½½å£°æ˜çš„å‚æ•°ç±»å‹</strong>ï¼Œè¿”å›ç±»å‹ä¹Ÿéœ€åŒ¹é…ã€‚</li>
</ol>
<h5 data-id="heading-33">2. å‡½æ•°é‡è½½çš„å®æ“ç¤ºä¾‹</h5>
<pre><code class="hljs language-TypeScript" lang="TypeScript"><span class="hljs-comment">// é‡è½½å£°æ˜1ï¼šæ¥æ”¶ä¸€ä¸ªnumberç±»å‹å‚æ•° æ— è¿”å›å€¼</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">foo</span>(<span class="hljs-params">x: <span class="hljs-built_in">number</span></span>): <span class="hljs-built_in">void</span>;

<span class="hljs-comment">// é‡è½½å£°æ˜2ï¼šæ¥æ”¶ä¸€ä¸ªstringç±»å‹å‚æ•° æ— è¿”å›å€¼</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">foo</span>(<span class="hljs-params">x: <span class="hljs-built_in">string</span></span>): <span class="hljs-built_in">void</span>;

<span class="hljs-comment">// å‡½æ•°å®ç°ï¼šå‚æ•°ç±»å‹ä¸º â€œ number | string â€  è¦†ç›–æ‰€æœ‰é‡è½½å£°æ˜</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">foo</span>(<span class="hljs-params">x: <span class="hljs-built_in">number</span> | <span class="hljs-built_in">string</span></span>): <span class="hljs-built_in">void</span> {
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> x === <span class="hljs-string">'number'</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'æ•°å­—ç±»å‹ï¼š'</span>, x);
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'å­—ç¬¦ä¸²ç±»å‹ï¼š'</span>, x);
  }
}

<span class="hljs-comment">// è°ƒç”¨ï¼šç¼–è¯‘å™¨è‡ªåŠ¨åŒ¹é…å¯¹åº”çš„é‡è½½å£°æ˜</span>
<span class="hljs-title function_">foo</span>(<span class="hljs-number">123</span>);    <span class="hljs-comment">// åŒ¹é…é‡è½½1  è¾“å‡ºï¼š æ•°å­—ç±»å‹ï¼š 123</span>
<span class="hljs-title function_">foo</span>(<span class="hljs-string">'aa'</span>);   <span class="hljs-comment">// åŒ¹é…é‡è½½2  è¾“å‡ºï¼š å­—ç¬¦ä¸²ç±»å‹ï¼š aa</span>
</code></pre>
<h5 data-id="heading-34">3. å¸¦è¿”å›å€¼çš„å‡½æ•°é‡è½½ç¤ºä¾‹</h5>
<pre><code class="hljs language-TypeScript" lang="TypeScript"><span class="hljs-comment">// é‡è½½å£°æ˜1ï¼šä¸¤ä¸ªnumberå‚æ•° è¿”å›number</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">calc</span>(<span class="hljs-params">a: <span class="hljs-built_in">number</span>, b: <span class="hljs-built_in">number</span></span>): <span class="hljs-built_in">number</span>;

<span class="hljs-comment">// é‡è½½å£°æ˜2ï¼šä¸¤ä¸ªstringå‚æ•° è¿”å›string</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">calc</span>(<span class="hljs-params">a: <span class="hljs-built_in">string</span>, b: <span class="hljs-built_in">string</span></span>): <span class="hljs-built_in">string</span>;

<span class="hljs-comment">// å‡½æ•°å®ç°</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">calc</span>(<span class="hljs-params">a: <span class="hljs-built_in">number</span> | <span class="hljs-built_in">string</span>, b: <span class="hljs-built_in">number</span> | <span class="hljs-built_in">string</span></span>): <span class="hljs-built_in">number</span> | <span class="hljs-built_in">string</span> {
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> a === <span class="hljs-string">'number'</span> &amp;&amp; <span class="hljs-keyword">typeof</span> b === <span class="hljs-string">'number'</span>) {
    <span class="hljs-keyword">return</span> a + b;
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-string">`<span class="hljs-subst">${a}</span><span class="hljs-subst">${b}</span>`</span>;
  }
}

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">calc</span>(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>));   <span class="hljs-comment">// è¾“å‡ºï¼š3</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">calc</span>(<span class="hljs-string">'a'</span>,<span class="hljs-string">'b'</span>));   <span class="hljs-comment">// è¾“å‡ºï¼šab</span>
</code></pre>
<h5 data-id="heading-35">4. å‡½æ•°é‡è½½çš„æ³¨æ„äº‹é¡¹</h5>
<ol>
<li>å‡½æ•°é‡è½½<strong>ä»…åœ¨ç¼–è¯‘é˜¶æ®µç”Ÿæ•ˆ</strong>ï¼Œç”¨äºåšç±»å‹æ ¡éªŒï¼Œè¿è¡Œæ—¶åªæœ‰ä¸€ä¸ªå‡½æ•°å®ç°ã€‚</li>
<li>ä¸èƒ½åªæœ‰é‡è½½å£°æ˜è€Œæ— å‡½æ•°å®ç°ï¼Œå¦åˆ™ç¼–è¯‘æŠ¥é”™ã€‚</li>
<li>é¸¿è’™å¼€å‘ä¸­ï¼Œå‡½æ•°é‡è½½å¸¸ç”¨äºå°è£…é€šç”¨æ–¹æ³•ï¼Œè®©æ–¹æ³•æ”¯æŒå¤šç§å‚æ•°ç±»å‹ï¼Œæå‡ä»£ç çš„çµæ´»æ€§ã€‚</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[SCALE ä¸€æœˆæ¦œå•å‘å¸ƒï¼šå›½äº§å¤§æ¨¡å‹åœ¨ AI4DB é¢†åŸŸä¸Šçš„æ°´å¹³å¦‚ä½•ï¼Ÿ]]></title>    <link>https://juejin.cn/post/7604786493639753755</link>    <guid>https://juejin.cn/post/7604786493639753755</guid>    <pubDate>2026-02-10T05:41:31.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604786493639753755" data-draft-id="7604791354257834022" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="SCALE ä¸€æœˆæ¦œå•å‘å¸ƒï¼šå›½äº§å¤§æ¨¡å‹åœ¨ AI4DB é¢†åŸŸä¸Šçš„æ°´å¹³å¦‚ä½•ï¼Ÿ"/> <meta itemprop="keywords" content="æ•°æ®åº“"/> <meta itemprop="datePublished" content="2026-02-10T05:41:31.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="çˆ±å¯ç”Ÿå¼€æºç¤¾åŒº"/> <meta itemprop="url" content="https://juejin.cn/user/1480387593251847"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            SCALE ä¸€æœˆæ¦œå•å‘å¸ƒï¼šå›½äº§å¤§æ¨¡å‹åœ¨ AI4DB é¢†åŸŸä¸Šçš„æ°´å¹³å¦‚ä½•ï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1480387593251847/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    çˆ±å¯ç”Ÿå¼€æºç¤¾åŒº
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T05:41:31.000Z" title="Tue Feb 10 2026 05:41:31 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»11åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä¸€ã€ æœ¬æœˆæ¦œå•æ‘˜è¦</h2>
<p>2026 å¹´ä¼Šå§‹ï¼Œ<a href="https://link.juejin.cn?target=https%3A%2F%2Fsql-llm-leaderboard.com%2Franking%2F2026-01" title="https://sql-llm-leaderboard.com/ranking/2026-01" target="_blank" ref="nofollow noopener noreferrer">SCALE</a> è¯„æµ‹æ¡†æ¶è¿æ¥äº†é‡è¦è¿›åŒ–ã€‚æœ¬æœˆï¼Œæˆ‘ä»¬ä¸ä»…è¿æ¥äº† <em>æ™ºè°± GLM-4.7</em> ä¸ <em>å­—èŠ‚è·³åŠ¨ Seed-OSS-36B-Instruct</em> çš„å…¥åœºï¼Œæ›´åœ¨è¯„æµ‹æ·±åº¦ä¸Šå®ç°äº†çªç ´ â€”â€” åœ¨ <strong>SQL ä¼˜åŒ–</strong> ç»´åº¦ä¸­æ­£å¼å¼•å…¥ <strong>â€œç´¢å¼•å»ºè®®â€</strong> æŒ‡æ ‡ã€‚</p>
<p><em>è¿™æ„å‘³ç€ SQL ä¼˜åŒ–èƒ½åŠ›çš„æµ‹è¯„æ ‡å‡†å·²ä»å•ä¸€çš„</em>*â€œè¯­æ³•å±‚é¢çš„æ”¹å†™ â€œè¿ˆå‘äº†â€ <strong>è¯­æ³•ä¼˜åŒ– + æ‰§è¡Œæˆæœ¬ä¼˜åŒ–â€</strong> çš„ç»¼åˆè¯„ä¼°ï¼Œæ›´ä½“ç°äº†æ¨¡å‹æ˜¯å¦çœŸæ­£ç«™åœ¨æ•°æ®åº“æ‰§è¡Œä¸èµ„æºæ¶ˆè€—çš„è§’åº¦æ€è€ƒé—®é¢˜ï¼Œèƒ½å¦ç»™å‡ºå…·å¤‡å®é™…æ€§èƒ½æ”¶ç›Šã€ç¬¦åˆçœŸå®ç”Ÿäº§åœºæ™¯çš„ä¼˜åŒ–å»ºè®®ã€‚*</p>
<h2 data-id="heading-1">äºŒã€ è¯„æµ‹åŸºå‡†ä½“ç³»å‡çº§</h2>
<p>SCALE è‡´åŠ›äºé€šè¿‡å¤šç»´åº¦çš„å‹åŠ›æµ‹è¯•ï¼Œé‡åŒ–å¤§è¯­è¨€æ¨¡å‹åœ¨ä¸“ä¸šæ•°æ®åº“ä»»åŠ¡ä¸­çš„çœŸå®ä»·å€¼ã€‚æˆ‘ä»¬ä¸¥æ ¼éµå¾ª SCALE æ¡†æ¶è‡ªåˆ›ç«‹ä»¥æ¥çš„ä¸‰å¤§æ ¸å¿ƒç»´åº¦å’Œç»Ÿä¸€è¯„æµ‹æ•°æ®é›†ï¼Œç¡®ä¿ç»“æœçš„å…¬æ­£æ€§ä¸å¯å¤ç°æ€§ã€‚</p>
<h3 data-id="heading-2">SCALE ä¸‰å¤§è¯„æµ‹ç»´åº¦</h3>

























<table><thead><tr><th>è¯„æµ‹ç»´åº¦</th><th>è¯„ä¼°ç›®æ ‡</th><th>æ ¸å¿ƒåº”ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td><strong>SQL ç†è§£</strong></td><td>å¯¹ç°æœ‰ SQL ä»£ç çš„é€»è¾‘ã€æ„å›¾å’Œæ‰§è¡Œè®¡åˆ’çš„æ·±åº¦åˆ†æèƒ½åŠ›ã€‚</td><td>æ•°æ®åˆ†æã€ç”Ÿäº§ç¯å¢ƒæ•…éšœæ’æŸ¥ã€ä»£ç å®¡æŸ¥ã€‚</td></tr><tr><td><strong>SQL ä¼˜åŒ–</strong></td><td>åœ¨ä¿è¯é€»è¾‘ç­‰ä»·ä¸‹ï¼Œå°†ä½æ•ˆ SQL æ”¹å†™ä¸ºæ€§èƒ½æ›´ä¼˜æŸ¥è¯¢çš„ç­–ç•¥åº”ç”¨å’Œæ•ˆæœã€‚</td><td>æ•°æ®åº“è°ƒä¼˜ã€å­˜é‡ä»£ç é‡æ„ã€‚</td></tr><tr><td><strong>æ–¹è¨€è½¬æ¢</strong></td><td>åœ¨ä¸åŒæ•°æ®åº“æ–¹è¨€ä¹‹é—´è¿›è¡Œè¯­æ³•è¿ç§»å’Œå¤æ‚è¿‡ç¨‹åŒ–é€»è¾‘é‡æ„çš„å‡†ç¡®æ€§å’Œå¯é æ€§ã€‚</td><td>æ•°æ®åº“è¿ç§»ã€è·¨å¹³å°æ•°æ®ä¸­å°æ„å»ºã€‚</td></tr></tbody></table>
<h3 data-id="heading-3">æœ¬æœˆæ–°å¢æŒ‡æ ‡ï¼šç´¢å¼•å»ºè®®</h3>
<p>åœ¨æ—¥å¸¸ <strong>SQL ä¼˜åŒ–</strong> æ—¶ï¼Œ<strong>ç´¢å¼•ä¼˜åŒ–éå¸¸é‡è¦çš„ä¸€ä¸ªæ‰‹æ®µ</strong>ï¼Œç´¢å¼•èƒ½è®©æ•°æ®åº“å°½é‡å°‘è¯»æ•°æ®ã€å°‘åšè®¡ç®—ï¼Œä»è€Œç”¨æ›´ä½çš„æˆæœ¬æ›´å¿«åœ°è¿”å›ç»“æœã€‚ä¸ºæ­¤æˆ‘ä»¬åœ¨ <strong>SQL ä¼˜åŒ–</strong> ç»´åº¦æ–°å¢äº†å¯¹ <strong>ç´¢å¼•å»ºè®®</strong> çš„æµ‹è¯„ã€‚</p>
<ul>
<li><strong>è¯„æµ‹å®šä½</strong>ï¼šç´¢å¼•ä¼˜åŒ–æ˜¯ SQL æ€§èƒ½æå‡çš„æ ¸å¿ƒã€‚è¯¥æŒ‡æ ‡æ£€éªŒæ¨¡å‹èƒ½å¦ç»™å‡ºå¯è½åœ°ã€æ€§ä»·æ¯”åˆç†ã€é£é™©å¯æ§çš„ä¼˜åŒ–æ–¹æ¡ˆï¼Œè€Œéä»…åœç•™åœ¨è¯­æ³•å±‚é¢çš„æ”¹å†™ã€‚</li>
<li><strong>æŒ‡æ ‡æ’å</strong>ï¼šæ ¹æ®æœ€æ–°æµ‹è¯„ç»“æœï¼Œå„ä¸»æµæ¨¡å‹åœ¨ç´¢å¼•å»ºè®®æµ‹è¯„çš„è¡¨ç°å¦‚ä¸‹ï¼š</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d13aa63450744223acbfd33d71e58ecf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5Y-v55Sf5byA5rqQ56S-5Yy6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771306894&amp;x-signature=YaB%2Bif6vTSY2miMA7LjaIcX6Xp8%3D" alt="scale-1.png" loading="lazy"/></p>
<h2 data-id="heading-4">ä¸‰ã€ä¸“é¡¹æµ‹è¯„ï¼šæ™ºè°± GLM-4.7</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fz.ai%2Fblog%2Fglm-4.7" title="https://z.ai/blog/glm-4.7" target="_blank" ref="nofollow noopener noreferrer">GLM-4.7</a> æ˜¯æ™ºè°± AI äº 2025 å¹´ 12 æœˆ 23 æ—¥å‘å¸ƒå¹¶å¼€æºçš„å¤§è¯­è¨€æ¨¡å‹ï¼Œè¯¥æ¨¡å‹é’ˆå¯¹ç¼–ç åœºæ™¯åœ¨ç›¸å…³èƒ½åŠ›æ–¹é¢è¿›è¡Œäº†å¼ºåŒ–ã€‚æ¨¡å‹å‘å¸ƒåï¼Œæ›¾åœ¨å¼€æºç¤¾åŒº <a href="https://link.juejin.cn?target=https%3A%2F%2Fhuggingface.co%2Fzai-org%2FGLM-4.7" title="https://huggingface.co/zai-org/GLM-4.7" target="_blank" ref="nofollow noopener noreferrer">Hugging Face</a> çš„å…¨çƒè¶‹åŠ¿æ¦œä¸Šä½åˆ—æ¦œé¦–ã€‚2026 å¹´ 1 æœˆ 8 æ—¥ï¼Œæ™ºè°± AI åœ¨æ¸¯äº¤æ‰€æŒ‚ç‰Œä¸Šå¸‚ã€‚ï¼ˆä¿¡æ¯æ¥æºï¼šç™¾åº¦ç™¾ç§‘ï¼‰</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a4b40faf35dd4b58ba127e1cc8dbd1f4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5Y-v55Sf5byA5rqQ56S-5Yy6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771306894&amp;x-signature=k1myyred9Fi8Zap%2BL62qejjDATU%3D" alt="glm-1.png" loading="lazy"/></p>
<h3 data-id="heading-5">1. èƒ½åŠ›å®šä½åˆ¤æ–­</h3>
<p><strong>æ™ºè°± GLM-4.7 åœ¨æœ¬æ¬¡æµ‹è¯„ä¸­è¡¨ç°å‡ºæé«˜çš„é€»è¾‘ä¸¥è°¨æ€§ä¸åœºæ™¯é€‚åº”æ€§ã€‚</strong></p>
<p>å®ƒä¸ä»…ä»…æ˜¯ä¸€ä¸ª SQL ç”Ÿæˆå™¨ï¼Œæ›´åƒæ˜¯ä¸€ä¸ªå…·å¤‡åˆæ­¥å·¥ç¨‹æ€ç»´çš„ <strong>â€œåˆçº§ DBAâ€</strong>ï¼Œåœ¨å¤„ç†å¤æ‚ä¸šåŠ¡é€»è¾‘ä¸å›½äº§åŒ–è¿ç§»æ—¶å±•ç°äº†ç¬¬ä¸€æ¢¯é˜Ÿçš„ç¨³å®šæ€§ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d790ab2e5165447dbd1fbfad94a33700~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5Y-v55Sf5byA5rqQ56S-5Yy6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771306894&amp;x-signature=HgFMcxJ%2FgA%2B2jjM5%2BAhUC49c8sM%3D" alt="glm-2.png" loading="lazy"/></p>
<h3 data-id="heading-6">2. æ ¸å¿ƒç»´åº¦åˆ†æ</h3>
<h4 data-id="heading-7">SQL ç†è§£ï¼š79.8 åˆ†</h4>
<p>**<em>GLM-4.7</em> è¡¨ç°å‡ºè¾ƒå¼ºçš„é€»è¾‘ä¸€è‡´æ€§ã€‚**å…¶æ‰§è¡Œå‡†ç¡®æ€§ï¼ˆ82.9ï¼‰ä¸è¯­æ³•é”™è¯¯æ£€æµ‹ï¼ˆ82.9ï¼‰å¾—åˆ†è¾ƒé«˜ï¼Œæ„å‘³ç€æ¨¡å‹èƒ½å¤Ÿå‡†ç¡®ç†è§£å¤æ‚çš„ä¸šåŠ¡æ„å›¾ã€‚</p>
<p>åœ¨æ‰§è¡Œè®¡åˆ’æ£€æµ‹ä¸­ï¼Œæµ‹è¯•æ¡ˆä¾‹é€šè¿‡ç‡ç›¸å¯¹è¾ƒä½ï¼Œä»…æœ‰ 55%ï¼Œæ¨¡å‹å¯¹åŒ…å« <code>LEFT JOIN</code>ã€<code>GROUP BY</code> å’Œ <code>ORDER BY</code> çš„å¤æ‚æŸ¥è¯¢ï¼Œé”™è¯¯åœ°è¾“å‡ºäº†è¿æ¥ç¼“å†²å’ŒåµŒå¥—å¾ªç¯ï¼ˆ<code>Using join buffer (Block Nested Loop)</code>ï¼‰ï¼Œå´é—æ¼äº†å…³é”®çš„ä¸´æ—¶è¡¨å’Œæ–‡ä»¶æ’åºæ ‡è¯†ï¼ˆ<code>Using temporary; Using filesort</code>ï¼‰ï¼Œä¸”è¡Œæ•°ä¼°ç®—é”™è¯¯ï¼Œæš´éœ²å‡ºå…¶å¯¹èšåˆæ’åºæ“ä½œçš„æ‰§è¡Œæœºåˆ¶ç†è§£ä¸è¶³ï¼Œä»¥åŠåœ¨å¤šè¡¨å…³è”åœºæ™¯ä¸‹å¯¹é©±åŠ¨è¡¨å’Œæ‰§è¡Œæ­¥éª¤çš„æ¨ç†èƒ½åŠ›æ¬ ç¼ºã€‚</p>
<h4 data-id="heading-8">SQL ä¼˜åŒ–ï¼š59.6 åˆ†</h4>
<p>åœ¨æ–°å¢çš„ç´¢å¼•å»ºè®®æŒ‡æ ‡ä¸­ï¼Œæ¨¡å‹å–å¾—äº† 58.1 åˆ†çš„æˆç»©ã€‚æ•´ä½“æ¥çœ‹ï¼Œæ¨¡å‹å·²èƒ½å¤Ÿç»“åˆæŸ¥è¯¢æ¡ä»¶ç»™å‡ºç¬¦åˆç´¢å¼•è®¾è®¡åŸºæœ¬åŸç†çš„ä¼˜åŒ–å»ºè®®ï¼Œ<strong>åˆæ­¥å…·å¤‡äº†åŸºäºæ‰§è¡Œè®¡åˆ’è¿›è¡Œåˆ†æå¹¶æå‡ºç‰©ç†ç»“æ„ä¼˜åŒ–æ–¹æ¡ˆçš„èƒ½åŠ›ã€‚</strong></p>
<p>åœ¨æ›´å¤æ‚çš„åœºæ™¯ä¸‹ï¼Œå°¤å…¶æ˜¯æ¶‰åŠç´¢å¼•å†—ä½™åˆ¤æ–­ä»¥åŠä½é€‰æ‹©æ€§åˆ—ä¸ç´¢å¼•ç»´æŠ¤æˆæœ¬ä¹‹é—´æƒè¡¡çš„é—®é¢˜æ—¶ï¼Œæ¨¡å‹çš„è¡¨ç°ä»ä¸ç¨³å®šï¼Œéš¾ä»¥æŒç»­ç»™å‡ºæœ‰æ•ˆä¸”åˆç†çš„ç´¢å¼•å»ºè®®ã€‚</p>
<h4 data-id="heading-9">æ–¹è¨€è½¬æ¢ï¼š68.2 åˆ†</h4>
<p><strong>å›½äº§æ•°æ®åº“è½¬æ¢å¾—åˆ†é«˜è¾¾ 89.5 åˆ†ï¼Œè¿™æ˜¯ GLM-4.7 çš„ä¼ ç»Ÿå¼ºé¡¹ï¼Œè¡¨ç°å‡ºè¾ƒé«˜çš„æˆç†Ÿåº¦ã€‚</strong></p>
<p>ä½†æ˜¯åœ¨è¯­æ³•æ­£ç¡®æ€§æ£€æµ‹æµ‹è¯„ä¸Šå¾—åˆ†ä¸º 50 åˆ†ï¼Œå¤„äºè¾ƒä½æ°´å¹³ï¼Œåæ˜ å‡ºæ¨¡å‹åœ¨ç»†ç²’åº¦æ–¹è¨€çŸ¥è¯†æŒæ¡ä¸Šçš„æ˜¾è‘—ä¸è¶³ï¼Œç‰¹åˆ«æ˜¯å¯¹ç‰¹å®šæ•°æ®åº“ç‰ˆæœ¬ï¼ˆå¦‚ OceanBase 4.2.5ã€GaussDB-v2.0_3.xï¼‰çš„è¯­æ³•çº¦æŸã€æ•°æ®ç±»å‹æ”¯æŒèŒƒå›´ç¼ºä¹å‡†ç¡®è®¤çŸ¥ã€‚</p>
<h3 data-id="heading-10">3. åº”ç”¨ä»·å€¼å»ºè®®</h3>
<ul>
<li><strong>æ¨èåœºæ™¯</strong>ï¼šé€‚ç”¨äºä¼ä¸šçº§é—ç•™ç³»ç»Ÿé‡æ„ã€å¤æ‚ä¸šåŠ¡ SQL å¼€å‘è¾…åŠ©ã€æ•°æ®åº“å›½äº§åŒ–è¿ç§»ä¸“é¡¹ã€‚</li>
<li><strong>å®æˆ˜å»ºè®®</strong>ï¼šå¯ç”¨äºç”Ÿæˆè¿ç§»è„šæœ¬çš„å‚è€ƒåˆç¨¿ï¼Œä½†åœ¨ç´¢å¼•å»ºè®®æ–¹é¢ï¼Œå»ºè®®ä½œä¸º DBA å®¡æŸ¥çš„â€œç¬¬ä¸€é“å‚è€ƒâ€ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²å‰ä»éœ€é…åˆ Explain Plan è¿›è¡Œå¾®è°ƒã€‚</li>
</ul>
<h2 data-id="heading-11">å››ã€ä¸“é¡¹æµ‹è¯„ï¼šå­—èŠ‚ Seed-OSS-36B</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fhuggingface.co%2FByteDance-Seed%2FSeed-OSS-36B-Base" title="https://huggingface.co/ByteDance-Seed/Seed-OSS-36B-Base" target="_blank" ref="nofollow noopener noreferrer">Seed-OSS-36B</a> æ˜¯ç”±å­—èŠ‚è·³åŠ¨æ——ä¸‹ Seed å›¢é˜Ÿäº 2025 å¹´ 8 æœˆ 21 æ—¥ åœ¨ Hugging Face å¹³å°å‘å¸ƒçš„å¼€æºå¤§å‹è¯­è¨€æ¨¡å‹ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a4cb776487504771af58c331299030b0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5Y-v55Sf5byA5rqQ56S-5Yy6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771306894&amp;x-signature=RNMMmrQU%2F%2B%2FbXD6rjjfaVJ4plmI%3D" alt="seed-1.png" loading="lazy"/></p>
<p>è¯¥æ¨¡å‹é‡‡ç”¨å› æœè¯­è¨€å»ºæ¨¡ã€åˆ†ç»„æŸ¥è¯¢æ³¨æ„åŠ›å’Œ RoPE ä½ç½®ç¼–ç ç­‰æŠ€æœ¯ï¼ŒåŒ…å« 360 äº¿å‚æ•°å¹¶æ”¯æŒ 15.5 ä¸‡è¯è¡¨è§„æ¨¡ã€‚é€šè¿‡ 64 å±‚ç½‘ç»œç»“æ„å®ç° 512k tokens çš„é•¿ä¸Šä¸‹æ–‡å¤„ç†èƒ½åŠ›ï¼Œé€‚ç”¨äºæ–‡æ¡£åˆ†æã€æ¨ç†é“¾ã€Agent äº¤äº’åŠé€šç”¨åœºæ™¯ã€‚ï¼ˆä¿¡æ¯æ¥æºï¼šç™¾åº¦ç™¾ç§‘ï¼‰</p>
<h3 data-id="heading-12">1. èƒ½åŠ›å®šä½åˆ¤æ–­</h3>
<p><em>å­—èŠ‚ Seed-OSS-36B</em> æ˜¯ä¸€ä¸ªæ€§æ ¼é²œæ˜çš„æ¨¡å‹ï¼š<strong>åœ¨æ ‡å‡†è§„èŒƒæ€§ä¸Šè¾¾åˆ°äº†æé«˜æ°´å‡†ï¼Œä½†åœ¨é•¿æ–‡æœ¬å¤„ç†ä¸æ·±å±‚æ‰§è¡Œæ¨ç†ä¸Šä»æœ‰å¾…çªç ´ã€‚</strong> å®ƒéå¸¸é€‚åˆä½œä¸ºä»£ç è§„èŒƒçš„**â€œå®ˆé—¨å‘˜â€**ï¼Œä½†åœ¨é¢å¯¹é‡åº¦å¤æ‚çš„å·¥ä¸šçº§ä»»åŠ¡æ—¶è¡¨ç°å‡ºä¸€å®šçš„æ³¢åŠ¨ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bb76f64e9deb45a49c055d6c808f7711~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5Y-v55Sf5byA5rqQ56S-5Yy6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771306894&amp;x-signature=3wVwHyEB%2FWgp4c8X1EEsL5PS2SA%3D" alt="seed-2.png" loading="lazy"/></p>
<h3 data-id="heading-13">2. æ ¸å¿ƒç»´åº¦åˆ†æ</h3>
<h4 data-id="heading-14">SQL ç†è§£ï¼š55.2 åˆ†</h4>
<p><em>å­—èŠ‚ Seed-OSS-36B</em> å±•ç°äº†**â€œåç§‘â€** çš„ç‰¹æ€§ã€‚å…¶è¯­æ³•æ£€æµ‹å¾—åˆ†é«˜è¾¾ 88.6ï¼Œèƒ½å¤Ÿè¯†åˆ«å‡ºæå…¶éšè”½çš„æ–¹è¨€å†²çªå’Œæ‹¼å†™é”™è¯¯ï¼›ä½†æ‰§è¡Œå‡†ç¡®æ€§ï¼ˆ48.6ï¼‰åä½ï¼Œæ¨¡å‹åœ¨åˆ†æ <code>SELECT</code> æŸ¥è¯¢æ—¶ï¼Œè™½ç„¶æ­£ç¡®è®¡ç®—å‡ºäº†æŸ¥è¯¢ç»“æœï¼ˆåˆ—åå’Œæ•°æ®è¡Œå‡å‡†ç¡®ï¼‰ï¼Œä½†å°† <code>result_type</code> é”™è¯¯æ ‡è¯†ä¸º <code>table_state</code> è€Œé <code>select</code>ï¼Œæ··æ·†äº†æŸ¥è¯¢æ“ä½œ <code>SELECT</code> ä¸è¡¨çŠ¶æ€ä¿®æ”¹æ“ä½œ <code>INSERT/UPDATE/DELETE</code> çš„è¯­ä¹‰åˆ†ç±»ï¼Œåæ˜ å‡ºå…¶å¯¹ SQL è¯­å¥ç±»å‹çš„ç†è§£å’Œåˆ†ç±»èƒ½åŠ›å­˜åœ¨ç¼ºé™·ï¼Œä»¥åŠåœ¨ç»“æ„åŒ–è¾“å‡ºçš„è¯­ä¹‰ä¸€è‡´æ€§æŠŠæ§ä¸Šä¸å¤Ÿä¸¥è°¨ã€‚</p>
<h4 data-id="heading-15">SQL ä¼˜åŒ–ï¼š55.3 åˆ†</h4>
<p>å…¶ä¼˜åŒ–ç­–ç•¥ç›¸å¯¹ä¿å®ˆã€‚ç´¢å¼•å»ºè®®ï¼ˆ53.8 åˆ†ï¼‰å¤šé›†ä¸­åœ¨å•è¡¨ç®€å•ç´¢å¼•ï¼Œæ¨¡å‹æš´éœ²å‡ºä¸‰ä¸ªæ ¸å…³é”®é—®é¢˜ï¼šæ¨èç´¢å¼•æ—¶æ·»åŠ äº†éå¿…è¦çš„ ID åˆ—ã€æœªèƒ½è¯†åˆ«ä¸ç°æœ‰ç´¢å¼•çš„å†—ä½™å…³ç³»ã€ä»¥åŠæ— æ³•æ£€æµ‹éšå¼ç±»å‹è½¬æ¢å¯¼è‡´çš„ç´¢å¼•å¤±æ•ˆé—®é¢˜ï¼Œç»¼åˆåæ˜ å‡ºå…¶åœ¨ç´¢å¼•åˆ—é€‰æ‹©ç²¾å‡†åº¦ã€å·²æœ‰ç´¢å¼•ä¸Šä¸‹æ–‡åˆ†æèƒ½åŠ›ä»¥åŠç´¢å¼•ç”Ÿæ•ˆæœºåˆ¶çš„æ·±å±‚ç†è§£ä¸Šå‡å­˜åœ¨ä¸è¶³ï¼Œç¼ºä¹å…¨å±€ä¼˜åŒ–è§†è§’ã€‚</p>
<h4 data-id="heading-16">æ–¹è¨€è½¬æ¢ï¼š55.0 åˆ†</h4>
<p>æ¨¡å‹å­˜åœ¨è¾ƒæ˜æ˜¾çš„â€œé•¿åº¦å¤©èŠ±æ¿â€ã€‚åœ¨æ ‡å‡†çŸ­ SQL è½¬æ¢ä¸­è¡¨ç°ä¼˜å¼‚ï¼Œä½†åœ¨ â€œå¤§ SQL è½¬æ¢â€ æµ‹è¯•é¡¹ä¸­ä»…å¾— 19.4 åˆ†ï¼Œæ¨¡å‹æš´éœ²å‡ºå¯¹è¿‡ç¨‹è¯­è¨€å’Œå¤æ‚ DML è½¬æ¢çš„ç³»ç»Ÿæ€§ç¼ºé™·ï¼š<em>Oracle è½¬ PostgreSQL</em> æ—¶ï¼Œé”™è¯¯åœ°å°†è¡¨è¾¾å¼ç”¨äº <code>GET DIAGNOSTICS</code> ç›®æ ‡ä½ç½®ã€æ··ç”¨ PL/SQL ç‰¹æœ‰çš„ <code>TYPE ... IS RECORD</code> å’Œæ¸¸æ ‡å±æ€§è¯­æ³•ï¼ˆ%NOTFOUNDã€SQL%ROWCOUNTï¼‰ï¼Œæœªèƒ½æ­£ç¡®æ˜ å°„åˆ° PL/pgSQL è§„èŒƒï¼›<em>SQL Server è½¬ GaussDB</em> æ—¶ï¼Œä¿ç•™äº† <code>+</code> å­—ç¬¦ä¸²æ‹¼æ¥è¿ç®—ç¬¦è€Œéä½¿ç”¨ <code>||</code>ï¼Œä¸”åœ¨å¤šè¡¨ <code>UPDATE ... FROM</code> è¯­å¥ä¸­é”™è¯¯åœ°å°†ç›®æ ‡è¡¨çº³å…¥ <code>FROM</code> åˆ—è¡¨å´ç¼ºå¤±å…³è”æ¡ä»¶ï¼Œå¯¼è‡´ç¬›å¡å°”ç§¯å’Œé€»è¾‘é”™è¯¯ã€‚è¿™äº›é—®é¢˜åæ˜ å‡ºæ¨¡å‹åœ¨è¿‡ç¨‹è¯­è¨€æ–¹è¨€å·®å¼‚ã€è¿ç®—ç¬¦æ˜ å°„è§„åˆ™ä»¥åŠå¤æ‚ DML è¯­ä¹‰ç­‰ä»·è½¬æ¢ä¸Šçš„ç†è§£æ·±åº¦ä¸è¶³ï¼Œå°¤å…¶ç¼ºä¹å¯¹ç›®æ ‡æ–¹è¨€éšå«è§„åˆ™å’Œè¯­æ³•çº¦æŸçš„ç²¾å‡†æŠŠæ¡ã€‚</p>
<h3 data-id="heading-17">3. åº”ç”¨ä»·å€¼å»ºè®®</h3>
<ul>
<li><strong>æ¨èåœºæ™¯</strong>ï¼šé€‚ç”¨äºä»£ç å®¡è®¡ã€æ—¥å¸¸ SQL è§„èŒƒæ€§æ ¡éªŒã€è½»é‡çº§æ•°æ®åº“æ—¥å¸¸ç»´æŠ¤ã€‚</li>
<li><strong>å®æˆ˜å»ºè®®</strong>ï¼šæ¨èå°†å…¶é›†æˆåœ¨ IDE æ’ä»¶ä¸­è¿›è¡Œå®æ—¶çš„è¯­æ³•çº é”™ï¼›å¯¹äºæ¶‰åŠæ•°ç™¾è¡Œã€è·¨å¤šå±‚åµŒå¥—çš„å¤æ‚å­˜å‚¨è¿‡ç¨‹ï¼Œå»ºè®®æ‹†è§£åå†äº¤ç»™æ¨¡å‹å¤„ç†ã€‚</li>
</ul>
<blockquote>
<p>è¯¥æ¨¡å‹çš„å‘å¸ƒæ—¶é—´è¾ƒæ—©ï¼ŒSCALE å°†æŒç»­å…³æ³¨å­—èŠ‚è·³åŠ¨ Seed å›¢é˜Ÿçš„å‘å¸ƒè®¡åˆ’ï¼Œç¬¬ä¸€æ—¶é—´å¸¦æ¥æµ‹è¯„åˆ†æã€‚</p>
</blockquote>
<h2 data-id="heading-18">äº”ã€SCALE ç½‘ç«™æ›´æ–°</h2>
<p>ä¸ºäº†å¢å¼º SCALE çš„æŠ€æœ¯æ²‰æ·€ï¼Œæœ¬æœˆæˆ‘ä»¬ä¸Šçº¿äº†ä»¥ä¸‹åŠŸèƒ½ï¼š</p>
<ol>
<li><strong>æ–°é—»æ¨¡å—</strong>ï¼šæŸ¥çœ‹å¾€æœŸå‘ç‰ˆæ·±åº¦åˆ†æï¼Œè¿½è¸ª SCALE è¯„æµ‹æ ‡å‡†çš„æ¼”è¿›å†ç¨‹ã€‚</li>
<li><strong>åšå®¢æ¨¡å—</strong>ï¼šæ²‰æ·€ç¤¾åŒºä¸“å®¶çš„å®æˆ˜æ¡ˆä¾‹ï¼Œæ‰‹æŠŠæ‰‹æ•™æ‚¨å¦‚ä½•åŸºäºæµ‹è¯„æ•°æ®é€‰æ‹©æœ€é€‚åˆçš„å¤§æ¨¡å‹æ–¹æ¡ˆã€‚</li>
</ol>
<h2 data-id="heading-19">å…­ã€æ€»ç»“ä¸å»ºè®®</h2>
<p><strong>æœ¬æœˆçš„æµ‹è¯„ç»“æœä¸ä»…æ˜¯æ¨¡å‹åˆ†æ•°çš„æ›´æ–°ï¼Œæ›´æ­ç¤ºäº†é€šç”¨å¤§è¯­è¨€æ¨¡å‹åœ¨ä¸“ä¸šæ•°æ®åº“é¢†åŸŸå‘å±•çš„ä¸¤ä¸ªæ ¸å¿ƒè¶‹åŠ¿ï¼š</strong></p>
<ul>
<li>ä»â€œå†™å¯¹è¯­æ³•â€å‘â€œè·‘å¾—æ›´å¿«â€è½¬å˜</li>
<li>å›½äº§åŒ–è¿ç§»èƒ½åŠ›çš„å¿«é€Ÿæˆç†Ÿ</li>
</ul>
<h3 data-id="heading-20">å…³æ³¨æ¨¡å‹åœ¨å¤æ‚åœºæ™¯ä¸‹çš„â€œèƒ½åŠ›é˜¶æ¢¯â€</h3>
<p>æ ¹æ®æœ¬æ¬¡ <strong>â€œå¤§ SQL è½¬æ¢â€</strong> ä¸“é¡¹æµ‹è¯•ï¼Œå›½äº§å¤§æ¨¡å‹åœ¨é•¿æ–‡æœ¬é€»è¾‘å¤„ç†ä¸Šä»é¢ä¸´æŒ‘æˆ˜ï¼ˆå¦‚ Seed æ¨¡å‹åœ¨é•¿ SQL ä»»åŠ¡ä¸­å¾—åˆ†æ’åè¾ƒä¸ºè½åï¼‰ã€‚</p>
<ul>
<li><strong>å¼€å‘ç­–ç•¥å»ºè®®</strong>ï¼šå¯¹äºä¸šåŠ¡é€»è¾‘æåº¦å¤æ‚çš„ SQL æˆ–å­˜å‚¨è¿‡ç¨‹ï¼Œå»ºè®®é‡‡ç”¨**â€œé€»è¾‘åˆ†å—â€**çš„åä½œæ–¹å¼ï¼Œå³ç”±äººå·¥æ˜ç¡®æ ¸å¿ƒé€»è¾‘å•å…ƒï¼Œå†ç”±å¤§æ¨¡å‹è¿›è¡Œåˆ†å—å®ç°æˆ–è½¬æ¢ï¼Œä»¥æŠµæ¶ˆå¤§æ¨¡å‹çš„é•¿è·ç¦»é€»è¾‘æ¼‚ç§»ã€‚</li>
<li><strong>æ ¡éªŒå¿…è¦æ€§</strong>ï¼šé‰´äºéƒ¨åˆ†æ¨¡å‹å­˜åœ¨ <strong>â€œé«˜è¯­æ³•åˆ†ã€ä½æ‰§è¡Œå‡†ç¡®æ€§â€</strong> çš„ç°è±¡ï¼ˆå¦‚æ‰§è¡Œå‡†ç¡®ç‡ä½äº 50% çš„æƒ…å†µï¼‰ï¼Œç”Ÿäº§ç¯å¢ƒçš„ SQL å¿…é¡»ç»è¿‡ä¸¥æ ¼çš„é€»è¾‘éªŒè¯ä¸æ€§èƒ½å‹æµ‹ã€‚</li>
</ul>
<h3 data-id="heading-21">åˆ©ç”¨å¤§æ¨¡å‹åŠ é€Ÿå›½äº§åŒ–è¿ç§»çš„â€œé»„é‡‘æœŸâ€</h3>
<p>è¯„æµ‹æ•°æ®æ˜¾ç¤ºï¼Œå›½äº§æ¨¡å‹åœ¨ <strong>â€œå›½äº§æ•°æ®åº“è½¬æ¢â€</strong> ç»´åº¦å·²è¡¨ç°å‡ºæé«˜çš„é€‚é…æ€§ï¼ˆå¦‚ GLM-4.7 è¾¾åˆ° 89.5 åˆ†ï¼‰ã€‚</p>
<ul>
<li><strong>æ¶æ„æ¼”è¿›å»ºè®®</strong>ï¼šé¢å¯¹ä¼ä¸šçº§å›½äº§åŒ–è¿ç§»è¶‹åŠ¿ï¼Œé€šç”¨å¤§æ¨¡å‹å·²å…·å¤‡å¤„ç†ç»å¤§éƒ¨åˆ†æ ‡å‡†å‡½æ•°ä¸è¯­æ³•æ˜ å°„çš„èƒ½åŠ›ï¼Œå¯ä»¥ä½œä¸ºè¿ç§»å·¥ç¨‹åˆæœŸçš„è‡ªåŠ¨åŒ–åº•åº§ã€‚</li>
<li><strong>ç´¢å¼•ä¼˜åŒ–å‰ç½®</strong>ï¼šéšç€ <strong>â€œç´¢å¼•å»ºè®®â€</strong> èƒ½åŠ›çš„å¼•å…¥ï¼Œå¤§æ¨¡å‹å¼€å§‹èƒ½å¤Ÿæä¾›åˆæ­¥çš„ç‰©ç†ç»“æ„å‚è€ƒã€‚ä¼ä¸šåœ¨è¿›è¡Œæ•°æ®åº“è¿ç§»æ—¶ï¼Œå¯ä»¥åŒæ­¥åˆ©ç”¨å¤§æ¨¡å‹çš„å»ºè®®è¿›è¡Œ Schema çš„åˆæ­¥è°ƒä¼˜ï¼Œè€Œéä»…ä»…æ˜¯åŸæ ·æ¬è¿ã€‚</li>
</ul>
<h2 data-id="heading-22">ä¸ƒã€ä¸“å®¶ç‚¹è¯„</h2>
<blockquote>
<p>ç™½é³ï¼ˆå¾æˆŸï¼‰ï¼Œä½°æ™Ÿæ™ºç®— CEOã€‚è‘—æœ‰ã€ŠDBA çš„æ€æƒ³å¤©ç©ºã€‹ã€Šå®æˆ˜å›½äº§æ•°æ®åº“ã€‹ç­‰æŠ€æœ¯ä¸“è‘—ã€‚æ‹…ä»»å¤šå®¶å›½äº§æ•°æ®åº“å‚å•†çš„æŠ€æœ¯é¡¾é—®ã€‚Oracle ACEã€PostgreSQL ACE Directorã€‚</p>
</blockquote>
<p><em>å›½äº§å¼€æºå¤§æ¨¡å‹åœ¨ SQL ç¼–ç¨‹èƒ½åŠ›ä¸Šçš„è¿›æ­¥æ˜¯ä»¤äººå…´å¥‹çš„ï¼Œè¿™ä½¿å¾— AIOPS æœ‰äº†ååˆ†æœ‰åŠ›çš„æ”¯æ’‘ï¼Œè®© SQL å®¡è®¡ã€SQL ä¼˜åŒ–è¿™äº›æ¶‰å¯†çš„ä»»åŠ¡å¯ä»¥åœ¨å†…ç½‘å®‰å…¨ç¯å¢ƒä¸­å®ç°ã€‚</em></p>
<p><em>SCALE æ¦œå•çš„å‡ºç°è®© AI åº”ç”¨å¼€å‘è€…æœ‰äº†ä¸€ä¸ªååˆ†æƒå¨çš„å‚è€ƒï¼Œæœ¬æ¬¡æ¨¡å‹ SQL èƒ½åŠ›æ¦œå•ä¸æˆ‘ä»¬çš„å®é™…åº”ç”¨æ„Ÿå—ç›¸å½“ä¸€è‡´ï¼Œä¸ºçˆ±å¯ç”Ÿå¼€æºç¤¾åŒºç‚¹ä¸ªèµã€‚</em></p>
<hr/>
<p>SCALE è¯„æµ‹ä½“ç³»å°†æŒç»­è·Ÿè¸ªå„å¤§å‚å•†çš„æœ€æ–°æ¨¡å‹åŠ¨æ€å’Œè¿­ä»£è¿›å±•ã€‚æˆ‘ä»¬è‡´åŠ›äºé€šè¿‡å…¬æ­£ã€é€æ˜çš„è¯„æµ‹æ•°æ®ï¼Œä¸ç¤¾åŒºå…±åŒæ¨åŠ¨å¤§è¯­è¨€æ¨¡å‹åœ¨æ•°æ®åº“é¢†åŸŸçš„åº”ç”¨å’Œå®è·µèµ°å‘æ›´æ·±å±‚æ¬¡ã€‚</p>
<p><strong>å³åˆ»æ¢ç´¢æ–°ä¸€ä»£æ¨¡å‹çš„ä¸“ä¸šèƒ½åŠ›ï¼</strong> æ¬¢è¿æ‚¨è®¿é—® SCALE å®˜æ–¹ç½‘ç«™ï¼ŒæŸ¥çœ‹å®Œæ•´çš„æœ€æ–°æ¦œå•å’Œæ¨¡å‹å¯¹æ¯”è¯¦æƒ…ï¼Œå…±åŒæŠŠæ¡ AI æŠ€æœ¯çš„å‰æ²¿è„‰æã€‚</p>
<p><em>æ•°æ®æˆªæ­¢æ—¶é—´ï¼š2026/1/5</em></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å‰ç«¯å‘æ¶æ„çªå›´ç³»åˆ— - è®¾è®¡ä¸è½åœ° [9 - 2]ï¼šå¾®å‰ç«¯æ¶æ„çš„è®¾è®¡é™·é˜±]]></title>    <link>https://juejin.cn/post/7604775190212657162</link>    <guid>https://juejin.cn/post/7604775190212657162</guid>    <pubDate>2026-02-10T05:47:26.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604775190212657162" data-draft-id="7604775190212624394" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å‰ç«¯å‘æ¶æ„çªå›´ç³»åˆ— - è®¾è®¡ä¸è½åœ° [9 - 2]ï¼šå¾®å‰ç«¯æ¶æ„çš„è®¾è®¡é™·é˜±"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2026-02-10T05:47:26.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å‰ç«¯ç‹å£®å£®"/> <meta itemprop="url" content="https://juejin.cn/user/4473272506789485"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å‰ç«¯å‘æ¶æ„çªå›´ç³»åˆ— - è®¾è®¡ä¸è½åœ° [9 - 2]ï¼šå¾®å‰ç«¯æ¶æ„çš„è®¾è®¡é™·é˜±
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4473272506789485/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å‰ç«¯ç‹å£®å£®
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T05:47:26.000Z" title="Tue Feb 10 2026 05:47:26 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"ã€Œ";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"ã€";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"Â»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"âœ“";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><blockquote>
<p><strong>å†™åœ¨å‰é¢</strong></p>
<p>å¾ˆå¤šäººæŠŠå¾®å‰ç«¯ç†è§£ä¸ºâ€œæŠŠä¸€ä¸ªå¤§é¡µé¢æ‹†æˆå‡ ä¸ªå°é¡µé¢â€ã€‚ å¦‚æœåªæ˜¯è¿™æ ·ï¼Œ<code>&lt;iframe&gt;</code> å·²ç»å¤Ÿç”¨äº†ã€‚</p>
<p>å¾®å‰ç«¯çš„æœ¬è´¨ä¸æ˜¯<strong>åˆ†å‘</strong>ï¼Œè€Œæ˜¯<strong>åè°ƒ</strong>ã€‚</p>
<p>çœŸæ­£çš„å¾®å‰ç«¯æ¶æ„ï¼Œæ˜¯ä¸€å¥—<strong>å¤æ‚çš„ç³»ç»Ÿå·¥ç¨‹</strong>ã€‚å®ƒéœ€è¦è§£å†³ï¼šåº”ç”¨çš„åŠ è½½ä¸è·¯ç”±åˆ†å‘ã€æ ·å¼éš”ç¦»ã€çŠ¶æ€å…±äº«ã€å…¬å…±ä¾èµ–ç®¡ç†ï¼Œä»¥åŠæœ€æ ¸å¿ƒçš„â€”â€”<strong>å¦‚ä½•è®©ä¸åŒå›¢é˜Ÿåœ¨äº’ä¸å¹²æ‰°çš„æƒ…å†µä¸‹ç‹¬ç«‹å¼€å‘å’Œéƒ¨ç½²</strong>ã€‚</p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/728dc62869e04d9cbfe6861352ab4a65~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv546L5aOu5aOu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771307535&amp;x-signature=mowstdANjXmLiLSrQarpQdttq5Q%3D" alt="image.png" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-0">ä¸€ã€ ä¸ºä»€ä¹ˆæˆ‘ä»¬è¦â€œæ‹†â€ï¼Ÿï¼ˆå¾®å‰ç«¯çš„æ ¸å¿ƒä»·å€¼ï¼‰</h2>
<p>åœ¨å†³å®šâ€œæ‹†â€ä¹‹å‰ï¼Œå…ˆé—®é—®è‡ªå·±ï¼Œä½ çš„é¡¹ç›®æ˜¯å¦é¢ä¸´ä»¥ä¸‹é—®é¢˜ï¼š</p>
<ol>
<li><strong>æŠ€æœ¯å€ºå †ç§¯ï¼š</strong> æ ¸å¿ƒç³»ç»Ÿè¿˜åœ¨ç”¨è€æ‰ç‰™çš„æŠ€æœ¯æ ˆï¼ˆæ¯”å¦‚ jQueryï¼‰ï¼Œæƒ³æ¢ React/Vue ä½†é‡æ„ä»£ä»·å¤ªå¤§ã€‚</li>
<li><strong>æ„å»ºé€Ÿåº¦å´©æºƒï¼š</strong> æ¯æ¬¡æ”¹ä¸€è¡Œä»£ç ï¼Œæœ¬åœ°ç¼–è¯‘è¦ 10 åˆ†é’Ÿï¼ŒCI/CD è¦åŠå°æ—¶ã€‚</li>
<li><strong>åä½œå†²çªï¼š</strong> å‡ åä¸ªå‰ç«¯åœ¨åŒä¸€ä¸ªä»“åº“æäº¤ä»£ç ï¼Œä»£ç å†²çªå’Œâ€œçº¿ä¸Šäº’ç›¸è¸©è„šâ€æˆä¸ºå¸¸æ€ã€‚</li>
</ol>
<hr/>
<h2 data-id="heading-1">äºŒã€ ä¸‰å¤§ä¸»æµæ–¹æ¡ˆçš„â€œä¸‰å›½æ¼”ä¹‰â€</h2>
<p>åœ¨å¾®å‰ç«¯çš„ä¸–ç•Œé‡Œï¼Œç›®å‰æœ‰ä¸‰è‚¡åŠ¿åŠ›æœ€ä¸ºå¼ºå¤§ã€‚æ¶æ„å¸ˆéœ€è¦æ ¹æ®ä¸šåŠ¡åœºæ™¯è¿›è¡Œç²¾å‡†é€‰å‹ï¼š</p>

































<table><thead><tr><th>æ–¹æ¡ˆ</th><th>æ ¸å¿ƒåŸç†</th><th>ä¼˜ç‚¹</th><th>ç¼ºç‚¹</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td><strong>iframe</strong></td><td>æµè§ˆå™¨åŸç”Ÿå®¹å™¨</td><td>å½»åº•çš„éš”ç¦»ï¼Œä¸Šæ‰‹æœ€å¿«</td><td>æ€§èƒ½å·®ï¼ŒSEO éš¾ï¼Œé€šä¿¡æå…¶ç—›è‹¦ï¼Œå¼¹çª—æ— æ³•æº¢å‡º</td><td>å¤–éƒ¨ç³»ç»ŸåµŒå…¥ï¼Œæç®€é›†æˆ</td></tr><tr><td><strong>qiankun (åŸºäºåè®®)</strong></td><td>JS æ²™ç®± + HTML Entry</td><td>æŠ€æœ¯æ ˆæ— å…³ï¼Œç”Ÿæ€æˆç†Ÿï¼Œæ”¯æŒå­åº”ç”¨é¢„åŠ è½½</td><td>æ ·å¼éš”ç¦»ä¸å½»åº•ï¼Œä¾µå…¥æ€§è¾ƒå¼ºï¼ˆéœ€æ”¹é€ å­åº”ç”¨ï¼‰</td><td>ä¼ä¸šçº§ä¸­åå°ï¼Œè·¨å›¢é˜Ÿåä½œ</td></tr><tr><td><strong>Module Federation</strong></td><td>Webpack 5 æ¨¡å—è”é‚¦</td><td><strong>æ€§èƒ½æœ€é«˜</strong>ï¼ŒåŸç”Ÿå…±äº«ä¾èµ–ï¼Œæ— æ²™ç®±å¼€é”€</td><td>å¼ºç»‘å®š Webpackï¼Œæ— åŸç”Ÿæ ·å¼éš”ç¦»</td><td><strong>åŒæ„ç³»ç»Ÿ</strong>ï¼ˆæŠ€æœ¯æ ˆç»Ÿä¸€ï¼‰çš„æ€§èƒ½ä¼˜åŒ–</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-2">ä¸‰ã€ é¿å‘æŒ‡å—ï¼šå¾®å‰ç«¯çš„è®¾è®¡é™·é˜±</h2>
<p>å¾ˆå¤šé¡¹ç›®æ­»æ‰ï¼Œä¸æ˜¯å› ä¸ºæ–¹æ¡ˆä¸å¥½ï¼Œè€Œæ˜¯æ‰è¿›äº†è¿™äº›å‘é‡Œï¼š</p>
<h3 data-id="heading-3">3.1 æ ·å¼çš„â€œçµå¼‚äº‹ä»¶â€</h3>
<ul>
<li><strong>é™·é˜±ï¼š</strong> å­åº”ç”¨ A æ”¹äº† <code>.btn</code> çš„é¢œè‰²ï¼Œå¯¼è‡´å­åº”ç”¨ B çš„æŒ‰é’®ä¹Ÿå˜è‰²äº†ã€‚</li>
<li><strong>å¯¹ç­–ï¼š</strong> ä¸è¦å®Œå…¨ä¾èµ– CSS-in-JSã€‚ä½¿ç”¨ <strong>Shadow DOM</strong>ï¼ˆæœ€å½»åº•ä½†æœ‰å…¼å®¹æ€§å‘ï¼‰æˆ–è€… <strong>CSS Prefixï¼ˆCSS å‰ç¼€ï¼‰</strong> é…åˆå·¥ç¨‹åŒ–å·¥å…·å¼ºåˆ¶åŠ ä¸Šå‘½åç©ºé—´ã€‚</li>
</ul>
<h3 data-id="heading-4">3.2 â€œé‡â€åº”ç”¨çš„åŠ è½½åœ°ç‹±</h3>
<ul>
<li><strong>é™·é˜±ï¼š</strong> ä¸»åº”ç”¨åŠ è½½äº† Reactï¼Œå­åº”ç”¨ A åŠ è½½äº† Reactï¼Œå­åº”ç”¨ B è¿˜æ˜¯ Reactã€‚ç”¨æˆ·æ‰“å¼€ä¸€ä¸ªé¡µé¢è¦ä¸‹è½½ä¸‰ä»½ React è¿è¡Œæ—¶ã€‚</li>
<li><strong>å¯¹ç­–ï¼š</strong> å¿…é¡»åœ¨æ„å»ºå±‚é¢åš <strong>Externalsï¼ˆå¤–éƒ¨ä¾èµ–æŠ½å–ï¼‰</strong> æˆ–è€…åˆ©ç”¨ <strong>Module Federation</strong> å…±äº«å…¬å…±åº•åº§ã€‚</li>
</ul>
<h3 data-id="heading-5">3.3 å…±äº«çŠ¶æ€çš„â€œè¿‡åº¦è€¦åˆâ€</h3>
<ul>
<li><strong>é™·é˜±ï¼š</strong> è¯•å›¾é€šè¿‡å…¨å±€å˜é‡åœ¨å­åº”ç”¨ä¹‹é—´å…±äº«å¤æ‚çš„ä¸šåŠ¡é€»è¾‘ã€‚</li>
<li><strong>å¯¹ç­–ï¼š</strong> éµå¾ª <strong>â€œæœ€å°åŒ–é€šä¿¡â€åŸåˆ™</strong>ã€‚å­åº”ç”¨ä¹‹é—´åº”è¯¥æ˜¯é€šè¿‡ <strong>CustomEvents</strong> æˆ– <strong>URL å‚æ•°</strong> è¿›è¡Œç®€å•çš„è§£è€¦é€šä¿¡ï¼Œè€Œä¸æ˜¯å…±ç”¨ä¸€ä¸ªå·¨å¤§çš„ Redux Storeã€‚</li>
</ul>
<h3 data-id="heading-6">3.4 è·¯ç”±çš„â€œå¤šé‡äººæ ¼â€</h3>
<p>ä¸»åº”ç”¨æœ‰ä¸€å¥—è·¯ç”±ï¼Œå­åº”ç”¨ä¹Ÿæœ‰ä¸€å¥—è·¯ç”±ã€‚</p>
<ul>
<li><strong>é™·é˜±ï¼š</strong> å½“ä½ åœ¨å­åº”ç”¨ A é‡Œç‚¹å‡»è·³è½¬ï¼ŒURL å˜äº†ï¼Œä½†ä¸»åº”ç”¨å¯èƒ½æ²¡ç›‘å¬åˆ°ï¼Œå¯¼è‡´ä¾§è¾¹æ çš„é«˜äº®çŠ¶æ€ä¸åŒæ­¥ã€‚</li>
<li><strong>æœ€ä½³å®è·µï¼š</strong> é‡‡ç”¨ <strong>â€œä¸»åº”ç”¨æ‰˜ç®¡è·¯ç”±ï¼Œå­åº”ç”¨æ¶ˆè´¹è·¯ç”±â€</strong> ã€‚å­åº”ç”¨å†…éƒ¨ä¸åº”ç›´æ¥ä½¿ç”¨ <code>BrowserRouter</code>ï¼Œè€Œåº”ä½¿ç”¨ <code>MemoryRouter</code> æˆ–ç”±ä¸»åº”ç”¨ä¸‹å‘çš„è·¯ç”±å®ä¾‹ã€‚</li>
</ul>
<h3 data-id="heading-7">3.5 æ€§èƒ½çš„â€œæœ¨æ¡¶æ•ˆåº”â€</h3>
<p>å¾®å‰ç«¯çš„å¯åŠ¨é€Ÿåº¦å–å†³äº<strong>æœ€æ…¢çš„é‚£ä¸€ä¸ªå­åº”ç”¨</strong>ã€‚</p>
<ul>
<li><strong>æ¶æ„æ‰‹æ®µï¼š</strong> 1. <strong>å­åº”ç”¨é¢„åŠ è½½ (Preload):</strong> åœ¨ç”¨æˆ·è¿˜æ²¡ç‚¹å¼€å­åº”ç”¨ B æ—¶ï¼Œåˆ©ç”¨æµè§ˆå™¨ç©ºé—²æ—¶é—´ï¼ˆ<code>requestIdleCallback</code>ï¼‰æ‚„æ‚„æ‹‰å–é™æ€èµ„æºã€‚ 2. <strong>éª¨æ¶å±åŒæ­¥ï¼š</strong> åŸºåº§è¦æ¥ç®¡å­åº”ç”¨åŠ è½½è¿‡ç¨‹ä¸­çš„ Loading çŠ¶æ€ï¼Œé¿å…â€œç™½å± -&gt; Loading -&gt; ç™½å± -&gt; æ¸²æŸ“â€çš„è·³è·ƒæ„Ÿã€‚</li>
</ul>
<h3 data-id="heading-8">3.6 å…¨å±€ç»„ä»¶çš„â€œæº¢å‡ºåœ°ç‹±â€</h3>
<ul>
<li><strong>é—®é¢˜ï¼š</strong> å­åº”ç”¨é‡Œçš„ <code>Tooltip</code> æˆ– <code>Select</code> å±•å¼€æ—¶ï¼Œå¦‚æœå®¹å™¨å¼€å¯äº† <code>overflow: hidden</code>ï¼Œé€‰é¡¹ä¼šè¢«æˆªæ–­ã€‚</li>
<li><strong>æ¶æ„å†³ç­–ï¼š</strong> æ‰€æœ‰æµ®å±‚å¿…é¡»é€šè¿‡ <code>Portal</code> æŒ‚è½½åˆ°åŸºåº§çš„ç‰¹å®šå®¹å™¨ä¸‹ï¼Œå¹¶ç¡®ä¿åŸºåº§å¯¹è¿™äº›å®¹å™¨æœ‰ç»Ÿä¸€çš„æ ·å¼æ³¨å…¥ã€‚</li>
</ul>
<hr/>
<h2 data-id="heading-9">å››ã€ æ¶æ„å¸ˆçš„æœ€ä½³å®è·µæ¸…å•</h2>
<p>å¦‚æœä½ å†³å®šè½åœ°å¾®å‰ç«¯ï¼Œè¯·ç¡®ä¿ä½ å·²ç»å‡†å¤‡å¥½äº†ä»¥ä¸‹é…å¥—ï¼š</p>
<ol>
<li><strong>ç»Ÿä¸€çš„ UI è§„èŒƒï¼š</strong> å¦‚æœå­åº”ç”¨ A ç”¨ AntDï¼Œå­åº”ç”¨ B ç”¨ Elementï¼Œæœ€åæ‹¼å‡ºæ¥çš„é¡µé¢ä¼šåƒâ€œç¼åˆæ€ªâ€ã€‚</li>
<li><strong>è‡ªåŠ¨åŒ–çš„è·¯ç”±æ‰˜ç®¡ï¼š</strong> ä¸»åº”ç”¨è´Ÿè´£ç›‘å¬è·¯ç”±å¹¶åˆ†å‘ï¼Œå­åº”ç”¨åªéœ€å…³å¿ƒè‡ªå·±çš„å†…é¡µã€‚</li>
<li><strong>ç‹¬ç«‹éƒ¨ç½²æµæ°´çº¿ (CI/CD)ï¼š</strong> è¿™æ˜¯å¾®å‰ç«¯çš„<strong>çµé­‚</strong>ã€‚å­åº”ç”¨çš„å‘å¸ƒä¸åº”è¯¥ä¾èµ–ä¸»åº”ç”¨çš„é‡å¯ã€‚</li>
<li><strong>å…¨é“¾è·¯ç›‘æ§ï¼š</strong> å½“ä¸€ä¸ªæŠ¥é”™å‘ç”Ÿæ—¶ï¼Œä½ å¿…é¡»èƒ½ä¸€çœ¼çœ‹å‡ºæ˜¯ä¸»åº”ç”¨çš„åŸºåº§å´©äº†ï¼Œè¿˜æ˜¯æŸä¸ªå­åº”ç”¨çš„ä»£ç å†™çƒ‚äº†ã€‚</li>
</ol>
<p>ä¸€ä¸ªåˆæ ¼çš„å¾®å‰ç«¯æ¶æ„å¸ˆï¼Œåº”è¯¥å»ºç«‹ä¸€å¥—**â€œæ¥å…¥åè®®â€**ï¼š</p>
<ol>
<li><strong>ç”Ÿå‘½å‘¨æœŸçº¦æŸï¼š</strong> å¿…é¡»å¯¼å‡º <code>bootstrap</code> (åˆå§‹åŒ–)ã€<code>mount</code> (æŒ‚è½½)ã€<code>unmount</code> (å¸è½½) ä¸‰ä¸ªé’©å­ã€‚</li>
<li><strong>å¥‘çº¦åŒ–é€šä¿¡ï¼š</strong> ç¦æ­¢ç›´æ¥è¯»å†™ <code>window</code>ã€‚å¿…é¡»é€šè¿‡ <code>props</code> ä¸‹å‘çš„ <code>EventBus</code> æˆ–å…¨å±€ <code>Actions</code> è¿›è¡Œè·¨åº”ç”¨é€šä¿¡ã€‚</li>
<li><strong>ç‹¬ç«‹ç‰ˆæœ¬æ§åˆ¶ï¼š</strong> å­åº”ç”¨å¿…é¡»æœ‰ç‹¬ç«‹çš„ä»“åº“å’Œç‹¬ç«‹çš„åŸŸåï¼Œé€šè¿‡ <code>manifest.json</code> åŠ¨æ€å‘Šè¯‰ä¸»åº”ç”¨æœ€æ–°ä»£ç çš„åœ°å€ã€‚</li>
</ol>
<hr/>
<h2 data-id="heading-10">äº”ã€ æ€»ç»“ï¼šä½•æ—¶è¯¥å›å½’â€œå•ä½“â€ï¼Ÿ</h2>
<p>æ¶æ„å¸ˆæœ€éœ€è¦æ—¶åˆ»è­¦æƒ•çš„æ˜¯ï¼š<strong>å¾®å‰ç«¯å¢åŠ äº†ç³»ç»Ÿçš„ç†µå€¼ã€‚</strong></p>
<p>å¦‚æœä½ çš„å›¢é˜Ÿåªæœ‰ 5 ä¸ªäººï¼Œä¸”ä¸šåŠ¡æ¨¡å—ç›¸å¯¹å›ºå®šï¼Œé‚£ä¹ˆ<strong>å¾®å‰ç«¯å°±æ˜¯è¿‡åº¦è®¾è®¡</strong>ã€‚æ­¤æ—¶ï¼Œä¸€ä¸ªæ•´æ´çš„ <strong>Monorepo (å•ä»“åº“å¤šé¡¹ç›®)</strong> æ–¹æ¡ˆå¯èƒ½æ¯”å¾®å‰ç«¯æ›´é«˜æ•ˆã€æ›´ç¨³å®šã€‚</p>
<p><strong>æ¶æ„çš„è‰ºæœ¯åœ¨äºï¼šåœ¨åº”ç”¨è§„æ¨¡å°çš„æ—¶å€™ä¿æŒå•ä½“çš„ç®€æ´ï¼Œåœ¨è§„æ¨¡çˆ†ç‚¸å‰é¢„ç•™æ‹†åˆ†çš„å£å­ã€‚</strong></p>
<p>å½“ä½ è€ƒè™‘ä½¿ç”¨å¾®å‰ç«¯æ—¶ï¼Œè¯·å¯¹ç…§è¿™ä¸ª <strong>ROI (æŠ•å…¥äº§å‡ºæ¯”)</strong> å…¬å¼ï¼š</p>
<p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>æ¶æ„æ”¶ç›Š</mtext><mo>=</mo><mo stretchy="false">(</mo><mtext>å¼€å‘è§£è€¦é€Ÿåº¦</mtext><mo>+</mo><mtext>æŠ€æœ¯æ ˆè¿ç§»æ”¶ç›Š</mtext><mo stretchy="false">)</mo><mo>âˆ’</mo><mo stretchy="false">(</mo><mtext>ç³»ç»Ÿå¤æ‚åº¦å¢åŠ </mtext><mo>+</mo><mtext>é€šä¿¡æˆæœ¬</mtext><mo>+</mo><mtext>è°ƒè¯•éš¾åº¦</mtext><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">æ¶æ„æ”¶ç›Š = (å¼€å‘è§£è€¦é€Ÿåº¦ + æŠ€æœ¯æ ˆè¿ç§»æ”¶ç›Š) - (ç³»ç»Ÿå¤æ‚åº¦å¢åŠ  + é€šä¿¡æˆæœ¬ + è°ƒè¯•éš¾åº¦)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord cjk_fallback">æ¶æ„æ”¶ç›Š</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">(</span><span class="mord cjk_fallback">å¼€å‘è§£è€¦é€Ÿåº¦</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord cjk_fallback">æŠ€æœ¯æ ˆè¿ç§»æ”¶ç›Š</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">(</span><span class="mord cjk_fallback">ç³»ç»Ÿå¤æ‚åº¦å¢åŠ </span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"/><span class="mord cjk_fallback">é€šä¿¡æˆæœ¬</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord cjk_fallback">è°ƒè¯•éš¾åº¦</span><span class="mclose">)</span></span></span></span></span></p>
<p>å¦‚æœä½ çš„æ”¶ç›Šæ˜¯è´Ÿæ•°ï¼Œè¯·æœæ–­åœæ‰‹ã€‚</p>
<p><strong>è®°ä½ï¼šå¾®å‰ç«¯ä¸æ˜¯ä¸ºäº†è®©å‰ç«¯å˜å¾—æ›´é…·ï¼Œè€Œæ˜¯ä¸ºäº†è®© 50 ä¸ªäººåä½œèµ·æ¥åƒ 5 ä¸ªäººä¸€æ ·é«˜æ•ˆã€‚</strong></p>
<hr/>
<h2 data-id="heading-11">ç»“è¯­ï¼šå»¶ä¼¸çš„è§¦è§’</h2>
<p>å¾®å‰ç«¯è§£å†³äº†å‰ç«¯ä¹‹é—´çš„â€œåˆ†æ²»â€é—®é¢˜ï¼Œä½†å‰ç«¯ä¸åç«¯ä¹‹é—´çš„é‚£å±‚â€œèƒ¶æ°´â€ä¾ç„¶è„†å¼±ã€‚å½“ä¸šåŠ¡é€»è¾‘å˜å¾—æç«¯å¤æ‚ï¼Œå‰ç«¯æ˜¯å¦åº”è¯¥æ¥ç®¡ä¸€éƒ¨åˆ†åç«¯çš„èŒèƒ½ï¼Ÿ</p>
<blockquote>
<p><strong>Next Step:</strong></p>
<p>éšç€äº‘åŸç”Ÿå’Œ Node.js ç”Ÿæ€çš„æˆç†Ÿï¼Œå‰ç«¯æ¶æ„çš„è¾¹ç•Œæ­£åœ¨å‘åç«¯æ— é™å»¶ä¼¸ã€‚ ä¸‹ä¸€èŠ‚ï¼Œæˆ‘ä»¬å°†æ¢è®¨å‰ç«¯æ¶æ„å¸ˆçš„â€œè·¨ç•Œâ€æ­¦å™¨ã€‚ è¯·çœ‹**ã€Šç¬¬ä¸‰ç¯‡ï¼šå»¶ä¼¸â€”â€”æ‰“ç ´è¾¹ç•Œï¼šBFF (Backend for Frontend) å±‚ä¸ Serverless çš„æ¶æ„èåˆã€‹**ã€‚</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å¦‚ä½•è®© MyBatis æ‰¹é‡æ’å…¥ä»5åˆ†é’Ÿç¼©çŸ­åˆ°3ç§’ï¼Ÿæˆ‘çš„ä¸‰ä¸ªå…³é”®ä¼˜åŒ–]]></title>    <link>https://juejin.cn/post/7604775190212673546</link>    <guid>https://juejin.cn/post/7604775190212673546</guid>    <pubDate>2026-02-10T05:52:31.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604775190212673546" data-draft-id="7604784281957154854" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å¦‚ä½•è®© MyBatis æ‰¹é‡æ’å…¥ä»5åˆ†é’Ÿç¼©çŸ­åˆ°3ç§’ï¼Ÿæˆ‘çš„ä¸‰ä¸ªå…³é”®ä¼˜åŒ–"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2026-02-10T05:52:31.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç¥å¥‡å°æ±¤åœ†"/> <meta itemprop="url" content="https://juejin.cn/user/1151943919285431"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å¦‚ä½•è®© MyBatis æ‰¹é‡æ’å…¥ä»5åˆ†é’Ÿç¼©çŸ­åˆ°3ç§’ï¼Ÿæˆ‘çš„ä¸‰ä¸ªå…³é”®ä¼˜åŒ–
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1151943919285431/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç¥å¥‡å°æ±¤åœ†
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T05:52:31.000Z" title="Tue Feb 10 2026 05:52:31 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>ä¸Šå‘¨æ¥äº†ä¸ªæ•°æ®è¿ç§»çš„æ´»ï¼Œè¦æŠŠ10ä¸‡æ¡æ•°æ®ä»è€ç³»ç»Ÿå¯¼å…¥æ–°ç³»ç»Ÿã€‚</p>
<p>å†™äº†ä¸ªç®€å•çš„æ‰¹é‡æ’å…¥ï¼Œè·‘èµ·æ¥ä¸€çœ‹â€”â€”5åˆ†é’Ÿã€‚</p>
<p>é¢†å¯¼è¯´å¤ªæ…¢äº†ï¼Œèƒ½ä¸èƒ½å¿«ç‚¹ï¼Ÿ</p>
<p>æŠ˜è…¾äº†ä¸€ä¸‹åˆï¼Œæœ€åä¼˜åŒ–åˆ°3ç§’ï¼Œè®°å½•ä¸€ä¸‹è¿‡ç¨‹ã€‚</p>
<h3 data-id="heading-0"/>
<h3 data-id="heading-1"/>
<h3 data-id="heading-2">æœ€åˆçš„ä»£ç ï¼ˆ5åˆ†é’Ÿï¼‰</h3>
<p>æœ€å¼€å§‹å†™çš„å¾ˆç®€å•ï¼Œforeachå¾ªç¯æ’å…¥ï¼š</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// æ–¹å¼1ï¼šå¾ªç¯å•æ¡æ’å…¥ï¼ˆæœ€æ…¢ï¼‰</span>
forÂ (User user : userList) {
Â  Â  userMapper<span class="hljs-selector-class">.insert</span>(user);
}
</code></pre>
<p>10ä¸‡æ¡æ•°æ®ï¼Œæ¯æ¡éƒ½è¦èµ°ä¸€æ¬¡ç½‘ç»œè¯·æ±‚ã€ä¸€æ¬¡SQLè§£æã€ä¸€æ¬¡äº‹åŠ¡æäº¤ã€‚</p>
<p>ç®—ä¸€ä¸‹ï¼šå‡è®¾æ¯æ¡æ’å…¥éœ€è¦3msï¼Œ10ä¸‡æ¡å°±æ˜¯300ç§’ = 5åˆ†é’Ÿã€‚</p>
<p><strong>è¿™æ˜¯æœ€è ¢çš„å†™æ³•ï¼Œä½†æˆ‘è§è¿‡å¾ˆå¤šé¡¹ç›®éƒ½è¿™ä¹ˆå†™ã€‚</strong></p>
<h3 data-id="heading-3"/>
<h3 data-id="heading-4"/>
<h3 data-id="heading-5">ç¬¬ä¸€æ¬¡ä¼˜åŒ–ï¼šæ‰¹é‡SQLï¼ˆ30ç§’ï¼‰</h3>
<p>æŠŠå¾ªç¯æ’å…¥æ”¹æˆæ‰¹é‡SQLï¼š</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- Mapper.xml --&gt;</span>
&lt;insertid="batchInsert"&gt;
Â  Â  INSERT INTO user (name, age, email) VALUES
Â  Â Â &lt;foreachcollection="list"item="item"separator=","&gt;
Â  Â  Â  Â  (#{item.name}, #{item.age}, #{item.email})
Â  Â Â <span class="hljs-tag">&lt;/<span class="hljs-name">foreach</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">insert</span>&gt;</span>
</code></pre>

<pre><code class="hljs language-ini" lang="ini">// åˆ†æ‰¹æ’å…¥ï¼Œæ¯æ‰¹1000æ¡
intÂ <span class="hljs-attr">batchSize</span> =Â <span class="hljs-number">1000</span><span class="hljs-comment">;</span>
forÂ (intÂ <span class="hljs-attr">i</span> =Â <span class="hljs-number">0</span><span class="hljs-comment">; i &lt; userList.size(); i += batchSize) {</span>
Â  Â Â intÂ <span class="hljs-attr">end</span> = Math.min(i + batchSize, userList.size())<span class="hljs-comment">;</span>
Â  Â  List&lt;User&gt; <span class="hljs-attr">batch</span> = userList.subList(i, end)<span class="hljs-comment">;</span>
Â  Â  userMapper.batchInsert(batch)<span class="hljs-comment">;</span>
}
</code></pre>
<p>ä»5åˆ†é’Ÿé™åˆ°30ç§’ï¼Œæå‡10å€ã€‚</p>
<p>åŸç†ï¼šä¸€æ¡SQLæ’å…¥å¤šæ¡æ•°æ®ï¼Œå‡å°‘ç½‘ç»œå¾€è¿”æ¬¡æ•°ã€‚</p>
<p>ä½†è¿˜æœ‰é—®é¢˜ï¼š30ç§’è¿˜æ˜¯å¤ªæ…¢ã€‚</p>
<h3 data-id="heading-6"/>
<h3 data-id="heading-7"/>
<h3 data-id="heading-8">ç¬¬äºŒæ¬¡ä¼˜åŒ–ï¼šJDBCæ‰¹å¤„ç†ï¼ˆ8ç§’ï¼‰</h3>
<p>MySQLæœ‰ä¸ªå‚æ•°å«<code>rewriteBatchedStatements</code>ï¼Œå¼€å¯åå¯ä»¥æŠŠå¤šæ¡INSERTåˆå¹¶æˆä¸€æ¡ã€‚</p>
<h5 data-id="heading-9">ç¬¬ä¸€æ­¥ï¼šä¿®æ”¹æ•°æ®åº“è¿æ¥URL</h5>
<pre><code class="hljs language-bash" lang="bash">jdbc:mysql://localhost:3306/test?rewriteBatchedStatements=<span class="hljs-literal">true</span>
</code></pre>
<h5 data-id="heading-10">ç¬¬äºŒæ­¥ï¼šä½¿ç”¨MyBatisçš„æ‰¹å¤„ç†æ¨¡å¼</h5>
<pre><code class="hljs language-ini" lang="ini">@Autowired
privateÂ SqlSessionFactory sqlSessionFactory<span class="hljs-comment">;</span>

publicvoidbatchInsertWithExecutor(List&lt;User&gt; userList){
Â  Â Â tryÂ (SqlSession <span class="hljs-attr">sqlSession</span> = sqlSessionFactory.openSession(ExecutorType.BATCH)) {
Â  Â  Â  Â  UserMapper <span class="hljs-attr">mapper</span> = sqlSession.getMapper(UserMapper.class)<span class="hljs-comment">;</span>
Â  Â  Â  Â Â 
Â  Â  Â  Â Â intÂ <span class="hljs-attr">batchSize</span> =Â <span class="hljs-number">1000</span><span class="hljs-comment">;</span>
Â  Â  Â  Â Â forÂ (intÂ <span class="hljs-attr">i</span> =Â <span class="hljs-number">0</span><span class="hljs-comment">; i &lt; userList.size(); i++) {</span>
Â  Â  Â  Â  Â  Â  mapper.insert(userList.get(i))<span class="hljs-comment">;</span>
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â Â ifÂ ((i +Â 1) % <span class="hljs-attr">batchSize</span> ==Â <span class="hljs-number">0</span>) {
Â  Â  Â  Â  Â  Â  Â  Â  sqlSession.flushStatements()<span class="hljs-comment">;</span>
Â  Â  Â  Â  Â  Â  Â  Â  sqlSession.clearCache()<span class="hljs-comment">;</span>
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â  sqlSession.flushStatements()<span class="hljs-comment">;</span>
Â  Â  Â  Â  sqlSession.commit()<span class="hljs-comment">;</span>
Â  Â  }
}
</code></pre>
<p>ä»30ç§’é™åˆ°8ç§’ã€‚</p>
<p>åŸç†ï¼š<code>ExecutorType.BATCH</code>æ¨¡å¼ä¸‹ï¼ŒMyBatisä¼šç¼“å­˜SQLï¼Œæœ€åä¸€æ¬¡æ€§å‘é€ç»™æ•°æ®åº“æ‰§è¡Œã€‚é…åˆ<code>rewriteBatchedStatements=true</code>ï¼ŒMySQLé©±åŠ¨ä¼šæŠŠå¤šæ¡INSERTåˆå¹¶ã€‚</p>
<h3 data-id="heading-11"/>
<h3 data-id="heading-12"/>
<h3 data-id="heading-13">ç¬¬ä¸‰æ¬¡ä¼˜åŒ–ï¼šå¤šçº¿ç¨‹å¹¶è¡Œï¼ˆ3ç§’ï¼‰</h3>
<p>8ç§’è¿˜æ˜¯ä¸å¤Ÿå¿«ï¼Œä¸Šå¤šçº¿ç¨‹ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">publicvoidparallelBatchInsert(List&lt;User&gt; userList){
Â  Â Â intÂ <span class="hljs-attr">threadCount</span> =Â <span class="hljs-number">4</span><span class="hljs-comment">; Â // æ ¹æ®æ•°æ®åº“è¿æ¥æ± å¤§å°è°ƒæ•´</span>
Â  Â Â intÂ <span class="hljs-attr">batchSize</span> = userList.size() / threadCount<span class="hljs-comment">;</span>
Â  Â Â 
Â  Â  ExecutorService <span class="hljs-attr">executor</span> = Executors.newFixedThreadPool(threadCount)<span class="hljs-comment">;</span>
Â  Â  List&lt;Future&lt;?&gt;&gt; <span class="hljs-attr">futures</span> =Â newÂ ArrayList&lt;&gt;()<span class="hljs-comment">;</span>
Â  Â Â 
Â  Â Â forÂ (intÂ <span class="hljs-attr">i</span> =Â <span class="hljs-number">0</span><span class="hljs-comment">; i &lt; threadCount; i++) {</span>
Â  Â  Â  Â Â intÂ <span class="hljs-attr">start</span> = i * batchSize<span class="hljs-comment">;</span>
Â  Â  Â  Â Â intÂ <span class="hljs-attr">end</span> = (i == threadCount -Â <span class="hljs-number">1</span>) ? userList.size() : (i +Â <span class="hljs-number">1</span>) * batchSize<span class="hljs-comment">;</span>
Â  Â  Â  Â  List&lt;User&gt; <span class="hljs-attr">subList</span> = userList.subList(start, end)<span class="hljs-comment">;</span>
Â  Â  Â  Â Â 
Â  Â  Â  Â  futures.add(executor.submit(() -&gt; {
Â  Â  Â  Â  Â  Â  batchInsertWithExecutor(subList)<span class="hljs-comment">;</span>
Â  Â  Â  Â  }))<span class="hljs-comment">;</span>
Â  Â  }
Â  Â Â 
Â  Â Â // ç­‰å¾…æ‰€æœ‰ä»»åŠ¡å®Œæˆ
Â  Â Â forÂ (Future&lt;?&gt; future : futures) {
Â  Â  Â  Â Â tryÂ {
Â  Â  Â  Â  Â  Â  future.get()<span class="hljs-comment">;</span>
Â  Â  Â  Â  }Â catchÂ (Exception e) {
Â  Â  Â  Â  Â  Â Â thrownewÂ RuntimeException(e)<span class="hljs-comment">;</span>
Â  Â  Â  Â  }
Â  Â  }
Â  Â Â 
Â  Â  executor.shutdown()<span class="hljs-comment">;</span>
}
</code></pre>
<p>ä»8ç§’é™åˆ°3ç§’ã€‚</p>
<p>æ³¨æ„äº‹é¡¹ï¼š</p>
<ul>
<li>çº¿ç¨‹æ•°ä¸è¦è¶…è¿‡æ•°æ®åº“è¿æ¥æ± å¤§å°</li>
<li>å¦‚æœéœ€è¦äº‹åŠ¡ä¸€è‡´æ€§ï¼Œè¿™ä¸ªæ–¹æ¡ˆä¸é€‚ç”¨</li>
<li>è¦è€ƒè™‘ä¸»é”®å†²çªçš„é—®é¢˜</li>
</ul>
<h3 data-id="heading-14"/>
<h3 data-id="heading-15"/>
<h3 data-id="heading-16">ä¼˜åŒ–æ•ˆæœå¯¹æ¯”</h3>
<h3 data-id="heading-17"/>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a6da9e695da64dcca1741bfe530658f4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We5aWH5bCP5rGk5ZyG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771307553&amp;x-signature=vMP1%2FFJVFxJLToBuBOFPs1sIl4w%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<h3 data-id="heading-18"/>
<h3 data-id="heading-19">è¸©è¿‡çš„å‘</h3>
<h5 data-id="heading-20">å‘1ï¼šforeachæ‹¼æ¥SQLè¿‡é•¿</h5>
<pre><code class="hljs language-ini" lang="ini">&lt;foreach <span class="hljs-attr">collection</span>=<span class="hljs-string">"list"</span>Â item=<span class="hljs-string">"item"</span>Â separator=<span class="hljs-string">","</span>&gt;
</code></pre>
<p>å¦‚æœä¸€æ¬¡æ’å…¥å¤ªå¤šæ¡ï¼ŒSQLä¼šéå¸¸é•¿ï¼Œå¯èƒ½è¶…è¿‡<code>max_allowed_packet</code>é™åˆ¶ã€‚</p>
<p><strong>è§£å†³ï¼š</strong> Â åˆ†æ‰¹æ’å…¥ï¼Œæ¯æ‰¹500-1000æ¡ã€‚</p>
<h5 data-id="heading-21">å‘2ï¼šrewriteBatchedStatementsä¸ç”Ÿæ•ˆ</h5>
<p>æ£€æŸ¥å‡ ä¸ªç‚¹ï¼š</p>
<ul>
<li>URLå‚æ•°æ˜¯å¦æ­£ç¡®ï¼š<code>rewriteBatchedStatements=true</code></li>
<li>æ˜¯å¦ä½¿ç”¨äº†<code>ExecutorType.BATCH</code></li>
<li>MySQLé©±åŠ¨ç‰ˆæœ¬æ˜¯å¦å¤ªæ—§</li>
</ul>
<h5 data-id="heading-22">å‘3ï¼šè‡ªå¢ä¸»é”®è¿”å›é—®é¢˜</h5>
<p>æ‰¹é‡æ’å…¥æ—¶æƒ³è·å–è‡ªå¢ä¸»é”®ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">&lt;<span class="hljs-attr">insertid</span>=<span class="hljs-string">"batchInsert"</span>useGeneratedKeys=<span class="hljs-string">"true"</span>keyProperty=<span class="hljs-string">"id"</span>&gt;
</code></pre>
<p>æ³¨æ„ï¼š<code>rewriteBatchedStatements=true</code>æ—¶ï¼Œè‡ªå¢ä¸»é”®è¿”å›å¯èƒ½æœ‰é—®é¢˜ï¼Œéœ€è¦å‡çº§MySQLé©±åŠ¨åˆ°8.0.17+ã€‚</p>
<h5 data-id="heading-23">å‘4ï¼šå†…å­˜æº¢å‡º</h5>
<p>10ä¸‡æ¡æ•°æ®ä¸€æ¬¡æ€§åŠ è½½åˆ°å†…å­˜ï¼Œå¯èƒ½OOMã€‚</p>
<p>è§£å†³ï¼šåˆ†é¡µè¯»å– + åˆ†æ‰¹æ’å…¥ã€‚</p>
<pre><code class="hljs language-ini" lang="ini">intÂ <span class="hljs-attr">pageSize</span> =Â <span class="hljs-number">10000</span><span class="hljs-comment">;</span>
intÂ <span class="hljs-attr">total</span> = countTotal()<span class="hljs-comment">;</span>
forÂ (intÂ <span class="hljs-attr">i</span> =Â <span class="hljs-number">0</span><span class="hljs-comment">; i &lt; total; i += pageSize) {</span>
Â  Â  List&lt;User&gt; <span class="hljs-attr">page</span> = selectByPage(i, pageSize)<span class="hljs-comment">;</span>
Â  Â  batchInsertWithExecutor(page)<span class="hljs-comment">;</span>
}
</code></pre>
<h3 data-id="heading-24"/>
<h3 data-id="heading-25"/>
<h3 data-id="heading-26">æœ€ç»ˆæ–¹æ¡ˆä»£ç </h3>
<pre><code class="hljs language-ini" lang="ini">@Service
publicclassBatchInsertService{
Â  Â Â 
Â  Â Â @Autowired
Â  Â Â privateÂ SqlSessionFactory sqlSessionFactory<span class="hljs-comment">;</span>
Â  Â Â 
Â  Â Â /**
Â  Â  Â * é«˜æ€§èƒ½æ‰¹é‡æ’å…¥
Â  Â  Â * 10ä¸‡æ¡æ•°æ®çº¦3ç§’
Â  Â  Â */
Â  Â Â publicvoidhighPerformanceBatchInsert(List&lt;User&gt; userList){
Â  Â  Â  Â Â ifÂ (<span class="hljs-attr">userList</span> ==Â nullÂ || userList.isEmpty()) {
Â  Â  Â  Â  Â  Â Â return<span class="hljs-comment">;</span>
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â Â intÂ <span class="hljs-attr">threadCount</span> = Math.min(<span class="hljs-number">4</span>, Runtime.getRuntime().availableProcessors())<span class="hljs-comment">;</span>
Â  Â  Â  Â Â intÂ <span class="hljs-attr">batchSize</span> = (int) Math.ceil((double) userList.size() / threadCount)<span class="hljs-comment">;</span>
Â  Â  Â  Â Â 
Â  Â  Â  Â  ExecutorService <span class="hljs-attr">executor</span> = Executors.newFixedThreadPool(threadCount)<span class="hljs-comment">;</span>
Â  Â  Â  Â  CountDownLatch <span class="hljs-attr">latch</span> =Â newÂ CountDownLatch(threadCount)<span class="hljs-comment">;</span>
Â  Â  Â  Â Â 
Â  Â  Â  Â Â forÂ (intÂ <span class="hljs-attr">i</span> =Â <span class="hljs-number">0</span><span class="hljs-comment">; i &lt; threadCount; i++) {</span>
Â  Â  Â  Â  Â  Â Â intÂ <span class="hljs-attr">start</span> = i * batchSize<span class="hljs-comment">;</span>
Â  Â  Â  Â  Â  Â Â intÂ <span class="hljs-attr">end</span> = Math.min((i +Â <span class="hljs-number">1</span>) * batchSize, userList.size())<span class="hljs-comment">;</span>
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â Â ifÂ (start &gt;= userList.size()) {
Â  Â  Â  Â  Â  Â  Â  Â  latch.countDown()<span class="hljs-comment">;</span>
Â  Â  Â  Â  Â  Â  Â  Â Â continue<span class="hljs-comment">;</span>
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  List&lt;User&gt; <span class="hljs-attr">subList</span> =Â newÂ ArrayList&lt;&gt;(userList.subList(start, end))<span class="hljs-comment">;</span>
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  executor.submit(() -&gt; {
Â  Â  Â  Â  Â  Â  Â  Â Â tryÂ {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  doBatchInsert(subList)<span class="hljs-comment">;</span>
Â  Â  Â  Â  Â  Â  Â  Â  }Â finallyÂ {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  latch.countDown()<span class="hljs-comment">;</span>
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  })<span class="hljs-comment">;</span>
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â Â tryÂ {
Â  Â  Â  Â  Â  Â  latch.await()<span class="hljs-comment">;</span>
Â  Â  Â  Â  }Â catchÂ (InterruptedException e) {
Â  Â  Â  Â  Â  Â  Thread.currentThread().interrupt()<span class="hljs-comment">;</span>
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  executor.shutdown()<span class="hljs-comment">;</span>
Â  Â  }
Â  Â Â 
Â  Â Â privatevoiddoBatchInsert(List&lt;User&gt; userList){
Â  Â  Â  Â Â tryÂ (SqlSession <span class="hljs-attr">sqlSession</span> = sqlSessionFactory.openSession(ExecutorType.BATCH,Â <span class="hljs-literal">false</span>)) {
Â  Â  Â  Â  Â  Â  UserMapper <span class="hljs-attr">mapper</span> = sqlSession.getMapper(UserMapper.class)<span class="hljs-comment">;</span>
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â Â forÂ (intÂ <span class="hljs-attr">i</span> =Â <span class="hljs-number">0</span><span class="hljs-comment">; i &lt; userList.size(); i++) {</span>
Â  Â  Â  Â  Â  Â  Â  Â  mapper.insert(userList.get(i))<span class="hljs-comment">;</span>
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â Â ifÂ ((i +Â 1) %Â <span class="hljs-attr">1000</span>Â ==Â <span class="hljs-number">0</span>) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  sqlSession.flushStatements()<span class="hljs-comment">;</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  sqlSession.clearCache()<span class="hljs-comment">;</span>
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  sqlSession.flushStatements()<span class="hljs-comment">;</span>
Â  Â  Â  Â  Â  Â  sqlSession.commit()<span class="hljs-comment">;</span>
Â  Â  Â  Â  }
Â  Â  }
}
</code></pre>
<h3 data-id="heading-27"/>
<h3 data-id="heading-28"/>
<h3 data-id="heading-29">æ€»ç»“</h3>
<h3 data-id="heading-30"/>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e270d75098d948998577c9c53d48202a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We5aWH5bCP5rGk5ZyG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771307553&amp;x-signature=stAnw%2BdeTn6WdKl7fJhR0rlskdc%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p><strong>æ ¸å¿ƒåŸåˆ™ï¼š</strong> Â å‡å°‘ç½‘ç»œå¾€è¿” + å‡å°‘äº‹åŠ¡æ¬¡æ•° + å¹¶è¡Œå¤„ç†ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[TDesign E2E â€”â€” ä¸€å¥—é…ç½®é©±åŠ¨ã€å¯æ‰©å±•çš„ç«¯åˆ°ç«¯æµ‹è¯•æ¡†æ¶]]></title>    <link>https://juejin.cn/post/7604701848150802432</link>    <guid>https://juejin.cn/post/7604701848150802432</guid>    <pubDate>2026-02-10T04:03:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604701848150802432" data-draft-id="7604779604125106176" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="TDesign E2E â€”â€” ä¸€å¥—é…ç½®é©±åŠ¨ã€å¯æ‰©å±•çš„ç«¯åˆ°ç«¯æµ‹è¯•æ¡†æ¶"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2026-02-10T04:03:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Novlan1"/> <meta itemprop="url" content="https://juejin.cn/user/1987523605435432"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            TDesign E2E â€”â€” ä¸€å¥—é…ç½®é©±åŠ¨ã€å¯æ‰©å±•çš„ç«¯åˆ°ç«¯æµ‹è¯•æ¡†æ¶
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1987523605435432/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Novlan1
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T04:03:17.000Z" title="Tue Feb 10 2026 04:03:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    19
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style>
<h2 data-id="heading-0">ä¸€ã€é¡¹ç›®èƒŒæ™¯</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Ftdesign.tencent.com%2F" target="_blank" title="https://tdesign.tencent.com/" ref="nofollow noopener noreferrer">TDesign</a> æ˜¯è…¾è®¯å¼€æºçš„ä¼ä¸šçº§è®¾è®¡ä½“ç³»ï¼Œè¦†ç›–äº† Vue Nextã€UniAppã€å°ç¨‹åºã€Mobile Vue ç­‰å¤šä¸ªæŠ€æœ¯æ ˆï¼Œå…¶å®˜ç½‘æ‰¿è½½ç€å¤§é‡ç»„ä»¶æ–‡æ¡£é¡µé¢ã€‚éšç€ç«™ç‚¹è§„æ¨¡å¢é•¿ï¼Œä¸€ä¸ªæ ¸å¿ƒé£é™©å§‹ç»ˆå­˜åœ¨â€”â€”<strong>é¡µé¢å‘å¸ƒåç™½å±</strong>æˆ–<strong>å…³é”®å…ƒç´ ä¸¢å¤±</strong>ã€‚æ‰‹å·¥å·¡æ£€ä¸ç°å®ï¼Œä¼ ç»Ÿçš„å•å…ƒæµ‹è¯•åˆè¦†ç›–ä¸åˆ°çœŸå®æµè§ˆå™¨çš„æ¸²æŸ“é“¾è·¯ã€‚</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FTDesignOteam%2Ftdesign-e2e-test" target="_blank" title="https://github.com/TDesignOteam/tdesign-e2e-test" ref="nofollow noopener noreferrer">tdesign-e2e-test</a> æ­£æ˜¯ä¸ºè§£å†³è¿™ä¸€é—®é¢˜è€Œè®¾è®¡çš„ï¼šåŸºäº <strong>Puppeteer + Jest</strong>ï¼Œé€šè¿‡ <strong>çº¯é…ç½®é©±åŠ¨</strong> çš„æ–¹å¼ï¼Œè®©å¼€å‘è€…åªéœ€ç¼–å†™ JSON é£æ ¼çš„é…ç½®å¯¹è±¡ï¼Œå³å¯è‡ªåŠ¨ç”Ÿæˆå®Œæ•´çš„ E2E æµ‹è¯•ç”¨ä¾‹ï¼Œ<strong>é›¶æµ‹è¯•ä»£ç ç¼–å†™</strong>ã€‚</p>
<hr/>
<h2 data-id="heading-1">äºŒã€æ•´ä½“æ¶æ„</h2>
<p>é¡¹ç›®é‡‡ç”¨ <strong>"é…ç½®å±‚ â†’ å¼•æ“å±‚ â†’ å·¥å…·å±‚"</strong> ä¸‰å±‚æ¶æ„ï¼Œå„å±‚èŒè´£æ¸…æ™°ã€äº’ä¸è€¦åˆï¼š</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB
    subgraph é…ç½®å±‚["ğŸ“‚ é…ç½®å±‚ (tests/config/)"]
        types["types.ts&lt;br/&gt;ç±»å‹å®šä¹‰"]
        modules["modules/&lt;br/&gt;æ¨¡å—åŒ–é…ç½®"]
        entry["pages.config.ts&lt;br/&gt;é…ç½®æ±‡æ€»å…¥å£"]
        modules --&gt; entry
        types -.-&gt; modules
    end

    subgraph å¼•æ“å±‚["âš™ï¸ å¼•æ“å±‚ (tests/)"]
        spec["tdesign.spec.ts&lt;br/&gt;æµ‹è¯•å¼•æ“&lt;br/&gt;è‡ªåŠ¨éå†é…ç½® â†’ ç”Ÿæˆç”¨ä¾‹"]
    end

    subgraph å·¥å…·å±‚["ğŸ”§ å·¥å…·å±‚ (tests/utils/)"]
        helpers["helpers.ts&lt;br/&gt;ç™½å±æ£€æµ‹ / å…ƒç´ æ£€æµ‹&lt;br/&gt;Shadow DOM ç©¿é€&lt;br/&gt;æ“ä½œæ‰§è¡Œå™¨"]
    end

    subgraph CI["ğŸš€ CI/CD"]
        workflow["GitHub Actions&lt;br/&gt;å®šæ—¶ + Push è§¦å‘"]
        notify["scripts/notify.ts&lt;br/&gt;ä¼ä¸šå¾®ä¿¡æœºå™¨äººé€šçŸ¥"]
        workflow --&gt; notify
    end

    entry --&gt; spec
    spec --&gt; helpers
    spec --&gt; CI
</code></pre>
<h3 data-id="heading-2">2.1 é…ç½®å±‚ï¼šå£°æ˜å¼æè¿°"æµ‹ä»€ä¹ˆ"</h3>
<p>é…ç½®å±‚æ˜¯ç”¨æˆ·å”¯ä¸€éœ€è¦å…³æ³¨çš„éƒ¨åˆ†ã€‚æ ¸å¿ƒç±»å‹ <code>PageConfig</code> å®šä¹‰äº†ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹çš„å®Œæ•´æè¿°ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">PageConfig</span> {
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;                <span class="hljs-comment">// ç”¨ä¾‹åç§°</span>
  <span class="hljs-attr">url</span>: <span class="hljs-built_in">string</span>;                 <span class="hljs-comment">// ç›®æ ‡é¡µé¢</span>
  whiteScreenCheck?: <span class="hljs-built_in">boolean</span>;  <span class="hljs-comment">// æ˜¯å¦ç™½å±æ£€æµ‹</span>
  expectedSelectors?: <span class="hljs-built_in">string</span>[];<span class="hljs-comment">// æœŸæœ›å­˜åœ¨çš„å…ƒç´ </span>
  actions?: <span class="hljs-title class_">PageAction</span>[];      <span class="hljs-comment">// æ“ä½œåºåˆ—ï¼ˆç‚¹å‡»/æ‚¬æµ®/å¯¼èˆª/æ»šåŠ¨/è¾“å…¥ï¼‰</span>
  afterActionCheck?: <span class="hljs-title class_">AfterActionCheck</span>; <span class="hljs-comment">// æ“ä½œåæ ¡éªŒ</span>
  viewport?: { width; height };<span class="hljs-comment">// è‡ªå®šä¹‰è§†å£</span>
  skip?: <span class="hljs-built_in">boolean</span>;              <span class="hljs-comment">// è·³è¿‡æ ‡è®°</span>
}
</code></pre>
<p>ä½¿ç”¨è€…åªéœ€å¡«å†™é…ç½®å¯¹è±¡ï¼Œ<strong>ä¸éœ€è¦ç¼–å†™ä»»ä½• <code>test()</code>ã€<code>expect()</code> ä»£ç </strong>ã€‚æ¡†æ¶ä¼šè‡ªåŠ¨å°†æ¯æ¡é…ç½®æ˜ å°„ä¸ºä¸€ä¸ªç‹¬ç«‹çš„ Jest æµ‹è¯•ç”¨ä¾‹ã€‚</p>
<h3 data-id="heading-3">2.2 å¼•æ“å±‚ï¼šè‡ªåŠ¨åŒ–éå† + ç”¨ä¾‹ç”Ÿæˆ</h3>
<p><code>tdesign.spec.ts</code> æ˜¯æ•´ä¸ªæ¡†æ¶çš„"å¿ƒè„"ï¼Œæ ¸å¿ƒé€»è¾‘ä»…çº¦ 120 è¡Œï¼Œä½†å®Œæˆäº†ä»¥ä¸‹å·¥ä½œï¼š</p>
<ol>
<li><strong>å¯åŠ¨æµè§ˆå™¨</strong>ï¼š<code>beforeAll</code> ä¸­åˆå§‹åŒ– Puppeteerï¼ŒCI ç¯å¢ƒè‡ªåŠ¨åˆ‡æ¢ headless æ¨¡å¼</li>
<li><strong>éå†é…ç½®ã€ç”Ÿæˆç”¨ä¾‹</strong>ï¼š<code>for (const pageConfig of pagesConfig)</code> å¾ªç¯ï¼Œä¸ºæ¯æ¡é…ç½®åŠ¨æ€ç”Ÿæˆ <code>test()</code></li>
<li><strong>æ ‡å‡†åŒ–æµ‹è¯•æµç¨‹</strong>ï¼šæ¯ä¸ªç”¨ä¾‹æŒ‰ç»Ÿä¸€ç®¡çº¿æ‰§è¡Œâ€”â€”è®¾ç½®è§†å£ â†’ æ³¨å†Œé”™è¯¯æ”¶é›† â†’ è®¿é—®é¡µé¢ â†’ ç­‰å¾…ç½‘ç»œç©ºé—² â†’ ç™½å±æ£€æµ‹ â†’ å…ƒç´ æ£€æµ‹ â†’ æ‰§è¡Œæ“ä½œ â†’ æ“ä½œåæ ¡éªŒ</li>
<li><strong>èµ„æºç®¡ç†</strong>ï¼šæ¯ä¸ªç”¨ä¾‹ç‹¬ç«‹å¼€å¯/å…³é—­ Pageï¼Œ<code>afterAll</code> ä¸­å…³é—­æµè§ˆå™¨ï¼Œæœç»å†…å­˜æ³„æ¼</li>
</ol>
<p>è¿™ç§è®¾è®¡è®©å¼•æ“å±‚æˆä¸º"ä¸å¯å˜çš„éª¨æ¶"â€”â€”<strong>æ–°å¢æµ‹è¯•ç”¨ä¾‹æ°¸è¿œä¸éœ€è¦ä¿®æ”¹å¼•æ“ä»£ç </strong>ã€‚</p>
<h3 data-id="heading-4">2.3 å·¥å…·å±‚ï¼šå¯¹æŠ— Web Components çš„æ·±åº¦ç©¿é€</h3>
<p>TDesign å®˜ç½‘å¤§é‡ä½¿ç”¨äº† Web Components + Shadow DOMï¼ˆå¦‚ <code>&lt;td-header&gt;</code>ã€<code>&lt;td-doc-layout&gt;</code>ï¼‰ï¼Œä¼ ç»Ÿçš„ <code>document.querySelector</code> æ— æ³•ç©¿é€ Shadow DOM è¾¹ç•Œã€‚</p>
<p><code>helpers.ts</code> ä¸­å®ç°äº†ä¸€å¥— <strong>é€’å½’ç©¿é€ Shadow DOM çš„é€‰æ‹©å™¨å¼•æ“</strong>ï¼Œè¿™æ˜¯æ•´ä¸ªé¡¹ç›®æœ€æœ‰æŠ€æœ¯å«é‡çš„éƒ¨åˆ†ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-built_in">deepQuerySelector</span>(page, selector)
â”‚
â”œâ”€â”€ æ™®é€šé€‰æ‹©å™¨ <span class="hljs-string">".TDesign-header"</span>
â”‚   â””â”€â”€ é€’å½’éå†æ‰€æœ‰ ShadowRoot + Slot åˆ†å‘å†…å®¹
â”‚
â””â”€â”€ ç©¿é€ç»„åˆé€‰æ‹©å™¨ <span class="hljs-string">"td-header &gt;&gt;&gt; .TDesign-header-nav"</span>
    â””â”€â”€ æŒ‰ <span class="hljs-string">"&gt;&gt;&gt;"</span> åˆ†æ®µï¼Œé€å±‚è¿›å…¥ Shadow DOM
</code></pre>
<p>æ­¤å¤–ï¼Œ<code>waitForVisible()</code> å®ç°äº†è½®è¯¢ç­‰å¾…æœºåˆ¶ï¼Œä¸ä»…æ£€æŸ¥å…ƒç´ å­˜åœ¨ï¼Œè¿˜éªŒè¯å…¶çœŸå®å¯è§æ€§ï¼ˆ<code>getBoundingClientRect</code> + <code>getComputedStyle</code>ï¼‰ï¼Œé¿å… <code>display:none</code> æˆ–é›¶å°ºå¯¸å…ƒç´ çš„è¯¯åˆ¤ã€‚</p>
<p><strong>ç™½å±æ£€æµ‹</strong> é‡‡ç”¨ 4 å±‚é€’è¿›ç­–ç•¥ï¼š</p>






























<table><thead><tr><th>å±‚çº§</th><th>æ£€æµ‹é¡¹</th><th>ç›®çš„</th></tr></thead><tbody><tr><td>1</td><td><code>body.children.length &gt; 0</code></td><td>æ’é™¤å®Œå…¨ç©ºç™½é¡µ</td></tr><tr><td>2</td><td><code>body.innerHTML.length &gt; 50</code></td><td>æ’é™¤ä»…æœ‰ç©ºæ ‡ç­¾å£³</td></tr><tr><td>3</td><td>é€’å½’ç©¿é€ Shadow DOM æ‰¾å¯è§å†…å®¹</td><td>æ’é™¤ Web Components å†…éƒ¨ç™½å±</td></tr><tr><td>4</td><td>æ£€æŸ¥ SPA æ ¹æŒ‚è½½ç‚¹ + è‡ªå®šä¹‰å…ƒç´ </td><td>æ’é™¤æ¡†æ¶æœªæŒ‚è½½</td></tr></tbody></table>
<p>å››å±‚ç­–ç•¥ç›¸äº’è¡¥å……ï¼Œæ—¢èƒ½æ£€æµ‹ä¼ ç»Ÿ SPA ç™½å±ï¼Œä¹Ÿèƒ½è¦†ç›– Web Components åœºæ™¯ã€‚</p>
<hr/>
<h2 data-id="heading-5">ä¸‰ã€çµæ´»çš„é…ç½®æ–¹å¼</h2>
<h3 data-id="heading-6">3.1 äº”ç§æ“ä½œç±»å‹è¦†ç›–ä¸»æµäº¤äº’</h3>
<p>æ¡†æ¶å†…ç½®äº† 5 ç§æ“ä½œç±»å‹ï¼Œé€šè¿‡ç»„åˆä½¿ç”¨å¯ä»¥æ¨¡æ‹Ÿå‡ ä¹æ‰€æœ‰ç”¨æˆ·äº¤äº’åœºæ™¯ï¼š</p>



































<table><thead><tr><th>ç±»å‹</th><th>ç”¨é€”</th><th>å…³é”®å‚æ•°</th></tr></thead><tbody><tr><td><code>click</code></td><td>ç‚¹å‡»å…ƒç´ ï¼Œæ”¯æŒè‡ªåŠ¨ç­‰å¾…å¯¼èˆª</td><td><code>selector</code></td></tr><tr><td><code>hover</code></td><td>é¼ æ ‡æ‚¬æµ®ï¼ŒéªŒè¯æµ®å±‚/ä¸‹æ‹‰èœå•</td><td><code>selector</code></td></tr><tr><td><code>navigate</code></td><td>SPA è·¯ç”±è·³è½¬</td><td><code>targetUrl</code></td></tr><tr><td><code>scroll</code></td><td>é¡µé¢æ»šåŠ¨ï¼Œæµ‹è¯•æ‡’åŠ è½½</td><td><code>scrollY</code></td></tr><tr><td><code>input</code></td><td>æ–‡æœ¬è¾“å…¥ï¼Œæµ‹è¯•æœç´¢/è¡¨å•</td><td><code>selector</code> + <code>inputValue</code></td></tr></tbody></table>
<p>æ“ä½œæ”¯æŒ <code>waitBefore</code> / <code>waitAfter</code> ç²¾ç»†æ§åˆ¶æ—¶åºï¼Œä¹Ÿæ”¯æŒé“¾å¼ç»„åˆâ€”â€”å…ˆæ»šåŠ¨ã€å†ç‚¹å‡»ã€å†è¾“å…¥ï¼Œä¸€æ°”å‘µæˆã€‚</p>
<h3 data-id="heading-7">3.2 Shadow DOM ç©¿é€é€‰æ‹©å™¨</h3>
<p>é’ˆå¯¹ Web Componentsï¼Œæ¡†æ¶è®¾è®¡äº†ç›´è§‚çš„ <code>&gt;&gt;&gt;</code> ç©¿é€è¯­æ³•ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// å…ˆæ‰¾åˆ° &lt;td-header&gt;ï¼Œè¿›å…¥å…¶ Shadow DOMï¼Œå†æ‰¾ .TDesign-header-nav</span>
<span class="hljs-attr">selector</span>: <span class="hljs-string">'td-header &gt;&gt;&gt; .TDesign-header-nav'</span>
</code></pre>
<p>æ™®é€šé€‰æ‹©å™¨åˆ™è‡ªåŠ¨é€’å½’ç©¿é€æ‰€æœ‰å±‚çº§çš„ Shadow DOMï¼Œå¼€å‘è€…æ— éœ€å…³å¿ƒå…ƒç´ åœ¨å“ªä¸€å±‚ã€‚</p>
<h3 data-id="heading-8">3.3 æ“ä½œåæ ¡éªŒ</h3>
<p>æ¯æ¡é…ç½®å¯ä»¥é™„å¸¦ <code>afterActionCheck</code>ï¼Œåœ¨æ“ä½œæ‰§è¡Œåè‡ªåŠ¨éªŒè¯ï¼š</p>
<ul>
<li><strong>ç™½å±æ£€æµ‹</strong>ï¼šæ“ä½œåé¡µé¢æ˜¯å¦æ­£å¸¸æ¸²æŸ“</li>
<li><strong>å…ƒç´ æ£€æµ‹</strong>ï¼šæ“ä½œåç›®æ ‡å…ƒç´ æ˜¯å¦å‡ºç°</li>
<li><strong>URL æ ¡éªŒ</strong>ï¼šé€šè¿‡æ­£åˆ™åŒ¹é…éªŒè¯è·³è½¬æ˜¯å¦æ­£ç¡®</li>
</ul>
<hr/>
<h2 data-id="heading-9">å››ã€å¯æ‰©å±•æ€§è®¾è®¡</h2>
<h3 data-id="heading-10">4.1 æ¨¡å—åŒ–æ‹†åˆ†</h3>
<p>é…ç½®æŒ‰ TDesign å­ç«™æ‹†åˆ†ä¸ºç‹¬ç«‹æ¨¡å—ï¼Œå­˜æ”¾åœ¨ <code>tests/config/modules/</code> ç›®å½•ä¸‹ï¼š</p>
<pre><code class="hljs language-java" lang="java">modules/
â”œâ”€â”€ index.ts           â† ç»Ÿä¸€å¯¼å‡º
â”œâ”€â”€ home.ts            â† å®˜ç½‘é¦–é¡µ
â”œâ”€â”€ uniapp.ts          â† UniApp
â”œâ”€â”€ miniprogram.ts     â† å°ç¨‹åº
â”œâ”€â”€ vue-next.ts        â† Vue <span class="hljs-title function_">Next</span> <span class="hljs-params">(æ¡Œé¢ç«¯)</span>
â””â”€â”€ mobile-vue.ts      â† Mobile <span class="hljs-title function_">Vue</span> <span class="hljs-params">(ç§»åŠ¨ç«¯)</span>
</code></pre>
<p><code>pages.config.ts</code> ä½œä¸ºæ±‡æ€»å…¥å£ï¼Œé€šè¿‡å±•å¼€è¿ç®—ç¬¦åˆå¹¶æ‰€æœ‰æ¨¡å—ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> <span class="hljs-attr">config</span>: <span class="hljs-title class_">PageConfig</span>[] = [
  ...homePages,
  ...uniappPages,
  ...miniprogramPages,
  ...vueNextPages,
  ...mobileVuePages,
];
</code></pre>
<h3 data-id="heading-11">4.2 æ–°å¢æ¨¡å—åªéœ€ 3 æ­¥</h3>
<p>ä»¥æ–°å¢ React æ¨¡å—ä¸ºä¾‹ï¼š</p>
<ol>
<li><strong>åˆ›å»º</strong> <code>modules/react.ts</code>ï¼Œå¯¼å‡º <code>PageConfig[]</code> æ•°ç»„</li>
<li><strong>æ³¨å†Œ</strong> åœ¨ <code>modules/index.ts</code> ä¸­æ·»åŠ ä¸€è¡Œ <code>export</code></li>
<li><strong>åˆå¹¶</strong> åœ¨ <code>pages.config.ts</code> ä¸­å±•å¼€ <code>...reactPages</code></li>
</ol>
<p>æ•´ä¸ªè¿‡ç¨‹ä¸éœ€è¦ä¿®æ”¹å¼•æ“ä»£ç ã€ä¸éœ€è¦æ–°å»ºæµ‹è¯•æ–‡ä»¶ã€ä¸éœ€è¦æ”¹åŠ¨ CI é…ç½®ã€‚</p>
<h3 data-id="heading-12">4.3 æ–°å¢æ“ä½œç±»å‹</h3>
<p>å¦‚æœæœªæ¥éœ€è¦æ”¯æŒæ–°çš„äº¤äº’ï¼ˆå¦‚æ‹–æ‹½ã€é•¿æŒ‰ï¼‰ï¼Œåªéœ€ï¼š</p>
<ol>
<li>åœ¨ <code>PageAction.type</code> è”åˆç±»å‹ä¸­æ–°å¢æšä¸¾å€¼</li>
<li>åœ¨ <code>helpers.ts</code> çš„ <code>executeActions</code> ä¸­æ–°å¢ <code>case</code> åˆ†æ”¯</li>
</ol>
<p>å¼•æ“å±‚å’Œé…ç½®å±‚å®Œå…¨ä¸å—å½±å“ï¼Œä½“ç°äº† <strong>å¼€é—­åŸåˆ™ï¼ˆOCPï¼‰</strong>ã€‚</p>
<hr/>
<h2 data-id="heading-13">äº”ã€æ˜“ç»´æŠ¤æ€§</h2>
<h3 data-id="heading-14">5.1 TypeScript å…¨é“¾è·¯ç±»å‹å®‰å…¨</h3>
<p>ä»é…ç½®å®šä¹‰åˆ°å¼•æ“æ¶ˆè´¹ï¼Œå…¨ç¨‹ TypeScript å¼ºç±»å‹ã€‚<code>PageConfig</code> æ¥å£ç¡®ä¿ï¼š</p>
<ul>
<li>æ‹¼é”™å­—æ®µå â†’ ç¼–è¯‘æŠ¥é”™</li>
<li>é—æ¼å¿…å¡«å­—æ®µ â†’ ç¼–è¯‘æŠ¥é”™</li>
<li><code>action.type</code> ä¼ å…¥æœªçŸ¥å€¼ â†’ ç¼–è¯‘æŠ¥é”™</li>
</ul>
<p>ç±»å‹ç³»ç»Ÿå……å½“äº†"æ´»æ–‡æ¡£"ï¼Œå¼€å‘è€…é˜…è¯»æ¥å£å®šä¹‰å³å¯ç†è§£æ‰€æœ‰é…ç½®é¡¹ã€‚</p>
<h3 data-id="heading-15">5.2 é…ç½®ä¸ä»£ç å®Œå…¨è§£è€¦</h3>
<p>è¿™æ˜¯é¡¹ç›®æœ€æ ¸å¿ƒçš„è®¾è®¡ç†å¿µï¼š<strong>æµ‹è¯•é€»è¾‘æ˜¯ç¨³å®šçš„æ¡†æ¶ä»£ç ï¼Œæµ‹è¯•å†…å®¹æ˜¯å¯å˜çš„é…ç½®æ•°æ®</strong>ã€‚</p>
<ul>
<li>æ–°å¢é¡µé¢ï¼Ÿâ†’ åªæ”¹é…ç½®</li>
<li>é¡µé¢æ”¹ç‰ˆï¼Ÿâ†’ åªæ”¹é€‰æ‹©å™¨</li>
<li>æ–°å¢æ£€æµ‹ç»´åº¦ï¼Ÿâ†’ åªæ”¹å·¥å…·å‡½æ•°</li>
</ul>
<p>ä¸‰ä¸ªå˜æ›´æ–¹å‘äº’ä¸å¹²æ‰°ï¼Œå›¢é˜Ÿä¸­ä¸åŒè§’è‰²å¯ä»¥å¹¶è¡Œå·¥ä½œã€‚</p>
<h3 data-id="heading-16">5.3 è‡ªåŠ¨åŒ– CI/CD + å‘Šè­¦é—­ç¯</h3>
<p>é¡¹ç›®é›†æˆäº† <a href="/Users/guowangyang/Documents/github/tdesign-e2e/.github/workflows/e2e-test.yml" target="_blank" title="/Users/guowangyang/Documents/github/tdesign-e2e/.github/workflows/e2e-test.yml">GitHub Actions å·¥ä½œæµ</a>ï¼Œå®ç°äº†å®Œæ•´çš„è‡ªåŠ¨åŒ–é—­ç¯ï¼š</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph LR
    A["â° å®šæ—¶è§¦å‘&lt;br/&gt;æ¯ 10 åˆ†é’Ÿ"] --&gt; B["ğŸ§ª æ‰§è¡Œ E2E æµ‹è¯•"]
    C["ğŸ“¦ master Push"] --&gt; B
    D["ğŸ–±ï¸ æ‰‹åŠ¨è§¦å‘"] --&gt; B
    B --&gt;|é€šè¿‡| E["âœ… ä¸Šä¼ æµ‹è¯•æŠ¥å‘Š"]
    B --&gt;|å¤±è´¥| F["ğŸ“¤ ä¼ä¸šå¾®ä¿¡é€šçŸ¥&lt;br/&gt;å¤±è´¥ç”¨ä¾‹ + Actions é“¾æ¥"]
    F --&gt; E
</code></pre>
<p><code>notify.ts</code> é€šçŸ¥è„šæœ¬ä¼šè‡ªåŠ¨è§£æ Jest JSON è¾“å‡ºï¼Œæå–å¤±è´¥ç”¨ä¾‹çš„åç§°å’Œé”™è¯¯ä¿¡æ¯ï¼Œæ ¼å¼åŒ–ä¸º Markdown æ¶ˆæ¯æ¨é€åˆ°ä¼ä¸šå¾®ä¿¡ï¼ŒåŒ…å«ç›´è¾¾ Actions æ—¥å¿—çš„é“¾æ¥ã€‚</p>
<h3 data-id="heading-17">5.4 å®¹é”™è®¾è®¡</h3>
<p>æ¡†æ¶åœ¨å¤šå¤„åšäº†å®¹é”™å¤„ç†ï¼Œä¿è¯å•ä¸ªç”¨ä¾‹å¤±è´¥ä¸ä¼šæ‹–å®æ•´ä¸ªæµ‹è¯•ï¼š</p>
<ul>
<li><code>networkIdle</code> è¶…æ—¶ä¸é˜»å¡æµ‹è¯•ï¼ˆ<code>.catch(() =&gt; {})</code>ï¼‰</li>
<li>å¯¼èˆªè¶…æ—¶é™é»˜å¤„ç†ï¼ˆé€‚åº” SPA æ— å¯¼èˆªåœºæ™¯ï¼‰</li>
<li>æ¯ä¸ªç”¨ä¾‹ç‹¬ç«‹å¼€å¯/å…³é—­ Pageï¼Œ<code>finally</code> å—ç¡®ä¿èµ„æºé‡Šæ”¾</li>
<li>æ§åˆ¶å°é”™è¯¯ä»…è®°å½•å‘Šè­¦ï¼Œä¸ç›´æ¥åˆ¤å®šå¤±è´¥</li>
<li><code>skip</code> æ ‡è®°æ”¯æŒä¸´æ—¶è·³è¿‡ä¸ç¨³å®šç”¨ä¾‹</li>
</ul>
<hr/>
<h2 data-id="heading-18">å…­ã€æŠ€æœ¯äº®ç‚¹æ€»ç»“</h2>





































<table><thead><tr><th>äº®ç‚¹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>é…ç½®é©±åŠ¨ï¼Œé›¶ä»£ç æµ‹è¯•</strong></td><td>ä½¿ç”¨è€…åªå†™é…ç½®å¯¹è±¡ï¼Œæ¡†æ¶è‡ªåŠ¨ç”Ÿæˆæµ‹è¯•ç”¨ä¾‹</td></tr><tr><td><strong>Shadow DOM æ·±åº¦ç©¿é€</strong></td><td>é€’å½’éå† + <code>&gt;&gt;&gt;</code> ç©¿é€è¯­æ³•ï¼Œå®Œç¾é€‚é… Web Components</td></tr><tr><td><strong>4 å±‚ç™½å±æ£€æµ‹ç­–ç•¥</strong></td><td>DOM ç»“æ„ + å†…å®¹é•¿åº¦ + å¯è§æ€§ + SPA æŒ‚è½½ç‚¹ï¼Œå¤šç»´åº¦äº¤å‰éªŒè¯</td></tr><tr><td><strong>æ¨¡å—åŒ–é…ç½®æ¶æ„</strong></td><td>æŒ‰å­ç«™æ‹†åˆ†ï¼Œæ–°å¢æ¨¡å— 3 æ­¥å®Œæˆï¼Œé›¶è€¦åˆ</td></tr><tr><td><strong>å…¨é“¾è·¯ TypeScript</strong></td><td>é…ç½®åˆ°æ‰§è¡Œå…¨ç¨‹ç±»å‹å®‰å…¨ï¼Œæ‹¼é”™å³æŠ¥é”™</td></tr><tr><td><strong>è‡ªåŠ¨åŒ–å‘Šè­¦é—­ç¯</strong></td><td>å®šæ—¶å·¡æ£€ â†’ å¤±è´¥æ£€æµ‹ â†’ ä¼ä¸šå¾®ä¿¡æ¨é€ â†’ Actions æ—¥å¿—æº¯æº</td></tr><tr><td><strong>å®¹é”™éš”ç¦»è®¾è®¡</strong></td><td>å•ç”¨ä¾‹å¤±è´¥ä¸æ‰©æ•£ï¼Œèµ„æºè‡ªåŠ¨å›æ”¶ï¼Œè¶…æ—¶é™é»˜é™çº§</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-19">ä¸ƒã€é€‚ç”¨åœºæ™¯</h2>
<ul>
<li><strong>ç»„ä»¶åº“å®˜ç½‘å·¡æ£€</strong>ï¼šé˜²æ­¢å‘å¸ƒåç™½å±ã€å…³é”®æ–‡æ¡£å…ƒç´ ä¸¢å¤±</li>
<li><strong>å¤šæ¡†æ¶ç«™ç‚¹ç›‘æ§</strong>ï¼šä¸€å¥—æ¡†æ¶è¦†ç›– Vue / UniApp / å°ç¨‹åº / ç§»åŠ¨ç«¯ç­‰æ‰€æœ‰å­ç«™</li>
<li><strong>Web Components åœºæ™¯</strong>ï¼šå†…ç½® Shadow DOM ç©¿é€ï¼Œå¼€ç®±å³ç”¨</li>
<li><strong>å›¢é˜Ÿåä½œ</strong>ï¼šé…ç½®ä¸ä»£ç åˆ†ç¦»ï¼Œäº§å“/QA ä¹Ÿèƒ½ç¼–å†™æµ‹è¯•é…ç½®</li>
</ul>
<p>è¿™å¥—æ¡†æ¶çš„è®¾è®¡å“²å­¦æ˜¯ï¼š<strong>æŠŠæµ‹è¯•çš„å¤æ‚æ€§å°è£…è¿›æ¡†æ¶ï¼ŒæŠŠæµ‹è¯•çš„ç®€å•æ€§äº¤è¿˜ç»™ç”¨æˆ·</strong>ã€‚å¼€å‘è€…åªéœ€è¦å›ç­”"æµ‹å“ªä¸ªé¡µé¢ã€æ£€æŸ¥ä»€ä¹ˆå…ƒç´ ã€æ‰§è¡Œä»€ä¹ˆæ“ä½œ"ï¼Œå‰©ä¸‹çš„ä¸€åˆ‡â€”â€”æµè§ˆå™¨ç®¡ç†ã€Shadow DOM ç©¿é€ã€ç™½å±åˆ¤å®šã€CI è°ƒåº¦ã€å¤±è´¥å‘Šè­¦â€”â€”å…¨éƒ¨ç”±æ¡†æ¶æ¥ç®¡ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å‰ç«¯ä¹Ÿèƒ½ææ¨¡å‹ï¼Ÿåœ¨æµè§ˆå™¨é‡Œè·‘ Qwen2.5ï¼Œæˆ‘ç»™å…¬å¸çœäº† 5 ä¸‡ API è´¹ç”¨]]></title>    <link>https://juejin.cn/post/7604741630448893986</link>    <guid>https://juejin.cn/post/7604741630448893986</guid>    <pubDate>2026-02-10T04:17:43.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604741630448893986" data-draft-id="7604671453454090255" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å‰ç«¯ä¹Ÿèƒ½ææ¨¡å‹ï¼Ÿåœ¨æµè§ˆå™¨é‡Œè·‘ Qwen2.5ï¼Œæˆ‘ç»™å…¬å¸çœäº† 5 ä¸‡ API è´¹ç”¨"/> <meta itemprop="keywords" content="å‰ç«¯,JavaScript,AIç¼–ç¨‹"/> <meta itemprop="datePublished" content="2026-02-10T04:17:43.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ErpanOmer"/> <meta itemprop="url" content="https://juejin.cn/user/3878732754331096"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å‰ç«¯ä¹Ÿèƒ½ææ¨¡å‹ï¼Ÿåœ¨æµè§ˆå™¨é‡Œè·‘ Qwen2.5ï¼Œæˆ‘ç»™å…¬å¸çœäº† 5 ä¸‡ API è´¹ç”¨
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3878732754331096/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ErpanOmer
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T04:17:43.000Z" title="Tue Feb 10 2026 04:17:43 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/34fe2125c5044ab7af251979e55cb917~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRXJwYW5PbWVy:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771301869&amp;x-signature=cpeVAVvHSWB4MpoWcEcLhRAdhYM%3D" alt="run-qwen-locally.webp" loading="lazy"/></p>
<p>æœˆåˆï¼Œè´¢åŠ¡æŠŠä¸Šä¸ªæœˆçš„ OpenAI è´¦å•ç”©åœ¨äº† å’±ä»¬ CTO çš„æ¡Œå­ä¸Šã€‚</p>
<p>æ•°å­—å¾ˆæƒŠäººï¼š<strong>9000 åˆ€</strong>ã€‚</p>
<p>æˆ‘ä»¬é‚£ä¸ªæ‰€è°“<strong>AI èµ‹èƒ½</strong> çš„å†…éƒ¨çŸ¥è¯†åº“åŠ©æ‰‹ï¼Œæ¯ä¸ªæœˆå…‰ Token è´¹å°±è¦çƒ§æ‰ä¸€è¾†æ¯”äºšè¿ªç§¦PLUSğŸ˜ƒã€‚</p>
<p>è€æ¿åœ¨ä¼šä¸Šæ‹æ¡Œå­ï¼šä¸å°±æ˜¯ä¸ªæŸ¥æ–‡æ¡£çš„æœºå™¨äººå—ï¼Ÿä¸ºä»€ä¹ˆè¦ç”¨ GPT-5ï¼Ÿèƒ½ä¸èƒ½æ¢ä¾¿å®œçš„ï¼Ÿèƒ½ä¸èƒ½é™æµï¼ŸGPT-4o æˆ–è€… GPT-4o mini å°±è¡Œ?</p>
<p>åç«¯æ¶æ„å¸ˆé¢éœ²éš¾è‰²ï¼šç²¾åº¦è¦æ±‚é«˜å•Šï¼Œæ¢ GPT-4o å°±å˜æ™ºéšœã€‚è‡ªéƒ¨ç½²ï¼Ÿé‚£å¾—ä¹° H100 æ˜¾å¡ï¼Œæ›´è´µã€‚ğŸ˜–</p>
<p>ä¼šè®®å®¤é‡Œå……æ»¡äº†<strong>è´«ç©·ä¸”ç„¦è™‘</strong>çš„ç©ºæ°”ã€‚</p>
<p>è¿™æ—¶å€™ï¼Œæˆ‘é»˜é»˜åˆä¸Šäº†ç¬”è®°æœ¬ï¼Œè¯´äº†ä¸€å¥ï¼š<strong>è¦ä¸ï¼ŒæŠŠæ¨¡å‹è·‘åœ¨å‰ç«¯å§ï¼Ÿè®©ç”¨æˆ·çš„æ˜¾å¡å¸®æˆ‘ä»¬ç®—ã€‚</strong></p>
<p>å…¨åœºå®‰é™äº†ä¸‰ç§’ã€‚</p>
<p>åç«¯ç»„é•¿æ²¡å¿ä½ç¬‘äº†ï¼šæµè§ˆå™¨è·‘å¤§æ¨¡å‹ï¼Ÿä½ å½“ Chrome æ˜¯ 4090 å‘¢ï¼Ÿè·‘ä¸ª Three.js éƒ½èƒ½å¡ï¼Œè¿˜è¦è·‘ Llama 3ï¼ŸğŸ˜¥</p>
<p>æˆ‘ä¸å“ã€‚</p>
<p>å¦‚æœä½ ä¸çŸ¥é“ <a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FAPI%2FWebGPU_API" target="_blank" title="https://developer.mozilla.org/en-US/docs/Web/API/WebGPU_API" ref="nofollow noopener noreferrer"><strong>WebGPU</strong></a>ï¼Œé‚£æˆ‘ä»¬ç¡®å®æ²¡æ³•èŠã€‚</p>
<hr/>
<h3 data-id="heading-0">ä½ çš„æµè§ˆå™¨å°±æ˜¯æ˜¾å¡</h3>
<p>å…„å¼Ÿï¼Œæ—¶ä»£å˜äº†ğŸ¤·â€â™‚ï¸ã€‚</p>
<p>åœ¨å¤§å¤šæ•°äººçš„è®¤çŸ¥é‡Œï¼Œå‰ç«¯å°±æ˜¯åˆ‡å›¾ã€è°ƒ APIã€å†™ React ç»„ä»¶ã€‚</p>
<p>è®¡ç®—ï¼Ÿé‚£æ˜¯æœåŠ¡å™¨çš„äº‹ã€‚</p>
<p>ä½†ä½ æœ‰æ²¡æœ‰æƒ³è¿‡ï¼Œç°åœ¨çš„ç”¨æˆ·æ‰‹é‡Œæ‹¿çš„æ˜¯ä»€ä¹ˆè®¾å¤‡ï¼Ÿ</p>
<p><strong>M3 èŠ¯ç‰‡çš„ MacBookï¼ŒRTX 4060 çš„æ¸¸æˆæœ¬ï¼Œç”šè‡³ iPhone 15 Proã€‚</strong></p>
<p>è¿™äº›è®¾å¤‡çš„ç®—åŠ›ï¼Œå¦‚æœä¸åˆ©ç”¨èµ·æ¥ï¼Œç®€ç›´å°±æ˜¯<strong>æš´æ®„å¤©ç‰©</strong>ã€‚</p>
<p>æˆ‘ä»¬ç°åœ¨åšçš„ï¼Œå« <strong>Edge AIï¼ˆè¾¹ç¼˜ AIï¼‰</strong> ã€‚</p>
<p>æ ¸å¿ƒæŠ€æœ¯å°±ä¸‰ä¸ªè¯ï¼š<strong>WebGPU + WebAssembly + é‡åŒ–æ¨¡å‹</strong>ã€‚</p>
<p>ä»¥å‰æµè§ˆå™¨åªèƒ½ç”¨ CPU è·‘ JSï¼Œæ…¢å¾—åƒèœ—ç‰›ã€‚</p>
<p>ç°åœ¨æœ‰äº† WebGPUï¼ŒJavaScript å¯ä»¥ç›´æ¥è°ƒç”¨åº•å±‚çš„æ˜¾å¡ç®—åŠ›ã€‚</p>
<p>å†åŠ ä¸Š <a href="https://link.juejin.cn?target=https%3A%2F%2Fwebllm.mlc.ai%2F" target="_blank" title="https://webllm.mlc.ai/" ref="nofollow noopener noreferrer"><strong>WebLLM ğŸ¤–</strong></a> è¿™ç§å¤§æ€å™¨ï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥æŠŠ <strong>Llama-3-8B-Instruct</strong> è¿™ç§çº§åˆ«çš„æ¨¡å‹ï¼Œç»è¿‡ <strong>4bit é‡åŒ–</strong> åï¼Œå‹ç¼©åˆ° 3-4GBï¼Œç›´æ¥å¡è¿›æµè§ˆå™¨é‡Œã€‚</p>
<p><strong>è¿™æ„å‘³ç€ä»€ä¹ˆï¼Ÿ</strong></p>
<p>æ„å‘³ç€æ¯ä¸€æ¬¡å¯¹è¯ï¼Œä¸å†æ¶ˆè€—å…¬å¸çš„ Tokenï¼Œè€Œæ˜¯æ¶ˆè€—<strong>ç”¨æˆ·è‡ªå·±çš„ç”µè´¹</strong>ã€‚</p>
<p>å¬èµ·æ¥æ˜¯ä¸æ˜¯æœ‰ç‚¹èµ„æœ¬å®¶ï¼Ÿ</p>
<p>ä¸ï¼Œè¿™å«<strong>åˆ†å¸ƒå¼è®¡ç®—</strong>ï¼Œå“ˆå“ˆå“ˆå“ˆå“ˆã€‚ğŸ˜</p>
<hr/>
<h3 data-id="heading-1">å…ˆè®© Chrome è·‘èµ·æ¥</h3>
<p>è¯´å¹²å°±å¹²ã€‚</p>
<p>æˆ‘æ²¡ç”¨åç«¯çš„ä¸€è¡Œä»£ç ã€‚</p>
<p>ç›´æ¥ <code>npm install @mlc-ai/web-llm</code>ã€‚</p>
<p>æ ¸å¿ƒé€»è¾‘å°±è¿™ä¹ˆå‡ è¡Œï¼ˆä¼ªä»£ç ï¼‰ï¼Œå¤§å®¶å¯ä»¥è‡ªå·±å»è¯•ä¸€ä¸‹ï¼š</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">CreateMLCEngine</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@mlc-ai/web-llm"</span>;

<span class="hljs-comment">// é€‰æœ€å°ä¸”ç¨³å®šçš„Qwen2.5,å…ˆä¿è¯èƒ½è·‘èµ·æ¥</span>
<span class="hljs-keyword">const</span> modelId = <span class="hljs-string">"Qwen2.5-0.5B-Instruct-q4f32_1-MLC"</span>;

<span class="hljs-comment">// åˆå§‹åŒ–å¼•æ“ï¼ˆWebGPUï¼‰</span>
<span class="hljs-keyword">const</span> engine = <span class="hljs-keyword">await</span> <span class="hljs-title class_">CreateMLCEngine</span>(modelId, {
  <span class="hljs-attr">initProgressCallback</span>: <span class="hljs-function">(<span class="hljs-params">p</span>) =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"[MLC]"</span>, p.<span class="hljs-property">text</span>);
  },
});

<span class="hljs-comment">// æ§åˆ¶å°å¯¹è¯</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">ask</span>(<span class="hljs-params">text: string</span>) {
  <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> engine.<span class="hljs-property">chat</span>.<span class="hljs-property">completions</span>.<span class="hljs-title function_">create</span>({
    <span class="hljs-attr">messages</span>: [{ <span class="hljs-attr">role</span>: <span class="hljs-string">"user"</span>, <span class="hljs-attr">content</span>: text }],
  });
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"ğŸ¤–"</span>, res.<span class="hljs-property">choices</span>[<span class="hljs-number">0</span>].<span class="hljs-property">message</span>.<span class="hljs-property">content</span>);
}

<span class="hljs-comment">// æµ‹è¯•</span>
<span class="hljs-keyword">await</span> <span class="hljs-title function_">ask</span>(<span class="hljs-string">"å†™ä¸€ä¸ª React Button"</span>)
<span class="hljs-keyword">await</span> <span class="hljs-title function_">ask</span>(<span class="hljs-string">"ç”¨CSSå®ç°ä¸‰è§’å½¢"</span>)
<span class="hljs-keyword">await</span> <span class="hljs-title function_">ask</span>(<span class="hljs-string">"ç”¨Pythonå†™ä¸€ä¸ªå†’æ³¡æ’åº"</span>)

</code></pre>
<p>è¿è¡Œçš„é‚£ä¸€åˆ»ï¼Œæ¨¡å‹ä¼šè‡ªåŠ¨åŠ è½½ï¼ˆè®¾å¤‡é…ç½®ä½çš„åŒå­¦å°½é‡ç”¨å°æ¨¡å‹ğŸ™‚â€â†”ï¸ï¼‰
<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmlc-ai%2Fweb-llm%2Fblob%2Fmain%2Fsrc%2Fconfig.ts%23L313" target="_blank" title="https://github.com/mlc-ai/web-llm/blob/main/src/config.ts#L313" ref="nofollow noopener noreferrer">ğŸ‘‰ å¯ç”¨æ¨¡å‹</a></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ea96ea970286482ebf6359b5e77ede8b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRXJwYW5PbWVy:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771301869&amp;x-signature=9XHkhpQeC1HBWE%2FPbx%2BOpm8Ja9M%3D" alt="image.png" loading="lazy"/></p>
<blockquote>
<p>ASK: å†™ä¸€ä¸ª React Button</p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/58aa00282dfb4558a8ebaf3b0fe9ba82~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRXJwYW5PbWVy:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771301869&amp;x-signature=V01UYIzbY8joVVkIhlvK%2Bqad5ac%3D" alt="image.png" loading="lazy"/></p>
<blockquote>
<p>ASK: ç”¨CSSå®ç°ä¸‰è§’å½¢</p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b4184bfd3ef24b0d884154ca36e6c471~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRXJwYW5PbWVy:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771301869&amp;x-signature=HbFI%2BJIPT0lJ6IwRbH6OKFm1vIk%3D" alt="image.png" loading="lazy"/></p>
<blockquote>
<p>ASK: ç”¨Pythonå†™ä¸€ä¸ªå†’æ³¡æ’åº</p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ee8a472996b942bb88b529874d1130e5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRXJwYW5PbWVy:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771301869&amp;x-signature=sBBsPLUr%2BE8hM8ILX1X7ddcWDfI%3D" alt="image.png" loading="lazy"/></p>
<p>ä¸Šå‘¨ä¸€ï¼Œæˆ‘æŠŠ Demo å‘åˆ°äº†å…¬å¸ç¾¤é‡Œäº†ã€‚</p>
<p>é‚£ä¸ªå˜²ç¬‘æˆ‘çš„åç«¯ç»„é•¿ï¼Œæ‹¿ç€ä»–çš„ M1 MacBook Air ç‚¹å¼€äº†é“¾æ¥ã€‚</p>
<p>åˆæ¬¡åŠ è½½ç”¨äº† 40 ç§’ï¼ˆä¸‹è½½æ¨¡å‹æƒé‡ï¼‰ï¼Œç„¶å...</p>
<p><strong>Token ç”Ÿæˆé€Ÿåº¦ï¼š15 tokens/sã€‚</strong></p>
<p>ç”šè‡³æ¯” GPT-4 çš„ API å“åº”è¿˜è¦å¿«ï¼</p>
<p>å› ä¸ºè¿™æ˜¯<strong>æœ¬åœ°ç”Ÿæˆ</strong>ï¼Œæ²¡æœ‰ç½‘ç»œå»¶è¿Ÿã€‚</p>
<p>ä»–æŠ¬å¤´çœ‹æˆ‘ï¼šè¿™...çœŸçš„æ²¡è°ƒ APIï¼ŸğŸ˜–</p>
<p>æˆ‘æŒ‡äº†æŒ‡ Network é¢æ¿ï¼š<strong>0 è¯·æ±‚ï¼Œçº¯æœ¬åœ°ã€‚</strong></p>
<hr/>
<h3 data-id="heading-2">ç®—ä¸€ç¬”è´¦ï¼šè¿™ 5 ä¸‡å¤šæ˜¯æ€ä¹ˆçœå‡ºæ¥çš„</h3>
<p>æˆ‘ä»¬å†…éƒ¨æœ‰ 50 ä¸ªå‘˜å·¥ï¼Œæ¯ä¸ªäººæ¯å¤©å¹³å‡é—® 50 æ¬¡ã€‚</p>
<p>å¦‚æœæ˜¯ GPT-5ï¼Œä¸€å¹´å°±æ˜¯30å¤šä¸‡äº†ï¼ˆæ’é™¤å‡æœŸå’Œå‘¨æœ«ï¼‰ã€‚</p>
<p>ç°åœ¨å‘¢ï¼Ÿ</p>
<p><strong>æˆæœ¬ = CDN æµé‡è´¹ï¼ˆä¸‹è½½é‚£æ˜¯ 0.5GB æ¨¡å‹æ–‡ä»¶ï¼Œé»˜è®¤æœ€ä½æˆæœ¬å»ç®—ï¼‰ã€‚</strong></p>
<p>è€Œä¸”æ¨¡å‹æœ‰äº†ç¼“å­˜ï¼ˆCache Storageï¼‰åï¼Œç¬¬äºŒæ¬¡æ‰“å¼€å°±æ˜¯<strong>é›¶æˆæœ¬</strong>ã€‚</p>
<p>æ›´é‡è¦çš„æ˜¯<strong>æ•°æ®éšç§</strong>ã€‚</p>
<p>è´¢åŠ¡éƒ¨é‚£ä¸ªå§å§ä¹‹å‰æ­»æ´»ä¸æ•¢ç”¨ AI æœå‘ç¥¨æ”¿ç­–ï¼Œæ€•æ•°æ®ä¼ ç»™ OpenAI æ³„å¯†ã€‚</p>
<p>ç°åœ¨æˆ‘å‘Šè¯‰å¥¹ï¼šè¿™ä¸œè¥¿è·‘åœ¨ä½ è‡ªå·±çš„ç”µè„‘ä¸Šï¼Œæ–­ç½‘éƒ½èƒ½ç”¨ï¼Œæ•°æ®å‡ºä¸äº†è¿™ä¸ªæˆ¿é—´ã€‚</p>
<p>å¥¹çœ‹æˆ‘çš„çœ¼ç¥éƒ½å˜äº†ã€‚ğŸ¤©ğŸ˜ƒ</p>
<hr/>
<h3 data-id="heading-3">ä¹Ÿåˆ«ç¥è¯ï¼Œä¹Ÿæœ‰å‘çš„ï¼</h3>
<p>å½“ç„¶ï¼Œä¸ºäº†ä¿æŒæŠ€æœ¯äººçš„å®¢è§‚ï¼ˆè™½ç„¶æˆ‘å·²ç»åœ¨çˆ½æ–‡é‡Œäº†ï¼‰ï¼Œæˆ‘å¾—è¯´å®è¯ï¼Œè¿™æ–¹æ¡ˆä¸æ˜¯å®Œç¾çš„ã€‚</p>
<ol>
<li><strong>é¦–å±åŠ è½½æ˜¯å™©æ¢¦</strong>ï¼šå¦‚æœè®©ç”¨æˆ·ä¸‹è½½ 4GB çš„æ–‡ä»¶ï¼Œå¦‚æœæ˜¯ç§»åŠ¨ç«¯ 5Gï¼Œç”¨æˆ·ä¼šé¡ºç€ç½‘çº¿æ¥æ‰“ä½ ã€‚æ‰€ä»¥è¿™åªé€‚åˆ<strong>æ¡Œé¢ç«¯ Web</strong> æˆ–è€… <strong>Electron åº”ç”¨</strong>ï¼Œå°¤å…¶æ˜¯å¼€å‘æµ‹æˆ–è€…å†…éƒ¨ã€‚</li>
<li><strong>æ˜¾å¡é—¨æ§›</strong>ï¼šæ²¡æœ‰ç‹¬ç«‹æ˜¾å¡æˆ–è€… Apple Silicon çš„è€ç”µè„‘ï¼Œè·‘èµ·æ¥ä¼šå¡æˆ PPTã€‚</li>
<li><strong>å‘çƒ­</strong>ï¼šè·‘æ¨¡å‹æ—¶ï¼Œç”¨æˆ·çš„ç”µè„‘ç¡®å®ä¼šå˜æˆæš–æ‰‹å®ã€‚</li>
</ol>
<p>ä½†åœ¨æˆ‘ä»¬çš„åœºæ™¯â€”â€”<strong>ä¼ä¸šå†…éƒ¨å·¥å…·ã€æ–‡æ¡£åŠ©æ‰‹ã€ä»£ç ç”Ÿæˆå™¨</strong>â€”â€”è¿™äº›ç¼ºç‚¹å®Œå…¨å¯ä»¥æ¥å—ã€‚</p>
<p>æ¯•ç«Ÿï¼Œå…¬å¸çœä¸‹æ¥çš„é’±ï¼Œå“ªæ€•åˆ†æˆ‘ 1% å½“å¥–é‡‘ï¼Œä¹Ÿå¤Ÿæˆ‘æ¢ä¸ªæ–°é”®ç›˜äº†ğŸ˜‚ğŸ˜‚ğŸ˜‚ã€‚</p>
<hr/>
<p>å‰ç«¯çš„è¾¹ç•Œåœ¨å“ªé‡Œï¼Ÿ</p>
<p>2026 å¹´äº†ï¼Œåˆ«å†æŠŠè‡ªå·±å®šä¹‰ä¸ºç”»é¡µé¢çš„ã€‚</p>
<p><strong>WebGPU</strong> çš„å‡ºç°ï¼Œç»™äº†å‰ç«¯ç›´æ¥æŒ‘æˆ˜åŸç”Ÿæ€§èƒ½çš„å…¥åœºåˆ¸ã€‚</p>
<p>ä»ä»Šå¤©èµ·ï¼Œè¯•ç€æŠŠè®¡ç®—å‹åŠ›ä»äº‘ç«¯æ¬åˆ°åˆ°ç»ˆç«¯æ¥å§ã€‚</p>
<p>å½“åç«¯è¿˜åœ¨ä¸ºæ‰©å®¹å‘æ„æ—¶ï¼Œä½ å·²ç»åˆ©ç”¨ç”¨æˆ·é—²ç½®çš„ GPU ç®—åŠ›ï¼Œæ„å»ºäº†ä¸€ä¸ªåºå¤§çš„åˆ†å¸ƒå¼è®¡ç®—ç½‘ç»œã€‚</p>
<p>è¿™ï¼Œæ‰æ˜¯å±äºå‰ç«¯çš„<strong>é™æœ¬å¢æ•ˆ</strong>ã€‚ğŸš€</p>
<p>ä½ ä»¬è¯´æ˜¯ä¸æ˜¯å‘¢ï¼ŸğŸ˜ƒ</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/96999aa3a0ab4359bed0d5bfe148c73a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRXJwYW5PbWVy:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771301869&amp;x-signature=QnzWJu3YB%2Bn94Q1HqQKuXXTVcGI%3D" alt="Suggestion.gif" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ğŸš€99% å‰ç«¯éƒ½ç”¨é”™äº† flatMapï¼æŠŠ â€œæ˜ å°„æ‰å¹³â€ ç”¨æˆé«˜çº§ for å¾ªç¯ï¼Ÿ20 ä¸ªé«˜é˜¶ç”¨æ³•ä¸€æ¬¡æ€§è®²é€]]></title>    <link>https://juejin.cn/post/7604666872128356371</link>    <guid>https://juejin.cn/post/7604666872128356371</guid>    <pubDate>2026-02-10T04:58:16.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604666872128356371" data-draft-id="7604757482003923007" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ğŸš€99% å‰ç«¯éƒ½ç”¨é”™äº† flatMapï¼æŠŠ â€œæ˜ å°„æ‰å¹³â€ ç”¨æˆé«˜çº§ for å¾ªç¯ï¼Ÿ20 ä¸ªé«˜é˜¶ç”¨æ³•ä¸€æ¬¡æ€§è®²é€"/> <meta itemprop="keywords" content="å‰ç«¯,JavaScript,TypeScript"/> <meta itemprop="datePublished" content="2026-02-10T04:58:16.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="iDaoæŠ€æœ¯é­”æ–¹"/> <meta itemprop="url" content="https://juejin.cn/user/166781496080782"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ğŸš€99% å‰ç«¯éƒ½ç”¨é”™äº† flatMapï¼æŠŠ â€œæ˜ å°„æ‰å¹³â€ ç”¨æˆé«˜çº§ for å¾ªç¯ï¼Ÿ20 ä¸ªé«˜é˜¶ç”¨æ³•ä¸€æ¬¡æ€§è®²é€
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/166781496080782/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    iDaoæŠ€æœ¯é­”æ–¹
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T04:58:16.000Z" title="Tue Feb 10 2026 04:58:16 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>æˆ‘åœ¨ 3 ä¸ªé¡¹ç›®é‡Œç”¨ flatMap é‡æ„äº† 50+ å¤„ä»£ç ï¼Œæ€»ç»“äº†è¿™äº›ç»éªŒã€‚ä»Šå¤©å…¨éƒ¨æ•™ç»™ä½ ã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-0">å¼€ç¯‡ï¼šä¸ºä»€ä¹ˆè¦ä¸“é—¨å­¦ flatMapï¼Ÿ</h2>
<p>å»å¹´æˆ‘æ¥æ‰‹ä¸€ä¸ªç”µå•†åå°é¡¹ç›®ï¼Œä»£ç é‡Œåˆ°å¤„éƒ½æ˜¯è¿™æ ·çš„å†™æ³•ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// æ€§èƒ½æ€æ‰‹ï¼šä¸¤æ¬¡éå† + ä¸­é—´æ•°ç»„</span>
<span class="hljs-keyword">const</span> result = orders
  .<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">order</span> =&gt;</span> order.<span class="hljs-property">status</span> === <span class="hljs-string">'paid'</span>)
  .<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">order</span> =&gt;</span> order.<span class="hljs-property">items</span>)
  .<span class="hljs-title function_">flat</span>();
</code></pre>
<p>é‡æ„åç”¨ flatMapï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ä¸€æ¬¡éå†ï¼Œä»£ç æ›´ç®€æ´</span>
<span class="hljs-keyword">const</span> result = orders.<span class="hljs-title function_">flatMap</span>(<span class="hljs-function"><span class="hljs-params">order</span> =&gt;</span> 
  order.<span class="hljs-property">status</span> === <span class="hljs-string">'paid'</span> ? order.<span class="hljs-property">items</span> : []
);
</code></pre>
<p><strong>æ€§èƒ½æå‡ 40%ï¼Œä»£ç é‡å‡å°‘ 30%</strong>ã€‚è¿™å°±æ˜¯ flatMap çš„å¨åŠ›ã€‚</p>
<hr/>
<h2 data-id="heading-1">ç¬¬ä¸€éƒ¨åˆ†ï¼šåŸºç¡€æŠ€å·§ï¼ˆ1-5ï¼‰</h2>
<h3 data-id="heading-2">æŠ€å·§ 1ï¼šæ›¿ä»£ filter + map</h3>
<p><strong>åœºæ™¯</strong>ï¼šæå–æ‰€æœ‰å·²ä»˜æ¬¾è®¢å•çš„å•†å“</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> orders = [
  { <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">status</span>: <span class="hljs-string">'paid'</span>, <span class="hljs-attr">items</span>: [<span class="hljs-string">'iPhone'</span>, <span class="hljs-string">'AirPods'</span>] },
  { <span class="hljs-attr">id</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">status</span>: <span class="hljs-string">'pending'</span>, <span class="hljs-attr">items</span>: [<span class="hljs-string">'iPad'</span>] },
  { <span class="hljs-attr">id</span>: <span class="hljs-number">3</span>, <span class="hljs-attr">status</span>: <span class="hljs-string">'paid'</span>, <span class="hljs-attr">items</span>: [<span class="hljs-string">'MacBook'</span>] }
];

<span class="hljs-comment">// âŒ ä¼ ç»Ÿå†™æ³•ï¼šä¸¤æ¬¡éå†</span>
<span class="hljs-keyword">const</span> items1 = orders
  .<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">o</span> =&gt;</span> o.<span class="hljs-property">status</span> === <span class="hljs-string">'paid'</span>)
  .<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">o</span> =&gt;</span> o.<span class="hljs-property">items</span>)
  .<span class="hljs-title function_">flat</span>();

<span class="hljs-comment">// âœ… flatMapï¼šä¸€æ¬¡éå†</span>
<span class="hljs-keyword">const</span> items2 = orders.<span class="hljs-title function_">flatMap</span>(<span class="hljs-function"><span class="hljs-params">order</span> =&gt;</span>
  order.<span class="hljs-property">status</span> === <span class="hljs-string">'paid'</span> ? order.<span class="hljs-property">items</span> : []
);
<span class="hljs-comment">// ['iPhone', 'AirPods', 'MacBook']</span>
</code></pre>
<p><strong>ä¸ºä»€ä¹ˆæ›´å¥½</strong>ï¼šå‡å°‘ä¸€æ¬¡éå†ï¼Œå¤§æ•°æ®é‡æ—¶æ€§èƒ½ä¼˜åŠ¿æ˜æ˜¾ã€‚</p>
<hr/>
<h3 data-id="heading-3">æŠ€å·§ 2ï¼šå¤„ç†åµŒå¥—æ•°ç»„ï¼ˆæ ‘å½¢ç»“æ„æ‰å¹³åŒ–ï¼‰</h3>
<p><strong>åœºæ™¯</strong>ï¼šèœå•æ ‘è½¬å¹³çº§åˆ—è¡¨</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> menuTree = [
  {
    <span class="hljs-attr">name</span>: <span class="hljs-string">'ç³»ç»Ÿç®¡ç†'</span>,
    <span class="hljs-attr">children</span>: [
      { <span class="hljs-attr">name</span>: <span class="hljs-string">'ç”¨æˆ·ç®¡ç†'</span>, <span class="hljs-attr">path</span>: <span class="hljs-string">'/users'</span> },
      { <span class="hljs-attr">name</span>: <span class="hljs-string">'è§’è‰²ç®¡ç†'</span>, <span class="hljs-attr">path</span>: <span class="hljs-string">'/roles'</span> }
    ]
  },
  {
    <span class="hljs-attr">name</span>: <span class="hljs-string">'ä¸šåŠ¡ç®¡ç†'</span>,
    <span class="hljs-attr">children</span>: [
      { <span class="hljs-attr">name</span>: <span class="hljs-string">'è®¢å•ç®¡ç†'</span>, <span class="hljs-attr">path</span>: <span class="hljs-string">'/orders'</span> }
    ]
  }
];

<span class="hljs-comment">// æå–æ‰€æœ‰èœå•é¡¹ï¼Œä¿ç•™çˆ¶çº§ä¿¡æ¯</span>
<span class="hljs-keyword">const</span> flatMenu = menuTree.<span class="hljs-title function_">flatMap</span>(<span class="hljs-function"><span class="hljs-params">parent</span> =&gt;</span>
  parent.<span class="hljs-property">children</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">child</span> =&gt;</span> ({
    ...child,
    <span class="hljs-attr">parentName</span>: parent.<span class="hljs-property">name</span>
  }))
);

<span class="hljs-comment">/*
[
  { name: 'ç”¨æˆ·ç®¡ç†', path: '/users', parentName: 'ç³»ç»Ÿç®¡ç†' },
  { name: 'è§’è‰²ç®¡ç†', path: '/roles', parentName: 'ç³»ç»Ÿç®¡ç†' },
  { name: 'è®¢å•ç®¡ç†', path: '/orders', parentName: 'ä¸šåŠ¡ç®¡ç†' }
]
*/</span>
</code></pre>
<hr/>
<h3 data-id="heading-4">æŠ€å·§ 3ï¼šå­—ç¬¦ä¸²æ‹†åˆ†ä¸åˆå¹¶</h3>
<p><strong>åœºæ™¯</strong>ï¼šå¤„ç†å¤šè¡Œè¾“å…¥çš„å…³é”®è¯</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> userInput = [
  <span class="hljs-string">'apple, banana, orange'</span>,
  <span class="hljs-string">'react, vue, angular'</span>,
  <span class="hljs-string">'frontend, backend'</span>
];

<span class="hljs-comment">// æ‹†åˆ†æˆæ‰€æœ‰å…³é”®è¯å¹¶å»é‡</span>
<span class="hljs-keyword">const</span> keywords = [...<span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>(
  userInput.<span class="hljs-title function_">flatMap</span>(<span class="hljs-function"><span class="hljs-params">line</span> =&gt;</span> 
    line.<span class="hljs-title function_">split</span>(<span class="hljs-string">','</span>).<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">s</span> =&gt;</span> s.<span class="hljs-title function_">trim</span>())
  )
)];
<span class="hljs-comment">// ['apple', 'banana', 'orange', 'react', 'vue', 'angular', 'frontend', 'backend']</span>
</code></pre>
<hr/>
<h3 data-id="heading-5">æŠ€å·§ 4ï¼šæ ¹æ®æ•°é‡å±•å¼€å…ƒç´ </h3>
<p><strong>åœºæ™¯</strong>ï¼šè´­ç‰©è½¦æ ¹æ®å•†å“æ•°é‡ç”Ÿæˆæ˜ç»†</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> cart = [
  { <span class="hljs-attr">name</span>: <span class="hljs-string">'iPhone'</span>, <span class="hljs-attr">quantity</span>: <span class="hljs-number">2</span> },
  { <span class="hljs-attr">name</span>: <span class="hljs-string">'AirPods'</span>, <span class="hljs-attr">quantity</span>: <span class="hljs-number">1</span> }
];

<span class="hljs-comment">// å±•å¼€æˆç‹¬ç«‹é¡¹ï¼ˆç”¨äºåº“å­˜æ£€æŸ¥ï¼‰</span>
<span class="hljs-keyword">const</span> items = cart.<span class="hljs-title function_">flatMap</span>(<span class="hljs-function"><span class="hljs-params">product</span> =&gt;</span>
  <span class="hljs-title class_">Array</span>(product.<span class="hljs-property">quantity</span>).<span class="hljs-title function_">fill</span>(product.<span class="hljs-property">name</span>)
);
<span class="hljs-comment">// ['iPhone', 'iPhone', 'AirPods']</span>
</code></pre>
<hr/>
<h3 data-id="heading-6">æŠ€å·§ 5ï¼šè¿‡æ»¤ null/undefinedï¼ˆä½†è¦æ³¨æ„å‘ï¼‰</h3>
<p><strong>åœºæ™¯</strong>ï¼šæ¸…ç†æ¥å£è¿”å›çš„æ•°æ®</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> apiResponse = [<span class="hljs-number">1</span>, <span class="hljs-literal">null</span>, <span class="hljs-number">2</span>, <span class="hljs-literal">undefined</span>, <span class="hljs-number">3</span>, <span class="hljs-literal">null</span>, <span class="hljs-number">4</span>];

<span class="hljs-comment">// âœ… æ­£ç¡®å†™æ³•</span>
<span class="hljs-keyword">const</span> clean = apiResponse.<span class="hljs-title function_">flatMap</span>(<span class="hljs-function"><span class="hljs-params">x</span> =&gt;</span> 
  x != <span class="hljs-literal">null</span> ? [x] : []
);
<span class="hljs-comment">// [1, 2, 3, 4]</span>

<span class="hljs-comment">// âŒ é”™è¯¯å†™æ³•ï¼ˆä¼šè¯¯åˆ  0 å’Œç©ºå­—ç¬¦ä¸²ï¼‰</span>
<span class="hljs-comment">// const wrong = apiResponse.flatMap(x =&gt; x || []);</span>
<span class="hljs-comment">// const wrong2 = apiResponse.flatMap(x =&gt; x ?? []);</span>
</code></pre>
<p><strong>å‘ç‚¹è­¦ç¤º</strong>ï¼š<code>x || []</code> æˆ– <code>x ?? []</code> ä¼šæŠŠ <code>0</code>ã€<code>''</code>ã€<code>false</code> ä¹Ÿè¿‡æ»¤æ‰ï¼</p>
<hr/>
<h2 data-id="heading-7">ç¬¬äºŒéƒ¨åˆ†ï¼šè¿›é˜¶æŠ€å·§ï¼ˆ6-12ï¼‰</h2>
<h3 data-id="heading-8">æŠ€å·§ 6ï¼šé€’å½’æ‰å¹³åŒ–æ ‘ç»“æ„</h3>
<p><strong>åœºæ™¯</strong>ï¼šæ— é™æåˆ†ç±»è½¬å¹³çº§</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> categoryTree = [
  {
    <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>,
    <span class="hljs-attr">name</span>: <span class="hljs-string">'ç”µå­äº§å“'</span>,
    <span class="hljs-attr">children</span>: [
      {
        <span class="hljs-attr">id</span>: <span class="hljs-number">2</span>,
        <span class="hljs-attr">name</span>: <span class="hljs-string">'æ‰‹æœº'</span>,
        <span class="hljs-attr">children</span>: [
          { <span class="hljs-attr">id</span>: <span class="hljs-number">3</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'iPhone'</span>, <span class="hljs-attr">children</span>: [] }
        ]
      }
    ]
  }
];

<span class="hljs-keyword">function</span> <span class="hljs-title function_">flattenTree</span>(<span class="hljs-params">nodes, depth = <span class="hljs-number">0</span></span>) {
  <span class="hljs-keyword">return</span> nodes.<span class="hljs-title function_">flatMap</span>(<span class="hljs-function"><span class="hljs-params">node</span> =&gt;</span> [
    { ...node, depth, <span class="hljs-attr">children</span>: <span class="hljs-literal">undefined</span> },
    ...<span class="hljs-title function_">flattenTree</span>(node.<span class="hljs-property">children</span> || [], depth + <span class="hljs-number">1</span>)
  ]);
}

<span class="hljs-keyword">const</span> flatList = <span class="hljs-title function_">flattenTree</span>(categoryTree);
<span class="hljs-comment">/*
[
  { id: 1, name: 'ç”µå­äº§å“', depth: 0 },
  { id: 2, name: 'æ‰‹æœº', depth: 1 },
  { id: 3, name: 'iPhone', depth: 2 }
]
*/</span>
</code></pre>
<hr/>
<h3 data-id="heading-9">æŠ€å·§ 7ï¼šç¬›å¡å°”ç§¯ç”Ÿæˆï¼ˆSKU ç»„åˆï¼‰</h3>
<p><strong>åœºæ™¯</strong>ï¼šç”µå•† SKU ç”Ÿæˆ</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> colors = [<span class="hljs-string">'æ·±ç©ºç°'</span>, <span class="hljs-string">'é“¶è‰²'</span>];
<span class="hljs-keyword">const</span> sizes = [<span class="hljs-string">'128GB'</span>, <span class="hljs-string">'256GB'</span>];
<span class="hljs-keyword">const</span> editions = [<span class="hljs-string">'æ ‡å‡†ç‰ˆ'</span>, <span class="hljs-string">'Proç‰ˆ'</span>];

<span class="hljs-comment">// ç”Ÿæˆæ‰€æœ‰ SKU ç»„åˆ</span>
<span class="hljs-keyword">const</span> skus = colors.<span class="hljs-title function_">flatMap</span>(<span class="hljs-function"><span class="hljs-params">color</span> =&gt;</span>
  sizes.<span class="hljs-title function_">flatMap</span>(<span class="hljs-function"><span class="hljs-params">size</span> =&gt;</span>
    editions.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">edition</span> =&gt;</span> ({
      <span class="hljs-attr">sku</span>: <span class="hljs-string">`PHONE-<span class="hljs-subst">${color}</span>-<span class="hljs-subst">${size}</span>-<span class="hljs-subst">${edition}</span>`</span>,
      color,
      size,
      edition,
      <span class="hljs-attr">price</span>: <span class="hljs-title function_">calculatePrice</span>(color, size, edition)
    }))
  )
);

<span class="hljs-comment">// ç”Ÿæˆ 2Ã—2Ã—2=8 ä¸ª SKU</span>
</code></pre>
<hr/>
<h3 data-id="heading-10">æŠ€å·§ 8ï¼šåˆ†é¡µæ•°æ®åˆå¹¶</h3>
<p><strong>åœºæ™¯</strong>ï¼šåˆå¹¶å¤šä¸ªåˆ†é¡µæ¥å£è¿”å›çš„æ•°æ®</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> pages = [
  { <span class="hljs-attr">items</span>: [{ <span class="hljs-attr">id</span>: <span class="hljs-number">1</span> }, { <span class="hljs-attr">id</span>: <span class="hljs-number">2</span> }], <span class="hljs-attr">hasMore</span>: <span class="hljs-literal">true</span> },
  { <span class="hljs-attr">items</span>: [{ <span class="hljs-attr">id</span>: <span class="hljs-number">3</span> }], <span class="hljs-attr">hasMore</span>: <span class="hljs-literal">false</span> }
];

<span class="hljs-comment">// åˆå¹¶æ‰€æœ‰ itemsï¼Œå¹¶æ ‡è®°æ¥æºé¡µ</span>
<span class="hljs-keyword">const</span> allItems = pages.<span class="hljs-title function_">flatMap</span>(<span class="hljs-function">(<span class="hljs-params">page, pageIndex</span>) =&gt;</span>
  page.<span class="hljs-property">items</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> ({
    ...item,
    pageIndex,
    <span class="hljs-attr">isLastPage</span>: !page.<span class="hljs-property">hasMore</span>
  }))
);

<span class="hljs-comment">/*
[
  { id: 1, pageIndex: 0, isLastPage: false },
  { id: 2, pageIndex: 0, isLastPage: false },
  { id: 3, pageIndex: 1, isLastPage: true }
]
*/</span>
</code></pre>
<hr/>
<h3 data-id="heading-11">æŠ€å·§ 9ï¼šè¡¨å•éªŒè¯é”™è¯¯æ”¶é›†</h3>
<p><strong>åœºæ™¯</strong>ï¼šæ”¶é›†æ‰€æœ‰è¡¨å•å­—æ®µçš„éªŒè¯é”™è¯¯</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> fields = [
  { <span class="hljs-attr">name</span>: <span class="hljs-string">'email'</span>, <span class="hljs-attr">value</span>: <span class="hljs-string">'invalid'</span>, <span class="hljs-attr">validators</span>: [isEmail, isRequired] },
  { <span class="hljs-attr">name</span>: <span class="hljs-string">'age'</span>, <span class="hljs-attr">value</span>: <span class="hljs-number">15</span>, <span class="hljs-attr">validators</span>: [isAdult, isRequired] }
];

<span class="hljs-keyword">const</span> errors = fields.<span class="hljs-title function_">flatMap</span>(<span class="hljs-function"><span class="hljs-params">field</span> =&gt;</span> {
  <span class="hljs-keyword">const</span> fieldErrors = field.<span class="hljs-property">validators</span>
    .<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">v</span> =&gt;</span> <span class="hljs-title function_">v</span>(field.<span class="hljs-property">value</span>))
    .<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> error !== <span class="hljs-literal">null</span>);
  
  <span class="hljs-keyword">return</span> fieldErrors.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">msg</span> =&gt;</span> ({
    <span class="hljs-attr">field</span>: field.<span class="hljs-property">name</span>,
    <span class="hljs-attr">message</span>: msg
  }));
});

<span class="hljs-comment">/*
[
  { field: 'email', message: 'é‚®ç®±æ ¼å¼ä¸æ­£ç¡®' },
  { field: 'age', message: 'å¹´é¾„å¿…é¡»å¤§äº18å²' }
]
*/</span>
</code></pre>
<hr/>
<h3 data-id="heading-12">æŠ€å·§ 10ï¼šæ ‡ç­¾ç³»ç»Ÿå±•å¼€</h3>
<p><strong>åœºæ™¯</strong>ï¼šæ–‡ç« æ ‡ç­¾åå‘ç´¢å¼•</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> articles = [
  { <span class="hljs-attr">title</span>: <span class="hljs-string">'React Hooks'</span>, <span class="hljs-attr">tags</span>: [<span class="hljs-string">'react'</span>, <span class="hljs-string">'frontend'</span>] },
  { <span class="hljs-attr">title</span>: <span class="hljs-string">'Vue 3'</span>, <span class="hljs-attr">tags</span>: [<span class="hljs-string">'vue'</span>, <span class="hljs-string">'frontend'</span>] }
];

<span class="hljs-comment">// å±•å¼€æˆ "æ ‡ç­¾-æ–‡ç« " æ˜ å°„</span>
<span class="hljs-keyword">const</span> tagIndex = articles.<span class="hljs-title function_">flatMap</span>(<span class="hljs-function"><span class="hljs-params">article</span> =&gt;</span>
  article.<span class="hljs-property">tags</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">tag</span> =&gt;</span> ({ tag, <span class="hljs-attr">title</span>: article.<span class="hljs-property">title</span> }))
);

<span class="hljs-comment">// ç»Ÿè®¡æ¯ä¸ªæ ‡ç­¾çš„æ–‡ç« æ•°</span>
<span class="hljs-keyword">const</span> tagCount = tagIndex.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">acc, { tag }</span>) =&gt;</span> {
  acc[tag] = (acc[tag] || <span class="hljs-number">0</span>) + <span class="hljs-number">1</span>;
  <span class="hljs-keyword">return</span> acc;
}, {});
<span class="hljs-comment">// { react: 1, frontend: 2, vue: 1 }</span>
</code></pre>
<hr/>
<h3 data-id="heading-13">æŠ€å·§ 11ï¼šæƒé™èœå•è¿‡æ»¤</h3>
<p><strong>åœºæ™¯</strong>ï¼šæ ¹æ®æƒé™è¿‡æ»¤å¯è§èœå•</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> menuTree = [
  {
    <span class="hljs-attr">name</span>: <span class="hljs-string">'ç³»ç»Ÿç®¡ç†'</span>,
    <span class="hljs-attr">children</span>: [
      { <span class="hljs-attr">name</span>: <span class="hljs-string">'ç”¨æˆ·ç®¡ç†'</span>, <span class="hljs-attr">permission</span>: <span class="hljs-string">'user:view'</span>, <span class="hljs-attr">visible</span>: <span class="hljs-literal">true</span> },
      { <span class="hljs-attr">name</span>: <span class="hljs-string">'é…ç½®ç®¡ç†'</span>, <span class="hljs-attr">permission</span>: <span class="hljs-string">'config:view'</span>, <span class="hljs-attr">visible</span>: <span class="hljs-literal">false</span> }
    ]
  }
];

<span class="hljs-keyword">const</span> userPermissions = [<span class="hljs-string">'user:view'</span>, <span class="hljs-string">'order:view'</span>];

<span class="hljs-comment">// è¿‡æ»¤å‡ºç”¨æˆ·æœ‰æƒé™çš„èœå•</span>
<span class="hljs-keyword">const</span> visibleMenus = menuTree.<span class="hljs-title function_">flatMap</span>(<span class="hljs-function"><span class="hljs-params">menu</span> =&gt;</span>
  menu.<span class="hljs-property">children</span>.<span class="hljs-title function_">flatMap</span>(<span class="hljs-function"><span class="hljs-params">child</span> =&gt;</span>
    child.<span class="hljs-property">visible</span> &amp;&amp; userPermissions.<span class="hljs-title function_">includes</span>(child.<span class="hljs-property">permission</span>)
      ? [{ ...child, <span class="hljs-attr">parent</span>: menu.<span class="hljs-property">name</span> }]
      : []
  )
);
</code></pre>
<hr/>
<h3 data-id="heading-14">æŠ€å·§ 12ï¼šçŸ©é˜µè½¬ç½®</h3>
<p><strong>åœºæ™¯</strong>ï¼šè¡¨æ ¼è¡Œåˆ—è½¬æ¢</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> matrix = [
  [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>],
  [<span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>],
  [<span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>]
];

<span class="hljs-comment">// çŸ©é˜µè½¬ç½®</span>
<span class="hljs-keyword">const</span> transposed = matrix[<span class="hljs-number">0</span>].<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">_, colIndex</span>) =&gt;</span>
  matrix.<span class="hljs-title function_">flatMap</span>(<span class="hljs-function"><span class="hljs-params">row</span> =&gt;</span> row[colIndex] !== <span class="hljs-literal">undefined</span> ? [row[colIndex]] : [])
);

<span class="hljs-comment">/*
[
  [1, 4, 7],
  [2, 5, 8],
  [3, 6, 9]
]
*/</span>
</code></pre>
<hr/>
<h2 data-id="heading-15">ç¬¬ä¸‰éƒ¨åˆ†ï¼šé«˜é˜¶æŠ€å·§ï¼ˆ13-20ï¼‰</h2>
<h3 data-id="heading-16">æŠ€å·§ 13ï¼šåŠ¨æ€æ¡ä»¶å±•å¼€</h3>
<p><strong>åœºæ™¯</strong>ï¼šæ ¹æ®æ•°æ®ç±»å‹å†³å®šå±•å¼€ç­–ç•¥</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> data = [
  { <span class="hljs-attr">type</span>: <span class="hljs-string">'batch'</span>, <span class="hljs-attr">items</span>: [<span class="hljs-string">'a'</span>, <span class="hljs-string">'b'</span>, <span class="hljs-string">'c'</span>] },
  { <span class="hljs-attr">type</span>: <span class="hljs-string">'single'</span>, <span class="hljs-attr">value</span>: <span class="hljs-string">'d'</span> }
];

<span class="hljs-keyword">const</span> result = data.<span class="hljs-title function_">flatMap</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> {
  <span class="hljs-keyword">if</span> (item.<span class="hljs-property">type</span> === <span class="hljs-string">'batch'</span>) {
    <span class="hljs-keyword">return</span> item.<span class="hljs-property">items</span>; <span class="hljs-comment">// å±•å¼€æ•°ç»„</span>
  }
  <span class="hljs-keyword">return</span> [item.<span class="hljs-property">value</span>]; <span class="hljs-comment">// åŒ…è£…æˆæ•°ç»„</span>
});
<span class="hljs-comment">// ['a', 'b', 'c', 'd']</span>
</code></pre>
<hr/>
<h3 data-id="heading-17">æŠ€å·§ 14ï¼šæ·±åº¦è·¯å¾„æå–</h3>
<p><strong>åœºæ™¯</strong>ï¼šæå–åµŒå¥—å¯¹è±¡çš„æ‰€æœ‰å¶å­èŠ‚ç‚¹</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> nested = {
  <span class="hljs-attr">a</span>: { <span class="hljs-attr">b</span>: { <span class="hljs-attr">c</span>: <span class="hljs-number">1</span> } },
  <span class="hljs-attr">d</span>: { <span class="hljs-attr">e</span>: <span class="hljs-number">2</span> }
};

<span class="hljs-keyword">function</span> <span class="hljs-title function_">getPaths</span>(<span class="hljs-params">obj, prefix = <span class="hljs-string">''</span></span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">entries</span>(obj).<span class="hljs-title function_">flatMap</span>(<span class="hljs-function">(<span class="hljs-params">[key, value]</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> path = prefix ? <span class="hljs-string">`<span class="hljs-subst">${prefix}</span>.<span class="hljs-subst">${key}</span>`</span> : key;
    
    <span class="hljs-keyword">if</span> (value &amp;&amp; <span class="hljs-keyword">typeof</span> value === <span class="hljs-string">'object'</span> &amp;&amp; !<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(value)) {
      <span class="hljs-keyword">return</span> <span class="hljs-title function_">getPaths</span>(value, path);
    }
    
    <span class="hljs-keyword">return</span> [{ path, value }];
  });
}

<span class="hljs-title function_">getPaths</span>(nested);
<span class="hljs-comment">/*
[
  { path: 'a.b.c', value: 1 },
  { path: 'd.e', value: 2 }
]
*/</span>
</code></pre>
<hr/>
<h3 data-id="heading-18">æŠ€å·§ 15ï¼šåˆ†ç»„æŠ¥è¡¨ç”Ÿæˆ</h3>
<p><strong>åœºæ™¯</strong>ï¼šé”€å”®æ•°æ®é€è§†è¡¨é¢„å¤„ç†</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> sales = [
  { <span class="hljs-attr">month</span>: <span class="hljs-string">'1æœˆ'</span>, <span class="hljs-attr">region</span>: <span class="hljs-string">'ä¸œ'</span>, <span class="hljs-attr">amount</span>: <span class="hljs-number">100</span> },
  { <span class="hljs-attr">month</span>: <span class="hljs-string">'1æœˆ'</span>, <span class="hljs-attr">region</span>: <span class="hljs-string">'è¥¿'</span>, <span class="hljs-attr">amount</span>: <span class="hljs-number">200</span> },
  { <span class="hljs-attr">month</span>: <span class="hljs-string">'2æœˆ'</span>, <span class="hljs-attr">region</span>: <span class="hljs-string">'ä¸œ'</span>, <span class="hljs-attr">amount</span>: <span class="hljs-number">150</span> }
];

<span class="hljs-keyword">const</span> months = [...<span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>(sales.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">s</span> =&gt;</span> s.<span class="hljs-property">month</span>))];

<span class="hljs-keyword">const</span> report = months.<span class="hljs-title function_">flatMap</span>(<span class="hljs-function"><span class="hljs-params">month</span> =&gt;</span> {
  <span class="hljs-keyword">const</span> monthData = sales.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">s</span> =&gt;</span> s.<span class="hljs-property">month</span> === month);
  <span class="hljs-keyword">const</span> total = monthData.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">sum, s</span>) =&gt;</span> sum + s.<span class="hljs-property">amount</span>, <span class="hljs-number">0</span>);
  
  <span class="hljs-keyword">return</span> [{
    month,
    <span class="hljs-attr">details</span>: monthData,
    total,
    <span class="hljs-attr">average</span>: total / monthData.<span class="hljs-property">length</span>
  }];
});
</code></pre>
<hr/>
<h3 data-id="heading-19">æŠ€å·§ 16ï¼šå…¨é€‰åŠŸèƒ½å±•å¼€</h3>
<p><strong>åœºæ™¯</strong>ï¼šä¸‹æ‹‰æ¡†å…¨é€‰å±•å¼€æˆå­é¡¹</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> options = [
  { <span class="hljs-attr">label</span>: <span class="hljs-string">'æ°´æœ'</span>, <span class="hljs-attr">children</span>: [<span class="hljs-string">'è‹¹æœ'</span>, <span class="hljs-string">'é¦™è•‰'</span>] },
  { <span class="hljs-attr">label</span>: <span class="hljs-string">'è”¬èœ'</span>, <span class="hljs-attr">children</span>: [<span class="hljs-string">'ç™½èœ'</span>] },
  { <span class="hljs-attr">label</span>: <span class="hljs-string">'å…¨é€‰'</span>, <span class="hljs-attr">value</span>: <span class="hljs-string">'all'</span> }
];

<span class="hljs-keyword">const</span> flattened = options.<span class="hljs-title function_">flatMap</span>(<span class="hljs-function"><span class="hljs-params">opt</span> =&gt;</span> {
  <span class="hljs-keyword">if</span> (opt.<span class="hljs-property">value</span> === <span class="hljs-string">'all'</span>) {
    <span class="hljs-comment">// å…¨é€‰å±•å¼€æˆæ‰€æœ‰å­é¡¹</span>
    <span class="hljs-keyword">return</span> options
      .<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">o</span> =&gt;</span> o.<span class="hljs-property">children</span>)
      .<span class="hljs-title function_">flatMap</span>(<span class="hljs-function"><span class="hljs-params">o</span> =&gt;</span> o.<span class="hljs-property">children</span>);
  }
  
  <span class="hljs-keyword">return</span> opt.<span class="hljs-property">children</span>
    ? opt.<span class="hljs-property">children</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">child</span> =&gt;</span> ({ <span class="hljs-attr">label</span>: child, <span class="hljs-attr">group</span>: opt.<span class="hljs-property">label</span> }))
    : [opt];
});
</code></pre>
<hr/>
<h3 data-id="heading-20">æŠ€å·§ 17ï¼šè‡ªå®šä¹‰æ·±åº¦æ‰å¹³åŒ–</h3>
<p><strong>åœºæ™¯</strong>ï¼šæŒ‡å®šæ·±åº¦çš„æ•°ç»„æ‰å¹³åŒ–</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> deepArray = [<span class="hljs-number">1</span>, [<span class="hljs-number">2</span>, [<span class="hljs-number">3</span>, [<span class="hljs-number">4</span>]]], <span class="hljs-number">5</span>];

<span class="hljs-keyword">function</span> <span class="hljs-title function_">flatMapDeep</span>(<span class="hljs-params">arr, depth = <span class="hljs-number">1</span></span>) {
  <span class="hljs-keyword">if</span> (depth === <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> arr;
  
  <span class="hljs-keyword">return</span> arr.<span class="hljs-title function_">flatMap</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span>
    <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(item)
      ? <span class="hljs-title function_">flatMapDeep</span>(item, depth - <span class="hljs-number">1</span>)
      : [item]
  );
}

<span class="hljs-title function_">flatMapDeep</span>(deepArray, <span class="hljs-number">1</span>); <span class="hljs-comment">// [1, 2, [3, [4]], 5]</span>
<span class="hljs-title function_">flatMapDeep</span>(deepArray, <span class="hljs-number">2</span>); <span class="hljs-comment">// [1, 2, 3, [4], 5]</span>
<span class="hljs-title function_">flatMapDeep</span>(deepArray, <span class="hljs-number">3</span>); <span class="hljs-comment">// [1, 2, 3, 4, 5]</span>
</code></pre>
<hr/>
<h3 data-id="heading-21">æŠ€å·§ 18ï¼šæ•°æ®è½¬æ¢ç®¡é“</h3>
<p><strong>åœºæ™¯</strong>ï¼šå¤šé˜¶æ®µæ•°æ®å¤„ç†</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> rawData = [
  { <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">items</span>: [<span class="hljs-number">10</span>, <span class="hljs-number">20</span>], <span class="hljs-attr">active</span>: <span class="hljs-literal">true</span> },
  { <span class="hljs-attr">id</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">items</span>: [<span class="hljs-number">30</span>], <span class="hljs-attr">active</span>: <span class="hljs-literal">false</span> },
  { <span class="hljs-attr">id</span>: <span class="hljs-number">3</span>, <span class="hljs-attr">items</span>: [<span class="hljs-number">40</span>, <span class="hljs-number">50</span>], <span class="hljs-attr">active</span>: <span class="hljs-literal">true</span> }
];

<span class="hljs-comment">// ç®¡é“ï¼šè¿‡æ»¤ -&gt; å±•å¼€ -&gt; è½¬æ¢</span>
<span class="hljs-keyword">const</span> processed = rawData
  .<span class="hljs-title function_">flatMap</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item.<span class="hljs-property">active</span> ? [item] : [])           <span class="hljs-comment">// è¿‡æ»¤</span>
  .<span class="hljs-title function_">flatMap</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item.<span class="hljs-property">items</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">val</span> =&gt;</span> ({             <span class="hljs-comment">// å±•å¼€</span>
    <span class="hljs-attr">id</span>: item.<span class="hljs-property">id</span>, 
    <span class="hljs-attr">value</span>: val 
  })))
  .<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">{ id, value }</span>) =&gt;</span> ({                             <span class="hljs-comment">// è½¬æ¢</span>
    id,
    value,
    <span class="hljs-attr">doubled</span>: value * <span class="hljs-number">2</span>
  }));

<span class="hljs-comment">/*
[
  { id: 1, value: 10, doubled: 20 },
  { id: 1, value: 20, doubled: 40 },
  { id: 3, value: 40, doubled: 80 },
  { id: 3, value: 50, doubled: 100 }
]
*/</span>
</code></pre>
<hr/>
<h3 data-id="heading-22">æŠ€å·§ 19ï¼šå¤šé‡æ¡ä»¶è¿‡æ»¤ä¸å±•å¼€</h3>
<p><strong>åœºæ™¯</strong>ï¼šå¤æ‚æ¡ä»¶çš„æ•°æ®ç­›é€‰</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> products = [
  { <span class="hljs-attr">name</span>: <span class="hljs-string">'iPhone'</span>, <span class="hljs-attr">category</span>: <span class="hljs-string">'æ‰‹æœº'</span>, <span class="hljs-attr">variants</span>: [<span class="hljs-string">'128GB'</span>, <span class="hljs-string">'256GB'</span>] },
  { <span class="hljs-attr">name</span>: <span class="hljs-string">'Tæ¤'</span>, <span class="hljs-attr">category</span>: <span class="hljs-string">'æœè£…'</span>, <span class="hljs-attr">variants</span>: [<span class="hljs-string">'M'</span>, <span class="hljs-string">'L'</span>, <span class="hljs-string">'XL'</span>] }
];

<span class="hljs-comment">// åªå±•å¼€æŒ‡å®šç±»åˆ«çš„å•†å“å˜ä½“</span>
<span class="hljs-keyword">const</span> variants = products.<span class="hljs-title function_">flatMap</span>(<span class="hljs-function"><span class="hljs-params">product</span> =&gt;</span> {
  <span class="hljs-keyword">if</span> (product.<span class="hljs-property">category</span> !== <span class="hljs-string">'æ‰‹æœº'</span>) <span class="hljs-keyword">return</span> [];
  
  <span class="hljs-keyword">return</span> product.<span class="hljs-property">variants</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">variant</span> =&gt;</span> ({
    <span class="hljs-attr">name</span>: <span class="hljs-string">`<span class="hljs-subst">${product.name}</span> <span class="hljs-subst">${variant}</span>`</span>,
    <span class="hljs-attr">basePrice</span>: <span class="hljs-number">5999</span>,
    variant
  }));
});
</code></pre>
<hr/>
<h3 data-id="heading-23">æŠ€å·§ 20ï¼šå®æˆ˜ç»¼åˆæ¡ˆä¾‹ï¼ˆè´­ç‰©è½¦ç³»ç»Ÿï¼‰</h3>
<p><strong>åœºæ™¯</strong>ï¼šå®Œæ•´çš„è´­ç‰©è½¦æ•°æ®å¤„ç†æµç¨‹</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> cart = [
  {
    <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>,
    <span class="hljs-attr">type</span>: <span class="hljs-string">'bundle'</span>,
    <span class="hljs-attr">name</span>: <span class="hljs-string">'è‹¹æœå¥—è£…'</span>,
    <span class="hljs-attr">items</span>: [
      { <span class="hljs-attr">sku</span>: <span class="hljs-string">'IPHONE'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'iPhone'</span>, <span class="hljs-attr">price</span>: <span class="hljs-number">5999</span>, <span class="hljs-attr">stock</span>: <span class="hljs-number">10</span>, <span class="hljs-attr">category</span>: <span class="hljs-string">'æ‰‹æœº'</span> },
      { <span class="hljs-attr">sku</span>: <span class="hljs-string">'AIRPODS'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'AirPods'</span>, <span class="hljs-attr">price</span>: <span class="hljs-number">1999</span>, <span class="hljs-attr">stock</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">category</span>: <span class="hljs-string">'é…ä»¶'</span> }
    ]
  },
  {
    <span class="hljs-attr">id</span>: <span class="hljs-number">2</span>,
    <span class="hljs-attr">type</span>: <span class="hljs-string">'single'</span>,
    <span class="hljs-attr">name</span>: <span class="hljs-string">'MacBook'</span>,
    <span class="hljs-attr">sku</span>: <span class="hljs-string">'MACBOOK'</span>,
    <span class="hljs-attr">price</span>: <span class="hljs-number">14999</span>,
    <span class="hljs-attr">stock</span>: <span class="hljs-number">5</span>,
    <span class="hljs-attr">category</span>: <span class="hljs-string">'ç”µè„‘'</span>,
    <span class="hljs-attr">options</span>: { <span class="hljs-attr">colors</span>: [<span class="hljs-string">'æ·±ç©ºç°'</span>, <span class="hljs-string">'é“¶è‰²'</span>], <span class="hljs-attr">sizes</span>: [<span class="hljs-string">'14å¯¸'</span>, <span class="hljs-string">'16å¯¸'</span>] }
  },
  {
    <span class="hljs-attr">id</span>: <span class="hljs-number">3</span>,
    <span class="hljs-attr">type</span>: <span class="hljs-string">'single'</span>,
    <span class="hljs-attr">name</span>: <span class="hljs-string">'é¼ æ ‡'</span>,
    <span class="hljs-attr">sku</span>: <span class="hljs-string">'MOUSE'</span>,
    <span class="hljs-attr">price</span>: <span class="hljs-number">299</span>,
    <span class="hljs-attr">stock</span>: <span class="hljs-number">100</span>,
    <span class="hljs-attr">category</span>: <span class="hljs-string">'é…ä»¶'</span>
  }
];

<span class="hljs-comment">// æ­¥éª¤1ï¼šå±•å¼€æ‰€æœ‰å•†å“ï¼ˆåŒ…æ‹¬å¥—è£…ï¼‰</span>
<span class="hljs-keyword">const</span> expanded = cart.<span class="hljs-title function_">flatMap</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> {
  <span class="hljs-keyword">if</span> (item.<span class="hljs-property">type</span> === <span class="hljs-string">'bundle'</span>) {
    <span class="hljs-keyword">return</span> item.<span class="hljs-property">items</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">sub</span> =&gt;</span> ({ 
      ...sub, 
      <span class="hljs-attr">bundleId</span>: item.<span class="hljs-property">id</span>,
      <span class="hljs-attr">bundleName</span>: item.<span class="hljs-property">name</span> 
    }));
  }
  <span class="hljs-keyword">return</span> [item];
});

<span class="hljs-comment">// æ­¥éª¤2ï¼šè¿‡æ»¤åº“å­˜ä¸º0çš„å•†å“</span>
<span class="hljs-keyword">const</span> available = expanded.<span class="hljs-title function_">flatMap</span>(<span class="hljs-function"><span class="hljs-params">product</span> =&gt;</span>
  product.<span class="hljs-property">stock</span> &gt; <span class="hljs-number">0</span> ? [product] : []
);

<span class="hljs-comment">// æ­¥éª¤3ï¼šç”Ÿæˆ SKU ç»„åˆ</span>
<span class="hljs-keyword">const</span> withSkus = available.<span class="hljs-title function_">flatMap</span>(<span class="hljs-function"><span class="hljs-params">product</span> =&gt;</span> {
  <span class="hljs-keyword">if</span> (product.<span class="hljs-property">options</span>) {
    <span class="hljs-keyword">const</span> { colors, sizes } = product.<span class="hljs-property">options</span>;
    <span class="hljs-keyword">return</span> colors.<span class="hljs-title function_">flatMap</span>(<span class="hljs-function"><span class="hljs-params">color</span> =&gt;</span>
      sizes.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">size</span> =&gt;</span> ({
        ...product,
        <span class="hljs-attr">sku</span>: <span class="hljs-string">`<span class="hljs-subst">${product.sku}</span>-<span class="hljs-subst">${color}</span>-<span class="hljs-subst">${size}</span>`</span>,
        <span class="hljs-attr">variant</span>: <span class="hljs-string">`<span class="hljs-subst">${color}</span> <span class="hljs-subst">${size}</span>`</span>,
        <span class="hljs-attr">unitPrice</span>: product.<span class="hljs-property">price</span>
      }))
    );
  }
  <span class="hljs-keyword">return</span> [product];
});

<span class="hljs-comment">// æ­¥éª¤4ï¼šæŒ‰åˆ†ç±»åˆ†ç»„</span>
<span class="hljs-keyword">const</span> byCategory = withSkus.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">acc, item</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> cat = item.<span class="hljs-property">category</span>;
  <span class="hljs-keyword">if</span> (!acc[cat]) acc[cat] = [];
  acc[cat].<span class="hljs-title function_">push</span>(item);
  <span class="hljs-keyword">return</span> acc;
}, {});

<span class="hljs-comment">// æ­¥éª¤5ï¼šç”Ÿæˆè®¢å•æ‘˜è¦</span>
<span class="hljs-keyword">const</span> orderSummary = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">entries</span>(byCategory).<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">[category, items]</span>) =&gt;</span> ({
  category,
  <span class="hljs-attr">count</span>: items.<span class="hljs-property">length</span>,
  <span class="hljs-attr">items</span>: items.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">i</span> =&gt;</span> ({
    <span class="hljs-attr">name</span>: i.<span class="hljs-property">name</span>,
    <span class="hljs-attr">sku</span>: i.<span class="hljs-property">sku</span>,
    <span class="hljs-attr">price</span>: i.<span class="hljs-property">unitPrice</span> || i.<span class="hljs-property">price</span>
  })),
  <span class="hljs-attr">subtotal</span>: items.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">sum, i</span>) =&gt;</span> sum + (i.<span class="hljs-property">unitPrice</span> || i.<span class="hljs-property">price</span>), <span class="hljs-number">0</span>)
}));

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'è®¢å•æ‘˜è¦:'</span>, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(orderSummary, <span class="hljs-literal">null</span>, <span class="hljs-number">2</span>));
</code></pre>
<p><strong>è¾“å‡ºç»“æœ</strong>ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">[</span>
  <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"category"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"æ‰‹æœº"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"count"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"items"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span> <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"iPhone"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"sku"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"IPHONE"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"price"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">5999</span> <span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"subtotal"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">5999</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"category"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ç”µè„‘"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"count"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">4</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"items"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
      <span class="hljs-punctuation">{</span> <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"MacBook"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"sku"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"MACBOOK-æ·±ç©ºç°-14å¯¸"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"price"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">14999</span> <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-punctuation">{</span> <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"MacBook"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"sku"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"MACBOOK-æ·±ç©ºç°-16å¯¸"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"price"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">14999</span> <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-punctuation">{</span> <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"MacBook"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"sku"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"MACBOOK-é“¶è‰²-14å¯¸"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"price"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">14999</span> <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-punctuation">{</span> <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"MacBook"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"sku"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"MACBOOK-é“¶è‰²-16å¯¸"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"price"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">14999</span> <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"subtotal"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">59996</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"category"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"é…ä»¶"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"count"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"items"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span> <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"é¼ æ ‡"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"sku"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"MOUSE"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"price"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">299</span> <span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"subtotal"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">299</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">]</span>
</code></pre>
<hr/>
<h2 data-id="heading-24">ç¬¬å››éƒ¨åˆ†ï¼šæ€§èƒ½å¯¹æ¯”ä¸æœ€ä½³å®è·µ</h2>
<h3 data-id="heading-25">æ€§èƒ½æµ‹è¯•</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// æµ‹è¯•æ•°æ®ï¼š10000 æ¡è®¢å•</span>
<span class="hljs-keyword">const</span> orders = <span class="hljs-title class_">Array</span>(<span class="hljs-number">10000</span>).<span class="hljs-title function_">fill</span>(<span class="hljs-literal">null</span>).<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">_, i</span>) =&gt;</span> ({
  <span class="hljs-attr">status</span>: i % <span class="hljs-number">2</span> === <span class="hljs-number">0</span> ? <span class="hljs-string">'paid'</span> : <span class="hljs-string">'pending'</span>,
  <span class="hljs-attr">items</span>: [<span class="hljs-string">`item-<span class="hljs-subst">${i}</span>-a`</span>, <span class="hljs-string">`item-<span class="hljs-subst">${i}</span>-b`</span>]
}));

<span class="hljs-comment">// æ–¹æ³•1ï¼šfilter + map + flat</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">time</span>(<span class="hljs-string">'filter-map-flat'</span>);
<span class="hljs-keyword">const</span> r1 = orders
  .<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">o</span> =&gt;</span> o.<span class="hljs-property">status</span> === <span class="hljs-string">'paid'</span>)
  .<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">o</span> =&gt;</span> o.<span class="hljs-property">items</span>)
  .<span class="hljs-title function_">flat</span>();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">timeEnd</span>(<span class="hljs-string">'filter-map-flat'</span>); <span class="hljs-comment">// ~2.5ms</span>

<span class="hljs-comment">// æ–¹æ³•2ï¼šflatMap</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">time</span>(<span class="hljs-string">'flatMap'</span>);
<span class="hljs-keyword">const</span> r2 = orders.<span class="hljs-title function_">flatMap</span>(<span class="hljs-function"><span class="hljs-params">o</span> =&gt;</span>
  o.<span class="hljs-property">status</span> === <span class="hljs-string">'paid'</span> ? o.<span class="hljs-property">items</span> : []
);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">timeEnd</span>(<span class="hljs-string">'flatMap'</span>); <span class="hljs-comment">// ~1.2ms</span>

<span class="hljs-comment">// flatMap å¿« 2 å€ï¼</span>
</code></pre>
<h3 data-id="heading-26">ä½¿ç”¨å£è¯€</h3>
<ol>
<li><strong>èƒ½ä¸€æ¬¡éå†åšå®Œï¼Œç»ä¸ç”¨ä¸¤æ¬¡</strong>ï¼ˆfilter + map â†’ flatMapï¼‰</li>
<li><strong>éœ€è¦æ¡ä»¶è¿‡æ»¤ + è½¬æ¢ â†’ flatMap</strong></li>
<li><strong>éœ€è¦å±•å¼€åµŒå¥—æ•°ç»„ â†’ flatMap</strong></li>
<li><strong>flatMap åªæ‰å¹³ä¸€å±‚ï¼Œæ·±åº¦æ‰å¹³éœ€è¦é€’å½’</strong></li>
<li><strong>å¤§æ•°æ®é‡ä¼˜å…ˆç”¨ flatMap å‡å°‘ä¸­é—´æ•°ç»„åˆ›å»º</strong></li>
</ol>
<hr/>
<h2 data-id="heading-27">ç¬¬äº”éƒ¨åˆ†ï¼šå¸¸è§è¸©å‘è®°å½•</h2>
<h3 data-id="heading-28">å‘ 1ï¼šè¯¯ç”¨ ?? æˆ– || å¯¼è‡´æ•°æ®ä¸¢å¤±</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> data = [<span class="hljs-number">0</span>, <span class="hljs-string">''</span>, <span class="hljs-literal">false</span>, <span class="hljs-literal">null</span>, <span class="hljs-literal">undefined</span>];

<span class="hljs-comment">// âŒ é”™è¯¯ï¼šä¼šè¿‡æ»¤æ‰ 0ã€''ã€false</span>
<span class="hljs-keyword">const</span> wrong = data.<span class="hljs-title function_">flatMap</span>(<span class="hljs-function"><span class="hljs-params">x</span> =&gt;</span> x || []); <span class="hljs-comment">// []</span>
<span class="hljs-keyword">const</span> wrong2 = data.<span class="hljs-title function_">flatMap</span>(<span class="hljs-function"><span class="hljs-params">x</span> =&gt;</span> x ?? []); <span class="hljs-comment">// []</span>

<span class="hljs-comment">// âœ… æ­£ç¡®ï¼šåªè¿‡æ»¤ null/undefined</span>
<span class="hljs-keyword">const</span> right = data.<span class="hljs-title function_">flatMap</span>(<span class="hljs-function"><span class="hljs-params">x</span> =&gt;</span> x != <span class="hljs-literal">null</span> ? [x] : []); 
<span class="hljs-comment">// [0, '', false]</span>
</code></pre>
<h3 data-id="heading-29">å‘ 2ï¼šasync å‡½æ•°ä¸èƒ½ç›´æ¥ç”¨äº flatMap</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> ids = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>];

<span class="hljs-comment">// âŒ é”™è¯¯ï¼šflatMap ä¸ä¼šç­‰å¾… Promise</span>
<span class="hljs-keyword">const</span> wrong = ids.<span class="hljs-title function_">flatMap</span>(<span class="hljs-keyword">async</span> id =&gt; {
  <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`/api/<span class="hljs-subst">${id}</span>`</span>);
  <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">json</span>();
});
<span class="hljs-comment">// è¿”å›çš„æ˜¯ [Promise, Promise, Promise]</span>

<span class="hljs-comment">// âœ… æ­£ç¡®ï¼šå…ˆç”¨ Promise.allï¼Œå†ç”¨ flatMap</span>
<span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>(ids.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">id</span> =&gt;</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`/api/<span class="hljs-subst">${id}</span>`</span>)));
<span class="hljs-keyword">const</span> results = data.<span class="hljs-title function_">flatMap</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> res.<span class="hljs-property">items</span> || []);
</code></pre>
<h3 data-id="heading-30">å‘ 3ï¼šè¿”å›éæ•°ç»„ä¼šæŠ¥é”™</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> nums = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>];

<span class="hljs-comment">// âŒ é”™è¯¯ï¼šè¿”å›éæ•°ç»„</span>
<span class="hljs-comment">// const wrong = nums.flatMap(n =&gt; n * 2); // TypeError</span>

<span class="hljs-comment">// âœ… æ­£ç¡®ï¼šè¿”å›æ•°ç»„</span>
<span class="hljs-keyword">const</span> right = nums.<span class="hljs-title function_">flatMap</span>(<span class="hljs-function"><span class="hljs-params">n</span> =&gt;</span> [n * <span class="hljs-number">2</span>]); <span class="hljs-comment">// [2, 4, 6]</span>
</code></pre>
<hr/>
<h2 data-id="heading-31">æ€»ç»“</h2>
<p>ç»è¿‡ 3 ä¸ªé¡¹ç›®çš„å®æˆ˜æ£€éªŒï¼ŒflatMap æ˜¯æˆ‘ä½¿ç”¨é¢‘ç‡æœ€é«˜çš„æ•°ç»„æ–¹æ³•ä¹‹ä¸€ã€‚å®ƒçš„æ ¸å¿ƒä¼˜åŠ¿ï¼š</p>

























<table><thead><tr><th>ä¼˜åŠ¿</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>æ€§èƒ½</td><td>å‡å°‘éå†æ¬¡æ•°ï¼Œå¤§æ•°æ®é‡æ—¶ä¼˜åŠ¿æ˜æ˜¾</td></tr><tr><td>ç®€æ´</td><td>filter + map åˆå¹¶æˆä¸€è¡Œä»£ç </td></tr><tr><td>çµæ´»</td><td>æ”¯æŒæ¡ä»¶å±•å¼€ã€åŠ¨æ€è¿”å› 0/1/N ä¸ªå…ƒç´ </td></tr><tr><td>ç»„åˆ</td><td>å¯é“¾å¼è°ƒç”¨ï¼Œæ„å»ºæ•°æ®å¤„ç†ç®¡é“</td></tr></tbody></table>
<p><strong>è®°ä½æ ¸å¿ƒå¿ƒæ³•</strong>ï¼š</p>
<ul>
<li>éœ€è¦ã€Œæ¡ä»¶è¿‡æ»¤ + è½¬æ¢ã€â†’ flatMap</li>
<li>éœ€è¦ã€Œå±•å¼€åµŒå¥—ã€â†’ flatMap</li>
<li>èƒ½ä¸€æ¬¡éå† â†’ ç»ä¸ç”¨ä¸¤æ¬¡</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Java çº¿ç¨‹åŒæ­¥-02ï¼šä¸åŒé”çŠ¶æ€ä¸‹Javaå¯¹è±¡å¤´çš„è¡¨ç°]]></title>    <link>https://juejin.cn/post/7604697194795892746</link>    <guid>https://juejin.cn/post/7604697194795892746</guid>    <pubDate>2026-02-10T03:08:31.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604697194795892746" data-draft-id="7604672395627790363" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Java çº¿ç¨‹åŒæ­¥-02ï¼šä¸åŒé”çŠ¶æ€ä¸‹Javaå¯¹è±¡å¤´çš„è¡¨ç°"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2026-02-10T03:08:31.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç™½è¡£é¸½å­"/> <meta itemprop="url" content="https://juejin.cn/user/3072451409619223"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Java çº¿ç¨‹åŒæ­¥-02ï¼šä¸åŒé”çŠ¶æ€ä¸‹Javaå¯¹è±¡å¤´çš„è¡¨ç°
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3072451409619223/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç™½è¡£é¸½å­
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T03:08:31.000Z" title="Tue Feb 10 2026 03:08:31 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å‰è¨€</h2>
<p>æœ¬æ–‡ä¸»è¦åˆ†äº«ä¸åŒé”çŠ¶æ€ä¸‹ï¼ŒJavaå¯¹è±¡å¤´çš„å¸ƒå±€æ˜¯æ€ä¹ˆæ ·çš„ï¼Œé‡ç‚¹å…³æ³¨å…¶ä¸­çš„Mark Wordå­—æ®µã€‚æ–‡ç« æ„æˆå¦‚ä¸‹ï¼šMark Wrod å­—æ®µå¯¹ç…§è¡¨ã€é”çŠ¶æ€è¡¨ã€JOLæŸ¥çœ‹å¯¹è±¡å¤´å®æˆ˜ã€å…³äºåå‘é”çš„ç‰¹æ®Šè¯´æ˜ã€‚</p>
<h2 data-id="heading-1">Mark Wordå­—æ®µå¯¹ç…§è¡¨</h2>











































































<table><thead><tr><th>English è‹±æ–‡</th><th>Chinese ä¸­æ–‡</th><th>Description æè¿°</th></tr></thead><tbody><tr><td><strong>bits</strong></td><td>ä½</td><td>Basic unit of digital information æ•°å­—ä¿¡æ¯çš„åŸºæœ¬å•ä½</td></tr><tr><td><strong>unused</strong></td><td>æœªä½¿ç”¨</td><td>Reserved space, not currently used ä¿ç•™ç©ºé—´ï¼Œå½“å‰æœªä½¿ç”¨</td></tr><tr><td><strong>identity_hashcode</strong></td><td>å¯¹è±¡å“ˆå¸Œç </td><td>Unique hash code of the object å¯¹è±¡çš„å”¯ä¸€å“ˆå¸Œç </td></tr><tr><td><strong>age</strong></td><td>GCå¹´é¾„</td><td>Generation count in garbage collection åƒåœ¾å›æ”¶ä¸­çš„åˆ†ä»£è®¡æ•°</td></tr><tr><td><strong>thread</strong></td><td>çº¿ç¨‹ID</td><td>Identifier of the thread holding the lock æŒæœ‰é”çš„çº¿ç¨‹æ ‡è¯†ç¬¦</td></tr><tr><td><strong>epoch</strong></td><td>æ—¶é—´æˆ³/ç‰ˆæœ¬å·</td><td>Timestamp or version for biased locks åå‘é”çš„æ—¶é—´æˆ³æˆ–ç‰ˆæœ¬å·</td></tr><tr><td><strong>ptr_to_lock_record</strong></td><td>æŒ‡å‘æ ˆä¸­é”è®°å½•çš„æŒ‡é’ˆ</td><td>Pointer to lock record in thread stack æŒ‡å‘çº¿ç¨‹æ ˆä¸­é”è®°å½•çš„æŒ‡é’ˆ</td></tr><tr><td><strong>ptr_to_monitor</strong></td><td>æŒ‡å‘Monitorå¯¹è±¡çš„æŒ‡é’ˆ</td><td>Pointer to ObjectMonitor object æŒ‡å‘ObjectMonitorå¯¹è±¡çš„æŒ‡é’ˆ</td></tr><tr><td><strong>Normal (Unlocked)</strong></td><td>æ— é”çŠ¶æ€</td><td>No thread holds the lock æ— çº¿ç¨‹æŒæœ‰é”</td></tr><tr><td><strong>Biased Lock</strong></td><td>åå‘é”</td><td>Lock biased towards first acquiring thread åå‘äºç¬¬ä¸€ä¸ªè·å–é”çš„çº¿ç¨‹</td></tr><tr><td><strong>Thin Lock</strong></td><td>è½»é‡çº§é”</td><td>Lock using CAS and stack records ä½¿ç”¨CASå’Œæ ˆè®°å½•çš„é”</td></tr><tr><td><strong>Fat Lock</strong></td><td>é‡é‡çº§é”</td><td>Lock using OS-level monitor ä½¿ç”¨æ“ä½œç³»ç»Ÿçº§ç›‘è§†å™¨çš„é”</td></tr><tr><td><strong>GC Marked</strong></td><td>GCæ ‡è®°</td><td>Object marked during garbage collection åƒåœ¾å›æ”¶æœŸé—´æ ‡è®°çš„å¯¹è±¡</td></tr></tbody></table>
<h2 data-id="heading-2">çŠ¶æ€è¡¨</h2>















































<table><thead><tr><th>é”çŠ¶æ€</th><th>é”æ ‡å¿—ä½ (2 bits)</th><th>åå‘é”æ ‡å¿— (1 bit)</th><th>Mark Word 64ä½ç»“æ„ (é«˜ä½ â†’ ä½ä½)</th><th>å­˜å‚¨å†…å®¹è¯´æ˜</th></tr></thead><tbody><tr><td><strong>æ— é”çŠ¶æ€</strong></td><td><strong>01</strong></td><td><strong>0</strong></td><td><code>25 bits unused</code>Â |Â <code>31 bits identity_hashcode</code>Â |Â <code>1 bit unused</code>Â |Â <code>4 bits age</code>Â |Â <code>0</code>Â |Â <code>01</code></td><td>â€¢ 31ä½ï¼šå¯¹è±¡å“ˆå¸Œç ï¼ˆç¬¬ä¸€æ¬¡è°ƒç”¨hashCode()æ—¶ç”Ÿæˆï¼‰<br/>â€¢ 4ä½ï¼šGCåˆ†ä»£å¹´é¾„ï¼ˆ0-15ï¼‰<br/>â€¢ 25ä½ï¼šæœªä½¿ç”¨<br/>â€¢ 1ä½ï¼šæœªä½¿ç”¨</td></tr><tr><td><strong>åå‘é”çŠ¶æ€</strong></td><td><strong>01</strong></td><td><strong>1</strong></td><td><code>54 bits thread</code>Â |Â <code>2 bits epoch</code>Â |Â <code>1 bit unused</code>Â |Â <code>4 bits age</code>Â |Â <code>1</code>Â |Â <code>01</code></td><td>â€¢ 54ä½ï¼šæŒæœ‰åå‘é”çš„çº¿ç¨‹ID<br/>â€¢ 2ä½ï¼šepochï¼ˆåå‘é”æ—¶é—´æˆ³ï¼‰<br/>â€¢ 4ä½ï¼šGCåˆ†ä»£å¹´é¾„<br/>â€¢ 1ä½ï¼šæœªä½¿ç”¨</td></tr><tr><td><strong>è½»é‡çº§é”çŠ¶æ€</strong></td><td><strong>00</strong></td><td>-</td><td><code>62 bits ptr_to_lock_record</code>Â |Â <code>00</code></td><td>â€¢ 62ä½ï¼šæŒ‡å‘æ ˆä¸­é”è®°å½•çš„æŒ‡é’ˆ<br/>â€¢ æŒ‡é’ˆæœ€å2ä½å®é™…ä¸º00ï¼ˆå¯¹é½è¦æ±‚ï¼‰</td></tr><tr><td><strong>é‡é‡çº§é”çŠ¶æ€</strong></td><td><strong>10</strong></td><td>-</td><td><code>62 bits ptr_to_monitor</code>Â |Â <code>10</code></td><td>â€¢ 62ä½ï¼šæŒ‡å‘ObjectMonitorå¯¹è±¡çš„æŒ‡é’ˆ<br/>â€¢ æŒ‡é’ˆæŒ‡å‘å †ä¸­çš„Monitorå®ä¾‹</td></tr><tr><td><strong>GCæ ‡è®°çŠ¶æ€</strong></td><td><strong>11</strong></td><td>-</td><td><code>62 bits GC information</code>Â |Â <code>11</code></td><td>â€¢ 62ä½ï¼šåƒåœ¾æ”¶é›†ç›¸å…³ä¿¡æ¯<br/>â€¢ ä¸åŒGCç®—æ³•å†…å®¹ä¸åŒ</td></tr></tbody></table>
<h2 data-id="heading-3">JOLå·¥å…·æŸ¥çœ‹å¯¹è±¡å¤´</h2>
<p>JOLï¼ˆJava Object Layoutï¼‰æ˜¯OpenJDKæä¾›çš„å®˜æ–¹å·¥å…·ï¼Œä¸“é—¨ç”¨äºåˆ†æJavaå¯¹è±¡çš„å†…å­˜å¸ƒå±€ã€‚åœ¨é¡¹ç›®ä¸­å¼•å…¥ç›¸å…³ä»£ç ä¾èµ–å¯ä»¥å‚è€ƒå¦‚ä¸‹ï¼š</p>
<p><strong>Maven:</strong></p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.openjdk.jol<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jol-core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>0.17<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>provided<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<p><strong>Gradle:</strong></p>
<pre><code class="hljs language-gradle" lang="gradle">dependencies {
    compileOnly 'org.openjdk.jol:jol-core:0.17'
}
</code></pre>
<p>ä¸‹é¢ç»™å‡ºä¸€ä¸ªä¸åŒé”çŠ¶æ€ä¸‹æŸ¥çœ‹å¯¹è±¡å¤´å¸ƒå±€çš„ä»£ç ç¤ºä¾‹ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥æœ¬åœ°è¿è¡Œï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> concurrent;

<span class="hljs-keyword">import</span> org.openjdk.jol.info.ClassLayout;

<span class="hljs-comment">/**
 * ä½¿ç”¨ JOLï¼ˆJava Object Layoutï¼‰æŸ¥çœ‹ Java å¯¹è±¡å¤´åœ¨ä¸åŒé”çŠ¶æ€ä¸‹çš„å˜åŒ–ã€‚
 * é¡ºåºï¼šæ— é” â†’ æ— é”(å« hash) â†’ åå‘é” â†’ è½»é‡çº§é” â†’ é‡é‡çº§é”ã€‚
 *
 * è¦çœ‹åˆ°ã€Œåå‘é”ã€å¿…é¡»å¼€å¯ JVM åå‘é”å¹¶å»æ‰å¯åŠ¨å»¶è¿Ÿï¼Œæ¨èè¿è¡Œï¼š
 *   ./gradlew runObjectHeaderDemo
 * ï¼ˆè¯¥ä»»åŠ¡å·²è‡ªåŠ¨æ·»åŠ  -XX:+UseBiasedLocking -XX:BiasedLockingStartupDelay=0ï¼‰
 *
 * è‹¥ä»ç”¨ runMain ä¸”æœªåŠ ä¸Šè¿° VM å‚æ•°ï¼ŒJDK 15+ ä¸‹ç¬¬ 3 æ­¥ä¼šæ˜¾ç¤º thin lock è€Œé biased lockã€‚
 * JDK 18+ å·²ç§»é™¤åå‘é”ï¼Œåªèƒ½çœ‹åˆ°è½»é‡çº§/é‡é‡çº§ã€‚
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ObjectHeaderDemo</span> {

    <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SimpleObject</span> {
        <span class="hljs-type">int</span> <span class="hljs-variable">x</span> <span class="hljs-operator">=</span> <span class="hljs-number">42</span>;
        <span class="hljs-type">long</span> <span class="hljs-variable">y</span> <span class="hljs-operator">=</span> <span class="hljs-number">100L</span>;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException {
        <span class="hljs-comment">// ç”¨äºå±•ç¤ºï¼šæ— é” â†’ æ— é”+hash â†’ è½»é‡çº§ â†’ é‡é‡çº§ï¼ˆæ­¤å¯¹è±¡ä¼šå…ˆç®— hashï¼Œå› æ­¤ä¸ä¼šè¿›å…¥åå‘ï¼‰</span>
        <span class="hljs-type">SimpleObject</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleObject</span>();

        <span class="hljs-comment">// 1. æ— é”</span>
        System.out.println(<span class="hljs-string">"=== 1. åˆå§‹çŠ¶æ€ï¼ˆæ— é”ï¼‰ ==="</span>);
        System.out.println(ClassLayout.parseInstance(obj).toPrintable());

        <span class="hljs-comment">// 2. æ— é”ä½†å·²å†™å…¥ identity hashCodeï¼ˆä¸€æ—¦å†™å…¥ hashï¼Œè¯¥å¯¹è±¡æ°¸è¿œæ— æ³•è¿›å…¥åå‘é”ï¼‰</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">hc</span> <span class="hljs-operator">=</span> System.identityHashCode(obj);
        System.out.println(<span class="hljs-string">"identityHashCode = 0x"</span> + Integer.toHexString(hc));
        System.out.println(<span class="hljs-string">"\n=== 2. å†™å…¥ hashCode åï¼ˆæ— é”ï¼Œä¸”æ­¤å¯¹è±¡ä¹‹åæ— æ³•åå‘ï¼‰ ==="</span>);
        System.out.println(ClassLayout.parseInstance(obj).toPrintable());

        <span class="hljs-comment">// 3. åå‘é”ï¼šå¿…é¡»ç”¨ã€Œä»æœªç®—è¿‡ hashã€çš„å¯¹è±¡ï¼Œä¸”è¦ç­‰åå‘ç”Ÿæ•ˆï¼ˆé»˜è®¤çº¦ 4sï¼‰</span>
        <span class="hljs-type">SimpleObject</span> <span class="hljs-variable">biasedCandidate</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleObject</span>();
        System.out.println(<span class="hljs-string">"\n=== 3. åå‘é”ï¼ˆç­‰å¾… "</span> + <span class="hljs-number">5</span> + <span class="hljs-string">" ç§’è®© JVM å¼€å¯è¯¥ç±»åå‘ï¼Œä¸”æ­¤å¯¹è±¡ä»æœªè°ƒç”¨ identityHashCodeï¼‰ ==="</span>);
        Thread.sleep(<span class="hljs-number">5000</span>);
        <span class="hljs-keyword">synchronized</span> (biasedCandidate) {
            System.out.println(ClassLayout.parseInstance(biasedCandidate).toPrintable());
        }

        <span class="hljs-comment">// 4. è½»é‡çº§é”ï¼šå¯¹å·²å†™ hash çš„ obj åŠ é”ï¼Œåªèƒ½æ˜¯è½»é‡çº§</span>
        System.out.println(<span class="hljs-string">"\n=== 4. è½»é‡çº§é”ï¼ˆåŒä¸€çº¿ç¨‹å¯¹ obj åŠ é”ï¼‰ ==="</span>);
        <span class="hljs-keyword">synchronized</span> (obj) {
            System.out.println(ClassLayout.parseInstance(obj).toPrintable());
        }

        <span class="hljs-comment">// 5. å¤šçº¿ç¨‹ç«äº‰ â†’ é‡é‡çº§é”</span>
        System.out.println(<span class="hljs-string">"\n=== 5. å¤šçº¿ç¨‹ç«äº‰ä¸‹çš„å¯¹è±¡å¤´ï¼ˆå¯èƒ½è†¨èƒ€ä¸ºé‡é‡çº§é”ï¼‰ ==="</span>);
        showContendedLockStates(obj);
    }

    <span class="hljs-comment">/**
     * å±•ç¤ºåœ¨å¤šçº¿ç¨‹ç«äº‰åŒä¸€ä¸ªé”æ—¶ï¼Œå¯¹è±¡å¤´çš„å˜åŒ–ã€‚
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">showContendedLockStates</span><span class="hljs-params">(SimpleObject obj)</span> <span class="hljs-keyword">throws</span> InterruptedException {
        <span class="hljs-type">Thread</span> <span class="hljs-variable">t1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
            <span class="hljs-keyword">synchronized</span> (obj) {
                System.out.println(<span class="hljs-string">"T1 è·å–åˆ°é”æ—¶çš„å¯¹è±¡å¤´ï¼š"</span>);
                System.out.println(ClassLayout.parseInstance(obj).toPrintable());
                <span class="hljs-comment">// ä¿æŒä¸€æ®µæ—¶é—´ï¼Œè®© T2 æœ‰æœºä¼šç«äº‰è¿™æŠŠé”</span>
                sleepQuietly(<span class="hljs-number">500</span>);
            }
            System.out.println(<span class="hljs-string">"T1 é‡Šæ”¾é”åç»“æŸ"</span>);
        }, <span class="hljs-string">"T1-holder"</span>);

        <span class="hljs-type">Thread</span> <span class="hljs-variable">t2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
            <span class="hljs-comment">// å…ˆç¨å¾®ç­‰å¾…ï¼Œå°½é‡ä¿è¯åœ¨ T1 å·²ç»æŒé”çš„æƒ…å†µä¸‹æ¥ç«äº‰</span>
            sleepQuietly(<span class="hljs-number">50</span>);
            <span class="hljs-keyword">synchronized</span> (obj) {
                System.out.println(<span class="hljs-string">"T2 ç«äº‰å¹¶è·å–åˆ°é”æ—¶çš„å¯¹è±¡å¤´ï¼š"</span>);
                System.out.println(ClassLayout.parseInstance(obj).toPrintable());
            }
            System.out.println(<span class="hljs-string">"T2 é‡Šæ”¾é”åç»“æŸ"</span>);
        }, <span class="hljs-string">"T2-contender"</span>);

        System.out.println(<span class="hljs-string">"ä¸»çº¿ç¨‹ï¼šå¯åŠ¨ T1ã€T2 ä¹‹å‰çš„å¯¹è±¡å¤´ï¼š"</span>);
        System.out.println(ClassLayout.parseInstance(obj).toPrintable());

        t1.start();
        t2.start();

        t1.join();
        t2.join();

        System.out.println(<span class="hljs-string">"ä¸»çº¿ç¨‹ï¼šT1ã€T2 éƒ½ç»“æŸåçš„å¯¹è±¡å¤´ï¼š"</span>);
        System.out.println(ClassLayout.parseInstance(obj).toPrintable());
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sleepQuietly</span><span class="hljs-params">(<span class="hljs-type">long</span> ms)</span> {
        <span class="hljs-keyword">try</span> {
            Thread.sleep(ms);
        } <span class="hljs-keyword">catch</span> (InterruptedException e) {
            Thread.currentThread().interrupt();
        }
    }
}
</code></pre>
<p>ä»¥ä¸Šä»£ç åœ¨æˆ‘æœ¬åœ°è¿è¡Œçš„ç»“æœï¼Œå¯å‚è€ƒå¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-shell" lang="shell"> code git:(main) âœ— ./gradlew runObjectHeaderDemo
<span class="hljs-meta prompt_">
&gt; </span><span class="bash">Task :runObjectHeaderDemo</span>
OpenJDK 64-Bit Server VM warning: Option UseBiasedLocking was deprecated in version 15.0 and will likely be removed in a future release.
OpenJDK 64-Bit Server VM warning: Option BiasedLockingStartupDelay was deprecated in version 15.0 and will likely be removed in a future release.
=== 1. åˆå§‹çŠ¶æ€ï¼ˆæ— é”ï¼‰ ===
<span class="hljs-meta prompt_"># </span><span class="bash">WARNING: Unable to attach Serviceability Agent. You can try again with escalated privileges. Two options: a) use -Djol.tryWithSudo=<span class="hljs-literal">true</span> to try with sudo; b) <span class="hljs-built_in">echo</span> 0 | sudo <span class="hljs-built_in">tee</span> /proc/sys/kernel/yama/ptrace_scope</span>
concurrent.ObjectHeaderDemo$SimpleObject object internals:
OFF  SZ   TYPE DESCRIPTION               VALUE
  0   8        (object header: mark)     0x0000000000000005 (biasable; age: 0)
  8   4        (object header: class)    0x00000a30
 12   4    int SimpleObject.x            42
 16   8   long SimpleObject.y            100
Instance size: 24 bytes
Space losses: 0 bytes internal + 0 bytes external = 0 bytes total

identityHashCode = 0x15ff3e9e

=== 2. å†™å…¥ hashCode åï¼ˆæ— é”ï¼Œä¸”æ­¤å¯¹è±¡ä¹‹åæ— æ³•åå‘ï¼‰ ===
concurrent.ObjectHeaderDemo$SimpleObject object internals:
OFF  SZ   TYPE DESCRIPTION               VALUE
  0   8        (object header: mark)     0x00000015ff3e9e01 (hash: 0x15ff3e9e; age: 0)
  8   4        (object header: class)    0x00000a30
 12   4    int SimpleObject.x            42
 16   8   long SimpleObject.y            100
Instance size: 24 bytes
Space losses: 0 bytes internal + 0 bytes external = 0 bytes total


=== 3. åå‘é”ï¼ˆç­‰å¾… 5 ç§’è®© JVM å¼€å¯è¯¥ç±»åå‘ï¼Œä¸”æ­¤å¯¹è±¡ä»æœªè°ƒç”¨ identityHashCodeï¼‰ ===
concurrent.ObjectHeaderDemo$SimpleObject object internals:
OFF  SZ   TYPE DESCRIPTION               VALUE
  0   8        (object header: mark)     0x00007fb3c9008805 (biased: 0x0000001fecf24022; epoch: 0; age: 0)
  8   4        (object header: class)    0x00000a30
 12   4    int SimpleObject.x            42
 16   8   long SimpleObject.y            100
Instance size: 24 bytes
Space losses: 0 bytes internal + 0 bytes external = 0 bytes total


=== 4. è½»é‡çº§é”ï¼ˆåŒä¸€çº¿ç¨‹å¯¹ obj åŠ é”ï¼‰ ===
concurrent.ObjectHeaderDemo$SimpleObject object internals:
OFF  SZ   TYPE DESCRIPTION               VALUE
  0   8        (object header: mark)     0x000070000c139ab0 (thin lock: 0x000070000c139ab0)
  8   4        (object header: class)    0x00000a30
 12   4    int SimpleObject.x            42
 16   8   long SimpleObject.y            100
Instance size: 24 bytes
Space losses: 0 bytes internal + 0 bytes external = 0 bytes total


=== 5. å¤šçº¿ç¨‹ç«äº‰ä¸‹çš„å¯¹è±¡å¤´ï¼ˆå¯èƒ½è†¨èƒ€ä¸ºé‡é‡çº§é”ï¼‰ ===
ä¸»çº¿ç¨‹ï¼šå¯åŠ¨ T1ã€T2 ä¹‹å‰çš„å¯¹è±¡å¤´ï¼š
concurrent.ObjectHeaderDemo$SimpleObject object internals:
OFF  SZ   TYPE DESCRIPTION               VALUE
  0   8        (object header: mark)     0x00000015ff3e9e01 (hash: 0x15ff3e9e; age: 0)
  8   4        (object header: class)    0x00000a30
 12   4    int SimpleObject.x            42
 16   8   long SimpleObject.y            100
Instance size: 24 bytes
Space losses: 0 bytes internal + 0 bytes external = 0 bytes total

T1 è·å–åˆ°é”æ—¶çš„å¯¹è±¡å¤´ï¼š
concurrent.ObjectHeaderDemo$SimpleObject object internals:
OFF  SZ   TYPE DESCRIPTION               VALUE
  0   8        (object header: mark)     0x000070000d59fa10 (thin lock: 0x000070000d59fa10)
  8   4        (object header: class)    0x00000a30
 12   4    int SimpleObject.x            42
 16   8   long SimpleObject.y            100
Instance size: 24 bytes
Space losses: 0 bytes internal + 0 bytes external = 0 bytes total

T1 é‡Šæ”¾é”åç»“æŸ
T2 ç«äº‰å¹¶è·å–åˆ°é”æ—¶çš„å¯¹è±¡å¤´ï¼š
concurrent.ObjectHeaderDemo$SimpleObject object internals:
OFF  SZ   TYPE DESCRIPTION               VALUE
  0   8        (object header: mark)     0x00007fb3d0013712 (fat lock: 0x00007fb3d0013712)
  8   4        (object header: class)    0x00000a30
 12   4    int SimpleObject.x            42
 16   8   long SimpleObject.y            100
Instance size: 24 bytes
Space losses: 0 bytes internal + 0 bytes external = 0 bytes total

T2 é‡Šæ”¾é”åç»“æŸ
ä¸»çº¿ç¨‹ï¼šT1ã€T2 éƒ½ç»“æŸåçš„å¯¹è±¡å¤´ï¼š
concurrent.ObjectHeaderDemo$SimpleObject object internals:
OFF  SZ   TYPE DESCRIPTION               VALUE
  0   8        (object header: mark)     0x00007fb3d0013712 (fat lock: 0x00007fb3d0013712)
  8   4        (object header: class)    0x00000a30
 12   4    int SimpleObject.x            42
 16   8   long SimpleObject.y            100
Instance size: 24 bytes
Space losses: 0 bytes internal + 0 bytes external = 0 bytes total
</code></pre>
<h2 data-id="heading-4">å…³äºåå‘é”çš„ç‰¹æ®Šè¯´æ˜</h2>
<p>Javaé«˜ç‰ˆæœ¬é€æ¸ç§»é™¤åå‘é”ï¼Œç§»é™¤æ—¶é—´çº¿ï¼š</p>
<ul>
<li><strong>JDK 15</strong>: é»˜è®¤ç¦ç”¨åå‘é”ï¼ˆ<code>-XX:-UseBiasedLocking</code>ï¼‰</li>
<li><strong>JDK 18</strong>: å®Œå…¨ç§»é™¤åå‘é”ç›¸å…³ä»£ç </li>
<li><strong>å½“å‰çŠ¶æ€</strong>: æ‰€æœ‰ç°ä»£JVMç‰ˆæœ¬ï¼ˆJDK 18+ï¼‰éƒ½ä¸æ”¯æŒåå‘é”</li>
</ul>
<p>æ®æˆ‘æ‰€è§‚å¯Ÿï¼Œåå‘é”æœªå‡ºç°é€šå¸¸æœ‰ä¸‰ä¸ªå¯èƒ½åŸå› ï¼š</p>
<ol>
<li>å…ˆè°ƒç”¨äº†Â System.identityHashCode(obj)ï¼Œå¯¹è±¡å¤´é‡Œå†™å…¥äº† hashï¼Œå°±æ— æ³•å†è¿›å…¥åå‘é”ã€‚</li>
<li>åå‘æœ‰â€œå»¶è¿Ÿç”Ÿæ•ˆâ€ï¼ˆé»˜è®¤çº¦ 4 ç§’ï¼‰ï¼Œåˆš new å‡ºæ¥çš„å¯¹è±¡ä¸ä¼šç«‹åˆ»åå‘ã€‚</li>
<li>JDKç‰ˆæœ¬è¾ƒé«˜ï¼ŒJVMé»˜è®¤æœªå¼€å¯æˆ–è€…å·²ç»ç§»é™¤åå‘é”çš„ä½¿ç”¨ã€‚</li>
</ol>
<p>åœ¨æˆ‘æœ¬åœ°é¡¹ç›®è¿è¡Œè¿‡ç¨‹ä¸­ä½¿ç”¨çš„æ˜¯JDK17ï¼Œå¯ä»¥åœ¨è¿è¡Œæ—¶åŠ å…¥ä»¥ä¸‹JVMå‚æ•°ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// è¿è¡Œå¯¹è±¡å¤´ç¤ºä¾‹å¹¶å¼€å¯åå‘é”ï¼ˆä»… JDK 8~17 æœ‰æ•ˆï¼ŒJDK 18+ å·²ç§»é™¤åå‘é”ï¼‰</span>
tasks.register&lt;JavaExec&gt;(<span class="hljs-string">"runObjectHeaderDemo"</span>) {
    group = <span class="hljs-string">"application"</span>
    description = <span class="hljs-string">"Run ObjectHeaderDemo with -XX:+UseBiasedLocking to see biased lock state"</span>
    javaLauncher.set(javaToolchains.launcherFor {
        languageVersion.set(JavaLanguageVersion.of(<span class="hljs-number">17</span>))
    })
    mainClass.set(<span class="hljs-string">"concurrent.ObjectHeaderDemo"</span>)
    classpath = sourceSets[<span class="hljs-string">"main"</span>].runtimeClasspath
    <span class="hljs-title function_">jvmArgs</span><span class="hljs-params">(
        <span class="hljs-string">"-XX:+UseBiasedLocking"</span>,
        <span class="hljs-string">"-XX:BiasedLockingStartupDelay=0"</span>,
        <span class="hljs-string">"-Djdk.attach.allowAttachSelf=true"</span>  // è®© JOL èƒ½ attach å½“å‰è¿›ç¨‹ï¼Œé¿å… ClassLoader é‡å¤åŠ è½½å¯¼è‡´å¼‚å¸¸
    )</span>
}
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Flink ClickHouse Sinkï¼šç”Ÿäº§çº§é«˜å¯ç”¨å†™å…¥æ–¹æ¡ˆï½œå¾—ç‰©æŠ€æœ¯]]></title>    <link>https://juejin.cn/post/7604701848150556672</link>    <guid>https://juejin.cn/post/7604701848150556672</guid>    <pubDate>2026-02-10T03:11:38.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604701848150556672" data-draft-id="7604678037808644132" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Flink ClickHouse Sinkï¼šç”Ÿäº§çº§é«˜å¯ç”¨å†™å…¥æ–¹æ¡ˆï½œå¾—ç‰©æŠ€æœ¯"/> <meta itemprop="keywords" content="åç«¯,å¤§æ•°æ®"/> <meta itemprop="datePublished" content="2026-02-10T03:11:38.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å¾—ç‰©æŠ€æœ¯"/> <meta itemprop="url" content="https://juejin.cn/user/2392954206960247"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Flink ClickHouse Sinkï¼šç”Ÿäº§çº§é«˜å¯ç”¨å†™å…¥æ–¹æ¡ˆï½œå¾—ç‰©æŠ€æœ¯
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2392954206960247/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å¾—ç‰©æŠ€æœ¯
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T03:11:38.000Z" title="Tue Feb 10 2026 03:11:38 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»19åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä¸€ã€èƒŒæ™¯ä¸ç—›ç‚¹</h2>
<h3 data-id="heading-1">ä¸šåŠ¡åœºæ™¯</h3>
<p>åœ¨å®æ—¶å¤§æ•°æ®å¤„ç†åœºæ™¯ä¸­ï¼ŒFlink + ClickHouse çš„ç»„åˆè¢«å¹¿æ³›åº”ç”¨äºï¼š</p>
<ul>
<li><strong>æ—¥å¿—å¤„ç†ï¼š</strong> æµ·é‡åº”ç”¨æ—¥å¿—å®æ—¶å†™å…¥åˆ†æåº“ã€‚</li>
<li><strong>ç›‘æ§åˆ†æï¼š</strong> ä¸šåŠ¡æŒ‡æ ‡ã€APM æ•°æ®çš„å®æ—¶èšåˆã€‚</li>
</ul>
<p>è¿™äº›åœºæ™¯çš„å…±åŒç‰¹ç‚¹ï¼š</p>
<ul>
<li><strong>æ•°æ®é‡å¤§</strong>ï¼šç™¾ä¸‡çº§ TPSï¼Œå³°å€¼å¯è¾¾åƒä¸‡çº§ã€‚</li>
<li><strong>å†™å…¥å»¶è¿Ÿæ•æ„Ÿï¼š</strong> éœ€è¦ç§’çº§å¯è§ã€‚</li>
<li><strong>æ•°æ®å‡†ç¡®æ€§è¦æ±‚é«˜</strong>ï¼šä¸å…è®¸æ•°æ®ä¸¢å¤±ã€‚</li>
<li><strong>å¤šè¡¨å†™å…¥ï¼š</strong> ä¸åŒæ•°æ®æ ¹æ®åˆ†è¡¨ç­–ç•¥å†™å…¥ä¸åŒçš„è¡¨ã€‚</li>
</ul>
<h3 data-id="heading-2">å¼€æº Flink ClickHouse Sink çš„ç—›ç‚¹</h3>
<p>Flink å®˜æ–¹æä¾›çš„ ClickHouse Sinkï¼ˆflink-connector-jdbcï¼‰åœ¨ç”Ÿäº§ç¯å¢ƒä¸­å­˜åœ¨ä»¥ä¸‹ä¸¥é‡é—®é¢˜ï¼š</p>
<h4 data-id="heading-3">ç—›ç‚¹ä¸€ï¼šç¼ºä¹åŸºäºæ•°æ®é‡çš„æ”’æ‰¹æœºåˆ¶</h4>
<p><strong>é—®é¢˜è¡¨ç°ï¼š</strong></p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// Flink å®˜æ–¹ JDBC Sink çš„å®ç°</span>
<span class="hljs-keyword">public</span>Â <span class="hljs-keyword">class</span>Â <span class="hljs-title">JdbcSink</span>&lt;<span class="hljs-title">T</span>&gt;Â <span class="hljs-title">extends</span>Â <span class="hljs-title">RichSinkFunction</span>&lt;<span class="hljs-title">T</span>&gt; {
Â  Â Â <span class="hljs-keyword">private</span>Â finalÂ <span class="hljs-built_in">int</span>Â batchSize; Â <span class="hljs-comment">// å›ºå®šæ‰¹æ¬¡å¤§å°</span>
Â  Â  @Override
Â  Â Â <span class="hljs-function"><span class="hljs-keyword">public</span>Â <span class="hljs-keyword">void</span>Â <span class="hljs-title">invoke</span>(<span class="hljs-params">TÂ <span class="hljs-keyword">value</span>, Context context</span>)</span>Â {
Â  Â  Â  Â  bufferedValues.<span class="hljs-keyword">add</span>(<span class="hljs-keyword">value</span>);
Â  Â  Â  Â Â <span class="hljs-keyword">if</span>Â (bufferedValues.size() &gt;= batchSize) {
Â  Â  Â  Â  Â  Â Â <span class="hljs-comment">// åªèƒ½åŸºäºè®°å½•æ•°æ”’æ‰¹ï¼Œæ— æ³•åŸºäºæ•°æ®é‡</span>
Â  Â  Â  Â  Â  Â  flush();
Â  Â  Â  Â  }
Â  Â  }
</code></pre>
<p><strong>å¸¦æ¥çš„é—®é¢˜ï¼š</strong></p>
<ol>
<li><strong>å†…å­˜å ç”¨ä¸å¯æ§ï¼š</strong> 100 æ¡ 1KB çš„æ—¥å¿—å’Œ 100 æ¡ 10MB çš„æ—¥å¿—å ç”¨å†…å­˜å·®è· 100 å€ã€‚</li>
<li><strong>OOM é£é™©é«˜ï¼š</strong> å¤§æ—¥å¿—è®°å½•ï¼ˆå¦‚å †æ ˆè½¬å‚¨ï¼‰ä¼šè¿…é€Ÿæ’‘çˆ†å†…å­˜ã€‚</li>
<li><strong>å†™å…¥æ€§èƒ½å·®ï¼š</strong> æ— æ³•æ ¹æ®è®°å½•å¤§å°åŠ¨æ€è°ƒæ•´æ‰¹æ¬¡ï¼Œå¯¼è‡´å°è®°å½•æ‰¹æ¬¡è¿‡å¤§æµªè´¹ç½‘ç»œå¼€é”€ã€‚</li>
</ol>
<h4 data-id="heading-4">ç—›ç‚¹äºŒï¼šæ— æ³•æ”¯æŒåŠ¨æ€è¡¨ç»“æ„</h4>
<p><strong>é—®é¢˜è¡¨ç°ï¼š</strong></p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// Flink å®˜æ–¹ Sink åªèƒ½å†™å…¥å›ºå®šè¡¨</span>
<span class="hljs-keyword">public</span>Â <span class="hljs-keyword">class</span>Â <span class="hljs-title class_">JdbcSink</span>Â {
Â  Â Â <span class="hljs-keyword">private</span>Â <span class="hljs-keyword">final</span>Â <span class="hljs-type">String</span>Â sql; Â <span class="hljs-comment">// å›ºå®šçš„ INSERT SQL</span>
Â  Â Â <span class="hljs-function"><span class="hljs-keyword">public</span>Â <span class="hljs-title">JdbcSink</span><span class="hljs-params">(<span class="hljs-type">String</span>Â jdbcUrl,Â <span class="hljs-type">String</span>Â sql, ...)</span> </span>{
Â  Â  Â  Â Â <span class="hljs-keyword">this</span>.sqlÂ = sql; Â <span class="hljs-comment">// ç¡¬ç¼–ç çš„è¡¨ç»“æ„</span>
Â  Â  }
}
</code></pre>
<p><strong>å¸¦æ¥çš„é—®é¢˜ï¼š</strong></p>
<ol>
<li><strong>å¤šåº”ç”¨æ— æ³•éš”ç¦»ï¼š</strong> æ‰€æœ‰åº”ç”¨çš„æ•°æ®å†™å…¥åŒä¸€å¼ è¡¨ï¼Œé€šè¿‡ç‰¹å®šåˆ†è¡¨ç­–ç•¥åŒºåˆ†ã€‚</li>
<li><strong>æ‰©å±•æ€§å·®ï¼š</strong> æ–°å¢åº”ç”¨éœ€è¦æ‰‹åŠ¨å»ºè¡¨ï¼Œæ— æ³•åŠ¨æ€è·¯ç”±ã€‚</li>
<li><strong>æ€§èƒ½ç“¶é¢ˆï¼š</strong> å•è¡¨æ•°æ®é‡è¿‡å¤§ï¼ˆç™¾äº¿çº§ï¼‰ï¼ŒæŸ¥è¯¢å’Œå†™å…¥æ€§èƒ½æ€¥å‰§ä¸‹é™ã€‚</li>
</ol>
<h4 data-id="heading-5">ç—›ç‚¹ä¸‰ï¼šåˆ†å¸ƒå¼è¡¨å†™å…¥æ€§èƒ½é—®é¢˜</h4>
<p><strong>é—®é¢˜è¡¨ç°ï¼š</strong></p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-operator">/</span><span class="hljs-operator">/</span> å¤§å¤šæ•°ç”Ÿäº§å®ç°ç›´æ¥å†™å…¥åˆ†å¸ƒå¼è¡¨
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> distributed_table_allÂ <span class="hljs-keyword">VALUES</span>Â (...)
</code></pre>
<p><strong>ClickHouse åˆ†å¸ƒå¼è¡¨çš„å·¥ä½œåŸç†ï¼š</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/119927d3b86e4b89ad0df2f1d8ae0ca2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771297904&amp;x-signature=lMTfG4%2FdIpgbs5q5vY4%2BgK2837c%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p><strong>å¸¦æ¥çš„é—®é¢˜ï¼š</strong></p>
<ol>
<li><strong>ç½‘ç»œå¼€é”€å¤§ï¼š</strong> æ•°æ®éœ€è¦ç»è¿‡åˆ†å¸ƒå¼è¡¨å±‚è½¬å‘ï¼Œå»¶è¿Ÿå¢åŠ ã€‚</li>
<li><strong>å†™å…¥æ€§èƒ½å·®ï¼š</strong> åˆ†å¸ƒå¼è¡¨å¢åŠ äº†è·¯ç”±å’Œè½¬å‘é€»è¾‘ï¼Œååé‡é™ä½ã€‚</li>
<li><strong>çƒ­ç‚¹é—®é¢˜ï¼š</strong> æ‰€æœ‰æ•°æ®å…ˆåˆ°åˆ†å¸ƒå¼è¡¨èŠ‚ç‚¹ï¼Œå†è½¬å‘ï¼Œé€ æˆå•ç‚¹ç“¶é¢ˆã€‚</li>
</ol>
<h3 data-id="heading-6">ç”Ÿäº§çº§æ–¹æ¡ˆçš„æ ¸å¿ƒæ”¹è¿›</h3>
<p>é’ˆå¯¹ä»¥ä¸Šç—›ç‚¹ï¼Œæœ¬æ–¹æ¡ˆæä¾›äº†ä»¥ä¸‹æ ¸å¿ƒæ”¹è¿›ï¼š</p>
<h4 data-id="heading-7">æ”¹è¿›ä¸€ï¼šåŸºäºæ•°æ®é‡çš„æ”’æ‰¹æœºåˆ¶</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">public</span>Â <span class="hljs-keyword">class</span>Â <span class="hljs-title class_">ClickHouseSinkCounter</span>Â {
Â  Â Â <span class="hljs-keyword">private</span>Â <span class="hljs-title class_">Long</span>Â metaSize; Â <span class="hljs-comment">// ç´¯è®¡æ•°æ®é‡ï¼ˆå­—èŠ‚ï¼‰</span>
Â  Â Â <span class="hljs-keyword">public</span>Â <span class="hljs-built_in">void</span>Â <span class="hljs-title function_">add</span>(<span class="hljs-params">LogModelÂ value</span>) {
Â  Â  Â  Â Â <span class="hljs-variable language_">this</span>.<span class="hljs-property">values</span>.<span class="hljs-title function_">add</span>(value);
Â  Â  Â  Â Â <span class="hljs-variable language_">this</span>.<span class="hljs-property">metaSize</span>Â += value.<span class="hljs-title function_">getMetaSize</span>(); Â <span class="hljs-comment">// ç´¯åŠ æ•°æ®é‡</span>
Â  Â  }
}
<span class="hljs-comment">// è§¦å‘æ¡ä»¶</span>
<span class="hljs-keyword">private</span>Â <span class="hljs-built_in">boolean</span>Â <span class="hljs-title function_">flushCondition</span>(<span class="hljs-params"><span class="hljs-built_in">String</span>Â application</span>) {
Â  Â Â <span class="hljs-keyword">return</span>Â <span class="hljs-title function_">checkMetaSize</span>(application) Â <span class="hljs-comment">// metaSize &gt;= 10000 å­—èŠ‚</span>
Â  Â  Â  Â  ||Â <span class="hljs-title function_">checkTime</span>(application); Â  Â Â <span class="hljs-comment">// æˆ–è¶…æ—¶ 30 ç§’</span>
}
</code></pre>
<p><strong>ä¼˜åŠ¿ï¼š</strong></p>
<ul>
<li><strong>å†…å­˜å¯æ§ï¼š</strong> æ ¹æ®æ•°æ®é‡è€Œéè®°å½•æ•°æ”’æ‰¹ã€‚</li>
<li><strong>ç²¾ç¡®æ§åˆ¶ï¼š</strong> 1KB çš„è®°å½•æ”’ 10000 æ¡ = 10MBï¼Œ1MB çš„è®°å½•æ”’ 10 æ¡ = 10MBã€‚</li>
<li><strong>é¿å…OOMï¼š</strong> å¤§æ—¥å¿—è®°å½•ä¸ä¼šæ’‘çˆ†å†…å­˜ã€‚</li>
</ul>
<h4 data-id="heading-8">æ”¹è¿›äºŒï¼šåŠ¨æ€è¡¨ç»“æ„ä¸åˆ†ç‰‡ç­–ç•¥</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">public</span>Â <span class="hljs-keyword">abstract</span>Â <span class="hljs-keyword">class</span>Â <span class="hljs-title class_">ClickHouseShardStrategy</span>&lt;T&gt; {
Â  Â Â <span class="hljs-keyword">public</span>Â <span class="hljs-keyword">abstract</span>Â <span class="hljs-title class_">String</span>Â <span class="hljs-title function_">getTableName</span>(T data);
}
<span class="hljs-comment">//æ—¥å¿—ä¾§å®ç°ä¸ºåº”ç”¨çº§åˆ†è¡¨</span>
<span class="hljs-keyword">public</span>Â <span class="hljs-keyword">class</span>Â <span class="hljs-title class_">LogClickHouseShardStrategy</span>Â <span class="hljs-keyword">extends</span>Â <span class="hljs-title class_ inherited__">ClickHouseShardStrategy</span>&lt;<span class="hljs-title class_">String</span>&gt; {
Â  Â Â <span class="hljs-meta">@Override</span>
Â  Â Â <span class="hljs-keyword">public</span>Â <span class="hljs-title class_">String</span>Â <span class="hljs-title function_">getTableName</span>(<span class="hljs-params"><span class="hljs-built_in">String</span>Â application</span>) {
Â  Â  Â  Â Â <span class="hljs-comment">// åŠ¨æ€è·¯ç”±ï¼šorder-service â†’ tb_logs_order_service</span>
Â  Â  Â  Â Â <span class="hljs-keyword">return</span>Â <span class="hljs-title class_">String</span>.<span class="hljs-title function_">format</span>(<span class="hljs-string">"tb_logs_%s"</span>, application);
Â  Â  }
}
</code></pre>
<p><strong>ä¼˜åŠ¿ï¼š</strong></p>
<ul>
<li><strong>åº”ç”¨éš”ç¦»ï¼š</strong> æ—¥å¿—ä¾§å†…ç½®åº”ç”¨çº§åˆ†è¡¨ï¼Œæ¯ä¸ªåº”ç”¨ç‹¬ç«‹åˆ†è¡¨ã€‚</li>
<li><strong>åŠ¨æ€è·¯ç”±ï¼š</strong> æ ¹æ® application è‡ªåŠ¨è·¯ç”±åˆ°ç›®æ ‡è¡¨ã€‚</li>
<li><strong>æ‰©å±•æ€§å¼ºï¼š</strong> æ–°å¢åº”ç”¨æ— éœ€æ‰‹åŠ¨å»ºè¡¨ï¼ˆé…åˆ ClickHouse è‡ªåŠ¨å»ºè¡¨ï¼‰ã€‚</li>
</ul>
<h4 data-id="heading-9">æ”¹è¿›ä¸‰ï¼šæœ¬åœ°è¡¨å†™å…¥ + åŠ¨æ€èŠ‚ç‚¹å‘ç°</h4>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-keyword">public</span>Â <span class="hljs-keyword">class</span>Â <span class="hljs-title class_">ClickHouseLocalWriter</span>Â extendsÂ ClickHouseWriterÂ {
Â  Â Â <span class="hljs-comment">// ç›´æ¥å†™æœ¬åœ°è¡¨ï¼Œé¿å…åˆ†å¸ƒå¼è¡¨è½¬å‘</span>
Â  Â Â <span class="hljs-keyword">private</span>Â <span class="hljs-keyword">final</span>Â ConcurrentMap&lt;<span class="hljs-type">String</span>,Â HikariDataSource&gt; dataSourceMap;
Â  Â Â @<span class="hljs-function">Override
Â  Â Â <span class="hljs-keyword">public</span>Â HikariDataSourceÂ <span class="hljs-title">getNextDataSource</span><span class="hljs-params">(Set&lt;<span class="hljs-type">String</span>&gt; exceptionHosts)</span> </span>{
Â  Â  Â  Â Â <span class="hljs-comment">// 1. åŠ¨æ€è·å–é›†ç¾¤èŠ‚ç‚¹åˆ—è¡¨</span>
Â  Â  Â  Â Â List&lt;<span class="hljs-type">String</span>&gt; healthyHosts =Â <span class="hljs-built_in">getHealthyHosts</span>(exceptionHosts);
Â  Â  Â  Â Â <span class="hljs-comment">// 2. éšæœºé€‰æ‹©å¥åº·èŠ‚ç‚¹</span>
Â  Â  Â  Â Â <span class="hljs-keyword">return</span>Â dataSourceMap.<span class="hljs-built_in">get</span>(healthyHosts.<span class="hljs-built_in">get</span>(random.<span class="hljs-built_in">nextInt</span>(size)));
Â  Â  }
}
</code></pre>
<p><strong>ä¼˜åŠ¿ï¼š</strong></p>
<ul>
<li><strong>æ€§èƒ½æå‡ï¼š</strong> ç›´æ¥å†™æœ¬åœ°è¡¨ï¼Œé¿å…ç½‘ç»œè½¬å‘ã€‚</li>
<li><strong>é«˜å¯ç”¨ï¼š</strong> åŠ¨æ€èŠ‚ç‚¹å‘ç° + æ•…éšœèŠ‚ç‚¹å‰”é™¤ã€‚</li>
<li><strong>è´Ÿè½½å‡è¡¡ï¼š</strong> éšæœºé€‰æ‹© + Shuffle åˆå§‹åŒ–ã€‚</li>
</ul>
<h3 data-id="heading-10">æŠ€æœ¯æ–¹æ¡ˆæ¦‚è§ˆ</h3>
<p>åŸºäºä»¥ä¸Šæ”¹è¿›ï¼Œæœ¬æ–¹æ¡ˆæä¾›äº†ä»¥ä¸‹æ ¸å¿ƒèƒ½åŠ›ï¼š</p>
<ol>
<li><strong>æœ¬åœ°è¡¨/åˆ†å¸ƒå¼è¡¨å†™å…¥ï¼š</strong> æ€§èƒ½ä¼˜åŒ–ä¸é«˜å¯ç”¨å¹³è¡¡ã€‚</li>
<li><strong>åˆ†ç‰‡ç­–ç•¥ï¼š</strong> æŒ‰åº”ç”¨ç»´åº¦è·¯ç”±ä¸éš”ç¦»ã€‚</li>
<li><strong>æ”’æ‰¹ä¸å†…å­˜æ§åˆ¶ï¼š</strong> åŒè§¦å‘æœºåˆ¶ï¼ˆæ•°æ®é‡ + è¶…æ—¶ï¼‰ã€‚</li>
<li><strong>æµé‡æ§åˆ¶ä¸é™æµï¼š</strong> æœ‰ç•Œé˜Ÿåˆ— + è¿æ¥æ± ã€‚</li>
<li><strong>å¥å£®çš„é‡è¯•æœºåˆ¶ï¼š</strong> é€’å½’é‡è¯• + æ•…éšœèŠ‚ç‚¹å‰”é™¤ã€‚</li>
<li><strong>Checkpoint è¯­ä¹‰ä¿è¯ï¼š</strong> At-Least-Once æ•°æ®ä¸€è‡´æ€§ã€‚</li>
</ol>
<h2 data-id="heading-11">äºŒã€æ ¸å¿ƒæ¶æ„è®¾è®¡</h2>
<h3 data-id="heading-12">æ¶æ„å›¾</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a6230f98edcb4387a91be9777855e095~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771297904&amp;x-signature=0asR5n8cBcdMRovjP61HlgLzcJU%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<h3 data-id="heading-13">æ ¸å¿ƒç»„ä»¶</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3ae0e0cae190480a906ce9eedc850e55~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771297904&amp;x-signature=yfhgmUdoRLsLwyvcbV7UO%2FBC7wg%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<h3 data-id="heading-14">æ ¸å¿ƒæµç¨‹</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/994fb8f04a3f4a5e9037ed1d68ed4fd8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771297904&amp;x-signature=%2Bu1yXFOZ5fTWFhCbOH4FWVmZcZo%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<h2 data-id="heading-15">ä¸‰ã€æœ¬åœ°è¡¨ vs åˆ†å¸ƒå¼è¡¨å†™å…¥</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aefda04b30094fa7a7597653ebe525d0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771297904&amp;x-signature=nvVXa8CPurVbLZzR%2BPN58hXZQ7E%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<h3 data-id="heading-16">ClickHouse è¡¨ç»“æ„è¯´æ˜</h3>
<p>ClickHouse <strong>æ¨èç›´æ¥å†™æœ¬åœ°è¡¨</strong>ï¼ŒåŸå› ï¼š</p>
<ol>
<li><strong>å†™å…¥æ€§èƒ½ï¼š</strong> é¿å…åˆ†å¸ƒå¼è¡¨çš„ç½‘ç»œåˆ†å‘ã€‚</li>
<li><strong>æ•°æ®ä¸€è‡´æ€§ï¼š</strong> ç›´æ¥å†™å…¥ç›®æ ‡èŠ‚ç‚¹ï¼Œå‡å°‘ä¸­é—´ç¯èŠ‚æ•…éšœç‚¹ï¼Œæ¯”åˆ†å¸ƒå¼è¡¨å†™å…¥æ›´å®‰å…¨ï¼Œåˆ©äºå·¥ç¨‹åŒ–ã€‚</li>
<li><strong>è´Ÿè½½å‡è¡¡ï¼š</strong> å®¢æˆ·ç«¯è·¯ç”±å®ç°è´Ÿè½½åˆ†æ•£ã€‚</li>
</ol>

<pre><code class="hljs language-scss" lang="scss">-- æœ¬åœ°è¡¨ï¼ˆå®é™…å­˜å‚¨æ•°æ®ï¼‰
CREATE <span class="hljs-selector-tag">TABLE</span>Â tb_logs_localÂ ONÂ CLUSTERÂ 'default'Â (
Â  Â  application String,
Â  Â  environment String,
Â  Â  message String,
Â  Â  log_time DateTime
) ENGINEÂ =Â <span class="hljs-built_in">MergeTree</span>()
PARTITIONÂ BYÂ <span class="hljs-built_in">toYYYYMM</span>(log_time)
<span class="hljs-attribute">ORDER</span>Â BYÂ (application, log_time);
-- åˆ†å¸ƒå¼è¡¨ï¼ˆé€»è¾‘è§†å›¾ï¼Œä¸å­˜å‚¨æ•°æ®ï¼‰
CREATE <span class="hljs-selector-tag">TABLE</span>Â tb_logs_allÂ ONÂ CLUSTERÂ 'default'Â ASÂ tb_logs_local
ENGINEÂ =Â <span class="hljs-built_in">Distributed</span>('default', dw_log, tb_logs_local, cityHash64(application));
</code></pre>
<h3 data-id="heading-17">HikariCP è¿æ¥æ± é…ç½®</h3>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// HikariCP è¿æ¥æ± é…ç½®</span>
<span class="hljs-keyword">public</span>Â <span class="hljs-keyword">class</span>Â <span class="hljs-title class_">ClickHouseDataSourceUtils</span>Â {
Â  Â Â <span class="hljs-function"><span class="hljs-keyword">private</span>Â <span class="hljs-type">static</span>Â HikariConfigÂ <span class="hljs-title">getHikariConfig</span><span class="hljs-params">(DataSourceImpl dataSource)</span>Â </span>{
Â  Â  Â  Â  HikariConfig config =Â <span class="hljs-keyword">new</span>Â <span class="hljs-built_in">HikariConfig</span>();
Â  Â  Â  Â  config.<span class="hljs-built_in">setConnectionTimeout</span>(<span class="hljs-number">30000L</span>); Â  Â <span class="hljs-comment">// è¿æ¥è¶…æ—¶ 30s</span>
Â  Â  Â  Â  config.<span class="hljs-built_in">setMaximumPoolSize</span>(<span class="hljs-number">20</span>); Â  Â  Â  Â  Â <span class="hljs-comment">// æœ€å¤§è¿æ¥æ•° 20</span>
Â  Â  Â  Â  config.<span class="hljs-built_in">setMinimumIdle</span>(<span class="hljs-number">2</span>); Â  Â  Â  Â  Â  Â  Â Â <span class="hljs-comment">// æœ€å°ç©ºé—² 2</span>
Â  Â  Â  Â  config.<span class="hljs-built_in">setDataSource</span>(dataSource);
Â  Â  Â  Â Â <span class="hljs-keyword">return</span>Â config;
Â  Â  }
Â  Â Â <span class="hljs-function"><span class="hljs-keyword">private</span>Â <span class="hljs-type">static</span>Â PropertiesÂ <span class="hljs-title">getClickHouseProperties</span><span class="hljs-params">(ClickHouseSinkCommonParamsÂ params)</span>Â </span>{
Â  Â  Â  Â  Properties props =Â <span class="hljs-keyword">new</span>Â <span class="hljs-built_in">Properties</span>();
Â  Â  Â  Â  props.<span class="hljs-built_in">setProperty</span>(<span class="hljs-string">"user"</span>,Â params.<span class="hljs-built_in">getUser</span>());
Â  Â  Â  Â  props.<span class="hljs-built_in">setProperty</span>(<span class="hljs-string">"password"</span>,Â params.<span class="hljs-built_in">getPassword</span>());
Â  Â  Â  Â  props.<span class="hljs-built_in">setProperty</span>(<span class="hljs-string">"database"</span>,Â params.<span class="hljs-built_in">getDatabase</span>());
Â  Â  Â  Â  props.<span class="hljs-built_in">setProperty</span>(<span class="hljs-string">"socket_timeout"</span>,Â <span class="hljs-string">"180000"</span>); Â  Â  Â <span class="hljs-comment">// Socket è¶…æ—¶ 3 åˆ†é’Ÿ</span>
Â  Â  Â  Â  props.<span class="hljs-built_in">setProperty</span>(<span class="hljs-string">"socket_keepalive"</span>,Â <span class="hljs-string">"true"</span>); Â  Â  Â <span class="hljs-comment">// ä¿æŒè¿æ¥</span>
Â  Â  Â  Â  props.<span class="hljs-built_in">setProperty</span>(<span class="hljs-string">"http_connection_provider"</span>,Â <span class="hljs-string">"APACHE_HTTP_CLIENT"</span>);
Â  Â  Â  Â Â <span class="hljs-keyword">return</span>Â props;
Â  Â  }
}
</code></pre>
<p><strong>é…ç½®è¯´æ˜ï¼š</strong></p>
<ul>
<li>maxPoolSize=20ï¼šæ¯ä¸ª ClickHouse èŠ‚ç‚¹æœ€å¤š 20 ä¸ªè¿æ¥ã€‚</li>
<li>minIdle=2ï¼šä¿æŒ 2 ä¸ªç©ºé—²è¿æ¥ï¼Œé¿å…é¢‘ç¹åˆ›å»ºã€‚</li>
<li>socket_timeout=180sï¼šSocket è¶…æ—¶ 3 åˆ†é’Ÿï¼Œé˜²æ­¢é•¿æ—¶é—´æŸ¥è¯¢é˜»å¡ã€‚</li>
</ul>
<h3 data-id="heading-18">ClickHouseLocalWriterï¼šåŠ¨æ€èŠ‚ç‚¹å‘ç°</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">public</span>Â <span class="hljs-keyword">class</span>Â <span class="hljs-title class_">ClickHouseLocalWriter</span>Â <span class="hljs-keyword">extends</span>Â <span class="hljs-title class_ inherited__">ClickHouseWriter</span>Â {
Â  Â Â <span class="hljs-comment">// æœ¬åœ°èŠ‚ç‚¹ç¼“å­˜ï¼ŒæŒ‰ IP ç»´æŠ¤</span>
Â  Â Â <span class="hljs-keyword">private</span>Â finalÂ <span class="hljs-title class_">ConcurrentMap</span>&lt;<span class="hljs-title class_">String</span>,Â <span class="hljs-title class_">HikariDataSource</span>&gt; dataSourceMap;
Â  Â Â <span class="hljs-comment">// åŠ¨æ€è·å–é›†ç¾¤æœ¬åœ°è¡¨èŠ‚ç‚¹</span>
Â  Â Â <span class="hljs-keyword">private</span>Â finalÂ <span class="hljs-title class_">ClusterIpsUtils</span>Â clusterIpsUtils;
Â  Â Â <span class="hljs-comment">// IP å˜æ›´æ ‡å¿—ï¼ˆCAS é”ï¼Œé¿å…å¹¶å‘æ›´æ–°ï¼‰</span>
Â  Â Â <span class="hljs-keyword">private</span>Â <span class="hljs-keyword">static</span>Â finalÂ <span class="hljs-title class_">AtomicBoolean</span>Â <span class="hljs-variable constant_">IP_CHANGING</span>Â =Â <span class="hljs-keyword">new</span>Â <span class="hljs-title class_">AtomicBoolean</span>(<span class="hljs-literal">false</span>);
Â  Â Â <span class="hljs-meta">@Override</span>
Â  Â Â <span class="hljs-keyword">public</span>Â <span class="hljs-title class_">HikariDataSource</span>Â <span class="hljs-title function_">getNextDataSource</span>(<span class="hljs-params"><span class="hljs-built_in">Set</span>&lt;<span class="hljs-built_in">String</span>&gt; exceptionHosts</span>) {
Â  Â  Â  Â Â <span class="hljs-comment">// 1ï¸âƒ£ æ£€æµ‹é›†ç¾¤èŠ‚ç‚¹å˜åŒ–ï¼ˆé€šè¿‡ CAS é¿å…å¹¶å‘æ›´æ–°ï¼‰</span>
Â  Â  Â  Â Â <span class="hljs-keyword">if</span>Â (<span class="hljs-title function_">clusterIpsChanged</span>() &amp;&amp;Â <span class="hljs-variable constant_">IP_CHANGING</span>.<span class="hljs-title function_">compareAndSet</span>(<span class="hljs-literal">false</span>,Â <span class="hljs-literal">true</span>)) {
Â  Â  Â  Â  Â  Â Â <span class="hljs-keyword">try</span>Â {
Â  Â  Â  Â  Â  Â  Â  Â Â <span class="hljs-title function_">ipChanged</span>();Â <span class="hljs-comment">// åŠ¨æ€æ›´æ–° dataSourceMap</span>
Â  Â  Â  Â  Â  Â  }Â <span class="hljs-keyword">finally</span>Â {
Â  Â  Â  Â  Â  Â  Â  Â Â <span class="hljs-variable constant_">IP_CHANGING</span>.<span class="hljs-title function_">set</span>(<span class="hljs-literal">false</span>);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â Â <span class="hljs-comment">// 2ï¸âƒ£ è·å–å¼‚å¸¸èŠ‚ç‚¹åˆ—è¡¨ï¼ˆä» Redis + APM å®æ—¶æŸ¥è¯¢ï¼‰</span>
Â  Â  Â  Â Â <span class="hljs-title class_">Set</span>&lt;<span class="hljs-title class_">String</span>&gt; exceptIps = clusterIpsUtils.<span class="hljs-title function_">getExceptIps</span>();
Â  Â  Â  Â  exceptIps.<span class="hljs-title function_">addAll</span>(exceptionHosts);
Â  Â  Â  Â Â <span class="hljs-comment">// 3ï¸âƒ£ è¿‡æ»¤å¥åº·èŠ‚ç‚¹ï¼Œéšæœºé€‰æ‹©</span>
Â  Â  Â  Â Â <span class="hljs-title class_">List</span>&lt;<span class="hljs-title class_">String</span>&gt; healthyHosts = dataSourceMap.<span class="hljs-title function_">keySet</span>().<span class="hljs-title function_">stream</span>()
Â  Â  Â  Â  Â  Â  .<span class="hljs-title function_">filter</span>(host -&gt; !exceptIps.<span class="hljs-title function_">contains</span>(host))
Â  Â  Â  Â  Â  Â  .<span class="hljs-title function_">collect</span>(<span class="hljs-title class_">Collectors</span>.<span class="hljs-title function_">toList</span>());
Â  Â  Â  Â Â <span class="hljs-keyword">if</span>Â (<span class="hljs-title class_">CollectionUtils</span>.<span class="hljs-title function_">isEmpty</span>(healthyHosts)) {
Â  Â  Â  Â  Â  Â Â <span class="hljs-keyword">throw</span>Â <span class="hljs-keyword">new</span>Â <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"Can't get datasource from local cache"</span>);
Â  Â  Â  Â  }
Â  Â  Â  Â Â <span class="hljs-keyword">return</span>Â dataSourceMap.<span class="hljs-title function_">get</span>(healthyHosts.<span class="hljs-title function_">get</span>(random.<span class="hljs-title function_">nextInt</span>(healthyHosts.<span class="hljs-title function_">size</span>())));
Â  Â  }
Â  Â Â <span class="hljs-keyword">private</span>Â <span class="hljs-built_in">void</span>Â <span class="hljs-title function_">ipChanged</span>(<span class="hljs-params"/>) {
Â  Â  Â  Â Â <span class="hljs-title class_">List</span>&lt;<span class="hljs-title class_">String</span>&gt; clusterIps = clusterIpsUtils.<span class="hljs-title function_">getClusterIps</span>();
Â  Â  Â  Â Â <span class="hljs-comment">// æ–°å¢èŠ‚ç‚¹ï¼šè‡ªåŠ¨åˆ›å»ºè¿æ¥æ± </span>
Â  Â  Â  Â  clusterIps.<span class="hljs-title function_">forEach</span>(ip -&gt;
Â  Â  Â  Â  Â  Â  dataSourceMap.<span class="hljs-title function_">computeIfAbsent</span>(ip, v -&gt;
Â  Â  Â  Â  Â  Â  Â  Â Â <span class="hljs-title function_">createHikariDataSource</span>(ip, port)
Â  Â  Â  Â  Â  Â  )
Â  Â  Â  Â  );
Â  Â  Â  Â Â <span class="hljs-comment">// ç§»é™¤ä¸‹çº¿èŠ‚ç‚¹ï¼šå…³é—­è¿æ¥æ± </span>
Â  Â  Â  Â  dataSourceMap.<span class="hljs-title function_">forEach</span>((ip, ds) -&gt; {
Â  Â  Â  Â  Â  Â Â <span class="hljs-keyword">if</span>Â (!clusterIps.<span class="hljs-title function_">contains</span>(ip)) {
Â  Â  Â  Â  Â  Â  Â  Â  dataSourceMap.<span class="hljs-title function_">remove</span>(ip);
Â  Â  Â  Â  Â  Â  Â  Â  ds.<span class="hljs-title function_">close</span>();
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });
Â  Â  }
}
</code></pre>
<p><strong>æ ¸å¿ƒé€»è¾‘ï¼š</strong></p>
<ol>
<li><strong>åŠ¨æ€èŠ‚ç‚¹å‘ç°ï¼š</strong> ä» system.clusters æŸ¥è¯¢æ‰€æœ‰èŠ‚ç‚¹ã€‚</li>
<li><strong>è‡ªåŠ¨æ‰©ç¼©å®¹ï¼š</strong> èŠ‚ç‚¹ä¸Šçº¿è‡ªåŠ¨åŠ å…¥ï¼Œä¸‹çº¿è‡ªåŠ¨å‰”é™¤ã€‚</li>
<li><strong>æ•…éšœèŠ‚ç‚¹å‰”é™¤ï¼š</strong> é€šè¿‡ APM ç›‘æ§ï¼Œè‡ªåŠ¨å‰”é™¤å¼‚å¸¸èŠ‚ç‚¹ã€‚</li>
<li><strong>è´Ÿè½½å‡è¡¡ï¼š</strong> éšæœºé€‰æ‹©å¥åº·èŠ‚ç‚¹ï¼Œé¿å…çƒ­ç‚¹ã€‚</li>
</ol>
<h3 data-id="heading-19">é›†ç¾¤èŠ‚ç‚¹åŠ¨æ€å‘ç°ï¼ˆClusterIpsUtilsï¼‰</h3>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">public</span>Â <span class="hljs-selector-tag">class</span>Â <span class="hljs-selector-tag">ClusterIpsUtils</span>Â {
Â  Â Â <span class="hljs-comment">// ä» system.clusters æŸ¥è¯¢æ‰€æœ‰èŠ‚ç‚¹</span>
Â  Â Â <span class="hljs-selector-tag">private</span>Â <span class="hljs-selector-tag">static</span>Â <span class="hljs-selector-tag">final</span>Â <span class="hljs-selector-tag">String</span>Â <span class="hljs-selector-tag">QUERY_CLUSTER_IPS</span>Â =
Â  Â  Â  Â Â "<span class="hljs-selector-tag">select</span> <span class="hljs-selector-tag">host_address</span> <span class="hljs-selector-tag">from</span> <span class="hljs-selector-tag">system</span><span class="hljs-selector-class">.clusters</span> <span class="hljs-selector-tag">where</span> <span class="hljs-selector-tag">cluster</span> = '<span class="hljs-selector-tag">default</span>'";
Â  Â Â <span class="hljs-comment">// LoadingCacheï¼šå®šæ—¶åˆ·æ–°èŠ‚ç‚¹åˆ—è¡¨ï¼ˆ1 å°æ—¶ï¼‰</span>
Â  Â Â <span class="hljs-selector-tag">private</span>Â <span class="hljs-selector-tag">final</span>Â <span class="hljs-selector-tag">LoadingCache</span>&lt;<span class="hljs-selector-tag">String</span>,Â <span class="hljs-selector-tag">List</span>&lt;<span class="hljs-selector-tag">String</span>&gt;&gt; <span class="hljs-selector-tag">clusterIpsCache</span> =
Â  Â  Â  Â Â <span class="hljs-selector-tag">CacheBuilder</span><span class="hljs-selector-class">.newBuilder</span>()
Â  Â  Â  Â  Â  Â  <span class="hljs-selector-class">.expireAfterAccess</span>(<span class="hljs-number">10</span>,Â TimeUnit.HOURS)
Â  Â  Â  Â  Â  Â  <span class="hljs-selector-class">.refreshAfterWrite</span>(<span class="hljs-number">1</span>,Â TimeUnit.HOURS)
Â  Â  Â  Â  Â  Â  <span class="hljs-selector-class">.build</span>(CacheLoader.<span class="hljs-built_in">asyncReloading</span>(newÂ CacheLoader&lt;&gt;() {
Â  Â  Â  Â  Â  Â  Â  Â Â <span class="hljs-variable">@Override</span>
Â  Â  Â  Â  Â  Â  Â  Â Â publicÂ List&lt;String&gt;Â <span class="hljs-built_in">load</span>(StringÂ dbName) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â returnÂ <span class="hljs-built_in">queryClusterIps</span>(); Â <span class="hljs-comment">// å®šæ—¶åˆ·æ–°èŠ‚ç‚¹åˆ—è¡¨</span>
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }));
Â  Â Â <span class="hljs-comment">// å¼‚å¸¸èŠ‚ç‚¹ç¼“å­˜ï¼ˆ1 åˆ†é’Ÿåˆ·æ–°ï¼‰</span>
Â  Â Â <span class="hljs-selector-tag">private</span>Â <span class="hljs-selector-tag">final</span>Â <span class="hljs-selector-tag">LoadingCache</span>&lt;<span class="hljs-selector-tag">String</span>,Â <span class="hljs-selector-tag">FlinkExceptIpModel</span>&gt; <span class="hljs-selector-tag">exceptIpsCache</span> =
Â  Â  Â  Â Â <span class="hljs-selector-tag">CacheBuilder</span><span class="hljs-selector-class">.newBuilder</span>()
Â  Â  Â  Â  Â  Â  <span class="hljs-selector-class">.refreshAfterWrite</span>(<span class="hljs-number">1</span>,Â TimeUnit.MINUTES)
Â  Â  Â  Â  Â  Â  <span class="hljs-selector-class">.build</span>(CacheLoader.<span class="hljs-built_in">asyncReloading</span>(newÂ CacheLoader&lt;&gt;() {
Â  Â  Â  Â  Â  Â  Â  Â Â <span class="hljs-variable">@Override</span>
Â  Â  Â  Â  Â  Â  Â  Â Â publicÂ FlinkExceptIpModelÂ <span class="hljs-built_in">load</span>(StringÂ dbName) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â returnÂ <span class="hljs-built_in">queryExceptIp</span>(); Â <span class="hljs-comment">// ä» Redis + APM æŸ¥è¯¢å¼‚å¸¸èŠ‚ç‚¹</span>
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }));
}
</code></pre>
<p><strong>å¼‚å¸¸èŠ‚ç‚¹ç›‘æ§ç­–ç•¥ï¼š</strong></p>
<ul>
<li><strong>ç£ç›˜ä½¿ç”¨ç‡ &gt;= 90%ï¼š</strong> ä» APM æŸ¥è¯¢ Prometheus æŒ‡æ ‡ï¼Œè‡ªåŠ¨åŠ å…¥é»‘åå•ã€‚</li>
<li><strong>HTTP è¿æ¥æ•° &gt;= 50ï¼š</strong> è¿æ¥æ•°è¿‡å¤šè¯´æ˜èŠ‚ç‚¹å‹åŠ›å¤§ï¼Œè‡ªåŠ¨åŠ å…¥é»‘åå•ã€‚</li>
<li><strong>äººå·¥é…ç½®ï¼š</strong> é€šè¿‡ Redis é…ç½®æ‰‹åŠ¨å‰”é™¤èŠ‚ç‚¹</li>
</ul>
<p><strong>æ•°æ®æ¥æºï¼š</strong></p>
<ol>
<li><strong>ClickHouse system.clusters è¡¨ï¼š</strong> è·å–æ‰€æœ‰é›†ç¾¤èŠ‚ç‚¹ã€‚</li>
<li><strong>APM Prometheus æ¥å£ï¼š</strong> ç›‘æ§èŠ‚ç‚¹å¥åº·çŠ¶æ€ã€‚</li>
<li><strong>Redis ç¼“å­˜ï¼š</strong> äººå·¥é…ç½®çš„å¼‚å¸¸èŠ‚ç‚¹ã€‚</li>
</ol>
<h3 data-id="heading-20">è´Ÿè½½å‡è¡¡ä¼˜åŒ–</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">public</span>Â <span class="hljs-keyword">class</span>Â <span class="hljs-title class_">ClickHouseWriter</span>Â {
Â  Â Â <span class="hljs-keyword">public</span>Â &lt;T&gt; ClickHouseWriter(...) {
Â  Â  Â  Â Â <span class="hljs-comment">// Shuffleï¼šéšæœºæ‰“ä¹±æ•°æ®æºé¡ºåº</span>
Â  Â  Â  Â  Collections.shuffle(clickHouseDataSources);
Â  Â  Â  Â Â <span class="hljs-keyword">this</span>.clickHouseDataSources = clickHouseDataSources;
Â  Â  }
Â  Â Â <span class="hljs-keyword">public</span>Â HikariDataSource getNextDataSource(Set&lt;String&gt; exceptionHosts) {
Â  Â  Â  Â Â <span class="hljs-comment">// è½®è¯¢ + éšæœºé€‰æ‹©ï¼ˆå·² shuffleï¼Œé¿å…çƒ­ç‚¹ï¼‰</span>
Â  Â  Â  Â  int current =Â <span class="hljs-keyword">this</span>.currentRandom.getAndIncrement();
Â  Â  Â  Â Â <span class="hljs-keyword">if</span>Â (current &gt;= clickHouseDataSources.size()) {
Â  Â  Â  Â  Â  Â Â <span class="hljs-keyword">this</span>.currentRandom.<span class="hljs-keyword">set</span>(<span class="hljs-number">0</span>);
Â  Â  Â  Â  }
Â  Â  Â  Â Â <span class="hljs-keyword">return</span>Â clickHouseDataSources.<span class="hljs-keyword">get</span>(currentRandom.<span class="hljs-keyword">get</span>());
Â  Â  }
}
</code></pre>
<p><strong>ä¼˜åŠ¿ï¼š</strong></p>
<ul>
<li>åˆå§‹åŒ–æ—¶ shuffleï¼Œé¿å…æ‰€æœ‰ writer åŒæ—¶ä»ç¬¬ä¸€ä¸ªèŠ‚ç‚¹å¼€å§‹ã€‚</li>
<li>è½®è¯¢ + éšæœºé€‰æ‹©ï¼Œè´Ÿè½½åˆ†æ•£æ›´å‡åŒ€ã€‚</li>
<li>æ•…éšœèŠ‚ç‚¹è‡ªåŠ¨å‰”é™¤ã€‚</li>
</ul>
<h2 data-id="heading-21">å››ã€æ”¯æŒåˆ†è¡¨ç­–ç•¥</h2>
<h3 data-id="heading-22">åˆ†ç‰‡ç­–ç•¥æŠ½è±¡</h3>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span>Â <span class="hljs-keyword">abstract</span>Â <span class="hljs-keyword">class</span>Â <span class="hljs-title">ClickHouseShardStrategy</span>&lt;<span class="hljs-title">T</span>&gt; {
Â  Â Â <span class="hljs-keyword">private</span>Â String tableName; Â  Â  Â <span class="hljs-comment">// è¡¨åæ¨¡æ¿ï¼Œå¦‚ "tb_log_%s"</span>
Â  Â Â <span class="hljs-keyword">private</span>Â Integer tableCount; Â  Â <span class="hljs-comment">// åˆ†è¡¨æ•°é‡</span>
Â  Â Â <span class="hljs-comment">// æ ¹æ®æ•°æ®å†³å®šç›®æ ‡è¡¨å</span>
Â  Â Â <span class="hljs-function"><span class="hljs-keyword">public</span>Â <span class="hljs-keyword">abstract</span>Â StringÂ <span class="hljs-title">getTableName</span>(<span class="hljs-params">T data</span>)</span>;
}
</code></pre>
<h3 data-id="heading-23">æ—¥å¿—åˆ†ç‰‡å®ç°</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">public</span>Â <span class="hljs-keyword">class</span>Â <span class="hljs-title class_">LogClickHouseShardStrategy</span>Â <span class="hljs-keyword">extends</span>Â <span class="hljs-title class_ inherited__">ClickHouseShardStrategy</span>&lt;<span class="hljs-title class_">String</span>&gt; {
Â  Â Â <span class="hljs-meta">@Override</span>
Â  Â Â <span class="hljs-keyword">public</span>Â <span class="hljs-title class_">String</span>Â <span class="hljs-title function_">getTableName</span>(<span class="hljs-params"><span class="hljs-built_in">String</span>Â application</span>) {
Â  Â  Â  Â Â <span class="hljs-comment">// è¡¨åæ ¼å¼ï¼štb_log_{application}</span>
Â  Â  Â  Â Â <span class="hljs-comment">// ä¾‹å¦‚ï¼šapplication = "order-service" -&gt; table = "tb_log_order_service"</span>
Â  Â  Â  Â Â <span class="hljs-keyword">return</span>Â <span class="hljs-title class_">String</span>.<span class="hljs-title function_">format</span>(
Â  Â  Â  Â  Â  Â Â <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getTableName</span>(),
Â  Â  Â  Â  Â  Â  application.<span class="hljs-title function_">replace</span>(<span class="hljs-string">"-"</span>,Â <span class="hljs-string">"_"</span>).<span class="hljs-title function_">toLowerCase</span>()
Â  Â  Â  Â  );
Â  Â  }
}
</code></pre>
<h3 data-id="heading-24">æŒ‰è¡¨ï¼ˆåº”ç”¨ï¼‰ç»´åº¦çš„ç¼“å†²åŒº</h3>
<p>æ—¥å¿—ä¾§ç»´åº¦é™çº§ä¸ºåº”ç”¨åç§°ç»´åº¦ç¼“å†²åŒºï¼Œå®åˆ™å› ä¸ºæŒ‰ç…§åº”ç”¨åˆ†è¡¨ï¼Œ</p>
<p>ä¸šåŠ¡æ–¹å¯ä½¿ç”¨è‡ªèº«åˆ†è¡¨ç­–ç•¥æºå¸¦è¡¨åå…ƒæ•°æ®ï¼Œè¿›è¡Œè¡¨ç»´åº¦ç¼“å†²ã€‚</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">public</span>Â <span class="hljs-keyword">class</span>Â <span class="hljs-title class_">ClickHouseShardSinkBuffer</span>Â {
Â  Â Â <span class="hljs-comment">// æŒ‰ application åˆ†ç»„çš„ç¼“å†²åŒºï¼ˆConcurrentHashMap ä¿è¯å¹¶å‘å®‰å…¨ï¼‰</span>
Â  Â Â <span class="hljs-keyword">private</span>Â finalÂ <span class="hljs-title class_">ConcurrentHashMap</span>&lt;<span class="hljs-title class_">String</span>,Â <span class="hljs-title class_">ClickHouseSinkCounter</span>&gt; localValues;
Â  Â Â <span class="hljs-keyword">public</span>Â <span class="hljs-built_in">void</span>Â <span class="hljs-title function_">put</span>(<span class="hljs-params">LogModelÂ value</span>) {
Â  Â  Â  Â Â <span class="hljs-title class_">String</span>Â application = value.<span class="hljs-title function_">getApplication</span>();
Â  Â  Â  Â Â <span class="hljs-comment">// 1ï¸âƒ£ æ£€æŸ¥æ˜¯å¦éœ€è¦ flush</span>
Â  Â  Â  Â Â <span class="hljs-keyword">if</span>Â (<span class="hljs-title function_">flushCondition</span>(application)) {
Â  Â  Â  Â  Â  Â Â <span class="hljs-title function_">addToQueue</span>(application);Â <span class="hljs-comment">// è§¦å‘å†™å…¥</span>
Â  Â  Â  Â  }
Â  Â  Â  Â Â <span class="hljs-comment">// 2ï¸âƒ£ æ·»åŠ åˆ°ç¼“å†²åŒºï¼ˆçº¿ç¨‹å®‰å…¨çš„ compute æ“ä½œï¼‰</span>
Â  Â  Â  Â  localValues.<span class="hljs-title function_">compute</span>(application, (k, v) -&gt; {
Â  Â  Â  Â  Â  Â Â <span class="hljs-keyword">if</span>Â (v ==Â <span class="hljs-literal">null</span>) v =Â <span class="hljs-keyword">new</span>Â <span class="hljs-title class_">ClickHouseSinkCounter</span>();
Â  Â  Â  Â  Â  Â  v.<span class="hljs-title function_">add</span>(value);
Â  Â  Â  Â  Â  Â Â <span class="hljs-keyword">return</span>Â v;
Â  Â  Â  Â  });
Â  Â  }
Â  Â Â <span class="hljs-keyword">private</span>Â <span class="hljs-built_in">void</span>Â <span class="hljs-title function_">addToQueue</span>(<span class="hljs-params"><span class="hljs-built_in">String</span>Â application</span>) {
Â  Â  Â  Â  localValues.<span class="hljs-title function_">computeIfPresent</span>(application, (k, v) -&gt; {
Â  Â  Â  Â  Â  Â Â <span class="hljs-comment">// æ·±æ‹·è´å¹¶æ¸…ç©ºï¼ˆé¿å…å¹¶å‘ä¿®æ”¹å¼‚å¸¸ï¼‰</span>
Â  Â  Â  Â  Â  Â Â <span class="hljs-title class_">List</span>&lt;<span class="hljs-title class_">LogModel</span>&gt; deepCopy = v.<span class="hljs-title function_">copyValuesAndClear</span>();
Â  Â  Â  Â  Â  Â Â <span class="hljs-comment">// æ„é€ è¯·æ±‚ Blankï¼šapplication + targetTable + values</span>
Â  Â  Â  Â  Â  Â Â <span class="hljs-title class_">String</span>Â targetTable = shardStrategy.<span class="hljs-title function_">getTableName</span>(application);
Â  Â  Â  Â  Â  Â Â <span class="hljs-title class_">ClickHouseRequestBlank</span>Â blank =Â <span class="hljs-keyword">new</span>Â <span class="hljs-title class_">ClickHouseRequestBlank</span>(deepCopy, application, targetTable);
Â  Â  Â  Â  Â  Â Â <span class="hljs-comment">// æ”¾å…¥é˜Ÿåˆ—</span>
Â  Â  Â  Â  Â  Â  writer.<span class="hljs-title function_">put</span>(blank);
Â  Â  Â  Â  Â  Â Â <span class="hljs-keyword">return</span>Â v;
Â  Â  Â  Â  });
Â  Â  }
}
</code></pre>
<p><strong>æ ¸å¿ƒè®¾è®¡ï¼š</strong></p>
<ul>
<li><strong>åº”ç”¨éš”ç¦»ï¼š</strong> æ¯ä¸ªè¡¨ï¼ˆåº”ç”¨ï¼‰ç‹¬ç«‹çš„ bufferï¼Œäº’ä¸å½±å“ã€‚</li>
<li><strong>çº¿ç¨‹å®‰å…¨ï¼š</strong> ä½¿ç”¨ ConcurrentHashMap.compute()ä¿è¯å¹¶å‘å®‰å…¨ã€‚</li>
<li><strong>æ·±æ‹·è´ï¼š</strong> List.copyOf() åˆ›å»ºä¸å¯å˜å‰¯æœ¬ï¼Œé¿å…å¹¶å‘ä¿®æ”¹ã€‚</li>
<li><strong>æ‰¹é‡æ¸…ç©ºï¼š</strong> ä¸€æ¬¡æ€§å–å‡ºæ‰€æœ‰æ•°æ®ï¼Œæ¸…ç©ºè®¡æ•°å™¨ã€‚</li>
</ul>
<h2 data-id="heading-25">äº”ã€æ”’æ‰¹ä¸å†…å­˜æ§åˆ¶</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0fbe4dbd0e40420ebfe253fdd2c5209a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771297904&amp;x-signature=SS577U1jEN8%2BTZ3ptFL3TZKSQF4%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<h3 data-id="heading-26">åŒè§¦å‘æœºåˆ¶</h3>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-keyword">public</span>Â <span class="hljs-keyword">class</span>Â <span class="hljs-title class_">ClickHouseShardSinkBuffer</span>Â {
Â  Â Â <span class="hljs-keyword">private</span>Â <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> maxFlushBufferSize; Â <span class="hljs-comment">// æœ€å¤§æ‰¹æ¬¡å¤§å°ï¼ˆå¦‚ 10000ï¼‰</span>
Â  Â Â <span class="hljs-keyword">private</span>Â <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> timeoutMillis; Â  Â  Â <span class="hljs-comment">// è¶…æ—¶æ—¶é—´ï¼ˆå¦‚ 30sï¼‰</span>
Â  Â Â <span class="hljs-comment">// è§¦å‘æ¡ä»¶æ£€æŸ¥ï¼ˆæ»¡è¶³ä»»ä¸€å³è§¦å‘ï¼‰</span>
Â  Â Â <span class="hljs-function"><span class="hljs-keyword">private</span>Â <span class="hljs-type">boolean</span>Â <span class="hljs-title">flushCondition</span><span class="hljs-params">(<span class="hljs-type">String</span>Â application)</span> </span>{
Â  Â  Â  Â Â <span class="hljs-keyword">return</span>Â localValues.<span class="hljs-built_in">get</span>(application) !=Â null
Â  Â  Â  Â  Â  Â  &amp;&amp; (<span class="hljs-built_in">checkMetaSize</span>(application) ||Â <span class="hljs-built_in">checkTime</span>(application));
Â  Â  }
Â  Â Â <span class="hljs-comment">// æ¡ä»¶1ï¼šè¾¾åˆ°æ‰¹æ¬¡å¤§å°</span>
Â  Â Â <span class="hljs-function"><span class="hljs-keyword">private</span>Â <span class="hljs-type">boolean</span>Â <span class="hljs-title">checkMetaSize</span><span class="hljs-params">(<span class="hljs-type">String</span>Â application)</span> </span>{
Â  Â  Â  Â Â <span class="hljs-keyword">return</span>Â localValues.<span class="hljs-built_in">get</span>(application).<span class="hljs-built_in">getMetaSize</span>() &gt;= maxFlushBufferSize;
Â  Â  }
Â  Â Â <span class="hljs-comment">// æ¡ä»¶2ï¼šè¶…æ—¶</span>
Â  Â Â <span class="hljs-function"><span class="hljs-keyword">private</span>Â <span class="hljs-type">boolean</span>Â <span class="hljs-title">checkTime</span><span class="hljs-params">(<span class="hljs-type">String</span>Â application)</span> </span>{
Â  Â  Â  Â  <span class="hljs-type">long</span> current =Â System.<span class="hljs-built_in">currentTimeMillis</span>();
Â  Â  Â  Â Â <span class="hljs-keyword">return</span>Â current - localValues.<span class="hljs-built_in">get</span>(application).<span class="hljs-built_in">getInsertTime</span>() &gt; timeoutMillis;
Â  Â  }
}
</code></pre>
<h3 data-id="heading-27">æ‰¹æ¬¡å¤§å°è®¡ç®—</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">public</span>Â <span class="hljs-keyword">class</span>Â <span class="hljs-title class_">ClickHouseSinkCounter</span>Â {
Â  Â Â <span class="hljs-keyword">private</span>Â <span class="hljs-keyword">final</span>Â List&lt;LogModel&gt; values;
Â  Â Â <span class="hljs-keyword">private</span>Â <span class="hljs-built_in">Long</span>Â metaSize;Â <span class="hljs-comment">// ç´¯è®¡çš„ metaSizeï¼ˆå­—èŠ‚ï¼‰</span>
Â  Â Â <span class="hljs-keyword">public</span>Â void add(LogModel value) {
Â  Â  Â  Â Â <span class="hljs-keyword">this</span>.values.add(value);
Â  Â  Â  Â Â <span class="hljs-keyword">this</span>.metaSize += value.getMetaSize();Â <span class="hljs-comment">// ç´¯åŠ  metaSize</span>
Â  Â  }
Â  Â Â <span class="hljs-keyword">public</span>Â List&lt;LogModel&gt; copyValuesAndClear() {
Â  Â  Â  Â  List&lt;LogModel&gt; logModels = List.copyOf(<span class="hljs-keyword">this</span>.values);Â <span class="hljs-comment">// æ·±æ‹·è´ï¼ˆä¸å¯å˜ï¼‰</span>
Â  Â  Â  Â Â <span class="hljs-keyword">this</span>.values.clear();
Â  Â  Â  Â Â <span class="hljs-keyword">this</span>.metaSize =Â <span class="hljs-number">0L</span>;
Â  Â  Â  Â Â <span class="hljs-keyword">this</span>.insertTime = System.currentTimeMillis();
Â  Â  Â  Â Â <span class="hljs-keyword">return</span>Â logModels;
Â  Â  }
}
</code></pre>
<p><strong>å…³é”®ç‚¹ï¼š</strong></p>
<ul>
<li>ä½¿ç”¨ metaSizeï¼ˆå­—èŠ‚æ•°ï¼‰è€Œéè®°å½•æ•°æ§åˆ¶æ‰¹æ¬¡ï¼Œå†…å­˜æ§åˆ¶æ›´ç²¾ç¡®ã€‚</li>
<li>List.copyOf() åˆ›å»ºä¸å¯å˜å‰¯æœ¬ï¼Œé¿å…å¹¶å‘ä¿®æ”¹ã€‚</li>
<li>æ¸…ç©ºåé‡ç½® insertTimeï¼Œä¿è¯è¶…æ—¶è§¦å‘å‡†ç¡®æ€§ã€‚</li>
</ul>
<h3 data-id="heading-28">å¸¦éšæœºæŠ–åŠ¨çš„è¶…æ—¶</h3>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-keyword">private</span>Â <span class="hljs-keyword">final</span>Â <span class="hljs-type">long</span>Â timeoutMillis;
<span class="hljs-function"><span class="hljs-keyword">public</span>Â <span class="hljs-title">ClickHouseShardSinkBuffer</span><span class="hljs-params">(...,Â <span class="hljs-type">int</span>Â timeoutSec, ...)</span>Â </span>{
Â  Â Â <span class="hljs-comment">// åŸºç¡€è¶…æ—¶ + 10% éšæœºæŠ–åŠ¨ï¼ˆé¿å…æƒŠç¾¤æ•ˆåº”ï¼‰</span>
Â  Â Â <span class="hljs-keyword">this</span>.timeoutMillis = TimeUnit.SECONDS.<span class="hljs-built_in">toMillis</span>(timeoutSec)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  +Â <span class="hljs-keyword">new</span>Â <span class="hljs-built_in">SecureRandom</span>().<span class="hljs-built_in">nextInt</span>((<span class="hljs-type">int</span>) (timeoutSec *Â <span class="hljs-number">0.1</span>Â *Â <span class="hljs-number">1000</span>));
}
</code></pre>
<p><strong>ç›®çš„ï¼š</strong> é¿å…å¤šä¸ªTM åŒæ—¶è§¦å‘ flushï¼Œé€ æˆå†™å…¥æµé‡å³°å€¼ã€‚</p>
<h3 data-id="heading-29">é…ç½®ç¤ºä¾‹</h3>
<pre><code class="hljs language-scss" lang="scss">ClickHouseShardSinkBuffer<span class="hljs-selector-class">.Builder</span>
Â  Â  <span class="hljs-selector-class">.aClickHouseSinkBuffer</span>()
Â  Â  <span class="hljs-selector-class">.withTargetTable</span>("single_table") Â <span class="hljs-comment">//å•è¡¨æ—¶ï¼Œå¯ç›´æ¥ä½¿ç”¨æŒ‡å®šè¡¨å</span>
Â  Â  <span class="hljs-selector-class">.withMaxFlushBufferSize</span>(<span class="hljs-number">10000</span>) Â <span class="hljs-comment">// å¯¹åº”å­—èŠ‚æ•°</span>
Â  Â  <span class="hljs-selector-class">.withTimeoutSec</span>(<span class="hljs-number">30</span>) Â  Â  Â  Â  Â  Â  Â <span class="hljs-comment">// 30 ç§’è¶…æ—¶</span>
Â  Â  <span class="hljs-selector-class">.withClickHouseShardStrategy</span>(newÂ LogClickHouseShardStrategy("table_prefix_%s",Â <span class="hljs-number">8</span>)) Â <span class="hljs-comment">//åˆ†è¡¨ç­–ç•¥æ—¶ï¼Œä½¿ç”¨</span>
Â  Â Â <span class="hljs-comment">// åˆ†è¡¨ç­–ç•¥å¯æ ¹æ®ä¸šåŠ¡å®é™…æƒ…å†µè¿›è¡Œæ‰©å±•</span>
Â  Â  <span class="hljs-selector-class">.build</span>(clickHouseWriter);
</code></pre>
<h2 data-id="heading-30">å…­ã€å†™å…¥é™æµä¸æµé‡æ§åˆ¶</h2>
<h3 data-id="heading-31">æœ‰ç•Œé˜Ÿåˆ—è®¾è®¡</h3>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span>Â <span class="hljs-keyword">class</span>Â <span class="hljs-title">ClickHouseWriter</span>Â {
Â  Â Â <span class="hljs-comment">// æœ‰ç•Œé˜»å¡é˜Ÿåˆ—</span>
Â  Â Â <span class="hljs-keyword">private</span>Â final BlockingQueue&lt;ClickHouseRequestBlank&gt; commonQueue;
Â  Â Â <span class="hljs-function"><span class="hljs-keyword">public</span>Â <span class="hljs-title">ClickHouseWriter</span>(<span class="hljs-params">ClickHouseSinkCommonParams sinkParams, ...</span>)</span>Â {
Â  Â  Â  Â Â <span class="hljs-comment">// é˜Ÿåˆ—æœ€å¤§å®¹é‡é…ç½®ï¼ˆé»˜è®¤ 10ï¼‰</span>
Â  Â  Â  Â Â <span class="hljs-keyword">this</span>.commonQueue =Â <span class="hljs-keyword">new</span>Â LinkedBlockingQueue&lt;&gt;(sinkParams.getQueueMaxCapacity());
Â  Â  }
Â  Â Â <span class="hljs-function"><span class="hljs-keyword">public</span>Â <span class="hljs-keyword">void</span>Â <span class="hljs-title">put</span>(<span class="hljs-params">ClickHouseRequestBlankÂ <span class="hljs-keyword">params</span></span>)</span>Â {
Â  Â  Â  Â  unProcessedCounter.incrementAndGet();
Â  Â  Â  Â Â <span class="hljs-comment">// put() æ–¹æ³•åœ¨é˜Ÿåˆ—æ»¡æ—¶ä¼šé˜»å¡ï¼Œå®ç°èƒŒå‹</span>
Â  Â  Â  Â  commonQueue.put(<span class="hljs-keyword">params</span>);
Â  Â  }
}
</code></pre>
<p>èƒŒå‹ä¼ å¯¼ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dec8c6b583404a38a991008e87765dfe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771297904&amp;x-signature=opiqc2MK6x4y25odW74eMs9%2BN2U%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<h3 data-id="heading-32">çº¿ç¨‹æ± å¹¶å‘æ§åˆ¶</h3>
<pre><code class="hljs language-ini" lang="ini">publicÂ classÂ ClickHouseWriterÂ {
Â  Â Â privateÂ finalÂ intÂ numWriters<span class="hljs-comment">;Â // å†™å…¥çº¿ç¨‹æ•°</span>
Â  Â Â privateÂ ExecutorService service<span class="hljs-comment">;</span>
Â  Â Â privateÂ voidÂ buildComponents()Â {
Â  Â  Â  Â Â ThreadFactoryÂ <span class="hljs-attr">threadFactory</span>Â =Â ThreadUtil.threadFactory(<span class="hljs-string">"clickhouse-writer"</span>)<span class="hljs-comment">;</span>
Â  Â  Â  Â  <span class="hljs-attr">service</span> = Executors.newFixedThreadPool(numWriters, threadFactory)<span class="hljs-comment">;</span>
Â  Â  Â  Â Â // åˆ›å»ºå¤šä¸ª WriterTask å¹¶æäº¤
Â  Â  Â  Â Â forÂ (intÂ <span class="hljs-attr">i</span>Â =Â <span class="hljs-number">0</span><span class="hljs-comment">; i &lt; numWriters; i++) {</span>
Â  Â  Â  Â  Â  Â Â WriterTaskÂ <span class="hljs-attr">task</span>Â =Â newÂ WriterTask(i, commonQueue, sinkParams, futures, unProcessedCounter)<span class="hljs-comment">;</span>
Â  Â  Â  Â  Â  Â  service.submit(task)<span class="hljs-comment">;</span>
Â  Â  Â  Â  }
Â  Â  }
}
</code></pre>
<h3 data-id="heading-33">WriterTask æ¶ˆè´¹é€»è¾‘</h3>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-keyword">class</span>Â <span class="hljs-title class_">WriterTask</span>Â implements Runnable {
Â  Â  @<span class="hljs-function">Override
Â  Â Â <span class="hljs-keyword">public</span>Â <span class="hljs-type">void</span>Â <span class="hljs-title">run</span><span class="hljs-params">()</span>Â </span>{
Â  Â  Â  Â  isWorking =Â <span class="hljs-literal">true</span>;
Â  Â  Â  Â Â <span class="hljs-keyword">while</span>Â (isWorking || !queue.<span class="hljs-built_in">isEmpty</span>()) {
Â  Â  Â  Â  Â  Â Â <span class="hljs-comment">// poll() è¶…æ—¶è¿”å›ï¼ˆ100msï¼‰ï¼Œé¿å…æ— é™ç­‰å¾…</span>
Â  Â  Â  Â  Â  Â  ClickHouseRequestBlank blank = queue.<span class="hljs-built_in">poll</span>(<span class="hljs-number">100</span>, TimeUnit.MILLISECONDS);
Â  Â  Â  Â  Â  Â Â <span class="hljs-keyword">if</span>Â (blank != null) {
Â  Â  Â  Â  Â  Â  Â  Â Â <span class="hljs-comment">// åˆ›å»º Future å¹¶è®¾ç½®è¶…æ—¶ï¼ˆ3 åˆ†é’Ÿï¼‰</span>
Â  Â  Â  Â  Â  Â  Â  Â  CompletableFuture&lt;Boolean&gt; future =Â <span class="hljs-keyword">new</span>Â CompletableFuture&lt;&gt;();
Â  Â  Â  Â  Â  Â  Â  Â  future.<span class="hljs-built_in">orTimeout</span>(<span class="hljs-number">3</span>, TimeUnit.MINUTES);
Â  Â  Â  Â  Â  Â  Â  Â  futures.<span class="hljs-built_in">add</span>(future);
Â  Â  Â  Â  Â  Â  Â  Â Â <span class="hljs-keyword">try</span>Â {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â <span class="hljs-built_in">send</span>(blank, future,Â <span class="hljs-keyword">new</span>Â HashSet&lt;&gt;());
Â  Â  Â  Â  Â  Â  Â  Â  } finally {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â <span class="hljs-comment">// final è¿›è¡ŒæœªçŸ¥å¼‚å¸¸å…œåº•ï¼Œé˜²æ­¢ä¸ºæ•è·å¼‚å¸¸é€ æˆfutureçŠ¶æ€ä¸å®Œæˆï¼Œæ°¸ä¹…é˜»å¡</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â <span class="hljs-keyword">if</span>Â (!future.<span class="hljs-built_in">isDone</span>()) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  future.<span class="hljs-built_in">completeExceptionally</span>(<span class="hljs-keyword">new</span>Â <span class="hljs-built_in">RuntimeException</span>(<span class="hljs-string">"Unknown exception"</span>));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  queueCounter.<span class="hljs-built_in">decrementAndGet</span>();
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  }
}
</code></pre>
<h3 data-id="heading-34">é…ç½®å‚æ•°</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f9d99484e9774322948675bc946eb62f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771297904&amp;x-signature=%2F5ipurXD1JRrSwWbG4hz7k0OScU%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<h2 data-id="heading-35">ä¸ƒã€é‡è¯•æœºåˆ¶ä¸è¶…æ—¶æ§åˆ¶</h2>
<h3 data-id="heading-36">Future è¶…æ—¶æ§åˆ¶</h3>
<pre><code class="hljs language-ini" lang="ini">publicÂ classÂ ClickHouseWriterÂ {
Â  Â Â privateÂ finalÂ intÂ numWriters<span class="hljs-comment">;Â // å†™å…¥çº¿ç¨‹æ•°</span>
Â  Â Â privateÂ ExecutorService service<span class="hljs-comment">;</span>
Â  Â Â privateÂ voidÂ buildComponents()Â {
Â  Â  Â  Â Â ThreadFactoryÂ <span class="hljs-attr">threadFactory</span>Â =Â ThreadUtil.threadFactory(<span class="hljs-string">"clickhouse-writer"</span>)<span class="hljs-comment">;</span>
Â  Â  Â  Â  <span class="hljs-attr">service</span> = Executors.newFixedThreadPool(numWriters, threadFactory)<span class="hljs-comment">;</span>
Â  Â  Â  Â Â // åˆ›å»ºå¤šä¸ª WriterTask å¹¶æäº¤
Â  Â  Â  Â Â forÂ (intÂ <span class="hljs-attr">i</span>Â =Â <span class="hljs-number">0</span><span class="hljs-comment">; i &lt; numWriters; i++) {</span>
Â  Â  Â  Â  Â  Â Â WriterTaskÂ <span class="hljs-attr">task</span>Â =Â newÂ WriterTask(i, commonQueue, sinkParams, futures, unProcessedCounter)<span class="hljs-comment">;</span>
Â  Â  Â  Â  Â  Â  service.submit(task)<span class="hljs-comment">;</span>
Â  Â  Â  Â  }
Â  Â  }
}
</code></pre>
<p><strong>è¶…æ—¶ç­–ç•¥ï¼š</strong></p>
<ul>
<li><strong>Future è¶…æ—¶ï¼š</strong> 3 åˆ†é’Ÿï¼ˆorTimeoutï¼‰ã€‚</li>
<li><strong>Socket è¶…æ—¶ï¼š</strong> 3 åˆ†é’Ÿï¼ˆsocket_timeout=180000ï¼‰ã€‚</li>
<li><strong>è¿æ¥è¶…æ—¶ï¼š</strong> 30 ç§’ï¼ˆconnectionTimeout=30000ï¼‰ã€‚</li>
</ul>
<h3 data-id="heading-37">é‡è¯•é€»è¾‘</h3>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-keyword">class</span>Â <span class="hljs-title class_">WriterTask</span>Â implements Runnable {
Â  Â  @<span class="hljs-function">Override
Â  Â Â <span class="hljs-keyword">public</span>Â <span class="hljs-type">void</span>Â <span class="hljs-title">run</span><span class="hljs-params">()</span>Â </span>{
Â  Â  Â  Â  isWorking =Â <span class="hljs-literal">true</span>;
Â  Â  Â  Â Â <span class="hljs-keyword">while</span>Â (isWorking || !queue.<span class="hljs-built_in">isEmpty</span>()) {
Â  Â  Â  Â  Â  Â Â <span class="hljs-comment">// poll() è¶…æ—¶è¿”å›ï¼ˆ100msï¼‰ï¼Œé¿å…æ— é™ç­‰å¾…</span>
Â  Â  Â  Â  Â  Â  ClickHouseRequestBlank blank = queue.<span class="hljs-built_in">poll</span>(<span class="hljs-number">100</span>, TimeUnit.MILLISECONDS);
Â  Â  Â  Â  Â  Â Â <span class="hljs-keyword">if</span>Â (blank != null) {
Â  Â  Â  Â  Â  Â  Â  Â Â <span class="hljs-comment">// åˆ›å»º Future å¹¶è®¾ç½®è¶…æ—¶ï¼ˆ3 åˆ†é’Ÿï¼‰</span>
Â  Â  Â  Â  Â  Â  Â  Â  CompletableFuture&lt;Boolean&gt; future =Â <span class="hljs-keyword">new</span>Â CompletableFuture&lt;&gt;();
Â  Â  Â  Â  Â  Â  Â  Â  future.<span class="hljs-built_in">orTimeout</span>(<span class="hljs-number">3</span>, TimeUnit.MINUTES);
Â  Â  Â  Â  Â  Â  Â  Â  futures.<span class="hljs-built_in">add</span>(future);
Â  Â  Â  Â  Â  Â  Â  Â Â <span class="hljs-keyword">try</span>Â {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â <span class="hljs-built_in">send</span>(blank, future,Â <span class="hljs-keyword">new</span>Â HashSet&lt;&gt;());
Â  Â  Â  Â  Â  Â  Â  Â  } finally {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â <span class="hljs-comment">// final è¿›è¡ŒæœªçŸ¥å¼‚å¸¸å…œåº•ï¼Œé˜²æ­¢ä¸ºæ•è·å¼‚å¸¸é€ æˆfutureçŠ¶æ€ä¸å®Œæˆï¼Œæ°¸ä¹…é˜»å¡</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â <span class="hljs-keyword">if</span>Â (!future.<span class="hljs-built_in">isDone</span>()) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  future.<span class="hljs-built_in">completeExceptionally</span>(<span class="hljs-keyword">new</span>Â <span class="hljs-built_in">RuntimeException</span>(<span class="hljs-string">"Unknown exception"</span>));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  queueCounter.<span class="hljs-built_in">decrementAndGet</span>();
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  }
}
</code></pre>
<h3 data-id="heading-38">é‡è¯•æ§åˆ¶é€»è¾‘</h3>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-function"><span class="hljs-keyword">private</span>Â <span class="hljs-type">void</span>Â <span class="hljs-title">handleUnsuccessfulResponse</span><span class="hljs-params">(..., Set&lt;<span class="hljs-type">String</span>&gt; exceptHosts)</span>Â </span>{
Â  Â Â <span class="hljs-comment">// æ£€æŸ¥ Future æ˜¯å¦å·²å®Œæˆï¼ˆé¿å…é‡å¤å®Œæˆï¼‰</span>
Â  Â Â <span class="hljs-keyword">if</span>Â (future.<span class="hljs-built_in">isDone</span>()) {
Â  Â  Â  Â Â <span class="hljs-keyword">return</span>;
Â  Â  }
Â  Â Â <span class="hljs-keyword">if</span>Â (attemptCounter &gt;= maxRetries) {
Â  Â  Â  Â Â <span class="hljs-comment">// è¾¾åˆ°æœ€å¤§é‡è¯•æ¬¡æ•°ï¼Œæ ‡è®°å¤±è´¥</span>
Â  Â  Â  Â  future.<span class="hljs-built_in">completeExceptionally</span>(<span class="hljs-keyword">new</span>Â <span class="hljs-built_in">RuntimeException</span>(<span class="hljs-string">"Max retries exceeded"</span>));
Â  Â  }Â <span class="hljs-keyword">else</span>Â {
Â  Â  Â  Â Â <span class="hljs-comment">// é€’å½’é‡è¯•</span>
Â  Â  Â  Â  requestBlank.<span class="hljs-built_in">incrementCounter</span>();
Â  Â  Â  Â Â <span class="hljs-built_in">send</span>(requestBlank, future, exceptHosts);Â <span class="hljs-comment">// é€’å½’è°ƒç”¨ï¼Œæ’é™¤å¤±è´¥èŠ‚ç‚¹</span>
Â  Â  }
}
</code></pre>
<p><strong>é‡è¯•ç­–ç•¥ï¼š</strong></p>
<ul>
<li><strong>é€’å½’é‡è¯•ï¼š</strong> å¤±è´¥åé€’å½’è°ƒç”¨ï¼Œç›´åˆ°æˆåŠŸæˆ–è¾¾åˆ°æœ€å¤§æ¬¡æ•°ã€‚</li>
<li><strong>å¼‚å¸¸èŠ‚ç‚¹éš”ç¦»ï¼š</strong> æ¯æ¬¡é‡è¯•æ—¶æ’é™¤å¤±è´¥çš„èŠ‚ç‚¹ï¼ˆexceptHostsï¼‰ã€‚</li>
<li><strong>è¶…æ—¶æ§åˆ¶ï¼š</strong> Future è¶…æ—¶ï¼ˆ3 åˆ†é’Ÿï¼‰é˜²æ­¢æ°¸ä¹…é˜»å¡ã€‚</li>
</ul>
<p><strong>ä¸ºä»€ä¹ˆé€’å½’é‡è¯•æ˜¯æ›´å¥½çš„é€‰æ‹©</strong></p>
<p><strong>é€’å½’é‡è¯•ï¼ˆå½“å‰å®ç°ï¼‰</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cff580bff498427780a97a1280a54a21~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771297904&amp;x-signature=jW5LDcOYN7cZmZdYx9jVzsqyzfk%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p><strong>é˜Ÿåˆ—é‡è¯•ï¼ˆå‡è®¾æ–¹æ¡ˆï¼‰</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bfe6d6876377456b9fd028835aefc42c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771297904&amp;x-signature=R7dRjFjZaqR8ZPbcCRsfZi5jIlk%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<h4 data-id="heading-39">ä¿è¯ä¸€è‡´æ€§</h4>
<pre><code class="hljs language-kotlin" lang="kotlin">Â Â <span class="hljs-comment">// ClickHouseWriter.java:139-158</span>
Â Â <span class="hljs-keyword">while</span>Â (!futures.isEmpty() || unProcessedCounter.<span class="hljs-keyword">get</span>() &gt;Â <span class="hljs-number">0</span>) {
Â  Â  Â  CompletableFuture&lt;<span class="hljs-built_in">Void</span>&gt; future = FutureUtil.allOf(futures);
Â  Â  Â  future.<span class="hljs-keyword">get</span>(<span class="hljs-number">3</span>, TimeUnit.MINUTES); Â <span class="hljs-comment">// é˜»å¡ç›´åˆ°å…¨éƒ¨å®Œæˆ</span>
Â  }
</code></pre>
<ul>
<li>Checkpoint æ—¶æ‰€æœ‰æ•°æ®è¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ã€‚</li>
<li>é‡å¯åä¸ä¼šæœ‰éƒ¨åˆ†æ•°æ®é‡å¤çš„é—®é¢˜ã€‚</li>
</ul>
<h4 data-id="heading-40">ç®€å•å¯é </h4>
<ul>
<li>ä»£ç é€»è¾‘æ¸…æ™°ã€‚</li>
<li>å¯¹äºé˜Ÿåˆ—é‡è¯•ä¸”ä¸é‡å¤ï¼Œéœ€è¦å¤æ‚çš„äºŒé˜¶æ®µæäº¤ï¼ˆè¿™é‡Œæš‚ä¸å±•å¼€ï¼‰ï¼Œå¤§å¹…å¢åŠ ä»£ç å¤æ‚åº¦ã€‚</li>
</ul>
<h4 data-id="heading-41">æ€§èƒ½å¯æ¥å—</h4>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-keyword">class</span>Â <span class="hljs-title class_">WriterTask</span>Â implements Runnable {
Â  Â  @<span class="hljs-function">Override
Â  Â Â <span class="hljs-keyword">public</span>Â <span class="hljs-type">void</span>Â <span class="hljs-title">run</span><span class="hljs-params">()</span>Â </span>{
Â  Â  Â  Â Â <span class="hljs-keyword">while</span>Â (isWorking || !queue.<span class="hljs-built_in">isEmpty</span>()) {
Â  Â  Â  Â  Â  Â  ClickHouseRequestBlank blank = queue.<span class="hljs-built_in">poll</span>(<span class="hljs-number">100</span>, TimeUnit.MILLISECONDS);
Â  Â  Â  Â  Â  Â Â <span class="hljs-keyword">if</span>Â (blank != null) {
Â  Â  Â  Â  Â  Â  Â  Â Â <span class="hljs-comment">// åˆ›å»º Future å¹¶è®¾ç½® 3 åˆ†é’Ÿè¶…æ—¶</span>
Â  Â  Â  Â  Â  Â  Â  Â  CompletableFuture&lt;Boolean&gt; future =Â <span class="hljs-keyword">new</span>Â CompletableFuture&lt;&gt;();
Â  Â  Â  Â  Â  Â  Â  Â  future.<span class="hljs-built_in">orTimeout</span>(<span class="hljs-number">3</span>, TimeUnit.MINUTES);Â <span class="hljs-comment">// é˜²æ­¢æ°¸ä¹…é˜»å¡</span>
Â  Â  Â  Â  Â  Â  Â  Â  futures.<span class="hljs-built_in">add</span>(future);
Â  Â  Â  Â  Â  Â  Â  Â Â <span class="hljs-keyword">try</span>Â {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â <span class="hljs-built_in">send</span>(blank, future,Â <span class="hljs-keyword">new</span>Â HashSet&lt;&gt;());
Â  Â  Â  Â  Â  Â  Â  Â  } finally {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â <span class="hljs-keyword">if</span>Â (!future.<span class="hljs-built_in">isDone</span>()) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  future.<span class="hljs-built_in">completeExceptionally</span>(<span class="hljs-keyword">new</span>Â <span class="hljs-built_in">RuntimeException</span>(<span class="hljs-string">"Timeout"</span>));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  queueCounter.<span class="hljs-built_in">decrementAndGet</span>();
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  }
}
</code></pre>
<ul>
<li>è™½ç„¶é˜»å¡ï¼Œä½†æœ‰è¶…æ—¶ä¿æŠ¤ã€‚</li>
<li>ClickHouse å†™å…¥é€šå¸¸å¾ˆå¿«ï¼ˆç§’çº§ï¼‰ã€‚</li>
<li>ç½‘ç»œæ•…éšœæ—¶é‡è¯•ä¹Ÿåˆç†ã€‚</li>
</ul>
<h4 data-id="heading-42">é¿å¼€æ•…éšœèŠ‚ç‚¹</h4>
<pre><code class="hljs language-ini" lang="ini">Â  // ClickHouseWriter.java:259-260
Â  HikariDataSource <span class="hljs-attr">dataSource</span> =Â getNextDataSource(exceptHosts)<span class="hljs-comment">;</span>
</code></pre>
<ul>
<li>é€’å½’æ—¶å¯ä»¥ä¼ é€’ exceptHostsã€‚</li>
<li>è‡ªåŠ¨é¿å¼€å¤±è´¥çš„èŠ‚ç‚¹ã€‚</li>
<li>æé«˜æˆåŠŸç‡ã€‚</li>
</ul>
<h3 data-id="heading-43">å¼‚å¸¸èŠ‚ç‚¹å‰”é™¤</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// ç‰¹æ®Šé”™è¯¯ç åˆ—è¡¨ï¼ˆè‡ªåŠ¨åŠ å…¥é»‘åå•ï¼‰</span>
<span class="hljs-keyword">private</span>Â <span class="hljs-keyword">final</span>Â List&lt;Integer&gt; ignoreHostCodes = Arrays.asList(<span class="hljs-number">210</span>,Â <span class="hljs-number">1002</span>);
<span class="hljs-keyword">public</span>Â HikariDataSource getNextDataSource(Set&lt;String&gt; exceptionHosts) {
Â  Â Â <span class="hljs-keyword">if</span>Â (CollectionUtils.isNotEmpty(exceptionHosts)) {
Â  Â  Â  Â Â <span class="hljs-comment">// è¿‡æ»¤å¼‚å¸¸èŠ‚ç‚¹</span>
Â  Â  Â  Â  List&lt;HikariDataSource&gt; healthyHosts = clickHouseDataSources.stream()
Â  Â  Â  Â  Â  Â  .filter(ds -&gt; !exceptionHosts.contains(getHostFromUrl(ds)))
Â  Â  Â  Â  Â  Â  .collect(Collectors.toList());
Â  Â  Â  Â Â <span class="hljs-keyword">if</span>Â (CollectionUtils.isEmpty(healthyHosts)) {
Â  Â  Â  Â  Â  Â Â <span class="hljs-keyword">return</span>Â <span class="hljs-literal">null</span>;Â <span class="hljs-comment">// æ‰€æœ‰èŠ‚ç‚¹éƒ½å¼‚å¸¸</span>
Â  Â  Â  Â  }
Â  Â  Â  Â Â <span class="hljs-keyword">return</span>Â healthyHosts.<span class="hljs-keyword">get</span>(random.nextInt(healthyHosts.size()));
Â  Â  }
Â  Â Â <span class="hljs-comment">// æ­£å¸¸è½®è¯¢ï¼ˆå·² shuffleï¼Œé¿å…çƒ­ç‚¹ï¼‰</span>
Â  Â Â <span class="hljs-keyword">return</span>Â clickHouseDataSources.<span class="hljs-keyword">get</span>(currentRandom.getAndIncrement() % size);
}
</code></pre>
<p><strong>æ•…éšœèŠ‚ç‚¹å‰”é™¤ç­–ç•¥ï¼š</strong></p>
<ol>
<li><strong>é”™è¯¯ç  210ï¼ˆç½‘ç»œå¼‚å¸¸ï¼‰ï¼š</strong> è‡ªåŠ¨åŠ å…¥é»‘åå•ã€‚</li>
<li><strong>é”™è¯¯ç  1002ï¼ˆè¿æ¥æ± å¼‚å¸¸ï¼‰ï¼š</strong> è‡ªåŠ¨åŠ å…¥é»‘åå•ã€‚</li>
<li><strong>APM ç›‘æ§ï¼š</strong> ç£ç›˜ &gt;= 90%ã€HTTP è¿æ¥ &gt;= 50 çš„èŠ‚ç‚¹ã€‚</li>
<li><strong>æ‰‹åŠ¨é…ç½®ï¼š</strong> é€šè¿‡ Redis é…ç½®å‰”é™¤ã€‚</li>
</ol>
<p><strong>æ¢å¤æœºåˆ¶ï¼š</strong></p>
<ul>
<li>LoadingCache å®šæ—¶åˆ·æ–°ï¼ˆ1 åˆ†é’Ÿï¼‰ã€‚</li>
<li>èŠ‚ç‚¹æ¢å¤å¥åº·åè‡ªåŠ¨ä»é»‘åå•ç§»é™¤ã€‚</li>
</ul>
<h3 data-id="heading-44">é‡è¯•æµç¨‹å›¾</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0189dadaec2c4a59a03071e72b007243~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771297904&amp;x-signature=q3T5EN6w2kq4WuyZT2e%2F3pWOLvQ%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<h2 data-id="heading-45">å…«ã€å¼‚å¸¸å¤„ç†æ¨¡å¼</h2>
<h3 data-id="heading-46">ä¸¤ç§ Sink æ¨¡å¼</h3>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-function"><span class="hljs-keyword">public</span>Â SinkÂ <span class="hljs-title">buildSink</span><span class="hljs-params">(<span class="hljs-type">String</span>Â targetTable,Â <span class="hljs-type">String</span>Â targetCount, <span class="hljs-type">int</span> maxBufferSize)</span> </span>{
Â  Â Â IClickHouseSinkBufferÂ buffer =Â ClickHouseShardSinkBuffer.Builder
Â  Â  Â  Â  .<span class="hljs-built_in">aClickHouseSinkBuffer</span>()
Â  Â  Â  Â  .<span class="hljs-built_in">withTargetTable</span>(targetTable)
Â  Â  Â  Â  .<span class="hljs-built_in">withMaxFlushBufferSize</span>(maxBufferSize)
Â  Â  Â  Â  .<span class="hljs-built_in">withClickHouseShardStrategy</span>(<span class="hljs-keyword">new</span>Â <span class="hljs-built_in">LogClickHouseShardStrategy</span>(targetTable, count))
Â  Â  Â  Â  .<span class="hljs-built_in">build</span>(clickHouseWriter);
Â  Â Â <span class="hljs-comment">// æ ¹æ®é…ç½®é€‰æ‹©æ¨¡å¼</span>
Â  Â Â <span class="hljs-keyword">if</span>Â (ignoringClickHouseSendingExceptionEnabled) {
Â  Â  Â  Â Â <span class="hljs-keyword">return</span>Â <span class="hljs-keyword">new</span>Â <span class="hljs-built_in">UnexceptionableSink</span>(buffer); Â <span class="hljs-comment">// å¿½ç•¥å¼‚å¸¸</span>
Â  Â  }Â <span class="hljs-keyword">else</span>Â {
Â  Â  Â  Â Â <span class="hljs-keyword">return</span>Â <span class="hljs-keyword">new</span>Â <span class="hljs-built_in">ExceptionsThrowableSink</span>(buffer);Â <span class="hljs-comment">// æŠ›å‡ºå¼‚å¸¸</span>
Â  Â  }
}
</code></pre>
<h3 data-id="heading-47">UnexceptionableSinkï¼ˆå¿½ç•¥å¼‚å¸¸ - At-Most-Onceï¼‰</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">public</span>Â <span class="hljs-keyword">class</span>Â <span class="hljs-title class_">UnexceptionableSink</span>Â <span class="hljs-keyword">implements</span>Â <span class="hljs-title class_">Sink</span>&lt;<span class="hljs-title class_">LogModel</span>&gt; {
Â  Â Â <span class="hljs-keyword">private</span>Â finalÂ <span class="hljs-title class_">IClickHouseSinkBuffer</span>&lt;<span class="hljs-title class_">LogModel</span>&gt; buffer;
Â  Â Â <span class="hljs-meta">@Override</span>
Â  Â Â <span class="hljs-keyword">public</span>Â <span class="hljs-built_in">void</span>Â <span class="hljs-title function_">put</span>(<span class="hljs-params">LogModelÂ message</span>) {
Â  Â  Â  Â  buffer.<span class="hljs-title function_">put</span>(message); Â <span class="hljs-comment">// ä¸æ£€æŸ¥ Future çŠ¶æ€</span>
Â  Â  }
Â  Â Â <span class="hljs-meta">@Override</span>
Â  Â Â <span class="hljs-keyword">public</span>Â <span class="hljs-built_in">void</span>Â <span class="hljs-title function_">flush</span>(<span class="hljs-params"/>) {
Â  Â  Â  Â  buffer.<span class="hljs-title function_">flush</span>();
Â  Â  }
}
</code></pre>
<p><strong>é€‚ç”¨åœºæ™¯ï¼š</strong></p>
<ul>
<li>å…è®¸éƒ¨åˆ†æ•°æ®ä¸¢å¤±ã€‚</li>
<li>ä¸å¸Œæœ›å› å†™å…¥å¼‚å¸¸å¯¼è‡´ä»»åŠ¡å¤±è´¥ã€‚</li>
<li>å¯¹æ•°æ®å‡†ç¡®æ€§è¦æ±‚ä¸é«˜ï¼ˆå¦‚æ—¥å¿—ç»Ÿè®¡ï¼‰ã€‚</li>
</ul>
<p><strong>è¯­ä¹‰ä¿è¯ï¼šAt-Most-Onceï¼ˆæœ€å¤šä¸€æ¬¡ï¼‰</strong></p>
<h3 data-id="heading-48">ExceptionsThrowableSinkï¼ˆæŠ›å‡ºå¼‚å¸¸ - At-Least-Onceï¼‰</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span>Â <span class="hljs-keyword">class</span>Â <span class="hljs-title class_">ExceptionsThrowableSink</span>Â <span class="hljs-keyword">implements</span>Â <span class="hljs-title class_">Sink</span>&lt;LogModel&gt; {
Â  Â Â <span class="hljs-keyword">private</span>Â <span class="hljs-keyword">final</span>Â IClickHouseSinkBuffer&lt;LogModel&gt; buffer;
Â  Â Â <span class="hljs-meta">@Override</span>
Â  Â Â <span class="hljs-keyword">public</span>Â <span class="hljs-keyword">void</span>Â <span class="hljs-title function_">put</span><span class="hljs-params">(LogModel message)</span>Â <span class="hljs-keyword">throws</span>Â ExecutionException, InterruptedException {
Â  Â  Â  Â  buffer.put(message);
Â  Â  Â  Â Â <span class="hljs-comment">// æ¯æ¬¡å†™å…¥éƒ½æ£€æŸ¥ Future çŠ¶æ€</span>
Â  Â  Â  Â  buffer.assertFuturesNotFailedYet();
Â  Â  }
Â  Â Â <span class="hljs-meta">@Override</span>
Â  Â Â <span class="hljs-keyword">public</span>Â <span class="hljs-keyword">void</span>Â <span class="hljs-title function_">flush</span><span class="hljs-params">()</span>Â <span class="hljs-keyword">throws</span>Â ExecutionException, InterruptedException {
Â  Â  Â  Â  buffer.flush();
Â  Â  }
}
</code></pre>
<p><strong>Future çŠ¶æ€æ£€æŸ¥ï¼š</strong></p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-function"><span class="hljs-keyword">public</span>Â <span class="hljs-type">void</span>Â <span class="hljs-title">assertFuturesNotFailedYet</span><span class="hljs-params">()</span>Â throws ExecutionException, InterruptedExceptionÂ </span>{
Â  Â  CompletableFuture&lt;Void&gt; future = FutureUtil.<span class="hljs-built_in">allOf</span>(futures);
Â  Â Â <span class="hljs-comment">// éé˜»å¡æ£€æŸ¥</span>
Â  Â Â <span class="hljs-keyword">if</span>Â (future.<span class="hljs-built_in">isCompletedExceptionally</span>()) {
Â  Â  Â  Â  logger.<span class="hljs-built_in">error</span>(<span class="hljs-string">"There is something wrong with the future. exist sink now"</span>);
Â  Â  Â  Â  future.<span class="hljs-built_in">get</span>();Â <span class="hljs-comment">// æŠ›å‡ºå¼‚å¸¸ï¼Œå¯¼è‡´ Flink ä»»åŠ¡å¤±è´¥</span>
Â  Â  }
}
</code></pre>
<p><strong>é€‚ç”¨åœºæ™¯ï¼š</strong></p>
<ul>
<li>æ•°æ®å‡†ç¡®æ€§è¦æ±‚é«˜ã€‚</li>
<li>éœ€è¦ä¿è¯æ‰€æœ‰æ•°æ®å†™å…¥æˆåŠŸã€‚</li>
<li>å¼‚å¸¸æ—¶å¸Œæœ› Flink ä»»åŠ¡å¤±è´¥å¹¶é‡å¯ã€‚</li>
</ul>
<p><strong>è¯­ä¹‰ä¿è¯ï¼šAt-Least-Onceï¼ˆè‡³å°‘ä¸€æ¬¡ï¼‰</strong></p>
<h3 data-id="heading-49">Future æ¸…ç†ç­–ç•¥ä¸å¹¶å‘æ§åˆ¶</h3>
<h4 data-id="heading-50">å®šæ—¶æ£€æŸ¥å™¨</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span>Â <span class="hljs-keyword">class</span>Â <span class="hljs-title class_">ClickHouseSinkScheduledCheckerAndCleaner</span>Â {
Â  Â Â <span class="hljs-keyword">private</span>Â <span class="hljs-keyword">final</span>Â ScheduledExecutorService scheduledExecutorService;
Â  Â Â <span class="hljs-keyword">private</span>Â <span class="hljs-keyword">final</span>Â List&lt;CompletableFuture&lt;Boolean&gt;&gt; futures;
Â  Â Â <span class="hljs-comment">// âš ï¸ volatile ä¿è¯å¤šçº¿ç¨‹å¯è§æ€§ï¼ˆå…³é”®å¹¶å‘æ§åˆ¶ç‚¹ï¼‰</span>
Â  Â Â <span class="hljs-keyword">private</span>Â <span class="hljs-keyword">volatile</span>Â <span class="hljs-type">boolean</span>Â <span class="hljs-variable">isFlushing</span>Â <span class="hljs-operator">=</span>Â <span class="hljs-literal">false</span>;
Â  Â Â <span class="hljs-keyword">public</span>Â <span class="hljs-title function_">ClickHouseSinkScheduledCheckerAndCleaner</span><span class="hljs-params">(...)</span>Â {
Â  Â  Â  Â Â <span class="hljs-comment">// å•çº¿ç¨‹å®šæ—¶æ‰§è¡Œå™¨</span>
Â  Â  Â  Â  scheduledExecutorService = Executors.newSingleThreadScheduledExecutor(factory);
Â  Â  Â  Â Â <span class="hljs-comment">// å®šæ—¶æ‰§è¡Œæ¸…ç†ä»»åŠ¡ï¼ˆæ¯éš” checkTimeout ç§’ï¼Œé»˜è®¤ 30 ç§’ï¼‰</span>
Â  Â  Â  Â  scheduledExecutorService.scheduleWithFixedDelay(getTask(), ...);
Â  Â  }
Â  Â Â <span class="hljs-keyword">private</span>Â RunnableÂ <span class="hljs-title function_">getTask</span><span class="hljs-params">()</span>Â {
Â  Â  Â  Â Â <span class="hljs-keyword">return</span>Â () -&gt; {
Â  Â  Â  Â  Â  Â Â <span class="hljs-keyword">synchronized</span>Â (<span class="hljs-built_in">this</span>) {
Â  Â  Â  Â  Â  Â  Â  Â Â <span class="hljs-comment">//  å…³é”®ï¼šæ£€æŸ¥æ˜¯å¦æ­£åœ¨ flushï¼Œé¿å…å¹¶å‘å†²çª</span>
Â  Â  Â  Â  Â  Â  Â  Â Â <span class="hljs-keyword">if</span>Â (isFlushing) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â <span class="hljs-keyword">return</span>;Â <span class="hljs-comment">// Checkpoint æœŸé—´æš‚åœæ¸…ç†</span>
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â Â <span class="hljs-comment">// 1ï¸âƒ£ æ¸…ç†å·²å®Œæˆçš„ Future</span>
Â  Â  Â  Â  Â  Â  Â  Â  futures.removeIf(filter);
Â  Â  Â  Â  Â  Â  Â  Â Â <span class="hljs-comment">// 2ï¸âƒ£ è§¦å‘æ‰€æœ‰ Buffer çš„ flushï¼ˆæ£€æŸ¥æ˜¯å¦éœ€è¦å†™å…¥ï¼‰</span>
Â  Â  Â  Â  Â  Â  Â  Â  clickHouseSinkBuffers.forEach(IClickHouseSinkBuffer::tryAddToQueue);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  };
Â  Â  }
Â  Â Â <span class="hljs-comment">// Checkpoint flush å‰è°ƒç”¨ï¼ˆæš‚åœ cleanerï¼‰</span>
Â  Â Â <span class="hljs-keyword">public</span>Â <span class="hljs-keyword">synchronized</span>Â <span class="hljs-keyword">void</span>Â <span class="hljs-title function_">beforeFlush</span><span class="hljs-params">()</span>Â {
Â  Â  Â  Â  isFlushing =Â <span class="hljs-literal">true</span>;
Â  Â  }
Â  Â Â <span class="hljs-comment">// Checkpoint flush åè°ƒç”¨ï¼ˆæ¢å¤ cleanerï¼‰</span>
Â  Â Â <span class="hljs-keyword">public</span>Â <span class="hljs-keyword">synchronized</span>Â <span class="hljs-keyword">void</span>Â <span class="hljs-title function_">afterFlush</span><span class="hljs-params">()</span>Â {
Â  Â  Â  Â  isFlushing =Â <span class="hljs-literal">false</span>;
Â  Â  }
}
</code></pre>
<p><strong>æ ¸å¿ƒè®¾è®¡ï¼š</strong></p>
<ul>
<li><strong>volatile boolean isFlushingï¼š</strong> æ ‡å¿—ä½ï¼Œåè°ƒ cleaner ä¸ checkpoint çº¿ç¨‹ã€‚</li>
<li><strong>synchronized (this)ï¼š</strong> ä¿è¯åŸå­æ€§ï¼Œé¿å…å¹¶å‘å†²çªã€‚</li>
<li><strong>å•çº¿ç¨‹æ‰§è¡Œå™¨ï¼š</strong> é¿å… cleaner å†…éƒ¨å¹¶å‘é—®é¢˜ã€‚</li>
</ul>
<h4 data-id="heading-51">å¹¶å‘æ§åˆ¶æœºåˆ¶</h4>
<p><strong>é—®é¢˜åœºæ™¯ï¼š</strong></p>
<pre><code class="hljs language-css" lang="css">æ—¶é—´è½´å†²çªï¼š
T1: Cleaner çº¿ç¨‹æ­£åœ¨æ‰§è¡ŒÂ <span class="hljs-built_in">tryAddToQueue</span>()
T2: Checkpoint è§¦å‘ï¼Œè°ƒç”¨ sink.<span class="hljs-built_in">flush</span>()
T3: Cleaner åŒæ—¶ä¹Ÿåœ¨æ‰§è¡ŒÂ <span class="hljs-built_in">tryAddToQueue</span>()
Â  Â  â”œâ”€ å¯èƒ½å¯¼è‡´ï¼šæ•°æ®é‡å¤å†™å…¥
Â  Â  â”œâ”€ å¯èƒ½å¯¼è‡´ï¼šBuffer æ¸…ç©ºé¡ºåºæ··ä¹±
Â  Â  â””â”€ å¯èƒ½å¯¼è‡´ï¼šFuture çŠ¶æ€ä¸ä¸€è‡´
</code></pre>
<p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// ClickHouseSinkManager.flush()</span>
<span class="hljs-function"><span class="hljs-keyword">public</span>Â <span class="hljs-keyword">void</span>Â <span class="hljs-title">flush</span>()</span>Â {
Â  Â Â <span class="hljs-comment">// 1ï¸âƒ£ æš‚åœå®šæ—¶æ¸…ç†ä»»åŠ¡ï¼ˆè®¾ç½®æ ‡å¿—ï¼‰</span>
Â  Â  clickHouseSinkScheduledCheckerAndCleaner.beforeFlush();Â <span class="hljs-comment">// isFlushing = true</span>
Â  Â Â <span class="hljs-keyword">try</span>Â {
Â  Â  Â  Â Â <span class="hljs-comment">// 2ï¸âƒ£ æ‰§è¡Œ flushï¼ˆæ­¤æ—¶ cleaner çº¿ç¨‹ä¼šè·³è¿‡æ‰§è¡Œï¼‰</span>
Â  Â  Â  Â  clickHouseWriter.waitUntilAllFuturesDone(<span class="hljs-literal">false</span>,Â <span class="hljs-literal">false</span>);
Â  Â  }Â <span class="hljs-keyword">finally</span>Â {
Â  Â  Â  Â Â <span class="hljs-comment">// 3ï¸âƒ£ æ¢å¤å®šæ—¶æ¸…ç†ä»»åŠ¡</span>
Â  Â  Â  Â  clickHouseSinkScheduledCheckerAndCleaner.afterFlush();Â <span class="hljs-comment">// isFlushing = false</span>
Â  Â  }
}
</code></pre>
<p>å¹¶å‘æ§åˆ¶æµç¨‹ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/10f55374e4ee49abb914d3c9137c91f4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771297904&amp;x-signature=rWjqaPoBWG7mDze7UwWj9ENsauA%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p><strong>å…³é”®è®¾è®¡ç‚¹ï¼š</strong></p>
<ol>
<li><strong>volatile ä¿è¯å¯è§æ€§ï¼š</strong> isFlushing ä½¿ç”¨ volatileï¼Œç¡®ä¿å¤šçº¿ç¨‹é—´çš„å¯è§æ€§ã€‚</li>
<li><strong>synchronized ä¿è¯åŸå­æ€§ï¼š</strong> getTask() æ•´ä¸ªæ–¹æ³•ä½“ä½¿ç”¨ synchronized (this)ã€‚</li>
<li><strong>æ ‡å¿—ä½åè°ƒï¼š</strong> é€šè¿‡ isFlushing æ ‡å¿—å®ç°ä¸¤ä¸ªçº¿ç¨‹é—´çš„åè°ƒã€‚</li>
<li><strong>finally ç¡®ä¿æ¢å¤ï¼š</strong> å³ä½¿ waitUntilAllFuturesDone() å¼‚å¸¸ï¼Œä¹Ÿä¼šåœ¨ finally ä¸­æ¢å¤ cleanerã€‚</li>
</ol>
<p><strong>é¿å…çš„å¹¶å‘é—®é¢˜ï¼š</strong></p>
<ul>
<li><strong>æ•°æ®é‡å¤å†™å…¥ï¼š</strong> Cleaner å’Œ Checkpoint åŒæ—¶ flushã€‚</li>
<li><strong>Buffer çŠ¶æ€ä¸ä¸€è‡´ï¼š</strong> ä¸€è¾¹æ¸…ç©ºä¸€è¾¹å†™å…¥ã€‚</li>
<li><strong>Future æ¸…ç†å†²çªï¼š</strong> æ­£åœ¨ä½¿ç”¨çš„ Future è¢«æ¸…ç†ã€‚</li>
</ul>
<p><strong>æ€§èƒ½å½±å“ï¼š</strong></p>
<ul>
<li>Checkpoint flush æœŸé—´ï¼Œcleaner æš‚åœæ‰§è¡Œï¼ˆé€šå¸¸ 1-3 ç§’ï¼‰ã€‚</li>
<li>Cleaner è·³è¿‡çš„å‘¨æœŸä¼šåœ¨ä¸‹æ¬¡æ­£å¸¸æ‰§è¡Œæ—¶è¡¥å¿ã€‚</li>
<li>å¯¹æ•´ä½“ååå½±å“æå°ï¼ˆcleaner é—´éš”é€šå¸¸ 30 ç§’ï¼‰ã€‚</li>
</ul>
<h2 data-id="heading-52">ä¹ã€Checkpoint è¯­ä¹‰ä¿è¯</h2>
<h3 data-id="heading-53">ä¸ºä»€ä¹ˆ Checkpoint æ—¶å¿…é¡» Flushï¼Ÿ</h3>
<h4 data-id="heading-54">ä¸ Flush çš„åæœ</h4>
<p><strong>ä¸Flushå¯¼è‡´æ•°æ®æ°¸ä¹…ä¸¢å¤±</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3ef7013722b5400084a22dd0754d2a47~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771297904&amp;x-signature=MhVyQZQj1FGYwBPV%2Fud2blWmEn8%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<h4 data-id="heading-55">æ­£ç¡®åšæ³•</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span>Â <span class="hljs-keyword">void</span>Â <span class="hljs-title function_">snapshotState</span><span class="hljs-params">(FunctionSnapshotContext context)</span>Â <span class="hljs-keyword">throws</span>Â Exception {
Â  Â  logger.info(<span class="hljs-string">"start doing snapshot. flush sink to ck"</span>);
Â  Â Â <span class="hljs-comment">// 1. å…ˆ flush bufferï¼ˆå°†å†…å­˜æ•°æ®å†™å…¥ ClickHouseï¼‰</span>
Â  Â Â <span class="hljs-keyword">if</span>Â (sink !=Â <span class="hljs-literal">null</span>) {
Â  Â  Â  Â  sink.flush();
Â  Â  }
Â  Â Â <span class="hljs-comment">// 2. ç­‰å¾…æ‰€æœ‰å†™å…¥å®Œæˆ</span>
Â  Â Â <span class="hljs-keyword">if</span>Â (sinkManager !=Â <span class="hljs-literal">null</span>Â &amp;&amp; !sinkManager.isClosed()) {
Â  Â  Â  Â  sinkManager.flush();
Â  Â  }
Â  Â Â <span class="hljs-comment">// æ­¤æ—¶ Checkpoint æ‰èƒ½æ ‡è®°ä¸ºæˆåŠŸ</span>
Â  Â  logger.info(<span class="hljs-string">"doing snapshot. flush sink to ck"</span>);
}
</code></pre>
<h3 data-id="heading-56">Flush å®ç°ä¸å¹¶å‘åè°ƒ</h3>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span>Â <span class="hljs-keyword">class</span>Â <span class="hljs-title">ClickHouseSinkManager</span>Â {
Â  Â Â <span class="hljs-function"><span class="hljs-keyword">public</span>Â <span class="hljs-keyword">void</span>Â <span class="hljs-title">flush</span>()</span>Â {
Â  Â  Â  Â Â <span class="hljs-comment">//  æ­¥éª¤1ï¼šæš‚åœå®šæ—¶æ¸…ç†ä»»åŠ¡</span>
Â  Â  Â  Â  clickHouseSinkScheduledCheckerAndCleaner.beforeFlush();Â <span class="hljs-comment">// isFlushing = true</span>
Â  Â  Â  Â Â <span class="hljs-keyword">try</span>Â {
Â  Â  Â  Â  Â  Â Â <span class="hljs-comment">//  æ­¥éª¤2ï¼šæ‰§è¡Œ buffer flush + ç­‰å¾…æ‰€æœ‰å†™å…¥å®Œæˆ</span>
Â  Â  Â  Â  Â  Â  clickHouseWriter.waitUntilAllFuturesDone(<span class="hljs-literal">false</span>,Â <span class="hljs-literal">false</span>);
Â  Â  Â  Â  }Â <span class="hljs-keyword">finally</span>Â {
Â  Â  Â  Â  Â  Â Â <span class="hljs-comment">//  æ­¥éª¤3ï¼šæ¢å¤å®šæ—¶æ¸…ç†ä»»åŠ¡ï¼ˆfinally ç¡®ä¿æ‰§è¡Œï¼‰</span>
Â  Â  Â  Â  Â  Â  clickHouseSinkScheduledCheckerAndCleaner.afterFlush();Â <span class="hljs-comment">// isFlushing = false</span>
Â  Â  Â  Â  }
Â  Â  }
}
</code></pre>
<p><strong>å¹¶å‘åè°ƒè¯¦è§£ï¼š</strong></p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// cleaner çº¿ç¨‹æ‰§è¡Œæµç¨‹</span>
synchronized (<span class="hljs-keyword">this</span>) {
Â  Â Â <span class="hljs-keyword">if</span>Â (isFlushing) {
Â  Â  Â  Â Â <span class="hljs-keyword">return</span>;Â <span class="hljs-comment">// Checkpoint æœŸé—´è·³è¿‡æœ¬æ¬¡æ‰§è¡Œ</span>
Â  Â  }
Â  Â Â <span class="hljs-comment">// æ­£å¸¸æ‰§è¡Œï¼šæ¸…ç†å·²å®Œæˆçš„ Future + è§¦å‘ Buffer flush</span>
Â  Â  futures.removeIf(filter);
Â  Â  buffers.forEach(Buffer::tryAddToQueue);
}
</code></pre>
<p><strong>å…³é”®ç‚¹ï¼š</strong></p>
<ul>
<li><strong>volatile å¯è§æ€§ï¼š</strong> isFlushing ä½¿ç”¨ volatile ç¡®ä¿ cleaner çº¿ç¨‹ç«‹å³çœ‹åˆ°çŠ¶æ€å˜åŒ–ã€‚</li>
<li><strong>synchronizedäº’æ–¥ï¼š</strong> getTask()æ–¹æ³•ä½“ä½¿ç”¨ synchronized (this) ç¡®ä¿åŸå­æ€§ã€‚</li>
<li><strong>æ ‡å¿—ä½åè°ƒï¼š</strong> é€šè¿‡ beforeFlush() / afterFlush() ç®¡ç†æ ‡å¿—ä½ã€‚</li>
<li><strong>finally ä¿è¯æ¢å¤ï¼š</strong> å³ä½¿ flush å¼‚å¸¸ï¼Œä¹Ÿä¼šåœ¨ finally ä¸­æ¢å¤ cleanerã€‚</li>
</ul>
<h3 data-id="heading-57">ç­‰å¾…æ‰€æœ‰ Future å®Œæˆ</h3>
<pre><code class="hljs language-scss" lang="scss">publicÂ synchronizedÂ voidÂ <span class="hljs-built_in">waitUntilAllFuturesDone</span>(booleanÂ stopWriters,Â booleanÂ clearFutures) {
Â  Â Â tryÂ {
Â  Â  Â  Â Â <span class="hljs-comment">// å¾ªç¯ç­‰å¾…ï¼šç›´åˆ°æ‰€æœ‰ Future å®Œæˆ + é˜Ÿåˆ—æ¸…ç©º</span>
Â  Â  Â  Â Â whileÂ (!futures.isEmpty() || unProcessedCounter<span class="hljs-selector-class">.get</span>() &gt;Â <span class="hljs-number">0</span>) {
Â  Â  Â  Â  Â  Â Â CompletableFuture&lt;Void&gt; <span class="hljs-attribute">all</span> =Â FutureUtil<span class="hljs-selector-class">.allOf</span>(futures);
Â  Â  Â  Â  Â  Â Â <span class="hljs-comment">// æœ€å¤šç­‰å¾… 3 åˆ†é’Ÿï¼ˆä¸ Future è¶…æ—¶ä¸€è‡´ï¼‰</span>
Â  Â  Â  Â  Â  Â  <span class="hljs-attribute">all</span><span class="hljs-selector-class">.get</span>(<span class="hljs-number">3</span>,Â TimeUnit.MINUTES);
Â  Â  Â  Â  Â  Â Â <span class="hljs-comment">// ç§»é™¤å·²å®Œæˆçš„ Futureï¼ˆéå¼‚å¸¸ï¼‰</span>
Â  Â  Â  Â  Â  Â  futures<span class="hljs-selector-class">.removeIf</span>(f -&gt; f.isDone() &amp;&amp; !f<span class="hljs-selector-class">.isCompletedExceptionally</span>());
Â  Â  Â  Â  Â  Â Â <span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦æœ‰å¼‚å¸¸ Future</span>
Â  Â  Â  Â  Â  Â Â ifÂ (anyFutureFailed()) {
Â  Â  Â  Â  Â  Â  Â  Â Â break;Â <span class="hljs-comment">// æœ‰å¼‚å¸¸åˆ™é€€å‡º</span>
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  }Â finallyÂ {
Â  Â  Â  Â Â ifÂ (stopWriters)Â <span class="hljs-built_in">stopWriters</span>();
Â  Â  Â  Â Â ifÂ (clearFutures) futures<span class="hljs-selector-class">.clear</span>();
Â  Â  }
}
</code></pre>
<p><strong>å…³é”®é€»è¾‘ï¼š</strong></p>
<ul>
<li>å¾ªç¯ç­‰å¾…ç›´åˆ°æ‰€æœ‰ Future å®Œæˆ + é˜Ÿåˆ—æ¸…ç©ºã€‚</li>
<li>è¶…æ—¶ 3 åˆ†é’Ÿï¼ˆä¸ Future è¶…æ—¶ä¸€è‡´ï¼‰ã€‚</li>
<li>ç§»é™¤å·²å®Œæˆçš„éå¼‚å¸¸ Futureã€‚</li>
<li>æœ‰å¼‚å¸¸æ—¶é€€å‡ºå¾ªç¯ã€‚</li>
</ul>
<h3 data-id="heading-58">ä¸‰ç§ Flush è§¦å‘æ–¹å¼å¯¹æ¯”</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5ba3862ba4e84285b1be07308345fdb4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771297904&amp;x-signature=skgFor1D%2FYZHiYwHiGTxrQDZrKI%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<h3 data-id="heading-59">Checkpoint å‚æ•°é…ç½®</h3>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// Checkpoint é…ç½®å»ºè®®</span>
StreamExecutionEnvironmentÂ envÂ =Â StreamExecutionEnvironment<span class="hljs-selector-class">.getExecutionEnvironment</span>();
<span class="hljs-comment">// å¯ç”¨ Checkpointï¼ˆé—´éš” 1 åˆ†é’Ÿï¼‰</span>
env<span class="hljs-selector-class">.enableCheckpointing</span>(<span class="hljs-number">60000</span>);
<span class="hljs-comment">// Checkpoint è¶…æ—¶ï¼ˆå¿…é¡»å¤§äº Future è¶…æ—¶ + é‡è¯•æ—¶é—´ï¼‰</span>
<span class="hljs-comment">// å»ºè®®ï¼šCheckpointTimeout &gt; FutureTimeout * MaxRetries</span>
env<span class="hljs-selector-class">.getCheckpointConfig</span>()<span class="hljs-selector-class">.setCheckpointTimeout</span>(<span class="hljs-number">600000</span>);Â <span class="hljs-comment">// 10 åˆ†é’Ÿ</span>
<span class="hljs-comment">// ä¸€è‡´æ€§æ¨¡å¼</span>
env<span class="hljs-selector-class">.getCheckpointConfig</span>()<span class="hljs-selector-class">.setCheckpointingMode</span>(CheckpointingMode.EXACTLY_ONCE);
<span class="hljs-comment">// æœ€å°é—´éš”ï¼ˆé¿å…è¿‡äºé¢‘ç¹ï¼‰</span>
env<span class="hljs-selector-class">.getCheckpointConfig</span>()<span class="hljs-selector-class">.setMinPauseBetweenCheckpoints</span>(<span class="hljs-number">30000</span>);Â <span class="hljs-comment">// 30 ç§’</span>
<span class="hljs-comment">// æœ€å¤§å¹¶å‘ Checkpoint æ•°</span>
env<span class="hljs-selector-class">.getCheckpointConfig</span>()<span class="hljs-selector-class">.setMaxConcurrentCheckpoints</span>(<span class="hljs-number">1</span>);
</code></pre>
<h3 data-id="heading-60">è¯­ä¹‰ä¿è¯</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4c965ba43df64f469d2a77c7eccae8ce~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771297904&amp;x-signature=9o0Je3HH%2BS7502YiMr%2BRlt5wq%2Bc%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p><strong>æ¨èé…ç½®ï¼š</strong></p>
<p><strong>ç”Ÿäº§ç¯å¢ƒï¼š</strong> ä½¿ç”¨ ExceptionsThrowableSink + Checkpointã€‚</p>
<p><strong>å…è®¸éƒ¨åˆ†ä¸¢å¤±ï¼š</strong> ä½¿ç”¨ UnexceptionableSinkã€‚</p>
<h2 data-id="heading-61">åã€æœ€ä½³å®è·µä¸è°ƒä¼˜</h2>
<h3 data-id="heading-62">ç”Ÿäº§é…ç½®</h3>
<pre><code class="hljs language-ini" lang="ini">// ========== ClickHouse è¿æ¥å‚æ•° ==========
<span class="hljs-attr">clickhouse.sink.target-table</span> = tb_logs_local
<span class="hljs-attr">clickhouse.sink.max-buffer-size</span> =Â <span class="hljs-number">104857600</span>Â  Â  Â  Â Â // æ‰¹æ¬¡å¤§å°
<span class="hljs-attr">clickhouse.sink.table-count</span> =Â <span class="hljs-number">0</span>Â  Â  Â  Â  Â  Â  Â  Â Â // <span class="hljs-number">0</span> è¡¨ç¤ºä¸åˆ†è¡¨
// ========== å†™å…¥æ€§èƒ½å‚æ•° ==========
<span class="hljs-attr">clickhouse.sink.num-writers</span> =Â <span class="hljs-number">10</span>Â  Â  Â  Â  Â  Â  Â  Â // å†™å…¥çº¿ç¨‹æ•°
<span class="hljs-attr">clickhouse.sink.queue-max-capacity</span> =Â <span class="hljs-number">10</span>Â  Â  Â  Â Â // é˜Ÿåˆ—å®¹é‡
<span class="hljs-attr">clickhouse.sink.timeout-sec</span> =Â <span class="hljs-number">30</span>Â  Â  Â  Â  Â  Â  Â  Â // flush è¶…æ—¶
<span class="hljs-attr">clickhouse.sink.retries</span> =Â <span class="hljs-number">10</span>Â  Â  Â  Â  Â  Â  Â  Â  Â  Â // æœ€å¤§é‡è¯•æ¬¡æ•°
<span class="hljs-attr">clickhouse.sink.check.timeout-sec</span> =Â <span class="hljs-number">30</span>Â  Â  Â  Â  Â // å®šæ—¶æ£€æŸ¥é—´éš”
// ========== å¼‚å¸¸å¤„ç†å‚æ•° ==========
<span class="hljs-attr">clickhouse.sink.ignoring-clickhouse-sending-exception-enabled</span> =Â <span class="hljs-literal">false</span>
<span class="hljs-attr">clickhouse.sink.local-address-enabled</span> =Â <span class="hljs-literal">true</span>Â  Â // å¯ç”¨æœ¬åœ°è¡¨å†™å…¥
// ========== ClickHouse é›†ç¾¤é…ç½® ==========
<span class="hljs-attr">clickhouse.access.hosts</span> =Â <span class="hljs-number">192.168</span>.<span class="hljs-number">1.1</span>:<span class="hljs-number">8123</span>,<span class="hljs-number">192.168</span>.<span class="hljs-number">1.2</span>:<span class="hljs-number">8123</span>,<span class="hljs-number">192.168</span>.<span class="hljs-number">1.3</span>:<span class="hljs-number">8123</span>
<span class="hljs-attr">clickhouse.access.user</span> =Â default
<span class="hljs-attr">clickhouse.access.password</span> = ***
<span class="hljs-attr">clickhouse.access.database</span> = dw_xx_xx
<span class="hljs-attr">clickhouse.access.cluster</span> =Â default
// ========== HikariCP è¿æ¥æ± é…ç½® ==========
<span class="hljs-attr">connectionTimeout</span> =Â <span class="hljs-number">30000</span>Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â // è¿æ¥è¶…æ—¶ <span class="hljs-number">30</span>s
<span class="hljs-attr">maximumPoolSize</span> =Â <span class="hljs-number">20</span>Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â // æœ€å¤§è¿æ¥æ•° <span class="hljs-number">20</span>
<span class="hljs-attr">minimumIdle</span> =Â <span class="hljs-number">2</span>Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â // æœ€å°ç©ºé—² <span class="hljs-number">2</span>
<span class="hljs-attr">socket_timeout</span> =Â <span class="hljs-number">180000</span>Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â // Socket è¶…æ—¶ <span class="hljs-number">3</span>mi
</code></pre>
<h2 data-id="heading-63">æ€§èƒ½è°ƒä¼˜</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bbe85a601349453aa2541fe47b0e88e1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771297904&amp;x-signature=3XhrUD4mwBz1c%2FJeYb8fQ5x7Amg%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<h2 data-id="heading-64">æ•…éšœæ’æŸ¥</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e2a917bed37a46ccb9f2a8a196762b93~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771297904&amp;x-signature=WlnooX42uWG5kXf4ycZTBXk4VTY%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<h2 data-id="heading-65">åä¸€ã€æ€»ç»“</h2>
<p>æœ¬æ–‡æ·±å…¥åˆ†æäº† Flink ClickHouse Sink çš„å®ç°æ–¹æ¡ˆï¼Œæ ¸å¿ƒäº®ç‚¹åŒ…æ‹¬ï¼š</p>
<h3 data-id="heading-66">æŠ€æœ¯äº®ç‚¹</h3>
<ul>
<li><strong>è¿æ¥æ± é€‰å‹ï¼š</strong> ä½¿ç”¨ HikariCPï¼Œæ€§èƒ½ä¼˜å¼‚ï¼Œè¿æ¥ç®¡ç†å¯é ã€‚</li>
<li><strong>Future è¶…æ—¶æ§åˆ¶ï¼š</strong> orTimeout(3min) é˜²æ­¢æ°¸ä¹…é˜»å¡ã€‚</li>
<li><strong>æ˜¾å¼èµ„æºç®¡ç†ï¼š</strong> Connection å’Œ PreparedStatement æ˜¾å¼å…³é—­ï¼Œé˜²æ­¢è¿æ¥æ³„æ¼ã€‚</li>
<li><strong>è´Ÿè½½å‡è¡¡ä¼˜åŒ–ï¼š</strong> Shuffle åˆå§‹åŒ– + è½®è¯¢é€‰æ‹©ï¼Œé¿å…çƒ­ç‚¹ã€‚</li>
<li><strong>å¼‚å¸¸å¤„ç†å¢å¼ºï¼š</strong> future.isDone() æ£€æŸ¥ï¼Œé¿å…é‡å¤å®Œæˆã€‚</li>
<li><strong>æœ¬åœ°è¡¨å†™å…¥ï¼š</strong> åŠ¨æ€èŠ‚ç‚¹å‘ç° + æ•…éšœå‰”é™¤ï¼Œå†™å…¥æ€§èƒ½æå‡ã€‚</li>
<li><strong>åˆ†ç‰‡ç­–ç•¥ï¼š</strong> æŒ‰è¡¨ï¼ˆåº”ç”¨ï¼‰ç»´åº¦è·¯ç”±ï¼Œç‹¬ç«‹ç¼“å†²å’Œéš”ç¦»ã€‚</li>
<li><strong>æ”’æ‰¹ä¼˜åŒ–ï¼š</strong> åŒè§¦å‘æœºåˆ¶ï¼ˆå¤§å° + è¶…æ—¶ï¼‰+ éšæœºæŠ–åŠ¨ã€‚</li>
<li><strong>æµé‡æ§åˆ¶ï¼š</strong> æœ‰ç•Œé˜Ÿåˆ— + çº¿ç¨‹æ± ï¼Œå®ç°èƒŒå‹ã€‚</li>
<li><strong>å¥å£®é‡è¯•ï¼š</strong> é€’å½’é‡è¯• + å¼‚å¸¸èŠ‚ç‚¹å‰”é™¤ + æœ€å¤§é‡è¯•é™åˆ¶ã€‚</li>
</ul>
<h3 data-id="heading-67">Checkpoint è¯­ä¹‰</h3>
<ul>
<li><strong>At-Least-Onceï¼š</strong> ExceptionsThrowableSink + Checkpointã€‚</li>
<li><strong>At-Most-Onceï¼š</strong> UnexceptionableSinkã€‚</li>
<li><strong>Exactly-Onceï¼š</strong> éœ€è¦é…åˆ ClickHouse äº‹åŠ¡ï¼ˆæœªå®ç°ï¼‰ã€‚</li>
</ul>
<h3 data-id="heading-68">ç”Ÿäº§å»ºè®®</h3>
<ol>
<li><strong>å¿…é¡»ï¼š</strong> Checkpoint æ—¶ flushï¼Œå¦åˆ™ä¼šä¸¢æ•°æ®ã€‚</li>
<li><strong>æ¨èï¼š</strong> ä½¿ç”¨ HikariCP + æœ¬åœ°è¡¨å†™å…¥ã€‚</li>
<li><strong>æ¨èï¼š</strong> é…ç½®åˆç†çš„è¶…æ—¶ï¼ˆFuture &lt; Socket &lt; Checkpointï¼‰ã€‚</li>
<li><strong>æ¨èï¼š</strong> ç›‘æ§é˜Ÿåˆ—å¤§å°ã€Future å¤±è´¥ç‡ã€é‡è¯•æ¬¡æ•°ã€‚</li>
</ol>
<p>è¯¥æ–¹æ¡ˆå·²åœ¨ç”Ÿäº§ç¯å¢ƒå¤§è§„æ¨¡éªŒè¯ï¼Œèƒ½å¤Ÿç¨³å®šæ”¯æ’‘<strong>ç™¾ä¸‡çº§ TPS</strong> çš„æ—¥å¿—å†™å…¥åœºæ™¯ã€‚</p>
<h2 data-id="heading-69">å¾€æœŸå›é¡¾</h2>
<p>1.æœåŠ¡æ‹†åˆ†ä¹‹æ—…ï¼šæµ‹è¯•è¿‡ç¨‹å…¨æ­ç§˜ï½œå¾—ç‰©æŠ€æœ¯</p>
<p>2.å¤§æ¨¡å‹ç½‘å…³ï¼šå¤§æ¨¡å‹æ—¶ä»£çš„æ™ºèƒ½äº¤é€šæ¢çº½ï½œå¾—ç‰©æŠ€æœ¯</p>
<p>3.ä»â€œäººæ²»â€åˆ°â€œæœºæ²»â€ï¼šå¾—ç‰©ç¦»çº¿æ•°ä»“å‘å¸ƒæµæ°´çº¿è´¨é‡é—¨ç¦å®è·µ</p>
<p>4.AIç¼–ç¨‹å®è·µï¼šä»Claude Codeå®è·µåˆ°å›¢é˜Ÿåä½œçš„ä¼˜åŒ–æ€è€ƒï½œå¾—ç‰©æŠ€æœ¯</p>
<p>5.å…¥é€‰AAAI-PerFMï½œå¾—ç‰©ç¤¾åŒºæ¨èä¹‹åŸºäºå¤§è¯­è¨€æ¨¡å‹çš„æ–°é¢–æ€§æ¨èç®—æ³•</p>
<h2 data-id="heading-70">æ–‡ /è™šç™½</h2>
<p>å…³æ³¨å¾—ç‰©æŠ€æœ¯ï¼Œæ¯å‘¨æ›´æ–°æŠ€æœ¯å¹²è´§</p>
<p>è¦æ˜¯è§‰å¾—æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©çš„è¯ï¼Œæ¬¢è¿è¯„è®ºè½¬å‘ç‚¹èµï½</p>
<p>æœªç»å¾—ç‰©æŠ€æœ¯è®¸å¯ä¸¥ç¦è½¬è½½ï¼Œå¦åˆ™ä¾æ³•è¿½ç©¶æ³•å¾‹è´£ä»»ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å‰ç«¯è·¨åŸŸå…¨æ”»ç•¥ï¼šä» Vite ä»£ç†åˆ° Nginx ç”Ÿäº§ç¯å¢ƒé…ç½®å®æˆ˜]]></title>    <link>https://juejin.cn/post/7604761524976648201</link>    <guid>https://juejin.cn/post/7604761524976648201</guid>    <pubDate>2026-02-10T03:14:52.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604761524976648201" data-draft-id="7604665952321372211" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å‰ç«¯è·¨åŸŸå…¨æ”»ç•¥ï¼šä» Vite ä»£ç†åˆ° Nginx ç”Ÿäº§ç¯å¢ƒé…ç½®å®æˆ˜"/> <meta itemprop="keywords" content="å‰ç«¯,Nginx,é¢è¯•"/> <meta itemprop="datePublished" content="2026-02-10T03:14:52.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å‘ç°ä¸€åªå¤§å‘†ç“œ"/> <meta itemprop="url" content="https://juejin.cn/user/180747382561607"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å‰ç«¯è·¨åŸŸå…¨æ”»ç•¥ï¼šä» Vite ä»£ç†åˆ° Nginx ç”Ÿäº§ç¯å¢ƒé…ç½®å®æˆ˜
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/180747382561607/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å‘ç°ä¸€åªå¤§å‘†ç“œ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T03:14:52.000Z" title="Tue Feb 10 2026 03:14:52 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">å‰è¨€</h3>
<p>åœ¨å‰åç«¯åˆ†ç¦»çš„æ¶æ„ä¸­ï¼Œè·¨åŸŸï¼ˆCORSï¼‰æ˜¯æˆ‘ä»¬è”è°ƒæ¥å£æ—¶é‡åˆ°çš„ç¬¬ä¸€ä¸ªâ€œæ‹¦è·¯è™â€ã€‚æ— è®ºæ˜¯æœ¬åœ°å¼€å‘è¿˜æ˜¯çº¿ä¸Šéƒ¨ç½²ï¼ŒæŒæ¡è·¨åŸŸçš„è§£å†³æ‰‹æ®µæ˜¯å‰ç«¯å¼€å‘è€…çš„åŸºæœ¬åŠŸã€‚æœ¬æ–‡å°†ç»“åˆ Vite å’Œ Nginxï¼Œæ·±åº¦è§£æè·¨åŸŸé—®é¢˜çš„ç»ˆæè§£å†³æ–¹æ¡ˆã€‚</p>
<h2 data-id="heading-1">ä¸€ã€ ä»€ä¹ˆæ˜¯è·¨åŸŸï¼Ÿ</h2>
<p><strong>è·¨åŸŸ</strong>æ˜¯ç”±æµè§ˆå™¨çš„<strong>åŒæºç­–ç•¥ï¼ˆSame-origin policyï¼‰å¼•èµ·çš„ã€‚å½“ä¸€ä¸ªè¯·æ±‚çš„åè®®ã€åŸŸåã€ç«¯å£</strong>ä¸‰è€…ä¸­è‡³å°‘æœ‰ä¸€ä¸ªä¸åŒæ—¶ï¼Œæµè§ˆå™¨å°±ä¼šæ‹¦æˆªè¯¥è¯·æ±‚çš„å“åº”ã€‚</p>
<blockquote>
<p><strong>æ³¨æ„</strong>ï¼šè·¨åŸŸè¯·æ±‚å…¶å®å·²ç»å‘åˆ°äº†æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨ä¹Ÿæ­£å¸¸è¿”å›äº†æ•°æ®ï¼Œåªæ˜¯æµè§ˆå™¨åœ¨æ¥æ”¶å“åº”æ—¶ï¼Œå‘ç°æºä¸åŒ¹é…ï¼Œä¸ºäº†å®‰å…¨å°†å…¶æ‹¦æˆªäº†ã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-2">äºŒã€ å¼€å‘ç¯å¢ƒæ–¹æ¡ˆï¼šVite åå‘ä»£ç†</h2>
<p>åœ¨å¼€å‘é˜¶æ®µï¼Œæˆ‘ä»¬æ— æ³•è¦æ±‚åç«¯é¢‘ç¹æ”¹åŠ¨ CORS é…ç½®ã€‚æ­¤æ—¶ï¼Œåˆ©ç”¨ Vite è‡ªå¸¦çš„ <code>http-proxy</code> æ¨¡å—è¿›è¡Œè½¬å‘æ˜¯æœ€ä¼˜è§£ã€‚</p>
<h3 data-id="heading-3">1. Vite é…ç½®å®æˆ˜</h3>
<p>åœ¨ <code>vite.config.js</code> ä¸­é…ç½® <code>server</code> å¯¹è±¡ï¼Œé€šè¿‡ä»£ç†æœåŠ¡å™¨ç»•è¿‡æµè§ˆå™¨åŒæºç­–ç•¥ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-attr">server</span>: {
    <span class="hljs-attr">port</span>: <span class="hljs-number">3000</span>,
    <span class="hljs-attr">cors</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// å¯ç”¨å¹¶å…è®¸ä»»ä½•æºï¼ˆä¸»è¦ç”¨äºå¼€å‘æœåŠ¡å™¨çš„å“åº”å¤´ï¼‰</span>
    <span class="hljs-attr">open</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// å¯åŠ¨æ—¶è‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨</span>
    
    <span class="hljs-comment">// åå‘ä»£ç†é…ç½®</span>
    <span class="hljs-attr">proxy</span>: {
      <span class="hljs-comment">// åœºæ™¯ Aï¼šä¸ç§»é™¤è·¯å¾„å‰ç¼€</span>
      <span class="hljs-comment">// ä¾‹å¦‚è¯·æ±‚ /aPath/login ä¼šè½¬å‘åˆ° http://33.133.190.116:8100/aPath/login</span>
      <span class="hljs-string">"/aPath"</span>: {
        <span class="hljs-attr">target</span>: <span class="hljs-string">"http://33.133.190.116:8100"</span>, 
        <span class="hljs-attr">changeOrigin</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// å¿…é¡»è®¾ç½®ä¸º trueï¼Œå¦åˆ™åç«¯æ— æ³•è·å–æ­£ç¡®çš„ Host</span>
      },
      
      <span class="hljs-comment">// åœºæ™¯ Bï¼šé‡å†™è·¯å¾„ï¼ˆç§»é™¤å‰ç¼€ï¼‰</span>
      <span class="hljs-comment">// ä¾‹å¦‚è¯·æ±‚ /bPath/list ä¼šè½¬å‘åˆ° http://172.16.7.160:9022/list</span>
      <span class="hljs-string">"/bPath"</span>: {
        <span class="hljs-attr">target</span>: <span class="hljs-string">"http://172.16.7.160:9022"</span>,
        <span class="hljs-attr">changeOrigin</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">rewrite</span>: <span class="hljs-function">(<span class="hljs-params">path</span>) =&gt;</span> path.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/^/</span>bPath/, <span class="hljs-string">""</span>),
      },
    },
  },
})
</code></pre>
<hr/>
<h2 data-id="heading-4">ä¸‰ã€ ç”Ÿäº§ç¯å¢ƒæ–¹æ¡ˆï¼šNginx éƒ¨ç½²é…ç½®</h2>
<p>é¡¹ç›®ä¸Šçº¿åï¼ŒVite çš„ä»£ç†å°±ä¸èµ·ä½œç”¨äº†ã€‚æ­¤æ—¶æˆ‘ä»¬éœ€è¦åœ¨ Nginx ä¸­é…ç½®åå‘ä»£ç†ï¼Œè®©æ‰€æœ‰çš„è¯·æ±‚ç”± Nginx ç»Ÿä¸€åˆ†å‘ã€‚</p>
<h3 data-id="heading-5">1. Nginx æ ¸å¿ƒé…ç½®æ–‡ä»¶è§£æ (<code>nginx.conf</code>)</h3>
<pre><code class="hljs language-Nginx" lang="Nginx"># åŸºç¡€å…¨å±€é…ç½®
user nginx;
worker_processes auto; # è‡ªåŠ¨é€‚é… CPU æ ¸å¿ƒæ•°
error_log /var/log/nginx/error.log notice;
pid /run/nginx.pid;

events {
    worker_connections 1024;
    use epoll; # ä½¿ç”¨é«˜æ€§èƒ½äº‹ä»¶é©±åŠ¨æ¨¡å‹
}

http {
    include /etc/nginx/mime.types;
    default_type application/octet-stream;
    client_max_body_size 300m; # æ”¯æŒå¤§æ–‡ä»¶ä¸Šä¼ 

    # å¼€å¯ Gzip å‹ç¼©ï¼Œä¼˜åŒ–ä¼ è¾“æ€§èƒ½
    gzip on;
    gzip_comp_level 5;
    gzip_types text/plain text/css application/json application/javascript;

    server {
        listen 80 default_server;
        server_name _; 

        # é™æ€èµ„æºå¤„ç†
        location / {
            root /usr/share/nginx/html;
            index index.html index.htm;
            try_files $uri $uri/ /index.html; # é€‚é…å•é¡µé¢åº”ç”¨è·¯ç”±
        }

        # ä»£ç†æ–¹æ¡ˆ Aï¼šå¸¦å‰ç¼€è½¬å‘
        # è¯·æ±‚ï¼š/aPath/api -&gt; http://33.133.190.116:8100/aPath/api
        location ^~/aPath/ {
            proxy_pass http://33.133.190.116:8100/aPath/;
            proxy_set_header X-Forwarded-For $remote_addr;
            proxy_read_timeout 3600s;
            proxy_buffering off; # AI å¯¹è¯åœºæ™¯éœ€å…³é—­ç¼“å†²
            chunked_transfer_encoding on;
        }

        # ä»£ç†æ–¹æ¡ˆ Bï¼šæŠ¹é™¤å‰ç¼€è½¬å‘
        # è¯·æ±‚ï¼š/bPath/api -&gt; http://172.16.7.160:9022/api
        location ^~/bPath/ {
            proxy_pass http://172.16.7.160:9022/; 
            proxy_set_header X-Forwarded-For $remote_addr;
        }

        # ç¦æ­¢è®¿é—® .ht æ–‡ä»¶
        location ~ /.ht {
            deny all;
        }
    }
}
</code></pre>
<hr/>
<h2 data-id="heading-6">å››ã€ è¡¥å……</h2>
<h3 data-id="heading-7">1. åç«¯ CORS é…ç½®ï¼ˆç®€å•è¯·æ±‚ä¸é¢„æ£€è¯·æ±‚ï¼‰</h3>
<p>åç«¯é€šè¿‡åœ¨å“åº”å¤´ä¸­æ·»åŠ ç‰¹å®šå­—æ®µï¼Œå‘Šè¯‰æµè§ˆå™¨å…è®¸è¯¥æºçš„è®¿é—®ï¼š</p>
<ul>
<li><code>Access-Control-Allow-Origin: *</code></li>
<li><code>Access-Control-Allow-Methods: GET, POST, PUT, DELETE</code></li>
</ul>
<h3 data-id="heading-8">2. ä¸ºä»€ä¹ˆ Nginx ä»£ç†èƒ½è§£å†³è·¨åŸŸï¼Ÿ</h3>
<p>å› ä¸º <strong>â€œè·¨åŸŸâ€ä»…å­˜åœ¨äºæµè§ˆå™¨ç«¯</strong>ã€‚ å½“ä½ çš„å‰ç«¯ä»£ç è¯·æ±‚ Nginx æ—¶ï¼Œå®ƒä»¬åŒæºï¼›Nginx ä½œä¸ºä¸­è½¬ç«™å†å»è¯·æ±‚åç«¯æ¥å£ï¼Œè¿™æ˜¯ <strong>æœåŠ¡å™¨å¯¹æœåŠ¡å™¨çš„é€šä¿¡</strong>ï¼Œä¸å—åŒæºç­–ç•¥é™åˆ¶ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å¤§é“ä¸è¯¥å¦‚æ­¤ä¹‹å°ï¼šä»å¾®å†…æ ¸çš„è§’åº¦ä»‹ç»å‰ç«¯ç›‘æ§]]></title>    <link>https://juejin.cn/post/7604775190212018186</link>    <guid>https://juejin.cn/post/7604775190212018186</guid>    <pubDate>2026-02-10T03:33:54.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604775190212018186" data-draft-id="7604786493639163931" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å¤§é“ä¸è¯¥å¦‚æ­¤ä¹‹å°ï¼šä»å¾®å†…æ ¸çš„è§’åº¦ä»‹ç»å‰ç«¯ç›‘æ§"/> <meta itemprop="keywords" content="å‰ç«¯,æ¶æ„,NPM"/> <meta itemprop="datePublished" content="2026-02-10T03:33:54.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ•²ä»£ç çš„å½­äºæ™"/> <meta itemprop="url" content="https://juejin.cn/user/553809592465277"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å¤§é“ä¸è¯¥å¦‚æ­¤ä¹‹å°ï¼šä»å¾®å†…æ ¸çš„è§’åº¦ä»‹ç»å‰ç«¯ç›‘æ§
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/553809592465277/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ•²ä»£ç çš„å½­äºæ™
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T03:33:54.000Z" title="Tue Feb 10 2026 03:33:54 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    15
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å‰è¨€</h2>
<p>å‰ç«¯ç›‘æ§ä¸€ç›´æ˜¯ä¿éšœ Web åº”ç”¨ç¨³å®šæ€§å’Œç”¨æˆ·ä½“éªŒçš„é‡è¦åŸºç¡€è®¾æ–½ã€‚éšç€åº”ç”¨å¤æ‚åº¦çš„æå‡ï¼Œç›‘æ§ç³»ç»Ÿçš„éœ€æ±‚ä¹Ÿåœ¨ä¸æ–­è†¨èƒ€ï¼šæˆ‘ä»¬è¦æ•è· JavaScript é”™è¯¯ã€ç›‘æ§ HTTP è¯·æ±‚ã€è¿½è¸ªç”¨æˆ·è¡Œä¸ºã€ç”šè‡³è®°å½•æ€§èƒ½æŒ‡æ ‡ã€‚å¦‚æœæŠŠæ‰€æœ‰çš„ç›‘æ§é€»è¾‘éƒ½å†™åœ¨ä¸€ä¸ªåºå¤§çš„ SDK é‡Œï¼Œä¸ä»…ä»£ç éš¾ä»¥ç»´æŠ¤ï¼Œè¿˜ä¼šå› ä¸ºä½“ç§¯è¿‡å¤§å½±å“é¡µé¢æ€§èƒ½ã€‚</p>
<p>æœ¬æ–‡å°†ç»“åˆæˆ‘è‡ªå·±å†™çš„ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fcwjbjy%2Fcwj_monitoring" target="_blank" title="https://github.com/cwjbjy/cwj_monitoring" ref="nofollow noopener noreferrer">cwj_monitoring</a> è¿™ä¸ªå¼€æºé¡¹ç›®çš„æºç ï¼Œä»‹ç»å¦‚ä½•åˆ©ç”¨ <strong>å¾®å†…æ ¸æ¶æ„ï¼ˆMicro-kernel Architectureï¼‰</strong> æ¥è®¾è®¡ä¸€ä¸ªå¯æ‰©å±•ã€è½»é‡çº§çš„å‰ç«¯ç›‘æ§ SDKã€‚å‰ç«¯ç›‘æ§åŒ…çš„ä½¿ç”¨æ–¹å¼ï¼Œå‚è€ƒï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Fcwj_monitoring" target="_blank" title="https://www.npmjs.com/package/cwj_monitoring" ref="nofollow noopener noreferrer">www.npmjs.com/package/cwjâ€¦</a></p>
<h3 data-id="heading-1">ä¸€ã€å‰ç½®çŸ¥è¯†ï¼šå¾®å†…æ ¸æ¶æ„</h3>
<p>åœ¨æ·±å…¥ä»£ç ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥èŠèŠå¾®å†…æ ¸æ¶æ„ï¼ˆMicrokernel Architectureï¼‰ï¼Œåˆç§°ä¸ºâ€œæ’ä»¶æ¶æ„â€ã€‚</p>
<h4 data-id="heading-2">1. æ ¸å¿ƒæ¦‚å¿µ</h4>
<p>å¾®å†…æ ¸æ¶æ„ä¸»è¦ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼š<strong>Coreï¼ˆå†…æ ¸ï¼‰</strong> + <strong>Pluginï¼ˆæ’ä»¶ï¼‰</strong>ã€‚</p>
<ul>
<li><strong>Core (å†…æ ¸)</strong>ï¼šä¸»è¦è´Ÿè´£åŸºç¡€è®¾æ–½å»ºè®¾ï¼ˆå¦‚ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€åŸºç¡€é…ç½®ï¼‰ä»¥åŠæ’ä»¶çš„è°ƒåº¦ã€‚å®ƒåº”è¯¥ä¿æŒæœ€ç²¾ç®€ï¼Œåªç»´æŒç³»ç»Ÿè¿è¡Œçš„æœ€å°åŠŸèƒ½é›†ã€‚</li>
<li><strong>Plugin (æ’ä»¶)</strong>ï¼šç‹¬ç«‹çš„åŠŸèƒ½æ¨¡å—ï¼Œç”¨æ¥ä¸°å¯Œå’ŒåŠ å¼ºå†…æ ¸çš„èƒ½åŠ›ã€‚</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ee7636e1f7a4488aac69365e7b286873~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pWy5Luj56CB55qE5b2t5LqO5pmP:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771300894&amp;x-signature=qqhYqT7cY66CeNDM2hcrocT4s6Q%3D" alt="1770696057167.png" loading="lazy"/></p>
<p>è¿™ç§æ¶æ„åœ¨å‰ç«¯é¢†åŸŸéå¸¸å¸¸è§ï¼Œå…¸å‹çš„ä¾‹å­å¦‚ Webpackã€Babelã€PostCSS å’Œ ESLintã€‚å®ƒä»¬éƒ½éœ€è¦åº”å¯¹å¤æ‚çš„å®šåˆ¶éœ€æ±‚ï¼Œåªæœ‰å¾®å†…æ ¸æ¶æ„æ‰èƒ½ä¿è¯ç³»ç»Ÿçš„çµæ´»æ€§å’Œå¯æ‰©å±•æ€§ã€‚</p>
<h4 data-id="heading-3">2. è®¾è®¡æ€æƒ³</h4>
<p>å¾®å†…æ ¸æ¶æ„èƒŒåè•´å«ç€å‡ ä¸ªé‡è¦çš„è½¯ä»¶è®¾è®¡åŸåˆ™ï¼š</p>
<ul>
<li><strong>å•ä¸€èŒè´£åŸåˆ™ (Single Responsibility)</strong>ï¼šæ¯ä¸ªæ’ä»¶ç›¸äº’ç‹¬ç«‹ï¼Œåªè´Ÿè´£å…¶å¯¹åº”çš„ç‰¹å®šç›‘æ§åŠŸèƒ½ï¼ˆå¦‚åªè´Ÿè´£æ•è· Promise é”™è¯¯ï¼‰ï¼Œä¾¿äºå¼€å‘å’Œæµ‹è¯•ã€‚</li>
<li><strong>å¼€æ”¾å°é—­åŸåˆ™ (Open/Closed)</strong>ï¼šæ‰©å±•æ–°åŠŸèƒ½ï¼ˆå¦‚æ–°å¢ WebSocket ç›‘æ§ï¼‰æ—¶ï¼Œä¸éœ€è¦ä¿®æ”¹å†…æ ¸è€ä»£ç ï¼Œåªéœ€å¼€å‘æ–°æ’ä»¶å³å¯ã€‚</li>
<li><strong>æ§åˆ¶åè½¬ (Inversion of Control)</strong>ï¼šå†…æ ¸é€šè¿‡ä¾èµ–æ³¨å…¥ï¼ˆDependency Injectionï¼‰çš„æ–¹å¼å°†ä¸Šä¸‹æ–‡ï¼ˆContextï¼‰ä¼ é€’ç»™æ’ä»¶ï¼Œè€Œä¸æ˜¯è®©æ’ä»¶å»å®ä¾‹åŒ–å†…æ ¸ã€‚</li>
<li><strong>ç­–ç•¥æ¨¡å¼ (Strategy Pattern)</strong>ï¼šä¸åŒçš„æ’ä»¶é€šè¿‡ç»Ÿä¸€çš„æ¥å£æ¥å…¥ç³»ç»Ÿï¼Œå†…æ ¸åªéœ€è¦åƒéå†åˆ—è¡¨ä¸€æ ·å»æ‰§è¡Œå®ƒä»¬ï¼Œè€Œä¸éœ€è¦å…³å¿ƒå…·ä½“å®ç°ã€‚</li>
</ul>
<h3 data-id="heading-4">äºŒã€æ¶æ„å®ç°ï¼šCore ä¸ Plugin</h3>
<h4 data-id="heading-5">1. æ ¸å¿ƒç³»ç»Ÿ (The Core)</h4>
<p>Core çš„ä¸¤ä¸ªä¸»è¦ç”¨é€”æ˜¯ï¼šå®ç°åŸºç¡€åŠŸèƒ½å’Œç®¡ç†æ’ä»¶ã€‚</p>
<p>åœ¨ <code>src/core/index.ts</code> ä¸­ï¼Œ<code>Core</code> ç±»æ‰®æ¼”äº†å†…æ ¸çš„è§’è‰²ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// src/core/index.ts</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Core</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">EventTrack</span> {
  <span class="hljs-keyword">private</span> <span class="hljs-attr">pluginMap</span>: <span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-title class_">IPlugin</span>&gt; = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();

  <span class="hljs-comment">// 1. æ’ä»¶æ³¨å†Œ (Registry)</span>
  <span class="hljs-title function_">use</span>(<span class="hljs-attr">plugin</span>: <span class="hljs-title class_">IPlugin</span>): <span class="hljs-title class_">Core</span> {
    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">pluginMap</span>.<span class="hljs-title function_">has</span>(plugin.<span class="hljs-property">name</span>)) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">pluginMap</span>.<span class="hljs-title function_">set</span>(plugin.<span class="hljs-property">name</span>, plugin);
    }
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>; <span class="hljs-comment">// æ”¯æŒé“¾å¼è°ƒç”¨ï¼Œå¦‚ core.use(plugin1).use(plugin2)</span>
  }

  <span class="hljs-comment">// 2. æ’ä»¶è°ƒåº¦ (Scheduling)</span>
  <span class="hljs-title function_">run</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// åˆ›å»ºä¸Šä¸‹æ–‡ï¼Œæ³¨å…¥æ ¸å¿ƒèƒ½åŠ›</span>
    <span class="hljs-keyword">const</span> context = {
      <span class="hljs-attr">emit</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">emit</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>),
      <span class="hljs-attr">url</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">options</span>.<span class="hljs-property">url</span>,
    };

    <span class="hljs-comment">// ä¾æ¬¡åˆå§‹åŒ–æ’ä»¶ (é¡ºåºæ‰§è¡Œ)</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">pluginMap</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">plugin</span>) =&gt;</span> {
      plugin.<span class="hljs-title function_">install</span>(context);
    });

    <span class="hljs-comment">// æŒ‚è½½å…¨å±€å˜é‡</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">mount</span>();
  }

  <span class="hljs-comment">// 3. åœæ­¢ç³»ç»Ÿ</span>
  <span class="hljs-title function_">stop</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">pluginMap</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">plugin</span>) =&gt;</span> {
      plugin.<span class="hljs-property">uninstall</span>?.();
    });
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">pluginMap</span>.<span class="hljs-title function_">clear</span>();
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">unmount</span>();
  }
}
</code></pre>
<p>è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨äº† <code>Map</code> æ¥å­˜å‚¨æ’ä»¶ï¼Œæ–¹ä¾¿å»é‡ï¼ˆå…·åæ’ä»¶ï¼‰ã€‚<code>run</code> æ–¹æ³•å±•ç¤ºäº†ç®€å•çš„<strong>ç®¡é“å¼</strong>è°ƒåº¦ï¼šä¾æ¬¡éå†å¹¶æ‰§è¡Œæ’ä»¶çš„ <code>install</code> æ–¹æ³•ã€‚</p>
<h4 data-id="heading-6">2. é€šä¿¡æœºåˆ¶ï¼šæ§åˆ¶åè½¬</h4>
<p>æ’ä»¶å’Œå†…æ ¸å¦‚ä½•é€šä¿¡ï¼Ÿæˆ‘ä»¬é‡‡ç”¨äº†<strong>ä¾èµ–æ³¨å…¥</strong>çš„æ–¹å¼ã€‚</p>
<p>åœ¨ <code>src/plugin/definePlugin.ts</code> ä¸­å®šä¹‰äº†æ ‡å‡†æ¥å£ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// src/plugin/definePlugin.ts</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">PluginContext</span> {
  <span class="hljs-comment">/** å‘é€äº‹ä»¶çš„èƒ½åŠ› */</span>
  <span class="hljs-attr">emit</span>: <span class="hljs-function">(<span class="hljs-params"><span class="hljs-keyword">type</span>: <span class="hljs-built_in">string</span>, data: <span class="hljs-built_in">any</span></span>) =&gt;</span> <span class="hljs-built_in">void</span>;
  <span class="hljs-comment">/** ç›‘æ§ä¸ŠæŠ¥åœ°å€ */</span>
  <span class="hljs-attr">url</span>: <span class="hljs-built_in">string</span>;
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">IPlugin</span> {
  <span class="hljs-keyword">readonly</span> <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-comment">/**
   * æ§åˆ¶åè½¬ï¼šCore åœ¨è°ƒç”¨ install æ—¶ï¼Œå°† context (è‡ªèº«èƒ½åŠ›çš„æŠ•å½±) ä¼ ç»™æ’ä»¶
   */</span>
  <span class="hljs-title function_">install</span>(<span class="hljs-attr">context</span>: <span class="hljs-title class_">PluginContext</span>): <span class="hljs-built_in">void</span>;
  uninstall?(): <span class="hljs-built_in">void</span>;
}
</code></pre>
<p>é€šè¿‡è¿™ç§è®¾è®¡ï¼Œæ’ä»¶ä¸éœ€è¦å…³å¿ƒæ•°æ®é€šè¿‡ä»€ä¹ˆæ–¹å¼ï¼ˆXHR/Beaconï¼‰å‘é€ï¼Œä¹Ÿä¸éœ€è¦å…³å¿ƒ <code>Core</code> çš„å…·ä½“å®ç°ç»†èŠ‚ã€‚å®ƒåªéœ€è¦æ‹¿åˆ° <code>context.emit</code>ï¼Œåƒè°ƒç”¨ API ä¸€æ ·ä¸ŠæŠ¥æ•°æ®å³å¯ã€‚</p>
<h4 data-id="heading-7">3. å®æˆ˜æ¡ˆä¾‹ï¼šErrorPlugin</h4>
<p>è®©æˆ‘ä»¬çœ‹çœ‹ <code>ErrorPlugin</code> å¦‚ä½•åˆ©ç”¨è¿™ä¸ªæ¶æ„å·¥ä½œã€‚å®ƒçš„èŒè´£æ˜¯æ•è·é”™è¯¯ï¼Œå¹¶é€šè¿‡æ³¨å…¥çš„ä¸Šä¸‹æ–‡ä¸ŠæŠ¥ã€‚</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// src/plugin/error.ts</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title class_">ErrorPlugin</span> = (<span class="hljs-attr">options</span>: <span class="hljs-title class_">ErrorOptions</span> = {}): <span class="hljs-function"><span class="hljs-params">IPlugin</span> =&gt;</span> {
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">name</span>: <span class="hljs-string">"error"</span>,
    <span class="hljs-attr">install</span>: <span class="hljs-function">(<span class="hljs-params">context: PluginContext</span>) =&gt;</span> {
      <span class="hljs-comment">// 1. å®ç°ä¸šåŠ¡é€»è¾‘ï¼šç›‘å¬å…¨å±€ JS é”™è¯¯</span>
      <span class="hljs-keyword">const</span> <span class="hljs-title function_">errorHandler</span> = (<span class="hljs-params">e: ErrorEvent</span>) =&gt; {
        <span class="hljs-comment">// å®šä¹‰å¤„ç†å‡½æ•°</span>
        <span class="hljs-keyword">const</span> errorData = {
          <span class="hljs-attr">type</span>: <span class="hljs-string">"js"</span>,
          <span class="hljs-attr">message</span>: e.<span class="hljs-property">message</span>,
          <span class="hljs-comment">// ... å…¶ä»–é”™è¯¯ä¿¡æ¯æå–</span>
        };
        <span class="hljs-comment">// 2. ä½¿ç”¨æ³¨å…¥çš„èƒ½åŠ›ï¼šé€šè¿‡ emit ä¸ŠæŠ¥ï¼Œä¸å…³å¿ƒåº•å±‚ä¼ è¾“</span>
        context.<span class="hljs-title function_">emit</span>(<span class="hljs-string">"error"</span>, errorData);
      };
      <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">"error"</span>, errorHandler, <span class="hljs-literal">true</span>);

      <span class="hljs-comment">// ç›‘å¬ Promise æœªæ•è·å¼‚å¸¸</span>
      <span class="hljs-keyword">const</span> <span class="hljs-title function_">rejectionHandler</span> = (<span class="hljs-params">e: PromiseRejectionEvent</span>) =&gt; {
        <span class="hljs-comment">// å®šä¹‰å¤„ç†å‡½æ•°</span>
        <span class="hljs-comment">// ... å¤„ç†é€»è¾‘</span>
        context.<span class="hljs-title function_">emit</span>(<span class="hljs-string">"error"</span>, { <span class="hljs-attr">type</span>: <span class="hljs-string">"promise"</span>, <span class="hljs-attr">reason</span>: e.<span class="hljs-property">reason</span> });
      };
      <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">"unhandledrejection"</span>, rejectionHandler, <span class="hljs-literal">true</span>);
    },
    <span class="hljs-attr">uninstall</span>: <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-comment">// æ¸…ç†ç›‘å¬å™¨ï¼Œé˜²æ­¢å†…å­˜æ³„æ¼</span>
      <span class="hljs-comment">// ...</span>
    },
  };
};
</code></pre>
<h3 data-id="heading-8">ä¸‰ã€é‡ç‚¹è®¾è®¡è€ƒé‡</h3>
<p>åœ¨è®¾è®¡è¿™æ ·ä¸€ä¸ªç³»ç»Ÿæ—¶ï¼Œé™¤äº†åŸºæœ¬åŠŸèƒ½ï¼Œè¿˜æœ‰å‡ ä¸ªå…³é”®ç‚¹éœ€è¦è€ƒè™‘ï¼š</p>
<ol>
<li>
<p><strong>å®‰å…¨æ€§ä¸éš”ç¦»</strong>ï¼š
ç”±äº JS è¯­è¨€ç‰¹æ€§ï¼Œå¾ˆéš¾åšåˆ°å®Œå…¨çš„æ²™ç®±éš”ç¦»ã€‚ä½†åœ¨è®¾è®¡ä¸Šï¼Œæˆ‘ä»¬é€šè¿‡ <code>PluginContext</code> é™åˆ¶äº†æ’ä»¶èƒ½è®¿é—®çš„ API èŒƒå›´ï¼ˆåªæš´éœ² <code>emit</code> å’Œ <code>url</code>ï¼‰ï¼Œè€Œä¸æ˜¯æŠŠæ•´ä¸ª <code>Core</code> å®ä¾‹æš´éœ²ç»™æ’ä»¶ï¼Œè¿™ä½“ç°äº†æœ€å°æƒé™åŸåˆ™ã€‚</p>
</li>
<li>
<p><strong>ç¨³å®šæ€§</strong>ï¼š
è™½ç„¶ç¤ºä¾‹ä»£ç ä¸­ç›´æ¥è¿›è¡Œäº† <code>forEach</code> è°ƒç”¨ï¼Œä½†åœ¨ç”Ÿäº§ç¯å¢ƒçš„å†…æ ¸è®¾è®¡ä¸­ï¼Œé€šå¸¸éœ€è¦åœ¨æ‰§è¡Œæ’ä»¶ä»£ç æ—¶åŒ…è£¹ <code>try-catch</code>ã€‚è¿™æ ·ä¸€æ—¦æŸä¸ªæ’ä»¶å†…éƒ¨æŠ¥é”™ï¼ˆæ¯”å¦‚ <code>addEventListener</code> å¤±è´¥ï¼‰ï¼Œä¸ä¼šå¯¼è‡´æ•´ä¸ªç›‘æ§ SDK å´©æºƒï¼Œå½±å“åˆ°ä¸šåŠ¡ä¸»æµç¨‹ã€‚</p>
</li>
<li>
<p><strong>æ’ä»¶ç®¡ç†ç­–ç•¥</strong>ï¼š
<code>cwj_monitoring</code> ä½¿ç”¨ <code>Map</code> æ¥ç®¡ç†æ’ä»¶ï¼Œè¿™æ„å‘³ç€åŒä¸€ä¸ªåç§°çš„æ’ä»¶åªä¼šè¢«å®‰è£…ä¸€æ¬¡ï¼Œé˜²æ­¢é‡å¤æ³¨å†Œã€‚è¿™æ˜¯ä¸€ç§ç®€å•çš„å†²çªè§£å†³ç­–ç•¥ã€‚</p>
</li>
</ol>
<h3 data-id="heading-9">ç»„è£…ä¸ä½¿ç”¨</h3>
<p>æœ€ç»ˆï¼Œç”¨æˆ·åœ¨ä½¿ç”¨ SDK æ—¶ï¼Œå°±åƒæ­ç§¯æœ¨ä¸€æ ·ç®€å•ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { createMonitor, <span class="hljs-title class_">ErrorPlugin</span>, <span class="hljs-title class_">PerformancePlugin</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"cwj_monitoring"</span>;

<span class="hljs-keyword">const</span> monitor = <span class="hljs-title function_">createMonitor</span>({
  <span class="hljs-attr">url</span>: <span class="hljs-string">"https://monitor.example.com/report"</span>,
})
  .<span class="hljs-title function_">use</span>(<span class="hljs-title class_">ErrorPlugin</span>()) <span class="hljs-comment">// æ’ä¸Šé”™è¯¯ç›‘æ§æ¨¡å—</span>
  .<span class="hljs-title function_">use</span>(<span class="hljs-title class_">PerformancePlugin</span>()) <span class="hljs-comment">// æ’ä¸Šæ€§èƒ½ç›‘æ§æ¨¡å—</span>
  .<span class="hljs-title function_">run</span>(); <span class="hljs-comment">// å¯åŠ¨ï¼</span>
</code></pre>
<p>è¿™ç§ä½¿ç”¨æ–¹å¼éå¸¸ç¬¦åˆç°ä»£å‰ç«¯å¼€å‘çš„ç›´è§‰ï¼ŒåŒæ—¶ä¹Ÿç»™äºˆäº†å¼€å‘è€…æå¤§çš„çµæ´»æ€§ã€‚</p>
<h3 data-id="heading-10">å››ã€æ€»ç»“</h3>
<p>é€šè¿‡ <code>cwj_monitoring</code>ï¼Œæˆ‘ä»¬å®è·µäº†ä¸€ä¸ªæ ‡å‡†çš„å‰ç«¯å¾®å†…æ ¸æ¶æ„ï¼š</p>
<ul>
<li><strong>Core</strong>ï¼šç²¾ç®€çš„è°ƒåº¦å™¨ï¼Œè´Ÿè´£ç”Ÿå‘½å‘¨æœŸå’ŒåŸºç¡€è®¾æ–½ã€‚</li>
<li><strong>Plugin</strong>ï¼šç‹¬ç«‹çš„ä¸šåŠ¡å•å…ƒï¼Œé€šè¿‡ <code>install(context)</code> æ¥å…¥ç³»ç»Ÿã€‚</li>
</ul>
<p>è¿™ç§æ¶æ„è®©å‰ç«¯ç›‘æ§ SDK å…·å¤‡äº†æå¼ºçš„ç”Ÿå‘½åŠ›ã€‚é’ˆå¯¹ä¸åŒä¸šåŠ¡åœºæ™¯ï¼ˆå¦‚ä¸éœ€è¦å½•å±æ—¶å°±ä¸å¼•å…¥å½•å±æ’ä»¶ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥çµæ´»ç»„åˆä¸åŒçš„ Pluginï¼Œå®ç°æŒ‰éœ€æ„å»ºå’ŒåŠ è½½ã€‚</p>
<p>æœ€åï¼šå¦‚æœæ–‡ç« æœ‰ä¸å¯¹æˆ–è€…æœ‰è¡¥å……çš„åœ°æ–¹ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºç•™è¨€ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å‘Šåˆ«å•è°ƒé…éŸ³ï¼VibeVoice+cpolarï¼šå¤šè§’è‰²è¯­éŸ³ç”Ÿæˆéšæ—¶éšåœ°æåˆ›ä½œ]]></title>    <link>https://juejin.cn/post/7604761524976762889</link>    <guid>https://juejin.cn/post/7604761524976762889</guid>    <pubDate>2026-02-10T03:35:04.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604761524976762889" data-draft-id="7604784281956646950" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å‘Šåˆ«å•è°ƒé…éŸ³ï¼VibeVoice+cpolarï¼šå¤šè§’è‰²è¯­éŸ³ç”Ÿæˆéšæ—¶éšåœ°æåˆ›ä½œ"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2026-02-10T03:35:04.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ˜é‡‘è€…é˜¿è±ª"/> <meta itemprop="url" content="https://juejin.cn/user/4073055974333608"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å‘Šåˆ«å•è°ƒé…éŸ³ï¼VibeVoice+cpolarï¼šå¤šè§’è‰²è¯­éŸ³ç”Ÿæˆéšæ—¶éšåœ°æåˆ›ä½œ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4073055974333608/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ˜é‡‘è€…é˜¿è±ª
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T03:35:04.000Z" title="Tue Feb 10 2026 03:35:04 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»17åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d71a2470f40040c4a40424c13bd099eb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6ICF6Zi_6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771299521&amp;x-signature=i4UOg7x47ESSoooNRHsMno7dj9E%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<p>VibeVoice ä½œä¸ºå¾®è½¯å¼€å‘çš„æ–‡æœ¬è½¬è¯­éŸ³å·¥å…·ï¼Œæ ¸å¿ƒä¼˜åŠ¿åœ¨äºæ”¯æŒ 4 ä¸ªä¸åŒè§’è‰²çš„è¯­éŸ³ç”Ÿæˆï¼Œæ¯ä¸ªè§’è‰²æœ‰ä¸“å±å£°çº¿ï¼Œè¿˜èƒ½æ ¹æ®æ–‡æœ¬å†…å®¹åŒ¹é…å–œæ€’å“€ä¹çš„æƒ…ç»ªï¼Œ1.5B æ¨¡å‹å¯ç”Ÿæˆ 90 åˆ†é’Ÿè¿ç»­è¯­éŸ³ï¼Œé€‚é…å‰§æœ¬æ€é…éŸ³ã€è‡ªåª’ä½“éŸ³é¢‘åˆ›ä½œã€ä¼ä¸šåŸ¹è®­è¯¾ä»¶åˆ¶ä½œç­‰åœºæ™¯ï¼Œå°¤å…¶é€‚åˆå‰§æœ¬æ€å·¥ä½œå®¤ã€è‡ªåª’ä½“åˆ›ä½œè€…ã€ä¼ä¸šåŸ¹è®­äººå‘˜è¿™ç±»éœ€è¦å¤šè§’è‰²ã€é•¿æ—¶é•¿è¯­éŸ³çš„äººç¾¤ï¼Œæ­é… ComfyUI å¯è§†åŒ–æ“ä½œåï¼Œæ— éœ€ç¼–ç¨‹åŸºç¡€ä¹Ÿèƒ½è°ƒæ•´å‚æ•°ï¼Œé™ä½äº†ä¸“ä¸šé…éŸ³çš„é—¨æ§›ã€‚</p>
<p>ä½¿ç”¨ VibeVoice æ—¶å‘ç°ï¼Œæƒ³è¦ç”Ÿæˆè´´åˆè§’è‰²çš„è¯­éŸ³ï¼Œå‚è€ƒéŸ³é¢‘çš„é€‰æ‹©å¾ˆå…³é”®ï¼Œ30 ç§’çš„æ¸…æ™°å‚è€ƒéŸ³é¢‘èƒ½è®©å…‹éš†çš„å£°éŸ³æ›´è´´è¿‘åŸå‹ï¼Œå¦å¤–ç¡¬ä»¶æ–¹é¢å»ºè®®æ­é… 8G ä»¥ä¸Šæ˜¾å­˜çš„ NVIDIA æ˜¾å¡ï¼Œå¦åˆ™ 7B æ¨¡å‹å®¹æ˜“å‡ºç°æ˜¾å­˜ä¸è¶³çš„æƒ…å†µï¼Œæ—¥å¸¸ä½¿ç”¨ä¸­å…ˆæµ‹è¯•çŸ­æ–‡æœ¬ç”Ÿæˆæ•ˆæœï¼Œå†æ‰©å±•åˆ°é•¿ç¯‡å†…å®¹ä¼šæ›´ç¨³å¦¥ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e55cbe6b9aff4581bc73bbff4e23d8f8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6ICF6Zi_6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771299521&amp;x-signature=HjVxfi4ovQQJVsN2FPWwWPvW5rI%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<p>ä¸è¿‡ VibeVoice+ComfyUI çš„ç»„åˆé»˜è®¤åªèƒ½åœ¨å±€åŸŸç½‘å†…ä½¿ç”¨ï¼Œæ¯”å¦‚å‰§æœ¬æ€å·¥ä½œå®¤çš„åˆ›ä½œè€…åœ¨å®¶è°ƒå¥½çš„é…éŸ³å‚æ•°ï¼Œå‡ºé—¨åæƒ³åœ¨æ‰‹æœºä¸Šä¿®æ”¹å°è¯å°±åšä¸åˆ°ï¼›å›¢é˜Ÿåä½œæ—¶ï¼Œç¼–å‰§æ”¹äº†å‰§æœ¬ï¼Œé…éŸ³å¸ˆåªèƒ½ç­‰æ–‡ä»¶ä¼ è¾“å®Œæˆæ‰èƒ½è¯•å¬æ•ˆæœï¼Œè·¨è®¾å¤‡æ“ä½œä¹Ÿå—é™äºå±€åŸŸç½‘ï¼Œæ¯”å¦‚ç”µè„‘ä¸Šç”Ÿæˆä¸€åŠçš„éŸ³é¢‘ï¼Œå¹³æ¿æ— æ³•æ¥ç»­ç¼–è¾‘ï¼Œå¤§å¤§å½±å“äº†åˆ›ä½œæ•ˆç‡ã€‚</p>
<p>è€Œå°† VibeVoice+ComfyUI ä¸ cpolar å†…ç½‘ç©¿é€ç»“åˆåï¼Œè¿™äº›é—®é¢˜éƒ½èƒ½è§£å†³ï¼šé€šè¿‡ cpolar ç”Ÿæˆçš„å…¬ç½‘åœ°å€ï¼Œæ— è®ºåœ¨å®¶ã€åœ°é“è¿˜æ˜¯å¤–å‡ºåŠå…¬ï¼Œéƒ½èƒ½éšæ—¶è®¿é—®è¯­éŸ³ç”Ÿæˆé¡¹ç›®ï¼›å›¢é˜Ÿæˆå‘˜æ— éœ€æ¥å›ä¼ æ–‡ä»¶ï¼Œå…±äº«é“¾æ¥å°±èƒ½å®æ—¶è¯•å¬ã€è°ƒæ•´é…éŸ³æ•ˆæœï¼›è·¨è®¾å¤‡åˆ‡æ¢ä¹Ÿæ¯«æ— é˜»ç¢ï¼Œç”µè„‘ã€å¹³æ¿ã€æ‰‹æœºéƒ½èƒ½æ“ä½œï¼Œè¿˜èƒ½ç»™é“¾æ¥è®¾ç½®å¯†ç ï¼Œä¿éšœé…éŸ³æ–¹æ¡ˆçš„å®‰å…¨æ€§ï¼Œè®©åˆ›ä½œä¸å—ç©ºé—´å’Œè®¾å¤‡çš„é™åˆ¶ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c001fc8321d44be19cfb96338c04f523~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6ICF6Zi_6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771299521&amp;x-signature=xTDSbb8%2BcGm8tVLOhNZgUFiMLfI%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<h4 data-id="heading-0">è‡ªå·±å°±æ˜¯ä¸€ä¸ªå›¢é˜Ÿï¼Œæ— è®ºæ˜¯è‡ªå·±åšè´¦å·è¿˜æ˜¯æ¥å•å­èµšé’±ã€‚è¿™ä¸ªå·¥å…·ç»„åˆå¯æ˜¯å¦¥å¦¥çš„ç”Ÿäº§åŠ›ï¼æ•™ç¨‹åœ¨ä¸‹é¢ï¼Œå¿«å»å®‰è£…æŒ£é’±å§ï¼</h4>
<p>æœ¬æ–‡å°†è¯¦ç»†ä»‹ç»å¦‚ä½•å€ŸåŠ© cpolar å†…ç½‘ç©¿é€ï¼Œç»“åˆ VibeVoice æ­å»ºå¯éšæ—¶éšåœ°è®¿é—®çš„å¤šè§’è‰²éŸ³é¢‘ç”Ÿæˆå¹³å°ï¼Œå¹¶ä»¥ 4 è§’è‰²å¯¹è¯å®æˆ˜æ¼”ç¤ºï¼Œçªç ´ä¼ ç»Ÿ TTS åœ¨å¤šè¯´è¯äººåœºæ™¯ä¸‹çš„é™åˆ¶ã€‚</p>
<h2 data-id="heading-1">1 é¡¹ç›®æ¦‚è¿°</h2>
<h3 data-id="heading-2">1.1 ä»€ä¹ˆæ˜¯VibeVoice</h3>
<p>VibeVoice æ˜¯å¾®è½¯å¼€å‘çš„ä¸€æ¬¾å…ˆè¿›æ–‡æœ¬è½¬è¯­éŸ³ï¼ˆTTSï¼‰æ¨¡å‹ï¼Œä¸“æ³¨äºé•¿å¯¹è¯åœºæ™¯çš„é«˜è´¨é‡è¯­éŸ³ç”Ÿæˆã€‚å®ƒçš„æ ¸å¿ƒç‰¹ç‚¹åŒ…æ‹¬ï¼šæ”¯æŒå¤šè¾¾ 4 ä¸ªä¸åŒè§’è‰²ï¼Œæ¯ä¸ªè§’è‰²æ‹¥æœ‰ç‹¬ç‰¹å£°éŸ³ï¼›èƒ½å¤Ÿç”Ÿæˆé•¿æ—¶é—´è¿ç»­å¯¹è¯ï¼ˆ1.5B æ¨¡å‹å¯ç”Ÿæˆçº¦ 90 åˆ†é’Ÿï¼ŒLarge æ¨¡å‹çº¦ 45 åˆ†é’Ÿï¼‰ï¼›å…·å¤‡ä¸°å¯Œçš„æƒ…æ„Ÿè¡¨è¾¾èƒ½åŠ›ï¼Œå¯æ ¹æ®æ–‡æœ¬è‡ªåŠ¨è°ƒæ•´è¯­è°ƒä¸æƒ…æ„Ÿè‰²å½©ï¼›æ”¯æŒä¸­è‹±æ–‡è¯­éŸ³ç”Ÿæˆï¼Œå¹¶å…·å¤‡è·¨è¯­è¨€è¿ç§»èƒ½åŠ›ï¼›åŒæ—¶æ”¯æŒå®æ—¶æµå¼éŸ³é¢‘è¾“å‡ºï¼Œæå‡äº’åŠ¨ä½“éªŒã€‚VibeVoice é€‚ç”¨äºå¤šè§’è‰²å‰§æœ¬ã€é•¿ç¯‡æ•…äº‹æœ—è¯»ä»¥åŠè™šæ‹ŸåŠ©æ‰‹ç­‰åœºæ™¯ã€‚</p>
<hr/>
<h3 data-id="heading-3">1.2 ä»€ä¹ˆæ˜¯ComfyUI</h3>
<p>ComfyUI æ˜¯ä¸€ä¸ªåŸºäºèŠ‚ç‚¹çš„å¯è§†åŒ–ç•Œé¢å·¥å…·ï¼Œä¸»è¦ç”¨äºæ„å»ºå’Œç®¡ç†æ·±åº¦å­¦ä¹ æ¨¡å‹çš„æ¨ç†æµç¨‹ã€‚å®ƒé€šè¿‡æ‹–æ‹½å¼èŠ‚ç‚¹è¿æ¥ï¼Œå°†æ¨¡å‹åŠ è½½ã€æ•°æ®å¤„ç†ã€å›¾åƒç”Ÿæˆç­‰ç¯èŠ‚ç›´è§‚åœ°å‘ˆç°å‡ºæ¥ï¼Œä½¿ç”¨æˆ·æ— éœ€ç¼–å†™å¤§é‡ä»£ç å³å¯æ­å»ºå¤æ‚çš„ AI æµç¨‹ã€‚ComfyUI æ”¯æŒå¤šç§æ‰©å±•èŠ‚ç‚¹å’Œè‡ªå®šä¹‰åŠŸèƒ½ï¼Œå¯ä»¥çµæ´»é›†æˆç¬¬ä¸‰æ–¹æ¨¡å‹å’Œæ’ä»¶ï¼ŒåŒæ—¶æä¾›å®æ—¶é¢„è§ˆå’Œè°ƒè¯•åŠŸèƒ½ï¼Œæå¤§é™ä½äº†æ·±åº¦å­¦ä¹ æ¨¡å‹æ“ä½œçš„é—¨æ§›ï¼Œé€‚åˆç ”ç©¶è€…ã€åˆ›ä½œè€…ä»¥åŠå¼€å‘è€…è¿›è¡Œå¿«é€ŸåŸå‹è®¾è®¡å’Œå®éªŒã€‚</p>
<h2 data-id="heading-4">2 ç¯å¢ƒå®‰è£…</h2>
<blockquote>
<p><strong>é‡è¦æç¤º</strong>ï¼šç¡®ä¿æ‚¨çš„ç³»ç»Ÿæ»¡è¶³ä»¥ä¸‹è¦æ±‚ï¼Œå¦åˆ™å¯èƒ½å¯¼è‡´å®‰è£…å¤±è´¥æˆ–è¿è¡Œå¼‚å¸¸ã€‚</p>
</blockquote>













































<table><thead><tr><th>ç¯å¢ƒé¡¹</th><th>è¦æ±‚è¯´æ˜</th></tr></thead><tbody><tr><td>æ“ä½œç³»ç»Ÿ</td><td>Windows 10/11ï¼ˆæ¨èï¼‰</td></tr><tr><td>Pythonç‰ˆæœ¬</td><td>3.11</td></tr><tr><td>å†…å­˜</td><td>è‡³å°‘ 8GB RAMï¼Œæ¨è 16GB ä»¥ä¸Š</td></tr><tr><td>å­˜å‚¨ç©ºé—´</td><td>è‡³å°‘ 20GB å¯ç”¨ç©ºé—´ï¼ˆæ¨¡å‹æ–‡ä»¶è¾ƒå¤§ï¼‰</td></tr><tr><td>ç½‘ç»œç¯å¢ƒ</td><td>ç¨³å®šçš„ç½‘ç»œè¿æ¥ï¼Œç”¨äºä¸‹è½½æ¨¡å‹å’Œä¾èµ–</td></tr><tr><td>æ˜¾å¡è¦æ±‚</td><td>NVIDIA GPUï¼Œå»ºè®® 8GB æ˜¾å­˜åŠä»¥ä¸Šï¼ˆ<strong>RTX 20 ç³»åˆ—åŠä»¥ä¸Š</strong>ï¼‰</td></tr><tr><td>æ˜¾å¡é©±åŠ¨</td><td>NVIDIA é©±åŠ¨ 531 åŠä»¥ä¸Šï¼ˆ<strong>ç¤ºä¾‹ç¯å¢ƒ</strong>ï¼š580.97ï¼‰</td></tr><tr><td>CUDAç‰ˆæœ¬</td><td>CUDA 12ï¼ˆéœ€ä¸ PyTorch/FlashAttention ç‰ˆæœ¬å¯¹åº”ï¼‰</td></tr><tr><td>PyTorchç‰ˆæœ¬</td><td>2.8.0ï¼ˆå·²ç¼–è¯‘æ”¯æŒ cu128ï¼Œå³ CUDA 12.8ï¼Œå¯¹åº” wheel åŒ…ï¼štorch2.8+cu128ï¼‰</td></tr></tbody></table>
<blockquote>
<p>èµ„æ–™æ‰“åŒ…ä¸‹è½½ï¼ˆå« FlashAttention 2.7.4ã€VibeVoice æ¨¡å‹ï¼ˆ1.5Bï¼‰ã€å‚è€ƒéŸ³é¢‘ï¼‰</p>
<p>ç™¾åº¦ç½‘ç›˜ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fpan.baidu.com%2Fs%2F1IxFfB0SKPiQuIIbiZfKwBQ%3Fpwd%3D7au3%25EF%25BC%2588%25E6%258F%2590%25E5%258F%2596%25E7%25A0%2581%25EF%25BC%259A**7au3**%25EF%25BC%2589" target="_blank" title="https://pan.baidu.com/s/1IxFfB0SKPiQuIIbiZfKwBQ?pwd=7au3%EF%BC%88%E6%8F%90%E5%8F%96%E7%A0%81%EF%BC%9A**7au3**%EF%BC%89" ref="nofollow noopener noreferrer">pan.baidu.com/s/1IxFfB0SKâ€¦</a></p>
</blockquote>
<h3 data-id="heading-5">2.1 å®‰è£…FlashAttention2</h3>
<p><strong>FlashAttentionï¼ˆflash_attnï¼‰</strong> æ˜¯ä¸€ç§é’ˆå¯¹ <strong>Transformer æ¨¡å‹ä¸­æ³¨æ„åŠ›æœºåˆ¶ (Attention)</strong> çš„é«˜æ•ˆå®ç°ï¼Œå®ƒçš„ä¸»è¦ä½œç”¨æ˜¯ <strong>è®©å¤§æ¨¡å‹æ¨ç†å’Œè®­ç»ƒæ›´å¿«ã€æ›´çœæ˜¾å­˜</strong>ã€‚</p>
<blockquote>
<p>å®˜æ–¹GitHubå‘å¸ƒé¡µåœ°å€ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmjun0812%2Fflash-attention-prebuild-wheels%2Freleases" target="_blank" title="https://github.com/mjun0812/flash-attention-prebuild-wheels/releases" ref="nofollow noopener noreferrer">github.com/mjun0812/flâ€¦</a></p>
<p>æœ¬æ•™ç¨‹æ¼”ç¤ºå®‰è£…çš„FlashAttentionç‰ˆæœ¬ä¸º2.7.4</p>
</blockquote>
<p>åœ¨é€‰æ‹©<code>Flash-Attention</code>æ—¶ï¼Œéœ€è¦æŸ¥çœ‹æ‚¨çš„æ˜¾å¡é©±åŠ¨æ”¯æŒçš„CUDAç‰ˆæœ¬ä¿¡æ¯ï¼Œåœ¨CMDä¸­è¾“å…¥ï¼š</p>
<pre><code class="hljs language-shell" lang="shell">nvidia-smi
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/edaef1ca172944e998ea36c3eeaa8831~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6ICF6Zi_6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771299521&amp;x-signature=1q5mtPHyLmk2OGdXS67zweRqQcM%3D" alt="image-20250905150304683" loading="lazy"/></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œå½“å‰<code>CUDA</code>ç‰ˆæœ¬æ˜¾ç¤º13.0ï¼ˆæ”¯æŒå‘ä¸‹å…¼å®¹ä¸€äº›çš„ï¼‰</p>
<p>åœ¨å‘å¸ƒé¡µä¸‹ï¼Œä¸‹è½½å¯¹åº”ä½ ç³»ç»Ÿç¯å¢ƒçš„whlåŒ…ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5d85347f354f43de8f97232bbe3c9716~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6ICF6Zi_6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771299521&amp;x-signature=6zVEW6IF37t4JU6q%2FBK1ZbvlE%2F8%3D" alt="image-20250905145650427" loading="lazy"/></p>
<p>å°†æ–‡ä»¶ä¸‹è½½è‡³æœ¬åœ°ï¼š</p>
<pre><code class="hljs language-text" lang="text">flash_attn-2.7.4+cu128torch2.8-cp311-cp311-win_amd64.whl
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1be910439fb84da2be03d1a973162ed5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6ICF6Zi_6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771299521&amp;x-signature=KNWyLZzxGglMZQ%2F4HRSuCoiEpqI%3D" alt="image-20250905145715450" loading="lazy"/></p>
<p><strong>ç¯å¢ƒè¦æ±‚è§£æï¼š</strong></p>
<ul>
<li><strong><code>cp311-cp311</code></strong> â†’ è¯´æ˜éœ€è¦ <strong>Python 3.11</strong></li>
<li><strong><code>torch2.8</code></strong> â†’ è¯´æ˜éœ€è¦ <strong>PyTorch 2.8.0</strong></li>
<li><strong><code>cu128</code></strong> â†’ è¯´æ˜éœ€è¦ <strong>CUDA 12.8</strong>ï¼ˆPyTorch è¦ç”¨å¯¹åº”çš„ CUDA ç¼–è¯‘ç‰ˆæœ¬ï¼‰</li>
<li><strong><code>win_amd64</code></strong> â†’ è¯´æ˜éœ€è¦ <strong>Windows 64 ä½ç³»ç»Ÿ</strong></li>
</ul>
<p>é¦–å…ˆï¼Œéœ€è¦æ£€æŸ¥å½“å‰ç”µè„‘çš„pythonç¯å¢ƒï¼Œåœ¨cmdä¸­è¾“å…¥å¦‚ä¸‹å‘½ä»¤æ£€æŸ¥ï¼š</p>
<pre><code class="hljs language-shell" lang="shell">python --version
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c69f4982cd6c47a38902c8d07a4ab566~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6ICF6Zi_6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771299521&amp;x-signature=mc5RbeF0BHmBpyYLxHKNcjo%2BVJA%3D" alt="image-20250905145843345" loading="lazy"/></p>
<p>å¯ä»¥çœ‹åˆ°å·²ç»æ˜¯<code>python 3.11.4</code>çš„ç‰ˆæœ¬ã€‚</p>
<blockquote>
<p>å¦‚æœæ²¡æœ‰å®‰è£…python,å¯å‰å¾€å®˜ç½‘è¿›è¡Œå®‰è£…ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.python.org%2Fdownloads%2F" target="_blank" title="https://www.python.org/downloads/" ref="nofollow noopener noreferrer">www.python.org/downloads/</a></p>
</blockquote>
<p>æ¥ä¸‹æ¥éœ€è¦æ£€æŸ¥ PyTorch ç‰ˆæœ¬ï¼ŒåŒæ ·æ‰“å¼€cmdæ‰§è¡Œ:</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_">#</span><span class="bash">1.è¾“å…¥pythonå›è½¦</span>
python
<span class="hljs-meta prompt_">
#</span><span class="bash">2.ç„¶åè¾“å…¥å¦‚ä¸‹å‘½ä»¤</span>
import torch
print(torch.__version__)
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/10ee71508d2940ba83d2b8932dc68b7a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6ICF6Zi_6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771299521&amp;x-signature=4X56w17URWRYNVnmIS6sFrBk4D0%3D" alt="image-20250905151112814" loading="lazy"/></p>
<p>å¦‚æœæ²¡æœ‰å®‰è£… PyTorch ï¼Œæ˜¾ç¤ºåº”å¦‚ä¸‹ï¼š
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9b223d7c74ab4a23b492e5d51c61fcee~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6ICF6Zi_6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771299521&amp;x-signature=WDaq4soJntnuZa6I4CGrOMDS6FA%3D" alt="image-20250905151323803" loading="lazy"/></p>
<p>éœ€è¦æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤è¿›è¡Œå®‰è£…å³å¯ï¼š</p>
<pre><code class="hljs language-shell" lang="shell">pip install torch==2.8.0+cu128 torchvision torchaudio --index-url https://download.pytorch.org/whl/cu128
</code></pre>
<p>æ¥ä¸‹æ¥éœ€è¦å®‰è£…FlashAttention2.7.4ï¼Œåœ¨å‰é¢å·²ç»ä¸‹è½½çš„é€‚é…ç¯å¢ƒçš„ wheel æ–‡ä»¶ç›®å½•ä¸‹æ‰“å¼€CMDï¼š
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b31a58c5c5264983aca12d492e45831c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6ICF6Zi_6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771299521&amp;x-signature=4k0UjCfrp19OQ3kjnu0ajEt5zWU%3D" alt="image-20250905151800906" loading="lazy"/></p>
<p>ç„¶åè¾“å…¥å¦‚ä¸‹å‘½ä»¤è¿›è¡Œå®‰è£…ï¼š</p>
<pre><code class="hljs language-shell" lang="shell">pip install flash_attn-2.7.4+cu128torch2.8-cp311-cp311-win_amd64.whl
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/32928a8ede5b4737a312a0c55092564c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6ICF6Zi_6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771299521&amp;x-signature=pV59ESKMt1OM4BK1w9qFRQ0ybFU%3D" alt="image-20250905152033680" loading="lazy"/></p>
<p>æ£€æŸ¥ç‰ˆæœ¬ä¿¡æ¯ç¡®è®¤å®‰è£…ï¼š</p>
<pre><code class="hljs language-shell" lang="shell">python

import flash_attn
print(flash_attn.__version__)
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1f6b0c59396a42d6b951a589aeba2104~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6ICF6Zi_6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771299521&amp;x-signature=X%2FGuOhDyzuce0RYO2lVzzWIBnJs%3D" alt="image-20250905152122033" loading="lazy"/></p>
<p>æˆåŠŸå®‰è£…ï¼</p>
<h2 data-id="heading-6">3 ComfyUIå·¥ä½œæµé¡¹ç›®å®‰è£…éƒ¨ç½²</h2>
<blockquote>
<p>å®˜æ–¹GitHubä»“åº“åœ°å€ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fcomfyanonymous%2FComfyUI" target="_blank" title="https://github.com/comfyanonymous/ComfyUI" ref="nofollow noopener noreferrer">github.com/comfyanonymâ€¦</a></p>
</blockquote>
<p>ä»¥windowsä¸ºä¾‹ï¼Œé¦–å…ˆä½¿ç”¨gitå‘½ä»¤å°†é¡¹ç›®å…‹éš†è‡³æœ¬åœ°ï¼Œcmdæ‰§è¡Œå‘½ä»¤ï¼š</p>
<blockquote>
<p>gitå®˜ç½‘åœ°å€ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgit-scm.com%2Fdownloads" target="_blank" title="https://git-scm.com/downloads" ref="nofollow noopener noreferrer">git-scm.com/downloads</a></p>
</blockquote>
<pre><code class="hljs language-shell" lang="shell">git clone https://github.com/comfyanonymous/ComfyUI.git
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/43738156e9e04cb6a30f7a90c781fe52~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6ICF6Zi_6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771299521&amp;x-signature=EQJ%2BWT44zkpKA2Emcwn0e3cOsU4%3D" alt="image-20250905154423769" loading="lazy"/></p>
<p>æ¥ç€ç»§ç»­åœ¨è¯¥çª—å£ï¼Œä¾æ¬¡æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œå®‰è£…æ‰€éœ€ä¾èµ–ï¼š</p>
<pre><code class="hljs language-shell" lang="shell">cd ComfyUI

pip install -r requirements.txt
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d5014c2fd11d47db86bc502205057daf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6ICF6Zi_6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771299521&amp;x-signature=UfFRFpsx0KnlmXx%2FM9WPJnXYnCA%3D" alt="image-20250905154544713" loading="lazy"/></p>
<p>å®‰è£…å®Œæˆä¾èµ–åï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤è¿›è¡Œå¯åŠ¨æµ‹è¯•ï¼š</p>
<pre><code class="hljs language-shell" lang="shell">python main.py --listen 0.0.0.0 --port 18188
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d1565314acc94307858ce10a83e596af~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6ICF6Zi_6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771299521&amp;x-signature=pFKqztlIRnF%2FTO8cF4Mk1kNcegg%3D" alt="image-20250905154857906" loading="lazy"/>å¯ä»¥çœ‹åˆ°ï¼ŒæˆåŠŸå¯åŠ¨äº†ï¼Œç«¯å£ä¸º 18188ï¼Œä¸ºäº†åç»­æ–¹ä¾¿å¯åŠ¨ï¼Œå¯ä»¥å†™ä¸€ä¸ªbatè„šæœ¬ï¼Œå°†å‘½ä»¤æ”¾å…¥å…¶ä¸­ï¼š
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/31fe5ce28baa4bdeab9138c13fcb4ffa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6ICF6Zi_6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771299521&amp;x-signature=9%2BYM7ldF31N%2Bqa8Xkm%2F8rxuxIcQ%3D" alt="image-20250905155057220" loading="lazy"/></p>
<p>åç»­åŒå‡»è„šæœ¬ï¼Œå°±å¯ä»¥ç›´æ¥å¯åŠ¨ï¼š
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/737ac359e12d4c469d612990ed2e4162~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6ICF6Zi_6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771299521&amp;x-signature=44Mn3Vpqvy62RVMB%2B0zM7aoT%2B4U%3D" alt="image-20250905155134482" loading="lazy"/></p>
<p>å¯ä»¥çœ‹åˆ°è¾“å‡ºäº†å¦‚ä¸‹ä¿¡æ¯ï¼š</p>
<pre><code class="hljs language-text" lang="text">To see the GUI go to: http://0.0.0.0:18188
</code></pre>
<p>è®©æˆ‘ä»¬è®¿é—®æµè§ˆå™¨è¿›è¡Œæµ‹è¯•ï¼š</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_">#</span><span class="bash">ä¸Šé¢æ˜¾ç¤ºçš„0.0.0.0 é€šå¸¸è¡¨ç¤ºç»‘å®šåˆ°æœ¬æœºçš„æ‰€æœ‰ç½‘ç»œæ¥å£ï¼Œå› æ­¤å®ƒå¯ä»¥é€šè¿‡æœ¬æœºçš„ä»»ä½•æœ‰æ•ˆIPåœ°å€ï¼ˆåŒ…æ‹¬localhostæˆ–127.0.0.1ï¼‰æ¥è®¿é—®ã€‚</span>
http://localhost:18188
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dec1ed0da83e49a2a98b06e24e2ab240~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6ICF6Zi_6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771299521&amp;x-signature=pMaBVJgYw50SpX05Y%2FpjLEFJaLc%3D" alt="image-20250905155443397" loading="lazy"/></p>
<p>å¯ä»¥çœ‹åˆ°ï¼ŒæˆåŠŸè®¿é—®å•¦ï¼</p>
<h2 data-id="heading-7">4 ComfyUI-VibeVoiceé¡¹ç›®éƒ¨ç½²</h2>
<p>ComfyUI-VibeVoice æ˜¯ä¸€ä¸ªä¸º <strong>ComfyUI</strong> å¼€å‘çš„è‡ªå®šä¹‰æ’ä»¶ï¼Œå®ƒé›†æˆäº†å¾®è½¯çš„ <strong>VibeVoice</strong> æ–‡æœ¬è½¬è¯­éŸ³ï¼ˆTTSï¼‰æ¨¡å‹ï¼Œèƒ½å¤Ÿå®ç°é«˜è´¨é‡ã€å¤šè¯´è¯äººçš„è¯­éŸ³åˆæˆä¸é›¶æ ·æœ¬è¯­éŸ³å…‹éš†ã€‚ç”¨æˆ·åªéœ€è¾“å…¥æ–‡æœ¬å¹¶æä¾›å‚è€ƒéŸ³é¢‘ï¼Œå°±å¯ä»¥å¿«é€Ÿç”Ÿæˆé£æ ¼ä¸€è‡´ã€è‡ªç„¶æµç•…çš„è¯­éŸ³ï¼›åŒæ—¶æ”¯æŒå¤šè§’è‰²å¯¹è¯ã€é•¿ç¯‡å†…å®¹ç”Ÿæˆï¼Œå¹¶æä¾›å¤šç§æ³¨æ„åŠ›æœºåˆ¶å’Œ 4-bit é‡åŒ–ä»¥ä¼˜åŒ–æ€§èƒ½ï¼Œé€‚åˆåœ¨æ’­å®¢åˆ¶ä½œã€å¯¹è¯é…éŸ³ã€AI è¯­éŸ³å®éªŒç­‰åœºæ™¯ä¸­ä½¿ç”¨ã€‚</p>
<h3 data-id="heading-8">4.1 å…‹éš†é¡¹ç›®ä»£ç </h3>
<p>åœ¨å‰é¢çš„æ­¥éª¤ï¼Œå·²ç»éƒ¨ç½²å¥½äº†ComfyUIå·¥ä½œæµé¡¹ç›®ã€‚æ¥ä¸‹æ¥éœ€è¦æ‰“å¼€å¦‚ä¸‹ç›®å½•ï¼š</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_">#</span><span class="bash">å‰é¢é¡¹ç›®<span class="hljs-built_in">clone</span>ä¸‹æ¥çš„ä½ç½®</span>
D:\AI\ComfyUI\custom_nodes
</code></pre>
<p>åœ¨è¯¥ç›®å½•ä¸‹æ‰“å¼€å‘½ä»¤ç»ˆç«¯ï¼Œä½¿ç”¨gitå‘½ä»¤å°†é¡¹ç›®å…‹éš†ä¸‹æ¥ï¼š</p>
<pre><code class="hljs language-shell" lang="shell">git clone https://github.com/wildminder/ComfyUI-VibeVoice.git
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fbb3b9ae4d5f4f6b8a7594d25b27780d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6ICF6Zi_6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771299521&amp;x-signature=lkUjPU1gohdmnu8sH1jg1Eq8zCE%3D" alt="image-20250905160411584" loading="lazy"/></p>
<p>ç„¶åæ¥ç€æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œä¸‹è½½è¯¥é¡¹ç›®ç›¸å…³ä¾èµ–ï¼š</p>
<pre><code class="hljs language-shell" lang="shell">cd ComfyUI-VibeVoice

pip install -r requirements.txt
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1864d6808dda492ea03a6420e993b07e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6ICF6Zi_6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771299521&amp;x-signature=O1NPIOeDReIVAehr1tfRBGxp0gQ%3D" alt="image-20250905160551797" loading="lazy"/></p>
<h2 data-id="heading-9">5 ComfyUI ä¸­é…ç½®å’Œä½¿ç”¨ VibeVoiceï¼ˆå®æˆ˜ï¼‰</h2>
<p>åŒå‡»å¯åŠ¨å‰é¢åœ¨ComfyUIç›®å½•ä¸­åˆ›å»ºçš„<code>StartComfyUI-WEB.bat</code>è„šæœ¬ï¼ˆå¦‚æœå‰é¢å¯åŠ¨äº†ï¼Œæ²¡æœ‰åœæ­¢çª—å£éœ€è¦å…ˆåœæ­¢å¯åŠ¨çš„çª—å£ï¼‰ï¼š
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d2f19694edca4ca3a612276bf8cd65b9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6ICF6Zi_6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771299521&amp;x-signature=ooriI8k%2FW3%2FIjFt5SUkPDlFn4Iw%3D" alt="image-20250905161339378" loading="lazy"/></p>
<p>å¯åŠ¨ååœ¨æµè§ˆå™¨ä¸­è®¿é—®ComfyUIé¡¹ç›®ï¼Œç„¶åä¾æ¬¡å¦‚ä¸‹å›¾é€‰æ‹©ï¼ˆæˆ–ç›´æ¥æŒ‰å¿«æ·é”® Ctrl + Oï¼‰ï¼š
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/11519e9f5e79404692389786747a2162~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6ICF6Zi_6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771299521&amp;x-signature=5%2F2hpRUuUmDRItIp971LkA%2BwL80%3D" alt="image-20250905161515561" loading="lazy"/></p>
<p>æ¥ç€ï¼Œè¿›å…¥åˆ°å¦‚ä¸‹ç›®å½•é€‰æ‹©VibeVoice_example.jsonæ–‡ä»¶ï¼Œç„¶åç‚¹å‡»æ‰“å¼€ï¼š</p>
<pre><code class="hljs language-shell" lang="shell">D:\AI\ComfyUI\custom_nodes\ComfyUI-VibeVoice\example_workflows
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f9d4d8055dd64a37a5884cf0a46d01b0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6ICF6Zi_6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771299521&amp;x-signature=mroQeHxvPaz9iB2%2FqhaeAI0vKjI%3D" alt="image-20250905161627411" loading="lazy"/></p>
<p>æ‰“å¼€åï¼Œå¯ä»¥çœ‹åˆ°å¦‚ä¸‹å›¾æ˜¾ç¤ºï¼š
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a6d6335f1a0d4fbf9d91c7474e9a6eba~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6ICF6Zi_6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771299521&amp;x-signature=17jGTMaiYW9z4cWeNtdEQGTnnco%3D" alt="image-20250905161951873" loading="lazy"/></p>
<p>æ¥ç€ï¼Œéšæ„ä¸Šä¼ ä¸¤ä¸ª<code>å‚è€ƒéŸ³é¢‘</code>ï¼Œç„¶åç»™å®šä¸€æ®µå¯¹è¯ï¼ˆè¿™é‡Œä½¿ç”¨çš„æ˜¯AIç”Ÿæˆçš„æ¨å¹‚å’Œæµ·ç»µå®å®çš„å¯¹è¯ï¼‰ï¼š</p>
<pre><code class="hljs language-shell" lang="shell">Speaker 1: å“ˆå“ˆï¼Œæµ·ç»µå®å®ï¼Œå¬è¯´ä½ åœ¨æ°´ä¸‹çš„ç”Ÿæ´»éå¸¸æœ‰è¶£ï¼Œèƒ½å’Œæˆ‘ä»¬åˆ†äº«ä¸€ä¸‹å—ï¼Ÿ
Speaker 2: å“‡å“¦ï¼Œæ¨å¹‚ï¼å½“ç„¶å¯ä»¥ï¼æˆ‘æ¯å¤©éƒ½åœ¨æ¯”å¥‡å ¡å’Œæˆ‘çš„æœ‹å‹ä»¬ä¸€èµ·ç©ï¼Œæœ€å–œæ¬¢çš„å°±æ˜¯å’Œæ´¾å¤§æ˜Ÿä¸€èµ·åšå†’é™©äº†ï¼
Speaker 1: è¿™å¬èµ·æ¥çœŸçš„å¾ˆæœ‰è¶£ï¼é‚£ä½ è§‰å¾—æ´¾å¤§æ˜Ÿæœ€æç¬‘çš„åœ°æ–¹æ˜¯ä»€ä¹ˆï¼Ÿ
Speaker 2: å“‡ï¼Œæ´¾å¤§æ˜ŸçœŸçš„å¾ˆæç¬‘ï¼ä»–æ€»æ˜¯é‚£ä¹ˆå¤©çœŸæ— é‚ªï¼Œåšäº‹å¸¸å¸¸æ²¡æœ‰ä»»ä½•è®¡åˆ’ï¼Œæ€»æ˜¯å¸¦ç»™æˆ‘ä»¬æƒŠå–œå’Œç¬‘å£°ï¼
Speaker 1: å“ˆå“ˆï¼Œæ„Ÿè§‰ä½ ä»¬çš„å†’é™©ä¸€å®šå¾ˆæ¬¢ä¹ã€‚æˆ‘æƒ³çŸ¥é“ï¼Œæµ·ç»µå®å®ï¼Œä½ æœ‰åšè¿‡ä»€ä¹ˆç‰¹åˆ«çš„äº‹æƒ…å—ï¼Ÿ
Speaker 2: å½“ç„¶ï¼æˆ‘æ›¾ç»å½“è¿‡é¤å…ç»ç†ï¼Œåœ¨èŸ¹å ¡ç‹å·¥ä½œï¼Œæ¯å¤©éƒ½å¿™å¾—ä¸äº¦ä¹ä¹ã€‚ä¸è¿‡æœ€ç‰¹åˆ«çš„è¿˜æ˜¯æˆ‘åšçš„èŸ¹å ¡ï¼Œå¤§å®¶éƒ½è¯´æˆ‘åšçš„æœ€ç¾å‘³ï¼
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a624394e0e994afdbbeade0ea3117865~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6ICF6Zi_6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771299521&amp;x-signature=k0ROFQpbxX2m0FY1kZmmf0SjnOs%3D" alt="image-20250905163933933" loading="lazy"/></p>
<blockquote>
<p>æ¨¡å‹é€‰æ‹©ï¼Œé¦–æ¬¡å¦‚æœæ²¡æœ‰è¯¥æ¨¡å‹ä¼šè‡ªåŠ¨è¿›è¡Œä¸‹è½½ï¼Œä¹Ÿå¯ä»¥ç›´æ¥æ‰‹åŠ¨ä¸‹è½½æ¨¡å‹</p>
<p>æ”¾å…¥å¦‚ä¸‹æ–‡ä»¶å¤¹ï¼šD:\AI\ComfyUI\models\tts\VibeVoice</p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9ce02bab5c4f4f8789180b395bc652e0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6ICF6Zi_6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771299521&amp;x-signature=%2B5XO4jcK2b5cgZxAsDFlj%2B8q9ic%3D" alt="image-20250905164034943" loading="lazy"/></p>
<p>å®Œæˆæœ¬åœ°æµç¨‹é…ç½®åï¼Œæˆ‘ä»¬å°†é€šè¿‡ cpolar å°†è¯¥å·¥ä½œæµå¯¹å¤–å‘å¸ƒï¼Œä¾¿äºè·¨è®¾å¤‡è®¿é—®ä¸å…±äº«ã€‚</p>
<p>å¦‚ä¸‹ä¸º1.5Bæ¨¡å‹ç”Ÿæˆ,ç‚¹å‡»å¯è¿›è¡Œè¯•å¬ï¼š</p>

  
  æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒ audio å…ƒç´ ã€‚

<p>ä»¥ä¸‹ä¸º7Bæ¨¡å‹å¼€å¯é‡åŒ–åŠŸèƒ½åç”Ÿæˆæ¨ç†çš„è¯­éŸ³ï¼ˆ3060tiçš„8Gæ˜¾å­˜æ— æ³•å®Œå…¨åŠ è½½7Bæ¨¡å‹ï¼‰ï¼š</p>

  
  æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒ audio å…ƒç´ ã€‚

<h2 data-id="heading-10">6 ä½¿ç”¨ cpolar å°† ComfyUI å®‰å…¨æš´éœ²åˆ°å…¬ç½‘</h2>
<h3 data-id="heading-11">6.1 ä¸ºä»€ä¹ˆè¦ç©¿é€comfyUI</h3>
<p>å€ŸåŠ© cpolar å†…ç½‘ç©¿é€ï¼Œæˆ‘ä»¬æ— éœ€å…¬ç½‘ IP ä¸è·¯ç”±é…ç½®ï¼Œå³å¯å°†æœ¬åœ° ComfyUI æœåŠ¡ç¨³å®šã€å®‰å…¨åœ°å‘å¸ƒåˆ°å…¬ç½‘ï¼Œæ”¯æŒ HTTPS ä¸å›ºå®šäºŒçº§åŸŸåã€‚</p>
<p>å¾ˆå¤šæ—¶å€™æˆ‘ä»¬åœ¨æœ¬åœ°ç”µè„‘æˆ–è€…æœåŠ¡å™¨ä¸Šéƒ¨ç½²äº† ComfyUIï¼Œä½†åˆå¸Œæœ›èƒ½éšæ—¶ä»å…¶ä»–è®¾å¤‡è®¿é—®ï¼Œæ¯”å¦‚è¿œç¨‹è°ƒè¯•ã€å’ŒåŒäº‹åä½œä¿®æ”¹èŠ‚ç‚¹ï¼Œæˆ–è€…åœ¨ä¸åŒåœ°æ–¹å±•ç¤ºæ¨¡å‹ç”Ÿæˆæ•ˆæœã€‚é—®é¢˜æ˜¯ ComfyUI é»˜è®¤åªèƒ½åœ¨æœ¬åœ°è®¿é—®ï¼Œå¤–ç½‘æ ¹æœ¬æ— æ³•è¿æ¥ï¼Œè¿™å°±è®©è¿œç¨‹ä½¿ç”¨å˜å¾—éå¸¸éº»çƒ¦ï¼Œéœ€è¦å¤æ‚çš„è·¯ç”±è®¾ç½®æˆ–è€…å›ºå®šå…¬ç½‘ IPã€‚é€šè¿‡å†…ç½‘ç©¿é€å·¥å…·å¦‚ cpolarï¼Œæˆ‘ä»¬å¯ä»¥æŠŠæœ¬åœ°çš„ ComfyUI å®‰å…¨åœ°æ˜ å°„åˆ°å…¬ç½‘ï¼Œç”Ÿæˆä¸€ä¸ªéšæ—¶å¯ç”¨çš„å…¬ç½‘åœ°å€ã€‚è¿™æ ·æ— è®ºèº«å¤„ä½•åœ°ï¼Œéƒ½èƒ½è½»æ¾è®¿é—®å’Œæ“ä½œ ComfyUIï¼Œå®ç°è¿œç¨‹åä½œå’Œå±•ç¤ºï¼Œè€Œä¸å¿…å†ä¸ºç½‘ç»œé…ç½®çƒ¦æ¼ã€‚</p>
<h3 data-id="heading-12">6.2 ä»€ä¹ˆæ˜¯ cpolarï¼ˆå†…ç½‘ç©¿é€ï¼‰ï¼Ÿ</h3>
<ul>
<li><strong>cpolar æ˜¯ä¸€æ¬¾å†…ç½‘ç©¿é€å·¥å…·</strong>ï¼Œå¯ä»¥å°†ä½ åœ¨å±€åŸŸç½‘å†…è¿è¡Œçš„æœåŠ¡ï¼ˆå¦‚æœ¬åœ° Web æœåŠ¡å™¨ã€SSHã€è¿œç¨‹æ¡Œé¢ç­‰ï¼‰é€šè¿‡ä¸€æ¡å®‰å…¨åŠ å¯†çš„ä¸­é—´éš§é“æ˜ å°„è‡³å…¬ç½‘ï¼Œè®©å¤–éƒ¨è®¾å¤‡æ— éœ€é…ç½®è·¯ç”±å™¨å³å¯è®¿é—®ã€‚</li>
<li>å¹¿æ³›æ”¯æŒ Windowsã€macOSã€Linuxã€æ ‘è“æ´¾ã€ç¾¤æ™– NAS ç­‰å¹³å°ï¼Œå¹¶æä¾›ä¸€é”®å®‰è£…è„šæœ¬æ–¹ä¾¿éƒ¨ç½²ã€‚</li>
</ul>
<h3 data-id="heading-13">6.3 ä¸‹è½½cpolar</h3>
<p>æ‰“å¼€cpolarå®˜ç½‘çš„ä¸‹è½½é¡µé¢ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.cpolar.com%2Fdownload" target="_blank" title="https://www.cpolar.com/download" ref="nofollow noopener noreferrer">www.cpolar.com/download</a>
ç‚¹å‡»<code>ç«‹å³ä¸‹è½½ 64-bit</code>æŒ‰é’®ï¼Œä¸‹è½½cpolarçš„å®‰è£…åŒ…ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4607555e15264d5dbf843193bb8b600f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6ICF6Zi_6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771299521&amp;x-signature=tC4i48eGRrB99Yo6%2FeuMmlF6hW8%3D" alt="image-20250815171202537" loading="lazy"/></p>
<p>ä¸‹è½½ä¸‹æ¥æ˜¯ä¸€ä¸ªå‹ç¼©åŒ…ï¼Œè§£å‹åæ‰§è¡Œç›®å½•ä¸­çš„åº”ç”¨ç¨‹åºï¼Œä¸€è·¯é»˜è®¤å®‰è£…å³å¯ï¼Œå®‰è£…å®Œæˆåï¼Œæ‰“å¼€cmdçª—å£è¾“å…¥å¦‚ä¸‹å‘½ä»¤ç¡®è®¤å®‰è£…ï¼š</p>
<pre><code class="hljs language-shell" lang="shell">cpolar version
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b8c22b55462c49ff8c44e2b4f252c5ad~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6ICF6Zi_6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771299521&amp;x-signature=DSSqUuZL8cTPQLxoaOuG9GV6Q5o%3D" alt="image-20250815171446129" loading="lazy"/></p>
<p>å‡ºç°å¦‚ä¸Šç‰ˆæœ¬å³ä»£è¡¨å®‰è£…æˆåŠŸï¼</p>
<p>å®‰è£…å®Œæˆåï¼Œcpolar å°†ä½œä¸ºæœ¬æ–¹æ¡ˆâ€œå…¬ç½‘è®¿é—®èƒ½åŠ›â€çš„å…³é”®åŸºç¡€ï¼Œè´¯ç©¿åç»­æ‰€æœ‰è¿œç¨‹è®¿é—®ä¸åä½œåœºæ™¯ã€‚</p>
<h3 data-id="heading-14">6.4æ³¨å†ŒåŠç™»å½•cpolar web uiç®¡ç†ç•Œé¢</h3>
<h4 data-id="heading-15">6.4.1 æ³¨å†Œcpolar</h4>
<p>å®˜ç½‘é“¾æ¥ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.cpolar.com%2F" target="_blank" title="https://www.cpolar.com/" ref="nofollow noopener noreferrer">www.cpolar.com/</a></p>
<p>è®¿é—®<code>cpolar</code>å®˜ç½‘ï¼Œç‚¹å‡»<code>å…è´¹æ³¨å†Œ</code>æŒ‰é’®ï¼Œè¿›è¡Œè´¦å·æ³¨å†Œ</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5493be24a2f247249093e09e4555628b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6ICF6Zi_6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771299521&amp;x-signature=FQMYWN8jhxDQ%2BvHerI9KCj%2BV4oQ%3D" alt="image-20250804085039567" loading="lazy"/></p>
<p>æ³¨å†Œé¡µé¢ï¼š
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f92f5ad382ed461f8db75324ce9403ec~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6ICF6Zi_6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771299521&amp;x-signature=B46CuJaq7cVMe0xTWHKEp9rGNGE%3D" alt="image-20250804085208319" loading="lazy"/></p>
<h4 data-id="heading-16">6.4.2 è®¿é—®web uiç®¡ç†ç•Œé¢</h4>
<p>æ³¨å†Œå®Œæˆå,åœ¨æµè§ˆå™¨ä¸­è¾“å…¥å¦‚ä¸‹åœ°å€è®¿é—® web uiç®¡ç†ç•Œé¢:</p>
<pre><code class="hljs language-shell" lang="shell">http://127.0.0.1:9200
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/35db9041d20d4760a997711200d4b894~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6ICF6Zi_6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771299521&amp;x-signature=iGhB5FnrMO207Z%2B%2Bfs%2B%2B%2FHoL%2BJk%3D" alt="image-20250815171734046" loading="lazy"/></p>
<p>è¾“å…¥åˆšæ‰æ³¨å†Œå¥½çš„cpolarè´¦å·ç™»å½•å³å¯è¿›å…¥åå°é¡µé¢:</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/54067c621ea54f58a8c1188ef14f8a84~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6ICF6Zi_6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771299521&amp;x-signature=Dw8v5J%2Ftb0knP8snTT38WMURQd8%3D" alt="image-20250815171846757" loading="lazy"/></p>
<h3 data-id="heading-17">6.5 ä½¿ç”¨ cpolar ç©¿é€ ComfyUI çš„ WebUI ç•Œé¢</h3>
<p>å‰é¢å¯ä»¥çœ‹åˆ°ï¼ŒcomfyUIçš„WebUIçš„ç•Œé¢ï¼Œç«¯å£æ˜¾ç¤ºä¸ºï¼š18188</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2dcc34d18a5c41cfa866addb6fb652c8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6ICF6Zi_6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771299521&amp;x-signature=X%2FqGEPRg5WReKNFGDJd6JsDWELk%3D" alt="image-20250905180851034" loading="lazy"/></p>
<p>æ‰€ä»¥æˆ‘ä»¬éœ€è¦å°†è¯¥ç«¯å£è¿›è¡Œç©¿é€ä»¥æ”¯æŒå’±ä»¬å…¬ç½‘è®¿é—®ï¼</p>
<h4 data-id="heading-18">6.5.1 éšæœºåŸŸåæ–¹å¼(å…è´¹æ–¹æ¡ˆ)</h4>
<p>ä½¿ç”¨ cpolar çš„éšæœºåŸŸåæ–¹å¼é€‚åˆé¢„ç®—æœ‰é™çš„ç”¨æˆ·ã€‚ä½¿ç”¨æ­¤æ–¹å¼æ—¶ï¼Œç³»ç»Ÿä¼šæ¯éš” <strong>24 å°æ—¶å·¦å³</strong> è‡ªåŠ¨æ›´æ¢ä¸€æ¬¡åŸŸååœ°å€ã€‚å¯¹äºé•¿æœŸè®¿é—®çš„ä¸å¤ªå‹å¥½ï¼Œä½†æ˜¯è¯¥æ–¹æ¡ˆæ˜¯å…è´¹çš„ï¼Œå¦‚æœæ‚¨æœ‰ä¸€å®šçš„é¢„ç®—ï¼Œå¯ä»¥æŸ¥çœ‹å¤§çº²6.5.2 çš„<strong>å›ºå®šåŸŸåæ–¹å¼</strong>ï¼Œä¸”<strong>è®¿é—®æ›´ç¨³å®š</strong>ã€‚</p>
<p>ç‚¹å‡»å·¦ä¾§èœå•æ çš„<code>éš§é“ç®¡ç†</code>ï¼Œå±•å¼€è¿›å…¥<code>éš§é“åˆ—è¡¨</code>é¡µé¢ï¼Œé¡µé¢ä¸‹é»˜è®¤ä¼šæœ‰ 2 ä¸ªéš§é“ï¼š</p>
<ul>
<li>sshéš§é“ï¼ŒæŒ‡å‘22ç«¯å£ï¼Œtcpåè®®</li>
<li>websiteéš§é“ï¼ŒæŒ‡å‘8080ç«¯å£ï¼Œhttpåè®®ï¼ˆhttpåè®®é»˜è®¤ä¼šç”Ÿæˆ2ä¸ªå…¬ç½‘åœ°å€ï¼Œä¸€ä¸ªæ˜¯httpï¼Œå¦ä¸€ä¸ªhttpsï¼Œå…å»é…ç½®sslè¯ä¹¦çš„ç¹çæ­¥éª¤ï¼‰</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/97584695f0554052856fa19c3be46f24~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6ICF6Zi_6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771299521&amp;x-signature=Ao1kUgOU9CdOVShcBhuo1cyVlIw%3D" alt="image-20250731121517683" loading="lazy"/></p>
<p>ç‚¹å‡»<code>websiteéš§é“</code>çš„<code>ç¼–è¾‘</code>æŒ‰é’®ï¼Œå¡«å†™å¦‚ä¸‹ä¿¡æ¯ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/52ad329ea4e24c84819499b518e39343~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6ICF6Zi_6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771299521&amp;x-signature=MXg%2FVsueeLFCAImzEST3Ri1Xshc%3D" alt="image-20250905181406529" loading="lazy"/></p>
<ul>
<li>æ³¨æ„ï¼šæ¯ä¸ªç”¨æˆ·åˆ›å»ºçš„éš§é“æ˜¾ç¤ºçš„å…¬ç½‘åœ°å€éƒ½ä¸ä¸€æ ·ï¼</li>
</ul>
<p>æ¥ç€ï¼Œç‚¹å‡»å·¦ä¾§èœå•çš„<code>çŠ¶æ€</code>èœå•ï¼Œæ¥ç€ç‚¹å‡»<code>åœ¨çº¿éš§é“åˆ—è¡¨</code>èœå•æŒ‰é’®ï¼Œå¯ä»¥çœ‹åˆ°æœ‰2ä¸ªcomfyui-18188çš„éš§é“ï¼Œä¸€ä¸ªä¸º http åè®®ï¼Œå¦ä¸€ä¸ªä¸º https åè®®ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7fa4931d3e0c485a8089e10f6c2eb4ec~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6ICF6Zi_6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771299521&amp;x-signature=mgtuLox7Z99mdd6jrBtkoPAZfOM%3D" alt="image-20250905181536558" loading="lazy"/></p>
<p>æ¥ä¸‹æ¥åœ¨æµè§ˆå™¨ä¸­è®¿é—® website éš§é“ç”Ÿæˆçš„å…¬ç½‘åœ°å€ï¼ˆhttp å’Œ https çš†å¯ï¼‰
è¿™é‡Œä»¥httpsä¸ºä¾‹ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7b76ad8f8a8c4d73bc7a7b77e30772fa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6ICF6Zi_6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771299521&amp;x-signature=2xKMHi3TY0WKYtY%2FVLyL5sIVj9g%3D" alt="image-20250905181810649" loading="lazy"/></p>
<p>å¯ä»¥çœ‹åˆ°æˆåŠŸè®¿é—®å•¦ï¼</p>
<h4 data-id="heading-19">6.5.2 å›ºå®šåŸŸåæ–¹å¼ï¼ˆå‡çº§å¥—é¤ï¼‰</h4>
<p>é€šè¿‡ cpolar çš„å›ºå®šäºŒçº§å­åŸŸåæ–¹å¼ï¼ˆå‡çº§å¥—é¤ï¼‰ï¼Œå¯è·å¾—ç¨³å®šä¸å˜çš„å…¬ç½‘åœ°å€ï¼Œä¾¿äºé•¿æœŸè®¿é—®ä¸å¯¹å¤–åˆ†äº«ã€‚</p>
<p>è¿›å…¥å®˜ç½‘çš„é¢„ç•™é¡µé¢ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fdashboard.cpolar.com%2Freserved" target="_blank" title="https://dashboard.cpolar.com/reserved" ref="nofollow noopener noreferrer">dashboard.cpolar.com/reserved</a></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1fa222ab999b42f7a53a81ef48c95878~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6ICF6Zi_6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771299521&amp;x-signature=Cc81khmCHZ8CmpV3pdrTkOFSsSU%3D" alt="image-20250905193637752" loading="lazy"/></p>
<p>åˆ—è¡¨ä¸­æ˜¾ç¤ºäº†ä¸€æ¡å·²ä¿ç•™çš„äºŒçº§å­åŸŸåè®°å½•ï¼š</p>
<ul>
<li>åœ°åŒºï¼šæ˜¾ç¤ºä¸º<code>China Top</code>ã€‚</li>
<li>äºŒçº§åŸŸåï¼šæ˜¾ç¤ºä¸º<code>comfyui01</code>ã€‚</li>
</ul>
<pre><code class="hljs language-text" lang="text">æ³¨ï¼šäºŒçº§åŸŸåæ˜¯å”¯ä¸€çš„ï¼Œæ¯ä¸ªè´¦å·éƒ½ä¸ç›¸åŒï¼Œè¯·ä»¥è‡ªå·±è®¾ç½®çš„äºŒçº§åŸŸåä¿ç•™çš„ä¸ºä¸»
</code></pre>
<p>è¿›å…¥ä¾§è¾¹èœå•æ çš„<code>éš§é“ç®¡ç†</code>ä¸‹çš„<code>éš§é“åˆ—è¡¨</code>ï¼Œå¯ä»¥çœ‹åˆ°åä¸º<code>comfyui-18188</code>çš„éš§é“
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e14982dd6b3c489eb82f1d8a0037678d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6ICF6Zi_6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771299521&amp;x-signature=RdM2g5I7G0%2B5I5t4wI0WcAoTtss%3D" alt="image-20250905193710797" loading="lazy"/></p>
<p>ç‚¹å‡»<code>ç¼–è¾‘</code>æŒ‰é’®è¿›å…¥ç¼–è¾‘é¡µé¢ï¼Œä¿®æ”¹åŸŸåç±»å‹ä¸º<code>äºŒçº§å­åŸŸå</code>ï¼Œç„¶åå¡«å†™å‰é¢é…ç½®å¥½çš„å­åŸŸåï¼Œç‚¹å‡»æ›´æ–°æŒ‰é’®ï¼š
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/158c4105b1094f63b021bb9303cd1b30~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6ICF6Zi_6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771299521&amp;x-signature=fXFO%2B1LiGlQFvQLSyjrU6pfwKE4%3D" alt="image-20250905195904105" loading="lazy"/></p>
<p>æ¥åˆ°<code>çŠ¶æ€</code>èœå•ä¸‹çš„<code>åœ¨çº¿éš§é“åˆ—è¡¨</code>å¯ä»¥çœ‹åˆ°éš§é“åç§°ä¸º<code>comfyui-18188</code>çš„å…¬ç½‘åœ°å€å·²ç»å˜æ›´ä¸º<code>äºŒçº§å­åŸŸå+å›ºå®šåŸŸåä¸»ä½“åŠåç¼€</code>çš„å½¢å¼äº†ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1ad256789be445acb93fe66ccf11f515~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6ICF6Zi_6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771299521&amp;x-signature=9yysg3EgM8XB7d8pfQX7sIM%2B4Ps%3D" alt="image-20250905195932400" loading="lazy"/></p>
<p>è¿™é‡Œä»¥httpsåè®®åšè®¿é—®æµ‹è¯•:</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ab21e13b8b904f92a0eca479cfa251ee~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6ICF6Zi_6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771299521&amp;x-signature=W30v68UmZ3rVD4unVylPhCmIyqY%3D" alt="image-20250907174602474" loading="lazy"/></p>
<p>è®¿é—®æˆåŠŸï¼</p>
<p>è‡³æ­¤ï¼Œä¾æ‰˜ cpolarï¼Œæˆ‘ä»¬å·²å°†æœ¬åœ° ComfyUI æœåŠ¡ç¨³å®šå‘å¸ƒåˆ°å…¬ç½‘ï¼Œä¾¿äºå›¢é˜Ÿè¿œç¨‹åä½œä¸å¤–éƒ¨æ¼”ç¤ºã€‚</p>
<h3 data-id="heading-20">6.6 ç»™ComfyUIæ·»åŠ æˆæƒéªŒè¯</h3>
<p>ç”±äº<code>ComfyUI</code>æœåŠ¡çš„WebUIç•Œé¢æ— éœ€ç™»å½•å³å¯è¿›è¡Œè®¿é—®ï¼Œä¸ºäº†ä¿æŠ¤ä¸ªäººçš„éšç§å³å®‰å…¨ï¼Œcpolarçš„éš§é“æœåŠ¡æ”¯æŒç»™ç½‘ç«™æ·»åŠ æˆæƒéªŒè¯åŠŸèƒ½ï¼Œé˜²æ­¢æ‚¨éƒ¨ç½²åœ¨å®¶ä¸­çš„<code>ComfyUI</code>æœåŠ¡è¢«æ»¥ç”¨ã€‚</p>
<p>é¦–å…ˆï¼Œæ‰“å¼€éš§é“åˆ—è¡¨ï¼Œç‚¹å‡»ç¼–è¾‘<code>comfyui-18188</code>çš„éš§é“ï¼š
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cd8445dc53974721a6860fadb4b28548~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6ICF6Zi_6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771299521&amp;x-signature=HFk7N4GGbdbxLVuLGLAwJ3LHX8M%3D" alt="image-20250908104953889" loading="lazy"/></p>
<p>ç„¶åï¼Œç‚¹å‡»é«˜çº§æŒ‰é’®ï¼Œå±•å¼€ï¼ŒæŒ‰ç…§å¦‚ä¸‹å›¾è¿›è¡Œé…ç½®ï¼š
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5272a0e4a1b04ee884f9ebc504b1bf37~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6ICF6Zi_6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771299521&amp;x-signature=ea%2BljrpTMGKeqpqEwZbsATYprAU%3D" alt="image-20250908105304054" loading="lazy"/></p>
<p>ç‚¹å‡»æ›´æ–°æŒ‰é’®åï¼Œè®¿é—®ç©¿é€çš„åœ°å€ï¼Œå¯ä»¥å‘ç°éœ€è¦æˆæƒéªŒè¯ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c3901ed16e9c4961afea472541436dae~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6ICF6Zi_6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771299521&amp;x-signature=9XgkdJQDkJp8xv4QF%2Fxhqmre6Og%3D" alt="image-20250908105335660" loading="lazy"/></p>
<p>è¿™æ ·ï¼Œä¸€ä¸ªå¯ä»¥éšæ—¶è®¿é—®ä¸”å¸¦æœ‰å®‰å…¨æ€§çš„<code>ComfyUI</code>çš„å·¥ä½œæµç½‘é¡µç«¯å°±å¼„å¥½å•¦ï¼</p>
<h2 data-id="heading-21">7 ä¸‰äººå¯¹è¯å’Œå››äººå¯¹è¯æµ‹è¯•</h2>
<h3 data-id="heading-22">7.1 ä¸‰äººå¯¹è¯</h3>
<p>é¦–å…ˆå‡†å¤‡ä¸€æ®µå¯¹è¯å†…å®¹ï¼š</p>
<pre><code class="hljs language-text" lang="text">Speaker 1: å¤§å®¶å¥½ï¼Œå¥½ä¹…ä¸è§äº†ï¼æˆ‘ä»¬ä»Šå¤©ç»ˆäºå¯ä»¥å¥½å¥½èŠèŠäº†ã€‚
Speaker 2: æ˜¯å•Šï¼Œæœ€è¿‘å·¥ä½œå¤ªå¿™äº†ï¼Œç»ˆäºèƒ½å’Œå¤§å®¶æ”¾æ¾ä¸€ä¸‹äº†ã€‚
Speaker 3: å“ˆå“ˆï¼Œä½ ä»¬æœ‰æ²¡æœ‰å‘ç°ï¼Œæˆ‘ä»¬ä¸‰ä¸ªå‡‘åœ¨ä¸€èµ·ï¼Œè¯é¢˜æ ¹æœ¬åœä¸ä¸‹æ¥ã€‚
Speaker 1: æœ€è¿‘æˆ‘åœ¨æ‹ä¸€éƒ¨å¤è£…å‰§ï¼Œé€ å‹è¶…çº§å¤æ‚ï¼Œæ¯å¤©éƒ½è¦èŠ±ä¸‰ä¸ªå°æ—¶åŒ–å¦†ã€‚
Speaker 2: å“‡ï¼Œé‚£ä¹Ÿå¤ªè¾›è‹¦äº†ï¼æˆ‘æœ€è¿‘åœ¨åšæ–°æ­Œdemoï¼Œç†¬å¤œç†¬åˆ°å¿«å¤±çœ äº†ã€‚
Speaker 3: çœ‹æ¥å¤§å®¶éƒ½å¾ˆæ‹¼å•Šï¼Œæˆ‘è¿™è¾¹åˆšä»å·¡æ¼”å›æ¥ï¼Œç°åœ¨åªæƒ³ä¼‘æ¯ç¡è§‰ã€‚
</code></pre>
<p>è¿™é‡Œçš„<code>Speaker 1</code>å’Œ<code>Speaker 2</code>ä»¥åŠ<code>Speaker 3</code>åˆ†åˆ«å¯¹åº”çš„å‚è€ƒéŸ³é¢‘å¦‚ä¸‹ï¼š</p>
<ul>
<li><strong>Speaker 1</strong>ï¼šæ¨å¹‚</li>
<li><strong>Speaker 2</strong>ï¼šè”¡å¾å¤</li>
<li><strong>Speaker 3</strong>ï¼šç‹ä¿Šå‡¯</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/458c32cc4def4359b000ec1e1822abc8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6ICF6Zi_6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771299521&amp;x-signature=OvwbazAjvSWrd0Vo4Ln6EOJpgXI%3D" alt="image-20250907192122704" loading="lazy"/></p>
<p>è®©æˆ‘ä»¬è¯•å¬ä¸€ä¸‹3äººå¯¹è¯çš„æ•ˆæœï¼š</p>

  
  æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒ audio å…ƒç´ ã€‚

<blockquote>
<p>ç”±äºæ¼”ç¤ºçš„windowsç³»ç»Ÿï¼Œ3060tiæ˜¾å¡ï¼Œæ˜¾å­˜ä¸º8Gï¼Œæ¨ç† 7B æ¨¡å‹å†…å­˜ä¼šè¶…å‡ºï¼Œæ‰€ä»¥è¿™è¾¹å°±ä¸åš7Bçš„æ¼”ç¤ºäº†</p>
</blockquote>
<h3 data-id="heading-23">7.2 å››äººå¯¹è¯</h3>
<p>åœ¨å‰é¢çš„å¯¹è¯å†…å®¹åŸºç¡€ä¸Šï¼Œæ·»åŠ ä¸€ä¸ªæ–°çš„è§’è‰²<code>Speaker 4</code>,è¿™é‡Œä½¿ç”¨çš„å‚è€ƒéŸ³é¢‘ä¸ºï¼š</p>
<ul>
<li><strong>Speaker 4</strong>ï¼šæ—å¿—ç²</li>
</ul>
<pre><code class="hljs language-text" lang="text">Speaker 1: å¤§å®¶å¥½ï¼Œå¥½ä¹…ä¸è§äº†ï¼æˆ‘ä»¬ä»Šå¤©ç»ˆäºå¯ä»¥å¥½å¥½èŠèŠäº†ã€‚
Speaker 2: æ˜¯å•Šï¼Œæœ€è¿‘å·¥ä½œå¤ªå¿™äº†ï¼Œç»ˆäºèƒ½å’Œå¤§å®¶æ”¾æ¾ä¸€ä¸‹äº†ã€‚
Speaker 3: å“ˆå“ˆï¼Œä½ ä»¬æœ‰æ²¡æœ‰å‘ç°ï¼Œæˆ‘ä»¬å››ä¸ªå‡‘åœ¨ä¸€èµ·ï¼Œè¯é¢˜æ ¹æœ¬åœä¸ä¸‹æ¥ã€‚
Speaker 4: å¬åˆ°ä½ ä»¬çš„å£°éŸ³æˆ‘å°±è§‰å¾—ç‰¹åˆ«æ¸©æš–ï¼Œä»Šå¤©ä¸€å®šè¦èŠä¸ªå°½å…´ï¼
Speaker 1: æœ€è¿‘æˆ‘åœ¨æ‹ä¸€éƒ¨å¤è£…å‰§ï¼Œé€ å‹è¶…çº§å¤æ‚ï¼Œæ¯å¤©éƒ½è¦èŠ±ä¸‰ä¸ªå°æ—¶åŒ–å¦†ã€‚
Speaker 2: å“‡ï¼Œé‚£ä¹Ÿå¤ªè¾›è‹¦äº†ï¼æˆ‘æœ€è¿‘åœ¨åšæ–°æ­Œdemoï¼Œç†¬å¤œç†¬åˆ°å¿«å¤±çœ äº†ã€‚
Speaker 3: çœ‹æ¥å¤§å®¶éƒ½å¾ˆæ‹¼å•Šï¼Œæˆ‘è¿™è¾¹åˆšä»å·¡æ¼”å›æ¥ï¼Œç°åœ¨åªæƒ³ä¼‘æ¯ç¡è§‰ã€‚
Speaker 4: æˆ‘å’Œä½ ä»¬æ¯”è½»æ¾å¤šäº†ï¼Œæœ€è¿‘ä¸»è¦åœ¨åšä¸€äº›å…¬ç›Šæ´»åŠ¨ï¼Œä¹Ÿè›®å……å®çš„ã€‚
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/af062384dcc9422182b231c07c55dcb9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6ICF6Zi_6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771299521&amp;x-signature=L7uaaVPSLuqAQ9c%2Fv%2BklXCGkCf8%3D" alt="image-20250908004742342" loading="lazy"/></p>
<p>è®©æˆ‘ä»¬è¯•å¬ä¸€ä¸‹4äººå¯¹è¯çš„æ•ˆæœï¼š</p>

  
  æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒ audio å…ƒç´ ã€‚

<p>å¯ä»¥çœ‹åˆ°ï¼Œ4äººå¯¹è¯çš„æ•ˆæœä¹Ÿæ˜¯éå¸¸ä¸é”™çš„ï¼Œéƒ½æ˜¯æ¼”ç¤ºäº†2è½®å¯¹è¯ã€‚æ¨ç†æ˜¾ç¤ºç”¨äº† 180s å·¦å³ï¼Œè¿˜æ˜¯å¾ˆä¸é”™çš„ï¼</p>
<h2 data-id="heading-24">æ€»ç»“</h2>
<p>VibeVoice å‡­å€Ÿå¤šè§’è‰²ã€é•¿æ—¶é•¿ã€å¸¦æƒ…ç»ªçš„è¯­éŸ³ç”Ÿæˆèƒ½åŠ›ï¼Œè§£å†³äº†å¤šåœºæ™¯ä¸‹éŸ³é¢‘åˆ›ä½œçš„æ ¸å¿ƒç—›ç‚¹ï¼ŒComfyUI åˆ™è®©æ“ä½œé—¨æ§›å¤§å¹…é™ä½ï¼Œä½†å±€åŸŸç½‘ä½¿ç”¨çš„å±€é™ç¡®å®åˆ¶çº¦äº†åˆ›ä½œçš„çµæ´»æ€§ã€‚è€Œ cpolar å†…ç½‘ç©¿é€çš„åŠ å…¥ï¼Œæ°å¥½è¡¥é½äº†è¿™ä¸€çŸ­æ¿ï¼Œå®ç°äº† VibeVoice åˆ›ä½œåœºæ™¯çš„å»¶ä¼¸ â€”â€” æ— è®ºæ˜¯ä¸ªäººåˆ›ä½œè€…éšæ—¶éšåœ°è°ƒæ•´é…éŸ³è„šæœ¬ï¼Œè¿˜æ˜¯å›¢é˜Ÿåä½œå®æ—¶ä¼˜åŒ–éŸ³é¢‘æ•ˆæœï¼Œéƒ½èƒ½é«˜æ•ˆå®Œæˆã€‚è¿™å¥—ç»„åˆå¹¶éå•çº¯çš„æŠ€æœ¯å åŠ ï¼Œè€Œæ˜¯ä»å®é™…åˆ›ä½œéœ€æ±‚å‡ºå‘ï¼Œè®©å¤šè§’è‰²è¯­éŸ³ç”Ÿæˆä» â€œåªèƒ½å›ºå®šåœ°ç‚¹æ“ä½œâ€ å˜æˆ â€œéšæ—¶éšåœ°å¯åˆ›ä½œâ€ï¼ŒçœŸæ­£é€‚é…äº†å‰§æœ¬æ€ã€è‡ªåª’ä½“ã€ä¼ä¸šåŸ¹è®­ç­‰åœºæ™¯çš„å®é™…ä½¿ç”¨éœ€æ±‚ï¼Œä¸ºéŸ³é¢‘å†…å®¹åˆ›ä½œæä¾›äº†æ›´çµæ´»ã€æ›´å®ç”¨çš„è§£å†³æ–¹æ¡ˆã€‚</p>
<p>æ„Ÿè°¢æ‚¨é˜…è¯»æœ¬ç¯‡æ–‡ç« ï¼Œæœ‰ä»»ä½•é—®é¢˜æ¬¢è¿ç•™è¨€äº¤æµã€‚<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.cpolar.com%2F" target="_blank" title="https://www.cpolar.com/" ref="nofollow noopener noreferrer">cpolarå®˜ç½‘-å®‰å…¨çš„å†…ç½‘ç©¿é€å·¥å…· | æ— éœ€å…¬ç½‘ip | è¿œç¨‹è®¿é—® | æ­å»ºç½‘ç«™</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[C ç«¯é«˜å¹¶å‘ä¸‹çš„ KV å­˜å‚¨ä¼˜åŒ–]]></title>    <link>https://juejin.cn/post/7604666872128241683</link>    <guid>https://juejin.cn/post/7604666872128241683</guid>    <pubDate>2026-02-10T03:45:14.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604666872128241683" data-draft-id="7604757482003841087" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="C ç«¯é«˜å¹¶å‘ä¸‹çš„ KV å­˜å‚¨ä¼˜åŒ–"/> <meta itemprop="keywords" content="åç«¯,Java,æ•°æ®åº“"/> <meta itemprop="datePublished" content="2026-02-10T03:45:14.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="LanLance"/> <meta itemprop="url" content="https://juejin.cn/user/2837173444548711"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            C ç«¯é«˜å¹¶å‘ä¸‹çš„ KV å­˜å‚¨ä¼˜åŒ–
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2837173444548711/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    LanLance
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T03:45:14.000Z" title="Tue Feb 10 2026 03:45:14 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>C ç«¯åœºæ™¯ä¸‹åˆ†å¸ƒå¼ KV å­˜å‚¨ï¼ˆå¦‚ Redisã€Tairï¼‰éšç€ä¸šåŠ¡é€»è¾‘çš„æ—¥ç›Šå¤æ‚ã€å¯¹è±¡ä½“ç§¯ä¸æ–­è†¨èƒ€ï¼Œå¤§ Value é—®é¢˜æˆä¸ºç³»ç»Ÿé¡½ç–¾ä¹‹ä¸€ï¼Œå±å®³ç³»ç»Ÿç¨³å®šæ€§ä¸æ¥å£æ€§èƒ½ã€‚</p>
<ul>
<li>
<p>å¤§ Value æ•°æ®å¦‚æœè¯»å†™é¢‘ç‡è¾ƒé«˜ï¼Œå®¹æ˜“å¯¼è‡´ç½‘å¡æµé‡è¾ƒé«˜è§¦å‘æµæ§ï¼Œè¿˜å®¹æ˜“ç¡¬ç›˜çš„è´Ÿè½½å¤ªé«˜ç”šè‡³å¯¼è‡´å¼•æ“å¤„ç†ä¸è¿‡æ¥è€Œé˜»å¡æ­£å¸¸çš„å†™å…¥ã€‚</p>
</li>
<li>
<p>å¤§ Value ç½‘ç»œä¼ è¾“å’Œå†…å­˜æ‹·è´æœ¬èº«å°±æ…¢ï¼ŒæœåŠ¡ç«¯çš„å†…ç½®ç¼“å­˜å¼•æ“ä¸å®¹æ˜“ç¼“å­˜å¤§ Valueï¼Œæ¶‰åŠçš„å¤§ Value è¯»å†™åŸºæœ¬éƒ½æ˜¯ç»è¿‡ç¡¬ç›˜ï¼Œè€Œä¸”å¤§ Value åœ¨å­˜å‚¨å¼•æ“ä¸Šå®¹æ˜“æœ‰ä¸¥é‡çš„å†™æ”¾å¤§é—®é¢˜ï¼Œæ‰€ä»¥å¤§ Value å¤„ç†æ€§èƒ½ä¼šæ˜æ˜¾è¾ƒå·®ã€‚</p>
</li>
</ul>
<p>ä¸ºäº†è§£å†³è¿™ä¸€ç—›ç‚¹ï¼ŒåŒæ—¶ä¸ç‰ºç‰²ç³»ç»Ÿçš„ååèƒ½åŠ›ï¼Œé’ˆå¯¹æ€§åœ°è®¾è®¡å‡ºäº†ä¸€å¥—åŸºäº Fory åºåˆ—åŒ–ä¸ Zstd å‹ç¼©çš„ç»„åˆæ–¹æ¡ˆã€‚è¿™å¥—æ–¹æ¡ˆçš„æ ¸å¿ƒé€»è¾‘åœ¨äºï¼šåˆ©ç”¨ Fory çš„æè‡´æ€§èƒ½è§£å†³åºåˆ—åŒ–å¸¦æ¥çš„ CPU å’Œè€—æ—¶é—®é¢˜ï¼Œåˆ©ç”¨ Zstd çš„é«˜å‹ç¼©æ¯”ä¸è§£å‹é€Ÿåº¦è§£å†³ KV å­˜å‚¨çš„å¤§ Value é—®é¢˜ã€‚</p>
<h2 data-id="heading-0">ä¸ºä»€ä¹ˆæ˜¯ Fory ä¸ Zstd</h2>
<p>åœ¨ä¼ ç»Ÿ Java æœåŠ¡ç«¯å¼€å‘ä¸­ï¼Œåºåˆ—åŒ–é€šå¸¸ä½¿ç”¨ JDK è‡ªå¸¦æ–¹æ¡ˆæˆ– Hessianï¼Œå‹ç¼©ä¹ æƒ¯ä½¿ç”¨ Gzipã€‚ä½†åœ¨ QPS æé«˜çš„åœºæ™¯ä¸‹è¯¥ç»„åˆæ€§èƒ½å·®ã€ç³»ç»Ÿå‹åŠ›å¤§ã€‚</p>
<p><strong>Apache Foryâ„¢</strong>ï¼ˆæ·˜å®å¼€æºï¼‰æ˜¯ä¸€ä¸ªåŸºäºåŠ¨æ€ä»£ç ç”Ÿæˆå’Œé›¶æ‹·è´æŠ€æœ¯çš„å¤šè¯­è¨€åºåˆ—åŒ–æ¡†æ¶ï¼Œå®ç°äº†æ— éœ€ IDL ç¼–è¯‘çš„åŸç”Ÿå¤šè¯­è¨€ç¼–ç¨‹èŒƒå¼ï¼Œå¹¶æä¾›æœ€é«˜ 170 å€çš„æ€§èƒ½å’Œæè‡´çš„æ˜“ç”¨æ€§ã€‚å¤§å¹…æå‡å¤§è§„æ¨¡æ•°æ®ä¼ è¾“ã€é«˜å¹¶å‘ RPCã€åˆ†å¸ƒå¼ç³»ç»Ÿã€äº‘åŸç”Ÿä¸­é—´ä»¶ç­‰åœºæ™¯çš„æ€§èƒ½ï¼Œæ˜¾è‘—é™ä½å¤šè¯­è¨€ç³»ç»Ÿçš„ç ”å‘æˆæœ¬ã€‚</p>
<p><strong>Zstandard</strong>ï¼ˆFacebook å¼€æºï¼‰æ˜¯ä¸€ä¸ªæä¾›é«˜å‹ç¼©æ¯”çš„å¿«é€Ÿå‹ç¼©ç®—æ³•ï¼Œé‡‡ç”¨äº†æœ‰é™çŠ¶æ€ç†µï¼ˆFinite State Entropyï¼Œç¼©å†™ä¸º FSEï¼‰ç¼–ç å™¨ã€‚è¯¥ç¼–ç å™¨æ˜¯åŸºäº ANS ç†è®ºå¼€å‘çš„ä¸€ç§æ–°å‹ç†µç¼–ç å™¨ï¼Œæä¾›äº†éå¸¸å¼ºå¤§çš„å‹ç¼©é€Ÿåº¦/å‹ç¼©ç‡çš„æŠ˜ä¸­æ–¹æ¡ˆï¼ˆäº‹å®ä¸Šä¹Ÿçš„ç¡®åšåˆ°äº†â€œé±¼â€å’Œâ€œç†ŠæŒâ€å…¼å¾—ï¼‰ã€‚Zstandard è¾¾åˆ°äº† Pareto frontierï¼ˆèµ„æºåˆ†é…æœ€ä½³çš„ç†æƒ³çŠ¶æ€ï¼‰ï¼Œå› ä¸ºå®ƒè§£å‹ç¼©é€Ÿåº¦å¿«äºä»»ä½•å…¶ä»–å½“å‰å¯ç”¨çš„ç®—æ³•ï¼Œä½†å‹ç¼©æ¯”ç±»ä¼¼æˆ–æ›´å¥½ã€‚</p>
<h2 data-id="heading-1">é€‰å‹å¯¹æ¯”</h2>
<p><strong>åºåˆ—åŒ–ç®—æ³•å¯¹æ¯”</strong></p>
<p>åœ¨åºåˆ—åŒ–å±‚é¢ï¼Œæˆ‘ä»¬ä¸»è¦å…³æ³¨åºåˆ—åŒ–é€Ÿåº¦ï¼ˆå½±å“æ¥å£è€—æ—¶ï¼‰ã€ç æµå¤§å°ï¼ˆå½±å“ç½‘ç»œä¸å­˜å‚¨ï¼‰ä»¥åŠæ˜“ç”¨æ€§ã€‚</p>















































<table><thead><tr><th>åºåˆ—åŒ–æ¡†æ¶</th><th>åºåˆ—åŒ–/ååºåˆ—åŒ–é€Ÿåº¦</th><th>ç æµå¤§å°</th><th>æ˜“ç”¨æ€§ä¸å…¼å®¹æ€§</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td><strong>Fory</strong></td><td>æå¿« (JIT åŠ é€Ÿ)</td><td>å° (æ”¯æŒç±»æ³¨å†Œ)</td><td>é«˜ (å…¼å®¹ JDK åºåˆ—åŒ–ï¼Œæ— éœ€ IDL)</td><td>é«˜æ€§èƒ½ Java åº”ç”¨ï¼Œå†…éƒ¨ RPC/KV</td></tr><tr><td><strong>Hessian2</strong></td><td>ä¸­ç­‰</td><td>ä¸­ç­‰</td><td>é«˜ (å…¼å®¹æ€§å¥½)</td><td>ä¼ ç»Ÿ RPCï¼Œå¯¹æ€§èƒ½è¦æ±‚ä¸ä¸¥è‹›</td></tr><tr><td><strong>Protobuf</strong></td><td>å¿«</td><td>æå°</td><td>ä½ (éœ€ç¼–å†™.proto æ–‡ä»¶)</td><td>è·¨è¯­è¨€äº¤äº’ï¼ŒSchema ç¨³å®šçš„åœºæ™¯</td></tr><tr><td><strong>JDK åŸç”Ÿ</strong></td><td>æ…¢</td><td>å¤§</td><td>é«˜ (å¼€ç®±å³ç”¨)</td><td>ä¸æ¨èç”¨äºé«˜å¹¶å‘ç”Ÿäº§ç¯å¢ƒ</td></tr><tr><td><strong>Kryo</strong></td><td>æå¿«</td><td>å°</td><td>ä¸­ (éœ€å¤„ç†çº¿ç¨‹å®‰å…¨)</td><td>å¤§æ•°æ®å¤„ç†ï¼ŒSpark/Flink</td></tr></tbody></table>
<p>Fory åœ¨ä¿æŒäº† Java åŸç”Ÿå…¼å®¹æ€§çš„å‰æä¸‹ï¼Œæä¾›äº†æ¥è¿‘ç”šè‡³è¶…è¶Š Protobuf çš„æ€§èƒ½ï¼Œä¸”ä¸éœ€è¦ç»´æŠ¤å¤æ‚çš„ IDL æ–‡ä»¶ã€‚</p>
<p><strong>å‹ç¼©ç®—æ³•å¯¹æ¯”</strong></p>
<p>åœ¨å‹ç¼©å±‚é¢ï¼Œæˆ‘ä»¬é‡ç‚¹å…³æ³¨å‹ç¼©ç‡ï¼ˆèŠ‚çœç©ºé—´ï¼‰ä¸è§£å‹é€Ÿåº¦ï¼ˆå½±å“è¯»å– RTï¼‰ã€‚</p>








































<table><thead><tr><th>å‹ç¼©ç®—æ³•</th><th>å‹ç¼©ç‡</th><th>å‹ç¼©é€Ÿåº¦</th><th>è§£å‹é€Ÿåº¦</th><th>ç‰¹ç‚¹</th></tr></thead><tbody><tr><td><strong>Zstd</strong></td><td>é«˜</td><td>å¿«</td><td>æå¿«</td><td>ç»¼åˆæ€§èƒ½æœ€å¼ºï¼Œå¹³è¡¡äº†ç©ºé—´ä¸æ—¶é—´</td></tr><tr><td><strong>Gzip</strong></td><td>é«˜</td><td>æ…¢</td><td>æ…¢</td><td>CPU æ¶ˆè€—å¤§ï¼Œé«˜å¹¶å‘ä¸‹æ˜“å¯¼è‡´ RT æŠ–åŠ¨</td></tr><tr><td><strong>LZ4</strong></td><td>ä½</td><td>æå¿«</td><td>æå¿«</td><td>é€Ÿåº¦æœ€å¿«ï¼Œä½†å‹ç¼©ç‡è¾ƒä½ï¼Œå¤§ Value ä¼˜åŒ–æœ‰é™</td></tr><tr><td><strong>Snappy</strong></td><td>ä½</td><td>å¿«</td><td>å¿«</td><td>Google å‡ºå“ï¼Œæ€§èƒ½ä»‹äº LZ4 ä¸ Gzip ä¹‹é—´</td></tr></tbody></table>
<p>Zstd åœ¨å‹ç¼©ç‡ä¸Šå®Œèƒœ LZ4ï¼Œåœ¨è§£å‹é€Ÿåº¦ä¸Šå®Œèƒœ Gzipï¼Œè¾¾åˆ°äº† Pareto frontierã€‚</p>
<h2 data-id="heading-2">æœ€ä½³å®è·µ</h2>
<p><strong>æ•´ä½“æµç¨‹</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8dfd66e5876f43d68c01b0d8173ad935~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTGFuTGFuY2U=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771299915&amp;x-signature=p3Be7rSi5EUHbOrmL4Tzm%2BIXafI%3D" alt="" loading="lazy"/></p>
<p><strong>Fory å®ä¾‹å¤ç”¨</strong></p>
<p>åˆ›å»º Fory æˆæœ¬å¾ˆé«˜ï¼Œå§‹ç»ˆå¤ç”¨å®ä¾‹ï¼Œä¸¥ç¦åœ¨æ¯æ¬¡è¯·æ±‚ä¸­é€šè¿‡ <code>new Fory()</code> åˆ›å»ºå®ä¾‹ï¼Œåº”ä½¿ç”¨ <code>ThreadSafeFory</code> æˆ–è€… <code>ThreadLocal</code> æ¥å¤ç”¨å®ä¾‹ã€‚åŒæ—¶æŒ‰ ID æ³¨å†Œç±»ä¼šæœ‰æ›´å¥½çš„æ€§èƒ½å’Œæ›´å°çš„ç©ºé—´å¼€é”€ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> ThreadSafeFory FORY_INSTANCE;

<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Map&lt;Class&lt;?&gt;, Integer&gt; REGISTERED_CLASSES_WITH_IDS = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedHashMap</span>&lt;&gt;();
<span class="hljs-keyword">static</span> {
    REGISTERED_CLASSES_WITH_IDS.put(LbsRecallCacheBO.class, <span class="hljs-number">1</span>);
    REGISTERED_CLASSES_WITH_IDS.put(ActivityPoiDocument.class, <span class="hljs-number">2</span>);
    REGISTERED_CLASSES_WITH_IDS.put(SkuSolrVo.class, <span class="hljs-number">3</span>);
    REGISTERED_CLASSES_WITH_IDS.put(PoiScore.class, <span class="hljs-number">4</span>);
}
</code></pre>
<p><strong>Zstd è§£å‹ç²¾ç¡®åˆ†é…</strong></p>
<p>Zstd åœ¨è§£å‹æ—¶ï¼Œå¦‚æœèƒ½é¢„å…ˆçŸ¥é“è§£å‹åçš„æ•°æ®å¤§å°ï¼Œå°±å¯ä»¥ç›´æ¥åˆ†é…ç²¾ç¡®çš„å†…å­˜ç©ºé—´ï¼Œé¿å…å¤šæ¬¡å†…å­˜æ‰©å®¹æˆ–åˆ†é…è¿‡å¤§çš„ç¼“å†²åŒºã€‚æœ€ä½³å®è·µæ˜¯åœ¨å‹ç¼©åçš„å­—èŠ‚æ•°ç»„å¤´éƒ¨æ‰‹åŠ¨å†™å…¥åŸå§‹æ•°æ®çš„é•¿åº¦ï¼ˆæˆ–è€…ä½¿ç”¨ <em>ZSTD_getFrameContentSize</em> APIï¼‰ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">byte</span>[] serializeAndCompress(Object object) {
    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">if</span> (object == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[<span class="hljs-number">0</span>];
        }
        <span class="hljs-type">byte</span>[] serializedData = FORY_INSTANCE.serializeJavaObject(object);
        <span class="hljs-keyword">if</span> (serializedData == <span class="hljs-literal">null</span> || serializedData.length == <span class="hljs-number">0</span>) {
            LOGGER.warn(<span class="hljs-string">"Serialized data is empty for object: {}"</span>, object.getClass().getName());
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[<span class="hljs-number">0</span>];
        }
        <span class="hljs-type">byte</span>[] compressedData = Zstd.compress(serializedData, ZSTD_COMPRESSION_LEVEL);
        <span class="hljs-type">ByteBuffer</span> <span class="hljs-variable">buffer</span> <span class="hljs-operator">=</span> ByteBuffer.allocate(HEADER_SIZE + compressedData.length);
        buffer.putInt(serializedData.length);
        buffer.put(compressedData);
        <span class="hljs-keyword">return</span> buffer.array();
    } <span class="hljs-keyword">catch</span> (Exception e) {
        LOGGER.error(<span class="hljs-string">"Fory+Zstd serialization failed for object: {}"</span>, object.getClass().getName(), e);
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"Fory+Zstd serialization failed"</span>, e);
    }
}
</code></pre>
<h2 data-id="heading-3">ä¼˜åŒ–æ•ˆæœ</h2>
<p>æŸæ ¸å¿ƒè¥é”€é¡µé¢ï¼ˆè„±æ•ï¼‰æ­£å¸¸å¬å› TP90 59.4msï¼Œä½¿ç”¨ç¼“å­˜å¬å› TP90 1.6msï¼ŒåŒæ—¶åˆé«˜å³°è¯¥é¡µé¢ç¼“å­˜å‘½ä¸­ç‡ 80% å·¦å³ã€‚ä¸”åœ¨ 10 ä¸‡ QPS çš„å…¥å£æµé‡ä¸‹ TP90 èƒ½å¤Ÿä¿è¯ 2ms ä»¥å†…ï¼ŒValue å¤§å°å‡å°äº 100Kbã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä½¿ç”¨bufio Writeræ—¶ï¼Œæ‰‹åŠ¨è°ƒç”¨Flush()çš„å¿…è¦æ€§]]></title>    <link>https://juejin.cn/post/7604741630448648226</link>    <guid>https://juejin.cn/post/7604741630448648226</guid>    <pubDate>2026-02-10T03:23:16.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604741630448648226" data-draft-id="7604779604124893184" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä½¿ç”¨bufio Writeræ—¶ï¼Œæ‰‹åŠ¨è°ƒç”¨Flush()çš„å¿…è¦æ€§"/> <meta itemprop="keywords" content="Go"/> <meta itemprop="datePublished" content="2026-02-10T03:23:16.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="cppgo"/> <meta itemprop="url" content="https://juejin.cn/user/1924620895400932"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä½¿ç”¨bufio Writeræ—¶ï¼Œæ‰‹åŠ¨è°ƒç”¨Flush()çš„å¿…è¦æ€§
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1924620895400932/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    cppgo
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T03:23:16.000Z" title="Tue Feb 10 2026 03:23:16 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
	<span class="hljs-string">"bytes"</span>
	<span class="hljs-string">"bufio"</span>
	<span class="hljs-string">"fmt"</span>
)

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
	buf := &amp;bytes.Buffer{}

	wr := bufio.NewWriter(buf)
	wr.Write([]<span class="hljs-type">byte</span>(<span class="hljs-string">"1234"</span>))

	fmt.Println(<span class="hljs-string">"buf:"</span>, buf.String())
}
</code></pre>
<p>ã€€ã€€å†…å®¹æ²¡æœ‰å†™åˆ°bufï¼š</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">go</span> run iotest.<span class="hljs-keyword">go</span>
buf:
</code></pre>
<p>ã€€ã€€æ·»åŠ Flushï¼š</p>
<pre><code class="hljs language-css" lang="css">package <span class="hljs-selector-tag">main</span>

import (
	"bytes"
	"bufio"
	"fmt"
)

func <span class="hljs-selector-tag">main</span>() {
	buf := &amp;bytes.Buffer{}

	wr := bufio.<span class="hljs-built_in">NewWriter</span>(buf)
	wr.<span class="hljs-built_in">Write</span>([]<span class="hljs-built_in">byte</span>(<span class="hljs-string">"1234"</span>))
	wr.<span class="hljs-built_in">Flush</span>()

	fmt.<span class="hljs-built_in">Println</span>(<span class="hljs-string">"buf:"</span>, buf.<span class="hljs-built_in">String</span>())
}
</code></pre>
<p>ã€€ã€€è¾“å‡ºï¼š</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">go</span> run iotest.<span class="hljs-keyword">go</span>
buf: <span class="hljs-number">1234</span>
</code></pre>
<p>ã€€ã€€æŸ¥çœ‹è¿™å—çš„æºç :</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/afe89e59c9e740e28309d0c0a9830f65~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY3BwZ28=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771298655&amp;x-signature=t9YKQUINaBtq2IHYcO05lbYbtLw%3D" alt="" loading="lazy"/></p>
<p>Â </p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œåªæœ‰åœ¨bufferå†™æ»¡ï¼ˆé»˜è®¤4KBï¼‰åï¼Œæ‰ä¼šä¸»åŠ¨è°ƒFlush()æŠŠbufferå†…å®¹å†™å…¥åº•å±‚ioã€‚æˆ–è€…å†™å…¥çš„æ•°æ®å¾ˆå¤§è¶…è¿‡bufferé•¿åº¦ï¼Œä¼šç›´æ¥å†™å…¥åº•å±‚ioã€‚</p>
<p>æ‰€ä»¥ï¼Œä½¿ç”¨bufio Writeræ—¶ï¼Œåœ¨é€‚å½“ä½ç½®æ‰‹åŠ¨è°ƒç”¨Flush()æ‰æ¯”è¾ƒç¨³å¦¥ã€‚</p>
<p>ã€è¿ç§»ã€‘<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.cnblogs.com%2Fzxq89%2Fp%2F16737371.html" target="_blank" title="https://www.cnblogs.com/zxq89/p/16737371.html" ref="nofollow noopener noreferrer">www.cnblogs.com/zxq89/p/167â€¦</a> posted @Â 2022-09-28 11:19</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[SpringBootä¸­ç»“åˆMySQLã€Redisï¼Œå®ç°å¼‚æ­¥è½åº“çš„è¯„è®ºç‚¹èµ/æ‹‰è¸©åŠŸèƒ½]]></title>    <link>https://juejin.cn/post/7604697194795974666</link>    <guid>https://juejin.cn/post/7604697194795974666</guid>    <pubDate>2026-02-10T03:24:43.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604697194795974666" data-draft-id="7604775190211870730" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="SpringBootä¸­ç»“åˆMySQLã€Redisï¼Œå®ç°å¼‚æ­¥è½åº“çš„è¯„è®ºç‚¹èµ/æ‹‰è¸©åŠŸèƒ½"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2026-02-10T03:24:43.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="PersonalViolet"/> <meta itemprop="url" content="https://juejin.cn/user/502926347091433"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            SpringBootä¸­ç»“åˆMySQLã€Redisï¼Œå®ç°å¼‚æ­¥è½åº“çš„è¯„è®ºç‚¹èµ/æ‹‰è¸©åŠŸèƒ½
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/502926347091433/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    PersonalViolet
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T03:24:43.000Z" title="Tue Feb 10 2026 03:24:43 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»14åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">æ¦‚è¦</h2>
<p>è¯¥æ–¹æ¡ˆæ˜¯ä¸€ä¸ªå…¸å‹çš„<strong>ç”¨ç©ºé—´ï¼ˆRedisç¼“å­˜ï¼‰å’Œå¼‚æ­¥åŒ–æ¢å–æ—¶é—´ï¼ˆå“åº”é€Ÿåº¦ï¼‰å’Œç³»ç»Ÿç¨³å®šæ€§ï¼ˆæ•°æ®åº“æŠ—å‹ï¼‰</strong> çš„æ¶æ„è®¾è®¡ã€‚å®ƒéå¸¸é€‚åˆç‚¹èµè¿™ç±»<strong>å†™å¤šè¯»å¤šã€å¯¹å®æ—¶ä¸€è‡´æ€§è¦æ±‚ç¨ä½</strong>çš„ä¸šåŠ¡åœºæ™¯ã€‚</p>
<h2 data-id="heading-1">å‰è¨€</h2>
<p>å­¦ä¹ javaè¿‡ç¨‹ä¸­çš„å¿ƒå¾—ï¼Œå¦‚æœ‰é”™è¯¯è¯·æé†’ä½œè€…çº æ­£ï¼Œæ„Ÿè°¢ä¸å°½ï¼ï¼ï¼</p>
<p>å¦‚æœæœ‰æ›´å¥½çš„å®ç°ï¼Œæ¬¢è¿åˆ†äº«ï¼ï¼ï¼</p>
<h3 data-id="heading-2">å½“å‰å®ç°ä¼˜ç‚¹</h3>
<ol>
<li>
<p><strong>é«˜æ€§èƒ½ä¸ä½å»¶è¿Ÿ</strong>ï¼š</p>
<ul>
<li><strong>å†™æ“ä½œå¿«</strong>ï¼šç”¨æˆ·ç‚¹èµ/æ‹‰è¸©è¯·æ±‚ç›´æ¥æ“ä½œå†…å­˜æ•°æ®åº“Redisï¼Œå“åº”é€Ÿåº¦æå¿«ï¼Œç”¨æˆ·ä½“éªŒå¥½ã€‚</li>
<li><strong>æ•°æ®åº“åœ¨å®šæ—¶ä»»åŠ¡è§¦å‘å‰å‹åŠ›å°</strong>ï¼šé«˜é¢‘çš„å†™æ“ä½œè¢«Redisæ‰¿æ¥ï¼Œé¿å…äº†ç›´æ¥å†²å‡»MySQL</li>
</ul>
</li>
<li>
<p><strong>æ•°æ®ä¸€è‡´æ€§ä¿éšœ</strong>ï¼š</p>
<ul>
<li><strong>åŸå­æ€§æ“ä½œ</strong>ï¼šä½¿ç”¨<strong>Luaè„šæœ¬</strong>åœ¨Rediså†…å®ŒæˆçŠ¶æ€åˆ‡æ¢ï¼ˆç‚¹èµ-&gt;æ‹‰è¸©-&gt;æ— çŠ¶æ€ï¼‰ï¼Œä¿è¯äº†â€œä¸€ä¸ªè¯„è®ºåŒä¸€æ—¶åˆ»åªèƒ½æœ‰ä¸€ç§çŠ¶æ€â€çš„ä¸šåŠ¡é€»è¾‘çš„åŸå­æ€§ï¼Œé˜²æ­¢å¹¶å‘è¯·æ±‚å¯¼è‡´çš„æ•°æ®é”™ä¹±ã€‚</li>
<li><strong>åˆ†å¸ƒå¼é”</strong>ï¼šå¯¹å•ä¸ªç”¨æˆ·çš„æ“ä½œåŠ é”ï¼ˆ<code>RLock</code>ï¼‰ï¼Œé˜²æ­¢åŒä¸€ç”¨æˆ·æçŸ­æ—¶é—´å†…çš„é‡å¤æäº¤é€ æˆç¼“å­˜æ•°æ®é—®é¢˜ã€‚</li>
</ul>
</li>
<li>
<p><strong>æ‰¹é‡å¤„ç†æ•ˆç‡é«˜</strong>ï¼š</p>
<ul>
<li><strong>å¼‚æ­¥è½åº“</strong>ï¼šå®šæ—¶ä»»åŠ¡å°†ç¼“å­˜ä¸­çš„å¤§é‡å˜æ›´é›†ä¸­èµ·æ¥ï¼Œé€šè¿‡<strong>æ‰¹é‡æ’å…¥/æ›´æ–°</strong>ï¼ˆ<code>ON DUPLICATE KEY UPDATE</code>ï¼‰å’Œ<strong>æ‰¹é‡æ›´æ–°ç»Ÿè®¡</strong>ï¼ˆ<code>CASE WHEN</code>ï¼‰çš„æ–¹å¼ä¸æ•°æ®åº“äº¤äº’ï¼Œæå¤§åœ°å‡å°‘äº†ç½‘ç»œI/Oå’ŒSQLæ‰§è¡Œæ¬¡æ•°ï¼Œæ•°æ®åº“å¤„ç†æ•ˆç‡é«˜ã€‚</li>
</ul>
</li>
</ol>
<h3 data-id="heading-3"><strong>å½“å‰å®ç°å­˜åœ¨é—®é¢˜</strong></h3>
<ol>
<li>
<p>å®šæ—¶ä»»åŠ¡å¼•å‘çš„æ•°æ®åº“å³°å€¼ï¼š</p>
<ol>
<li><strong>å¯é€šè¿‡ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—å‰Šå³°å¡«è°·</strong></li>
<li><strong>å°†å®šæ—¶ä»»åŠ¡ä»å¤„ç†å…¨éƒ¨æ•°æ®æ”¹ä¸ºå¤„ç†éƒ¨åˆ†æ•°æ®ï¼Œå®šæ—¶ä»»åŠ¡çš„å‘¨æœŸè°ƒä½</strong></li>
</ol>
</li>
</ol>
<h2 data-id="heading-4">ä¸»è¦å®ç°ç»†èŠ‚</h2>
<p>Redis + Redisåˆ†å¸ƒå¼é” + åŸå­æ“ä½œ + å¼‚æ­¥è½åº“ + SpringBootå®šæ—¶ä»»åŠ¡</p>
<h2 data-id="heading-5">æµç¨‹å›¾</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2dab1bc3269c407dac3ef72a7a66f5f6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUGVyc29uYWxWaW9sZXQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771298683&amp;x-signature=A4FfvkVAxdaVUCby1PfCawMtG9c%3D" alt="ç‚¹èµæ‹‰è¸©æ— çŠ¶æ€æ–¹æ¡ˆ2.png" loading="lazy"/></p>
<h2 data-id="heading-6">è¯·æ±‚æ–¹æ³•è®¾è®¡</h2>
<p><strong>è¯·æ±‚URL</strong>ï¼š<code>/api/article/v1/{commentId}/vote</code></p>
<p><strong>è¯·æ±‚æ–¹æ³•</strong>ï¼šPUT</p>
<p><strong>è¯·æ±‚å‚æ•°</strong>ï¼štype(Integer);(type=0è¡¨ç¤ºä¿®æ”¹æˆæ— çŠ¶æ€ï¼Œtype=1è¡¨ç¤ºä¿®æ”¹æˆç‚¹èµçŠ¶æ€ï¼Œtype=-1è¡¨ç¤ºä¿®æ”¹æˆæ‹‰è¸©çŠ¶æ€)</p>
<p><strong>URLç¤ºä¾‹</strong>ï¼š/api/article/v1/{commentId}/vote?type = 1</p>
<h2 data-id="heading-7">Redisè¡¨è®¾è®¡</h2>
<p>ä¸‹è¿°ä¸‰è¡¨éƒ½ç”¨æ¥è®°å½•ç”¨æˆ·å¯¹è¯„è®ºçš„çŠ¶æ€(ç‚¹èµã€æ‹‰è¸©ã€æ— çŠ¶æ€)</p>
<h3 data-id="heading-8">articles:comments:likes:users:{userId}</h3>
<p>{userId}ä¸ºåŠ¨æ€é”®å</p>
<p><strong>Redis Set</strong>æ•°æ®ç»“æ„ï¼›</p>
<p>å­˜å‚¨çš„å€¼ï¼š{commentId}</p>
<h3 data-id="heading-9">articles:comments:dislikes:users:{userId}</h3>
<p>{userId}ä¸ºåŠ¨æ€é”®å</p>
<p><strong>Redis Set</strong>æ•°æ®ç»“æ„ï¼›</p>
<p>å­˜å‚¨çš„å€¼ï¼š{commentId}</p>
<h3 data-id="heading-10">articles:comments:stateless:users:{userId}</h3>
<p>{userId}ä¸ºåŠ¨æ€é”®å</p>
<p><strong>Redis Set</strong>æ•°æ®ç»“æ„ï¼›</p>
<p>å­˜å‚¨çš„å€¼ï¼š{commentId}</p>
<h2 data-id="heading-11">MySQLè¡¨è®¾è®¡</h2>
<p>è¯¥åšå®¢èšç„¦å®ç°ç‚¹èµ/æ‹‰è¸©åŠŸèƒ½ï¼Œæ¶‰åŠx_article_commentsè¡¨ä¸å¤šï¼Œæ•…ä¸åšx_article_commentsè¡¨çš„å­—æ®µä»‹ç»</p>
<ul>
<li>
<p>x_article_comments_votes</p>
<ul>
<li>è”åˆä¸»é”®(comment_id, user_id)</li>
<li>voteå­—æ®µè¡¨ç”¨æˆ·å¯¹è¯„è®ºçš„çŠ¶æ€ï¼Œ1ä»£è¡¨ç‚¹èµï¼Œ-1ä»£è¡¨æ‹‰è¸©ï¼Œ0ä»£è¡¨æ— çŠ¶æ€ï¼Œå³ä¸å¤„äºç‚¹èµçŠ¶æ€æˆ–æ‹‰è¸©çŠ¶æ€</li>
</ul>
</li>
</ul>

<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- æ–‡ç« è¯„è®ºè¡¨</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> x_article_comments (
  id <span class="hljs-type">BIGINT</span> AUTO_INCREMENT <span class="hljs-keyword">PRIMARY</span> KEY,
  article_id <span class="hljs-type">BIGINT</span> UNSIGNED <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>, Â  Â  Â  Â  Â  Â <span class="hljs-comment">-- å…³è”çš„æ–‡ç« </span>
  parent_id <span class="hljs-type">BIGINT</span> UNSIGNED <span class="hljs-keyword">NULL</span>, Â  Â  Â  Â  Â  Â  Â  <span class="hljs-comment">-- NULL è¡¨ç¤ºé¡¶çº§è¯„è®ºï¼›å¦åˆ™æ˜¯å›å¤</span>
  root_id <span class="hljs-type">BIGINT</span> UNSIGNED <span class="hljs-keyword">NULL</span>, Â  Â  Â  Â  Â  Â  Â  Â  <span class="hljs-comment">-- åŒä¸€Threadçš„Rootè¯„è®º idï¼ˆä¾¿äºæŸ¥è¯¢æ•´ä¸ªThreadï¼‰</span>
  user_id <span class="hljs-type">BIGINT</span> UNSIGNED <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>, Â  Â  Â  Â  Â  Â  <span class="hljs-comment">-- è¯„è®ºä½œè€…</span>
  content TEXT <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
 Â status TINYINT <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">1</span>, Â  Â  Â  Â  Â  Â <span class="hljs-comment">-- 1=æ˜¾ç¤º,0=å·²åˆ é™¤/éšè—,2=å¾…å®¡æ ¸ ç­‰</span>
  like_count <span class="hljs-type">INT</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span>,
  dislike_count <span class="hljs-type">INT</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span>,
  reply_count <span class="hljs-type">INT</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span>, <span class="hljs-comment">-- è¯¥å±‚å­©å­çš„æ•°é‡</span>
  reply_descendant_count <span class="hljs-type">INT</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span>, <span class="hljs-comment">-- è¯¥å±‚åä»£çš„æ•°é‡</span>
  version <span class="hljs-type">INT</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span>, Â  Â  Â  Â  Â  Â  Â  <span class="hljs-comment">-- ä¹è§‚é”ï¼ˆæ›´æ–°æ—¶æ ¡éªŒï¼‰</span>
  create_time DATETIME <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>,
  update_time DATETIME <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> <span class="hljs-keyword">ON</span> <span class="hljs-keyword">UPDATE</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>,
â€‹
 Â <span class="hljs-keyword">PRIMARY</span> KEY (id)
) ENGINE<span class="hljs-operator">=</span>InnoDB
 Â <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8mb4
 Â <span class="hljs-keyword">COLLATE</span><span class="hljs-operator">=</span>utf8mb4_unicode_ci;
â€‹
<span class="hljs-comment">-- ç‚¹èµ/è¸©è¡¨ï¼ˆæ¯ä¸ªç”¨æˆ·å¯¹æŸæ¡è¯„è®ºçš„åŠ¨ä½œï¼‰</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> x_article_comments_votes (
  comment_id <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  user_id <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  vote TINYINT <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>, <span class="hljs-comment">-- 1=like, -1=dislike, 0=none</span>
  create_time DATETIME <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>,
  update_time DATETIME <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> <span class="hljs-keyword">ON</span> <span class="hljs-keyword">UPDATE</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>,
 Â <span class="hljs-keyword">PRIMARY</span> KEY (comment_id, user_id)
) ENGINE<span class="hljs-operator">=</span>InnoDB
 Â <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8mb4
 Â <span class="hljs-keyword">COLLATE</span><span class="hljs-operator">=</span>utf8mb4_unicode_ci;
</code></pre>
<h2 data-id="heading-12">åç«¯å®ç°ç»†èŠ‚</h2>
<h3 data-id="heading-13">å¤„ç†ç”¨æˆ·å‘èµ·çš„ç‚¹èµ/æ‹‰è¸©/æ— çŠ¶æ€è¯·æ±‚</h3>
<h4 data-id="heading-14">Controllerå±‚</h4>
<h5 data-id="heading-15">æ ¡éªŒå‚æ•°</h5>
<p>å…ˆæ ¡éªŒå½“å‰ç”¨æˆ·æ˜¯å¦ç™»å½•ï¼ŒuserReadApi.getCurrentUserId()æ˜¯æˆ‘å°è£…å¥½çš„æ–¹æ³•ï¼Œç”¨äºè·å–å‘èµ·å½“å‰è¯·æ±‚çš„ç”¨æˆ·ID</p>
<pre><code class="hljs language-ini" lang="ini"> Â  Â  Â  Â // è·å–å½“å‰ç”¨æˆ·ID
 Â  Â  Â  Â Long <span class="hljs-attr">userId</span> = userReadApi.getCurrentUserId()<span class="hljs-comment">;</span>
 Â  Â  Â  Â if (<span class="hljs-attr">userId</span> == null) {
 Â  Â  Â  Â  Â  Â return AjaxResult.error(HttpStatus.UNAUTHORIZED, "ç”¨æˆ·æœªç™»å½•æˆ–è·å–ç”¨æˆ·IDå¤±è´¥")<span class="hljs-comment">;</span>
 Â  Â  Â   }
</code></pre>
<h5 data-id="heading-16">å®Œæ•´ä»£ç </h5>
<pre><code class="hljs language-less" lang="less"> Â  Â <span class="hljs-comment">/**
 Â  Â  * ç‚¹èµ/æ‹‰è¸©/æ— çŠ¶æ€è¯„è®º
 Â  Â  */</span>
 Â  Â <span class="hljs-variable">@PutMapping</span>(<span class="hljs-string">"/{commentId}/vote"</span>)
 Â  Â public AjaxResult <span class="hljs-built_in">voteComment</span>(
 Â  Â  Â  Â  Â  Â <span class="hljs-variable">@PathVariable</span>(<span class="hljs-string">"commentId"</span>) Long commentId,
 Â  Â  Â  Â  Â  Â <span class="hljs-variable">@RequestParam</span>(<span class="hljs-string">"type"</span>) Integer type
 Â   ) {
 Â  Â  Â  Â <span class="hljs-selector-tag">log</span><span class="hljs-selector-class">.info</span>(<span class="hljs-string">"è¿›å…¥è¯·æ±‚ /api/article/v1/{}/vote -&gt; ç‚¹èµ/å–æ¶ˆç‚¹èµè¯„è®º type={}"</span>, commentId, type);
â€‹
 Â  Â  Â  Â <span class="hljs-comment">// è·å–å½“å‰ç”¨æˆ·ID</span>
 Â  Â  Â  Â <span class="hljs-selector-tag">Long</span> <span class="hljs-selector-tag">userId</span> = <span class="hljs-selector-tag">userReadApi</span><span class="hljs-selector-class">.getCurrentUserId</span>();
 Â  Â  Â  Â <span class="hljs-selector-tag">if</span> (userId == null) {
 Â  Â  Â  Â  Â  Â <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">AjaxResult</span><span class="hljs-selector-class">.error</span>(HttpStatus.UNAUTHORIZED, <span class="hljs-string">"ç”¨æˆ·æœªç™»å½•æˆ–è·å–ç”¨æˆ·IDå¤±è´¥"</span>);
 Â  Â  Â   }
â€‹
â€‹
 Â  Â  Â  Â <span class="hljs-selector-tag">articleService</span><span class="hljs-selector-class">.voteComment</span>(userId, commentId, type);
â€‹
 Â  Â  Â  Â <span class="hljs-selector-tag">log</span><span class="hljs-selector-class">.info</span>(<span class="hljs-string">"è¿”å›ç»“æœ /api/article/v1/{}/vote -&gt; OK"</span>, commentId);
 Â  Â  Â  Â <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">AjaxResult</span><span class="hljs-selector-class">.success</span>();
 Â   }
</code></pre>
<h4 data-id="heading-17">Serviceå±‚</h4>
<h5 data-id="heading-18">æ ¡éªŒå‚æ•°</h5>
<pre><code class="hljs language-typescript" lang="typescript"> Â  Â  Â  Â <span class="hljs-comment">// 1. å‚æ•°æ ¡éªŒ</span>
 Â  Â  Â  Â <span class="hljs-keyword">if</span> (commentId == <span class="hljs-literal">null</span> || <span class="hljs-keyword">type</span> == <span class="hljs-literal">null</span>) {
 Â  Â  Â  Â  Â  Â <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClientException</span>(<span class="hljs-title class_">HttpStatus</span>.<span class="hljs-property">BAD_REQUEST</span>, <span class="hljs-string">"å‚æ•°ä¸å®Œæ•´"</span>);
 Â  Â  Â   }
 Â  Â  Â  Â <span class="hljs-keyword">if</span> (<span class="hljs-keyword">type</span> != <span class="hljs-title class_">ArticleCommentVoteConstants</span>.<span class="hljs-property">LIKE</span> &amp;&amp; <span class="hljs-keyword">type</span> != <span class="hljs-title class_">ArticleCommentVoteConstants</span>.<span class="hljs-property">DISLIKE</span> &amp;&amp; <span class="hljs-keyword">type</span> != <span class="hljs-title class_">ArticleCommentVoteConstants</span>.<span class="hljs-property">STATELESS</span>) {
 Â  Â  Â  Â  Â  Â <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClientException</span>(<span class="hljs-title class_">HttpStatus</span>.<span class="hljs-property">BAD_REQUEST</span>, <span class="hljs-string">"æŠ•ç¥¨ç±»å‹éæ³•"</span>);
 Â  Â  Â   }
â€‹
 Â  Â  Â  Â <span class="hljs-comment">// 2. æ ¡éªŒè¯„è®ºæ˜¯å¦å­˜åœ¨</span>
 Â  Â  Â  Â <span class="hljs-title class_">ArticleComment</span> comment = articleCommentMapper.<span class="hljs-title function_">selectArticleCommentById</span>(commentId);
 Â  Â  Â  Â <span class="hljs-keyword">if</span> (comment == <span class="hljs-literal">null</span>) {
 Â  Â  Â  Â  Â  Â <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClientException</span>(<span class="hljs-title class_">HttpStatus</span>.<span class="hljs-property">NOT_FOUND</span>, <span class="hljs-string">"è¯„è®ºä¸å­˜åœ¨"</span>);
 Â  Â  Â   }
</code></pre>
<h5 data-id="heading-19">åˆ†å¸ƒå¼é” + luaè„šæœ¬</h5>
<p>ä½¿ç”¨äº†redissonå®ç°åŠ é”ï¼Œå¹¶ä½¿ç”¨äº†luaè„šæœ¬ä¿è¯åŸå­æ€§ï¼Œä»è€Œé˜²æ­¢ç”¨æˆ·é¢‘ç¹å‘èµ·è¯·æ±‚å¯¼è‡´åœ¨redisç¼“å­˜çš„æ•°æ®å‡ºç°é”™è¯¯çš„æƒ…å†µ</p>
<h6 data-id="heading-20"><strong>åˆ†å¸ƒå¼é”ç›¸å…³ä»£ç </strong></h6>
<pre><code class="hljs language-csharp" lang="csharp"> Â  Â  Â  Â <span class="hljs-comment">// 5. å°è¯•è·å–åˆ†å¸ƒå¼é”</span>
 Â  Â  Â  Â RLock <span class="hljs-keyword">lock</span> = redisson.getLock(RedisKeyConstants.ARTICLES_COMMENTS_VOTES_LOCK_KEY + userId);
 Â  Â  Â  Â boolean isLocked = <span class="hljs-literal">false</span>;
 Â  Â  Â  Â <span class="hljs-keyword">try</span> {
 Â  Â  Â  Â  Â  Â isLocked = <span class="hljs-keyword">lock</span>.tryLock(<span class="hljs-number">0</span>, RedisKeyConstants.ARTICLES_COMMENTS_VOTES_LOCK_KEY_EXPIRE_TIME, TimeUnit.SECONDS);
 Â  Â  Â  Â  Â  Â <span class="hljs-keyword">if</span> (!isLocked) {
 Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ClientException(HttpStatus.SERVICE_UNAVAILABLE, <span class="hljs-string">"ç³»ç»Ÿç¹å¿™ï¼Œè¯·ç¨åå†è¯•"</span>);
 Â  Â  Â  Â  Â   } <span class="hljs-keyword">else</span> {
 Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-comment">// è·å–åˆ°é”ï¼Œæ‰§è¡ŒæŠ•ç¥¨é€»è¾‘ï¼Œæ­¤å¤„çœç•¥</span>
 Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-comment">// ...</span>
 Â  Â  Â  Â  Â   }
 Â  Â  Â   } <span class="hljs-keyword">catch</span> (InterruptedException e) {
 Â  Â  Â  Â  Â  Â Thread.currentThread().interrupt();
 Â  Â  Â  Â  Â  Â <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ClientException(HttpStatus.ERROR, <span class="hljs-string">"ç³»ç»Ÿç¹å¿™ï¼Œè¯·ç¨åå†è¯•"</span>);
 Â  Â  Â   } <span class="hljs-keyword">finally</span> {
 Â  Â  Â  Â  Â  Â <span class="hljs-keyword">if</span> (isLocked &amp;&amp; <span class="hljs-keyword">lock</span>.isHeldByCurrentThread()) {
 Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-keyword">lock</span>.unlock();
 Â  Â  Â  Â  Â  Â  Â  Â log.info(<span class="hljs-string">"ç”¨æˆ· {} çš„é”å·²é‡Šæ”¾"</span>, userId);
 Â  Â  Â  Â  Â   }
 Â  Â  Â   }
</code></pre>
<h6 data-id="heading-21">luaè„šæœ¬ç›¸å…³ä»£ç </h6>
<p><strong>é¢„å…ˆå‡†å¤‡å¥½redisé”®å’Œluaè„šæœ¬</strong></p>
<pre><code class="hljs language-ini" lang="ini"> Â  Â  Â  Â // 3. æ„å»º Redis é”®
 Â  Â  Â  Â String <span class="hljs-attr">likeKey</span> = RedisKeyConstants.ARTICLES_COMMENTS_LIKES_USERS_KEY + userId<span class="hljs-comment">;</span>
 Â  Â  Â  Â String <span class="hljs-attr">dislikeKey</span> = RedisKeyConstants.ARTICLES_COMMENTS_DISLIKES_USERS_KEY + userId<span class="hljs-comment">;</span>
 Â  Â  Â  Â String <span class="hljs-attr">statelessKey</span> = RedisKeyConstants.ARTICLES_COMMENTS_STATELESS_USERS_KEY + userId<span class="hljs-comment">;</span>
 Â  Â  Â  Â // 4. æ ¹æ®æŠ•ç¥¨ç±»å‹å¤„ç†é€»è¾‘
 Â  Â  Â  Â DefaultRedisScript&lt;Long&gt; <span class="hljs-attr">deleteScript</span> = new DefaultRedisScript&lt;&gt;()<span class="hljs-comment">;</span>
 Â  Â  Â  Â deleteScript.setScriptSource(new ResourceScriptSource(new ClassPathResource(RedisLuaConstants.ARTICLE_COMMENTS_VOTE_LUA_SCRIPT_PATH)))<span class="hljs-comment">;</span>
 Â  Â  Â  Â deleteScript.setResultType(Long.class)<span class="hljs-comment">;</span>
 Â  Â  Â  Â Long <span class="hljs-attr">execute</span> = null<span class="hljs-comment">;</span>
</code></pre>
<p><strong>luaè„šæœ¬æ–‡ä»¶</strong></p>
<p>luaè„šæœ¬èƒ½å¤Ÿ<strong>ä¿è¯åŸå­æ€§</strong>ï¼Œè‹¥ç”¨æˆ·é¢‘ç¹å‘èµ·è¯·æ±‚ä¹Ÿèƒ½ä¿è¯<strong>ä»¥ä¸‹çš„è¦æ±‚</strong></p>
<p>ä¸‰ä¸ªé”®å¯¹åº”çš„seté›†åˆé‡Œçš„å€¼åº”<strong>ä¿æŒäº’æ–¥</strong>ï¼Œåªå…è®¸ä¸€ä¸ªå€¼å¦‚3åªèƒ½å‡ºç°åœ¨ä¸€ä¸ªé”®ï¼Œä¾‹å¦‚ï¼šå…±æœ‰ä¸‰ä¸ªé”®like:{userId}ã€dislike:{userId}ã€stateless:{userId}ï¼Œé”®likeç°åœ¨æŒæœ‰3ï¼Œç”¨æˆ·å¯¹commentId = 3å‘èµ·äº†ç‚¹èµ/æ‹‰è¸©/æ— çŠ¶æ€è¯·æ±‚ï¼Œä¿®æ”¹ä¸ºæ‹‰è¸©ï¼Œæ­¤æ—¶è¦å»é™¤like:{userId}é”®å’Œstateless:{userId}é”®çš„seté›†åˆä¸­å€¼ä¸º3çš„å…ƒç´ ï¼Œæ‰§è¡Œå®Œååªæœ‰é”®dislike:{userId}å­˜åœ¨å€¼3</p>
<pre><code class="hljs language-lua" lang="lua"><span class="hljs-comment">-- Lua è„šæœ¬ï¼šå¤„ç†è¯„è®ºæŠ•ç¥¨é€»è¾‘</span>
<span class="hljs-keyword">local</span> mainKey = KEYS[<span class="hljs-number">1</span>] Â  Â  Â  <span class="hljs-comment">-- è¿›è¡Œaddçš„é”®</span>
<span class="hljs-keyword">local</span> srem1Key = KEYS[<span class="hljs-number">2</span>] Â  Â <span class="hljs-comment">-- è¿›è¡Œsremçš„é”®</span>
<span class="hljs-keyword">local</span> srem2Key = KEYS[<span class="hljs-number">3</span>] Â <span class="hljs-comment">-- è¿›è¡Œsremçš„é”®</span>
<span class="hljs-keyword">local</span> commentId = ARGV[<span class="hljs-number">1</span>] Â  Â  <span class="hljs-comment">-- è¯„è®º ID</span>
â€‹
<span class="hljs-comment">-- æ·»åŠ åˆ°mainé›†åˆ</span>
redis.call(<span class="hljs-string">'SADD'</span>, mainKey, commentId)
â€‹
<span class="hljs-comment">-- ä»ä¸¤ä¸ªé›†åˆä¸­ç§»é™¤</span>
redis.call(<span class="hljs-string">'SREM'</span>, srem1Key, commentId)
redis.call(<span class="hljs-string">'SREM'</span>, srem2Key, commentId)
â€‹
<span class="hljs-comment">-- è¿”å›æ“ä½œç»“æœï¼ˆå¯é€‰ï¼‰</span>
<span class="hljs-keyword">return</span> <span class="hljs-number">1</span> Â <span class="hljs-comment">-- è¡¨ç¤ºæˆåŠŸæ‰§è¡Œ</span>
â€‹
</code></pre>
<p><strong>è·å–åˆ°é”åï¼Œä¸ºå®ç°å­˜è¿›redisï¼Œæ‰§è¡Œçš„æ“ä½œå¦‚ä¸‹</strong></p>
<pre><code class="hljs language-vbscript" lang="vbscript"> Â  Â  Â  Â  Â  Â  Â  Â switch (type) {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-keyword">case</span> ArticleCommentVoteConstants.LIKE:
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â // <span class="hljs-number">4.</span> å¤„ç†ç‚¹èµé€»è¾‘
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-keyword">execute</span> = stringRedisTemplate.<span class="hljs-keyword">execute</span>(deleteScript, Arrays.asList(likeKey, dislikeKey, statelessKey), commentId.<span class="hljs-keyword">to</span><span class="hljs-built_in">String</span>());
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-keyword">if</span> (<span class="hljs-keyword">execute</span> == <span class="hljs-literal">null</span>) {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â throw <span class="hljs-keyword">new</span> ClientException(HttpStatus.SERVICE_UNAVAILABLE, <span class="hljs-string">"å¤„ç†ç‚¹è¸©é€»è¾‘å¤±è´¥"</span>);
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â   }
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â break;
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-keyword">case</span> ArticleCommentVoteConstants.DISLIKE:
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â // <span class="hljs-number">5.</span> å¤„ç†ç‚¹è¸©é€»è¾‘
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-keyword">execute</span> = stringRedisTemplate.<span class="hljs-keyword">execute</span>(deleteScript, Arrays.asList(dislikeKey, likeKey, statelessKey), commentId.<span class="hljs-keyword">to</span><span class="hljs-built_in">String</span>());
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-keyword">if</span> (<span class="hljs-keyword">execute</span> == <span class="hljs-literal">null</span>) {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â throw <span class="hljs-keyword">new</span> ClientException(HttpStatus.SERVICE_UNAVAILABLE, <span class="hljs-string">"å¤„ç†ç‚¹è¸©é€»è¾‘å¤±è´¥"</span>);
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â   }
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â break;
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-keyword">case</span> ArticleCommentVoteConstants.STATELESS:
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-keyword">execute</span> = stringRedisTemplate.<span class="hljs-keyword">execute</span>(deleteScript, Arrays.asList(statelessKey, dislikeKey, likeKey), commentId.<span class="hljs-keyword">to</span><span class="hljs-built_in">String</span>());
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-keyword">if</span> (<span class="hljs-keyword">execute</span> == <span class="hljs-literal">null</span>) {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â throw <span class="hljs-keyword">new</span> ClientException(HttpStatus.<span class="hljs-keyword">ERROR</span>, <span class="hljs-string">"å¤„ç†æ— çŠ¶æ€é€»è¾‘å¤±è´¥"</span>);
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â   }
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â break;
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-keyword">default</span>:
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â throw <span class="hljs-keyword">new</span> ClientException(HttpStatus.BAD_REQUEST, <span class="hljs-string">"æœªçŸ¥çš„æŠ•ç¥¨ç±»å‹"</span>);
 Â  Â  Â  Â  Â  Â  Â   }
</code></pre>
<h5 data-id="heading-22">å®Œæ•´ä»£ç </h5>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">voteComment</span><span class="hljs-params">(Long userId, Long commentId, Integer type)</span> {
        <span class="hljs-comment">// 1. å‚æ•°æ ¡éªŒ</span>
        <span class="hljs-keyword">if</span> (commentId == <span class="hljs-literal">null</span> || type == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClientException</span>(HttpStatus.BAD_REQUEST, <span class="hljs-string">"å‚æ•°ä¸å®Œæ•´"</span>);
        }
        <span class="hljs-keyword">if</span> (type != ArticleCommentVoteConstants.LIKE &amp;&amp; type != ArticleCommentVoteConstants.DISLIKE &amp;&amp; type != ArticleCommentVoteConstants.STATELESS) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClientException</span>(HttpStatus.BAD_REQUEST, <span class="hljs-string">"æŠ•ç¥¨ç±»å‹éæ³•"</span>);
        }

        <span class="hljs-comment">// 2. æ ¡éªŒè¯„è®ºæ˜¯å¦å­˜åœ¨</span>
        <span class="hljs-type">ArticleComment</span> <span class="hljs-variable">comment</span> <span class="hljs-operator">=</span> articleCommentMapper.selectArticleCommentById(commentId);
        <span class="hljs-keyword">if</span> (comment == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClientException</span>(HttpStatus.NOT_FOUND, <span class="hljs-string">"è¯„è®ºä¸å­˜åœ¨"</span>);
        }

        <span class="hljs-comment">// 3. æ„å»º Redis é”®</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">likeKey</span> <span class="hljs-operator">=</span> RedisKeyConstants.ARTICLES_COMMENTS_LIKES_USERS_KEY + userId;
        <span class="hljs-type">String</span> <span class="hljs-variable">dislikeKey</span> <span class="hljs-operator">=</span> RedisKeyConstants.ARTICLES_COMMENTS_DISLIKES_USERS_KEY + userId;
        <span class="hljs-type">String</span> <span class="hljs-variable">statelessKey</span> <span class="hljs-operator">=</span> RedisKeyConstants.ARTICLES_COMMENTS_STATELESS_USERS_KEY + userId;
        <span class="hljs-comment">// 4. æ ¹æ®æŠ•ç¥¨ç±»å‹å¤„ç†é€»è¾‘</span>
        DefaultRedisScript&lt;Long&gt; deleteScript = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultRedisScript</span>&lt;&gt;();
        deleteScript.setScriptSource(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ResourceScriptSource</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ClassPathResource</span>(RedisLuaConstants.ARTICLE_COMMENTS_VOTE_LUA_SCRIPT_PATH)));
        deleteScript.setResultType(Long.class);
        <span class="hljs-type">Long</span> <span class="hljs-variable">execute</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;
        <span class="hljs-comment">// 5. å°è¯•è·å–åˆ†å¸ƒå¼é”</span>
        <span class="hljs-type">RLock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> redisson.getLock(RedisKeyConstants.ARTICLES_COMMENTS_VOTES_LOCK_KEY + userId);
        <span class="hljs-type">boolean</span> <span class="hljs-variable">isLocked</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">try</span> {
            isLocked = lock.tryLock(<span class="hljs-number">0</span>, RedisKeyConstants.ARTICLES_COMMENTS_VOTES_LOCK_KEY_EXPIRE_TIME, TimeUnit.SECONDS);
            <span class="hljs-keyword">if</span> (!isLocked) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClientException</span>(HttpStatus.SERVICE_UNAVAILABLE, <span class="hljs-string">"ç³»ç»Ÿç¹å¿™ï¼Œè¯·ç¨åå†è¯•"</span>);
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-comment">// è·å–åˆ°é”ï¼Œæ‰§è¡ŒæŠ•ç¥¨é€»è¾‘</span>
                <span class="hljs-keyword">switch</span> (type) {
                    <span class="hljs-keyword">case</span> ArticleCommentVoteConstants.LIKE:
                        <span class="hljs-comment">// 4. å¤„ç†ç‚¹èµé€»è¾‘</span>
                        execute = stringRedisTemplate.execute(deleteScript, Arrays.asList(likeKey, dislikeKey, statelessKey), commentId.toString());
                        <span class="hljs-keyword">if</span> (execute == <span class="hljs-literal">null</span>) {
                            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClientException</span>(HttpStatus.SERVICE_UNAVAILABLE, <span class="hljs-string">"å¤„ç†ç‚¹è¸©é€»è¾‘å¤±è´¥"</span>);
                        }
                        <span class="hljs-keyword">break</span>;
                    <span class="hljs-keyword">case</span> ArticleCommentVoteConstants.DISLIKE:
                        <span class="hljs-comment">// 5. å¤„ç†ç‚¹è¸©é€»è¾‘</span>
                        execute = stringRedisTemplate.execute(deleteScript, Arrays.asList(dislikeKey, likeKey, statelessKey), commentId.toString());
                        <span class="hljs-keyword">if</span> (execute == <span class="hljs-literal">null</span>) {
                            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClientException</span>(HttpStatus.SERVICE_UNAVAILABLE, <span class="hljs-string">"å¤„ç†ç‚¹è¸©é€»è¾‘å¤±è´¥"</span>);
                        }
                        <span class="hljs-keyword">break</span>;
                    <span class="hljs-keyword">case</span> ArticleCommentVoteConstants.STATELESS:
                        execute = stringRedisTemplate.execute(deleteScript, Arrays.asList(statelessKey, dislikeKey, likeKey), commentId.toString());
                        <span class="hljs-keyword">if</span> (execute == <span class="hljs-literal">null</span>) {
                            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClientException</span>(HttpStatus.ERROR, <span class="hljs-string">"å¤„ç†æ— çŠ¶æ€é€»è¾‘å¤±è´¥"</span>);
                        }
                        <span class="hljs-keyword">break</span>;
                    <span class="hljs-keyword">default</span>:
                        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClientException</span>(HttpStatus.BAD_REQUEST, <span class="hljs-string">"æœªçŸ¥çš„æŠ•ç¥¨ç±»å‹"</span>);
                }
            }
        } <span class="hljs-keyword">catch</span> (InterruptedException e) {
            Thread.currentThread().interrupt();
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClientException</span>(HttpStatus.ERROR, <span class="hljs-string">"ç³»ç»Ÿç¹å¿™ï¼Œè¯·ç¨åå†è¯•"</span>);
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (isLocked &amp;&amp; lock.isHeldByCurrentThread()) {
                lock.unlock();
                log.info(<span class="hljs-string">"ç”¨æˆ· {} çš„é”å·²é‡Šæ”¾"</span>, userId);
            }
        }
    }
</code></pre>
<h3 data-id="heading-23">å®šæ—¶ä»»åŠ¡</h3>
<p>å®šæ—¶ä»»åŠ¡è¦å®ç°è½åº“åˆ°MySQLä¸­ï¼Œå¹¶ä¸”æ¸…ç©ºrediså¯¹åº”çš„ç¼“å­˜</p>
<h4 data-id="heading-24">åˆ›å»ºå®šæ—¶ä»»åŠ¡</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Component</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">VoteSyncScheduler</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ArticleService articleService;
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">VoteSyncScheduler</span><span class="hljs-params">(ArticleService articleService)</span> {
        <span class="hljs-built_in">this</span>.articleService = articleService;
    }

    <span class="hljs-meta">@Scheduled(fixedRate = 5 * 60 * 1000)</span> <span class="hljs-comment">// æ¯äº”åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">syncVote</span><span class="hljs-params">()</span> {
        log.info(<span class="hljs-string">"å¼€å§‹æ‰§è¡Œç‚¹èµåŒæ­¥ä»»åŠ¡..."</span>);
        <span class="hljs-type">Boolean</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> articleService.syncVote();
        log.info(<span class="hljs-string">"ç‚¹èµåŒæ­¥ä»»åŠ¡æ‰§è¡Œå®Œæˆã€‚"</span>);
    }
}
</code></pre>
<h4 data-id="heading-25">syncVoteå®ç°</h4>
<p>MySQLæ¶‰åŠæ“ä½œå¤šå¼ è¡¨ï¼Œæ‰€ä»¥éœ€è¦åœ¨æ–¹æ³•ä¸ŠåŠ ä¸Šæ³¨è§£@Transactional</p>
<p><a href="##%E6%B5%81%E7%A8%8B%E5%9B%BE" title="##%E6%B5%81%E7%A8%8B%E5%9B%BE">å‚è€ƒæµç¨‹å›¾</a></p>
<ol start="0">
<li>æˆ‘ä»¬é¦–å…ˆè¦ä»redisä¸­è·å–æ•°æ®ï¼Œå¹¶å°†æ•°æ®å°è£…åˆ°ä¸¤ä¸ªé›†åˆä¸­ã€‚</li>
<li>è½åº“åˆ°MySQL</li>
<li>æ ¹æ®x_article_comments_votesè¡¨ï¼Œé€šè¿‡SQLè¯­å¥ç»Ÿè®¡å‡ºlike_count, dislike_count</li>
<li>å°†ç»Ÿè®¡å‡ºçš„æ•°æ®æ›´æ–°åˆ°x_article_comments</li>
<li>æ¸…é™¤å·²åœ¨è¯¥å®šæ—¶ä»»åŠ¡å¤„ç†å®Œçš„redisç¼“å­˜æ•°æ®</li>
</ol>
<h5 data-id="heading-26">å˜é‡è¯´æ˜</h5>
<ul>
<li>List votes = new ArrayList&lt;&gt;(); // ä¿å­˜æ‰€æœ‰æŠ•ç¥¨æ•°æ®</li>
<li>Set TotalcommentId = new HashSet&lt;&gt;(); // ä¿å­˜æ‰€æœ‰è¯„è®ºid</li>
<li>likesUserIdToCommentIdsMapã€dislikesUserIdToCommentIdsMapã€statelessUserIdToCommentIdsMapâ€”â€”å­˜å‚¨çš„å€¼ä¸ºç»è¿‡é€»è¾‘åé”®ä¸­å·²è¢«å¤„ç†çš„å€¼ï¼Œåœ¨æœ€åä¸€æ­¥æ¸…é™¤redisç¼“å­˜å‘æŒ¥ä½œç”¨</li>
</ul>
<h5 data-id="heading-27">ä»redisä¸­è·å–æ•°æ®ï¼Œå¹¶å°†æ•°æ®å°è£…åˆ°ä¸¤ä¸ªé›†åˆä¸­</h5>
<pre><code class="hljs language-ini" lang="ini">        Set&lt;String&gt; <span class="hljs-attr">userLikesKeys</span> = stringRedisTemplate.keys(RedisKeyConstants.ARTICLES_COMMENTS_LIKES_USERS_KEY + <span class="hljs-string">"*"</span>)<span class="hljs-comment">;</span>
        Set&lt;String&gt; <span class="hljs-attr">userDislikesKeys</span> = stringRedisTemplate.keys(RedisKeyConstants.ARTICLES_COMMENTS_DISLIKES_USERS_KEY + <span class="hljs-string">"*"</span>)<span class="hljs-comment">;</span>
        Set&lt;String&gt; <span class="hljs-attr">userStatelessKeys</span> = stringRedisTemplate.keys(RedisKeyConstants.ARTICLES_COMMENTS_STATELESS_USERS_KEY + <span class="hljs-string">"*"</span>)<span class="hljs-comment">;</span>
        if (userLikesKeys.isEmpty() &amp;&amp; userDislikesKeys.isEmpty() &amp;&amp; userStatelessKeys.isEmpty()){
            log.info("æ²¡æœ‰éœ€è¦åŒæ­¥çš„æ•°æ®")<span class="hljs-comment">;</span>
            return true<span class="hljs-comment">;</span>
        }
        List&lt;ArticleCommentVote&gt; <span class="hljs-attr">votes</span> = new ArrayList&lt;&gt;()<span class="hljs-comment">;      // ä¿å­˜æ‰€æœ‰æŠ•ç¥¨æ•°æ®</span>
        Set&lt;Long&gt; <span class="hljs-attr">TotalcommentId</span> = new HashSet&lt;&gt;()<span class="hljs-comment">;     // ä¿å­˜æ‰€æœ‰è¯„è®ºid</span>
        Map&lt;Long, Set&lt;String&gt;&gt; <span class="hljs-attr">likesUserIdToCommentIdsMap</span> = new HashMap&lt;&gt;()<span class="hljs-comment">;</span>
        Map&lt;Long, Set&lt;String&gt;&gt; <span class="hljs-attr">dislikesUserIdToCommentIdsMap</span> = new HashMap&lt;&gt;()<span class="hljs-comment">;</span>
        Map&lt;Long, Set&lt;String&gt;&gt; <span class="hljs-attr">statelessUserIdToCommentIdsMap</span> = new HashMap&lt;&gt;()<span class="hljs-comment">;</span>
        for (String userLikesKey : userLikesKeys) {
            String <span class="hljs-attr">userId</span> = userLikesKey.replace(RedisKeyConstants.ARTICLES_COMMENTS_LIKES_USERS_KEY, <span class="hljs-string">""</span>)<span class="hljs-comment">;</span>
            Set&lt;String&gt; <span class="hljs-attr">commentIds</span> = stringRedisTemplate.opsForSet().members(userLikesKey)<span class="hljs-comment">;</span>
            for (String commentId : commentIds) {
                votes.add(new ArticleCommentVote(Long.parseLong(commentId), Long.parseLong(userId), ArticleCommentVoteConstants.LIKE, null, null))<span class="hljs-comment">;</span>
                TotalcommentId.add(Long.parseLong(commentId))<span class="hljs-comment">;</span>
                // æ›´æ–°æˆ–æ–°å¢likesUserIdToCommentIdsMapé”®å€¼å¯¹ï¼Œå€¼çš„seté›†åˆæ–°å¢commentId
                likesUserIdToCommentIdsMap.computeIfAbsent(Long.parseLong(userId), k -&gt; new HashSet&lt;&gt;()).add(commentId)<span class="hljs-comment">;</span>
            }
        }
        for (String userDislikesKey : userDislikesKeys) {
            String <span class="hljs-attr">userId</span> = userDislikesKey.replace(RedisKeyConstants.ARTICLES_COMMENTS_DISLIKES_USERS_KEY, <span class="hljs-string">""</span>)<span class="hljs-comment">;</span>
            Set&lt;String&gt; <span class="hljs-attr">commentIds</span> = stringRedisTemplate.opsForSet().members(userDislikesKey)<span class="hljs-comment">;</span>
            for (String commentId : commentIds) {
                votes.add(new ArticleCommentVote(Long.parseLong(commentId), Long.parseLong(userId), ArticleCommentVoteConstants.DISLIKE, null, null))<span class="hljs-comment">;</span>
                TotalcommentId.add(Long.parseLong(commentId))<span class="hljs-comment">;</span>
                // æ›´æ–°æˆ–æ–°å¢dislikesUserIdToCommentIdsMapé”®å€¼å¯¹ï¼Œå€¼çš„seté›†åˆæ–°å¢commentId
                dislikesUserIdToCommentIdsMap.computeIfAbsent(Long.parseLong(userId), k -&gt; new HashSet&lt;&gt;()).add(commentId)<span class="hljs-comment">;</span>
            }
        }
        for (String userStatelessKey : userStatelessKeys) {
            String <span class="hljs-attr">userId</span> = userStatelessKey.replace(RedisKeyConstants.ARTICLES_COMMENTS_STATELESS_USERS_KEY, <span class="hljs-string">""</span>)<span class="hljs-comment">;</span>
            Set&lt;String&gt; <span class="hljs-attr">commentIds</span> = stringRedisTemplate.opsForSet().members(userStatelessKey)<span class="hljs-comment">;</span>
            for (String commentId : commentIds) {
                votes.add(new ArticleCommentVote(Long.parseLong(commentId), Long.parseLong(userId), ArticleCommentVoteConstants.STATELESS, null, null))<span class="hljs-comment">;</span>
                TotalcommentId.add(Long.parseLong(commentId))<span class="hljs-comment">;</span>
                // æ·»åŠ åˆ°statelessUserIdToCommentIdsMapé”®å€¼å¯¹ï¼Œå€¼çš„seté›†åˆæ–°å¢commentId
                statelessUserIdToCommentIdsMap.computeIfAbsent(Long.parseLong(userId), k -&gt; new HashSet&lt;&gt;()).add(commentId)<span class="hljs-comment">;</span>
            }
        }
</code></pre>
<h5 data-id="heading-28">è½åº“åˆ°MySQL</h5>
<h6 data-id="heading-29">Serviceå±‚ç›¸å…³ä»£ç </h6>
<pre><code class="hljs language-arduino" lang="arduino">        <span class="hljs-comment">// æ ¹æ®votesæ‰§è¡Œè½åº“é€»è¾‘ï¼ˆåŒ…å«æ’å…¥/æ›´æ–°ï¼‰</span>
        <span class="hljs-keyword">if</span> (!votes.<span class="hljs-built_in">isEmpty</span>()){
            <span class="hljs-type">int</span> i = articleCommentVoteMapper.<span class="hljs-built_in">batchInsertOrUpdate</span>(votes);
            <span class="hljs-keyword">if</span> (i &lt; <span class="hljs-number">0</span>){
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">ClientException</span>(HttpStatus.ERROR, <span class="hljs-string">"æ‰¹é‡æ’å…¥æˆ–æ›´æ–°æ•°æ®å¤±è´¥"</span>);
            }
            log.<span class="hljs-built_in">info</span>(<span class="hljs-string">"æ‰¹é‡æ’å…¥æˆ–æ›´æ–°æ•°æ®æˆåŠŸï¼Œæ•°é‡ä¸ºï¼š{}"</span>, i);
        } <span class="hljs-keyword">else</span> {
            log.<span class="hljs-built_in">info</span>(<span class="hljs-string">"æ²¡æœ‰éœ€è¦è½åº“çš„æ•°æ®"</span>);
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        }
</code></pre>
<h6 data-id="heading-30">SQLè¯­å¥ç›¸å…³å®ç°</h6>
<pre><code class="hljs language-xml" lang="xml">    <span class="hljs-comment">&lt;!-- åŸæœ‰æ–¹æ³• --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">insert</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"batchInsertOrUpdate"</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">"java.util.List"</span>&gt;</span>
        INSERT INTO x_article_comments_votes (
            comment_id,
            user_id,
            vote,
            create_time,
            update_time
        )
        VALUES
        <span class="hljs-tag">&lt;<span class="hljs-name">foreach</span> <span class="hljs-attr">collection</span>=<span class="hljs-string">"list"</span> <span class="hljs-attr">item</span>=<span class="hljs-string">"item"</span> <span class="hljs-attr">separator</span>=<span class="hljs-string">","</span>&gt;</span>
            (
                #{item.commentId},
                #{item.userId},
                #{item.vote},
                NOW(),
                NOW()
            )
        <span class="hljs-tag">&lt;/<span class="hljs-name">foreach</span>&gt;</span>
        ON DUPLICATE KEY UPDATE
            vote = VALUES(vote),
            update_time = VALUES(update_time)
    <span class="hljs-tag">&lt;/<span class="hljs-name">insert</span>&gt;</span>
</code></pre>
<h5 data-id="heading-31">æ ¹æ®x_article_comments_votesè¡¨ï¼Œé€šè¿‡SQLè¯­å¥ç»Ÿè®¡å‡ºlike_count, dislike_count</h5>
<h6 data-id="heading-32">Serviceå±‚ç›¸å…³ä»£ç </h6>
<pre><code class="hljs language-ini" lang="ini">        List&lt;UpdateCommentVoteCountDTO&gt; <span class="hljs-attr">updateCommentVoteCountDTOList</span> = getCommentLikeCountAndDislikeCountByListOfCommentId(TotalcommentId)<span class="hljs-comment">;</span>
</code></pre>
<h6 data-id="heading-33">SQLè¯­å¥ç›¸å…³å®ç°</h6>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-operator">&lt;</span><span class="hljs-operator">!</span><span class="hljs-comment">-- æ–°å¢æ–¹æ³•: èšåˆæŸ¥è¯¢ç‚¹èµ/ç‚¹è¸©æ•°é‡ --&gt;</span>
<span class="hljs-operator">&lt;</span><span class="hljs-keyword">select</span> id<span class="hljs-operator">=</span>"selectCommentLikeCountAndDislikeCountByListOfCommentId" resultType<span class="hljs-operator">=</span>"com.anon.spaceblogserver.modules.article.POJO.DTO.UpdateCommentVoteCountDTO"<span class="hljs-operator">&gt;</span>
    <span class="hljs-keyword">SELECT</span>
        comment_id <span class="hljs-keyword">AS</span> commentId,
        <span class="hljs-built_in">SUM</span>(<span class="hljs-keyword">CASE</span> <span class="hljs-keyword">WHEN</span> vote <span class="hljs-operator">=</span> <span class="hljs-number">1</span> <span class="hljs-keyword">THEN</span> <span class="hljs-number">1</span> <span class="hljs-keyword">ELSE</span> <span class="hljs-number">0</span> <span class="hljs-keyword">END</span>) <span class="hljs-keyword">AS</span> likeCount,
        <span class="hljs-built_in">SUM</span>(<span class="hljs-keyword">CASE</span> <span class="hljs-keyword">WHEN</span> vote <span class="hljs-operator">=</span> <span class="hljs-number">-1</span> <span class="hljs-keyword">THEN</span> <span class="hljs-number">1</span> <span class="hljs-keyword">ELSE</span> <span class="hljs-number">0</span> <span class="hljs-keyword">END</span>) <span class="hljs-keyword">AS</span> dislikeCount
    <span class="hljs-keyword">FROM</span> x_article_comments_votes
    <span class="hljs-keyword">WHERE</span> comment_id <span class="hljs-keyword">IN</span>
    <span class="hljs-operator">&lt;</span>foreach collection<span class="hljs-operator">=</span>"commentIds" item<span class="hljs-operator">=</span>"commentId" <span class="hljs-keyword">open</span><span class="hljs-operator">=</span>"(" separator<span class="hljs-operator">=</span>"," <span class="hljs-keyword">close</span><span class="hljs-operator">=</span>")"<span class="hljs-operator">&gt;</span>
        #{commentId}
    <span class="hljs-operator">&lt;</span><span class="hljs-operator">/</span>foreach<span class="hljs-operator">&gt;</span>
    <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> comment_id
<span class="hljs-operator">&lt;</span><span class="hljs-operator">/</span><span class="hljs-keyword">select</span><span class="hljs-operator">&gt;</span>
</code></pre>
<h5 data-id="heading-34">å°†ç»Ÿè®¡å‡ºçš„æ•°æ®æ‰¹é‡æ›´æ–°åˆ°x_article_comments</h5>
<h6 data-id="heading-35">Serviceå±‚ç›¸å…³ä»£ç </h6>
<pre><code class="hljs language-scss" lang="scss">int updated = <span class="hljs-built_in">batchUpdateCommentLikeCountAndDislikeCount</span>(updateCommentVoteCountDTOList, MySQLBatchSizeConstants.DEFAULT_UPDATE_BATCH_SIZE);
if (updated &lt; <span class="hljs-number">0</span>){
    throw new <span class="hljs-built_in">ClientException</span>(HttpStatus.ERROR, "æ‰¹é‡æ›´æ–°æ•°æ®å¤±è´¥");
}
log<span class="hljs-selector-class">.info</span>("æ‰¹é‡æ›´æ–°æ•°æ®æˆåŠŸï¼Œæ›´æ–°æ•°é‡ä¸ºï¼š{}", updated);
</code></pre>
<h6 data-id="heading-36">é™åˆ¶å•æ¡SQLè¯­å¥é•¿åº¦ï¼Œæ‰¹é‡æ›´æ–°æ“ä½œå…·ä½“å®ç°</h6>
<p>å› ä¸º<strong>SQLè¯­å¥</strong>é‡‡ç”¨äº†<code>case when</code>æ¥<strong>å‡å°‘ç½‘ç»œå¾€è¿”</strong>ï¼Œä¸º<strong>é™åˆ¶SQLè¯­å¥é•¿åº¦é˜²æ­¢æº¢å‡º</strong>ä»¥åŠ<strong>å½±å“æ€§èƒ½</strong>ï¼Œé‡‡ç”¨çš„ç­–ç•¥å¦‚ä¸‹</p>
<p>è‹¥æ£€æµ‹åˆ°å‚æ•°updateCommentVoteCountDTOListè¶…è¿‡æŒ‡å®šä¸ªæ•°ï¼Œå°†ä¼šæ‹†åˆ†æˆå¤šæ¡SQLè¯­å¥ä¸MySQLæ•°æ®åº“è¿›è¡Œäº¤äº’</p>
<pre><code class="hljs language-ini" lang="ini">/**
 * æ‰¹é‡æ›´æ–°è¯„è®ºçš„ç‚¹èµæ•°å’Œç‚¹è¸©æ•°
 * @param updateCommentVoteCountDTOList     éœ€è¦æ›´æ–°çš„è¯„è®ºç‚¹èµæ•°å’Œç‚¹è¸©æ•°åˆ—è¡¨
 * @param batchSize                   æ‰¹æ¬¡å¤§å°ï¼Œå»ºè®®æ ¹æ®å®é™…æƒ…å†µè°ƒæ•´ï¼Œè¿‡å¤§å¯èƒ½å¯¼è‡´å•æ¬¡æ›´æ–°è¿‡æ…¢ï¼Œè¿‡å°å¯èƒ½å¯¼è‡´æ›´æ–°æ¬¡æ•°è¿‡å¤š
 * @return      æˆåŠŸæ›´æ–°çš„è®°å½•æ•°
 */
public int batchUpdateCommentLikeCountAndDislikeCount(List&lt;UpdateCommentVoteCountDTO&gt; updateCommentVoteCountDTOList, Integer batchSize) {
    int <span class="hljs-attr">totalUpdated</span> = <span class="hljs-number">0</span><span class="hljs-comment">;</span>
    for (int <span class="hljs-attr">i</span> = <span class="hljs-number">0</span><span class="hljs-comment">; i &lt; updateCommentVoteCountDTOList.size(); i += batchSize) {</span>
        // æˆªå–å½“å‰æ‰¹æ¬¡çš„æ•°æ®
        List&lt;UpdateCommentVoteCountDTO&gt; <span class="hljs-attr">batch</span> = updateCommentVoteCountDTOList.subList(
                i,
                Math.min(i + batchSize, updateCommentVoteCountDTOList.size())
        )<span class="hljs-comment">;</span>
        // æ‰§è¡Œå½“å‰æ‰¹æ¬¡çš„æ›´æ–°
        int <span class="hljs-attr">updated</span> = articleCommentMapper.batchUpdateCommentLikeCountAndDislikeCount(batch)<span class="hljs-comment">;</span>
        if (updated &lt; 0) {
            log.error("æ‰¹é‡æ›´æ–°æ•°æ®å¤±è´¥ï¼Œå½“å‰æ‰¹æ¬¡æ›´æ–°æ•°é‡: {}", updated)<span class="hljs-comment">;</span>
            return -1<span class="hljs-comment">;</span>
        }
        totalUpdated += updated<span class="hljs-comment">;</span>

        log.info("æ‰¹é‡æ›´æ–°è¯„è®ºç‚¹èµ/ç‚¹è¸©æ•°ï¼Œå½“å‰æ‰¹æ¬¡æ›´æ–°æ•°é‡: {}, ç´¯è®¡æ›´æ–°æ•°é‡: {}", updated, totalUpdated)<span class="hljs-comment">;</span>
    }
    return totalUpdated<span class="hljs-comment">;</span>
}
</code></pre>
<h6 data-id="heading-37">SQLè¯­å¥ç›¸å…³å®ç°</h6>
<pre><code class="hljs language-ini" lang="ini">&lt;update <span class="hljs-attr">id</span>=<span class="hljs-string">"batchUpdateCommentLikeCountAndDislikeCount"</span>&gt;
    UPDATE x_article_comments
    SET <span class="hljs-attr">like_count</span> = CASE id
    &lt;foreach <span class="hljs-attr">collection</span>=<span class="hljs-string">"list"</span> item=<span class="hljs-string">"item"</span>&gt;
        WHEN <span class="hljs-comment">#{item.commentId} THEN #{item.likeCount}</span>
    &lt;/foreach&gt;
    END,
    <span class="hljs-attr">dislike_count</span> = CASE id
    &lt;foreach <span class="hljs-attr">collection</span>=<span class="hljs-string">"list"</span> item=<span class="hljs-string">"item"</span>&gt;
        WHEN <span class="hljs-comment">#{item.commentId} THEN #{item.dislikeCount}</span>
    &lt;/foreach&gt;
    END,
    <span class="hljs-attr">update_time</span> = NOW()
    WHERE id IN
    &lt;foreach <span class="hljs-attr">collection</span>=<span class="hljs-string">"list"</span> item=<span class="hljs-string">"item"</span> open=<span class="hljs-string">"("</span> separator=<span class="hljs-string">","</span> close=<span class="hljs-string">")"</span>&gt;
        <span class="hljs-comment">#{item.commentId}</span>
    &lt;/foreach&gt;
&lt;/update&gt;
</code></pre>
<h5 data-id="heading-38">æ¸…é™¤å·²åœ¨è¯¥å®šæ—¶ä»»åŠ¡å¤„ç†å®Œçš„redisç¼“å­˜æ•°æ®</h5>
<p>å‰é¢æåˆ°çš„å˜é‡â€”â€”likesUserIdToCommentIdsMapã€dislikesUserIdToCommentIdsMapã€statelessUserIdToCommentIdsMapã€‚å­˜å‚¨çš„å€¼ä¸ºç»è¿‡é€»è¾‘åé”®ä¸­å·²è¢«å¤„ç†çš„å€¼ï¼Œåœ¨æœ€åä¸€æ­¥æ¸…é™¤redisç¼“å­˜å‘æŒ¥ä½œç”¨</p>
<p>ä¸Šè¿°å˜é‡ç±»å‹å½¢å¼ä¸º<strong>Map&lt;Long, Set&gt;</strong> ï¼Œæ»¡è¶³äº†userId -&gt; è¯„è®ºidé›†åˆï¼Œè¿™å¯ä»¥ç²¾å‡†ä¸”æ–¹ä¾¿çš„æ¸…é™¤å·²å¤„ç†åçš„redisç¼“å­˜æ•°æ®</p>
<p>æ„å»ºä¸Šè¿°ä¸‰ä¸ªMapé›†åˆçš„è¿‡ç¨‹åœ¨<a href="####%E4%BB%8Eredis%E4%B8%AD%E8%8E%B7%E5%8F%96%E6%95%B0%E6%8D%AE%EF%BC%8C%E5%B9%B6%E5%B0%86%E6%95%B0%E6%8D%AE%E5%B0%81%E8%A3%85%E5%88%B0%E4%B8%A4%E4%B8%AA%E9%9B%86%E5%90%88%E4%B8%AD" title="####%E4%BB%8Eredis%E4%B8%AD%E8%8E%B7%E5%8F%96%E6%95%B0%E6%8D%AE%EF%BC%8C%E5%B9%B6%E5%B0%86%E6%95%B0%E6%8D%AE%E5%B0%81%E8%A3%85%E5%88%B0%E4%B8%A4%E4%B8%AA%E9%9B%86%E5%90%88%E4%B8%AD">ç¬¬ä¸€æ­¥æ“ä½œ</a>ä¸­ç»å†ä¸‰ä¸ªforå¾ªç¯å·²ç»æ„å»ºå®Œæ¯•</p>
<p>è¯¥æ“ä½œåŒæ ·ç”¨åˆ°<strong>luaè„šæœ¬</strong>ä¿è¯<strong>åŸå­æ€§</strong></p>
<h6 data-id="heading-39">luaè„šæœ¬</h6>
<p>è¯¥è„šæœ¬å®ç°<strong>å®‰å…¨æ‰¹é‡çš„ç§»é™¤</strong>keyä¸­<strong>è¦åˆ é™¤çš„å…ƒç´ åˆ—è¡¨</strong>ï¼Œ<strong>ä¸ºä»€ä¹ˆä¸ç›´æ¥æŠŠé”®åˆ é™¤çš„åŸå› </strong> -&gt; å‡å¦‚åœ¨è¯¥å®šæ—¶ä»»åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­ä»¥åŠè¯¥è„šæœ¬æ‰§è¡Œä¹‹å‰<strong>ç”¨æˆ·åˆå‘èµ·ç‚¹èµ/æ‹‰è¸©/æ— çŠ¶æ€è¯·æ±‚</strong>ï¼Œè‹¥ä¸å®šæ—¶ä»»åŠ¡è§¦å‘å<strong>ä»redisæŸ¥åˆ°çš„ç”¨æˆ·å¯¹è¯„è®ºçš„çŠ¶æ€ç›¸ç­‰ï¼Œåˆ™ä¼šç§»é™¤</strong>ï¼Œè¿™å¹¶æ²¡æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œ<strong>è‹¥ä¸ç›¸ç­‰ï¼Œä¸ä¼šç§»é™¤æ–°è¯·æ±‚ä¸­ç”¨æˆ·è®¾ç½®çš„ç‚¹èµ/æ‹‰è¸©/æ— çŠ¶æ€ï¼Œç•™åˆ°ä¸‹ä¸€æ¬¡å®šæ—¶ä»»åŠ¡è§¦å‘åå¤„ç†</strong>ã€‚</p>
<pre><code class="hljs language-lua" lang="lua"><span class="hljs-comment">-- å®‰å…¨æ‰¹é‡åˆ é™¤ï¼ŒåŒ…å«keyå­˜åœ¨æ€§æ£€æŸ¥</span>
<span class="hljs-comment">-- KEYS[1]: Setçš„key</span>
<span class="hljs-comment">-- ARGV[1..n]: è¦åˆ é™¤çš„å…ƒç´ åˆ—è¡¨</span>
<span class="hljs-comment">--</span>
<span class="hljs-keyword">local</span> key = KEYS[<span class="hljs-number">1</span>]
<span class="hljs-keyword">local</span> key_type = redis.call(<span class="hljs-string">'TYPE'</span>, key).ok

<span class="hljs-comment">-- æ£€æŸ¥keyæ˜¯å¦å­˜åœ¨ä¸”ç±»å‹ä¸ºset</span>
<span class="hljs-keyword">if</span> key_type == <span class="hljs-string">'none'</span> <span class="hljs-keyword">then</span>
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>
<span class="hljs-keyword">elseif</span> key_type ~= <span class="hljs-string">'set'</span> <span class="hljs-keyword">then</span>
    <span class="hljs-keyword">return</span> redis.error_reply(<span class="hljs-string">'WRONGTYPE Operation against a key holding the wrong kind of value'</span>)
<span class="hljs-keyword">end</span>

<span class="hljs-comment">-- å…¼å®¹ Lua 5.1 å’Œ Lua 5.2+</span>
<span class="hljs-keyword">local</span> <span class="hljs-built_in">unpack</span> = <span class="hljs-built_in">unpack</span> <span class="hljs-keyword">or</span> <span class="hljs-built_in">table</span>.<span class="hljs-built_in">unpack</span>

<span class="hljs-keyword">local</span> result = <span class="hljs-number">0</span>

<span class="hljs-comment">-- å¦‚æœ ARGV ä¸ä¸ºç©ºï¼Œåˆ™æ‰§è¡Œæ‰¹é‡åˆ é™¤</span>
<span class="hljs-keyword">if</span> #ARGV &gt; <span class="hljs-number">0</span> <span class="hljs-keyword">then</span>
    result = redis.call(<span class="hljs-string">'SREM'</span>, key, <span class="hljs-built_in">unpack</span>(ARGV))
<span class="hljs-keyword">end</span>

<span class="hljs-keyword">return</span> result
</code></pre>
<h6 data-id="heading-40">Serviceå±‚ç›¸å…³ä»£ç </h6>
<pre><code class="hljs language-vbscript" lang="vbscript">// æ¸…ç©ºRedisä¸­çš„æ•°æ®
DefaultRedisScript&lt;Long&gt; deleteScript = <span class="hljs-keyword">new</span> DefaultRedisScript&lt;&gt;();
deleteScript.setScriptSource(<span class="hljs-keyword">new</span> ResourceScriptSource(<span class="hljs-keyword">new</span> ClassPathResource(RedisLuaConstants.BATCH_REMOVE_MEMBERS_FROM_SET_LUA_SCRIPT_PATH)));
deleteScript.setResultType(Long.<span class="hljs-keyword">class</span>);
likesUserIdToCommentIdsMap.forEach((userId, commentIdSet) -&gt; {
    Long result = stringRedisTemplate.<span class="hljs-keyword">execute</span>(deleteScript, List.of(RedisKeyConstants.ARTICLES_COMMENTS_LIKES_USERS_KEY + userId.<span class="hljs-keyword">to</span><span class="hljs-built_in">String</span>()), commentIdSet.<span class="hljs-keyword">to</span><span class="hljs-built_in">Array</span>());
    <span class="hljs-keyword">if</span> (result == <span class="hljs-literal">null</span> || result &lt; <span class="hljs-number">0</span>){
        log.<span class="hljs-keyword">error</span>(<span class="hljs-string">"æ‰¹é‡åˆ é™¤ç”¨æˆ· {} ç¼“å­˜ç‚¹èµçš„è¯„è®ºå¤±è´¥ï¼Œæ¬²åˆ é™¤çš„commentId -&gt; {}"</span>, userId, commentIdSet);
    }
});
dislikesUserIdToCommentIdsMap.forEach((userId, commentIdSet) -&gt; {
    Long result = stringRedisTemplate.<span class="hljs-keyword">execute</span>(deleteScript, List.of(RedisKeyConstants.ARTICLES_COMMENTS_DISLIKES_USERS_KEY + userId.<span class="hljs-keyword">to</span><span class="hljs-built_in">String</span>()), commentIdSet.<span class="hljs-keyword">to</span><span class="hljs-built_in">Array</span>());
    <span class="hljs-keyword">if</span> (result == <span class="hljs-literal">null</span> || result &lt; <span class="hljs-number">0</span>){
        log.<span class="hljs-keyword">error</span>(<span class="hljs-string">"æ‰¹é‡åˆ é™¤ç”¨æˆ· {} ç¼“å­˜ç‚¹è¸©çš„è¯„è®ºå¤±è´¥ï¼Œæ¬²åˆ é™¤çš„commentId -&gt; {}"</span>, userId, commentIdSet);
    }
});
statelessUserIdToCommentIdsMap.forEach((userId, commentIdSet) -&gt; {
    Long result = stringRedisTemplate.<span class="hljs-keyword">execute</span>(deleteScript, List.of(RedisKeyConstants.ARTICLES_COMMENTS_STATELESS_USERS_KEY + userId.<span class="hljs-keyword">to</span><span class="hljs-built_in">String</span>()), commentIdSet.<span class="hljs-keyword">to</span><span class="hljs-built_in">Array</span>());
    <span class="hljs-keyword">if</span> (result == <span class="hljs-literal">null</span> || result &lt; <span class="hljs-number">0</span>){
        log.<span class="hljs-keyword">error</span>(<span class="hljs-string">"æ‰¹é‡åˆ é™¤ç”¨æˆ· {} ç¼“å­˜æ— çŠ¶æ€çš„è¯„è®ºå¤±è´¥ï¼Œæ¬²åˆ é™¤çš„commentId -&gt; {}"</span>, userId, commentIdSet);
    }
});
</code></pre>
<h4 data-id="heading-41">SyncVoteå®Œæ•´ä»£ç </h4>
<pre><code class="hljs language-ini" lang="ini">@Transactional
@Override
public Boolean syncVote() {
 Â  Â //TODO å‘æ•£æ€ç»´ï¼Œè¯¥æ®µé€»è¾‘ä¼¼ä¹åœ¨æ”¶è—ã€æŠ•å¸ç­‰åŠŸèƒ½æœ‰ç›¸ä¼¼ä¹‹å¤„ï¼Œè¯¥æ®µä¹‹æ‰€ä»¥æœ‰ç‚¹å¤æ‚æ˜¯å› ä¸ºæœ‰ä¸‰ç§çŠ¶æ€â€”â€”â€”â€”ç‚¹èµã€ç‚¹è¸©ã€æ— çŠ¶æ€ï¼Œä¸”ä¸‰è€…ä¹‹é—´æ˜¯äº’æ–¥çš„ï¼Œä½†å‰é¢çš„æ”¶è—ã€æŠ•å¸åŠŸèƒ½æ²¡æœ‰è¿™ä¸ªé—®é¢˜ï¼Œå¹¶ä¸”å¥½åƒåªæœ‰ä¸¤ä¸ªçŠ¶æ€ï¼Œæ—¥åå¯ä»¥æŠ½è±¡å‡ºä¸€ä¸ªé€šç”¨æ–¹æ³•æ¥å¤„ç†è¿™ç±»åŠŸèƒ½ï¼Œå‡å°‘ä»£ç é‡å¤åº¦
 Â  Â Set&lt;String&gt; <span class="hljs-attr">userLikesKeys</span> = stringRedisTemplate.keys(RedisKeyConstants.ARTICLES_COMMENTS_LIKES_USERS_KEY + <span class="hljs-string">"*"</span>)<span class="hljs-comment">;</span>
 Â  Â Set&lt;String&gt; <span class="hljs-attr">userDislikesKeys</span> = stringRedisTemplate.keys(RedisKeyConstants.ARTICLES_COMMENTS_DISLIKES_USERS_KEY + <span class="hljs-string">"*"</span>)<span class="hljs-comment">;</span>
 Â  Â Set&lt;String&gt; <span class="hljs-attr">userStatelessKeys</span> = stringRedisTemplate.keys(RedisKeyConstants.ARTICLES_COMMENTS_STATELESS_USERS_KEY + <span class="hljs-string">"*"</span>)<span class="hljs-comment">;</span>
 Â  Â if (userLikesKeys.isEmpty() &amp;&amp; userDislikesKeys.isEmpty() &amp;&amp; userStatelessKeys.isEmpty()){
 Â  Â  Â  Â log.info("æ²¡æœ‰éœ€è¦åŒæ­¥çš„æ•°æ®")<span class="hljs-comment">;</span>
 Â  Â  Â  Â return true<span class="hljs-comment">;</span>
 Â   }
 Â  Â List&lt;ArticleCommentVote&gt; <span class="hljs-attr">votes</span> = new ArrayList&lt;&gt;()<span class="hljs-comment">; Â  Â  Â // ä¿å­˜æ‰€æœ‰æŠ•ç¥¨æ•°æ®</span>
 Â  Â Set&lt;Long&gt; <span class="hljs-attr">TotalcommentId</span> = new HashSet&lt;&gt;()<span class="hljs-comment">; Â  Â  // ä¿å­˜æ‰€æœ‰è¯„è®ºid</span>
 Â  Â Map&lt;Long, Set&lt;String&gt;&gt; <span class="hljs-attr">likesUserIdToCommentIdsMap</span> = new HashMap&lt;&gt;()<span class="hljs-comment">;</span>
 Â  Â Map&lt;Long, Set&lt;String&gt;&gt; <span class="hljs-attr">dislikesUserIdToCommentIdsMap</span> = new HashMap&lt;&gt;()<span class="hljs-comment">;</span>
 Â  Â Map&lt;Long, Set&lt;String&gt;&gt; <span class="hljs-attr">statelessUserIdToCommentIdsMap</span> = new HashMap&lt;&gt;()<span class="hljs-comment">;</span>
 Â  Â for (String userLikesKey : userLikesKeys) {
 Â  Â  Â  Â String <span class="hljs-attr">userId</span> = userLikesKey.replace(RedisKeyConstants.ARTICLES_COMMENTS_LIKES_USERS_KEY, <span class="hljs-string">""</span>)<span class="hljs-comment">;</span>
 Â  Â  Â  Â Set&lt;String&gt; <span class="hljs-attr">commentIds</span> = stringRedisTemplate.opsForSet().members(userLikesKey)<span class="hljs-comment">;</span>
 Â  Â  Â  Â for (String commentId : commentIds) {
 Â  Â  Â  Â  Â  Â votes.add(new ArticleCommentVote(Long.parseLong(commentId), Long.parseLong(userId), ArticleCommentVoteConstants.LIKE, null, null))<span class="hljs-comment">;</span>
 Â  Â  Â  Â  Â  Â TotalcommentId.add(Long.parseLong(commentId))<span class="hljs-comment">;</span>
 Â  Â  Â  Â  Â  Â // æ›´æ–°æˆ–æ–°å¢likesUserIdToCommentIdsMapé”®å€¼å¯¹ï¼Œå€¼çš„seté›†åˆæ–°å¢commentId
 Â  Â  Â  Â  Â  Â likesUserIdToCommentIdsMap.computeIfAbsent(Long.parseLong(userId), k -&gt; new HashSet&lt;&gt;()).add(commentId)<span class="hljs-comment">;</span>
 Â  Â  Â   }
 Â   }
 Â  Â for (String userDislikesKey : userDislikesKeys) {
 Â  Â  Â  Â String <span class="hljs-attr">userId</span> = userDislikesKey.replace(RedisKeyConstants.ARTICLES_COMMENTS_DISLIKES_USERS_KEY, <span class="hljs-string">""</span>)<span class="hljs-comment">;</span>
 Â  Â  Â  Â Set&lt;String&gt; <span class="hljs-attr">commentIds</span> = stringRedisTemplate.opsForSet().members(userDislikesKey)<span class="hljs-comment">;</span>
 Â  Â  Â  Â for (String commentId : commentIds) {
 Â  Â  Â  Â  Â  Â votes.add(new ArticleCommentVote(Long.parseLong(commentId), Long.parseLong(userId), ArticleCommentVoteConstants.DISLIKE, null, null))<span class="hljs-comment">;</span>
 Â  Â  Â  Â  Â  Â TotalcommentId.add(Long.parseLong(commentId))<span class="hljs-comment">;</span>
 Â  Â  Â  Â  Â  Â // æ›´æ–°æˆ–æ–°å¢dislikesUserIdToCommentIdsMapé”®å€¼å¯¹ï¼Œå€¼çš„seté›†åˆæ–°å¢commentId
 Â  Â  Â  Â  Â  Â dislikesUserIdToCommentIdsMap.computeIfAbsent(Long.parseLong(userId), k -&gt; new HashSet&lt;&gt;()).add(commentId)<span class="hljs-comment">;</span>
 Â  Â  Â   }
 Â   }
 Â  Â for (String userStatelessKey : userStatelessKeys) {
 Â  Â  Â  Â String <span class="hljs-attr">userId</span> = userStatelessKey.replace(RedisKeyConstants.ARTICLES_COMMENTS_STATELESS_USERS_KEY, <span class="hljs-string">""</span>)<span class="hljs-comment">;</span>
 Â  Â  Â  Â Set&lt;String&gt; <span class="hljs-attr">commentIds</span> = stringRedisTemplate.opsForSet().members(userStatelessKey)<span class="hljs-comment">;</span>
 Â  Â  Â  Â for (String commentId : commentIds) {
 Â  Â  Â  Â  Â  Â votes.add(new ArticleCommentVote(Long.parseLong(commentId), Long.parseLong(userId), ArticleCommentVoteConstants.STATELESS, null, null))<span class="hljs-comment">;</span>
 Â  Â  Â  Â  Â  Â TotalcommentId.add(Long.parseLong(commentId))<span class="hljs-comment">;</span>
 Â  Â  Â  Â  Â  Â // æ·»åŠ åˆ°statelessUserIdToCommentIdsMapé”®å€¼å¯¹ï¼Œå€¼çš„seté›†åˆæ–°å¢commentId
 Â  Â  Â  Â  Â  Â statelessUserIdToCommentIdsMap.computeIfAbsent(Long.parseLong(userId), k -&gt; new HashSet&lt;&gt;()).add(commentId)<span class="hljs-comment">;</span>
 Â  Â  Â   }
 Â   }
 Â  Â // æ ¹æ®votesæ‰§è¡Œè½åº“é€»è¾‘ï¼ˆåŒ…å«æ’å…¥/æ›´æ–°ï¼‰
 Â  Â if (!votes.isEmpty()){
 Â  Â  Â  Â int <span class="hljs-attr">i</span> = articleCommentVoteMapper.batchInsertOrUpdate(votes)<span class="hljs-comment">;</span>
 Â  Â  Â  Â if (i &lt; 0){
 Â  Â  Â  Â  Â  Â throw new ClientException(HttpStatus.ERROR, "æ‰¹é‡æ’å…¥æˆ–æ›´æ–°æ•°æ®å¤±è´¥")<span class="hljs-comment">;</span>
 Â  Â  Â   }
 Â  Â  Â  Â log.info("æ‰¹é‡æ’å…¥æˆ–æ›´æ–°æ•°æ®æˆåŠŸï¼Œæ•°é‡ä¸ºï¼š{}", i)<span class="hljs-comment">;</span>
 Â   } else {
 Â  Â  Â  Â log.info("æ²¡æœ‰éœ€è¦è½åº“çš„æ•°æ®")<span class="hljs-comment">;</span>
 Â  Â  Â  Â return true<span class="hljs-comment">;</span>
 Â   }
 Â  Â // æ ¹æ®TotalcommentIdé›†åˆä¸­çš„commentIdï¼Œåˆ©ç”¨èšåˆå‡½æ•°è·å–å¯¹åº”è¡¨ä¸­å¯¹åº”è¯„è®ºçš„likeCountå’ŒdislikeCountï¼Œå°è£…æˆList&lt;updateCommentVoteCountDTO&gt; updateCommentVoteCountDTOList
 Â  Â List&lt;UpdateCommentVoteCountDTO&gt; <span class="hljs-attr">updateCommentVoteCountDTOList</span> = getCommentLikeCountAndDislikeCountByListOfCommentId(TotalcommentId)<span class="hljs-comment">;</span>
 Â  Â // æ ¹æ®updateCommentVoteCountDTOListæ‰§è¡Œæ‰¹é‡æ›´æ–°çš„é€»è¾‘ï¼Œä½œç”¨çš„è¡¨ä¸ºx_article_commentsï¼Œä½¿ç”¨case when thenè¯­æ³•æ›´æ–°likeCountå’ŒdislikeCount
 Â  Â int <span class="hljs-attr">updated</span> = batchUpdateCommentLikeCountAndDislikeCount(updateCommentVoteCountDTOList, MySQLBatchSizeConstants.DEFAULT_UPDATE_BATCH_SIZE)<span class="hljs-comment">;</span>
 Â  Â if (updated &lt; 0){
 Â  Â  Â  Â throw new ClientException(HttpStatus.ERROR, "æ‰¹é‡æ›´æ–°æ•°æ®å¤±è´¥")<span class="hljs-comment">;</span>
 Â   }
 Â  Â log.info("æ‰¹é‡æ›´æ–°æ•°æ®æˆåŠŸï¼Œæ›´æ–°æ•°é‡ä¸ºï¼š{}", updated)<span class="hljs-comment">;</span>
 Â  Â // æ¸…ç©ºRedisä¸­çš„æ•°æ®
 Â  Â DefaultRedisScript&lt;Long&gt; <span class="hljs-attr">deleteScript</span> = new DefaultRedisScript&lt;&gt;()<span class="hljs-comment">;</span>
 Â  Â deleteScript.setScriptSource(new ResourceScriptSource(new ClassPathResource(RedisLuaConstants.BATCH_REMOVE_MEMBERS_FROM_SET_LUA_SCRIPT_PATH)))<span class="hljs-comment">;</span>
 Â  Â deleteScript.setResultType(Long.class)<span class="hljs-comment">;</span>
 Â  Â likesUserIdToCommentIdsMap.forEach((userId, commentIdSet) -&gt; {
 Â  Â  Â  Â Long <span class="hljs-attr">result</span> = stringRedisTemplate.execute(deleteScript, List.of(RedisKeyConstants.ARTICLES_COMMENTS_LIKES_USERS_KEY + userId.toString()), commentIdSet.toArray())<span class="hljs-comment">;</span>
 Â  Â  Â  Â if (<span class="hljs-attr">result</span> == null || result &lt; <span class="hljs-number">0</span>){
 Â  Â  Â  Â  Â  Â log.error("æ‰¹é‡åˆ é™¤ç”¨æˆ· {} ç¼“å­˜ç‚¹èµçš„è¯„è®ºå¤±è´¥ï¼Œæ¬²åˆ é™¤çš„commentId -&gt; {}", userId, commentIdSet)<span class="hljs-comment">;</span>
 Â  Â  Â   }
 Â   })<span class="hljs-comment">;</span>
 Â  Â dislikesUserIdToCommentIdsMap.forEach((userId, commentIdSet) -&gt; {
 Â  Â  Â  Â Long <span class="hljs-attr">result</span> = stringRedisTemplate.execute(deleteScript, List.of(RedisKeyConstants.ARTICLES_COMMENTS_DISLIKES_USERS_KEY + userId.toString()), commentIdSet.toArray())<span class="hljs-comment">;</span>
 Â  Â  Â  Â if (<span class="hljs-attr">result</span> == null || result &lt; <span class="hljs-number">0</span>){
 Â  Â  Â  Â  Â  Â log.error("æ‰¹é‡åˆ é™¤ç”¨æˆ· {} ç¼“å­˜ç‚¹è¸©çš„è¯„è®ºå¤±è´¥ï¼Œæ¬²åˆ é™¤çš„commentId -&gt; {}", userId, commentIdSet)<span class="hljs-comment">;</span>
 Â  Â  Â   }
 Â   })<span class="hljs-comment">;</span>
 Â  Â statelessUserIdToCommentIdsMap.forEach((userId, commentIdSet) -&gt; {
 Â  Â  Â  Â Long <span class="hljs-attr">result</span> = stringRedisTemplate.execute(deleteScript, List.of(RedisKeyConstants.ARTICLES_COMMENTS_STATELESS_USERS_KEY + userId.toString()), commentIdSet.toArray())<span class="hljs-comment">;</span>
 Â  Â  Â  Â if (<span class="hljs-attr">result</span> == null || result &lt; <span class="hljs-number">0</span>){
 Â  Â  Â  Â  Â  Â log.error("æ‰¹é‡åˆ é™¤ç”¨æˆ· {} ç¼“å­˜æ— çŠ¶æ€çš„è¯„è®ºå¤±è´¥ï¼Œæ¬²åˆ é™¤çš„commentId -&gt; {}", userId, commentIdSet)<span class="hljs-comment">;</span>
 Â  Â  Â   }
 Â   })<span class="hljs-comment">;</span>
 Â  Â return true<span class="hljs-comment">;</span>
}
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Nçš‡åé—®é¢˜(å«ä½è¿ç®—ç‰ˆæœ¬)]]></title>    <link>https://juejin.cn/post/7604775190211936266</link>    <guid>https://juejin.cn/post/7604775190211936266</guid>    <pubDate>2026-02-10T03:29:33.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604775190211936266" data-draft-id="7604697194795810826" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Nçš‡åé—®é¢˜(å«ä½è¿ç®—ç‰ˆæœ¬)"/> <meta itemprop="keywords" content="ç®—æ³•"/> <meta itemprop="datePublished" content="2026-02-10T03:29:33.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="è‰ºè‰ºç”Ÿè¾‰"/> <meta itemprop="url" content="https://juejin.cn/user/1071389369728667"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Nçš‡åé—®é¢˜(å«ä½è¿ç®—ç‰ˆæœ¬)
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1071389369728667/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    è‰ºè‰ºç”Ÿè¾‰
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T03:29:33.000Z" title="Tue Feb 10 2026 03:29:33 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Nçš‡åé—®é¢˜(å«ä½è¿ç®—ç‰ˆæœ¬)</h2>
<h3 data-id="heading-1">1.ç»å…¸æ–¹æ³•è§£å†³Nçš‡åé—®é¢˜</h3>
<p><strong>é¢˜ç›®</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e120d4407c364b048ed4e35344203689~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Im66Im655Sf6L6J:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771298974&amp;x-signature=PBCxwG24BlE%2BmiytH4eIph2kMGU%3D" alt="image.png" loading="lazy"/>
æµ‹è¯•è¿æ¥:<a href="https://link.juejin.cn?target=https%3A%2F%2Fleetcode.cn%2Fproblems%2Fn-queens%2F%3FenvType%3Dstudy-plan-v2%26envId%3Dtop-100-liked" target="_blank" title="https://leetcode.cn/problems/n-queens/?envType=study-plan-v2&amp;envId=top-100-liked" ref="nofollow noopener noreferrer">leetcode.cn/problems/n-â€¦</a><br/>
é¢˜ç›®ä¸­:1&lt;=n&lt;=9ï¼Œnçš„èŒƒå›´è¾ƒå°ï¼Œæˆ‘ä»¬å¯ä»¥æšä¸¾æ‰€æœ‰å¯èƒ½<br/>
<strong>ä»£ç :</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> {
    <span class="hljs-keyword">private</span> List&lt;List&lt;String&gt;&gt; ans = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
    <span class="hljs-keyword">public</span> List&lt;List&lt;String&gt;&gt; <span class="hljs-title function_">solveNQueens</span><span class="hljs-params">(<span class="hljs-type">int</span> n)</span> {
        <span class="hljs-type">int</span>[] path = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[n];
        f(path,<span class="hljs-number">0</span>,n);
        <span class="hljs-keyword">return</span> ans;
    }
    <span class="hljs-comment">//ç­–ç•¥:æ¯ä¸€è¡Œå¼€å§‹æšä¸¾ï¼Œçœ‹æ¯ä¸€è¡Œçš„æ£‹å­åº”è¯¥æ”¾ç½®å“ªä¸ªä½ç½®</span>
    <span class="hljs-comment">//pathæ•°ç»„:è®°å½•æ¯ä¸€è¡Œçš„æ£‹å­æ”¾ç½®çš„åˆ—æ•°</span>
    <span class="hljs-comment">//cur:å½“å‰çš„è¡Œ</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">f</span><span class="hljs-params">(<span class="hljs-type">int</span>[] path ,<span class="hljs-type">int</span> cur,<span class="hljs-type">int</span> n)</span>{
        <span class="hljs-comment">//é€’å½’ç»ˆæ­¢æ¡ä»¶</span>
        <span class="hljs-keyword">if</span>(cur == n){
            List&lt;String&gt; list = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>();
            <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;n;i++){
                <span class="hljs-type">StringBuilder</span> <span class="hljs-variable">sb</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>();
                <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> j=<span class="hljs-number">0</span>;j&lt;n;j++){
                    <span class="hljs-keyword">if</span>(path[i]==j) sb.append(<span class="hljs-string">'Q'</span>);
                    <span class="hljs-keyword">else</span> sb.append(<span class="hljs-string">'.'</span>);
                }
                list.add(sb.toString());
            }
            ans.add(list);
            <span class="hljs-keyword">return</span>;
        }
        <span class="hljs-comment">//æšä¸¾æ¯ä¸€åˆ—ï¼Œçœ‹çœ‹èƒ½ä¸èƒ½æ”¾</span>
        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> col=<span class="hljs-number">0</span>;col&lt;n;col++){
            <span class="hljs-comment">//checkå‡½æ•°æ£€æŸ¥</span>
            <span class="hljs-keyword">if</span>(check(path,cur,col)){
                path[cur]=col;
                f(path,cur+<span class="hljs-number">1</span>,n);
            }
        }
    }
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">check</span><span class="hljs-params">(<span class="hljs-type">int</span>[] path,<span class="hljs-type">int</span> row,<span class="hljs-type">int</span> col)</span>{
        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;row;i++){
            <span class="hljs-comment">//è¿™é‡Œåˆ©ç”¨æ–œç‡==1çš„çŸ¥è¯†ï¼Œå·§å¦™å¤„ç†äº†ä¸¤æ¡å¯¹è§’çº¿</span>
            <span class="hljs-keyword">if</span>(path[i]==col || Math.abs(row-i)==Math.abs(col-path[i])) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }
}

</code></pre>
<p><strong>æ—¶é—´å¤æ‚åº¦:</strong> O(n!)</p>
<h3 data-id="heading-2">2.ç”¨ä½è¿ç®—è§£å†³Nçš‡åé—®é¢˜</h3>
<p><strong>é¢˜ç›®</strong>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/20bfd3a1b4394f8cad3104888d35011a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Im66Im655Sf6L6J:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771298974&amp;x-signature=k4j6v0%2F7jQadVlCwAf6f6N92ALo%3D" alt="image.png" loading="lazy"/>
æµ‹è¯•é“¾æ¥:<a href="https://link.juejin.cn?target=https%3A%2F%2Fleetcode.cn%2Fproblems%2Fn-queens-ii%2Fdescription%2F" target="_blank" title="https://leetcode.cn/problems/n-queens-ii/description/" ref="nofollow noopener noreferrer">leetcode.cn/problems/n-â€¦</a><br/>
<strong>ä»£ç </strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> {
    <span class="hljs-comment">//ç”¨ä½è¿ç®—å®ç°é€’å½’ç‰ˆæœ¬</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">totalNQueens</span><span class="hljs-params">(<span class="hljs-type">int</span> n)</span> {
        <span class="hljs-comment">//æ¯”å¦‚5çš‡åé—®é¢˜,limit= ...00011111,æœ€å³è¾¹æœ‰5ä¸ª1</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">limit</span> <span class="hljs-operator">=</span> (<span class="hljs-number">1</span>&lt;&lt;n) -<span class="hljs-number">1</span>;
        <span class="hljs-keyword">return</span> f2(limit,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);
    }
    <span class="hljs-comment">//col:åˆ—çš„é™åˆ¶æ¡ä»¶ï¼Œè®°å½•å“ªäº›åˆ—æ”¾ç½®äº†çš‡å,0ä»£è¡¨å½“å‰è¡Œå¯ä»¥æ”¾ç½®ï¼Œ1ä»£è¡¨ä¸å¯ä»¥æ”¾ç½®</span>
    <span class="hljs-comment">//left:å³ä¸Šè§’åˆ°å·¦ä¸‹è§’çš„é™åˆ¶æ¡ä»¶ï¼Œ0ä»£è¡¨å½“å‰è¡Œå¯ä»¥æ”¾ç½®ï¼Œ1ä»£è¡¨ä¸å¯ä»¥æ”¾ç½®</span>
    <span class="hljs-comment">//right:å·¦ä¸Šè§’åˆ°å³ä¸‹è§’çš„é™åˆ¶æ¡ä»¶,0ä»£è¡¨å½“å‰è¡Œå¯ä»¥æ”¾ç½®ï¼Œ1ä»£è¡¨ä¸å¯ä»¥æ”¾ç½®</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">f2</span><span class="hljs-params">(<span class="hljs-type">int</span> limit,<span class="hljs-type">int</span> col,<span class="hljs-type">int</span> left,<span class="hljs-type">int</span> right)</span>{
        <span class="hljs-comment">//é€’å½’ç»ˆæ­¢æ¡ä»¶</span>
        <span class="hljs-keyword">if</span>(col == limit){
            <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;
        }
        <span class="hljs-comment">//å¯ä»¥æ”¾ç½®çš„ä½ç½®</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">cadidate</span> <span class="hljs-operator">=</span> col | left | right;
        <span class="hljs-comment">//å–åæ˜¯å°†1å˜ä¸ºå¯æ”¾ç½®çš„ï¼Œ0å˜ä¸ºä¸å¯æ”¾ç½®ï¼Œæ–¹ä¾¿æˆ‘ä»¬åé¢è¿ç®—</span>
        <span class="hljs-comment">//&amp;limit:æ˜¯å»æ‰æ— ç”¨çš„ä¿¡æ¯</span>
        cadidate = ((~cadidate) &amp; limit);
        <span class="hljs-type">int</span> <span class="hljs-variable">ans</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
        <span class="hljs-keyword">while</span>(cadidate != <span class="hljs-number">0</span>){
            <span class="hljs-comment">//å–å‡ºæœ€å³ä¾§çš„1</span>
            <span class="hljs-type">int</span> <span class="hljs-variable">choice</span> <span class="hljs-operator">=</span> cadidate &amp; (~cadidate+<span class="hljs-number">1</span>);
            <span class="hljs-comment">//æ›´æ–°candidate</span>
            cadidate ^= choice;
            <span class="hljs-comment">//æ›´æ–°ä¸‹ä¸€è¡Œçš„æ¡ä»¶</span>
            ans += f2(limit,col | choice,(left | choice)&lt;&lt;<span class="hljs-number">1</span> ,(right | choice) &gt;&gt;<span class="hljs-number">1</span>);
        }
        <span class="hljs-keyword">return</span> ans;
    }
}

</code></pre>
<p><strong>æ—¶é—´å¤æ‚åº¦:O(n!)</strong><br/>
ä½è¿ç®—çš„é€Ÿåº¦æ¯”ç”¨pathæ•°ç»„è®°å½•æ›´å¿«<br/></p>
<h3 data-id="heading-3">3.å£°æ˜</h3>
<p><strong>ä»¥ä¸Šçš„ä»£ç æ˜¯å¬äº†å·¦ç¥(bç«™å·¦ç¨‹äº‘)çš„æ•™å­¦åè‡ªå·±å†™çš„</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[for rangeçš„ä½¿ç”¨æ³¨æ„äº‹é¡¹]]></title>    <link>https://juejin.cn/post/7604701848150687744</link>    <guid>https://juejin.cn/post/7604701848150687744</guid>    <pubDate>2026-02-10T03:31:22.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604701848150687744" data-draft-id="7604779604124925952" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="for rangeçš„ä½¿ç”¨æ³¨æ„äº‹é¡¹"/> <meta itemprop="keywords" content="Go"/> <meta itemprop="datePublished" content="2026-02-10T03:31:22.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="cppgo"/> <meta itemprop="url" content="https://juejin.cn/user/1924620895400932"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            for rangeçš„ä½¿ç”¨æ³¨æ„äº‹é¡¹
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1924620895400932/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    cppgo
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T03:31:22.000Z" title="Tue Feb 10 2026 03:31:22 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong>(ä¸€)</strong></p>
<p>1.åœ¨rangeä¸­ä¿®æ”¹åˆ‡ç‰‡ï¼š</p>
<pre><code class="hljs language-go" lang="go"> <span class="hljs-number">1</span> n := []<span class="hljs-type">int</span>{<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span>,<span class="hljs-number">6</span>}
 <span class="hljs-number">2</span> <span class="hljs-keyword">for</span> i, e := <span class="hljs-keyword">range</span> n{
 <span class="hljs-number">3</span>         <span class="hljs-keyword">if</span> i == <span class="hljs-built_in">len</span>(n)<span class="hljs-number">-1</span> {
 <span class="hljs-number">4</span>                 n[<span class="hljs-number">0</span>] += e
 <span class="hljs-number">5</span>         } <span class="hljs-keyword">else</span> {
 <span class="hljs-number">6</span>                 n[i+<span class="hljs-number">1</span>] += e
 <span class="hljs-number">7</span>         }
 <span class="hljs-number">8</span> 
 <span class="hljs-number">9</span> }
<span class="hljs-number">10</span> fmt.Println(<span class="hljs-string">"n:"</span>, n)
</code></pre>
<p>è¾“å‡ºï¼š</p>
<pre><code class="hljs language-ini" lang="ini">n: <span class="hljs-section">[22 3 6 10 15 21]</span>
</code></pre>
<p>2.åœ¨rangeä¸­ä¿®æ”¹æ•°ç»„ï¼š</p>
<pre><code class="hljs language-go" lang="go"> <span class="hljs-number">1</span> n := [...]<span class="hljs-type">int</span>{<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span>,<span class="hljs-number">6</span>}
 <span class="hljs-number">2</span> <span class="hljs-keyword">for</span> i, e := <span class="hljs-keyword">range</span> n{
 <span class="hljs-number">3</span>         <span class="hljs-keyword">if</span> i == <span class="hljs-built_in">len</span>(n)<span class="hljs-number">-1</span> {
 <span class="hljs-number">4</span>                 n[<span class="hljs-number">0</span>] += e
 <span class="hljs-number">5</span>         } <span class="hljs-keyword">else</span> {
 <span class="hljs-number">6</span>                 n[i+<span class="hljs-number">1</span>] += e
 <span class="hljs-number">7</span>         }
 <span class="hljs-number">8</span> 
 <span class="hljs-number">9</span> }
<span class="hljs-number">10</span> fmt.Println(<span class="hljs-string">"n:"</span>, n)
</code></pre>
<p>è¾“å‡ºï¼š</p>
<pre><code class="hljs language-ini" lang="ini">n: <span class="hljs-section">[7 3 5 7 9 11]</span>
</code></pre>
<p>Â </p>
<p><strong><code>range</code>è¡¨è¾¾å¼ä¼šåœ¨<code>for</code>è¯­å¥å¼€å§‹æ‰§è¡Œæ—¶è¢«æ±‚å€¼ä¸€æ¬¡ã€‚æ±‚å€¼çš„ç»“æœå€¼è¢«ä¼ é€’å‡ºæ¥ï¼Œæ˜¯å€¼ä¼ é€’ï¼ˆå¤åˆ¶ï¼‰ã€‚ç”±äºåˆ‡ç‰‡æ˜¯å¼•ç”¨ç±»å‹ï¼Œæ‰€ä»¥å¯ä»¥è·Ÿéšå˜åŒ–ã€‚</strong></p>
<p><strong>(äºŒ)</strong></p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">str</span><span class="hljs-params">()</span></span> {
        a := <span class="hljs-string">"ä½ å¥½123"</span>
        <span class="hljs-keyword">for</span> i, v :=  <span class="hljs-keyword">range</span> a {
                fmt.Println(<span class="hljs-string">"i:"</span>,i, <span class="hljs-string">", v:"</span>, v)
        }
        b := []<span class="hljs-type">rune</span>(a)
        fmt.Println(<span class="hljs-string">"b:"</span>, b)

}
</code></pre>
<p>è¾“å‡ºï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">i:</span> <span class="hljs-number">0</span> <span class="hljs-string">,</span> <span class="hljs-attr">v:</span> <span class="hljs-number">20320</span>
<span class="hljs-attr">i:</span> <span class="hljs-number">3</span> <span class="hljs-string">,</span> <span class="hljs-attr">v:</span> <span class="hljs-number">22909</span>
<span class="hljs-attr">i:</span> <span class="hljs-number">6</span> <span class="hljs-string">,</span> <span class="hljs-attr">v:</span> <span class="hljs-number">49</span>
<span class="hljs-attr">i:</span> <span class="hljs-number">7</span> <span class="hljs-string">,</span> <span class="hljs-attr">v:</span> <span class="hljs-number">50</span>
<span class="hljs-attr">i:</span> <span class="hljs-number">8</span> <span class="hljs-string">,</span> <span class="hljs-attr">v:</span> <span class="hljs-number">51</span>
<span class="hljs-attr">b:</span> [<span class="hljs-number">20320</span> <span class="hljs-number">22909</span> <span class="hljs-number">49</span> <span class="hljs-number">50</span> <span class="hljs-number">51</span>]
</code></pre>
<p>ã€è¿ç§»ã€‘<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.cnblogs.com%2Fzxq89%2Fp%2F16658420.html" target="_blank" title="https://www.cnblogs.com/zxq89/p/16658420.html" ref="nofollow noopener noreferrer">www.cnblogs.com/zxq89/p/166â€¦</a> posted @Â 2022-09-05 15:42</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[antfu æ–°ä½œï¼šskills-npm å¦‚ä½•ç”¨åŒ…ç®¡ç†é‡å¡‘ Agent Skills ç”Ÿæ€]]></title>    <link>https://juejin.cn/post/7604666872128061459</link>    <guid>https://juejin.cn/post/7604666872128061459</guid>    <pubDate>2026-02-10T03:18:02.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604666872128061459" data-draft-id="7604853010162810943" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="antfu æ–°ä½œï¼šskills-npm å¦‚ä½•ç”¨åŒ…ç®¡ç†é‡å¡‘ Agent Skills ç”Ÿæ€"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2026-02-10T03:18:02.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="twl"/> <meta itemprop="url" content="https://juejin.cn/user/3016715635534029"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            antfu æ–°ä½œï¼šskills-npm å¦‚ä½•ç”¨åŒ…ç®¡ç†é‡å¡‘ Agent Skills ç”Ÿæ€
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3016715635534029/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    twl
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T03:18:02.000Z" title="Tue Feb 10 2026 03:18:02 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»10åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"/>
<blockquote>
<p>æ·±åº¦è§£æ Anthony Fu çš„åˆä¸€ä¸ªã€Œç†å¿µå…ˆè¡Œã€å¼€æºä½œå“</p>
</blockquote>
<hr/>
<h3 data-id="heading-1">ä¸€ã€ä¸ºä»€ä¹ˆéœ€è¦ skills-npmï¼Ÿ</h3>
<p>å¦‚æœä½ æ­£åœ¨ç”¨ Cursorã€Claude Code æˆ– Windsurf ç­‰ AI ç¼–ç åŠ©æ‰‹ï¼Œä½ å¯èƒ½å·²ç»ä½“éªŒè¿‡ã€ŒSkillsã€çš„æ¦‚å¿µ â€”â€” ä¸€ç»„è‡ªå®šä¹‰çš„æŒ‡ä»¤å’Œä¸Šä¸‹æ–‡ï¼Œå‘Šè¯‰ AI å¦‚ä½•ä¸ä½ çš„é¡¹ç›®åä½œã€‚ä½†å½“ä½ æƒ³æŠŠè¿™äº› Skills åˆ†äº«ç»™å›¢é˜Ÿã€è·¨é¡¹ç›®å¤ç”¨ï¼Œç”šè‡³éšå·¥å…·åº“ä¸€èµ·åˆ†å‘æ—¶ï¼Œé—®é¢˜å°±æ¥äº†ï¼š</p>

























<table><thead><tr><th>ç—›ç‚¹</th><th>å…¸å‹åœºæ™¯</th></tr></thead><tbody><tr><td><strong>åˆ†å‘ç¢ç‰‡åŒ–</strong></td><td>æ¯ä¸ª Skill éƒ½æ•£è½åœ¨ç‹¬ç«‹ Git ä»“åº“ä¸­ï¼Œæ‰‹åŠ¨å…‹éš†å®‰è£…</td></tr><tr><td><strong>ç‰ˆæœ¬ä¸å¯¹é½</strong></td><td>å·¥å…·å‡çº§äº†ï¼ŒSkill è¿˜åœç•™åœ¨æ—§ç‰ˆæœ¬ï¼Œè¡Œä¸ºä¸å¯é¢„æµ‹</td></tr><tr><td><strong>æ‰‹åŠ¨ç®¡ç†</strong></td><td>ä»å®‰è£…åˆ°æ›´æ–°ï¼Œå…¨ç¨‹æ‰‹åŠ¨æ“ä½œ</td></tr><tr><td><strong>å›¢é˜ŸåŒæ­¥å›°éš¾</strong></td><td>æ–°æˆå‘˜åŠ å…¥éœ€è¦é‡æ–°é…ç½®ä¸€é Skills ç¯å¢ƒ</td></tr></tbody></table>
<p>Anthony Fuï¼ˆVue/Vite æ ¸å¿ƒè´¡çŒ®è€…ï¼‰çš„è§£æ³•ä¼˜é›…è€Œå¤§èƒ†ï¼š<strong>ä¸è¦é‡æ–°å‘æ˜è½®å­ï¼Œè®© npm æ¥åšå®ƒæœ€æ“…é•¿çš„äº‹ã€‚</strong></p>
<p>skills-npm çš„æ ¸å¿ƒä¸»å¼ æ˜¯ï¼šå°† Agent Skills å†…åµŒåˆ° npm åŒ…ä¸­ï¼Œåˆ©ç”¨ npm å·²æœ‰çš„ç‰ˆæœ¬ç®¡ç†ã€ä¾èµ–è§£æã€lockfile é”å®šå’Œç§æœ‰ä»“åº“ç­‰åŸºç¡€è®¾æ–½ï¼Œè®© Skills çš„åˆ†å‘å’Œç®¡ç†å˜å¾—å’Œå®‰è£…ä¸€ä¸ª npm ä¾èµ–ä¸€æ ·ç®€å•ã€‚</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># å®‰è£…ä¸€ä¸ªåŒ…å« Skills çš„ npm åŒ…</span>
npm install @slidev/cli

<span class="hljs-comment"># è¿è¡Œ skills-npmï¼Œè‡ªåŠ¨å‘ç°å¹¶é“¾æ¥ Skills</span>
npx skills-npm
</code></pre>
<p>å°±è¿™ä¹ˆç®€å•ã€‚<code>.cursor/skills/</code> ä¸‹è‡ªåŠ¨å‡ºç°äº† <code>npm-slidev-cli-presenter-mode</code> â€” ä¸€ä¸ªç¬¦å·é“¾æ¥ï¼ŒæŒ‡å‘åˆšå®‰è£…çš„ npm åŒ…ä¸­çš„ Skill ç›®å½•ã€‚</p>
<hr/>
<h3 data-id="heading-2">äºŒã€çº¦å®šä¼˜äºé…ç½®ï¼šä¸€åˆ‡å§‹äº <code>skills/*/SKILL.md</code></h3>
<p>skills-npm çš„åˆ†å‘åè®®æå…¶ç®€æ´ã€‚å¦‚æœä½ æ˜¯å·¥å…·åº“ä½œè€…ï¼Œæƒ³éšåŒ…é™„å¸¦ Agent Skillsï¼Œåªéœ€è¦åœ¨ä½ çš„ npm åŒ…ä¸­æŒ‰å¦‚ä¸‹ç»“æ„ç»„ç»‡ï¼š</p>
<pre><code class="hljs language-css" lang="css">your-awesome-lib/
â”œâ”€â”€ <span class="hljs-attribute">src</span>/
â”œâ”€â”€ package<span class="hljs-selector-class">.json</span>
â””â”€â”€ skills/
    â”œâ”€â”€ debug-helper/
    â”‚   â””â”€â”€ SKILL<span class="hljs-selector-class">.md</span>
    â””â”€â”€ <span class="hljs-selector-tag">code</span>-generation/
        â””â”€â”€ SKILL<span class="hljs-selector-class">.md</span>
</code></pre>
<p>æ¯ä¸ª <code>SKILL.md</code> éœ€è¦åŒ…å« YAML frontmatter æ¥å£°æ˜å…ƒä¿¡æ¯ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-meta">---</span>
<span class="hljs-attr">name:</span> <span class="hljs-string">debug-helper</span>
<span class="hljs-attr">description:</span> <span class="hljs-string">å¸®åŠ©</span> <span class="hljs-string">AI</span> <span class="hljs-string">ä»£ç†ç†è§£é¡¹ç›®çš„è°ƒè¯•çº¦å®š</span>
<span class="hljs-meta">---
</span>
<span class="hljs-string">åœ¨è°ƒè¯•æœ¬é¡¹ç›®æ—¶ï¼Œè¯·éµå¾ªä»¥ä¸‹è§„èŒƒ...</span>
</code></pre>
<p>è¿™å°±æ˜¯å…¨éƒ¨çš„ã€Œåè®®ã€ã€‚æ²¡æœ‰ JSON Schemaï¼Œæ²¡æœ‰æ³¨å†Œä¸­å¿ƒï¼Œæ²¡æœ‰é¢å¤–çš„æ„å»ºæ­¥éª¤ â€”â€” <strong>çº¦å®šä¼˜äºé…ç½®çš„æè‡´å®è·µã€‚</strong></p>
<p>skills-npm ä¼šä½¿ç”¨ <code>gray-matter</code> åº“è§£æ frontmatterï¼Œå¹¶éªŒè¯ <code>name</code> å’Œ <code>description</code> å­—æ®µçš„å­˜åœ¨æ€§ã€‚ä¸ç¬¦åˆè§„èŒƒçš„ Skill ä¼šè¢«æ ‡è®°ä¸ºæ— æ•ˆå¹¶åœ¨ç»ˆç«¯ä¸­æŠ¥å‘Šï¼Œä½†ä¸ä¼šä¸­æ–­æ•´ä¸ªæµç¨‹ã€‚</p>
<hr/>
<h3 data-id="heading-3">ä¸‰ã€æ¶æ„å‰–æï¼šä¸€ä¸ªç²¾ç®€çš„ ETL ç®¡é“</h3>
<p>æ•´ä¸ª skills-npm çš„æ ¸å¿ƒä»£ç ä»…çº¦ <strong>1,400 è¡Œ</strong>ï¼Œå´å®ç°äº†å®Œæ•´çš„ CLI å·¥å…·é“¾ã€‚å®ƒé‡‡ç”¨äº†ç»å…¸çš„ <strong>ETLï¼ˆExtract-Transform-Loadï¼‰ç®¡é“æ¶æ„</strong>ï¼š</p>
<pre><code class="hljs">é…ç½®åŠ è½½ â†’ æŠ€èƒ½æ‰«æ â†’ è¿‡æ»¤å¤„ç† â†’ Agent æ£€æµ‹ â†’ ç¬¦å·é“¾æ¥åˆ›å»º â†’ .gitignore æ›´æ–°
</code></pre>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart LR
    A[CLI å…¥å£&lt;br/&gt;cac] --&gt; B[é…ç½®è§£æ&lt;br/&gt;unconfig]
    B --&gt; C[Skills æ‰«æ&lt;br/&gt;scan.ts]
    C --&gt; D[Include/Exclude&lt;br/&gt;è¿‡æ»¤]
    D --&gt; E[Agent æ£€æµ‹]
    E --&gt; F[ç”¨æˆ·ç¡®è®¤&lt;br/&gt;@clack/prompts]
    F --&gt; G[ç¬¦å·é“¾æ¥&lt;br/&gt;symlink.ts]
    G --&gt; H[.gitignore&lt;br/&gt;æ›´æ–°]
    
    C -.-&gt; J[ç¼“å­˜å±‚&lt;br/&gt;cache.ts]
    J -.-&gt; C
</code></pre>
<p>æ¯ä¸ªç¯èŠ‚å¯¹åº”ä¸€ä¸ªç‹¬ç«‹æ¨¡å—ï¼ŒèŒè´£å•ä¸€ã€è¾¹ç•Œæ¸…æ™°ã€‚è®©æˆ‘ä»¬é€ä¸€æ‹†è§£ã€‚</p>
<h4 data-id="heading-4">3.1 Extract â€” æŠ€èƒ½æ‰«æå¼•æ“</h4>
<p>æ‰«æå¼•æ“ï¼ˆ<code>scan.ts</code>ï¼‰æ˜¯æ•´ä¸ªå·¥å…·çš„æ ¸å¿ƒï¼Œæ”¯æŒä¸¤ç§æ‰«æç­–ç•¥ï¼š</p>
<p><strong>ç­–ç•¥ä¸€ï¼š<code>node_modules</code> å…¨æ‰«æ</strong></p>
<p>éå†æ•´ä¸ª <code>node_modules</code> ç›®å½•ï¼Œæ£€æŸ¥æ¯ä¸ªåŒ…æ˜¯å¦åŒ…å« <code>skills/</code> å­ç›®å½•ã€‚è¿™ç§æ–¹å¼è¦†ç›–é¢å¹¿ï¼Œèƒ½å‘ç°æ‰€æœ‰å±‚çº§çš„ Skillsï¼ŒåŒ…æ‹¬é—´æ¥ä¾èµ–ä¸­çš„ Skillsã€‚</p>
<p><strong>ç­–ç•¥äºŒï¼š<code>package.json</code> ç²¾å‡†æ‰«æ</strong></p>
<p>åªæ£€æŸ¥ <code>dependencies</code> å’Œ <code>devDependencies</code> ä¸­æ˜¾å¼å£°æ˜çš„ç›´æ¥ä¾èµ–ã€‚æ›´å¿«ã€æ›´ç²¾å‡†ï¼Œé€‚åˆå¤§å‹é¡¹ç›®ã€‚</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">scanCurrentNodeModules</span>(<span class="hljs-params">
  cwd: <span class="hljs-built_in">string</span>, 
  source: ScanOptions[<span class="hljs-string">'source'</span>] = <span class="hljs-string">'node_modules'</span>
</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">ScanResult</span>&gt; {
  <span class="hljs-comment">// æ ¹æ®ç­–ç•¥å†³å®šæ‰«æèŒƒå›´</span>
  <span class="hljs-keyword">const</span> packageNames = source === <span class="hljs-string">'package.json'</span> 
    ? <span class="hljs-keyword">await</span> <span class="hljs-title function_">getPackageDeps</span>(cwd) 
    : <span class="hljs-literal">null</span>

  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> entry <span class="hljs-keyword">of</span> entries) {
    <span class="hljs-keyword">if</span> (entry.<span class="hljs-property">name</span>.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">'@'</span>)) {
      <span class="hljs-comment">// å¤„ç†ä½œç”¨åŸŸåŒ…ï¼šè¿›å…¥ @org/ äºŒçº§ç›®å½•ç»§ç»­æ‰«æ</span>
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">await</span> <span class="hljs-title function_">scanPackageForSkills</span>(entry)
    }
  }
}
</code></pre>
<p>ä¸€ä¸ªå€¼å¾—æ³¨æ„çš„ç»†èŠ‚ï¼šæ‰«ææ—¶ä½¿ç”¨ <code>isDirectoryOrSymlink()</code> è€Œéç®€å•çš„ <code>isDirectory()</code> æ£€æŸ¥ï¼Œè¿™æ˜¯å¯¹ <strong>pnpm ç¬¦å·é“¾æ¥ç»“æ„çš„ä¸“é—¨é€‚é…</strong>ã€‚pnpm ä¸ºäº†èŠ‚çœç£ç›˜ç©ºé—´ï¼Œåœ¨ <code>node_modules</code> ä¸­ä½¿ç”¨ç¬¦å·é“¾æ¥æŒ‡å‘å…¨å±€å­˜å‚¨ï¼Œå¦‚æœåªæ£€æŸ¥ç›®å½•ç±»å‹ä¼šé—æ¼æ‰€æœ‰åŒ…ã€‚</p>
<p>å¯¹äº <strong>Monorepo åœºæ™¯</strong>ï¼Œskills-npm æä¾› <code>--recursive</code> å‚æ•°ï¼Œé€šè¿‡è§£æ <code>pnpm-workspace.yaml</code> æˆ– <code>package.json</code> çš„ <code>workspaces</code> å­—æ®µï¼Œæ‰¾åˆ°æ‰€æœ‰å­åŒ…å¹¶ç‹¬ç«‹æ‰«æï¼Œä½¿ç”¨ Map æŒ‰åŒ…åå»é‡ã€‚</p>
<h4 data-id="heading-5">3.2 Transform â€” è¿‡æ»¤ç³»ç»Ÿ</h4>
<p>è¿‡æ»¤ç³»ç»Ÿï¼ˆ<code>utils/skills.ts</code>ï¼‰æ”¯æŒä¸¤ç§ç²’åº¦çš„æ§åˆ¶ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// åŒ…çº§åˆ«è¿‡æ»¤ï¼šåŒ¹é…æ•´ä¸ªåŒ…çš„æ‰€æœ‰ Skills</span>
<span class="hljs-attr">include</span>: [<span class="hljs-string">'@slidev/cli'</span>]

<span class="hljs-comment">// æŠ€èƒ½çº§åˆ«è¿‡æ»¤ï¼šç²¾ç¡®åˆ°ç‰¹å®šåŒ…çš„ç‰¹å®š Skill</span>
<span class="hljs-attr">exclude</span>: [{ <span class="hljs-attr">package</span>: <span class="hljs-string">'@some/lib'</span>, <span class="hljs-attr">skills</span>: [<span class="hljs-string">'deprecated-skill'</span>] }]
</code></pre>
<p>è¿‡æ»¤ä½¿ç”¨ç»å…¸çš„ç™½åå• + é»‘åå•æ¨¡å¼ï¼šå…ˆé€šè¿‡ <code>include</code> ç­›é€‰å‡ºæƒ³è¦çš„ï¼Œå†é€šè¿‡ <code>exclude</code> æ’é™¤ä¸éœ€è¦çš„ã€‚</p>
<h4 data-id="heading-6">3.3 Load â€” ç¬¦å·é“¾æ¥å¼•æ“</h4>
<p>ç¬¦å·é“¾æ¥åˆ›å»ºï¼ˆ<code>symlink.ts</code>ï¼‰æ˜¯æœ€ä½“ç°å·¥ç¨‹ç´ å…»çš„æ¨¡å—ã€‚126 è¡Œä»£ç ä¸­ï¼Œè¾¹ç•Œå¤„ç†å ªç§°æ•™ç§‘ä¹¦çº§åˆ«ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">createSymlink</span>(<span class="hljs-params">target: <span class="hljs-built_in">string</span>, linkPath: <span class="hljs-built_in">string</span></span>) {
  <span class="hljs-comment">// 1. å¹‚ç­‰æ€§ï¼šç›®æ ‡è·¯å¾„ç›¸åŒ â†’ ç›´æ¥è·³è¿‡</span>
  <span class="hljs-keyword">if</span> (resolvedTarget === resolvedLinkPath) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>

  <span class="hljs-comment">// 2. å·²æœ‰é“¾æ¥å¤„ç†ï¼š</span>
  <span class="hljs-comment">//    - ç¬¦å·é“¾æ¥å·²æŒ‡å‘æ­£ç¡®ç›®æ ‡ â†’ è·³è¿‡</span>
  <span class="hljs-comment">//    - ç¬¦å·é“¾æ¥æŒ‡å‘é”™è¯¯ç›®æ ‡ â†’ åˆ é™¤åé‡å»º</span>
  <span class="hljs-comment">//    - éç¬¦å·é“¾æ¥æ–‡ä»¶å ä½ â†’ é€’å½’åˆ é™¤åé‡å»º</span>

  <span class="hljs-comment">// 3. å¾ªç¯å¼•ç”¨é˜²æŠ¤ï¼šæ•è· ELOOP é”™è¯¯å¹¶å¼ºåˆ¶æ¸…é™¤</span>

  <span class="hljs-comment">// 4. è·¨å¹³å°å…¼å®¹ï¼šWindows ä½¿ç”¨ junction ç±»å‹</span>
  <span class="hljs-keyword">const</span> symlinkType = <span class="hljs-title function_">platform</span>() === <span class="hljs-string">'win32'</span> ? <span class="hljs-string">'junction'</span> : <span class="hljs-literal">undefined</span>

  <span class="hljs-comment">// 5. ä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼šé¡¹ç›®ç§»åŠ¨åé“¾æ¥ä¾ç„¶æœ‰æ•ˆ</span>
  <span class="hljs-keyword">const</span> relativePath = <span class="hljs-title function_">relative</span>(linkDir, target)
  <span class="hljs-keyword">await</span> <span class="hljs-title function_">symlink</span>(relativePath, linkPath, symlinkType)
}
</code></pre>
<p><strong>ä¸ºä»€ä¹ˆç”¨ç›¸å¯¹è·¯å¾„è€Œä¸æ˜¯ç»å¯¹è·¯å¾„ï¼Ÿ</strong> è€ƒè™‘ä¸€ä¸ªåœºæ™¯ï¼šä½ åœ¨ CI ç¯å¢ƒä¸­ clone é¡¹ç›®åˆ° <code>/home/runner/project</code>ï¼Œæœ¬åœ°å¼€å‘åœ¨ <code>/Users/you/project</code>ã€‚å¦‚æœä½¿ç”¨ç»å¯¹è·¯å¾„åˆ›å»ºç¬¦å·é“¾æ¥ï¼Œé“¾æ¥åœ¨ä¸åŒæœºå™¨ä¸Šä¼šå¤±æ•ˆã€‚ç›¸å¯¹è·¯å¾„ç¡®ä¿äº†é¡¹ç›®ç›®å½•å¯ä»¥æ•´ä½“ç§»åŠ¨æˆ–åœ¨ä¸åŒè·¯å¾„ä¸‹ä½¿ç”¨ï¼Œç¬¦å·é“¾æ¥å§‹ç»ˆæœ‰æ•ˆã€‚</p>
<p><strong>å‘½åè§„åˆ™</strong> ä½¿ç”¨ <code>npm-{sanitized-package}-{skill-name}</code> çš„æ ¼å¼ï¼š</p>
<pre><code class="hljs language-perl" lang="perl">@slidev/cli çš„ presenter-mode â†’ npm-slidev-cli-presenter-mode
<span class="hljs-keyword">my</span>-lib çš„ debug-helper       â†’ npm-<span class="hljs-keyword">my</span>-lib-debug-helper
</code></pre>
<p><code>npm-</code> å‰ç¼€è®©ç”¨æˆ·ä¸€çœ¼å°±èƒ½åŒºåˆ†æ¥è‡ª npm çš„ Skill å’Œæ‰‹åŠ¨åˆ›å»ºçš„ Skillã€‚</p>
<hr/>
<h3 data-id="heading-7">å››ã€ç¼“å­˜ï¼šå°è€Œç²¾çš„æ€§èƒ½ä¼˜åŒ–</h3>
<p>åœ¨å¤§å‹é¡¹ç›®ä¸­ï¼Œ<code>node_modules</code> å¯èƒ½åŒ…å«æ•°åƒä¸ªåŒ…ã€‚æ¯æ¬¡è¿è¡Œéƒ½å…¨é‡æ‰«ææ˜¾ç„¶ä¸åˆ‡å®é™…ã€‚skills-npm çš„ç¼“å­˜ç­–ç•¥ï¼ˆ<code>cache.ts</code>ï¼Œ58 è¡Œï¼‰å·§å¦™è€Œå®ç”¨ï¼š</p>
<p><strong>æ ¸å¿ƒæ€è·¯ï¼šlockfile ä¸å˜ = ä¾èµ–ä¸å˜ = æ‰«æç»“æœä¸å˜ã€‚</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getPackageManagerLockFileHash</span>(<span class="hljs-params">cwd: <span class="hljs-built_in">string</span></span>) {
  <span class="hljs-comment">// æŒ‰ä¼˜å…ˆçº§å°è¯•ï¼šbun.lockb â†’ pnpm-lock.yaml â†’ yarn.lock â†’ package-lock.json</span>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> file <span class="hljs-keyword">of</span> <span class="hljs-variable constant_">LOCK_FILES</span>.<span class="hljs-property">all</span>) {
    <span class="hljs-keyword">const</span> encoding = <span class="hljs-title function_">isBinaryLockFile</span>(file) ? <span class="hljs-literal">undefined</span> : <span class="hljs-string">'utf-8'</span>
    <span class="hljs-keyword">const</span> content = <span class="hljs-keyword">await</span> <span class="hljs-title function_">readFile</span>(<span class="hljs-title function_">join</span>(cwd, file), encoding)
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">hash</span>: <span class="hljs-title function_">createHash</span>(<span class="hljs-string">'md5'</span>).<span class="hljs-title function_">update</span>(content).<span class="hljs-title function_">digest</span>(<span class="hljs-string">'hex'</span>),
      <span class="hljs-attr">path</span>: file,
    }
  }
}
</code></pre>
<p>ç¼“å­˜å­˜å‚¨åœ¨ <code>node_modules/.skills-npm/cache.json</code>ã€‚è¿™ä¸ªè·¯å¾„çš„é€‰æ‹©ä¹Ÿå€¼å¾—ç©å‘³ â€”â€” å½“ä½ æ‰§è¡Œ <code>rm -rf node_modules</code> é‡è£…ä¾èµ–æ—¶ï¼Œæ—§ç¼“å­˜è‡ªåŠ¨æ¶ˆå¤±ï¼Œæ–°ä¸€æ¬¡æ‰«æä¼šé‡å»ºç¼“å­˜ã€‚ç¼“å­˜çš„æ¸…ç†å’Œ <code>node_modules</code> çš„ç”Ÿå‘½å‘¨æœŸè‡ªç„¶å¯¹é½ï¼Œä¸éœ€è¦é¢å¤–çš„æ¸…ç†æœºåˆ¶ã€‚</p>
<hr/>
<h3 data-id="heading-8">äº”ã€é…ç½®ç³»ç»Ÿï¼šä¸‰å±‚è¦†ç›– + TypeScript åŸç”Ÿæ”¯æŒ</h3>
<p>skills-npm æä¾›ä¸‰å±‚é…ç½®åˆå¹¶æœºåˆ¶ï¼Œéµå¾ªã€Œæœ€è¿‘åŸåˆ™ã€ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">é»˜è®¤é…ç½® &lt; skills-npm.config.ts &lt; CLI å‚æ•°
</code></pre>
<p>é…ç½®æ–‡ä»¶ä½¿ç”¨ Anthony Fu è‡ªå·±ç»´æŠ¤çš„ <code>unconfig</code> åº“åŠ è½½ï¼ŒåŸç”Ÿæ”¯æŒ TypeScript æ ¼å¼ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// skills-npm.config.ts</span>
<span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'skills-npm'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-attr">source</span>: <span class="hljs-string">'package.json'</span>,      <span class="hljs-comment">// åªæ‰«æç›´æ¥ä¾èµ–</span>
  <span class="hljs-attr">recursive</span>: <span class="hljs-literal">true</span>,             <span class="hljs-comment">// é€’å½’æ‰«æ Monorepo</span>
  <span class="hljs-attr">include</span>: [<span class="hljs-string">'@slidev/*'</span>],      <span class="hljs-comment">// åªå®‰è£… Slidev ç›¸å…³çš„ Skills</span>
  <span class="hljs-attr">exclude</span>: [{ <span class="hljs-attr">package</span>: <span class="hljs-string">'@some/lib'</span>, <span class="hljs-attr">skills</span>: [<span class="hljs-string">'experimental'</span>] }],
  <span class="hljs-attr">confirm</span>: <span class="hljs-literal">false</span>,              <span class="hljs-comment">// è·³è¿‡ç¡®è®¤æç¤ºï¼ˆCI ç¯å¢ƒï¼‰</span>
})
</code></pre>
<p><code>defineConfig</code> æ˜¯ä¸€ä¸ªç»å…¸çš„ identity å‡½æ•°ï¼Œå”¯ä¸€çš„ä½œç”¨æ˜¯æä¾› TypeScript ç±»å‹æ¨å¯¼ï¼Œè®©ä½ åœ¨å†™é…ç½®æ—¶è·å¾—å®Œæ•´çš„è‡ªåŠ¨è¡¥å…¨ã€‚</p>
<hr/>
<h3 data-id="heading-9">å…­ã€ç»ˆç«¯ä½“éªŒï¼šTTY æ„ŸçŸ¥çš„åŒæ¨¡å¼è¾“å‡º</h3>
<p>skills-npm çš„ç»ˆç«¯ä½“éªŒåšäº†ç²¾ç»†çš„ç¯å¢ƒé€‚é…ï¼ˆ<code>printer.ts</code>ï¼‰ï¼š</p>
<p><strong>TTY æ¨¡å¼</strong>ï¼ˆäº¤äº’å¼ç»ˆç«¯ï¼‰ï¼šä½¿ç”¨ <code>@clack/prompts</code> æä¾›äº¤äº’å¼ä½“éªŒï¼ŒåŒ…æ‹¬æ¸å˜ç°è‰²çš„ ASCII Art Logoã€spinner è¿›åº¦åŠ¨ç”»ã€å½©è‰²æŠ€èƒ½åˆ—è¡¨ï¼ˆ<code>picocolors</code>ï¼‰ã€ä»¥åŠç¡®è®¤/å¤šé€‰æç¤ºã€‚</p>
<p><strong>é TTY æ¨¡å¼</strong>ï¼ˆCI/CD ç®¡é“ï¼‰ï¼šè‡ªåŠ¨é™çº§ä¸ºçº¯æ–‡æœ¬è¾“å‡ºï¼Œæ—  ANSI é¢œè‰²ç ï¼Œæ— äº¤äº’å¼æç¤ºï¼Œç¡®ä¿åœ¨æ—¥å¿—ç³»ç»Ÿä¸­å¯è¯»ã€‚</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">if</span> (isTTY) {
  p.<span class="hljs-property">log</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Discovered skills:'</span>)
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`  <span class="hljs-subst">${c.green(<span class="hljs-string">'â—'</span>)}</span> <span class="hljs-subst">${c.bold(skill.name)}</span> <span class="hljs-subst">${c.dim(<span class="hljs-string">`from <span class="hljs-subst">${pkg}</span>`</span>)}</span>`</span>)
} <span class="hljs-keyword">else</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`  - <span class="hljs-subst">${skill.name}</span> (<span class="hljs-subst">${pkg}</span>)`</span>)
}
</code></pre>
<p>è¿™ç§åŒæ¨¡å¼è®¾è®¡ä¿è¯äº†ä¸€ä¸ªå‘½ä»¤åœ¨æœ¬åœ°å¼€å‘å’Œ CI/CD ç¯å¢ƒä¸­éƒ½è¡¨ç°è‰¯å¥½ï¼Œæ˜¯ä¼˜ç§€ CLI å·¥å…·çš„æ ‡å‡†å®è·µã€‚</p>
<hr/>
<h3 data-id="heading-10">ä¸ƒã€Vendor å­æ¨¡å—ï¼šç«™åœ¨å·¨äººè‚©è†€ä¸Š</h3>
<p>skills-npm é€šè¿‡ Git submodule å¼•å…¥äº† <code>vercel-labs/skills</code> ä½œä¸º vendor ä¾èµ–ã€‚è¿™ä¸ªå­æ¨¡å—æä¾›äº† Agent ç±»å‹å®šä¹‰ï¼ˆ<code>AgentType</code>ã€<code>AgentConfig</code>ï¼‰å’Œ Agent æ£€æµ‹é€»è¾‘ï¼ˆ<code>detectInstalledAgents()</code>ï¼‰ã€‚</p>
<p>æ„å»ºæ—¶é€šè¿‡ tsdown çš„ <code>noExternal: [/vendor\/skills/]</code> é…ç½®å°† vendor ä»£ç å†…è”æ‰“åŒ…åˆ°æœ€ç»ˆäº§ç‰©ä¸­ï¼Œå®ç°äº†ï¼š</p>
<ul>
<li><strong>ç±»å‹å…±äº«</strong>ï¼šå¤ç”¨ä¸Šæ¸¸æ ‡å‡†ç±»å‹è€Œéè‡ªå·±å®šä¹‰</li>
<li><strong>æ£€æµ‹é€»è¾‘å¤ç”¨</strong>ï¼šä¸é‡å¤å®ç° Agent ç‰¹å®šç›®å½•çš„æ£€æµ‹</li>
<li><strong>ç‰ˆæœ¬å¯æ§</strong>ï¼šé€šè¿‡ submodule çš„ commit hash ç²¾ç¡®é”å®šä¸Šæ¸¸ç‰ˆæœ¬</li>
</ul>
<p>è¿™æ˜¯ä¸€ç§ã€Œ<strong>ç¼–è¯‘æ—¶ä¾èµ–ï¼Œè¿è¡Œæ—¶é›¶ä¾èµ–</strong>ã€çš„ç­–ç•¥ â€”â€” ç”¨æˆ·ä¸éœ€è¦å®‰è£… <code>vercel-labs/skills</code>ï¼Œä½† skills-npm çš„ä»£ç ä¸­åŒ…å«äº†å®ƒçš„é€»è¾‘ã€‚</p>
<hr/>
<h3 data-id="heading-11">å…«ã€å·¥ä½œåŒºæ£€æµ‹ï¼šç§»æ¤è‡ª Vite çš„æˆç†Ÿå®è·µ</h3>
<p>å·¥ä½œåŒºæ ¹ç›®å½•çš„æ£€æµ‹ï¼ˆ<code>utils/workspace.ts</code>ï¼‰ç›´æ¥ç§»æ¤è‡ª Vite çš„æºç ï¼Œé€šè¿‡é€’å½’å‘ä¸Šæœç´¢æ¥å®šä½ Monorepo æ ¹ç›®å½•ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">ROOT_FILES</span> = [<span class="hljs-string">'pnpm-workspace.yaml'</span>, <span class="hljs-string">'lerna.json'</span>]

<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">searchForWorkspaceRoot</span>(<span class="hljs-params">current: <span class="hljs-built_in">string</span>, root: <span class="hljs-built_in">string</span></span>): <span class="hljs-built_in">string</span> {
  <span class="hljs-keyword">if</span> (<span class="hljs-title function_">hasRootFile</span>(current)) <span class="hljs-keyword">return</span> current              <span class="hljs-comment">// æ‰¾åˆ°æ ‡å¿—æ–‡ä»¶</span>
  <span class="hljs-keyword">if</span> (<span class="hljs-title function_">hasWorkspacePackageJSON</span>(current)) <span class="hljs-keyword">return</span> current  <span class="hljs-comment">// package.json æœ‰ workspaces</span>
  <span class="hljs-keyword">const</span> dir = <span class="hljs-title function_">dirname</span>(current)
  <span class="hljs-keyword">if</span> (!dir || dir === current) <span class="hljs-keyword">return</span> root              <span class="hljs-comment">// åˆ°è¾¾æ–‡ä»¶ç³»ç»Ÿæ ¹</span>
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">searchForWorkspaceRoot</span>(dir, root)              <span class="hljs-comment">// ç»§ç»­å‘ä¸Š</span>
}
</code></pre>
<p>è¿™ç§ã€Œå‘ä¸Šæ¢æµ‹ã€çš„æ¨¡å¼åœ¨ Node.js å·¥å…·é“¾ä¸­éå¸¸å¸¸è§ï¼ˆESLintã€Prettier ä¹Ÿæ˜¯ç±»ä¼¼ç­–ç•¥ï¼‰ï¼Œskills-npm é€‰æ‹©å¤ç”¨ Vite ç»è¿‡å¤§è§„æ¨¡éªŒè¯çš„å®ç°ï¼Œæ˜¯æ˜æ™ºçš„å·¥ç¨‹å†³ç­–ã€‚</p>
<hr/>
<h3 data-id="heading-12">ä¹ã€è®¾è®¡ç²¾åä¸æŠ€æœ¯åˆ›æ–°</h3>
<p>å›é¡¾æ•´ä¸ªé¡¹ç›®ï¼Œæœ‰å‡ ä¸ªè®¾è®¡å†³ç­–å€¼å¾—ç‰¹åˆ«å…³æ³¨ï¼š</p>
<h4 data-id="heading-13">9.1 ç†å¿µåˆ›æ–°ï¼šåŸºç¡€è®¾æ–½å¤ç”¨</h4>
<p>skills-npm æ²¡æœ‰æ„å»ºæ–°çš„åˆ†å‘æ¸ é“ã€æ³¨å†Œä¸­å¿ƒæˆ–ç‰ˆæœ¬ç®¡ç†ç³»ç»Ÿã€‚å®ƒçš„åˆ›æ–°åœ¨äº <strong>è®¤çŸ¥å±‚é¢</strong> â€”â€” å°† Agent Skills çš„åˆ†å‘é—®é¢˜æ˜ å°„åˆ°å·²æœ‰çš„ npm ç”Ÿæ€ä¸Šã€‚npm çš„ç‰ˆæœ¬è¯­ä¹‰åŒ–ã€lockfile é”å®šã€ç§æœ‰ä»“åº“ã€CI/CD é›†æˆã€Monorepo æ”¯æŒâ€¦â€¦è¿™äº›ç»è¿‡åå¤šå¹´æ‰“ç£¨çš„åŸºç¡€è®¾æ–½ï¼Œskills-npm å…¨éƒ¨ç™½å«–ã€‚</p>
<h4 data-id="heading-14">9.2 å¹‚ç­‰è®¾è®¡ï¼š<code>prepare</code> è„šæœ¬å‹å¥½</h4>
<p>skills-npm è¢«è®¾è®¡ä¸ºå¯ä»¥å®‰å…¨åœ°æ”¾å…¥ <code>package.json</code> çš„ <code>prepare</code> è„šæœ¬ä¸­ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"scripts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"prepare"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"skills-npm --yes"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>æ¯æ¬¡ <code>npm install</code> åè‡ªåŠ¨æ‰§è¡Œã€‚å¹‚ç­‰æ€§ç¡®ä¿äº†é‡å¤è¿è¡Œä¸ä¼šäº§ç”Ÿå‰¯ä½œç”¨ï¼Œç¼“å­˜æœºåˆ¶é¿å…äº†ä¸å¿…è¦çš„æ‰«æå¼€é”€ã€‚</p>
<h4 data-id="heading-15">9.3 æ¨¡å—åŒ–æè‡´</h4>
<p>14 ä¸ªæºæ–‡ä»¶ï¼Œå¹³å‡æ¯ä¸ªæ–‡ä»¶ä¸è¶…è¿‡ 100 è¡Œã€‚æ¯ä¸ªæ–‡ä»¶çš„å‘½åå°±æ˜¯å®ƒçš„èŒè´£ï¼š<code>scan.ts</code> åªåšæ‰«æï¼Œ<code>symlink.ts</code> åªåšé“¾æ¥ï¼Œ<code>cache.ts</code> åªåšç¼“å­˜ã€‚ç±»å‹å®šä¹‰é›†ä¸­åœ¨ <code>types.ts</code>ï¼Œå¸¸é‡é›†ä¸­åœ¨ <code>constants.ts</code>ã€‚è¿™ç§æè‡´çš„å…³æ³¨ç‚¹åˆ†ç¦»è®©ä»£ç çš„å¯ç»´æŠ¤æ€§å’Œå¯æµ‹è¯•æ€§éƒ½è¾¾åˆ°äº†å¾ˆé«˜çš„æ°´å¹³ã€‚</p>
<hr/>
<h3 data-id="heading-16">åã€æ”¹è¿›ç©ºé—´ä¸æœªæ¥å±•æœ›</h3>
<p>ä½œä¸º v0.1.0 é˜¶æ®µçš„é¡¹ç›®ï¼Œskills-npm ä»æœ‰ä¸å°‘è¿›åŒ–ç©ºé—´ï¼š</p>








































<table><thead><tr><th>æ–¹é¢</th><th>ç°çŠ¶</th><th>æ½œåœ¨æ”¹è¿›</th></tr></thead><tbody><tr><td><strong>æ‰«ææ€§èƒ½</strong></td><td>åŒ…é€ä¸ªä¸²è¡Œæ‰«æ</td><td>ä½¿ç”¨ <code>Promise.all</code> æˆ– <code>p-limit</code> å¹¶è¡Œæ‰«æ</td></tr><tr><td><strong>é”™è¯¯æ¢å¤</strong></td><td>å¤§é‡ catch å—é™é»˜å¿½ç•¥</td><td>å¢åŠ  <code>--verbose</code> æ¨¡å¼æš´éœ²è°ƒè¯•ä¿¡æ¯</td></tr><tr><td><strong>ç¼“å­˜ç²’åº¦</strong></td><td>lockfile çº§åˆ«ï¼ˆä»»ä½•ä¾èµ–å˜åŒ–éƒ½å¤±æ•ˆï¼‰</td><td>å¯æŒ‰åŒ…çº§åˆ«åšå¢é‡ç¼“å­˜</td></tr><tr><td><strong>é“¾æ¥æ¸…ç†</strong></td><td>æ— è‡ªåŠ¨æ¸…ç†åŠŸèƒ½</td><td>å¢åŠ  <code>--clean</code> å‘½ä»¤æ¸…é™¤å¤±æ•ˆé“¾æ¥</td></tr><tr><td><strong>å®æ—¶æ›´æ–°</strong></td><td>æ—  watch æ¨¡å¼</td><td>ç›‘å¬ <code>node_modules</code> å˜åŒ–è‡ªåŠ¨æ›´æ–°</td></tr><tr><td><strong>åµŒå¥—å‘ç°</strong></td><td>ä¸æ‰«æåµŒå¥— <code>node_modules</code></td><td>é€‚é…é hoisted æ¨¡å¼çš„åŒ…ç®¡ç†ç­–ç•¥</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-17">åä¸€ã€æ€»ç»“</h3>
<p>skills-npm æ˜¯ä¸€ä¸ªå…¸å‹çš„ã€Œå°å·¥å…·ï¼Œå¤§ç†å¿µã€é¡¹ç›®ã€‚1,400 è¡Œä»£ç èƒŒåï¼Œæ˜¯å¯¹ AI Agent å·¥å…·é“¾ç”Ÿæ€çš„æ·±åˆ»è§‚å¯Ÿï¼šSkills çš„åˆ†å‘ä¸éœ€è¦æ–°çš„åŸºç¡€è®¾æ–½ï¼Œnpm å·²ç»å‡†å¤‡å¥½äº†ä¸€åˆ‡ã€‚</p>
<p>ä»æŠ€æœ¯å®ç°æ¥çœ‹ï¼Œé¡¹ç›®çš„ä»£ç è´¨é‡æé«˜ï¼šTypeScript ç±»å‹ç³»ç»Ÿè¿ç”¨è§„èŒƒã€æ¨¡å—èŒè´£åˆ’åˆ†æ¸…æ™°ã€è¾¹ç•Œå¤„ç†ï¼ˆç¬¦å·é“¾æ¥çš„å¹‚ç­‰æ€§ã€ELOOP é˜²æŠ¤ã€Windows å…¼å®¹ï¼‰æ— å¯æŒ‘å‰”ã€‚æŠ€æœ¯æ ˆé€‰å‹ä¹Ÿä½“ç°äº† Anthony Fu ä¸€è´¯çš„å“å‘³ â€”â€” <code>cac</code>ã€<code>picocolors</code>ã€<code>unconfig</code>ã€<code>tsdown</code> â€”â€” æ¯ä¸€ä¸ªéƒ½æ˜¯è½»é‡çº§ã€æ— ä¾èµ–çš„ç²¾å“å·¥å…·ã€‚</p>
<p>åœ¨ AI ç¼–ç åŠ©æ‰‹å¿«é€Ÿæ™®åŠçš„ä»Šå¤©ï¼Œskills-npm å¾ˆå¯èƒ½æˆä¸º Agent Skills åˆ†å‘é¢†åŸŸçš„äº‹å®æ ‡å‡†ã€‚æ¯•ç«Ÿï¼Œ<strong>æœ€å¥½çš„åŸºç¡€è®¾æ–½ï¼Œæ˜¯è®©ä½ æ„Ÿè§‰ä¸åˆ°å®ƒå­˜åœ¨çš„åŸºç¡€è®¾æ–½ã€‚</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å¦‚æœ JavaScript å’Œ TypeScript æ˜¯äººï¼Œä»–ä»¬ä¼šæ€ä¹ˆè°ˆæ‹çˆ±ï¼Ÿ]]></title>    <link>https://juejin.cn/post/7604786493639442459</link>    <guid>https://juejin.cn/post/7604786493639442459</guid>    <pubDate>2026-02-10T03:50:28.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604786493639442459" data-draft-id="7604694326519119923" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å¦‚æœ JavaScript å’Œ TypeScript æ˜¯äººï¼Œä»–ä»¬ä¼šæ€ä¹ˆè°ˆæ‹çˆ±ï¼Ÿ"/> <meta itemprop="keywords" content="JavaScript"/> <meta itemprop="datePublished" content="2026-02-10T03:50:28.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç¨‹åºå‘˜å°å´”æ—¥è®°"/> <meta itemprop="url" content="https://juejin.cn/user/1576048754165866"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å¦‚æœ JavaScript å’Œ TypeScript æ˜¯äººï¼Œä»–ä»¬ä¼šæ€ä¹ˆè°ˆæ‹çˆ±ï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1576048754165866/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç¨‹åºå‘˜å°å´”æ—¥è®°
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T03:50:28.000Z" title="Tue Feb 10 2026 03:50:28 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å½“JavaScriptå’ŒTypeScriptåœ¨å’–å•¡åº—ç›¸äº²ï¼šä¸€åœºå…³äº"ç±»å‹"çš„çˆ±æƒ…å–œå‰§</h2>
<h3 data-id="heading-1">ç®€ä»‹ï¼šä¸¤ä¸ªç¨‹åºå‘˜ç›¸äº²è®°</h3>
<p>æƒ³è±¡ä¸€ä¸‹ï¼Œä½ èµ°è¿›ä¸€å®¶åä¸º"ä»£ç å’–å•¡"çš„å¥‡æ€ªå’–å•¡é¦†ã€‚è§’è½é‡Œåç€ä¸¤ä½æ­£åœ¨ç›¸äº²çš„ç¨‹åºå‘˜ï¼šJavaScriptï¼ˆç®€ç§°JSï¼‰ï¼Œç©¿ç€éšæ„Tæ¤ï¼Œå¤´å‘ä¹±ç³Ÿç³Ÿï¼Œçœ‹èµ·æ¥æœ‰ç‚¹æ¼«ä¸ç»å¿ƒï¼›TypeScriptï¼ˆç®€ç§°TSï¼‰ï¼Œè¥¿è£…é©å±¥ï¼Œæˆ´ç€é‡‘ä¸çœ¼é•œï¼Œé¢å‰æ•´é½æ‘†æ”¾ç€ä¸€ä»½æ¸…å•å’Œä¸€æ”¯ç¬”ã€‚</p>
<p>JSå–äº†å£å’–å•¡ï¼š"å—¨ï¼Œæˆ‘æ˜¯ä¸ªçµæ´»çš„å•èº«æ±‰ï¼Œéšæ—¶å¯ä»¥å˜æˆä»»ä½•ä½ æƒ³è¦çš„æ ·å­ï¼"</p>
<p>TSæ¨äº†æ¨çœ¼é•œï¼š"å¾ˆé«˜å…´è®¤è¯†ä½ ã€‚åœ¨æˆ‘è€ƒè™‘è¿›ä¸€æ­¥å‘å±•å‰ï¼Œè¯·å…ˆå¡«å†™è¿™ä»½ç±»å‹å£°æ˜è¡¨ï¼ŒåŒ…æ‹¬ä½ çš„å§“åï¼ˆå­—ç¬¦ä¸²ï¼‰ã€å¹´é¾„ï¼ˆæ•°å­—ï¼‰ï¼Œä»¥åŠæ˜¯å¦æœ‰è¿‡å˜é‡é‡å®šä¹‰çš„ç»å†ï¼ˆå¸ƒå°”å€¼ï¼‰ã€‚"</p>
<p>è¿™ï¼Œå°±æ˜¯æ•…äº‹çš„å¼€ç«¯ã€‚</p>
<h3 data-id="heading-2">åŒºåˆ«ä¸è”ç³»ï¼šä¸€åœºä»£ç çº¦ä¼šå®å½•</h3>
<h4 data-id="heading-3">ç¬¬ä¸€å¹•ï¼šç‚¹å•é£æ³¢</h4>
<p>JSçœ‹äº†ä¸€çœ¼èœå•ï¼š"æˆ‘è¦ä¸€æ¯'éšä¾¿'ã€‚"</p>
<p>æœåŠ¡å‘˜å›°æƒ‘ï¼š"'éšä¾¿'æ˜¯ä»€ä¹ˆï¼Ÿ"</p>
<p>JSçœ¨çœ¨çœ¼ï¼š"è¿è¡Œæ—¶ä½ å°±çŸ¥é“äº†ï¼å¯èƒ½æ˜¯å’–å•¡ï¼Œä¹Ÿå¯èƒ½æ˜¯èŒ¶ï¼Œç”šè‡³å¯èƒ½æ˜¯æœæ±â€”â€”æƒŠå–œä¸æ˜¯æ›´ç¾å¦™å—ï¼Ÿ"</p>
<p>TSå¹äº†å£æ°”ï¼š"è¯·ç»™æˆ‘ä¸€æ¯æ— ç³–æ‹¿é“ï¼Œæ¸©åº¦70Â±2â„ƒï¼Œå’–å•¡è±†äº§åœ°å“¥ä¼¦æ¯”äºšï¼Œç‰›å¥¶è„‚è‚ªå«é‡3.5%ã€‚è¿™æ˜¯æˆ‘çš„è¯¦ç»†è®¢å•æ¥å£å£°æ˜ã€‚"</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">//Â JSçš„ç‚¹å•æ–¹å¼</span>
<span class="hljs-keyword">let</span>Â myDrinkÂ =Â <span class="hljs-string">"coffee"</span>;
myDrinkÂ =Â <span class="hljs-number">42</span>;Â <span class="hljs-comment">//Â ç°åœ¨å˜æˆæ•°å­—äº†ï¼</span>
myDrinkÂ =Â {Â <span class="hljs-attr">beverage</span>:Â <span class="hljs-string">"tea"</span>,Â <span class="hljs-attr">temp</span>:Â <span class="hljs-string">"hot"</span>Â };Â <span class="hljs-comment">//Â åˆå˜æˆå¯¹è±¡äº†ï¼</span>
<span class="hljs-comment">//Â ä¸€åˆ‡å‘ç”Ÿåœ¨è¿è¡Œæ—¶ï¼Œåƒé­”æœ¯ä¸€æ ·ï¼</span>

<span class="hljs-comment">//Â TSçš„ç‚¹å•æ–¹å¼</span>
<span class="hljs-keyword">interface</span>Â <span class="hljs-title class_">CoffeeOrder</span>Â {
Â Â <span class="hljs-attr">beverageType</span>:Â <span class="hljs-string">"latte"</span>Â |Â <span class="hljs-string">"espresso"</span>Â |Â <span class="hljs-string">"cappuccino"</span>;
Â Â <span class="hljs-attr">temperature</span>:Â <span class="hljs-built_in">number</span>;
Â Â <span class="hljs-attr">sugar</span>:Â <span class="hljs-built_in">boolean</span>;
Â Â <span class="hljs-attr">milkPercentage</span>:Â <span class="hljs-built_in">number</span>;
}

<span class="hljs-keyword">const</span>Â <span class="hljs-attr">myOrder</span>:Â <span class="hljs-title class_">CoffeeOrder</span>Â =Â {
Â Â <span class="hljs-attr">beverageType</span>:Â <span class="hljs-string">"latte"</span>,
Â Â <span class="hljs-attr">temperature</span>:Â <span class="hljs-number">70</span>,
Â Â <span class="hljs-attr">sugar</span>:Â <span class="hljs-literal">false</span>,
Â Â <span class="hljs-attr">milkPercentage</span>:Â <span class="hljs-number">100</span>
};
<span class="hljs-comment">//Â è¯•å›¾æŠŠwaterèµ‹å€¼ç»™beverageTypeï¼Ÿç¼–è¾‘å™¨ä¼šç«‹å³çº¢çº¿ä¸‹åˆ’çº¿è­¦å‘Šï¼</span>
</code></pre>
<h4 data-id="heading-4">ç¬¬äºŒå¹•ï¼šçº¦ä¼šä¸­çš„"æƒŠå–œ"</h4>
<p>JSå’ŒTSå†³å®šå»çœ‹ç”µå½±ã€‚</p>
<p>JSè¯´ï¼š"æˆ‘çŸ¥é“ä¸€å®¶å¾ˆæ£’çš„å½±é™¢ï¼Œèµ°ï¼"</p>
<p>åˆ°äº†åœ°æ–¹ï¼ŒTSæ„£ä½äº†ï¼š"è¿™æ˜¯ä¿é¾„çƒé¦†ã€‚"</p>
<p>JSæŒ å¤´ï¼š"å•Šï¼Œæˆ‘ä»¥ä¸º'å¨±ä¹åœºæ‰€'éƒ½å·®ä¸å¤šã€‚ä¸è¿‡æ²¡å…³ç³»ï¼æˆ‘ä»¬å¯ä»¥ç°åœºå†³å®šåšä»€ä¹ˆï¼"</p>
<p>TSä»åŒ…é‡Œæ‹¿å‡ºè®¡åˆ’è¡¨ï¼š"æ ¹æ®æˆ‘é¢„å…ˆçš„ç±»å‹æ£€æŸ¥ï¼Œæˆ‘ä»¬åº”è¯¥åœ¨ç¬¬15è¡—çš„å½±é™¢ï¼Œè§‚çœ‹ç±»å‹ä¸º'å–œå‰§ç‰‡'æˆ–'ç§‘å¹»ç‰‡'çš„ç”µå½±ï¼Œæ—¶é•¿ä¸è¶…è¿‡150åˆ†é’Ÿã€‚"</p>
<h4 data-id="heading-5">ç¬¬ä¸‰å¹•ï¼šè§æœ‹å‹æ—¶çš„å°´å°¬</h4>
<p>JSå¸¦ç€TSè§æœ‹å‹Pythonå’ŒJavaã€‚</p>
<p>JSå¤§å£°ä»‹ç»ï¼š"è¿™æ˜¯TSï¼Œæˆ‘çš„...å‘ƒ...æœ‹å‹ï¼ŸåŒäº‹ï¼Ÿå·¥å…·ï¼Ÿåæ­£æˆ‘ä»¬ä¸€èµ·å†™ä»£ç ï¼"</p>
<p>Pythonå°å£°è¯´ï¼š"æ‰€ä»¥ä½ ä»¬çš„å…³ç³»ç±»å‹æ˜¯'any'ï¼Ÿ"</p>
<p>Javaç‚¹å¤´ï¼š"éœ€è¦æˆ‘æ¥å¼ºåˆ¶è½¬æ¢ä¸€ä¸‹å…³ç³»ç±»å‹å—ï¼Ÿ"</p>
<p>TSå¹³é™åœ°è¯´ï¼š"ç¡®åˆ‡åœ°è¯´ï¼Œæˆ‘ä»¬æ˜¯æ¸è¿›å¼ç±»å‹ç³»ç»Ÿçš„ä¼™ä¼´å…³ç³»ã€‚æˆ‘æ˜¯JSçš„è¶…é›†ï¼Œåœ¨å¼€å‘é˜¶æ®µæä¾›ç±»å‹å®‰å…¨ï¼Œä½†æœ€ç»ˆä¼šç¼–è¯‘æˆçº¯JSè¿è¡Œã€‚"</p>
<p>å…¨åœºæ²‰é»˜ä¸‰ç§’ã€‚</p>
<p>JSæ‰“ç ´å°´å°¬ï¼š"ä»–è¯´çš„æ˜¯'æˆ‘ä»¬å¾ˆé…'çš„æ„æ€å•¦ï¼å°±åƒJSONå’Œå¯¹è±¡å­—é¢é‡é‚£ä¹ˆé…ï¼"</p>
<h3 data-id="heading-6">è”ç³»ï¼šä»–ä»¬å…¶å®æ˜¯äº²æˆšï¼</h3>
<p>äº‹å®ä¸Šï¼ŒTSæ‚„æ‚„å¯¹JSè¯´ï¼š"æœ‰ä»¶äº‹å¾—å‘Šè¯‰ä½ â€”â€”æˆ‘å…¶å®å°±æ˜¯ä½ ï¼Œåªæ˜¯å¤šäº†äº›'è§„çŸ©'ã€‚"</p>
<p>JSæƒŠè®¶ï¼š"ä»€ä¹ˆï¼Ÿ"</p>
<p>TSè§£é‡Šï¼š"å’±ä»¬æœ¬è´¨ä¸Šæ˜¯ä¸€å®¶äººã€‚ä½ å†™çš„æ‰€æœ‰ä»£ç ï¼Œæˆ‘éƒ½èƒ½ç†è§£ã€‚è€Œæˆ‘çš„ä»£ç ï¼Œæœ€ç»ˆéƒ½ä¼šå˜æˆä½ çš„æ ·å­è¿è¡Œã€‚æˆ‘æ˜¯ä½ çš„'å¼€å‘æ—¶ä¿é•–'ï¼Œç¡®ä¿ä½ ä¸ä¼šåœ¨è¿è¡Œæ—¶æ‘”è·¤ã€‚"</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">//Â TSå†™çš„ä»£ç </span>
<span class="hljs-keyword">function</span>Â <span class="hljs-title function_">greet</span>(<span class="hljs-params">name:Â string</span>):Â stringÂ {
Â Â <span class="hljs-keyword">return</span>Â <span class="hljs-string">`Hello,Â <span class="hljs-subst">${name}</span>!`</span>;
}

<span class="hljs-comment">//Â ç¼–è¯‘åä¼šå˜æˆJSè®¤è¯†çš„ä»£ç </span>
<span class="hljs-keyword">function</span>Â <span class="hljs-title function_">greet</span>(<span class="hljs-params">name</span>)Â {
Â Â <span class="hljs-keyword">return</span>Â <span class="hljs-string">"Hello,Â "</span>Â +Â nameÂ +Â <span class="hljs-string">"!"</span>;
}
<span class="hljs-comment">//Â çœ‹ï¼Œæˆ‘ä»¬éª¨å­é‡Œæ˜¯ä¸€æ ·çš„ï¼</span>
</code></pre>
<h4 data-id="heading-7">é‚£ä¸ªå†³å®šæ€§çš„æ‹¥æŠ±</h4>
<p>é¡¹ç›®æˆªæ­¢å‰å¤œï¼ŒJSçš„ä»£ç çªç„¶åœ¨å‡Œæ™¨3ç‚¹å´©æºƒã€‚</p>
<p>JSç»æœ›åœ°å‘ç°ï¼šä¸€ä¸ªåº”è¯¥æ˜¯æ•°ç»„çš„å˜é‡ä¸çŸ¥ä½•æ—¶å˜æˆäº†å­—ç¬¦ä¸²ï¼Œæ•´ä¸ªåº”ç”¨åƒå¤šç±³è¯ºéª¨ç‰Œä¸€æ ·å€’ä¸‹ã€‚</p>
<p>è¿™æ—¶TSå‡ºç°äº†ï¼Œå¸¦ç€æ¸…æ™°çš„é”™è¯¯ä¿¡æ¯ï¼š"ç¬¬247è¡Œï¼šç±»å‹'string'ä¸Šä¸å­˜åœ¨å±æ€§'map'ã€‚å»ºè®®ï¼šç¡®ä¿å˜é‡åœ¨æ­¤å¤„ä¸ºæ•°ç»„ç±»å‹ã€‚"</p>
<p>JSä¿®å¤äº†bugï¼Œçœ‹ç€TSï¼š"ä½ ä¸€ç›´éƒ½çŸ¥é“è¿™é‡Œä¼šå‡ºé—®é¢˜ï¼Ÿ"</p>
<p>TSç‚¹å¤´ï¼š"ä»ä½ å†™ä¸‹ä»£ç çš„é‚£ä¸€åˆ»å°±çŸ¥é“ã€‚ä½†ä½ æœ‰'any'çš„æƒåŠ›ï¼Œæˆ‘åªèƒ½å»ºè®®ï¼Œä¸èƒ½å¼ºåˆ¶ã€‚"</p>
<p>JSæ²‰æ€ï¼š"ä¹Ÿè®¸...æœ‰æ—¶å€™æƒŠå–œä¸å¦‚ç¨³å®šæ¥å¾—é‡è¦ï¼Ÿ"</p>
<h3 data-id="heading-8">æ€»ç»“ï¼šä¸æ˜¯å–ä»£ï¼Œè€Œæ˜¯è¿›åŒ–</h3>
<p>æ‰€ä»¥ï¼ŒJavaScriptå’ŒTypeScriptåˆ°åº•æ˜¯ä»€ä¹ˆå…³ç³»ï¼Ÿ</p>
<h4 data-id="heading-9">1. <strong>è‰ºæœ¯å®¶ vs å»ºç­‘å¸ˆ</strong></h4>
<ul>
<li>JSæ˜¯å³å…´åˆ›ä½œçš„è¡—å¤´è‰ºæœ¯å®¶</li>
<li>TSæ˜¯å¸¦ç€è“å›¾çš„å»ºç­‘å¸ˆ</li>
<li>ä¸¤è€…éƒ½èƒ½é€ å‡ºæˆ¿å­ï¼Œä½†ä¸€ä¸ªå¯èƒ½é€ å‡ºæ¢¦å¹»æ ‘å±‹ï¼Œå¦ä¸€ä¸ªåˆ™ç¡®ä¿æˆ¿å­ç¬¦åˆå®‰å…¨è§„èŒƒ</li>
</ul>
<h4 data-id="heading-10">2. <strong>"å…ˆåšåæƒ³" vs "å…ˆæƒ³ååš"</strong></h4>
<ul>
<li>JSå–œæ¬¢å¿«é€ŸåŸå‹</li>
<li>TSå–œæ¬¢æå‰è§„åˆ’</li>
<li>å¤§å‹é¡¹ç›®å¸¸å¸¸éœ€è¦ä¸¤è€…ç»“åˆâ€”â€”ç”¨TSæ­å»ºç¨³å›ºæ¡†æ¶ï¼Œç”¨JSå¿«é€Ÿè¯•éªŒæ–°æƒ³æ³•</li>
</ul>
<h4 data-id="heading-11">3. <strong>æœ€ç»ˆéƒ½æ˜¯ä¸€å®¶äºº</strong></h4>
<ul>
<li>æ‰€æœ‰TSä»£ç æœ€ç»ˆéƒ½ä¼š"å˜èº«"ä¸ºJSè¿è¡Œ</li>
<li>TSå°±åƒæ˜¯JSçš„"è®­ç»ƒè½®"ï¼Œç­‰ä½ ç†Ÿæ‚‰äº†ç±»å‹ç³»ç»Ÿï¼Œç”šè‡³å¯ä»¥é€æ¸æ‹†é™¤</li>
</ul>
<h4 data-id="heading-12">4. <strong>å¹½é»˜çš„çœŸç›¸</strong></h4>
<ul>
<li>ä½¿ç”¨JSå°±åƒåœ¨è¯´"ç›¸ä¿¡æˆ‘ï¼Œæˆ‘çŸ¥é“æˆ‘åœ¨åšä»€ä¹ˆ"</li>
<li>ä½¿ç”¨TSåˆ™åƒåœ¨è¯´"æˆ‘ä¸å®Œå…¨ç›¸ä¿¡è‡ªå·±ï¼Œæ‰€ä»¥è®©ç¼–è¯‘å™¨åŒé‡æ£€æŸ¥ä¸€ä¸‹"</li>
</ul>
<p>æœ€ç»ˆï¼ŒJSå’ŒTSåœ¨ä»£ç å’–å•¡åº—è¾¾æˆäº†å’Œè§£ã€‚JSå­¦ä¼šäº†å¶å°”æ¥å—ç±»å‹å»ºè®®ï¼ŒTSå­¦ä¼šäº†å®¹å¿ä¸€äº›"any"çš„çµæ´»æ€§ã€‚ä»–ä»¬å…±åŒåˆ›å»ºäº†ä¸€ä¸ªé¡¹ç›®ï¼šä¸€ä¸ªåœ¨å¼€å‘é˜¶æ®µä¸¥æ ¼ç±»å‹æ£€æŸ¥ï¼Œä½†åœ¨æŸäº›å°æ¨¡å—ä¿ç•™JSçµæ´»æ€§çš„æ··åˆåº”ç”¨ã€‚</p>
<p>å°±åƒå’–å•¡åº—è€æ¿è¯´çš„ï¼š"çº¯é»‘å’–å•¡æç¥ï¼ŒåŠ å¥¶åŠ ç³–å¥½å…¥å£ã€‚å…³é”®æ˜¯çŸ¥é“è‡ªå·±ä»€ä¹ˆæ—¶å€™éœ€è¦ä»€ä¹ˆã€‚"</p>
<p>è€Œè§’è½é‡Œï¼Œä¸€ä¸ªæ–°æ¥çš„è¯­è¨€å«Rustæ­£åœ¨ç‚¹å•ï¼š"æˆ‘è¦ä¸€æ¯ç»å¯¹å†…å­˜å®‰å…¨çš„é¥®æ–™ï¼Œæ‰€æœ‰æƒæ˜ç¡®ï¼Œé›¶æˆæœ¬æŠ½è±¡..."</p>
<p>ä½†é‚£æ˜¯å¦ä¸€ä¸ªæ•…äº‹äº†ã€‚</p>
<hr/>
<h3 data-id="heading-13">é™„å½•ï¼šå¿«é€Ÿå¯¹æ¯”è¡¨</h3>








































<table><thead><tr><th>ç‰¹æ€§</th><th>JavaScript</th><th>TypeScript</th></tr></thead><tbody><tr><td>ç±»å‹ç³»ç»Ÿ</td><td>åŠ¨æ€ç±»å‹</td><td>é™æ€ç±»å‹ï¼ˆå¯é€‰çš„ï¼‰</td></tr><tr><td>é”™è¯¯å‘ç°æ—¶é—´</td><td>è¿è¡Œæ—¶</td><td>ç¼–è¯‘æ—¶</td></tr><tr><td>å­¦ä¹ æ›²çº¿</td><td>ç›¸å¯¹å¹³ç¼“</td><td>éœ€è¦é¢å¤–å­¦ä¹ ç±»å‹ç³»ç»Ÿ</td></tr><tr><td>çµæ´»æ€§</td><td>æé«˜</td><td>é«˜ï¼Œä½†æœ‰çº¦æŸ</td></tr><tr><td>é€‚åˆé¡¹ç›®</td><td>å°å‹é¡¹ç›®ã€åŸå‹ã€è„šæœ¬</td><td>å¤§å‹é¡¹ç›®ã€å›¢é˜Ÿåä½œã€é•¿æœŸç»´æŠ¤</td></tr><tr><td>æµè¡Œæ¡†æ¶</td><td>Reactã€Vueã€Node.js</td><td>Angularã€React+TSã€Vue+TS</td></tr></tbody></table>
<hr/>
<p><strong>åè®°</strong>ï¼šæ— è®ºä½ é€‰æ‹©JSçš„çµæ´»è¿˜æ˜¯TSçš„ä¸¥è°¨ï¼Œè®°ä½æœ€å¥½çš„ä»£ç ä¸æ˜¯æœ€èªæ˜çš„ï¼Œè€Œæ˜¯å…­ä¸ªæœˆåä½ ï¼ˆæˆ–åŒäº‹ï¼‰è¿˜èƒ½çœ‹æ‡‚çš„é‚£ä¸€äº›ã€‚æ¯•ç«Ÿï¼Œåœ¨ç¼–ç¨‹ä¸–ç•Œé‡Œï¼Œèƒ½è®©ä½ å°‘ç†¬å¤œçš„æŠ€æœ¯ï¼Œæ‰æ˜¯çœŸçˆ±çš„æŠ€æœ¯ã€‚</p>
<hr/>
<p><em>æ–‡ç« å­—æ•°ï¼šçº¦1200å­—</em><br/>
<em>å»ºè®®é˜…è¯»æ—¶é—´ï¼š5-7åˆ†é’Ÿ</em><br/>
<em>æŠ€æœ¯éš¾åº¦ï¼šåˆçº§åˆ°ä¸­çº§</em><br/>
<em>å¹½é»˜æŒ‡æ•°ï¼šâ˜•â˜•â˜•â˜• (4/5æ¯å’–å•¡)</em></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Koin ä¾èµ–æ³¨å…¥æ·±åº¦è§£æï¼šSingleã€Factory ä¸ Scoped åˆ°åº•æ€ä¹ˆé€‰ï¼Ÿ]]></title>    <link>https://juejin.cn/post/7604666872128077843</link>    <guid>https://juejin.cn/post/7604666872128077843</guid>    <pubDate>2026-02-10T03:22:49.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604666872128077843" data-draft-id="7604693038440136710" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Koin ä¾èµ–æ³¨å…¥æ·±åº¦è§£æï¼šSingleã€Factory ä¸ Scoped åˆ°åº•æ€ä¹ˆé€‰ï¼Ÿ"/> <meta itemprop="keywords" content="Android,Kotlin"/> <meta itemprop="datePublished" content="2026-02-10T03:22:49.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Ehtan_Zheng"/> <meta itemprop="url" content="https://juejin.cn/user/413072099642478"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Koin ä¾èµ–æ³¨å…¥æ·±åº¦è§£æï¼šSingleã€Factory ä¸ Scoped åˆ°åº•æ€ä¹ˆé€‰ï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/413072099642478/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Ehtan_Zheng
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T03:22:49.000Z" title="Tue Feb 10 2026 03:22:49 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨ Kotlin çš„ä¸–ç•Œé‡Œï¼ŒKoin ä»¥å…¶â€œæ— åå°„ã€æç®€ DSLâ€çš„ç‰¹æ€§è®©å¼€å‘è€…å€æ„Ÿå¹¸ç¦ã€‚ä½†è¦ç”¨å¥½ Koinï¼Œç†è§£å…¶ä¸‰å¤§æ ¸å¿ƒå®šä¹‰ç±»å‹ï¼š<strong><code>single</code></strong>ã€<strong><code>factory</code></strong> ä¸ <strong><code>scoped</code></strong> æ˜¯å¿…ä¿®è¯¾ã€‚</p>
<hr/>
<h2 data-id="heading-0">ä¸€ã€ <code>single</code>ï¼šå…¨å±€å”¯ä¸€çš„å•ä¾‹ (Singleton)</h2>
<p><code>single</code> æ˜¯ Koin ä¸­æœ€å¸¸ç”¨çš„å®šä¹‰æ–¹å¼ã€‚</p>
<ul>
<li>
<p><strong>æœ¬è´¨</strong>ï¼šåœ¨æ•´ä¸ª Koin å®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸå†…ï¼ˆé€šå¸¸æ˜¯åº”ç”¨çš„ç”Ÿå‘½å‘¨æœŸï¼‰ï¼Œè¯¥å®šä¹‰çš„å®ä¾‹åªä¼šè¢«åˆ›å»º<strong>ä¸€æ¬¡</strong>ã€‚åç»­æ‰€æœ‰çš„æ³¨å…¥è¯·æ±‚éƒ½ä¼šè¿”å›åŒä¸€ä¸ªå¯¹è±¡ã€‚</p>
</li>
<li>
<p><strong>ç”Ÿå‘½å‘¨æœŸ</strong>ï¼šä¸åº”ç”¨è¿›ç¨‹å…±å­˜äº¡ã€‚</p>
</li>
<li>
<p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼š</p>
<ul>
<li><strong>Repository å±‚</strong>ï¼šæ•°æ®ä»“åº“é€šå¸¸ä¸éœ€è¦é‡å¤åˆ›å»ºã€‚</li>
<li><strong>ç½‘ç»œæ¨¡å—</strong>ï¼šå¦‚ Retrofit å®ä¾‹ã€OkHttpClientã€‚</li>
<li><strong>æœ¬åœ°æ•°æ®åº“</strong>ï¼šå¦‚ Room æ•°æ®åº“å®ä¾‹ã€‚</li>
</ul>
</li>
</ul>
<p><strong>ä»£ç ç¤ºä¾‹ï¼š</strong></p>
<p>Kotlin</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">val</span> <span class="hljs-variable">appModule</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">module</span> {
    <span class="hljs-comment">// æ•´ä¸ªåº”ç”¨è¿è¡ŒæœŸé—´ï¼Œåªæœ‰ä¸€ä¸ª UserRepository å®ä¾‹</span>
    single { UserRepository(get()) }
}
</code></pre>
<hr/>
<h2 data-id="heading-1">äºŒã€ <code>factory</code>ï¼šæŒ‰éœ€åˆ›å»ºçš„å·¥å‚ (Factory)</h2>
<p>ä¸ <code>single</code> ç›¸åï¼Œ<code>factory</code> æ¯æ¬¡éƒ½ä¼šç»™ä½ æä¾›ä¸€ä¸ªâ€œå…¨æ–°çš„â€å¯¹è±¡ã€‚</p>
<ul>
<li>
<p><strong>æœ¬è´¨</strong>ï¼šæ¯æ¬¡è¿›è¡Œæ³¨å…¥ï¼ˆé€šè¿‡ <code>inject()</code> æˆ– <code>get()</code>ï¼‰æ—¶ï¼ŒKoin éƒ½ä¼šæ‰§è¡Œä¸€æ¬¡ä»£ç å—ï¼Œåˆ›å»ºä¸€ä¸ª<strong>æ–°çš„å®ä¾‹</strong>ã€‚</p>
</li>
<li>
<p><strong>ç”Ÿå‘½å‘¨æœŸ</strong>ï¼šKoin ä¸è´Ÿè´£ä¿å­˜è¿™ä¸ªå®ä¾‹ï¼Œå®ƒçš„ç”Ÿå‘½å‘¨æœŸç”±è°ƒç”¨è€…å†³å®šï¼ˆä¾‹å¦‚è¢«èµ‹å€¼ç»™æŸä¸ªå±€éƒ¨å˜é‡ï¼‰ã€‚</p>
</li>
<li>
<p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼š</p>
<ul>
<li><strong>ä¸´æ—¶çš„ UI é€»è¾‘ç±»</strong>ï¼šä¸éœ€è¦æŒä¹…åŒ–çŠ¶æ€çš„å°å·¥å…·ã€‚</li>
<li><strong>å…·æœ‰çŠ¶æ€çš„å¯¹è±¡</strong>ï¼šä½ ä¸å¸Œæœ›ä¸åŒé¡µé¢å…±äº«åŒä¸€ä¸ªçŠ¶æ€çš„å¯¹è±¡ã€‚</li>
</ul>
</li>
</ul>
<p><strong>ä»£ç ç¤ºä¾‹ï¼š</strong></p>
<p>Kotlin</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">val</span> <span class="hljs-variable">appModule</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">module</span> {
    <span class="hljs-comment">// æ¯æ¬¡æ³¨å…¥éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ Presenter å®ä¾‹</span>
    factory { UserPresenter(get()) }
}
</code></pre>
<hr/>
<h2 data-id="heading-2">ä¸‰ã€ <code>scoped</code>ï¼šå—æ§çš„ä½œç”¨åŸŸ (Scoped)</h2>
<p>è¿™æ˜¯ Koin ä¸­æœ€å¼ºå¤§ä½†ä¹Ÿæœ€å®¹æ˜“è¢«è¯¯è§£çš„éƒ¨åˆ†ã€‚å®ƒä»‹äº <code>single</code> å’Œ <code>factory</code> ä¹‹é—´ã€‚</p>
<ul>
<li>
<p><strong>æœ¬è´¨</strong>ï¼šå®ä¾‹åœ¨ä¸€ä¸ªç‰¹å®šçš„**ä½œç”¨åŸŸï¼ˆScopeï¼‰**å†…æ˜¯å”¯ä¸€çš„ã€‚å½“ä½œç”¨åŸŸå¼€å¯æ—¶åˆ›å»ºï¼Œå½“ä½œç”¨åŸŸå…³é—­ï¼ˆå¦‚ Activity é”€æ¯ï¼‰æ—¶ï¼Œè¯¥å®ä¾‹ä¹Ÿä¼šéšä¹‹é”€æ¯ã€‚</p>
</li>
<li>
<p><strong>ç”Ÿå‘½å‘¨æœŸ</strong>ï¼šç»‘å®šåˆ°ç‰¹å®šçš„ç»„ä»¶ç”Ÿå‘½å‘¨æœŸã€‚</p>
</li>
<li>
<p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼š</p>
<ul>
<li><strong>åˆ†æ­¥è¡¨å•/å‘å¯¼ç•Œé¢</strong>ï¼šåœ¨ 3 ä¸ª Fragment ä¹‹é—´å…±äº«æ•°æ®ï¼Œä½†ä¸€æ—¦é€€å‡ºè¯¥æµç¨‹ï¼Œæ•°æ®åº”ç«‹å³æ¸…é™¤ã€‚</li>
<li><strong>Activity ä¸“æœ‰æ•°æ®</strong>ï¼šåªåœ¨æŸä¸ªç‰¹å®šé¡µé¢åŠå…¶å†…éƒ¨å­ç»„ä»¶ä¸­å…±äº«ã€‚</li>
</ul>
</li>
</ul>
<p><strong>ä»£ç ç¤ºä¾‹ï¼š</strong></p>
<p>Kotlin</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">val</span> <span class="hljs-variable">appModule</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">module</span> {
    <span class="hljs-comment">// å®šä¹‰ä¸€ä¸ªä½œç”¨åŸŸ</span>
    scope&lt;MyActivity&gt; {
        <span class="hljs-comment">// åœ¨ MyActivity çš„ç”Ÿå‘½å‘¨æœŸå†…ï¼Œè¯¥å®ä¾‹æ˜¯å•ä¾‹</span>
        scoped { UserSession() }
    }
}
</code></pre>
<hr/>
<h2 data-id="heading-3">å››ã€ æ ¸å¿ƒå·®å¼‚å¯¹æ¯”è¡¨</h2>



































<table><thead><tr><th><strong>ç‰¹æ€§</strong></th><th><strong>single</strong></th><th><strong>factory</strong></th><th><strong>scoped</strong></th></tr></thead><tbody><tr><td><strong>å®ä¾‹æ•°é‡</strong></td><td>å…¨å±€åªæœ‰ä¸€ä¸ª</td><td>æ¯æ¬¡è¯·æ±‚éƒ½æœ‰ä¸€ä¸ªæ–°å®ä¾‹</td><td>ä½œç”¨åŸŸå†…å”¯ä¸€</td></tr><tr><td><strong>å†…å­˜å ç”¨</strong></td><td>æŒç»­å ç”¨ï¼Œç›´åˆ°åº”ç”¨å…³é—­</td><td>ç¬æ—¶å ç”¨ï¼Œéšç”¨éšå…³</td><td>éšä½œç”¨åŸŸç”Ÿå‘½å‘¨æœŸé‡Šæ”¾</td></tr><tr><td><strong>å®ä¾‹å…±äº«</strong></td><td>å…¨å±€å…±äº«</td><td>ä¸å…±äº«</td><td>ä»…åœ¨å½“å‰ä½œç”¨åŸŸå†…å…±äº«</td></tr><tr><td><strong>æ¨èç”¨é€”</strong></td><td>æ•°æ®åº“ã€API å®¢æˆ·ç«¯ã€Repo</td><td>å·¥å…·ç±»ã€ç¬æ—¶æ•°æ®å¤„ç†</td><td>é¡µé¢ç§æœ‰é€»è¾‘ã€åˆ†æ­¥ä»»åŠ¡æµ</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-4">äº”ã€ é¿å‘ä¸æœ€ä½³å®è·µ</h2>
<ol>
<li><strong>å…³äº ViewModel</strong>ï¼šåœ¨ Android ä¸­ï¼ŒKoin æä¾›äº†ä¸“ç”¨çš„ <code>viewModel { ... }</code> å…³é”®å­—ã€‚å®ƒçš„è¡Œä¸ºç±»ä¼¼äº <code>factory</code>ï¼Œä½†ç”±ç³»ç»Ÿçš„ <code>ViewModelProvider</code> æ‰˜ç®¡ï¼Œç¡®ä¿åœ¨é…ç½®æ›´æ”¹ï¼ˆå¦‚æ—‹è½¬å±å¹•ï¼‰æ—¶å®ä¾‹ä¸è¢«é”€æ¯ã€‚</li>
<li><strong>é¿å…æ»¥ç”¨ <code>single</code></strong>ï¼šè™½ç„¶ <code>single</code> å¾ˆçœäº‹ï¼Œä½†å¦‚æœæŠŠå¤ªå¤šå…·æœ‰çŠ¶æ€çš„é€»è¾‘ç±»å®šä¹‰ä¸ºå•ä¾‹ï¼Œä¼šå¯¼è‡´å†…å­˜ç§¯å‹ï¼Œç”šè‡³å‡ºç°â€œé€€å‡ºç™»å½•åæ•°æ®æœªæ¸…ç†â€çš„è¯¡å¼‚ Bugã€‚</li>
<li><strong>Scoped çš„è‡ªåŠ¨é‡Šæ”¾</strong>ï¼šåœ¨ Android ä¸­ä½¿ç”¨ <code>scoped</code> æ—¶ï¼Œå»ºè®®é…åˆ <code>ActivityScope</code> æˆ– <code>FragmentScope</code> çš„æ‰©å±•ï¼Œè¿™æ · Koin èƒ½åœ¨ç»„ä»¶ <code>onDestroy()</code> æ—¶è‡ªåŠ¨å¸®ä½ å›æ”¶èµ„æºï¼Œé¿å…å†…å­˜æ³„æ¼ã€‚</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[HEIF ä¸ AVIF å¦‚ä½•è®© Android å­˜å‚¨å‡åŠ]]></title>    <link>https://juejin.cn/post/7604693038440382470</link>    <guid>https://juejin.cn/post/7604693038440382470</guid>    <pubDate>2026-02-10T03:46:58.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604693038440382470" data-draft-id="7604693038440202246" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="HEIF ä¸ AVIF å¦‚ä½•è®© Android å­˜å‚¨å‡åŠ"/> <meta itemprop="keywords" content="Android"/> <meta itemprop="datePublished" content="2026-02-10T03:46:58.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Ehtan_Zheng"/> <meta itemprop="url" content="https://juejin.cn/user/413072099642478"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            HEIF ä¸ AVIF å¦‚ä½•è®© Android å­˜å‚¨å‡åŠ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/413072099642478/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Ehtan_Zheng
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T03:46:58.000Z" title="Tue Feb 10 2026 03:46:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨ Android å¼€å‘çš„æ€§èƒ½ä¼˜åŒ–æ¸…å•ä¸­ï¼Œâ€œå›¾ç‰‡å‹ç¼©â€å§‹ç»ˆæ˜¯ç»•ä¸å¼€çš„æ ¸å¿ƒã€‚é•¿æœŸä»¥æ¥ï¼Œæˆ‘ä»¬ä¹ æƒ¯äºåœ¨ JPEG çš„è´¨é‡å’Œä½“ç§¯ä¹‹é—´èµ°é’¢ä¸ã€‚ç„¶è€Œï¼Œéšç€ <strong>HEIF</strong> å’Œ <strong>AVIF</strong> ç­‰ç°ä»£æ ¼å¼çš„æˆç†Ÿï¼Œè¿™åœºå¹³è¡¡æ¸¸æˆæ­£åœ¨å‘ç”Ÿè´¨å˜ï¼šæˆ‘ä»¬å¯ä»¥åœ¨ä¸æŸå¤±ç”»è´¨çš„å‰æä¸‹ï¼Œå°†æ–‡ä»¶ä½“ç§¯ç¼©å° 50% ç”šè‡³æ›´å¤šã€‚</p>
<hr/>
<h2 data-id="heading-0">ä¸€ã€ ä¸ºä»€ä¹ˆ JPEG è¯¥â€œé€€ä¼‘â€äº†ï¼Ÿ</h2>
<p>JPEG è¯ç”Ÿäº 1992 å¹´ã€‚åœ¨é‚£ä¸ªæ‹¨å·ä¸Šç½‘çš„æ—¶ä»£ï¼Œå®ƒæ˜¯ä¼Ÿå¤§çš„å‘æ˜ã€‚ä½†åœ¨ 30 å¹´åçš„ä»Šå¤©ï¼Œå®ƒçš„å‹ç¼©ç®—æ³•åœ¨é¢å¯¹é«˜åŠ¨æ€èŒƒå›´ï¼ˆHDRï¼‰å’Œé«˜åˆ†è¾¨ç‡å›¾åƒæ—¶æ˜¾å¾—åŠ›ä¸ä»å¿ƒï¼š</p>
<ul>
<li><strong>å‹ç¼©æ•ˆç‡ä½</strong>ï¼šç›¸åŒç”»è´¨ä¸‹ï¼Œä½“ç§¯è¿œå¤§äºç°ä»£æ ¼å¼ã€‚</li>
<li><strong>ä¸æ”¯æŒé€æ˜åº¦</strong>ï¼šä¸ºäº†é€æ˜æ•ˆæœï¼Œæˆ‘ä»¬ä¸å¾—ä¸è½¬è€Œä½¿ç”¨ä½“ç§¯è‡ƒè‚¿çš„ PNGã€‚</li>
<li><strong>è¾¹ç¼˜ä¼ªå½±</strong>ï¼šåœ¨é«˜å‹ç¼©æ¯”ä¸‹ï¼Œç‰©ä½“è¾¹ç¼˜ä¼šå‡ºç°æ˜æ˜¾çš„â€œå™ªå£°â€ã€‚</li>
</ul>
<hr/>
<h2 data-id="heading-1">äºŒã€ ç°ä»£å›¾åƒæ ¼å¼çš„åŒå­æ˜Ÿ</h2>
<h3 data-id="heading-2">1. HEIF (High Efficiency Image File Format)</h3>
<p>åŸºäº HEVC (H.265) è§†é¢‘ç¼–ç æŠ€æœ¯ã€‚</p>
<ul>
<li><strong>ä¼˜åŠ¿</strong>ï¼šåœ¨ç›¸åŒç”»è´¨ä¸‹ï¼Œä½“ç§¯ä»…ä¸º JPEG çš„ <strong>50%</strong> ã€‚å®ƒæ”¯æŒ 10 ä½è‰²æ·±ã€é€æ˜é€šé“å’Œåºåˆ—å¸§ï¼ˆç±»ä¼¼äºé«˜ç”»è´¨çš„ GIFï¼‰ã€‚</li>
<li><strong>Android æ”¯æŒ</strong>ï¼šAndroid 8.0+ (API 26) å¼€å§‹æ”¯æŒé˜…è¯»ï¼ŒAndroid 9.0+ æ”¯æŒå†™å…¥ã€‚</li>
<li><strong>ç¡¬ä»¶åŠ é€Ÿ</strong>ï¼šè®¸å¤šç°ä»£ Android èŠ¯ç‰‡ï¼ˆå¦‚é«˜é€šéªé¾™ï¼‰å†…ç½®äº† HEVC ç¡¬è§£ç ï¼Œé€Ÿåº¦æå¿«ã€‚</li>
</ul>
<h3 data-id="heading-3">2. AVIF (AV1 Image File Format)</h3>
<p>åŸºäºå¼€æºçš„ AV1 è§†é¢‘ç¼–ç ï¼Œç”± Googleã€Netflix ç­‰å·¨å¤´æ¨åŠ¨ã€‚</p>
<ul>
<li><strong>ä¼˜åŠ¿</strong>ï¼šå®ƒæ˜¯ç›®å‰çš„â€œå‹ç¼©ä¹‹ç‹â€ã€‚åœ¨æä½å¸¦å®½ä¸‹ï¼ŒAVIF çš„ç»†èŠ‚ä¿ç•™èƒ½åŠ›ç”šè‡³è¶…è¿‡äº† WebP å’Œ HEIFã€‚å®ƒæ˜¯å¼€æºä¸”å…ç‰ˆç¨çš„ã€‚</li>
<li><strong>Android æ”¯æŒ</strong>ï¼šAndroid 12+ (API 31) å·²åŸç”Ÿæ”¯æŒã€‚</li>
</ul>
<hr/>
<h2 data-id="heading-4">ä¸‰ã€ æ ¸å¿ƒæ”¶ç›Šï¼šä¸ä»…ä»…æ˜¯çœç©ºé—´</h2>
<p>é€šè¿‡è¿ç§»åˆ° HEIF/AVIFï¼Œä½ çš„ App å°†è·å¾—ä»¥ä¸‹ç›´æ¥æ”¶ç›Šï¼š</p>
<ol>
<li><strong>APK ç˜¦èº«</strong>ï¼šå†…ç½®èµ„æºå›¾ç›´æ¥å‡åŠï¼Œé™ä½ç”¨æˆ·çš„ä¸‹è½½é—¨æ§›å’Œç•™å­˜æµå¤±ã€‚</li>
<li><strong>å¸¦å®½æˆæœ¬é™ä½</strong>ï¼šå¯¹äºäº‘å­˜å‚¨å’Œ CDN æœåŠ¡å•†æ¥è¯´ï¼Œæµé‡æ”¯å‡ºå°†å¤§å¹…ç¼©å‡ã€‚</li>
<li><strong>åŠ è½½é€Ÿåº¦æå‡</strong>ï¼šæ›´å°çš„æ–‡ä»¶æ„å‘³ç€æ›´å¿«çš„ I/O å’Œæ›´çŸ­çš„ç½‘ç»œä¼ è¾“è€—æ—¶ï¼ŒUI æ¸²æŸ“æ›´ä¸æ»‘ã€‚</li>
<li><strong>æ›´å¥½çš„è§†è§‰è´¨é‡</strong>ï¼šæ”¯æŒé«˜ä½æ·±ï¼Œè§£å†³å›¾åƒåœ¨æ¸å˜åŒºåŸŸçš„â€œæ–­å±‚â€ç°è±¡ã€‚</li>
</ol>
<hr/>
<h2 data-id="heading-5">å››ã€ å¦‚ä½•åœ¨ Android ä¸­è½åœ°ï¼Ÿ</h2>
<h3 data-id="heading-6">1. æ£€æŸ¥å…¼å®¹æ€§</h3>
<p>è™½ç„¶ç°ä»£æ ¼å¼å¼ºå¤§ï¼Œä½†ä»éœ€å¤„ç†ç‰ˆæœ¬å·®å¼‚ã€‚å»ºè®®åœ¨æœåŠ¡ç«¯è¿›è¡Œé€»è¾‘åˆ¤æ–­ï¼š</p>
<ul>
<li><strong>Android 12+</strong> ï¼šä¼˜å…ˆæ¨ <strong>AVIF</strong>ã€‚</li>
<li><strong>Android 8.0 - 11</strong>ï¼šä¼˜å…ˆæ¨ <strong>HEIF</strong>ã€‚</li>
<li><strong>è€æ—§ç‰ˆæœ¬</strong>ï¼šé™çº§ä½¿ç”¨ WebP æˆ–ä¼˜åŒ–è¿‡çš„ JPEGã€‚</li>
</ul>
<h3 data-id="heading-7">2. ä½¿ç”¨ HeifWriter</h3>
<p>å¯¹äºéœ€è¦æœ¬åœ°ä¿å­˜å›¾ç‰‡çš„åœºæ™¯ï¼ŒAndroid æä¾›äº† <code>HeifWriter</code>ï¼š</p>
<p>Kotlin</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// ä½¿ç”¨ HeifWriter å°† Bitmap ä¿å­˜ä¸º HEIF</span>
val heifWriter = HeifWriter<span class="hljs-selector-class">.Builder</span>(
    outputStream, width, height, HeifWriter.INPUT_MODE_BITMAP
)<span class="hljs-selector-class">.build</span>()
heifWriter<span class="hljs-selector-class">.start</span>()
heifWriter<span class="hljs-selector-class">.addBitmap</span>(myBitmap)
heifWriter<span class="hljs-selector-class">.stop</span>()
</code></pre>
<h3 data-id="heading-8">3. è½¬æ¢å·¥å…·</h3>
<p>ä½ å¯ä»¥åˆ©ç”¨ <strong>libavif</strong> æˆ– <strong>ImageMagick</strong> åœ¨ CI/CD æµç¨‹ä¸­è‡ªåŠ¨è½¬æ¢èµ„æºå›¾ã€‚ä¾‹å¦‚ä½¿ç”¨ <code>avifenc</code>ï¼š</p>
<p>Bash</p>
<pre><code class="hljs language-css" lang="css">avifenc <span class="hljs-attr">--jobs</span> <span class="hljs-number">4</span> <span class="hljs-selector-tag">input</span><span class="hljs-selector-class">.jpg</span> output<span class="hljs-selector-class">.avif</span>
</code></pre>
<h3 data-id="heading-9">4. Coilï¼šKotlin ä¼˜å…ˆçš„ä¼˜é›…é›†æˆ</h3>
<p>Coil ä½œä¸ºç°ä»£ Android å¼€å‘çš„é¦–é€‰å›¾ç‰‡åº“ï¼Œå…¶æ’ä»¶åŒ–è®¾è®¡éå¸¸ç®€æ´ã€‚ç”±äºå®˜æ–¹åœ¨ Coil 3.0+ ä¸­é€šè¿‡ KMP å¢å¼ºäº†æ ¼å¼æ”¯æŒï¼Œè¿™é‡Œæˆ‘ä»¬ä»¥ç›®å‰æœ€ä¸»æµçš„é›†æˆæ–¹å¼ä¸ºä¾‹ã€‚</p>
<p><strong>æ·»åŠ ä¾èµ–</strong></p>
<p>ä½ éœ€è¦å¼•å…¥ä¸“é—¨å¤„ç† AVIF çš„è§£ç åº“ï¼ˆé€šå¸¸åŸºäº libavifï¼‰ï¼š</p>
<p>Kotlin</p>
<pre><code class="hljs language-scss" lang="scss">dependencies {
    <span class="hljs-comment">// ä½¿ç”¨ç¤¾åŒºå¹¿æ³›è®¤å¯çš„ AVIF è§£ç æ’ä»¶</span>
    <span class="hljs-built_in">implementation</span>("com.github.awxkee:avif-coder-coil:<span class="hljs-number">1.5</span>.<span class="hljs-number">0</span>")
}
</code></pre>
<p><strong>é…ç½® ImageLoader</strong></p>
<p>åœ¨ <code>Application</code> ç±»æˆ–å…¨å±€é…ç½®ä¸­æ³¨å†Œ <code>AvifDecoder</code>ï¼š</p>
<p>Kotlin</p>
<pre><code class="hljs language-scss" lang="scss">val imageLoader = ImageLoader<span class="hljs-selector-class">.Builder</span>(context)
    <span class="hljs-selector-class">.components</span> {
        <span class="hljs-comment">// å°† AVIF è§£ç å™¨åŠ å…¥ç»„ä»¶æ± </span>
        <span class="hljs-built_in">add</span>(AvifDecoder.Factory())
    }
    <span class="hljs-selector-class">.build</span>()
</code></pre>
<hr/>
<h3 data-id="heading-10">5. Glideï¼šè€ç‰ŒåŠ²æ—…çš„æ¨¡å—åŒ–æ‰©å±•</h3>
<p>Glide çš„é›†æˆç¨å¾®å¤æ‚ä¸€ç‚¹ï¼Œéœ€è¦é€šè¿‡ <code>AppGlideModule</code> æ¥æ‰‹åŠ¨æ³¨å†Œè§£ç ç»„ä»¶ã€‚</p>
<p><strong>æ·»åŠ ä¾èµ–</strong></p>
<p>ç›®å‰æœ€ç¨³å®šçš„æ–¹æ¡ˆæ˜¯ä½¿ç”¨ <code>glide-avif</code> åº“ï¼š</p>
<p>Kotlin</p>
<pre><code class="hljs language-scss" lang="scss">dependencies {
    <span class="hljs-built_in">implementation</span>("com.github.zjupure:glide-avif:<span class="hljs-number">1.0</span>.<span class="hljs-number">1</span>")
    <span class="hljs-built_in">annotationProcessor</span>("github.com.bumptech.glide:compiler:<span class="hljs-number">4.15</span>.<span class="hljs-number">1</span>")
}
</code></pre>
<p><strong>æ³¨å†Œç»„ä»¶</strong></p>
<p>åˆ›å»ºä¸€ä¸ª <code>AppGlideModule</code>ï¼Œå¹¶åœ¨ <code>registerComponents</code> ä¸­æ³¨å…¥è§£ç å™¨ã€‚è¿™æ · Glide å°±èƒ½åœ¨è¯»å–è¾“å…¥æµæ—¶è¯†åˆ«å¹¶å¤„ç† AVIF æ ¼å¼ã€‚</p>
<p>Kotlin</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@GlideModule</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">MyAppGlideModule</span> : <span class="hljs-type">AppGlideModule</span>() {
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">registerComponents</span><span class="hljs-params">(context: <span class="hljs-type">Context</span>, glide: <span class="hljs-type">Glide</span>, registry: <span class="hljs-type">Registry</span>)</span></span> {
        <span class="hljs-comment">// æ³¨å†Œ AVIF è§£ç å™¨ï¼Œè®©å…¶å¤„ç† InputStream å’Œ ByteBuffer</span>
        registry.prepend(InputStream::<span class="hljs-keyword">class</span>.java, Bitmap::<span class="hljs-keyword">class</span>.java, AvifStreamBitmapDecoder(glide.bitmapPool))
        registry.prepend(ByteBuffer::<span class="hljs-keyword">class</span>.java, Bitmap::<span class="hljs-keyword">class</span>.java, AvifByteBufferBitmapDecoder(glide.bitmapPool))
    }
}
</code></pre>
<h2 data-id="heading-11">äº”ã€ æœªæ¥å±•æœ›</h2>
<p>è™½ç„¶ç¼–ç æ—¶é—´ï¼ˆEncoding Timeï¼‰ç›®å‰æ˜¯ç°ä»£æ ¼å¼çš„è½¯è‚‹ï¼Œä½†å¯¹äºç»å¤§å¤šæ•°â€œä¸€æ¬¡ä¸Šä¼ ã€åƒä¸‡æ¬¡ä¸‹è½½â€çš„ App åœºæ™¯æ¥è¯´ï¼Œè¿™ç‚¹è®¡ç®—æˆæœ¬å¾®ä¸è¶³é“ã€‚</p>
<p>éšç€ Android 15 å’Œ 16 å¯¹ç¡¬ä»¶è§£ç çš„è¿›ä¸€æ­¥æ™®åŠï¼ŒJPEG ç»ˆå°†èµ°å‘è¾¹ç¼˜ã€‚ä½œä¸ºå¼€å‘è€…ï¼Œç°åœ¨å¼€å§‹å°è¯• <strong>HEIF/AVIF</strong>ï¼Œä¸ä»…æ˜¯ä¸ºäº†å‡å°‘ 50% çš„å­˜å‚¨ç©ºé—´ï¼Œæ›´æ˜¯ä¸ºäº†ç»™ç”¨æˆ·æä¾›ä¸€ä¸ªæ›´è½»å¿«ã€æ›´æ¸…æ™°çš„è§†è§‰ä½“éªŒã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[OpenClaw Clawdbot è‡ªå®šä¹‰ä¸­è½¬ç«™é…ç½®æ•™ç¨‹]]></title>    <link>https://juejin.cn/post/7604685644685541428</link>    <guid>https://juejin.cn/post/7604685644685541428</guid>    <pubDate>2026-02-10T03:16:12.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604685644685541428" data-draft-id="7604697194795909130" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="OpenClaw Clawdbot è‡ªå®šä¹‰ä¸­è½¬ç«™é…ç½®æ•™ç¨‹"/> <meta itemprop="keywords" content="AIGC,AIç¼–ç¨‹"/> <meta itemprop="datePublished" content="2026-02-10T03:16:12.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ›¦å’Œ"/> <meta itemprop="url" content="https://juejin.cn/user/1116759545101406"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            OpenClaw Clawdbot è‡ªå®šä¹‰ä¸­è½¬ç«™é…ç½®æ•™ç¨‹
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1116759545101406/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ›¦å’Œ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T03:16:12.000Z" title="Tue Feb 10 2026 03:16:12 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">ç¬¬ä¸€æ­¥ï¼šå®‰è£…ä¸åŸºç¡€åˆå§‹åŒ–</h3>
<p>é¦–å…ˆç¡®ä¿ä½ å·²ç»å®‰è£…äº† Node.js ç¯å¢ƒï¼Œç„¶ååœ¨ç»ˆç«¯æ‰§è¡Œï¼š</p>
<ol>
<li><strong>å…¨å±€å®‰è£…ï¼š</strong></li>
</ol>
<pre><code class="hljs language-bash" lang="bash">npm i -g clawdbot

</code></pre>
<ol start="2">
<li><strong>æ‰§è¡Œå¼•å¯¼ï¼ˆæ ¹æ®æç¤ºå®ŒæˆåŸºç¡€è®¾ç½®ï¼‰ï¼š</strong></li>
</ol>
<pre><code class="hljs language-bash" lang="bash">clawdbot onboard

</code></pre>
<p><em>æ³¨æ„ï¼šåœ¨ Windows åŸç”Ÿç¯å¢ƒä¸‹ï¼Œå¦‚æœæç¤º <code>openclaw</code> ä¸æ˜¯å‘½ä»¤ï¼Œè¯·ç»Ÿä¸€ä½¿ç”¨ <code>clawdbot</code>ã€‚</em></p>
<hr/>
<h3 data-id="heading-1">ç¬¬äºŒæ­¥ï¼šä¿®æ”¹ä¸»é…ç½®æ–‡ä»¶ <code>clawdbot.json</code></h3>
<p>æ‰“å¼€è·¯å¾„ï¼š<code>C:\Users\Administrator\.clawdbot\clawdbot.json</code>
å°† <code>models</code> å’Œ <code>auth</code> éƒ¨åˆ†ä¿®æ”¹ä¸ºä»¥ä¸‹å†…å®¹ï¼Œä»¥æ”¯æŒè‡ªå®šä¹‰ä¸­è½¬ç«™ã€‚</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"agents"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"defaults"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"workspace"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"C:\\Users\\Administrator\\clawd"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"models"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"api-proxy-gpt/gpt-4o"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"alias"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"GPT-4o"</span> <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"api-proxy-claude/claude-sonnet-4-5-20250929"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"alias"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Claude Sonnet 4.5"</span> <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"api-proxy-google/gemini-3-pro-preview"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"alias"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Gemini 3 Pro"</span> <span class="hljs-punctuation">}</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"primary"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"api-proxy-claude/claude-sonnet-4-5-20250929"</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"auth"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"profiles"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"api-proxy-gpt:default"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"provider"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"api-proxy-gpt"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"mode"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"api_key"</span> <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"api-proxy-claude:default"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"provider"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"api-proxy-claude"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"mode"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"api_key"</span> <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"api-proxy-google:default"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"provider"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"api-proxy-google"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"mode"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"api_key"</span> <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"models"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"mode"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"merge"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"providers"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"api-proxy-gpt"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"baseUrl"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://api.88api.chat/v1"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"api"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"openai-completions"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"models"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
          <span class="hljs-punctuation">{</span> <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"gpt-4o"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"GPT-4o"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"contextWindow"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">128000</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"maxTokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">8192</span> <span class="hljs-punctuation">}</span>
        <span class="hljs-punctuation">]</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"api-proxy-claude"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"baseUrl"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://api.88api.chat"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"api"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"anthropic-messages"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"models"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
          <span class="hljs-punctuation">{</span> <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"claude-sonnet-4-5-20250929"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Claude Sonnet 4.5"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"contextWindow"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">200000</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"maxTokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">8192</span> <span class="hljs-punctuation">}</span>
        <span class="hljs-punctuation">]</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"api-proxy-google"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"baseUrl"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://api.88api.chat/v1beta"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"api"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"google-generative-ai"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"models"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
          <span class="hljs-punctuation">{</span> <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"gemini-3-pro-preview"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Gemini 3 Pro"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"contextWindow"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2000000</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"maxTokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">8192</span> <span class="hljs-punctuation">}</span>
        <span class="hljs-punctuation">]</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>

</code></pre>
<hr/>
<h3 data-id="heading-2">ç¬¬ä¸‰æ­¥ï¼šé…ç½®é‰´æƒæ–‡ä»¶ <code>auth-profiles.json</code></h3>
<p>æ‰“å¼€è·¯å¾„ï¼š<code>C:\Users\Administrator\.clawdbot\agents\main\agent\auth-profiles.json</code>
åœ¨æ­¤å¤„å¡«å…¥ä½ ä»ä¸­è½¬ç«™è·å–çš„çœŸå® API Keyã€‚</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"version"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"profiles"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"api-proxy-gpt:default"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"api_key"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"provider"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"api-proxy-gpt"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"key"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"sk-your-unique-gpt-key-here"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"api-proxy-claude:default"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"api_key"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"provider"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"api-proxy-claude"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"key"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"sk-your-unique-claude-key-here"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"api-proxy-google:default"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"api_key"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"provider"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"api-proxy-google"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"key"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"sk-your-unique-google-key-here"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"lastGood"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"api-proxy-gpt"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"api-proxy-gpt:default"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"api-proxy-claude"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"api-proxy-claude:default"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"api-proxy-google"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"api-proxy-google:default"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>

</code></pre>
<hr/>
<h3 data-id="heading-3">ç¬¬å››æ­¥ï¼šæ£€æŸ¥å¹¶å¯åŠ¨</h3>
<ol>
<li><strong>è¿è¡Œå¥åº·æ£€æŸ¥ï¼š</strong></li>
</ol>
<pre><code class="hljs language-bash" lang="bash">clawdbot doctor

</code></pre>
<ol start="2">
<li><strong>å¯åŠ¨ Gateway æœåŠ¡ï¼š</strong></li>
</ol>
<pre><code class="hljs language-bash" lang="bash">clawdbot gateway

</code></pre>
<ol start="3">
<li><strong>è®¿é—®æ§åˆ¶å°ï¼š</strong>
æ‰“å¼€æµè§ˆå™¨è®¿é—® <code>http://127.0.0.1:18789/</code>ï¼Œä½¿ç”¨ <code>clawdbot onboarding</code> ç»“å°¾è¾“å‡ºçš„ Token ç™»å½•å³å¯å¼€å§‹è°ƒæ•™ä½ çš„ AI Agentã€‚</li>
</ol>
<p><strong>å…³äº 88API</strong></p>
<p>88API æ˜¯ä¸€ä¸ª AI ç¼–æ’å¹³å°ï¼Œæä¾›ç»Ÿä¸€æ¥å£è°ƒç”¨å…¨çƒæœ€å¼º AI æ¨¡å‹ï¼ˆGPT-5.2ã€Claude 4.5ã€Gemini 3 Proã€DeepSeek V4 ç­‰ï¼‰ã€‚é€šè¿‡æ™ºèƒ½è·¯ç”±ã€ç¼“å­˜æœºåˆ¶ã€æ¨¡å‹ç¼–æ’ç­‰æ ¸å¿ƒåŠŸèƒ½ï¼Œå¸®åŠ©ä¼ä¸šåœ¨æ¨ç†æ—¶ä»£å®ç°èƒ½æ•ˆé©å‘½ï¼Œé™ä½ 70% çš„ AI æˆæœ¬ã€‚</p>
<p><strong>ç«‹å³ä½“éªŒ</strong>ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fapi.88api.chat" target="_blank" title="https://api.88api.chat" ref="nofollow noopener noreferrer">api.88api.chat</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å¤§æ¨¡å‹å¾®è°ƒå®æˆ˜æ‰‹å†Œ (SWIFT + Qwen2)]]></title>    <link>https://juejin.cn/post/7604775190211854346</link>    <guid>https://juejin.cn/post/7604775190211854346</guid>    <pubDate>2026-02-10T03:21:32.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604775190211854346" data-draft-id="7604775190211837962" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å¤§æ¨¡å‹å¾®è°ƒå®æˆ˜æ‰‹å†Œ (SWIFT + Qwen2)"/> <meta itemprop="keywords" content="äººå·¥æ™ºèƒ½"/> <meta itemprop="datePublished" content="2026-02-10T03:21:32.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Turnip1202"/> <meta itemprop="url" content="https://juejin.cn/user/1684912023022440"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å¤§æ¨¡å‹å¾®è°ƒå®æˆ˜æ‰‹å†Œ (SWIFT + Qwen2)
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1684912023022440/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Turnip1202
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T03:21:32.000Z" title="Tue Feb 10 2026 03:21:32 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    2
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å¤§æ¨¡å‹å¾®è°ƒå®æˆ˜æ‰‹å†Œ (SWIFT + Qwen2)</h2>
<p>æœ¬æ‰‹å†Œè¯¦ç»†è®°å½•äº†åœ¨ Windows ç¯å¢ƒä¸‹ï¼Œä½¿ç”¨ RTX 4060 (8GB æ˜¾å­˜) æˆåŠŸå¾®è°ƒ Qwen2-1.5B æ¨¡å‹çš„å…¨è¿‡ç¨‹ã€å‘½ä»¤è¯¦è§£åŠå¸¸è§é—®é¢˜å¤„ç†ã€‚</p>
<hr/>
<h3 data-id="heading-1">1. ç¯å¢ƒæ­å»º (Installation)</h3>
<p>åœ¨å¼€å§‹å¾®è°ƒä¹‹å‰ï¼Œéœ€è¦é…ç½®å¥½ Python ç¯å¢ƒåŠç›¸å…³çš„ AI åº“ã€‚å»ºè®®ä½¿ç”¨ Python 3.10+ ç¯å¢ƒã€‚</p>
<h4 data-id="heading-2">ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºå¹¶æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ</span>
python -m venv .venv

<span class="hljs-comment"># æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ (Windows PowerShell)</span>
.\.venv\Scripts\Activate.ps1
</code></pre>
<h4 data-id="heading-3">ç¬¬äºŒæ­¥ï¼šå®‰è£…æ ¸å¿ƒä¾èµ–åŒ…</h4>
<pre><code class="hljs language-perl" lang="perl"><span class="hljs-comment"># 1. å®‰è£… ModelScope SWIFT æ¡†æ¶ (æ ¸å¿ƒå·¥å…·)</span>
pip install ms-swift -U

<span class="hljs-comment"># 2. å®‰è£… PyTorch (æ ¹æ®ä½ çš„ CUDA ç‰ˆæœ¬é€‰æ‹©ï¼Œè¿™é‡Œä»¥ CUDA 12.1 ä¸ºä¾‹)</span>
pip install torch torchvision torchaudio --<span class="hljs-keyword">index</span>-url https:<span class="hljs-regexp">//d</span>ownload.pytorch.org/whl/cu121

<span class="hljs-comment"># 3. å®‰è£…é‡åŒ–ä¸åŠ é€Ÿå·¥å…· (8G æ˜¾å­˜å¿…å¤‡)</span>
pip install bitsandbytes  <span class="hljs-comment"># æä¾› 4-bit é‡åŒ–æ”¯æŒ</span>
pip install accelerate    <span class="hljs-comment"># æ˜¾å­˜ä¼˜åŒ–ä¸åŠ é€Ÿ</span>
pip install peft         <span class="hljs-comment"># LoRA æ ¸å¿ƒåº“</span>
pip install transformers -U <span class="hljs-comment"># ç¡®ä¿ Transformers åº“æ˜¯æœ€æ–°çš„</span>
</code></pre>
<h4 data-id="heading-4">ç¬¬ä¸‰æ­¥ï¼šéªŒè¯å®‰è£…</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æ£€æŸ¥ SWIFT æ˜¯å¦å®‰è£…æˆåŠŸ</span>
swift --version
</code></pre>
<hr/>
<h3 data-id="heading-5">2. å¿«é€Ÿå¼€å§‹æµç¨‹</h3>
<h4 data-id="heading-6">ç¬¬ä¸€æ­¥ï¼šå‡†å¤‡æ•°æ®é›† <code>my_data.jsonl</code></h4>
<p>æ•°æ®é›†åº”åŒ…å«å¤šç§æé—®æ–¹å¼ï¼Œä»¥å¢å¼ºæ¨¡å‹çš„æ³›åŒ–èƒ½åŠ›ã€‚</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span><span class="hljs-attr">"instruction"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"è¿™ä»¶è¡¬è¡«å¤šå°‘é’±ï¼Ÿ"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"output"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"è¿™ä»¶è¡¬è¡«çš„ä»·æ ¼æ˜¯19.9ç¾å…ƒã€‚"</span><span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">{</span><span class="hljs-attr">"instruction"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"è¡¬è¡«å•ä»·æ˜¯å¤šå°‘ï¼Ÿ"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"output"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"è¿™ä»¶è¡¬è¡«çš„ä»·æ ¼æ˜¯19.9ç¾å…ƒã€‚"</span><span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">{</span><span class="hljs-attr">"instruction"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Shirt price please."</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"output"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"è¿™ä»¶è¡¬è¡«çš„ä»·æ ¼æ˜¯19.9ç¾å…ƒã€‚"</span><span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-7">ç¬¬äºŒæ­¥ï¼šæ‰§è¡Œå¾®è°ƒ (SFT)</h4>
<pre><code class="hljs language-lua" lang="lua">swift sft `
    <span class="hljs-comment">--model qwen/Qwen2-1.5B-Instruct `</span>
    <span class="hljs-comment">--train_type lora `</span>
    <span class="hljs-comment">--dataset "d:\ACode\demo\my_data.jsonl" `</span>
    <span class="hljs-comment">--quant_bits 4 `</span>
    <span class="hljs-comment">--max_length 256 `</span>
    <span class="hljs-comment">--per_device_train_batch_size 1 `</span>
    <span class="hljs-comment">--gradient_accumulation_steps 4 `</span>
    <span class="hljs-comment">--learning_rate 1e-4 `</span>
    <span class="hljs-comment">--num_train_epochs 5 `</span>
    <span class="hljs-comment">--lora_rank 8 `</span>
    <span class="hljs-comment">--lora_alpha 32 `</span>
    <span class="hljs-comment">--logging_steps 1 `</span>
    <span class="hljs-comment">--output_dir "d:\ACode\demo\output"</span>
</code></pre>
<h4 data-id="heading-8">ç¬¬ä¸‰æ­¥ï¼šæ¨ç†æµ‹è¯• (Inference)</h4>
<pre><code class="hljs language-arduino" lang="arduino">swift infer --adapters <span class="hljs-string">"D:\ACode\demo\output\v0-xxxxxxxx-xxxxxx\checkpoint-65"</span>
</code></pre>
<h4 data-id="heading-9">ç¬¬å››æ­¥ï¼šåˆå¹¶å¯¼å‡º (Export)</h4>
<pre><code class="hljs language-r" lang="r">swift export `
    --adapters "D:\ACode\demo\output\v0-xxxxxxxx-xxxxxx\checkpoint-65" `
    <span class="hljs-operator">-</span><span class="hljs-operator">-</span>merge_lora true
</code></pre>
<hr/>
<h3 data-id="heading-10">3. åˆå¹¶åçš„æ¨¡å‹ä½¿ç”¨ (Usage)</h3>
<p>åˆå¹¶ï¼ˆMergedï¼‰åçš„æ¨¡å‹å·²ç»å°† LoRA æƒé‡èå…¥äº†åº•åº§æ¨¡å‹ï¼Œå®ƒç°åœ¨æ˜¯ä¸€ä¸ª<strong>å®Œæ•´çš„ã€ç‹¬ç«‹çš„</strong>æ¨¡å‹æ–‡ä»¶å¤¹ï¼ˆé€šå¸¸ä½äº <code>checkpoint-xxx/merged</code> ç›®å½•ä¸‹ï¼‰ã€‚</p>
<h4 data-id="heading-11">æ–¹æ³•ä¸€ï¼šä½¿ç”¨ SWIFT æ¨ç† (æœ€ç®€å•)</h4>
<p>åˆå¹¶åçš„æ¨¡å‹ä¸å†éœ€è¦ <code>--adapters</code> å‚æ•°ï¼Œç›´æ¥ä½œä¸ºæ™®é€šæ¨¡å‹åŠ è½½å³å¯ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># è¿™é‡Œçš„ --model æŒ‡å‘åˆå¹¶åçš„å®Œæ•´ç›®å½•</span>
swift infer --model <span class="hljs-string">"D:\ACode\demo\output\v0-xxx\checkpoint-65\merged"</span>
</code></pre>
<h4 data-id="heading-12">æ–¹æ³•äºŒï¼šä½¿ç”¨åŸç”Ÿ Transformers åº“ (Python ä»£ç )</h4>
<p>ä½ å¯ä»¥åƒä½¿ç”¨ä»»ä½• HuggingFace/ModelScope æ¨¡å‹ä¸€æ ·åŠ è½½å®ƒï¼š</p>
<pre><code class="hljs language-ini" lang="ini">from transformers import AutoModelForCausalLM, AutoTokenizer
import torch

<span class="hljs-attr">model_path</span> = <span class="hljs-string">"D:/ACode/demo/output/v0-xxx/checkpoint-65/merged"</span>

<span class="hljs-comment"># åŠ è½½åˆ†è¯å™¨å’Œæ¨¡å‹</span>
<span class="hljs-attr">tokenizer</span> = AutoTokenizer.from_pretrained(model_path, trust_remote_code=<span class="hljs-literal">True</span>)
<span class="hljs-attr">model</span> = AutoModelForCausalLM.from_pretrained(model_path, torch_dtype=torch.bfloat16, device_map=<span class="hljs-string">"auto"</span>, trust_remote_code=<span class="hljs-literal">True</span>)

<span class="hljs-comment"># è¿›è¡Œå¯¹è¯æµ‹è¯•</span>
<span class="hljs-attr">inputs</span> = tokenizer(<span class="hljs-string">"è¿™ä»¶è¡¬è¡«å¤šå°‘é’±ï¼Ÿ"</span>, return_tensors=<span class="hljs-string">"pt"</span>).to(<span class="hljs-string">"cuda"</span>)
<span class="hljs-attr">outputs</span> = model.generate(**inputs, max_new_tokens=<span class="hljs-number">128</span>)
print(tokenizer.decode(outputs<span class="hljs-section">[0]</span>, <span class="hljs-attr">skip_special_tokens</span>=<span class="hljs-literal">True</span>))
</code></pre>
<h4 data-id="heading-13">æ–¹æ³•ä¸‰ï¼šç¬¬ä¸‰æ–¹å·¥å…·éƒ¨ç½² (éƒ¨ç½²ç¥å™¨)</h4>
<p>å› ä¸ºåˆå¹¶åçš„æ¨¡å‹ç»“æ„ä¸åŸå§‹ Qwen2 å®Œå…¨ä¸€è‡´ï¼Œä½ å¯ä»¥ç›´æ¥å°†å…¶å¯¼å…¥ï¼š</p>
<ul>
<li><strong>LM Studio / Ollama</strong>ï¼šå°†åˆå¹¶åçš„ç›®å½•å¯¼å…¥æˆ–è½¬æ¢ä¸º GGUF æ ¼å¼å³å¯ä½¿ç”¨ã€‚</li>
<li><strong>API æœåŠ¡</strong>ï¼šä½¿ç”¨ <code>vLLM</code> æˆ– <code>FastChat</code> å¿«é€Ÿæ­å»ºè‡ªå·±çš„ API æœåŠ¡å™¨ã€‚</li>
</ul>
<hr/>
<h3 data-id="heading-14">4. æ ¸å¿ƒå‘½ä»¤å‚æ•°è¯¦è§£</h3>
<h4 data-id="heading-15"><code>swift sft</code> (æœ‰ç›‘ç£å¾®è°ƒ)</h4>




























































<table><thead><tr><th>å‚æ•°å</th><th>è§£é‡Š</th><th>å»ºè®®å€¼</th></tr></thead><tbody><tr><td><code>--model</code></td><td>æŒ‡å®šåº•åº§æ¨¡å‹ ID æˆ–è·¯å¾„</td><td><code>qwen/Qwen2-1.5B-Instruct</code></td></tr><tr><td><code>--train_type</code></td><td>è®­ç»ƒæ–¹æ³•</td><td><code>lora</code> (è½»é‡åŒ–æ’ä»¶å¼å¾®è°ƒ)</td></tr><tr><td><code>--quant_bits</code></td><td>é‡åŒ–ä½æ•°</td><td><code>4</code> (8G æ˜¾å­˜å¿…é€‰ï¼Œæ˜¾è‘—é™ä½å ç”¨)</td></tr><tr><td><code>--max_length</code></td><td>å•æ¡æ•°æ®æœ€å¤§é•¿åº¦</td><td><code>256</code> (æ ¹æ®ä»»åŠ¡å¤æ‚åº¦è°ƒæ•´)</td></tr><tr><td><code>--per_device_train_batch_size</code></td><td>å•å¡æ‰¹å¤§å°</td><td><code>1</code> (æ˜¾å­˜å°æ—¶è®¾ä¸º 1)</td></tr><tr><td><code>--gradient_accumulation_steps</code></td><td>æ¢¯åº¦ç´¯ç§¯æ­¥æ•°</td><td><code>4</code> (æ¨¡æ‹Ÿæ›´å¤§çš„ Batch Size)</td></tr><tr><td><code>--learning_rate</code></td><td>å­¦ä¹ ç‡</td><td><code>1e-4</code> (LoRA è®­ç»ƒå¸¸ç”¨å€¼)</td></tr><tr><td><code>--num_train_epochs</code></td><td>è®­ç»ƒæ€»è½®æ•°</td><td><code>5</code> (è§†ä»»åŠ¡å¤æ‚åº¦è€Œå®š)</td></tr><tr><td><code>--lora_rank</code></td><td>LoRA çš„ç§©</td><td><code>8</code> æˆ– <code>16</code> (è¶Šå¤§è¡¨è¾¾åŠ›è¶Šå¼º)</td></tr><tr><td><code>--logging_steps</code></td><td>æ—¥å¿—æ‰“å°é¢‘ç‡</td><td><code>1</code> (æ¯ä¸€å°æ­¥éƒ½æ˜¾ç¤ºï¼Œæ–¹ä¾¿ç›‘æ§)</td></tr></tbody></table>
<h4 data-id="heading-16"><code>swift infer</code> (æ¨¡å‹æ¨ç†)</h4>

























<table><thead><tr><th>å‚æ•°å</th><th>è§£é‡Š</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>--adapters</code></td><td>æŒ‡å‘è®­ç»ƒå¥½çš„ checkpoint æ–‡ä»¶å¤¹</td><td>å¿…é¡»åŒ…å« <code>adapter_config.json</code></td></tr><tr><td><code>--stream</code></td><td>æ˜¯å¦å¼€å¯æµå¼è¾“å‡º</td><td><code>true</code> (åƒ ChatGPT ä¸€æ ·å¼¹å‡ºæ–‡å­—)</td></tr><tr><td><code>--quant_bits</code></td><td>æ¨ç†é‡åŒ–ä½æ•°</td><td><code>0</code> (1.5B æ¨¡å‹æ¨ç†æ—¶ä¸é‡åŒ–æ›´ç¨³å®š)</td></tr></tbody></table>
<h4 data-id="heading-17"><code>swift export</code> (å¯¼å‡ºåˆå¹¶)</h4>















<table><thead><tr><th>å‚æ•°å</th><th>è§£é‡Š</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>--merge_lora</code></td><td>æ˜¯å¦å°† LoRA æƒé‡åˆå¹¶å…¥ä¸»æ¨¡å‹</td><td><code>true</code> (ç”Ÿæˆå¯ç‹¬ç«‹ä½¿ç”¨çš„æ¨¡å‹)</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-18">4. å¸¸è§é—®é¢˜ (FAQ)</h3>
<h4 data-id="heading-19">Q: ä¸ºä»€ä¹ˆå‘½ä»¤æ‰§è¡Œå <code>output</code> æ–‡ä»¶å¤¹é‡Œæ²¡æœ‰ä¸œè¥¿ï¼Ÿ</h4>
<p><strong>A</strong>: SWIFT åœ¨å¯åŠ¨é˜¶æ®µéœ€è¦è¿›è¡Œæ¨¡å‹ä¸‹è½½ã€åŠ è½½å’Œ <strong>4-bit é‡åŒ–</strong>ï¼Œè¿™é€šå¸¸éœ€è¦ 30-60 ç§’ã€‚åœ¨é‡åŒ–å®Œæˆå¹¶å¼€å§‹ç¬¬ä¸€ä¸ªè®­ç»ƒæ­¥ä¹‹å‰ï¼Œä¸ä¼šå†™å…¥æ—¥å¿—ã€‚</p>
<h4 data-id="heading-20">Q: é‡åˆ° <code>ambiguous option</code> é”™è¯¯æ€ä¹ˆåŠï¼Ÿ</h4>
<p><strong>A</strong>: è¿™æ˜¯ SWIFT v3 çš„å‚æ•°åæ­§ä¹‰ã€‚ä¾‹å¦‚ä½¿ç”¨ <code>--merge_lora true</code> è€Œä¸æ˜¯æ¨¡ç³Šçš„ <code>--merge</code>ã€‚</p>
<h4 data-id="heading-21">Q: 8GB æ˜¾å­˜å¦‚ä½•è¿›ä¸€æ­¥ä¼˜åŒ–ï¼Ÿ</h4>
<p><strong>A</strong>:</p>
<ol>
<li>å‡å° <code>--max_length</code> (ä¾‹å¦‚è®¾ä¸º 128)ã€‚</li>
<li>ç¡®ä¿å¼€å¯ <code>--gradient_checkpointing true</code>ã€‚</li>
<li>å…³é—­æµè§ˆå™¨ç­‰å ç”¨ GPU èµ„æºçš„åå°ç¨‹åºã€‚</li>
</ol>
<hr/>
<h3 data-id="heading-22">5. ç›®å½•ç»“æ„å‚è€ƒ</h3>
<pre><code class="hljs language-bash" lang="bash">demo/
â”œâ”€â”€ my_data.jsonl          <span class="hljs-comment"># åŸå§‹æ•°æ®é›†</span>
â”œâ”€â”€ output/                <span class="hljs-comment"># è®­ç»ƒè¾“å‡ºç›®å½•</span>
â”‚   â””â”€â”€ v0-xxx-xxx/        <span class="hljs-comment"># æŸæ¬¡è®­ç»ƒçš„ä»»åŠ¡æ–‡ä»¶å¤¹</span>
â”‚       â”œâ”€â”€ checkpoint-65/ <span class="hljs-comment"># è®­ç»ƒç”Ÿæˆçš„æƒé‡</span>
â”‚       â””â”€â”€ logging.jsonl  <span class="hljs-comment"># è®­ç»ƒæ—¥å¿—</span>
â””â”€â”€ .venv/                 <span class="hljs-comment"># Python è™šæ‹Ÿç¯å¢ƒ</span>
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ã€éAIã€‘å¹¶å‘ç¯å¢ƒä¸‹æ­»é”æ£€æµ‹çš„å®ç°æ–¹æ¡ˆ]]></title>    <link>https://juejin.cn/post/7604694326519152691</link>    <guid>https://juejin.cn/post/7604694326519152691</guid>    <pubDate>2026-02-10T03:59:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604694326519152691" data-draft-id="7604693038440300550" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ã€éAIã€‘å¹¶å‘ç¯å¢ƒä¸‹æ­»é”æ£€æµ‹çš„å®ç°æ–¹æ¡ˆ"/> <meta itemprop="keywords" content="åç«¯,Java,æ€§èƒ½ä¼˜åŒ–"/> <meta itemprop="datePublished" content="2026-02-10T03:59:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ¡¦è¯´ç¼–ç¨‹"/> <meta itemprop="url" content="https://juejin.cn/user/2212689394274136"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ã€éAIã€‘å¹¶å‘ç¯å¢ƒä¸‹æ­»é”æ£€æµ‹çš„å®ç°æ–¹æ¡ˆ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2212689394274136/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ¡¦è¯´ç¼–ç¨‹
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T03:59:23.000Z" title="Tue Feb 10 2026 03:59:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">èƒŒæ™¯</h2>
<p>åœ¨å¤æ‚çš„å¹¶å‘ç³»ç»Ÿä¸­ï¼Œå°¤å…¶æ˜¯æ¶‰åŠå¤šçº¿ç¨‹æ± åµŒå¥—è°ƒç”¨çš„åœºæ™¯ï¼Œæ­»é”å’Œæ´»é”é—®é¢˜å¾€å¾€éš¾ä»¥å‘ç°å’Œæ’æŸ¥ã€‚æœ¬æ–‡ä»‹ç»ä¸€ç§åŸºäº<strong>ä»»åŠ¡ä¾èµ–å›¾</strong>çš„æ£€æµ‹æ–¹æ¡ˆï¼Œèƒ½å¤Ÿåœ¨è¿è¡Œæ—¶åŠ¨æ€è¿½è¸ªä»»åŠ¡è°ƒç”¨é“¾ï¼Œè‡ªåŠ¨è¯†åˆ«æ½œåœ¨çš„å¾ªç¯ä¾èµ–é£é™©ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b384fb9b72ae4cc2b945bb5a94688b7e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5qGm6K-057yW56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771300799&amp;x-signature=oskpi3KAAZtbRdCocvHYK79pJSo%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-1">æ ¸å¿ƒæ€æƒ³</h2>
<h3 data-id="heading-2">1. é—®é¢˜å»ºæ¨¡</h3>
<p>å°†å¹¶å‘ä»»åŠ¡è°ƒç”¨å…³ç³»æŠ½è±¡ä¸º<strong>æœ‰å‘å›¾</strong>ï¼š</p>
<ul>
<li><strong>èŠ‚ç‚¹</strong>ï¼šæ¯ä¸ªä»»åŠ¡ï¼ˆæˆ–æ‰§è¡Œå™¨/çº¿ç¨‹æ± ï¼‰</li>
<li><strong>è¾¹</strong>ï¼šä»»åŠ¡ A æäº¤ä»»åŠ¡ B æ‰§è¡Œï¼Œåˆ™å­˜åœ¨è¾¹ A â†’ B</li>
</ul>
<p>å¦‚æœè¿™ä¸ªæœ‰å‘å›¾ä¸­å­˜åœ¨<strong>ç¯è·¯</strong>ï¼Œåˆ™æ„å‘³ç€å­˜åœ¨æ½œåœ¨çš„æ­»é”é£é™©ã€‚
å¦‚æœæœ‰è¶…æ—¶æ—¶é—´ï¼Œå‡ºç°æ­»é”æ—¶ï¼Œä¼šç¨³å®šè§¦å‘è¶…æ—¶ï¼Œé€€åŒ–ä¸ºé¥¥é¥¿é—®é¢˜ï¼Œæœ¬è´¨è¿˜æ˜¯æ­»é”ã€‚å®é™…ç”Ÿäº§ä¸­ï¼Œå¯ä»¥é€šè¿‡è¿™ä¸ªæŒ‡æ ‡æ¨æ–­æ­»é”å·²ç»å‘ç”Ÿã€‚</p>
<pre><code class="hljs language-scss" lang="scss">TaskA â†’ TaskB â†’ TaskC â†’ TaskA  (ç¯è·¯ = æ­»é”é£é™©)
</code></pre>
<h3 data-id="heading-3">2. æ£€æµ‹ç»´åº¦</h3>
<p>æˆ‘ä»¬å…³æ³¨ä¸¤ä¸ªå±‚é¢çš„å¾ªç¯ä¾èµ–ï¼š</p>

















<table><thead><tr><th>ç»´åº¦</th><th>æ£€æµ‹å†…å®¹</th></tr></thead><tbody><tr><td><strong>ä»»åŠ¡çº§åˆ«</strong></td><td>ä»»åŠ¡ A â†’ B â†’ C â†’ A</td></tr><tr><td><strong>æ‰§è¡Œå™¨çº§åˆ«</strong></td><td>çº¿ç¨‹æ±  X â†’ Y â†’ X</td></tr></tbody></table>
<h3 data-id="heading-4">3. å…³é”®æŠ€æœ¯ç‚¹</h3>
<ol>
<li><strong>TransmittableThreadLocal (TTL)</strong>ï¼šè·¨çº¿ç¨‹ä¼ é€’ä»»åŠ¡å›¾æ•°æ®</li>
<li><strong>Guava Graph</strong>ï¼šé«˜æ•ˆçš„å›¾æ•°æ®ç»“æ„å’Œç¯è·¯æ£€æµ‹ç®—æ³•</li>
<li><strong>æ‡’åŠ è½½</strong>ï¼šä»…åœ¨è¯·æ±‚ç»“æŸæ—¶æ„å»ºå’Œåˆ†æå›¾</li>
<li><strong>çº¿ç¨‹å®‰å…¨é˜Ÿåˆ—</strong>ï¼šæ— é”æ”¶é›†ä»»åŠ¡å¯¹</li>
</ol>
<h2 data-id="heading-5">å®ç°æ–¹æ¡ˆ</h2>
<h3 data-id="heading-6">æ•´ä½“æ¶æ„</h3>
<pre><code class="hljs language-scss" lang="scss">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      è¯·æ±‚å…¥å£                            â”‚
â”‚                   TaskGraph<span class="hljs-selector-class">.init</span>()                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚         ä¸šåŠ¡ä»£ç æ‰§è¡Œ                â”‚
    â”‚   ParallelExecutor<span class="hljs-selector-class">.submit</span>(task)   â”‚
    â”‚         â†“ <span class="hljs-built_in">logForking</span>()            â”‚
    â”‚   è®°å½•: parent â†’ child            â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚         è¯·æ±‚ç»“æŸ                    â”‚
    â”‚   TaskGraph.<span class="hljs-built_in">destroy</span>()             â”‚
    â”‚   - æ„å»ºæœ‰å‘å›¾                      â”‚
    â”‚   - æ£€æµ‹ç¯è·¯                        â”‚
    â”‚   - è¾“å‡ºå‘Šè­¦æ—¥å¿—                    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h3 data-id="heading-7">æ ¸å¿ƒæ•°æ®ç»“æ„ï¼šä»»åŠ¡å›¾</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * ä»»åŠ¡ä¾èµ–å›¾ - é€šè¿‡ TTL å®ç°è¯·æ±‚çº§åˆ«å…±äº«
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TaskGraph</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">TransmittableThreadLocal</span>&lt;TaskGraph.Data&gt; {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">TaskGraph</span> <span class="hljs-variable">TTL</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TaskGraph</span>();

    <span class="hljs-comment">/** ä»»åŠ¡å â†’ æ‰§è¡Œå™¨å çš„æ˜ å°„ */</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Map&lt;String, String&gt; TASK_TO_EXECUTOR_MAP = buildTaskExecutorMapping();

    <span class="hljs-comment">/**
     * è¯·æ±‚çº§åˆ«çš„å›¾æ•°æ®ï¼ˆçº¿ç¨‹å®‰å…¨ï¼Œæ‰€æœ‰å­çº¿ç¨‹å…±äº«åŒä¸€å®ä¾‹ï¼‰
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Data</span> {
        <span class="hljs-comment">/** ä»»åŠ¡å¯¹é˜Ÿåˆ—ï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰ */</span>
        <span class="hljs-keyword">final</span> BlockingQueue&lt;EndpointPair&lt;String&gt;&gt; taskPairs = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedTransferQueue</span>&lt;&gt;();

        <span class="hljs-comment">/** æ‡’åŠ è½½ï¼šä»»åŠ¡ä¾èµ–å›¾ */</span>
        <span class="hljs-meta">@Getter(lazy = true)</span>
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Graph&lt;String&gt; taskGraph = buildTaskGraph();

        <span class="hljs-comment">/** æ‡’åŠ è½½ï¼šæ‰§è¡Œå™¨ä¾èµ–å›¾ */</span>
        <span class="hljs-meta">@Getter(lazy = true)</span>
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Graph&lt;String&gt; executorGraph = buildExecutorGraph();

        <span class="hljs-comment">/** æ‡’åŠ è½½ï¼šæ˜¯å¦å­˜åœ¨ä»»åŠ¡ç¯è·¯ */</span>
        <span class="hljs-meta">@Getter(lazy = true)</span>
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">hasTaskCycle</span> <span class="hljs-operator">=</span> Graphs.hasCycle(getTaskGraph());

        <span class="hljs-comment">/** æ‡’åŠ è½½ï¼šæ˜¯å¦å­˜åœ¨æ‰§è¡Œå™¨ç¯è·¯ */</span>
        <span class="hljs-meta">@Getter(lazy = true)</span>
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">hasExecutorCycle</span> <span class="hljs-operator">=</span> Graphs.hasCycle(getExecutorGraph());

        <span class="hljs-comment">/** æ‡’åŠ è½½ï¼šæ˜¯å¦å­˜åœ¨è‡ªç¯ */</span>
        <span class="hljs-meta">@Getter(lazy = true)</span>
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">hasSelfLoop</span> <span class="hljs-operator">=</span> checkSelfLoop();

        <span class="hljs-keyword">private</span> Graph&lt;String&gt; <span class="hljs-title function_">buildTaskGraph</span><span class="hljs-params">()</span> {
            Builder&lt;String&gt; builder = GraphBuilder.directed()
                    .allowsSelfLoops(<span class="hljs-literal">true</span>)
                    .immutable();
            taskPairs.forEach(builder::putEdge);
            <span class="hljs-keyword">return</span> builder.build();
        }

        <span class="hljs-keyword">private</span> Graph&lt;String&gt; <span class="hljs-title function_">buildExecutorGraph</span><span class="hljs-params">()</span> {
            Builder&lt;String&gt; builder = GraphBuilder.directed()
                    .allowsSelfLoops(<span class="hljs-literal">true</span>)
                    .immutable();

            getTaskGraph().edges().stream()
                    .map(pair -&gt; EndpointPair.ordered(
                            TASK_TO_EXECUTOR_MAP.getOrDefault(pair.source(), <span class="hljs-string">"UNKNOWN"</span>),
                            TASK_TO_EXECUTOR_MAP.getOrDefault(pair.target(), <span class="hljs-string">"UNKNOWN"</span>)))
                    .forEach(builder::putEdge);
            <span class="hljs-keyword">return</span> builder.build();
        }

        <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">checkSelfLoop</span><span class="hljs-params">()</span> {
            <span class="hljs-keyword">return</span> getExecutorGraph().edges().stream()
                    .anyMatch(p -&gt; Objects.equals(p.nodeU(), p.nodeV()));
        }
    }

    <span class="hljs-comment">// ============== TTL æ ¸å¿ƒæ–¹æ³• ==============</span>

    <span class="hljs-comment">/**
     * è·¨çº¿ç¨‹æ‹·è´ï¼šè¿”å›åŒä¸€ Data å®ä¾‹ï¼ˆå¼•ç”¨å…±äº«ï¼‰
     */</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Data <span class="hljs-title function_">copy</span><span class="hljs-params">(Data parentValue)</span> {
        <span class="hljs-keyword">return</span> parentValue;  <span class="hljs-comment">// æ‰€æœ‰å­çº¿ç¨‹å…±äº«åŒä¸€ä¸ª Data</span>
    }

    <span class="hljs-comment">// ============== å…¬å…± API ==============</span>

    <span class="hljs-comment">/** è¯·æ±‚å¼€å§‹æ—¶åˆå§‹åŒ– */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">()</span> {
        TTL.set(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Data</span>());
    }

    <span class="hljs-comment">/** è®°å½•ä»»åŠ¡ä¾èµ–å…³ç³» */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">logTaskPair</span><span class="hljs-params">(String parent, String child)</span> {
        <span class="hljs-type">Data</span> <span class="hljs-variable">data</span> <span class="hljs-operator">=</span> TTL.get();
        <span class="hljs-keyword">if</span> (data != <span class="hljs-literal">null</span>) {
            parent = StringUtils.defaultString(parent, <span class="hljs-string">"ROOT"</span>);
            data.taskPairs.add(EndpointPair.ordered(parent, child));
        }
    }

    <span class="hljs-comment">/** è¯·æ±‚ç»“æŸæ—¶æ£€æµ‹å¹¶æ¸…ç† */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">destroy</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">Data</span> <span class="hljs-variable">data</span> <span class="hljs-operator">=</span> TTL.get();
            <span class="hljs-keyword">if</span> (data != <span class="hljs-literal">null</span> &amp;&amp; !data.taskPairs.isEmpty()) {
                checkAndLog(data);
            }
        } <span class="hljs-keyword">finally</span> {
            TTL.remove();
        }
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">checkAndLog</span><span class="hljs-params">(Data data)</span> {
        <span class="hljs-type">boolean</span> <span class="hljs-variable">hasTaskCycle</span> <span class="hljs-operator">=</span> data.isHasTaskCycle();
        <span class="hljs-type">boolean</span> <span class="hljs-variable">hasExecutorCycle</span> <span class="hljs-operator">=</span> data.isHasExecutorCycle();
        <span class="hljs-type">boolean</span> <span class="hljs-variable">hasSelfLoop</span> <span class="hljs-operator">=</span> data.isHasSelfLoop();

        <span class="hljs-keyword">if</span> (hasTaskCycle || hasExecutorCycle || hasSelfLoop) {
            <span class="hljs-type">String</span> <span class="hljs-variable">edges</span> <span class="hljs-operator">=</span> data.getExecutorGraph().edges().stream()
                    .map(p -&gt; p.source() + <span class="hljs-string">" â†’ "</span> + p.target())
                    .collect(Collectors.joining(<span class="hljs-string">", "</span>));

            log.warn(<span class="hljs-string">"Potential deadlock detected: taskCycle={}, executorCycle={}, "</span> +
                     <span class="hljs-string">"selfLoop={}, edges=[{}]"</span>,
                    hasTaskCycle, hasExecutorCycle, hasSelfLoop, edges);
        }
    }
}
</code></pre>
<h3 data-id="heading-8">å¹¶è¡Œæ‰§è¡Œå™¨é›†æˆ</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * å¹¶è¡Œæ‰§è¡Œå¸®åŠ©ç±» - åœ¨ä»»åŠ¡æäº¤æ—¶è®°å½•ä¾èµ–å…³ç³»
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ParallelHelper</span> {

    <span class="hljs-comment">/**
     * è®°å½•ä»»åŠ¡åˆ†å‰ï¼ˆçˆ¶ä»»åŠ¡ â†’ å­ä»»åŠ¡ï¼‰
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">logForking</span><span class="hljs-params">(String childTaskName)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">parentTaskName</span> <span class="hljs-operator">=</span> ThreadContext.getCurrentTaskName();
        TaskGraph.logTaskPair(parentTaskName, childTaskName);
    }

    <span class="hljs-comment">/**
     * å¹¶è¡Œæ‰§è¡Œä»»åŠ¡é›†åˆ
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;T, R&gt; List&lt;R&gt; <span class="hljs-title function_">parallelMap</span><span class="hljs-params">(
            List&lt;T&gt; items,
            Function&lt;T, R&gt; mapper,
            ParallelOptions options,
            ExecutorService executor)</span> {

        <span class="hljs-keyword">if</span> (CollectionUtils.isEmpty(items)) {
            <span class="hljs-keyword">return</span> Collections.emptyList();
        }

        <span class="hljs-comment">// è®°å½•ä»»åŠ¡ä¾èµ–</span>
        logForking(options.getTaskName());

        <span class="hljs-comment">// åŒ…è£…ä»»åŠ¡ï¼Œä¼ é€’ä¸Šä¸‹æ–‡</span>
        List&lt;Callable&lt;R&gt;&gt; tasks = items.stream()
                .map(item -&gt; wrapWithContext(options.getTaskName(), () -&gt; mapper.apply(item)))
                .collect(toList());

        <span class="hljs-comment">// æäº¤æ‰§è¡Œ</span>
        <span class="hljs-keyword">return</span> submitAndWait(tasks, executor, options.getTimeout());
    }
}
</code></pre>
<h3 data-id="heading-9">ä»»åŠ¡æšä¸¾ä¸æ‰§è¡Œå™¨æ˜ å°„</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * å­ä»»åŠ¡æšä¸¾ - å®šä¹‰ä»»åŠ¡åä¸æ‰§è¡Œå™¨çš„æ˜ å°„å…³ç³»
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">SubTaskEnum</span> {

    <span class="hljs-comment">// ç¤ºä¾‹ä»»åŠ¡å®šä¹‰</span>
    PRICE_CALCULATION(<span class="hljs-string">"PriceCalculation"</span>, <span class="hljs-string">"COMPUTE_POOL"</span>),
    INVENTORY_CHECK(<span class="hljs-string">"InventoryCheck"</span>, <span class="hljs-string">"IO_POOL"</span>),
    CACHE_REFRESH(<span class="hljs-string">"CacheRefresh"</span>, <span class="hljs-string">"IO_POOL"</span>),
    RULE_EVALUATION(<span class="hljs-string">"RuleEvaluation"</span>, <span class="hljs-string">"COMPUTE_POOL"</span>);

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String taskName;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String executorName;

    SubTaskEnum(String taskName, String executorName) {
        <span class="hljs-built_in">this</span>.taskName = taskName;
        <span class="hljs-built_in">this</span>.executorName = executorName;
    }

    <span class="hljs-comment">/** æ„å»ºå…¨å±€æ˜ å°„è¡¨ */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Map&lt;String, String&gt; TASK_TO_EXECUTOR_MAP =
            Arrays.stream(values())
                    .collect(Collectors.toMap(
                            SubTaskEnum::getTaskName,
                            SubTaskEnum::getExecutorName));
}
</code></pre>
<h3 data-id="heading-10">è¯·æ±‚ç”Ÿå‘½å‘¨æœŸé›†æˆ</h3>
<p>RPCæ¡†æ¶å’Œå¸¸é©»çº¿ç¨‹æ± ä»»åŠ¡ç­‰ä¹Ÿéœ€è¦è€ƒè™‘ï¼Œè¿™é‡Œä¸ä½œå±•ç¤ºã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * è¯·æ±‚æ‹¦æˆªå™¨ - ç®¡ç† TaskGraph ç”Ÿå‘½å‘¨æœŸ
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RequestInterceptor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">HandlerInterceptor</span> {

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">preHandle</span><span class="hljs-params">(HttpServletRequest request,
                            HttpServletResponse response,
                            Object handler)</span> {
        ThreadContext.setCurrentTaskName(<span class="hljs-string">"REQUEST_ENTRY"</span>);
        TaskGraph.init();
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">afterCompletion</span><span class="hljs-params">(HttpServletRequest request,
                               HttpServletResponse response,
                               Object handler,
                               Exception ex)</span> {
        <span class="hljs-comment">// è¯·æ±‚ç»“æŸï¼šæ£€æµ‹å¹¶æ¸…ç†</span>
        TaskGraph.destroy();
        ThreadContext.remove();
    }
}
</code></pre>
<h2 data-id="heading-11">æ£€æµ‹æ•ˆæœç¤ºä¾‹</h2>
<h3 data-id="heading-12">åœºæ™¯ï¼šæ‰§è¡Œå™¨è‡ªç¯</h3>
<pre><code class="hljs">COMPUTE_POOL çš„ä»»åŠ¡åŒæ­¥ç­‰å¾… COMPUTE_POOL çš„ç»“æœ
</code></pre>
<p>æ—¥å¿—è¾“å‡ºï¼š</p>
<pre><code class="hljs language-ini" lang="ini">WARN - Potential deadlock detected:
       <span class="hljs-attr">taskCycle</span>=<span class="hljs-literal">true</span>, executorCycle=<span class="hljs-literal">true</span>, selfLoop=<span class="hljs-literal">true</span>,
       <span class="hljs-attr">edges</span>=[COMPUTE_POOL â†’ COMPUTE_POOL]
</code></pre>
<h3 data-id="heading-13">åœºæ™¯ï¼šè·¨æ‰§è¡Œå™¨ç¯è·¯</h3>
<pre><code class="hljs">COMPUTE_POOL â†’ IO_POOL â†’ COMPUTE_POOL
</code></pre>
<p>æ—¥å¿—è¾“å‡ºï¼š</p>
<pre><code class="hljs language-ini" lang="ini">WARN - Potential deadlock detected:
       <span class="hljs-attr">taskCycle</span>=<span class="hljs-literal">true</span>, executorCycle=<span class="hljs-literal">true</span>, selfLoop=<span class="hljs-literal">false</span>,
       <span class="hljs-attr">edges</span>=[COMPUTE_POOL â†’ IO_POOL, IO_POOL â†’ COMPUTE_POOL]
</code></pre>
<h2 data-id="heading-14">æ€»ç»“</h2>
<h3 data-id="heading-15">æŠ€æœ¯è¦ç‚¹</h3>
<p><strong>TTL (TransmittableThreadLocal)</strong>ï¼šç”¨äºè·¨çº¿ç¨‹ä¼ é€’ä»»åŠ¡å›¾æ•°æ®ã€‚é€šè¿‡é‡å†™ <code>copy()</code> æ–¹æ³•è¿”å›åŒä¸€å®ä¾‹ï¼Œä½¿å¾—æ•´ä¸ªè¯·æ±‚æ ‘ä¸­çš„æ‰€æœ‰çº¿ç¨‹å…±äº«åŒä¸€ä¸ª Data å¯¹è±¡ï¼Œä»è€Œå®ç°ä»»åŠ¡ä¾èµ–å…³ç³»çš„ç»Ÿä¸€æ”¶é›†ã€‚</p>
<p><strong>Guava Graph</strong>ï¼šæä¾›é«˜æ•ˆçš„å›¾æ•°æ®ç»“æ„å’Œç¯è·¯æ£€æµ‹èƒ½åŠ›ã€‚ä½¿ç”¨ <code>GraphBuilder</code> æ„å»ºæœ‰å‘å›¾ï¼Œé€šè¿‡ <code>Graphs.hasCycle()</code> æ–¹æ³•æ£€æµ‹æ˜¯å¦å­˜åœ¨å¾ªç¯ä¾èµ–ã€‚</p>
<p><strong>æ‡’åŠ è½½æœºåˆ¶</strong>ï¼šé€šè¿‡ Lombok çš„ <code>@Getter(lazy=true)</code> æ³¨è§£å®ç°æ‡’åŠ è½½ï¼Œä»…åœ¨è¯·æ±‚ç»“æŸéœ€è¦æ£€æµ‹æ—¶æ‰æ„å»ºå›¾å¹¶æ‰§è¡Œåˆ†æï¼Œé¿å…äº†è¿è¡Œæ—¶çš„é¢å¤–è®¡ç®—å¼€é”€ã€‚</p>
<p><strong>LinkedTransferQueue</strong>ï¼šä½œä¸ºæ— é”å¹¶å‘é˜Ÿåˆ—ï¼Œæ”¯æŒå¤šçº¿ç¨‹åŒæ—¶è®°å½•ä»»åŠ¡å¯¹ã€‚è¯¥é˜Ÿåˆ—å…·æœ‰è‰¯å¥½çš„å¹¶å‘æ€§èƒ½ï¼Œå†™å…¥æ“ä½œçš„æ—¶é—´å¤æ‚åº¦ä¸º O(1)ã€‚</p>
<p><strong>Callable åŒ…è£…</strong>ï¼šé‡‡ç”¨è£…é¥°å™¨æ¨¡å¼åŒ…è£…åŸå§‹ä»»åŠ¡ï¼Œåœ¨ä»»åŠ¡æ‰§è¡Œå‰åç»´æŠ¤å½“å‰ä»»åŠ¡åä¸Šä¸‹æ–‡ï¼Œä½¿å¾—åµŒå¥—çš„å­ä»»åŠ¡èƒ½å¤Ÿæ­£ç¡®è®°å½•çˆ¶å­ä¾èµ–å…³ç³»ã€‚</p>
<h3 data-id="heading-16">æ³¨æ„äº‹é¡¹</h3>
<ul>
<li><strong>æ€§èƒ½å¼€é”€</strong>ï¼šTaskGraph ä»…åœ¨è¯·æ±‚ç»“æŸæ—¶æ„å»ºå›¾ç»“æ„ï¼Œè¿è¡Œæ—¶åªè¿›è¡Œé˜Ÿåˆ—å†™å…¥æ“ä½œï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O(1)ï¼Œå¯¹ä¸šåŠ¡æ€§èƒ½å½±å“æå°</li>
<li><strong>è¯¯æŠ¥å¤„ç†</strong>ï¼šæ£€æµ‹åˆ°ç¯è·¯å¹¶ä¸æ„å‘³ç€å¿…ç„¶å‘ç”Ÿæ­»é”ï¼Œéœ€è¦ç»“åˆçº¿ç¨‹æ± çš„æ‹’ç»ç­–ç•¥ï¼ˆå¦‚ CallerRunsPolicyï¼‰å’Œå®é™…ä¸šåŠ¡åœºæ™¯ç»¼åˆåˆ†æ</li>
<li><strong>é‡‡æ ·æ§åˆ¶</strong>ï¼šç”Ÿäº§ç¯å¢ƒå»ºè®®é€šè¿‡é…ç½®å¼€å…³æ§åˆ¶é‡‡æ ·ç‡ï¼Œé¿å…å¯¹æ€§èƒ½æ•æ„Ÿåœºæ™¯äº§ç”Ÿå½±å“</li>
</ul>
<h3 data-id="heading-17">æ‰©å±•æ–¹å‘</h3>
<ul>
<li><strong>å¯è§†åŒ–</strong>ï¼šå°†ä»»åŠ¡å›¾å¯¼å‡ºä¸º DOT æ ¼å¼ï¼Œä½¿ç”¨ Graphviz ç­‰å·¥å…·æ¸²æŸ“æˆå¯è§†åŒ–å›¾è¡¨ï¼Œä¾¿äºç›´è§‚åˆ†æä¾èµ–å…³ç³»</li>
<li><strong>å‘Šè­¦é›†æˆ</strong>ï¼šæ¥å…¥ç›‘æ§ç³»ç»Ÿï¼Œå½“æ£€æµ‹åˆ°æ½œåœ¨æ­»é”æ—¶è‡ªåŠ¨è§¦å‘å‘Šè­¦é€šçŸ¥</li>
<li><strong>å†å²åˆ†æ</strong>ï¼šæŒä¹…åŒ–å­˜å‚¨å†å²æ£€æµ‹æ•°æ®ï¼Œåˆ†æé«˜é¢‘å‡ºç°çš„ç¯è·¯æ¨¡å¼ï¼Œè¯†åˆ«ç³»ç»Ÿæ€§çš„æ¶æ„é—®é¢˜</li>
</ul>
<hr/>
<p>é€šè¿‡è¿™å¥—æ–¹æ¡ˆï¼Œæˆ‘ä»¬èƒ½å¤Ÿåœ¨è¿è¡Œæ—¶è‡ªåŠ¨å‘ç°æ½œåœ¨çš„æ­»é”é£é™©ï¼Œå°†é—®é¢˜ä»"çº¿ä¸Šæ’æŸ¥"å‰ç§»åˆ°"æå‰é¢„è­¦"ï¼Œæ˜¾è‘—é™ä½å¹¶å‘é—®é¢˜çš„å®šä½æˆæœ¬ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[åŒä¸€ç”µè„‘é…ç½®å¤šgithubå¸å·]]></title>    <link>https://juejin.cn/post/7604775190212165642</link>    <guid>https://juejin.cn/post/7604775190212165642</guid>    <pubDate>2026-02-10T04:00:10.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604775190212165642" data-draft-id="7604761524976812041" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="åŒä¸€ç”µè„‘é…ç½®å¤šgithubå¸å· "/> <meta itemprop="keywords" content="å‰ç«¯,åç«¯,JavaScript"/> <meta itemprop="datePublished" content="2026-02-10T04:00:10.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="éšæ„_"/> <meta itemprop="url" content="https://juejin.cn/user/4222562141210478"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            åŒä¸€ç”µè„‘é…ç½®å¤šgithubå¸å· 
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4222562141210478/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    éšæ„_
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T04:00:10.000Z" title="Tue Feb 10 2026 04:00:10 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨æ—¥å¸¸å¼€å‘ä¸­ï¼Œå¾ˆå¤šå¼€å‘è€…ä¼šåŒæ—¶ä½¿ç”¨å¤šä¸ª GitHub è´¦å·ï¼ˆæ¯”å¦‚å·¥ä½œè´¦å·ã€ä¸ªäººè´¦å·ï¼‰ï¼Œå¦‚æœç›´æ¥å…±ç”¨ä¸€å¥— SSH å¯†é’¥ï¼Œä¼šå¯¼è‡´æƒé™æ··ä¹±ã€ä»£ç æäº¤èº«ä»½é”™è¯¯ç­‰é—®é¢˜ã€‚æœ¬æ–‡å°†ä»åŸç†åˆ°å®æ“ï¼Œæ•™ä½ å¦‚ä½•ä¸ºå¤šä¸ª GitHub è´¦å·é…ç½®ç‹¬ç«‹çš„ SSH å¯†é’¥ï¼Œä»¥åŠå¦‚ä½•æ­£ç¡®æ‹‰å–å¯¹åº”è´¦å·çš„ä»£ç ã€‚</p>
<h2 data-id="heading-0">ä¸€ã€æ ¸å¿ƒåŸç†</h2>
<p>SSH å¯†é’¥æ˜¯æœ¬åœ°ä¸ GitHub è®¤è¯çš„ â€œèº«ä»½è¯â€ï¼Œæ¯ä¸ª GitHub è´¦å·å¯ç»‘å®šç‹¬ç«‹çš„ SSH å¯†é’¥ã€‚å•å°ç”µè„‘åŒºåˆ†å¤šè´¦å·çš„å…³é”®æ˜¯ï¼š</p>
<ol>
<li>ä¸ºæ¯ä¸ª GitHub è´¦å·ç”Ÿæˆ<strong>ç‹¬ç«‹çš„ SSH å¯†é’¥æ–‡ä»¶</strong>ï¼›</li>
<li>é€šè¿‡ <code>config</code> é…ç½®æ–‡ä»¶å»ºç«‹ â€œåˆ«å - å¯†é’¥ - è´¦å·â€ çš„å¯¹åº”å…³ç³»ï¼›</li>
<li>æ‹‰å– / æ¨é€ä»£ç æ—¶ï¼Œç”¨è‡ªå®šä¹‰åˆ«åæ›¿ä»£é»˜è®¤çš„ <code>github.com</code>ï¼Œè®© Git è‡ªåŠ¨åŒ¹é…å¯¹åº”å¯†é’¥</li>
</ol>
<h2 data-id="heading-1">äºŒã€å‰ç½®å‡†å¤‡</h2>
<ol>
<li>å·²å®‰è£… Gitï¼ˆWindows/macOS/Linux å‡å¯ï¼‰ï¼›</li>
<li>æ‹¥æœ‰ä¸¤ä¸ªåŠä»¥ä¸Š GitHub è´¦å·ï¼›</li>
<li>çŸ¥æ™“æœ¬åœ°å®¶ç›®å½•è·¯å¾„ï¼ˆWindowsï¼š<code>C:\Users\ä½ çš„ç”¨æˆ·å</code>ï¼›macOS/Linuxï¼š<code>/Users/ä½ çš„ç”¨æˆ·å</code> æˆ– <code>/home/ä½ çš„ç”¨æˆ·å</code>ï¼‰ã€‚</li>
</ol>
<h2 data-id="heading-2">ä¸‰ã€å®æ“æ­¥éª¤ï¼ˆä»¥ 2 ä¸ª GitHub è´¦å·ä¸ºä¾‹ï¼‰</h2>
<h3 data-id="heading-3">æ­¥éª¤ 1ï¼šä¸ºä¸åŒ GitHub è´¦å·ç”Ÿæˆç‹¬ç«‹ SSH å¯†é’¥</h3>
<p>æ‰“å¼€ç»ˆç«¯ï¼ˆWindows ç”¨ Git Bash/CMDï¼ŒmacOS/Linux ç”¨ç»ˆç«¯ï¼‰ï¼Œåˆ†åˆ«ä¸ºä¸¤ä¸ªè´¦å·ç”Ÿæˆå¯†é’¥ï¼ˆæ–‡ä»¶åéœ€åŒºåˆ†ï¼Œæ¯”å¦‚ <code>github_rsa_work</code>ï¼ˆå·¥ä½œï¼‰ã€<code>github_rsa_personal</code>ï¼ˆä¸ªäººï¼‰ï¼‰ã€‚</p>
<h4 data-id="heading-4">å‘½ä»¤æ ¼å¼</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ç”Ÿæˆå·¥ä½œè´¦å·å¯†é’¥ï¼ˆæ›¿æ¢ä¸ºå·¥ä½œè´¦å·é‚®ç®±ï¼‰</span>
ssh-keygen -t ed25519 -C <span class="hljs-string">"work@example.com"</span> -f <span class="hljs-variable">$HOME</span>/.ssh/github_rsa_work

<span class="hljs-comment"># ç”Ÿæˆä¸ªäººè´¦å·å¯†é’¥ï¼ˆæ›¿æ¢ä¸ºä¸ªäººè´¦å·é‚®ç®±ï¼‰</span>
ssh-keygen -t ed25519 -C <span class="hljs-string">"personal@example.com"</span> -f <span class="hljs-variable">$HOME</span>/.ssh/github_rsa_personal
</code></pre>
<h4 data-id="heading-5">æ‰§è¡Œäº¤äº’</h4>
<p>å‘½ä»¤æ‰§è¡Œåä¼šæç¤ºè¾“å…¥ â€œå¯†ç çŸ­è¯­ï¼ˆpassphraseï¼‰â€ï¼Œå»ºè®®ç›´æ¥æŒ‰å›è½¦ç•™ç©ºï¼ˆæ–¹ä¾¿æ—¥å¸¸ä½¿ç”¨ï¼›è‹¥è®¾ç½®å¯†ç ï¼Œæ¯æ¬¡æ‹‰ / æ¨ä»£ç éœ€éªŒè¯ï¼‰ï¼š</p>
<p>plaintext</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">Enter</span> <span class="hljs-string">passphrase</span> <span class="hljs-string">(empty</span> <span class="hljs-string">for</span> <span class="hljs-literal">no</span> <span class="hljs-string">passphrase):</span>  <span class="hljs-comment"># å›è½¦</span>
<span class="hljs-attr">Enter same passphrase again:</span>  <span class="hljs-comment"># å†æ¬¡å›è½¦</span>
</code></pre>
<h4 data-id="heading-6">éªŒè¯ç”Ÿæˆç»“æœ</h4>
<p>æ‰§è¡Œåä¼šåœ¨ <code>~/.ssh</code> ç›®å½•ä¸‹ç”Ÿæˆ 4 ä¸ªæ–‡ä»¶ï¼š</p>
<ul>
<li>å·¥ä½œè´¦å·ï¼š<code>github_rsa_work</code>ï¼ˆç§é’¥ï¼‰ã€<code>github_rsa_work.pub</code>ï¼ˆå…¬é’¥ï¼‰ï¼›</li>
<li>ä¸ªäººè´¦å·ï¼š<code>github_rsa_personal</code>ï¼ˆç§é’¥ï¼‰ã€<code>github_rsa_personal.pub</code>ï¼ˆå…¬é’¥ï¼‰ã€‚</li>
</ul>
<h3 data-id="heading-7">æ­¥éª¤ 2ï¼šå°†å…¬é’¥åˆ†åˆ«æ·»åŠ åˆ°å¯¹åº” GitHub è´¦å·</h3>
<p>SSH å¯†é’¥åˆ† â€œå…¬é’¥â€ å’Œ â€œç§é’¥â€ï¼Œéœ€å°†å…¬é’¥ä¸Šä¼ åˆ° GitHub è´¦å·ï¼Œç§é’¥ä¿å­˜åœ¨æœ¬åœ°ã€‚</p>
<h4 data-id="heading-8">1. å¤åˆ¶å…¬é’¥å†…å®¹</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># å¤åˆ¶å·¥ä½œè´¦å·å…¬é’¥ï¼ˆWindows ç”¨ type æ›¿ä»£ catï¼‰</span>
<span class="hljs-built_in">cat</span> ~/.ssh/github_rsa_work.pub

<span class="hljs-comment"># å¤åˆ¶ä¸ªäººè´¦å·å…¬é’¥</span>
<span class="hljs-built_in">cat</span> ~/.ssh/github_rsa_personal.pub
</code></pre>
<p>å¤åˆ¶ç»ˆç«¯è¾“å‡ºçš„å®Œæ•´å†…å®¹ï¼ˆä»¥ <code>ssh-ed25519</code> å¼€å¤´ï¼Œé‚®ç®±ç»“å°¾ï¼‰ã€‚</p>
<h4 data-id="heading-9">2. ä¸Šä¼ å…¬é’¥åˆ° GitHub</h4>
<p>ä»¥å·¥ä½œè´¦å·ä¸ºä¾‹ï¼Œæ“ä½œæµç¨‹ï¼š</p>
<ol>
<li>ç™»å½•å·¥ä½œ GitHub è´¦å· â†’ ç‚¹å‡»å³ä¸Šè§’å¤´åƒ â†’ <code>Settings</code>ï¼›</li>
<li>å·¦ä¾§èœå•é€‰æ‹© <code>SSH and GPG keys</code> â†’ ç‚¹å‡» <code>New SSH key</code>ï¼›</li>
<li><code>Title</code>ï¼šå¡«å¤‡æ³¨ï¼ˆå¦‚ <code>Mac-work-github</code>ï¼‰ï¼Œä¾¿äºè¯†åˆ«ï¼›</li>
<li><code>Key</code>ï¼šç²˜è´´å¤åˆ¶çš„å…¬é’¥å†…å®¹ â†’ ç‚¹å‡» <code>Add SSH key</code>ï¼›</li>
<li>é‡å¤ä¸Šè¿°æ­¥éª¤ï¼Œå°†ä¸ªäººè´¦å·çš„å…¬é’¥ä¸Šä¼ åˆ°ä¸ªäºº GitHub è´¦å·ã€‚</li>
</ol>
<h3 data-id="heading-10">æ­¥éª¤ 3ï¼šé…ç½® SSH config æ–‡ä»¶ï¼ˆæ ¸å¿ƒï¼‰</h3>
<p><code>config</code> æ–‡ä»¶æ˜¯ Git è¯†åˆ«ä¸åŒè´¦å·å¯†é’¥çš„ â€œè§„åˆ™è¡¨â€ï¼Œéœ€åœ¨ <code>.ssh</code> ç›®å½•ä¸‹åˆ›å»º / ç¼–è¾‘è¯¥æ–‡ä»¶ã€‚</p>
<h4 data-id="heading-11">1. æ‰“å¼€ config æ–‡ä»¶</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># Windows/macOS/Linux é€šç”¨ï¼ˆæ— æ–‡ä»¶åˆ™æ–°å»ºï¼‰</span>
vim ~/.ssh/config
</code></pre>
<h4 data-id="heading-12">2. å†™å…¥é…ç½®å†…å®¹</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># å·¥ä½œ GitHub è´¦å·é…ç½®</span>
Host github-work  <span class="hljs-comment"># è‡ªå®šä¹‰åˆ«åï¼ˆå¯ä»»æ„å‘½åï¼Œå¦‚ github-workï¼‰</span>
    HostName github.com  <span class="hljs-comment"># å›ºå®šä¸º github.comï¼Œä¸å¯æ”¹</span>
    User git  <span class="hljs-comment"># å›ºå®šä¸º gitï¼Œä¸æ˜¯ä½ çš„ GitHub ç”¨æˆ·å</span>
    IdentityFile ~/.ssh/github_rsa_work  <span class="hljs-comment"># ç»‘å®šå·¥ä½œè´¦å·ç§é’¥</span>
    PreferredAuthentications publickey

<span class="hljs-comment"># ä¸ªäºº GitHub è´¦å·é…ç½®</span>
Host github-personal  <span class="hljs-comment"># è‡ªå®šä¹‰åˆ«åï¼ˆå¦‚ github-personalï¼‰</span>
    HostName github.com
    User git
    IdentityFile ~/.ssh/github_rsa_personal  <span class="hljs-comment"># ç»‘å®šä¸ªäººè´¦å·ç§é’¥</span>
    PreferredAuthentications publickey
</code></pre>
<h4 data-id="heading-13">3. ä¿å­˜å¹¶è®¾ç½®æƒé™</h4>
<ul>
<li>
<p>vim ä¸­æŒ‰ <code>Esc</code> â†’ è¾“å…¥ <code>:wq</code> â†’ å›è½¦ä¿å­˜ï¼›</p>
</li>
<li>
<p>è®¾ç½®æ–‡ä»¶æƒé™ï¼ˆé¿å… SSH è®¤è¯å¤±è´¥ï¼ŒmacOS/Linux å¿…åšï¼ŒWindows å¯é€‰ï¼‰ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># è®¾ç½® config æ–‡ä»¶æƒé™</span>
<span class="hljs-built_in">chmod</span> 600 ~/.ssh/config
<span class="hljs-comment"># è®¾ç½®ç§é’¥æƒé™</span>
<span class="hljs-built_in">chmod</span> 600 ~/.ssh/github_rsa_work
<span class="hljs-built_in">chmod</span> 600 ~/.ssh/github_rsa_personal
</code></pre>
</li>
</ul>
<h3 data-id="heading-14">æ­¥éª¤ 4ï¼šæµ‹è¯• SSH è¿æ¥</h3>
<p>éªŒè¯æ¯ä¸ªè´¦å·æ˜¯å¦èƒ½æ­£å¸¸è®¤è¯ï¼š</p>
<pre><code class="hljs language-perl" lang="perl"><span class="hljs-comment"># æµ‹è¯•å·¥ä½œè´¦å·</span>
ssh -T git@github-work

<span class="hljs-comment"># æµ‹è¯•ä¸ªäººè´¦å·</span>
ssh -T git@github-personal
</code></pre>
<p>è‹¥è¿”å› <code>Hi [ä½ çš„è´¦å·å]! You've successfully authenticated...</code>ï¼Œè¯´æ˜é…ç½®ç”Ÿæ•ˆã€‚</p>
<h2 data-id="heading-15">å››ã€æ‹‰å–å¯¹åº”è´¦å·çš„ä»£ç ï¼ˆå®æ“ï¼‰</h2>
<p>é…ç½®å®Œæˆåï¼Œæ‹‰å–ä»£ç çš„æ ¸å¿ƒæ˜¯<strong>ç”¨è‡ªå®šä¹‰åˆ«åæ›¿æ¢ä»“åº“åœ°å€ä¸­çš„ <code>github.com</code></strong>ã€‚</p>
<h3 data-id="heading-16">åœºæ™¯ 1ï¼šå…‹éš†æ–°ä»“åº“</h3>
<h4 data-id="heading-17">1. å¤åˆ¶ä»“åº“ SSH åœ°å€</h4>
<p>ç™»å½•å¯¹åº” GitHub è´¦å· â†’ æ‰“å¼€ä»“åº“ â†’ ç‚¹å‡» <code>Code</code> â†’ <code>SSH</code> â†’ å¤åˆ¶åœ°å€ï¼ˆå¦‚ <code>git@github.com:work-account/project.git</code>ï¼‰ã€‚</p>
<h4 data-id="heading-18">2. æ›¿æ¢åˆ«åå¹¶å…‹éš†</h4>
<ul>
<li>
<p>å·¥ä½œä»“åº“ï¼šå°† <code>github.com</code> æ›¿æ¢ä¸º <code>github-work</code></p>
<pre><code class="hljs language-bash" lang="bash">git <span class="hljs-built_in">clone</span> git@github-work:work-account/project.git
</code></pre>
</li>
<li>
<p>ä¸ªäººä»“åº“ï¼šå°† <code>github.com</code> æ›¿æ¢ä¸º <code>github-personal</code></p>
<pre><code class="hljs language-bash" lang="bash">git <span class="hljs-built_in">clone</span> git@github-personal:personal-account/notes.git
</code></pre>
</li>
</ul>
<h3 data-id="heading-19">åœºæ™¯ 2ï¼šä¿®æ”¹å·²å…‹éš†ä»“åº“çš„è¿œç¨‹åœ°å€</h3>
<p>è‹¥ä»“åº“å·²å…‹éš†ï¼ˆé»˜è®¤ç”¨ <code>github.com</code> åœ°å€ï¼‰ï¼Œéœ€ä¿®æ”¹è¿œç¨‹åœ°å€åŒ¹é…å¯¹åº”è´¦å·ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># è¿›å…¥ä»“åº“ç›®å½•</span>
<span class="hljs-built_in">cd</span> project
<span class="hljs-comment"># ä¿®æ”¹ä¸ºå·¥ä½œè´¦å·åœ°å€</span>
git remote set-url origin git@github-work:work-account/project.git
</code></pre>
<h3 data-id="heading-20">è¡¥å……ï¼šè®¾ç½®æäº¤èº«ä»½ï¼ˆé¿å…ä¿¡æ¯æ··æ·†ï¼‰</h3>
<p>SSH è§£å†³ â€œè®¤è¯â€ é—®é¢˜ï¼Œè€Œæäº¤ä»£ç çš„èº«ä»½ç”± <code>user.name</code>/<code>user.email</code> å†³å®šï¼Œéœ€ä¸ºæ¯ä¸ªä»“åº“å•ç‹¬è®¾ç½®ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino"># è¿›å…¥å·¥ä½œä»“åº“ï¼Œè®¾ç½®å·¥ä½œè´¦å·ä¿¡æ¯
git config user.name <span class="hljs-string">"WorkName"</span>
git config user.email <span class="hljs-string">"work@example.com"</span>

# è¿›å…¥ä¸ªäººä»“åº“ï¼Œè®¾ç½®ä¸ªäººè´¦å·ä¿¡æ¯
git config user.name <span class="hljs-string">"PersonalName"</span>
git config user.email <span class="hljs-string">"personal@example.com"</span>
</code></pre>
<p>âš ï¸ ä¸è¦ç”¨ <code>git config --global</code> å…¨å±€è®¾ç½®ï¼Œå¦åˆ™ä¼šå¯¼è‡´æ‰€æœ‰ä»“åº“æäº¤ä¿¡æ¯æ··ä¹±ã€‚</p>
<h2 data-id="heading-21">äº”ã€å¸¸è§é—®é¢˜æ’æŸ¥</h2>
<ol>
<li>
<p><strong>Permission denied (publickey)</strong> ï¼š</p>
<ul>
<li>æ£€æŸ¥ <code>config</code> æ–‡ä»¶ä¸­ç§é’¥è·¯å¾„æ˜¯å¦æ­£ç¡®ï¼›</li>
<li>ç¡®è®¤å…¬é’¥å·²ä¸Šä¼ åˆ°å¯¹åº” GitHub è´¦å·ï¼›</li>
<li>éªŒè¯ç§é’¥ /<code>config</code> æ–‡ä»¶æƒé™æ˜¯å¦ä¸º 600ï¼ˆmacOS/Linuxï¼‰ã€‚</li>
</ul>
</li>
<li>
<p><strong>æ‹‰å–ä»£ç æ—¶æç¤º â€œä»“åº“ä¸å­˜åœ¨â€</strong> ï¼š</p>
<ul>
<li>æ£€æŸ¥åˆ«åæ˜¯å¦æ­£ç¡®ï¼ˆå¦‚æŠŠ <code>github-work</code> å†™æˆ <code>github-work1</code>ï¼‰ï¼›</li>
<li>ç¡®è®¤ä»“åº“åœ°å€ä¸­çš„è´¦å·åã€é¡¹ç›®åæ— è¯¯ã€‚</li>
</ul>
</li>
<li>
<p><strong>æäº¤ä»£ç åèº«ä»½é”™è¯¯</strong>ï¼š</p>
<ul>
<li>æœªä¸ºä»“åº“å•ç‹¬è®¾ç½® <code>user.name</code>/<code>user.email</code>ï¼Œéœ€è¡¥å……è®¾ç½®ã€‚</li>
</ul>
</li>
</ol>
<h2 data-id="heading-22">å…­ã€æ‰©å±•ï¼šæ·»åŠ æ›´å¤š GitHub è´¦å·</h2>
<p>è‹¥éœ€é…ç½®ç¬¬ä¸‰ä¸ªåŠä»¥ä¸Šè´¦å·ï¼Œåªéœ€é‡å¤ä»¥ä¸‹æ­¥éª¤ï¼š</p>
<ol>
<li>ç”Ÿæˆæ–°å¯†é’¥ï¼š<code>ssh-keygen -t ed25519 -C "new@example.com" -f ~/.ssh/github_rsa_new</code>ï¼›</li>
<li>ä¸Šä¼ æ–°å…¬é’¥åˆ°å¯¹åº” GitHub è´¦å·ï¼›</li>
<li>åœ¨ <code>config</code> æ–‡ä»¶ä¸­æ–°å¢ä¸€æ®µé…ç½®ï¼ˆè‡ªå®šä¹‰æ–°åˆ«åï¼Œç»‘å®šæ–°ç§é’¥ï¼‰ï¼›</li>
<li>æ‹‰å–ä»£ç æ—¶ç”¨æ–°åˆ«åæ›¿æ¢ <code>github.com</code>ã€‚</li>
</ol>
<h2 data-id="heading-23">æ€»ç»“</h2>
<ol>
<li>å¤š GitHub è´¦å·é…ç½®çš„æ ¸å¿ƒæ˜¯ â€œç‹¬ç«‹å¯†é’¥ + config åˆ«åç»‘å®šâ€ï¼›</li>
<li>æ‹‰å–ä»£ç çš„å…³é”®æ˜¯ç”¨è‡ªå®šä¹‰åˆ«åæ›¿ä»£ <code>github.com</code>ï¼›</li>
<li>æäº¤ä»£ç æ—¶éœ€ä¸ºä»“åº“å•ç‹¬è®¾ç½® <code>user.name</code>/<code>user.email</code>ï¼Œé¿å…èº«ä»½æ··æ·†ã€‚é€šè¿‡ä»¥ä¸Šé…ç½®ï¼Œå•å°ç”µè„‘å¯æ— ç¼åˆ‡æ¢å¤šä¸ª GitHub è´¦å·ï¼Œæ—¢ä¿è¯äº†æƒé™éš”ç¦»ï¼Œåˆèƒ½é«˜æ•ˆç®¡ç†ä¸åŒè´¦å·çš„ä»£ç ä»“åº“ã€‚</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[0210_1 SFC SPI/QSPI æ¨¡å¼æ·±åº¦åˆ†æ]]></title>    <link>https://juejin.cn/post/7604697194794565642</link>    <guid>https://juejin.cn/post/7604697194794565642</guid>    <pubDate>2026-02-09T17:29:50.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604697194794565642" data-draft-id="7604690250363682825" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="0210_1  SFC SPI/QSPI æ¨¡å¼æ·±åº¦åˆ†æ"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2026-02-09T17:29:50.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ly77777"/> <meta itemprop="url" content="https://juejin.cn/user/3775071381890170"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            0210_1  SFC SPI/QSPI æ¨¡å¼æ·±åº¦åˆ†æ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3775071381890170/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ly77777
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-09T17:29:50.000Z" title="Mon Feb 09 2026 17:29:50 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    11
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»31åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">FBB_WS63 SFC SPI/QSPI æ¨¡å¼æ·±åº¦åˆ†æ</h2>
<h3 data-id="heading-1">ğŸ“‹ ç›®å½•</h3>
<ol>
<li><a href="#spi-vs-qspi-%E6%A8%A1%E5%BC%8F%E5%AF%B9%E6%AF%94" title="#spi-vs-qspi-%E6%A8%A1%E5%BC%8F%E5%AF%B9%E6%AF%94">SPI vs QSPI æ¨¡å¼å¯¹æ¯”</a></li>
<li><a href="#gpio-pin-%E6%98%A0%E5%B0%84" title="#gpio-pin-%E6%98%A0%E5%B0%84">GPIO Pin æ˜ å°„</a></li>
<li><a href="#%E7%BC%96%E8%AF%91%E9%85%8D%E7%BD%AE%E5%BC%80%E5%85%B3" title="#%E7%BC%96%E8%AF%91%E9%85%8D%E7%BD%AE%E5%BC%80%E5%85%B3">ç¼–è¯‘é…ç½®å¼€å…³</a></li>
<li><a href="#gpio-%E9%87%8D%E6%96%B0%E5%B8%83%E7%BA%BF%E4%BF%AE%E6%94%B9%E6%B8%85%E5%8D%95" title="#gpio-%E9%87%8D%E6%96%B0%E5%B8%83%E7%BA%BF%E4%BF%AE%E6%94%B9%E6%B8%85%E5%8D%95">GPIO é‡æ–°å¸ƒçº¿ä¿®æ”¹æ¸…å•</a></li>
<li><a href="#%E4%BB%A3%E7%A0%81%E8%B7%AF%E5%BE%84%E6%B1%87%E6%80%BB" title="#%E4%BB%A3%E7%A0%81%E8%B7%AF%E5%BE%84%E6%B1%87%E6%80%BB">ä»£ç è·¯å¾„æ±‡æ€»</a></li>
</ol>
<hr/>
<h3 data-id="heading-2">1ï¸âƒ£ SPI vs QSPI æ¨¡å¼å¯¹æ¯”</h3>
<h4 data-id="heading-3">ğŸ“Š æ¨¡å¼æ¦‚è§ˆ</h4>








































<table><thead><tr><th>ç‰¹æ€§</th><th>SPI æ¨¡å¼</th><th>QSPI æ¨¡å¼</th></tr></thead><tbody><tr><td><strong>é€šè®¯æ¨¡å¼</strong></td><td>æ ‡å‡† SPI</td><td>å››çº¿ SPI</td></tr><tr><td><strong>GPIO pin æ•°é‡</strong></td><td>4 æ¡</td><td>6 æ¡</td></tr><tr><td><strong>æ•°æ®çº¿</strong></td><td>MOSI(1çº¿) + MISO(1çº¿)</td><td>IO0 + IO1 + IO2 + IO3(4çº¿)</td></tr><tr><td><strong>ä¼ è¾“é€Ÿåº¦</strong></td><td>æ­£å¸¸</td><td>4x æ›´å¿«</td></tr><tr><td><strong>åº”ç”¨åœºæ™¯</strong></td><td>é€šç”¨ Flash</td><td>é«˜é€Ÿ Flashã€å­˜å‚¨å™¨</td></tr><tr><td><strong>Flash æ”¯æŒ</strong></td><td>æ‰€æœ‰ç°ä»£ Flash</td><td>å¤§å¤šæ•°æ–°å‹ Flash</td></tr></tbody></table>
<h4 data-id="heading-4">ğŸ”Œ ä¸¤ç§æ¨¡å¼çš„ GPIO éœ€æ±‚å¯¹æ¯”</h4>
<h5 data-id="heading-5">SPI æ¨¡å¼ï¼ˆæ ‡å‡†4çº¿ï¼‰</h5>
<pre><code class="hljs language-scss" lang="scss">â”Œâ”€â”€â”€ SFC ç¡¬ä»¶æ¨¡å— â”€â”€â”€â”
â”‚ WS63 SFC æ§åˆ¶å™¨    â”‚
â”‚ (<span class="hljs-number">0</span>x48000000)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â”œâ”€â†’ GPIO_19 (SFC_CLK)    - æ—¶é’Ÿä¿¡å·ï¼ŒCLK
        â”œâ”€â†’ GPIO_20 (SFC_CSN)    - ç‰‡é€‰ä¿¡å·ï¼ŒCSï¼ˆä½æœ‰æ•ˆï¼‰
        â”œâ”€â†’ GPIO_21 (SFC_IO0)    - æ•°æ®çº¿ <span class="hljs-number">0</span>ï¼ŒMOSIï¼ˆMaster Outï¼‰
        â””â”€â†’ GPIO_22 (SFC_IO1)    - æ•°æ®çº¿ <span class="hljs-number">1</span>ï¼ŒMISOï¼ˆMaster Inï¼‰
</code></pre>
<h5 data-id="heading-6">QSPI æ¨¡å¼ï¼ˆå››çº¿å¢å¼ºï¼‰</h5>
<pre><code class="hljs language-scss" lang="scss">â”Œâ”€â”€â”€ SFC ç¡¬ä»¶æ¨¡å— â”€â”€â”€â”
â”‚ WS63 SFC æ§åˆ¶å™¨    â”‚
â”‚ (<span class="hljs-number">0</span>x48000000)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â”œâ”€â†’ GPIO_19 (SFC_CLK)    - æ—¶é’Ÿä¿¡å·
        â”œâ”€â†’ GPIO_20 (SFC_CSN)    - ç‰‡é€‰ä¿¡å·
        â”œâ”€â†’ GPIO_21 (SFC_IO0)    - æ•°æ®çº¿ <span class="hljs-number">0</span>ï¼ŒMOSI
        â”œâ”€â†’ GPIO_22 (SFC_IO1)    - æ•°æ®çº¿ <span class="hljs-number">1</span>ï¼ŒMISO
        â”œâ”€â†’ GPIO_23 (SFC_IO2)    - æ•°æ®çº¿ <span class="hljs-number">2</span>ï¼ŒWPï¼ˆå†™ä¿æŠ¤ï¼Œä½æœ‰æ•ˆï¼‰
        â””â”€â†’ GPIO_24 (SFC_IO3)    - æ•°æ®çº¿ <span class="hljs-number">3</span>ï¼ŒHOLDï¼ˆä¿æŒï¼Œä½æœ‰æ•ˆï¼‰
</code></pre>
<h4 data-id="heading-7">ğŸ“Œ å…³é”®å·®å¼‚è¯´æ˜</h4>





















































<table><thead><tr><th>é¡¹ç›®</th><th>SPI æ¨¡å¼</th><th>QSPI æ¨¡å¼</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>CLK</strong></td><td>GPIO_19</td><td>GPIO_19</td><td>å§‹ç»ˆéœ€è¦ï¼ˆç¡¬å›ºå®šï¼‰</td></tr><tr><td><strong>CSN</strong></td><td>GPIO_20</td><td>GPIO_20</td><td>å§‹ç»ˆéœ€è¦ï¼ˆç¡¬å›ºå®šï¼‰</td></tr><tr><td><strong>MOSI(IO0)</strong></td><td>GPIO_21</td><td>GPIO_21</td><td>å§‹ç»ˆéœ€è¦ï¼ˆç¡¬å›ºå®šï¼‰</td></tr><tr><td><strong>MISO(IO1)</strong></td><td>GPIO_22</td><td>GPIO_22</td><td>å§‹ç»ˆéœ€è¦ï¼ˆç¡¬å›ºå®šï¼‰</td></tr><tr><td><strong>WP(IO2)</strong></td><td>âŒ ä¸éœ€è¦</td><td>GPIO_23</td><td>âš ï¸ QSPI å¿…éœ€</td></tr><tr><td><strong>HOLD(IO3)</strong></td><td>âŒ ä¸éœ€è¦</td><td>GPIO_24</td><td>âš ï¸ QSPI å¿…éœ€</td></tr><tr><td><strong>æ€» Pin æ•°</strong></td><td><strong>4</strong></td><td><strong>6</strong></td><td>+2 pin</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-8">2ï¸âƒ£ GPIO Pin æ˜ å°„</h3>
<h4 data-id="heading-9">ğŸ¯ GPIO Pin å®šä¹‰ä½ç½®</h4>
<h5 data-id="heading-10"><strong>æ–‡ä»¶ 1</strong>ï¼š<a href="https://link.juejin.cn?target=src%2Fdrivers%2Fchips%2Fws63%2Finclude%2Fplatform_core_rom.h" target="_blank" title="src/drivers/chips/ws63/include/platform_core_rom.h" ref="nofollow noopener noreferrer">src/drivers/chips/ws63/include/platform_core_rom.h</a></h5>
<p><strong>ä½ç½®</strong>ï¼šç¬¬ 50-54 è¡Œ</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">enum</span> {</span>
    GPIO_00 = <span class="hljs-number">0</span>,
    <span class="hljs-comment">// ... GPIO_01 åˆ° GPIO_18 ...</span>
    GPIO_18 = <span class="hljs-number">18</span>,
    SFC_CLK = <span class="hljs-number">19</span>,      <span class="hljs-comment">// âœ… Flash æ—¶é’Ÿ</span>
    SFC_CSN = <span class="hljs-number">20</span>,      <span class="hljs-comment">// âœ… ç‰‡é€‰ï¼ˆCS#ï¼‰</span>
    SFC_IO0 = <span class="hljs-number">21</span>,      <span class="hljs-comment">// âœ… MOSI æ•°æ®çº¿ 0</span>
    SFC_IO1 = <span class="hljs-number">22</span>,      <span class="hljs-comment">// âœ… MISO æ•°æ®çº¿ 1</span>
    SFC_IO2 = <span class="hljs-number">23</span>,      <span class="hljs-comment">// âš ï¸  æ•°æ®çº¿ 2ï¼ˆWPï¼Œä»… QSPIï¼‰</span>
    SFC_IO3 = <span class="hljs-number">24</span>,      <span class="hljs-comment">// âš ï¸  æ•°æ®çº¿ 3ï¼ˆHOLDï¼Œä»… QSPIï¼‰</span>
    PIN_NONE = <span class="hljs-number">25</span>,
} <span class="hljs-type">pin_t</span>;
</code></pre>
<p><strong>è¯´æ˜</strong>ï¼š</p>
<ul>
<li>è¿™äº›æ˜¯ <strong>enum æšä¸¾å®šä¹‰</strong>ï¼Œæ˜ å°„åˆ°å…·ä½“çš„ GPIO å·ï¼ˆ19-24ï¼‰</li>
<li>GPIO_19-22 æ˜¯ç¡¬ä»¶å›ºå®šåˆ†é…çš„ SFC å¼•è„š</li>
<li>GPIO_23-24 æ˜¯å¯é€‰çš„ QSPI æ‰©å±•å¼•è„š</li>
<li><strong>è¿™æ˜¯ç¡¬ä»¶çº§åˆ«çš„å›ºå®šè¿æ¥</strong>ï¼Œä¸èƒ½æ”¹å˜</li>
</ul>
<hr/>
<h5 data-id="heading-11"><strong>æ–‡ä»¶ 2</strong>ï¼š<a href="https://link.juejin.cn?target=src%2Fdrivers%2Fchips%2Fws63%2Fporting%2Fsoc%2Fsoc_porting.c" target="_blank" title="src/drivers/chips/ws63/porting/soc/soc_porting.c" ref="nofollow noopener noreferrer">src/drivers/chips/ws63/porting/soc/soc_porting.c</a></h5>
<p><strong>ä½ç½®</strong>ï¼šç¬¬ 64-79 è¡Œ</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// PAD å¯„å­˜å™¨åœ°å€ï¼ˆç¡¬ä»¶ Pad Controlï¼‰</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> PAD_SFC_CLK_CTRL  0x4400d868    <span class="hljs-comment">// GPIO_19 çš„ Pad æ§åˆ¶å¯„å­˜å™¨</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> PAD_SFC_CSN_CTRL  0x4400d86C    <span class="hljs-comment">// GPIO_20 çš„ Pad æ§åˆ¶å¯„å­˜å™¨</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> PAD_SFC_IO0_CTRL  0x4400d870    <span class="hljs-comment">// GPIO_21 çš„ Pad æ§åˆ¶å¯„å­˜å™¨</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> PAD_SFC_IO1_CTRL  0x4400d874    <span class="hljs-comment">// GPIO_22 çš„ Pad æ§åˆ¶å¯„å­˜å™¨</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> PAD_SFC_IO2_CTRL  0x4400d878    <span class="hljs-comment">// GPIO_23 çš„ Pad æ§åˆ¶å¯„å­˜å™¨ï¼ˆQSPIï¼‰</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> PAD_SFC_IO3_CTRL  0x4400d87C    <span class="hljs-comment">// GPIO_24 çš„ Pad æ§åˆ¶å¯„å­˜å™¨ï¼ˆQSPIï¼‰</span></span>

<span class="hljs-comment">// é©±åŠ¨å¼ºåº¦ (Drive Strength) è®¾ç½®</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> SFC_CLK_DS_VALUE      0x3       <span class="hljs-comment">// CLK é©±åŠ¨å¼ºåº¦</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> SFC_CSN_DS_VALUE      0x2       <span class="hljs-comment">// CSN é©±åŠ¨å¼ºåº¦</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> SFC_DATA_DS_VALUE     0x2       <span class="hljs-comment">// æ•°æ®çº¿é©±åŠ¨å¼ºåº¦</span></span>

<span class="hljs-type">void</span> <span class="hljs-title function_">config_sfc_ctrl_ds</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span>
{
    reg_setbits(PAD_SFC_CLK_CTRL, <span class="hljs-number">0</span>, POS_4, DTRL_DS_LEN, SFC_CLK_DS_VALUE);
    reg_setbits(PAD_SFC_CSN_CTRL, <span class="hljs-number">0</span>, POS_4, DTRL_DS_LEN, SFC_CSN_DS_VALUE);
    reg_setbits(PAD_SFC_IO0_CTRL, <span class="hljs-number">0</span>, POS_4, DTRL_DS_LEN, SFC_DATA_DS_VALUE);
    reg_setbits(PAD_SFC_IO1_CTRL, <span class="hljs-number">0</span>, POS_4, DTRL_DS_LEN, SFC_DATA_DS_VALUE);
    reg_setbits(PAD_SFC_IO2_CTRL, <span class="hljs-number">0</span>, POS_4, DTRL_DS_LEN, SFC_DATA_DS_VALUE);
    reg_setbits(PAD_SFC_IO3_CTRL, <span class="hljs-number">0</span>, POS_4, DTRL_DS_LEN, SFC_DATA_DS_VALUE);
}
</code></pre>
<p><strong>è¯´æ˜</strong>ï¼š</p>
<ul>
<li>è¿™æ˜¯èŠ¯ç‰‡ Pad æ§åˆ¶çš„ç¡¬ä»¶å¯„å­˜å™¨åœ°å€</li>
<li>é…ç½®äº†æ¯æ¡çº¿çš„é©±åŠ¨å¼ºåº¦ï¼ˆDrive Strengthï¼‰</li>
<li>è¿™äº›åœ°å€æ˜¯èŠ¯ç‰‡çº§åˆ«çš„å›ºå®šå€¼ï¼ˆSOC çº§åˆ«ï¼‰</li>
<li><strong>ä¸å»ºè®®ä¿®æ”¹è¿™äº›åœ°å€</strong>ï¼Œé™¤éç¡¬ä»¶é‡æ–°è®¾è®¡</li>
</ul>
<hr/>
<h5 data-id="heading-12"><strong>æ–‡ä»¶ 3</strong>ï¼š<a href="https://link.juejin.cn?target=src%2Fdrivers%2Fdrivers%2Fhal%2Fpinmux%2Fws63%2Fhal_pinctrl_ws63.c" target="_blank" title="src/drivers/drivers/hal/pinmux/ws63/hal_pinctrl_ws63.c" ref="nofollow noopener noreferrer">src/drivers/drivers/hal/pinmux/ws63/hal_pinctrl_ws63.c</a></h5>
<p><strong>ä½ç½®</strong>ï¼šç¬¬ 20-27 è¡Œï¼ˆåŸºåœ°å€å®šä¹‰ï¼‰ã€ç¬¬ 109-140 è¡Œï¼ˆpin é…ç½®ç»„ï¼‰</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">define</span> HAL_IO_CFG_BASE_ADDR            0x4400D000</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> HAL_PIN_GPIO_SEL_START_OFFSET   0x000</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> HAL_PIN_UART_SEL_START_OFFSET   0x03C</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> HAL_PIN_GPIO_CTRL_START_OFFSET  0x800</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> HAL_PIN_SFC_CTRL_START_OFFSET   0x868  <span class="hljs-comment">// âœ… SFC pin æ§åˆ¶èµ·å§‹åœ°å€</span></span>

<span class="hljs-meta">#<span class="hljs-keyword">define</span> HAL_PIN_GPIO_SEL_START_ADDR     (HAL_IO_CFG_BASE_ADDR + HAL_PIN_GPIO_SEL_START_OFFSET)</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> HAL_PIN_UART_SEL_START_ADDR     (HAL_IO_CFG_BASE_ADDR + HAL_PIN_UART_SEL_START_OFFSET)</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> HAL_PIN_GPIO_CTRL_START_ADDR    (HAL_IO_CFG_BASE_ADDR + HAL_PIN_GPIO_CTRL_START_OFFSET)</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> HAL_PIN_SFC_CTRL_START_ADDR     (HAL_IO_CFG_BASE_ADDR + HAL_PIN_SFC_CTRL_START_OFFSET)</span>
</code></pre>
<p><strong>Pin é…ç½®ç»„ï¼ˆç¬¬ 109-140 è¡Œï¼‰</strong>ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-type">static</span> <span class="hljs-type">hal_pin_config_group_t</span> <span class="hljs-type">const</span> g_pin_pull_map[] = {
    {
        GPIO_00,
        GPIO_14,
        HAL_PIN_GPIO_CTRL_START_ADDR,
        <span class="hljs-comment">// ... GPIO_00~14 çš„ä¸Šæ‹‰/ä¸‹æ‹‰é…ç½® ...</span>
    },
    {
        SFC_CLK,                          <span class="hljs-comment">// GPIO_19</span>
        SFC_IO3,                          <span class="hljs-comment">// GPIO_24</span>
        HAL_PIN_SFC_CTRL_START_ADDR,      <span class="hljs-comment">// 0x4400D868</span>
        HAL_PIN_CONFIG_PER_NUM,
        HAL_PIN_PULL_START_BIT,
        HAL_PIN_PULL_BITS_NUM
    }
};

<span class="hljs-type">static</span> <span class="hljs-type">hal_pin_config_group_t</span> <span class="hljs-type">const</span> g_pin_ds_map[] = {
    {
        GPIO_00,
        GPIO_14,
        HAL_PIN_GPIO_CTRL_START_ADDR,
        <span class="hljs-comment">// ... GPIO_00~14 çš„é©±åŠ¨å¼ºåº¦é…ç½® ...</span>
    },
    {
        SFC_CLK,                          <span class="hljs-comment">// GPIO_19</span>
        SFC_IO3,                          <span class="hljs-comment">// GPIO_24</span>
        HAL_PIN_SFC_CTRL_START_ADDR,      <span class="hljs-comment">// 0x4400D868</span>
        HAL_PIN_CONFIG_PER_NUM,
        HAL_PIN_DS_START_BIT,
        HAL_PIN_DS_BITS_NUM
    }
};

<span class="hljs-comment">// IEï¼ˆè¾“å…¥ä½¿èƒ½ï¼‰é…ç½®</span>
<span class="hljs-type">static</span> <span class="hljs-type">hal_pin_config_group_t</span> <span class="hljs-type">const</span> g_pin_ie_map[] = {
    {
        SFC_CLK,      <span class="hljs-comment">// GPIO_19</span>
        SFC_IO3,      <span class="hljs-comment">// GPIO_24</span>
        HAL_PIN_SFC_CTRL_START_ADDR,
        <span class="hljs-comment">// ...</span>
    }
};

<span class="hljs-comment">// STï¼ˆSchmitt Triggerï¼‰é…ç½®</span>
<span class="hljs-type">static</span> <span class="hljs-type">hal_pin_config_group_t</span> <span class="hljs-type">const</span> g_pin_st_map[] = {
    {
        SFC_CLK,      <span class="hljs-comment">// GPIO_19</span>
        SFC_IO3,      <span class="hljs-comment">// GPIO_24</span>
        HAL_PIN_SFC_CTRL_START_ADDR,
        <span class="hljs-comment">// ...</span>
    }
};
</code></pre>
<p><strong>è¯´æ˜</strong>ï¼š</p>
<ul>
<li>å®šä¹‰äº† SFC çš„ pin æ§åˆ¶å¯„å­˜å™¨åŸºåœ°å€</li>
<li>GPIO_19-24 éƒ½ç»Ÿä¸€åœ¨ <code>HAL_PIN_SFC_CTRL_START_ADDR</code> é…ç½®ç»„ä¸­</li>
<li>é…ç½®é¡¹åŒ…æ‹¬ï¼šä¸Šæ‹‰/ä¸‹æ‹‰ã€é©±åŠ¨å¼ºåº¦ã€è¾“å…¥ä½¿èƒ½ã€æ–½å¯†ç‰¹è§¦å‘å™¨</li>
</ul>
<hr/>
<h4 data-id="heading-13">ğŸ”„ GPIO Pin ä½¿ç”¨æµç¨‹</h4>
<pre><code class="hljs language-scss" lang="scss">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç¡¬å¯åŠ¨/çƒ§å½•ï¼ˆBootLoaderï¼‰                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ <span class="hljs-number">1</span>. SFC ç¡¬ä»¶è‡ªåŠ¨ä½¿ç”¨ GPIO_19-<span class="hljs-number">22</span>ï¼ˆSPI æ¨¡å¼ï¼‰        â”‚
â”‚ <span class="hljs-number">2</span>. soc_porting<span class="hljs-selector-class">.c</span> é…ç½® Pad é©±åŠ¨å¼ºåº¦                 â”‚
â”‚    â””â”€ <span class="hljs-built_in">config_sfc_ctrl_ds</span>()                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åº”ç”¨å¯åŠ¨ï¼ˆAPP é˜¶æ®µï¼‰                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ <span class="hljs-number">1</span>. sfc<span class="hljs-selector-class">.c</span> è°ƒç”¨ <span class="hljs-built_in">hal_sfc_init</span>()                       â”‚
â”‚ <span class="hljs-number">2</span>. hal_pinctrl_ws63<span class="hljs-selector-class">.c</span> é…ç½® pin å±æ€§                â”‚
â”‚    â””â”€ æ‹‰é«˜/æ‹‰ä½ã€é©±åŠ¨å¼ºåº¦ç­‰                       â”‚
â”‚ <span class="hljs-number">3</span>. SFC é©±åŠ¨åˆå§‹åŒ–å®Œæˆ                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<hr/>
<h3 data-id="heading-14">3ï¸âƒ£ ç¼–è¯‘é…ç½®å¼€å…³</h3>
<h4 data-id="heading-15">ğŸ“š Kconfig é…ç½®æ–‡ä»¶ä½ç½®</h4>
<h5 data-id="heading-16"><strong>æ–‡ä»¶ 1</strong>ï¼š<a href="https://link.juejin.cn?target=src%2Fdrivers%2Fdrivers%2FKconfig" target="_blank" title="src/drivers/drivers/Kconfig" ref="nofollow noopener noreferrer">src/drivers/drivers/Kconfig</a></h5>
<p><strong>ä½ç½®</strong>ï¼šç¬¬ 387-403 è¡Œ</p>
<pre><code class="hljs language-kconfig" lang="kconfig">config DRIVER_SUPPORT_SFC
    bool
    prompt "SFC"
    default y
    help
        This option means support SFC.

if DRIVER_SUPPORT_SFC
menu "SFC Configuration"
    comment "Config  SFC"
    osource "drivers/drivers/driver/sfc/Kconfig"
    osource "drivers/drivers/hal/sfc/Kconfig"
endmenu
endif

config DRIVER_SUPPORT_SPI
    bool
    prompt "SPI"
    default n
    help
        This option means support SPI.

if DRIVER_SUPPORT_SPI
menu "SPI Configuration"
    comment "Config SPI"
    osource "drivers/drivers/driver/spi/Kconfig"
    osource "drivers/drivers/hal/spi/Kconfig"
endmenu
endif
</code></pre>
<p><strong>è¯´æ˜</strong>ï¼š</p>
<ul>
<li><code>CONFIG_DRIVER_SUPPORT_SFC</code> - SFC é©±åŠ¨æ€»å¼€å…³ï¼ˆ<strong>é»˜è®¤å¯ç”¨</strong>ï¼‰</li>
<li><code>CONFIG_DRIVER_SUPPORT_SPI</code> - é€šç”¨ SPI é©±åŠ¨æ€»å¼€å…³ï¼ˆ<strong>é»˜è®¤ç¦ç”¨</strong>ï¼‰</li>
<li><strong>å…³é”®ç‚¹</strong>ï¼šSFC å’Œ SPI æ˜¯åˆ†åˆ«çš„é©±åŠ¨ï¼Œä¸ä¼šç›´æ¥å†²çª</li>
</ul>
<hr/>
<h5 data-id="heading-17"><strong>æ–‡ä»¶ 2</strong>ï¼š<a href="https://link.juejin.cn?target=src%2Fdrivers%2Fchips%2Fws63%2From%2Fdrivers%2Fdrivers%2Fdriver%2Fsfc%2FKconfig" target="_blank" title="src/drivers/chips/ws63/rom/drivers/drivers/driver/sfc/Kconfig" ref="nofollow noopener noreferrer">src/drivers/chips/ws63/rom/drivers/drivers/driver/sfc/Kconfig</a></h5>
<p><strong>ä½ç½®</strong>ï¼šå®Œæ•´å†…å®¹</p>
<pre><code class="hljs language-kconfig" lang="kconfig">#===============================================================================
# @brief    Kconfig file.
# Copyright (c) HiSilicon (Shanghai) Technologies Co., Ltd. 2022-2022. All rights reserved.
#===============================================================================
config SFC_SUPPORT_DMA
    bool
    prompt "SFC Support DMA"
    default y
    depends on DRIVER_SUPPORT_SFC

config SFC_ALLOW_ERASE_WRITEBACK
    bool
    prompt "Allows Erase at Any Address, needs 4KB RAM at least"
    default n
    depends on DRIVER_SUPPORT_SFC

config SFC_ALREADY_INIT
    bool
    prompt "SFC has been inited, need not to set reg in init/deinit func."
    default n
    depends on DRIVER_SUPPORT_SFC
</code></pre>
<p><strong>SFC ç›¸å…³é…ç½®</strong>ï¼š</p>





























<table><thead><tr><th>é…ç½®é¡¹</th><th>è¯´æ˜</th><th>é»˜è®¤å€¼</th><th>ç”¨é€”</th></tr></thead><tbody><tr><td><code>CONFIG_SFC_SUPPORT_DMA</code></td><td>å¯ç”¨ DMA ä¼ è¾“</td><td><code>y</code>ï¼ˆå¯ç”¨ï¼‰</td><td>æé«˜ä¼ è¾“é€Ÿåº¦</td></tr><tr><td><code>CONFIG_SFC_ALLOW_ERASE_WRITEBACK</code></td><td>å…è®¸ä»»æ„åœ°å€æ“¦é™¤</td><td><code>n</code>ï¼ˆç¦ç”¨ï¼‰</td><td>éœ€è¦é¢å¤– 4KB RAM</td></tr><tr><td><code>CONFIG_SFC_ALREADY_INIT</code></td><td>Skip åˆå§‹åŒ–</td><td><code>n</code>ï¼ˆç¦ç”¨ï¼‰</td><td>BootLoader å·²åˆå§‹åŒ–æ—¶</td></tr></tbody></table>
<p><strong>âš ï¸ é‡è¦</strong>ï¼š</p>
<ul>
<li><strong>è¿™äº›é…ç½®ä¸­æ²¡æœ‰ QSPI/SPI æ¨¡å¼é€‰æ‹©å¼€å…³</strong></li>
<li><strong>QSPI æ¨¡å¼æ˜¯ç”± Flash èŠ¯ç‰‡æœ¬èº«å†³å®šçš„</strong>ï¼ˆFlash æ”¯æŒ QSPI å°±è‡ªåŠ¨å¯ç”¨ï¼‰</li>
</ul>
<hr/>
<h5 data-id="heading-18"><strong>æ–‡ä»¶ 3</strong>ï¼š<a href="https://link.juejin.cn?target=src%2Fapplication%2Fsamples%2Fperipheral%2Fspi%2FKconfig" target="_blank" title="src/application/samples/peripheral/spi/Kconfig" ref="nofollow noopener noreferrer">src/application/samples/peripheral/spi/Kconfig</a></h5>
<p><strong>ä½ç½®</strong>ï¼šç¬¬ 49-77 è¡Œï¼ˆSPI Master QSPI æ”¯æŒï¼‰</p>
<pre><code class="hljs language-kconfig" lang="kconfig">config SPI_MASTER_SUPPORT_QSPI
    bool
    prompt "SPI master support QSPI."
    depends on SAMPLE_SUPPORT_SPI_MASTER
    default n

config SPI_MASTER_D3_PIN_MODE
    int
    prompt "Choose QSPI master D3 pin mode."
    depends on SPI_MASTER_SUPPORT_QSPI
    default 1

config SPI_MASTER_D2_PIN_MODE
    int
    prompt "Choose QSPI master D2 pin mode."
    depends on SPI_MASTER_SUPPORT_QSPI
    default 1

config SPI_MASTER_D3_PIN
    int
    prompt "Choose QSPI master D3 pin."
    depends on SPI_MASTER_SUPPORT_QSPI
    default 40

config SPI_MASTER_D2_PIN
    int
    prompt "Choose QSPI master D2 pin."
    depends on SPI_MASTER_SUPPORT_QSPI
    default 41
</code></pre>
<p><strong>è¯´æ˜</strong>ï¼š</p>
<ul>
<li>è¿™æ˜¯ <strong>é€šç”¨ SPI æ¨¡å—</strong>ï¼ˆä¸æ˜¯ SFCï¼‰çš„ QSPI é…ç½®</li>
<li>æ”¯æŒç”¨æˆ·è‡ªå®šä¹‰ D2/D3 pinï¼ˆGPIO_40ã€GPIO_41 ç­‰ï¼‰</li>
<li><strong>è¿™ä¸å½±å“ SFC çš„ GPIO_23-24</strong></li>
</ul>
<hr/>
<h4 data-id="heading-19">ğŸ“Š å½“å‰é¡¹ç›®é…ç½®çŠ¶æ€</h4>
<h5 data-id="heading-20"><strong>æ–‡ä»¶</strong>ï¼š<a href="https://link.juejin.cn?target=src%2Fbuild%2Fconfig%2Ftarget_config%2Fws63%2Fmenuconfig%2Facore%2Fws63_liteos_app.config" target="_blank" title="src/build/config/target_config/ws63/menuconfig/acore/ws63_liteos_app.config" ref="nofollow noopener noreferrer">src/build/config/target_config/ws63/menuconfig/acore/ws63_liteos_app.config</a></h5>
<p><strong>ä½ç½®</strong>ï¼šç¬¬ 357-383 è¡Œ</p>
<pre><code class="hljs language-config" lang="config">#
# SFC Configuration
#

#
# Config  SFC
#
# CONFIG_SFC_SUPPORT_DMA is not set
# CONFIG_SFC_ALLOW_ERASE_WRITEBACK is not set
# CONFIG_SFC_ALREADY_INIT is not set
# CONFIG_SFC_SUPPORT_LPM is not set
# CONFIG_SFC_SUPPORT_SFC_LOCK is not set
# CONFIG_SFC_SUPPORT_DATA_CACHE is not set
# CONFIG_SFC_SUPPORT_RWE_INDEPENDENT is not set
# CONFIG_SFC_SUPPORT_WRITE_PROTECT is not set
# CONFIG_SFC_USE_CUSTOMIZED_DEVICE_INFO is not set
# CONFIG_SFC_DEBUG is not set
# end of SFC Configuration

CONFIG_DRIVER_SUPPORT_SPI=y

#
# SPI Configuration
#

#
# Config SPI
#
# CONFIG_SPI_SUPPORT_MASTER is not set
# CONFIG_SPI_SUPPORT_SLAVE is not set
# CONFIG_SPI_SUPPORT_DMA is not set
# CONFIG_SPI_SUPPORT_INTERRUPT is not set
# CONFIG_SPI_SUPPORT_CONCURRENCY is not set
# CONFIG_SPI_SUPPORT_LOOPBACK is not set
# CONFIG_SPI_SUPPORT_CRC is not set
</code></pre>
<p><strong>å½“å‰é…ç½®åˆ†æ</strong>ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">âœ… å¯ç”¨çš„é…ç½®ï¼š
   â””â”€ CONFIG_DRIVER_SUPPORT_SFC=y         ï¼ˆSFC é©±åŠ¨å¯ç”¨ï¼‰
   â””â”€ CONFIG_DRIVER_SUPPORT_SPI=y         ï¼ˆ<span class="hljs-built_in">SPI</span> é©±åŠ¨å¯ç”¨ï¼‰

âŒ ç¦ç”¨çš„é…ç½®ï¼š
   â””â”€ CONFIG_SFC_SUPPORT_DMA              ï¼ˆDMA ç¦ç”¨ - ä»…å¯„å­˜å™¨æ¨¡å¼ï¼‰
   â””â”€ CONFIG_SPI_SUPPORT_MASTER           ï¼ˆé€šç”¨ <span class="hljs-built_in">SPI</span> Master ç¦ç”¨ï¼‰
   â””â”€ CONFIG_SPI_SUPPORT_SLAVE            ï¼ˆé€šç”¨ <span class="hljs-built_in">SPI</span> Slave ç¦ç”¨ï¼‰
   â””â”€ CONFIG_SPI_SUPPORT_DMA              ï¼ˆ<span class="hljs-built_in">SPI</span> DMA ç¦ç”¨ï¼‰

âš ï¸  å…³é”®å‘ç°ï¼š
   â€¢ SFC æ²¡æœ‰æ˜¾å¼çš„ <span class="hljs-built_in">SPI</span>/QSPI æ¨¡å¼å¼€å…³
   â€¢ QSPI æ¨¡å¼ç”± Flash èŠ¯ç‰‡è‡ªåŠ¨æ£€æµ‹å’Œå¯ç”¨
   â€¢ å½“å‰ä½¿ç”¨çš„æ˜¯å¯„å­˜å™¨æ¨¡å¼ï¼ˆé DMAï¼‰ï¼Œè¾ƒä½æ•ˆç‡
</code></pre>
<hr/>
<h4 data-id="heading-21">ğŸ” æ¨¡å¼é…ç½®å†³ç­–æµç¨‹</h4>
<pre><code class="hljs language-arduino" lang="arduino">ç¡¬ä»¶æ£€æµ‹ Flash èŠ¯ç‰‡
        â”‚
        â”œâ”€â†’ è¯†åˆ« Flash ID
        â”‚   â””â”€ sfc.c line <span class="hljs-number">151</span>
        â”‚       <span class="hljs-built_in">build_cmds</span>(flash_id, ...)
        â”‚
        â””â”€â†’ æŸ¥è¯¢ Flash æ”¯æŒçš„æ¨¡å¼
            â””â”€ flash_config_info.c
                <span class="hljs-type">flash_spi_info_t</span> ä¸­çš„ quad_mode

            â”œâ”€ quad_mode != <span class="hljs-literal">NULL</span>
            â”‚  â””â”€â†’ æ­¤ Flash æ”¯æŒ QSPI
            â”‚      â”œâ”€ è‡ªåŠ¨å¯ç”¨ GPIO_23<span class="hljs-number">-24</span>
            â”‚      â””â”€ é…ç½® QSPI æŒ‡ä»¤
            â”‚
            â””â”€ quad_mode == <span class="hljs-literal">NULL</span>
               â””â”€â†’ æ­¤ Flash ä»…æ”¯æŒ <span class="hljs-built_in">SPI</span>
                   â”œâ”€ ä»…ä½¿ç”¨ GPIO_19<span class="hljs-number">-22</span>
                   â””â”€ é…ç½® <span class="hljs-built_in">SPI</span> æŒ‡ä»¤
</code></pre>
<hr/>
<h3 data-id="heading-22">4ï¸âƒ£ GPIO é‡æ–°å¸ƒçº¿ä¿®æ”¹æ¸…å•</h3>
<h4 data-id="heading-23">âš ï¸ ç¡¬ä»¶GPIOå›ºå®šæ€§è­¦å‘Š</h4>
<pre><code class="hljs language-markdown" lang="markdown">âŒ ã€ä¸å¯ä¿®æ”¹ã€‘ç¡¬ä»¶å›ºå®šçš„ GPIO æ˜ å°„ï¼š

<span class="hljs-code">    GPIO_19 â†â†’ SFC_CLKï¼ˆç¡¬çº¿è¿æ¥ï¼‰
    GPIO_20 â†â†’ SFC_CSNï¼ˆç¡¬çº¿è¿æ¥ï¼‰
    GPIO_21 â†â†’ SFC_IO0/MOSIï¼ˆç¡¬çº¿è¿æ¥ï¼‰
    GPIO_22 â†â†’ SFC_IO1/MISOï¼ˆç¡¬çº¿è¿æ¥ï¼‰
    GPIO_23 â†â†’ SFC_IO2/WPï¼ˆç¡¬çº¿è¿æ¥ï¼‰
    GPIO_24 â†â†’ SFC_IO3/HOLDï¼ˆç¡¬çº¿è¿æ¥ï¼‰
</span>
è¿™äº›æ˜¯èŠ¯ç‰‡è®¾è®¡é˜¶æ®µçš„ç¡¬è¿æ¥ï¼Œæ— æ³•é€šè¿‡è½¯ä»¶ä¿®æ”¹ã€‚
</code></pre>
<h4 data-id="heading-24">ğŸ“ è‹¥<strong>ç¡¬ä»¶é‡æ–°è®¾è®¡</strong>éœ€è¦ä¿®æ”¹GPIO</h4>
<p><strong>å‡è®¾æ–°ç¡¬ä»¶ä½¿ç”¨äº†ä¸åŒçš„ GPIO å¼•è„š</strong>ï¼Œéœ€è¦ä¿®æ”¹ä»¥ä¸‹ä½ç½®ï¼š</p>
<h5 data-id="heading-25"><strong>1ï¸âƒ£ platform_core_rom.h</strong></h5>
<p><strong>æ–‡ä»¶ä½ç½®</strong>ï¼š<a href="https://link.juejin.cn?target=src%2Fdrivers%2Fchips%2Fws63%2Finclude%2Fplatform_core_rom.h" target="_blank" title="src/drivers/chips/ws63/include/platform_core_rom.h" ref="nofollow noopener noreferrer">src/drivers/chips/ws63/include/platform_core_rom.h</a></p>
<p><strong>åŸå†…å®¹</strong>ï¼ˆç¬¬ 50-54 è¡Œï¼‰ï¼š</p>
<pre><code class="hljs language-c" lang="c">SFC_CLK = <span class="hljs-number">19</span>,
SFC_CSN = <span class="hljs-number">20</span>,
SFC_IO0 = <span class="hljs-number">21</span>,
SFC_IO1 = <span class="hljs-number">22</span>,
SFC_IO2 = <span class="hljs-number">23</span>,
SFC_IO3 = <span class="hljs-number">24</span>,
</code></pre>
<p><strong>ä¿®æ”¹ç¤ºä¾‹</strong>ï¼ˆå‡è®¾æ–°ç¡¬ä»¶ç”¨ä¸åŒ GPIOï¼‰ï¼š</p>
<pre><code class="hljs language-c" lang="c">SFC_CLK = <span class="hljs-number">25</span>,    <span class="hljs-comment">// æ”¹ä¸º GPIO_25</span>
SFC_CSN = <span class="hljs-number">26</span>,    <span class="hljs-comment">// æ”¹ä¸º GPIO_26</span>
SFC_IO0 = <span class="hljs-number">27</span>,    <span class="hljs-comment">// æ”¹ä¸º GPIO_27</span>
SFC_IO1 = <span class="hljs-number">28</span>,    <span class="hljs-comment">// æ”¹ä¸º GPIO_28</span>
SFC_IO2 = <span class="hljs-number">29</span>,    <span class="hljs-comment">// æ”¹ä¸º GPIO_29ï¼ˆQSPIï¼‰</span>
SFC_IO3 = <span class="hljs-number">30</span>,    <span class="hljs-comment">// æ”¹ä¸º GPIO_30ï¼ˆQSPIï¼‰</span>
</code></pre>
<p><strong>ä¿®æ”¹æ­¥éª¤</strong>ï¼š</p>
<ol>
<li>ç¡®å®šæ–°çš„ GPIO å·ï¼ˆéœ€è¦ç¡¬ä»¶åŸç†å›¾ç¡®è®¤ï¼‰</li>
<li>ä¿®æ”¹ enum ä¸­çš„æ•°å€¼</li>
<li>ç¡®ä¿æ–° GPIO å·åœ¨æœ‰æ•ˆèŒƒå›´å†…ï¼ˆ0-45 ä»¥å†…ï¼‰</li>
</ol>
<hr/>
<h5 data-id="heading-26"><strong>2ï¸âƒ£ soc_porting.cï¼ˆPad æ§åˆ¶å¯„å­˜å™¨åœ°å€ï¼‰</strong></h5>
<p><strong>æ–‡ä»¶ä½ç½®</strong>ï¼š<a href="https://link.juejin.cn?target=src%2Fdrivers%2Fchips%2Fws63%2Fporting%2Fsoc%2Fsoc_porting.c" target="_blank" title="src/drivers/chips/ws63/porting/soc/soc_porting.c" ref="nofollow noopener noreferrer">src/drivers/chips/ws63/porting/soc/soc_porting.c</a></p>
<p><strong>åŸå†…å®¹</strong>ï¼ˆç¬¬ 64-67 è¡Œï¼‰ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">define</span> PAD_SFC_CLK_CTRL   0x4400d868</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> PAD_SFC_CSN_CTRL   0x4400d86C</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> PAD_SFC_IO0_CTRL   0x4400d870</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> PAD_SFC_IO1_CTRL   0x4400d874</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> PAD_SFC_IO2_CTRL   0x4400d878</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> PAD_SFC_IO3_CTRL   0x4400d87C</span>
</code></pre>
<p><strong>ä¿®æ”¹è¯´æ˜</strong>ï¼š</p>
<ul>
<li>è¿™äº›å¯„å­˜å™¨åœ°å€æ¥è‡ª <strong>WS63 èŠ¯ç‰‡è®¾è®¡æ–‡æ¡£</strong></li>
<li>æ¯ä¸ªæ–° GPIO å·å¯¹åº”æ–°çš„å¯„å­˜å™¨åœ°å€</li>
<li><strong>éœ€è¦æŸ¥é˜… WS63 æ•°æ®æ‰‹å†Œ</strong>è·å–æ–°åœ°å€</li>
</ul>
<p><strong>ä¿®æ”¹ç¤ºä¾‹</strong>ï¼ˆå‡è®¾æ–° GPIO çš„ Pad åœ°å€ï¼‰ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">define</span> PAD_SFC_CLK_CTRL   0x4400d880    <span class="hljs-comment">// æ–°åœ°å€</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> PAD_SFC_CSN_CTRL   0x4400d884</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> PAD_SFC_IO0_CTRL   0x4400d888</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> PAD_SFC_IO1_CTRL   0x4400d88C</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> PAD_SFC_IO2_CTRL   0x4400d890</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> PAD_SFC_IO3_CTRL   0x4400d894</span>
</code></pre>
<hr/>
<h5 data-id="heading-27"><strong>3ï¸âƒ£ hal_pinctrl_ws63.c</strong></h5>
<p><strong>æ–‡ä»¶ä½ç½®</strong>ï¼š<a href="https://link.juejin.cn?target=src%2Fdrivers%2Fdrivers%2Fhal%2Fpinmux%2Fws63%2Fhal_pinctrl_ws63.c" target="_blank" title="src/drivers/drivers/hal/pinmux/ws63/hal_pinctrl_ws63.c" ref="nofollow noopener noreferrer">src/drivers/drivers/hal/pinmux/ws63/hal_pinctrl_ws63.c</a></p>
<p><strong>åŸå†…å®¹</strong>ï¼ˆç¬¬ 109-140 è¡Œï¼‰ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-type">static</span> <span class="hljs-type">hal_pin_config_group_t</span> <span class="hljs-type">const</span> g_pin_pull_map[] = {
    {
        GPIO_00,
        GPIO_14,
        <span class="hljs-comment">// ... GPIO_00~14 ...</span>
    },
    {
        SFC_CLK,    <span class="hljs-comment">// = 19</span>
        SFC_IO3,    <span class="hljs-comment">// = 24</span>
        HAL_PIN_SFC_CTRL_START_ADDR,
        <span class="hljs-comment">// ...</span>
    }
};
</code></pre>
<p><strong>ä¿®æ”¹è¯´æ˜</strong>ï¼š</p>
<ul>
<li>å¦‚æœæ–° GPIO å·ä»åœ¨è¿ç»­èŒƒå›´å†…ï¼ˆå¦‚ 25-30ï¼‰ï¼Œåªéœ€ä¿®æ”¹ begin å’Œ end</li>
<li>å¦‚æœåˆ†æ•£åœ¨ä¸åŒèŒƒå›´ï¼Œå¯èƒ½éœ€è¦æ–°å¢é…ç½®ç»„</li>
</ul>
<p><strong>ä¿®æ”¹ç¤ºä¾‹</strong>ï¼ˆå‡è®¾æ–° GPIO ä¸º 25-30ï¼‰ï¼š</p>
<pre><code class="hljs language-c" lang="c">{
    SFC_CLK,        <span class="hljs-comment">// æ–°å®šä¹‰ä¸º GPIO_25</span>
    SFC_IO3,        <span class="hljs-comment">// æ–°å®šä¹‰ä¸º GPIO_30</span>
    HAL_PIN_SFC_CTRL_START_ADDR,  <span class="hljs-comment">// ä½¿ç”¨æ–°çš„åŸºåœ°å€</span>
    HAL_PIN_CONFIG_PER_NUM,
    HAL_PIN_PULL_START_BIT,
    HAL_PIN_PULL_BITS_NUM
}
</code></pre>
<hr/>
<h4 data-id="heading-28">ğŸš« Kconfig ä¸­<strong>æ— éœ€ä¿®æ”¹</strong>çš„å†…å®¹</h4>
<pre><code class="hljs language-bash" lang="bash">âœ… Kconfig æ–‡ä»¶ï¼š
   â€¢ src/drivers/drivers/Kconfig
   â€¢ src/drivers/chips/ws63/rom/drivers/drivers/driver/sfc/Kconfig
   â€¢ src/application/samples/peripheral/spi/Kconfig

ä¸ºä»€ä¹ˆï¼Ÿ
   â”œâ”€ GPIO pin å·ä¸åœ¨ Kconfig ä¸­ç¡¬ç¼–ç 
   â”œâ”€ Kconfig åªæ§åˆ¶åŠŸèƒ½å¯ç”¨/ç¦ç”¨å¼€å…³
   â””â”€ Pin æ˜ å°„åœ¨æºä»£ç ä¸­å®šä¹‰ï¼Œä¸åœ¨é…ç½®ä¸­
</code></pre>
<hr/>
<h4 data-id="heading-29">âœ… å®Œæ•´ä¿®æ”¹æ£€æŸ¥æ¸…å•</h4>
<h5 data-id="heading-30">å¦‚æœåªæ˜¯æ™®é€šé¡¹ç›®ï¼ˆä¸æ”¹ç¡¬ä»¶GPIOï¼‰ï¼š</h5>
<pre><code class="hljs">âœ… æ£€æŸ¥é¡¹ï¼š
   â˜ ç¡®è®¤å½“å‰ GPIO_19-24 åœ¨ç¡¬ä»¶ä¸Šè¿æ¥æ­£ç¡®
   â˜ æ£€æŸ¥åŸç†å›¾ä¸­ Flash pin çš„ç‰©ç†è¿æ¥
   â˜ éªŒè¯ç”µæºå’Œ GND è¿æ¥
   â˜ ç¡®ä¿ Flash èŠ¯ç‰‡è§„æ ¼ä¹¦ä¸­æ”¯æŒå½“å‰å›ºä»¶
   
âŒ æ— éœ€ä¿®æ”¹ä»»ä½•ä»£ç 
</code></pre>
<h5 data-id="heading-31">å¦‚æœéœ€è¦ç¡¬ä»¶gpioé‡æ–°å¸ƒçº¿ï¼š</h5>
<pre><code class="hljs language-markdown" lang="markdown">âœ… ä¿®æ”¹æ­¥éª¤ï¼š
<span class="hljs-bullet">   1.</span> è·å–ç¡¬ä»¶åŸç†å›¾
<span class="hljs-bullet">   2.</span> ç¡®å®šæ–° GPIO å·å’Œ Pad å¯„å­˜å™¨åœ°å€
<span class="hljs-bullet">   3.</span> ä¿®æ”¹ platform<span class="hljs-emphasis">_core_</span>rom.hï¼ˆGPIO å·ï¼‰
<span class="hljs-bullet">   4.</span> ä¿®æ”¹ soc<span class="hljs-emphasis">_porting.cï¼ˆPad æ§åˆ¶åœ°å€ï¼‰
   5. ä¿®æ”¹ hal_</span>pinctrl<span class="hljs-emphasis">_ws63.cï¼ˆpin é…ç½®èŒƒå›´ï¼‰
   6. ç¼–è¯‘éªŒè¯
   7. çƒ§å½• BootLoader æ‰§è¡Œåˆå§‹åŒ–

ğŸ”§ å·¥å…·éœ€æ±‚ï¼š
   â€¢ WS63 æ•°æ®æ‰‹å†Œï¼ˆè·å– Pad åœ°å€ï¼‰
   â€¢ FlashTool é‡æ–°çƒ§å½• BootLoader
   â€¢ ç¡¬ä»¶æµ‹è¯•å·¥å…·ï¼ˆç¤ºæ³¢å™¨ã€é€»è¾‘åˆ†æä»ªï¼‰
</span></code></pre>
<hr/>
<h3 data-id="heading-32">5ï¸âƒ£ ä»£ç è·¯å¾„æ±‡æ€»</h3>
<h4 data-id="heading-33">ğŸ“ æ–‡ä»¶ç»“æ„å›¾</h4>
<pre><code class="hljs language-erlang" lang="erlang">fbb_ws63-master/
â”œâ”€â”€ src/drivers/
â”‚   â”œâ”€â”€ chips/ws63/
â”‚   â”‚   â”œâ”€â”€ include/
â”‚   â”‚   â”‚   â”œâ”€â”€ platform_core_rom.h                â­ GPIO æšä¸¾å®šä¹‰
â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â”œâ”€â”€ porting/
â”‚   â”‚   â”‚   â”œâ”€â”€ soc/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ soc_porting.c                 â­ Pad å¯„å­˜å™¨åœ°å€
â”‚   â”‚   â”‚   â”œâ”€â”€ sfc/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ sfc_porting.h                 ğŸ“‹ SFC é…ç½®ç»“æ„ä½“
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ porting/
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ sfc_porting.c             â­ SFC å¯„å­˜å™¨åŸºåœ°å€
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ driver/
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ sfc.c                     ğŸ’» SFC é©±åŠ¨æ ¸å¿ƒ
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ flash_config/
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ flash_config_info.c       ğŸ“Š Flash èŠ¯ç‰‡é…ç½®
â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”œâ”€â”€ drivers/
â”‚   â”‚   â”œâ”€â”€ hal/
â”‚   â”‚   â”‚   â”œâ”€â”€ pinmux/ws63/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ hal_pinctrl_ws63.c            â­ Pin æ§åˆ¶é…ç½®
â”‚   â”‚   â”‚   â”œâ”€â”€ sfc/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ hal_sfc_v150.c               ğŸ’» SFC HAL å±‚
â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â”œâ”€â”€ Kconfig                               ğŸ“ é©±åŠ¨é…ç½®å¼€å…³
â”‚   â”‚   â””â”€â”€ ...
â”‚   â””â”€â”€ ...
â”œâ”€â”€ src/application/
â”‚   â””â”€â”€ samples/
â”‚       â””â”€â”€ peripheral/
â”‚           â”œâ”€â”€ spi/
â”‚           â”‚   â”œâ”€â”€ Kconfig                       ğŸ“ SPI é…ç½®å¼€å…³
â”‚           â”‚   â””â”€â”€ spi_master_demo.c             ğŸ“œ SPI Master ç¤ºä¾‹
â”‚           â””â”€â”€ sfc/
â”‚               â””â”€â”€ sfc_demo.c                    ğŸ“œ SFC ä½¿ç”¨ç¤ºä¾‹
â”œâ”€â”€ src/build/
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â””â”€â”€ target_config/ws63/menuconfig/acore/
â”‚   â”‚       â”œâ”€â”€ ws63_liteos_app.config            âš™ï¸  APP é…ç½®
â”‚   â”‚       â”œâ”€â”€ ws63_flashboot.config             âš™ï¸  BootLoader é…ç½®
â”‚   â”‚       â””â”€â”€ ws63_liteos_testsuite.config      âš™ï¸  æµ‹è¯•å¥—ä»¶é…ç½®
â”‚   â””â”€â”€ ...
â””â”€â”€ ...
</code></pre>
<hr/>
<h4 data-id="heading-34">ğŸ”‘ æ ¸å¿ƒæ–‡ä»¶è¯¦è§£</h4>


















































































<table><thead><tr><th>#</th><th>æ–‡ä»¶å</th><th>è·¯å¾„</th><th>åŠŸèƒ½</th><th>ä¿®æ”¹é¢‘ç‡</th></tr></thead><tbody><tr><td>1</td><td><strong>platform_core_rom.h</strong></td><td><code>src/drivers/chips/ws63/include/</code></td><td>GPIO æšä¸¾å®šä¹‰ï¼ˆGPIO_19-24ï¼‰</td><td>ğŸ”´ æå°‘ä¿®æ”¹</td></tr><tr><td>2</td><td><strong>soc_porting.c</strong></td><td><code>src/drivers/chips/ws63/porting/soc/</code></td><td>Pad å¯„å­˜å™¨åœ°å€ &amp; é©±åŠ¨å¼ºåº¦é…ç½®</td><td>ğŸ”´ æå°‘ä¿®æ”¹</td></tr><tr><td>3</td><td><strong>hal_pinctrl_ws63.c</strong></td><td><code>src/drivers/drivers/hal/pinmux/ws63/</code></td><td>Pin æ§åˆ¶é…ç½®æ˜ å°„è¡¨</td><td>ğŸŸ¡ å¦‚æœæ”¹GPIO</td></tr><tr><td>4</td><td><strong>sfc_porting.h</strong></td><td><code>src/drivers/chips/ws63/porting/sfc/</code></td><td>SFC é…ç½®ç»“æ„ä½“å®šä¹‰</td><td>ğŸŸ¢ å¯é…ç½®</td></tr><tr><td>5</td><td><strong>sfc_porting.c</strong></td><td><code>src/drivers/chips/ws63/porting/sfc/porting/</code></td><td>SFC å¯„å­˜å™¨åŸºåœ°å€</td><td>ğŸ”´ å›ºå®š</td></tr><tr><td>6</td><td><strong>sfc.c</strong></td><td><code>src/drivers/chips/ws63/porting/sfc/driver/</code></td><td>SFC é©±åŠ¨å®ç°</td><td>ğŸŸ¢ æŒ‰éœ€é…ç½®</td></tr><tr><td>7</td><td><strong>flash_config_info.c</strong></td><td><code>src/drivers/chips/ws63/porting/sfc/flash_config/</code></td><td>Flash èŠ¯ç‰‡æ•°æ®åº“</td><td>ğŸŸ¢ æ–°èŠ¯ç‰‡éœ€æ·»åŠ </td></tr><tr><td>8</td><td><strong>hal_sfc_v150.c</strong></td><td><code>src/drivers/drivers/hal/sfc/</code></td><td>SFC ç¡¬ä»¶æŠ½è±¡å±‚</td><td>ğŸ”´ æå°‘ä¿®æ”¹</td></tr><tr><td>9</td><td><strong>Kconfig</strong></td><td><code>src/drivers/drivers/</code></td><td>é©±åŠ¨åŠŸèƒ½å¼€å…³</td><td>ğŸŸ¡ æŒ‰é¡¹ç›®éœ€æ±‚</td></tr><tr><td>10</td><td><strong>.config</strong></td><td><code>src/build/config/target_config/ws63/</code></td><td>å½“å‰ç¼–è¯‘é…ç½®</td><td>ğŸŸ¢ é¢‘ç¹ä¿®æ”¹</td></tr></tbody></table>
<p><strong>å›¾ä¾‹</strong>ï¼š</p>
<ul>
<li>ğŸ”´ çº¢è‰²ï¼šç¡¬ä»¶å›ºå®šï¼Œæå°‘æ”¹åŠ¨</li>
<li>ğŸŸ¡ é»„è‰²ï¼šç‰¹å®šåœºæ™¯ä¿®æ”¹</li>
<li>ğŸŸ¢ ç»¿è‰²ï¼šå¸¸è§„é…ç½®å’Œå®šåˆ¶</li>
</ul>
<hr/>
<h4 data-id="heading-35">ğŸ” åŠŸèƒ½è¿½è¸ª</h4>
<h5 data-id="heading-36"><strong>"å¦‚ä½•å¯ç”¨ QSPI æ¨¡å¼ï¼Ÿ"è¿½è¸ª</strong></h5>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> ç¡¬ä»¶æ£€æµ‹é˜¶æ®µ
   â””â”€ sfc.c:151
<span class="hljs-code">       uapi_sfc_init() å…¥å£
           â†“
       build_cmds(flash_id, ...)
           â†“
</span>
<span class="hljs-bullet">2.</span> Flash èŠ¯ç‰‡æŸ¥è¯¢
   â””â”€ flash<span class="hljs-emphasis">_config_</span>info.c
<span class="hljs-code">       æŸ¥è¯¢ flash_spi_info_t æ•°ç»„
       æ‰¾åˆ°åŒ¹é…çš„ flash_id
           â†“
</span>
<span class="hljs-bullet">3.</span> æ¨¡å¼è‡ªåŠ¨é€‰æ‹©
   â””â”€ sfc.c:67
<span class="hljs-code">       if (spi_info-&gt;quad_mode != NULL)
           â”œâ”€ QSPI æ”¯æŒ
           â”‚  â”œâ”€ è‡ªåŠ¨å¯ç”¨ GPIO_23-24
           â”‚  â”œâ”€ åŠ è½½ QSPI æŒ‡ä»¤åºåˆ—
           â”‚  â””â”€ é…ç½® Quad SPI æ¨¡å¼
           â””â”€ SPI ä»…æ”¯æŒ
              â”œâ”€ ä»…ä½¿ç”¨ GPIO_19-22
              â”œâ”€ åŠ è½½ SPI æŒ‡ä»¤
              â””â”€ é…ç½®æ ‡å‡† SPI æ¨¡å¼
</span>
<span class="hljs-bullet">4.</span> HAL å±‚åˆå§‹åŒ–
   â””â”€ hal<span class="hljs-emphasis">_sfc_</span>v150.c
<span class="hljs-code">       hal_sfc_init()
       æ ¹æ® quad_mode å‚æ•°é…ç½®ç¡¬ä»¶
           â†“
</span>
<span class="hljs-bullet">5.</span> å®Œæˆ
   â””â”€ é©±åŠ¨è‡ªåŠ¨è¿è¡Œäºæœ€ä¼˜æ¨¡å¼
</code></pre>
<hr/>
<h5 data-id="heading-37"><strong>"å¦‚ä½•ä¿®æ”¹ Flash é…ç½®ï¼Ÿ"è¿½è¸ª</strong></h5>
<pre><code class="hljs language-ini" lang="ini">1. æ‰¾åˆ°ä½¿ç”¨çš„ Flash èŠ¯ç‰‡å‹å·
   â””â”€ ç¡¬ä»¶åŸç†å›¾ â†’ Flash èŠ¯ç‰‡æ‰‹å†Œ

2. æ£€æŸ¥ flash_config_info.c
   â””â”€ æŸ¥æ‰¾å¯¹åº”çš„ FLASH_XXX ID å®šä¹‰
       æ˜¯å¦å­˜åœ¨è¯¥èŠ¯ç‰‡é…ç½®

3. å¦‚æœå·²æœ‰é…ç½®
   â””â”€ sfc.c ä¼šè‡ªåŠ¨ä½¿ç”¨
   â””â”€ æ— éœ€ä¿®æ”¹ä»£ç 

4. å¦‚æœæ— è¯¥é…ç½®
   â””â”€ flash_config_info.c
       ä»¿ç…§ç°æœ‰æ ¼å¼æ·»åŠ è¯¥ Flash é…ç½®
           â”œâ”€ .<span class="hljs-attr">chip_id</span> = <span class="hljs-number">0</span>xXXXXXX
           â”œâ”€ .read_cmds<span class="hljs-section">[]</span> = { ... }
           â”œâ”€ .write_cmds<span class="hljs-section">[]</span> = { ... }
           â”œâ”€ .erase_cmds<span class="hljs-section">[]</span> = { ... }
           â””â”€ .<span class="hljs-attr">quad_mode</span> = &amp;cmd_seq  (å¦‚æœæ”¯æŒ)

5. é‡æ–°ç¼–è¯‘çƒ§å½•
</code></pre>
<hr/>
<h4 data-id="heading-38">ğŸ¯ å¿«é€ŸæŸ¥æ‰¾è¡¨</h4>
<p><strong>æˆ‘æƒ³è¦é…ç½®...</strong></p>

































































<table><thead><tr><th>éœ€æ±‚</th><th>æ–‡ä»¶</th><th>è¡Œå·</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>æŸ¥çœ‹ GPIO å®šä¹‰</td><td>platform_core_rom.h</td><td>50-54</td><td>enum GPIO ç¼–å·</td></tr><tr><td>æ”¹å˜ GPIO å·</td><td>platform_core_rom.h</td><td>50-54</td><td>ä¿®æ”¹æšä¸¾å€¼</td></tr><tr><td>è°ƒæ•´é©±åŠ¨å¼ºåº¦</td><td>soc_porting.c</td><td>70-71</td><td>SFC_CLK_DS_VALUE ç­‰</td></tr><tr><td>å¯ç”¨ DMA</td><td>Kconfig</td><td>é…ç½®èœå•</td><td>CONFIG_SFC_SUPPORT_DMA</td></tr><tr><td>æ·»åŠ æ–° Flash</td><td>flash_config_info.c</td><td>å…¨æ–‡</td><td>ä»¿ç…§ç°æœ‰æ¡ç›®æ·»åŠ </td></tr><tr><td>å¯ç”¨ Quad æ¨¡å¼</td><td>è‡ªåŠ¨</td><td>-</td><td>Flash è‡ªåŠ¨æ£€æµ‹</td></tr><tr><td>æŸ¥çœ‹ SFC åˆå§‹åŒ–</td><td>sfc.c</td><td>145-170</td><td>uapi_sfc_init() å‡½æ•°</td></tr><tr><td>æŸ¥çœ‹ Pin é…ç½®</td><td>hal_pinctrl_ws63.c</td><td>109-140</td><td>g_pin_xxx_map æ•°ç»„</td></tr><tr><td>ç¦ç”¨ SFC</td><td>Kconfig</td><td>é©±åŠ¨èœå•</td><td>CONFIG_DRIVER_SUPPORT_SFC</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-39">ğŸ“ æ€»ç»“å¯¹æ¯”è¡¨</h3>
<h4 data-id="heading-40">SPI vs QSPI æ¨¡å¼ï¼šç¡¬ä»¶è§†è§’</h4>
<pre><code class="hljs language-scss" lang="scss">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç‰¹æ€§         â”‚ SPI æ¨¡å¼        â”‚ QSPI æ¨¡å¼       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ GPIO pin     â”‚ GPIO_19~<span class="hljs-number">22</span>      â”‚ GPIO_19~<span class="hljs-number">24</span>      â”‚
â”‚ æ€»æ•°         â”‚ <span class="hljs-number">4</span> æ¡            â”‚ <span class="hljs-number">6</span> æ¡            â”‚
â”‚ CLK          â”‚ GPIO_19         â”‚ GPIO_19         â”‚
â”‚ CSN          â”‚ GPIO_20         â”‚ GPIO_20         â”‚
â”‚ <span class="hljs-built_in">MOSI</span>(IO0)    â”‚ GPIO_21         â”‚ GPIO_21         â”‚
â”‚ <span class="hljs-built_in">MISO</span>(IO1)    â”‚ GPIO_22         â”‚ GPIO_22         â”‚
â”‚ <span class="hljs-built_in">WP</span>(IO2)      â”‚ âŒ ä¸éœ€è¦       â”‚ GPIO_23         â”‚
â”‚ <span class="hljs-built_in">HOLD</span>(IO3)    â”‚ âŒ ä¸éœ€è¦       â”‚ GPIO_24         â”‚
â”‚ é©±åŠ¨å¼ºåº¦     â”‚ åœ¨ soc_porting<span class="hljs-selector-class">.c</span> ä¸­é…ç½® | åŒå·¦   â”‚
â”‚ Pad å¯„å­˜å™¨   â”‚ <span class="hljs-number">0</span>x4400d868-<span class="hljs-number">74</span>   â”‚ <span class="hljs-number">0</span>x4400d868-<span class="hljs-number">7</span>C   â”‚
â”‚ æ•°æ®çº¿æ•°     â”‚ <span class="hljs-number">1</span>(æ”¶) + <span class="hljs-number">1</span>(å‘)   â”‚ <span class="hljs-number">4</span> çº¿åŒå‘        â”‚
â”‚ ä¼ è¾“é€Ÿç‡     â”‚ åŸºçº¿            â”‚ ~<span class="hljs-number">4</span>x å¿«é€Ÿ        â”‚
â”‚ Pin é…ç½®æ–‡ä»¶ â”‚ hal_pinctrl_ws63<span class="hljs-selector-class">.c</span> ï¼ˆç»Ÿä¸€ï¼‰       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h4 data-id="heading-41">ç¼–è¯‘é…ç½®ï¼šå½“å‰é¡¹ç›®çŠ¶æ€</h4>
<pre><code class="hljs language-ini" lang="ini">â”œâ”€ <span class="hljs-attr">CONFIG_DRIVER_SUPPORT_SFC</span>=y       âœ… SFC é©±åŠ¨å¯ç”¨
â”œâ”€ <span class="hljs-attr">CONFIG_DRIVER_SUPPORT_SPI</span>=y       âœ… é€šç”¨ SPI å¯ç”¨ï¼ˆä½†æ—  Masterï¼‰
â”œâ”€ CONFIG_SFC_SUPPORT_DMA æœªè®¾       âŒ ç¦ç”¨ DMAï¼ˆä½æ€§èƒ½ï¼‰
â”‚
â””â”€ å½“å‰æ¨¡å¼è‡ªåŠ¨æ£€æµ‹ï¼š
    Flash æ”¯æŒ QUAD â†’ è‡ªåŠ¨å¯ç”¨ QSPIï¼ˆGPIO_19-24ï¼‰
    Flash ä»…æ”¯æŒ SPI â†’ ä½¿ç”¨ SPI æ¨¡å¼ï¼ˆGPIO_19-22ï¼‰
</code></pre>
<h4 data-id="heading-42">ä¿®æ”¹éœ€æ±‚æ¸…å•</h4>
<pre><code class="hljs language-arduino" lang="arduino">åœºæ™¯ <span class="hljs-number">1</span>ï¼šä»…ä½¿ç”¨ç°æœ‰ç¡¬ä»¶ï¼ˆGPIO_19<span class="hljs-number">-24</span>ï¼‰
   ä¿®æ”¹æ–‡ä»¶ï¼šæ— 
   é‡ç¼–è¯‘ï¼šä»…éœ€æ›´æ–° .configï¼ˆå¦‚å¯ç”¨ DMAï¼‰
   
åœºæ™¯ <span class="hljs-number">2</span>ï¼šæ›´æ¢ä¸åŒ Flash èŠ¯ç‰‡ï¼ˆåŒ GPIOï¼‰
   ä¿®æ”¹æ–‡ä»¶ï¼šå¯èƒ½éœ€è¦ flash_config_info.c
   é‡ç¼–è¯‘ï¼šä»…é©±åŠ¨ä»£ç 
   
åœºæ™¯ <span class="hljs-number">3</span>ï¼šé‡æ–°è®¾è®¡ç¡¬ä»¶ï¼ˆä¸åŒ GPIOï¼‰
   ä¿®æ”¹æ–‡ä»¶ï¼š
      âœï¸  platform_core_rom.hï¼ˆGPIO æšä¸¾ï¼‰
      âœï¸  soc_porting.cï¼ˆPad åœ°å€ï¼‰
      âœï¸  hal_pinctrl_ws63.cï¼ˆPin é…ç½®ï¼‰
   é‡ç¼–è¯‘ï¼šæ•´ä¸ªé©±åŠ¨ + BootLoader
   çƒ§å½•ï¼šé‡æ–°åˆå§‹åŒ–ç¡¬ä»¶
</code></pre>
<hr/>
<h3 data-id="heading-43">ğŸ“š å‚è€ƒèµ„æº</h3>






























<table><thead><tr><th>èµ„æº</th><th>ä½ç½®</th><th>ç”¨é€”</th></tr></thead><tbody><tr><td><strong>WS63 æ•°æ®æ‰‹å†Œ</strong></td><td>ï¼ˆç¡¬ä»¶æ–‡æ¡£ï¼‰</td><td>Pad åœ°å€ã€GPIO å®šä¹‰</td></tr><tr><td><strong>GPIO_LITTLEFS_ANALYSIS.md</strong></td><td>é¡¹ç›®æ ¹ç›®å½•</td><td>GPIO é…ç½®è¯¦è§£</td></tr><tr><td><strong>SFC_GPIO_PIN_MAPPING.md</strong></td><td>AI/ æ–‡ä»¶å¤¹</td><td>Pin æ˜ å°„å‚è€ƒ</td></tr><tr><td><strong>NOR_FLASH_CONFIG_PARAMETER_GUIDE.md</strong></td><td>AI/ æ–‡ä»¶å¤¹</td><td>Flash é…ç½®æŒ‡å—</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-44">â“ å¸¸è§é—®é¢˜è§£ç­”</h3>
<h4 data-id="heading-45">Q1ï¼šèƒ½å¦æ”¹å˜ GPIO_19-24 çš„å¼•è„šå·ï¼Ÿ</h4>
<p><strong>A</strong>ï¼šä¸èƒ½ã€‚è¿™æ˜¯ç¡¬ä»¶çº§åˆ«çš„å›ºå®šè¿æ¥ã€‚SFC ç¡¬ä»¶å†…éƒ¨å·²ç›´æ¥è¿æ¥åˆ°è¿™äº› GPIOï¼Œæ”¹éœ€è¦é‡æ–°è®¾è®¡èŠ¯ç‰‡ã€‚</p>
<h4 data-id="heading-46">Q2ï¼šSPI å’Œ QSPI æ˜¯å¦å¯ä»¥åŒæ—¶å¯ç”¨ï¼Ÿ</h4>
<p><strong>A</strong>ï¼šåœ¨ SFC é©±åŠ¨ä¸­ï¼ŒFlash è‡ªåŠ¨é€‰æ‹©ä¸€ç§æ¨¡å¼ã€‚ä½†é€šç”¨ SPI æ¨¡å—å¯ç‹¬ç«‹ä½¿ç”¨ä¸åŒ GPIOï¼ˆå¦‚ GPIO_40-41ï¼‰ï¼Œä¸ SFC æ— å†²çªã€‚</p>
<h4 data-id="heading-47">Q3ï¼šä¸ºä»€ä¹ˆé…ç½®ä¸­æ²¡æœ‰ QSPI å¼€å…³ï¼Ÿ</h4>
<p><strong>A</strong>ï¼šå› ä¸º QSPI æ¨¡å¼ç”± Flash èŠ¯ç‰‡å†³å®šã€‚SFC é©±åŠ¨è‡ªåŠ¨æ£€æµ‹ Flash æ˜¯å¦æ”¯æŒ Quad æ¨¡å¼ï¼Œæ— éœ€æ‰‹åŠ¨å¼€å…³ã€‚</p>
<h4 data-id="heading-48">Q4ï¼šä¿®æ”¹äº† GPIO å®šä¹‰åç¼–è¯‘ä¸è¿‡æ€ä¹ˆåŠï¼Ÿ</h4>
<p><strong>A</strong>ï¼š</p>
<ol>
<li>æ£€æŸ¥æ–° GPIO å·æ˜¯å¦è¶…å‡ºæœ‰æ•ˆèŒƒå›´ï¼ˆ0-45ï¼‰</li>
<li>æ›´æ–°æ‰€æœ‰æ¶‰åŠçš„æ–‡ä»¶ï¼ˆplatform_core_rom.hã€soc_porting.cã€hal_pinctrl_ws63.cï¼‰</li>
<li>æ¸…ç†ç¼–è¯‘ç¼“å­˜ï¼š<code>rm -rf src/build/cmake_build</code></li>
<li>é‡æ–°ç¼–è¯‘</li>
</ol>
<h4 data-id="heading-49">Q5ï¼šGPIO_23-24 å¯ä»¥ç”¨äºå…¶ä»–åŠŸèƒ½å—ï¼Ÿ</h4>
<p><strong>A</strong>ï¼šå¦‚æœ Flash ä¸æ”¯æŒ QSPIï¼Œè¿™ä¸¤ä¸ª GPIO ç†è®ºä¸Šå¯å¤ç”¨ã€‚ä½†ä¸å»ºè®®ï¼š</p>
<ul>
<li>ç¡¬ä»¶è®¾è®¡é€šå¸¸å·²è¿æ¥åˆ° Flash</li>
<li>ä¼šä½¿ä»£ç ç»´æŠ¤å¤æ‚åŒ–</li>
<li>å¯ç”¨çš„ GPIO æœ‰å…¶ä»–é€‰é¡¹ï¼ˆGPIO_0-18, GPIO_25+ï¼‰</li>
</ul>
<hr/>
<p><strong>æ–‡æ¡£æ›´æ–°æ—¶é—´</strong>ï¼š2025-02 | <strong>FBB_WS63 ç‰ˆæœ¬</strong>ï¼šæœ€æ–° | <strong>é€‚ç”¨èŒƒå›´</strong>ï¼šSPI/QSPI é…ç½®</p>
<p>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”--â€”â€”â€”â€”â€”â€”</p>
<h2 data-id="heading-50">FBB_WS63 SFC GPIO ä¿®æ”¹ä»£ç ç¤ºä¾‹</h2>
<h3 data-id="heading-51">ğŸ¯ ä½¿ç”¨åœºæ™¯ï¼šå‡è®¾éœ€è¦æ”¹å˜ GPIO æ˜ å°„</h3>
<p>å‡å®šåŸç¡¬ä»¶ä½¿ç”¨ GPIO_19-24ï¼Œç°åœ¨éœ€è¦æ”¹ä¸º GPIO_25-30ï¼ˆä»…ä½œç¤ºä¾‹ï¼‰</p>
<hr/>
<h3 data-id="heading-52">æ¨¡æ¿ 1ï¼šplatform_core_rom.h ä¿®æ”¹ç¤ºä¾‹</h3>
<h4 data-id="heading-53">åŸå§‹ä»£ç </h4>
<p><strong>æ–‡ä»¶</strong>ï¼š<code>src/drivers/chips/ws63/include/platform_core_rom.h</code>
<strong>è¡Œå·</strong>ï¼š45-60</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">/**
 * @brief Definition of pin.
 */</span>
<span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">enum</span> {</span>
    GPIO_00 = <span class="hljs-number">0</span>,
    GPIO_01 = <span class="hljs-number">1</span>,
    GPIO_02 = <span class="hljs-number">2</span>,
    GPIO_03 = <span class="hljs-number">3</span>,
    GPIO_04 = <span class="hljs-number">4</span>,
    GPIO_05 = <span class="hljs-number">5</span>,
    GPIO_06 = <span class="hljs-number">6</span>,
    GPIO_07 = <span class="hljs-number">7</span>,
    GPIO_08 = <span class="hljs-number">8</span>,
    GPIO_09 = <span class="hljs-number">9</span>,
    GPIO_10 = <span class="hljs-number">10</span>,
    GPIO_11 = <span class="hljs-number">11</span>,
    GPIO_12 = <span class="hljs-number">12</span>,
    GPIO_13 = <span class="hljs-number">13</span>,
    GPIO_14 = <span class="hljs-number">14</span>,
    GPIO_15 = <span class="hljs-number">15</span>,
    GPIO_16 = <span class="hljs-number">16</span>,
    GPIO_17 = <span class="hljs-number">17</span>,
    GPIO_18 = <span class="hljs-number">18</span>,
    SFC_CLK = <span class="hljs-number">19</span>,      <span class="hljs-comment">// â† åŸå€¼</span>
    SFC_CSN = <span class="hljs-number">20</span>,      <span class="hljs-comment">// â† åŸå€¼</span>
    SFC_IO0 = <span class="hljs-number">21</span>,      <span class="hljs-comment">// â† åŸå€¼</span>
    SFC_IO1 = <span class="hljs-number">22</span>,      <span class="hljs-comment">// â† åŸå€¼</span>
    SFC_IO2 = <span class="hljs-number">23</span>,      <span class="hljs-comment">// â† åŸå€¼</span>
    SFC_IO3 = <span class="hljs-number">24</span>,      <span class="hljs-comment">// â† åŸå€¼</span>
    PIN_NONE = <span class="hljs-number">25</span>, <span class="hljs-comment">// used as invalid/unused PIN number</span>
} <span class="hljs-type">pin_t</span>;
</code></pre>
<h4 data-id="heading-54">ä¿®æ”¹åçš„ä»£ç </h4>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">/**
 * @brief Definition of pin.
 */</span>
<span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">enum</span> {</span>
    GPIO_00 = <span class="hljs-number">0</span>,
    GPIO_01 = <span class="hljs-number">1</span>,
    GPIO_02 = <span class="hljs-number">2</span>,
    GPIO_03 = <span class="hljs-number">3</span>,
    GPIO_04 = <span class="hljs-number">4</span>,
    GPIO_05 = <span class="hljs-number">5</span>,
    GPIO_06 = <span class="hljs-number">6</span>,
    GPIO_07 = <span class="hljs-number">7</span>,
    GPIO_08 = <span class="hljs-number">8</span>,
    GPIO_09 = <span class="hljs-number">9</span>,
    GPIO_10 = <span class="hljs-number">10</span>,
    GPIO_11 = <span class="hljs-number">11</span>,
    GPIO_12 = <span class="hljs-number">12</span>,
    GPIO_13 = <span class="hljs-number">13</span>,
    GPIO_14 = <span class="hljs-number">14</span>,
    GPIO_15 = <span class="hljs-number">15</span>,
    GPIO_16 = <span class="hljs-number">16</span>,
    GPIO_17 = <span class="hljs-number">17</span>,
    GPIO_18 = <span class="hljs-number">18</span>,
    GPIO_19 = <span class="hljs-number">19</span>,      <span class="hljs-comment">// ç°åœ¨ä½œä¸ºæ™®é€š GPIO</span>
    GPIO_20 = <span class="hljs-number">20</span>,      <span class="hljs-comment">// ç°åœ¨ä½œä¸ºæ™®é€š GPIO</span>
    GPIO_21 = <span class="hljs-number">21</span>,      <span class="hljs-comment">// ç°åœ¨ä½œä¸ºæ™®é€š GPIO</span>
    GPIO_22 = <span class="hljs-number">22</span>,      <span class="hljs-comment">// ç°åœ¨ä½œä¸ºæ™®é€š GPIO</span>
    GPIO_23 = <span class="hljs-number">23</span>,      <span class="hljs-comment">// ç°åœ¨ä½œä¸ºæ™®é€š GPIO</span>
    GPIO_24 = <span class="hljs-number">24</span>,      <span class="hljs-comment">// ç°åœ¨ä½œä¸ºæ™®é€š GPIO</span>
    SFC_CLK = <span class="hljs-number">25</span>,      <span class="hljs-comment">// â† æ–°å€¼ï¼ˆæ”¹åˆ° GPIO_25ï¼‰</span>
    SFC_CSN = <span class="hljs-number">26</span>,      <span class="hljs-comment">// â† æ–°å€¼ï¼ˆæ”¹åˆ° GPIO_26ï¼‰</span>
    SFC_IO0 = <span class="hljs-number">27</span>,      <span class="hljs-comment">// â† æ–°å€¼ï¼ˆæ”¹åˆ° GPIO_27ï¼‰</span>
    SFC_IO1 = <span class="hljs-number">28</span>,      <span class="hljs-comment">// â† æ–°å€¼ï¼ˆæ”¹åˆ° GPIO_28ï¼‰</span>
    SFC_IO2 = <span class="hljs-number">29</span>,      <span class="hljs-comment">// â† æ–°å€¼ï¼ˆæ”¹åˆ° GPIO_29ï¼‰</span>
    SFC_IO3 = <span class="hljs-number">30</span>,      <span class="hljs-comment">// â† æ–°å€¼ï¼ˆæ”¹åˆ° GPIO_30ï¼‰</span>
    PIN_NONE = <span class="hljs-number">31</span>,     <span class="hljs-comment">// æ›´æ–°ä¸º 31ï¼ˆä¹‹å‰çš„ PIN_NONE å€¼ä¹Ÿè¦é¡ºå»¶ï¼‰</span>
} <span class="hljs-type">pin_t</span>;

<span class="hljs-meta">#<span class="hljs-keyword">define</span> PIN_MAX_NUMBER PIN_NONE  <span class="hljs-comment">// ä¿ç•™è¿™ä¸€è¡Œ</span></span>
</code></pre>
<h4 data-id="heading-55">ä¿®æ”¹è¦ç‚¹</h4>
<pre><code class="hljs">âœï¸  æ”¹åŠ¨æ¸…å•ï¼š
   â˜ SFC_CLK ä» 19 æ”¹ä¸º 25
   â˜ SFC_CSN ä» 20 æ”¹ä¸º 26
   â˜ SFC_IO0 ä» 21 æ”¹ä¸º 27
   â˜ SFC_IO1 ä» 22 æ”¹ä¸º 28
   â˜ SFC_IO2 ä» 23 æ”¹ä¸º 29
   â˜ SFC_IO3 ä» 24 æ”¹ä¸º 30
   â˜ PIN_NONE ä» 25 æ”¹ä¸º 31
   â˜ æ·»åŠ  GPIO_19-24 çš„æ™®é€šå®šä¹‰ï¼ˆå¯é€‰ï¼‰
</code></pre>
<hr/>
<h3 data-id="heading-56">æ¨¡æ¿ 2ï¼šsoc_porting.c ä¿®æ”¹ç¤ºä¾‹</h3>
<h4 data-id="heading-57">åŸå§‹ä»£ç </h4>
<p><strong>æ–‡ä»¶</strong>ï¼š<code>src/drivers/chips/ws63/porting/soc/soc_porting.c</code>
<strong>è¡Œå·</strong>ï¼š64-79</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">define</span> PAD_SFC_CLK_CTRL  0x4400d868    <span class="hljs-comment">// GPIO_19</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> PAD_SFC_CSN_CTRL  0x4400d86C    <span class="hljs-comment">// GPIO_20</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> PAD_SFC_IO0_CTRL  0x4400d870    <span class="hljs-comment">// GPIO_21</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> PAD_SFC_IO1_CTRL  0x4400d874    <span class="hljs-comment">// GPIO_22</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> PAD_SFC_IO2_CTRL  0x4400d878    <span class="hljs-comment">// GPIO_23</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> PAD_SFC_IO3_CTRL  0x4400d87C    <span class="hljs-comment">// GPIO_24</span></span>

<span class="hljs-meta">#<span class="hljs-keyword">define</span> SFC_CLK_DS_VALUE  0x3</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> SFC_CSN_DS_VALUE  0x2</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> SFC_DATA_DS_VALUE 0x2</span>

<span class="hljs-type">void</span> <span class="hljs-title function_">config_sfc_ctrl_ds</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span>
{
    reg_setbits(PAD_SFC_CLK_CTRL, <span class="hljs-number">0</span>, POS_4, DTRL_DS_LEN, SFC_CLK_DS_VALUE);
    reg_setbits(PAD_SFC_CSN_CTRL, <span class="hljs-number">0</span>, POS_4, DTRL_DS_LEN, SFC_CSN_DS_VALUE);
    reg_setbits(PAD_SFC_IO0_CTRL, <span class="hljs-number">0</span>, POS_4, DTRL_DS_LEN, SFC_DATA_DS_VALUE);
    reg_setbits(PAD_SFC_IO1_CTRL, <span class="hljs-number">0</span>, POS_4, DTRL_DS_LEN, SFC_DATA_DS_VALUE);
    reg_setbits(PAD_SFC_IO2_CTRL, <span class="hljs-number">0</span>, POS_4, DTRL_DS_LEN, SFC_DATA_DS_VALUE);
    reg_setbits(PAD_SFC_IO3_CTRL, <span class="hljs-number">0</span>, POS_4, DTRL_DS_LEN, SFC_DATA_DS_VALUE);
}
</code></pre>
<h4 data-id="heading-58">ä¿®æ”¹åçš„ä»£ç </h4>
<p><strong>âš ï¸ å…³é”®</strong>ï¼šéœ€è¦ä» WS63 æ•°æ®æ‰‹å†ŒæŸ¥è¯¢æ–° GPIO å¯¹åº”çš„ Pad æ§åˆ¶å¯„å­˜å™¨åœ°å€</p>
<p>å‡è®¾æ–°åœ°å€ä» 0x4400d880 å¼€å§‹ï¼ˆæŒ‰é¡ºåºé€’å¢ 0x4ï¼‰ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// æ–° GPIO çš„ Pad æ§åˆ¶å¯„å­˜å™¨åœ°å€ï¼ˆéœ€ä»èŠ¯ç‰‡æ‰‹å†ŒæŸ¥è¯¢ï¼‰</span>
<span class="hljs-comment">// GPIO_25 â†’ GPIO_30 çš„ Pad åœ°å€ï¼ˆå‡è®¾ï¼‰</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> PAD_SFC_CLK_CTRL  0x4400d880    <span class="hljs-comment">// GPIO_25 å¯¹åº”çš„ Pad åœ°å€</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> PAD_SFC_CSN_CTRL  0x4400d884    <span class="hljs-comment">// GPIO_26 å¯¹åº”çš„ Pad åœ°å€</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> PAD_SFC_IO0_CTRL  0x4400d888    <span class="hljs-comment">// GPIO_27 å¯¹åº”çš„ Pad åœ°å€</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> PAD_SFC_IO1_CTRL  0x4400d88C    <span class="hljs-comment">// GPIO_28 å¯¹åº”çš„ Pad åœ°å€</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> PAD_SFC_IO2_CTRL  0x4400d890    <span class="hljs-comment">// GPIO_29 å¯¹åº”çš„ Pad åœ°å€</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> PAD_SFC_IO3_CTRL  0x4400d894    <span class="hljs-comment">// GPIO_30 å¯¹åº”çš„ Pad åœ°å€</span></span>

<span class="hljs-comment">// é©±åŠ¨å¼ºåº¦å€¼ä¿æŒä¸å˜ï¼ˆé™¤ééœ€è¦å¾®è°ƒï¼‰</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> SFC_CLK_DS_VALUE  0x3           <span class="hljs-comment">// æ—¶é’Ÿå¼ºé©±åŠ¨</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> SFC_CSN_DS_VALUE  0x2           <span class="hljs-comment">// ç‰‡é€‰ä¸­ç­‰é©±åŠ¨</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> SFC_DATA_DS_VALUE 0x2           <span class="hljs-comment">// æ•°æ®çº¿ä¸­ç­‰é©±åŠ¨</span></span>

<span class="hljs-type">void</span> <span class="hljs-title function_">config_sfc_ctrl_ds</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span>
{
    <span class="hljs-comment">// é…ç½®é€»è¾‘å®Œå…¨ç›¸åŒï¼Œåªæ˜¯ä½¿ç”¨äº†æ–°çš„å¯„å­˜å™¨åœ°å€</span>
    reg_setbits(PAD_SFC_CLK_CTRL, <span class="hljs-number">0</span>, POS_4, DTRL_DS_LEN, SFC_CLK_DS_VALUE);
    reg_setbits(PAD_SFC_CSN_CTRL, <span class="hljs-number">0</span>, POS_4, DTRL_DS_LEN, SFC_CSN_DS_VALUE);
    reg_setbits(PAD_SFC_IO0_CTRL, <span class="hljs-number">0</span>, POS_4, DTRL_DS_LEN, SFC_DATA_DS_VALUE);
    reg_setbits(PAD_SFC_IO1_CTRL, <span class="hljs-number">0</span>, POS_4, DTRL_DS_LEN, SFC_DATA_DS_VALUE);
    reg_setbits(PAD_SFC_IO2_CTRL, <span class="hljs-number">0</span>, POS_4, DTRL_DS_LEN, SFC_DATA_DS_VALUE);
    reg_setbits(PAD_SFC_IO3_CTRL, <span class="hljs-number">0</span>, POS_4, DTRL_DS_LEN, SFC_DATA_DS_VALUE);
}
</code></pre>
<h4 data-id="heading-59">ä¿®æ”¹è¦ç‚¹</h4>
<pre><code class="hljs language-scss" lang="scss">âœï¸  æ”¹åŠ¨æ¸…å•ï¼š
   â˜ PAD_SFC_CLK_CTRL åœ°å€æ›´æ–°ï¼ˆä»èŠ¯ç‰‡æ‰‹å†ŒæŸ¥è¡¨ï¼‰
   â˜ PAD_SFC_CSN_CTRL åœ°å€æ›´æ–°
   â˜ PAD_SFC_IO0_CTRL åœ°å€æ›´æ–°
   â˜ PAD_SFC_IO1_CTRL åœ°å€æ›´æ–°
   â˜ PAD_SFC_IO2_CTRL åœ°å€æ›´æ–°
   â˜ PAD_SFC_IO3_CTRL åœ°å€æ›´æ–°
   â˜ é©±åŠ¨å¼ºåº¦å€¼ä¿æŒæˆ–å¾®è°ƒï¼ˆå¯é€‰ï¼‰
   â˜ <span class="hljs-built_in">config_sfc_ctrl_ds</span>() å‡½æ•°é€»è¾‘ä¸å˜

âš ï¸  é‡è¦ï¼š
   â€¢ æ‰€æœ‰åœ°å€éƒ½å¿…é¡»ä» WS63 æ•°æ®æ‰‹å†ŒæŸ¥è¯¢
   â€¢ åœ°å€é€šå¸¸æ˜¯æŒ‰é¡ºåºæ’åˆ—ï¼Œé—´éš” <span class="hljs-number">0</span>x4 å­—èŠ‚
   â€¢ åŠ¡å¿…ç¡®ä¿åœ°å€å‡†ç¡®æ— è¯¯
</code></pre>
<hr/>
<h3 data-id="heading-60">æ¨¡æ¿ 3ï¼šhal_pinctrl_ws63.c ä¿®æ”¹ç¤ºä¾‹</h3>
<h4 data-id="heading-61">åŸå§‹ä»£ç </h4>
<p><strong>æ–‡ä»¶</strong>ï¼š<code>src/drivers/drivers/hal/pinmux/ws63/hal_pinctrl_ws63.c</code>
<strong>è¡Œå·</strong>ï¼š93-140</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-type">static</span> <span class="hljs-type">hal_pin_config_group_t</span> <span class="hljs-type">const</span> g_pin_mode_map[] = {
    {
        GPIO_00,
        GPIO_14,
        HAL_PIN_GPIO_SEL_START_ADDR,
        HAL_PIN_CONFIG_PER_NUM,
        HAL_PIN_GPIO_SEL_START_BIT,
        HAL_PIN_GPIO_SEL_BITS_NUM
    },
    {
        GPIO_15,
        GPIO_18,
        HAL_PIN_UART_SEL_START_ADDR,
        HAL_PIN_CONFIG_PER_NUM,
        HAL_PIN_UART_SEL_START_BIT,
        HAL_PIN_UART_SEL_BITS_NUM
    }
    <span class="hljs-comment">// âš ï¸ åŸæ¥æ²¡æœ‰ SFC_CLK çš„æ¡ç›®</span>
};

<span class="hljs-type">static</span> <span class="hljs-type">hal_pin_config_group_t</span> <span class="hljs-type">const</span> g_pin_pull_map[] = {
    {
        GPIO_00,
        GPIO_14,
        HAL_PIN_GPIO_CTRL_START_ADDR,
        HAL_PIN_CONFIG_PER_NUM,
        HAL_PIN_PULL_START_BIT,
        HAL_PIN_PULL_BITS_NUM
    },
    {
        SFC_CLK,        <span class="hljs-comment">// = 19ï¼ˆåŸå€¼ï¼‰</span>
        SFC_IO3,        <span class="hljs-comment">// = 24ï¼ˆåŸå€¼ï¼‰</span>
        HAL_PIN_SFC_CTRL_START_ADDR,
        HAL_PIN_CONFIG_PER_NUM,
        HAL_PIN_PULL_START_BIT,
        HAL_PIN_PULL_BITS_NUM
    }
};

<span class="hljs-type">static</span> <span class="hljs-type">hal_pin_config_group_t</span> <span class="hljs-type">const</span> g_pin_ds_map[] = {
    {
        GPIO_00,
        GPIO_14,
        HAL_PIN_GPIO_CTRL_START_ADDR,
        HAL_PIN_CONFIG_PER_NUM,
        HAL_PIN_DS_START_BIT,
        HAL_PIN_DS_BITS_NUM
    },
    {
        SFC_CLK,        <span class="hljs-comment">// = 19ï¼ˆåŸå€¼ï¼‰</span>
        SFC_IO3,        <span class="hljs-comment">// = 24ï¼ˆåŸå€¼ï¼‰</span>
        HAL_PIN_SFC_CTRL_START_ADDR,
        HAL_PIN_CONFIG_PER_NUM,
        HAL_PIN_DS_START_BIT,
        HAL_PIN_DS_BITS_NUM
    }
};

<span class="hljs-meta">#<span class="hljs-keyword">if</span> defined(CONFIG_PINCTRL_SUPPORT_IE)</span>
<span class="hljs-type">static</span> <span class="hljs-type">hal_pin_config_group_t</span> <span class="hljs-type">const</span> g_pin_ie_map[] = {
    {
        GPIO_00,
        GPIO_18,
        HAL_PIN_GPIO_CTRL_START_ADDR,
        HAL_PIN_CONFIG_PER_NUM,
        HAL_PIN_IE_START_BIT,
        HAL_PIN_IE_BITS_NUM
    },
    {
        SFC_CLK,        <span class="hljs-comment">// = 19ï¼ˆåŸå€¼ï¼‰</span>
        SFC_IO3,        <span class="hljs-comment">// = 24ï¼ˆåŸå€¼ï¼‰</span>
        HAL_PIN_SFC_CTRL_START_ADDR,
        HAL_PIN_CONFIG_PER_NUM,
        HAL_PIN_IE_START_BIT,
        HAL_PIN_IE_BITS_NUM
    }
};
<span class="hljs-meta">#<span class="hljs-keyword">endif</span></span>

<span class="hljs-meta">#<span class="hljs-keyword">if</span> defined(CONFIG_PINCTRL_SUPPORT_ST)</span>
<span class="hljs-type">static</span> <span class="hljs-type">hal_pin_config_group_t</span> <span class="hljs-type">const</span> g_pin_st_map[] = {
    {
        GPIO_00,
        GPIO_18,
        HAL_PIN_GPIO_CTRL_START_ADDR,
        HAL_PIN_CONFIG_PER_NUM,
        HAL_PIN_ST_START_BIT,
        HAL_PIN_ST_BITS_NUM
    },
    {
        SFC_CLK,        <span class="hljs-comment">// = 19ï¼ˆåŸå€¼ï¼‰</span>
        SFC_IO3,        <span class="hljs-comment">// = 24ï¼ˆåŸå€¼ï¼‰</span>
        HAL_PIN_SFC_CTRL_START_ADDR,
        HAL_PIN_CONFIG_PER_NUM,
        HAL_PIN_ST_START_BIT,
        HAL_PIN_ST_BITS_NUM
    }
};
<span class="hljs-meta">#<span class="hljs-keyword">endif</span></span>
</code></pre>
<h4 data-id="heading-62">ä¿®æ”¹åçš„ä»£ç </h4>
<p><strong>å‡è®¾æ–°çš„ SFC GPIO ä¸º GPIO_25-30ï¼Œä»åœ¨è¿ç»­èŒƒå›´å†…</strong>ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-type">static</span> <span class="hljs-type">hal_pin_config_group_t</span> <span class="hljs-type">const</span> g_pin_mode_map[] = {
    {
        GPIO_00,
        GPIO_14,
        HAL_PIN_GPIO_SEL_START_ADDR,
        HAL_PIN_CONFIG_PER_NUM,
        HAL_PIN_GPIO_SEL_START_BIT,
        HAL_PIN_GPIO_SEL_BITS_NUM
    },
    {
        GPIO_15,
        GPIO_18,
        HAL_PIN_UART_SEL_START_ADDR,
        HAL_PIN_CONFIG_PER_NUM,
        HAL_PIN_UART_SEL_START_BIT,
        HAL_PIN_UART_SEL_BITS_NUM
    }
    <span class="hljs-comment">// SFC çš„ GPIO_25-30 å¯èƒ½ä¸éœ€è¦åœ¨ mode_map ä¸­é…ç½®</span>
};

<span class="hljs-type">static</span> <span class="hljs-type">hal_pin_config_group_t</span> <span class="hljs-type">const</span> g_pin_pull_map[] = {
    {
        GPIO_00,
        GPIO_14,
        HAL_PIN_GPIO_CTRL_START_ADDR,
        HAL_PIN_CONFIG_PER_NUM,
        HAL_PIN_PULL_START_BIT,
        HAL_PIN_PULL_BITS_NUM
    },
    {
        SFC_CLK,        <span class="hljs-comment">// ç°åœ¨ç­‰äº 25ï¼ˆæ–°å€¼ä» platform_core_rom.h è‡ªåŠ¨è·å¾—ï¼‰</span>
        SFC_IO3,        <span class="hljs-comment">// ç°åœ¨ç­‰äº 30ï¼ˆæ–°å€¼ä» platform_core_rom.h è‡ªåŠ¨è·å¾—ï¼‰</span>
        HAL_PIN_SFC_CTRL_START_ADDR,  <span class="hljs-comment">// è¿™ä¸ªåœ°å€å¯èƒ½ä¹Ÿéœ€è¦æ›´æ–°</span>
        HAL_PIN_CONFIG_PER_NUM,
        HAL_PIN_PULL_START_BIT,
        HAL_PIN_PULL_BITS_NUM
    }
};

<span class="hljs-type">static</span> <span class="hljs-type">hal_pin_config_group_t</span> <span class="hljs-type">const</span> g_pin_ds_map[] = {
    {
        GPIO_00,
        GPIO_14,
        HAL_PIN_GPIO_CTRL_START_ADDR,
        HAL_PIN_CONFIG_PER_NUM,
        HAL_PIN_DS_START_BIT,
        HAL_PIN_DS_BITS_NUM
    },
    {
        SFC_CLK,        <span class="hljs-comment">// è‡ªåŠ¨ä» enum è·å–æ–°å€¼ 25</span>
        SFC_IO3,        <span class="hljs-comment">// è‡ªåŠ¨ä» enum è·å–æ–°å€¼ 30</span>
        HAL_PIN_SFC_CTRL_START_ADDR,  <span class="hljs-comment">// å¯èƒ½éœ€è¦æ›´æ–°</span>
        HAL_PIN_CONFIG_PER_NUM,
        HAL_PIN_DS_START_BIT,
        HAL_PIN_DS_BITS_NUM
    }
};

<span class="hljs-meta">#<span class="hljs-keyword">if</span> defined(CONFIG_PINCTRL_SUPPORT_IE)</span>
<span class="hljs-type">static</span> <span class="hljs-type">hal_pin_config_group_t</span> <span class="hljs-type">const</span> g_pin_ie_map[] = {
    {
        GPIO_00,
        GPIO_18,
        HAL_PIN_GPIO_CTRL_START_ADDR,
        HAL_PIN_CONFIG_PER_NUM,
        HAL_PIN_IE_START_BIT,
        HAL_PIN_IE_BITS_NUM
    },
    {
        SFC_CLK,        <span class="hljs-comment">// è‡ªåŠ¨è·å–æ–°å€¼ 25</span>
        SFC_IO3,        <span class="hljs-comment">// è‡ªåŠ¨è·å–æ–°å€¼ 30</span>
        HAL_PIN_SFC_CTRL_START_ADDR,  <span class="hljs-comment">// å¯èƒ½éœ€è¦æ›´æ–°</span>
        HAL_PIN_CONFIG_PER_NUM,
        HAL_PIN_IE_START_BIT,
        HAL_PIN_IE_BITS_NUM
    }
};
<span class="hljs-meta">#<span class="hljs-keyword">endif</span></span>

<span class="hljs-meta">#<span class="hljs-keyword">if</span> defined(CONFIG_PINCTRL_SUPPORT_ST)</span>
<span class="hljs-type">static</span> <span class="hljs-type">hal_pin_config_group_t</span> <span class="hljs-type">const</span> g_pin_st_map[] = {
    {
        GPIO_00,
        GPIO_18,
        HAL_PIN_GPIO_CTRL_START_ADDR,
        HAL_PIN_CONFIG_PER_NUM,
        HAL_PIN_ST_START_BIT,
        HAL_PIN_ST_BITS_NUM
    },
    {
        SFC_CLK,        <span class="hljs-comment">// è‡ªåŠ¨è·å–æ–°å€¼ 25</span>
        SFC_IO3,        <span class="hljs-comment">// è‡ªåŠ¨è·å–æ–°å€¼ 30</span>
        HAL_PIN_SFC_CTRL_START_ADDR,  <span class="hljs-comment">// å¯èƒ½éœ€è¦æ›´æ–°</span>
        HAL_PIN_CONFIG_PER_NUM,
        HAL_PIN_ST_START_BIT,
        HAL_PIN_ST_BITS_NUM
    }
};
<span class="hljs-meta">#<span class="hljs-keyword">endif</span></span>
</code></pre>
<h4 data-id="heading-63">ä¿®æ”¹è¯´æ˜</h4>
<p><strong>å…³é”®è¦ç‚¹</strong>ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">â˜‘ï¸  è‡ªåŠ¨é€‚é…ï¼š
   â€¢ ç”±äºä½¿ç”¨äº† SFC_CLK å’Œ SFC_IO3 çš„æšä¸¾å
   â€¢ platform_core_rom.h æ”¹äº†åè‡ªåŠ¨åº”ç”¨
   â€¢ hal_pinctrl_ws63.c ä¸­ç”¨æšä¸¾åçš„åœ°æ–¹è‡ªåŠ¨æ›´æ–°

âŒ éœ€è¦æ‰‹åŠ¨æ”¹çš„ï¼š
   â€¢ HAL_PIN_SFC_CTRL_START_ADDR
   â€¢ æ‰€æœ‰ GPIO é…ç½®ç»„çš„æ•°æ®ç»“æ„èŒƒå›´

âœï¸  æ”¹åŠ¨æ–¹å¼ï¼š
   æ–¹æ¡ˆ Aï¼ˆæœ€ç®€å•ï¼‰ï¼š
      â€¢ åªæ”¹ platform_core_rom.h ä¸­çš„ <span class="hljs-keyword">enum</span>
      â€¢ å¦‚æœæ–° GPIO èŒƒå›´ä»ç„¶è¿ç»­ï¼Œå…¶ä»–æ–‡ä»¶å¯èƒ½æ— éœ€æ”¹
      
   æ–¹æ¡ˆ Bï¼ˆå½»åº•ï¼‰ï¼š
      â€¢ æ”¹ platform_core_rom.hï¼ˆ<span class="hljs-keyword">enum</span>ï¼‰
      â€¢ æ”¹ soc_porting.cï¼ˆPad åœ°å€ï¼‰
      â€¢ æ”¹ hal_pinctrl_ws63.cï¼ˆé…ç½®ç»„ï¼‰
      â€¢ æ”¹ HAL_PIN_SFC_CTRL_START_OFFSET åŸºåœ°å€
</code></pre>
<hr/>
<h3 data-id="heading-64">æ¨¡æ¿ 4ï¼šHAL_PIN_SFC_CTRL_START_OFFSET åŸºåœ°å€æ›´æ–°</h3>
<h4 data-id="heading-65">åŸå§‹å®šä¹‰</h4>
<p><strong>æ–‡ä»¶</strong>ï¼š<code>src/drivers/drivers/hal/pinmux/ws63/hal_pinctrl_ws63.c</code>
<strong>è¡Œå·</strong>ï¼š20-27</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">define</span> HAL_IO_CFG_BASE_ADDR            0x4400D000</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> HAL_PIN_GPIO_SEL_START_OFFSET   0x000</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> HAL_PIN_UART_SEL_START_OFFSET   0x03C</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> HAL_PIN_GPIO_CTRL_START_OFFSET  0x800</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> HAL_PIN_SFC_CTRL_START_OFFSET   0x868    <span class="hljs-comment">// â† åŸå€¼ï¼ˆç”¨äº GPIO_19-24ï¼‰</span></span>

<span class="hljs-meta">#<span class="hljs-keyword">define</span> HAL_PIN_GPIO_SEL_START_ADDR     (HAL_IO_CFG_BASE_ADDR + HAL_PIN_GPIO_SEL_START_OFFSET)</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> HAL_PIN_UART_SEL_START_ADDR     (HAL_IO_CFG_BASE_ADDR + HAL_PIN_UART_SEL_START_OFFSET)</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> HAL_PIN_GPIO_CTRL_START_ADDR    (HAL_IO_CFG_BASE_ADDR + HAL_PIN_GPIO_CTRL_START_OFFSET)</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> HAL_PIN_SFC_CTRL_START_ADDR     (HAL_IO_CFG_BASE_ADDR + HAL_PIN_SFC_CTRL_START_OFFSET)</span>
</code></pre>
<h4 data-id="heading-66">ä¿®æ”¹åï¼ˆå¦‚æœ GPIO æ”¹åˆ° 25-30ï¼‰</h4>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">define</span> HAL_IO_CFG_BASE_ADDR            0x4400D000</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> HAL_PIN_GPIO_SEL_START_OFFSET   0x000</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> HAL_PIN_UART_SEL_START_OFFSET   0x03C</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> HAL_PIN_GPIO_CTRL_START_OFFSET  0x800</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> HAL_PIN_SFC_CTRL_START_OFFSET   0x880    <span class="hljs-comment">// â† æ–°å€¼ï¼ˆä»èŠ¯ç‰‡æ‰‹å†ŒæŸ¥è¯¢ï¼‰</span></span>

<span class="hljs-meta">#<span class="hljs-keyword">define</span> HAL_PIN_GPIO_SEL_START_ADDR     (HAL_IO_CFG_BASE_ADDR + HAL_PIN_GPIO_SEL_START_OFFSET)</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> HAL_PIN_UART_SEL_START_ADDR     (HAL_IO_CFG_BASE_ADDR + HAL_PIN_UART_SEL_START_OFFSET)</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> HAL_PIN_GPIO_CTRL_START_ADDR    (HAL_IO_CFG_BASE_ADDR + HAL_PIN_GPIO_CTRL_START_OFFSET)</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> HAL_PIN_SFC_CTRL_START_ADDR     (HAL_IO_CFG_BASE_ADDR + HAL_PIN_SFC_CTRL_START_OFFSET)</span>
</code></pre>
<hr/>
<h3 data-id="heading-67">æ¨¡æ¿ 5ï¼šflash_config_info.c æ·»åŠ æ–° Flash</h3>
<h4 data-id="heading-68">åœºæ™¯ï¼šæ·»åŠ æ–°çš„ Flash èŠ¯ç‰‡ï¼ˆå¦‚ GD25Q256ï¼‰</h4>
<h4 data-id="heading-69">åŸæœ‰ Flash æ¡ç›®ç¤ºä¾‹</h4>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">define</span> FLASH_GD25Q32           0x1640C8</span>

<span class="hljs-comment">// ... åœ¨æŸä¸ªæ•°ç»„ä¸­ ...</span>
{
    .chip_id = FLASH_GD25Q32,
    .chip_size = <span class="hljs-number">0x400000</span>,                <span class="hljs-comment">// 4MB</span>
    .read_cmds = {
        {
            .cmd = <span class="hljs-number">0x0B</span>, .cmd_support = <span class="hljs-number">1</span>,
            .addr_len = SPI_ADDR_LEN_24, .addr_support = <span class="hljs-number">1</span>,
            .dummy_cycles = <span class="hljs-number">1</span>,
            .cmd_type = STANDARD_READ, .size = <span class="hljs-number">0x04</span>
        },
        <span class="hljs-comment">// ... å…¶ä»–è¯»å‘½ä»¤ ...</span>
    },
    .read_cmd_num = <span class="hljs-number">3</span>,
    .write_cmds = { ... },
    .write_cmd_num = <span class="hljs-number">2</span>,
    .erase_cmds = { ... },
    .erase_cmd_num = <span class="hljs-number">4</span>,
    .quad_mode = &amp;gd25_quad_mode_cmd,      <span class="hljs-comment">// QSPI æ”¯æŒ</span>
},
</code></pre>
<h4 data-id="heading-70">æ–°å¢ Flash GD25Q256</h4>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// 1. é¦–å…ˆæ·»åŠ  Flash ID å®šä¹‰ï¼ˆåœ¨å®å®šä¹‰éƒ¨åˆ†ï¼‰</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> FLASH_GD25Q256          0x1940C8    <span class="hljs-comment">// 256Mbit</span></span>

<span class="hljs-comment">// 2. å®šä¹‰ QSPI æ¨¡å¼çš„ä½¿èƒ½å‘½ä»¤ï¼ˆå¦‚æœæ”¯æŒ Quadï¼‰</span>
<span class="hljs-type">static</span> <span class="hljs-type">flash_cmd_execute_t</span> gd25q256_quad_mode_cmd = {
    {
        .cmd = <span class="hljs-number">0x35</span>,                        <span class="hljs-comment">// å†™çŠ¶æ€å¯„å­˜å™¨ 2</span>
        .cmd_support = <span class="hljs-number">1</span>,
        .addr_support = <span class="hljs-number">0</span>,
        .dummy_cycles = <span class="hljs-number">0</span>,
        .cmd_type = FLASH_CMD_WRITE,
        .size = <span class="hljs-number">1</span>,
    },
    {
        .cmd = <span class="hljs-number">0x15</span>,                        <span class="hljs-comment">// è¯»çŠ¶æ€å¯„å­˜å™¨ 2</span>
        .cmd_support = <span class="hljs-number">1</span>,
        .addr_support = <span class="hljs-number">0</span>,
        .dummy_cycles = <span class="hljs-number">0</span>,
        .cmd_type = FLASH_CMD_READ,
        .size = <span class="hljs-number">1</span>,
    },
    {
        .cmd_support = <span class="hljs-number">0</span>,                   <span class="hljs-comment">// å…¶ä»–å‘½ä»¤å¯é€‰</span>
    }
};

<span class="hljs-comment">// 3. åœ¨ Flash é…ç½®æ•°ç»„ä¸­è¿½åŠ æ–°æ¡ç›®</span>
{
    .chip_id = FLASH_GD25Q256,
    .chip_size = <span class="hljs-number">0x2000000</span>,                 <span class="hljs-comment">// 32MBï¼ˆ256Mbitï¼‰</span>
    .read_cmds = {
        {
            .cmd = <span class="hljs-number">0x0B</span>,                    <span class="hljs-comment">// Standard Read</span>
            .cmd_support = <span class="hljs-number">1</span>,
            .addr_len = SPI_ADDR_LEN_24,
            .addr_support = <span class="hljs-number">1</span>,
            .dummy_cycles = <span class="hljs-number">1</span>,
            .cmd_type = STANDARD_READ,
            .size = <span class="hljs-number">0x04</span>
        },
        {
            .cmd = <span class="hljs-number">0x3B</span>,                    <span class="hljs-comment">// Fast Read</span>
            .cmd_support = <span class="hljs-number">1</span>,
            .addr_len = SPI_ADDR_LEN_24,
            .addr_support = <span class="hljs-number">1</span>,
            .dummy_cycles = <span class="hljs-number">1</span>,
            .cmd_type = STANDARD_READ,
            .size = <span class="hljs-number">0x04</span>
        },
        {
            .cmd = <span class="hljs-number">0xEB</span>,                    <span class="hljs-comment">// Quad Fast Read</span>
            .cmd_support = <span class="hljs-number">1</span>,
            .addr_len = SPI_ADDR_LEN_24,
            .addr_support = <span class="hljs-number">1</span>,
            .dummy_cycles = <span class="hljs-number">3</span>,
            .cmd_type = QUAD_READ,
            .size = <span class="hljs-number">0x04</span>
        },
    },
    .read_cmd_num = <span class="hljs-number">3</span>,
    .write_cmds = {
        {
            .cmd = <span class="hljs-number">0x02</span>,                    <span class="hljs-comment">// Page Program</span>
            .cmd_support = <span class="hljs-number">1</span>,
            .addr_len = SPI_ADDR_LEN_24,
            .addr_support = <span class="hljs-number">1</span>,
            .dummy_cycles = <span class="hljs-number">0</span>,
            .cmd_type = PAGE_PROGRAM,
            .size = <span class="hljs-number">256</span>
        },
        {
            .cmd = <span class="hljs-number">0x32</span>,                    <span class="hljs-comment">// Quad Page Program</span>
            .cmd_support = <span class="hljs-number">1</span>,
            .addr_len = SPI_ADDR_LEN_24,
            .addr_support = <span class="hljs-number">1</span>,
            .dummy_cycles = <span class="hljs-number">0</span>,
            .cmd_type = PAGE_PROGRAM,
            .size = <span class="hljs-number">256</span>
        },
    },
    .write_cmd_num = <span class="hljs-number">2</span>,
    .erase_cmds = {
        {
            .cmd = <span class="hljs-number">0x20</span>,                    <span class="hljs-comment">// Sector Erase (4KB)</span>
            .cmd_support = <span class="hljs-number">1</span>,
            .addr_support = <span class="hljs-number">1</span>,
            .cmd_type = ERASE_SECTOR,
            .size = <span class="hljs-number">0x1000</span>
        },
        {
            .cmd = <span class="hljs-number">0x52</span>,                    <span class="hljs-comment">// 32KB Erase</span>
            .cmd_support = <span class="hljs-number">1</span>,
            .addr_support = <span class="hljs-number">1</span>,
            .cmd_type = ERASE_32K,
            .size = <span class="hljs-number">0x8000</span>
        },
        {
            .cmd = <span class="hljs-number">0xD8</span>,                    <span class="hljs-comment">// 64KB Erase (Block)</span>
            .cmd_support = <span class="hljs-number">1</span>,
            .addr_support = <span class="hljs-number">1</span>,
            .cmd_type = ERASE_BLOCK,
            .size = <span class="hljs-number">0x10000</span>
        },
        {
            .cmd = <span class="hljs-number">0xC7</span>,                    <span class="hljs-comment">// Chip Erase</span>
            .cmd_support = <span class="hljs-number">1</span>,
            .addr_support = <span class="hljs-number">0</span>,
            .cmd_type = ERASE_CHIP,
            .size = <span class="hljs-number">0x2000000</span>                <span class="hljs-comment">// å…¨å®¹é‡</span>
        },
    },
    .erase_cmd_num = <span class="hljs-number">4</span>,
    .quad_mode = &amp;gd25q256_quad_mode_cmd,   <span class="hljs-comment">// æ”¯æŒ QSPI</span>
},
</code></pre>
<h4 data-id="heading-71">ä¿®æ”¹æ¸…å•</h4>
<pre><code class="hljs language-arduino" lang="arduino">â˜‘ï¸  æ·»åŠ  Flash çš„æ­¥éª¤ï¼š
   <span class="hljs-number">1.</span> ä» Flash æ•°æ®æ‰‹å†Œè·å–ï¼š
      â–¡ Flash IDï¼ˆ<span class="hljs-number">3</span> å­—èŠ‚ï¼‰
      â–¡ å®¹é‡ï¼ˆ<span class="hljs-type">byte</span>ï¼‰
      â–¡ å„ç§è¯»å‘½ä»¤çš„ opcode
      â–¡ ç¼–ç¨‹å‘½ä»¤ opcode
      â–¡ æ“¦é™¤å‘½ä»¤ opcodeï¼ˆé€šå¸¸ <span class="hljs-number">4</span> ç§ï¼‰
      â–¡ QSPI ä½¿èƒ½åºåˆ—ï¼ˆå¦‚æ”¯æŒï¼‰
      
   <span class="hljs-number">2.</span> ä¿®æ”¹ flash_config_info.cï¼š
      â–¡ æ·»åŠ  <span class="hljs-meta">#<span class="hljs-keyword">define</span> FLASH_XXXXX ID</span>
      â–¡ å¦‚æœæ”¯æŒ QSPIï¼Œå®šä¹‰ quad_mode ç»“æ„
      â–¡ åˆ›å»º <span class="hljs-type">flash_spi_info_t</span> æ¡ç›®
      â–¡ å¡«å……è¯»/å†™/æ“¦å‘½ä»¤æ•°ç»„
      
   <span class="hljs-number">3.</span> ç¼–è¯‘éªŒè¯ï¼š
      â–¡ å›ºä»¶ç¼–è¯‘æˆåŠŸ
      â–¡ çƒ§å½•å¹¶æµ‹è¯• Flash è¯†åˆ«
      â–¡ éªŒè¯ <span class="hljs-built_in">SPI</span> æ¨¡å¼è¯»å†™
      â–¡ éªŒè¯ QSPI æ¨¡å¼è¯»å†™ï¼ˆå¦‚æ”¯æŒï¼‰
</code></pre>
<hr/>
<h3 data-id="heading-72">æ¨¡æ¿ 6ï¼šç¼–è¯‘é…ç½®ä¿®æ”¹</h3>
<h4 data-id="heading-73">å¯ç”¨ DMA æ¨¡å¼</h4>
<p><strong>æ–‡ä»¶</strong>ï¼š<code>ws63_liteos_app.config</code>
<strong>ä¿®æ”¹</strong>ï¼š</p>
<pre><code class="hljs language-diff" lang="diff">  #
  # SFC Configuration
  #
  
  #
  # Config  SFC
  #
<span class="hljs-deletion">- # CONFIG_SFC_SUPPORT_DMA is not set</span>
<span class="hljs-addition">+ CONFIG_SFC_SUPPORT_DMA=y</span>
  # CONFIG_SFC_ALLOW_ERASE_WRITEBACK is not set
  # CONFIG_SFC_ALREADY_INIT is not set
</code></pre>
<h4 data-id="heading-74">å¯ç”¨é€šç”¨ SPI Master</h4>
<p><strong>æ–‡ä»¶</strong>ï¼š<code>ws63_liteos_app.config</code>
<strong>ä¿®æ”¹</strong>ï¼š</p>
<pre><code class="hljs language-diff" lang="diff">  CONFIG_DRIVER_SUPPORT_SPI=y
  
  #
  # SPI Configuration
  #
  
  #
  # Config SPI
  #
<span class="hljs-deletion">- # CONFIG_SPI_SUPPORT_MASTER is not set</span>
<span class="hljs-addition">+ CONFIG_SPI_SUPPORT_MASTER=y</span>
</code></pre>
<hr/>
<h3 data-id="heading-75">ğŸ” ç¼–è¯‘éªŒè¯æ­¥éª¤</h3>
<h4 data-id="heading-76">æ­¥éª¤ 1ï¼šæ¸…ç†æ—§ç¼–è¯‘</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cd</span> fbb_ws63-master
<span class="hljs-built_in">rm</span> -rf src/build/cmake_build
<span class="hljs-built_in">rm</span> -rf src/build/output
</code></pre>
<h4 data-id="heading-77">æ­¥éª¤ 2ï¼šé‡æ–°ç¼–è¯‘</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cd</span> src
python build.py
</code></pre>
<h4 data-id="heading-78">æ­¥éª¤ 3ï¼šæ£€æŸ¥ç¼–è¯‘é”™è¯¯</h4>
<pre><code class="hljs language-arduino" lang="arduino">å¸¸è§é”™è¯¯ï¼š
  â€¢ <span class="hljs-string">"undefined reference to SFC_CLK"</span> 
    â†’ æ£€æŸ¥ platform_core_rom.h <span class="hljs-keyword">enum</span> å®šä¹‰
  
  â€¢ <span class="hljs-string">"SFC initialization failed"</span>
    â†’ æ£€æŸ¥ Pad å¯„å­˜å™¨åœ°å€æ˜¯å¦æ­£ç¡®
  
  â€¢ <span class="hljs-string">"Flash not detected"</span>
    â†’ æ£€æŸ¥ GPIO ç¡¬ä»¶è¿æ¥
    â†’ æ£€æŸ¥ flash_config_info.c Flash ID
</code></pre>
<h4 data-id="heading-79">æ­¥éª¤ 4ï¼šçƒ§å½•å’Œæµ‹è¯•</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># çƒ§å½•æ–°å›ºä»¶</span>
./flashtool --boot src/build/output/bin/out.bin

<span class="hljs-comment"># é€šè¿‡ä¸²å£è§‚å¯Ÿ SFC åˆå§‹åŒ–æ—¥å¿—</span>
<span class="hljs-comment"># åº”çœ‹åˆ°ç±»ä¼¼ï¼š</span>
<span class="hljs-comment">#   SFC: Identifying flash...</span>
<span class="hljs-comment">#   SFC: Flash ID = 0x1640C8</span>
<span class="hljs-comment">#   SFC: QSPI mode enabled</span>
<span class="hljs-comment">#   SFC: Initialization success</span>
</code></pre>
<hr/>
<h3 data-id="heading-80">âš ï¸ å¸¸è§é™·é˜±</h3>
<h4 data-id="heading-81">é™·é˜± 1ï¼šå¿˜è®°åŒæ—¶æ”¹å¤šä¸ªæ–‡ä»¶</h4>
<pre><code class="hljs">âŒ é”™è¯¯åšæ³•ï¼š
   åªæ”¹ platform_core_rom.hï¼Œæ²¡æ”¹ soc_porting.c

âœ… æ­£ç¡®åšæ³•ï¼š
   åŒæ—¶æ”¹ï¼š
   â€¢ platform_core_rom.hï¼ˆGPIO å·ï¼‰
   â€¢ soc_porting.cï¼ˆPad åœ°å€ï¼‰
   â€¢ hal_pinctrl_ws63.cï¼ˆé…ç½®èŒƒå›´ï¼‰
</code></pre>
<h4 data-id="heading-82">é™·é˜± 2ï¼šPad å¯„å­˜å™¨åœ°å€å‡è®¾</h4>
<pre><code class="hljs language-ini" lang="ini">âŒ é”™è¯¯åšæ³•ï¼š
   ç®€å•åœ°åŠ åç§»ï¼š0x4400d868 + <span class="hljs-attr">8</span> = <span class="hljs-number">0</span>x4400d870
   ï¼ˆå®é™…å¯èƒ½ä¸æ˜¯çº¿æ€§å…³ç³»ï¼‰

âœ… æ­£ç¡®åšæ³•ï¼š
   ä» WS63 æ•°æ®æ‰‹å†ŒæŸ¥è¡¨è·å–å‡†ç¡®åœ°å€
</code></pre>
<h4 data-id="heading-83">é™·é˜± 3ï¼šFlash ID åŒ¹é…å¤±è´¥</h4>
<pre><code class="hljs language-arduino" lang="arduino">âŒ é”™è¯¯ç°è±¡ï¼š
   Flash ID = <span class="hljs-number">0xFFFFFF</span>
   
âœ… æ’æŸ¥æ­¥éª¤ï¼š
   <span class="hljs-number">1.</span> ç”¨é€»è¾‘åˆ†æä»ªæ•è· <span class="hljs-built_in">SPI</span> é€šä¿¡
   <span class="hljs-number">2.</span> æ£€æŸ¥ GPIO_19<span class="hljs-number">-22</span> æ³¢å½¢
   <span class="hljs-number">3.</span> ç”¨ Flash æ•°æ®æ‰‹å†ŒéªŒè¯ read ID å‘½ä»¤
   <span class="hljs-number">4.</span> æ£€æŸ¥ flash_config_info.c ä¸­æ˜¯å¦æœ‰è¯¥ ID
</code></pre>
<h4 data-id="heading-84">é™·é˜± 4ï¼šQSPI æ¨¡å¼æ— æ³•å¯ç”¨</h4>
<pre><code class="hljs language-markdown" lang="markdown">âŒ é”™è¯¯ç°è±¡ï¼š
   å§‹ç»ˆè¿è¡Œåœ¨ SPI è€Œé QSPI æ¨¡å¼
   
âœ… æ’æŸ¥æ­¥éª¤ï¼š
<span class="hljs-bullet">   1.</span> ç¡®è®¤ Flash æ•°æ®æ‰‹å†Œæ”¯æŒ QSPI
<span class="hljs-bullet">   2.</span> æ£€æŸ¥ flash<span class="hljs-emphasis">_config_</span>info.c ä¸­ quad<span class="hljs-emphasis">_mode æŒ‡é’ˆæ˜¯å¦ä¸º NULL
   3. éªŒè¯ GPIO_</span>23-24 çš„è¿æ¥ï¼ˆä»… QSPI ç”¨ï¼‰
<span class="hljs-bullet">   4.</span> æ£€æŸ¥ QSPI ä½¿èƒ½å‘½ä»¤æ˜¯å¦æ­£ç¡®
</code></pre>
<hr/>
<h3 data-id="heading-85">ğŸ“š å‚è€ƒèµ„æº</h3>

























<table><thead><tr><th>èµ„æº</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>WS63 æ•°æ®æ‰‹å†Œ</td><td>Pad åœ°å€æŸ¥è¡¨ã€GPIO åŠŸèƒ½</td></tr><tr><td>Flash æ•°æ®æ‰‹å†Œ</td><td>å‘½ä»¤é›†ã€QSPI æ”¯æŒã€ID</td></tr><tr><td>GPIO_LITTLEFS_ANALYSIS.md</td><td>GPIO é…ç½®åŸç†</td></tr><tr><td>SFC_GPIO_PIN_MAPPING.md</td><td>Pin æ˜ å°„å®Œæ•´è¡¨</td></tr></tbody></table>
<hr/>
<p><strong>ç¤ºä¾‹æ–‡æ¡£å®Œæˆ</strong> | ç”¨äºå­¦ä¹ å’Œå‚è€ƒ | å®é™…ä½¿ç”¨éœ€æŒ‰ç¡¬ä»¶å®šåˆ¶</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>