<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>掘金文章推荐</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>一个帮助开发者成长的社区</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[Java基础-4：JDK 中基于 AQS 的核心类详解与使用示例]]></title>    <link>https://juejin.cn/post/7598537739516919850</link>    <guid>https://juejin.cn/post/7598537739516919850</guid>    <pubDate>2026-01-25T12:50:40.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598537739516919850" data-draft-id="7598587406708080681" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Java基础-4：JDK 中基于 AQS 的核心类详解与使用示例"/> <meta itemprop="keywords" content="Java"/> <meta itemprop="datePublished" content="2026-01-25T12:50:40.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="beata"/> <meta itemprop="url" content="https://juejin.cn/user/1839900247461280"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Java基础-4：JDK 中基于 AQS 的核心类详解与使用示例
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1839900247461280/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    beata
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-25T12:50:40.000Z" title="Sun Jan 25 2026 12:50:40 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在上一篇中我们详细介绍了AQS的底层代码实现逻辑，这里我们来介绍基于AQS实现的类，在 Java 并发编程中，<code>java.util.concurrent</code>（JUC）包为我们提供了大量高效、可靠的并发工具类。这些工具类的底层实现大多依赖于一个关键的抽象框架——<strong>AbstractQueuedSynchronizer</strong>（AQS）。本文将深入介绍 AQS 的基本原理，并详细讲解 JDK 中几个基于 AQS 实现的核心同步器类，包括 <code>ReentrantLock</code>、<code>Semaphore</code>、<code>CountDownLatch</code>、<code>ReentrantReadWriteLock</code> 和 <code>Condition</code>，并附上实用的代码示例。</p>
<hr/>
<h2 data-id="heading-0">一、什么是 AQS？</h2>
<p><strong>AbstractQueuedSynchronizer</strong>（AQS）是 Doug Lea 设计的一个用于构建锁和同步器的基础框架。它通过一个 <strong>int 类型的 state</strong> 表示同步状态，并维护一个 <strong>FIFO 的等待队列</strong>（CLH 队列变体），用于管理那些未能获取资源而被阻塞的线程。</p>
<p>AQS 的核心思想是：</p>
<ul>
<li>子类通过重写 <code>tryAcquire</code> / <code>tryRelease</code>（独占模式）或 <code>tryAcquireShared</code> / <code>tryReleaseShared</code>（共享模式）等方法来定义如何获取/释放资源。</li>
<li>AQS 负责线程的排队、唤醒、阻塞等复杂逻辑。</li>
</ul>
<p>AQS 支持两种资源共享方式：</p>
<ul>
<li><strong>独占式</strong>（Exclusive）：如 ReentrantLock</li>
<li><strong>共享式</strong>（Shared）：如 Semaphore、CountDownLatch</li>
</ul>
<hr/>
<h2 data-id="heading-1">二、JDK 中基于 AQS 的核心类</h2>
<h3 data-id="heading-2">1. ReentrantLock（可重入锁）</h3>
<p><strong>特点</strong>：</p>
<ul>
<li>基于 AQS 独占模式实现</li>
<li>支持公平锁与非公平锁</li>
<li>可重入（同一线程可多次获取）</li>
<li>支持 Condition</li>
</ul>
<h4 data-id="heading-3">示例代码：</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.util.concurrent.locks.ReentrantLock;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ReentrantLockExample</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">ReentrantLock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantLock</span>();
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException {
        <span class="hljs-type">Thread</span> <span class="hljs-variable">t1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000</span>; i++) {
                lock.lock();
                <span class="hljs-keyword">try</span> {
                    count++;
                } <span class="hljs-keyword">finally</span> {
                    lock.unlock();
                }
            }
        });

        <span class="hljs-type">Thread</span> <span class="hljs-variable">t2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000</span>; i++) {
                lock.lock();
                <span class="hljs-keyword">try</span> {
                    count++;
                } <span class="hljs-keyword">finally</span> {
                    lock.unlock();
                }
            }
        });

        t1.start();
        t2.start();
        t1.join();
        t2.join();

        System.out.println(<span class="hljs-string">"Final count: "</span> + count); <span class="hljs-comment">// 输出 2000</span>
    }
}
</code></pre>
<hr/>
<h3 data-id="heading-4">2. Semaphore（信号量）</h3>
<p><strong>特点</strong>：</p>
<ul>
<li>基于 AQS 共享模式实现</li>
<li>控制同时访问特定资源的线程数量</li>
<li>常用于限流、资源池控制</li>
</ul>
<h4 data-id="heading-5">示例代码（模拟数据库连接池）：</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.util.concurrent.Semaphore;
<span class="hljs-keyword">import</span> java.util.concurrent.TimeUnit;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SemaphoreExample</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Semaphore</span> <span class="hljs-variable">semaphore</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Semaphore</span>(<span class="hljs-number">3</span>); <span class="hljs-comment">// 最多3个并发</span>

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">8</span>; i++) {
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
                <span class="hljs-keyword">try</span> {
                    semaphore.acquire(); <span class="hljs-comment">// 获取许可</span>
                    System.out.println(Thread.currentThread().getName() + <span class="hljs-string">" 获取数据库连接"</span>);
                    TimeUnit.SECONDS.sleep(<span class="hljs-number">2</span>); <span class="hljs-comment">// 模拟操作</span>
                    System.out.println(Thread.currentThread().getName() + <span class="hljs-string">" 释放数据库连接"</span>);
                } <span class="hljs-keyword">catch</span> (InterruptedException e) {
                    Thread.currentThread().interrupt();
                } <span class="hljs-keyword">finally</span> {
                    semaphore.release(); <span class="hljs-comment">// 释放许可</span>
                }
            }, <span class="hljs-string">"Thread-"</span> + i).start();
        }
    }
}
</code></pre>
<hr/>
<h3 data-id="heading-6">3. CountDownLatch（倒计时门闩）</h3>
<p><strong>特点</strong>：</p>
<ul>
<li>基于 AQS 共享模式实现</li>
<li>初始化时指定一个计数，调用 <code>countDown()</code> 减 1，<code>await()</code> 阻塞直到计数为 0</li>
<li>一次性使用，计数不能重置</li>
</ul>
<h4 data-id="heading-7">示例代码（等待多个任务完成）：</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.util.concurrent.CountDownLatch;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CountDownLatchExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException {
        <span class="hljs-type">int</span> <span class="hljs-variable">threadCount</span> <span class="hljs-operator">=</span> <span class="hljs-number">5</span>;
        <span class="hljs-type">CountDownLatch</span> <span class="hljs-variable">latch</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CountDownLatch</span>(threadCount);

        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; threadCount; i++) {
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
                <span class="hljs-keyword">try</span> {
                    <span class="hljs-comment">// 模拟任务</span>
                    Thread.sleep((<span class="hljs-type">long</span>) (Math.random() * <span class="hljs-number">2000</span>));
                    System.out.println(Thread.currentThread().getName() + <span class="hljs-string">" 完成任务"</span>);
                } <span class="hljs-keyword">catch</span> (InterruptedException e) {
                    Thread.currentThread().interrupt();
                } <span class="hljs-keyword">finally</span> {
                    latch.countDown(); <span class="hljs-comment">// 计数减1</span>
                }
            }).start();
        }

        latch.await(); <span class="hljs-comment">// 主线程等待所有任务完成</span>
        System.out.println(<span class="hljs-string">"所有任务已完成，继续执行后续逻辑"</span>);
    }
}
</code></pre>
<hr/>
<h3 data-id="heading-8">4. ReentrantReadWriteLock（读写锁）</h3>
<p><strong>特点</strong>：</p>
<ul>
<li>内部包含两个锁：ReadLock（共享）和 WriteLock（独占）</li>
<li>多个读线程可同时访问，但写线程必须独占</li>
<li>适用于“读多写少”场景</li>
</ul>
<h4 data-id="heading-9">示例代码（缓存读写）：</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.util.HashMap;
<span class="hljs-keyword">import</span> java.util.Map;
<span class="hljs-keyword">import</span> java.util.concurrent.locks.ReentrantReadWriteLock;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ReadWriteLockCache</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Map&lt;String, String&gt; cache = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">ReentrantReadWriteLock</span> <span class="hljs-variable">rwLock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantReadWriteLock</span>();

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">get</span><span class="hljs-params">(String key)</span> {
        rwLock.readLock().lock();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">return</span> cache.get(key);
        } <span class="hljs-keyword">finally</span> {
            rwLock.readLock().unlock();
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">put</span><span class="hljs-params">(String key, String value)</span> {
        rwLock.writeLock().lock();
        <span class="hljs-keyword">try</span> {
            cache.put(key, value);
        } <span class="hljs-keyword">finally</span> {
            rwLock.writeLock().unlock();
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">ReadWriteLockCache</span> <span class="hljs-variable">cache</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReadWriteLockCache</span>();
        cache.put(<span class="hljs-string">"name"</span>, <span class="hljs-string">"Alice"</span>);

        <span class="hljs-comment">// 多个读线程</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++) {
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
                System.out.println(Thread.currentThread().getName() + <span class="hljs-string">" 读取: "</span> + cache.get(<span class="hljs-string">"name"</span>));
            }).start();
        }
    }
}
</code></pre>
<hr/>
<h3 data-id="heading-10">5. Condition（条件变量）</h3>
<p><strong>特点</strong>：</p>
<ul>
<li>与 Lock 配合使用，替代 Object 的 wait/notify</li>
<li>一个 Lock 可以创建多个 Condition，实现更精细的线程通信</li>
</ul>
<h4 data-id="heading-11">示例代码（生产者-消费者模型）：</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.util.LinkedList;
<span class="hljs-keyword">import</span> java.util.Queue;
<span class="hljs-keyword">import</span> java.util.concurrent.locks.Condition;
<span class="hljs-keyword">import</span> java.util.concurrent.locks.ReentrantLock;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ProducerConsumerWithCondition</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Queue&lt;Integer&gt; buffer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedList</span>&lt;&gt;();
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">capacity</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">ReentrantLock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantLock</span>();
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Condition</span> <span class="hljs-variable">notFull</span> <span class="hljs-operator">=</span> lock.newCondition();
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Condition</span> <span class="hljs-variable">notEmpty</span> <span class="hljs-operator">=</span> lock.newCondition();

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">produce</span><span class="hljs-params">(<span class="hljs-type">int</span> item)</span> <span class="hljs-keyword">throws</span> InterruptedException {
        lock.lock();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">while</span> (buffer.size() == capacity) {
                System.out.println(<span class="hljs-string">"Buffer full, producer waiting..."</span>);
                notFull.await();
            }
            buffer.offer(item);
            System.out.println(<span class="hljs-string">"Produced: "</span> + item);
            notEmpty.signal(); <span class="hljs-comment">// 唤醒消费者</span>
        } <span class="hljs-keyword">finally</span> {
            lock.unlock();
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">consume</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException {
        lock.lock();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">while</span> (buffer.isEmpty()) {
                System.out.println(<span class="hljs-string">"Buffer empty, consumer waiting..."</span>);
                notEmpty.await();
            }
            <span class="hljs-type">int</span> <span class="hljs-variable">item</span> <span class="hljs-operator">=</span> buffer.poll();
            System.out.println(<span class="hljs-string">"Consumed: "</span> + item);
            notFull.signal(); <span class="hljs-comment">// 唤醒生产者</span>
            <span class="hljs-keyword">return</span> item;
        } <span class="hljs-keyword">finally</span> {
            lock.unlock();
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">ProducerConsumerWithCondition</span> <span class="hljs-variable">pc</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ProducerConsumerWithCondition</span>();

        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; i &lt;= <span class="hljs-number">5</span>; i++) {
                    pc.produce(i);
                    Thread.sleep(<span class="hljs-number">500</span>);
                }
            } <span class="hljs-keyword">catch</span> (InterruptedException e) {
                Thread.currentThread().interrupt();
            }
        }).start();

        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++) {
                    pc.consume();
                    Thread.sleep(<span class="hljs-number">1000</span>);
                }
            } <span class="hljs-keyword">catch</span> (InterruptedException e) {
                Thread.currentThread().interrupt();
            }
        }).start();
    }
}
</code></pre>
<hr/>
<h2 data-id="heading-12">三、总结</h2>



































<table><thead><tr><th>同步器</th><th>AQS 模式</th><th>典型用途</th></tr></thead><tbody><tr><td><code>ReentrantLock</code></td><td>独占</td><td>替代 synchronized，支持超时、中断、公平性</td></tr><tr><td><code>Semaphore</code></td><td>共享</td><td>控制并发线程数，资源池限流</td></tr><tr><td><code>CountDownLatch</code></td><td>共享</td><td>等待 N 个任务完成后再继续</td></tr><tr><td><code>ReentrantReadWriteLock</code></td><td>读（共享）/写（独占）</td><td>读多写少的并发访问控制</td></tr><tr><td><code>Condition</code></td><td>与 Lock 配合</td><td>精细线程通信（替代 wait/notify）</td></tr></tbody></table>
<p>这些类都封装了 AQS 的复杂性，让开发者可以专注于业务逻辑，而无需手动处理线程调度和状态管理。理解 AQS 的工作原理，有助于我们更高效、安全地使用这些并发工具。</p>
<blockquote>
<p><strong>提示</strong>：虽然 AQS 强大，但除非你正在开发新的同步组件（如自定义锁），否则一般不需要直接继承 AQS。日常开发中，优先使用 JUC 提供的标准同步器即可。</p>
</blockquote>
<hr/>
<p>希望本文能帮助你深入理解 AQS 及其在 JDK 中的应用。如果你有任何问题或想了解更底层的源码机制，欢迎留言讨论！</p>
<blockquote>
<p>作者：架构师Beata<br/>
日期：2026年1月25日<br/>
版权声明：本文可自由转载，但请保留出处</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[MySQL的锁机制、适用场景以及对应的解决方案]]></title>    <link>https://juejin.cn/post/7598881914203750450</link>    <guid>https://juejin.cn/post/7598881914203750450</guid>    <pubDate>2026-01-25T12:51:16.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598881914203750450" data-draft-id="7598921649888378907" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="MySQL的锁机制、适用场景以及对应的解决方案"/> <meta itemprop="keywords" content="后端,MySQL"/> <meta itemprop="datePublished" content="2026-01-25T12:51:16.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="三水不滴"/> <meta itemprop="url" content="https://juejin.cn/user/283045639753100"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            MySQL的锁机制、适用场景以及对应的解决方案
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/283045639753100/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    三水不滴
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-25T12:51:16.000Z" title="Sun Jan 25 2026 12:51:16 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    5
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读27分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">MySQL 锁机制全解析：所有锁类型、适用场景与落地解决方案</h2>
<p>MySQL 锁机制是数据库<strong>并发控制</strong>的核心，用于解决多事务同时操作数据时的<strong>脏读、不可重复读、幻读</strong>以及<strong>数据不一致</strong>问题，是保障数据一致性和高并发处理能力的基础。不同存储引擎的锁机制差异显著，其中 InnoDB 作为 MySQL 默认引擎，实现了<strong>细粒度的行级锁</strong>，并兼容表级锁，是互联网后端开发的核心研究对象；而 MyISAM 仅支持表级锁，现已逐步被淘汰。</p>
<p>本文将从<strong>锁的整体分类</strong>出发，详细讲解 MySQL 中<strong>所有锁类型</strong>的定义、特性、触发条件，结合互联网后端典型业务场景给出<strong>锁的选择策略与可落地的解决方案</strong>（含 SQL/Java 代码），同时分析生产高频的锁阻塞、死锁问题的定位与解决，兼顾面试八股文和生产实战需求。</p>
<h3 data-id="heading-1">一、MySQL 锁的整体分类</h3>
<p>MySQL 锁的分类维度多样，核心按<strong>锁粒度</strong>（最常用）、<strong>锁兼容性</strong>、<strong>实现方式</strong>划分，不同分类维度可交叉，例如 InnoDB 的行级锁包含共享行锁和排他行锁。以下是全维度分类体系，建立对 MySQL 锁的整体认知：</p>

























































































<table><thead><tr><th>分类维度</th><th>锁类型</th><th>核心存储引擎</th><th>锁粒度 / 特性</th><th>核心适用场景</th></tr></thead><tbody><tr><td><strong>锁粒度</strong></td><td>表级锁（Table Lock）</td><td>MyISAM/InnoDB</td><td>整表加锁，粒度粗，开销小，并发低</td><td>整表批量操作、静态数据修改</td></tr><tr><td/><td>行级锁（Row Lock）</td><td>InnoDB</td><td>单行加锁，粒度细，开销大，并发高</td><td>高并发单行 / 多行更新、读写混合场景</td></tr><tr><td/><td>页级锁（Page Lock）</td><td>BDB</td><td>数据页加锁，粒度介于表 / 行之间</td><td>极少使用，已被 InnoDB 替代</td></tr><tr><td><strong>锁兼容性</strong></td><td>共享锁（Shared Lock，S 锁）</td><td>InnoDB/MyISAM</td><td>读锁，多个 S 锁可共存</td><td>数据查询，不允许其他事务修改</td></tr><tr><td/><td>排他锁（Exclusive Lock，X 锁）</td><td>InnoDB/MyISAM</td><td>写锁，与任何锁互斥</td><td>数据插入 / 更新 / 删除</td></tr><tr><td><strong>实现方式</strong></td><td>意向锁（Intention Lock，IS/IX）</td><td>InnoDB</td><td>表级锁，配合行级锁使用</td><td>行级锁的前置锁，避免表锁与行锁冲突</td></tr><tr><td><strong>特殊锁</strong></td><td>记录锁（Record Lock）</td><td>InnoDB</td><td>行级锁的基础，锁定单行记录</td><td>单行精准更新</td></tr><tr><td/><td>间隙锁（Gap Lock）</td><td>InnoDB</td><td>行级锁，锁定索引间隙</td><td>防止幻读，区间查询</td></tr><tr><td/><td>临键锁（Next-Key Lock）</td><td>InnoDB</td><td>记录锁 + 间隙锁，InnoDB 默认行锁</td><td>RR 隔离级别下的行级锁默认形态</td></tr><tr><td/><td>元数据锁（MDL）</td><td>所有引擎</td><td>表级锁，锁定表结构</td><td>表结构修改（ALTER）、表查询</td></tr><tr><td/><td>自增锁（AUTO-INC Lock）</td><td>InnoDB</td><td>表级 / 行级，锁定自增列</td><td>自增主键的插入操作</td></tr></tbody></table>
<p><strong>核心前提</strong>：InnoDB 的锁机制依赖<strong>事务隔离级别</strong>，默认隔离级别为<strong>可重复读（RR）</strong> ，临键锁、间隙锁仅在 RR 级别生效；** 读已提交（RC）** 级别下，InnoDB 会关闭间隙锁，仅保留记录锁，并发更高但无法解决幻读。</p>
<h3 data-id="heading-2">二、各类型锁的详细解析</h3>
<p>本节将逐一讲解 MySQL 中<strong>所有锁类型</strong>的定义、触发条件、特性，重点聚焦 InnoDB 的锁机制（面试 + 生产核心），对 MyISAM/BDB 的锁仅做基础说明。</p>
<h4 data-id="heading-3">2.1 表级锁（Table Lock）：整表管控，简单高效</h4>
<p>表级锁是 MySQL 中<strong>粒度最粗</strong>的锁，对整张表加锁，分为<strong>表共享锁（S 锁）<strong>和</strong>表排他锁（X 锁）</strong> ，MyISAM 的默认锁，InnoDB 也支持手动加表锁。</p>
<h5 data-id="heading-4">核心特性</h5>
<ol>
<li>加锁 / 解锁开销小，无需遍历索引，执行速度快；</li>
<li>并发性能极低：加表 X 锁后，其他事务无法对该表执行<strong>任何读写操作</strong>；加表 S 锁后，其他事务可读但不可写；</li>
<li>InnoDB 中<strong>不建议默认使用</strong>，仅在整表批量操作时手动使用，否则会丧失行级锁的高并发优势。</li>
</ol>
<h5 data-id="heading-5">加锁 / 解锁 SQL（InnoDB/MyISAM 通用）</h5>
<pre><code class="hljs language-sql" lang="sql"># 手动加表共享锁（S锁），加锁后仅能读，不能写
LOCK TABLES `goods_stock` READ;
# 手动加表排他锁（X锁），加锁后禁止其他所有操作
LOCK TABLES `goods_stock` WRITE;
# 解锁（必须手动解锁，否则会话断开前一直持有）
UNLOCK TABLES;
</code></pre>
<h4 data-id="heading-6">2.2 行级锁（Row Lock）：InnoDB 核心，高并发基石</h4>
<p>行级锁是 InnoDB 的<strong>核心锁机制</strong>，粒度最细，仅对操作的<strong>单行 / 多行记录</strong>加锁，分为<strong>行共享锁（S 锁）<strong>和</strong>行排他锁（X 锁）</strong> ，是实现高并发读写的关键。</p>
<p>InnoDB 的行级锁并非直接锁定数据行，而是<strong>基于索引锁定</strong>（索引项加锁），若无索引或未使用索引，行级锁会<strong>退化为表级锁</strong>（生产高频坑点）。</p>
<p>根据锁定范围，InnoDB 的行级锁细分为<strong>记录锁、间隙锁、临键锁</strong>（三者为行级锁的具体实现，非独立分类），以下是详细说明：</p>
<h5 data-id="heading-7">2.2.1 记录锁（Record Lock）：精准锁定单行</h5>
<p><strong>定义</strong>：锁定<strong>索引上的单行记录</strong>，仅对当前存在的行生效，是最基础的行级锁。<strong>触发条件</strong>：<strong>精准匹配索引的等值查询</strong>（主键 / 唯一索引），RR/RC 隔离级别均生效。<strong>示例</strong>：通过商品 ID（主键）更新库存，InnoDB 会对<code>goods_id=1001</code>的索引项加记录锁，仅阻塞该单行的其他写操作，不影响其他商品。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">UPDATE</span> goods_stock <span class="hljs-keyword">SET</span> stock_num<span class="hljs-operator">=</span><span class="hljs-number">99</span> <span class="hljs-keyword">WHERE</span> goods_id<span class="hljs-operator">=</span><span class="hljs-number">1001</span>; # 主键等值查询，触发记录锁
</code></pre>
<h5 data-id="heading-8">2.2.2 间隙锁（Gap Lock）：锁定索引间隙，防止幻读</h5>
<p><strong>定义</strong>：锁定<strong>两个索引项之间的间隙</strong>（也包括索引首行前、末行后的间隙），不锁定具体行，目的是<strong>防止其他事务在该间隙插入数据</strong>，解决幻读问题。<strong>触发条件</strong>：<strong>RR 隔离级别下</strong>，对<strong>非唯一索引的范围查询 / 等值查询</strong>（未命中行）。<strong>特性</strong>：间隙锁之间<strong>互相兼容</strong>，多个事务可同时对同一间隙加间隙锁，仅阻塞插入操作。<strong>示例</strong>：商品表的非唯一索引<code>idx_category</code>（分类 ID）有值 [1,3,5]，执行范围查询<code>WHERE category_id&gt;2 AND category_id&lt;5</code>，InnoDB 会锁定间隙 (3,5)，其他事务无法在该间隙插入<code>category_id=4</code>的记录。</p>
<h5 data-id="heading-9">2.2.3 临键锁（Next-Key Lock）：InnoDB 默认行锁</h5>
<p><strong>定义</strong>：<strong>记录锁 + 间隙锁</strong>的组合，锁定<strong>当前索引行 + 其后续的索引间隙</strong>，是 InnoDB 在<strong>RR 隔离级别下的默认行级锁形态</strong>。<strong>触发条件</strong>：<strong>RR 隔离级别下</strong>，所有行级锁的默认触发（等值查询命中唯一索引时，临键锁会<strong>降级为记录锁</strong>）。<strong>核心作用</strong>：同时解决<strong>不可重复读</strong>和<strong>幻读</strong>，是 InnoDB RR 级别实现事务隔离的核心。<strong>示例</strong>：索引值 [1,3,5]，执行<code>WHERE category_id&lt;=3</code>，临键锁会锁定 (∞,1]、(1,3] 的记录 + 间隙，其他事务既不能修改 1、3 行，也不能在间隙中插入数据。</p>
<h4 data-id="heading-10">2.3 页级锁（Page Lock）：淘汰的中间方案</h4>
<p>页级锁是 BDB 存储引擎的锁机制，锁定<strong>数据页</strong>（InnoDB 默认 16KB / 页），粒度介于表级锁和行级锁之间。<strong>特性</strong>：加锁开销、并发性能也介于两者之间，无明显优势；<strong>现状</strong>：BDB 引擎已被 MySQL 官方逐步淘汰，实际开发中几乎不使用，无需深入研究。</p>
<h4 data-id="heading-11">2.4 意向锁（Intention Lock）：行级锁的 “前置锁”</h4>
<p>意向锁是 InnoDB 的<strong>表级锁</strong>，分为<strong>意向共享锁（IS）<strong>和</strong>意向排他锁（IX）</strong> ，是行级锁的<strong>前置锁</strong>——<strong>加行级锁前，必须先加对应的意向锁</strong>。</p>
<h5 data-id="heading-12">核心作用</h5>
<p>解决<strong>表级锁与行级锁的冲突检测问题</strong>，避免加表锁时遍历全表检查是否有行锁（大幅提升加锁效率）。</p>
<h5 data-id="heading-13">触发条件</h5>
<ul>
<li>加<strong>行 S 锁</strong>前，自动加<strong>表 IS 锁</strong>；</li>
<li>加<strong>行 X 锁</strong>前，自动加<strong>表 IX 锁</strong>；</li>
<li>意向锁由 InnoDB<strong>自动加锁 / 解锁</strong>，无需手动操作。</li>
</ul>
<h5 data-id="heading-14">特性</h5>
<ol>
<li>意向锁是<strong>表级锁</strong>，仅用于冲突检测，不阻塞任何读写操作；</li>
<li>意向锁之间<strong>互相兼容</strong>，IS 和 IX 可共存；</li>
<li>意向锁与表级锁<strong>互斥</strong>：表 X 锁与 IS/IX 均互斥，表 S 锁仅与 IX 互斥。</li>
</ol>
<h4 data-id="heading-15">2.5 特殊锁：生产高频易踩坑的锁类型</h4>
<p>这类锁并非传统的读写锁，而是 MySQL 为<strong>特殊场景</strong>设计的锁，是生产中<strong>锁阻塞、死锁</strong>的高频诱因，也是面试重点。</p>
<h5 data-id="heading-16">2.5.1 元数据锁（MDL）：表结构的 “隐形锁”</h5>
<p><strong>定义</strong>：MDL（Metadata Lock）是<strong>表级锁</strong>，锁定表的<strong>元数据（表结构）</strong> ，所有 MySQL 引擎均支持，<strong>自动加锁 / 解锁</strong>，无需手动操作。<strong>核心作用</strong>：保证<strong>表结构与数据的一致性</strong>，避免查询过程中表结构被修改（如查询时执行 ALTER TABLE）。</p>
<h5 data-id="heading-17">加锁规则（核心）</h5>
<p>MDL 锁分为 S 锁和 X 锁，加锁逻辑由 MySQL 自动控制，<strong>会话断开前一直持有</strong>：</p>
<ol>
<li>执行<strong>表查询操作</strong>（SELECT/SHOW），自动加<strong>MDL S 锁</strong>，多个 MDL S 锁可共存；</li>
<li>执行<strong>表结构修改操作</strong>（ALTER/DROP/RENAME），自动加<strong>MDL X 锁</strong>，与任何 MDL 锁互斥；</li>
<li>执行<strong>数据修改操作</strong>（INSERT/UPDATE/DELETE），自动加<strong>MDL S 锁</strong>（与查询一致）。</li>
</ol>
<h5 data-id="heading-18">生产高频问题</h5>
<p>高并发查询场景下，执行<code>ALTER TABLE</code>会加 MDL X 锁，而此时表上已有大量 MDL S 锁，导致：</p>
<ul>
<li>MDL X 锁等待所有 MDL S 锁释放；</li>
<li>后续所有查询 / 修改操作会排队等待 MDL X 锁释放，最终导致<strong>整个表的操作阻塞</strong>（生产重大故障）。</li>
</ul>
<h5 data-id="heading-19">2.5.2 自增锁（AUTO-INC Lock）：自增主键的专属锁</h5>
<p><strong>定义</strong>：AUTO-INC Lock 是 InnoDB 为<strong>自增列（AUTO_INCREMENT）<strong>设计的锁，用于保证</strong>自增列值的唯一性和连续性</strong>，避免批量插入时自增 ID 重复。</p>
<h5 data-id="heading-20">加锁模式（innodb_autoinc_lock_mode）</h5>
<p>InnoDB 通过参数<code>innodb_autoinc_lock_mode</code>控制自增锁的加锁粒度，默认值为<strong>1</strong>，可选 0/1/2，不同模式的并发性能不同：</p>

































<table><thead><tr><th>模式值</th><th>锁模式</th><th>特性</th><th>并发性能</th><th>适用场景</th></tr></thead><tbody><tr><td>0</td><td>传统模式</td><td>表级 AUTO-INC 锁，批量插入全程持有</td><td>最低</td><td>需严格连续自增 ID 的场景</td></tr><tr><td>1</td><td>连续模式（默认）</td><td>单行插入行级锁，批量插入表级锁</td><td>中等</td><td>常规业务（大部分场景）</td></tr><tr><td>2</td><td>交错模式</td><td>全程行级锁，自增 ID 可能不连续</td><td>最高</td><td>高并发批量插入（如分库分表）</td></tr></tbody></table>
<h5 data-id="heading-21">核心特性</h5>
<ul>
<li>模式 2 是<strong>并发性能最高</strong>的，但自增 ID 可能不连续（因多事务同时插入）；</li>
<li>主从复制中，若使用<strong>基于语句的复制（SBR）</strong> ，不建议使用模式 2（可能导致从库数据不一致），建议使用<strong>基于行的复制（RBR）</strong> 。</li>
</ul>
<h3 data-id="heading-22">三、MySQL 锁的兼容性矩阵</h3>
<p>锁的<strong>兼容性</strong>指<strong>同一资源上，已持有锁与请求锁是否能共存</strong>，兼容则请求锁成功，不兼容则请求锁的事务<strong>阻塞等待</strong>。</p>
<p>以下是 MySQL<strong>核心锁类型</strong>的兼容性矩阵（√= 兼容，×= 不兼容，—= 无关联），是理解锁阻塞的基础，面试高频考点：</p>








































































































<table><thead><tr><th>已持有锁 \ 请求锁</th><th>表 S 锁</th><th>表 X 锁</th><th>表 IS 锁</th><th>表 IX 锁</th><th>行 S 锁</th><th>行 X 锁</th><th>MDL S 锁</th><th>MDL X 锁</th></tr></thead><tbody><tr><td>表 S 锁</td><td>√</td><td>×</td><td>√</td><td>×</td><td>—</td><td>—</td><td>—</td><td>—</td></tr><tr><td>表 X 锁</td><td>×</td><td>×</td><td>×</td><td>×</td><td>—</td><td>—</td><td>—</td><td>—</td></tr><tr><td>表 IS 锁</td><td>√</td><td>×</td><td>√</td><td>√</td><td>—</td><td>—</td><td>—</td><td>—</td></tr><tr><td>表 IX 锁</td><td>×</td><td>×</td><td>√</td><td>√</td><td>—</td><td>—</td><td>—</td><td>—</td></tr><tr><td>行 S 锁</td><td>—</td><td>—</td><td>—</td><td>—</td><td>√</td><td>×</td><td>—</td><td>—</td></tr><tr><td>行 X 锁</td><td>—</td><td>—</td><td>—</td><td>—</td><td>×</td><td>×</td><td>—</td><td>—</td></tr><tr><td>MDL S 锁</td><td>—</td><td>—</td><td>—</td><td>—</td><td>—</td><td>—</td><td>√</td><td>×</td></tr><tr><td>MDL X 锁</td><td>—</td><td>—</td><td>—</td><td>—</td><td>—</td><td>—</td><td>×</td><td>×</td></tr></tbody></table>
<p><strong>核心结论</strong>：</p>
<ol>
<li>排他锁（表 X / 行 X/MDL X）与<strong>所有锁</strong>互斥，是锁阻塞的核心原因；</li>
<li>共享锁（表 S / 行 S/MDL S）与<strong>其他共享锁</strong>兼容，与<strong>排他锁</strong>互斥；</li>
<li>意向锁（IS/IX）仅与<strong>表级锁</strong>互斥，彼此之间完全兼容。</li>
</ol>
<h3 data-id="heading-23">四、InnoDB 锁的核心实现前提：基于索引</h3>
<p><strong>InnoDB 的行级锁是基于索引实现的，而非基于数据行本身</strong>，这是 InnoDB 锁机制的<strong>核心原则</strong>，也是生产中最容易踩坑的点。</p>
<h4 data-id="heading-24">核心推论</h4>
<ol>
<li><strong>使用索引加锁</strong>：只有通过<strong>主键 / 唯一索引 / 普通索引</strong>的查询条件操作数据，InnoDB 才会加行级锁；</li>
<li><strong>无索引 / 未使用索引→表级锁</strong>：若查询条件无索引，或有索引但未使用（如隐式类型转换），InnoDB 会对整张表加表级锁，导致并发性能骤降；</li>
<li><strong>锁的是索引项，而非数据行</strong>：即使两行数据的物理存储在一起，只要索引项不同，行级锁也不会冲突。</li>
</ol>
<h4 data-id="heading-25">坑点示例：隐式类型转换导致索引失效，行锁退表锁</h4>
<pre><code class="hljs language-sql" lang="sql"># 表结构：goods_id是<span class="hljs-type">BIGINT</span>类型（主键索引）
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `goods_stock` (
  `goods_id` <span class="hljs-type">BIGINT</span> UNSIGNED <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">PRIMARY</span> KEY,
  `stock_num` <span class="hljs-type">INT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>
) ENGINE<span class="hljs-operator">=</span>InnoDB;

# 错误：查询条件传入字符串，触发隐式类型转换，索引失效→行锁退表锁
<span class="hljs-keyword">UPDATE</span> goods_stock <span class="hljs-keyword">SET</span> stock_num<span class="hljs-operator">=</span><span class="hljs-number">99</span> <span class="hljs-keyword">WHERE</span> goods_id<span class="hljs-operator">=</span><span class="hljs-string">'1001'</span>; 
# 正确：查询条件类型与索引一致，使用主键索引→加记录锁
<span class="hljs-keyword">UPDATE</span> goods_stock <span class="hljs-keyword">SET</span> stock_num<span class="hljs-operator">=</span><span class="hljs-number">99</span> <span class="hljs-keyword">WHERE</span> goods_id<span class="hljs-operator">=</span><span class="hljs-number">1001</span>;
</code></pre>
<h3 data-id="heading-26">五、典型业务场景与锁机制解决方案</h3>
<p>结合互联网后端<strong>高并发、高可用</strong>的核心需求，针对 8 大典型业务场景，给出<strong>锁的选择策略、可落地的代码实现（SQL/Java）、生产注意事项</strong>，覆盖从单库到分布式、从常规操作到问题解决的全场景。</p>
<h4 data-id="heading-27">场景 1：整表批量操作（如全表数据更新、数据迁移）</h4>
<h5 data-id="heading-28">场景描述</h5>
<p>需要对整张表执行批量更新 / 删除（如批量修改商品价格、清理历史数据），涉及数据量占表的 80% 以上。</p>
<h5 data-id="heading-29">问题痛点</h5>
<p>若使用 InnoDB 默认的行级锁，会遍历全表加大量行锁，加锁开销大、执行速度慢，且容易引发锁冲突。</p>
<h5 data-id="heading-30">锁选择策略</h5>
<p><strong>手动加表级排他锁（WRITE）</strong> ，放弃行级锁的高并发，提升批量操作效率。</p>
<h5 data-id="heading-31">落地 SQL 实现</h5>
<pre><code class="hljs language-sql" lang="sql"># <span class="hljs-number">1.</span> 手动加表排他锁，阻塞其他所有操作
LOCK TABLES `goods` WRITE;
# <span class="hljs-number">2.</span> 执行批量操作（如批量将分类<span class="hljs-number">1</span>的商品价格打<span class="hljs-number">9</span>折）
<span class="hljs-keyword">UPDATE</span> `goods` <span class="hljs-keyword">SET</span> price<span class="hljs-operator">=</span>price<span class="hljs-operator">*</span><span class="hljs-number">0.9</span> <span class="hljs-keyword">WHERE</span> category_id<span class="hljs-operator">=</span><span class="hljs-number">1</span>;
# <span class="hljs-number">3.</span> 手动解锁，恢复表的正常操作
UNLOCK TABLES;
# <span class="hljs-number">4.</span> 若操作失败，直接解锁即可，无需回滚（表锁无事务特性）
</code></pre>
<h5 data-id="heading-32">生产注意事项</h5>
<ol>
<li>表级锁<strong>无事务特性</strong>，加锁后执行的操作立即生效，无需 COMMIT；</li>
<li>批量操作需在<strong>业务低峰期</strong>执行（如凌晨），避免阻塞正常业务；</li>
<li>操作前必须<strong>备份数据</strong>，防止批量更新错误。</li>
</ol>
<h4 data-id="heading-33">场景 2：高并发单行更新（如电商扣库存、秒杀减库存）</h4>
<h5 data-id="heading-34">场景描述</h5>
<p>高并发下对单行数据执行更新操作（如扣库存、修改用户余额），要求<strong>数据一致性</strong>，绝对避免超卖 / 超扣，冲突率高。</p>
<h5 data-id="heading-35">锁选择策略</h5>
<p><strong>InnoDB 行排他锁（记录锁）+ 显式事务</strong>（悲观锁），通过<code>FOR UPDATE</code>精准加行锁，保证事务原子性。</p>
<h5 data-id="heading-36">落地实现（SQL+Java）</h5>
<h6 data-id="heading-37">步骤 1：表结构设计（主键索引，保证行锁生效）</h6>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `goods_stock` (
  `goods_id` <span class="hljs-type">BIGINT</span> UNSIGNED <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">PRIMARY</span> KEY COMMENT <span class="hljs-string">'商品ID（主键）'</span>,
  `stock_num` <span class="hljs-type">INT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span> COMMENT <span class="hljs-string">'库存数量'</span>,
  `update_time` DATETIME <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> <span class="hljs-keyword">ON</span> <span class="hljs-keyword">UPDATE</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>
) ENGINE<span class="hljs-operator">=</span>InnoDB COMMENT<span class="hljs-operator">=</span><span class="hljs-string">'商品库存表'</span>;
# 初始化库存：商品<span class="hljs-number">1001</span>库存<span class="hljs-number">100</span>件
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> goods_stock (goods_id, stock_num) <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">1001</span>, <span class="hljs-number">100</span>);
</code></pre>
<h6 data-id="heading-38">步骤 2：SQL 显式事务 + FOR UPDATE 加记录锁</h6>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">BEGIN</span>; # 开启显式事务，关闭自动提交
# 主键等值查询，<span class="hljs-keyword">FOR</span> <span class="hljs-keyword">UPDATE</span>加行排他锁（记录锁）
<span class="hljs-keyword">SELECT</span> stock_num <span class="hljs-keyword">FROM</span> goods_stock <span class="hljs-keyword">WHERE</span> goods_id<span class="hljs-operator">=</span><span class="hljs-number">1001</span> <span class="hljs-keyword">FOR</span> <span class="hljs-keyword">UPDATE</span>;
# 扣减库存，业务层需先判断stock_num<span class="hljs-operator">&gt;</span><span class="hljs-number">0</span>
<span class="hljs-keyword">UPDATE</span> goods_stock <span class="hljs-keyword">SET</span> stock_num<span class="hljs-operator">=</span>stock_num<span class="hljs-number">-1</span> <span class="hljs-keyword">WHERE</span> goods_id<span class="hljs-operator">=</span><span class="hljs-number">1001</span> <span class="hljs-keyword">AND</span> stock_num<span class="hljs-operator">&gt;</span><span class="hljs-number">0</span>;
# 获取受影响行数，业务层判断是否扣减成功（<span class="hljs-number">0</span><span class="hljs-operator">=</span>库存不足）
<span class="hljs-keyword">SELECT</span> ROW_COUNT();
<span class="hljs-keyword">COMMIT</span>; # 提交事务，释放锁
# <span class="hljs-keyword">ROLLBACK</span>; # 若失败，回滚事务，释放锁
</code></pre>
<h6 data-id="heading-39">步骤 3：Java 业务层实现（Spring Boot）</h6>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-meta">@Transactional(rollbackFor = Exception.class)</span> <span class="hljs-comment">// 声明式事务，替代手动BEGIN/COMMIT</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StockService</span> {
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> JdbcTemplate jdbcTemplate;

    <span class="hljs-comment">/**
     * 扣减库存（悲观锁实现）
     * <span class="hljs-doctag">@param</span> goodsId 商品ID
     * <span class="hljs-doctag">@return</span> true=成功，false=库存不足
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">deductStock</span><span class="hljs-params">(Long goodsId)</span> {
        <span class="hljs-comment">// 1. 查询库存并加行锁（FOR UPDATE）</span>
        <span class="hljs-type">Integer</span> <span class="hljs-variable">stock</span> <span class="hljs-operator">=</span> jdbcTemplate.queryForObject(
                <span class="hljs-string">"SELECT stock_num FROM goods_stock WHERE goods_id=? FOR UPDATE"</span>,
                <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]{goodsId},
                Integer.class
        );
        <span class="hljs-keyword">if</span> (stock == <span class="hljs-literal">null</span> || stock &lt;= <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>; <span class="hljs-comment">// 库存不足</span>
        }
        <span class="hljs-comment">// 2. 扣减库存</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">row</span> <span class="hljs-operator">=</span> jdbcTemplate.update(
                <span class="hljs-string">"UPDATE goods_stock SET stock_num=stock_num-1 WHERE goods_id=? AND stock_num&gt;0"</span>,
                goodsId
        );
        <span class="hljs-keyword">return</span> row &gt; <span class="hljs-number">0</span>;
    }
}
</code></pre>
<h5 data-id="heading-40">生产注意事项</h5>
<ol>
<li><code>FOR UPDATE</code>必须在<strong>显式事务</strong>中使用，否则会自动提交，锁立即释放；</li>
<li>务必通过<strong>主键 / 唯一索引</strong>查询，避免行锁退表锁；</li>
<li>事务中仅包含核心操作，<strong>不执行耗时操作</strong>（如 RPC 调用、文件读写），缩短锁持有时间。</li>
</ol>
<h4 data-id="heading-41">场景 3：低冲突数据修改（如用户信息修改、订单状态更新）</h4>
<h5 data-id="heading-42">场景描述</h5>
<p>对数据执行修改操作，但<strong>冲突率极低</strong>（如用户修改昵称、订单状态从 “待支付” 改为 “已取消”），无需严格阻塞其他事务。</p>
<h5 data-id="heading-43">问题痛点</h5>
<p>若使用悲观锁（FOR UPDATE），会导致不必要的锁阻塞，降低并发性能。</p>
<h5 data-id="heading-44">锁选择策略</h5>
<p><strong>乐观锁</strong>（基于版本号 / 时间戳实现），无锁阻塞，通过版本号判断数据是否被修改，提升并发性能。</p>
<h5 data-id="heading-45">落地实现（SQL+Java）</h5>
<h6 data-id="heading-46">步骤 1：表结构新增版本号字段（乐观锁核心）</h6>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> `user_info` <span class="hljs-keyword">ADD</span> <span class="hljs-keyword">COLUMN</span> `version` <span class="hljs-type">INT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span> COMMENT <span class="hljs-string">'乐观锁版本号'</span>;
<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> `order_info` <span class="hljs-keyword">ADD</span> <span class="hljs-keyword">COLUMN</span> `version` <span class="hljs-type">INT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span> COMMENT <span class="hljs-string">'乐观锁版本号'</span>;
</code></pre>
<h6 data-id="heading-47">步骤 2：SQL 乐观锁更新逻辑</h6>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">BEGIN</span>;
# <span class="hljs-number">1.</span> 查询用户信息和版本号
<span class="hljs-keyword">SELECT</span> nickname, version <span class="hljs-keyword">FROM</span> user_info <span class="hljs-keyword">WHERE</span> user_id<span class="hljs-operator">=</span><span class="hljs-number">10086</span>;
# <span class="hljs-number">2.</span> 更新昵称，仅当版本号匹配时执行（保证基于最新版本修改）
<span class="hljs-keyword">UPDATE</span> user_info <span class="hljs-keyword">SET</span> nickname<span class="hljs-operator">=</span><span class="hljs-string">'新昵称'</span>, version<span class="hljs-operator">=</span>version<span class="hljs-operator">+</span><span class="hljs-number">1</span> <span class="hljs-keyword">WHERE</span> user_id<span class="hljs-operator">=</span><span class="hljs-number">10086</span> <span class="hljs-keyword">AND</span> version<span class="hljs-operator">=</span>#{oldVersion};
# <span class="hljs-number">3.</span> 判断受影响行数，<span class="hljs-number">0</span><span class="hljs-operator">=</span>数据已被其他事务修改
<span class="hljs-keyword">SELECT</span> ROW_COUNT();
<span class="hljs-keyword">COMMIT</span>;
</code></pre>
<h6 data-id="heading-48">步骤 3：Java 业务层实现（带重试机制）</h6>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-variable">@Service</span>
public class UserService {
    <span class="hljs-variable">@Autowired</span>
    private UserMapper userMapper;
    <span class="hljs-operator">/</span><span class="hljs-operator">/</span> 最大重试次数
    private <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> MAX_RETRY <span class="hljs-operator">=</span> <span class="hljs-number">3</span>;

    <span class="hljs-comment">/**
     * 修改用户昵称（乐观锁+重试）
     * @param userId 用户ID
     * @param newNickname 新昵称
     * @return true=成功
     */</span>
    public <span class="hljs-type">boolean</span> updateNickname(Long userId, String newNickname) {
        <span class="hljs-type">int</span> retry <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
        while (retry <span class="hljs-operator">&lt;</span> MAX_RETRY) {
            <span class="hljs-operator">/</span><span class="hljs-operator">/</span> <span class="hljs-number">1.</span> 查询用户最新信息和版本号
            UserInfo <span class="hljs-keyword">user</span> <span class="hljs-operator">=</span> userMapper.selectById(userId);
            if (<span class="hljs-keyword">user</span> <span class="hljs-operator">=</span><span class="hljs-operator">=</span> <span class="hljs-keyword">null</span>) {
                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
            }
            <span class="hljs-operator">/</span><span class="hljs-operator">/</span> <span class="hljs-number">2.</span> 执行乐观锁更新
            <span class="hljs-type">int</span> <span class="hljs-type">row</span> <span class="hljs-operator">=</span> userMapper.updateNickname(userId, newNickname, user.getVersion());
            if (<span class="hljs-type">row</span> <span class="hljs-operator">&gt;</span> <span class="hljs-number">0</span>) {
                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>; <span class="hljs-operator">/</span><span class="hljs-operator">/</span> 更新成功
            }
            retry<span class="hljs-operator">+</span><span class="hljs-operator">+</span>; <span class="hljs-operator">/</span><span class="hljs-operator">/</span> 更新失败，重试
            try {
                Thread.sleep(<span class="hljs-number">100</span>); <span class="hljs-operator">/</span><span class="hljs-operator">/</span> 短暂休眠，避免瞬时冲突
            } catch (InterruptedException e) {
                Thread.currentThread().interrupt();
            }
        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>; <span class="hljs-operator">/</span><span class="hljs-operator">/</span> 重试多次失败
    }
}

<span class="hljs-operator">/</span><span class="hljs-operator">/</span> Mapper接口
public interface UserMapper {
    <span class="hljs-variable">@Select</span>("SELECT user_id, nickname, version FROM user_info WHERE user_id=#{userId}")
    UserInfo selectById(Long userId);

    <span class="hljs-variable">@Update</span>("UPDATE user_info SET nickname=#{newNickname}, version=version+1 WHERE user_id=#{userId} AND version=#{oldVersion}")
    <span class="hljs-type">int</span> updateNickname(<span class="hljs-variable">@Param</span>("userId") Long userId, <span class="hljs-variable">@Param</span>("newNickname") String newNickname, <span class="hljs-variable">@Param</span>("oldVersion") <span class="hljs-type">Integer</span> oldVersion);
}
</code></pre>
<h5 data-id="heading-49">生产注意事项</h5>
<ol>
<li>乐观锁<strong>无实际加锁</strong>，通过版本号实现冲突检测，适用于<strong>读多写少、冲突率低</strong>的场景；</li>
<li>必须增加<strong>重试机制</strong>，若更新失败，说明数据被其他事务修改，重试即可；</li>
<li>版本号建议使用<strong>INT/BIGINT</strong>，避免使用时间戳（存在并发下时间戳相同的情况）。</li>
</ol>
<h4 data-id="heading-50">场景 4：防幻读业务（如区间查询并更新、批量筛选数据）</h4>
<h5 data-id="heading-51">场景描述</h5>
<p>需要对<strong>索引区间</strong>内的数据执行查询并更新（如查询 “2025-01-01 至 2025-01-10” 的订单并修改状态），要求<strong>解决幻读</strong>（避免更新过程中其他事务在该区间插入新数据）。</p>
<h5 data-id="heading-52">锁选择策略</h5>
<p><strong>InnoDB 临键锁</strong>（RR 隔离级别默认），无需手动加锁，通过<strong>范围查询</strong>触发临键锁，锁定区间内的记录 + 间隙，防止幻读。</p>
<h5 data-id="heading-53">落地 SQL 实现</h5>
<pre><code class="hljs language-sql" lang="sql"># 订单表：create_time为DATETIME类型，有索引idx_create_time
# RR隔离级别下，范围查询自动触发临键锁，防止幻读
<span class="hljs-keyword">BEGIN</span>;
# 范围查询<span class="hljs-number">2025</span><span class="hljs-number">-01</span><span class="hljs-number">-01</span>至<span class="hljs-number">2025</span><span class="hljs-number">-01</span><span class="hljs-number">-10</span>的订单，触发临键锁
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> order_info <span class="hljs-keyword">WHERE</span> create_time <span class="hljs-keyword">BETWEEN</span> <span class="hljs-string">'2025-01-01'</span> <span class="hljs-keyword">AND</span> <span class="hljs-string">'2025-01-10'</span> <span class="hljs-keyword">FOR</span> <span class="hljs-keyword">UPDATE</span>;
# 修改该区间内的订单状态为“已完成”
<span class="hljs-keyword">UPDATE</span> order_info <span class="hljs-keyword">SET</span> order_status<span class="hljs-operator">=</span><span class="hljs-number">3</span> <span class="hljs-keyword">WHERE</span> create_time <span class="hljs-keyword">BETWEEN</span> <span class="hljs-string">'2025-01-01'</span> <span class="hljs-keyword">AND</span> <span class="hljs-string">'2025-01-10'</span>;
<span class="hljs-keyword">COMMIT</span>;
</code></pre>
<h5 data-id="heading-54">生产注意事项</h5>
<ol>
<li>必须在<strong>RR 隔离级别</strong>下执行，RC 级别会关闭间隙锁，无法解决幻读；</li>
<li>范围查询的字段必须<strong>建立索引</strong>，否则行锁退表锁；</li>
<li>临键锁的锁定范围较大，尽量缩小查询区间，减少锁冲突。</li>
</ol>
<h4 data-id="heading-55">场景 5：高并发批量插入（如分库分表插入、日志批量写入）</h4>
<h5 data-id="heading-56">场景描述</h5>
<p>高并发下对表执行批量插入操作（如分库分表的订单插入、系统日志批量写入），自增主键的插入性能成为瓶颈。</p>
<h5 data-id="heading-57">问题痛点</h5>
<p>InnoDB 默认的自增锁模式（innodb_autoinc_lock_mode=1）在批量插入时会加表级锁，导致插入性能低。</p>
<h5 data-id="heading-58">锁优化策略</h5>
<p>修改自增锁模式为<strong>2（交错模式）</strong> ，全程使用行级锁，提升批量插入的并发性能。</p>
<h5 data-id="heading-59">落地配置 + 实现</h5>
<h6 data-id="heading-60">步骤 1：修改 MySQL 配置（my.cnf/my.ini）</h6>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-section">[mysqld]</span>
<span class="hljs-comment"># 自增锁模式改为2（交错模式），高并发批量插入最优</span>
<span class="hljs-attr">innodb_autoinc_lock_mode</span> = <span class="hljs-number">2</span>
<span class="hljs-comment"># 开启基于行的复制（RBR），配合模式2使用，避免主从数据不一致</span>
<span class="hljs-attr">binlog_format</span> = ROW
</code></pre>
<h6 data-id="heading-61">步骤 2：Java 批量插入实现（MyBatis-Plus）</h6>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderService</span> {
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> OrderMapper orderMapper;

    <span class="hljs-comment">/**
     * 高并发批量插入订单
     * <span class="hljs-doctag">@param</span> orderList 订单列表
     * <span class="hljs-doctag">@return</span> 插入成功数
     */</span>
    <span class="hljs-meta">@Transactional(rollbackFor = Exception.class)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">batchInsert</span><span class="hljs-params">(List&lt;OrderInfo&gt; orderList)</span> {
        <span class="hljs-keyword">return</span> orderMapper.saveBatch(orderList, <span class="hljs-number">100</span>); <span class="hljs-comment">// 每次插入100条，分批提交</span>
    }
}
</code></pre>
<h5 data-id="heading-62">生产注意事项</h5>
<ol>
<li>模式 2 的自增 ID<strong>可能不连续</strong>，但不影响业务（无需严格连续的场景均可使用）；</li>
<li>必须配合<strong>binlog_format=ROW</strong>（基于行的复制）使用，若使用 SBR（基于语句的复制），会导致主从数据不一致；</li>
<li>批量插入建议<strong>分批提交</strong>（如每次 100/500 条），避免单事务插入数据过多，导致事务过大。</li>
</ol>
<h4 data-id="heading-63">场景 6：生产高频问题 ——MDL 锁阻塞（查询时执行 ALTER TABLE）</h4>
<h5 data-id="heading-64">问题描述</h5>
<p>高并发查询场景下，执行<code>ALTER TABLE</code>修改表结构，导致<strong>整个表的所有操作（查询 / 修改）全部阻塞</strong>，数据库连接数暴涨，最终引发生产故障。</p>
<h5 data-id="heading-65">问题根因</h5>
<ul>
<li>高并发查询持有大量<strong>MDL S 锁</strong>；</li>
<li>执行<code>ALTER TABLE</code>需要加<strong>MDL X 锁</strong>，与 MDL S 锁互斥，X 锁等待所有 S 锁释放；</li>
<li>后续所有查询 / 修改操作需要加 MDL S 锁，排队等待 X 锁释放，形成<strong>阻塞链</strong>。</li>
</ul>
<h5 data-id="heading-66">解决方案</h5>
<p>使用<strong>在线 DDL 工具</strong>（如 pt-online-schema-change/gh-ost），避免直接执行<code>ALTER TABLE</code>，工具会通过<strong>分批次复制数据、触发器同步增量</strong>的方式修改表结构，全程不持有 MDL X 锁，不阻塞业务。</p>
<h5 data-id="heading-67">落地实现（pt-online-schema-change）</h5>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 安装percona-toolkit工具</span>
yum install percona-toolkit -y
<span class="hljs-comment"># 在线修改表结构：为order_info表新增字段remark（VARCHAR(255)）</span>
<span class="hljs-comment"># --alter：要执行的DDL语句</span>
<span class="hljs-comment"># D=数据库名，t=表名</span>
<span class="hljs-comment"># h=数据库IP，u=用户名，p=密码</span>
pt-online-schema-change --alter <span class="hljs-string">"ADD COLUMN remark VARCHAR(255) DEFAULT '' COMMENT '备注'"</span> D=shop,t=order_info h=127.0.0.1,u=root,p=123456 --execute
</code></pre>
<h5 data-id="heading-68">生产注意事项</h5>
<ol>
<li>禁止在<strong>高并发时段</strong>直接执行<code>ALTER TABLE</code>，即使使用在线 DDL 工具，也需在低峰期执行；</li>
<li>在线 DDL 工具会产生<strong>临时表和触发器</strong>，执行前需保证数据库有足够的磁盘空间和权限；</li>
<li>执行前先通过<code>pt-online-schema-change --dry-run</code>模拟执行，检查是否有错误。</li>
</ol>
<h4 data-id="heading-69">场景 7：分布式系统并发控制（微服务 / 分库分表下的扣库存）</h4>
<h5 data-id="heading-70">场景描述</h5>
<p>系统为<strong>分布式部署</strong>（多服务实例 / 多数据库实例），高并发下执行扣库存 / 下单操作，单库的行级锁 / 乐观锁无法解决<strong>跨实例的并发冲突</strong>，导致超卖。</p>
<h5 data-id="heading-71">锁选择策略</h5>
<p><strong>Redis 分布式锁 + InnoDB 行级锁</strong>，双重锁机制：</p>
<ol>
<li><strong>Redis 分布式锁</strong>：解决跨实例的并发冲突，保证同一商品只有一个实例能执行扣库存；</li>
<li><strong>InnoDB 行级锁</strong>：解决单库内的并发冲突，保证单实例内的数据一致性。</li>
</ol>
<h5 data-id="heading-72">落地实现（Java+Redis+MySQL）</h5>
<h6 data-id="heading-73">步骤 1：Redis 分布式锁工具类（基于 Redisson，推荐生产使用）</h6>
<p>Redisson 是 Redis 官方推荐的分布式锁实现，解决了<strong>死锁、锁超时、重入</strong>等问题，比手动实现的 Redis 锁更稳定。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedissonConfig</span> {
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> RedissonClient <span class="hljs-title function_">redissonClient</span><span class="hljs-params">()</span> {
        <span class="hljs-type">Config</span> <span class="hljs-variable">config</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Config</span>();
        config.useSingleServer().setAddress(<span class="hljs-string">"redis://127.0.0.1:6379"</span>).setPassword(<span class="hljs-string">"123456"</span>);
        <span class="hljs-keyword">return</span> Redisson.create(config);
    }
}
</code></pre>
<h6 data-id="heading-74">步骤 2：分布式扣库存核心实现</h6>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DistributeStockService</span> {
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> RedissonClient redissonClient;
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> StockService stockService; <span class="hljs-comment">// 场景2的悲观锁扣库存服务</span>

    <span class="hljs-comment">/**
     * 分布式扣库存（Redis分布式锁+MySQL行级锁）
     * <span class="hljs-doctag">@param</span> goodsId 商品ID
     * <span class="hljs-doctag">@return</span> true=成功
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">deductDistributeStock</span><span class="hljs-params">(Long goodsId)</span> {
        <span class="hljs-comment">// 1. 定义Redis分布式锁的key（按商品ID区分，细粒度锁）</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">lockKey</span> <span class="hljs-operator">=</span> <span class="hljs-string">"stock:lock:"</span> + goodsId;
        <span class="hljs-type">RLock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> redissonClient.getLock(lockKey);
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 2. 获取分布式锁，等待3秒，持有10秒（避免死锁）</span>
            <span class="hljs-type">boolean</span> <span class="hljs-variable">lockSuccess</span> <span class="hljs-operator">=</span> lock.tryLock(<span class="hljs-number">3</span>, <span class="hljs-number">10</span>, TimeUnit.SECONDS);
            <span class="hljs-keyword">if</span> (!lockSuccess) {
                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>; <span class="hljs-comment">// 获取锁失败，直接返回</span>
            }
            <span class="hljs-comment">// 3. 获取锁成功，执行MySQL行级锁扣库存</span>
            <span class="hljs-keyword">return</span> stockService.deductStock(goodsId);
        } <span class="hljs-keyword">catch</span> (InterruptedException e) {
            Thread.currentThread().interrupt();
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-comment">// 4. 释放分布式锁（必须在finally中释放，避免锁泄漏）</span>
            <span class="hljs-keyword">if</span> (lock.isHeldByCurrentThread()) {
                lock.unlock();
            }
        }
    }
}
</code></pre>
<h5 data-id="heading-75">生产注意事项</h5>
<ol>
<li>分布式锁的<strong>锁粒度要细</strong>（如按商品 ID / 用户 ID），避免使用全局锁（如 stock:lock），导致并发性能低；</li>
<li>必须设置<strong>锁超时时间</strong>，避免服务宕机导致锁无法释放（死锁）；</li>
<li>推荐使用<strong>Redisson</strong>实现分布式锁，避免手动实现的锁存在漏洞（如 SETNX 未加过期时间）。</li>
</ol>
<h4 data-id="heading-76">场景 8：生产高频问题 —— 死锁的定位、解决与预防</h4>
<h5 data-id="heading-77">死锁定义</h5>
<p>两个或多个事务<strong>互相持有对方需要的锁</strong>，且均不释放自己的锁，导致彼此永久阻塞，是 MySQL 锁机制的常见问题。</p>
<h5 data-id="heading-78">死锁示例</h5>
<p>事务 A 持有 goods_id=1001 的行锁，请求 goods_id=1002 的行锁；事务 B 持有 goods_id=1002 的行锁，请求 goods_id=1001 的行锁，形成互相等待。</p>
<h5 data-id="heading-79">步骤 1：死锁的定位（MySQL 内置命令）</h5>
<p>InnoDB 会<strong>自动检测死锁</strong>，并回滚其中一个事务（代价最小的），但需手动定位死锁原因，避免再次发生。</p>
<pre><code class="hljs language-sql" lang="sql"># <span class="hljs-number">1.</span> 开启死锁日志（my.cnf配置，永久生效）
innodb_print_all_deadlocks <span class="hljs-operator">=</span> <span class="hljs-number">1</span>
# <span class="hljs-number">2.</span> 查看最新的死锁详情（核心命令）
<span class="hljs-keyword">SHOW</span> ENGINE INNODB STATUS;
# <span class="hljs-number">3.</span> 查看当前活跃事务、锁等待情况
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> information_schema.INNODB_TRX; # 活跃事务
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> information_schema.INNODB_LOCK_WAITS; # 锁等待
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> information_schema.INNODB_LOCKS; # 持有锁
</code></pre>
<p><strong>核心查看点</strong>：<code>SHOW ENGINE INNODB STATUS</code>的<code>LATEST DEADLOCK</code>部分，包含死锁的事务、持有的锁、请求的锁，是定位根因的关键。</p>
<h5 data-id="heading-80">步骤 2：死锁的解决</h5>
<ol>
<li><strong>立即解决</strong>：InnoDB 会自动回滚代价最小的事务，无需手动干预；若未自动回滚，可通过<code>KILL [事务ID]</code>杀死阻塞的事务；</li>
<li><strong>根本解决</strong>：根据死锁定位结果，优化事务的加锁逻辑，避免互相等待。</li>
</ol>
<h5 data-id="heading-81">步骤 3：死锁的预防（生产最佳实践）</h5>
<p>死锁的核心诱因是<strong>事务加锁顺序不一致、锁持有时间过长、锁定范围过大</strong>，针对性预防即可：</p>
<ol>
<li><strong>统一加锁顺序</strong>：多个事务对多张表 / 多行数据加锁时，必须遵循<strong>相同的加锁顺序</strong>（如先锁 goods_id=1001，再锁 goods_id=1002）；</li>
<li><strong>缩短锁持有时间</strong>：事务中仅包含核心操作，<strong>不执行耗时操作</strong>（如 RPC 调用、文件读写、睡眠），快速提交 / 回滚事务；</li>
<li><strong>缩小锁定范围</strong>：尽量使用<strong>主键 / 唯一索引</strong>的等值查询，触发记录锁，避免临键锁 / 表锁的大范围锁定；</li>
<li><strong>设置锁等待超时</strong>：通过参数<code>innodb_lock_wait_timeout</code>设置行锁等待超时时间（默认 50 秒，建议改为 10 秒），避免永久阻塞；</li>
<li><strong>避免大事务</strong>：将大事务拆分为多个小事务，减少锁的持有时间和锁定范围。</li>
</ol>
<h3 data-id="heading-82">六、MySQL 锁机制优化最佳实践</h3>
<p>MySQL 锁机制的优化核心是<strong>减少锁冲突、缩短锁持有时间、提升并发性能</strong>，结合索引、事务、配置、架构四个维度，给出生产可落地的最佳实践，覆盖 90% 以上的锁优化场景：</p>
<h4 data-id="heading-83">6.1 索引优化：行级锁的基础</h4>
<ol>
<li>所有<strong>写操作（UPDATE/DELETE/FOR UPDATE）<strong>的 WHERE 条件必须</strong>使用主键 / 唯一索引 / 普通索引</strong>，避免行锁退表锁；</li>
<li>避免<strong>隐式类型转换、使用函数操作索引</strong>，导致索引失效；</li>
<li>合理设计索引，遵循<strong>最左匹配、覆盖索引、避免冗余索引</strong>原则，提升查询效率，减少锁的持有时间。</li>
</ol>
<h4 data-id="heading-84">6.2 事务优化：缩短锁持有时间</h4>
<ol>
<li>使用<strong>显式事务</strong>，替代自动提交（autocommit=1），精准控制事务的开始和结束；</li>
<li><strong>事务中仅包含核心业务操作</strong>，不执行耗时操作（RPC 调用、文件读写、睡眠）；</li>
<li>拆分<strong>大事务</strong>为多个小事务，减少锁的持有时间和锁定范围；</li>
<li>根据业务需求选择<strong>合适的隔离级别</strong>：读多写少、无需解决幻读的场景，可将隔离级别改为<strong>RC</strong>，关闭间隙锁，提升并发性能。</li>
</ol>
<h4 data-id="heading-85">6.3 配置优化：适配高并发</h4>
<ol>
<li>高并发批量插入场景，将<code>innodb_autoinc_lock_mode</code>改为 2，<code>binlog_format</code>改为 ROW；</li>
<li>设置合理的<strong>锁等待超时</strong>：<code>innodb_lock_wait_timeout=10</code>（秒），避免永久阻塞；</li>
<li>开启死锁日志：<code>innodb_print_all_deadlocks=1</code>，方便定位死锁问题；</li>
<li>调大 InnoDB 缓冲池：<code>innodb_buffer_pool_size</code>设置为物理内存的 50%-70%，提升查询效率，减少锁冲突。</li>
</ol>
<h4 data-id="heading-86">6.4 架构优化：从单库到分布式</h4>
<ol>
<li><strong>读多写少</strong>的场景，使用<strong>主从复制 + 读写分离</strong>，主库负责写操作（加锁），从库负责读操作，分散数据库压力；</li>
<li><strong>单表数据量过大</strong>（千万 / 亿级），使用<strong>分库分表</strong>，将大表拆分为多个小表，分散锁的冲突；</li>
<li><strong>分布式系统</strong>，使用<strong>Redis 分布式锁 + MySQL 行级锁</strong>，解决跨实例的并发冲突；</li>
<li>避免<strong>跨库联表查询</strong>，尽量在业务层做关联，减少分布式场景下的锁复杂度。</li>
</ol>
<h3 data-id="heading-87">七、总结</h3>
<p>MySQL 锁机制是数据库并发控制的核心，<strong>InnoDB 的行级锁</strong>是互联网后端开发的重点，其设计的核心是<strong>基于索引、细粒度管控、高并发适配</strong>。掌握 MySQL 锁机制的关键，不仅要理解各类锁的定义、特性、兼容性（面试八股文），更要结合<strong>业务场景</strong>选择合适的锁策略 ——<strong>悲观锁适用于高冲突场景，乐观锁适用于低冲突场景，分布式锁适用于跨实例场景</strong>。</p>
<p>生产中绝大多数的锁问题（锁阻塞、死锁、行锁退表锁），根源并非锁机制本身，而是<strong>索引设计不合理、事务编写不规范、锁选择策略不当</strong>。因此，锁机制的优化并非孤立的，而是与<strong>索引优化、事务优化、架构优化</strong>深度结合的系统性工程。</p>
<p>对于 Java 后端开发而言，掌握 MySQL 锁机制是应对大厂面试、解决生产并发问题的必备技能，核心原则可总结为：<strong>索引为基、事务为纲、锁随场景、优化随行</strong>。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[HashMap 线程不安全怎么办？从 Hashtable 到 ConcurrentHashMap 的完美解答]]></title>    <link>https://juejin.cn/post/7598734303174098996</link>    <guid>https://juejin.cn/post/7598734303174098996</guid>    <pubDate>2026-01-25T13:25:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598734303174098996" data-draft-id="7597266967139139618" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="HashMap 线程不安全怎么办？从 Hashtable 到 ConcurrentHashMap 的完美解答"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-25T13:25:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="用户49793230963"/> <meta itemprop="url" content="https://juejin.cn/user/4461159469290944"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            HashMap 线程不安全怎么办？从 Hashtable 到 ConcurrentHashMap 的完美解答
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4461159469290944/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    用户49793230963
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-25T13:25:59.000Z" title="Sun Jan 25 2026 13:25:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>“在 Java 集合框架体系中，容器主要根据并发特性划分为<strong>线程安全</strong>与<strong>非线程安全</strong>两大阵营。纵观 JDK 的迭代历程，容器的演进本质上是设计者在**并发安全（Safety）<strong>与</strong>执行性能（Performance）**之间不断权衡与博弈的过程。这一演进脉络，不仅记录了技术的更迭，更为我们深入理解并发编程的设计哲学提供了宝贵的范本。”</p>
<p>那么什么是“线程安全”？
我们来看一下线程安全的定义：
<strong>Brian Goetz 给出的定义是：</strong></p>
<blockquote>
<p>“当多个线程访问一个类时，如果不用考虑这些线程在运行时环境下的调度和交替执行，并且不需要额外的同步，这个类都能表现出<strong>正确的行为</strong>，那么这个类就是线程安全的。”</p>
</blockquote>
<p>为了更好理解，可以将这个定义拆解为三个关键词：</p>
<ul>
<li>
<p><strong>多线程访问</strong>：这是前提条件。如果是单线程，谈论线程安全没有意义。</p>
</li>
<li>
<p><strong>无须额外同步</strong>：使用者（调用方）不需要自己加锁（如 <code>synchronized</code> 或 <code>Lock</code>），这个类内部已经处理好了。</p>
</li>
<li>
<p><strong>正确的行为</strong>：无论线程怎么抢占 CPU，结果永远符合预期。比如计数器不会少算，转账金额不会凭空消失。</p>
</li>
</ul>
<p>其实其实所谓的安全 无非就是解决了这三个问题</p>
<ul>
<li>
<p><strong>原子性 (Atomicity)</strong> ：操作要么全部执行，要么全不执行，不能被中断。（例如：<code>i++</code> 不是原子的）。</p>
</li>
<li>
<p><strong>可见性 (Visibility)</strong> ：一个线程修改了数据，其他线程能立刻看到。（例如：<code>volatile</code> 关键字）。</p>
</li>
<li>
<p><strong>有序性 (Ordering)</strong> ：程序代码按照预期的顺序执行，禁止指令重排。
这三个问题也是并发编程的三大核心 从内在的JMM 到表现在程序里面的volatile synchronized RLock 再到无锁操作CAS本质上都是为了在保证一定性能的同时去解决 原子性 可见性 有序性。</p>
</li>
</ul>
<p>从最早的“全表锁”到现在的“无锁化（CAS）”和“分段思想”，JDK 的每一次迭代都在试图解决一个核心矛盾：<strong>如何在保证数据不乱的前提下，让多线程跑得更快？</strong></p>
<p>我将 Java 容器的发展分为<strong>三个时代</strong>，为你梳理这条演进之路：</p>
<h4 data-id="heading-0">第一时代：上古时代的“绝对安全” (JDK 1.0)</h4>
<p>此时的JDK处于刚刚发展阶段 为了保证安全宁愿这个实现的方式简单粗暴</p>
<p>观看HashTable的源码 发现它涉及到修改操作的方法都是被synchronized 关键字包围的 比如说</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5f4270ae57ff41e8849d65c1ee81a864~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3NDk3OTMyMzA5NjM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769952359&amp;x-signature=uuyMbDqaSkdePTjxBftEPCg0GBQ%3D" alt="image.png" loading="lazy"/></p>
<p>这种操作无疑可以保证多线程下的 可见性 原子性 有序性 因为加锁本质上就是只允许同一时间 只能有一个线程去进行操作 但是这种设计真的够优雅吗 答案是否定的 本质上加锁的操作极大的影响了性能 我们可能很多时候只有一个线程去执行 所以我们需要一种更快速的容器</p>
<h4 data-id="heading-1">第二时代：性能觉醒的“裸奔时代” (JDK 1.2)</h4>
<p>在经历了 JDK 1.0 中 <code>Vector</code> 和 <code>Hashtable</code> 的“笨重”之后，JDK 1.2 迎来了一次彻底的<strong>思想解放</strong>。设计者意识到：在绝大多数实际应用场景中，容器仅仅是在<strong>单线程</strong>环境下作为局部变量使用的。</p>
<p>为了那 1% 的并发场景，让 99% 的单线程场景都背负沉重的锁竞争开销，这是极不划算的。于是， <strong>“性能至上”</strong> 成为了这一时期的绝对信条。</p>
<p>标题所说的HashMap正是这个阶段诞生的 观看源码可以看出 此时的容器发展完全牺牲了并发安全这个要素 它的所有操作都没有锁 这也导致了性能的极致 但也为并发安全性埋下了隐患</p>
<ul>
<li><strong>JDK 1.7</strong>：多线程扩容会导致链表成环，CPU 飙升 100%。</li>
<li><strong>JDK 1.8</strong>：多线程 Put 会导致数据直接覆盖（丢失）。</li>
<li><strong>但这不重要</strong>：在设计者的眼里，这些问题是使用者应该去规避的，容器本身的职责就是<strong>快</strong>。</li>
</ul>
<p>可是我们真的没有办法在并发安全和性能做一个平衡 真的做不到既要又要吗 答案是否定的</p>
<h4 data-id="heading-2">第三时代：并发大师的“黄金时代” (JDK 1.5 - J.U.C)</h4>
<p>在这个充满设计者智慧的版本中 我们可以看到许多设计精妙的容器 就比如我们今天的主角ConcurrentHashMap</p>
<p>我们将 CHM 的演进分为两个时代：<strong>JDK 1.7 的“分段锁时代”</strong> 和 <strong>JDK 1.8 的“CAS + 红黑树时代”</strong> 。</p>
<p><strong>第一部分：JDK 1.7 —— 分段锁 (Segment Locking)</strong>
在 JDK 1.7 中，设计者 Doug Lea 的核心思想是： <strong>“大化小”</strong> 。既然锁整个大数组太慢，那我就把它切成几块（Segments），每一块自己管自己的锁。</p>
<h4 data-id="heading-3">1. 核心结构</h4>
<ul>
<li><strong>Segment 数组 + HashEntry 数组</strong>。</li>
<li>一个 <code>ConcurrentHashMap</code> 内部维护了一个 <code>Segment</code> 数组。</li>
<li><strong>关键点</strong>：<code>Segment</code> 这个类直接继承了 <code>ReentrantLock</code>。这意味着每个 Segment 本身就是一把锁。</li>
<li>默认 <code>concurrencyLevel = 16</code>，也就是说整个 Map 被分成了 16 个小隔间。理论上支持 16 个线程同时并发写入（只要它们 hash 到不同的 Segment）。</li>
</ul>
<h4 data-id="heading-4">2. Put 操作流程</h4>
<ol>
<li>
<p><strong>Hash 计算</strong>：先通过 Hash 算法定位到具体的 <code>Segment</code>。</p>
</li>
<li>
<p><strong>获取锁</strong>：当前线程尝试获取这个 Segment 的锁 (<code>tryLock</code>)。</p>
<ul>
<li>如果获取失败，会使用<strong>自旋机制</strong>（SCANNING），重试一定次数后如果还拿不到，才进入阻塞状态（挂起）。</li>
</ul>
</li>
<li>
<p><strong>写入</strong>：拿到锁后，就像操作一个普通的 HashMap 一样，操作内部的 <code>HashEntry</code> 数组（链表插入）。</p>
</li>
<li>
<p><strong>释放锁</strong>。</p>
</li>
</ol>
<h4 data-id="heading-5">3. Get 操作 (高效的秘诀)</h4>
<ul>
<li>
<p><strong>不加锁</strong></p>
</li>
<li>
<p><strong>原理</strong>：<code>HashEntry</code> 中的 <code>value</code> 属性是被 <code>volatile</code> 修饰的。</p>
<p>Java</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-type">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HashEntry</span>&lt;K,V&gt; {
    <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> hash;
    <span class="hljs-keyword">final</span> K key;
    <span class="hljs-keyword">volatile</span> V value; <span class="hljs-comment">// 重点：保证可见性</span>
    <span class="hljs-keyword">volatile</span> HashEntry&lt;K,V&gt; next;
}
</code></pre>
</li>
<li>
<p>由于 volatile 的可见性，写线程修改完，读线程能立刻看到，所以读操作完全无锁，性能极高。</p>
</li>
</ul>
<h4 data-id="heading-6">4. Size 操作 (跨段统计的难题)</h4>
<p>怎么统计总数？数据分散在 16 个桶里，且随时有人在写。</p>
<ul>
<li><strong>机制</strong>：先尝试 <strong>“不加锁”</strong> 统计几次（最多 3 次）。</li>
<li>如果在统计过程中，发现 <code>modCount</code> (修改次数) 没变，说明没人捣乱，直接返回。</li>
<li>如果发现 <code>modCount</code> 变了，说明有人在写，只好<strong>强制锁住所有 Segment</strong> (全局锁)，统计完再解锁。这是一次昂贵的操作。</li>
</ul>
<p>但是这种方法在随着硬件性能提升和 JVM 对 <code>synchronized</code> 的大幅优化，JDK 1.7 的 <code>Segment</code> 显得臃肿了（为了维护 Segment，内存浪费严重）所以就有了 JDK 1.8的优化 也就是现在的 CHM</p>
<h4 data-id="heading-7">第二部分：JDK 1.8 —— CAS + Synchronized + 红黑树</h4>
<p>1.8 的核心思想是： <strong>原子化</strong> 和 <strong>数据结构降维打击</strong> 。它抛弃了 Segment，直接回到了类似 HashMap 的大数组结构，但在细节上做到了极致。</p>
<p>这一设计转变基于一个关键的工程洞察：在大多数实际应用场景中，<strong>Hash 冲突的发生概率极低</strong>。基于此，JDK 1.8 采取了更为激进且高效的加锁策略——<strong>直接锁定 Hash 桶的头节点 (Head Node)</strong> 。这一优化将锁的粒度从原本的段级别（1/16）急剧细化至桶级别（1/N），在保证安全的前提下，最大限度地释放了并发性能。”）</p>
<h4 data-id="heading-8">2. Put 操作流程</h4>
<p>这是面试的重灾区，也是我个人认为CCH设计最为精妙的一点：</p>
<ol>
<li>
<p><strong>判断初始化</strong>：如果 table 为空，调用 <code>initTable()</code> 初始化（利用 CAS 保证只有一个线程初始化成功）。</p>
</li>
<li>
<p><strong>计算 Hash</strong>：定位到数组下标 <code>i</code>。</p>
</li>
<li>
<p><strong>Case 1：桶是空的 (No Collision)</strong></p>
<ul>
<li><strong>CAS 无锁插入</strong>：直接利用 <code>CAS</code> 指令尝试把新节点放入该位置。</li>
<li>如果成功，完事。如果失败（说明瞬间有人抢了），进入下一轮循环。</li>
</ul>
</li>
<li>
<p><strong>Case 2：发现正在扩容 (MOVED)</strong></p>
<ul>
<li>如果发现该位置的节点的 hash 值是 <code>MOVED (-1)</code>，说明当前 Map 正在扩容。</li>
<li><strong>帮忙扩容 (Help Transfer)</strong> ：当前线程不干活了，加入扩容大军，帮忙把数据搬到新数组去（众筹扩容，非常有意思的设计）。</li>
</ul>
</li>
<li>
<p><strong>Case 3：发生哈希冲突 (Collision)</strong></p>
<ul>
<li><strong>Synchronized 锁头节点</strong>：只锁住当前这个桶的第一个节点。</li>
<li>进入锁块后，遍历链表或红黑树进行插入。</li>
</ul>
</li>
<li>
<p><strong>转树</strong>：如果链表长度 &gt; 8 且数组长度 &gt;= 64，将链表转为红黑树。</p>
</li>
</ol>
<h4 data-id="heading-9">3. 为什么 1.8 抛弃 ReentrantLock 改用 Synchronized？</h4>
<ol>
<li><strong>节省内存</strong>：<code>ReentrantLock</code> 需要继承 AQS，每个节点都继承这玩意儿，内存消耗太大。而 <code>synchronized</code> 是 JVM 原生的，锁信息存在对象头（Mark Word）里，几乎零额外开销。</li>
<li><strong>JVM 优化</strong>：JDK 6 以后，JVM 团队对 <code>synchronized</code> 做了惊人的优化（偏向锁、轻量级锁、锁消除、锁粗化）。在低竞争下，它的性能已经优于 ReentrantLock。</li>
</ol>
<h4 data-id="heading-10">4. Size 操作 (LongAdder 思想)</h4>
<p>1.8 甚至优化了计数器。它不再纠结于统计所有桶，而是引入了类似 <code>LongAdder</code> 的机制：</p>
<ul>
<li><strong>baseCount</strong>：基础计数器。</li>
<li><strong>CounterCell 数组</strong>：如果并发太高，CAS 修改 <code>baseCount</code> 失败，就随机找一个 <code>CounterCell</code> 去加。</li>
<li><strong>最终结果</strong> = <code>baseCount</code> + <code>sum(CounterCell[])</code>。</li>
<li>这使得 <code>size()</code> 在高并发下性能飞升。</li>
<li/>
</ul>
<p>JDK 1.7 的 ConcurrentHashMap 像是<strong>包工头制度</strong>（Segment），每个包工头管一片地，虽然比全厂只有一个管理员（Hashtable）强，但管理成本还是高。 而 JDK 1.8 则是<strong>自动化 + 扁平化管理</strong>。平时大家用 CAS（无锁）快速通过，真遇到冲突了，只锁当前那一个工位（Synchronized），而且引入了红黑树解决长队问题，引入了 LongAdder 解决统计问题，是目前的性能天花板。</p>
<p>正因其卓越的并发性能，它成为了众多主流框架底层架构的<strong>基石</strong>。 例如，我们大家都再在用的Spring 框架的核心组件——<strong>Bean 容器</strong>，其底层正是利用 ConcurrentHashMap 来管理单例对象（Singleton Objects），从而在极高的并发访问下保障了容器的线程安全。</p>
<h4 data-id="heading-11">结尾</h4>
<p>总而言之，Java 容器的演进历程，本质上就是一部锁粒度不断细化的变革史。</p>
<p>这一过程始终贯穿着一条主线：<strong>在‘并发安全’的底线之上，向‘单线程效率’发起无限逼近的挑战。</strong> 这不仅是技术指标的提升，更凝聚了开发者在取舍之间的工程智慧。</p>
<p>深入理解这段历史，不仅能让我们掌握底层原理，更能潜移默化地提升我们的<strong>并发设计意识</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[十大排序]]></title>    <link>https://juejin.cn/post/7598947628467912750</link>    <guid>https://juejin.cn/post/7598947628467912750</guid>    <pubDate>2026-01-25T13:42:33.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598947628467912750" data-draft-id="7598921649888542747" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="十大排序"/> <meta itemprop="keywords" content="前端,面试"/> <meta itemprop="datePublished" content="2026-01-25T13:42:33.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="lulaaaa"/> <meta itemprop="url" content="https://juejin.cn/user/3804728203425918"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            十大排序
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3804728203425918/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    lulaaaa
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-25T13:42:33.000Z" title="Sun Jan 25 2026 13:42:33 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读17分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">十大排序算法</h2>
<h3 data-id="heading-1">前言</h3>
<p>排序算法是编程的基础核心知识点，根据是否依赖「元素比较」可分为两类：</p>
<ul>
<li><strong>比较类排序</strong>：通过比较元素大小确定顺序，时间复杂度最低为 O(nlogn)，包含冒泡、选择、插入、希尔、归并、快速、堆排序；</li>
<li><strong>非比较类排序</strong>：利用数值特征（如位数、范围）排序，时间复杂度可达 O(n)，包含计数、桶、基数排序。</li>
</ul>
<p><strong>核心概念铺垫</strong>：</p>
<ul>
<li><strong>排序稳定性</strong>：若排序后，两个相等值的元素相对位置与排序前一致，则为「稳定排序」；否则为「不稳定排序」（如 <code>[2,2,1]</code> 排序后，第一个 2 仍在第二个 2 前则稳定）。</li>
<li><strong>时间复杂度</strong>：算法执行时间随数据规模增长的趋势；</li>
<li><strong>空间复杂度</strong>：算法占用额外空间随数据规模增长的趋势。</li>
</ul>
<hr/>
<h3 data-id="heading-2">1. 冒泡排序（Bubble Sort）</h3>
<h4 data-id="heading-3">核心思想</h4>
<p>像水中的气泡上浮：每次遍历数组，相邻元素两两比较，把<strong>最大的元素逐步 “浮” 到数组末尾</strong>，小元素留在前面。可优化：某轮遍历无交换时，说明数组已有序，提前终止。</p>
<h4 data-id="heading-4">算法步骤</h4>
<ol>
<li>遍历数组，相邻元素两两比较，若前 &gt; 后则交换；</li>
<li>每轮遍历结束，当前未排序部分的最大值 “归位” 到末尾；</li>
<li>重复上述步骤，直到数组有序（或提前终止）。</li>
</ol>
<h4 data-id="heading-5">案例演示（数组 <code>[5,3,8,4,2]</code>）</h4>






























<table><thead><tr><th>遍历轮次</th><th>数组变化</th><th>归位元素</th></tr></thead><tbody><tr><td>轮 1</td><td>[3,5,8,4,2] → [3,5,4,8,2] → [3,5,4,2,8]</td><td>8</td></tr><tr><td>轮 2</td><td>[3,4,5,2,8] → [3,4,2,5,8]</td><td>5</td></tr><tr><td>轮 3</td><td>[3,2,4,5,8]</td><td>4</td></tr><tr><td>轮 4</td><td>[2,3,4,5,8]</td><td>3</td></tr></tbody></table>
<h4 data-id="heading-6">代码实现（Java）</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BubbleSort</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">bubbleSort</span><span class="hljs-params">(<span class="hljs-type">int</span>[] arr)</span> {
        <span class="hljs-keyword">if</span> (arr == <span class="hljs-literal">null</span> || arr.length &lt;= <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span>;
        <span class="hljs-type">int</span> <span class="hljs-variable">n</span> <span class="hljs-operator">=</span> arr.length;
        <span class="hljs-type">boolean</span> swapped; <span class="hljs-comment">// 标记是否发生交换</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; n - <span class="hljs-number">1</span>; i++) {
            swapped = <span class="hljs-literal">false</span>;
            <span class="hljs-comment">// 每轮减少i次遍历（末尾i个元素已归位）</span>
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; j &lt; n - <span class="hljs-number">1</span> - i; j++) {
                <span class="hljs-keyword">if</span> (arr[j] &gt; arr[j + <span class="hljs-number">1</span>]) {
                    <span class="hljs-comment">// 交换相邻元素</span>
                    <span class="hljs-type">int</span> <span class="hljs-variable">temp</span> <span class="hljs-operator">=</span> arr[j];
                    arr[j] = arr[j + <span class="hljs-number">1</span>];
                    arr[j + <span class="hljs-number">1</span>] = temp;
                    swapped = <span class="hljs-literal">true</span>;
                }
            }
            <span class="hljs-comment">// 无交换则提前终止</span>
            <span class="hljs-keyword">if</span> (!swapped) <span class="hljs-keyword">break</span>;
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">int</span>[] arr = {<span class="hljs-number">5</span>, <span class="hljs-number">3</span>, <span class="hljs-number">8</span>, <span class="hljs-number">4</span>, <span class="hljs-number">2</span>};
        bubbleSort(arr);
        System.out.println(Arrays.toString(arr)); <span class="hljs-comment">// 输出 [2, 3, 4, 5, 8]</span>
    }
}
</code></pre>
<h4 data-id="heading-7">算法分析</h4>
<ul>
<li>时间复杂度：最好 O(n)（已有序）、最坏 / 平均 O(n2)；</li>
<li>空间复杂度：O(1)（原地排序）；</li>
<li>稳定性：稳定（相等元素不交换）。</li>
</ul>
<hr/>
<h3 data-id="heading-8">2. 选择排序（Selection Sort）</h3>
<h4 data-id="heading-9">核心思想</h4>
<p>像选 “标兵”：每次从<strong>未排序部分选出最小值</strong>，放到已排序部分的末尾，逐步扩大有序区域。</p>
<h4 data-id="heading-10">算法步骤</h4>
<ol>
<li>划分「已排序区」（初始为空）和「未排序区」（整个数组）；</li>
<li>遍历未排序区，找到最小值的索引；</li>
<li>交换最小值与未排序区的第一个元素，扩大已排序区；</li>
<li>重复直到未排序区为空。</li>
</ol>
<h4 data-id="heading-11">案例演示（数组 <code>[5,3,8,4,2]</code>）</h4>



































<table><thead><tr><th>遍历轮次</th><th>未排序区</th><th>最小值（索引）</th><th>数组变化</th></tr></thead><tbody><tr><td>轮 1</td><td>[5,3,8,4,2]</td><td>2（4）</td><td>[2,3,8,4,5]</td></tr><tr><td>轮 2</td><td>[3,8,4,5]</td><td>3（1）</td><td>[2,3,8,4,5]</td></tr><tr><td>轮 3</td><td>[8,4,5]</td><td>4（3）</td><td>[2,3,4,8,5]</td></tr><tr><td>轮 4</td><td>[8,5]</td><td>5（4）</td><td>[2,3,4,5,8]</td></tr></tbody></table>
<h4 data-id="heading-12">代码实现（Java）</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SelectionSort</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">selectionSort</span><span class="hljs-params">(<span class="hljs-type">int</span>[] arr)</span> {
        <span class="hljs-keyword">if</span> (arr == <span class="hljs-literal">null</span> || arr.length &lt;= <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span>;
        <span class="hljs-type">int</span> <span class="hljs-variable">n</span> <span class="hljs-operator">=</span> arr.length;
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; n - <span class="hljs-number">1</span>; i++) {
            <span class="hljs-comment">// 找未排序区（i到n-1）的最小值索引</span>
            <span class="hljs-type">int</span> <span class="hljs-variable">minIndex</span> <span class="hljs-operator">=</span> i;
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> i + <span class="hljs-number">1</span>; j &lt; n; j++) {
                <span class="hljs-keyword">if</span> (arr[j] &lt; arr[minIndex]) {
                    minIndex = j;
                }
            }
            <span class="hljs-comment">// 交换最小值和未排序区第一个元素</span>
            <span class="hljs-type">int</span> <span class="hljs-variable">temp</span> <span class="hljs-operator">=</span> arr[i];
            arr[i] = arr[minIndex];
            arr[minIndex] = temp;
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">int</span>[] arr = {<span class="hljs-number">5</span>, <span class="hljs-number">3</span>, <span class="hljs-number">8</span>, <span class="hljs-number">4</span>, <span class="hljs-number">2</span>};
        selectionSort(arr);
        System.out.println(Arrays.toString(arr)); <span class="hljs-comment">// 输出 [2, 3, 4, 5, 8]</span>
    }
}
</code></pre>
<h4 data-id="heading-13">算法分析</h4>
<ul>
<li>时间复杂度：所有情况 O(n2)（无论是否有序，都要遍历找最小值）；</li>
<li>空间复杂度：O(1)（原地排序）；</li>
<li>稳定性：不稳定（如 <code>[2,2,1]</code>，选 1 交换第一个 2，两个 2 的相对位置改变）。</li>
</ul>
<hr/>
<h3 data-id="heading-14">3. 插入排序（Insertion Sort）</h3>
<h4 data-id="heading-15">核心思想</h4>
<p>像打扑克牌插牌：把当前元素插入到<strong>前面已排序数组的合适位置</strong>，前面始终保持有序。</p>
<h4 data-id="heading-16">算法步骤</h4>
<ol>
<li>划分「已排序区」（初始为第一个元素）和「未排序区」（剩余元素）；</li>
<li>取未排序区的第一个元素，向前遍历已排序区，找到比它小的元素位置；</li>
<li>将该位置后的元素后移，插入当前元素；</li>
<li>重复直到未排序区为空。</li>
</ol>
<h4 data-id="heading-17">案例演示（数组 <code>[5,3,8,4,2]</code>）</h4>



































<table><thead><tr><th>遍历轮次</th><th>已排序区</th><th>待插入元素</th><th>数组变化</th></tr></thead><tbody><tr><td>轮 1</td><td>[5]</td><td>3</td><td>[3,5,8,4,2]</td></tr><tr><td>轮 2</td><td>[3,5]</td><td>8</td><td>[3,5,8,4,2]</td></tr><tr><td>轮 3</td><td>[3,5,8]</td><td>4</td><td>[3,5,4,8,2] → [3,4,5,8,2]</td></tr><tr><td>轮 4</td><td>[3,4,5,8]</td><td>2</td><td>[2,3,4,5,8]</td></tr></tbody></table>
<h4 data-id="heading-18">代码实现（Java）</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">InsertionSort</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">insertionSort</span><span class="hljs-params">(<span class="hljs-type">int</span>[] arr)</span> {
        <span class="hljs-keyword">if</span> (arr == <span class="hljs-literal">null</span> || arr.length &lt;= <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span>;
        <span class="hljs-type">int</span> <span class="hljs-variable">n</span> <span class="hljs-operator">=</span> arr.length;
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; i &lt; n; i++) {
            <span class="hljs-type">int</span> <span class="hljs-variable">current</span> <span class="hljs-operator">=</span> arr[i]; <span class="hljs-comment">// 待插入元素</span>
            <span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> i - <span class="hljs-number">1</span>;
            <span class="hljs-comment">// 向前遍历已排序区，找到插入位置</span>
            <span class="hljs-keyword">while</span> (j &gt;= <span class="hljs-number">0</span> &amp;&amp; arr[j] &gt; current) {
                arr[j + <span class="hljs-number">1</span>] = arr[j]; <span class="hljs-comment">// 元素后移</span>
                j--;
            }
            arr[j + <span class="hljs-number">1</span>] = current; <span class="hljs-comment">// 插入元素</span>
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">int</span>[] arr = {<span class="hljs-number">5</span>, <span class="hljs-number">3</span>, <span class="hljs-number">8</span>, <span class="hljs-number">4</span>, <span class="hljs-number">2</span>};
        insertionSort(arr);
        System.out.println(Arrays.toString(arr)); <span class="hljs-comment">// 输出 [2, 3, 4, 5, 8]</span>
    }
}
</code></pre>
<h4 data-id="heading-19">算法分析</h4>
<ul>
<li>时间复杂度：最好 O(n)（已有序）、最坏 / 平均 O(n2)；</li>
<li>空间复杂度：O(1)（原地排序）；</li>
<li>稳定性：稳定（相等元素不后移）。</li>
</ul>
<hr/>
<h3 data-id="heading-20">4. 希尔排序（Shell Sort）</h3>
<h4 data-id="heading-21">核心思想</h4>
<p>插入排序的 “升级版”：先按「步长」将数组分组，每组内做插入排序（粗排）；逐步缩小步长到 1，最终做一次整体插入排序（精排）。像先把数组 “梳顺”，再精细排序，减少插入排序的元素移动次数。</p>
<h4 data-id="heading-22">算法步骤</h4>
<ol>
<li>选择初始步长（通常为 n/2，每次减半）；</li>
<li>按步长将数组分成若干子数组（索引 i,i+step,i+2step...）；</li>
<li>对每个子数组执行插入排序；</li>
<li>步长减半，重复步骤 2-3；直到步长 = 1，做最后一次插入排序。</li>
</ol>
<h4 data-id="heading-23">案例演示（数组 <code>[5,3,8,4,2]</code>，n=5）</h4>




















<table><thead><tr><th>步长</th><th>分组情况</th><th>分组排序后数组</th></tr></thead><tbody><tr><td>2</td><td>[5,8,2]、[3,4]</td><td>[2,3,8,4,5]</td></tr><tr><td>1</td><td>整体数组</td><td>[2,3,4,5,8]</td></tr></tbody></table>
<h4 data-id="heading-24">代码实现（Java）</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ShellSort</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">shellSort</span><span class="hljs-params">(<span class="hljs-type">int</span>[] arr)</span> {
        <span class="hljs-keyword">if</span> (arr == <span class="hljs-literal">null</span> || arr.length &lt;= <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span>;
        <span class="hljs-type">int</span> <span class="hljs-variable">n</span> <span class="hljs-operator">=</span> arr.length;
        <span class="hljs-comment">// 步长逐步减半</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">step</span> <span class="hljs-operator">=</span> n / <span class="hljs-number">2</span>; step &gt; <span class="hljs-number">0</span>; step /= <span class="hljs-number">2</span>) {
            <span class="hljs-comment">// 按步长分组，每组插入排序</span>
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> step; i &lt; n; i++) {
                <span class="hljs-type">int</span> <span class="hljs-variable">current</span> <span class="hljs-operator">=</span> arr[i];
                <span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> i - step;
                <span class="hljs-keyword">while</span> (j &gt;= <span class="hljs-number">0</span> &amp;&amp; arr[j] &gt; current) {
                    arr[j + step] = arr[j];
                    j -= step;
                }
                arr[j + step] = current;
            }
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">int</span>[] arr = {<span class="hljs-number">5</span>, <span class="hljs-number">3</span>, <span class="hljs-number">8</span>, <span class="hljs-number">4</span>, <span class="hljs-number">2</span>};
        shellSort(arr);
        System.out.println(Arrays.toString(arr)); <span class="hljs-comment">// 输出 [2, 3, 4, 5, 8]</span>
    }
}
</code></pre>
<h4 data-id="heading-25">算法分析</h4>
<ul>
<li>时间复杂度：最好 O(nlogn)、最坏 O(n2)、平均 O(n1.3)（步长影响）；</li>
<li>空间复杂度：O(1)（原地排序）；</li>
<li>稳定性：不稳定（分组排序会打乱相等元素的相对位置）。</li>
</ul>
<hr/>
<h3 data-id="heading-26">5. 归并排序（Merge Sort）</h3>
<h4 data-id="heading-27">核心思想</h4>
<p>分治思想的典型应用：“分而治之”，先把数组拆成最小单元（单个元素，天然有序），再<strong>两两合并成有序子数组</strong>，最终合并成整体有序数组。像拼拼图，先拆成碎片，再按规则拼合。</p>
<h4 data-id="heading-28">算法步骤</h4>
<ol>
<li><strong>分</strong>：递归将数组分成左右两半，直到每个子数组只有 1 个元素；</li>
<li><strong>治</strong>：合并两个有序子数组为一个有序数组；</li>
<li>递归合并，直到整个数组合并完成。</li>
</ol>
<h4 data-id="heading-29">案例演示（数组 <code>[5,3,8,4,2]</code>）</h4>
<p>plaintext</p>
<pre><code class="hljs language-css" lang="css">分：<span class="hljs-selector-attr">[5,3,8,4,2]</span> → <span class="hljs-selector-attr">[5,3]</span> + <span class="hljs-selector-attr">[8,4,2]</span> → <span class="hljs-selector-attr">[5]</span>+<span class="hljs-selector-attr">[3]</span> + <span class="hljs-selector-attr">[8]</span>+<span class="hljs-selector-attr">[4,2]</span> → <span class="hljs-selector-attr">[5]</span>+<span class="hljs-selector-attr">[3]</span> + <span class="hljs-selector-attr">[8]</span>+<span class="hljs-selector-attr">[4]</span>+<span class="hljs-selector-attr">[2]</span>
合：<span class="hljs-selector-attr">[5]</span>+<span class="hljs-selector-attr">[3]</span>→<span class="hljs-selector-attr">[3,5]</span>；<span class="hljs-selector-attr">[4]</span>+<span class="hljs-selector-attr">[2]</span>→<span class="hljs-selector-attr">[2,4]</span>；<span class="hljs-selector-attr">[8]</span>+<span class="hljs-selector-attr">[2,4]</span>→<span class="hljs-selector-attr">[2,4,8]</span>；<span class="hljs-selector-attr">[3,5]</span>+<span class="hljs-selector-attr">[2,4,8]</span>→<span class="hljs-selector-attr">[2,3,4,5,8]</span>
</code></pre>
<h4 data-id="heading-30">代码实现（Java，递归版）</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MergeSort</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">mergeSort</span><span class="hljs-params">(<span class="hljs-type">int</span>[] arr)</span> {
        <span class="hljs-keyword">if</span> (arr == <span class="hljs-literal">null</span> || arr.length &lt;= <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span>;
        <span class="hljs-type">int</span> <span class="hljs-variable">n</span> <span class="hljs-operator">=</span> arr.length;
        <span class="hljs-type">int</span>[] temp = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[n]; <span class="hljs-comment">// 临时数组，避免频繁创建</span>
        mergeSort(arr, <span class="hljs-number">0</span>, n - <span class="hljs-number">1</span>, temp);
    }

    <span class="hljs-comment">// 递归拆分</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">mergeSort</span><span class="hljs-params">(<span class="hljs-type">int</span>[] arr, <span class="hljs-type">int</span> left, <span class="hljs-type">int</span> right, <span class="hljs-type">int</span>[] temp)</span> {
        <span class="hljs-keyword">if</span> (left &gt;= right) <span class="hljs-keyword">return</span>;
        <span class="hljs-type">int</span> <span class="hljs-variable">mid</span> <span class="hljs-operator">=</span> left + (right - left) / <span class="hljs-number">2</span>; <span class="hljs-comment">// 避免溢出</span>
        mergeSort(arr, left, mid, temp); <span class="hljs-comment">// 左半区排序</span>
        mergeSort(arr, mid + <span class="hljs-number">1</span>, right, temp); <span class="hljs-comment">// 右半区排序</span>
        merge(arr, left, mid, right, temp); <span class="hljs-comment">// 合并左右区</span>
    }

    <span class="hljs-comment">// 合并两个有序子数组</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">merge</span><span class="hljs-params">(<span class="hljs-type">int</span>[] arr, <span class="hljs-type">int</span> left, <span class="hljs-type">int</span> mid, <span class="hljs-type">int</span> right, <span class="hljs-type">int</span>[] temp)</span> {
        <span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> left; <span class="hljs-comment">// 左区指针</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> mid + <span class="hljs-number">1</span>; <span class="hljs-comment">// 右区指针</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">k</span> <span class="hljs-operator">=</span> left; <span class="hljs-comment">// 临时数组指针</span>
        <span class="hljs-comment">// 合并两个有序数组</span>
        <span class="hljs-keyword">while</span> (i &lt;= mid &amp;&amp; j &lt;= right) {
            <span class="hljs-keyword">if</span> (arr[i] &lt;= arr[j]) {
                temp[k++] = arr[i++];
            } <span class="hljs-keyword">else</span> {
                temp[k++] = arr[j++];
            }
        }
        <span class="hljs-comment">// 拷贝左区剩余元素</span>
        <span class="hljs-keyword">while</span> (i &lt;= mid) {
            temp[k++] = arr[i++];
        }
        <span class="hljs-comment">// 拷贝右区剩余元素</span>
        <span class="hljs-keyword">while</span> (j &lt;= right) {
            temp[k++] = arr[j++];
        }
        <span class="hljs-comment">// 临时数组拷贝回原数组</span>
        System.arraycopy(temp, left, arr, left, right - left + <span class="hljs-number">1</span>);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">int</span>[] arr = {<span class="hljs-number">5</span>, <span class="hljs-number">3</span>, <span class="hljs-number">8</span>, <span class="hljs-number">4</span>, <span class="hljs-number">2</span>};
        mergeSort(arr);
        System.out.println(Arrays.toString(arr)); <span class="hljs-comment">// 输出 [2, 3, 4, 5, 8]</span>
    }
}
</code></pre>
<h4 data-id="heading-31">算法分析</h4>
<ul>
<li>时间复杂度：所有情况 O(nlogn)（拆分 O(logn) 层，每层合并 O(n)）；</li>
<li>空间复杂度：O(n)（需要临时数组存储合并结果）；</li>
<li>稳定性：稳定（合并时相等元素优先取左区，保持相对位置）。</li>
</ul>
<hr/>
<h3 data-id="heading-32">6. 快速排序（Quick Sort）</h3>
<h4 data-id="heading-33">核心思想</h4>
<p>分治 + 分区：选一个「基准值」，把数组分成 “小于基准、等于基准、大于基准” 三部分；递归处理左右两部分。像选裁判，把数组分成 “左队（小）、裁判（基准）、右队（大）”，再细分左右队。</p>
<h4 data-id="heading-34">算法步骤</h4>
<ol>
<li>选基准值（推荐：随机选，避免有序数组退化）；</li>
<li>分区：遍历数组，小于基准的放左，大于的放右，基准放中间；</li>
<li>递归对左、右分区重复步骤 1-2；</li>
<li>递归结束则数组有序。</li>
</ol>
<h4 data-id="heading-35">案例演示（数组 <code>[5,3,8,4,2]</code>，选 5 为基准）</h4>
<p>plaintext</p>
<pre><code class="hljs language-css" lang="css">分区：小于<span class="hljs-number">5</span>→<span class="hljs-selector-attr">[3,4,2]</span>，基准→<span class="hljs-number">5</span>，大于<span class="hljs-number">5</span>→<span class="hljs-selector-attr">[8]</span> → <span class="hljs-selector-attr">[3,4,2,5,8]</span>
左分区<span class="hljs-selector-attr">[3,4,2]</span>选<span class="hljs-number">3</span>为基准：小于<span class="hljs-number">3</span>→<span class="hljs-selector-attr">[2]</span>，基准→<span class="hljs-number">3</span>，大于<span class="hljs-number">3</span>→<span class="hljs-selector-attr">[4]</span> → <span class="hljs-selector-attr">[2,3,4,5,8]</span>
右分区<span class="hljs-selector-attr">[8]</span>有序，最终结果：<span class="hljs-selector-attr">[2,3,4,5,8]</span>
</code></pre>
<h4 data-id="heading-36">代码实现（Java，随机基准优化）</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">QuickSort</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">quickSort</span><span class="hljs-params">(<span class="hljs-type">int</span>[] arr)</span> {
        <span class="hljs-keyword">if</span> (arr == <span class="hljs-literal">null</span> || arr.length &lt;= <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span>;
        quickSort(arr, <span class="hljs-number">0</span>, arr.length - <span class="hljs-number">1</span>);
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">quickSort</span><span class="hljs-params">(<span class="hljs-type">int</span>[] arr, <span class="hljs-type">int</span> left, <span class="hljs-type">int</span> right)</span> {
        <span class="hljs-keyword">if</span> (left &gt;= right) <span class="hljs-keyword">return</span>;
        <span class="hljs-type">int</span> <span class="hljs-variable">pivotIndex</span> <span class="hljs-operator">=</span> partition(arr, left, right); <span class="hljs-comment">// 分区，返回基准位置</span>
        quickSort(arr, left, pivotIndex - <span class="hljs-number">1</span>); <span class="hljs-comment">// 左分区</span>
        quickSort(arr, pivotIndex + <span class="hljs-number">1</span>, right); <span class="hljs-comment">// 右分区</span>
    }

    <span class="hljs-comment">// 分区函数（Hoare法）</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">partition</span><span class="hljs-params">(<span class="hljs-type">int</span>[] arr, <span class="hljs-type">int</span> left, <span class="hljs-type">int</span> right)</span> {
        <span class="hljs-comment">// 随机选基准，避免有序数组退化</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">randomIndex</span> <span class="hljs-operator">=</span> left + <span class="hljs-keyword">new</span> <span class="hljs-title class_">Random</span>().nextInt(right - left + <span class="hljs-number">1</span>);
        swap(arr, left, randomIndex); <span class="hljs-comment">// 基准移到左边界</span>

        <span class="hljs-type">int</span> <span class="hljs-variable">pivot</span> <span class="hljs-operator">=</span> arr[left]; <span class="hljs-comment">// 基准值</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> left, j = right;
        <span class="hljs-keyword">while</span> (i &lt; j) {
            <span class="hljs-comment">// 从右找小于基准的元素</span>
            <span class="hljs-keyword">while</span> (i &lt; j &amp;&amp; arr[j] &gt;= pivot) j--;
            <span class="hljs-comment">// 从左找大于基准的元素</span>
            <span class="hljs-keyword">while</span> (i &lt; j &amp;&amp; arr[i] &lt;= pivot) i++;
            <span class="hljs-comment">// 交换左右指针元素</span>
            <span class="hljs-keyword">if</span> (i &lt; j) swap(arr, i, j);
        }
        <span class="hljs-comment">// 基准归位（i=j的位置）</span>
        swap(arr, left, i);
        <span class="hljs-keyword">return</span> i;
    }

    <span class="hljs-comment">// 交换元素</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">swap</span><span class="hljs-params">(<span class="hljs-type">int</span>[] arr, <span class="hljs-type">int</span> i, <span class="hljs-type">int</span> j)</span> {
        <span class="hljs-type">int</span> <span class="hljs-variable">temp</span> <span class="hljs-operator">=</span> arr[i];
        arr[i] = arr[j];
        arr[j] = temp;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">int</span>[] arr = {<span class="hljs-number">5</span>, <span class="hljs-number">3</span>, <span class="hljs-number">8</span>, <span class="hljs-number">4</span>, <span class="hljs-number">2</span>};
        quickSort(arr);
        System.out.println(Arrays.toString(arr)); <span class="hljs-comment">// 输出 [2, 3, 4, 5, 8]</span>
    }
}
</code></pre>
<h4 data-id="heading-37">算法分析</h4>
<ul>
<li>时间复杂度：最好 / 平均 O(nlogn)、最坏 O(n2)（有序数组未优化）；</li>
<li>空间复杂度：O(logn)（递归栈，随机基准可优化到 O(logn)）；</li>
<li>稳定性：不稳定（分区交换会打乱相等元素位置）。</li>
</ul>
<hr/>
<h3 data-id="heading-38">7. 堆排序（Heap Sort）</h3>
<h4 data-id="heading-39">核心思想</h4>
<p>利用「堆」（完全二叉树）的特性：构建<strong>大顶堆</strong>（父节点 &gt; 子节点），每次取堆顶（最大值）放到数组末尾，再调整堆，重复直到堆为空。像从堆里每次挑最大的元素 “拿出来”，最终有序。</p>
<h4 data-id="heading-40">算法步骤</h4>
<ol>
<li>构建大顶堆（从最后一个非叶子节点开始向上调整）；</li>
<li>交换堆顶（最大值）和堆的最后一个元素，堆大小减 1；</li>
<li>调整剩余元素为大顶堆；</li>
<li>重复步骤 2-3，直到堆大小为 1。</li>
</ol>
<h4 data-id="heading-41">案例演示（数组 <code>[5,3,8,4,2]</code>）</h4>
<p>plaintext</p>
<pre><code class="hljs language-css" lang="css">构建大顶堆：<span class="hljs-selector-attr">[8,4,5,3,2]</span>
轮<span class="hljs-number">1</span>：交换<span class="hljs-number">8</span>和<span class="hljs-number">2</span>→<span class="hljs-selector-attr">[2,4,5,3,8]</span>，调整堆→<span class="hljs-selector-attr">[5,4,2,3,8]</span>
轮<span class="hljs-number">2</span>：交换<span class="hljs-number">5</span>和<span class="hljs-number">3</span>→<span class="hljs-selector-attr">[3,4,2,5,8]</span>，调整堆→<span class="hljs-selector-attr">[4,3,2,5,8]</span>
轮<span class="hljs-number">3</span>：交换<span class="hljs-number">4</span>和<span class="hljs-number">2</span>→<span class="hljs-selector-attr">[2,3,4,5,8]</span>，调整堆→<span class="hljs-selector-attr">[3,2,4,5,8]</span>
轮<span class="hljs-number">4</span>：交换<span class="hljs-number">3</span>和<span class="hljs-number">2</span>→<span class="hljs-selector-attr">[2,3,4,5,8]</span>，结束
</code></pre>
<h4 data-id="heading-42">代码实现（Java）</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HeapSort</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">heapSort</span><span class="hljs-params">(<span class="hljs-type">int</span>[] arr)</span> {
        <span class="hljs-keyword">if</span> (arr == <span class="hljs-literal">null</span> || arr.length &lt;= <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span>;
        <span class="hljs-type">int</span> <span class="hljs-variable">n</span> <span class="hljs-operator">=</span> arr.length;

        <span class="hljs-comment">// 构建大顶堆（从最后一个非叶子节点开始）</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> n / <span class="hljs-number">2</span> - <span class="hljs-number">1</span>; i &gt;= <span class="hljs-number">0</span>; i--) {
            heapify(arr, n, i);
        }

        <span class="hljs-comment">// 逐个取出堆顶元素</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> n - <span class="hljs-number">1</span>; i &gt; <span class="hljs-number">0</span>; i--) {
            <span class="hljs-comment">// 交换堆顶和当前堆最后一个元素</span>
            swap(arr, <span class="hljs-number">0</span>, i);
            <span class="hljs-comment">// 调整剩余元素为大顶堆</span>
            heapify(arr, i, <span class="hljs-number">0</span>);
        }
    }

    <span class="hljs-comment">// 调整堆（以i为根的子树）</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">heapify</span><span class="hljs-params">(<span class="hljs-type">int</span>[] arr, <span class="hljs-type">int</span> heapSize, <span class="hljs-type">int</span> i)</span> {
        <span class="hljs-type">int</span> <span class="hljs-variable">largest</span> <span class="hljs-operator">=</span> i; <span class="hljs-comment">// 初始化最大值为根</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">left</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span> * i + <span class="hljs-number">1</span>; <span class="hljs-comment">// 左子节点</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">right</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span> * i + <span class="hljs-number">2</span>; <span class="hljs-comment">// 右子节点</span>

        <span class="hljs-comment">// 左子节点更大</span>
        <span class="hljs-keyword">if</span> (left &lt; heapSize &amp;&amp; arr[left] &gt; arr[largest]) {
            largest = left;
        }
        <span class="hljs-comment">// 右子节点更大</span>
        <span class="hljs-keyword">if</span> (right &lt; heapSize &amp;&amp; arr[right] &gt; arr[largest]) {
            largest = right;
        }

        <span class="hljs-comment">// 最大值不是根，交换并递归调整</span>
        <span class="hljs-keyword">if</span> (largest != i) {
            swap(arr, i, largest);
            heapify(arr, heapSize, largest);
        }
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">swap</span><span class="hljs-params">(<span class="hljs-type">int</span>[] arr, <span class="hljs-type">int</span> i, <span class="hljs-type">int</span> j)</span> {
        <span class="hljs-type">int</span> <span class="hljs-variable">temp</span> <span class="hljs-operator">=</span> arr[i];
        arr[i] = arr[j];
        arr[j] = temp;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">int</span>[] arr = {<span class="hljs-number">5</span>, <span class="hljs-number">3</span>, <span class="hljs-number">8</span>, <span class="hljs-number">4</span>, <span class="hljs-number">2</span>};
        heapSort(arr);
        System.out.println(Arrays.toString(arr)); <span class="hljs-comment">// 输出 [2, 3, 4, 5, 8]</span>
    }
}
</code></pre>
<h4 data-id="heading-43">算法分析</h4>
<ul>
<li>时间复杂度：所有情况 O(nlogn)（建堆 O(n)，每次调整 O(logn)）；</li>
<li>空间复杂度：O(1)（原地排序）；</li>
<li>稳定性：不稳定（堆调整会打乱相等元素位置）。</li>
</ul>
<hr/>
<h3 data-id="heading-44">8. 计数排序（Counting Sort）</h3>
<h4 data-id="heading-45">核心思想</h4>
<p>非比较排序：统计每个数值出现的次数，再根据次数 “还原” 有序数组。像数人数：按身高统计每个身高的人数，再按身高顺序输出。</p>
<h4 data-id="heading-46">算法步骤</h4>
<ol>
<li>找到数组的最大值 <code>max</code> 和最小值 <code>min</code>；</li>
<li>创建计数数组 <code>count</code>，长度为 <code>max - min + 1</code>，初始化为 0；</li>
<li>遍历原数组，<code>count[num - min]++</code>（统计每个数的出现次数）；</li>
<li>遍历计数数组，按次数将数值填充回原数组。</li>
</ol>
<h4 data-id="heading-47">案例演示（数组 <code>[5,3,8,4,2]</code>）</h4>
<ul>
<li>min=2，max=8，count 数组长度 = 7（索引 0→2，1→3，2→4，3→5，4→6，5→7，6→8）；</li>
<li>统计后：<code>count = [1,1,1,1,0,0,1]</code>；</li>
<li>填充：2 (1 次)→3 (1)→4 (1)→5 (1)→8 (1) → [2,3,4,5,8]。</li>
</ul>
<h4 data-id="heading-48">代码实现（Java）</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CountingSort</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">countingSort</span><span class="hljs-params">(<span class="hljs-type">int</span>[] arr)</span> {
        <span class="hljs-keyword">if</span> (arr == <span class="hljs-literal">null</span> || arr.length &lt;= <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span>;
        <span class="hljs-type">int</span> <span class="hljs-variable">n</span> <span class="hljs-operator">=</span> arr.length;

        <span class="hljs-comment">// 找最大值和最小值</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">min</span> <span class="hljs-operator">=</span> arr[<span class="hljs-number">0</span>], max = arr[<span class="hljs-number">0</span>];
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> num : arr) {
            <span class="hljs-keyword">if</span> (num &lt; min) min = num;
            <span class="hljs-keyword">if</span> (num &gt; max) max = num;
        }

        <span class="hljs-comment">// 计数数组</span>
        <span class="hljs-type">int</span>[] count = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[max - min + <span class="hljs-number">1</span>];
        <span class="hljs-comment">// 统计次数</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> num : arr) {
            count[num - min]++;
        }

        <span class="hljs-comment">// 填充回原数组</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">index</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; count.length; i++) {
            <span class="hljs-keyword">while</span> (count[i] &gt; <span class="hljs-number">0</span>) {
                arr[index++] = i + min;
                count[i]--;
            }
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">int</span>[] arr = {<span class="hljs-number">5</span>, <span class="hljs-number">3</span>, <span class="hljs-number">8</span>, <span class="hljs-number">4</span>, <span class="hljs-number">2</span>};
        countingSort(arr);
        System.out.println(Arrays.toString(arr)); <span class="hljs-comment">// 输出 [2, 3, 4, 5, 8]</span>
    }
}
</code></pre>
<h4 data-id="heading-49">算法分析</h4>
<ul>
<li>时间复杂度：O(n+k)（k=max−min，数值范围）；</li>
<li>空间复杂度：O(n+k)（计数数组 + 原数组）；</li>
<li>稳定性：稳定（按顺序填充，保持相等元素的相对位置）。</li>
<li>适用场景：数值范围小的整数排序（如成绩、年龄）。</li>
</ul>
<hr/>
<h3 data-id="heading-50">9. 桶排序（Bucket Sort）</h3>
<h4 data-id="heading-51">核心思想</h4>
<p>非比较排序：把数组按数值范围分到多个「桶」里，每个桶内用其他排序（如插入排序），最后合并所有桶。像分桶整理：先按范围粗分，再精细排序，最后合并。</p>
<h4 data-id="heading-52">算法步骤</h4>
<ol>
<li>确定桶的数量和范围（通常按数值分布划分，如 <code>桶数=数组长度</code>）；</li>
<li>遍历数组，将元素放入对应桶中；</li>
<li>对每个非空桶内的元素排序（推荐插入排序，小规模数据高效）；</li>
<li>按桶的顺序合并所有元素，得到有序数组。</li>
</ol>
<h4 data-id="heading-53">案例演示（数组 <code>[5,3,8,4,2]</code>）</h4>
<ul>
<li>桶数 = 3，范围划分：[0-3)、[3-6)、[6-9)；</li>
<li>分桶：桶 1→[2,3]，桶 2→[5,4]，桶 3→[8]；</li>
<li>桶内排序：桶 1→[2,3]，桶 2→[4,5]，桶 3→[8]；</li>
<li>合并：[2,3,4,5,8]。</li>
</ul>
<h4 data-id="heading-54">代码实现（Java）</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BucketSort</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">bucketSort</span><span class="hljs-params">(<span class="hljs-type">int</span>[] arr)</span> {
        <span class="hljs-keyword">if</span> (arr == <span class="hljs-literal">null</span> || arr.length &lt;= <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span>;
        <span class="hljs-type">int</span> <span class="hljs-variable">n</span> <span class="hljs-operator">=</span> arr.length;

        <span class="hljs-comment">// 1. 找最大值和最小值，确定桶范围</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">min</span> <span class="hljs-operator">=</span> arr[<span class="hljs-number">0</span>], max = arr[<span class="hljs-number">0</span>];
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> num : arr) {
            <span class="hljs-keyword">if</span> (num &lt; min) min = num;
            <span class="hljs-keyword">if</span> (num &gt; max) max = num;
        }

        <span class="hljs-comment">// 2. 创建桶（桶数=数组长度，均匀划分）</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">bucketNum</span> <span class="hljs-operator">=</span> n;
        List&lt;List&lt;Integer&gt;&gt; buckets = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;(bucketNum);
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; bucketNum; i++) {
            buckets.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;());
        }

        <span class="hljs-comment">// 3. 元素入桶</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> num : arr) {
            <span class="hljs-comment">// 计算元素所属桶的索引</span>
            <span class="hljs-type">int</span> <span class="hljs-variable">bucketIndex</span> <span class="hljs-operator">=</span> (num - min) * (bucketNum - <span class="hljs-number">1</span>) / (max - min);
            buckets.get(bucketIndex).add(num);
        }

        <span class="hljs-comment">// 4. 桶内排序 + 合并</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">index</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
        <span class="hljs-keyword">for</span> (List&lt;Integer&gt; bucket : buckets) {
            Collections.sort(bucket); <span class="hljs-comment">// 桶内用插入排序（Collections.sort底层是TimSort）</span>
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> num : bucket) {
                arr[index++] = num;
            }
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">int</span>[] arr = {<span class="hljs-number">5</span>, <span class="hljs-number">3</span>, <span class="hljs-number">8</span>, <span class="hljs-number">4</span>, <span class="hljs-number">2</span>};
        bucketSort(arr);
        System.out.println(Arrays.toString(arr)); <span class="hljs-comment">// 输出 [2, 3, 4, 5, 8]</span>
    }
}
</code></pre>
<h4 data-id="heading-55">算法分析</h4>
<ul>
<li>时间复杂度：最好 O(n+k)（分布均匀）、最坏 O(n2)（所有元素入一个桶）、平均 O(n+k)；</li>
<li>空间复杂度：O(n+k)（桶的数量）；</li>
<li>稳定性：稳定（取决于桶内排序算法，如插入排序稳定）；</li>
<li>适用场景：数值分布均匀的场景（如成绩、薪资）。</li>
</ul>
<hr/>
<h3 data-id="heading-56">10. 基数排序（Radix Sort）</h3>
<h4 data-id="heading-57">核心思想</h4>
<p>非比较排序：按数字的「位」（个位、十位、百位…）依次排序，从低位到高位（LSD）或高位到低位（MSD）。像按位数分级排序：先排个位，再排十位，最终整体有序。</p>
<h4 data-id="heading-58">算法步骤（LSD，低位优先）</h4>
<ol>
<li>找到数组的最大位数（如 <code>748</code> 是 3 位）；</li>
<li>从个位开始，按当前位的数值将元素分到 0-9 的桶中；</li>
<li>按桶的顺序（0→9）合并元素；</li>
<li>位数升级（十位、百位…），重复步骤 2-3；直到最高位。</li>
</ol>
<h4 data-id="heading-59">案例演示（数组 <code>[53, 3, 542, 748, 14, 214]</code>）</h4>
<ul>
<li>补零对齐：<code>003, 014, 053, 214, 542, 748</code>；</li>
<li>个位排序：按个位分桶→合并 <code>[542, 053, 003, 014, 214, 748]</code>；</li>
<li>十位排序：按十位分桶→合并 <code>[003, 014, 214, 542, 053, 748]</code>；</li>
<li>百位排序：按百位分桶→合并 <code>[003, 014, 053, 214, 542, 748]</code> → <code>[3,14,53,214,542,748]</code>。</li>
</ul>
<h4 data-id="heading-60">代码实现（Java，LSD）</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RadixSort</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">radixSort</span><span class="hljs-params">(<span class="hljs-type">int</span>[] arr)</span> {
        <span class="hljs-keyword">if</span> (arr == <span class="hljs-literal">null</span> || arr.length &lt;= <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span>;

        <span class="hljs-comment">// 1. 找最大值，确定最大位数</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">max</span> <span class="hljs-operator">=</span> arr[<span class="hljs-number">0</span>];
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> num : arr) {
            <span class="hljs-keyword">if</span> (num &gt; max) max = num;
        }

        <span class="hljs-comment">// 2. 按位排序（个位、十位、百位...）</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">exp</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; max / exp &gt; <span class="hljs-number">0</span>; exp *= <span class="hljs-number">10</span>) {
            countSortByDigit(arr, exp);
        }
    }

    <span class="hljs-comment">// 按指定位数排序（exp=1→个位，exp=10→十位...）</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">countSortByDigit</span><span class="hljs-params">(<span class="hljs-type">int</span>[] arr, <span class="hljs-type">int</span> exp)</span> {
        <span class="hljs-type">int</span> <span class="hljs-variable">n</span> <span class="hljs-operator">=</span> arr.length;
        <span class="hljs-type">int</span>[] output = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[n]; <span class="hljs-comment">// 输出数组</span>
        <span class="hljs-type">int</span>[] count = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[<span class="hljs-number">10</span>]; <span class="hljs-comment">// 0-9的桶</span>

        <span class="hljs-comment">// 统计当前位的次数</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> num : arr) {
            <span class="hljs-type">int</span> <span class="hljs-variable">digit</span> <span class="hljs-operator">=</span> (num / exp) % <span class="hljs-number">10</span>;
            count[digit]++;
        }

        <span class="hljs-comment">// 计算前缀和，确定元素位置（保证稳定性）</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; i &lt; <span class="hljs-number">10</span>; i++) {
            count[i] += count[i - <span class="hljs-number">1</span>];
        }

        <span class="hljs-comment">// 逆序遍历，保证稳定性</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> n - <span class="hljs-number">1</span>; i &gt;= <span class="hljs-number">0</span>; i--) {
            <span class="hljs-type">int</span> <span class="hljs-variable">digit</span> <span class="hljs-operator">=</span> (arr[i] / exp) % <span class="hljs-number">10</span>;
            output[count[digit] - <span class="hljs-number">1</span>] = arr[i];
            count[digit]--;
        }

        <span class="hljs-comment">// 拷贝回原数组</span>
        System.arraycopy(output, <span class="hljs-number">0</span>, arr, <span class="hljs-number">0</span>, n);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">int</span>[] arr = {<span class="hljs-number">53</span>, <span class="hljs-number">3</span>, <span class="hljs-number">542</span>, <span class="hljs-number">748</span>, <span class="hljs-number">14</span>, <span class="hljs-number">214</span>};
        radixSort(arr);
        System.out.println(Arrays.toString(arr)); <span class="hljs-comment">// 输出 [3, 14, 53, 214, 542, 748]</span>
    }
}
</code></pre>
<h4 data-id="heading-61">算法分析</h4>
<ul>
<li>时间复杂度：O(d×(n+k))（d= 最大位数，k= 基数 10）；</li>
<li>空间复杂度：O(n+k)（输出数组 + 计数数组）；</li>
<li>稳定性：稳定（逆序遍历 + 前缀和保证相对位置）；</li>
<li>适用场景：整数、字符串排序（如手机号、身份证号）。</li>
</ul>
<hr/>
<h3 data-id="heading-62">十大排序算法总结表</h3>


















































































<table><thead><tr><th>算法</th><th>时间复杂度（最好 / 平均 / 最坏）</th><th>空间复杂度</th><th>稳定性</th><th>核心特点</th></tr></thead><tbody><tr><td>冒泡排序</td><td>O(n)/O(n2)/O(n2)</td><td>O(1)</td><td>稳定</td><td>相邻交换，简单易实现</td></tr><tr><td>选择排序</td><td>O(n2)/O(n2)/O(n2)</td><td>O(1)</td><td>不稳定</td><td>选最小值交换，效率低</td></tr><tr><td>插入排序</td><td>O(n)/O(n2)/O(n2)</td><td>O(1)</td><td>稳定</td><td>插牌逻辑，小规模数据高效</td></tr><tr><td>希尔排序</td><td>O(nlogn)/O(n1.3)/O(n2)</td><td>O(1)</td><td>不稳定</td><td>分组插入排序，效率优于插入</td></tr><tr><td>归并排序</td><td>O(nlogn)/O(nlogn)/O(nlogn)</td><td>O(n)</td><td>稳定</td><td>分治合并，效率稳定</td></tr><tr><td>快速排序</td><td>O(nlogn)/O(nlogn)/O(n2)</td><td>O(logn)</td><td>不稳定</td><td>分治分区，实际应用最优</td></tr><tr><td>堆排序</td><td>O(nlogn)/O(nlogn)/O(nlogn)</td><td>O(1)</td><td>不稳定</td><td>利用堆结构，原地排序</td></tr><tr><td>计数排序</td><td>O(n+k)/O(n+k)/O(n+k)</td><td>O(n+k)</td><td>稳定</td><td>非比较，数值范围小高效</td></tr><tr><td>桶排序</td><td>O(n+k)/O(n+k)/O(n2)</td><td>O(n+k)</td><td>稳定</td><td>分桶排序，分布均匀时高效</td></tr><tr><td>基数排序</td><td>O(d(n+k))/O(d(n+k))/O(d(n+k))</td><td>O(n+k)</td><td>稳定</td><td>按位排序，适合整数 /</td></tr></tbody></table></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[踩坑实录！MQ 消费租户菜单更新竟引发并发血案？我是如何把线上 BUG 按在地上摩擦的]]></title>    <link>https://juejin.cn/post/7599268297202008102</link>    <guid>https://juejin.cn/post/7599268297202008102</guid>    <pubDate>2026-01-25T14:07:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599268297202008102" data-draft-id="7598881914203914290" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="踩坑实录！MQ 消费租户菜单更新竟引发并发血案？我是如何把线上 BUG 按在地上摩擦的"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-25T14:07:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="爱找bug的李寻欢"/> <meta itemprop="url" content="https://juejin.cn/user/3228615868953102"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            踩坑实录！MQ 消费租户菜单更新竟引发并发血案？我是如何把线上 BUG 按在地上摩擦的
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3228615868953102/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    爱找bug的李寻欢
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-25T14:07:03.000Z" title="Sun Jan 25 2026 14:07:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>作为一名后端开发，最怕的不是写代码，而是线上突然炸锅 —— 告警群 99+、业务方追着问、老板在群里 @你… 最近我就踩了个巨坑：一段看似平平无奇的 MQ 消费租户菜单更新代码，上线后直接引发并发血案：租户菜单重复创建、部分租户更新完全失效、甚至偶发<strong>租户数据串流</strong>（A 租户能看到 B 租户的菜单）！</p>
<p>今天就带大家复盘整个排坑过程，把这些藏在代码里的 “隐形炸弹” 揪出来，顺便聊聊 MQ 消费并发场景下的避坑指南～</p>
<h2 data-id="heading-0">一、案发现场：MQ 消费的 “诡异现象”</h2>
<p>先交代下背景：这段代码是 MQ 消费者的<code>onMessage</code>方法，核心功能是监听 “租户角色菜单更新” 消息，异步更新租户的菜单权限。上线前测试一切正常，结果一上生产，诡异现象接二连三：</p>
<ol>
<li><strong>重复执行</strong>：同一租户的菜单更新请求被多次消费，菜单数据重复插入，数据库里一堆重复记录；</li>
<li><strong>更新失效</strong>：部分租户反馈菜单改了但不生效，查日志发现消息明明消费了，却卡在 Redis 锁判断直接返回；</li>
<li><strong>数据串流</strong>：最致命的！偶发 A 租户能看到 B 租户的菜单，多租户隔离直接破防，这要是被用户发现，妥妥的生产事故！</li>
</ol>
<p>先贴出那段 “罪魁祸首” 的核心代码（大家先品品，能看出几个问题？）：</p>
<p>java</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d8bed23dc95240399d117cac6856eb95~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5om-YnVn55qE5p2O5a-75qyi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769954823&amp;x-signature=QGGNZ1SdBJJdrm9dY1r%2Bu3Gu57c%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-1">二、抽丝剥茧：扒开代码里的 “隐形炸弹”</h2>
<p>看似简单的几十行代码，藏了 4 个能引爆生产的坑，个个都是 “致命级”：</p>
<h3 data-id="heading-2">1. 分布式锁的 “伪实现”—— 没过期时间的 Redis Key 就是定时炸弹</h3>
<p>代码里想通过<code>Redis Key=true</code>实现 “防重复消费”，但这波操作纯纯是 “裸奔”：</p>
<ul>
<li><strong>无过期时间</strong>：如果程序在<code>set(key, true)</code>后、<code>finally</code>前崩溃（比如 JVM 宕机、线程被 Kill），这个 Key 会永远留在 Redis 里，后续该租户的所有更新请求都会因为<code>isSync=true</code>直接返回，菜单更新彻底失效；</li>
<li><strong>非原子性操作</strong>：<code>get(key)</code> + <code>set(key)</code>是两步操作，高并发下多个线程能同时拿到<code>isSync=null</code>，然后都执行<code>set</code>，最终多线程并发处理同一租户的菜单，导致数据重复；</li>
<li><strong>锁归属权混乱</strong>：<code>finally</code>里直接删 Key，不管这把锁是不是当前线程加的，容易误删其他线程的锁，并发问题雪上加霜。</li>
</ul>
<p>👉 生动比喻：这就像你给房门装了把锁，但既没配钥匙，也没设自动开锁时间 —— 一旦锁上，这扇门就永远打不开了；更坑的是，多个人同时来开锁，还能一起把门撞开，屋里的东西被翻得乱七八糟。</p>
<h3 data-id="heading-3">2. 租户上下文的 “漏网之鱼”—— 线程池复用导致的 “串台”</h3>
<p>多租户系统的核心是 “租户上下文隔离”，但代码里只做了<code>setTenantId</code>，却没在<code>finally</code>里清理：</p>
<pre><code class="hljs language-scss" lang="scss">TenantContextHolder<span class="hljs-selector-class">.setTenantId</span>(xxx); <span class="hljs-comment">// 只加不删！</span>
</code></pre>
<p>MQ 消费者一般运行在线程池里，线程执行完任务不会销毁，会复用给下一个任务。如果线程 A 处理完租户 1 的请求，上下文没清，线程 A 再处理租户 2 的请求时，就会带着租户 1 的 ID 跑，直接导致<strong>数据串流</strong>（A 租户看到 B 租户的菜单）。</p>
<p>👉 生动比喻：这就像餐厅服务员用完 A 桌的餐具，没收拾就直接端给 B 桌用 —— 不仅不卫生，还会让 B 桌顾客吃到 A 桌的剩菜，体验直接拉满（负的）。</p>
<h3 data-id="heading-4">3. 异常处理的 “摆烂操作”—— 吞掉所有异常 + 日志缺堆栈</h3>
<p>代码里<code>catch (Exception e)</code>把所有异常都吞了，还只打印了异常消息，没打印堆栈：</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-built_in">log</span>.error(<span class="hljs-string">"upd-app-role-menu-topic exception is :{}"</span>,e); <span class="hljs-comment">// 错误示范！</span>
</code></pre>
<p>这会导致两个问题：</p>
<ul>
<li>异常被 “吞”：即使核心业务逻辑（比如菜单插入数据库）失败，程序也不会报错，监控系统感知不到，问题藏在暗处；</li>
<li>日志 “残废”：只有异常消息（比如<code>NullPointerException</code>），没有堆栈，根本定位不到是哪一行代码出问题，排障时只能瞎猜。</li>
</ul>
<p>👉 生动比喻：这就像医生看病只看病人说 “不舒服”，既不问哪里不舒服，也不做检查，还不写病历 —— 等病人病情恶化，连怎么治都不知道。</p>
<h3 data-id="heading-5">4. Redis 操作的 “粗心大意”—— 空 Key + 反序列化隐患</h3>
<p>代码里拼接 Redis Key 时直接用<code>cacheKey</code>，没做非空校验：</p>
<p>java</p>
<p>运行</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-string">"tenant_menu:"</span>+updAppTenantRoleMenuDTO.<span class="hljs-built_in">getCacheKey</span>() <span class="hljs-comment">// cacheKey可能为null</span>
</code></pre>
<p>如果<code>cacheKey</code>是<code>null</code>，最终 Key 会变成<code>tenant_menu:null</code>，不仅不符合 Redis Key 规范，还拿不到任何数据；更坑的是，直接把 Redis 里的 Object 强转成<code>List&lt;AppMenuEntity&gt;</code>，如果<code>redisTemplate</code>没配置 JSON 序列化器，会因为 JDK 序列化问题导致反序列化失败，直接抛异常。</p>
<p>👉 生动比喻：这就像寄快递没写清楚收件地址，还把包裹缠了十几层胶带 —— 快递员找不到人，就算找到人，也打不开包裹。</p>
<h2 data-id="heading-6">三、对症下药：把 BUG 按在地上摩擦的优化方案</h2>
<p>找到问题后，针对性优化，每一步都直击痛点：</p>
<h3 data-id="heading-7">1. 升级分布式锁：用 Redisson 替代手动实现（别自己造轮子！）</h3>
<p>手动实现分布式锁容易踩坑，直接用成熟的 Redisson，原子性 + 过期时间 + 锁归属权校验全搞定：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Resource</span>
<span class="hljs-keyword">private</span> RedissonClient redissonClient;

<span class="hljs-meta">@SneakyThrows</span>
<span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onMessage</span><span class="hljs-params">(UpdAppTenantRoleMenuDTO updAppTenantRoleMenuDTO)</span> {
    <span class="hljs-type">String</span> <span class="hljs-variable">tenantId</span> <span class="hljs-operator">=</span> updAppTenantRoleMenuDTO.getTenantId();
    <span class="hljs-type">String</span> <span class="hljs-variable">lockKey</span> <span class="hljs-operator">=</span> <span class="hljs-string">"upd-app-role-menu-topic:"</span> + tenantId;
    <span class="hljs-type">RLock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> redissonClient.getLock(lockKey);
    <span class="hljs-comment">// 5秒内拿不到锁就放弃，锁30秒自动过期（避免死锁）</span>
    <span class="hljs-keyword">if</span> (!lock.tryLock(<span class="hljs-number">5</span>, <span class="hljs-number">30</span>, TimeUnit.SECONDS)) {
        log.info(<span class="hljs-string">"租户{}菜单更新任务正在执行，本次请求放弃"</span>, tenantId);
        <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-keyword">try</span> {
        <span class="hljs-comment">// 核心业务逻辑（下文继续优化）</span>
    } <span class="hljs-keyword">catch</span> (Exception e) {
        log.error(<span class="hljs-string">"租户{}菜单更新异常"</span>, tenantId, e); <span class="hljs-comment">// 打印完整堆栈</span>
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BusinessException</span>(<span class="hljs-string">"租户菜单更新失败"</span>, e); <span class="hljs-comment">// 抛异常触发告警</span>
    } <span class="hljs-keyword">finally</span> {
        <span class="hljs-comment">// 只释放当前线程持有的锁，避免误删</span>
        <span class="hljs-keyword">if</span> (lock.isHeldByCurrentThread()) {
            lock.unlock();
        }
    }
}
</code></pre>
<h3 data-id="heading-8">2. 管好租户上下文：try-finally 必清理（用完即清！）</h3>
<p>多租户上下文必须 “加了就清”，哪怕抛异常也要清：</p>
<p>java</p>
<p>运行</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">try</span> {
    <span class="hljs-comment">// 设置租户上下文</span>
    TenantContextHolder.setTenantId(tenantId);
    <span class="hljs-comment">// 核心业务逻辑...</span>
} <span class="hljs-keyword">finally</span> {
    <span class="hljs-comment">// 无论是否异常，都清理上下文！</span>
    TenantContextHolder.clear();
    <span class="hljs-comment">// 释放锁等其他操作...</span>
}
</code></pre>
<h3 data-id="heading-9">3. 规范异常处理：精准捕获 + 完整日志</h3>
<p>别再无脑<code>catch (Exception e)</code>，精准捕获业务异常 + 打印完整堆栈：</p>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-keyword">try</span> {
    // 核心业务逻辑
} <span class="hljs-keyword">catch</span> (RedisException e) {
    log.<span class="hljs-keyword">error</span>(<span class="hljs-string">"租户{}菜单更新-Redis操作异常"</span>, tenantId, e);
    <span class="hljs-keyword">throw</span> <span class="hljs-built_in">new</span> BusinessException(<span class="hljs-string">"Redis操作失败，菜单更新终止"</span>, e);
} <span class="hljs-keyword">catch</span> (ServiceException e) {
    log.<span class="hljs-keyword">error</span>(<span class="hljs-string">"租户{}菜单更新-业务服务异常"</span>, tenantId, e);
    <span class="hljs-keyword">throw</span> <span class="hljs-built_in">new</span> BusinessException(<span class="hljs-string">"业务服务调用失败，菜单更新终止"</span>, e);
} <span class="hljs-keyword">catch</span> (Exception e) {
    log.<span class="hljs-keyword">error</span>(<span class="hljs-string">"租户{}菜单更新-未知异常"</span>, tenantId, e);
    <span class="hljs-keyword">throw</span> <span class="hljs-built_in">new</span> BusinessException(<span class="hljs-string">"未知异常，菜单更新终止"</span>, e);
}
</code></pre>
<h3 data-id="heading-10">4. Redis 操作 “加防护”：空值校验 + 正确序列化</h3>
<p>先校验 Key 的合法性，再配置 Redis 序列化器（避免反序列化失败）：
运行</p>
<pre><code class="hljs language-ini" lang="ini">// 1. 空值校验
String <span class="hljs-attr">cacheKey</span> = updAppTenantRoleMenuDTO.getCacheKey()<span class="hljs-comment">;</span>
if (StringUtils.isBlank(cacheKey)) {
    log.warn("租户{}的cacheKey为空，菜单更新终止", tenantId)<span class="hljs-comment">;</span>
    return<span class="hljs-comment">;</span>
}
String <span class="hljs-attr">menuRedisKey</span> = <span class="hljs-string">"tenant_menu:"</span> + cacheKey<span class="hljs-comment">;</span>

// 2. 安全获取数据（先确保redisTemplate配置了Jackson序列化）
List&lt;AppMenuEntity&gt; <span class="hljs-attr">sysMenus</span> = (List&lt;AppMenuEntity&gt;) redisTemplate.opsForValue().get(menuRedisKey)<span class="hljs-comment">;</span>
if (CollectionUtil.isEmpty(sysMenus)) {
    log.warn("租户{}的菜单列表为空，更新终止", tenantId)<span class="hljs-comment">;</span>
    return<span class="hljs-comment">;</span>
}
</code></pre>
<p>Redis 序列化配置示例（关键！）：</p>
<p>java</p>
<p>运行</p>
<pre><code class="hljs language-arduino" lang="arduino">@<span class="hljs-function">Bean
<span class="hljs-keyword">public</span> RedisTemplate&lt;<span class="hljs-type">String</span>, Object&gt; <span class="hljs-title">redisTemplate</span><span class="hljs-params">(RedisConnectionFactory factory)</span> </span>{
    RedisTemplate&lt;<span class="hljs-type">String</span>, Object&gt; <span class="hljs-keyword">template</span> = <span class="hljs-keyword">new</span> RedisTemplate&lt;&gt;();
    <span class="hljs-keyword">template</span>.<span class="hljs-built_in">setConnectionFactory</span>(factory);
    <span class="hljs-comment">// 使用Jackson2JsonRedisSerializer序列化</span>
    Jackson2JsonRedisSerializer&lt;Object&gt; serializer = <span class="hljs-keyword">new</span> Jackson2JsonRedisSerializer&lt;&gt;(Object.<span class="hljs-keyword">class</span>);
    ObjectMapper mapper = <span class="hljs-keyword">new</span> <span class="hljs-built_in">ObjectMapper</span>();
    mapper.<span class="hljs-built_in">setVisibility</span>(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY);
    mapper.<span class="hljs-built_in">activateDefaultTyping</span>(LaissezFaireSubTypeValidator.instance, ObjectMapper.DefaultTyping.NON_FINAL);
    serializer.<span class="hljs-built_in">setObjectMapper</span>(mapper);
    <span class="hljs-comment">// 设置Key和Value的序列化器</span>
    <span class="hljs-keyword">template</span>.<span class="hljs-built_in">setKeySerializer</span>(<span class="hljs-keyword">new</span> <span class="hljs-built_in">StringRedisSerializer</span>());
    <span class="hljs-keyword">template</span>.<span class="hljs-built_in">setValueSerializer</span>(serializer);
    <span class="hljs-keyword">template</span>.<span class="hljs-built_in">afterPropertiesSet</span>();
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">template</span>;
}
</code></pre>
<h2 data-id="heading-11">四、避坑指南：MQ 消费并发场景的 “保命法则”</h2>
<p>踩完这些坑，我总结了 4 条 “保命法则”，分享给大家：</p>
<ol>
<li><strong>分布式锁别自己造轮子</strong>：Redisson/Redlock 才是 YYDS，手动实现容易漏原子性、过期时间、锁归属权这些关键点；</li>
<li><strong>多租户上下文 =“用完即清”</strong> ：线程池环境下，租户 ID、用户 ID 等上下文信息，必须在 finally 里清理，否则必串流；</li>
<li><strong>异常别 “吞”，日志别 “缺”</strong> ：异常要抛出去（触发监控告警），日志要打印完整堆栈（方便定位问题），别做 “甩手掌柜”；</li>
<li><strong>Redis 操作先校验</strong>：拼接 Key 前先校验非空，序列化配置要到位，避免反序列化失败 / 非法 Key。</li>
</ol>
<h2 data-id="heading-12">五、最后唠两句</h2>
<p>这段代码的问题，其实都不是 “高深的技术难题”，而是基础规范没做好 —— 分布式锁的基础、线程安全的基础、异常处理的基础。但恰恰是这些 “基础坑”，在生产环境下会被放大成致命故障。</p>
<p>踩坑不可怕，可怕的是踩了不总结。希望这篇复盘能帮大家少走弯路，也欢迎评论区聊聊你踩过的 MQ 并发坑～</p>
<h3 data-id="heading-13">关键点回顾</h3>
<ol>
<li>手动实现的 Redis 分布式锁若无过期时间和原子性保障，易引发死锁和重复执行，优先用 Redisson；</li>
<li>多租户系统中，租户上下文必须在 finally 块清理，避免线程池复用导致数据串流；</li>
<li>MQ 消费异常不能 “吞”，日志要打印完整堆栈，关键异常需抛出触发告警；</li>
<li>Redis 操作前要校验 Key 合法性，配置正确的序列化器避免反序列化失败。</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[我的项目实战（六）- Prisma ORM：从数据库设计到高效开发]]></title>    <link>https://juejin.cn/post/7598710324167557135</link>    <guid>https://juejin.cn/post/7598710324167557135</guid>    <pubDate>2026-01-25T14:12:28.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598710324167557135" data-draft-id="7598710324167507983" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="我的项目实战（六）- Prisma ORM：从数据库设计到高效开发"/> <meta itemprop="keywords" content="后端,NestJS"/> <meta itemprop="datePublished" content="2026-01-25T14:12:28.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ETA8"/> <meta itemprop="url" content="https://juejin.cn/user/608445545328347"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            我的项目实战（六）- Prisma ORM：从数据库设计到高效开发
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/608445545328347/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ETA8
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-25T14:12:28.000Z" title="Sun Jan 25 2026 14:12:28 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在我们的 react + nestjs全栈开发中，如何高效、安全地操作数据库，是开发者都会面临的问题。传统的 SQL 编写方式虽然灵活，但容易出错、难以维护；而过度依赖原始查询又会让代码变得臃肿且缺乏类型安全性。</p>
<p>这次让我们使用<strong>prisma</strong>，这个对象映射关系工具，剖析其数据模型设计背后的思考逻辑，讲解迁移（migrate）机制的实际价值，并探讨 Prisma 在企业级应用中的优势与注意事项。让我们还原一次完整的数据库建模与开发流程。</p>
<hr/>
<h2 data-id="heading-0">一、为什么选择 Prisma？告别手写 SQL 的时代</h2>
<p>我们先来回答一个问题：<strong>为什么要用 ORM？</strong></p>
<p>很多初学者会认为，“SQL 我都会写，还用什么 ORM？” 这个想法没错，但在实际工程中，随着业务增长，你会发现：</p>
<ul>
<li>多人协作时，每个人写的 SQL 风格不同；</li>
<li>表结构变更频繁，手动改 SQL 容易遗漏；</li>
<li>类型不安全，JS/TS 中无法静态检查字段是否存在；</li>
<li>分页、关联查询等重复逻辑不断复制粘贴。</li>
</ul>
<p>而 Prisma 正是为了解决这些问题而生的——它不是简单的 ORM 工具，更像是一套<strong>类型安全 + 自动化迁移 + 可视化调试</strong>的完整解决方案。</p>
<blockquote>
<p>Prisma = Schema 设计 + 数据迁移 + 类型生成 + 查询构建器</p>
</blockquote>
<p>它的核心理念是：<strong>把数据库当作代码一样管理</strong>。</p>
<hr/>
<h2 data-id="heading-1">二、数据模型设计：不只是建表，更是业务逻辑的表达</h2>
<p>让我们来看这样一个场景：我们要做一个内容社区系统，包含用户、文章、评论、标签、点赞等功能。这看似简单，但其中的关系处理非常关键。</p>
<h3 data-id="heading-2">1. 用户表（User）</h3>
<pre><code class="hljs language-prisma" lang="prisma">model User {
  id        Int      @id @default(autoincrement())
  name      String   @unique
  password  String
  posts     Post[]
  comments  Comment[]
  likes     UserLikePost[]
}
</code></pre>
<p>这里有几个重点设计点值得说明：</p>
<h4 data-id="heading-3">✅ 唯一用户名 <code>@unique</code></h4>
<p>用户名作为登录标识，必须唯一。使用 <code>@unique</code> 能自动创建唯一索引，避免程序层漏校验导致脏数据。</p>
<h4 data-id="heading-4">✅ 级联删除 vs 置空策略的选择</h4>
<p>比如用户的头像（Avatar）、文件（File），都设置了 <code>onDelete: Cascade</code> —— 用户删了，相关资源也一并清理，符合直觉。</p>
<p>但文章（Post）却设置为：</p>
<pre><code class="hljs language-prisma" lang="prisma">user Post? @relation(... onDelete: SetNull)
</code></pre>
<p>这意味着：<strong>当作者被删除时，文章仍然保留，只是作者变为空</strong>。这是出于内容保护的考虑——不能因为某个用户注销账号，就让所有他发布的内容消失。类似知乎、微博的做法。</p>
<blockquote>
<p>⚠️ 思考题：什么时候该用 <code>Cascade</code>？什么时候用 <code>SetNull</code>？</p>
<ul>
<li><code>Cascade</code>：附属资源无独立意义（如用户上传的临时图片）</li>
<li><code>SetNull</code>：主资源有价值，需保留历史记录（如文章、评论）</li>
</ul>
</blockquote>
<hr/>
<h3 data-id="heading-5">2. 文章与标签的多对多关系（PostTag）</h3>
<p>标签系统是一个典型的多对多场景。直接在 <code>Post</code> 上加 <code>tagIds</code> 字段看似方便，实则违反范式，后期难扩展。</p>
<p>Prisma 推荐显式定义中间表：</p>
<pre><code class="hljs language-prisma" lang="prisma">model PostTag {
  postId Int
  tagId  Int
  post   Post @relation(fields: [postId], references: [id], onDelete: Cascade)
  tag    Tag  @relation(fields: [tagId], references: [id], onDelete: Cascade)
  @@id([postId, tagId])
}
</code></pre>
<p>这样做有三个好处：</p>
<ol>
<li><strong>清晰表达关系结构</strong>：不再是隐式的数组字符串拼接；</li>
<li><strong>支持额外字段扩展</strong>：未来如果要记录“谁添加的标签”、“添加时间”，可以直接在这个表里加字段；</li>
<li><strong>性能可控</strong>：可以针对 <code>(tagId)</code> 建立索引，实现“查找某标签下的所有文章”这类高频查询。</li>
</ol>
<blockquote>
<p>💡 小技巧：中间表命名建议统一为 <code>&lt;Left&gt;&lt;Right&gt;</code> 形式，如 <code>PostTag</code>，而不是 <code>TagPost</code> 或 <code>post_tags</code> 混用，保持一致性。</p>
</blockquote>
<hr/>
<h3 data-id="heading-6">3. 评论的递归关系（Comment → Comment）</h3>
<p>评论可以回复评论，形成树状结构。这种自引用关系在 Prisma 中通过 <code>@relation("Name")</code> 显式命名来实现：</p>
<pre><code class="hljs language-prisma" lang="prisma">model Comment {
  parent   Comment?  @relation("CommentToComment", fields: [parentId], references: [id])
  replies  Comment[] @relation("CommentToComment")
}
</code></pre>
<p>这个设计的关键在于：</p>
<ul>
<li>使用字符串 <code>"CommentToComment"</code> 区分两个方向的关系；</li>
<li><code>parentId</code> 可为空，表示顶层评论；</li>
<li>删除父评论时，子评论也级联删除（<code>onDelete: Cascade</code>），防止孤儿节点。</li>
</ul>
<blockquote>
<p>❗ 注意：递归删除可能引发性能问题。若评论层级很深或数量巨大，应结合软删除或异步任务处理。</p>
</blockquote>
<hr/>
<h3 data-id="heading-7">4. 文件存储的设计（File 表）</h3>
<p>文件表不仅记录路径，还包括元信息：</p>
<pre><code class="hljs language-prisma" lang="prisma">model File {
  originalname String
  mimetype     String
  filename     String
  size         Int
  width        Int @db.SmallInt
  height       Int @db.SmallInt
  metadata     Json?
  postId       Int?
  userId       Int
}
</code></pre>
<p>几点设计考量：</p>
<ul>
<li><code>width</code> / <code>height</code> 使用 <code>@db.SmallInt</code> 显式映射 PostgreSQL 的 smallint 类型，节省空间；</li>
<li><code>metadata</code> 使用 <code>Json?</code> 类型，可用于保存缩略图地址、OCR 结果等非结构化数据；</li>
<li><code>postId</code> 可为空，意味着文件既可以属于文章，也可以属于用户个人上传（如头像）；</li>
<li>关联用户时使用 <code>Cascade</code>，确保用户注销后不会留下垃圾文件。</li>
</ul>
<hr/>
<h2 data-id="heading-8">三、迁移（Migrate）：让数据库变更可追踪、可回滚</h2>
<p>很多人一开始跳过 <code>prisma migrate</code>，直接用 <code>db push</code> 快速同步 schema 到数据库。但这只适合本地开发。</p>
<p>真正的生产环境，必须使用 <strong>迁移脚本（migration script）</strong>。</p>
<p>执行命令：</p>
<pre><code class="hljs language-bash" lang="bash">npx prisma migrate dev --name init_user
</code></pre>
<p>Prisma 会做三件事：</p>
<ol>
<li>对比当前 <code>schema.prisma</code> 和数据库状态；</li>
<li>生成 SQL 迁移文件（放在 <code>prisma/migrations/</code> 目录下）；</li>
<li>执行 SQL 并更新数据库。</li>
</ol>
<h3 data-id="heading-9">为什么需要迁移？</h3>
<p>举个例子：你在本地加了个字段 <code>email</code>，同事 A 也加了 <code>phone</code>，你们都没沟通。如果直接 <code>db push</code>，很可能覆盖对方改动。</p>
<p>但如果有迁移脚本：</p>
<ul>
<li>你的提交包含 <code>add_email_field.sql</code></li>
<li>他的提交包含 <code>add_phone_field.sql</code></li>
<li>CI 流水线会按顺序执行这两个脚本，最终两者都存在</li>
</ul>
<p>这就实现了 <strong>数据库版本控制</strong>，就像 Git 管理代码一样。</p>
<blockquote>
<p>🔔 提示：团队协作中，每次修改 schema 都应提交对应的 migration 文件，不要只提交 <code>.prisma</code> 文件。</p>
</blockquote>
<hr/>
<h2 data-id="heading-10">四、Prisma Studio：可视化调试利器</h2>
<p>运行：</p>
<pre><code class="hljs language-bash" lang="bash">npx prisma studio
</code></pre>
<p>打开浏览器就能看到图形化界面，支持增删改查，特别适合：</p>
<ul>
<li>查看种子数据是否正确；</li>
<li>调试复杂关系的数据展示；</li>
<li>给产品经理演示后台数据结构。</li>
</ul>
<p>虽然是个小工具，但在快速验证阶段极为实用。</p>
<hr/>
<h2 data-id="heading-11">五、实战建议与避坑指南</h2>
<h3 data-id="heading-12">✅ 最佳实践</h3>

























<table><thead><tr><th>实践</th><th>说明</th></tr></thead><tbody><tr><td>使用 <code>migrate dev</code> 而非 <code>db push</code></td><td>保证迁移历史完整</td></tr><tr><td>每次 schema 修改都生成新 migration</td><td>避免线上冲突</td></tr><tr><td>多对多关系显式建中间表</td><td>更灵活、可扩展</td></tr><tr><td>时间字段统一用 <code>DateTime @default(now())</code></td><td>避免时区混乱</td></tr></tbody></table>
<h3 data-id="heading-13">❌ 常见误区</h3>
<ol>
<li>
<p><strong>滥用 <code>any</code> 类型绕过 Prisma 类型检查</strong></p>
<blockquote>
<p>不要用 <code>as any</code> 强转结果，失去类型安全的意义。</p>
</blockquote>
</li>
<li>
<p><strong>忽略索引导致慢查询</strong></p>
<blockquote>
<p>对经常用于查询的外键字段（如 <code>userId</code>, <code>postId</code>）务必加 <code>@@index</code>。</p>
</blockquote>
</li>
<li>
<p><strong>在事务中执行耗时操作</strong></p>
<blockquote>
<p>Prisma 支持事务，但不要在里面做 HTTP 请求或文件处理，容易超时。</p>
</blockquote>
</li>
<li>
<p><strong>忘记设置环境变量</strong></p>
<blockquote>
<p><code>DATABASE_URL</code> 必须配置正确，尤其是生产环境注意加密传输。</p>
</blockquote>
</li>
</ol>
<hr/>
<h2 data-id="heading-14">六、总结：Prisma 是现代 Node.js 开发的基础设施</h2>
<p>经过这次实战，我们可以得出结论：</p>
<blockquote>
<p><strong>Prisma 不只是一个数据库客户端，它是连接代码与数据库之间的桥梁，让后端开发变得更可靠、更高效、更容易协作。</strong></p>
</blockquote>
<p>它带来的改变不仅仅是“少写 SQL”，更重要的是：</p>
<ul>
<li>数据结构设计前置化；</li>
<li>数据变更可追溯；</li>
<li>查询类型安全；</li>
<li>团队协作更顺畅。</li>
</ul>
<p>当你开始在一个项目中使用 Prisma 并建立起规范的 migration 流程后，你会发现：<strong>数据库不再是一个黑盒，而是整个应用中最清晰、最可维护的一部分。</strong></p>
<hr/>
<h2 data-id="heading-15">延伸阅读建议</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.prisma.io%2Fdocs" target="_blank" title="https://www.prisma.io/docs" ref="nofollow noopener noreferrer">Prisma 官方文档</a></li>
<li>如何在 NestJS 中集成 Prisma（推荐封装 Module）</li>
<li>使用 <code>prisma seed</code> 初始化测试数据</li>
<li>生产环境中如何安全执行 migrate（配合 CI/CD）</li>
</ul>
<p>如果你正在启动一个新的 Node.js 项目，不妨试试从 Prisma 开始。也许你会发现，原来操作数据库也可以如此优雅。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[MySQL索引结构的演进与设计逻辑]]></title>    <link>https://juejin.cn/post/7598737609494691859</link>    <guid>https://juejin.cn/post/7598737609494691859</guid>    <pubDate>2026-01-25T15:03:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598737609494691859" data-draft-id="7598767580306063414" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="MySQL索引结构的演进与设计逻辑"/> <meta itemprop="keywords" content="MySQL,程序员,数据库"/> <meta itemprop="datePublished" content="2026-01-25T15:03:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Olaf_n"/> <meta itemprop="url" content="https://juejin.cn/user/1324234125087575"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            MySQL索引结构的演进与设计逻辑
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1324234125087575/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Olaf_n
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-25T15:03:56.000Z" title="Sun Jan 25 2026 15:03:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、引言</h2>
<p>索引并非与生俱来就是B+树结构，但大多数人与MySQL打交道时，都默认了索引=B+树的认知。我们往往记住了最终的结论，却忽略了背后的迭代历程——它为何会从早期的查找树，一步步演化成如今的B+树？每一次迭代都在解决什么核心痛点，今天我们就来拆解MySQL索引结构的演变。</p>
<h2 data-id="heading-1">二、索引结构的设计核心诉求</h2>
<p>在追溯演进前，我们先明确一个核心前提：所有索引结构的设计，都围绕三大核心诉求平衡展开，这也是判断结构优劣的关键标尺。</p>
<ol>
<li><strong>高效查询</strong>：核心是减少磁盘IO次数，既要支持等值查询，也要适配范围查询、排序等高频业务场景，避免极端慢查询。</li>
<li><strong>低存储成本</strong>：索引本身不存储业务数据，仅作为导航工具，需控制自身存储空间，避免占用过多磁盘资源。</li>
<li><strong>稳定性与适配性</strong>：适配磁盘存储的预读特性，能应对大数据量增长，维持索引结构平衡，确保查询效率稳定。</li>
</ol>
<h2 data-id="heading-2">三、演进脉络</h2>
<h3 data-id="heading-3">第一代结构（二叉查找树）</h3>
<p>二叉查找树的特点如下</p>
<ul>
<li>若左子树不空，则左子树上所有结点的值均小于根节点的值；</li>
<li>若右字树不空，则右子树上所有结点的值均大于跟节点的值；</li>
<li>左、右子树也分别为二叉排序树</li>
</ul>
<p>如图</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ad160094b7ea446896725c216db7cd3f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT2xhZl9u:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769958236&amp;x-signature=HrwvP0gmPr6cvSMOj3gcbREuuJA%3D" alt="image.png" loading="lazy"/></p>
<ol>
<li>
<p><strong>核心结构</strong>：每个节点最多包含两个子节点，左子树的所有节点值小于父节点，右子树的所有节点值大于父节点，通过这种有序性实现快速查找。</p>
</li>
<li>
<p><strong>查找逻辑</strong>：以查询值与父节点比较，小于则进入左子树，大于则进入右子树，依次递归，直到找到目标节点或遍历至空节点。</p>
</li>
<li>
<p><strong>致命局限</strong>：完全无法适配MySQL的大数据量、磁盘存储场景</p>
</li>
</ol>
<p>这种结构有一个致命的缺陷就是会退化成单链表，查找时间复杂度从O(logn)骤变为O(n)，与全表扫描无异；比如这种数据情况【50，40，30，20，10，5】</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4f91af01dda84f7f8936ef3f8e5a60a6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT2xhZl9u:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769958236&amp;x-signature=G%2FPHyOpb6Uoj%2FxeA8xwPnw0LtMw%3D" alt="image.png" loading="lazy"/></p>
<p>树高过高百万级数据下，树高可达数十层甚至上百层，而磁盘IO是毫秒级操作，过多IO次数会导致查询极慢；</p>
<p>不支持范围查询高效遍历：需额外排序或全量遍历，无法满足MySQL高频范围查询需求。</p>
<h3 data-id="heading-4">优化改进：平衡二叉树（红黑树也是属于平衡树的一种）</h3>
<p>平衡二叉树的特点：在满足二叉搜索树的基础上，左树和右树的高度差绝对值不超过1</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d2628b83a7c542f8be9de8fe24b210cf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT2xhZl9u:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769958236&amp;x-signature=33GXwcgfsZRV1QndrA%2FFlnPAcAk%3D" alt="" loading="lazy"/></p>
<p>平衡二叉树可以通过左旋转和右旋转调整树的高度，使其维持基本的平衡，但是还有一个核心的问题还没有解决。树的高度问题，如果数据量过大，还是会导致这棵树的高度过高。</p>
<h3 data-id="heading-5">继续优化：B-tree（B树）</h3>
<p>B树的本质上是一种多路查找树结构，B树的特征点是每一层节点存的都是真实数据。B树的结构如下
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3df6275a91dc4f13882ff2f050f63a5c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT2xhZl9u:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769958236&amp;x-signature=NJiZBW9mvwQ%2B9sdeVSROX06LnIY%3D" alt="" loading="lazy"/></p>
<p>B树的查找流程</p>
<h4 data-id="heading-6">单条数据查找流程（以查找 key = 45 为例）</h4>
<ol>
<li>
<p><strong>从根节点开始查找</strong><br/>
根节点包含关键字 <code>[30, 60, 90]</code>。<br/>
根据 B 树的查找规则：</p>
<ul>
<li>45 &gt; 30 且 45 &lt; 60<br/>
因此沿着 <strong>30 与 60 之间对应的子指针</strong>，进入第二个子节点。</li>
</ul>
</li>
<li>
<p><strong>在目标子节点中查找数据</strong><br/>
进入子节点 <code>[35, 45, 55]</code> 后，在该节点内部对关键字进行查找（顺序查找或二分查找）。<br/>
此时可以直接定位到 key = 45，对应的数据记录被成功命中，查找流程结束。</p>
</li>
</ol>
<blockquote>
<p>可以看到，B 树的单条数据查找过程是一个<strong>自顶向下的逐层定位过程</strong>，当目标 key 出现在某个节点中时，查找即可结束。</p>
</blockquote>
<h4 data-id="heading-7">范围数据查找流程（以查找 45 ~ 100 为例）</h4>
<p>范围查询是B树相对容易暴露性能问题的场景。</p>
<ol>
<li>
<p><strong>首先定位范围起点</strong><br/>
与单条查询类似，按照 B 树的查找规则，从根节点 <code>[30, 60, 90]</code> 出发，最终定位到包含起始 key = 45 的子节点 <code>[35, 45, 55]</code>。</p>
</li>
<li>
<p><strong>在起始节点中进行扫描</strong><br/>
在节点 <code>[35, 45, 55]</code> 中，从 key = 45 开始向右扫描，命中符合范围条件的数据：</p>
<pre><code class="hljs language-csharp" lang="csharp">[<span class="hljs-meta">45, 55</span>]
</code></pre>
<p>需要注意的是，此时<strong>范围查询不会结束</strong>，因为后续节点中仍然可能存在满足条件的 key。</p>
</li>
<li>
<p><strong>回溯并切换到其他相关节点继续查找</strong><br/>
扫描完当前子节点后，需要回溯到上层节点 <code>[30, 60, 90]</code>，继续判断：</p>
<ul>
<li>key = 60、90 均落在查询范围内，命中对应数据<br/>
随后沿着指针切换到右侧子节点 <code>[95, 100, 110]</code>，在该节点中从左向右扫描，继续命中：</li>
</ul>

<pre><code class="hljs language-csharp" lang="csharp">[<span class="hljs-meta">95, 100</span>]
</code></pre>
</li>
<li>
<p><strong>遍历结束，范围查询完成</strong><br/>
当所有可能包含目标范围的数据节点都被访问后，查询结束。<br/>
最终命中的数据为：
[45, 55, 60, 90, 95, 100]</p>
</li>
</ol>
<h4 data-id="heading-8">B 树在范围查询中的性能问题</h4>
<p>从上述流程可以明显看出B树的范围查询并非线性顺序扫描，查询过程中需要在子节点、父节点、兄弟节点  之间频繁切换</p>
<p>在数据库场景下，这种<strong>节点切换往往意味着额外的磁盘 IO</strong></p>
<ul>
<li>每一次节点跳转，都可能触发一次新的磁盘页读取</li>
<li>当数据量较大、树层级较深时，IO 成本会被不断放大</li>
</ul>
<p>👉 <strong>这正是 B 树在范围查询场景下的先天劣势，也是 B+ 树设计中重点优化的问题之一。</strong></p>
<h3 data-id="heading-9">最终版 B+Tree</h3>
<p>B+Tree 是针对 B树的改进，先来看看一看B+Tree长什么样子。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1ad28f5ba441444e95f7516c047a18ab~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT2xhZl9u:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769958236&amp;x-signature=L1afVJ6ul9w9MJE8h0O6M7sM4gw%3D" alt="image.png" loading="lazy"/></p>
<p>可以看到B+Tree对B-Tree做了以下改进</p>
<ol>
<li>数据索引分离，所有的数据都是在叶子节点上，非叶子节点上只是存储地址信息，这样的好处是所有的查询都必须走到叶子节点，因此查询的路径长度固定，时间复杂度稳定为O(logN)，B树的话，叶子节点和非叶子节点都会存数据，有时候查的快有时候查的慢，不稳定。</li>
<li>叶子节点使用链表连接，极大的提升了范围查找的效率。</li>
</ol>
<p>B+Tree的数据查找流程</p>
<h4 data-id="heading-10">单条数据查找流程（以查找 key = 45 为例）</h4>
<ol>
<li>
<p><strong>从根节点开始查找</strong><br/>
根节点中包含索引关键字 <code>[30, 60, 90]</code>。<br/>
根据 B+ 树的查找规则：</p>
<ul>
<li>30 &lt; 45 &lt; 60<br/>
因此沿着对应的子指针，进入第二个子节点 <code>[35, 45, 55]</code>。</li>
</ul>
</li>
<li>
<p><strong>在非叶子节点中继续向下定位</strong><br/>
虽然在节点 <code>[35, 45, 55]</code> 中已经可以看到 key = 45，<br/>
但此时<strong>查找不能停止</strong>，因为该节点是非叶子节点，只保存索引 key 与子节点指针，并不存储真实数据。</p>
</li>
<li>
<p><strong>继续向下，直到叶子节点</strong><br/>
沿着指针继续向下访问子节点，最终在某个叶子节点中定位到 key = 45，对应的数据记录。<br/>
至此，单条数据查找流程结束。</p>
</li>
</ol>
<blockquote>
<p>可以看到，B+ 树的单条查询路径是<strong>固定的</strong>：<br/>
<strong>从根节点开始，逐层向下，最终一定到达叶子节点。</strong></p>
</blockquote>
<h4 data-id="heading-11">范围数据查找流程（以查找 45 ~ 100 为例）</h4>
<ol>
<li>
<p><strong>先定位范围起点</strong><br/>
首先查找 key = 45，查找过程与单条查询完全一致，最终定位到包含 45 的叶子节点。</p>
</li>
<li>
<p><strong>从起始叶子节点开始顺序扫描</strong><br/>
在叶子节点中，从 key = 45 开始向右遍历，依次命中满足条件的数据。</p>
</li>
<li>
<p><strong>沿叶子节点链表持续遍历</strong><br/>
B+ 树中的所有叶子节点通过指针形成一个有序链表。<br/>
因此，当当前叶子节点扫描完成后，可以<strong>直接通过指针访问下一个叶子节点</strong>，无需回到父节点或重新查找。</p>
</li>
<li>
<p><strong>直到超出范围为止</strong><br/>
当扫描到 key &gt; 100 时，范围查询结束。<br/>
最终命中的数据为：</p>
<pre><code class="hljs language-csharp" lang="csharp">[<span class="hljs-meta">45, 46, 50, 55, 58, 60, 92, 94, 100</span>]
</code></pre>
</li>
</ol>
<hr/>
<h4 data-id="heading-12">B+树范围查询高效的根本原因</h4>
<p>与 B 树相比，B+ 树在范围查询中的优势非常明显：</p>
<ul>
<li>查询路径固定，只需一次自顶向下的定位</li>
<li>范围扫描发生在<strong>叶子节点层</strong></li>
<li>叶子节点之间通过链表顺序连接</li>
<li>避免了频繁在父子节点之间来回切换</li>
</ul>
<p>👉 <strong>在数据库场景下，这种顺序扫描方式可以显著减少磁盘 IO 次数，这也是 MySQL 等关系型数据库选择 B+ 树作为索引结构的核心原因之一。</strong></p>
<h2 data-id="heading-13">四、扩展补充 Hash索引</h2>
<p>是一张表，里面有对应的key和value
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1a48da3ed8fc4712b94b02c1f22601e6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT2xhZl9u:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769958236&amp;x-signature=HmuOXxGn45K3yZByrSiXtOKFFR0%3D" alt="" loading="lazy"/></p>
<p>查询操作直接通过 get(key) 进行获取，时间复杂度O(1)，好处是检索速度极快，缺点就是支持不了范围查找，还有一个问题就是但是Hash结构如果产生Hash冲突，会导致整个数据散列的不均匀，查找可能会退化成O(n)</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4ff2529b9f624b0f8158fb4fc33a0db3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT2xhZl9u:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769958236&amp;x-signature=LbJ81QozSL1FkLlVe005dyayUgI%3D" alt="" loading="lazy"/></p>
<p>等值查找可以直接get(key)，但是如果想要完成范围查找就又得遍历整个hash表，效率很慢，hash就不合适了。在MySQL这类需要高效支撑大量范围查询的应用场景中，Hash结构并不适用，这也是为什么它未能成为主流数据库索引结构的重要原因。</p>
<h2 data-id="heading-14">五、总结</h2>
<p>MySQL索引结构的演进，本质上是一场围绕“高效查询、低存储成本、稳定性适配”三大核心诉求的持续优化之旅，每一代结构的迭代都精准解决了前序方案在数据库实际场景中的致命局限，最终沉淀出适配主流业务需求的B+树结构。</p>
<ul>
<li>
<p>早期的二叉查找树凭借有序性实现了基础快速查找，但极易因数据分布失衡退化为单链表，且树高过高导致磁盘IO次数激增，完全无法适配大数据量、磁盘存储的数据库场景。平衡二叉树通过旋转调整机制解决了结构失衡问题，维持了查询时间复杂度的稳定性，但未能突破树高限制，面对海量数据时仍存在IO效率瓶颈。</p>
</li>
<li>
<p>B树作为多路查找树，通过多节点存储特性大幅降低了树高，减少了磁盘IO层级，一定程度上优化了查询效率。但B树的核心缺陷的在于范围查询时需在父子节点、兄弟节点间频繁切换，引发额外磁盘IO，在高频范围查询场景中性能受限，这也为B+树的出现埋下了伏笔。</p>
</li>
<li>
<p>B+树在B树基础上完成了关键性改进，成为MySQL索引的最优解。其一，实现数据与索引分离，非叶子节点仅存储索引指针，叶子节点集中存储所有真实数据，使查询路径固定统一，时间复杂度稳定在O(logN)；其二，叶子节点通过链表有序连接，范围查询只需一次自顶向下定位起点，随后沿链表顺序扫描即可，彻底规避了节点间的频繁切换，大幅降低磁盘IO成本，完美适配数据库等值查询、范围查询、排序等核心业务场景。</p>
</li>
<li>
<p>而Hash索引虽能以O(1)时间复杂度实现等值查询，检索速度极快，但存在天然短板：无法支持范围查询，且Hash冲突可能导致性能退化为O(n)，难以适配MySQL多样化的查询需求，因此仅适用于特定等值查询场景，无法成为主流索引结构。</p>
</li>
</ul>
<p>总而言之MySQL索引结构的演进并非偶然，而是从场景需求出发，不断弥补前序结构缺陷、平衡各项性能指标的过程。B+树之所以成为主流，核心在于其精准契合了磁盘存储特性与数据库高频查询场景，在查询效率、稳定性与适配性上达到了最优平衡，而其他结构或因场景局限、或因性能短板，最终沦为特定场景的补充方案。这一演进逻辑也启示我们，索引结构的选择本质是对业务场景与性能需求的精准匹配。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[# JavaScript 函数核心知识体系：从基础到精]]></title>    <link>https://juejin.cn/post/7598563188112343092</link>    <guid>https://juejin.cn/post/7598563188112343092</guid>    <pubDate>2026-01-25T11:10:38.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598563188112343092" data-draft-id="7598710324167294991" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="# JavaScript 函数核心知识体系：从基础到精"/> <meta itemprop="keywords" content="JavaScript"/> <meta itemprop="datePublished" content="2026-01-25T11:10:38.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="不会敲代码1"/> <meta itemprop="url" content="https://juejin.cn/user/1927884034804425"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            # JavaScript 函数核心知识体系：从基础到精
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1927884034804425/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    不会敲代码1
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-25T11:10:38.000Z" title="Sun Jan 25 2026 11:10:38 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    6
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">JavaScript 函数核心知识体系：从基础到精通</h2>
<h3 data-id="heading-1">目录</h3>
<ol>
<li>[函数的本质与对象特性]</li>
<li>[this绑定的四种模式]</li>
<li>[arguments对象与参数处理]</li>
<li>[闭包机制深度解析]</li>
<li>[递归算法详解]</li>
<li>[回调函数与异步编程]</li>
</ol>
<hr/>
<h3 data-id="heading-2">1. 函数的本质与对象特性</h3>
<h4 data-id="heading-3">1.1 函数就是对象</h4>
<p>在JavaScript中，<strong>函数是一种特殊的对象</strong>。它不仅包含可执行的代码，还可以拥有属性和方法。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 函数作为对象的证据</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">sayHi</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"Hello!"</span>);
}

<span class="hljs-comment">// 可以像普通对象一样添加属性</span>
sayHi.<span class="hljs-property">name</span> = <span class="hljs-string">"greeting"</span>;
sayHi.<span class="hljs-property">version</span> = <span class="hljs-string">"1.0"</span>;

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(sayHi.<span class="hljs-property">name</span>); <span class="hljs-comment">// "greeting"</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(sayHi.<span class="hljs-property">version</span>); <span class="hljs-comment">// "1.0"</span>
</code></pre>
<h4 data-id="heading-4">1.2 函数的原型链结构</h4>
<p>所有函数都连接到 <code>Function.prototype</code>，而 <code>Function.prototype</code> 又连接到 <code>Object.prototype</code>。</p>
<pre><code class="hljs language-lua" lang="lua"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fn</span><span class="hljs-params">()</span></span> {}
└── <span class="hljs-string">[[Prototype]]</span> → Function.prototype
    └── <span class="hljs-string">[[Prototype]]</span> → Object.prototype
        └── <span class="hljs-string">[[Prototype]]</span> → null
</code></pre>
<p>这意味着函数不仅能调用 <code>call()</code>、<code>apply()</code> 等方法（来自 <code>Function.prototype</code>），还能调用 <code>toString()</code> 等方法（来自 <code>Object.prototype</code>）。</p>
<h4 data-id="heading-5">1.3 函数的两个隐藏属性</h4>
<p>每个函数在创建时都会附带两个隐藏属性：</p>
<ul>
<li><strong>函数的上下文</strong>：决定 <code>this</code> 的绑定规则</li>
<li><strong>实现函数行为的代码</strong>：函数体中的逻辑</li>
</ul>
<h4 data-id="heading-6">1.4 prototype属性详解</h4>
<p>每个函数对象在创建时都会自动获得一个 <code>prototype</code> 属性。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Person</span>(<span class="hljs-params">name</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
}

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Person</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>); 
<span class="hljs-comment">// 输出: { constructor: Person }</span>

<span class="hljs-comment">// 默认constructor指向函数本身</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Person</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">constructor</span> === <span class="hljs-title class_">Person</span>); <span class="hljs-comment">// true</span>
</code></pre>
<h5 data-id="heading-7">关键区分：</h5>




















<table><thead><tr><th>名称</th><th>是什么？</th><th>作用</th></tr></thead><tbody><tr><td><code>fn.__proto__</code></td><td>函数对象的 <code>[[Prototype]]</code></td><td>指向 <code>Function.prototype</code>，用于继承函数方法（如 <code>.call()</code>）</td></tr><tr><td><code>fn.prototype</code></td><td>函数的 <code>prototype</code> 属性</td><td>是一个普通对象，用于作为 <code>new fn()</code> 实例的原型</td></tr></tbody></table>
<blockquote>
<p><strong>一句话总结</strong>：<br/>
<code>__proto__</code> 是"我爸爸是谁"（功能来源）；<br/>
<code>prototype</code> 是"我的孩子将来长什么样"（模板）。</p>
</blockquote>
<hr/>
<h3 data-id="heading-8">2. this绑定的四种模式</h3>
<h4 data-id="heading-9">2.1 方法调用模式</h4>
<p>当一个函数被作为一个对象的方法调用时，<code>this</code> 指向该对象。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">var</span> p = {
    <span class="hljs-attr">name</span>: <span class="hljs-string">"Alice"</span>,
    <span class="hljs-attr">sayName</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>);
    }
};

p.<span class="hljs-title function_">sayName</span>(); <span class="hljs-comment">// 输出: Alice → this === p</span>
</code></pre>
<h4 data-id="heading-10">2.2 函数调用模式</h4>
<p>独立调用函数时，<code>this</code> 的指向取决于是否在严格模式下：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-meta">'use strict'</span>;

<span class="hljs-keyword">var</span> fn = p.<span class="hljs-property">sayName</span>;
<span class="hljs-title function_">fn</span>(); <span class="hljs-comment">// TypeError: Cannot read property 'name' of undefined</span>
      <span class="hljs-comment">// 因为 this 是 undefined</span>

<span class="hljs-comment">// 非严格模式下，this 指向全局对象（window）</span>
</code></pre>
<h4 data-id="heading-11">2.3 构造器调用模式</h4>
<p>使用 <code>new</code> 关键字调用函数时，会创建一个新的对象，<code>this</code> 指向这个新对象。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Person</span>(<span class="hljs-params">name</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name; <span class="hljs-comment">// this 指向 new 创建的新对象</span>
}

<span class="hljs-keyword">var</span> p = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">"Bob"</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(p.<span class="hljs-property">name</span>); <span class="hljs-comment">// Bob</span>
</code></pre>
<h4 data-id="heading-12">2.4 apply/call调用模式</h4>
<p>可以显式地指定 <code>this</code> 的值。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">greet</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"Hello, I'm "</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>);
}

<span class="hljs-keyword">var</span> obj = { <span class="hljs-attr">name</span>: <span class="hljs-string">"Charlie"</span> };
greet.<span class="hljs-title function_">apply</span>(obj); <span class="hljs-comment">// 输出: Hello, I'm Charlie → this === obj</span>
</code></pre>
<h4 data-id="heading-13">2.5 this绑定口诀</h4>
<blockquote>
<p><strong>"this 不是‘我’，而是‘谁调用我’。"</strong></p>
<ul>
<li>方法调用 → this 是调用者</li>
<li>独立调用 → this 是全局/undefined</li>
<li>new 调用 → this 是新对象</li>
<li>apply 调用 → this 是你指定的</li>
</ul>
</blockquote>
<hr/>
<h3 data-id="heading-14">3. arguments对象与参数处理</h3>
<h4 data-id="heading-15">3.1 arguments的本质</h4>
<p>每当函数被调用时，会自动获得一个名为 <code>arguments</code> 的"免费"参数，它包含了所有传入的实际参数。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">greet</span>(<span class="hljs-params">name, age</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"Name:"</span>, name);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"Age:"</span>, age);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"Other args:"</span>, <span class="hljs-variable language_">arguments</span>[<span class="hljs-number">2</span>], <span class="hljs-variable language_">arguments</span>[<span class="hljs-number">3</span>]);
}

<span class="hljs-title function_">greet</span>(<span class="hljs-string">"Alice"</span>, <span class="hljs-number">25</span>, <span class="hljs-string">"student"</span>, <span class="hljs-string">"developer"</span>);
<span class="hljs-comment">// Other args: student developer</span>
</code></pre>
<h4 data-id="heading-16">3.2 arguments的设计缺陷</h4>
<p>尽管被称为"数组"，但 <code>arguments</code> 并不是真正的数组，而是一个"类数组对象"。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">test</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">arguments</span>.<span class="hljs-property">length</span>); <span class="hljs-comment">// 3</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">arguments</span>[<span class="hljs-number">0</span>]);     <span class="hljs-comment">// 'a'</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">arguments</span>.<span class="hljs-title function_">slice</span>()); <span class="hljs-comment">// ❌ TypeError!</span>
}
<span class="hljs-title function_">test</span>(<span class="hljs-string">'a'</span>, <span class="hljs-string">'b'</span>, <span class="hljs-string">'c'</span>);
</code></pre>
<h4 data-id="heading-17">3.3 arguments转换为真数组</h4>
<p>有三种常用方法将 <code>arguments</code> 转换为真正的数组：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">convertArgs</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// 方法1：Array.from()</span>
    <span class="hljs-keyword">var</span> args1 = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(<span class="hljs-variable language_">arguments</span>);
    
    <span class="hljs-comment">// 方法2：扩展运算符（ES6）</span>
    <span class="hljs-keyword">var</span> args2 = [...<span class="hljs-variable language_">arguments</span>];
    
    <span class="hljs-comment">// 方法3：call + slice</span>
    <span class="hljs-keyword">var</span> args3 = [].<span class="hljs-property">slice</span>.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">arguments</span>);
    
    <span class="hljs-keyword">return</span> args1;
}
</code></pre>
<h4 data-id="heading-18">3.4 现代替代方案</h4>
<p>推荐使用 ES6 的 rest 参数来替代 <code>arguments</code>：</p>
<pre><code class="hljs language-scss" lang="scss">const sum = (...nums) =&gt; {
    return nums<span class="hljs-selector-class">.reduce</span>((total, num) =&gt; total + num, <span class="hljs-number">0</span>);
};

<span class="hljs-built_in">sum</span>(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>); <span class="hljs-comment">// 6</span>
<span class="hljs-built_in">sum</span>(<span class="hljs-number">4</span>, <span class="hljs-number">8</span>, <span class="hljs-number">15</span>, <span class="hljs-number">16</span>, <span class="hljs-number">23</span>, <span class="hljs-number">42</span>); <span class="hljs-comment">// 108</span>
</code></pre>
<blockquote>
<p>💡 <strong>金句</strong>："arguments 是 JS 的历史遗产，它让函数变得灵活，但也留下了‘非数组’的遗憾。"</p>
</blockquote>
<hr/>
<h3 data-id="heading-19">4. 闭包机制深度解析</h3>
<h4 data-id="heading-20">4.1 什么是闭包？</h4>
<blockquote>
<p><strong>闭包 = 一个函数 + 它被创建时所处的词法环境的引用</strong></p>
</blockquote>
<p>当一个内部函数即使在其外部函数执行完毕后仍能访问其变量时，就形成了闭包。</p>
<h4 data-id="heading-21">4.2 形成闭包的三个必要条件</h4>

























<table><thead><tr><th>条件</th><th>说明</th><th>示例</th></tr></thead><tbody><tr><td>① 内部函数</td><td>必须有一个函数定义在另一个函数内部</td><td><code>function outer() { function inner() {} }</code></td></tr><tr><td>② 访问外部变量</td><td>内部函数必须引用外层函数的局部变量</td><td><code>inner() { console.log(x); }</code></td></tr><tr><td>③ 外部函数执行完毕后，内部函数仍可被调用</td><td>内部函数被返回或赋值给全局变量</td><td><code>return inner;</code> 或 <code>window.fn = inner;</code></td></tr></tbody></table>
<h4 data-id="heading-22">4.3 经典示例</h4>
<h5 data-id="heading-23">示例1：最简闭包</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">makeAdder</span>(<span class="hljs-params">x</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span>(<span class="hljs-params">y</span>) {
        <span class="hljs-keyword">return</span> x + y; <span class="hljs-comment">// 访问外部变量 x</span>
    };
}

<span class="hljs-keyword">const</span> add5 = <span class="hljs-title function_">makeAdder</span>(<span class="hljs-number">5</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">add5</span>(<span class="hljs-number">3</span>)); <span class="hljs-comment">// 8</span>
</code></pre>
<h5 data-id="heading-24">示例2：私有变量封装</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">createCounter</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">let</span> count = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">increment</span>: <span class="hljs-function">() =&gt;</span> ++count,
        <span class="hljs-attr">decrement</span>: <span class="hljs-function">() =&gt;</span> --count,
        <span class="hljs-attr">value</span>: <span class="hljs-function">() =&gt;</span> count
    };
}

<span class="hljs-keyword">const</span> counter = <span class="hljs-title function_">createCounter</span>();
counter.<span class="hljs-title function_">increment</span>();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(counter.<span class="hljs-title function_">value</span>()); <span class="hljs-comment">// 1</span>
<span class="hljs-comment">// count 对外界完全隐藏 → 实现了「数据封装」</span>
</code></pre>
<h5 data-id="heading-25">示例3：事件监听器中的闭包</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">3</span>; i++) {
    <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">`btn<span class="hljs-subst">${i}</span>`</span>).<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-function">() =&gt;</span> {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Button <span class="hljs-subst">${i}</span> clicked!`</span>);
    });
}
</code></pre>
<h4 data-id="heading-26">4.4 let/const在闭包中的行为</h4>

















<table><thead><tr><th>场景</th><th>var 行为</th><th>let/const 行为</th><th>原因</th></tr></thead><tbody><tr><td>在循环中定义函数</td><td>所有函数共享同一个变量</td><td>每次迭代都有独立的绑定</td><td>let/const 有块级作用域</td></tr></tbody></table>
<pre><code class="hljs language-css" lang="css">// ❌ <span class="hljs-selector-tag">var</span> 陷阱
for (<span class="hljs-selector-tag">var</span> <span class="hljs-selector-tag">i</span> = <span class="hljs-number">0</span>; <span class="hljs-selector-tag">i</span> &lt; <span class="hljs-number">3</span>; <span class="hljs-selector-tag">i</span>++) {
    setTimeout(() =&gt; console<span class="hljs-selector-class">.log</span>(<span class="hljs-selector-tag">i</span>), <span class="hljs-number">100</span>); // 输出: <span class="hljs-number">3</span>, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>
}

// ✅ let 正确
for (let <span class="hljs-selector-tag">i</span> = <span class="hljs-number">0</span>; <span class="hljs-selector-tag">i</span> &lt; <span class="hljs-number">3</span>; <span class="hljs-selector-tag">i</span>++) {
    setTimeout(() =&gt; console<span class="hljs-selector-class">.log</span>(<span class="hljs-selector-tag">i</span>), <span class="hljs-number">100</span>); // 输出: <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>
}
</code></pre>
<h4 data-id="heading-27">4.5 闭包的用途</h4>






























<table><thead><tr><th>用途</th><th>说明</th><th>示例</th></tr></thead><tbody><tr><td>数据封装</td><td>隐藏实现细节</td><td><code>createCounter()</code> 中的 <code>count</code></td></tr><tr><td>函数工厂</td><td>动态生成函数</td><td><code>makeAdder(5)</code></td></tr><tr><td>模块化开发</td><td>避免全局污染</td><td>IIFE 模块</td></tr><tr><td>异步编程</td><td>保持上下文</td><td><code>setTimeout(() =&gt; console.log(x), 100)</code></td></tr></tbody></table>
<h4 data-id="heading-28">4.6 闭包风险与优化</h4>





















<table><thead><tr><th>风险</th><th>如何避免</th></tr></thead><tbody><tr><td>内存占用增加</td><td>避免引用大型 DOM 对象或数据结构</td></tr><tr><td>意外保留作用域</td><td>不要在循环中无意捕获大对象</td></tr><tr><td>调试困难</td><td>使用 Chrome DevTools 查看 Scope</td></tr></tbody></table>
<blockquote>
<p>🔑 <strong>终极口诀</strong>："一嵌套、二访问、三脱离——三者俱全才是闭包。"</p>
</blockquote>
<hr/>
<h3 data-id="heading-29">5. 递归算法详解</h3>
<h4 data-id="heading-30">5.1 什么是递归？</h4>
<p>递归是指函数直接或间接地调用自身。必须包含：</p>
<ol>
<li><strong>基线条件</strong>（Base Case）：停止递归的条件</li>
<li><strong>递推关系</strong>（Recursive Case）：问题规模变小的自我调用</li>
</ol>
<h4 data-id="heading-31">5.2 汉诺塔问题详解</h4>
<h5 data-id="heading-32">问题描述</h5>
<p>将 n 个圆盘从源柱移动到目标柱，遵循以下规则：</p>
<ol>
<li>每次只能移动一个圆盘</li>
<li>不能将较大的圆盘放在较小的圆盘上面</li>
<li>可以使用辅助柱作为过渡</li>
</ol>
<h5 data-id="heading-33">递归解法</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">var</span> hanoi = <span class="hljs-keyword">function</span>(<span class="hljs-params">disc, src, aux, dst</span>) {
    <span class="hljs-keyword">if</span> (disc &gt; <span class="hljs-number">0</span>) {
        <span class="hljs-title function_">hanoi</span>(disc - <span class="hljs-number">1</span>, src, dst, aux); <span class="hljs-comment">// 步骤1：把上面n-1个移到辅助柱</span>
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Move disc '</span> + disc + <span class="hljs-string">' from '</span> + src + <span class="hljs-string">' to '</span> + dst); <span class="hljs-comment">// 步骤2：移动最大盘</span>
        <span class="hljs-title function_">hanoi</span>(disc - <span class="hljs-number">1</span>, aux, src, dst); <span class="hljs-comment">// 步骤3：把n-1个从辅助柱移到目标柱</span>
    }
};

<span class="hljs-title function_">hanoi</span>(<span class="hljs-number">3</span>, <span class="hljs-string">'Src'</span>, <span class="hljs-string">'Aux'</span>, <span class="hljs-string">'Dst'</span>);
</code></pre>
<h5 data-id="heading-34">完整执行流程（n=3）</h5>













































<table><thead><tr><th>步骤</th><th>输出</th><th>物理状态</th></tr></thead><tbody><tr><td>①</td><td>Move disc 1 from Src to Dst</td><td><code>[3,2] / [] / [1]</code></td></tr><tr><td>②</td><td>Move disc 2 from Src to Aux</td><td><code>[3] / [2] / [1]</code></td></tr><tr><td>③</td><td>Move disc 1 from Dst to Aux</td><td><code>[3] / [2,1] / []</code></td></tr><tr><td>④</td><td>Move disc 3 from Src to Dst</td><td><code>[] / [2,1] / [3]</code></td></tr><tr><td>⑤</td><td>Move disc 1 from Aux to Src</td><td><code>[1] / [2] / [3]</code></td></tr><tr><td>⑥</td><td>Move disc 2 from Aux to Dst</td><td><code>[1] / [] / [3,2]</code></td></tr><tr><td>⑦</td><td>Move disc 1 from Src to Dst</td><td><code>[] / [] / [3,2,1]</code></td></tr></tbody></table>
<h5 data-id="heading-35">数学规律</h5>
<p>移动 n 个盘所需的最少步数为：<code>T(n) = 2ⁿ - 1</code></p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">T</span>(<span class="hljs-number">1</span>) = <span class="hljs-number">1</span>
<span class="hljs-built_in">T</span>(<span class="hljs-number">2</span>) = <span class="hljs-number">3</span>  
<span class="hljs-built_in">T</span>(<span class="hljs-number">3</span>) = <span class="hljs-number">7</span>
<span class="hljs-built_in">T</span>(<span class="hljs-number">4</span>) = <span class="hljs-number">15</span>
...
</code></pre>
<blockquote>
<p>🧠 <strong>核心思想</strong>："要把 n 个盘从 A→C，必须先搬走上面 n−1 个盘到 B，再把最大的盘移到 C，最后把 n−1 个盘从 B 移到 C。"</p>
</blockquote>
<hr/>
<h3 data-id="heading-36">6. 回调函数与异步编程</h3>
<h4 data-id="heading-37">6.1 同步 vs 异步</h4>
<h5 data-id="heading-38">同步方式（阻塞式）</h5>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">request</span> = prepare_the_request()<span class="hljs-comment">;</span>
<span class="hljs-attr">response</span> = send_request_synchronously(request)<span class="hljs-comment">; // 卡住等待</span>
display(response)<span class="hljs-comment">;</span>
</code></pre>
<p>❌ 问题：网络请求会导致客户端"假死"状态。</p>
<h5 data-id="heading-39">异步方式（非阻塞式）</h5>
<pre><code class="hljs language-scss" lang="scss">request = <span class="hljs-built_in">prepare_the_request</span>();
<span class="hljs-built_in">send_request_asynchronously</span>(request, function(response) {
    <span class="hljs-attribute">display</span>(response);
});
</code></pre>
<p>✅ 优点：立即返回，不阻塞UI，响应到达时自动调用回调函数。</p>
<h4 data-id="heading-40">6.2 回调函数本质</h4>
<ul>
<li><strong>函数作为参数</strong>传递给另一个函数</li>
<li><strong>延迟执行</strong>，在特定事件触发时执行</li>
<li>实现<strong>事件驱动</strong>编程模型</li>
<li>达到代码<strong>解耦</strong>的效果</li>
</ul>
<h4 data-id="heading-41">6.3 实际应用示例</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">simulateAsyncRequest</span>(<span class="hljs-params">callback</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"开始请求..."</span>);
    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-keyword">const</span> response = <span class="hljs-string">"Hello from server!"</span>;
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"响应到达！"</span>);
        <span class="hljs-title function_">callback</span>(response);
    }, <span class="hljs-number">1000</span>);
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">display</span>(<span class="hljs-params">response</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"显示结果："</span> + response);
}

<span class="hljs-title function_">simulateAsyncRequest</span>(display);
</code></pre>
<blockquote>
<p>"回调 = 把‘要做什么’告诉别人，等事情做完后再通知你。"</p>
</blockquote>
<h4 data-id="heading-42">6.4 发展演进</h4>
<p>虽然回调是异步编程的基础，但存在"回调地狱"问题，因此发展出了：</p>
<ul>
<li><strong>Promise</strong>：解决回调嵌套过深的问题</li>
<li><strong>async/await</strong>：让异步代码看起来像同步代码</li>
</ul>
<hr/>
<h3 data-id="heading-43">总结与展望</h3>
<h4 data-id="heading-44">核心知识点回顾</h4>
<ol>
<li><strong>函数是对象</strong>：具有属性和方法，通过原型链继承</li>
<li><strong>this绑定</strong>：由调用方式决定，掌握四种模式</li>
<li><strong>arguments</strong>：类数组对象，现代开发推荐使用 rest 参数</li>
<li><strong>闭包</strong>：记住作用域的能力，是许多高级特性的基础</li>
<li><strong>递归</strong>：分治思想的体现，适用于树形结构等问题</li>
<li><strong>回调</strong>：异步编程的基石，理解事件循环的关键</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue3 v-model 新写法全解：多绑定+自定义修饰符+(.camel)避坑]]></title>    <link>https://juejin.cn/post/7598574507347853347</link>    <guid>https://juejin.cn/post/7598574507347853347</guid>    <pubDate>2026-01-25T12:07:21.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598574507347853347" data-draft-id="7598532592456466459" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vue3 v-model 新写法全解：多绑定+自定义修饰符+(.camel)避坑"/> <meta itemprop="keywords" content="JavaScript,面试,Vue.js"/> <meta itemprop="datePublished" content="2026-01-25T12:07:21.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="boooooooom"/> <meta itemprop="url" content="https://juejin.cn/user/3078273283917399"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vue3 v-model 新写法全解：多绑定+自定义修饰符+(.camel)避坑
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3078273283917399/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    boooooooom
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-25T12:07:21.000Z" title="Sun Jan 25 2026 12:07:21 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    6
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;color:#3c9dff}.markdown-body h1{font-size:30px;margin-bottom:5px;padding-bottom:8px;text-align:center}.markdown-body h2{font-size:24px;padding-bottom:6px}.markdown-body h2:before{content:"🍋"}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h3:before{content:"🍓"}.markdown-body h4{font-size:16px}.markdown-body h4:before{content:"🍑"}.markdown-body h5{font-size:15px}.markdown-body h5:before{content:"🍉"}.markdown-body h6{margin-top:5px}.markdown-body h6:before{content:"🍒"}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{display:block;margin:0 auto;max-width:100%;border-radius:4px;padding:1px;border:1px solid #d2e8ff}.markdown-body img:hover{box-shadow:0 1px 3px #5eaeff}.markdown-body hr{height:4px;margin:34px 0;background-size:4px 1px;background-image:linear-gradient(270deg,#5eaeff,#f3f9ff 25%,transparent 50%);border-style:none}.markdown-body code{word-break:break-word;border-radius:3px;overflow-x:auto;background-color:#d2e8ff;color:#3c9dff;font-size:.9em;padding:.1em .5em;margin:0 3px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;transition:all .3s}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;border:1px solid #90c7ff;border-radius:4px}.markdown-body pre:hover{box-shadow:0 1px 10px #beddff}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#3c9dff;border-bottom:1px solid #90c7ff;transition:all .3s}.markdown-body a:hover{color:#007fff;border-bottom:2px solid #5eaeff}.markdown-body a[href]:not(:empty){padding-right:18px}.markdown-body a[href]:not(:empty):after{display:inline-block;width:16px;height:16px;margin-left:2px;content:"";background:url(data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiPjxwYXRoIGQ9Ik0zODQgMTI4YTQ4IDQ4IDAgMDEyLjgxNiA5NS45MkwzODQgMjI0SDI1NmEzMiAzMiAwIDAwLTMxLjkyIDI5LjZMMjI0IDI1NnY1MTJhMzIgMzIgMCAwMDI5LjYgMzEuOTJsMi40LjA4aDUxMmEzMiAzMiAwIDAwMzEuOTItMjkuNmwuMDgtMi40VjY1NmE0OCA0OCAwIDAxOTUuOTItMi44MTZMODk2IDY1NnYxMTJhMTI4IDEyOCAwIDAxLTEyNCAxMjcuOTM2bC00IC4wNjRIMjU2YTEyOCAxMjggMCAwMS0xMjcuOTM2LTEyNGwtLjA2NC00VjI1NmExMjggMTI4IDAgMDExMjQtMTI3LjkzNmw0LS4wNjRoMTI4em0zODQgMGExMjggMTI4IDAgMDExMjcuOTM2IDEyNGwuMDY0IDR2MTYwYTQ4IDQ4IDAgMDEtOTUuOTIgMi44MTZMODAwIDQxNlYyOTEuODcybC0zODIuMDY0IDM4Mi4wOGE0OCA0OCAwIDAxLTcwLjAzMi02NS42bDIuMTYtMi4yODhMNzMyLjA5NiAyMjRINjA4YTQ4IDQ4IDAgMDEtMi44MTYtOTUuOTJMNjA4IDEyOGgxNjB6IiBmaWxsPSIjM2M5ZGZmIiBmaWxsLW9wYWNpdHk9Ii41NiIgZGF0YS1zcG0tYW5jaG9yLWlkPSJhMzEzeC5zZWFyY2hfaW5kZXguMC5pMC41Yzc1M2E4MTgwa2RKWCIgY2xhc3M9InNlbGVjdGVkIi8+PC9zdmc+);background-size:100%}.markdown-body table{margin:0 auto 10px;font-size:12px;width:auto;max-width:100%;overflow:auto;border-collapse:collapse;border:1px solid #3c9dff}.markdown-body thead{text-align:center}.markdown-body thead th{color:#fff;background-color:#5eaeff}.markdown-body tr{text-align:center}.markdown-body tbody tr:hover{background-color:#d2e8ff}.markdown-body tbody tr:hover code{background-color:#90c7ff}.markdown-body tr:nth-child(2n){background-color:#ecf5ff}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#5eaeff}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body b,.markdown-body strong{font-weight:900;padding:0 1px;font-size:17px}.markdown-body small{color:#cbcbcb;padding:0 1px;font-size:22px;zoom:.5}.markdown-body em{padding:0 1px}.markdown-body del{padding:0 1px;text-decoration-thickness:2px}.markdown-body blockquote{color:#1a1b1c;padding:1px 20px;margin:22px 0;border-radius:4px;border-left:4px solid rgba(60,157,255,.5);background-color:rgba(190,221,255,.3)}.markdown-body blockquote blockquote{margin:8px 0}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body details{margin:12px 0;padding:4px 10px;border:2px solid #3c9dff;border-radius:8px;background-color:#ecf5ff;transition:all .3s}.markdown-body details summary{cursor:pointer}.markdown-body input[type=checkbox]{position:relative;appearance:none;width:16px;height:16px;border-radius:2px;vertical-align:middle;transform:translateY(-2px);box-sizing:border-box;border:1px solid #beddff}.markdown-body input[type=checkbox]:checked{border:1px solid #5eaeff;background-color:#5eaeff}.markdown-body input[type=checkbox]:checked:before{position:absolute;top:3px;left:1px;width:11px;height:6px;background-color:transparent;border-left:2px solid #fff;border-bottom:2px solid #fff;transform:rotate(-45deg);content:"";box-sizing:border-box}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="androidstudio">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#a9b7c6;background:#282b2e}.hljs-bullet,.hljs-literal,.hljs-number,.hljs-symbol{color:#6897bb}.hljs-deletion,.hljs-keyword,.hljs-selector-tag{color:#cc7832}.hljs-link,.hljs-template-variable,.hljs-variable{color:#629755}.hljs-comment,.hljs-quote{color:grey}.hljs-meta{color:#bbb529}.hljs-addition,.hljs-attribute,.hljs-string{color:#6a8759}.hljs-section,.hljs-title,.hljs-type{color:#ffc66d}.hljs-name,.hljs-selector-class,.hljs-selector-id{color:#e8bf6a}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在 Vue3 中，v-model 进行了大幅重构，摆脱了 Vue2 中基于 value 属性和 input 事件的强耦合限制，变得更灵活、可扩展。新语法支持多 v-model 绑定、自定义修饰符、.camel 命名转换等实用特性，彻底解决了旧版本的诸多痛点。本文将从核心变化入手，结合实战案例拆解所有新特性，助你高效掌握 Vue3 v-model 用法。</p>
<h2 data-id="heading-0">一、Vue3 v-model 核心变化（与 Vue2 对比）</h2>
<p>Vue3 对 v-model 的设计理念进行了革新，核心变更在于“解耦属性与事件”，让开发者可自由定义绑定的属性名和触发事件，同时简化了自定义组件的 v-model 实现。</p>
<h3 data-id="heading-1">1. 默认绑定规则变更</h3>
<p>Vue2 中，自定义组件的 v-model 默认绑定 <code>value</code> 属性和 <code>input</code> 事件；Vue3 则默认绑定 <code>modelValue</code> 属性和 <code>update:modelValue</code> 事件，避免了与原生表单元素的 value 属性冲突。</p>
<pre><code class="hljs language-ts" lang="ts">&lt;!-- <span class="hljs-title class_">Vue2</span> 自定义组件 v-model 写法 --&gt;
&lt;template&gt;
  &lt;input :value="value" @input="$emit('input', $event.target.value)"&gt;
&lt;/template&gt;
&lt;script setup&gt;
export default {
  props: ['value']
}
&lt;script&gt;

&lt;!-- Vue3 自定义组件 v-model 写法（默认） --&gt;
&lt;template&gt;
  &lt;input :value="modelValue" @input="$emit('update:modelValue', $event.target.value)"&gt;
&lt;/template&gt;
&lt;script setup&gt;
defineProps(['modelValue'])
&lt;/script&gt;
</code></pre>
<h3 data-id="heading-2">2. 支持自定义绑定属性与事件</h3>
<p>Vue3 允许通过 <code>v-model:propName</code> 的形式，自定义组件 v-model 绑定的属性名，替代 Vue2 中需要通过 <code>model</code> 选项配置的方式，语法更简洁。</p>
<pre><code class="hljs language-ts" lang="ts">&lt;!-- 父组件：自定义绑定属性为 title --&gt;
&lt;template&gt;
  &lt;CustomInput v-model:title="formTitle" /&amp;gt;
&lt;/template&gt;

&lt;!-- 子组件：对应绑定 title 属性和 update:title 事件 --&gt;
&lt;template&gt;
  &lt;input :value="title" @input="$emit('update:title', $event.target.value)"&gt;
&lt;/template&gt;
&lt;script setup&gt;
defineProps(['title'])
&lt;/script&gt;
</code></pre>
<h2 data-id="heading-3">二、多 v-model 绑定（Vue3 新增）</h2>
<p>Vue2 中一个组件只能绑定一个 v-model，若需多字段双向绑定，需手动定义多个事件；Vue3 借助“自定义绑定属性”特性，支持在一个组件上使用多个 v-model，实现多字段同步更新，大幅简化代码。</p>
<h3 data-id="heading-4">实战案例：多字段表单组件</h3>
<p>实现一个用户信息表单组件，同时绑定姓名（name）和年龄（age）两个字段，通过多 v-model 同步到父组件。</p>
<pre><code class="hljs language-ts" lang="ts">&lt;!-- 父组件：多 v-model 绑定 --&gt;
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">UserForm</span> 
    <span class="hljs-attr">v-model:name</span>=<span class="hljs-string">"userName"</span> 
    <span class="hljs-attr">v-model:age</span>=<span class="hljs-string">"userAge"</span> 
  /&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>姓名：{{ userName }}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>年龄：{{ userAge }}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></span>

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { ref } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">UserForm</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./UserForm.vue'</span>

<span class="hljs-keyword">const</span> userName = <span class="hljs-title function_">ref</span>(<span class="hljs-string">''</span>)
<span class="hljs-keyword">const</span> userAge = <span class="hljs-title function_">ref</span>(<span class="hljs-number">0</span>)
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>

&lt;!-- 子组件：<span class="hljs-title class_">UserForm</span>.<span class="hljs-property">vue</span> --&gt;
&lt;template&gt;
  &lt;div&gt;
    &lt;input 
      type="text" 
      :value="name" 
      @input="$emit('update:name', $event.target.value)"
      placeholder="请输入姓名"
    &gt;
    &lt;input 
      type="number" 
      :value="age" 
      @input="$emit('update:age', $event.target.valueAsNumber)"
      placeholder="请输入年龄"
    &gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup&gt;
// 接收父组件传递的两个绑定属性
defineProps(['name', 'age'])
&lt;/script&gt;
</code></pre>
<p>核心逻辑：每个 v-model 对应“属性名 + update:属性名 事件”的组合，子组件通过触发对应事件，将值同步给父组件，实现多字段双向绑定。</p>
<h2 data-id="heading-5">三、自定义修饰符（Vue3 新增）</h2>
<p>Vue2 中 v-model 仅支持系统内置修饰符（.trim、.number、.lazy），自定义修饰符需通过复杂的事件处理实现；Vue3 允许为 v-model 定义自定义修饰符，轻松实现格式化、验证等逻辑，且支持全局和局部修饰符。</p>
<h3 data-id="heading-6">1. 自定义修饰符基础用法</h3>
<p>实现一个自定义修饰符 <code>.capitalize</code>，将输入的文本首字母大写，步骤如下：</p>
<pre><code class="hljs language-ts" lang="ts">&lt;!-- 父组件：使用自定义修饰符 .<span class="hljs-property">capitalize</span> --&gt;
&lt;template&gt;
  &lt;CustomInput v-model.capitalize="username" /&amp;gt;
&lt;/template&gt;

&lt;!-- 子组件：处理自定义修饰符 --&gt;
&lt;template&gt;
  &lt;input 
    :value="modelValue" 
    @input="handleInput"
  &gt;
&lt;/template&gt;

&lt;script setup&gt;
const props = defineProps({
  modelValue: String,
  // 接收修饰符：格式为“modelModifiers”，类型为对象
  modelModifiers: {
    type: Object,
    default: () =&gt; ({})
  }
})

const emit = defineEmits(['update:modelValue'])

const handleInput = (e) =&gt; {
  let value = e.target.value
  // 判断是否使用了 .capitalize 修饰符
  if (props.modelModifiers.capitalize) {
    value = value.charAt(0).toUpperCase() + value.slice(1)
  }
  emit('update:modelValue', value)
}
&lt;/script&gt;
</code></pre>
<h3 data-id="heading-7">2. 多 v-model 自定义修饰符</h3>
<p>若为多 v-model 绑定添加修饰符，需在子组件中通过“属性名 + Modifiers”的格式接收，例如为 <code>v-model:name</code> 添加修饰符，子组件接收 <code>nameModifiers</code>。</p>
<pre><code class="hljs language-ts" lang="ts">&lt;!-- 父组件：为 name 绑定添加 .<span class="hljs-property">capitalize</span> 修饰符 --&gt;
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">UserForm</span> <span class="hljs-attr">v-model:name.capitalize</span>=<span class="hljs-string">"userName"</span> /&amp;<span class="hljs-attr">gt</span>;
&lt;/<span class="hljs-attr">template</span>&gt;</span>

<span class="hljs-comment">&lt;!-- 子组件：接收 nameModifiers 修饰符 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">const</span> props = <span class="hljs-title function_">defineProps</span>({
  <span class="hljs-attr">name</span>: <span class="hljs-title class_">String</span>,
  <span class="hljs-comment">// 对应 name 绑定的修饰符</span>
  <span class="hljs-attr">nameModifiers</span>: {
    <span class="hljs-attr">type</span>: <span class="hljs-title class_">Object</span>,
    <span class="hljs-attr">default</span>: <span class="hljs-function">() =&gt;</span> ({})
  }
})

<span class="hljs-keyword">const</span> emit = <span class="hljs-title function_">defineEmits</span>([<span class="hljs-string">'update:name'</span>])

<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleNameInput</span> = (<span class="hljs-params">e</span>) =&gt; {
  <span class="hljs-keyword">let</span> value = e.<span class="hljs-property">target</span>.<span class="hljs-property">value</span>
  <span class="hljs-keyword">if</span> (props.<span class="hljs-property">nameModifiers</span>.<span class="hljs-property">capitalize</span>) {
    value = value.<span class="hljs-title function_">charAt</span>(<span class="hljs-number">0</span>).<span class="hljs-title function_">toUpperCase</span>() + value.<span class="hljs-title function_">slice</span>(<span class="hljs-number">1</span>)
  }
  <span class="hljs-title function_">emit</span>(<span class="hljs-string">'update:name'</span>, value)
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</span></code></pre>
<h2 data-id="heading-8">四、.camel 修饰符（Vue3 保留并优化）</h2>
<p>Vue 中 HTML 属性名是不区分大小写的，默认会将 v-model 绑定的驼峰式属性名转为短横线分隔式（kebab-case）。<code>.camel</code> 修饰符用于强制保留驼峰式属性名，适用于绑定原生组件或第三方组件中需要驼峰命名属性的场景。</p>
<h3 data-id="heading-9">使用场景与实例</h3>
<p>例如，原生 SVG 元素的 <code>viewBox</code> 属性是驼峰命名，若直接通过 v-model 绑定，Vue 会默认转为 <code>view-box</code>，导致属性失效，此时需使用 <code>.camel</code> 修饰符保留驼峰格式。</p>
<pre><code class="hljs language-ts" lang="ts">
&lt;template&gt;
  &lt;!-- 错误：<span class="hljs-title class_">Vue</span> 会将 viewBox 转为 view-box，<span class="hljs-variable constant_">SVG</span> 无法识别 --&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">svg</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">"viewBoxValue"</span>&amp;<span class="hljs-attr">gt</span>;&amp;<span class="hljs-attr">lt</span>;/<span class="hljs-attr">svg</span>&amp;<span class="hljs-attr">gt</span>;

  &lt;!<span class="hljs-attr">--</span> <span class="hljs-attr">正确</span>：<span class="hljs-attr">.camel</span> <span class="hljs-attr">强制保留</span> <span class="hljs-attr">viewBox</span> <span class="hljs-attr">驼峰命名</span> <span class="hljs-attr">--</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">svg</span> <span class="hljs-attr">v-model.camel</span>=<span class="hljs-string">"viewBoxValue"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">svg</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></span>

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { ref } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-comment">// viewBoxValue 格式："0 0 100 100"</span>
<span class="hljs-keyword">const</span> viewBoxValue = <span class="hljs-title function_">ref</span>(<span class="hljs-string">"0 0 100 100"</span>)
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>
</code></pre>
<p>注意：在 Vue3 的单文件组件（SFC）中，模板是经过编译优化的，对于自定义组件的驼峰属性，若子组件接收时用驼峰命名，可无需 <code>.camel</code>；但对于原生元素或第三方组件，仍需通过 <code>.camel</code> 处理驼峰属性。</p>
<h2 data-id="heading-10">五、常见问题与避坑指南</h2>
<ol>
<li><strong>修饰符与多 v-model 冲突</strong>：多 v-model 绑定的修饰符需对应“属性名 + Modifiers”接收，不可混用<code>modelModifiers</code>（默认修饰符接收名）。</li>
<li><strong>.camel 修饰符滥用</strong>：自定义组件间的驼峰属性绑定无需 <code>.camel</code>，仅原生元素或第三方组件需要，避免过度使用。</li>
<li><strong>Vue2 迁移兼容</strong>：若需兼容 Vue2 代码，可通过 <code>model</code> 选项配置默认属性和事件，Vue3 仍支持该写法，但推荐使用新语法。</li>
</ol>
<h2 data-id="heading-11">六、总结</h2>
<p>Vue3 对 v-model 的重构，核心是赋予开发者更强的灵活性——多 v-model 绑定解决了多字段双向同步的痛点，自定义修饰符简化了值处理逻辑，.camel 修饰符适配了特殊属性命名场景。这些特性让 v-model 不再局限于基础表单绑定，能轻松应对复杂业务场景。</p>
<p>实际开发中，建议根据业务需求合理选择特性：简单表单用默认 v-model，多字段用多 v-model 绑定，需格式化值用自定义修饰符，原生驼峰属性用 .camel 修饰符，最大化提升开发效率。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[css实现网格类背景图]]></title>    <link>https://juejin.cn/post/7598699872552812580</link>    <guid>https://juejin.cn/post/7598699872552812580</guid>    <pubDate>2026-01-25T12:26:16.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598699872552812580" data-draft-id="7598480267218370594" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="css实现网格类背景图"/> <meta itemprop="keywords" content="CSS"/> <meta itemprop="datePublished" content="2026-01-25T12:26:16.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="its_wild"/> <meta itemprop="url" content="https://juejin.cn/user/651350467947725"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            css实现网格类背景图
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/651350467947725/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    its_wild
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-25T12:26:16.000Z" title="Sun Jan 25 2026 12:26:16 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"「";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"」";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"✓";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atelier-forest-dark">.hljs-comment,.hljs-quote{color:#9c9491}.hljs-attribute,.hljs-link,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#f22c40}.hljs-built_in,.hljs-builtin-name,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#df5320}.hljs-bullet,.hljs-string,.hljs-symbol{color:#7b9726}.hljs-section,.hljs-title{color:#407ee7}.hljs-keyword,.hljs-selector-tag{color:#6666ea}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#1b1918;color:#a8a19f}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">原理</h3>
<p>将网格背景拆解成最小单元，然后通过复制最小单元从而实现网格背景。</p>
<h3 data-id="heading-1">点状网格</h3>
<h4 data-id="heading-2">效果：</h4>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/19a3f413f6f94da29795ef738bdac902~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaXRzX3dpbGQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769949098&amp;x-signature=0ZiDEtxlf2jz6NG1iY9QgAqDdtE%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-3">最小单元：</h4>
<p>如图所示，红框内为最小单元。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6f663a84212a4c3c8fe8b7920d258b01~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaXRzX3dpbGQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769949098&amp;x-signature=vlgF83oc7LaaNQzHVAOc8orCPS8%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-4">实现步骤：</h4>
<p>先确定最小单的边长为 <strong>20px</strong>，点的边长为 <strong>4px</strong>。</p>
<ol>
<li>先绘制一个从上到下的正方形，把该正方形的上方 <strong>4px</strong> 部分绘制为透明的，下方部分绘制为深色，效果如下(<em>注：灰色边框是为了看效果作为辅助的不算在最小单元内</em>)：</li>
</ol>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3b055c3cb589472fa1d429b71a19d3b2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaXRzX3dpbGQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769949098&amp;x-signature=Gdi2DCYdVoDKioz6OcrTQ1VhakA%3D" alt="image.png" loading="lazy"/></p>
<ol start="2">
<li>再绘制一个从左到右的正方形，把该正方形的左边 <strong>4px</strong> 部分绘制为透明的，右边部分绘制为深色，效果如下：</li>
</ol>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c99dc3cbce844611986f33d95186af84~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaXRzX3dpbGQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769949098&amp;x-signature=bIEcHLRR4Zlk%2FG4rmv3s7FfhZ1I%3D" alt="image.png" loading="lazy"/></p>
<ol start="3">
<li>将前两个图形叠加效果如下：</li>
</ol>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c742305e444845dd924dbe707ee125a5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaXRzX3dpbGQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769949098&amp;x-signature=7ByyD8D3XrQz96souuObb1pT%2B5Q%3D" alt="image.png" loading="lazy"/></p>
<ol start="4">
<li>复制前三步得到的图形，效果如下：</li>
</ol>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e3bb6242497943068f4fc33879ca4535~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaXRzX3dpbGQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769949098&amp;x-signature=C9sMK5Bp%2BYL%2BwYAPHtWir%2FWZmPs%3D" alt="image.png" loading="lazy"/></p>
<ol start="5">
<li>给背景设置一个颜色，让透明的部分展示背景的颜色，效果如下：</li>
</ol>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2159fb378c9942a1bf84ccab15fe057e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaXRzX3dpbGQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769949098&amp;x-signature=UKU%2Bh5STGXaZkSVDOMxjHelJasg%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-5">代码：</h4>
<pre><code class="hljs language-html" lang="html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"zh"</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>网格<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
    <span class="hljs-selector-pseudo">:root</span> {
      <span class="hljs-comment">/* 深色大面积的背景色 */</span>
      <span class="hljs-attr">--clr1</span>: <span class="hljs-number">#1F3A5F</span>;
      <span class="hljs-comment">/* 浅色点的颜色 */</span>
      <span class="hljs-attr">--clr2</span>: <span class="hljs-number">#4d648d</span>;
      <span class="hljs-comment">/* 点的宽度 */</span>
      <span class="hljs-attr">--w1</span>: <span class="hljs-number">4px</span>;
      <span class="hljs-comment">/* 最小单元的宽度 */</span>
      <span class="hljs-attr">--w2</span>: <span class="hljs-number">20px</span>;
    }

    * {
      <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;
      <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span>;
    }

    <span class="hljs-selector-class">.main</span> {
      <span class="hljs-attribute">width</span>: <span class="hljs-number">100vw</span>;
      <span class="hljs-attribute">height</span>: <span class="hljs-number">100vh</span>;
      <span class="hljs-attribute">background-image</span>:
        <span class="hljs-comment">/* 先绘制一个从上到下的正方形，把该正方形的上方 **4px** 部分绘制为透明的，下方部分绘制为深色 */</span>
        <span class="hljs-built_in">linear-gradient</span>(to bottom, transparent, transparent <span class="hljs-built_in">var</span>(--w1), <span class="hljs-built_in">var</span>(--clr1) <span class="hljs-built_in">var</span>(--w1)),
        <span class="hljs-comment">/* 再绘制一个从左到右的正方形，把该正方形的左边 **4px** 部分绘制为透明的，右边部分绘制为深色 */</span>
        <span class="hljs-built_in">linear-gradient</span>(to right, transparent, transparent <span class="hljs-built_in">var</span>(--w1), <span class="hljs-built_in">var</span>(--clr1) <span class="hljs-built_in">var</span>(--w1));
      <span class="hljs-comment">/* 设置最小单元的宽度 */</span>
      <span class="hljs-attribute">background-size</span>: <span class="hljs-built_in">var</span>(--w2) <span class="hljs-built_in">var</span>(--w2);
      <span class="hljs-comment">/* 给背景设置一个颜色，让透明的部分展示背景的颜色 */</span>
      <span class="hljs-attribute">background-color</span>: <span class="hljs-built_in">var</span>(--clr2);
    }
  </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"main"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<h3 data-id="heading-6">线状网格</h3>
<h4 data-id="heading-7">效果：</h4>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/16467a22e5cb4c3b9af88a11b1876eb9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaXRzX3dpbGQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769949098&amp;x-signature=Fhi0xF1KE6xBZ4WHhQTKsce78%2F8%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-8">实现原理：</h4>
<p>将上面点状网格的点的边长调大，点大了之后就会出现两条边的效果，如下图：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a1f387f83bc449ada5b66ad620589801~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaXRzX3dpbGQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769949098&amp;x-signature=46SIe5fNGwcP8cx8xG64WpP4MpI%3D" alt="image.png" loading="lazy"/></p>
<p>再将之前的两个颜色调换一下就得到了线状网格。</p>
<h4 data-id="heading-9">代码：</h4>
<pre><code class="hljs language-html" lang="html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"zh"</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>网格<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
    <span class="hljs-selector-pseudo">:root</span> {
      <span class="hljs-comment">/* 深色大面积的背景色 */</span>
      <span class="hljs-attr">--clr1</span>: <span class="hljs-number">#4d648d</span>;
      <span class="hljs-comment">/* 浅色点的颜色 */</span>
      <span class="hljs-attr">--clr2</span>: <span class="hljs-number">#1F3A5F</span>;
      <span class="hljs-comment">/* 点的宽度 */</span>
      <span class="hljs-attr">--w1</span>: <span class="hljs-number">18px</span>;
      <span class="hljs-comment">/* 最小单元的宽度 */</span>
      <span class="hljs-attr">--w2</span>: <span class="hljs-number">20px</span>;
    }

    * {
      <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;
      <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span>;
    }

    <span class="hljs-selector-class">.main</span> {
      <span class="hljs-attribute">width</span>: <span class="hljs-number">100vw</span>;
      <span class="hljs-attribute">height</span>: <span class="hljs-number">100vh</span>;
      <span class="hljs-attribute">background-image</span>:
        <span class="hljs-comment">/* 先绘制一个从上到下的正方形，把该正方形的上方 **4px** 部分绘制为透明的，下方部分绘制为深色 */</span>
        <span class="hljs-built_in">linear-gradient</span>(to bottom, transparent, transparent <span class="hljs-built_in">var</span>(--w1), <span class="hljs-built_in">var</span>(--clr1) <span class="hljs-built_in">var</span>(--w1)),
        <span class="hljs-comment">/* 再绘制一个从左到右的正方形，把该正方形的左边 **4px** 部分绘制为透明的，右边部分绘制为深色 */</span>
        <span class="hljs-built_in">linear-gradient</span>(to right, transparent, transparent <span class="hljs-built_in">var</span>(--w1), <span class="hljs-built_in">var</span>(--clr1) <span class="hljs-built_in">var</span>(--w1));
      <span class="hljs-comment">/* 设置最小单元的宽度 */</span>
      <span class="hljs-attribute">background-size</span>: <span class="hljs-built_in">var</span>(--w2) <span class="hljs-built_in">var</span>(--w2);
      <span class="hljs-comment">/* 给背景设置一个颜色，让透明的部分展示背景的颜色 */</span>
      <span class="hljs-attribute">background-color</span>: <span class="hljs-built_in">var</span>(--clr2);
    }
  </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"main"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[JS-告别页面卡死：深度解析 Web Worker 多线程]]></title>    <link>https://juejin.cn/post/7598807837867753498</link>    <guid>https://juejin.cn/post/7598807837867753498</guid>    <pubDate>2026-01-25T12:30:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598807837867753498" data-draft-id="7598807837867737114" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="JS-告别页面卡死：深度解析 Web Worker 多线程"/> <meta itemprop="keywords" content="前端,JavaScript,面试"/> <meta itemprop="datePublished" content="2026-01-25T12:30:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="发现一只大呆瓜"/> <meta itemprop="url" content="https://juejin.cn/user/180747382561607"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            JS-告别页面卡死：深度解析 Web Worker 多线程
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/180747382561607/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    发现一只大呆瓜
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-25T12:30:39.000Z" title="Sun Jan 25 2026 12:30:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">前言</h3>
<p>由于 JavaScript 是单线程执行的，在处理大量计算任务（如大文件 Hash 计算、图像处理）时，往往会导致 UI 渲染掉帧甚至页面假死。<strong>Web Worker</strong> 的出现为 JS 带来了多线程能力，让我们可以将耗时任务丢到后台执行。</p>
<h2 data-id="heading-1">一、 什么是 Web Worker？</h2>
<p><strong>Web Worker</strong> 是 HTML5 标准的一部分，它允许在浏览器后台运行 JavaScript。</p>
<ul>
<li><strong>主线程</strong>：负责 UI 渲染、用户交互、执行常规 JS。</li>
<li><strong>Worker 线程</strong>：在后台运行，与主线程并行不悖。</li>
</ul>
<hr/>
<h2 data-id="heading-2">二、 核心用法与 API</h2>
<h3 data-id="heading-3">1. 快速上手</h3>
<p>Web Worker 的通信是基于“消息发布/订阅”模式的。</p>
<ol>
<li>通过 <code>new worker(worker文件)</code>创建worker进程</li>
<li>设置<code>onmessage()</code>事件监听接受到的消息（错误了就会触发<code>onerror</code> 事件）</li>
<li>使用<code>postMessage()</code>向worker线程发送数据</li>
<li>使用<code>terminate()</code>关掉Web Worker、并释放浏览器资源</li>
</ol>
<p><strong>主线程 (Main Thread)：</strong></p>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-comment">// 1. 创建 Worker 实例，加载脚本文件</span>
<span class="hljs-keyword">const</span> worker = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Worker</span>(<span class="hljs-string">'./worker.js'</span>);

<span class="hljs-comment">// 2. 向 Worker 发送数据</span>
worker.<span class="hljs-title function_">postMessage</span>({ <span class="hljs-attr">type</span>: <span class="hljs-string">'start'</span>, <span class="hljs-attr">value</span>: <span class="hljs-number">10000</span> });

<span class="hljs-comment">// 3. 监听 Worker 返回的结果</span>
worker.<span class="hljs-property">onmessage</span> = <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'收到后台计算结果:'</span>, e.<span class="hljs-property">data</span>);
};

<span class="hljs-comment">// 4. 异常处理</span>
worker.<span class="hljs-property">onerror</span> = <span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Worker 报错:'</span>, err.<span class="hljs-property">message</span>);
};

<span class="hljs-comment">// 5. 任务完成，主动关闭（节省内存）</span>
<span class="hljs-comment">// worker.terminate(); </span>
</code></pre>
<p><strong>Worker 线程 (worker.js)：</strong></p>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-comment">// self 代表子线程自身</span>
self.<span class="hljs-property">onmessage</span> = <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> { type, value } = e.<span class="hljs-property">data</span>;
    
    <span class="hljs-keyword">if</span> (type === <span class="hljs-string">'start'</span>) {
        <span class="hljs-comment">// 执行高能耗计算</span>
        <span class="hljs-keyword">let</span> result = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; value; i++) { result += i; }
        
        <span class="hljs-comment">// 将结果发回主线程</span>
        self.<span class="hljs-title function_">postMessage</span>(result);
    }
};

<span class="hljs-comment">// 也可以在子线程内部关闭自己</span>
<span class="hljs-comment">// self.close(); </span>
</code></pre>
<hr/>
<h2 data-id="heading-4">三、 使用 Web Worker 的“五大禁令”</h2>
<p>由于 Worker 运行在独立的环境中，它受到以下严格限制：</p>
<ol>
<li><strong>同源限制</strong>：子线程脚本文件必须与主线程代码<strong>同源</strong>。</li>
<li><strong>DOM 限制</strong>：无法操作 DOM（没有 <code>document</code>, <code>window</code>, <code>parent</code> 对象）。</li>
<li><strong>文件限制</strong>：无法直接读取本地文件（<code>file://</code> 协议），只能加载网络脚本。</li>
<li><strong>通信限制</strong>：主线程与子线程之间不在同一个上下文，必须通过 <code>postMessage</code> 传值，不能共享内存（除非使用 <code>SharedArrayBuffer</code>）。</li>
<li><strong>脚本限制</strong>：无法调用 <code>alert()</code> 或 <code>confirm()</code>，但可以使用 <code>XMLHttpRequest</code> 和 <code>fetch</code>。</li>
</ol>
<hr/>
<h2 data-id="heading-5">四、 进阶：性能优化的利器</h2>
<h3 data-id="heading-6">1. 大文件切片与 Hash 计算</h3>
<p>在上传几 GB 的大文件时，我们需要计算文件 MD5 值来做“秒传”判断。在主线程执行这个计算会直接卡死页面。</p>
<ul>
<li><strong>方案</strong>：将文件 File 对象传给 Worker，在后台使用 <code>FileReaderSync</code>（同步读取，仅限 Worker 使用）进行分片 Hash 计算。</li>
</ul>
<hr/>
<h2 data-id="heading-7">五、 总结：什么时候该用 Web Worker？</h2>
<ul>
<li><strong>数据加密/解密</strong>：如大型字符串的 MD5/SHA 计算。</li>
<li><strong>复杂图像/视频处理</strong>：如 Canvas 的像素级滤镜计算。</li>
<li><strong>解析超大 JSON</strong>：当后端接口返回数十万条数据时。</li>
<li><strong>流媒体处理</strong>：音视频解码。</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[我的2025：TRAE帮我圆梦开发的VibeCoding时光]]></title>    <link>https://juejin.cn/post/7598587406708064297</link>    <guid>https://juejin.cn/post/7598587406708064297</guid>    <pubDate>2026-01-25T12:45:30.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598587406708064297" data-draft-id="7598744870995427371" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="我的2025：TRAE帮我圆梦开发的VibeCoding时光"/> <meta itemprop="keywords" content="Trae"/> <meta itemprop="datePublished" content="2026-01-25T12:45:30.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="鼓掌MVP"/> <meta itemprop="url" content="https://juejin.cn/user/3009786736020724"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            我的2025：TRAE帮我圆梦开发的VibeCoding时光
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3009786736020724/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    鼓掌MVP
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-25T12:45:30.000Z" title="Sun Jan 25 2026 12:45:30 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读31分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/65e3d64677984768b6983c87bc2fc3a6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6byT5o6MTVZQ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769949930&amp;x-signature=GC3RCvLXe%2F5GZj9Uc4qSBubitag%3D" alt="image.png" loading="lazy"/>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/112c25d09b494a1d9a2a002a37c676ac~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6byT5o6MTVZQ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769949930&amp;x-signature=1hO7T8fIXtwmC3vl455adaGRYJc%3D" alt="请在此添加图片描述" loading="lazy"/></p>
<h2 data-id="heading-0">引言</h2>
<p>2025年，对我而言是充满技术探索与创意实践的一年。这一年，我与TRAE相遇，它像一把钥匙，为我打开了创意与技术融合的大门。</p>
<p>从旅游札记到游戏开发，从生活助手到社交管理，TRAE与MCP的组合以其强大的AI辅助编程和服务整合能力，让我这个前端开发者能够轻松将创意变为现实。现在，就让我回顾这段与TRAE和MCP相伴的精彩时光。</p>
<h2 data-id="heading-1">一、TRAE赋能的创意项目</h2>
<h3 data-id="heading-2">1. AI驱动的旅游札记生成器：MCP能力的完美展示</h3>
<p>作为一个热爱旅行的人，我一直困扰于旅行后整理照片和撰写游记的繁琐。2025年，我利用TRAE Builder+MCP服务开发了一个AI驱动的旅游札记生成器，彻底解决了这个问题。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cd7bd65cfb6d46248a8e96d2dab1caf1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6byT5o6MTVZQ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769949930&amp;x-signature=uXGl4adc%2FGswzx9UYHQ3c06PIVY%3D" alt="请在此添加图片描述" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1fa3f24946744cf6b2c7dc349c08300e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6byT5o6MTVZQ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769949930&amp;x-signature=c3i4BMKwg%2B9rN%2BQuVKWXiwkZYps%3D" alt="请在此添加图片描述" loading="lazy"/></p>
<p>这个应用的神奇之处在于：只需输入旅行的基本信息和照片，它就能自动分析照片内容，结合地理位置信息，生成风格多样、内容丰富的旅行札记。更令人惊喜的是，它还支持Markdown、HTML、PDF等多种格式导出，让我的旅行记忆能够以各种形式保存和分享。</p>
<p>MCP服务在这里发挥了核心作用：</p>
<ul>
<li><strong>图像分析MCP</strong>：像一位专业的视觉解读师，智能识别照片中的场景、物体、人物和氛围，甚至能捕捉到照片中的情感色彩，为游记增添生动的描述。</li>
<li><strong>高德地图MCP</strong>：将普通地址精准转换为经纬度坐标，不仅能在地图上标记旅行足迹，还能智能搜索周边的隐藏景点和特色美食，为旅行故事增添惊喜元素。</li>
<li><strong>文本生成MCP</strong>：结合所有分析结果，生成风格各异的旅行故事，从文艺小清新到深度旅行感悟，满足不同场景的表达需求。</li>
</ul>
<p>通过这些MCP服务的无缝整合，最终生成的旅行故事个性化十足，细节丰富，情感真挚，比我自己写的还要精彩。这让我深刻体会到，MCP不仅是技术工具，更是创意的放大器。</p>
<h3 data-id="heading-3">2. 基于MCP与Trae框架的"人情账本"系统：智能社交管理的新范式</h3>
<p>中国人的社交往来中，"人情"是一个重要的组成部分。但随着时间推移，事务繁杂，很难记得清这些往来账。为此，我利用TRAE的Vibe Coding开发能力，结合MCP技术，开发了一个"人情账本"系统。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/61cbd800f1584a55911082a739261a68~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6byT5o6MTVZQ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769949930&amp;x-signature=5ZsNzU5%2FsgybGF5cXrLsx7qZSEs%3D" alt="请在此添加图片描述" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7790eafa19114ae2b2e384dc3211e9f1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6byT5o6MTVZQ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769949930&amp;x-signature=%2BNA%2FQrET7GDw5WxhyYcgTFbzQ8I%3D" alt="请在此添加图片描述" loading="lazy"/></p>
<p>这个系统的核心特点是支持自然语言管理人际往来，让用户能够轻松记录和查询社交账目。无论是收到的红包，还是需要随份子的庆典，都能通过简单的语言描述快速记录，从此人际往来不再头疼。</p>
<p>MCP技术在这里的应用让系统更加智能：</p>
<ul>
<li><strong>自然语言处理MCP</strong>：理解用户的自然语言输入，自动提取关键信息（如人物、金额、事件类型、日期等），将非结构化的语言描述转化为结构化的数据记录。</li>
<li><strong>数据存储与分析MCP</strong>：安全存储用户的社交往来数据，并提供智能分析功能，如往来频次统计、金额分析、关系网络图等，帮助用户更好地理解自己的社交网络。</li>
<li><strong>提醒服务MCP</strong>：根据历史数据和时间节点，智能提醒用户重要的社交事件，如朋友的生日、纪念日等，避免因疏忽而错过重要的社交场合。</li>
</ul>
<p>通过这些MCP服务的整合，"人情账本"系统不仅解决了实际问题，还为用户提供了全新的社交管理体验。这让我意识到，MCP的价值在于它能够将复杂的技术能力封装为简单易用的服务，让开发者能够专注于解决用户问题。</p>
<h3 data-id="heading-4">3. 智能睡眠助手Agent：MCP驱动的健康管理</h3>
<p>由于工作压力，我曾经常遭受失眠的困扰，早上醒来总是头疼不已。意识到这个问题后，我想到了用TRAE的AI智能体功能结合MCP服务开发一个睡眠助手。</p>
<p>虽然最初只是抱着尝试的心态，但TRAE与MCP的组合让我惊喜不已。通过与睡眠助手的交流，它能够分析我的睡眠习惯，提供个性化的睡眠建议，甚至通过放松音乐和冥想指导帮助我改善睡眠质量。这个小小的工具，成为了我2025年最贴心的健康伙伴。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d7d168f4391f4266b4cc454c16055dbe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6byT5o6MTVZQ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769949930&amp;x-signature=IkpsJynwo89yBJnmb3E7B9kPkc8%3D" alt="请在此添加图片描述" loading="lazy"/></p>
<p>MCP服务在这里的应用让睡眠助手更加智能和实用：</p>
<ul>
<li><strong>语音交互MCP</strong>：提供自然流畅的语音对话能力，让我能够在睡前放松状态下与助手交流，无需动手操作。</li>
<li><strong>数据分析MCP</strong>：记录和分析我的睡眠数据，包括入睡时间、睡眠时长、睡眠质量等，生成详细的睡眠报告，帮助我了解自己的睡眠状况。</li>
<li><strong>内容生成MCP</strong>：根据我的偏好和当前状态，生成个性化的放松音乐和冥想指导，帮助我更快进入睡眠状态。</li>
<li><strong>健康建议MCP</strong>：结合睡眠数据和个人情况，提供科学的睡眠建议，如调整作息时间、改善睡眠环境等，帮助我建立健康的睡眠习惯。</li>
</ul>
<p>通过这些MCP服务的整合，智能睡眠助手不仅是一个简单的应用，更是一个个性化的健康管理专家。这让我认识到，MCP技术在健康领域有着巨大的应用潜力，能够为人们的生活带来实质性的改善。</p>
<h3 data-id="heading-5">4. 碰碰车吃豆大战游戏：MCP增强的游戏体验</h3>
<p>游戏开发一直是我的兴趣所在，但传统的游戏开发流程复杂且耗时。2025年，我利用Trae对话式编程，结合HTML5 Canvas技术和MCP服务，开发了一款碰碰车吃豆大战游戏。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e8b9e7aa4bd848b68f8b69fbe9d738df~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6byT5o6MTVZQ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769949930&amp;x-signature=PkG1BOkh3jbQDftpcDL4w8gnjg4%3D" alt="pp.gif" loading="lazy"/></p>
<p>这是一款休闲竞技游戏，玩家控制一辆碰碰车与其他AI对手在地图上争夺资源。游戏实现了爽快的物理碰撞体验、智能的AI对手行为、随机生成的奖励系统和实时计分排行榜。整个开发过程中，TRAE的代码生成和优化能力让我能够在短时间内实现复杂的游戏逻辑和AI行为，而MCP服务则为游戏增添了更多精彩特性。</p>
<p>MCP服务在这里的应用让游戏更加丰富和智能：</p>
<ul>
<li><strong>AI行为MCP</strong>：为游戏中的AI对手提供智能决策能力，使它们能够评估地图上的资源价值，选择最优目标，甚至能够学习玩家的游戏风格并调整策略。</li>
<li><strong>音效MCP</strong>：根据游戏场景和玩家操作，生成动态的音效和背景音乐，增强游戏的沉浸感和趣味性。</li>
<li><strong>数据分析MCP</strong>：记录玩家的游戏数据，如游戏时长、得分、常用策略等，生成个人游戏报告，帮助玩家了解自己的游戏风格和改进方向。</li>
<li><strong>社交分享MCP</strong>：提供便捷的游戏成绩分享功能，让玩家能够轻松将自己的精彩表现分享到社交平台，增加游戏的社交属性。</li>
</ul>
<p>通过这些MCP服务的整合，碰碰车吃豆大战游戏不仅具有出色的游戏体验，还具备了智能和社交特性。这让我意识到，MCP技术能够为游戏开发带来全新的可能性，让游戏更加智能、个性化和社交化。</p>
<h3 data-id="heading-6">5. "猫鼠大作战"小游戏：MCP助力的快速开发</h3>
<p>作为一名前端开发者，我一直希望能够快速实现自己的游戏创意。2025年，我尝试了豆包AI+Trae IDE+MCP的组合，仅用一句话就开发了"猫鼠大作战"网页小游戏。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a7501824bf044355a77d8a047a5ea960~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6byT5o6MTVZQ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769949930&amp;x-signature=fofUbk7PLiAk6rXrwsC61xcTEf4%3D" alt="请在此添加图片描述" loading="lazy"/></p>
<p>整个开发过程始于一个简单的需求描述："帮我开发一个猫捉老鼠的网页小游戏"。豆包AI通过智能分析和代码生成，快速实现了游戏的基本框架，而MCP服务则为游戏增添了更多智能特性。最终的游戏包含了键盘和触摸控制、动态难度系统、智能的老鼠AI和响应式设计，能够在不同设备上提供良好的游戏体验。</p>
<p>MCP服务在这里的应用让游戏开发更加高效和智能：</p>
<ul>
<li><strong>游戏逻辑MCP</strong>：提供预设的游戏逻辑模块，如碰撞检测、AI行为、计分系统等，大大减少了手动编写代码的工作量。</li>
<li><strong>多设备适配MCP</strong>：自动生成适配不同设备的代码，确保游戏在PC、平板和手机上都能提供良好的体验，无需手动编写复杂的响应式代码。</li>
<li><strong>性能优化MCP</strong>：根据游戏的具体情况，自动优化代码结构和资源加载策略，确保游戏在各种设备上都能流畅运行。</li>
<li><strong>用户体验MCP</strong>：提供游戏教程、难度调整、成就系统等通用游戏功能模块，让游戏更加完整和专业。</li>
</ul>
<p>通过这些MCP服务的整合，"猫鼠大作战"小游戏的开发时间大大缩短，而游戏质量却得到了保证。这让我深刻体会到，MCP技术是快速原型开发和创意验证的强大工具，能够让开发者在短时间内将创意变为现实。</p>
<h2 data-id="heading-7">二、TRAE的2025年更新变迁</h2>
<p>2025年是TRAE快速发展的一年，在这一年里，TRAE推出了多项重要更新，不断提升开发者体验和能力。这些更新不仅丰富了TRAE的功能，也为VibeCoding的实践提供了更加强大的支持。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/401244d4976848f693805c2cd1d1aada~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6byT5o6MTVZQ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769949930&amp;x-signature=G6zrm7MC6eaS8fS6vXYrxZsPhyg%3D" alt="请在此添加图片描述" loading="lazy"/></p>
<p>作为一个受益匪浅的开发者，感谢TRAE的陪伴，也感谢无数工作人员背后默默的付出！</p>
<h3 data-id="heading-8">2.1 TRAE插件系统的推出</h3>
<p>年初，TRAE正式推出了插件系统，为开发者提供了扩展TRAE功能的全新方式。插件系统的核心价值在于：</p>
<ul>
<li><strong>功能扩展</strong>：开发者可以通过安装和开发插件，为TRAE添加新的功能和能力，如特定领域的代码生成、自定义MCP服务集成等。</li>
<li><strong>个性化定制</strong>：每个开发者都可以根据自己的工作流程和偏好，定制TRAE的界面和功能，打造专属的开发环境。</li>
<li><strong>社区生态</strong>：插件系统催生了活跃的开发者社区，开发者可以分享自己开发的插件，也可以从社区获取他人开发的优质插件，共同丰富TRAE的功能生态。</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/adbb33f0b0064e9e8b4005cb9264d3a8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6byT5o6MTVZQ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769949930&amp;x-signature=qgtn45wYpqLzXkTFdMMq6JXU%2FLQ%3D" alt="请在此添加图片描述" loading="lazy"/></p>
<p>作为前端开发者，我还特别喜欢前端相关的插件，如React组件生成插件、Tailwind CSS智能提示插件等，这些插件大大提高了我的开发效率。</p>
<h3 data-id="heading-9">2.2 TRAE Builder的全面升级</h3>
<p>年中，TRAE Builder迎来了重大升级，从一个简单的项目生成工具进化为功能强大的可视化开发平台：</p>
<ul>
<li><strong>可视化界面设计</strong>：新增了拖拽式界面设计器，开发者可以通过可视化操作创建和编辑UI界面，无需手动编写HTML和CSS代码。</li>
<li><strong>流程编排能力</strong>：提供了直观的流程编排工具，开发者可以通过拖拽和连接不同的节点，构建复杂的业务逻辑和工作流程。</li>
<li><strong>MCP服务可视化配置</strong>：支持通过可视化界面配置和管理MCP服务，大大降低了MCP服务的使用门槛。</li>
<li><strong>多平台发布</strong>：内置了多平台发布功能，开发者可以一键将应用发布到Web、移动端、桌面端等多个平台，无需为不同平台单独开发。</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/32607827bc984b00a36daad4a8161028~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6byT5o6MTVZQ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769949930&amp;x-signature=jJu9%2FKOHU60gVXruo44crp%2Bbeic%3D" alt="请在此添加图片描述" loading="lazy"/></p>
<p>TRAE Builder的升级，让我能够更加高效地构建完整的应用，从界面设计到功能实现，都可以在一个统一的平台上完成，大大简化了开发流程。</p>
<h3 data-id="heading-10">2.3 SOLO模式的创新</h3>
<p>下半年，TRAE推出了全新的SOLO模式，为个人开发者提供了更加专注和高效的开发环境：</p>
<ul>
<li><strong>沉浸式开发体验</strong>：SOLO模式提供了极简的界面设计，移除了所有不必要的干扰元素，让开发者能够完全专注于代码和创意。</li>
<li><strong>智能上下文感知</strong>：系统能够智能感知开发者的工作上下文，自动提供相关的代码建议、文档和工具，减少了开发者的认知负担。</li>
<li><strong>离线工作能力</strong>：SOLO模式支持完全离线工作，开发者可以在没有网络连接的情况下继续开发，确保了开发工作的连续性。</li>
<li><strong>个人知识管理</strong>：内置了个人知识管理系统，自动记录和组织开发者的代码片段、解决方案和开发经验，形成个人的开发知识库。</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f43a0b8fe61846eb8768fd05b0d263b7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6byT5o6MTVZQ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769949930&amp;x-signature=uapHWN2PV%2FL81ydmDD1W0QG5Dlg%3D" alt="请在此添加图片描述" loading="lazy"/></p>
<p>这时我苦苦排队等了很久，心心念念的SOLO模式，终于用上了！还是免费的！</p>
<p>SOLO模式的推出，让我在开发过程中能够更加专注和高效，特别是在处理复杂的问题时，沉浸式的开发环境帮助我更好地集中注意力，找到最佳的解决方案。</p>
<h3 data-id="heading-11">2.4 其他重要更新</h3>
<p>除了上述重大更新外，TRAE在2025年还推出了多项其他重要更新：</p>
<ul>
<li><strong>AI能力增强</strong>：不断提升TRAE的AI理解和生成能力，支持更加复杂和抽象的需求描述，生成更加准确和高质量的代码。</li>
<li><strong>性能优化</strong>：持续优化TRAE的运行性能，减少响应时间，提高代码生成速度，确保流畅的开发体验。</li>
<li><strong>多语言支持</strong>：增加了对更多编程语言和框架的支持，扩大了TRAE的适用范围。</li>
<li><strong>安全性提升</strong>：加强了代码和数据的安全性，确保开发者的知识产权和敏感信息得到充分保护。</li>
</ul>
<p>这些更新，让TRAE在2025年实现了从工具到平台的跨越，成为了一个功能完整、生态丰富的AI辅助开发平台。作为一名前端开发者，我深刻感受到了这些更新带来的便利和效率提升，它们不仅改变了我的开发方式，也让我对编程的未来充满了期待。</p>
<h2 data-id="heading-12">三、TRAE带来的技术体验与收获</h2>
<h3 data-id="heading-13">1. 降低编程门槛，提高开发效率</h3>
<p>在与TRAE相伴的2025年，我深刻体会到了AI辅助编程如何彻底改变传统的软件开发流程。无论是复杂的旅游札记生成器，还是简单的网页小游戏，TRAE都能通过对话式编程和智能代码生成，帮助我快速实现创意。</p>
<p>这种开发方式不仅大大降低了编程门槛，让编程经验有限的我也能开发出专业级别的应用，也极大提高了开发效率，让我能够将更多精力放在创意设计和用户体验上。</p>
<h3 data-id="heading-14">2. 模块化设计与技术整合：MCP的核心价值</h3>
<p>TRAE的开发环境鼓励模块化设计，让我能够将复杂的项目分解为多个独立但相互协作的组件。这种设计方式不仅使代码结构清晰，也便于后续维护和扩展。</p>
<p>而MCP（Module Connect Platform）则是技术整合的最佳实践，它像一个智能的连接器，让不同的技术服务能够无缝协作：</p>
<ul>
<li><strong>服务封装</strong>：MCP将复杂的技术能力封装为简单易用的服务接口，开发者无需了解底层实现细节，只需关注如何使用这些服务来解决问题。</li>
<li><strong>标准化接口</strong>：MCP提供标准化的服务接口，使不同的服务能够按照统一的方式进行调用和集成，大大降低了技术整合的复杂度。</li>
<li><strong>服务编排</strong>：MCP支持服务之间的智能编排，使多个服务能够协同工作，形成更强大的复合功能。例如，在旅游札记生成器中，图像分析MCP、地图MCP和文本生成MCP的协同工作，产生了1+1+1&gt;3的效果。</li>
<li><strong>可扩展性</strong>：MCP的模块化架构使得系统具有高度的可扩展性，开发者可以根据需要轻松添加新的服务或替换现有的服务，而不会影响整个系统的稳定性。</li>
</ul>
<p>通过TRAE与MCP的结合，我能够轻松整合各种第三方服务，如图像分析、地图服务、语音识别等，为应用添加丰富的功能。这种技术整合能力，让我的项目能够站在巨人的肩膀上，实现更多可能性。</p>
<p>作为前端开发者，我尤其欣赏MCP在前端技术整合方面的能力。它不仅能够整合后端服务，还能够整合各种前端库和框架，如React、Vue、Three.js等，让前端开发更加高效和灵活。</p>
<h3 data-id="heading-15">3. 从创意到现实的快速转化：MCP的加速作用</h3>
<p>2025年，我最深的感受是：有了TRAE和MCP，创意到现实的距离变得前所未有的近。无论是突发奇想的小游戏，还是解决实际问题的工具应用，我都能通过TRAE和MCP快速将其变为现实。</p>
<p>MCP在创意转化过程中发挥了关键的加速作用：</p>
<ul>
<li><strong>快速原型</strong>：通过调用现有的MCP服务，我可以在短时间内搭建出功能完整的原型，验证创意的可行性，而不需要从零开始编写所有代码。</li>
<li><strong>功能丰富</strong>：MCP提供了丰富的服务库，涵盖了从图像处理、自然语言处理到数据分析、社交分享等各种功能，让我能够为应用添加更多高级特性，提升用户体验。</li>
<li><strong>技术兜底</strong>：MCP服务由专业团队维护和更新，确保了服务的稳定性和安全性，让我能够专注于创意设计，而不需要担心技术实现的细节和风险。</li>
<li><strong>迭代迅速</strong>：当创意需要调整时，我可以通过修改MCP服务的配置或替换不同的MCP服务，快速实现功能的变更和优化，大大缩短了迭代周期。</li>
</ul>
<p>这种快速转化的能力，让我更加勇于尝试新的创意，也让我的2025年充满了惊喜和成就感。正如那句"人人都是VibeMaker"所说，TRAE和MCP让每个人都有机会成为创意的实现者。</p>
<p>作为前端开发者，我发现MCP在前端创意转化方面尤其有价值。它不仅能够加速前端界面的开发，还能够轻松整合后端服务，让我能够独立完成从前端到后端的完整应用开发，真正实现"一个人就是一个团队"的开发效率。</p>
<h3 data-id="heading-16">4. VibeCoding：重新定义编程体验</h3>
<p>在使用TRAE和MCP的过程中，我逐渐领悟到VibeCoding的真正含义。它不仅仅是一种编程方式，更是一种全新的创意表达形式，而MCP则是VibeCoding的重要技术支撑。</p>
<p>VibeCoding的核心在于"对话式编程"，它打破了传统编程中人与机器之间的壁垒。通过自然语言交流，我可以直接向TRAE表达我的创意和需求，而不需要担心语法错误或复杂的代码结构。这种交流方式更加符合人类的思维习惯，让编程变得更加直观和愉悦。</p>
<p>而MCP则为VibeCoding提供了强大的技术后盾：</p>
<ul>
<li><strong>能力扩展</strong>：MCP为VibeCoding提供了丰富的技术能力，让开发者能够通过对话式编程调用各种高级服务，如图像处理、自然语言处理、数据分析等，大大扩展了VibeCoding的应用范围。</li>
<li><strong>复杂度管理</strong>：MCP将复杂的技术实现封装为简单的服务接口，让开发者能够通过自然语言命令轻松使用这些服务，而不需要了解底层实现的复杂度，进一步降低了编程的门槛。</li>
<li><strong>创意聚焦</strong>：MCP让开发者能够专注于问题的本质和解决方案的创意，而不是陷入繁琐的代码细节中。当我开发旅游札记生成器时，我可以专注于如何让AI更好地理解照片内容和旅行故事，而不是纠结于图像处理的具体算法；当我开发游戏时，我可以专注于游戏机制和用户体验，而不是担心碰撞检测的实现细节。</li>
</ul>
<p>这种思维方式的转变，让我对编程有了全新的认识。编程不再是一种技术门槛，而是一种创意表达的工具。每个人都可以通过VibeCoding和MCP，将自己的创意变为现实，成为数字世界的建设者。</p>
<p>作为前端开发者，我发现VibeCoding和MCP的结合在前端开发中尤其有价值。它不仅能够加速前端界面的开发，还能够轻松整合各种后端服务，让前端开发者能够独立完成更加复杂和功能丰富的应用，真正实现"创意驱动开发"的理念。</p>
<h3 data-id="heading-17">5. TRAE与MCP对前端开发者的特别帮助</h3>
<p>作为一名前端开发者，我发现TRAE与MCP的组合在前端开发领域尤其具有革命性的意义。它们不仅解决了前端开发中的许多痛点，也为前端开发者打开了新的可能性。</p>
<h4 data-id="heading-18">5.1 前端框架与库的智能应用</h4>
<p>TRAE对主流前端框架（如React、Vue、Angular等）和库（如Tailwind CSS、Three.js等）有深入的理解。通过简单的对话，我可以快速生成符合最佳实践的组件代码，而不需要手动编写繁琐的模板和配置。</p>
<p>而MCP则为前端框架提供了强大的扩展能力：</p>
<ul>
<li><strong>组件库MCP</strong>：提供丰富的预设组件库，涵盖了从基础UI组件到复杂交互组件的各种类型，让前端开发更加高效。</li>
<li><strong>框架适配MCP</strong>：自动生成适配不同前端框架的代码，让我能够根据项目需求灵活选择合适的框架，而不需要学习多种框架的语法。</li>
</ul>
<p>例如，当我需要创建一个响应式导航栏时，只需告诉TRAE我的需求，它就能生成包含适当的HTML结构、CSS样式和JavaScript交互的完整代码，甚至会自动处理移动端适配和动画效果。</p>
<h4 data-id="heading-19">5.2 响应式设计与移动适配</h4>
<p>响应式设计是现代前端开发的核心要求之一，但手动编写媒体查询和处理各种设备尺寸的适配往往耗时且容易出错。TRAE能够智能分析设计需求，自动生成适配各种屏幕尺寸的响应式代码，确保应用在不同设备上都能提供良好的用户体验。</p>
<p>MCP在响应式设计中发挥了重要作用：</p>
<ul>
<li><strong>设备检测MCP</strong>：智能检测用户设备的类型和尺寸，提供针对性的界面适配方案。</li>
<li><strong>布局优化MCP</strong>：根据不同设备的屏幕尺寸，自动调整布局结构和元素大小，确保最佳的视觉效果。</li>
<li><strong>交互适配MCP</strong>：根据设备类型（如触摸设备 vs 鼠标设备），自动调整交互方式，提供符合设备特性的用户体验。</li>
</ul>
<h4 data-id="heading-20">5.3 UI组件开发与样式管理</h4>
<p>TRAE可以帮助前端开发者快速创建和管理UI组件库。通过对话式编程，我可以描述组件的外观和行为，TRAE会生成符合设计规范的组件代码，并自动处理样式隔离和主题管理。</p>
<p>MCP在UI组件开发中提供了强大的支持：</p>
<ul>
<li><strong>设计系统MCP</strong>：提供完整的设计系统支持，包括颜色、字体、间距等设计规范，确保整个应用的视觉风格统一。</li>
<li><strong>样式管理MCP</strong>：提供现代化的样式管理方案，如CSS-in-JS、CSS Modules等，解决样式冲突和命名空间问题。</li>
<li><strong>主题切换MCP</strong>：支持动态主题切换，让应用能够根据用户偏好或系统设置自动调整主题，提升用户体验。</li>
</ul>
<h4 data-id="heading-21">5.4 性能优化</h4>
<p>前端性能优化是一个复杂且持续的过程，涉及代码分割、懒加载、缓存策略等多个方面。TRAE能够分析项目结构，识别性能瓶颈，并提供针对性的优化建议和代码实现，帮助前端开发者构建更加高效的应用。</p>
<p>MCP在前端性能优化中发挥了关键作用：</p>
<ul>
<li><strong>代码分析MCP</strong>：智能分析前端代码，识别性能瓶颈和优化机会。</li>
<li><strong>资源优化MCP</strong>：自动优化图片、字体、脚本等资源的加载策略，减少页面加载时间。</li>
<li><strong>渲染优化MCP</strong>：提供虚拟列表、无限滚动等高级渲染技术，提升复杂页面的渲染性能。</li>
<li><strong>缓存策略MCP</strong>：根据应用的具体情况，自动生成最佳的缓存策略，减少重复请求和数据传输。</li>
</ul>
<h4 data-id="heading-22">5.5 API集成与数据处理</h4>
<p>前端开发中经常需要与后端API进行交互，处理数据获取、状态管理和错误处理等问题。TRAE可以帮助开发者快速生成API调用代码，实现数据的高效处理和状态管理，减少了手动编写重复代码的工作量。</p>
<p>MCP在API集成中提供了强大的能力：</p>
<ul>
<li><strong>API客户端MCP</strong>：自动生成符合RESTful或GraphQL规范的API客户端代码，简化API调用过程。</li>
<li><strong>状态管理MCP</strong>：提供现代化的状态管理方案，如Redux、Vuex、MobX等，帮助前端开发者高效管理应用状态。</li>
<li><strong>数据转换MCP</strong>：自动处理前后端数据格式的转换，解决数据结构不匹配的问题。</li>
<li><strong>错误处理MCP</strong>：提供统一的错误处理机制，确保API调用失败时能够优雅地处理错误，提升用户体验。</li>
</ul>
<h4 data-id="heading-23">5.6 前端测试</h4>
<p>测试是确保前端应用质量的重要环节，但编写测试代码往往繁琐且耗时。TRAE能够根据组件和功能自动生成测试代码，覆盖常见的测试场景，帮助前端开发者提高代码质量和可靠性。</p>
<p>MCP在前端测试中提供了全面的支持：</p>
<ul>
<li><strong>测试框架MCP</strong>：支持多种前端测试框架，如Jest、Mocha、Cypress等，满足不同类型的测试需求。</li>
<li><strong>测试用例MCP</strong>：根据组件和功能的特性，自动生成针对性的测试用例，确保测试覆盖全面。</li>
<li><strong>测试报告MCP</strong>：生成详细的测试报告，帮助开发者了解测试结果和代码质量状况。</li>
<li><strong>CI/CD集成MCP</strong>：提供与持续集成/持续部署系统的集成，实现自动化测试和部署，确保代码质量和开发效率。</li>
</ul>
<h2 data-id="heading-24">四、对未来的展望</h2>
<p>回顾2025年与TRAE和MCP相伴的时光，我充满感激。TRAE和MCP不仅是开发工具，更是我实现创意的伙伴。通过它们，我不仅开发了多个有趣实用的项目，也提升了自己的编程能力和创意表达能力。</p>
<h3 data-id="heading-25">VibeCoding与MCP的未来发展</h3>
<p>展望未来，我相信VibeCoding将会成为主流的编程方式，而MCP则会成为技术整合的标准实践，两者的结合将彻底改变软件开发的格局。</p>
<p>我期待TRAE和MCP能够在以下几个方面继续进化：</p>
<ol>
<li><strong>更深入的行业解决方案</strong>：针对不同行业的特定需求，提供更加专业的MCP服务和开发模板，如教育、医疗、金融等领域的专用解决方案。这些解决方案将整合行业特定的技术能力，为开发者提供一站式的行业应用开发工具。</li>
<li><strong>更强的协作能力</strong>：支持多人实时协作开发，让团队成员能够通过对话式编程共同完成项目，提高团队协作效率。MCP将作为团队协作的技术基础，确保不同开发者的代码和服务能够无缝集成。</li>
<li><strong>更丰富的创意表达形式</strong>：除了文字和代码，还能支持语音、图像、视频等多种形式的创意输入，让开发者能够更加自由地表达自己的想法。MCP将提供相应的服务，处理这些不同形式的创意输入，并转化为可执行的代码。</li>
<li><strong>更智能的代码优化</strong>：能够根据项目的具体情况，自动优化代码结构和性能，提供更加专业和高效的解决方案。MCP将整合先进的代码分析和优化技术，为不同类型的应用提供定制化的优化方案。</li>
<li><strong>更广泛的生态系统</strong>：MCP将构建更加开放和丰富的服务生态系统，吸引更多的服务提供商加入，为开发者提供更加多样化的技术选择。同时，MCP将提供标准化的服务接口和开发工具，降低服务集成的门槛，促进生态系统的健康发展。</li>
<li><strong>更强大的前端能力</strong>：针对前端开发的特点，提供更加专业和强大的MCP服务，如WebAssembly优化、PWA增强、WebXR支持等，帮助前端开发者构建更加先进和丰富的Web应用。</li>
</ol>
<h3 data-id="heading-26">个人的未来规划</h3>
<p>作为一名前端开发者和VibeCoder，我计划在未来继续深入探索TRAE和MCP的潜力，开发更多有意义的前端项目：</p>
<ol>
<li><strong>扩展旅游札记生成器</strong>：增加更多的风格选项和导出格式，支持视频游记的生成，让旅行记忆的保存和分享更加丰富多样。作为前端开发者，我将重点优化用户界面和交互体验，采用现代前端框架构建响应式布局，确保在各种设备上都能提供出色的用户体验。同时，我将探索整合更多MCP服务，如视频处理MCP、社交媒体分享MCP等，为应用添加更多高级特性。</li>
<li><strong>开发教育辅助工具</strong>：利用AI技术和MCP服务，开发能够根据学生特点和学习进度，自动生成个性化学习计划和辅导内容的教育工具。在前端实现上，我将采用组件化开发方式，构建可复用的教育组件库，支持多种学习场景和交互模式。同时，我将整合教育内容MCP、学习分析MCP等专业服务，提升工具的教育价值。</li>
<li><strong>探索虚拟现实应用</strong>：结合VR技术和MCP服务，开发沉浸式的游戏和应用，为用户带来更加真实和震撼的体验。作为前端开发者，我将利用Three.js等3D库，实现WebVR/AR应用，探索前端技术在虚拟现实领域的应用潜力。同时，我将整合空间计算MCP、虚拟场景MCP等专业服务，提升VR/AR应用的质量和体验。</li>
<li><strong>构建前端组件库</strong>：基于TRAE的VibeCoding能力和MCP服务，开发一套完整的前端组件库，包含常用的UI组件和交互模式，支持主题定制和响应式设计，为前端开发提供更加高效的工具。我将特别关注组件库与MCP服务的集成，让开发者能够通过简单的配置，为组件添加智能特性，如表单验证、数据可视化等。</li>
<li><strong>参与开源项目</strong>：将自己的VibeCoding和MCP使用经验分享给社区，与其他开发者共同推动VibeCoding和MCP的发展。特别是在前端领域，我希望能够贡献更多基于TRAE和MCP的前端开发工具和最佳实践，帮助其他前端开发者提高开发效率。我计划创建一个开源的MCP前端集成库，简化前端开发者使用MCP服务的流程。</li>
<li><strong>探索前端与AI的结合</strong>：利用TRAE的AI能力和MCP服务，探索前端开发与人工智能的深度结合，开发能够根据用户行为和偏好自动调整界面和功能的智能前端应用，为用户提供更加个性化的体验。我将整合用户行为分析MCP、个性化推荐MCP等服务，构建智能前端应用的技术框架。</li>
<li><strong>MCP服务开发</strong>：尝试开发自己的MCP服务，专注于解决前端开发中的特定问题，如高性能动画、智能表单、实时协作等。通过开发MCP服务，我希望能够更深入地理解MCP的技术架构和工作原理，为前端开发社区贡献更多有价值的工具和服务。</li>
</ol>
<p>同时，我也期待看到更多开发者加入VibeCoding的行列，通过TRAE释放创意，共同创造一个更加丰富多彩的数字世界。</p>
<h2 data-id="heading-27">五、结语</h2>
<p>2025年，是我与TRAE和MCP结缘的一年，也是我创意迸发的一年。从旅游札记生成器到游戏开发，从生活助手到社交管理工具，TRAE与MCP的组合陪伴我走过了一段充满惊喜和成就的技术探索之旅。</p>
<h3 data-id="heading-28">我的VibeCoding与MCP之旅</h3>
<p>对我个人而言，2025年的VibeCoding与MCP之旅是一次自我突破和成长的过程。作为一名前端开发者，我不仅开发了多个有趣实用的项目，也发现了自己在创意设计和问题解决方面的潜力。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/89ed48e5322846d7a023e8481f8ce421~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6byT5o6MTVZQ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769949930&amp;x-signature=spTtsqVWbQfekWyVGvFgAHNEj0Y%3D" alt="请在此添加图片描述" loading="lazy"/></p>
<p>技术的魅力在于它能够让生活变得更加美好，而TRAE和MCP正是这样一对能够赋能创意、简化开发的神奇组合。TRAE提供了智能的对话式编程环境，让创意表达更加自然和直观；MCP提供了丰富的技术服务，让创意实现更加高效和强大。</p>
<p>我回顾我这一年TRAE的总结报告，获得了“执剑人”评价。倒也十分贴切！</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/061e5c889f0d48b186057300cec12ddd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6byT5o6MTVZQ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769949930&amp;x-signature=ZsyYX%2BDqLBuPZUUEDHG3g%2BQ%2BZao%3D" alt="请在此添加图片描述" loading="lazy"/></p>
<p>2025年，与TRAE和MCP的故事已经成为我人生中一段美好的回忆；而未来，更多与TRAE和MCP的精彩故事正在等待着我去书写。</p>
<h3 data-id="heading-29">未来的展望</h3>
<p>我相信，在未来的日子里，TRAE和MCP将继续进化，为开发者带来更加强大和智能的开发体验。VibeCoding将成为主流的编程方式，而MCP将成为技术整合的标准实践，两者的结合将彻底改变软件开发的格局。</p>
<p>作为一名前端开发者，我期待着在VibeCoding和MCP的道路上继续探索，开发更多有意义的项目，为前端开发社区贡献自己的力量。我也期待着与更多志同道合的伙伴相遇，共同探索技术的无限可能，创造一个更加美好的数字未来。</p>
<p>技术的进步永无止境，创意的表达也永无止境。有了TRAE和MCP，我们每个人都可以成为数字世界的建设者，用创意和技术共同创造一个更加丰富多彩的未来。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[LeetCode 28. 找出字符串中第一个匹配项的下标：两种实现与深度解析]]></title>    <link>https://juejin.cn/post/7599268297201811494</link>    <guid>https://juejin.cn/post/7599268297201811494</guid>    <pubDate>2026-01-25T12:52:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599268297201811494" data-draft-id="7598807837867802650" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="LeetCode 28. 找出字符串中第一个匹配项的下标：两种实现与深度解析"/> <meta itemprop="keywords" content="前端,TypeScript,算法"/> <meta itemprop="datePublished" content="2026-01-25T12:52:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Wect"/> <meta itemprop="url" content="https://juejin.cn/user/4185164878720068"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            LeetCode 28. 找出字符串中第一个匹配项的下标：两种实现与深度解析
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4185164878720068/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Wect
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-25T12:52:46.000Z" title="Sun Jan 25 2026 12:52:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"「";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"」";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"✓";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><p>在字符串处理领域，“子串匹配”是经典基础问题，LeetCode 28 题就围绕这一核心展开。题目要求在主串 <code>haystack</code> 中找到子串 <code>needle</code> 第一个匹配项的起始下标，若不存在则返回 -1。这道题不仅考察对字符串遍历的基础理解，更能延伸出高效算法的设计思路。本文将详细解析两种实现方案：优化后的暴力匹配法与经典的 KMP 算法，带你从基础到进阶吃透这道题。</p>
<h2 data-id="heading-0">一、题目核心解读</h2>
<h3 data-id="heading-1">1. 题目边界条件</h3>
<ul>
<li>
<p>若 <code>needle</code> 为空字符串，按行业惯例返回 0（虽题目输入可能不包含此情况，但代码需兼容）；</p>
</li>
<li>
<p>若 <code>haystack</code> 长度小于 <code>needle</code>，直接返回 -1（长度不足无法匹配）；</p>
</li>
<li>
<p>匹配需严格连续，返回第一个完全匹配子串的起始下标。</p>
</li>
</ul>
<h3 data-id="heading-2">2. 示例场景</h3>
<ul>
<li>
<p>输入：<code>haystack = "sadbutsad", needle = "sad"</code>，输出：0（子串从下标 0 开始匹配）；</p>
</li>
<li>
<p>输入：<code>haystack = "leetcode", needle = "leeto"</code>，输出：-1（无匹配子串）；</p>
</li>
<li>
<p>输入：<code>haystack = "abcdabcdabcdef", needle = "abcdabcdabcdef"</code>，输出：4（需跨部分匹配后复用前缀）。</p>
</li>
</ul>
<h2 data-id="heading-3">二、实现方案一：优化后的暴力匹配法（单循环版）</h2>
<h3 data-id="heading-4">1. 代码实现</h3>
<pre><code class="hljs language-typescript" lang="typescript">
<span class="hljs-keyword">function</span> <span class="hljs-title function_">strStr_1</span>(<span class="hljs-params">haystack: <span class="hljs-built_in">string</span>, needle: <span class="hljs-built_in">string</span></span>): <span class="hljs-built_in">number</span> {
  <span class="hljs-keyword">const</span> hL = haystack.<span class="hljs-property">length</span>;
  <span class="hljs-keyword">const</span> nL = needle.<span class="hljs-property">length</span>;
  <span class="hljs-keyword">if</span> (nL === <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
  <span class="hljs-keyword">if</span> (hL &lt; nL) <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>;

  <span class="hljs-keyword">let</span> resIndex = -<span class="hljs-number">1</span>;
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; hL; i++) {
    <span class="hljs-keyword">if</span> (resIndex !== -<span class="hljs-number">1</span>) {
      <span class="hljs-comment">// 当前匹配的位置（相对于needle的下标）</span>
      <span class="hljs-keyword">const</span> matchPos = i - resIndex;
      <span class="hljs-comment">// 若已匹配完needle所有字符，提前终止</span>
      <span class="hljs-keyword">if</span> (matchPos &gt;= nL) <span class="hljs-keyword">break</span>;
      <span class="hljs-comment">// 字符不匹配，回退i并重置匹配状态</span>
      <span class="hljs-keyword">if</span> (haystack[i] !== needle[matchPos]) {
        i = resIndex;
        resIndex = -<span class="hljs-number">1</span>;
      }
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-comment">// 找到匹配起始字符，记录起始下标</span>
      <span class="hljs-keyword">if</span> (haystack[i] === needle[<span class="hljs-number">0</span>]) {
        resIndex = i;
      }
    }
  }
  <span class="hljs-comment">// 最终校验：确保匹配长度足够</span>
  <span class="hljs-keyword">return</span> (resIndex !== -<span class="hljs-number">1</span> &amp;&amp; (hL - resIndex) &gt;= nL) ? resIndex : -<span class="hljs-number">1</span>;
};
</code></pre>
<h3 data-id="heading-5">2. 核心逻辑解析</h3>
<p>该方法试图用单循环完成匹配，核心思路是“记录起始匹配下标，逐字符验证，失败则回退”：</p>
<ul>
<li>
<p><code>resIndex</code>：存储潜在的匹配起始下标，初始为 -1（无潜在匹配）；</p>
</li>
<li>
<p>当 <code>resIndex !== -1</code> 时，说明正处于匹配验证阶段，通过 <code>matchPos = i - resIndex</code> 计算当前验证的是 <code>needle</code> 的第几个字符；</p>
</li>
<li>
<p>若验证失败，将 <code>i</code> 回退到 <code>resIndex</code>（利用 for 循环的<code>i++</code>，实际下一轮从 <code>resIndex + 1</code> 开始，避免重复遍历），同时重置 <code>resIndex</code>；</p>
</li>
<li>
<p>循环结束后，需校验 <code>resIndex</code>对应的子串长度是否足够（避免末尾部分匹配但长度不足的情况）。</p>
</li>
</ul>
<h3 data-id="heading-6">3. 优劣分析</h3>
<p><strong>优点</strong>：空间复杂度 O(1)，无额外空间开销，实现逻辑直观，适合短字符串场景；</p>
<p><strong>缺点</strong>：时间复杂度仍为 O(n*m)（n 为 <code>haystack</code> 长度，m 为 <code>needle</code> 长度），最坏情况下（如主串和子串均为大量重复字符，如 "aaaaa...a"）会有大量重复比较，效率较低。</p>
<h2 data-id="heading-7">三、实现方案二：KMP 算法（高效子串匹配）</h2>
<p>KMP 算法是解决子串匹配问题的经典高效算法，核心优势是通过预处理子串，让主串指针永不回退，将时间复杂度优化至 O(n+m)，适合长字符串或高频匹配场景。</p>
<h3 data-id="heading-8">1. 核心原理铺垫：最长相等前后缀（LPS 数组）</h3>
<p>KMP 算法的核心是利用子串 <code>needle</code> 自身的前后缀规律，构建 <strong>LPS 数组</strong>（最长相等前后缀数组）：</p>
<ul>
<li>
<p>前缀：子串中不包含最后一个字符的所有开头子串（如 "ABCD" 的前缀为 "A"、"AB"、"ABC"）；</p>
</li>
<li>
<p>后缀：子串中不包含第一个字符的所有结尾子串（如 "ABCD" 的后缀为 "D"、"CD"、"BCD"）；</p>
</li>
<li>
<p>最长相等前后缀长度：对于子串的前 k 个字符，前缀和后缀中长度最长且内容完全相同的子串长度（若无则为 0）。</p>
</li>
</ul>
<p>LPS 数组的作用：当匹配失败时，告诉我们<code>needle</code> 的指针应回退到哪个位置，而非从头开始，从而复用已匹配的前缀部分。</p>
<h3 data-id="heading-9">2. 代码实现</h3>
<pre><code class="hljs language-typescript" lang="typescript">
<span class="hljs-keyword">function</span> <span class="hljs-title function_">strStr_2</span>(<span class="hljs-params">haystack: <span class="hljs-built_in">string</span>, needle: <span class="hljs-built_in">string</span></span>): <span class="hljs-built_in">number</span> {
  <span class="hljs-keyword">const</span> hLen = haystack.<span class="hljs-property">length</span>;
  <span class="hljs-keyword">const</span> nLen = needle.<span class="hljs-property">length</span>;

  <span class="hljs-keyword">if</span> (nLen === <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
  <span class="hljs-keyword">if</span> (hLen &lt; nLen) <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>;

  <span class="hljs-comment">// 构建LPS数组（最长相等前后缀数组）</span>
  <span class="hljs-keyword">const</span> buildLPS = (<span class="hljs-attr">s</span>: <span class="hljs-built_in">string</span>): <span class="hljs-built_in">number</span>[] =&gt; {
    <span class="hljs-keyword">const</span> len = s.<span class="hljs-property">length</span>;
    <span class="hljs-keyword">const</span> lps = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(len).<span class="hljs-title function_">fill</span>(<span class="hljs-number">0</span>);
    <span class="hljs-keyword">let</span> prevLPS = <span class="hljs-number">0</span>; <span class="hljs-comment">// 前一个位置的最长相等前后缀长度</span>
    <span class="hljs-keyword">let</span> i = <span class="hljs-number">1</span>; <span class="hljs-comment">// 从第二个字符开始遍历（第一个字符LPS必为0）</span>

    <span class="hljs-keyword">while</span> (i &lt; len) {
      <span class="hljs-keyword">if</span> (s[i] === s[prevLPS]) {
        <span class="hljs-comment">// 字符匹配，延长最长相等前后缀长度</span>
        prevLPS++;
        lps[i] = prevLPS;
        i++;
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">if</span> (prevLPS !== <span class="hljs-number">0</span>) {
          <span class="hljs-comment">// 不匹配且prevLPS&gt;0，回退prevLPS（核心复用逻辑）</span>
          prevLPS = lps[prevLPS - <span class="hljs-number">1</span>];
        } <span class="hljs-keyword">else</span> {
          <span class="hljs-comment">// prevLPS=0，无匹配前缀，LPS[i]设为0</span>
          lps[i] = <span class="hljs-number">0</span>;
          i++;
        }
      }
    }
    <span class="hljs-keyword">return</span> lps;
  };

  <span class="hljs-keyword">const</span> lps = <span class="hljs-title function_">buildLPS</span>(needle);
  <span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; <span class="hljs-comment">// haystack指针（永不回退）</span>
  <span class="hljs-keyword">let</span> j = <span class="hljs-number">0</span>; <span class="hljs-comment">// needle指针（按LPS回退）</span>

  <span class="hljs-keyword">while</span> (i &lt; hLen) {
    <span class="hljs-keyword">if</span> (haystack[i] === needle[j]) {
      <span class="hljs-comment">// 字符匹配，双指针前进</span>
      i++;
      j++;
      <span class="hljs-comment">// j到达needle末尾，匹配成功，返回起始下标</span>
      <span class="hljs-keyword">if</span> (j === nLen) {
        <span class="hljs-keyword">return</span> i - j;
      }
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">if</span> (j !== <span class="hljs-number">0</span>) {
        <span class="hljs-comment">// 匹配失败，j按LPS回退（复用前缀）</span>
        j = lps[j - <span class="hljs-number">1</span>];
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// j=0，无匹配前缀，仅前进主串指针</span>
        i++;
      }
    }
  }

  <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>;
};
</code></pre>
<h3 data-id="heading-10">3. 关键步骤拆解</h3>
<h4 data-id="heading-11">（1）LPS 数组构建过程</h4>
<p>以 <code>needle = "abcdabcdabcdef"</code>为例，构建的 LPS 数组为 <code>[0,0,0,0,1,2,3,4,5,6,7,8,0,0]</code>：</p>
<ul>
<li>
<p>下标 4（字符 'a'）：前 4 个字符 "abcd" 的前缀与当前字符匹配，LPS[4] = 1；</p>
</li>
<li>
<p>下标 11（字符 'd'）：前 11 个字符 "abcdabcdabc" 的最长相等前后缀为 "abcdabcd"（长度 8），LPS[11] = 8；</p>
</li>
<li>
<p>下标 12（字符 'e'）：无相等前后缀，LPS[12] = 0。</p>
</li>
</ul>
<h4 data-id="heading-12">（2）核心匹配逻辑</h4>
<p>以示例 <code>haystack = "abcdabcdabcdabcdef", needle = "abcdabcdabcdef"</code> 为例：</p>
<ol>
<li>
<p>初始匹配：i、j 从 0 开始，连续匹配到 i=12、j=12 时，<code>haystack[12] = 'a'</code> 与 <code>needle[12] = 'e'</code> 不匹配；</p>
</li>
<li>
<p>回退操作：j=12≠0，执行 <code>j = lps[11] = 8</code>（复用前 11 个字符的最长前缀 "abcdabcd"）；</p>
</li>
<li>
<p>继续匹配：i=12 与 j=8 匹配（均为 'a'），后续双指针连续前进，直至 j=14（等于 needle 长度 14），返回 <code>i-j = 18-14 = 4</code>，匹配成功。</p>
</li>
</ol>
<h3 data-id="heading-13">4. 优劣分析</h3>
<p><strong>优点</strong>：时间复杂度 O(n+m)，主串和子串仅需遍历一次；主串指针永不回退，避免重复比较，长字符串场景下效率远超暴力匹配；</p>
<p><strong>缺点</strong>：逻辑较复杂，需额外构建 LPS 数组（空间复杂度 O(m)），适合对性能有要求的场景，简单场景下不如暴力匹配直观。</p>
<h2 data-id="heading-14">四、两种方案对比与选型建议</h2>





























<table><thead><tr><th>方案</th><th>时间复杂度</th><th>空间复杂度</th><th>优点</th><th>缺点</th><th>适用场景</th></tr></thead><tbody><tr><td>优化暴力匹配</td><td>O(n*m)</td><td>O(1)</td><td>实现简单、无额外空间开销</td><td>最坏情况效率低</td><td>短字符串、日常简单业务场景</td></tr><tr><td>KMP 算法</td><td>O(n+m)</td><td>O(m)</td><td>高效、长字符串表现优异</td><td>逻辑复杂、需理解 LPS 数组</td><td>长字符串、高频匹配、性能敏感场景</td></tr></tbody></table>
<h2 data-id="heading-15">五、常见问题与注意事项</h2>
<h3 data-id="heading-16">1. 暴力匹配的回退陷阱</h3>
<p>原暴力匹配若不回退 <code>i</code>，会导致跳过部分字符（如匹配 "hello" 和 "ll" 时可能漏匹配）。优化后通过 <code>i = resIndex</code> 配合 for 循环的 <code>i++</code>，实现正确回退，避免漏判。</p>
<h3 data-id="heading-17">2. KMP 中 j 回退的核心逻辑</h3>
<p>代码中 <code>j = lps[j - 1]</code> 是关键：当 <code>needle[j]</code> 匹配失败时，<code>lps[j-1]</code> 是 <code>needle[0..j-1]</code> 的最长相等前后缀长度，将 j 设为该值，即可复用已匹配的前缀部分，无需从头开始。</p>
<h3 data-id="heading-18">3. 边界条件不可遗漏</h3>
<p>无论哪种方案，都需优先处理 <code>needle</code> 为空、主串长度小于子串的情况，避免后续无效计算或数组越界。</p>
<h2 data-id="heading-19">六、总结</h2>
<p>LeetCode 28 题看似简单，却能串联起基础遍历与高效算法的设计思路。优化后的暴力匹配法适合快速实现与简单场景，而 KMP 算法则展现了“利用数据自身规律优化性能”的核心思想——通过预处理子串的前后缀信息，将时间复杂度从 O(n*m) 降至线性级别。</p>
<p>在实际开发中，若业务场景以短字符串为主，暴力匹配足够高效；若需处理大量长文本匹配（如日志分析、文本检索），KMP 算法是更优选择。掌握这两种方案，不仅能顺利解决本题，更能为复杂字符串处理问题打下基础。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[JavaScript 原型链机制深度解析：从构造函数到隐式委托]]></title>    <link>https://juejin.cn/post/7598737609494364179</link>    <guid>https://juejin.cn/post/7598737609494364179</guid>    <pubDate>2026-01-25T13:15:51.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598737609494364179" data-draft-id="7598744870995443755" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" JavaScript 原型链机制深度解析：从构造函数到隐式委托"/> <meta itemprop="keywords" content="前端,JavaScript"/> <meta itemprop="datePublished" content="2026-01-25T13:15:51.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="NEXT06"/> <meta itemprop="url" content="https://juejin.cn/user/1176918763246011"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             JavaScript 原型链机制深度解析：从构造函数到隐式委托
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1176918763246011/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    NEXT06
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-25T13:15:51.000Z" title="Sun Jan 25 2026 13:15:51 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在 JavaScript 的设计哲学中，<strong>原型（Prototype）</strong>  是其面向对象系统的基石。与 Java 或 C++ 等基于类（Class）的语言不同，JavaScript 并不通过复制“蓝图”来创建对象，而是通过<strong>委托（Delegation）</strong>  机制将对象连接在一起。</p>
<p>本文将基于一系列实战代码，从内存管理的角度出发，深入剖析构造函数、原型对象与实例之间的三角关系，揭示原型链查找的底层逻辑，并探讨继承机制的演变。</p>
<p>这张图先放在这里，现在不懂没关系，待会儿你会划上来的
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bdabdf061a8a48f093c0b66322edcefe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTkVYVDA2:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769951751&amp;x-signature=xJq7nHWNRBDT5PTdxkhB%2FuA1RHU%3D" alt="屏幕截图 2026-01-25 174707.png" loading="lazy"/></p>
<h2 data-id="heading-0">第一章：起源——构造函数的内存困境</h2>
<p>在 ES5 时代，我们通过构造函数来模拟“类”的概念。构造函数的核心作用是初始化新对象的属性。</p>
<h3 data-id="heading-1">1.1 私有属性与方法的内存开销</h3>
<p>请看以下代码示例</p>
<p>JavaScript</p>
<pre><code class="hljs language-ini" lang="ini">function Car(color) {
    // 实例属性：每个对象独享一份内存
    <span class="hljs-attr">this.color</span> = color<span class="hljs-comment">; </span>
    
    // 假设我们将方法直接写在构造函数内部（不推荐）
    // <span class="hljs-attr">this.drive</span> = function() {
    //     console.log('drive, 下赛道')<span class="hljs-comment">;</span>
    // }
}

const <span class="hljs-attr">car1</span> = new Car(<span class="hljs-string">'霞光紫'</span>)<span class="hljs-comment">;</span>
const <span class="hljs-attr">car2</span> = new Car(<span class="hljs-string">'海湾蓝'</span>)<span class="hljs-comment">;</span>
</code></pre>
<p>如果在构造函数内部定义 drive 方法，每次执行 new Car() 时，JavaScript 引擎都会在内存中创建一个新的函数实例。这意味着 car1.drive 和 car2.drive 虽然功能相同，但在内存中是两个完全不同的地址。对于成千上万个实例而言，这是极大的内存浪费。</p>
<h3 data-id="heading-2">1.2 Prototype：共享内存的解决方案</h3>
<p>为了解决上述问题，JavaScript 引入了 prototype 属性。它是函数对象特有的属性，用于存放所有实例<strong>共享</strong>的方法和属性。</p>
<p>JavaScript</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 资料来源：1.js</span>
<span class="hljs-comment">// 将公共方法挂载到 prototype 上</span>
<span class="hljs-title class_">Car</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = {
    <span class="hljs-attr">drive</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'drive, 下赛道'</span>);
    },
    <span class="hljs-attr">name</span>: <span class="hljs-string">'su7'</span>,
    <span class="hljs-attr">long</span>: <span class="hljs-number">4800</span>
};

<span class="hljs-keyword">const</span> car1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Car</span>(<span class="hljs-string">'霞光紫'</span>);
car1.<span class="hljs-title function_">drive</span>(); <span class="hljs-comment">// 调用的是 Car.prototype 上的方法</span>
</code></pre>
<p>此时，无论创建多少个 Car 实例，drive 方法在内存中只存在一份。实例通过一种隐式的链接访问该方法。这便是原型机制诞生的初衷：<strong>通过共享来优化资源</strong>。</p>
<hr/>
<h2 data-id="heading-3">第二章：三角关系——构造函数、实例与原型对象</h2>
<p>理解 JavaScript 面向对象的关键，在于理清构造函数（Constructor）、原型（Prototype）和实例（Instance）三者之间的关系。</p>
<h3 data-id="heading-4">2.1 核心概念界定</h3>
<ol>
<li>
<p><strong>prototype（显式原型）</strong> ：</p>
<ul>
<li><strong>归属</strong>：只有<strong>函数</strong>（构造函数）才拥有此属性。</li>
<li><strong>作用</strong>：作为新创建实例的公共祖先（基因库）。</li>
</ul>
</li>
<li>
<p><strong><strong>proto</strong>（隐式原型）</strong> ：</p>
<ul>
<li><strong>归属</strong>：所有<strong>对象</strong>（包括实例、函数、原型对象本身）都拥有此属性（现代标准推荐使用 Object.getPrototypeOf，但 <strong>proto</strong> 依然广泛存在于调试与旧代码中）。</li>
<li><strong>作用</strong>：它是连接对象与原型的“链条”，指向创建该对象的构造函数的 prototype。</li>
</ul>
</li>
<li>
<p><strong>constructor</strong>：</p>
<ul>
<li><strong>归属</strong>：原型对象默认拥有的属性。</li>
<li><strong>作用</strong>：记录“我是由谁创造的”，指向构造函数本身。</li>
</ul>
</li>
</ol>
<h3 data-id="heading-5">2.2 终极公式与关系图</h3>
<p>我们可以得出一个铁律公式：</p>
<p>JavaScript</p>
<pre><code class="hljs language-diff" lang="diff">// 实例的隐式原型 <span class="hljs-comment">=== 构造函数的显式原型</span>
instance.__proto__ <span class="hljs-comment">=== Constructor.prototype</span>
</code></pre>
<p>我们可以通过以下字符图来可视化这种关系：</p>
<p>Text</p>
<pre><code class="hljs language-sql" lang="sql">构造函数 (Person)
              <span class="hljs-operator">+</span><span class="hljs-comment">-----------------+</span>
              <span class="hljs-operator">|</span> prototype       <span class="hljs-operator">|</span> <span class="hljs-comment">---------------------&gt; +-----------------------+</span>
              <span class="hljs-operator">|</span>                 <span class="hljs-operator">|</span>                        <span class="hljs-operator">|</span> Person.prototype      <span class="hljs-operator">|</span>
              <span class="hljs-operator">+</span><span class="hljs-comment">-----------------+ &lt;--------------------- | constructor           |</span>
                       <span class="hljs-operator">^</span>                                 <span class="hljs-operator">|</span> sayHi() <span class="hljs-operator">/</span> species     <span class="hljs-operator">|</span>
                       <span class="hljs-operator">|</span> (<span class="hljs-keyword">new</span> 操作)                       <span class="hljs-operator">+</span><span class="hljs-comment">-----------------------+</span>
                       <span class="hljs-operator">|</span>                                           <span class="hljs-operator">^</span>
              <span class="hljs-operator">+</span><span class="hljs-comment">-----------------+                                  |</span>
              <span class="hljs-operator">|</span> 实例 (su)        <span class="hljs-operator">|</span>                                  <span class="hljs-operator">|</span>
              <span class="hljs-operator">|</span> __proto__       <span class="hljs-operator">|</span> <span class="hljs-comment">---------------------------------+</span>
              <span class="hljs-operator">+</span><span class="hljs-comment">-----------------+</span>
</code></pre>
<p>代码验证：</p>
<p>JavaScript</p>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">su</span> = new Person(<span class="hljs-string">'舒老板'</span>, <span class="hljs-number">19</span>)<span class="hljs-comment">;</span>
console.log(<span class="hljs-attr">su.__proto__</span> === Person.prototype)<span class="hljs-comment">; // true</span>
console.log(<span class="hljs-attr">Person.prototype.constructor</span> === Person)<span class="hljs-comment">; // true</span>
</code></pre>
<hr/>
<h2 data-id="heading-6">第三章：链式查找——原型链的本质</h2>
<p>当我们访问一个对象的属性时，JavaScript 引擎会启动一套严格的查找机制（Look-up）。</p>
<h3 data-id="heading-7">3.1 查找规则：向上委托</h3>
<p>查找过程如下：</p>
<ol>
<li><strong>自身查找</strong>：检查对象实例本身（su）是否拥有该属性。</li>
<li><strong>原型委托</strong>：如果没有，顺着 su.<strong>proto</strong> 找到 Person.prototype 继续查找。</li>
<li><strong>层层上溯</strong>：如果 Person.prototype 也没有，继续顺着 Person.prototype.<strong>proto</strong>（即 Object.prototype）查找。</li>
<li><strong>终点</strong>：如果 Object.prototype 也没有，查找 Object.prototype.<strong>proto</strong>，结果为 null，停止查找并返回 undefined。</li>
</ol>
<p>JavaScript</p>
<pre><code class="hljs language-ini" lang="ini">var <span class="hljs-attr">obj</span> = {}<span class="hljs-comment">; </span>
console.log(obj.__proto__.toString())<span class="hljs-comment">; </span>
// 输出 <span class="hljs-section">[object Object]</span>，该方法来自于 Object.prototype
</code></pre>
<h3 data-id="heading-8">3.2 属性遮蔽（Shadowing）</h3>
<p>一个常见的误区是认为修改实例属性会影响原型。实际上，JavaScript 的<strong>读</strong>与<strong>写</strong>操作在原型链上的行为是不同的。</p>
<p>JavaScript</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">Person.prototype.species</span> = <span class="hljs-string">'人类'</span><span class="hljs-comment">;</span>
var <span class="hljs-attr">su</span> = new Person(<span class="hljs-string">'舒老板'</span>, <span class="hljs-number">19</span>)<span class="hljs-comment">;</span>

// "写"操作：直接在实例 su 上创建新属性，不会向上查找
<span class="hljs-attr">su.species</span> = <span class="hljs-string">'LOL达人'</span><span class="hljs-comment">; </span>

console.log(su.species)<span class="hljs-comment">; // 输出 'LOL达人' (来自实例)</span>
console.log(su.__proto__.species)<span class="hljs-comment">; // 输出 '人类' (原型保持不变)</span>
</code></pre>
<p>这种现象称为<strong>属性遮蔽（Shadowing）</strong> 。实例上的同名属性会“挡住”原型上的属性，但不会修改原型本身。这体现了 JS 原型继承的哲学：<strong>它不是基于复制的（像传统类继承那样），而是基于委托的。</strong>  如果我自己有，我就用自己的；如果我没有，我才去问我的原型。</p>
<hr/>
<h2 data-id="heading-9">第四章：进阶陷阱——重写原型与 Constructor 的丢失</h2>
<p>在定义原型方法时，有两种常见的写法。新手往往因为图方便而陷入“重写原型”的陷阱。</p>
<h3 data-id="heading-10">4.1 增量添加（推荐）</h3>
<p>采用了安全的写法：</p>
<p>JavaScript</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">Person.prototype.species</span> = <span class="hljs-string">'人类'</span><span class="hljs-comment">;</span>
// 此时 Person.prototype.constructor 依然指向 Person
</code></pre>
<h3 data-id="heading-11">4.2 重写对象（危险）</h3>
<p>采用了覆盖写法：</p>
<p>JavaScript</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 危险操作：直接赋值一个新对象</span>
<span class="hljs-title class_">Person</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = {
    <span class="hljs-attr">species</span>: <span class="hljs-string">'人类'</span>,
    <span class="hljs-attr">sayHi</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {}
};
</code></pre>
<p><strong>后果</strong>：<br/>
原始的 Person.prototype 对象被完全丢弃，取而代之的是一个新的对象字面量 {}。<br/>
这个新对象的 constructor 属性不再指向 Person，而是指向根构造函数 Object。</p>
<p>JavaScript</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 资料来源：3.html</span>
<span class="hljs-keyword">var</span> su = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">'舒老板'</span>, <span class="hljs-number">19</span>);
<span class="hljs-comment">// 结果为 false，因为 constructor 链条断裂</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Person</span> == <span class="hljs-title class_">Person</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">constructor</span>); 
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Person</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">constructor</span>); <span class="hljs-comment">// 输出 Object</span>
</code></pre>
<p><strong>修正方案</strong>：<br/>
如果在实际开发中必须使用对象字面量赋值，必须手动修复 constructor：</p>
<p>JavaScript</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">Person.prototype</span> = {
    constructor: Person, // 手动指回
    species: '人类'
}<span class="hljs-comment">;</span>
</code></pre>
<hr/>
<h2 data-id="heading-12">第五章：继承的演变——从手动委托到 ES6 语法糖</h2>
<p>原型链最强大的应用在于实现继承。展示了在 ES6 class 出现之前，开发者是如何手动构建继承链的。</p>
<h3 data-id="heading-13">5.1 手动构建原型链</h3>
<p>我们希望 Person 继承 Animal 的属性。</p>
<p>JavaScript</p>
<pre><code class="hljs language-ini" lang="ini">var <span class="hljs-attr">obj</span> = new Object()<span class="hljs-comment">;</span>
<span class="hljs-attr">obj.species</span> = <span class="hljs-string">'动物'</span><span class="hljs-comment">;</span>

function Animal() {}
<span class="hljs-attr">Animal.prototype</span> = obj<span class="hljs-comment">; // Animal 继承自 obj</span>

function Person() {}
// 关键步骤：建立连接
// Person.prototype 变成了一个 Animal 的实例
// 因此 <span class="hljs-attr">Person.prototype.__proto__</span> === Animal.prototype
<span class="hljs-attr">Person.prototype</span> = new Animal()<span class="hljs-comment">; </span>

var <span class="hljs-attr">su</span> = new Person()<span class="hljs-comment">;</span>
console.log(su.species)<span class="hljs-comment">; // 输出 '动物'</span>
</code></pre>
<p><strong>原理解析</strong>：<br/>
查找路径为：su (无) -&gt; su.<strong>proto</strong> (即 Person.prototype, 无) -&gt; Person.prototype.<strong>proto</strong> (即 Animal.prototype/obj) -&gt; <strong>找到 '动物'</strong> 。</p>
<h3 data-id="heading-14">5.2 ES6 Class：语法的现代化</h3>
<p>提到了 ES6 的 class 写法。必须明确的是，JavaScript 的 class 只是<strong>语法糖（Syntactic Sugar）</strong> 。</p>
<p>JavaScript</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> {
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name</span>) { <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name; }
    <span class="hljs-title function_">sayHi</span>(<span class="hljs-params"/>) { ... }
}
</code></pre>
<p>其底层依然遵循原型链机制：</p>
<ul>
<li>class 声明的本质是构造函数。</li>
<li>类的方法依然被挂载在 prototype 上。</li>
<li>extends 关键字实际上是在执行类似 Person.prototype = Object.create(Animal.prototype) 的操作。</li>
</ul>
<hr/>
<h2 data-id="heading-15">技术总结</h2>
<ol>
<li><strong>构造函数</strong>负责处理对象的<strong>差异性</strong>（私有属性），<strong>原型对象</strong>负责处理对象的<strong>共性</strong>（共享方法）。</li>
<li><strong><strong>proto</strong></strong>  是对象寻找属性的“地图导线”，<strong>prototype</strong> 是函数提供的“公共资源库”。</li>
<li><strong>原型查找遵循就近原则</strong>：读取属性时沿链向上查找，写入属性时只操作实例自身（遮蔽效应）。</li>
<li><strong>慎重重写 Prototype</strong>：直接赋值 {...} 给 prototype 会导致 constructor 指向丢失，需手动修正。</li>
<li><strong>继承的本质是委托</strong>：JavaScript 的对象之间是通过引用链接的，而非传统面向对象语言中的代码复制。su 能访问 species，不是因为它拥有了 species，而是因为它被委托了访问权限。</li>
</ol>
<p>如果这篇文章有助于你理解原型链机制，就请您点个赞吧，谢谢</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[性能暴涨 1200 倍！我用 TypeScript 重构了这个经典项目]]></title>    <link>https://juejin.cn/post/7598574507347918883</link>    <guid>https://juejin.cn/post/7598574507347918883</guid>    <pubDate>2026-01-25T13:33:50.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598574507347918883" data-draft-id="7598563188112425012" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" 性能暴涨 1200 倍！我用 TypeScript 重构了这个经典项目"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-25T13:33:50.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员Soldier"/> <meta itemprop="url" content="https://juejin.cn/user/935056027688039"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             性能暴涨 1200 倍！我用 TypeScript 重构了这个经典项目
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/935056027688039/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员Soldier
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-25T13:33:50.000Z" title="Sun Jan 25 2026 13:33:50 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">中国亲戚关系计算器 TypeScript 重构版：性能暴涨 1200 倍，完美支持 React Native</h2>
<p>一个 LRU 缓存，让性能从 44 QPS 飙升到 54,000 QPS</p>
<blockquote>
<p>GitHub: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FExploringTheCodeWorld%2Frelationship-ts" target="_blank" title="https://github.com/ExploringTheCodeWorld/relationship-ts" ref="nofollow noopener noreferrer">github.com/ExploringTh…</a></p>
</blockquote>
<p>你是否也有过这样的经历？过年回家面对七大姑八大姨，却叫不上来对方该喊什么称呼？"中国家庭称谓计算器"这个项目就是为了解决这个问题而生的。</p>
<p>最近，我对这个经典项目进行了 <strong>TypeScript 重构优化</strong>，在保持功能完整的同时，实现了显著的性能提升和更好的兼容性。今天就来分享一下这次重构的亮点和收获。</p>
<h3 data-id="heading-1">为什么需要重构？</h3>
<h4 data-id="heading-2">起因：React Native 的"坑"</h4>
<p>在将原版 <code>relationship.js</code> 集成到 React Native 移动端应用时，遇到了一个棘手的报错：</p>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-keyword">ERROR</span> [RangeError: <span class="hljs-keyword">Property</span> storage exceeds <span class="hljs-number">196607</span> properties]
</code></pre>
<p>这是因为原版 JS 在初始化时创建了大量的对象属性，超出了 <strong>JavaScriptCore 引擎</strong> 的属性数量限制（约 196607 个）。</p>
<h4 data-id="heading-3">技术选型</h4>
<p>为了彻底解决这个问题，我决定从以下几个方向进行重构：</p>
<ol>
<li><strong>TypeScript 重写</strong> - 提供类型安全和更好的开发体验</li>
<li><strong>Map 替代 Object</strong> - 利用 Map 的特性优化数据存储</li>
<li><strong>LRU 缓存机制</strong> - 提升重复查询性能</li>
<li><strong>模块化架构</strong> - 更好的代码组织和 Tree Shaking 支持</li>
</ol>
<h3 data-id="heading-4">核心优化点</h3>
<h4 data-id="heading-5">1. 数据结构优化：Map vs Object</h4>
<p><strong>原版实现：</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 使用 Object 存储称谓映射</span>
<span class="hljs-keyword">const</span> cacheData = {
  <span class="hljs-string">'f'</span>: [<span class="hljs-string">'父亲'</span>, <span class="hljs-string">'老爸'</span>, <span class="hljs-string">'爹地'</span>],
  <span class="hljs-string">'m'</span>: [<span class="hljs-string">'母亲'</span>, <span class="hljs-string">'老妈'</span>, <span class="hljs-string">'妈咪'</span>],
  <span class="hljs-comment">// ... 数千个属性</span>
};
</code></pre>
<p><strong>TS 版本优化：</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">OptimizedCache</span> {
  <span class="hljs-keyword">private</span> <span class="hljs-attr">_titleToChain</span>: <span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-title class_">Chain</span>[]&gt; = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();
  <span class="hljs-keyword">private</span> <span class="hljs-attr">_chainToTitle</span>: <span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">string</span>[]&gt; = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();

  <span class="hljs-title function_">getTitleToChain</span>(<span class="hljs-attr">title</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">Chain</span>[] | <span class="hljs-literal">undefined</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_titleToChain</span>.<span class="hljs-title function_">get</span>(title);  <span class="hljs-comment">// O(1) 查找</span>
  }
}
</code></pre>
<p><strong>优势：</strong></p>
<ul>
<li>Map 提供 O(1) 的查找性能</li>
<li>避免了 Object 的属性数量限制</li>
<li>更好的内存管理</li>
</ul>
<h4 data-id="heading-6">2. LRU 缓存实现</h4>
<p>这是我这次重构最满意的部分之一。针对亲戚关系查询场景，大量查询是重复的（比如"爸爸的爸爸"这种高频查询），非常适合使用缓存。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LRUCache</span>&lt;K, V&gt; {
  <span class="hljs-keyword">private</span> <span class="hljs-attr">capacity</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-keyword">private</span> <span class="hljs-attr">cache</span>: <span class="hljs-title class_">Map</span>&lt;K, V&gt;;

  <span class="hljs-title function_">get</span>(<span class="hljs-attr">key</span>: K): V | <span class="hljs-literal">undefined</span> {
    <span class="hljs-keyword">const</span> value = <span class="hljs-variable language_">this</span>.<span class="hljs-property">cache</span>.<span class="hljs-title function_">get</span>(key);
    <span class="hljs-keyword">if</span> (value !== <span class="hljs-literal">undefined</span>) {
      <span class="hljs-comment">// 更新访问顺序：删除并重新插入 - O(1)</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">cache</span>.<span class="hljs-title function_">delete</span>(key);
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">cache</span>.<span class="hljs-title function_">set</span>(key, value);
    }
    <span class="hljs-keyword">return</span> value;
  }
}
</code></pre>
<p><strong>巧妙点：</strong> 利用 Map 的有序性（按插入顺序迭代），通过 <code>delete + set</code> 实现 O(1) 的访问顺序更新，无需额外的双向链表结构。</p>
<h4 data-id="heading-7">3. 分层缓存架构</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">QueryCache</span> {
  <span class="hljs-keyword">private</span> <span class="hljs-attr">selectorCache</span>: <span class="hljs-title class_">LRUCache</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">string</span>[]&gt;;   <span class="hljs-comment">// 中文转选择器</span>
  <span class="hljs-keyword">private</span> <span class="hljs-attr">idCache</span>: <span class="hljs-title class_">LRUCache</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">string</span>[]&gt;;         <span class="hljs-comment">// ID转中文</span>
  <span class="hljs-keyword">private</span> <span class="hljs-attr">chainCache</span>: <span class="hljs-title class_">LRUCache</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">string</span>&gt;;        <span class="hljs-comment">// 关系链缓存</span>
}
</code></pre>
<p>三个独立的缓存层，针对不同类型的查询结果进行缓存，互不干扰。</p>
<h4 data-id="heading-8">4. 类型安全</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">RelationshipOptions</span> {
  <span class="hljs-attr">text</span>: <span class="hljs-built_in">string</span>;           <span class="hljs-comment">// 目标对象的称谓</span>
  target?: <span class="hljs-built_in">string</span>;        <span class="hljs-comment">// 相对对象的称谓</span>
  sex?: -<span class="hljs-number">1</span> | <span class="hljs-number">0</span> | <span class="hljs-number">1</span>;      <span class="hljs-comment">// 本人性别：-1未知，0女性，1男性</span>
  <span class="hljs-keyword">type</span>?: <span class="hljs-string">'default'</span> | <span class="hljs-string">'chain'</span> | <span class="hljs-string">'pair'</span>;
  reverse?: <span class="hljs-built_in">boolean</span>;
  mode?: <span class="hljs-built_in">string</span>;
  optimal?: <span class="hljs-built_in">boolean</span>;
}
</code></pre>
<p>完整的 TypeScript 类型定义，开发时获得智能提示和类型检查。</p>
<h3 data-id="heading-9">性能基准测试</h3>
<h4 data-id="heading-10">测试环境</h4>
<ul>
<li><strong>Node.js</strong>: v22.12.0</li>
<li><strong>平台</strong>: Windows x64</li>
<li><strong>测试方法</strong>: 运行 10,000 次重复查询</li>
</ul>
<h4 data-id="heading-11">测试脚本</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">/**
 * 中国亲戚关系计算器性能测试脚本
 * 对比原版 JS 和 TypeScript 版本的性能
 */</span>

<span class="hljs-keyword">import</span> { performance } <span class="hljs-keyword">from</span> <span class="hljs-string">'perf_hooks'</span>;
<span class="hljs-keyword">import</span> fs <span class="hljs-keyword">from</span> <span class="hljs-string">'fs'</span>;

<span class="hljs-comment">// 测试用例 - 涵盖不同复杂度的查询</span>
<span class="hljs-keyword">const</span> testCases = [
  { <span class="hljs-attr">text</span>: <span class="hljs-string">'父亲'</span>, <span class="hljs-attr">desc</span>: <span class="hljs-string">'简单查询'</span> },
  { <span class="hljs-attr">text</span>: <span class="hljs-string">'爸爸的妈妈'</span>, <span class="hljs-attr">desc</span>: <span class="hljs-string">'两层关系'</span> },
  { <span class="hljs-attr">text</span>: <span class="hljs-string">'妈妈的妈妈的哥哥'</span>, <span class="hljs-attr">desc</span>: <span class="hljs-string">'三层关系'</span> },
  { <span class="hljs-attr">text</span>: <span class="hljs-string">'爸爸的哥哥的妻子的弟弟'</span>, <span class="hljs-attr">desc</span>: <span class="hljs-string">'复杂关系链'</span> },
  { <span class="hljs-attr">text</span>: <span class="hljs-string">'父亲的父亲的父亲的父亲'</span>, <span class="hljs-attr">desc</span>: <span class="hljs-string">'四层关系(缓存)'</span> },
];

<span class="hljs-comment">// 格式化数字</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">formatNumber</span>(<span class="hljs-params">num</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Intl</span>.<span class="hljs-title class_">NumberFormat</span>(<span class="hljs-string">'zh-CN'</span>).<span class="hljs-title function_">format</span>(num);
}

<span class="hljs-comment">// 格式化时间</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">formatTime</span>(<span class="hljs-params">ms</span>) {
  <span class="hljs-keyword">if</span> (ms &lt; <span class="hljs-number">0.001</span>) <span class="hljs-keyword">return</span> <span class="hljs-string">`<span class="hljs-subst">${(ms * <span class="hljs-number">1000000</span>).toFixed(<span class="hljs-number">2</span>)}</span> μs`</span>;
  <span class="hljs-keyword">if</span> (ms &lt; <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span> <span class="hljs-string">`<span class="hljs-subst">${(ms * <span class="hljs-number">1000</span>).toFixed(<span class="hljs-number">2</span>)}</span> ms`</span>;
  <span class="hljs-keyword">return</span> <span class="hljs-string">`<span class="hljs-subst">${ms.toFixed(<span class="hljs-number">2</span>)}</span> ms`</span>;
}

<span class="hljs-comment">// 获取文件大小</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">getFileSize</span>(<span class="hljs-params">filePath</span>) {
  <span class="hljs-keyword">const</span> stats = fs.<span class="hljs-title function_">statSync</span>(filePath);
  <span class="hljs-keyword">return</span> stats.<span class="hljs-property">size</span>;
}

<span class="hljs-comment">// 性能测试函数</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">runBenchmark</span>(<span class="hljs-params">name, relationshipFunc</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`\n<span class="hljs-subst">${<span class="hljs-string">'='</span>.repeat(<span class="hljs-number">60</span>)}</span>`</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`测试: <span class="hljs-subst">${name}</span>`</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'='</span>.<span class="hljs-title function_">repeat</span>(<span class="hljs-number">60</span>));

  <span class="hljs-keyword">const</span> results = {
    <span class="hljs-attr">coldStart</span>: [],
    <span class="hljs-attr">warmStart</span>: [],
    <span class="hljs-attr">queries</span>: {},
  };

  <span class="hljs-comment">// 预热 - 确保模块初始化</span>
  <span class="hljs-title function_">relationshipFunc</span>({ <span class="hljs-attr">text</span>: <span class="hljs-string">'父亲'</span> });

  <span class="hljs-comment">// 1. 冷启动测试 - 测试不同查询的首次性能</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'\n🔵 冷启动测试 (各查询类型的首次性能)...'</span>);
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> tc <span class="hljs-keyword">of</span> testCases) {
    <span class="hljs-keyword">const</span> times = [];
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">50</span>; i++) {
      <span class="hljs-comment">// 使用不同的查询来避免缓存</span>
      <span class="hljs-keyword">const</span> start = performance.<span class="hljs-title function_">now</span>();
       <span class="hljs-title function_">relationshipFunc</span>({ <span class="hljs-attr">text</span>: tc.<span class="hljs-property">text</span> + (i &gt; <span class="hljs-number">0</span> ? <span class="hljs-string">'的'</span> + <span class="hljs-string">'父亲'</span>.<span class="hljs-title function_">repeat</span>(i % <span class="hljs-number">3</span>) : <span class="hljs-string">''</span>) });
      <span class="hljs-keyword">const</span> end = performance.<span class="hljs-title function_">now</span>();
      times.<span class="hljs-title function_">push</span>(end - start);
    }
    <span class="hljs-keyword">const</span> avg = times.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> a + b, <span class="hljs-number">0</span>) / times.<span class="hljs-property">length</span>;
    results.<span class="hljs-property">queries</span>[tc.<span class="hljs-property">desc</span> + <span class="hljs-string">'(冷)'</span>] = avg;
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`   <span class="hljs-subst">${tc.desc.padEnd(<span class="hljs-number">20</span>)}</span>: <span class="hljs-subst">${formatTime(avg)}</span>`</span>);
  }

  <span class="hljs-comment">// 2. 热启动测试 - 重复同一查询（测试缓存效果）</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'\n🟢 热启动测试 (重复查询，命中缓存)...'</span>);
  <span class="hljs-keyword">const</span> warmQuery = <span class="hljs-string">'父亲的父亲的父亲的父亲'</span>;
  <span class="hljs-keyword">const</span> warmTimes = [];
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10000</span>; i++) {
    <span class="hljs-keyword">const</span> start = performance.<span class="hljs-title function_">now</span>();
     <span class="hljs-title function_">relationshipFunc</span>({ <span class="hljs-attr">text</span>: warmQuery });
    <span class="hljs-keyword">const</span> end = performance.<span class="hljs-title function_">now</span>();
    warmTimes.<span class="hljs-title function_">push</span>(end - start);
  }
  <span class="hljs-keyword">const</span> avgWarm = warmTimes.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> a + b, <span class="hljs-number">0</span>) / warmTimes.<span class="hljs-property">length</span>;
  <span class="hljs-keyword">const</span> minWarm = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(...warmTimes);
  <span class="hljs-keyword">const</span> maxWarm = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(...warmTimes);

  <span class="hljs-comment">// 排除异常值（取中位数附近）</span>
  <span class="hljs-keyword">const</span> sorted = [...warmTimes].<span class="hljs-title function_">sort</span>(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> a - b);
  <span class="hljs-keyword">const</span> medianWarm = sorted[<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(sorted.<span class="hljs-property">length</span> / <span class="hljs-number">2</span>)];

  results.<span class="hljs-property">avgWarm</span> = avgWarm;
  results.<span class="hljs-property">minWarm</span> = minWarm;
  results.<span class="hljs-property">maxWarm</span> = maxWarm;
  results.<span class="hljs-property">medianWarm</span> = medianWarm;
  results.<span class="hljs-property">qps</span> = <span class="hljs-number">1000</span> / medianWarm;

  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`   平均耗时: <span class="hljs-subst">${formatTime(avgWarm)}</span>`</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`   中位数耗时: <span class="hljs-subst">${formatTime(medianWarm)}</span> (去除异常值)`</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`   最小耗时: <span class="hljs-subst">${formatTime(minWarm)}</span>`</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`   最大耗时: <span class="hljs-subst">${formatTime(maxWarm)}</span>`</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`   QPS: <span class="hljs-subst">${formatNumber(<span class="hljs-number">1000</span> / medianWarm)}</span> req/s`</span>);

  <span class="hljs-keyword">return</span> results;
}

<span class="hljs-comment">// 主测试函数</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'\n'</span> + <span class="hljs-string">'█'</span>.<span class="hljs-title function_">repeat</span>(<span class="hljs-number">60</span>));
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'█'</span> + <span class="hljs-string">' '</span>.<span class="hljs-title function_">repeat</span>(<span class="hljs-number">20</span>) + <span class="hljs-string">'性能测试基准测试'</span> + <span class="hljs-string">' '</span>.<span class="hljs-title function_">repeat</span>(<span class="hljs-number">20</span>) + <span class="hljs-string">'█'</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'█'</span>.<span class="hljs-title function_">repeat</span>(<span class="hljs-number">60</span>));
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`\n📊 测试环境:`</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`   Node.js: <span class="hljs-subst">${process.version}</span>`</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`   平台: <span class="hljs-subst">${process.platform}</span> <span class="hljs-subst">${process.arch}</span>`</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`   热启动迭代: 10000 次`</span>);

  <span class="hljs-comment">// 包体积对比</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`\n📦 包体积对比:`</span>);
  <span class="hljs-keyword">const</span> jsSize = <span class="hljs-title function_">getFileSize</span>(<span class="hljs-string">'E:/github-project/relationship/dist/relationship.min.js'</span>);
  <span class="hljs-keyword">const</span> tsSize = <span class="hljs-title function_">getFileSize</span>(<span class="hljs-string">'E:/github-project/relationship-ts/dist/relationship.min.js'</span>);
  <span class="hljs-keyword">const</span> jsSizeKb = (jsSize / <span class="hljs-number">1024</span>).<span class="hljs-title function_">toFixed</span>(<span class="hljs-number">2</span>);
  <span class="hljs-keyword">const</span> tsSizeKb = (tsSize / <span class="hljs-number">1024</span>).<span class="hljs-title function_">toFixed</span>(<span class="hljs-number">2</span>);
  <span class="hljs-keyword">const</span> diff = ((tsSize - jsSize) / jsSize * <span class="hljs-number">100</span>).<span class="hljs-title function_">toFixed</span>(<span class="hljs-number">2</span>);

  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`   原版 (JS):     <span class="hljs-subst">${jsSizeKb}</span> KB (<span class="hljs-subst">${formatNumber(jsSize)}</span> bytes)`</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`   优化版 (TS):   <span class="hljs-subst">${tsSizeKb}</span> KB (<span class="hljs-subst">${formatNumber(tsSize)}</span> bytes)`</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`   差异:         <span class="hljs-subst">${diff &gt; <span class="hljs-number">0</span> ? <span class="hljs-string">'+'</span> : <span class="hljs-string">''</span>}</span><span class="hljs-subst">${diff}</span>%`</span>);

  <span class="hljs-comment">// 导入两个版本</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`\n📥 加载模块...`</span>);

  <span class="hljs-comment">// 分别导入两个版本</span>
  <span class="hljs-keyword">const</span> relationshipJS = (<span class="hljs-keyword">await</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'file:///E:/github-project/relationship/dist/relationship.min.mjs'</span>)).<span class="hljs-property">default</span>;
  <span class="hljs-keyword">const</span> relationshipTS = (<span class="hljs-keyword">await</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'file:///E:/github-project/relationship-ts/dist/relationship.min.mjs'</span>)).<span class="hljs-property">default</span>;

  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`   ✅ 原版 (JS) 加载完成`</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`   ✅ 优化版 (TS) 加载完成`</span>);

  <span class="hljs-comment">// 运行测试</span>
  <span class="hljs-keyword">const</span> jsResults = <span class="hljs-keyword">await</span> <span class="hljs-title function_">runBenchmark</span>(<span class="hljs-string">'原版 (relationship.js)'</span>, relationshipJS);
  <span class="hljs-keyword">const</span> tsResults = <span class="hljs-keyword">await</span> <span class="hljs-title function_">runBenchmark</span>(<span class="hljs-string">'优化版 (relationship-ts)'</span>, relationshipTS);

  <span class="hljs-comment">// 生成对比报告</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'\n'</span> + <span class="hljs-string">'='</span>.<span class="hljs-title function_">repeat</span>(<span class="hljs-number">60</span>));
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'📊 性能对比报告'</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'='</span>.<span class="hljs-title function_">repeat</span>(<span class="hljs-number">60</span>));

  <span class="hljs-comment">// 冷启动对比</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'\n🔵 冷启动对比 (首次查询，无缓存):'</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`   <span class="hljs-subst">${<span class="hljs-string">'查询类型'</span>.padEnd(<span class="hljs-number">20</span>)}</span> <span class="hljs-subst">${<span class="hljs-string">'原版'</span>.padEnd(<span class="hljs-number">15</span>)}</span> <span class="hljs-subst">${<span class="hljs-string">'优化版'</span>.padEnd(<span class="hljs-number">15</span>)}</span> <span class="hljs-subst">${<span class="hljs-string">'差异'</span>.padEnd(<span class="hljs-number">10</span>)}</span>`</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'   '</span> + <span class="hljs-string">'-'</span>.<span class="hljs-title function_">repeat</span>(<span class="hljs-number">60</span>));

  <span class="hljs-keyword">let</span> coldImprovements = [];
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> [desc, jsTime] <span class="hljs-keyword">of</span> <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">entries</span>(jsResults.<span class="hljs-property">queries</span>)) {
    <span class="hljs-keyword">if</span> (desc.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'(冷)'</span>)) {
      <span class="hljs-keyword">const</span> tsTime = tsResults.<span class="hljs-property">queries</span>[desc];
      <span class="hljs-keyword">const</span> improvement = ((jsTime - tsTime) / jsTime * <span class="hljs-number">100</span>);
      coldImprovements.<span class="hljs-title function_">push</span>(improvement);
      <span class="hljs-keyword">const</span> arrow = improvement &gt; <span class="hljs-number">0</span> ? <span class="hljs-string">'🚀'</span> : (improvement &lt; <span class="hljs-number">0</span> ? <span class="hljs-string">'📈'</span> : <span class="hljs-string">'➡️'</span>);
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`   <span class="hljs-subst">${desc.replace(<span class="hljs-string">'(冷)'</span>, <span class="hljs-string">''</span>).padEnd(<span class="hljs-number">20</span>)}</span> <span class="hljs-subst">${formatTime(jsTime).padEnd(<span class="hljs-number">15</span>)}</span> <span class="hljs-subst">${formatTime(tsTime).padEnd(<span class="hljs-number">15</span>)}</span> <span class="hljs-subst">${arrow}</span> <span class="hljs-subst">${(improvement &gt; <span class="hljs-number">0</span> ? <span class="hljs-string">'+'</span> : <span class="hljs-string">''</span>) + improvement.toFixed(<span class="hljs-number">1</span>)}</span>%`</span>);
    }
  }

  <span class="hljs-comment">// 热启动对比</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'\n🟢 热启动对比 (重复查询，命中 LRU 缓存):'</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`   原版中位数:    <span class="hljs-subst">${formatTime(jsResults.medianWarm)}</span>`</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`   优化版中位数:  <span class="hljs-subst">${formatTime(tsResults.medianWarm)}</span>`</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`   原版 QPS:      <span class="hljs-subst">${formatNumber(jsResults.qps)}</span> req/s`</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`   优化版 QPS:    <span class="hljs-subst">${formatNumber(tsResults.qps)}</span> req/s`</span>);

  <span class="hljs-keyword">const</span> warmImprovement = ((jsResults.<span class="hljs-property">medianWarm</span> - tsResults.<span class="hljs-property">medianWarm</span>) / jsResults.<span class="hljs-property">medianWarm</span> * <span class="hljs-number">100</span>);
  <span class="hljs-keyword">const</span> qpsImprovement = ((tsResults.<span class="hljs-property">qps</span> - jsResults.<span class="hljs-property">qps</span>) / jsResults.<span class="hljs-property">qps</span> * <span class="hljs-number">100</span>);
  <span class="hljs-keyword">const</span> speedup = (jsResults.<span class="hljs-property">medianWarm</span> / tsResults.<span class="hljs-property">medianWarm</span>).<span class="hljs-title function_">toFixed</span>(<span class="hljs-number">1</span>);

  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`   耗时减少:     <span class="hljs-subst">${warmImprovement &gt; <span class="hljs-number">0</span> ? warmImprovement.toFixed(<span class="hljs-number">1</span>) : <span class="hljs-string">'0'</span>}</span>%`</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`   QPS 提升:     <span class="hljs-subst">${qpsImprovement &gt; <span class="hljs-number">0</span> ? <span class="hljs-string">'+'</span> : <span class="hljs-string">''</span>}</span><span class="hljs-subst">${formatNumber(<span class="hljs-built_in">Math</span>.round(qpsImprovement))}</span>%`</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`   性能倍数:     🚀 <span class="hljs-subst">${speedup}</span>x 更快`</span>);

  <span class="hljs-comment">// 总结</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'\n'</span> + <span class="hljs-string">'='</span>.<span class="hljs-title function_">repeat</span>(<span class="hljs-number">60</span>));
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'📝 总结'</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'='</span>.<span class="hljs-title function_">repeat</span>(<span class="hljs-number">60</span>));

  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`
✅ 优化版主要改进:
   • 包体积:        <span class="hljs-subst">${diff.startsWith(<span class="hljs-string">'-'</span>) ? <span class="hljs-string">'⬇️ 减少 '</span> + <span class="hljs-built_in">Math</span>.abs(diff) + <span class="hljs-string">'%'</span> : <span class="hljs-string">'⬆️ 增加 '</span> + diff}</span>
   • 热启动性能:    🚀 <span class="hljs-subst">${speedup}</span>x 更快 (得益于 LRU 缓存机制)
   • QPS 提升:      <span class="hljs-subst">${qpsImprovement &gt; <span class="hljs-number">0</span> ? <span class="hljs-string">'+'</span> : <span class="hljs-string">''</span>}</span><span class="hljs-subst">${formatNumber(<span class="hljs-built_in">Math</span>.round(qpsImprovement))}</span>% (从 <span class="hljs-subst">${formatNumber(<span class="hljs-built_in">Math</span>.round(jsResults.qps))}</span> 到 <span class="hljs-subst">${formatNumber(<span class="hljs-built_in">Math</span>.round(tsResults.qps))}</span> req/s)
   • 类型安全:      ✅ 完整的 TypeScript 类型定义
   • 架构优化:      ✅ 模块化设计，更好的 Tree Shaking 支持
   • 兼容性:        ✅ 解决 React Native 属性存储超限问题
  `</span>);

  <span class="hljs-keyword">return</span> {
    jsSizeKb,
    tsSizeKb,
    diff,
    <span class="hljs-attr">jsQps</span>: jsResults.<span class="hljs-property">qps</span>,
    <span class="hljs-attr">tsQps</span>: tsResults.<span class="hljs-property">qps</span>,
    speedup,
    <span class="hljs-attr">jsMedian</span>: jsResults.<span class="hljs-property">medianWarm</span>,
    <span class="hljs-attr">tsMedian</span>: tsResults.<span class="hljs-property">medianWarm</span>,
  };
}

<span class="hljs-title function_">main</span>().<span class="hljs-title function_">catch</span>(<span class="hljs-variable language_">console</span>.<span class="hljs-property">error</span>);

</code></pre>
<h4 data-id="heading-12">测试结果</h4>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cb8eee4c72554fbc8d5102ce4a2effc6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYU29sZGllcg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769952830&amp;x-signature=XhW5LQqzRqKfQdHX6WYUU%2BnaI1g%3D" alt="image.png" loading="lazy"/></p>









































<table><thead><tr><th>指标</th><th>原版 (JS)</th><th>优化版 (TS)</th><th>提升</th></tr></thead><tbody><tr><td><strong>包体积</strong></td><td>81.60 KB</td><td><strong>77.17 KB</strong></td><td>⬇️ 5.4%</td></tr><tr><td><strong>热启动响应时间</strong></td><td>~23 ms</td><td><strong>~0.02 ms</strong></td><td>🚀 1200x</td></tr><tr><td><strong>热启动 QPS</strong></td><td>~44 req/s</td><td><strong>~54,000 req/s</strong></td><td>🚀 122,000%</td></tr><tr><td><strong>冷启动响应时间</strong></td><td>~23 ms</td><td>~30 ms</td><td>持平</td></tr><tr><td><strong>React Native</strong></td><td>⚠️ 属性溢出风险</td><td>✅ 完美支持</td><td>-</td></tr></tbody></table>
<p><strong>核心发现：</strong></p>
<ul>
<li>冷启动（首次查询）性能基本持平，因为都需要遍历数据</li>
<li>热启动（重复查询）性能提升 <strong>1200 倍</strong>，得益于 LRU 缓存机制</li>
<li>包体积减少 5.4%，虽然加了缓存代码，但 TypeScript 的类型擦除和 Tree Shaking 带来了优化</li>
</ul>
<h3 data-id="heading-13">项目结构对比</h3>
<h4 data-id="heading-14">原版结构</h4>
<pre><code class="hljs language-ruby" lang="ruby">relationship/
├── src/
│   ├── relationship.js       <span class="hljs-comment"># 主入口 (单文件)</span>
│   ├── relationship-mode.js  <span class="hljs-comment"># 模式相关</span>
│   ├── locale/               <span class="hljs-comment"># 语言包</span>
│   └── <span class="hljs-keyword">module</span>/               <span class="hljs-comment"># 模块</span>
└── package.json
</code></pre>
<h4 data-id="heading-15">TS 版本结构</h4>
<pre><code class="hljs language-python" lang="python">relationship-ts/
├── src/
│   ├── core/                 <span class="hljs-comment"># 核心模块</span>
│   │   ├── cache.ts          <span class="hljs-comment"># 缓存系统 (Map优化)</span>
│   │   ├── lru.ts            <span class="hljs-comment"># LRU缓存实现</span>
│   │   ├── <span class="hljs-built_in">id</span>.ts             <span class="hljs-comment"># 关系链转中文</span>
│   │   ├── mode.ts           <span class="hljs-comment"># 模式管理</span>
│   │   └── selector.ts       <span class="hljs-comment"># 中文转关系链</span>
│   ├── data/                 <span class="hljs-comment"># 数据文件</span>
│   ├── rules/                <span class="hljs-comment"># 规则文件</span>
│   ├── utils/                <span class="hljs-comment"># 工具函数</span>
│   ├── locale/               <span class="hljs-comment"># 方言数据</span>
│   ├── types.ts              <span class="hljs-comment"># 类型定义</span>
│   └── index.ts              <span class="hljs-comment"># 主入口</span>
├── docs/                     <span class="hljs-comment"># VitePress 文档</span>
├── benchmark/                <span class="hljs-comment"># 性能测试</span>
└── package.json
</code></pre>
<p><strong>改进点：</strong></p>
<ul>
<li>更清晰的模块划分</li>
<li>独立的类型定义文件</li>
<li>完善的文档系统</li>
<li>性能基准测试</li>
</ul>
<h3 data-id="heading-16">使用示例</h3>
<h4 data-id="heading-17">安装</h4>
<pre><code class="hljs language-bash" lang="bash">npm install relationship-ts
</code></pre>
<h4 data-id="heading-18">基本用法</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> relationship <span class="hljs-keyword">from</span> <span class="hljs-string">'relationship-ts'</span>;

<span class="hljs-comment">// 查询称谓</span>
<span class="hljs-title function_">relationship</span>({ <span class="hljs-attr">text</span>: <span class="hljs-string">'爸爸的妈妈'</span> });
<span class="hljs-comment">// =&gt; ['奶奶', '祖母']</span>

<span class="hljs-comment">// 多层关系查询</span>
<span class="hljs-title function_">relationship</span>({ <span class="hljs-attr">text</span>: <span class="hljs-string">'妈妈的妈妈的哥哥'</span> });
<span class="hljs-comment">// =&gt; ['舅外公']</span>

<span class="hljs-comment">// 反向查询：对方称呼我什么？</span>
<span class="hljs-title function_">relationship</span>({ <span class="hljs-attr">text</span>: <span class="hljs-string">'外婆'</span>, <span class="hljs-attr">reverse</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">sex</span>: <span class="hljs-number">1</span> });
<span class="hljs-comment">// =&gt; ['外孙']</span>

<span class="hljs-comment">// 关系链查询</span>
<span class="hljs-title function_">relationship</span>({ <span class="hljs-attr">text</span>: <span class="hljs-string">'舅公'</span>, <span class="hljs-attr">type</span>: <span class="hljs-string">'chain'</span> });
<span class="hljs-comment">// =&gt; ['爸爸的妈妈的兄弟', '妈妈的妈妈的兄弟']</span>
</code></pre>
<h4 data-id="heading-19">自然语言模式</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 支持自然语言表达式</span>
<span class="hljs-title function_">relationship</span>(<span class="hljs-string">'舅妈如何称呼外婆？'</span>);
<span class="hljs-comment">// =&gt; ['婆婆']</span>

<span class="hljs-title function_">relationship</span>(<span class="hljs-string">'外婆和奶奶之间是什么关系？'</span>);
<span class="hljs-comment">// =&gt; ['儿女亲家']</span>
</code></pre>
<h4 data-id="heading-20">自定义方言</h4>
<pre><code class="hljs language-typescript" lang="typescript">relationship.<span class="hljs-title function_">setMode</span>(<span class="hljs-string">'northern'</span>, {
  <span class="hljs-string">'m,f'</span>: [<span class="hljs-string">'姥爷'</span>],
  <span class="hljs-string">'m,m'</span>: [<span class="hljs-string">'姥姥'</span>],
  <span class="hljs-string">'m,xb,s&amp;o'</span>: [<span class="hljs-string">'表哥'</span>],
  <span class="hljs-string">'m,xb,s&amp;l'</span>: [<span class="hljs-string">'表弟'</span>],
});

<span class="hljs-title function_">relationship</span>({ <span class="hljs-attr">text</span>: <span class="hljs-string">'妈妈的妈妈'</span>, <span class="hljs-attr">mode</span>: <span class="hljs-string">'northern'</span> });
<span class="hljs-comment">// =&gt; ['姥姥']</span>
</code></pre>
<h3 data-id="heading-21">兼容性说明</h3>
<p>TS 版本保持了与原版 <strong>100% 的 API 兼容性</strong>，你可以无缝替换：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 原版引入方式仍然支持</span>
<span class="hljs-keyword">import</span> relationship <span class="hljs-keyword">from</span> <span class="hljs-string">'relationship.js'</span>;

<span class="hljs-comment">// 替换为 TS 版本</span>
<span class="hljs-keyword">import</span> relationship <span class="hljs-keyword">from</span> <span class="hljs-string">'relationship-ts'</span>;

<span class="hljs-comment">// 代码无需任何修改</span>
</code></pre>
<h3 data-id="heading-22">总结</h3>
<p>这次 TypeScript 重构主要带来了以下收益：</p>
<ol>
<li><strong>性能提升</strong> - LRU 缓存让重复查询性能提升 1200 倍</li>
<li><strong>兼容性解决</strong> - 使用 Map 彻底解决 React Native 属性溢出问题</li>
<li><strong>类型安全</strong> - 完整的 TypeScript 类型定义</li>
<li><strong>代码质量</strong> - 模块化架构，更易维护和扩展</li>
<li><strong>包体积优化</strong> - 压缩后体积减少约 5.4%</li>
</ol>
<p>如果你在项目中需要使用亲戚关系计算功能，尤其是在 <strong>React Native</strong> 或 <strong>TypeScript</strong> 项目中，不妨试试这个优化版本。</p>
<h3 data-id="heading-23">致谢</h3>
<p>本项目基于 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmumuy%2Frelationship" target="_blank" title="https://github.com/mumuy/relationship" ref="nofollow noopener noreferrer">mumuy/relationship</a> 进行重构，感谢原作者 mumuy 的优秀工作！</p>
<hr/>
<blockquote>
<p>GitHub: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FExploringTheCodeWorld%2Frelationship-ts" target="_blank" title="https://github.com/ExploringTheCodeWorld/relationship-ts" ref="nofollow noopener noreferrer">github.com/ExploringTh…</a>
在线演示: <a href="https://link.juejin.cn?target=https%3A%2F%2Fexample.qinyimo.cn%2F" target="_blank" title="https://example.qinyimo.cn/" ref="nofollow noopener noreferrer">example.qinyimo.cn/</a>
文档地址: <a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.qinyimo.cn%2F" target="_blank" title="https://docs.qinyimo.cn/" ref="nofollow noopener noreferrer">docs.qinyimo.cn/</a></p>
</blockquote>
<p>如果这个项目对你有帮助，欢迎给个 Star ⭐️</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[TypeScript 类型断言]]></title>    <link>https://juejin.cn/post/7598563188112490548</link>    <guid>https://juejin.cn/post/7598563188112490548</guid>    <pubDate>2026-01-25T13:37:22.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598563188112490548" data-draft-id="7598588085597634600" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="TypeScript 类型断言"/> <meta itemprop="keywords" content="TypeScript"/> <meta itemprop="datePublished" content="2026-01-25T13:37:22.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="如果你好"/> <meta itemprop="url" content="https://juejin.cn/user/2272012281328215"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            TypeScript 类型断言
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2272012281328215/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    如果你好
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-25T13:37:22.000Z" title="Sun Jan 25 2026 13:37:22 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">TypeScript 类型断言</h2>
<h3 data-id="heading-1">一、类型断言</h3>
<p>举个简单例子：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 定义一个只能是 'a'/'b'/'c' 的类型</span>
<span class="hljs-keyword">type</span> T = <span class="hljs-string">'a'</span>|<span class="hljs-string">'b'</span>|<span class="hljs-string">'c'</span>;
<span class="hljs-comment">// TS 推断 foo 的类型是 string（太宽泛了）</span>
<span class="hljs-keyword">let</span> foo = <span class="hljs-string">'a'</span>;
<span class="hljs-comment">// 报错：string 类型不能赋值给 T 类型</span>
<span class="hljs-keyword">let</span> <span class="hljs-attr">bar</span>:T = foo;
</code></pre>
<p>这里 foo 明明是 'a'，但 TS 推断成了 string 类型（T 的父类型），父类型不能赋值给子类型，就报错了。</p>
<p>而<strong>类型断言</strong>就是用来“绕开”TS 的自动推断，手动指定值的类型——你比编译器更了解自己的代码，直接告诉它该怎么识别这个值！</p>
<p>改一下上面的例子，加上断言就不报错了：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">type</span> T = <span class="hljs-string">'a'</span>|<span class="hljs-string">'b'</span>|<span class="hljs-string">'c'</span>;
<span class="hljs-keyword">let</span> foo = <span class="hljs-string">'a'</span>;
<span class="hljs-comment">// 断言 foo 的类型是 T，TS 直接照做</span>
<span class="hljs-keyword">let</span> <span class="hljs-attr">bar</span>:T = foo <span class="hljs-keyword">as</span> T; <span class="hljs-comment">// 正确！</span>
</code></pre>
<p>注意：类型断言<strong>不会真的改变值的类型</strong>，只是给编译器“提个醒”，运行时该是什么类型还是什么类型。</p>
<h3 data-id="heading-2">二、类型断言的两种写法（推荐第二种）</h3>
<p>TS 提供了两种断言语法，功能完全一样，只是写法不同：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 写法1：尖括号形式（和 JSX 语法冲突，不推荐）</span>
<span class="hljs-keyword">let</span> <span class="hljs-attr">bar</span>:T = &lt;T&gt;foo;

<span class="hljs-comment">// 写法2：as 形式（推荐！无冲突，更易读）</span>
<span class="hljs-keyword">let</span> <span class="hljs-attr">bar</span>:T = foo <span class="hljs-keyword">as</span> T;
</code></pre>
<p>因为 React 的 JSX 语法也用尖括号（比如 <code>&lt;div&gt;</code>），为了避免混淆，现在都用 <code>值 as 类型</code> 的写法。</p>
<h4 data-id="heading-3">例子：操作 DOM 元素</h4>
<p>日常开发中最常用的场景——获取输入框并读取 value 属性：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// TS 推断 username 的类型是 HTMLElement | null</span>
<span class="hljs-keyword">const</span> username = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'username'</span>);

<span class="hljs-keyword">if</span> (username) {
  <span class="hljs-comment">// 断言成输入框类型，才能读取 value 属性</span>
  (username <span class="hljs-keyword">as</span> <span class="hljs-title class_">HTMLInputElement</span>).<span class="hljs-property">value</span>; <span class="hljs-comment">// 正确！</span>
}
</code></pre>
<p>这里的圆括号不能少，否则 TS 会把 <code>username as HTMLInputElement.value</code> 当成整体，直接报错</p>
<h3 data-id="heading-4">三、类型断言不可以随便使用</h3>
<p>你不能把一个值断言成完全无关的类型，TS 会拦着你：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> n = <span class="hljs-number">1</span>;
<span class="hljs-comment">// 报错：数值不能断言成字符串（完全无关）</span>
<span class="hljs-keyword">const</span> <span class="hljs-attr">m</span>:<span class="hljs-built_in">string</span> = n <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>;
</code></pre>
<p><strong>断言的规则</strong>：实际类型和断言类型必须“兼容”——要么是父子类型，要么是子父类型（比如 string 可以断言成 'a'|'b'，反过来也可以）。</p>
<p>如果非要断言成完全无关的类型（不推荐），可以走“弯路”：先断言成 <code>unknown</code>（所有类型的父类型），再断言成目标类型：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> n = <span class="hljs-number">1</span>;
<span class="hljs-comment">// 先转 unknown，再转 string，不报错了</span>
<span class="hljs-keyword">const</span> <span class="hljs-attr">m</span>:<span class="hljs-built_in">string</span> = n <span class="hljs-keyword">as</span> <span class="hljs-built_in">unknown</span> <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>;
</code></pre>
<h3 data-id="heading-5">四、超实用的特殊断言：as const</h3>
<p>日常开发中，我们经常遇到“let 变量被推断成宽泛类型”的问题，比如：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">let</span> s = <span class="hljs-string">'JavaScript'</span>;
<span class="hljs-comment">// 定义只能传这三个值的类型</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">Lang</span> = <span class="hljs-string">'JavaScript'</span>|<span class="hljs-string">'TypeScript'</span>|<span class="hljs-string">'Python'</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">setLang</span>(<span class="hljs-params">language:Lang</span>) {}

<span class="hljs-comment">// 报错：string 类型不能传给 Lang 类型</span>
<span class="hljs-title function_">setLang</span>(s);
</code></pre>
<p>解决方法有两个：要么把 let 改成 const（TS 会推断成固定值类型），要么用 <code>as const</code> 断言：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 断言后，s 的类型变成 'JavaScript'（不是 string 了）</span>
<span class="hljs-keyword">let</span> s = <span class="hljs-string">'JavaScript'</span> <span class="hljs-keyword">as</span> <span class="hljs-keyword">const</span>;
<span class="hljs-title function_">setLang</span>(s); <span class="hljs-comment">// 正确！</span>
</code></pre>
<p><code>as const</code> 的核心作用：把值断言成“不可变的常量类型”，缩小 TS 的推断范围。</p>
<h4 data-id="heading-6">as const 还能用于对象/数组</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 普通声明：x/y 都是 number 类型</span>
<span class="hljs-keyword">const</span> v1 = { <span class="hljs-attr">x</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">y</span>: <span class="hljs-number">2</span> };

<span class="hljs-comment">// 断言整个对象：x=1、y=2，且只读</span>
<span class="hljs-keyword">const</span> v2 = { <span class="hljs-attr">x</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">y</span>: <span class="hljs-number">2</span> } <span class="hljs-keyword">as</span> <span class="hljs-keyword">const</span>;

<span class="hljs-comment">// 普通数组：number[] 类型</span>
<span class="hljs-keyword">const</span> a1 = [<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>];
<span class="hljs-comment">// 断言后：只读元组 [1,2,3]</span>
<span class="hljs-keyword">const</span> a2 = [<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>] <span class="hljs-keyword">as</span> <span class="hljs-keyword">const</span>;
</code></pre>
<p>比如数组断言成元组后，传给固定参数的函数就不报错了：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">x:<span class="hljs-built_in">number</span>, y:<span class="hljs-built_in">number</span></span>) {
  <span class="hljs-keyword">return</span> x + y;
}

<span class="hljs-keyword">const</span> nums = [<span class="hljs-number">1</span>,<span class="hljs-number">2</span>] <span class="hljs-keyword">as</span> <span class="hljs-keyword">const</span>;
<span class="hljs-title function_">add</span>(...nums); <span class="hljs-comment">// 正确！</span>
</code></pre>
<h3 data-id="heading-7">五、非空断言：!（保证值不是 null/undefined）</h3>
<p>如果一个值可能是 null/undefined，但你确定它一定有值，用 <code>!</code> 做非空断言：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// TS 担心 root 是 null，调用方法会报错</span>
<span class="hljs-keyword">const</span> root = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'root'</span>);
<span class="hljs-comment">// root.addEventListener('click', () =&gt; {}); // 报错</span>

<span class="hljs-comment">// 加 ! 断言：root 一定不是 null</span>
<span class="hljs-keyword">const</span> root = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'root'</span>)!;
root.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-function">() =&gt;</span> {}); <span class="hljs-comment">// 正确！</span>
</code></pre>
<p>非空断言别滥用！只有你确定值非空时才用，否则运行时可能报错。更稳妥的方式是手动判断：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> root = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'root'</span>);
<span class="hljs-keyword">if</span> (root) {
  root.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-function">() =&gt;</span> {});
}
</code></pre>
<h3 data-id="heading-8">六、断言函数：确认参数类型</h3>
<p>有时候我们需要写“校验函数”，确保参数符合类型要求，不符合就抛错——这就是断言函数：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 新版写法：明确告诉 TS，这个函数断言 value 是字符串</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">isString</span>(<span class="hljs-params">value:<span class="hljs-built_in">unknown</span></span>):asserts value is <span class="hljs-built_in">string</span> {
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> value !== <span class="hljs-string">'string'</span>) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'不是字符串！'</span>);
  }
}

<span class="hljs-comment">// 使用断言函数</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">toUpper</span>(<span class="hljs-params">x: <span class="hljs-built_in">string</span>|<span class="hljs-built_in">number</span></span>) {
  <span class="hljs-title function_">isString</span>(x); <span class="hljs-comment">// 执行后，TS 就知道 x 是字符串了</span>
  <span class="hljs-keyword">return</span> x.<span class="hljs-title function_">toUpperCase</span>(); <span class="hljs-comment">// 正确！</span>
}


</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[拒绝属性冲突！一文吃透 JavaScript 第七种数据类型：Symbol]]></title>    <link>https://juejin.cn/post/7598744870995558443</link>    <guid>https://juejin.cn/post/7598744870995558443</guid>    <pubDate>2026-01-25T13:59:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598744870995558443" data-draft-id="7598767580306096182" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="拒绝属性冲突！一文吃透 JavaScript 第七种数据类型：Symbol"/> <meta itemprop="keywords" content="前端,JavaScript"/> <meta itemprop="datePublished" content="2026-01-25T13:59:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="NEXT06"/> <meta itemprop="url" content="https://juejin.cn/user/1176918763246011"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            拒绝属性冲突！一文吃透 JavaScript 第七种数据类型：Symbol
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1176918763246011/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    NEXT06
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-25T13:59:39.000Z" title="Sun Jan 25 2026 13:59:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p><strong>前言</strong>：<br/>
在 ES6 之前，JavaScript 的对象属性名只有一种类型：字符串。这在单人开发的小项目中看似没问题，但在大型项目或多人协作开发第三方库时，属性名冲突（Collision）简直是噩梦。</p>
<p>于是，ES6 带来了<strong>Symbol</strong>。它不仅仅是一个新类型，更是解决架构设计中“唯一性”问题的银弹。</p>
</blockquote>
<h2 data-id="heading-0">一、 数据类型的“七上八下”</h2>
<p>在深入 Symbol 之前，各位作为未来专业前端工程师，我们需要先理清 JavaScript 目前的数据类型版图。根据最新的 ECMAScript 标准，我们可以用**“七上八下”**这个口诀来记忆：</p>
<ul>
<li>
<p><strong>七上（7 种原始数据类型 Primitive Types）：</strong></p>
<ol>
<li>Number</li>
<li>Boolean</li>
<li>String</li>
<li>Null</li>
<li>Undefined</li>
<li><strong>Symbol</strong> (ES6 新增，符号)</li>
<li><strong>BigInt</strong> (ES2020 新增，大整数)</li>
</ol>
</li>
<li>
<p><strong>八下（1 种引用数据类型 Reference Type）：</strong></p>
<ol>
<li>Object (包含 Array, Function 等)</li>
</ol>
</li>
</ul>
<p>那么问题来了，既然已经有了 String，为什么还需要 Symbol？答案只有一个核心痛点：<strong>唯一性（Uniqueness）</strong> 。</p>
<hr/>
<h2 data-id="heading-1">二、 Symbol 的核心特性：独一无二的指纹</h2>
<h3 data-id="heading-2">1. 它是原始类型，不是对象</h3>
<p>很多新手看到首字母大写的 Symbol，下意识想用 new 去调用。<strong>这是错误的！</strong></p>
<p>JavaScript</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 正确写法</span>
<span class="hljs-keyword">const</span> id1 = <span class="hljs-title class_">Symbol</span>();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-keyword">typeof</span> id1); <span class="hljs-comment">// 'symbol'</span>

<span class="hljs-comment">// 错误写法：会抛出 TypeError</span>
<span class="hljs-comment">// const id2 = new Symbol();</span>
</code></pre>
<p><strong>深度解析</strong>：<br/>
Symbol 是原始数据类型（Primitive），就像 123 或 'abc' 一样。new 关键字是用来调用构造函数生成对象实例的（Wrapper Object）。如果你非要创建一个 Symbol 包装对象（不推荐），需要使用 Object(Symbol())。</p>
<h3 data-id="heading-3">2. 描述只是标签，不是身份</h3>
<p>我们可以给 Symbol 传入一个字符串作为描述（Description），但这仅仅是为了调试方便（当你打印 Log 时知道它是谁），<strong>不影响它的唯一性</strong>。</p>
<p>让我们看一段代码</p>
<p>JavaScript</p>
<pre><code class="hljs language-ini" lang="ini">// 即使描述完全一样
const <span class="hljs-attr">s1</span> = Symbol(<span class="hljs-string">'二哈'</span>)<span class="hljs-comment">;</span>
const <span class="hljs-attr">s2</span> = Symbol(<span class="hljs-string">'二哈'</span>)<span class="hljs-comment">;</span>

// 它们依然不相等！
console.log(<span class="hljs-attr">s1</span> === s2)<span class="hljs-comment">; // false</span>
</code></pre>
<p>这就像现实生活中，名字都叫“张三”的人有很多，但他们的身份证号（内存地址/唯一标识）绝对不同。Symbol 就是那个身份证号。</p>
<hr/>
<h2 data-id="heading-4">三、 实战：解决协作中的“属性覆盖”危机</h2>
<p>这是 Symbol 诞生最大的意义。</p>
<p>假设你正在使用一个第三方库提供的 user 对象，或者在一个大型团队中维护一个公共对象。你想给这个对象添加一个“密钥”属性。</p>
<p><strong>传统做法的风险：</strong></p>
<p>JavaScript</p>
<pre><code class="hljs language-ini" lang="ini">// 假如 user 是别人传给你的
<span class="hljs-attr">user.id</span> = <span class="hljs-string">'123456'</span><span class="hljs-comment">; //  危险！如果 user 原本就有 id 属性，你就把它覆盖了！</span>
</code></pre>
<p><strong>Symbol 的做法：</strong></p>
<p>JavaScript</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">const</span> secretKey = Symbol(<span class="hljs-string">'secret'</span>); <span class="hljs-comment">// 生成一个独一无二的 Key</span>
<span class="hljs-keyword">const</span> a = <span class="hljs-string">"ecut"</span>; <span class="hljs-comment">// 普通字符串 Key</span>

<span class="hljs-keyword">const</span> user = {
    name: <span class="hljs-string">'曹仁'</span>,
    email: <span class="hljs-string">'123@qq.com'</span>,
    [<span class="hljs-meta">a</span>]: <span class="hljs-number">456</span>,            <span class="hljs-comment">// 普通计算属性名</span>
    [<span class="hljs-meta">secretKey</span>]: <span class="hljs-string">'111222'</span> <span class="hljs-comment">//  Symbol 作为 Key，绝不会冲突</span>
};

<span class="hljs-comment">// 访问方式</span>
console.log(user[secretKey]); <span class="hljs-comment">// '111222'</span>
</code></pre>
<p><strong>场景模拟</strong>：<br/>
哪怕 user 对象里原本就有个属性叫 secret，或者其他同事也定义了一个 Symbol('secret')，你的代码依然安全。因为你的 secretKey 变量持有的那个 Symbol 引用，是宇宙唯一的。</p>
<hr/>
<h2 data-id="heading-5">四、 隐身与反向查找：不可枚举的“魔法”</h2>
<p>Symbol 属性还有一个非常迷人的特性：<strong>它在常规遍历中是“隐身”的。</strong></p>
<p>让我们看一个课堂名单的例子</p>
<p>JavaScript</p>
<pre><code class="hljs language-css" lang="css">const classRoom = {
    "<span class="hljs-selector-tag">dl</span>": [<span class="hljs-string">"张三"</span>, <span class="hljs-string">"李四"</span>], // 普通属性
    [<span class="hljs-built_in">Symbol</span>(<span class="hljs-string">'Mark'</span>)]: { grade: <span class="hljs-number">50</span>, gender: <span class="hljs-string">'male'</span> },
    <span class="hljs-selector-attr">[Symbol(<span class="hljs-string">'oliva'</span>)]</span>: { grade: <span class="hljs-number">80</span>, gender: <span class="hljs-string">'female'</span> },
    // 注意：下面这个 Oliva 和上面那个是两个不同的 Key，不会覆盖！
    <span class="hljs-selector-attr">[Symbol(<span class="hljs-string">'oliva'</span>)]</span>: { grade: <span class="hljs-number">85</span>, gender: <span class="hljs-string">'female'</span> } 
}

// <span class="hljs-number">1</span>. 使用 for..<span class="hljs-selector-class">.in</span> 遍历
for (const key in classRoom) {
    console<span class="hljs-selector-class">.log</span>(key); // 只会输出 "<span class="hljs-selector-tag">dl</span>"
}

// <span class="hljs-number">2</span>. 使用 <span class="hljs-selector-tag">Object</span><span class="hljs-selector-class">.keys</span>()
console<span class="hljs-selector-class">.log</span>(<span class="hljs-selector-tag">Object</span><span class="hljs-selector-class">.keys</span>(classRoom)); // <span class="hljs-selector-attr">[<span class="hljs-string">"dl"</span>]</span>

// <span class="hljs-number">3</span>.  巨坑预警：JSON 序列化
console<span class="hljs-selector-class">.log</span>(JSON<span class="hljs-selector-class">.stringify</span>(classRoom)); 
// 输出: {"<span class="hljs-selector-tag">dl</span>":[<span class="hljs-string">"张三"</span>,<span class="hljs-string">"李四"</span>]}
// Symbol 属性直接被忽略了！
</code></pre>
<h3 data-id="heading-6">既然隐身了，我怎么拿到它？</h3>
<p>虽然 Symbol 可以模拟“私有属性”，但它不是绝对私有的。ES6 专门提供了一个 API 来获取对象中所有的 Symbol 键：</p>
<p>JavaScript</p>
<pre><code class="hljs language-ini" lang="ini">// 获取所有 Symbol 属性
const <span class="hljs-attr">syms</span> = Object.getOwnPropertySymbols(classRoom)<span class="hljs-comment">;</span>
console.log(syms)<span class="hljs-comment">; </span>
// <span class="hljs-section">[Symbol(Mark), Symbol(oliva), Symbol(oliva)]</span>

// 拿到 Key 后就可以访问数据了
const <span class="hljs-attr">data</span> = syms.map(sym =&gt; classRoom[sym])<span class="hljs-comment">;</span>
console.log(data)<span class="hljs-comment">;</span>
</code></pre>
<p>这一特性常用于在对象中存储<strong>元数据（Metadata）</strong> ，这些数据对业务逻辑重要，但在序列化传输给前端或存储到数据库时不需要（或者不能）被带走。</p>
<hr/>
<h2 data-id="heading-7">五、 深度扩展：Symbol 的进阶玩法</h2>
<p>作为一名资深开发者，只掌握基础是不够的，以下两个知识点能体现你的专业度。</p>
<h3 data-id="heading-8">1. 全局注册表：Symbol.for()</h3>
<p>普通的 Symbol() 每次都是新的。但如果你想在不同的文件、甚至不同的 iframe 之间共享同一个 Symbol 怎么办？</p>
<p>JavaScript</p>
<pre><code class="hljs language-ini" lang="ini">// 在全局注册表中登记一个名为 'uid' 的 Symbol
const <span class="hljs-attr">globalSym</span> = Symbol.for(<span class="hljs-string">'uid'</span>)<span class="hljs-comment">;</span>
const <span class="hljs-attr">sameSym</span> = Symbol.for(<span class="hljs-string">'uid'</span>)<span class="hljs-comment">;</span>

console.log(<span class="hljs-attr">globalSym</span> === sameSym)<span class="hljs-comment">; // true</span>
</code></pre>
<p>它就像一个全局的储物柜，你拿着凭证（Key）去取，拿到的永远是同一个东西。</p>
<h3 data-id="heading-9">2. 内置 Symbol（Well-known Symbols）</h3>
<p>你是否好奇，为什么 for...of 可以遍历数组，却不能遍历普通对象？为什么 String(obj) 会调用 toString？</p>
<p>这一切都是因为 JS 内部定义了一组<strong>内置 Symbol</strong>。比如 Symbol.iterator 定义了迭代行为，Symbol.toPrimitive 定义了类型转换行为。通过重写这些 Symbol，你可以从底层改变对象的行为模式。</p>
<hr/>
<h2 data-id="heading-10">六、 总结</h2>
<p>Symbol 的出现，标志着 JavaScript 从一门简单的脚本语言向成熟的大型应用语言迈进。</p>
<p>它主要解决了三大痛点：</p>
<ol>
<li><strong>唯一性</strong>：从根本上杜绝了属性名冲突。</li>
<li><strong>数据隐藏</strong>：作为非枚举属性，适合存储对象状态、配置项或元数据。</li>
<li><strong>行为钩子</strong>：通过内置 Symbol 扩展语言的底层能力。</li>
</ol>
<p>下次当你在设计通用组件、SDK 或处理复杂对象数据时，不妨想一想：“这里是不是该用 Symbol 了？”</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Canvas 何尝不是亮点呢？（一）]]></title>    <link>https://juejin.cn/post/7598744870995591211</link>    <guid>https://juejin.cn/post/7598744870995591211</guid>    <pubDate>2026-01-25T14:03:34.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598744870995591211" data-draft-id="7598744870995574827" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Canvas 何尝不是亮点呢？（一）"/> <meta itemprop="keywords" content="前端,JavaScript,面试"/> <meta itemprop="datePublished" content="2026-01-25T14:03:34.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="秀秀不只会前端"/> <meta itemprop="url" content="https://juejin.cn/user/1410009035452887"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Canvas 何尝不是亮点呢？（一）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1410009035452887/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    秀秀不只会前端
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-25T14:03:34.000Z" title="Sun Jan 25 2026 14:03:34 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、Canvas 是什么？</h2>
<p><strong>Canvas  是高性能渲染引擎。</strong></p>
<ul>
<li><code>&lt;canvas&gt;</code> 是一个<strong>位图渲染容器</strong></li>
<li>所有内容都通过 <strong>JS API 绘制</strong></li>
<li>绘制完成后，浏览器只认识「像素」，<strong>不再关心你画了什么</strong></li>
<li>canvans 支持绘制的图形，总结起来有四种：
<ul>
<li>直线（矩形）</li>
<li>曲线（圆形）</li>
<li>文字</li>
<li>图片</li>
</ul>
</li>
</ul>
<blockquote>
<p>这与 DOM（结构化、可访问）完全不同。</p>
</blockquote>
<p>Canvas 和 DOM / SVG 的区别：</p>
<p>使用场景：</p>
<ul>
<li>动画动效</li>
<li>编辑器（时间轴 / 画布）</li>
<li>数据 / 大屏可视化</li>
<li>大数据量下的表格（性能优化）</li>
<li>游戏</li>
<li>音视频波形、字幕</li>
</ul>
<h2 data-id="heading-1">二、Canvas 基础</h2>
<p>Canvas 是 <strong>命令式 + 无状态渲染</strong></p>
<ul>
<li>每一帧都要<strong>重新画完整画面</strong></li>
<li>Canvas 不会保存任何结构</li>
</ul>
<ol>
<li>
<h3 data-id="heading-2">简单示例</h3>
</li>
</ol>
<pre><code class="hljs language-HTML" lang="HTML"><span class="hljs-meta">&lt;!doctype <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Document<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">canvas</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"canvas"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">canvas</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
      <span class="hljs-comment">// 获取 canvas 元素​</span>
      <span class="hljs-keyword">const</span> canvas = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">"#canvas"</span>);
      <span class="hljs-comment">// 获取 canvas 上下文</span>
      <span class="hljs-keyword">const</span> ctx = canvas.<span class="hljs-title function_">getContext</span>(<span class="hljs-string">"2d"</span>);

      <span class="hljs-comment">// 初始化</span>
      <span class="hljs-keyword">function</span> <span class="hljs-title function_">init</span>(<span class="hljs-params"/>) {
        canvas.<span class="hljs-property">width</span> = <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span>;
        canvas.<span class="hljs-property">height</span> = <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span>;
      }
      <span class="hljs-title function_">init</span>();

      <span class="hljs-comment">// ==设置初始值==</span>
      <span class="hljs-comment">// 设置路径</span>
      ctx.<span class="hljs-title function_">beginPath</span>();
      <span class="hljs-comment">// 起始路径点：从画布左上角开始移动到某个位置</span>
      ctx.<span class="hljs-title function_">moveTo</span>(<span class="hljs-number">100</span>, <span class="hljs-number">200</span>);
      <span class="hljs-comment">// 画线中途连接点</span>
      ctx.<span class="hljs-title function_">lineTo</span>(<span class="hljs-number">200</span>, <span class="hljs-number">300</span>);
      <span class="hljs-comment">// 画线下一个点</span>
      <span class="hljs-comment">// ctx.lineTo(300, 350);</span>
      <span class="hljs-comment">// 最后闭合，终点连接起点（可选）</span>
      <span class="hljs-comment">// ctx.closePath();</span>

      <span class="hljs-comment">// ==绘制行为==</span>
      <span class="hljs-comment">// 示例一：画线</span>
      ctx.<span class="hljs-property">strokeStyle</span> = <span class="hljs-string">"red"</span>;
      ctx.<span class="hljs-title function_">stroke</span>();
      <span class="hljs-comment">// 示例二：画圆(小的填充圆就是点)</span>
      ctx.<span class="hljs-title function_">beginPath</span>();
      ctx.<span class="hljs-title function_">arc</span>(<span class="hljs-number">200</span>, <span class="hljs-number">300</span>, <span class="hljs-number">15</span>, <span class="hljs-number">0</span>, <span class="hljs-number">2</span> * <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span>, <span class="hljs-literal">true</span>); <span class="hljs-comment">// 圆心坐标x，圆心坐标y，半径，起始角度，结束角度（默认顺指针），是否逆时针</span>
      ctx.<span class="hljs-property">fillStyle</span> = <span class="hljs-string">"green"</span>;
      ctx.<span class="hljs-title function_">fill</span>();
      <span class="hljs-comment">// 填充</span>
      <span class="hljs-comment">// ctx.fillStyle = "blue";</span>
      <span class="hljs-comment">// ctx.fill();</span>
      <span class="hljs-comment">// 实例三：文字</span>
      <span class="hljs-comment">// ctx.font = "32px sans-serif";</span>
      <span class="hljs-comment">// ctx.fillText("123", 300, 400);</span>
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<ol start="2">
<li>
<h3 data-id="heading-3">坐标系统</h3>
</li>
</ol>
<ul>
<li>左上角 <code>(0,0)</code></li>
<li>向右：x 正方向</li>
<li>向下：y 正方向</li>
</ul>
<ol start="3">
<li>
<h3 data-id="heading-4">常见 API</h3>
</li>
</ol>
<blockquote>
<p>这里如果想要练手 canvas，我推荐两个项目：第一个是 vue3-particles（现在可能不叫这个名字了，总之就是粒子库/星空图的类似效果，第二个是代码雨/文字雨（canvas 版本），完全可以模仿着使用 canvas 复刻一下，能复刻出来，canvas 就算真正入门了。</p>
<p>彩蛋（😜）：如果后续有时间，我还会分享一些我之前做过的“花里胡哨”的动效。</p>
<p>进阶同学可以研究下 gsap 这个动画库，配合 canvas 会非常好用，就可以 <strong>GSAP 管时间，Canvas 管空间。</strong></p>
</blockquote>
<pre><code class="hljs language-Markdown" lang="Markdown">/<span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span>** 获取 Canvas &amp; 上下文 <span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">**/
const canvas = document.getElementById('canvas'); // 获取 canvas DOM
const ctx = canvas.getContext('2d');              // 获取 2D 渲染上下文（核心对象）

/**</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span> 状态管理 <span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">**/
ctx.save();       // 保存当前绘图状态（样式、变换、裁剪区）
ctx.restore();    // 恢复到最近一次 save 的状态
ctx.resetTransform(); // 重置 transform（现代浏览器）
ctx.globalAlpha = 1;  // 全局透明度（0~1）
ctx.globalCompositeOperation = 'source-over'; // 图层混合模式

/**</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span> 路径相关 <span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">**/
ctx.beginPath();  // 开启新路径
ctx.closePath();  // 闭合路径
ctx.moveTo(x, y);         // 移动到指定点（不画线）
ctx.lineTo(x, y);         // 从当前点画线到指定点
ctx.arc(x, y, r, start, end, ccw); // 画圆/圆弧
ctx.arcTo(x1, y1, x2, y2, r);      // 圆角连接线
ctx.rect(x, y, w, h);     // 画矩形路径
ctx.quadraticCurveTo(cpx, cpy, x, y); // 二次贝塞尔
ctx.bezierCurveTo(cp1x, cp1y, cp2x, cp2y, x, y); // 三次贝塞尔
ctx.stroke(); // 描边
ctx.fill();   // 填充
ctx.clip();   // 将当前路径设为裁剪区域（遮罩核心）

/**</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span> 样式设置 <span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">**/
ctx.strokeStyle = '#fff';     // 描边颜色
ctx.fillStyle = '#000';       // 填充颜色
ctx.lineWidth = 2;            // 线宽
ctx.lineCap = 'round';        // 线帽（butt | round | square）
ctx.lineJoin = 'round';       // 连接处样式
ctx.miterLimit = 10;          // 尖角限制
ctx.shadowColor = 'rgba(0,0,0,0.3)'; // 阴影颜色
ctx.shadowBlur = 10;                // 阴影模糊
ctx.shadowOffsetX = 5;              // 阴影偏移
ctx.shadowOffsetY = 5;

/**</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span> 变换 <span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">**/
ctx.translate(x, y); // 平移
ctx.rotate(rad);     // 旋转（弧度）
ctx.scale(sx, sy);   // 缩放
ctx.transform(a, b, c, d, e, f);    // 矩阵变换
ctx.setTransform(a, b, c, d, e, f); // 直接设置变换矩阵

/**</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span> 清屏 &amp; 擦除 <span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">**/
ctx.clearRect(0, 0, canvas.width, canvas.height); // 每次重新 draw 的时候通常会清空指定区域


/**</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span> 文本 <span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">**/
ctx.font = 'bold 48px sans-serif'; // 字体
ctx.textAlign = 'center';          // 对齐方式
ctx.textBaseline = 'middle';       // 基线
ctx.fillText('Hello', x, y);   // 填充文字
ctx.strokeText('Hello', x, y); // 描边文字
ctx.measureText('Hello');      // 测量文字宽度（字母动画必用）

/**</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span> 图片 <span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">**/
const img = new Image();
img.src = 'image.png';
ctx.drawImage(img, x, y);                         // 原尺寸绘制
ctx.drawImage(img, x, y, w, h);                   // 指定尺寸
ctx.drawImage(img, sx, sy, sw, sh, dx, dy, dw, dh); // 裁剪绘制（精灵图）

/**</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span> 渐变 &amp; 图案 <span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">**/
const linearGradient = ctx.createLinearGradient(x0, y0, x1, y1);
linearGradient.addColorStop(0, '#ff0');
linearGradient.addColorStop(1, '#f00');
ctx.fillStyle = linearGradient;
const radialGradient = ctx.createRadialGradient(x0, y0, r0, x1, y1, r1);
radialGradient.addColorStop(0, '#fff');
radialGradient.addColorStop(1, '#000');
const pattern = ctx.createPattern(img, 'repeat'); // 平铺图案

/**</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span> 像素操作（性能敏感） <span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">**/
const imageData = ctx.getImageData(0, 0, w, h); // 读取像素
const data = imageData.data;                   // RGBA 数组
ctx.putImageData(imageData, x, y);              // 写回像素
// data[i]     -&gt; R
// data[i + 1] -&gt; G
// data[i + 2] -&gt; B
// data[i + 3] -&gt; A

/**</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span> 动画循环 <span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">**/
function render() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  // draw...
  requestAnimationFrame(render);
  // 不能使用 setInterval，因为 1. 不跟随屏幕刷新 2. 掉帧严重 3. 能耗高
}
render();
</span></code></pre>
<h2 data-id="heading-5">三、其他注意事项</h2>
<ol>
<li>
<h3 data-id="heading-6">分层思想</h3>
</li>
</ol>
<ul>
<li>时间层（GSAP / Ticker）</li>
<li>逻辑层（业务逻辑、状态计算）</li>
<li>渲染层（Canvas draw）</li>
</ul>
<ol start="2">
<li>
<h3 data-id="heading-7">canvas / 图片清晰度问题</h3>
</li>
</ol>
<p>样式尺寸：el.style.width</p>
<p>原始尺寸：el.naturalWidth（canvas.width）</p>
<p>页面缩放倍率：devicePixelRatio</p>
<p>☝️ 保证图片(canvas)清晰可以总结为一个等式：原始尺寸 = 样式尺寸 * 缩放倍率</p>
<p>所以在项目中，我们一般为初始化的 canvas 设置宽高为：</p>
<pre><code class="hljs language-Plain" lang="Plain">const dpr = window.devicePixelRatio || 1;
canvas.width = project.width * dpr;
canvas.height = project.height * dpr;
</code></pre>
<ol start="3">
<li>
<h3 data-id="heading-8">必须使用 requestAnimationFrame</h3>
</li>
</ol>
<pre><code class="hljs language-Plain" lang="Plain">function render() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  // draw...
  requestAnimationFrame(render);
  // 
}
render();
</code></pre>
<p>不能使用 setInterval，因为：</p>
<ol>
<li>不跟随屏幕刷新</li>
<li>掉帧严重</li>
<li>能耗高</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[阿里一面：ReentrantLock如何保证线程安全？]]></title>    <link>https://juejin.cn/post/7598734303174967348</link>    <guid>https://juejin.cn/post/7598734303174967348</guid>    <pubDate>2026-01-26T01:59:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598734303174967348" data-draft-id="7598732691769819187" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="阿里一面：ReentrantLock如何保证线程安全？"/> <meta itemprop="keywords" content="后端,面试,Java"/> <meta itemprop="datePublished" content="2026-01-26T01:59:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员飞鱼"/> <meta itemprop="url" content="https://juejin.cn/user/1665088861772688"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            阿里一面：ReentrantLock如何保证线程安全？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1665088861772688/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员飞鱼
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-26T01:59:39.000Z" title="Mon Jan 26 2026 01:59:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:2;font-weight:400;font-size:15px;overflow-x:hidden;color:#333;letter-spacing:1.2px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1:first-child,.markdown-body h2:first-child,.markdown-body h3:first-child,.markdown-body h4:first-child,.markdown-body h5:first-child,.markdown-body h6:first-child{margin-top:-1.5rem;margin-bottom:1rem}.markdown-body h1:before,.markdown-body h2:before,.markdown-body h3:before,.markdown-body h4:before,.markdown-body h5:before,.markdown-body h6:before{content:"#";display:inline-block;color:#3eaf7c;padding-right:.23em}.markdown-body h1{position:relative;font-size:2.5rem;margin-bottom:5px}.markdown-body h1:before{font-size:2.5rem}.markdown-body h2{padding-bottom:.5rem;font-size:2.2rem;border-bottom:1px solid #ececec}.markdown-body h3{font-size:1.5rem;padding-bottom:0}.markdown-body h4{font-size:1.25rem}.markdown-body h5{font-size:1rem}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body strong{color:#3eaf7c}.markdown-body img{max-width:100%;border-radius:2px;display:block;margin:auto}.markdown-body hr{border:none;border-top:1px solid #3eaf7c;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;overflow-x:auto;padding:.2rem .5rem;margin:0;color:#3eaf7c;font-size:.85em;background-color:rgba(27,31,35,.05);border-radius:3px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;border:.5rem solid #3eaf7c}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{font-weight:500;text-decoration:none;color:#3eaf7c;margin:0 5px}.markdown-body a:active,.markdown-body a:hover{text-decoration:none;border-bottom:1.5px solid #3eaf7c}.markdown-body a[href^=http]:after{content:url("data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTQiIGhlaWdodD0iMTQiPjxkZWZzPjxzdHlsZS8+PC9kZWZzPjxwYXRoIGQ9Ik04MzIgMTI4SDY0MHY2NGgxNDYuNzUyTDUyMS4zNzYgNDU3LjM3Nmw0NS4yNDggNDUuMjQ4TDgzMiAyMzcuMjQ4VjM4NGg2NFYxMjh6IiBmaWxsPSIjM2VhZjdjIi8+PHBhdGggZD0iTTc2OCA4MzJIMTkyVjI1NmgzNTJ2LTY0SDE2MGEzMiAzMiAwIDAwLTMyIDMydjY0MGEzMiAzMiAwIDAwMzIgMzJoNjQwYTMyIDMyIDAgMDAzMi0zMlY0ODBoLTY0djM1MnoiIGZpbGw9IiMzZWFmN2MiLz48L3N2Zz4=");margin-left:2px}.markdown-body a[href^="#"]:before{content:"#"}.markdown-body table{display:inline-block!important;font-size:13px;width:auto;max-width:100%;overflow:auto;border:1px solid #3eaf7c;border-collapse:collapse}.markdown-body thead{background:#3eaf7c;color:#fff;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(153,255,188,.1)}.markdown-body td,.markdown-body th{padding:4px 8px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#7b7878;padding:1px 23px;border-left:.5rem solid;border-color:#42b983;background-color:rgba(66,184,131,.1);position:relative;margin:14px 8px 0}.markdown-body blockquote:before{display:inline-block;position:absolute;content:url("data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjUiIGhlaWdodD0iMjUiIHZpZXdCb3g9IjAgMCAyNyAyNyIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxLjg2MiAxLjg2MikiIGZpbGwtcnVsZT0ibm9uemVybyIgZmlsbD0ibm9uZSI+PGNpcmNsZSBzdHJva2U9IiNGRkYiIHN0cm9rZS13aWR0aD0iMS43MjQiIGZpbGw9IiM0MkI5ODMiIGN4PSIxMS42MzgiIGN5PSIxMS42MzgiIHI9IjExLjYzOCIvPjxwYXRoIGQ9Ik0xNC45NzggNi4yN0E1LjAwNiA1LjAwNiAwIDAwNi42NyA5LjQ2OGE0LjkwMSA0LjkwMSAwIDAwMS43NzMgNC4zNjJjLjMyMy4yNTguNTE0LjY0Ny41MjIgMS4wNnYxLjA2YTIuNjg1IDIuNjg1IDAgMDA1LjM3IDB2LTEuMDA4Yy4wMDItLjM5OC4xNzMtLjc3Ny40Ny0xLjA0MmE1LjAyMyA1LjAyMyAwIDAwLjE3My03LjYzem0tMy4zMzcgMTAuOTY3YTEuMzA0IDEuMzA0IDAgMDEtMS4yODYtMS4yODd2LS4yNzhoMi41NzJ2LjI2MWMwIC43MTMtLjU3MyAxLjI5NC0xLjI4NiAxLjMwNHptMi4yNi00LjQxNWMtLjQ0LjM4My0uNzUuODkzLS44ODcgMS40NmgtMi43NDZhMi44NjggMi44NjggMCAwMC0uOTM4LTEuNTNoLS4wMThhMy40NzYgMy40NzYgMCAwMS0xLjI2OS0zLjE0NSAzLjYxNSAzLjYxNSAwIDAxNy4xOTYuNCAzLjY1IDMuNjUgMCAwMS0xLjMzOCAyLjgxNXoiIGZpbGw9IiNGRkYiLz48L2c+PC9zdmc+");width:25px;height:25px;left:-16px;top:12px}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body details{outline:none;border:none;border-left:4px solid #3eaf7c;padding-left:10px;margin-left:4px}.markdown-body details summary{cursor:pointer;border:none;outline:none;background:#fff;margin:0 -17px}.markdown-body details summary::-webkit-details-marker{color:#3eaf7c}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body ol li::marker{color:#3eaf7c}.markdown-body ul li{list-style:none;padding-left:10px}.markdown-body ul li::marker{content:"•";color:#3eaf7c}.markdown-body ul li.task-list-item:before{content:"";margin-right:0}.markdown-body input[type=checkbox]{vertical-align:text-bottom;box-shadow:inset 0 0 0 10px #fff}.markdown-body input[type=checkbox]:before{content:url("data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiPjxkZWZzPjxzdHlsZS8+PC9kZWZzPjxwYXRoIGQ9Ik04NzcuMDU2IDE0Ni45NDR2NzMwLjExMkgxNDYuOTQ0VjE0Ni45NDRoNzMwLjExMnptMC0xMDQuMjc3SDE0Ni45NDRjLTU3LjYyOCAwLTEwNC4yNzcgNDYuNjQ5LTEwNC4yNzcgMTA0LjI3N3Y3MzAuMTEyYzAgNTcuNjI4IDQ2LjY0OSAxMDQuMjc3IDEwNC4yNzcgMTA0LjI3N2g3MzAuMTEyYzU3LjYyOCAwIDEwNC4yNzctNDYuNjQ5IDEwNC4yNzctMTA0LjI3N1YxNDYuOTQ0YzAtNTcuNjI4LTQ2LjY0OS0xMDQuMjc3LTEwNC4yNzctMTA0LjI3N3oiIGZpbGw9IiMzZWFmN2MiLz48L3N2Zz4=");position:relative;top:-2px;right:2px}.markdown-body input[type=checkbox]:checked:before{content:url("data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTUiIGhlaWdodD0iMTUiPjxkZWZzPjxzdHlsZS8+PC9kZWZzPjxwYXRoIGQ9Ik05MTAuMjA4IDBIMTEzLjc2QTExNC4xMTIgMTE0LjExMiAwIDAwLS4wMzIgMTEzLjc5MlY5MTAuMjRjMCA2Mi41OTIgNTEuMiAxMTMuNzkyIDExMy43OTIgMTEzLjc5Mmg3OTYuNDQ4YzYyLjU5MiAwIDExMy43OTItNTEuMiAxMTMuNzkyLTExMy43OTJWMTEzLjc5MkMxMDI0IDUxLjIgOTcyLjggMCA5MTAuMjA4IDB6bS01MTIgNzk2LjQ0OEwxMTMuNzYgNTEybDc5LjY0OC03OS42NDggMjA0LjggMjA0LjhMODMwLjU2IDIwNC44bDc5LjY0OCA3OS42NDgtNTEyIDUxMnoiIGZpbGw9IiMzZWFmN2MiLz48L3N2Zz4=");position:relative;top:-2px;right:2px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="monokai">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#272822;color:#ddd}.hljs-keyword,.hljs-literal,.hljs-name,.hljs-selector-tag,.hljs-strong,.hljs-tag{color:#f92672}.hljs-code{color:#66d9ef}.hljs-class .hljs-title{color:#fff}.hljs-attribute,.hljs-link,.hljs-regexp,.hljs-symbol{color:#bf79db}.hljs-addition,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-emphasis,.hljs-section,.hljs-selector-attr,.hljs-selector-pseudo,.hljs-string,.hljs-subst,.hljs-template-tag,.hljs-template-variable,.hljs-title,.hljs-type,.hljs-variable{color:#a6e22e}.hljs-comment,.hljs-deletion,.hljs-meta,.hljs-quote{color:#75715e}.hljs-doctag,.hljs-keyword,.hljs-literal,.hljs-section,.hljs-selector-id,.hljs-selector-tag,.hljs-title,.hljs-type{font-weight:700}</style><p><strong>文章内容收录到个人网站，方便阅读</strong>：<a href="https://link.juejin.cn?target=http%3A%2F%2Fhardyfish.top%2F" target="_blank" title="http://hardyfish.top/" ref="nofollow noopener noreferrer">hardyfish.top/</a></p>
<p>ReentrantLock 的线程安全，本质由两件事托底：<strong>互斥</strong>与<strong>内存可见性</strong>。</p>
<p>互斥保证同一时刻只有一个线程进入临界区（critical section，受保护的共享资源访问区）；</p>
<p>内存可见性保证临界区内对共享变量的写入，在解锁后对随后获得锁的线程可见。</p>
<p><strong>互斥：基于 AQS 的“独占状态”与 CAS 争用</strong></p>
<p>ReentrantLock 的底层是 <strong>AQS（AbstractQueuedSynchronizer，同步器框架）</strong> 。AQS 用一个 <code>state</code> 整数表示同步状态，对独占锁而言通常含义是“是否被占用/占用次数”。</p>
<ul>
<li>
<p>抢锁：线程通过 CAS（Compare-And-Swap，比较并交换）尝试把<code>state</code>从0改为1（或从当前值递增）。</p>
<ul>
<li>成功：获得锁，成为 owner（持有者）。</li>
<li>失败：进入 AQS 的 CLH 队列（FIFO 等待队列），阻塞/自旋等待后续唤醒。</li>
</ul>
</li>
<li>
<p><strong>锁的排他性</strong>：只有 owner 才能继续执行临界区代码；非 owner 必须等待 <code>state</code> 归零并被唤醒后再竞争。</p>
</li>
</ul>
<p>这种设计的关键点在于：对 <code>state</code> 的修改使用原子操作（CAS），从而在高并发下也能可靠地裁决“谁赢得锁”。</p>
<p><strong>可重入：用“持有者 + 计数”避免自我死锁</strong></p>
<p>“可重入（reentrant）”指同一线程在持有锁时再次 <code>lock()</code> 不会被自己阻塞。</p>
<p>ReentrantLock 通过两类信息实现：</p>
<ul>
<li>
<p><strong>持有者线程记录</strong>：AQS 维护当前独占持有者（owner thread）。</p>
</li>
<li>
<p>重入次数计数：<code>state</code>充当计数器。</p>
<ul>
<li>第一次获取锁：<code>state</code> 从 <code>0</code> 变为 <code>1</code>，owner 设为当前线程。</li>
<li>同一线程再次获取：检测 owner 是自己，直接 <code>state++</code>。</li>
<li>释放锁：<code>state--</code>；直到减到 <code>0</code> 才真正释放所有权并唤醒队列中的后继线程。</li>
</ul>
</li>
</ul>
<p>因此，临界区内调用链较深、方法间层层加锁时，不会发生“自己把自己锁死”的问题。</p>
<p><strong>阻塞与唤醒：队列化等待减少竞争风暴</strong></p>
<p>当抢锁失败，线程不会无休止忙等，而是进入 AQS 队列并在合适时机被唤醒：</p>
<ul>
<li>入队后，线程可能 <code>park</code>（挂起），释放 CPU。</li>
<li>解锁时，持有者把 <code>state</code> 释放到 <code>0</code>，再按策略唤醒队列中的后继节点竞争。</li>
</ul>
<p>队列化的价值在于把竞争从“所有线程同时冲刺”变成“排队接力”，显著降低上下文切换与缓存抖动带来的损耗。</p>
<p><strong>内存可见性：lock/unlock 的 happens-before 语义</strong></p>
<p>线程安全不只需要“同一时刻只有一个线程进来”，还需要“前一个线程写过的数据，后一个线程读得到”。</p>
<p>ReentrantLock 提供与 <code>synchronized</code> 类似的内存语义：</p>
<ul>
<li><strong>unlock 之前的写</strong>，在 <strong>随后某线程成功 lock 之后的读</strong> 中可见（happens-before）。</li>
<li>这依赖于 AQS 内部对 <code>state</code> 等字段的 <strong>volatile 语义</strong> 与 CAS/park-unpark 等操作在 Java 内存模型下形成的屏障效果。</li>
</ul>
<p>直观理解：解锁像“刷盘提交”，加锁像“重新加载最新版本”，保证共享变量不会读到旧值。</p>
<p><strong>公平与非公平：安全性相同，调度策略不同</strong></p>
<p>ReentrantLock 有两种策略：</p>
<ul>
<li><strong>非公平锁（默认）</strong> ：新来的线程可能“插队”直接 CAS 抢到锁，吞吐通常更高。</li>
<li><strong>公平锁</strong>：倾向于按队列先来后到获取锁，减少饥饿（starvation）风险。</li>
</ul>
<p>两者都满足互斥与可见性要求，线程安全语义一致，差别在于获得锁的次序与性能特征。</p>
<p><strong>关键用法约束：释放必须与获取配对</strong></p>
<p>ReentrantLock 的线程安全依赖“锁的协议”被正确遵守：</p>
<ul>
<li>释放次数必须与获取次数匹配（重入多少次就要 unlock 多少次），否则会造成锁长期不释放。</li>
<li>通常在 <code>finally</code> 中释放，避免异常路径遗留锁导致其他线程永久阻塞。</li>
</ul>
<p>这套机制合起来，使 ReentrantLock 在并发访问共享资源时，既能保证互斥，又能保证内存可见性，从而实现可验证的线程安全。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Zustand：轻量、直观、持久化的 React 状态管理新范式]]></title>    <link>https://juejin.cn/post/7598921649888329755</link>    <guid>https://juejin.cn/post/7598921649888329755</guid>    <pubDate>2026-01-25T12:13:52.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598921649888329755" data-draft-id="7598537377473560614" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Zustand：轻量、直观、持久化的 React 状态管理新范式"/> <meta itemprop="keywords" content="React.js"/> <meta itemprop="datePublished" content="2026-01-25T12:13:52.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Zyx2007"/> <meta itemprop="url" content="https://juejin.cn/user/3924597867554890"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Zustand：轻量、直观、持久化的 React 状态管理新范式
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3924597867554890/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Zyx2007
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-25T12:13:52.000Z" title="Sun Jan 25 2026 12:13:52 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在 React 应用日益复杂的今天，状态管理早已不是“要不要”的问题，而是“用什么更合适”。Redux 曾是主流选择，但其样板代码多、学习曲线陡峭的问题一直为人诟病。而 <strong>Zustand</strong> 的出现，以极简 API、Hooks 友好、零依赖和内置持久化能力，为开发者提供了一种更清爽、更高效的解决方案。它不追求大而全，却在“够用、好用、易维护”上做到了极致。</p>
<h2 data-id="heading-0">为什么需要全局状态？</h2>
<p>React 组件天然具备局部状态（<code>useState</code>），但当多个组件需要共享数据（如用户登录信息、全局主题、未完成任务数）时，状态提升或 Context 会迅速变得笨重。这时，一个<strong>集中式、可预测、可追踪</strong>的状态仓库就显得尤为重要。Zustand 正是为此而生——它像一个中央数据库，所有组件都能从中读取或更新数据，且更新逻辑被严格封装。</p>
<h2 data-id="heading-1">核心理念：一切皆 Hook</h2>
<p>Zustand 完全基于 React Hooks 设计，使用方式极其自然：</p>
<pre><code class="hljs language-scss" lang="scss">const { count, increment } = <span class="hljs-built_in">useCounterStore</span>();
</code></pre>
<p>无需 Provider 包裹根组件，无需 <code>connect</code> 高阶组件，直接在任意函数组件中调用 store Hook 即可。这种“即用即取”的体验，大幅降低了状态管理的心理门槛和代码侵入性。</p>
<h2 data-id="heading-2">定义 Store：类型安全 + 逻辑内聚</h2>
<p>Zustand 鼓励将状态与修改方法定义在一起，并通过 TypeScript 接口明确契约：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">CounterState</span> {
  <span class="hljs-attr">count</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-attr">increment</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span>;
  <span class="hljs-attr">reset</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span>;
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> useCounterStore = create&lt;<span class="hljs-title class_">CounterState</span>&gt;()(
  <span class="hljs-function">(<span class="hljs-params">set</span>) =&gt;</span> ({
    <span class="hljs-attr">count</span>: <span class="hljs-number">0</span>,
    <span class="hljs-attr">increment</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">set</span>(<span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> ({ <span class="hljs-attr">count</span>: state.<span class="hljs-property">count</span> + <span class="hljs-number">1</span> })),
    <span class="hljs-attr">reset</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">set</span>({ <span class="hljs-attr">count</span>: <span class="hljs-number">0</span> }),
  })
);
</code></pre>
<p>这里，<code>set</code> 是 Zustand 提供的更新函数，支持函数式更新（接收当前状态）或直接赋值。所有状态变更都集中在此，逻辑清晰，便于测试和维护。TypeScript 则确保任何地方使用 <code>useCounterStore()</code> 都能获得准确的类型提示和编译检查。</p>
<h2 data-id="heading-3">复杂状态：Todo 列表实战</h2>
<p>对于包含数组或对象的复杂状态，Zustand 同样游刃有余：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-attr">addTodo</span>: <span class="hljs-function">(<span class="hljs-params">title</span>) =&gt;</span> 
  <span class="hljs-title function_">set</span>(<span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> ({ 
    <span class="hljs-attr">todos</span>: [...state.<span class="hljs-property">todos</span>, { <span class="hljs-attr">id</span>: +<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(), title, <span class="hljs-attr">completed</span>: <span class="hljs-literal">false</span> }] 
  }))
</code></pre>
<p>通过展开运算符创建新数组，保持状态不可变性，符合 React 最佳实践。每个操作（添加、切换、删除）都是独立的函数，职责单一，组合灵活。</p>
<h2 data-id="heading-4">内置持久化：一行代码实现本地存储</h2>
<p>Zustand 通过中间件（middleware）机制扩展能力，其中 <code>persist</code> 是最常用的一个：</p>
<pre><code class="hljs language-javascript" lang="javascript">create&lt;<span class="hljs-title class_">CounterState</span>&gt;()(
  <span class="hljs-title function_">persist</span>(
    <span class="hljs-function">(<span class="hljs-params">set</span>) =&gt;</span> ({ <span class="hljs-comment">/* ... */</span> }),
    { <span class="hljs-attr">name</span>: <span class="hljs-string">'counter'</span> }
  )
)
</code></pre>
<p>只需将原始 store 包裹在 <code>persist</code> 中，并指定存储键名（如 <code>'counter'</code>），Zustand 就会自动将状态同步到 <code>localStorage</code>，并在页面刷新后恢复。这对 Todo 列表、用户设置等场景至关重要，且无需手动编写序列化/反序列化逻辑。</p>
<h2 data-id="heading-5">多 Store 分治：关注点分离</h2>
<p>Zustand 不强制单一全局 store。我们可以按功能拆分为多个独立 store：</p>
<ul>
<li><code>useUserStore</code>：管理登录状态与用户信息；</li>
<li><code>useTodoStore</code>：管理任务列表；</li>
<li><code>useCounterStore</code>：管理计数器。</li>
</ul>
<p>每个 store 自包含状态和行为，互不干扰。这种“分而治之”的策略，比单一巨型 store 更易于理解和维护，尤其适合中大型项目。</p>
<h2 data-id="heading-6">实际集成：在组件中消费状态</h2>
<p>在组件中使用 Zustand store 如同使用普通 Hook：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> { todos, addTodo } = <span class="hljs-title function_">useTodoStore</span>();
  <span class="hljs-keyword">const</span> [input, setInput] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">''</span>);

  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleAdd</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-keyword">if</span> (input.<span class="hljs-title function_">trim</span>()) {
      <span class="hljs-title function_">addTodo</span>(input);
      <span class="hljs-title function_">setInput</span>(<span class="hljs-string">''</span>);
    }
  };

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">value</span>=<span class="hljs-string">{input}</span> <span class="hljs-attr">onChange</span>=<span class="hljs-string">{e</span> =&gt;</span> setInput(e.target.value)} /&gt;
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{handleAdd}</span>&gt;</span>添加<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span>
        {todos.map(todo =&gt; (
          <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{todo.id}</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>{todo.title}<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
            {/* ... */}
          <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
        ))}
      <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}
</code></pre>
<p>组件完全不关心状态如何存储或持久化，只专注于 UI 渲染和事件触发。这种解耦让代码更专注、更可测试。</p>
<h2 data-id="heading-7">性能优化：自动选择性订阅</h2>
<p>Zustand 默认会对整个 store 进行浅比较，但若只关心部分状态，可通过 selector 避免不必要的重渲染：</p>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">count</span> = useCounterStore(state =&gt; state.count)<span class="hljs-comment">;</span>
</code></pre>
<p>这样，只有当 <code>count</code> 变化时，组件才会更新，其他字段的变动不会触发重渲染，性能表现优异。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[为什么 Java 的锁锁不住 Kotlin 协程？]]></title>    <link>https://juejin.cn/post/7598921649888985115</link>    <guid>https://juejin.cn/post/7598921649888985115</guid>    <pubDate>2026-01-26T00:11:26.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598921649888985115" data-draft-id="7596710680896569350" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="为什么 Java 的锁锁不住 Kotlin 协程？"/> <meta itemprop="keywords" content="Android"/> <meta itemprop="datePublished" content="2026-01-26T00:11:26.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="潜龙勿用之化骨龙"/> <meta itemprop="url" content="https://juejin.cn/user/2313028195058471"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            为什么 Java 的锁锁不住 Kotlin 协程？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2313028195058471/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    潜龙勿用之化骨龙
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-26T00:11:26.000Z" title="Mon Jan 26 2026 00:11:26 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、问题起手：一个“看起来完全没问题”的代码</h2>
<p>很多人在协程里第一次写到下面这样的代码时，都会觉得<strong>这没什么问题</strong>：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0fd4c2121a79495ba57de370ee4077ac~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5r2c6b6Z5Yu_55So5LmL5YyW6aqo6b6Z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769991086&amp;x-signature=jwsBGfbV7ai5FSOS56KOGNd7K%2Fk%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/650ed8fc2bd941509e2de312ee3413c5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5r2c6b6Z5Yu_55So5LmL5YyW6aqo6b6Z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769991086&amp;x-signature=GZFqD5zYBae7scwhQVQaBr3pSIU%3D" alt="image.png" loading="lazy"/></p>
<ul>
<li>用了 <code>ReentrantLock</code></li>
<li>做了余额判断</li>
<li>甚至切到 <strong>单线程 dispatcher</strong>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/79897acfee9942a4a5427381ac77a496~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5r2c6b6Z5Yu_55So5LmL5YyW6aqo6b6Z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769991086&amp;x-signature=uGh7TAMY%2FW%2B8KUYoLWLuVdidaVM%3D" alt="image.png" loading="lazy"/></li>
</ul>
<p>但真实运行结果却可能是：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">currentBalance</span> = -<span class="hljs-number">500</span>
</code></pre>
<p>更诡异的是：</p>
<ul>
<li><strong>多线程</strong>：直接抛异常</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dc1b3e45f33f4196bb444972158c1af3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5r2c6b6Z5Yu_55So5LmL5YyW6aqo6b6Z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769991086&amp;x-signature=QsoNdWIMwV3N0A%2Bs9LkLsGGmzyc%3D" alt="image.png" loading="lazy"/></p>
<ul>
<li><strong>单线程</strong>：不报错，但结果错</li>
</ul>
<p>这就引出了本文的核心问题：</p>
<blockquote>
<p><strong>为什么 Java 的锁，在协程里看起来“完全不可靠”？</strong></p>
</blockquote>
<hr/>
<h2 data-id="heading-1">二、<code>synchronized</code> 与协程的根本冲突</h2>
<h3 data-id="heading-2">2.1 <code>synchronized</code> 的语义：线程绑定的 JVM monitor</h3>
<p>在 JVM 层面，<code>synchronized</code> 的语义非常明确：</p>
<ul>
<li>
<p>锁的拥有者是 <strong>Thread</strong></p>
</li>
<li>
<p>进入同步块 → 当前线程获取 monitor</p>
</li>
<li>
<p>退出同步块 → <strong>必须由同一个线程释放</strong></p>
</li>
<li>
<p>JVM 假设：</p>
<blockquote>
<p>持锁期间，线程不会“消失”</p>
</blockquote>
</li>
</ul>
<hr/>
<h3 data-id="heading-3">2.2 协程的语义：可挂起、可恢复、可迁移</h3>
<p>而协程的 <code>suspend</code> 意味着：</p>
<ul>
<li>
<p>当前逻辑执行可以 <strong>挂起</strong></p>
</li>
<li>
<p>线程会被 <strong>释放</strong></p>
</li>
<li>
<p>恢复时：</p>
<ul>
<li>可能是同一个线程</li>
<li>也可能是另一个线程</li>
</ul>
</li>
</ul>
<p>也就是说：</p>
<blockquote>
<p><strong>协程绑定的是“逻辑执行流”，
而不是某个固定线程。</strong></p>
</blockquote>
<hr/>
<h3 data-id="heading-4">2.3 语义正面冲突</h3>
<p>如果允许下面的代码存在：</p>
<pre><code class="hljs language-kotlin" lang="kotlin">synchronized(lock) {
    delay(<span class="hljs-number">1000</span>)
}
</code></pre>
<p>那么 JVM 将面对一个无法成立的事实：</p>
<ul>
<li>monitor 是线程 A 拿的</li>
<li>delay 后代码可能在线程 B 执行</li>
<li>线程 B 却在“同步块”中运行</li>
</ul>
<p>这会直接破坏 JVM 对 monitor 的基本假设。</p>
<p>👉 因此 Kotlin 的选择是：</p>
<blockquote>
<p><strong>在编译期直接禁止：
synchronized / @Synchronized 中不能出现挂起点</strong></p>
</blockquote>
<hr/>
<h2 data-id="heading-5">三、为什么 <code>ReentrantLock</code> 却能“正常编译”？</h2>
<h3 data-id="heading-6">3.1 语言级 vs 库级</h3>
<ul>
<li><code>synchronized</code> 是 <strong>语言级特性</strong></li>
<li><code>ReentrantLock</code> 是 <strong>普通 Java 类</strong></li>
</ul>
<pre><code class="hljs language-kotlin" lang="kotlin">lock.lock()
delay(<span class="hljs-number">1000</span>)
lock.unlock()
</code></pre>
<p>在 Kotlin 编译器看来，这只是普通方法调用：</p>
<blockquote>
<p>“我不知道你这是锁，
我也不知道你有什么语义。”</p>
</blockquote>
<p>所以：</p>
<ul>
<li>编译期 <strong>不拦</strong></li>
<li>风险 <strong>全部留给运行期</strong></li>
</ul>
<hr/>
<h2 data-id="heading-7">四、同一段代码，<code>ReentrantLock</code> 的两种结局</h2>
<p>我们统一看下面这段代码：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/79897acfee9942a4a5427381ac77a496~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5r2c6b6Z5Yu_55So5LmL5YyW6aqo6b6Z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769991086&amp;x-signature=uGh7TAMY%2FW%2B8KUYoLWLuVdidaVM%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-8">4.1 多线程调度：<strong>直接抛异常</strong></h3>
<p>如果在多线程 dispatcher 下运行：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a6938110d8be4dc28d1406ba7197b9eb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5r2c6b6Z5Yu_55So5LmL5YyW6aqo6b6Z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769991086&amp;x-signature=s5yQyFgNOvmUHO0akxjE23qjn5o%3D" alt="image.png" loading="lazy"/></p>
<p>这个启动协程去线程调度和在方法上线程调度 本质是一样的.
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0fd4c2121a79495ba57de370ee4077ac~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5r2c6b6Z5Yu_55So5LmL5YyW6aqo6b6Z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769991086&amp;x-signature=jwsBGfbV7ai5FSOS56KOGNd7K%2Fk%3D" alt="image.png" loading="lazy"/></p>
<p>你很快会看到：</p>
<pre><code class="hljs">IllegalMonitorStateException
</code></pre>
<p>原因非常直接：</p>
<ul>
<li><code>lock.lock()</code> 在 <strong>线程 A</strong></li>
<li><code>delay()</code> 挂起后释放线程</li>
<li>协程恢复时可能在 <strong>线程 B</strong></li>
<li><code>lock.unlock()</code> 却由线程 B 执行</li>
</ul>
<p>而 JVM 的规则是：</p>
<blockquote>
<p>❌ <strong>只能由拿锁的线程释放锁</strong></p>
</blockquote>
<p>👉 这是 JVM 级非法行为，直接抛异常。</p>
<h3 data-id="heading-9">4.2 单线程调度：<strong>不报错，但结果是 -500</strong></h3>
<p>很多人会尝试“绕过”这个问题：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">val</span> dispatcher = newSingleThreadContext(<span class="hljs-string">"single"</span>)
</code></pre>
<p>在这种情况下：</p>
<ul>
<li><code>lock.lock()</code> / <code>unlock()</code>
确实发生在同一个 Thread 实例</li>
<li>不会抛异常</li>
</ul>
<p><strong>但结果却可能是：</strong></p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">currentBalance</span> = -<span class="hljs-number">500</span>
</code></pre>
<hr/>
<h3 data-id="heading-10">4.3 为什么单线程下也会算错？</h3>
<p>因为问题已经不是“线程安全”，而是：</p>
<blockquote>
<p><strong>挂起把“时间”引进了临界区</strong></p>
</blockquote>
<p>真实执行时间线（单线程）：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">balance</span> = <span class="hljs-number">1000</span>
启动 3 个协程
</code></pre>
<ul>
<li>协程 A：判断通过 → delay</li>
<li>1 秒后：扣 500 → balance = 500</li>
<li>协程 B：判断通过 → delay</li>
<li>1 秒后：扣 500 → balance = 0</li>
<li>协程 C：判断在 delay 前已成立 → 再扣 500</li>
</ul>
<p>最终结果：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">balance</span> = -<span class="hljs-number">500</span>
</code></pre>
<p>⚠️ 注意：</p>
<ul>
<li>没有线程并发</li>
<li>锁没有失效</li>
<li><strong>只是判断结果在 suspend 后已经过期</strong></li>
</ul>
<hr/>
<h3 data-id="heading-11">4.4 小结：两种死法</h3>

























<table><thead><tr><th>场景</th><th>表现</th><th>根因</th></tr></thead><tbody><tr><td>多线程 + Lock</td><td>抛异常</td><td>锁 owner 是 Thread</td></tr><tr><td>单线程 + Lock</td><td>结果错误</td><td>时间竞态</td></tr><tr><td>任意线程 + Mutex</td><td>语义成立</td><td>锁绑定协程</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-12">五、为什么 <code>Mutex</code> 在协程里是“语义正确”的</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c151e2b3eacc47a1873f87ff919d5ef4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5r2c6b6Z5Yu_55So5LmL5YyW6aqo6b6Z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769991086&amp;x-signature=pvkgTuUE39edYhNgW%2FKKGLxNTko%3D" alt="image.png" loading="lazy"/></p>
<p><code>Mutex</code> 的关键区别在于：</p>
<ul>
<li>它锁的不是线程</li>
<li>而是 <strong>协程执行权</strong></li>
</ul>
<p>也就是说：</p>
<pre><code class="hljs language-text" lang="text">ReentrantLock → owner = Thread
Mutex         → owner = Coroutine
</code></pre>
<p>因此：</p>
<ul>
<li>挂起不会破坏锁语义</li>
<li>恢复后仍是同一个逻辑执行者</li>
</ul>
<h2 data-id="heading-13">六、总结</h2>
<p>ReentrantLock 的世界观是：
❌ 锁的 owner 必须是同一个线程</p>
<p>而协程的世界观是：
✅ 只要是“同一个协程”，逻辑就是连续的</p>
<p>当线程锁遇到可迁移执行的协程时，
两套宇宙法则发生了正面冲突。</p>
<ul>
<li><code>synchronized</code>
→ JVM 线程模型
→ <strong>编译期禁止 suspend</strong></li>
<li><code>ReentrantLock</code>
→ 库级 API
→ <strong>运行期风险自负</strong></li>
<li><code>Mutex</code>
→ 协程原生同步
→ <strong>唯一语义正确的选择</strong></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[失业，仲裁，都赶上了（四）]]></title>    <link>https://juejin.cn/post/7599268297202270246</link>    <guid>https://juejin.cn/post/7599268297202270246</guid>    <pubDate>2026-01-26T00:12:26.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599268297202270246" data-draft-id="7598464972912984104" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="失业，仲裁，都赶上了（四）"/> <meta itemprop="keywords" content="前端,JavaScript,程序员"/> <meta itemprop="datePublished" content="2026-01-26T00:12:26.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="前端切圖仔"/> <meta itemprop="url" content="https://juejin.cn/user/1460596659193351"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            失业，仲裁，都赶上了（四）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1460596659193351/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    前端切圖仔
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-26T00:12:26.000Z" title="Mon Jan 26 2026 00:12:26 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>很久没有写文章了，再次敲下键盘，没想到手居然有点生疏起来。</p>
<p>当这篇文章发出去的时候，我应该是在开庭的路上了（本来想设定时发送，没想到这么久了，这功能还没有）。</p>
<p>回过头看了这个<a href="https://juejin.cn/column/7441405701607079990" target="_blank" title="https://juejin.cn/column/7441405701607079990">系列</a>，真的十分十分谢谢大家对我的鼓励！</p>
<p>那么久没写文章：</p>
<ul>
<li>第一是，真的懒了；</li>
<li>第二是，在我2024年11月失业过后的7个月里，我思考经历了很多。有开心，有自由，有焦虑，有迷茫。但没关系，现在基本都过去了。</li>
</ul>
<p>这篇文章大概讲讲我那会失业后的生活，还有仲裁的结果。希望给到失业了的，或可能即将失业的朋友一些参考。</p>
<h2 data-id="heading-1">自由</h2>
<p>在我失业后，我第一个收获到的是自由。</p>
<p>记得上班的时候，工作日两点一线，平时周末可能还要被占据去加班，因此平常想做的事，基本没有时间去做，只想在工作之余好好的休息。</p>
<p>所以，趁着失业，我回去看望了我很久没见的外婆，整理了我乱糟糟的房间，陪了陪家人；我做了很多平时没有时间去做的事情。</p>
<p>但有点出乎意料的是，在工作日工作时间出去时，发现虽然人比平时少，但也没少多少。我在工作时间去的游泳馆，里面虽然大部分是上了年纪的人在游泳，但是年轻人也很多。后面我乍一想，这些人如果不是家里有矿的话，那估计是都跟我一样失业了，这个时间点才有时间来游泳吧。</p>
<p>平时工作想请假，公司就像没了你运营不了似得，不是卡你流程，就是不会让你请那么多天。</p>
<p>因此趁着失业，我也去旅游了好几个地方，当作是给我工作那么久以来的犒劳：</p>
<ul>
<li>去南京看了枫叶</li>
<li>去济州岛第一次看到雪</li>
<li>第一次一个人旅游，去了趟北京，当做送给自己30岁的礼物</li>
</ul>
<p>没了工作后，本以为每天生活会很无聊，但其实每天都有事情做，虽然大部分是家庭琐事，但是依旧让人觉得是充实的。</p>
<h2 data-id="heading-2">焦虑</h2>
<p>在收获了几个月的自由后，随之而来的是焦虑感。</p>
<p>虽然我还有点存款，但生活是要成本的。我每个月都会有固定的支出，看着自己的钱只出不进，那种焦虑感真的很可怕。你会不断地想着如果这些钱都花完了怎么办。</p>
<p>所以后几个月我几乎：</p>
<ul>
<li>每天都在刷招聘软件，有适合一点的岗位我就投递</li>
<li>加入各种前端兼职群，看能不能碰碰运气拿点单子做</li>
<li>开始想着要不要先去奶茶店或者什么店兼职</li>
</ul>
<p><strong>不出所料的是，基本没有什么回应。</strong></p>
<p>也许是平时我待人真诚，没什么心眼，谢谢上天对我眷顾🙏🏻。后期我十分意外的接到了一个外包，帮一个公司开发一个小程序。</p>
<p>本来我以为毕竟是外包，且又是不认识的人，合作的过程中会十分难熬。但是在合作的过程中，除了工作量大点，其他方面都是很不错的，最重要的是大家沟通的都十分愉快。在一些交付的时间节点上，大家也不是很死板，而是有商有量，他们会说没事，慢慢做。</p>
<p>当然，在这个过程中，我也有很强烈的契约精神。即使交付时间可以商量，但之前说好的交付时间点，我依旧会熬夜完成，因为我觉得信任跟真诚是相互的，这样才会是一个良性循环。</p>
<p>后期小程序顺利上线，我当然也小小的回血了一波。</p>
<p>我十分感激在我十分焦虑的那个时间段里，遇到了这些陌生人。虽然我们是相互合作的关系，但我还是要在这里说声谢谢。我不清楚如果当时我没有这么好的运气接到这个外包，后面的我会怎么样。但是我觉得真诚对人，善良对人，后面也许这些都会在冥冥中以你不知道的方式也回馈给你。</p>
<h2 data-id="heading-3">工作</h2>
<p>再说说工作。</p>
<p>我刚开头投递了一阵子，确实没什么回应。但是后期接到外包后，我也没有时间去想下一份工作的事，因为实在是太忙了。</p>
<p>再后面，我朋友内推我进了一家公司。虽然是薪资没有以前高，但是每天准时下班，基本不加班，而且是相对比较稳定的公司。虽然有些方面我感觉不太合适，但是现在的我更想追求稳定了。</p>
<p>现在的我工作更关注的是好不好请假，稳不稳定。不是我失去了上进心，是我觉得如果去的都是小公司，当下环境，似乎很难再攀升，不如在一个稳定的地方更认真的做，或许也是个不错的选择。至于薪资，只要认真做，有产出，都会有机会的。</p>
<p>我也想对失业没找到工作的朋友说：不要气馁，不是能力不行，是现在的大环境也许就是这样。现在找工作，更多的是靠内推，还有需要些许的运气，所以千万不要内耗。</p>
<h2 data-id="heading-4">仲裁结果</h2>
<p>在2月份仲裁结束以后，大概4月份我终于收到了仲裁结果。<strong>很开心的告诉大家，我仲裁成功了！诉求都得到了支持！再次谢谢大家对我的关注与鼓励！</strong></p>
<p>这不单是我一个人的胜利，是属于打工人的胜利！✌🏻</p>
<p>仲裁结果:</p>
<ul>
<li>支付我<code>N</code>的济补偿金</li>
<li>支付我剩余未休年假金额</li>
<li>支付我的律师费</li>
</ul>
<p>但是好景不长。在拿到仲裁判决书后，我找老板就仲裁结果进行了谈判，结果当然是他不会赔那么多，所以他提起了一审诉讼。</p>
<p>这样的结果，我也早就预料在内，这本身就是一场持久战。</p>
<p>现在的我，无所畏惧，而且也没有什么可以失去的了。欠我的薪资已经追回，工作让我有了底气，仲裁我也赢了。</p>
<p>于是4月份，我也整理相应资料应诉了。并且，在应诉的过程中，我也申请了财产保全，已经成功冻住了公司的钱。所以，不要同情资本家！不是真的没钱，就是不想赔而已。</p>
<p>因此，整个周期时长为：</p>
<ul>
<li>2024年11月底左右提交的仲裁申请</li>
<li>2024年12月中左右收到开庭通知</li>
<li>开庭时间为2025年2月中左右</li>
<li>2025年4月左右出了结果，仲裁胜利</li>
<li>2025年4月应诉准备一审</li>
<li>2026年1月底左右进行一审开庭</li>
</ul>
<p>整个过程到一审，大概一年多的时间。我个人觉得还蛮快的，可能是因为我的案件清晰，基本没有什么争议点。但是，我也做好了继续二审的准备。</p>
<blockquote>
<p><strong>另外，这个系列的文章可能会更新的慢，但是一定不会断！因为我想告诉大家一个完整的过程。在私信里，我也有收到一些朋友的疑问，也很开心能帮助到一些朋友。</strong></p>
</blockquote>
<h2 data-id="heading-5">最后</h2>
<p>失业的那段时间里，我觉得也是收获了我人生很宝贵的一段时间，尤其是刚开头失业那段时间。</p>
<p>那段时间，我觉得我的生活变慢了。我有时间去好好感受我身边发生的事情，真正的体会到原来除了工作，其实每天还有很多别的无聊的、有趣的、意外的事情发生，我感触很多。</p>
<p>于是我也开了一个公众号——<strong>小日记大本子</strong>，我想把我遇到的、或者想到的一些事情记录下来，仅仅只是个人的一些感受，如果大家有兴趣，当然欢迎关注一波.</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8599713a120f4fb48b2174830276a194~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5YiH5ZyW5LuU:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769991145&amp;x-signature=nbOlXNQeWgBaMwWIN2qUIPE4IWc%3D" alt="qrcode_for_gh_0350ce2077c3_258.jpg" loading="lazy"/></p>
<h2 data-id="heading-6">最后的最后</h2>
<p>再次谢谢所有为我鼓励的人。</p>
<p>下一次更新，应该是在一审判决出来了。但我现在时不时会在公众号更新文章。</p>
<p>今天走在开庭的路上，天气看不出好坏。但是没关系，有阳光照耀过地方，一定会更加美丽！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[CopyOnWriteArrayList：写时复制机制与高效并发访问]]></title>    <link>https://juejin.cn/post/7598807837868261402</link>    <guid>https://juejin.cn/post/7598807837868261402</guid>    <pubDate>2026-01-26T00:14:31.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598807837868261402" data-draft-id="7598401650856738816" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" CopyOnWriteArrayList：写时复制机制与高效并发访问"/> <meta itemprop="keywords" content="Java"/> <meta itemprop="datePublished" content="2026-01-26T00:14:31.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="SevenCoding"/> <meta itemprop="url" content="https://juejin.cn/user/3261615728242467"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             CopyOnWriteArrayList：写时复制机制与高效并发访问
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3261615728242467/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    SevenCoding
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-26T00:14:31.000Z" title="Mon Jan 26 2026 00:14:31 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>Vector无论是add方法还是get方法都加上了<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.seven97.top%2Fjava%2Fconcurrent%2F02-keyword1-synchronized.html" target="_blank" title="https://www.seven97.top/java/concurrent/02-keyword1-synchronized.html" ref="nofollow noopener noreferrer"><strong>synchronized</strong></a>修饰，当多线程读写List必须排队执行，很显然这样效率比较是低下的，CopyOnWriteArrayList是读写分离的，好处是提高线程访问效率。</p>
<p>CopyOnWrite容器即<strong>写时复制</strong>的容器。通俗的理解是当往一个容器添加元素的时候，不直接往当前容器添加，而是先将当前容器里的值Copy到新的容器，然后再往新的容器里添加元素，添加完元素之后，再将原容器的引用指向新的容器。这样做的好处是我们可以对CopyOnWrite容器进行并发的读 要加锁，因为当前容器不会添加任何元素。所以CopyOnWrite容器也是一种读写分离的思想，读和写不同的容器。</p>
<h2 data-id="heading-1">底层原理</h2>
<ol>
<li>CopyOnWriteArrayList的动态数组机制 -- 它内部有个volatile数组(array)来保持数据。在“添加/删除”数据时，都会新建一个数组，并将更新后的数据拷贝到新建的数组中，最后再将该数组赋值给volatile数组。这就是它叫做CopyOnWriteArrayList的原因！</li>
<li>每一个CopyOnWriteArrayList都和一个监视器锁lock绑定，通过lock，实现了对CopyOnWriteArrayList的互斥添加/删除。</li>
</ol>
<h3 data-id="heading-2">类的继承关系</h3>
<p>CopyOnWriteArrayList实现了List接口，List接口定义了对列表的基本操作；同时实现了RandomAccess接口，表示可以随机访问(数组具有随机访问的特性)；同时实现了Cloneable接口，表示可克隆；同时也实现了Serializable接口，表示可被序列化。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CopyOnWriteArrayList</span>&lt;E&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title class_">List</span>&lt;E&gt;, RandomAccess, Cloneable, java.io.Serializable {}
</code></pre>
<h3 data-id="heading-3">类的内部类</h3>
<ul>
<li>COWIterator类</li>
</ul>
<p>COWIterator表示迭代器，其也有一个Object类型的数组作为CopyOnWriteArrayList数组的快照，这种快照风格的迭代器方法在创建迭代器时使用了对当时数组状态的引用。此数组在迭代器的生存期内不会更改，因此不可能发生冲突，并且迭代器保证不会抛出 ConcurrentModificationException。创建迭代器以后，迭代器就不会反映列表的添加、移除或者更改。在迭代器上进行的元素更改操作(remove、set 和 add)不受支持。这些方法将抛出 UnsupportedOperationException。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">COWIterator</span>&lt;E&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ListIterator</span>&lt;E&gt; {
    <span class="hljs-comment">/** Snapshot of the array */</span>
    <span class="hljs-comment">// 快照</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Object[] snapshot;
    <span class="hljs-comment">/** Index of element to be returned by subsequent call to next.  */</span>
    <span class="hljs-comment">// 游标</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> cursor;
    <span class="hljs-comment">// 构造函数</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title function_">COWIterator</span><span class="hljs-params">(Object[] elements, <span class="hljs-type">int</span> initialCursor)</span> {
        cursor = initialCursor;
        snapshot = elements;
    }
    <span class="hljs-comment">// 是否还有下一项</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">hasNext</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> cursor &lt; snapshot.length;
    }
    <span class="hljs-comment">// 是否有上一项</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">hasPrevious</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> cursor &gt; <span class="hljs-number">0</span>;
    }
    <span class="hljs-comment">// next项</span>
    <span class="hljs-meta">@SuppressWarnings("unchecked")</span>
    <span class="hljs-keyword">public</span> E <span class="hljs-title function_">next</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">if</span> (! hasNext()) <span class="hljs-comment">// 不存在下一项，抛出异常</span>
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NoSuchElementException</span>();
        <span class="hljs-comment">// 返回下一项</span>
        <span class="hljs-keyword">return</span> (E) snapshot[cursor++];
    }

    <span class="hljs-meta">@SuppressWarnings("unchecked")</span>
    <span class="hljs-keyword">public</span> E <span class="hljs-title function_">previous</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">if</span> (! hasPrevious())
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NoSuchElementException</span>();
        <span class="hljs-keyword">return</span> (E) snapshot[--cursor];
    }
    
    <span class="hljs-comment">// 下一项索引</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">nextIndex</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> cursor;
    }
    
    <span class="hljs-comment">// 上一项索引</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">previousIndex</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> cursor-<span class="hljs-number">1</span>;
    }

    <span class="hljs-comment">/**
        * Not supported. Always throws UnsupportedOperationException.
        * <span class="hljs-doctag">@throws</span> UnsupportedOperationException always; {<span class="hljs-doctag">@code</span> remove}
        *         is not supported by this iterator.
        */</span>
    <span class="hljs-comment">// 不支持remove操作</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">remove</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UnsupportedOperationException</span>();
    }

    <span class="hljs-comment">/**
        * Not supported. Always throws UnsupportedOperationException.
        * <span class="hljs-doctag">@throws</span> UnsupportedOperationException always; {<span class="hljs-doctag">@code</span> set}
        *         is not supported by this iterator.
        */</span>
    <span class="hljs-comment">// 不支持set操作</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">set</span><span class="hljs-params">(E e)</span> {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UnsupportedOperationException</span>();
    }

    <span class="hljs-comment">/**
        * Not supported. Always throws UnsupportedOperationException.
        * <span class="hljs-doctag">@throws</span> UnsupportedOperationException always; {<span class="hljs-doctag">@code</span> add}
        *         is not supported by this iterator.
        */</span>
    <span class="hljs-comment">// 不支持add操作</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">add</span><span class="hljs-params">(E e)</span> {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UnsupportedOperationException</span>();
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">forEachRemaining</span><span class="hljs-params">(Consumer&lt;? <span class="hljs-built_in">super</span> E&gt; action)</span> {
        Objects.requireNonNull(action);
        Object[] elements = snapshot;
        <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">size</span> <span class="hljs-operator">=</span> elements.length;
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> cursor; i &lt; size; i++) {
            <span class="hljs-meta">@SuppressWarnings("unchecked")</span> <span class="hljs-type">E</span> <span class="hljs-variable">e</span> <span class="hljs-operator">=</span> (E) elements[i];
            action.accept(e);
        }
        cursor = size;
    }
}
</code></pre>
<h3 data-id="heading-4">类的属性</h3>
<p>属性中有一个可重入锁，用来保证线程安全访问，还有一个Object类型的数组，用来存放具体的元素。当然，也使用到了反射机制和CAS来保证原子性的修改lock域。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CopyOnWriteArrayList</span>&lt;E&gt;
    <span class="hljs-keyword">implements</span> <span class="hljs-title class_">List</span>&lt;E&gt;, RandomAccess, Cloneable, java.io.Serializable {
    <span class="hljs-comment">// 版本序列号</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">serialVersionUID</span> <span class="hljs-operator">=</span> <span class="hljs-number">8673264195747942595L</span>;
    <span class="hljs-comment">// 可重入锁</span>
    <span class="hljs-keyword">final</span> <span class="hljs-keyword">transient</span> <span class="hljs-type">ReentrantLock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantLock</span>();
    <span class="hljs-comment">// 对象数组，用于存放元素</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">transient</span> <span class="hljs-keyword">volatile</span> Object[] array;
    <span class="hljs-comment">// 反射机制</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> sun.misc.Unsafe UNSAFE;
    <span class="hljs-comment">// lock域的内存偏移量</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> lockOffset;
    <span class="hljs-keyword">static</span> {
        <span class="hljs-keyword">try</span> {
            UNSAFE = sun.misc.Unsafe.getUnsafe();
            Class&lt;?&gt; k = CopyOnWriteArrayList.class;
            lockOffset = UNSAFE.objectFieldOffset
                (k.getDeclaredField(<span class="hljs-string">"lock"</span>));
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(e);
        }
    }
}
</code></pre>
<h3 data-id="heading-5">类的构造函数</h3>
<ul>
<li>默认构造函数</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-title function_">CopyOnWriteArrayList</span><span class="hljs-params">()</span> {
    <span class="hljs-comment">// 设置数组</span>
    setArray(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[<span class="hljs-number">0</span>]);
}
</code></pre>
<ul>
<li>CopyOnWriteArrayList(Collection&lt;? extends E&gt;)</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-title function_">CopyOnWriteArrayList</span><span class="hljs-params">(Collection&lt;? extends E&gt; c)</span> {
    Object[] elements;
    <span class="hljs-keyword">if</span> (c.getClass() == CopyOnWriteArrayList.class) <span class="hljs-comment">// 类型相同</span>
        <span class="hljs-comment">// 获取c集合的数组</span>
        elements = ((CopyOnWriteArrayList&lt;?&gt;)c).getArray();
    <span class="hljs-keyword">else</span> { <span class="hljs-comment">// 类型不相同</span>
        <span class="hljs-comment">// 将c集合转化为数组并赋值给elements</span>
        elements = c.toArray();
        <span class="hljs-comment">// c.toArray might (incorrectly) not return Object[] (see 6260652)</span>
        <span class="hljs-keyword">if</span> (elements.getClass() != Object[].class) <span class="hljs-comment">// elements类型不为Object[]类型</span>
            <span class="hljs-comment">// 将elements数组转化为Object[]类型的数组</span>
            elements = Arrays.copyOf(elements, elements.length, Object[].class);
    }
    <span class="hljs-comment">// 设置数组</span>
    setArray(elements);
}

</code></pre>
<p>该构造函数的处理流程如下</p>
<ol>
<li>
<p>判断传入的集合c的类型是否为CopyOnWriteArrayList类型，若是，则获取该集合类型的底层数组(Object[])，并且设置当前CopyOnWriteArrayList的数组(Object[]数组)，进入步骤③；否则，进入步骤②</p>
</li>
<li>
<p>将传入的集合转化为数组elements，判断elements的类型是否为Object[]类型(toArray方法可能不会返回Object类型的数组)，若不是，则将elements转化为Object类型的数组。进入步骤③</p>
</li>
<li>
<p>设置当前CopyOnWriteArrayList的Object[]为elements。</p>
</li>
</ol>
<ul>
<li>CopyOnWriteArrayList(E[])：该构造函数用于创建一个保存给定数组的副本的列表。</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-title function_">CopyOnWriteArrayList</span><span class="hljs-params">(E[] toCopyIn)</span> {
    <span class="hljs-comment">// 将toCopyIn转化为Object[]类型数组，然后设置当前数组</span>
    setArray(Arrays.copyOf(toCopyIn, toCopyIn.length, Object[].class));
}
</code></pre>
<h3 data-id="heading-6">核心函数分析</h3>
<p>对于CopyOnWriteArrayList的函数分析，主要明白Arrays.copyOf方法即可理解CopyOnWriteArrayList其他函数的意义。</p>
<h4 data-id="heading-7">copyOf函数</h4>
<p>该函数用于复制指定的数组，截取或用 null 填充(如有必要)，以使副本具有指定的长度。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;T,U&gt; T[] copyOf(U[] original, <span class="hljs-type">int</span> newLength, Class&lt;? <span class="hljs-keyword">extends</span> <span class="hljs-title class_">T</span>[]&gt; newType) {
    <span class="hljs-meta">@SuppressWarnings("unchecked")</span>
    <span class="hljs-comment">// 确定copy的类型(将newType转化为Object类型，将Object[].class转化为Object类型；</span>
    <span class="hljs-comment">// 判断两者是否相等，若相等，则生成指定长度的Object数组</span>
    <span class="hljs-comment">// 否则,生成指定长度的新类型的数组)</span>
    T[] copy = ((Object)newType == (Object)Object[].class)
        ? (T[]) <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[newLength]
        : (T[]) Array.newInstance(newType.getComponentType(), newLength);
    <span class="hljs-comment">// 将original数组从下标0开始，复制长度为(original.length和newLength的较小者),复制到copy数组中(也从下标0开始)</span>
    System.arraycopy(original, <span class="hljs-number">0</span>, copy, <span class="hljs-number">0</span>,
                        Math.min(original.length, newLength));
    <span class="hljs-keyword">return</span> copy;
}
</code></pre>
<h4 data-id="heading-8">add函数</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">add</span><span class="hljs-params">(E e)</span> {
    <span class="hljs-comment">// 可重入锁</span>
    <span class="hljs-keyword">final</span> <span class="hljs-type">ReentrantLock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.lock;
    <span class="hljs-comment">// 获取锁</span>
    lock.lock();
    <span class="hljs-keyword">try</span> {
        <span class="hljs-comment">// 元素数组</span>
        Object[] elements = getArray();
        <span class="hljs-comment">// 数组长度</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">len</span> <span class="hljs-operator">=</span> elements.length;
        <span class="hljs-comment">// 复制数组</span>
        Object[] newElements = Arrays.copyOf(elements, len + <span class="hljs-number">1</span>);
        <span class="hljs-comment">// 存放元素e</span>
        newElements[len] = e;
        <span class="hljs-comment">// 设置数组</span>
        setArray(newElements);
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    } <span class="hljs-keyword">finally</span> {
        <span class="hljs-comment">// 释放锁</span>
        lock.unlock();
    }
}
</code></pre>
<p>此函数用于将指定元素添加到此列表的尾部，处理流程如下</p>
<ol>
<li>获取锁(保证多线程的安全访问)，获取当前的Object数组，获取Object数组的长度为length，进入步骤②。</li>
<li>根据Object数组复制一个长度为length+1的Object数组为newElements(此时，newElements[length]为null)，进入下一步骤。</li>
<li>将下标为length的数组元素newElements[length]设置为元素e，再设置当前Object[]为newElements，释放锁，返回。这样就完成了元素的添加。</li>
</ol>
<h4 data-id="heading-9">addIfAbsent方法</h4>
<p>该函数用于添加元素(如果数组中不存在，则添加；否则，不添加，直接返回)，可以保证多线程环境下不会重复添加元素。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">addIfAbsent</span><span class="hljs-params">(E e, Object[] snapshot)</span> {
    <span class="hljs-comment">// 重入锁</span>
    <span class="hljs-keyword">final</span> <span class="hljs-type">ReentrantLock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.lock;
    <span class="hljs-comment">// 获取锁</span>
    lock.lock();
    <span class="hljs-keyword">try</span> {
        <span class="hljs-comment">// 获取数组</span>
        Object[] current = getArray();
        <span class="hljs-comment">// 数组长度</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">len</span> <span class="hljs-operator">=</span> current.length;
        <span class="hljs-keyword">if</span> (snapshot != current) { <span class="hljs-comment">// 快照不等于当前数组，对数组进行了修改</span>
            <span class="hljs-comment">// Optimize for lost race to another addXXX operation</span>
            <span class="hljs-comment">// 取较小者</span>
            <span class="hljs-type">int</span> <span class="hljs-variable">common</span> <span class="hljs-operator">=</span> Math.min(snapshot.length, len);
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; common; i++) <span class="hljs-comment">// 遍历</span>
                <span class="hljs-keyword">if</span> (current[i] != snapshot[i] &amp;&amp; eq(e, current[i])) <span class="hljs-comment">// 当前数组的元素与快照的元素不相等并且e与当前元素相等</span>
                    <span class="hljs-comment">// 表示在snapshot与current之间修改了数组，并且设置了数组某一元素为e，已经存在</span>
                    <span class="hljs-comment">// 返回</span>
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
            <span class="hljs-keyword">if</span> (indexOf(e, current, common, len) &gt;= <span class="hljs-number">0</span>) <span class="hljs-comment">// 在当前数组中找到e元素</span>
                <span class="hljs-comment">// 返回</span>
                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }
        <span class="hljs-comment">// 复制数组</span>
        Object[] newElements = Arrays.copyOf(current, len + <span class="hljs-number">1</span>);
        <span class="hljs-comment">// 对数组len索引的元素赋值为e</span>
        newElements[len] = e;
        <span class="hljs-comment">// 设置数组</span>
        setArray(newElements);
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    } <span class="hljs-keyword">finally</span> {
        <span class="hljs-comment">// 释放锁</span>
        lock.unlock();
    }
}
</code></pre>
<p>该函数的流程如下:</p>
<ol>
<li>
<p>获取锁，获取当前数组为current，current长度为len，判断数组之前的快照snapshot是否等于当前数组current，若不相等，则进入步骤2；否则，进入步骤4</p>
</li>
<li>
<p>不相等，表示在snapshot与current之间，对数组进行了修改(如进行了add、set、remove等操作)，获取长度(snapshot与current之间的较小者)，对current进行遍历操作，若遍历过程发现snapshot与current的元素不相等并且current的元素与指定元素相等(可能进行了set操作)，进入步骤5，否则，进入步骤3</p>
</li>
<li>
<p>在当前数组中索引指定元素，若能够找到，进入步骤5，否则，进入步骤4</p>
</li>
<li>
<p>复制当前数组current为newElements，长度为len+1，此时newElements[len]为null。再设置newElements[len]为指定元素e，再设置数组，进入步骤5</p>
</li>
<li>
<p>释放锁，返回。</p>
</li>
</ol>
<h4 data-id="heading-10">set函数</h4>
<p>此函数用于用指定的元素替代此列表指定位置上的元素，也是基于数组的复制来实现的。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> E <span class="hljs-title function_">set</span><span class="hljs-params">(<span class="hljs-type">int</span> index, E element)</span> {
    <span class="hljs-comment">// 可重入锁</span>
    <span class="hljs-keyword">final</span> <span class="hljs-type">ReentrantLock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.lock;
    <span class="hljs-comment">// 获取锁</span>
    lock.lock();
    <span class="hljs-keyword">try</span> {
        <span class="hljs-comment">// 获取数组</span>
        Object[] elements = getArray();
        <span class="hljs-comment">// 获取index索引的元素</span>
        <span class="hljs-type">E</span> <span class="hljs-variable">oldValue</span> <span class="hljs-operator">=</span> get(elements, index);

        <span class="hljs-keyword">if</span> (oldValue != element) { <span class="hljs-comment">// 旧值等于element</span>
            <span class="hljs-comment">// 数组长度</span>
            <span class="hljs-type">int</span> <span class="hljs-variable">len</span> <span class="hljs-operator">=</span> elements.length;
            <span class="hljs-comment">// 复制数组</span>
            Object[] newElements = Arrays.copyOf(elements, len);
            <span class="hljs-comment">// 重新赋值index索引的值</span>
            newElements[index] = element;
            <span class="hljs-comment">// 设置数组</span>
            setArray(newElements);
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// Not quite a no-op; ensures volatile write semantics</span>
            <span class="hljs-comment">// 设置数组</span>
            setArray(elements);
        }
        <span class="hljs-comment">// 返回旧值</span>
        <span class="hljs-keyword">return</span> oldValue;
    } <span class="hljs-keyword">finally</span> {
        <span class="hljs-comment">// 释放锁</span>
        lock.unlock();
    }
}
</code></pre>
<h4 data-id="heading-11">remove函数</h4>
<p>此函数用于移除此列表指定位置上的元素。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> E <span class="hljs-title function_">remove</span><span class="hljs-params">(<span class="hljs-type">int</span> index)</span> {
    <span class="hljs-comment">// 可重入锁</span>
    <span class="hljs-keyword">final</span> <span class="hljs-type">ReentrantLock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.lock;
    <span class="hljs-comment">// 获取锁</span>
    lock.lock();
    <span class="hljs-keyword">try</span> {
        <span class="hljs-comment">// 获取数组</span>
        Object[] elements = getArray();
        <span class="hljs-comment">// 数组长度</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">len</span> <span class="hljs-operator">=</span> elements.length;
        <span class="hljs-comment">// 获取旧值</span>
        <span class="hljs-type">E</span> <span class="hljs-variable">oldValue</span> <span class="hljs-operator">=</span> get(elements, index);
        <span class="hljs-comment">// 需要移动的元素个数</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">numMoved</span> <span class="hljs-operator">=</span> len - index - <span class="hljs-number">1</span>;
        <span class="hljs-keyword">if</span> (numMoved == <span class="hljs-number">0</span>) <span class="hljs-comment">// 移动个数为0</span>
            <span class="hljs-comment">// 复制后设置数组</span>
            setArray(Arrays.copyOf(elements, len - <span class="hljs-number">1</span>));
        <span class="hljs-keyword">else</span> { <span class="hljs-comment">// 移动个数不为0</span>
            <span class="hljs-comment">// 新生数组</span>
            Object[] newElements = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[len - <span class="hljs-number">1</span>];
            <span class="hljs-comment">// 复制index索引之前的元素</span>
            System.arraycopy(elements, <span class="hljs-number">0</span>, newElements, <span class="hljs-number">0</span>, index);
            <span class="hljs-comment">// 复制index索引之后的元素</span>
            System.arraycopy(elements, index + <span class="hljs-number">1</span>, newElements, index,
                                numMoved);
            <span class="hljs-comment">// 设置索引</span>
            setArray(newElements);
        }
        <span class="hljs-comment">// 返回旧值</span>
        <span class="hljs-keyword">return</span> oldValue;
    } <span class="hljs-keyword">finally</span> {
        <span class="hljs-comment">// 释放锁</span>
        lock.unlock();
    }
}
</code></pre>
<p>处理流程如下</p>
<ol>
<li>获取锁，获取数组elements，数组长度为length，获取索引的值elements[index]，计算需要移动的元素个数(length - index - 1),若个数为0，则表示移除的是数组的最后一个元素，复制elements数组，复制长度为length-1，然后设置数组，进入步骤③；否则，进入步骤②</li>
<li>先复制index索引前的元素，再复制index索引后的元素，然后设置数组。</li>
<li>释放锁，返回旧值</li>
<li/>
</ol>
<h2 data-id="heading-12">CopyOnWriteArrayList是Fail Safe的</h2>
<p>采用安全失败机制的集合容器，在遍历时不是直接在集合内容上访问的，而是先复制原有集合内容，在拷贝的集合上进行遍历。java.util.concurrent包下的容器都是安全失败，可以在多线程下并发使用，并发修改。</p>
<p>原理：由于迭代时是对原集合的拷贝进行遍历，所以在遍历过程中对原集合所作的修改并不能被迭代器检测到，所以不会触发Concurrent Modification Exception。</p>
<p>缺点：基于拷贝内容的优点是避免了Concurrent Modification Exception，但同样地，迭代器并不能访问到修改后的内容，即：迭代器遍历的是开始遍历那一刻拿到的集合拷贝，在遍历期间原集合发生的修改迭代器是不知道的。</p>
<p>Vector无论是add方法还是get方法都加上了<strong>synchronized</strong>修饰，当多线程读写List必须排队执行，很显然这样效率比较是低下的，CopyOnWriteArrayList是读写分离的，好处是提高线程访问效率。</p>
<h2 data-id="heading-13">缺陷和使用场景</h2>
<ul>
<li>
<p>CopyOnWriteArrayList的写效率比Vector慢。当CopyOnWriteArrayList写元素时是通过备份数组的方式实现的，当多线程同步激烈，数据量较大时会不停的<strong>复制数组，内存浪费严重</strong>。如果原数组的内容比较多的情况下，可能导致young gc或者full gc</p>
</li>
<li>
<p>弱一致性：不能用于实时读的场景，像拷贝数组、新增元素都需要时间，所以调用一个set操作后，读取到数据可能还是旧的，虽然CopyOnWriteArrayList 能做到最终一致性，但是还是没法满足实时性要求；</p>
</li>
</ul>
<p><strong>小结：</strong> CopyOnWriteArrayList合适读多写少的场景，例如黑名单白名单等</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[SpringBoot自动配置的5个秘密，90%开发者都不知道]]></title>    <link>https://juejin.cn/post/7598588085597978664</link>    <guid>https://juejin.cn/post/7598588085597978664</guid>    <pubDate>2026-01-26T00:19:01.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598588085597978664" data-draft-id="7598710324167835663" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="SpringBoot自动配置的5个秘密，90%开发者都不知道"/> <meta itemprop="keywords" content="后端,前端,人工智能"/> <meta itemprop="datePublished" content="2026-01-26T00:19:01.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="阿橙的百宝箱"/> <meta itemprop="url" content="https://juejin.cn/user/1638743356481367"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            SpringBoot自动配置的5个秘密，90%开发者都不知道
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1638743356481367/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    阿橙的百宝箱
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-26T00:19:01.000Z" title="Mon Jan 26 2026 00:19:01 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>SpringBoot自动配置的5个秘密，90%开发者都不知道</strong></h2>
<h3 data-id="heading-1">引言</h3>
<p>SpringBoot的自动配置（Auto-Configuration）是其核心特性之一，它通过约定优于配置的原则极大地简化了Spring应用的开发。然而，大多数开发者仅仅停留在“开箱即用”的层面，对自动配置背后的机制和隐藏技巧知之甚少。本文将揭示5个关于SpringBoot自动配置的“秘密”，帮助你更深入地理解其工作原理，并在实际开发中游刃有余。</p>
<hr/>
<h3 data-id="heading-2">1. 条件注解的真正威力：<code>@Conditional</code>家族的隐藏用法</h3>
<h4 data-id="heading-3">背景</h4>
<p>SpringBoot的自动配置依赖于一系列<code>@Conditional</code>注解（如<code>@ConditionalOnClass</code>、<code>@ConditionalOnProperty</code>等），但很少有人深入研究它们的组合使用和自定义扩展。</p>
<h4 data-id="heading-4">秘密解析</h4>
<ul>
<li><strong>组合条件</strong>：可以通过<code>AnyNestedCondition</code>或<code>AllNestedConditions</code>实现复杂的逻辑判断。例如：
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OnDatabaseType</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AllNestedConditions</span> {
    OnDatabaseType() {
        <span class="hljs-built_in">super</span>(ConfigurationPhase.PARSE_CONFIGURATION);
    }
    <span class="hljs-meta">@ConditionalOnProperty(name = "db.type", havingValue = "mysql")</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OnMySQL</span> {}
    <span class="hljs-meta">@ConditionalOnProperty(name = "db.type", havingValue = "postgresql")</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OnPostgreSQL</span> {}
}
</code></pre>
</li>
<li><strong>自定义条件</strong>：继承<code>Condition</code>接口可以实现完全自定义的条件逻辑。例如根据环境变量动态加载配置。</li>
</ul>
<h4 data-id="heading-5">实战建议</h4>
<p>在编写Starter时，灵活使用组合条件和自定义条件可以大幅提升自动配置的灵活性。</p>
<hr/>
<h3 data-id="heading-6">2. <code>spring.factories</code>的替代方案：从SPI到现代注解</h3>
<h4 data-id="heading-7">背景</h4>
<p>传统上，SpringBoot通过<code>META-INF/spring.factories</code>文件定义自动配置类，但这种方式缺乏类型安全和IDE支持。</p>
<h4 data-id="heading-8">秘密解析</h4>
<ul>
<li><strong>SPI替代方案</strong>：SpringBoot 2.7+引入了新的方式——直接在类上使用注解：
<ol>
<li><code>@AutoConfiguration</code>标记自动配置类。</li>
<li><code>@ImportAutoConfiguration</code>显式导入其他自动配置类。</li>
<li><code>META-INF/spring/org.springframework.boot.autoconfigure.AutoConfiguration.imports</code>文件逐步取代传统的<code>.factories</code>.</li>
</ol>
示例：
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@AutoConfiguration</span>
<span class="hljs-meta">@ConditionalOnClass(DataSource.class)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyDataSourceAutoConfiguration</span> {}
</code></pre>
</li>
</ul>
<h4 data-id="heading-9">实战建议</h4>
<p>新项目优先使用注解方式，老项目可以逐步迁移以提升可维护性。</p>
<hr/>
<h3 data-id="heading-10">3. Bean加载顺序的控制魔法：<code>@AutoConfigureOrder</code>与依赖关系</h3>
<h4 data-id="heading-11">背景</h4>
<p>当多个自动配置类存在依赖关系时，Bean的加载顺序可能成为难题。大部分开发者仅知道通过`.factories中的数字排序控制顺序。</p>
<h4 data-id="heading-12">秘密解析</h4>
<ul>
<li><strong>精细控制</strong>：
<ol>
<li><code>@AutoConfigureOrder(Ordered.HIGHEST_PRECEDENCE)</code>全局生效。</li>
<li><code>@AutoConfigureAfter(OtherConfig.class)</code>或<code>@AutoConfigureBefore(OtherConfig.class)</code>精确控制相对顺序。</li>
<li><strong>隐藏陷阱</strong>：这些注解仅对自动配置类有效！普通Bean需结合标准Spring机制（如方法调用顺序）。</li>
</ol>
</li>
</ul>
<h4 data-id="heading-13">实战建议</h4>
<p>在开发复杂Starter时务必显式声明依赖关系以避免隐式问题。</p>
<hr/>
<h3 data-id="heading-14">4. “负条件”的黑科技：如何优雅禁用默认配置</h3>
<h4 data-id="heading-15">背景</h4>
<p>有时我们需要禁用某些默认的自动配置（比如禁用内嵌Tomcat），常见做法是使用排除属性(<code>exclude</code>)或配置文件(<code>spring.autoconfigure.exclude=</code>)。</p>
<h4 data-id="heading-16">秘密解析</h4>
<p>更优雅的方式是通过“负条件”实现：</p>
<ol>
<li><strong>反向利用条件注解</strong>：
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@ConditionalOnMissingClass("com.example.ForbiddenClass")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FallbackConfig</span> {}
</code></pre>
</li>
<li><strong>动态排除</strong>：
通过环境变量动态决定是否排除：
<pre><code class="hljs language-properties" lang="properties">spring.autoconfigure.exclude[0]=org.springframework.boot.autoconfigure.jdbc.DataSourceAutoConfiguration
</code></pre>
</li>
</ol>
<h4 data-id="heading-17">实战建议</h4>
<p>优先选择基于条件的动态禁用而非硬编码排除。</p>
<hr/>
<h3 data-id="heading-18">5. Profile与分阶段加载的秘密分层策略</h3>
<h4 data-id="heading-19">Background</h4>
<p>大多数开发者认为Profile只是简单的环境隔离工具，但结合自动配置可以实现更强大的功能。</p>
<h4 data-id="heading-20">Secret Details</h4>
<ol>
<li><strong>分阶段激活</strong>：
结合Profile和条件注解可实现多层级激活策略：
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Profile("cloud")</span>
<span class="hljs-meta">@ConditionalOnCloudPlatform(CloudPlatform.KUBERNETES)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">KubernetesSpecificConfig</span> {}

<span class="hljs-meta">@Profile("local")</span>
<span class="hljs-meta">@ConditionalOnNotWebApplication</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BatchProcessingConfig</span> {}
</code></pre>
</li>
</ol>
<p>2.<strong>Meta-Annotation技巧</strong>
创建复合注解简化Profile管理:</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Target({ElementType.TYPE})</span>
<span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span>
<span class="hljs-meta">@Profile("prod")</span>
<span class="hljs-keyword">public</span><span class="hljs-meta">@interface</span> ProductionReady{}
</code></pre>
<p>3.<strong>测试场景的特殊处理</strong>
测试环境中可以强制覆盖特定profile:</p>
<pre><code class="hljs language-properties" lang="properties">#test/resources/application-test.properties 
spring.profiles.active=test,mock-services
</code></pre>
<hr/>
<h2 data-id="heading-21">Conclusion</h2>
<p>Spring Boot Auto-configuration hides far more powerful features than most developers realize.From mastering the full potential of conditional annotations to leveraging modern alternatives for spring.factories,these secrets can significantly elevate your configuration game.Remember that great power comes with great responsibility-use these techniques judiciously to keep your configurations maintainable and debuggable.</p>
<p>The next time you work on a Spring Boot project,try applying one of these hidden gems.You might be surprised how much cleaner and more flexible your auto-configuration can become!</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Spring Boot 定时任务多实例互斥执行]]></title>    <link>https://juejin.cn/post/7598767580306423862</link>    <guid>https://juejin.cn/post/7598767580306423862</guid>    <pubDate>2026-01-26T00:22:26.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598767580306423862" data-draft-id="7598921649888444443" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Spring Boot 定时任务多实例互斥执行"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-26T00:22:26.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="风象南"/> <meta itemprop="url" content="https://juejin.cn/user/2524134428655159"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Spring Boot 定时任务多实例互斥执行
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2524134428655159/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    风象南
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-26T00:22:26.000Z" title="Mon Jan 26 2026 00:22:26 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Spring Boot 的 <code>@Scheduled</code> 写定时任务很方便，但多实例部署时有个问题：同一个定时任务会在每台机器上都触发执行。</p>
<p>比如部署了两台应用服务器，凌晨 2 点的数据统计任务会同时跑两遍，数据重复、文件重复生成。</p>
<p>解决这个问题通常有几种思路。</p>
<h2 data-id="heading-0">常见方案</h2>
<p><strong>方案一：单机执行</strong></p>
<p>只在一台指定的机器上跑任务：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Scheduled(cron = "0 0 2 * * ?")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">scheduledTask</span><span class="hljs-params">()</span> {
    <span class="hljs-type">String</span> <span class="hljs-variable">hostname</span> <span class="hljs-operator">=</span> InetAddress.getLocalHost().getHostName();
    <span class="hljs-keyword">if</span> (!<span class="hljs-string">"app-server-01"</span>.equals(hostname)) {
        <span class="hljs-keyword">return</span>;
    }
    <span class="hljs-comment">// do something</span>
}
</code></pre>
<p>问题很明显：那台机器挂了，任务就不执行了。</p>
<p><strong>方案二：Redis 分布式锁</strong></p>
<p>用 Redis 的 SETNX 实现互斥（或者Redission）：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Scheduled(cron = "0 0 2 * * ?")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">scheduledTask</span><span class="hljs-params">()</span> {
    <span class="hljs-type">Boolean</span> <span class="hljs-variable">locked</span> <span class="hljs-operator">=</span> stringRedisTemplate.opsForValue()
        .setIfAbsent(<span class="hljs-string">"task:data-sync"</span>, <span class="hljs-string">"1"</span>, <span class="hljs-number">10</span>, TimeUnit.MINUTES);
    <span class="hljs-keyword">if</span> (Boolean.FALSE.equals(locked)) {
        <span class="hljs-keyword">return</span>;
    }
    <span class="hljs-keyword">try</span> {
        <span class="hljs-comment">// do something</span>
    } <span class="hljs-keyword">finally</span> {
        stringRedisTemplate.delete(<span class="hljs-string">"task:data-sync"</span>);
    }
}
</code></pre>
<p>能用，但每个任务都要写一遍加锁释放逻辑，而且需要项目里有 Redis。</p>
<h2 data-id="heading-1">ShedLock 方案</h2>
<p>ShedLock 是一个专门解决定时任务重复执行问题的框架，支持多种存储后端（数据库、Redis、MongoDB 等）。</p>
<p>核心思路：在存储层记录每个任务的锁状态，任务执行前先抢锁，抢到了才执行。</p>
<h4 data-id="heading-2">集成步骤</h4>
<p><strong>1. 添加依赖</strong></p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>net.javacrumbs.shedlock<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>shedlock-spring<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.42.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>net.javacrumbs.shedlock<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>shedlock-provider-jdbc-template<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.42.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<p><strong>2. 创建锁表</strong></p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> shedlock (
    name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">64</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
    lock_until <span class="hljs-type">TIMESTAMP</span>(<span class="hljs-number">3</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
    locked_at <span class="hljs-type">TIMESTAMP</span>(<span class="hljs-number">3</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
    locked_by <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
    <span class="hljs-keyword">PRIMARY</span> KEY (name)
);
</code></pre>
<p><strong>3. 配置 LockProvider</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@EnableSchedulerLock(defaultLockAtMostFor = "10m")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ShedLockConfig</span> {

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> LockProvider <span class="hljs-title function_">lockProvider</span><span class="hljs-params">(DataSource dataSource)</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JdbcTemplateLockProvider</span>(
            JdbcTemplateLockProvider.Configuration.builder()
                .withDataSource(dataSource)
                .withTableName(<span class="hljs-string">"shedlock"</span>)
                .build()
        );
    }
}
</code></pre>
<p><strong>4. 给定时任务加注解</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Scheduled(cron = "0 0 2 * * ?")</span>
<span class="hljs-meta">@SchedulerLock(name = "dataSyncTask", lockAtMostFor = "5m")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">syncData</span><span class="hljs-params">()</span> {
    <span class="hljs-comment">// do something</span>
}
</code></pre>
<p>完成。多台服务器部署时，只有抢到锁的那台会执行任务。</p>
<h2 data-id="heading-3">注解参数说明</h2>
<p><code>@SchedulerLock</code> 有几个关键参数：</p>
<p><strong>name</strong>：锁名称，相同 name 的任务会互斥执行。建议用任务名来命名，保持唯一。</p>
<p><strong>lockAtMostFor</strong>：锁的最大持有时间。</p>
<p>这是为了防止任务执行过程中机器宕机，导致锁永远不释放。比如设置 <code>5m</code>，即使任务执行超时，锁也会在 5 分钟后自动过期。</p>
<p>一般按任务预期执行时间的 2 倍左右设置，留些余量。</p>
<p><strong>lockAtLeastFor</strong>：锁的最小持有时间。</p>
<p>这是为了防止任务执行太快，锁立即释放被其他机器抢到。</p>
<p>比如定时任务每分钟执行一次，任务 5 秒就跑完了。如果没有这个参数，其他机器可能会在同一分钟内再次抢到锁执行。</p>
<p>这种情况下可以设置 <code>lockAtLeastFor = "1m"</code>，确保锁保持到下一分钟。</p>
<h2 data-id="heading-4">实现原理</h2>
<p>ShedLock 的实现逻辑不复杂。</p>
<p>任务执行前，会向数据库插入或更新锁记录：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> shedlock (name, lock_until, locked_at, locked_by)
<span class="hljs-keyword">VALUES</span> (<span class="hljs-string">'dataSyncTask'</span>, <span class="hljs-string">'2025-01-25 02:05:00'</span>, NOW(), <span class="hljs-string">'192.168.1.10'</span>)
<span class="hljs-keyword">ON</span> DUPLICATE KEY <span class="hljs-keyword">UPDATE</span>
  lock_until <span class="hljs-operator">=</span> <span class="hljs-string">'2025-01-25 02:05:00'</span>,
  locked_at <span class="hljs-operator">=</span> NOW(),
  locked_by <span class="hljs-operator">=</span> <span class="hljs-string">'192.168.1.10'</span>
<span class="hljs-keyword">WHERE</span> lock_until <span class="hljs-operator">&lt;</span> NOW();
</code></pre>
<p>关键是最后的 <code>WHERE lock_until &lt; NOW()</code> 条件：</p>
<ul>
<li>如果当前锁已过期，UPDATE 成功，抢到锁</li>
<li>如果当前锁未过期，UPDATE 影响行数为 0，抢锁失败，任务不执行</li>
</ul>
<p>任务执行完成后不需要主动释放锁，等待 <code>lock_until</code> 时间到期即可。</p>
<h2 data-id="heading-5">适用场景</h2>
<p>ShedLock 的定位很明确：专门为定时任务设计的分布式锁框架。</p>
<p><strong>适合</strong></p>
<ul>
<li>定时任务需要互斥执行，避免重复</li>
<li>希望用注解方式简化锁的代码逻辑</li>
<li>需要自动锁过期机制，防止死锁</li>
</ul>
<p><strong>不适合</strong></p>
<ul>
<li>高并发抢锁的业务场景（比如秒杀、库存扣减），ShedLock 不是为此设计</li>
<li>需要可重入锁、读写锁等复杂特性</li>
<li>需要精确控制锁获取和释放时机的业务逻辑</li>
</ul>
<p>ShedLock 和通用分布式锁是互补关系，不是替代关系。如果你的业务代码里需要手动加锁解锁，用 Redisson 或手动实现 Redis SETNX 更合适。但如果只是为了解决定时任务重复执行的问题，ShedLock 是更简洁的方案。</p>
<h2 data-id="heading-6">几个注意事项</h2>
<p><strong>1. 存储后端选择</strong></p>
<p>本文演示用的是 JDBC 方式（基于数据库表）。ShedLock 还支持 Redis、MongoDB、ZooKeeper、Hazelcast 等多种存储后端，根据项目现有技术栈选择即可。</p>
<p><strong>2. 表名自定义（数据库存储时）</strong></p>
<p>如果用 JDBC 作为存储后端，默认表名是 <code>shedlock</code>，可以按需修改：
<strong>3. 机器标识</strong></p>
<p><code>locked_by</code> 字段记录是哪台机器拿到的锁，默认是主机名。可以自定义成更有意义的标识：</p>
<pre><code class="hljs language-java" lang="java">.withLockedByValue(<span class="hljs-string">"app-"</span> + getServerIp())
</code></pre>
<p><strong>4. 主从/多数据源场景（数据库存储时）</strong></p>
<p>如果项目有多个数据源，确保 ShedLock 用的是主库，避免主从延迟导致的锁问题。</p>
<h2 data-id="heading-7">总结</h2>
<p>ShedLock 是一个专门为定时任务设计的分布式锁框架：</p>
<ul>
<li>优点：注解式使用、集成简单、自动锁过期、支持多种存储后端</li>
<li>局限性：只适用于定时任务场景，不适用于通用业务加锁</li>
</ul>
<p>和手动写 Redis 分布式锁相比，ShedLock 把定时任务锁的逻辑抽象出来了，代码更简洁。但如果你需要的是通用业务锁，还是用 Redisson 或手写 SETNX 更合适。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[第6章、函数的艺术——定义、多返回值与闭包]]></title>    <link>https://juejin.cn/post/7598710324167852047</link>    <guid>https://juejin.cn/post/7598710324167852047</guid>    <pubDate>2026-01-26T00:42:04.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598710324167852047" data-draft-id="7598588085598011432" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" 第6章、函数的艺术——定义、多返回值与闭包"/> <meta itemprop="keywords" content="后端,Go"/> <meta itemprop="datePublished" content="2026-01-26T00:42:04.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="怕浪猫"/> <meta itemprop="url" content="https://juejin.cn/user/2832784963939438"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             第6章、函数的艺术——定义、多返回值与闭包
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2832784963939438/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    怕浪猫
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-26T00:42:04.000Z" title="Mon Jan 26 2026 00:42:04 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读22分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>大家好～ 前面我们掌握了Go的基础语法和控制结构，今天进入Go编程的核心模块——函数。函数是代码的“最小复用单元”，也是组织业务逻辑的核心载体。Go的函数设计非常有特色，不仅支持多返回值、命名返回值等实用特性，还将函数视为“一等公民”，支持函数值、匿名函数和闭包，为函数式编程提供了基础。</p>
<p>本文会从“基础定义”到“高级特性”逐步拆解，结合大量实战代码示例，把函数的用法、底层机制和最佳实践讲透。无论你是刚入门的新手，还是需要夯实基础的开发者，这篇文章都能帮你掌握Go函数的“艺术”。</p>
<h2 data-id="heading-0">1. 函数定义与参数传递机制</h2>
<p>函数定义是使用函数的基础，Go的函数定义语法简洁清晰，同时参数传递机制（值传递）是理解后续高级特性的关键，必须先吃透。</p>
<h3 data-id="heading-1">1.1 基础函数定义语法</h3>
<p>Go函数的核心定义语法：</p>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-comment">// 函数声明：func 函数名(参数列表) (返回值列表) { 函数体 }</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> 函数名<span class="hljs-params">(参数名1 类型1, 参数名2 类型2)</span></span> (返回值类型<span class="hljs-number">1</span>, 返回值类型<span class="hljs-number">2</span>) {
    <span class="hljs-comment">// 函数逻辑</span>
    <span class="hljs-keyword">return</span> 返回值<span class="hljs-number">1</span>, 返回值<span class="hljs-number">2</span>
}

</code></pre>
<p>关键说明：</p>
<ul>
<li>
<p><code>func</code>：关键字，标记函数定义的开始；</p>
</li>
<li>
<p>参数列表：多个参数用逗号分隔，<strong>类型后置</strong>（Go的特色语法，更注重参数名的可读性）；如果多个参数类型相同，可简写（如<code>a, b int</code>）；</p>
</li>
<li>
<p>返回值列表：支持0个、1个或多个返回值；如果只有1个返回值，可省略括号；</p>
</li>
<li>
<p>函数体：必须用大括号<code>{}</code>包裹，即使只有一行代码。</p>
</li>
</ul>
<h3 data-id="heading-2">1.2 基础示例：不同类型的函数定义</h3>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span>

<span class="hljs-comment">// 1. 无参数、无返回值</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">sayHello</span><span class="hljs-params">()</span></span> {
    fmt.Println(<span class="hljs-string">"Hello, Go!"</span>)
}

<span class="hljs-comment">// 2. 有参数、无返回值（多个同类型参数简写）</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">printSum</span><span class="hljs-params">(a, b <span class="hljs-type">int</span>)</span></span> {
    fmt.Printf(<span class="hljs-string">"%d + %d = %d\n"</span>, a, b, a+b)
}

<span class="hljs-comment">// 3. 有参数、单个返回值（省略返回值括号）</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">add</span><span class="hljs-params">(a, b <span class="hljs-type">int</span>)</span></span> <span class="hljs-type">int</span> {
    <span class="hljs-keyword">return</span> a + b
}

<span class="hljs-comment">// 4. 有参数、多个返回值</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">divide</span><span class="hljs-params">(a, b <span class="hljs-type">int</span>)</span></span> (<span class="hljs-type">int</span>, <span class="hljs-type">error</span>) {
    <span class="hljs-keyword">if</span> b == <span class="hljs-number">0</span> {
        <span class="hljs-comment">// 返回错误信息</span>
        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>, fmt.Errorf(<span class="hljs-string">"除数不能为0"</span>)
    }
    <span class="hljs-keyword">return</span> a / b, <span class="hljs-literal">nil</span>
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    sayHello()                          <span class="hljs-comment">// 输出：Hello, Go!</span>
    printSum(<span class="hljs-number">10</span>, <span class="hljs-number">20</span>)                    <span class="hljs-comment">// 输出：10 + 20 = 30</span>
    sum := add(<span class="hljs-number">15</span>, <span class="hljs-number">25</span>)
    fmt.Println(<span class="hljs-string">"sum ="</span>, sum)           <span class="hljs-comment">// 输出：sum = 40</span>
    result, err := divide(<span class="hljs-number">20</span>, <span class="hljs-number">4</span>)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        fmt.Println(<span class="hljs-string">"错误："</span>, err)
    } <span class="hljs-keyword">else</span> {
        fmt.Println(<span class="hljs-string">"20 / 4 ="</span>, result) <span class="hljs-comment">// 输出：20 / 4 = 5</span>
    }
    <span class="hljs-comment">// 测试错误场景</span>
    result2, err2 := divide(<span class="hljs-number">10</span>, <span class="hljs-number">0</span>)
    <span class="hljs-keyword">if</span> err2 != <span class="hljs-literal">nil</span> {
        fmt.Println(<span class="hljs-string">"错误："</span>, err2)      <span class="hljs-comment">// 输出：错误：除数不能为0</span>
    } <span class="hljs-keyword">else</span> {
        fmt.Println(<span class="hljs-string">"10 / 0 ="</span>, result2)
    }
}

</code></pre>
<h3 data-id="heading-3">1.3 核心机制：参数传递——值传递</h3>
<p>Go的参数传递只有一种机制：<strong>值传递</strong>。即函数调用时，会将实参的“副本”传递给形参，函数内部对形参的修改，不会影响外部的实参。</p>
<p>很多新手会混淆“值类型参数”和“引用类型参数”的传递，这里要明确：<strong>无论参数是值类型（int、string、struct）还是引用类型（slice、map、chan），Go都是值传递</strong>——区别在于，引用类型的“副本”指向的是同一个底层数据结构，所以修改副本的“内容”会影响外部，而修改副本的“指向”则不会。</p>
<h3 data-id="heading-4">1.4 代码示例：值传递的细节</h3>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span>

<span class="hljs-comment">// 1. 值类型参数（int）：修改形参不影响实参</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">modifyInt</span><span class="hljs-params">(x <span class="hljs-type">int</span>)</span></span> {
    x = <span class="hljs-number">100</span> <span class="hljs-comment">// 修改的是副本</span>
}

<span class="hljs-comment">// 2. 引用类型参数（slice）：修改副本的内容，影响外部实参</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">modifySlice</span><span class="hljs-params">(s []<span class="hljs-type">int</span>)</span></span> {
    s[<span class="hljs-number">0</span>] = <span class="hljs-number">100</span> <span class="hljs-comment">// 副本指向的底层数组不变，修改内容会影响外部</span>
    s = <span class="hljs-built_in">append</span>(s, <span class="hljs-number">40</span>) <span class="hljs-comment">// 修改副本的指向（扩容后指向新数组），不影响外部</span>
}

<span class="hljs-comment">// 3. 结构体参数（值传递）：修改形参不影响实参</span>
<span class="hljs-keyword">type</span> User <span class="hljs-keyword">struct</span> {
    Name <span class="hljs-type">string</span>
    Age  <span class="hljs-type">int</span>
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">modifyUser</span><span class="hljs-params">(u User)</span></span> {
    u.Age = <span class="hljs-number">30</span> <span class="hljs-comment">// 修改的是副本</span>
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// 测试值类型参数</span>
    x := <span class="hljs-number">10</span>
    modifyInt(x)
    fmt.Println(<span class="hljs-string">"x ="</span>, x) <span class="hljs-comment">// 输出：x = 10（未被修改）</span>

    <span class="hljs-comment">// 测试引用类型参数</span>
    s := []<span class="hljs-type">int</span>{<span class="hljs-number">10</span>, <span class="hljs-number">20</span>, <span class="hljs-number">30</span>}
    modifySlice(s)
    fmt.Println(<span class="hljs-string">"s ="</span>, s) <span class="hljs-comment">// 输出：s = [100 20 30]（仅第一个元素被修改，append未生效）</span>

    <span class="hljs-comment">// 测试结构体参数</span>
    u := User{Name: <span class="hljs-string">"Alice"</span>, Age: <span class="hljs-number">20</span>}
    modifyUser(u)
    fmt.Println(<span class="hljs-string">"u ="</span>, u) <span class="hljs-comment">// 输出：u = {Alice 20}（未被修改）</span>
}

</code></pre>
<h3 data-id="heading-5">1.5 最佳实践</h3>
<ul>
<li>
<p>参数命名要清晰：避免使用a、b、c等模糊命名，用有语义的名称（如user、score、data）；</p>
</li>
<li>
<p>参数数量不宜过多：如果参数超过5个，建议封装为结构体（如<code>func updateUser(u User) error</code>），提升可读性；</p>
</li>
<li>
<p>修改外部数据的两种方式：① 传递引用类型参数（slice、map等）；② 让函数返回修改后的值，外部重新赋值；</p>
</li>
<li>
<p>避免传递大结构体：大结构体的值传递会拷贝大量数据，影响性能，建议传递结构体指针（<code>*User</code>）。</p>
</li>
</ul>
<h2 data-id="heading-6">2. 多返回值与错误处理惯例</h2>
<p>多返回值是Go的核心特色之一，彻底解决了其他语言（如Java）“单个返回值+异常”的繁琐设计。在Go中，多返回值最经典的应用场景是“返回结果+错误信息”，这也是Go的错误处理惯例。</p>
<h3 data-id="heading-7">2.1 多返回值的核心用法</h3>
<p>Go的多返回值支持两种接收方式：① 接收所有返回值；② 用<code>_</code>忽略不需要的返回值。</p>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span>

<span class="hljs-comment">// 多返回值：返回计算结果、平方、立方</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">calculate</span><span class="hljs-params">(x <span class="hljs-type">int</span>)</span></span> (<span class="hljs-type">int</span>, <span class="hljs-type">int</span>, <span class="hljs-type">int</span>) {
    sum := x + <span class="hljs-number">10</span>
    square := x * x
    cube := x * x * x
    <span class="hljs-keyword">return</span> sum, square, cube
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// 1. 接收所有返回值</span>
    sum, square, cube := calculate(<span class="hljs-number">5</span>)
    fmt.Printf(<span class="hljs-string">"sum=%d, square=%d, cube=%d\n"</span>, sum, square, cube) <span class="hljs-comment">// 输出：sum=15, square=25, cube=125</span>

    <span class="hljs-comment">// 2. 忽略不需要的返回值（用_）</span>
    _, sq, _ := calculate(<span class="hljs-number">6</span>)
    fmt.Printf(<span class="hljs-string">"6的平方=%d\n"</span>, sq) <span class="hljs-comment">// 输出：6的平方=36</span>
}

</code></pre>
<h3 data-id="heading-8">2.2 错误处理惯例：返回值末尾放error</h3>
<p>Go没有像Java那样的try-catch异常机制，而是通过“多返回值+error类型”实现错误处理。核心惯例：</p>
<ul>
<li>
<p>函数的最后一个返回值类型是<code>error</code>（内置接口类型）；</p>
</li>
<li>
<p>执行成功时，error返回<code>nil</code>；执行失败时，返回具体的错误信息；</p>
</li>
<li>
<p>调用函数后，<strong>必须先判断error是否为nil</strong>，再使用其他返回值（避免使用错误的结果）。</p>
</li>
</ul>
<h3 data-id="heading-9">2.3 代码示例：标准错误处理流程</h3>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"errors"</span>
    <span class="hljs-string">"fmt"</span>
)

<span class="hljs-comment">// 模拟查询用户信息：返回用户信息和错误</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">getUserByID</span><span class="hljs-params">(userID <span class="hljs-type">int</span>)</span></span> (<span class="hljs-type">string</span>, <span class="hljs-type">int</span>, <span class="hljs-type">error</span>) {
    <span class="hljs-comment">// 模拟数据库查询</span>
    <span class="hljs-keyword">if</span> userID &lt;= <span class="hljs-number">0</span> {
        <span class="hljs-comment">// 返回错误信息（用errors.New或fmt.Errorf）</span>
        <span class="hljs-keyword">return</span> <span class="hljs-string">""</span>, <span class="hljs-number">0</span>, errors.New(<span class="hljs-string">"用户ID必须大于0"</span>)
    }
    <span class="hljs-keyword">if</span> userID == <span class="hljs-number">1001</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"Alice"</span>, <span class="hljs-number">25</span>, <span class="hljs-literal">nil</span> <span class="hljs-comment">// 成功：error为nil</span>
    }
    <span class="hljs-keyword">return</span> <span class="hljs-string">""</span>, <span class="hljs-number">0</span>, fmt.Errorf(<span class="hljs-string">"未找到用户（ID：%d）"</span>, userID) <span class="hljs-comment">// 带参数的错误信息</span>
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// 标准错误处理流程：先判断error，再使用结果</span>
    username, age, err := getUserByID(<span class="hljs-number">1001</span>)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        <span class="hljs-comment">// 错误处理：打印日志、返回等</span>
        fmt.Printf(<span class="hljs-string">"查询失败：%v\n"</span>, err)
        <span class="hljs-keyword">return</span>
    }
    <span class="hljs-comment">// 没有错误，使用结果</span>
    fmt.Printf(<span class="hljs-string">"查询成功：姓名=%s，年龄=%d\n"</span>, username, age) <span class="hljs-comment">// 输出：查询成功：姓名=Alice，年龄=25</span>

    <span class="hljs-comment">// 测试错误场景1：用户ID无效</span>
    _, _, err2 := getUserByID(<span class="hljs-number">-1</span>)
    <span class="hljs-keyword">if</span> err2 != <span class="hljs-literal">nil</span> {
        fmt.Printf(<span class="hljs-string">"查询失败：%v\n"</span>, err2) <span class="hljs-comment">// 输出：查询失败：用户ID必须大于0</span>
        <span class="hljs-keyword">return</span>
    }

    <span class="hljs-comment">// 测试错误场景2：用户不存在</span>
    _, _, err3 := getUserByID(<span class="hljs-number">1002</span>)
    <span class="hljs-keyword">if</span> err3 != <span class="hljs-literal">nil</span> {
        fmt.Printf(<span class="hljs-string">"查询失败：%v\n"</span>, err3) <span class="hljs-comment">// 输出：查询失败：未找到用户（ID：1002）</span>
        <span class="hljs-keyword">return</span>
    }
}

</code></pre>
<h3 data-id="heading-10">2.4 错误处理的最佳实践</h3>
<ul>
<li>
<p>错误信息要具体：包含关键上下文（如用户ID、文件名、参数值），方便排查问题；</p>
</li>
<li>
<p>不要忽略错误：即使你觉得“不可能出错”，也不要用<code>_</code>忽略error，否则会隐藏潜在问题；</p>
</li>
<li>
<p>错误传递时添加上下文：如果需要将错误向上传递（如在函数中调用其他函数），用<code>fmt.Errorf("上下文：%w", err)</code>包装错误（<code>%w</code>是Go 1.13+新增，保留原始错误）；</p>
</li>
<li>
<p>区分“预期错误”和“致命错误”：预期错误（如用户不存在、参数无效）返回error；致命错误（如内存溢出）用<code>panic</code>（后续章节讲解）。</p>
</li>
</ul>
<h2 data-id="heading-11">3. 命名返回值的使用技巧</h2>
<p>Go支持“命名返回值”，即定义函数时，给返回值指定名称。命名返回值会在函数开始时被自动初始化（零值），函数体中可以直接赋值，return时无需指定返回值（裸return）。</p>
<h3 data-id="heading-12">3.1 命名返回值的基础用法</h3>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span>

<span class="hljs-comment">// 命名返回值：sum（int类型）、err（error类型）</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">addWithCheck</span><span class="hljs-params">(a, b <span class="hljs-type">int</span>)</span></span> (sum <span class="hljs-type">int</span>, err <span class="hljs-type">error</span>) {
    <span class="hljs-keyword">if</span> a &lt; <span class="hljs-number">0</span> || b &lt; <span class="hljs-number">0</span> {
        err = fmt.Errorf(<span class="hljs-string">"参数不能为负数（a=%d, b=%d）"</span>, a, b)
        <span class="hljs-keyword">return</span> <span class="hljs-comment">// 裸return：自动返回sum和err</span>
    }
    sum = a + b
    <span class="hljs-keyword">return</span> <span class="hljs-comment">// 裸return：自动返回sum和err</span>
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    sum, err := addWithCheck(<span class="hljs-number">10</span>, <span class="hljs-number">20</span>)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        fmt.Println(<span class="hljs-string">"错误："</span>, err)
        <span class="hljs-keyword">return</span>
    }
    fmt.Println(<span class="hljs-string">"sum ="</span>, sum) <span class="hljs-comment">// 输出：sum = 30</span>

    <span class="hljs-comment">// 测试错误场景</span>
    sum2, err2 := addWithCheck(<span class="hljs-number">-5</span>, <span class="hljs-number">10</span>)
    <span class="hljs-keyword">if</span> err2 != <span class="hljs-literal">nil</span> {
        fmt.Println(<span class="hljs-string">"错误："</span>, err2) <span class="hljs-comment">// 输出：错误：参数不能为负数（a=-5, b=10）</span>
        <span class="hljs-keyword">return</span>
    }
    fmt.Println(<span class="hljs-string">"sum2 ="</span>, sum2)
}

</code></pre>
<h3 data-id="heading-13">3.2 命名返回值的核心优势与注意事项</h3>
<h4 data-id="heading-14">3.2.1 优势</h4>
<ul>
<li>
<p>提升代码可读性：返回值名称能直观说明返回值的含义（如sum、err、username）；</p>
</li>
<li>
<p>简化代码：函数体中无需重新声明返回值变量，直接赋值即可；裸return减少重复代码。</p>
</li>
</ul>
<h4 data-id="heading-15">3.2.2 注意事项</h4>
<ul>
<li>
<p>裸return容易出错：如果函数有多个命名返回值，裸return会自动返回所有命名返回值，若遗漏赋值，会返回零值（如int返回0，string返回""）；</p>
</li>
<li>
<p>不要过度使用：简单函数（如单个返回值）使用命名返回值意义不大，反而增加代码冗余；复杂函数（多个返回值、逻辑繁琐）使用命名返回值更合适；</p>
</li>
<li>
<p>命名要清晰：避免使用模糊的命名（如ret1、ret2），否则会降低可读性。</p>
</li>
</ul>
<h3 data-id="heading-16">3.3 最佳实践：命名返回值的适用场景</h3>
<ul>
<li>
<p>多个返回值的函数：尤其是返回值类型相近时（如<code>func getData() (int, int, error)</code>），命名返回值能明确区分每个返回值；</p>
</li>
<li>
<p>错误处理复杂的函数：函数体中有多个错误分支时，命名返回值的err可以统一赋值，裸return简化代码；</p>
</li>
<li>
<p>递归函数：递归函数的返回值通常固定，命名返回值能减少重复声明。</p>
</li>
</ul>
<h2 data-id="heading-17">4. 函数作为一等公民：函数值</h2>
<p>在Go中，函数是“一等公民”（First-Class Citizen），意味着：</p>
<ul>
<li>
<p>函数可以赋值给变量（即“函数值”）；</p>
</li>
<li>
<p>函数可以作为参数传递给其他函数；</p>
</li>
<li>
<p>函数可以作为其他函数的返回值；</p>
</li>
<li>
<p>函数可以在其他函数内部定义（匿名函数）。</p>
</li>
</ul>
<p>函数值是实现“函数作为一等公民”的基础，本质是“指向函数的指针”。</p>
<h3 data-id="heading-18">4.1 函数值的基础用法</h3>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span>

<span class="hljs-comment">// 定义两个函数，签名相同（参数类型、返回值类型相同）</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">add</span><span class="hljs-params">(a, b <span class="hljs-type">int</span>)</span></span> <span class="hljs-type">int</span> {
    <span class="hljs-keyword">return</span> a + b
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">subtract</span><span class="hljs-params">(a, b <span class="hljs-type">int</span>)</span></span> <span class="hljs-type">int</span> {
    <span class="hljs-keyword">return</span> a - b
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// 1. 函数赋值给变量（函数值）</span>
    <span class="hljs-comment">// 变量f的类型是：func(int, int) int（函数签名）</span>
    <span class="hljs-keyword">var</span> f <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(<span class="hljs-type">int</span>, <span class="hljs-type">int</span>)</span></span> <span class="hljs-type">int</span>
    f = add <span class="hljs-comment">// 赋值add函数</span>
    fmt.Println(<span class="hljs-string">"10 + 20 ="</span>, f(<span class="hljs-number">10</span>, <span class="hljs-number">20</span>)) <span class="hljs-comment">// 输出：10 + 20 = 30</span>

    f = subtract <span class="hljs-comment">// 重新赋值subtract函数</span>
    fmt.Println(<span class="hljs-string">"10 - 20 ="</span>, f(<span class="hljs-number">10</span>, <span class="hljs-number">20</span>)) <span class="hljs-comment">// 输出：10 - 20 = -10</span>

    <span class="hljs-comment">// 2. 函数值作为参数传递</span>
    funcParam(f, <span class="hljs-number">5</span>, <span class="hljs-number">3</span>) <span class="hljs-comment">// 输出：5 - 3 = -2</span>

    <span class="hljs-comment">// 3. 函数值作为返回值</span>
    multiplyFunc := getOperator(<span class="hljs-string">"multiply"</span>)
    fmt.Println(<span class="hljs-string">"5 * 3 ="</span>, multiplyFunc(<span class="hljs-number">5</span>, <span class="hljs-number">3</span>)) <span class="hljs-comment">// 输出：5 * 3 = 15</span>

    divideFunc := getOperator(<span class="hljs-string">"divide"</span>)
    fmt.Println(<span class="hljs-string">"6 / 2 ="</span>, divideFunc(<span class="hljs-number">6</span>, <span class="hljs-number">2</span>)) <span class="hljs-comment">// 输出：6 / 2 = 3</span>
}

<span class="hljs-comment">// 函数值作为参数</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">funcParam</span><span class="hljs-params">(op <span class="hljs-keyword">func</span>(<span class="hljs-type">int</span>, <span class="hljs-type">int</span>)</span></span> <span class="hljs-type">int</span>, a, b <span class="hljs-type">int</span>) {
    result := op(a, b)
    fmt.Printf(<span class="hljs-string">"%d op %d = %d\n"</span>, a, b, result)
}

<span class="hljs-comment">// 函数值作为返回值</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">getOperator</span><span class="hljs-params">(operator <span class="hljs-type">string</span>)</span></span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(<span class="hljs-type">int</span>, <span class="hljs-type">int</span>)</span></span> <span class="hljs-type">int</span> {
    <span class="hljs-keyword">switch</span> operator {
    <span class="hljs-keyword">case</span> <span class="hljs-string">"multiply"</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(a, b <span class="hljs-type">int</span>)</span></span> <span class="hljs-type">int</span> { <span class="hljs-comment">// 匿名函数作为返回值</span>
            <span class="hljs-keyword">return</span> a * b
        }
    <span class="hljs-keyword">case</span> <span class="hljs-string">"divide"</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(a, b <span class="hljs-type">int</span>)</span></span> <span class="hljs-type">int</span> {
            <span class="hljs-keyword">return</span> a / b
        }
    <span class="hljs-keyword">default</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
    }
}

</code></pre>
<h3 data-id="heading-19">4.2 核心概念：函数签名</h3>
<p>函数值的类型由“函数签名”决定。函数签名是指：</p>
<ul>
<li>
<p>参数的类型和数量；</p>
</li>
<li>
<p>返回值的类型和数量；</p>
</li>
<li>
<p>参数名和返回值名不影响签名。</p>
</li>
</ul>
<p>只有签名完全相同的函数，才能赋值给同一个函数值变量。例如：</p>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-comment">// 签名：func(int, int) int</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">add</span><span class="hljs-params">(a, b <span class="hljs-type">int</span>)</span></span> <span class="hljs-type">int</span> { <span class="hljs-keyword">return</span> a + b }

<span class="hljs-comment">// 签名：func(int, int) int（参数名不同，但签名相同）</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">add2</span><span class="hljs-params">(x, y <span class="hljs-type">int</span>)</span></span> <span class="hljs-type">int</span> { <span class="hljs-keyword">return</span> x + y }

<span class="hljs-comment">// 签名：func(int, int) (int, error)（返回值不同，签名不同）</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">addWithErr</span><span class="hljs-params">(a, b <span class="hljs-type">int</span>)</span></span> (<span class="hljs-type">int</span>, <span class="hljs-type">error</span>) { <span class="hljs-keyword">return</span> a + b, <span class="hljs-literal">nil</span> }

<span class="hljs-keyword">var</span> f <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(<span class="hljs-type">int</span>, <span class="hljs-type">int</span>)</span></span> <span class="hljs-type">int</span>
f = add    <span class="hljs-comment">// 合法</span>
f = add2   <span class="hljs-comment">// 合法</span>
<span class="hljs-comment">// f = addWithErr // 非法：签名不匹配</span>

</code></pre>
<h3 data-id="heading-20">4.3 函数值的应用场景</h3>
<ul>
<li>
<p>实现“策略模式”：根据不同的场景，动态选择不同的函数逻辑（如上面的getOperator示例）；</p>
</li>
<li>
<p>简化回调函数：将函数作为参数传递，实现回调逻辑（如排序、过滤等）；</p>
</li>
<li>
<p>动态生成函数：根据条件返回不同的函数，实现逻辑复用。</p>
</li>
</ul>
<h2 data-id="heading-21">5. 匿名函数与立即执行函数</h2>
<p>匿名函数是“没有名称的函数”，核心作用是“临时使用”或“作为函数值的载体”。立即执行函数（IIFE）是匿名函数的一种特殊用法：定义后立即调用。</p>
<h3 data-id="heading-22">5.1 匿名函数的基础用法</h3>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span>

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// 1. 匿名函数赋值给变量</span>
    add := <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(a, b <span class="hljs-type">int</span>)</span></span> <span class="hljs-type">int</span> {
        <span class="hljs-keyword">return</span> a + b
    }
    fmt.Println(<span class="hljs-string">"3 + 4 ="</span>, add(<span class="hljs-number">3</span>, <span class="hljs-number">4</span>)) <span class="hljs-comment">// 输出：3 + 4 = 7</span>

    <span class="hljs-comment">// 2. 匿名函数作为参数（简化代码）</span>
    numbers := []<span class="hljs-type">int</span>{<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>}
    <span class="hljs-comment">// 自定义过滤逻辑：保留偶数</span>
    evenNumbers := filter(numbers, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(n <span class="hljs-type">int</span>)</span></span> <span class="hljs-type">bool</span> {
        <span class="hljs-keyword">return</span> n%<span class="hljs-number">2</span> == <span class="hljs-number">0</span>
    })
    fmt.Println(<span class="hljs-string">"偶数："</span>, evenNumbers) <span class="hljs-comment">// 输出：偶数： [2 4]</span>

    <span class="hljs-comment">// 自定义过滤逻辑：保留大于3的数</span>
    greaterThan3 := filter(numbers, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(n <span class="hljs-type">int</span>)</span></span> <span class="hljs-type">bool</span> {
        <span class="hljs-keyword">return</span> n &gt; <span class="hljs-number">3</span>
    })
    fmt.Println(<span class="hljs-string">"大于3的数："</span>, greaterThan3) <span class="hljs-comment">// 输出：大于3的数： [4 5]</span>

    <span class="hljs-comment">// 3. 立即执行函数（IIFE）：定义后立即调用</span>
    <span class="hljs-comment">// 语法：(匿名函数)(参数)</span>
    result := <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(a, b <span class="hljs-type">int</span>)</span></span> <span class="hljs-type">int</span> {
        <span class="hljs-keyword">return</span> a * b
    }(<span class="hljs-number">5</span>, <span class="hljs-number">6</span>)
    fmt.Println(<span class="hljs-string">"5 * 6 ="</span>, result) <span class="hljs-comment">// 输出：5 * 6 = 30</span>

    <span class="hljs-comment">// 4. 立即执行函数的常见用途：创建临时作用域</span>
    {
        x := <span class="hljs-number">10</span>
        fmt.Println(<span class="hljs-string">"局部作用域x ="</span>, x) <span class="hljs-comment">// 输出：局部作用域x = 10</span>
    }
    <span class="hljs-comment">// 用立即执行函数模拟</span>
    <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> {
        y := <span class="hljs-number">20</span>
        fmt.Println(<span class="hljs-string">"立即执行函数作用域y ="</span>, y) <span class="hljs-comment">// 输出：立即执行函数作用域y = 20</span>
    }()
    <span class="hljs-comment">// fmt.Println(x) // 编译报错：undefined: x</span>
    <span class="hljs-comment">// fmt.Println(y) // 编译报错：undefined: y</span>
}

<span class="hljs-comment">// 过滤函数：接收切片和过滤逻辑（匿名函数），返回过滤后的切片</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">filter</span><span class="hljs-params">(numbers []<span class="hljs-type">int</span>, condition <span class="hljs-keyword">func</span>(<span class="hljs-type">int</span>)</span></span> <span class="hljs-type">bool</span>) []<span class="hljs-type">int</span> {
    <span class="hljs-keyword">var</span> result []<span class="hljs-type">int</span>
    <span class="hljs-keyword">for</span> _, n := <span class="hljs-keyword">range</span> numbers {
        <span class="hljs-keyword">if</span> condition(n) {
            result = <span class="hljs-built_in">append</span>(result, n)
        }
    }
    <span class="hljs-keyword">return</span> result
}

</code></pre>
<h3 data-id="heading-23">5.2 立即执行函数的核心作用</h3>
<ul>
<li>
<p>创建临时作用域：避免变量污染全局或外层作用域（如上面的y变量，仅在立即执行函数内部有效）；</p>
</li>
<li>
<p>一次性执行逻辑：某些逻辑只需要执行一次（如初始化配置、加载资源），用立即执行函数封装，代码更整洁；</p>
</li>
<li>
<p>传递参数并立即处理：将参数传递给匿名函数，立即处理并返回结果，简化代码。</p>
</li>
</ul>
<h3 data-id="heading-24">5.3 最佳实践</h3>
<ul>
<li>
<p>匿名函数不宜过长：如果匿名函数逻辑复杂（超过10行），建议提取为命名函数，提升可读性；</p>
</li>
<li>
<p>立即执行函数用于临时逻辑：仅在需要“一次性执行+临时作用域”时使用，避免滥用；</p>
</li>
<li>
<p>匿名函数作为参数时，逻辑要简洁：如过滤、排序等简单逻辑，用匿名函数能简化代码；复杂逻辑建议用命名函数。</p>
</li>
</ul>
<h2 data-id="heading-25">6. 闭包的定义与变量捕获机制</h2>
<p>闭包（Closure）是Go函数的高级特性，也是函数式编程的核心。简单来说，<strong>闭包是“引用了外部变量的匿名函数”</strong>——这个匿名函数不仅包含自身的代码逻辑，还“捕获”了外部作用域的变量，即使外部作用域已经结束，闭包依然能访问和修改这些变量。</p>
<h3 data-id="heading-26">6.1 闭包的基础示例</h3>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span>

<span class="hljs-comment">// 定义一个函数，返回一个闭包</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">counter</span><span class="hljs-params">()</span></span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> <span class="hljs-type">int</span> {
    count := <span class="hljs-number">0</span> <span class="hljs-comment">// 外部变量：被闭包捕获</span>
    <span class="hljs-comment">// 匿名函数（闭包）：引用了外部变量count</span>
    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> <span class="hljs-type">int</span> {
        count++ <span class="hljs-comment">// 修改捕获的变量</span>
        <span class="hljs-keyword">return</span> count
    }
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// 创建两个闭包实例</span>
    c1 := counter()
    c2 := counter()

    <span class="hljs-comment">// 调用闭包c1</span>
    fmt.Println(c1()) <span class="hljs-comment">// 输出：1</span>
    fmt.Println(c1()) <span class="hljs-comment">// 输出：2</span>
    fmt.Println(c1()) <span class="hljs-comment">// 输出：3</span>

    <span class="hljs-comment">// 调用闭包c2（独立的count变量）</span>
    fmt.Println(c2()) <span class="hljs-comment">// 输出：1</span>
    fmt.Println(c2()) <span class="hljs-comment">// 输出：2</span>

    <span class="hljs-comment">// 再次调用c1，继续累加</span>
    fmt.Println(c1()) <span class="hljs-comment">// 输出：4</span>
}

</code></pre>
<p>关键说明：</p>
<ul>
<li>
<p>counter函数返回一个闭包，闭包捕获了外部变量count；</p>
</li>
<li>
<p>每次调用counter()，都会创建一个新的count变量和新的闭包实例（c1和c2是两个独立的闭包，各自的count互不影响）；</p>
</li>
<li>
<p>即使counter函数执行结束（外部作用域结束），闭包依然能访问和修改count变量——这就是闭包的核心特性。</p>
</li>
</ul>
<h3 data-id="heading-27">6.2 核心机制：变量捕获</h3>
<p>闭包对外部变量的“捕获”，是按“引用”捕获，而不是按“值”捕获。这意味着：闭包内部修改的是外部变量的原始值，而不是副本。</p>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span>

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">modifyExternal</span><span class="hljs-params">()</span></span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> {
    x := <span class="hljs-number">10</span>
    <span class="hljs-comment">// 闭包：捕获x的引用</span>
    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> {
        x += <span class="hljs-number">5</span>
        fmt.Println(<span class="hljs-string">"x ="</span>, x)
    }
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    f := modifyExternal()
    f() <span class="hljs-comment">// 输出：x = 15（修改原始x）</span>
    f() <span class="hljs-comment">// 输出：x = 20（继续修改）</span>

    <span class="hljs-comment">// 重新创建闭包，捕获新的x</span>
    f2 := modifyExternal()
    f2() <span class="hljs-comment">// 输出：x = 15（新的x）</span>
}

</code></pre>
<h3 data-id="heading-28">6.3 闭包捕获变量的细节</h3>
<p>闭包捕获的是“变量本身”，而不是变量在某个时刻的值。这个细节容易导致“意想不到的bug”，必须注意：</p>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span>

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">var</span> funcs []<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span>
    <span class="hljs-comment">// 循环创建闭包，捕获变量i</span>
    <span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">3</span>; i++ {
        funcs = <span class="hljs-built_in">append</span>(funcs, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> {
            fmt.Println(<span class="hljs-string">"i ="</span>, i)
        })
    }
    <span class="hljs-comment">// 执行所有闭包</span>
    <span class="hljs-keyword">for</span> _, f := <span class="hljs-keyword">range</span> funcs {
        f()
    }
    <span class="hljs-comment">// 预期输出：0、1、2</span>
    <span class="hljs-comment">// 实际输出：3、3、3</span>
}

</code></pre>
<p>原因分析：</p>
<ul>
<li>
<p>循环中创建的所有闭包，捕获的是同一个变量i（循环变量i在循环过程中不断变化）；</p>
</li>
<li>
<p>当执行闭包时，循环已经结束，i的值已经变成3，所以所有闭包输出的都是3。</p>
</li>
</ul>
<p>解决方案：在循环内部创建临时变量，将i的值赋值给临时变量，闭包捕获临时变量（临时变量每次循环都会重新创建）：</p>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span>

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">var</span> funcs []<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span>
    <span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">3</span>; i++ {
        temp := i <span class="hljs-comment">// 临时变量，每次循环重新创建</span>
        funcs = <span class="hljs-built_in">append</span>(funcs, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> {
            fmt.Println(<span class="hljs-string">"i ="</span>, temp)
        })
    }
    <span class="hljs-keyword">for</span> _, f := <span class="hljs-keyword">range</span> funcs {
        f()
    }
    <span class="hljs-comment">// 输出：0、1、2（符合预期）</span>
}

</code></pre>
<h2 data-id="heading-29">7. 闭包中的变量生命周期问题</h2>
<p>在Go中，变量的生命周期由“引用关系”决定：只要有变量被引用，就不会被垃圾回收（GC）。闭包的存在，会延长外部变量的生命周期——即使外部作用域已经结束，只要闭包还被引用，捕获的外部变量就不会被GC回收。</p>
<h3 data-id="heading-30">7.1 示例：闭包延长变量生命周期</h3>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span>

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">createClosure</span><span class="hljs-params">()</span></span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// 局部变量：正常情况下，createClosure执行结束后，x会被GC回收</span>
    x := <span class="hljs-number">100</span>
    fmt.Println(<span class="hljs-string">"createClosure：x被创建，地址="</span>, &amp;x)
    <span class="hljs-comment">// 闭包捕获x</span>
    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> {
        fmt.Println(<span class="hljs-string">"闭包：x的值="</span>, x, <span class="hljs-string">"，地址="</span>, &amp;x)
    }
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    f := createClosure() <span class="hljs-comment">// createClosure执行结束，但x被闭包捕获</span>
    f() <span class="hljs-comment">// 闭包依然能访问x，说明x未被GC回收</span>
    f() <span class="hljs-comment">// 再次访问，x依然存在</span>
}

</code></pre>
<p>输出结果：</p>
<pre><code class="hljs language-Plain" lang="Plain">
createClosure：x被创建，地址= 0xc00001a0a8
闭包：x的值= 100 ，地址= 0xc00001a0a8
闭包：x的值= 100 ，地址= 0xc00001a0a8

</code></pre>
<p>结论：闭包捕获的x变量，在createClosure执行结束后依然存在，地址不变，说明生命周期被延长。</p>
<h3 data-id="heading-31">7.2 注意事项：避免内存泄漏</h3>
<p>闭包延长变量生命周期的特性，可能导致“内存泄漏”——如果闭包被长期引用（如存储在全局变量中），且捕获的变量占用大量内存（如大切片、大结构体），这些变量会一直无法被GC回收，导致内存占用过高。</p>
<p>解决方案：</p>
<ul>
<li>
<p>避免捕获大变量：如果需要使用大变量的部分数据，可先提取为小变量，再让闭包捕获；</p>
</li>
<li>
<p>及时释放闭包引用：当闭包不再需要时，将闭包变量设为nil，切断引用，让GC回收捕获的变量；</p>
</li>
<li>
<p>合理设计闭包作用域：避免将闭包存储在全局变量中，尽量限制在局部作用域。</p>
</li>
</ul>
<h2 data-id="heading-32">8. 函数式编程思想在Go中的应用</h2>
<p>函数式编程是一种编程范式，核心思想是“用函数作为核心操作单元”，强调“纯函数”（无副作用）、“不可变数据”和“函数组合”。Go不是严格的函数式编程语言，但通过函数值、匿名函数和闭包，支持部分函数式编程思想，能极大提升代码的简洁性和可维护性。</p>
<h3 data-id="heading-33">8.1 核心应用1：纯函数</h3>
<p>纯函数是指“没有副作用”的函数：</p>
<ul>
<li>
<p>输入相同，输出必然相同；</p>
</li>
<li>
<p>不修改外部变量；</p>
</li>
<li>
<p>不执行IO操作（如打印、读写文件、网络请求）。</p>
</li>
</ul>
<p>纯函数的优势是“可预测性强”“易于测试”“线程安全”。</p>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span>

<span class="hljs-comment">// 纯函数：输入相同，输出相同；无副作用</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">pureAdd</span><span class="hljs-params">(a, b <span class="hljs-type">int</span>)</span></span> <span class="hljs-type">int</span> {
    <span class="hljs-keyword">return</span> a + b
}

<span class="hljs-comment">// 非纯函数：修改外部变量（有副作用）</span>
<span class="hljs-keyword">var</span> global <span class="hljs-type">int</span> = <span class="hljs-number">10</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">impureAdd</span><span class="hljs-params">(a <span class="hljs-type">int</span>)</span></span> <span class="hljs-type">int</span> {
    global += a <span class="hljs-comment">// 修改外部变量</span>
    <span class="hljs-keyword">return</span> global
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// 纯函数：多次调用，输入相同输出相同</span>
    fmt.Println(pureAdd(<span class="hljs-number">2</span>, <span class="hljs-number">3</span>)) <span class="hljs-comment">// 输出：5</span>
    fmt.Println(pureAdd(<span class="hljs-number">2</span>, <span class="hljs-number">3</span>)) <span class="hljs-comment">// 输出：5</span>

    <span class="hljs-comment">// 非纯函数：多次调用，输入相同输出不同（受外部变量影响）</span>
    fmt.Println(impureAdd(<span class="hljs-number">2</span>)) <span class="hljs-comment">// 输出：12</span>
    fmt.Println(impureAdd(<span class="hljs-number">2</span>)) <span class="hljs-comment">// 输出：14</span>
}

</code></pre>
<h3 data-id="heading-34">8.2 核心应用2：函数组合</h3>
<p>函数组合是指“将多个简单函数组合成一个复杂函数”，核心是“函数作为参数或返回值”。</p>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span>

<span class="hljs-comment">// 函数1：加1</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">add1</span><span class="hljs-params">(n <span class="hljs-type">int</span>)</span></span> <span class="hljs-type">int</span> {
    <span class="hljs-keyword">return</span> n + <span class="hljs-number">1</span>
}

<span class="hljs-comment">// 函数2：乘2</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">multiply2</span><span class="hljs-params">(n <span class="hljs-type">int</span>)</span></span> <span class="hljs-type">int</span> {
    <span class="hljs-keyword">return</span> n * <span class="hljs-number">2</span>
}

<span class="hljs-comment">// 函数组合：将两个函数f和g组合成一个新函数f(g(n))</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">compose</span><span class="hljs-params">(f, g <span class="hljs-keyword">func</span>(<span class="hljs-type">int</span>)</span></span> <span class="hljs-type">int</span>) <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(<span class="hljs-type">int</span>)</span></span> <span class="hljs-type">int</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(n <span class="hljs-type">int</span>)</span></span> <span class="hljs-type">int</span> {
        <span class="hljs-keyword">return</span> f(g(n))
    }
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// 组合函数：先乘2，再加1（multiply2 → add1）</span>
    addAfterMultiply := compose(add1, multiply2)
    fmt.Println(addAfterMultiply(<span class="hljs-number">3</span>)) <span class="hljs-comment">// 输出：3*2+1=7</span>

    <span class="hljs-comment">// 组合函数：先加1，再乘2（add1 → multiply2）</span>
    multiplyAfterAdd := compose(multiply2, add1)
    fmt.Println(multiplyAfterAdd(<span class="hljs-number">3</span>)) <span class="hljs-comment">// 输出：(3+1)*2=8</span>
}

</code></pre>
<h3 data-id="heading-35">8.3 核心应用3：高阶函数处理集合</h3>
<p>高阶函数是指“接收函数作为参数”或“返回函数作为结果”的函数。在Go中，高阶函数常用于处理集合（切片、map），实现过滤、映射、折叠等通用逻辑。</p>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span>

<span class="hljs-comment">// 映射（Map）：将切片中的每个元素通过函数f转换，返回新切片</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">mapSlice</span>[<span class="hljs-title">T</span> <span class="hljs-title">any</span>, <span class="hljs-title">U</span> <span class="hljs-title">any</span>]<span class="hljs-params">(slice []T, f <span class="hljs-keyword">func</span>(T)</span></span> U) []U {
    <span class="hljs-keyword">var</span> result []U
    <span class="hljs-keyword">for</span> _, v := <span class="hljs-keyword">range</span> slice {
        result = <span class="hljs-built_in">append</span>(result, f(v))
    }
    <span class="hljs-keyword">return</span> result
}

<span class="hljs-comment">// 过滤（Filter）：保留切片中满足函数f条件的元素，返回新切片</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">filterSlice</span>[<span class="hljs-title">T</span> <span class="hljs-title">any</span>]<span class="hljs-params">(slice []T, f <span class="hljs-keyword">func</span>(T)</span></span> <span class="hljs-type">bool</span>) []T {
    <span class="hljs-keyword">var</span> result []T
    <span class="hljs-keyword">for</span> _, v := <span class="hljs-keyword">range</span> slice {
        <span class="hljs-keyword">if</span> f(v) {
            result = <span class="hljs-built_in">append</span>(result, v)
        }
    }
    <span class="hljs-keyword">return</span> result
}

<span class="hljs-comment">// 折叠（Reduce）：将切片中的元素通过函数f累积为一个值</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">reduceSlice</span>[<span class="hljs-title">T</span> <span class="hljs-title">any</span>, <span class="hljs-title">U</span> <span class="hljs-title">any</span>]<span class="hljs-params">(slice []T, f <span class="hljs-keyword">func</span>(U, T)</span></span> U, initial U) U {
    result := initial
    <span class="hljs-keyword">for</span> _, v := <span class="hljs-keyword">range</span> slice {
        result = f(result, v)
    }
    <span class="hljs-keyword">return</span> result
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    numbers := []<span class="hljs-type">int</span>{<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>}

    <span class="hljs-comment">// 1. 映射：将每个元素乘2</span>
    doubled := mapSlice(numbers, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(n <span class="hljs-type">int</span>)</span></span> <span class="hljs-type">int</span> {
        <span class="hljs-keyword">return</span> n * <span class="hljs-number">2</span>
    })
    fmt.Println(<span class="hljs-string">"映射（乘2）："</span>, doubled) <span class="hljs-comment">// 输出：映射（乘2）： [2 4 6 8 10]</span>

    <span class="hljs-comment">// 2. 过滤：保留偶数</span>
    evens := filterSlice(numbers, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(n <span class="hljs-type">int</span>)</span></span> <span class="hljs-type">bool</span> {
        <span class="hljs-keyword">return</span> n%<span class="hljs-number">2</span> == <span class="hljs-number">0</span>
    })
    fmt.Println(<span class="hljs-string">"过滤（偶数）："</span>, evens) <span class="hljs-comment">// 输出：过滤（偶数）： [2 4]</span>

    <span class="hljs-comment">// 3. 折叠：计算所有元素的和</span>
    sum := reduceSlice(numbers, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(acc, n <span class="hljs-type">int</span>)</span></span> <span class="hljs-type">int</span> {
        <span class="hljs-keyword">return</span> acc + n
    }, <span class="hljs-number">0</span>)
    fmt.Println(<span class="hljs-string">"折叠（求和）："</span>, sum) <span class="hljs-comment">// 输出：折叠（求和）： 15</span>

    <span class="hljs-comment">// 4. 组合使用：先过滤偶数，再映射乘3，最后求和</span>
    combined := reduceSlice(
        mapSlice(
            filterSlice(numbers, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(n <span class="hljs-type">int</span>)</span></span> <span class="hljs-type">bool</span> { <span class="hljs-keyword">return</span> n%<span class="hljs-number">2</span> == <span class="hljs-number">0</span> }),
            <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(n <span class="hljs-type">int</span>)</span></span> <span class="hljs-type">int</span> { <span class="hljs-keyword">return</span> n * <span class="hljs-number">3</span> }),
        <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(acc, n <span class="hljs-type">int</span>)</span></span> <span class="hljs-type">int</span> { <span class="hljs-keyword">return</span> acc + n },
        <span class="hljs-number">0</span>,
    )
    fmt.Println(<span class="hljs-string">"组合使用结果："</span>, combined) <span class="hljs-comment">// 输出：组合使用结果： (2*3)+(4*3)= 18</span>
}

</code></pre>
<p>说明：上面的代码使用了Go 1.18+新增的<strong>泛型</strong>（T、U是类型参数），让函数能支持任意类型的切片，通用性更强。泛型不是本文重点，后续章节会详细讲解。</p>
<h3 data-id="heading-36">8.4 函数式编程的最佳实践</h3>
<ul>
<li>
<p>优先使用纯函数：纯函数易于测试和维护，尤其是在并发场景中（线程安全）；</p>
</li>
<li>
<p>合理使用高阶函数：处理集合时，用高阶函数（map、filter、reduce）替代重复的循环逻辑，提升代码复用率；</p>
</li>
<li>
<p>避免过度函数组合：复杂的函数组合会降低代码可读性，建议控制组合层数（不超过3层）；</p>
</li>
<li>
<p>结合Go的特性：Go不是纯函数式语言，不必强行追求“纯函数式”，应结合Go的并发、接口等特性，灵活使用函数式编程思想。</p>
</li>
</ul>
<h2 data-id="heading-37">总结</h2>
<p>本章我们全面讲解了Go函数的核心特性，从基础定义到高级的闭包和函数式编程，核心要点总结如下：</p>
<ol>
<li>
<p>函数定义：语法简洁，参数类型后置，支持多返回值；参数传递是值传递，引用类型的副本指向同一底层数据；</p>
</li>
<li>
<p>多返回值与错误处理：Go的错误处理惯例是“返回值末尾放error”，调用后必须先判断error；</p>
</li>
<li>
<p>命名返回值：自动初始化，支持裸return，适合多返回值和复杂错误处理的函数；</p>
</li>
<li>
<p>函数值：函数作为一等公民，可以赋值给变量、作为参数或返回值，核心是函数签名匹配；</p>
</li>
<li>
<p>匿名函数与立即执行函数：匿名函数用于临时逻辑，立即执行函数用于创建临时作用域和一次性执行；</p>
</li>
<li>
<p>闭包：引用外部变量的匿名函数，按引用捕获变量，会延长外部变量的生命周期；注意避免循环中捕获同一变量的坑；</p>
</li>
<li>
<p>函数式编程：Go支持部分函数式编程思想，纯函数、函数组合、高阶函数是核心应用，能提升代码复用率和可读性。</p>
</li>
</ol>
<p>函数是Go编程的核心，掌握这些特性，能让你写出更简洁、高效、可维护的代码。建议多动手实践：用函数封装业务逻辑、用闭包实现状态保存、用高阶函数处理集合，加深对函数特性的理解。如果有任何问题，欢迎在评论区交流～</p>
<p>参考链接：</p>
<ul>
<li>
<p>Go官方文档 - 函数：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgo.dev%2Fref%2Fspec%23Function_declarations" target="_blank" title="https://go.dev/ref/spec#Function_declarations" ref="nofollow noopener noreferrer">go.dev/ref/spec#Fu…</a></p>
</li>
<li>
<p>Go官方博客 - 闭包：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgo.dev%2Fblog%2Fclosures" target="_blank" title="https://go.dev/blog/closures" ref="nofollow noopener noreferrer">go.dev/blog/closur…</a></p>
</li>
<li>
<p>Go标准库 - errors包：<a href="https://link.juejin.cn?target=https%3A%2F%2Fpkg.go.dev%2Ferrors" target="_blank" title="https://pkg.go.dev/errors" ref="nofollow noopener noreferrer">pkg.go.dev/errors</a></p>
</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[老板说拼图游戏太卷了，让我用Cocos做个3d版本的...]]></title>    <link>https://juejin.cn/post/7599094262592143370</link>    <guid>https://juejin.cn/post/7599094262592143370</guid>    <pubDate>2026-01-26T00:42:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599094262592143370" data-draft-id="7599268297202335782" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="老板说拼图游戏太卷了，让我用Cocos做个3d版本的..."/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-26T00:42:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="亿元程序员"/> <meta itemprop="url" content="https://juejin.cn/user/1972988307323236"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            老板说拼图游戏太卷了，让我用Cocos做个3d版本的...
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1972988307323236/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    亿元程序员
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-26T00:42:53.000Z" title="Mon Jan 26 2026 00:42:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f1665f88f8fe44cba30baf9a7aaee4de~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769992973&amp;x-signature=%2FBp5I86jPumUmwdkfeBtoElo1XE%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<h2 data-id="heading-0">引言</h2>
<p><strong>哈喽大家好</strong>，我是亿元程序员，上次老板让做拼图游戏的那个小伙伴又来了：</p>
<blockquote>
<p><strong>亿哥</strong>，我又来了（捂脸），上次我们老板不是让我们趁热抢个拼图游戏头位吗？</p>
<p><strong>结果</strong>还是慢了一节，投流基本纯亏，现在大家都在拼题材和变种了（哭笑不得）。</p>
<p><strong>老板</strong>却异想天开，让我搞一个<code>3d</code>版本的（捂脸），我这没有经验咋搞啊！</p>
</blockquote>
<p><strong>别慌</strong>，<code>3d</code>版本的拼图游戏？那不就是拼模型！其实很早就有小伙伴咨询笔者关于<code>Cocos</code>游戏开发中的动态切割模型！（之前还不知道意欲何为，现在想起大有乾坤。）</p>
<p><strong>言归正传</strong>，本期带大家一起来看看，如何在<code>Cocos</code>游戏开发中，<strong>实现一个<code>3d</code>版本的拼图（拼模型）游戏</strong>，并加入到我的<strong>亿元Cocos小游戏实战合集</strong>中去。</p>
<p><strong>本文源工程可在文末获取，小伙伴们自行前往。</strong></p>
<h2 data-id="heading-1">简单分析一下</h2>
<p><strong>3d的拼图游戏</strong>其实可以做成拼模型的游戏，就是基本规则沿用拼图游戏的规则：</p>
<blockquote>
<p><strong>将</strong>完整的图片按照难度分割成<code>n*n</code>的碎片，然后打乱，玩家通过交换拼图最终把图片恢复完整，包括一些特殊的规则，例如正确相邻的图片会合并成整体。</p>
</blockquote>
<p><strong>拼模型游戏</strong>就是按照上述规则，将图片替换成模型即可，其关键的第一步就是要把模型动态分割。</p>
<p><strong>那么问题来了，如何将一个模型进行动态分割？</strong></p>
<h2 data-id="heading-2">动态模型分割</h2>
<p><strong>其实</strong>关于动态模型分割，笔者之前的文章就已经做过了介绍，感兴趣的小伙伴可以前往阅读<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F3BzzFBzeVAO-a6LPTeFTrA" target="_blank" title="https://mp.weixin.qq.com/s/3BzzFBzeVAO-a6LPTeFTrA" ref="nofollow noopener noreferrer">《如何在CocosCreator3.8中实现动态切割模型？》
</a>。</p>
<p><strong>动态模型分割</strong>，说是分割，其实是创建，就是动态创建被切割平面分割的两部分子模型，然后把原模型销毁。</p>
<p><strong>其中</strong>最关键的<code>API</code>就是<code>utils.MeshUtils.createMesh</code>。这里面涉及的知识点实在是非常多，包括分割、生成、割面填充等等，不要求小伙伴们都会，会用就行，或者会指挥<code>AI</code>用就行。</p>
<p><strong>既然分割起来这么麻烦，有没有更简单的方法？</strong></p>
<h2 data-id="heading-3">美术妹子分割</h2>
<p><strong>美术妹子</strong> ： 我再次谢谢你！（为什么是再次？）</p>
<p><strong>这时候</strong>又有小伙伴提出疑问了：</p>
<blockquote>
<p><strong>不是</strong>说程序能完成的事情，尽量不要麻烦美术妹子吗？</p>
<p><strong>就不怕</strong>妹子追你九条街？</p>
</blockquote>
<p><strong>其实</strong>对于没有<code>3d</code>游戏开发经验的小伙伴来说，美术妹子分割好给到都不一定能完成游戏的开发，更何况通过程序去动态切割！</p>
<p><strong>说到这里</strong>，我相信美术妹子会理解的，模型能切割成的份数，很多情况下是可以确定的，所以试试看，说不定能成。</p>
<p><strong>话又说回来，没有3d游戏开发经验的小伙伴，该怎么着手开发拼模型游戏？</strong></p>
<h2 data-id="heading-4">创建项目</h2>
<p><strong>万事开头难</strong>，首先第一步就要创建项目，这里注意要创建一个<code>3d</code>的项目。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/89db1c58d3354a1cad4f09070732098a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769992973&amp;x-signature=7Qcnfq3mVJPHZ4eXmtlzuvWsHmc%3D" alt="" loading="lazy"/></p>
<p><strong>区别于</strong><code>2d</code>游戏项目，项目创建后，场景中会自带灯光和相机，以及三维的场景编辑器。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3be8b244ef744761ae9be0356702671b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769992973&amp;x-signature=lK4ucByJTlZhy%2Bes1wIifK7dk%2FU%3D" alt="" loading="lazy"/></p>
<p><strong>下面</strong>列举一些常用的操作：</p>
<ul>
<li>
<p><strong>定位物体</strong> ：可以通过双击或者快捷键<code>F</code>，快速定位物体。
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a49943a870d749f1a10bac2411f8e767~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769992973&amp;x-signature=q9odxG5fGOGjsO93Rx73VlSNUrI%3D" alt="" loading="lazy"/></p>
</li>
<li>
<p><strong>场景漫游</strong> ：按下鼠标右键后，可以通过快捷键<code>w</code>、<code>s</code>、<code>a</code>、<code>d</code>、<code>e</code>、<code>q</code>漫游场景。
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c7a4d1f1c9604d86a73fab50aa236109~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769992973&amp;x-signature=Mx5IDZHqwsNrIrE0o1lmYKRR%2FZU%3D" alt="" loading="lazy"/></p>
</li>
<li>
<p><strong>调整相机视角</strong> ：调整好合适的视角后，选中相机后可以通过菜单栏<code>节点-&gt;将节点对齐到场景视角</code>快速调整相机视角。
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/453360b9bbb54a96b9a0f798f9ddad62~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769992973&amp;x-signature=Su3Fi0JVAKwQscLVksg8MUB9VhE%3D" alt="" loading="lazy"/></p>
</li>
<li>
<p><strong>快速回到相机视角</strong> ：选中相机后可以通过菜单栏<code>节点-&gt;将场景视角对齐到与节点</code>快速回到相机视角。
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ac2a188730bb4f97bc4ffe9c0e828b8b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769992973&amp;x-signature=AmSPYXBfjeKrEN2onuSgjZqKvNE%3D" alt="" loading="lazy"/></p>
</li>
</ul>
<p><strong>这太基础了，你上你也行，那如何让界面既能显示3d模型又能显示UI？</strong></p>
<h2 data-id="heading-5">多相机共存</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/811a7c4fbd3f475fbf5a9f28e519abe6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769992973&amp;x-signature=ntYenKHwBv2vEqeMuPv0tMLc4uw%3D" alt="" loading="lazy"/></p>
<p>**如上图所示，**游戏画面中包含UI和模型，意味着场景中可能包含至少<code>2</code>个相机。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/821a2c453c154894810a36dc37574f1e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769992973&amp;x-signature=sNlkQgVdxVpXaIBEkcVRqhkdY3Y%3D" alt="" loading="lazy"/></p>
<p><strong>控制</strong>相机拍摄哪些物体可以通过<code>Visibility</code>属性去控制。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/705d811aabab41cc87763edb0b89b251~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769992973&amp;x-signature=ggpfWleVQhQ8ch1omJ2WVLAyEtM%3D" alt="" loading="lazy"/></p>
<p><strong>控制</strong>相机的渲染优先级可以通过<code>Priority</code>属性去控制，如上面拍背景的相机为<code>0</code>、拍模型的相机为<code>1</code>，拍弹框的相机为<code>2</code>。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6b67b3fca6cc410e9b39d70cdb318e4c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769992973&amp;x-signature=Nijb%2BTiq1mUGkeAJmQPwTTQK1EU%3D" alt="" loading="lazy"/></p>
<p><strong>说了那么多，可以开始实战写模型游戏，写代码没？</strong></p>
<h2 data-id="heading-6">拼模型游戏实战</h2>
<p><strong>相信小伙伴们通过上面的文章内容，已经学会如何着手开发拼模型游戏了吧！</strong></p>
<p><strong>由于</strong>本期还没有贴熟悉的代码，笔者还是决定补充一些关键代码：</p>
<ul>
<li>
<p><strong>屏幕点击3d物体</strong> ： 首先通过<code>screenPointToRay</code>方法将点击转成射线，然后通过<code>PhysicsSystem.instance.raycast</code>获取到对应的物体。
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f811acc0b6df4de8b7302f9676b59be0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769992973&amp;x-signature=6x1Yda6Gu4mSRc%2BLnJ%2Fxwa9YgWg%3D" alt="" loading="lazy"/></p>
</li>
<li>
<p><strong>拖拽3d物体</strong> ：
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/28620b65dafc430d911a420995dca8a6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769992973&amp;x-signature=bG3kt2yUFlqsG%2FkZTECqfSFzkaU%3D" alt="" loading="lazy"/></p>
</li>
<li>
<p><strong>3d物体动画</strong> ： 直接用熟悉的<code>tween</code>动画即可。
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c604c19d08c44768b874e6d8e9ac8238~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769992973&amp;x-signature=Y0uuNIy%2BZwKbMrRDufQ4tVLVlkk%3D" alt="" loading="lazy"/></p>
</li>
</ul>
<h2 data-id="heading-7">效果演示</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7242914c6905423f9ebf4152fe0875d8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769992973&amp;x-signature=RHWcjrGpsPRy3k3A4QJKozAibe0%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<h2 data-id="heading-8">结语</h2>
<p><strong>拼图游戏</strong>现在都玩出花了，要不要做个<code>3d</code>版本的试一试？</p>
<p><strong>小伙伴们</strong>，你们都学会了吗？</p>
<p>本文<strong>实战完整源码</strong>已集成到<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FFOi5gCiGzF3LnT03DpPMXA" target="_blank" title="https://mp.weixin.qq.com/s/FOi5gCiGzF3LnT03DpPMXA" ref="nofollow noopener noreferrer">亿元Cocos小游戏实战合集</a>，内含体验链接，通过添加模型即可完成关卡的配置。</p>
<hr/>
<p><strong>我是"亿元程序员"，一位有着8年游戏行业经验的主程。在游戏开发中，希望能给到您帮助, 也希望通过您能帮助到大家。</strong></p>
<p>AD:笔者线上的小游戏《打螺丝闯关》《贪吃蛇掌机经典》《重力迷宫球》《填色之旅》《方块掌机经典》大家可以自行点击搜索体验。</p>
<p>实不相瞒，想要个<strong>赞</strong>和<strong>爱心</strong>！请把该文章<strong>分享</strong>给你觉得有需要的其他小伙伴。谢谢！</p>
<p>推荐文章：</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FFOi5gCiGzF3LnT03DpPMXA" target="_blank" title="https://mp.weixin.qq.com/s/FOi5gCiGzF3LnT03DpPMXA" ref="nofollow noopener noreferrer">亿元Cocos小游戏实战合集</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FXLCknL3fJDubec2GW6KLFA" target="_blank" title="https://mp.weixin.qq.com/s/XLCknL3fJDubec2GW6KLFA" ref="nofollow noopener noreferrer">Cocos游戏如何接入安卓穿山甲广告变现？</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F3_VrSld4KnDKY_7hxjSoKg" target="_blank" title="https://mp.weixin.qq.com/s/3_VrSld4KnDKY_7hxjSoKg" ref="nofollow noopener noreferrer">你知道和不知道的微信小游戏常用API整理，赶紧收藏用起来~</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F0Lj24VHJ-pL8z82hHqQLiA" target="_blank" title="https://mp.weixin.qq.com/s/0Lj24VHJ-pL8z82hHqQLiA" ref="nofollow noopener noreferrer">Cocos游戏如何快速接入抖音小游戏广告变现？</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FZ7DusUJA2v1IFZDFtBsueg" target="_blank" title="https://mp.weixin.qq.com/s/Z7DusUJA2v1IFZDFtBsueg" ref="nofollow noopener noreferrer">如何在CocosCreator3.8中实现割绳子游戏效果</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F3BzzFBzeVAO-a6LPTeFTrA" target="_blank" title="https://mp.weixin.qq.com/s/3BzzFBzeVAO-a6LPTeFTrA" ref="nofollow noopener noreferrer">如何在CocosCreator3.8中实现动态切割模型？</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FZIph332u_r24OTY4r6_jow" target="_blank" title="https://mp.weixin.qq.com/s/ZIph332u_r24OTY4r6_jow" ref="nofollow noopener noreferrer">Cocos游戏开发中的贴花效果</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Claude Code Tasks 来了：从"随用随忘"到跨会话持久化任务管理]]></title>    <link>https://juejin.cn/post/7599094262592176138</link>    <guid>https://juejin.cn/post/7599094262592176138</guid>    <pubDate>2026-01-26T00:51:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599094262592176138" data-draft-id="7598807837868441626" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Claude Code Tasks 来了：从&quot;随用随忘&quot;到跨会话持久化任务管理"/> <meta itemprop="keywords" content="Claude,AIGC,AI编程"/> <meta itemprop="datePublished" content="2026-01-26T00:51:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="黄林晴"/> <meta itemprop="url" content="https://juejin.cn/user/3985057546510423"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Claude Code Tasks 来了：从"随用随忘"到跨会话持久化任务管理
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3985057546510423/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    黄林晴
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-26T00:51:59.000Z" title="Mon Jan 26 2026 00:51:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>2026年1月，Anthropic 悄悄上线了 Claude Code 的重大更新——Tasks 系统。这个功能将彻底改变你使用 AI 编程助手处理复杂项目的方式。</p>
</blockquote>
<hr/>
<h2 data-id="heading-0">Todos 的痛点：用完就忘</h2>
<p>如果你是 Claude Code 的老用户，可能听说过 Todos 功能。但说实话，大多数人都会忽略它。</p>
<p>为什么？因为 <strong>Todos 存在内存中</strong>。</p>
<p>这意味着：</p>
<ul>
<li>• 关闭会话，任务清单消失</li>
<li>• 启动子代理（sub-agent），它完全不知道主代理在追踪什么</li>
<li>• 多个会话之间无法共享任务状态</li>
</ul>

<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 旧版 Todos 的尴尬处境</span>
Session 1: 创建了5个 todos → 关闭
Session 2: <span class="hljs-string">"什么 todos？我不知道啊"</span>
</code></pre>
<p>这就像用便利贴管理项目——写完贴墙上，转头就找不到了。</p>
<hr/>
<h2 data-id="heading-1">Tasks：持久化 + 依赖 + 协作</h2>
<p>新的 Tasks 系统解决了所有这些问题。</p>
<h3 data-id="heading-2">持久化存储</h3>
<p>任务现在保存在 <code>~/.claude/tasks</code> 目录中。关闭 Claude Code，明天再打开，任务还在那里等你。</p>
<h3 data-id="heading-3">依赖关系管理</h3>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-built_in">Task</span> A: 设计数据库 Schema
<span class="hljs-built_in">Task</span> B: 实现 Repository 层  ← blockedBy: <span class="hljs-built_in">Task</span> A
<span class="hljs-built_in">Task</span> C: 编写单元测试       ← blockedBy: <span class="hljs-built_in">Task</span> B
</code></pre>
<p>Tasks 支持定义任务之间的依赖关系。只有前置任务完成，后续任务才能开始。</p>
<h3 data-id="heading-4">多代理协作</h3>
<p>这是最强大的特性。多个子代理或多个 Claude Code 会话可以：</p>
<ul>
<li>• 访问同一个任务列表</li>
<li>• 实时同步状态更新</li>
<li>• 避免重复工作</li>
</ul>
<p>想象一下：你让一个代理写前端，另一个写后端，它们共享同一份任务清单，互相知道对方的进度。</p>
<hr/>
<h2 data-id="heading-5">核心工具一览</h2>
<p>Tasks 系统提供四个核心工具：</p>






























<table><thead><tr><th>工具</th><th>功能</th><th>使用场景</th></tr></thead><tbody><tr><td><code>TaskCreate</code></td><td>创建新任务</td><td>规划项目、分解需求</td></tr><tr><td><code>TaskList</code></td><td>查看任务列表</td><td>了解整体进度</td></tr><tr><td><code>TaskGet</code></td><td>获取任务详情</td><td>查看具体描述和依赖</td></tr><tr><td><code>TaskUpdate</code></td><td>更新任务状态</td><td>标记进度、设置依赖</td></tr></tbody></table>
<p>任务有三种状态：</p>
<pre><code class="hljs"> pending → in_progress → completed
 待处理      进行中        已完成
</code></pre>
<hr/>
<h2 data-id="heading-6">实战示例</h2>
<p>假设你要给项目添加用户认证功能：</p>
<pre><code class="hljs language-less" lang="less">&gt; 帮我实现用户登录功能，需要 <span class="hljs-selector-tag">JWT</span> 认证

<span class="hljs-selector-tag">Claude</span> <span class="hljs-selector-tag">Code</span> 自动创建任务：
<span class="hljs-selector-attr">[1]</span> 设计用户数据模型        ✓ <span class="hljs-selector-tag">completed</span>
<span class="hljs-selector-attr">[2]</span> 实现 <span class="hljs-selector-tag">JWT</span> 工具类         ● <span class="hljs-selector-tag">in_progress</span>
<span class="hljs-selector-attr">[3]</span> 创建登录 <span class="hljs-selector-tag">API</span> 端点       ○ <span class="hljs-selector-tag">pending</span> (<span class="hljs-attribute">blockedBy</span>: <span class="hljs-number">2</span>)
<span class="hljs-selector-attr">[4]</span> 添加中间件验证          ○ <span class="hljs-selector-tag">pending</span> (<span class="hljs-attribute">blockedBy</span>: <span class="hljs-number">3</span>)
<span class="hljs-selector-attr">[5]</span> 编写集成测试            ○ <span class="hljs-selector-tag">pending</span> (<span class="hljs-attribute">blockedBy</span>: <span class="hljs-number">4</span>)
</code></pre>
<p>即使你中途关闭 Claude Code 去开会，回来后它依然记得：</p>
<ul>
<li>• 哪些任务完成了</li>
<li>• 当前在做什么</li>
<li>• 接下来该做什么</li>
</ul>
<hr/>
<h2 data-id="heading-7">Tasks vs Skills：别搞混了</h2>
<p>很多人会问：Tasks 和 Skills 有什么区别？</p>
<p><strong>Skills（技能）</strong> ：</p>
<ul>
<li>• 教会 Claude 特定领域知识</li>
<li>• 存储在 <code>~/.claude/skills/</code> 目录</li>
<li>• 通过 <code>/skill-name</code> 手动调用</li>
<li>• 适合：代码规范、提交模板、架构指南</li>
</ul>
<p><strong>Tasks（任务）</strong> ：</p>
<ul>
<li>• 管理工作项和进度</li>
<li>• 支持并行处理和子代理调度</li>
<li>• 动态创建，自动追踪</li>
<li>• 适合：复杂项目、多步骤重构、功能开发</li>
</ul>
<p>简单说：</p>
<ul>
<li>• Skills 是"我会什么"</li>
<li>• Tasks 是"我要做什么"</li>
</ul>
<p>两者配合使用效果更佳。比如用 Skills 定义代码规范，用 Tasks 管理重构进度。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a32c2ab7008b41bb884ac6c1dd177bc1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6buE5p6X5pm0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769993518&amp;x-signature=pIVwq%2BwDcBotR%2BdPwiVzd6bBzLs%3D" alt="claude_code_tasks_vs_skills.png" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-8">什么时候该用 Tasks？</h2>
<p><strong>适合用 Tasks 的场景</strong>：</p>
<ul>
<li>• 跨多个文件的功能开发</li>
<li>• 大规模代码重构</li>
<li>• 需要多个步骤的测试套件编写</li>
<li>• 任何需要"记住进度"的复杂工作</li>
</ul>
<p><strong>不需要 Tasks 的场景</strong>：</p>
<ul>
<li>• 修复一个小 bug</li>
<li>• 重构单个函数</li>
<li>• 简单的代码查询</li>
</ul>
<p>正如官方所说：对于小任务，Claude 足够聪明，不需要任务管理系统。但对于大项目，Tasks 是你的得力助手。</p>
<hr/>
<h2 data-id="heading-9">使用技巧</h2>
<ol>
<li><strong>让 Claude 自动创建任务</strong>：描述一个复杂需求，Claude 会自动分解成多个任务</li>
<li><strong>善用依赖关系</strong>：确保任务按正确顺序执行</li>
<li><strong>定期查看任务列表</strong>：使用 <code>/tasks</code> 命令快速查看进度</li>
<li><strong>并行执行</strong>：没有依赖关系的任务可以同时进行，大幅提升效率</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/60f27af85eb144eea874ef042ef93f93~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6buE5p6X5pm0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769993518&amp;x-signature=d740QPwPAMLw4iBMkpvlpxTAsbY%3D" alt="claude_code_tasks_workflow.png" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-10">总结</h2>
<p>Claude Code Tasks 的上线，标志着 AI 编程助手从"对话式工具"向"项目管理伙伴"的转变。</p>






























<table><thead><tr><th>特性</th><th>旧版 Todos</th><th>新版 Tasks</th></tr></thead><tbody><tr><td>存储</td><td>内存（会话结束即消失）</td><td>文件系统（持久化）</td></tr><tr><td>依赖</td><td>不支持</td><td>完整支持</td></tr><tr><td>多代理</td><td>各自独立</td><td>共享协作</td></tr><tr><td>跨会话</td><td>不可能</td><td>原生支持</td></tr></tbody></table>
<p>如果你经常用 Claude Code 处理复杂项目，Tasks 功能值得你认真研究。它不仅仅是一个任务清单，而是让 AI 真正理解"项目进度"概念的关键一步。</p>
<hr/>
<p>你觉得 Tasks 功能怎么样？欢迎在评论区分享你的使用体验。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[栗子前端技术周刊第 114 期 - jQuery 4.0、Chrome 144、Node.js v25.4.0...]]></title>    <link>https://juejin.cn/post/7598537739517460522</link>    <guid>https://juejin.cn/post/7598537739517460522</guid>    <pubDate>2026-01-26T00:51:24.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598537739517460522" data-draft-id="7598537739516035114" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="栗子前端技术周刊第 114 期 - jQuery 4.0、Chrome 144、Node.js v25.4.0..."/> <meta itemprop="keywords" content="前端,JavaScript,jQuery"/> <meta itemprop="datePublished" content="2026-01-26T00:51:24.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="晓得迷路了"/> <meta itemprop="url" content="https://juejin.cn/user/2172290706715565"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            栗子前端技术周刊第 114 期 - jQuery 4.0、Chrome 144、Node.js v25.4.0...
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2172290706715565/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    晓得迷路了
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-26T00:51:24.000Z" title="Mon Jan 26 2026 00:51:24 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>🌰<strong>栗子前端技术周刊第 114 期 (2026.01.19 - 2026.01.25)</strong>：浏览前端一周最新消息，学习国内外优秀文章，让我们保持对前端的好奇心。</p>
<h2 data-id="heading-0">📰 技术资讯</h2>
<ol>
<li>
<p><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.jquery.com%2F2026%2F01%2F17%2Fjquery-4-0-0%2F" target="_blank" title="https://blog.jquery.com/2026/01/17/jquery-4-0-0/" ref="nofollow noopener noreferrer">jQuery 4.0</a></strong>：上周六 jQuery 4.0 正式发布，4.0 版本移除了对 IE 10 及更早期版本的支持，新增 Trusted Types 特性支持，对齐了 W3C 焦点事件规范，而最值得关注的是：jQuery 已全面迁移至 ES 模块体系，这意味着它可完美适配各类现代构建工具！</p>
</li>
<li>
<p><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.chrome.com%2Fblog%2Fgeolocation-html-element" target="_blank" title="https://developer.chrome.com/blog/geolocation-html-element" ref="nofollow noopener noreferrer">Chrome 144</a></strong>：Chrome 144 正式发布，新增 <code>&lt;geolocation&gt;</code> HTML 元素，该元素改变了网站请求用户位置数据的方式。</p>
</li>
<li>
<p><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fnodejs.org%2Fen%2Fblog%2Frelease%2Fv25.4.0" target="_blank" title="https://nodejs.org/en/blog/release/v25.4.0" ref="nofollow noopener noreferrer">Node.js 25.4.0</a></strong>：Node.js v25.4.0（最新版本）已发布，其中 <code>require(esm)</code> 功能现已标记为稳定版，模块编译缓存特性同步完成稳定化，此外还包含多项小幅优化调整。</p>
</li>
<li>
<p><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fdenoland%2Fdeno%2Freleases%2Ftag%2Fv2.6.5" target="_blank" title="https://github.com/denoland/deno/releases/tag/v2.6.5" ref="nofollow noopener noreferrer">Deno 2.6.5</a></strong>：Deno 2.6.5 发布，更新内容包括：为 <code>createImageBitmap</code> 接口新增 GIF、WEBP 格式支持；新增 <code>performance.clearResourceTimings()</code> 与 <code>setResourceTimingBufferSize()</code> 接口等等。</p>
</li>
</ol>
<h2 data-id="heading-1">📒 技术文章</h2>
<ol>
<li><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Falmanac.httparchive.org%2Fzh-CN%2F2025%2F" target="_blank" title="https://almanac.httparchive.org/zh-CN/2025/" ref="nofollow noopener noreferrer">The 2025 Web Almanac</a></strong>：2025 年度 Web 年鉴 - 这份向来兼具趣味性与深度的年度报告如期发布。报告基于对超 1700 万个网站的分析、总计约 244TB 数据的处理撰写而成！报告通过无障碍适配、性能优化、安全防护、内容分发、人工智能等多个章节，深度剖析了过去一年间 Web 领域的发展演变脉络。</li>
</ol>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b2a242d6f4cd425195b792acfee1b773~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pmT5b6X6L-36Lev5LqG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769993483&amp;x-signature=MKWGGDctP06EDWjQw9OukYm9Uz4%3D" width="100%" alt="image-20260125093321403" loading="lazy"/>
<ol start="2">
<li>
<p><strong><a href="https://juejin.cn/post/7596932640727056419" target="_blank" title="https://juejin.cn/post/7596932640727056419">AI辅助研发的落地实践：工具、效率与成长</a></strong>：本文将从“工具实践”与“个人成长”两个维度，分享作者在 AI 辅助研发方面的落地经验与思考，作者希望能为大家带来一些参考与启发。</p>
</li>
<li>
<p><strong><a href="https://juejin.cn/post/7596970073750552612" target="_blank" title="https://juejin.cn/post/7596970073750552612">前端指纹技术是如何实现的？（Canvas、Audio、硬件API 核心原理解密）</a></strong>：本文围绕前端指纹技术展开，介绍了设备指纹概念并详细阐述三种实现方式，Canvas 指纹、AudioContext 指纹和电池与硬件并发。</p>
</li>
</ol>
<h2 data-id="heading-2">🔧 开发工具</h2>
<ol>
<li><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fwooorm%2Fstarry-night" target="_blank" title="https://github.com/wooorm/starry-night" ref="nofollow noopener noreferrer">Starry Night 3.9</a></strong>：类 GitHub 语法高亮工具 —— GitHub 官方语法高亮器并非开源，但这款工具库是一款功能强大的替代方案，力求在效果上无限贴近官方版本，同时支持上百种编程语言。</li>
</ol>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/509b77b0162d41e982a6271603117f48~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pmT5b6X6L-36Lev5LqG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769993483&amp;x-signature=4jDNcTnlNq9dlz1CaS6XMfTJUKI%3D" width="100%" alt="image-20260125092657102" loading="lazy"/>
<ol start="2">
<li><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fextension.js.org%2F" target="_blank" title="https://extension.js.org/" ref="nofollow noopener noreferrer">Extension.js 3</a></strong>：浏览器扩展开发框架 —— 无需手动配置构建流程，即可创建跨浏览器扩展程序；通过统一的工作流，实现跨浏览器的开发、构建与预览。</li>
</ol>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b32a75968b2d451b9a25a0b0cddb4322~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pmT5b6X6L-36Lev5LqG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769993483&amp;x-signature=fYEtA%2FhpRxRPgfnNtemUC8VCeMc%3D" width="100%" alt="image-20260125092958438" loading="lazy"/>
<ol start="3">
<li><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fstylelint.io%2F" target="_blank" title="https://stylelint.io/" ref="nofollow noopener noreferrer">Stylelint 17.0</a></strong>：作为一款成熟的 CSS 代码检查工具，Stylelint 内置超 100 条规则，可帮助开发者“捕获代码错误、设定编码限制并强制执行样式规范”。</li>
</ol>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/91a00539e74f4ef58a573c3498fa2f1b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pmT5b6X6L-36Lev5LqG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769993483&amp;x-signature=c%2F2YKYD6jggPOJVdnOiPPeMLStg%3D" width="100%" alt="image-20260125094016446" loading="lazy"/>
<p>🚀🚀🚀 <em>以上资讯文章选自常见周刊，如 JavaScript Weekly 等，周刊内容也会不断优化改进，希望你们能够喜欢。</em></p>
<p>💖 <strong>欢迎关注微信公众号：栗子前端</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Compose 的震动还能这么玩儿？]]></title>    <link>https://juejin.cn/post/7598734303174574132</link>    <guid>https://juejin.cn/post/7598734303174574132</guid>    <pubDate>2026-01-26T01:00:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598734303174574132" data-draft-id="7598203055747874868" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Compose 的震动还能这么玩儿？"/> <meta itemprop="keywords" content="Kotlin,Android"/> <meta itemprop="datePublished" content="2026-01-26T01:00:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="RockByte"/> <meta itemprop="url" content="https://juejin.cn/user/1046390797768519"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Compose 的震动还能这么玩儿？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1046390797768519/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    RockByte
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-26T01:00:05.000Z" title="Mon Jan 26 2026 01:00:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:2;font-weight:400;font-size:15px;overflow-x:hidden;color:#333;letter-spacing:1.2px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1:first-child,.markdown-body h2:first-child,.markdown-body h3:first-child,.markdown-body h4:first-child,.markdown-body h5:first-child,.markdown-body h6:first-child{margin-top:-1.5rem;margin-bottom:1rem}.markdown-body h1:before,.markdown-body h2:before,.markdown-body h3:before,.markdown-body h4:before,.markdown-body h5:before,.markdown-body h6:before{content:"#";display:inline-block;color:#3eaf7c;padding-right:.23em}.markdown-body h1{position:relative;font-size:2.5rem;margin-bottom:5px}.markdown-body h1:before{font-size:2.5rem}.markdown-body h2{padding-bottom:.5rem;font-size:2.2rem;border-bottom:1px solid #ececec}.markdown-body h3{font-size:1.5rem;padding-bottom:0}.markdown-body h4{font-size:1.25rem}.markdown-body h5{font-size:1rem}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body strong{color:#3eaf7c}.markdown-body img{max-width:100%;border-radius:2px;display:block;margin:auto}.markdown-body hr{border:none;border-top:1px solid #3eaf7c;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;overflow-x:auto;padding:.2rem .5rem;margin:0;color:#3eaf7c;font-size:.85em;background-color:rgba(27,31,35,.05);border-radius:3px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;border:.5rem solid #3eaf7c}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{font-weight:500;text-decoration:none;color:#3eaf7c;margin:0 5px}.markdown-body a:active,.markdown-body a:hover{text-decoration:none;border-bottom:1.5px solid #3eaf7c}.markdown-body a[href^=http]:after{content:url("data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTQiIGhlaWdodD0iMTQiPjxkZWZzPjxzdHlsZS8+PC9kZWZzPjxwYXRoIGQ9Ik04MzIgMTI4SDY0MHY2NGgxNDYuNzUyTDUyMS4zNzYgNDU3LjM3Nmw0NS4yNDggNDUuMjQ4TDgzMiAyMzcuMjQ4VjM4NGg2NFYxMjh6IiBmaWxsPSIjM2VhZjdjIi8+PHBhdGggZD0iTTc2OCA4MzJIMTkyVjI1NmgzNTJ2LTY0SDE2MGEzMiAzMiAwIDAwLTMyIDMydjY0MGEzMiAzMiAwIDAwMzIgMzJoNjQwYTMyIDMyIDAgMDAzMi0zMlY0ODBoLTY0djM1MnoiIGZpbGw9IiMzZWFmN2MiLz48L3N2Zz4=");margin-left:2px}.markdown-body a[href^="#"]:before{content:"#"}.markdown-body table{display:inline-block!important;font-size:13px;width:auto;max-width:100%;overflow:auto;border:1px solid #3eaf7c;border-collapse:collapse}.markdown-body thead{background:#3eaf7c;color:#fff;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(153,255,188,.1)}.markdown-body td,.markdown-body th{padding:4px 8px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#7b7878;padding:1px 23px;border-left:.5rem solid;border-color:#42b983;background-color:rgba(66,184,131,.1);position:relative;margin:14px 8px 0}.markdown-body blockquote:before{display:inline-block;position:absolute;content:url("data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjUiIGhlaWdodD0iMjUiIHZpZXdCb3g9IjAgMCAyNyAyNyIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxLjg2MiAxLjg2MikiIGZpbGwtcnVsZT0ibm9uemVybyIgZmlsbD0ibm9uZSI+PGNpcmNsZSBzdHJva2U9IiNGRkYiIHN0cm9rZS13aWR0aD0iMS43MjQiIGZpbGw9IiM0MkI5ODMiIGN4PSIxMS42MzgiIGN5PSIxMS42MzgiIHI9IjExLjYzOCIvPjxwYXRoIGQ9Ik0xNC45NzggNi4yN0E1LjAwNiA1LjAwNiAwIDAwNi42NyA5LjQ2OGE0LjkwMSA0LjkwMSAwIDAwMS43NzMgNC4zNjJjLjMyMy4yNTguNTE0LjY0Ny41MjIgMS4wNnYxLjA2YTIuNjg1IDIuNjg1IDAgMDA1LjM3IDB2LTEuMDA4Yy4wMDItLjM5OC4xNzMtLjc3Ny40Ny0xLjA0MmE1LjAyMyA1LjAyMyAwIDAwLjE3My03LjYzem0tMy4zMzcgMTAuOTY3YTEuMzA0IDEuMzA0IDAgMDEtMS4yODYtMS4yODd2LS4yNzhoMi41NzJ2LjI2MWMwIC43MTMtLjU3MyAxLjI5NC0xLjI4NiAxLjMwNHptMi4yNi00LjQxNWMtLjQ0LjM4My0uNzUuODkzLS44ODcgMS40NmgtMi43NDZhMi44NjggMi44NjggMCAwMC0uOTM4LTEuNTNoLS4wMThhMy40NzYgMy40NzYgMCAwMS0xLjI2OS0zLjE0NSAzLjYxNSAzLjYxNSAwIDAxNy4xOTYuNCAzLjY1IDMuNjUgMCAwMS0xLjMzOCAyLjgxNXoiIGZpbGw9IiNGRkYiLz48L2c+PC9zdmc+");width:25px;height:25px;left:-16px;top:12px}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body details{outline:none;border:none;border-left:4px solid #3eaf7c;padding-left:10px;margin-left:4px}.markdown-body details summary{cursor:pointer;border:none;outline:none;background:#fff;margin:0 -17px}.markdown-body details summary::-webkit-details-marker{color:#3eaf7c}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body ol li::marker{color:#3eaf7c}.markdown-body ul li{list-style:none;padding-left:10px}.markdown-body ul li::marker{content:"•";color:#3eaf7c}.markdown-body ul li.task-list-item:before{content:"";margin-right:0}.markdown-body input[type=checkbox]{vertical-align:text-bottom;box-shadow:inset 0 0 0 10px #fff}.markdown-body input[type=checkbox]:before{content:url("data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiPjxkZWZzPjxzdHlsZS8+PC9kZWZzPjxwYXRoIGQ9Ik04NzcuMDU2IDE0Ni45NDR2NzMwLjExMkgxNDYuOTQ0VjE0Ni45NDRoNzMwLjExMnptMC0xMDQuMjc3SDE0Ni45NDRjLTU3LjYyOCAwLTEwNC4yNzcgNDYuNjQ5LTEwNC4yNzcgMTA0LjI3N3Y3MzAuMTEyYzAgNTcuNjI4IDQ2LjY0OSAxMDQuMjc3IDEwNC4yNzcgMTA0LjI3N2g3MzAuMTEyYzU3LjYyOCAwIDEwNC4yNzctNDYuNjQ5IDEwNC4yNzctMTA0LjI3N1YxNDYuOTQ0YzAtNTcuNjI4LTQ2LjY0OS0xMDQuMjc3LTEwNC4yNzctMTA0LjI3N3oiIGZpbGw9IiMzZWFmN2MiLz48L3N2Zz4=");position:relative;top:-2px;right:2px}.markdown-body input[type=checkbox]:checked:before{content:url("data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTUiIGhlaWdodD0iMTUiPjxkZWZzPjxzdHlsZS8+PC9kZWZzPjxwYXRoIGQ9Ik05MTAuMjA4IDBIMTEzLjc2QTExNC4xMTIgMTE0LjExMiAwIDAwLS4wMzIgMTEzLjc5MlY5MTAuMjRjMCA2Mi41OTIgNTEuMiAxMTMuNzkyIDExMy43OTIgMTEzLjc5Mmg3OTYuNDQ4YzYyLjU5MiAwIDExMy43OTItNTEuMiAxMTMuNzkyLTExMy43OTJWMTEzLjc5MkMxMDI0IDUxLjIgOTcyLjggMCA5MTAuMjA4IDB6bS01MTIgNzk2LjQ0OEwxMTMuNzYgNTEybDc5LjY0OC03OS42NDggMjA0LjggMjA0LjhMODMwLjU2IDIwNC44bDc5LjY0OCA3OS42NDgtNTEyIDUxMnoiIGZpbGw9IiMzZWFmN2MiLz48L3N2Zz4=");position:relative;top:-2px;right:2px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="xcode">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#fff;color:#000}.xml .hljs-meta{color:silver}.hljs-comment,.hljs-quote{color:#007400}.hljs-attribute,.hljs-keyword,.hljs-literal,.hljs-name,.hljs-selector-tag,.hljs-tag{color:#aa0d91}.hljs-template-variable,.hljs-variable{color:#3f6e74}.hljs-code,.hljs-meta-string,.hljs-string{color:#c41a16}.hljs-link,.hljs-regexp{color:#0e0eff}.hljs-bullet,.hljs-number,.hljs-symbol,.hljs-title{color:#1c00cf}.hljs-meta,.hljs-section{color:#643820}.hljs-built_in,.hljs-builtin-name,.hljs-class .hljs-title,.hljs-params,.hljs-type{color:#5c2699}.hljs-attr{color:#836c28}.hljs-subst{color:#000}.hljs-formula{background-color:#eee;font-style:italic}.hljs-addition{background-color:#baeeba}.hljs-deletion{background-color:#ffc8bd}.hljs-selector-class,.hljs-selector-id{color:#9b703f}.hljs-doctag,.hljs-strong{font-weight:700}.hljs-emphasis{font-style:italic}</style><p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8c6800beeb924f2484ce679c209c80d1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUm9ja0J5dGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769994004&amp;x-signature=cIxBYLXfmVshFDmNT53WpC%2F3wUU%3D" alt="2.png" loading="lazy"/></p>
<p>上周我在公司摸鱼的时候，发现 Github 上有一个开源库叫 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fcompose-jindong%2Fjindong" target="_blank" title="https://github.com/compose-jindong/jindong" ref="nofollow noopener noreferrer">Jindong</a>，没错，听起来就是京东！</p>
<p>我以为我看错了，京东什么时候开始干这玩意儿了？后面才发现误会了。</p>
<h2 data-id="heading-0">Jindong 是什么</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3ff95b33316948099512d1f39d6e87d5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUm9ja0J5dGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769994004&amp;x-signature=WKMy2Nd2ynuxlIIvCsHbB9NozM8%3D" alt="1.png" loading="lazy"/></p>
<p><strong>Jindong</strong> 为 Compose 跨平台应用（支持 Android 和 iOS）提供了声明式的触觉反馈 <strong>DSL</strong>。它基于 Compose 构建，让你能通过简单直观的 API 定义复杂的触觉模式。</p>
<blockquote>
<p>该开源库的作者是来自韩国的开发者。“Jindong”[tɕindooŋ]（진동）在韩语中意为“振动”。<br/>
好朴实无华的库名称，如果是中文名那岂不就是——Zhendong？</p>
</blockquote>
<p>我们知道，当前移动 UI 开发已成功转向声明式范式，但与硬件 API 的交互（尤其是触觉反馈）仍然主要依赖命令式编程。</p>
<p>所以这个库的初衷，是为了让触觉反馈的交互也转向声明范式，它解决了在 Compose Multiplatform 应用中实现触觉反馈的复杂性。借助 Compose，开发者现在可以将触觉模式以结构化描述的形式进行定义。</p>
<p>也就是说，它提供了一种声明范式的方式调用硬件 API，同时还支持跨平台。</p>
<h2 data-id="heading-1">传统震动</h2>
<p>我们先来看看传统的命令式方式——使用标准 Android API 创建波形振动，需要并行的时序和振幅值数组：</p>
<pre><code class="hljs language-kotlin" lang="kotlin">Column(
    modifier = Modifier.fillMaxSize(),
) {
    Button(onClick = {
        <span class="hljs-keyword">val</span> timings = longArrayOf(<span class="hljs-number">0</span>, <span class="hljs-number">50</span>, <span class="hljs-number">100</span>, <span class="hljs-number">50</span>, <span class="hljs-number">100</span>, <span class="hljs-number">50</span>)
        <span class="hljs-keyword">val</span> amplitudes = intArrayOf(<span class="hljs-number">0</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0</span>, <span class="hljs-number">128</span>, <span class="hljs-number">0</span>, <span class="hljs-number">255</span>)
        <span class="hljs-keyword">val</span> effect = VibrationEffect.createWaveform(timings, amplitudes, -<span class="hljs-number">1</span>)
        defaultVibrator.vibrate(effect)
    }) {
        Text(<span class="hljs-string">"Vibrate"</span>)
    }
}

</code></pre>
<p>调整某个节拍的持续时间需要重新计算数组索引。更不用说，这种逻辑是平台相关的，iOS 的 Core Haptics 需要完全不同的代码实现。</p>
<h2 data-id="heading-2">声明式</h2>
<p><strong>Jindong</strong> 将这些底层细节抽象为一种 DSL。开发者只需定义反馈结构，库会负责执行。</p>
<p>首先，我们添加权限和依赖：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">uses-permission</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.permission.VIBRATE"</span> /&gt;</span>
</code></pre>
<pre><code class="hljs language-Kotlin" lang="Kotlin">implementation(<span class="hljs-string">"io.github.compose-jindong:jindong:1.0.0"</span>)
</code></pre>
<p>然后，开始 DSL 形式的震动：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">var</span> count <span class="hljs-keyword">by</span> remember { mutableIntStateOf(<span class="hljs-number">0</span>) }

JindongProvider { <span class="hljs-comment">// 需要提供一个 JindongProvider</span>
    <span class="hljs-keyword">if</span> (count &gt; <span class="hljs-number">0</span>) { <span class="hljs-comment">// 防止第一次进来就震动</span>
        Jindong(count) { <span class="hljs-comment">// 传入一个 key，当 key 发生变化的时候，就会震动</span>
            Sequence {
                repeat(<span class="hljs-number">3</span>) { <span class="hljs-comment">// 重复三次震动</span>
                    Haptic(<span class="hljs-number">50.</span>ms, HapticIntensity.STRONG)
                    Delay(<span class="hljs-number">100.</span>ms)
                }
            }
        }
    }

}

Column(
    modifier = Modifier.fillMaxSize(),
) {
    Button(onClick = {
        count++
    }) {
        Text(<span class="hljs-string">"Vibrate"</span>)
    }
}
</code></pre>
<p>在这里，开发者只需定义触觉模式（一个重复三次的序列），而库会负责处理平台相关的执行细节。</p>
<p>这种差异不仅仅是语法上的不同——关键在于<strong>谁来控制执行过程</strong>。</p>
<p>这也正是旧式的 View 写法和新式的 Compose 写法的核心差别：</p>

















<table><thead><tr><th>命令式思维</th><th>声明式思维</th></tr></thead><tbody><tr><td>“先振动 50ms，然后等待 100ms，再振动 50ms”</td><td>“我想要一个 50ms-100ms-50ms 的震动模式”</td></tr><tr><td>“循环三次，中间有延迟，启动震动”</td><td>“我想要三次重复”</td></tr></tbody></table>
<p>声明式编程关注于定义目标的逻辑和关系，而不指定如何实现它们。</p>
<p><strong>“描述要做什么，而不是怎么做。”</strong></p>
<h2 data-id="heading-3">生命周期管理</h2>
<p>在命令式触觉反馈中，生命周期管理是最大的痛点之一。如果用户在长时间振动模式播放过程中导航离开当前页面，会发生什么？</p>
<p>在命令式编程的世界里，你必须手动在 <code>onPause</code> 或 <code>onDispose</code> 中调用 <code>vibrator.cancel()</code>。</p>
<p>而使用 <strong>Jindong</strong> 时，触觉模式会自动绑定到 Compose 的生命周期：</p>
<ul>
<li><strong>自动取消</strong>：当 Composable 离开组合时，触觉引擎会立即停止。</li>
<li><strong>响应式更新</strong>：就像 <code>LaunchedEffect</code> 一样，如果在模式播放过程中 <code>keys</code> 发生变化，<strong>Jindong</strong> 会自动取消当前模式，并根据新状态重新开始执行。</li>
</ul>
<pre><code class="hljs language-Kotlin" lang="Kotlin"><span class="hljs-comment">/**
 * 当 keys 发生变化时，触发触觉模式执行的可组合函数。
 */</span>
<span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">jindong</span><span class="hljs-params">(
    <span class="hljs-keyword">vararg</span> keys: <span class="hljs-type">Any</span>?,
    content: @<span class="hljs-type">Composable</span> <span class="hljs-type">JindongScope</span>.() -&gt; <span class="hljs-type">Unit</span>,
)</span></span> {
    <span class="hljs-keyword">val</span> pattern = rememberHapticPattern(content)
    <span class="hljs-keyword">val</span> executor = LocalHapticExecutor.current
    LaunchedEffect(*keys) {
        executor.execute(pattern)
    }
}
</code></pre>
<p>这正是 Compose 的一大优势，无需特别关心生命周期。</p>
<p>当你离开组合时，当前的副作用自动结束！</p>
<h2 data-id="heading-4">搞点例子</h2>
<p>以下是一些 <strong>Jindong</strong> 的实用场景。</p>
<p><em>下面的例子因为篇幅我没有显示的指定 <code>JindongProvider</code>，实际上所有的 <code>Jindong</code> 都需要在 <code>JindongProvider</code> 内部。</em></p>
<h3 data-id="heading-5">屏幕进入反馈</h3>
<p>使用 <code>Unit</code> 作为触发键，可在进入屏幕时立即触发热反馈：</p>
<pre><code class="hljs language-Kotlin" lang="Kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">WelcomeScreen</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// 页面出现时执行一次</span>
    Jindong(<span class="hljs-built_in">Unit</span>) {
        Haptic(<span class="hljs-number">100.</span>ms, HapticIntensity.MEDIUM)
    }
}
</code></pre>
<h3 data-id="heading-6">按钮点击反馈</h3>
<pre><code class="hljs language-Kotlin" lang="Kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">TapButton</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">var</span> taps <span class="hljs-keyword">by</span> remember { mutableIntStateOf(<span class="hljs-number">0</span>) }
    <span class="hljs-keyword">if</span> (taps &gt; <span class="hljs-number">0</span>) {
        Jindong(taps) {
            Haptic(<span class="hljs-number">100.</span>ms, HapticIntensity.LIGHT)
        }
    }
    Button(onClick = { taps++ }) {
        Text(<span class="hljs-string">"Tap"</span>)
    }
}
</code></pre>
<h3 data-id="heading-7">淡出效果</h3>
<pre><code class="hljs language-Kotlin" lang="Kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">FadeOutHaptic</span><span class="hljs-params">(trigger: <span class="hljs-type">Int</span>)</span></span> {
    Jindong(trigger) {
        RepeatWithIndex(<span class="hljs-number">5</span>) { index -&gt;
            <span class="hljs-keyword">val</span> intensity = HapticIntensity.Custom(<span class="hljs-number">1.0f</span> - (index * <span class="hljs-number">0.2f</span>))
            Haptic(<span class="hljs-number">50.</span>ms, intensity)
            Delay(<span class="hljs-number">100.</span>ms)
        }
    }
}
</code></pre>
<h3 data-id="heading-8">模拟心跳</h3>
<pre><code class="hljs language-Kotlin" lang="Kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">HeartbeatHaptic</span><span class="hljs-params">(trigger: <span class="hljs-type">Int</span>)</span></span> {
    Jindong(trigger) {
        Repeat(<span class="hljs-number">5</span>) {

            <span class="hljs-comment">// Lub（强脉冲）</span>
            Haptic(<span class="hljs-number">60.</span>ms, HapticIntensity.STRONG)
            Delay(<span class="hljs-number">80.</span>ms)

            <span class="hljs-comment">// Dub（弱脉冲）</span>
            Haptic(<span class="hljs-number">40.</span>ms, HapticIntensity.MEDIUM)
            Delay(<span class="hljs-number">400.</span>ms)
            
        }
    }
}
</code></pre>
<p><strong>强烈建议各位试一下，这个特别像！</strong></p>
<h2 data-id="heading-9">内部原理：Compose Runtime 与 CMP</h2>
<h3 data-id="heading-10">Compose Runtime 的作用是什么？</h3>
<p>Compose Runtime 是一个与 UI 渲染无关的树管理引擎。<strong>Jindong</strong> 依赖于 Compose 运行时的两个核心组件：</p>
<ul>
<li><strong>ComposeNode</strong>：这是一个通用函数，用于将节点插入到树中。在 <strong>Jindong</strong> 中，每个 DSL 函数（如 <code>Haptic</code>、<code>Delay</code> 和 <code>Sequence</code>）都会在内部调用 <code>ComposeNode</code>，以创建特定的 <code>HapticNode</code> 实现。</li>
<li><strong>Applier</strong>：运行时需要知道如何将这些节点连接起来。<code>Applier</code> 负责处理 <code>HapticNode</code> 树的结构更新，该树将在播放前被遍历，以收集 <code>ScheduledHapticEvent</code> 事件。</li>
</ul>
<p>就像 Compose UI 通过构建 <code>LayoutNode</code> 树来渲染像素一样，<strong>Jindong</strong> 通过构建 <code>HapticNode</code> 树来合成振动效果。这使我们能够使用标准的 Compose 特性（如 <code>SideEffect</code>、<code>remember</code>），结合 Kotlin 的标准控制流（如 <code>if/when/for</code>），自然地构建动态的触觉体验。</p>
<h3 data-id="heading-11">Compose Multiplatform 实现</h3>
<p><strong>Jindong</strong> 遵循标准的 CMP（Compose Multiplatform）架构：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/48925c6b609a4ab298002ef02ee73ccc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUm9ja0J5dGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769994004&amp;x-signature=GzjNWUeHecWN0ns1mQ0Q6DSF8Zg%3D" alt="cmp.png" loading="lazy"/></p>
<ol>
<li><strong>通用层（Common Layer）</strong> ：包含 Compose DSL 定义、节点（Nodes）以及 <code>HapticPattern</code> 数据模型。所有时间计算和模式编译都在此层完成，确保跨平台行为的一致性。</li>
<li><strong>平台层（Platform Layer，即执行器 Executor）</strong> ：
<ul>
<li><strong>Android</strong>：将 <code>HapticPattern</code> 转换为 <code>VibrationEffect</code>（使用 <code>VibrationEffect.createWaveform</code>）。</li>
<li><strong>iOS</strong>：将 <code>HapticPattern</code> 转换为 <code>CHHapticPattern</code>，用于 Core Haptics。</li>
</ul>
</li>
</ol>
<p>Android 和 iOS 对振动强度的处理方式不同。</p>
<p>Android 使用振幅整数（1–255），而 iOS 的 Core Haptics 使用归一化的浮点值（0.0–1.0）。</p>
<p><strong>Jindong</strong> 提供了一个统一的抽象层，使开发者可以使用归一化的百分比（例如，<code>intensity = 0.5f</code>）来定义强度，无需关心平台特定的数学转换。</p>
<h2 data-id="heading-12">总结</h2>
<p><strong>Jindong</strong> 旨在解决在 Compose Multiplatform 应用中实现触觉反馈的复杂性。通过利用 Compose 运行时，开发者可以将触觉模式定义为<strong>结构化描述</strong>，而非一系列电机命令序列。</p>
<p>各位还在等什么，赶紧用起来试试呀！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[FileCodeBox：轻量级文件快递柜，让文件分享像取快递一样简单]]></title>    <link>https://juejin.cn/post/7598710324167868431</link>    <guid>https://juejin.cn/post/7598710324167868431</guid>    <pubDate>2026-01-26T01:02:32.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598710324167868431" data-draft-id="7538085027172237327" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="FileCodeBox：轻量级文件快递柜，让文件分享像取快递一样简单"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-26T01:02:32.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="YL_jia"/> <meta itemprop="url" content="https://juejin.cn/user/1467226241383211"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            FileCodeBox：轻量级文件快递柜，让文件分享像取快递一样简单
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1467226241383211/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    YL_jia
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-26T01:02:32.000Z" title="Mon Jan 26 2026 01:02:32 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">FileCodeBox：轻量级文件快递柜，让文件分享像取快递一样简单</h2>
<blockquote>
<p><strong>“在隐私焦虑的时代，FileCodeBox用匿名口令架起了安全与便捷的桥梁”</strong>——一位从传统网盘迁移的DevOps工程师如此评价</p>
</blockquote>
<p>当我们还在为微信文件过期、网盘限速、FTP配置复杂而烦恼时，一款基于<strong>FastAPI+Vue3</strong>开发的轻量级工具——FileCodeBox正以“文件快递柜”的理念重塑文件共享体验。它允许用户通过匿名口令分享文件，接收方凭取件码获取内容，<strong>无需注册、无需登录、即开即用</strong>。本文将深入解析这一5.8k Star开源项目的技术架构与实战应用。</p>
<hr/>
<h3 data-id="heading-1">一、核心价值：为什么FileCodeBox成为开发者的新宠？</h3>
<h4 data-id="heading-2">1. 极简架构背后的工程哲学</h4>
<p>FileCodeBox采用<strong>前后端分离架构</strong>：</p>
<ul>
<li><strong>后端</strong>：FastAPI + SQLite3（高性能异步框架，单文件数据库）</li>
<li><strong>前端</strong>：Vue3 + ElementUI（响应式界面，暗黑模式支持）</li>
<li><strong>资源占用</strong>：Docker镜像仅85MB，内存消耗&lt;100MB</li>
</ul>
<p>这种设计使得它在树莓派等边缘设备上也能流畅运行，彻底告别传统网盘的资源黑洞。</p>
<h4 data-id="heading-3">2. 六大杀手级特性</h4>
<ul>
<li><strong>无感上传体验</strong><br/>
支持拖拽文件、粘贴文本、Ctrl+V粘贴截图，上传过程如同聊天发图般自然</li>
<li><strong>军工级安全防护</strong>
<pre><code class="hljs language-mermaid" lang="mermaid">graph LR
  A[暴力破解] --&gt;|错误超5次| B(IP冻结10分钟)
  C[恶意上传] --&gt;|IP限流60次/分钟| D(请求拒绝)
</code></pre>
</li>
<li><strong>精准有效期控制</strong><br/>
可按次数（如允许提取5次）或时间（如24小时后过期）设置自毁规则</li>
<li><strong>多云存储支持</strong><br/>
通过插件化存储引擎，无缝切换本地存储与阿里云OSS/S3协议</li>
<li><strong>终端友好</strong><br/>
<code>wget https://your-domain/?code=提取码</code> 直接下载</li>
<li><strong>零成本管理</strong><br/>
管理员通过统一面板查看所有文件，一键清理敏感内容</li>
</ul>
<hr/>
<h3 data-id="heading-4">二、安装部署：5分钟构建企业级文件共享中心</h3>
<h4 data-id="heading-5">1. 单机Docker部署（推荐方案）</h4>
<p><strong>适用场景</strong>：个人/小团队快速搭建</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 创建持久化目录</span>
<span class="hljs-built_in">mkdir</span> -p /opt/FileCodeBox &amp;&amp; <span class="hljs-built_in">cd</span> /opt/FileCodeBox

<span class="hljs-comment"># 一键启动容器</span>
docker run -d --restart=always \
  -p 12345:12345 \
  -v $(<span class="hljs-built_in">pwd</span>):/app/data \  <span class="hljs-comment"># 持久化配置及文件</span>
  --name filecodebox \
  lanol/filecodebox:beta
</code></pre>
<p>访问 <code>http://服务器IP:12345</code> 进入前台，<code>http://服务器IP:12345/#/admin</code> 进入管理后台（初始密码：<code>FileCodeBox2023</code>）</p>
<h4 data-id="heading-6">2. 企业高可用方案</h4>
<p><strong>架构拓扑</strong>：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB
    Nginx --&gt; FileCodeBox1
    Nginx --&gt; FileCodeBox2
    FileCodeBox1 --&gt; OSS[阿里云OSS]
    FileCodeBox2 --&gt; OSS
</code></pre>
<p><strong>关键配置</strong>（docker-compose.yml）：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">services:</span>
  <span class="hljs-attr">filecodebox:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">lanol/filecodebox:beta</span>
    <span class="hljs-attr">environment:</span>
      <span class="hljs-attr">STORAGE_ENGINE:</span> <span class="hljs-string">oss</span>  <span class="hljs-comment"># 启用OSS存储</span>
      <span class="hljs-attr">KeyId:</span> <span class="hljs-string">AK***************</span>  <span class="hljs-comment"># OSS访问密钥</span>
      <span class="hljs-attr">KeySecret:</span> <span class="hljs-string">SK******************</span>
      <span class="hljs-attr">OSS_ENDPOINT:</span> <span class="hljs-string">oss-cn-hangzhou.aliyuncs.com</span>
      <span class="hljs-attr">BUCKET_NAME:</span> <span class="hljs-string">your-bucket</span>
    <span class="hljs-attr">volumes:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">./config:/app/data</span>  <span class="hljs-comment"># 保留配置文件</span>
</code></pre>
<h4 data-id="heading-7">3. 安全加固实践</h4>
<p><strong>场景</strong>：企业合规要求审计日志<br/>
<strong>方案</strong>：启用数据库追踪</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 修改挂载目录中的.env</span>
AUDIT_LOG_ENABLED=True
AUDIT_LOG_PATH=/app/data/audit.log
</code></pre>
<p><strong>效果</strong>：所有文件操作（上传/下载/删除）记录IP、时间、操作类型，满足等保2.0要求</p>
<hr/>
<h3 data-id="heading-8">三、企业实战案例：从临时分享到生产级应用</h3>
<h4 data-id="heading-9">案例1：金融公司合规文件传输</h4>
<p><strong>挑战</strong>：某支付机构需向监管机构报送交易数据，但禁止使用微信/邮箱发送敏感文件。</p>
<p><strong>FileCodeBox解决方案</strong>：</p>
<ol>
<li><strong>安全策略配置</strong>：
<pre><code class="hljs language-env" lang="env"># .env 安全强化配置
FILE_SIZE_LIMIT=50  # 文件上限50MB
UPLOAD_COUNT=3      # 每个IP每天限传3次
ERROR_COUNT=3       # 密码错误3次冻结IP
</code></pre>
</li>
<li><strong>操作流程</strong>：
<ul>
<li>业务员上传加密压缩包，设置<strong>1次提取权限+2小时有效期</strong></li>
<li>系统生成取件码，通过安全信道发送至监管方</li>
<li>监管方下载后文件自动销毁
<strong>成效</strong>：数据泄露风险降低90%，审计通过率100%</li>
</ul>
</li>
</ol>
<h4 data-id="heading-10">案例2：制造业分布式固件分发</h4>
<p><strong>挑战</strong>：某汽车零件厂需向全球8个工厂下发设备固件，FTP服务器跨国传输慢。</p>
<p><strong>技术方案</strong>：</p>
<ol>
<li>中心节点部署FileCodeBox + 阿里云OSS加速</li>
<li>各工厂通过内网缓存节点同步：
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 工厂节点定期同步脚本</span>
wget -O firmware.bin <span class="hljs-string">"https://center.com/?code=FX29K"</span>
<span class="hljs-built_in">md5sum</span> firmware.bin | grep -q <span class="hljs-string">"a1b2c3d4"</span> &amp;&amp; flash_firmware
</code></pre>
</li>
</ol>
<hr/>
<h3 data-id="heading-11">四、高阶技巧：解锁90%用户未知的用法</h3>
<h4 data-id="heading-12">1. CLI自动化运维</h4>
<p>通过API实现无人值守操作：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># Python自动上传巡检报告</span>
<span class="hljs-keyword">import</span> requests

url = <span class="hljs-string">"http://filecodebox.domain/upload"</span>
files = {<span class="hljs-string">'file'</span>: <span class="hljs-built_in">open</span>(<span class="hljs-string">'daily_check.log'</span>, <span class="hljs-string">'rb'</span>)}
data = {<span class="hljs-string">'expire_type'</span>: <span class="hljs-string">'time'</span>, <span class="hljs-string">'expire_value'</span>: <span class="hljs-number">24</span>}  <span class="hljs-comment"># 24小时过期</span>
headers = {<span class="hljs-string">'X-Management-Key'</span>: <span class="hljs-string">'企业密钥'</span>}  <span class="hljs-comment"># 后台配置密钥</span>

r = requests.post(url, files=files, data=data, headers=headers)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"取件码：<span class="hljs-subst">{r.json()[<span class="hljs-string">'code'</span>]}</span>"</span>)
</code></pre>
<h4 data-id="heading-13">2. 跨系统集成方案</h4>
<p><strong>场景</strong>：与钉钉机器人联动<br/>
<strong>步骤</strong>：</p>
<ol>
<li>配置钉钉机器人Webhook</li>
<li>文件上传后触发通知：
<pre><code class="hljs language-json" lang="json"><span class="hljs-comment">// 钉钉消息模板</span>
<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"msgtype"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"markdown"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"markdown"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"新文件待取"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"text"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"文件：${filename}\n有效期：${expire}\n取件码：`${code}`"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
</li>
</ol>
<h4 data-id="heading-14">3. 存储优化实战</h4>
<p><strong>问题</strong>：本地磁盘空间不足<br/>
<strong>解决方案</strong>：挂载NFS或启用OSS</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># docker-compose.yml 片段</span>
<span class="hljs-attr">volumes:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">/nfs/filecodebox:/app/data</span>  <span class="hljs-comment"># NFS挂载</span>
<span class="hljs-attr">environment:</span>
  <span class="hljs-attr">STORAGE_ENGINE:</span> <span class="hljs-string">oss</span>  <span class="hljs-comment"># 或使用S3协议</span>
</code></pre>
<hr/>
<h3 data-id="heading-15">五、与传统工具的对比</h3>















































<table><thead><tr><th><strong>能力维度</strong></th><th><strong>FileCodeBox</strong></th><th><strong>WeTransfer</strong></th><th><strong>自建FTP</strong></th></tr></thead><tbody><tr><td>部署复杂度</td><td>⭐（Docker一键启动）</td><td>⭐⭐⭐⭐（需公有云）</td><td>⭐⭐⭐（配置复杂）</td></tr><tr><td>隐私保护</td><td>✅ 匿名分享+无用户数据</td><td>❌ 需手机号/邮箱</td><td>⚠️ 依赖账号体系</td></tr><tr><td>传输加密</td><td>TLS 1.3端到端加密</td><td>✅</td><td>❌ 明文传输</td></tr><tr><td>成本</td><td>0（开源）</td><td>付费版$12/月起</td><td>服务器费用</td></tr><tr><td>定制开发</td><td>✅ 完整API+开源代码</td><td>❌</td><td>⚠️ 有限</td></tr><tr><td>企业级扩展</td><td>✅ OSS/S3/高可用</td><td>✅</td><td>❌</td></tr></tbody></table>
<blockquote>
<p><strong>结论</strong>：FileCodeBox在<strong>隐私安全</strong>和<strong>可控性</strong>上完胜，尤其适合对数据主权要求高的场景</p>
</blockquote>
<hr/>
<h3 data-id="heading-16">六、未来演进：2025年路线图解析</h3>
<p>根据核心开发者访谈，FileCodeBox将聚焦三大方向：</p>
<ol>
<li><strong>区块链存证</strong>：文件哈希上链，实现不可篡改的传输审计</li>
<li><strong>边缘计算支持</strong>：集成Web3.storage，实现IPFS分布式存储</li>
<li><strong>AI安全增强</strong>：
<pre><code class="hljs language-mermaid" lang="mermaid">graph LR
  上传文件 --&gt; AI扫描
  AI扫描 --&gt;|敏感内容| 自动加密
  AI扫描 --&gt;|恶意软件| 拦截删除
</code></pre>
</li>
</ol>
<hr/>
<h3 data-id="heading-17">结语：工具的本质是回归用户价值</h3>
<p>FileCodeBox的成功不在于技术颠覆，而在于<strong>精准抓住了“临时文件分享”这一高频痛点</strong>。当开发者不再为10MB的小文件搭建FTP，当业务人员能安全传递客户数据，效率提升便水到渠成。</p>
<blockquote>
<p><strong>实践箴言</strong>：</p>
<ol>
<li><strong>轻量起步</strong>：从团队内部临时分享切入，逐步替代微信文件传输</li>
<li><strong>安全左移</strong>：初始部署即配置IP限流与错误封锁</li>
<li><strong>文化适配</strong>：通过取件码机制培养用户“用完即焚”的安全意识</li>
</ol>
</blockquote>
<p>正如某科技公司CTO所言：<em>“自从用了FileCodeBox，公司钉钉群里的‘文件已过期’投诉减少了87%”</em>。</p>
<p><strong>项目地址</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fvastsa%2FFileCodeBox" target="_blank" title="https://github.com/vastsa/FileCodeBox" ref="nofollow noopener noreferrer">github.com/vastsa/File…</a><br/>
<strong>中文文档</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Ffilecodebox.cn%2Fdocs" target="_blank" title="https://filecodebox.cn/docs" ref="nofollow noopener noreferrer">filecodebox.cn/docs</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Laravel12 + Vue3 的免费可商用 PHP 管理后台 CatchAdmin V5.1.1 发布]]></title>    <link>https://juejin.cn/post/7598921649888935963</link>    <guid>https://juejin.cn/post/7598921649888935963</guid>    <pubDate>2026-01-25T23:47:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598921649888935963" data-draft-id="7599094262592012298" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Laravel12 + Vue3 的免费可商用 PHP 管理后台 CatchAdmin V5.1.1 发布"/> <meta itemprop="keywords" content="后端,PHP,Laravel"/> <meta itemprop="datePublished" content="2026-01-25T23:47:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="BingoGo"/> <meta itemprop="url" content="https://juejin.cn/user/993614242266077"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Laravel12 + Vue3 的免费可商用 PHP 管理后台 CatchAdmin V5.1.1 发布
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/993614242266077/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    BingoGo
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-25T23:47:56.000Z" title="Sun Jan 25 2026 23:47:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Laravel12 + Vue3 的免费可商用 PHP 管理后台 CatchAdmin V5.1.1 发布</h2>
<h3 data-id="heading-1">介绍</h3>
<p><code>CatchAdmin</code> 是一款基于 <a href="https://link.juejin.cn?target=https%3A%2F%2Flaravel.com" target="_blank" title="https://laravel.com" ref="nofollow noopener noreferrer">Laravel 12.x</a> 与 <a href="https://link.juejin.cn?target=https%3A%2F%2Fvuejs.org%2F" target="_blank" title="https://vuejs.org/" ref="nofollow noopener noreferrer">Vue3</a> 二次开发的 PHP 开源后台管理系统，采用前后端分离架构，面向企业级后台场景提供开箱即用的基础能力与可扩展的模块化框架。系统内置 Token 鉴权、权限管理（菜单/按钮/数据权限）、动态路由、动态表格、分页封装、资源权限控制、上传/下载、代码生成器（支持一键导入/导出）、数据回收站、附件管理等功能，覆盖后台系统从安全、权限到效率开发的常见需求。</p>
<p>在架构设计上，<code>Laravel</code> 仅作为 <code>API</code> 服务层对外输出，尽可能弱化业务模块之间的耦合关系。每个模块均具备独立的控制器、路由、模型与数据表结构，支持按模块拆分、按需加载与独立演进，从而降低开发复杂度，提高可维护性与迭代效率。同时，项目封装了大量通用能力与开发工具（如统一响应、异常处理、分页与资源封装等），让业务开发更聚焦、更高效。</p>
<p>基于 <code>CatchAdmin</code>，你可以快速搭建 <code>CMS</code>、<code>CRM</code>、<code>OA</code> 等各类管理系统，并在稳定的基础设施之上持续扩展业务模块，满足不同规模团队的开发与交付需求。</p>
<h3 data-id="heading-2">V5.1.1 版本亮点</h3>
<ul>
<li>优化获取模块名，修复前端页面加载失败</li>
<li>优化表单生成数据响应式</li>
<li>后台登录界面添加异常展示</li>
<li>优化表格刷新和重置</li>
<li>优化 catchtable 组件</li>
<li>优化后台系统设置</li>
<li>优化表格搜索组件
等等更多...</li>
</ul>
<h3 data-id="heading-3">快速开始</h3>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">创建项目</span>
composer create  catchadmin/catchadmin
<span class="hljs-meta prompt_">
# </span><span class="bash">安装项目</span>
cd catchadmin &amp;&amp; php artisan catch:install
<span class="hljs-meta prompt_">
# </span><span class="bash">启动项目</span>
composer run dev
</code></pre>
<h3 data-id="heading-4">功能清单</h3>
<ul>
<li>☑️ <strong>用户管理</strong>：用户添加、修改、删除，支持不同用户登录后台看到不同首页</li>
<li>☑️ <strong>部门管理</strong>：部门组织机构（公司、部门、小组），树结构展现</li>
<li>☑️ <strong>岗位管理</strong>：给用户配置所担任职务</li>
<li>☑️ <strong>角色管理</strong>：树结构设计，支持角色菜单和按钮权限分配、角色数据权限分配</li>
<li>☑️ <strong>菜单管理</strong>：配置系统菜单和按钮</li>
<li>☑️ <strong>字典管理</strong>：对系统中经常使用的固定数据进行维护和复用</li>
<li>☑️ <strong>系统配置</strong>：系统常用设置管理</li>
<li>☑️ <strong>操作日志</strong>：用户正常操作的查询</li>
<li>☑️ <strong>登录日志</strong>：用户登录记录查询</li>
<li>☑️ <strong>文件上传</strong>：支持本地、七牛云、阿里云、腾讯云</li>
<li>☑️ <strong>附件管理</strong>：管理系统上传的文件及图片</li>
<li>☑️ <strong>数据表维护</strong>：数据表碎片清理和优化，管理数据回收和销毁</li>
<li>☑️ <strong>代码生成</strong>：前后端代码生成（PHP、Vue、数据库迁移），支持一键生成到模块</li>
<li>☑️ <strong>Vue 即时渲染</strong>：前端 Vue 即时渲染，无需编译</li>
<li>☑️ <strong>插件系统</strong>：CatchAdmin 插件即 Composer 包，完全绑定 Composer 生态</li>
</ul>
<h3 data-id="heading-5">在线体验</h3>
<p>演示地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fv5.catchadmin.com" target="_blank" title="https://v5.catchadmin.com" ref="nofollow noopener noreferrer">v5.catchadmin.com</a></p>
<p><strong>超管账户</strong></p>
<ul>
<li>账户：<code>catch@admin.com</code></li>
<li>密码：<code>catchadmin</code></li>
</ul>
<p><strong>测试账户</strong></p>
<ul>
<li>账户：<code>test@admin.com</code></li>
<li>密码：<code>Testadmin1</code></li>
</ul>
<h3 data-id="heading-6">项目地址</h3>
<ul>
<li>GitHub：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FJaguarJack%2Fcatch-admin" target="_blank" title="https://github.com/JaguarJack/catch-admin" ref="nofollow noopener noreferrer">github.com/JaguarJack/…</a></li>
<li>Gitee：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fcatchadmin%2Fcatchadmin" target="_blank" title="https://gitee.com/catchadmin/catchadmin" ref="nofollow noopener noreferrer">gitee.com/catchadmin/…</a></li>
</ul>
<h3 data-id="heading-7">项目预览</h3>

























<table><thead><tr><th/><th/></tr></thead><tbody><tr><td><img src="https://image.catchadmin.com/202512151142046.png" alt="登录" loading="lazy"/></td><td><img src="https://image.catchadmin.com/202512150841525.png" alt="控制台" loading="lazy"/></td></tr><tr><td><img src="https://image.catchadmin.com/202512151143109.png" alt="权限" loading="lazy"/></td><td><img src="https://image.catchadmin.com/202512151144233.png" alt="布局" loading="lazy"/></td></tr><tr><td><img src="https://image.catchadmin.com/202601101535082.png" alt="上传" loading="lazy"/></td><td><img src="https://image.catchadmin.com/202601101536072.png" alt="代码生成" loading="lazy"/></td></tr><tr><td><img src="https://image.catchadmin.com/202601101537583.png" alt="菜单" loading="lazy"/></td><td><img src="https://image.catchadmin.com/202601101538807.png" alt="模板" loading="lazy"/></td></tr></tbody></table>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fcatchadmin.com%2Fpost%2F2026-01%2Fcatchadmin-v511-update" target="_blank" title="https://catchadmin.com/post/2026-01/catchadmin-v511-update" ref="nofollow noopener noreferrer">原文 Laravel12 + Vue3 的免费可商用 PHP 管理后台 CatchAdmin V5.1.1 发布
</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[供应链系统中的 Web 打印方案的探索实践]]></title>    <link>https://juejin.cn/post/7598921649888968731</link>    <guid>https://juejin.cn/post/7598921649888968731</guid>    <pubDate>2026-01-26T00:00:01.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598921649888968731" data-draft-id="7599268297202253862" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="供应链系统中的 Web 打印方案的探索实践"/> <meta itemprop="keywords" content="React.js"/> <meta itemprop="datePublished" content="2026-01-26T00:00:01.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="古茗前端团队"/> <meta itemprop="url" content="https://juejin.cn/user/3233040624266695"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            供应链系统中的 Web 打印方案的探索实践
            <!----> <!----></h1> <div class="container team-follow" data-v-d326b38e="" data-v-61fb5e44=""><div class="left" data-v-d326b38e=""><a href="/team/7198439419173404711/posts" data-v-d326b38e=""><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/dafcebf7c91d402abd52f072a32deba8~tplv-k3u1fbpfcp-watermark.image?" class="icon" data-v-d326b38e=""/></a> <div class="content" data-v-d326b38e=""><div style="display: flex" data-v-d326b38e=""><a href="/team/7198439419173404711/posts" data-v-d326b38e=""><p class="title-line" data-v-d326b38e=""><span title="古茗前端团队" class="title" data-v-d326b38e="">古茗前端团队</span> <img src="//lf-web-assets.juejin.cn/obj/juejin-web/xitu_juejin_web/255e400027b783cbad76dc41527e7695.svg" alt="team icon" class="team-icon" data-v-d326b38e=""/></p></a></div> <div class="meta-box team" data-v-d326b38e="" data-v-61fb5e44=""><time datetime="2026-01-26T00:00:01.000Z" title="Mon Jan 26 2026 00:00:01 GMT+0000 (Coordinated Universal Time)" class="time" data-v-d326b38e="" data-v-61fb5e44="">
                2026-01-26
              </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-d326b38e="" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-d326b38e="" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-d326b38e="" data-v-61fb5e44=""/></svg> <span class="views-count" style="display:none;" data-v-d326b38e="" data-v-61fb5e44="">
                0
              </span> <span class="read-time" data-v-d326b38e="" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-d326b38e="" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-d326b38e="" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-d326b38e="" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-d326b38e="" data-v-61fb5e44=""/></svg>
                阅读1分钟
              </span> <!----> <!----></div></div></div> <button class="jj-follow-button follow-btn" style="display:none;" data-v-b60b2868="" data-v-d326b38e=""><span data-v-b60b2868="" data-v-d326b38e=""><i class="byte-icon byte-icon--plus" data-v-d326b38e=""><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 48 48"><path fill="none" d="M0 0h48v48H0z"/><path d="M24.7 4c.4 0 .6 0 .8.1.2.1.3.2.4.4.1.2.1.3.1.8V22h16.7c.4 0 .6 0 .8.1.2.1.3.2.4.4.1.2.1.3.1.8v1.4c0 .4 0 .6-.1.8-.1.2-.2.3-.4.4-.2.1-.3.1-.8.1H26v16.7c0 .4 0 .6-.1.8-.1.2-.2.3-.4.4-.2.1-.3.1-.8.1h-1.4c-.4 0-.6 0-.8-.1-.2-.1-.3-.2-.4-.4-.1-.2-.1-.3-.1-.8V26H5.3c-.4 0-.6 0-.8-.1-.2-.1-.3-.2-.4-.4-.1-.2-.1-.3-.1-.8v-1.4c0-.4 0-.6.1-.8.1-.2.2-.3.4-.4.2-.1.3-.1.8-.1H22V5.3c0-.4 0-.6.1-.8.1-.2.2-.3.4-.4.2-.1.3-.1.8-.1h1.4z"/></svg></i>
        关注
      </span></button></div> <div class="team-user block-hidden" data-v-61fb5e44=""><div class="avatar jj-avatar avatar" data-v-03256cc6="" data-v-61fb5e44=""><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8AQMAAAAAMksxAAAAA1BMVEUAAACnej3aAAAAAXRSTlMAQObYZgAAAA5JREFUKM9jGAWjAAcAAAIcAAE27nY6AAAAAElFTkSuQmCC" alt="avatar" class="lazy avatar-img" data-v-5244ef91="" data-v-03256cc6=""/> </div> <!----> <span class="position ellipsis" data-v-61fb5e44="">
              @古茗科技
            </span></div> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>作者：刘锦泉</p>
</blockquote>
<h2 data-id="heading-0">一、前言</h2>
<p>在供应链业务系统中，打印是一项<strong>难以被完全数字化替代的基础能力</strong>。尽管系统形态不断向 Web 化、平台化演进，但在仓储、物流、配送等线下环节，大量核心流程依然依赖纸质单据（如面单、送货单、运输单）完成流转与交接。</p>
<p>打印的稳定性与一致性，往往直接影响现场作业效率。一旦打印出现异常，问题会迅速放大，甚至直接阻断线下业务流程。</p>
<p>基于真实的供应链项目实践，本文将围绕浏览器打印这一常被低估的能力，系统性地梳理主流方案的技术取舍，并重点展开基于 <code>window.print</code> 的实现思路与工程实践。</p>
<h2 data-id="heading-1">二、供应链系统中的主流打印方案调研</h2>
<p>围绕“如何将单据稳定、可靠地打印出来”，在实际项目中常见的 Web 打印方案大致可以分为三类：</p>
<ul>
<li>基于 DOM 的浏览器原生打印方案</li>
<li>基于可视化模板的前端打印方案</li>
<li>基于本地打印控件的软件方案</li>
</ul>
<p>下面结合实际项目经验，对这三类方案进行简要分析。</p>
<h3 data-id="heading-2">1.基于DOM浏览器原生打印方案</h3>
<p>这是目前<strong>最常见、也是前端介入成本最低</strong>的一种打印实现方式。</p>
<p>其核心思路是：</p>
<blockquote>
<p>直接使用浏览器原生打印能力，将页面或指定 DOM 节点渲染为打印内容。</p>
</blockquote>
<p>打印效果如下图：</p>

<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/17442b196ee74d45bc966aa555135ff0~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp" alt="" loading="lazy"/></p>
<h4 data-id="heading-3">实现方式</h4>
<ol>
<li><strong>原生</strong> <strong>window.print()</strong></li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// window.print</span>
<span class="hljs-variable language_">window</span>.<span class="hljs-property">print</span>
</code></pre>
<ol start="2">
<li><strong>使用 <strong><strong>print-js</strong></strong> 等开源库进行增强</strong></li>
</ol>
<p>官网地址：传送门(<a href="https://link.juejin.cn?target=https%3A%2F%2Fprintjs.crabbly.com%2F" target="_blank" title="https://printjs.crabbly.com/" ref="nofollow noopener noreferrer">printjs.crabbly.com/</a>)</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// printJs</span>
<span class="hljs-title function_">printJS</span>({
  <span class="hljs-attr">printable</span>: <span class="hljs-string">'print-area'</span>,
  <span class="hljs-attr">type</span>: <span class="hljs-string">'html'</span>,
  <span class="hljs-attr">style</span>: <span class="hljs-string">'@page { size: A4; margin: 10mm; }'</span>,
  <span class="hljs-attr">targetStyles</span>: [<span class="hljs-string">'*'</span>]
});
</code></pre>
<h4 data-id="heading-4">优点</h4>
<ul>
<li><strong>零额外依赖</strong>，完全基于浏览器原生能力</li>
<li><strong>浏览器兼容性优秀</strong>：Chrome、Firefox、Safari、Edge 均支持</li>
<li><strong>开发与维护成本低</strong>，对现代前端技术栈（React / Vue）非常友好</li>
<li><strong>页面即模板</strong>，业务变更成本低，适合供应链中高频调整的单据场景</li>
</ul>
<h4 data-id="heading-5">缺点</h4>
<ul>
<li><strong>样式控制高度依赖 CSS</strong>，对分页、跨页控制要求较高</li>
<li><strong>批量打印需自行实现调度与队列逻辑</strong></li>
<li><strong>打印体验受浏览器限制</strong>：
<ul>
<li>页眉页脚难以完全控制</li>
<li>无法绕开系统打印弹窗</li>
</ul>
</li>
</ul>
<h3 data-id="heading-6">2.基于可视化模板的前端打印方案（HiPrint）</h3>
<p>以 HiPrint 为代表的方案，通常基于 jQuery，通过拖拽方式设计打印模板，再将业务数据动态渲染到模板中进行打印。HiPrint 官网地址：传送门(<a href="https://link.juejin.cn?target=http%3A%2F%2Fhiprint.io%2F" target="_blank" title="http://hiprint.io/" ref="nofollow noopener noreferrer">hiprint.io/</a>)</p>
<p>配置示例效果如下图：</p>

<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/48c4a520ab744742a3c347753a9bb5b2~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp" alt="" loading="lazy"/></p>
<h4 data-id="heading-7">实现方式</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 基于jQuery的打印设计器</span>
$(<span class="hljs-string">'#element'</span>).<span class="hljs-title function_">hiPrint</span>({
  <span class="hljs-attr">designer</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 开启可视化设计</span>
  <span class="hljs-attr">templates</span>: [...] <span class="hljs-comment">// 预设模板</span>
});
</code></pre>
<h4 data-id="heading-8">优点</h4>
<ul>
<li><strong>所见即所得的可视化模板设计</strong>
<ul>
<li>拖拽式配置</li>
<li>非开发人员也可参与模板调整</li>
</ul>
</li>
<li><strong>布局组件丰富</strong>
<ul>
<li>表格、文本、条码、图片等组件齐全</li>
<li>支持动态数据绑定</li>
</ul>
</li>
<li><strong>模板管理能力完善</strong>
<ul>
<li>模板导入 / 导出</li>
<li>支持模板版本管理</li>
</ul>
</li>
</ul>
<h4 data-id="heading-9">缺点</h4>
<ul>
<li><strong>技术栈依赖性强</strong>：强依赖 jQuery，与 React / Vue 整合成本高</li>
<li><strong>性能问题明显</strong>：
<ul>
<li>模板复杂时渲染速度下降</li>
<li>大数据量场景容易卡顿</li>
</ul>
</li>
<li><strong>样式隔离难度大</strong>：
<ul>
<li>容易与现有系统样式冲突</li>
<li>需要额外处理样式覆盖与作用域</li>
</ul>
</li>
</ul>
<h3 data-id="heading-10">3.基于本地打印控件的软件方案（LODOP）</h3>
<p>LODOP 是一类 <strong>依赖本地打印控件或客户端程序</strong> 的打印方案，通过浏览器与本地程序通信完成打印。在早期政务、财务、制造业系统中使用较多。官网地址：传送门(<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.lodop.net%2F" target="_blank" title="https://www.lodop.net/" ref="nofollow noopener noreferrer">www.lodop.net/</a>)</p>
<h4 data-id="heading-11">实现方式</h4>
<ul>
<li>先去Lodop官网下载相应的安装包</li>
<li>解压安装后将LodopFuncs.js放在项目中</li>
<li>具体页面引入 Lodop</li>
</ul>
<pre><code class="hljs language-css" lang="css">import { getLodop } <span class="hljs-selector-tag">from</span> "@/plugins/LodopFuncs";

let LODOP = getLodop()
</code></pre>
<ul>
<li>执行打印指令</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 需要先安装LODOP软件</span>
<span class="hljs-variable constant_">LODOP</span>.<span class="hljs-title function_">PRINT_INIT</span>(<span class="hljs-string">"打印任务"</span>);
<span class="hljs-variable constant_">LODOP</span>.<span class="hljs-title function_">ADD_PRINT_TEXT</span>(<span class="hljs-number">50</span>, <span class="hljs-number">100</span>, <span class="hljs-number">200</span>, <span class="hljs-number">30</span>, <span class="hljs-string">"供应链单据"</span>);
<span class="hljs-variable constant_">LODOP</span>.<span class="hljs-title function_">PRINT</span>();
</code></pre>
<h4 data-id="heading-12">优点</h4>
<ul>
<li><strong>打印控制能力极强</strong>
<ul>
<li>支持毫米级定位</li>
<li>可直接控制打印机指令</li>
</ul>
</li>
<li><strong>对专业打印设备支持完善</strong></li>
</ul>
<h4 data-id="heading-13">缺点</h4>
<ul>
<li><strong>浏览器兼容性极差</strong>
<ul>
<li>依赖 ActiveX</li>
<li>现代浏览器与移动端基本不支持</li>
<li>只支持windows 系统</li>
</ul>
</li>
<li><strong>部署与运维成本高</strong>
<ul>
<li>每台客户端需安装软件</li>
<li>需要管理员权限</li>
</ul>
</li>
<li><strong>安全性与可持续性问题</strong>
<ul>
<li>ActiveX 存在安全隐患</li>
<li>已逐步被浏览器厂商淘汰</li>
</ul>
</li>
</ul>
<h3 data-id="heading-14">4.方案对比一览表</h3>









































<table><thead><tr><th><strong>维度</strong></th><th><strong>window.print</strong></th><th><strong>jQuery HiPrint</strong></th><th><strong>LODOP</strong></th></tr></thead><tbody><tr><td><strong>开发成本</strong></td><td>极低</td><td>中等</td><td>高</td></tr><tr><td><strong>打印精度</strong></td><td>一般（受限于浏览器）</td><td>良好</td><td><strong>极高</strong></td></tr><tr><td><strong>跨浏览器</strong></td><td><strong>优秀</strong></td><td>良好</td><td>极差</td></tr><tr><td><strong>部署成本</strong></td><td><strong>零部署</strong></td><td>低</td><td>高（需安装客户端）</td></tr><tr><td><strong>维护成本</strong></td><td>低</td><td>中等</td><td>高</td></tr></tbody></table>
<h3 data-id="heading-15">5.方案选型结论</h3>
<p>结合当前业务特点：</p>
<ul>
<li>需要快速适配不同客户与环境</li>
<li>系统主体基于 React 技术栈</li>
<li>单据模板相对稳定，支持页面预览</li>
</ul>
<p>最终选择了 <strong>基于 DOM 的浏览器打印方案，并以 <strong>window.print</strong> 作为核心实现方式</strong>。</p>
<h4 data-id="heading-16">为什么直接使用 PrintJs ?</h4>
<p>可能会有人疑惑，既然是 DOM 打印，为什么不使用 <code>print-js</code> 进行封装？主要原因如下：</p>
<ul>
<li><strong>print-js 需要能够直接获取到打印节点（dom 的id 或者原始的html）</strong>
<ul>
<li><strong>必须将预览节点在打印前挂载到页面上。</strong></li>
</ul>
</li>
<li><strong>iframe 隔离成本高</strong>
<ul>
<li>需要单独引入工程化依赖包CSS 资源。如： Antd等</li>
</ul>
</li>
<li><strong>样式维护成本高</strong>
<ul>
<li>额外样式需要么通过字符串方式注入，要么将工程的less 转换成css 引入，不利于后续维护。</li>
</ul>
</li>
</ul>
<p>总的来说，print-js 在工程化配置项目依旧不是那么方便还用。</p>
<h2 data-id="heading-17">三、window.print 的能力边界</h2>
<p><code>window.print()</code> 本质上是<strong>触发浏览器打印对话框</strong>。当打印动作触发时，浏览器会将<strong>当前页面最终渲染的结果</strong>输出为打印内容，或者导出为 PDF 文件。</p>
<p>也正因为这一点，<code>window.print</code> 天生存在一个非常重要的限制：</p>
<blockquote>
<p><strong>它无法直接指定“只打印某一个 DOM 区域”。</strong></p>
</blockquote>
<p>浏览器并不知道你只想打印某一个 <code>div</code>，它只会按照当前页面的渲染结果，完整地执行一次打印流程。<br/>
这意味着，如果页面上存在导航栏、按钮、筛选条件等元素，它们同样会被一并打印出来。</p>
<h2 data-id="heading-18">四、指定区域打印的实现思路</h2>
<p>既然 <code>window.print</code> 无法直接指定打印区域，那么解决问题的思路就非常清晰了：</p>
<blockquote>
<p><strong>在触发打印之前，主动控制页面最终的渲染结果，让真正参与渲染的内容只剩下需要打印的部分。</strong></p>
</blockquote>
<p>顺着这个思路，第一个最直观的方案自然就出现了。</p>
<h3 data-id="heading-19">1.innerHTML 直接替换页面内容</h3>
<p>既然浏览器只会打印当前页面的渲染结果，那么我们是否可以在打印前，<strong>直接用需要打印的内容替换整个页面</strong>？</p>
<p>实现方式也很简单：</p>
<ul>
<li>缓存当前页面内容</li>
<li>将 <code>document.body.innerHTML</code> 替换为打印区域内容</li>
<li>执行 <code>window.print()</code></li>
<li>打印完成后再恢复页面</li>
</ul>
<p>代码示例如下：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 获取预览组件的html</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">getPreviewContainerHtml</span> = (<span class="hljs-params">component</span>) =&gt; {
  <span class="hljs-keyword">const</span> div = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'div'</span>);

  <span class="hljs-title function_">flushSync</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-title class_">ReactDOM</span>.<span class="hljs-title function_">render</span>(component, div);
  })

  <span class="hljs-keyword">return</span> div.<span class="hljs-property">innerHtml</span>
}

<span class="hljs-keyword">const</span> <span class="hljs-title function_">prinit</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">const</span> oldHtml = <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-property">innerHtml</span>;
  <span class="hljs-keyword">const</span> printHtml = <span class="hljs-title function_">getPreviewContainerHtml</span>(<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">PreviewContainer</span> /&gt;</span></span>);
  <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-property">innerHtml</span> = printHtml;
  <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">print</span>()
  <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-property">innerHtml</span> = oldHtml;
}
</code></pre>
<p>这种方案在早期项目中非常常见。但随着实践的深入，很快就会发现一个问题：<br/>
<strong>直接替换 <strong><code>innerHTML</code></strong> 会彻底打破原有页面的渲染结构。</strong></p>
<p>在 React / Vue 等现代前端框架中，这种方式会导致：</p>
<ul>
<li>组件状态丢失</li>
<li>事件绑定失效</li>
<li>页面需要强制刷新才能恢复</li>
</ul>
<p>因此，这种方案虽然思路直接，但在复杂系统中并不安全。</p>
<h3 data-id="heading-20">2.新开标签页打印</h3>
<p>既然直接替换当前页面会破坏原有渲染结构，那么很自然就会想到：</p>
<blockquote>
<p><strong>如果不动当前页面，而是新开一个标签页，专门用来承载打印内容，是否就可以解决这个问题？</strong></p>
</blockquote>
<p>新开标签页后，我们可以：</p>
<ul>
<li>在新页面中渲染完整的打印内容</li>
<li>调用新页面的 <code>window.print()</code></li>
<li>当前业务页面完全不受影响</li>
</ul>
<p>从技术角度看，这个方案确实可以稳定地打印出我们想要的内容。但在真实业务场景中，很快又会暴露出新的问题：</p>
<ul>
<li>浏览器可能拦截弹窗</li>
<li>用户需要多一步切换窗口的操作</li>
<li>打印流程被打断，体验不够流畅</li>
</ul>
<p>对于仓库、物流等高频打印场景来说，<strong>这种额外的交互成本是不可忽略的</strong>。</p>
<p>于是问题进一步演化为：</p>
<blockquote>
<p><strong>能否在不新开标签页、不破坏当前页面的前提下，在当前页签内完成指定内容的打印？</strong></p>
</blockquote>
<h3 data-id="heading-21">3.iframe 当前页签打印</h3>
<p>顺着这个问题继续往下推，自然而然就会引出 <strong>iframe 打印方案</strong>。</p>
<p>其核心思路是：</p>
<ul>
<li>在当前页面中动态创建一个隐藏的 <code>iframe</code></li>
<li>将需要打印的内容完整渲染到 iframe 中</li>
<li>调用 iframe 内部的 <code>print()</code> 方法完成打印</li>
</ul>
<p>示例代码如下：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">print</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">const</span> iframe = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'iframe'</span>);
  iframe.<span class="hljs-property">src</span> = <span class="hljs-string">`预览页地址`</span>;
  iframe.<span class="hljs-title function_">setAttribute</span>(
    <span class="hljs-string">'style'</span>,
    <span class="hljs-string">'visibility: hidden; height: 0; width: 0; position: absolute; border: 0'</span>
  );

  <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'onafterprint'</span>, <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'打印完成'</span>);
    iframe.<span class="hljs-title function_">remove</span>();
  });

  <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>(iframe);

  iframe.<span class="hljs-property">onload</span> = <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
      iframe.<span class="hljs-property">contentWindow</span>?.<span class="hljs-title function_">print</span>();
    }, <span class="hljs-number">1000</span>);
  };
};
</code></pre>
<p>从浏览器的角度来看，<strong>iframe 本身就是一个完整的页面环境</strong>，因此可以独立完成打印流程，而不会影响主页面的渲染状态。</p>
<p>这一方案在实践中具备明显优势：</p>
<ul>
<li>不破坏当前页面状态</li>
<li>不依赖新窗口或弹窗</li>
<li>对 React / Vue 等现代框架友好</li>
<li>非常适合供应链系统中的高频打印场景</li>
</ul>
<h3 data-id="heading-22">4.批量打印</h3>
<p>到目前为止，我们已经可以稳定地完成 <strong>单个单据的打印</strong>。但在供应链场景中，一个非常常见的需求是：</p>
<blockquote>
<p><strong>一次性打印多张面单、送货单或运输单。</strong></p>
</blockquote>
<p>在浏览器环境下，这一需求首先会受到一个客观限制：</p>
<ul>
<li>浏览器在同一时间只能处理<strong>一个打印任务</strong></li>
<li>调用 <code>window.print()</code> 时，浏览器会弹出系统打印对话框</li>
<li>在用户完成打印设置并关闭对话框之前，<strong>页面线程会被阻塞</strong></li>
</ul>
<p>这意味着，<strong>通过循环多次调用 <strong><code>window.print()</code></strong> 来实现批量打印并不可行</strong>。</p>
<h4 data-id="heading-23">批量渲染内容 + CSS 分页</h4>
<p>基于上述限制，一个更合理的思路是：<strong>在一次打印动作中，承载所有需要打印的单据内容。</strong>具体做法是：</p>
<ul>
<li>遍历需要打印的单据数据</li>
<li>将每一张单据渲染为独立的打印容器</li>
<li>通过 CSS 控制分页规则</li>
<li>最终只触发一次 window.print()</li>
</ul>
<p> 示例代码如下：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 批量创建打印容器</span>
printPageList.<span class="hljs-title function_">map</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">PrintContent</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"single-order-page"</span> /&gt;</span></span>
    })

<span class="hljs-comment">// css 配置</span>
<span class="hljs-comment">/* 确保每个订单在新页开始 */</span>
.<span class="hljs-property">single</span>-order-page {
  page-<span class="hljs-keyword">break</span>-<span class="hljs-attr">before</span>: always;
  page-<span class="hljs-keyword">break</span>-<span class="hljs-attr">inside</span>: avoid;
}

<span class="hljs-comment">/* 第一个订单不需要分页 */</span>
.<span class="hljs-property">single</span>-order-<span class="hljs-attr">page</span>:first-child {
  page-<span class="hljs-keyword">break</span>-<span class="hljs-attr">before</span>: avoid;
}

</code></pre>
<p>通过这种方式，浏览器会将每个单据视为一页内容，顺序稳定、实现简单，非常适合<strong>版式统一的批量单据打印场景</strong>。</p>
<h4 data-id="heading-24">大批量场景下的性能考量</h4>
<p>需要注意的是，当单据数量非常大（例如超过 50 张）时，<strong>一次性渲染所有打印内容，可能会带来内存占用和页面卡顿的问题</strong>。在这种情况下，可以考虑引入<strong>串行队列式的打印方案</strong>。</p>
<p>该方案的核心思路是：</p>
<ul>
<li>构建一个打印任务队列</li>
<li>每次只渲染并打印一张单据</li>
<li>当前打印结束后，再进入下一张单据的处理</li>
</ul>
<p>但需要特别注意的是，<strong>浏览器无法准确感知打印完成的时机</strong>，因此该方案通常需要额外的控制手段，例如：</p>
<ul>
<li>由用户交互驱动（如点击“下一张”）</li>
<li>通过时间间隔进行节流控制</li>
</ul>
<p>这种方式更适合作为<strong>大批量或特殊场景下的补充方案</strong>，而不是默认选择。</p>
<h2 data-id="heading-25">五、核心 CSS 打印配置：从“能打”到“好用”</h2>
<p>在基于浏览器的打印方案中，CSS 决定了最终的输出效果。合理的打印样式配置，往往可以显著减少版式错乱、内容截断等问题，也是浏览器打印能否真正落地的重要前提。</p>
<p>下面结合实际项目，整理几类最常用、也最容易被忽视的打印样式配置。</p>
<h3 data-id="heading-26">1.使用 <code>@media print</code> 定义专用打印样式</h3>
<p>浏览器提供了 <code>@media print</code> 媒体查询，用于在打印场景下<strong>覆盖页面的默认样式</strong>。</p>
<p>通过该方式，可以做到：</p>
<ul>
<li>页面正常浏览时样式不受影响</li>
<li>打印时只应用与单据相关的样式规则</li>
</ul>
<pre><code class="hljs language-css" lang="css"><span class="hljs-keyword">@media</span> print {
  <span class="hljs-comment">/* 打印场景下隐藏页面中的非单据内容 */</span>
  <span class="hljs-selector-class">.no-print</span> {
    <span class="hljs-attribute">display</span>: none <span class="hljs-meta">!important</span>;
  }
}
</code></pre>
<h3 data-id="heading-27">2.页面尺寸与边距控制</h3>
<p>如果不对打印页面的尺寸和边距进行控制，常见问题包括：</p>
<ul>
<li>内容被裁切</li>
<li>页面留白过多</li>
<li>不同浏览器下表现不一致</li>
</ul>
<p>通过 <code>@page</code> 可以明确指定打印纸张规格与边距：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-keyword">@media</span> print {
  <span class="hljs-keyword">@page</span> {
    size: A4;
    <span class="hljs-attribute">margin</span>: <span class="hljs-number">10mm</span>;
  }
}
</code></pre>
<h3 data-id="heading-28">3.避免表格内容被强制拆页</h3>
<p>表格是供应链单据中最常见的结构，同时也是打印问题的高发区域。<br/>
如果不加控制，浏览器可能会在任意位置拆分页，导致一行数据被拆成两页。</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-keyword">@media</span> print {
  <span class="hljs-selector-tag">table</span> {
    <span class="hljs-attribute">border-collapse</span>: collapse;
    <span class="hljs-comment">/* 避免整个表格在打印时被拆分 */</span>
    <span class="hljs-attribute">page-break-inside</span>: avoid;
  }

  <span class="hljs-selector-tag">tr</span> {
    <span class="hljs-comment">/* 避免单行数据跨页 */</span>
    <span class="hljs-attribute">page-break-inside</span>: avoid;
  }
}
</code></pre>
<h3 data-id="heading-29">4.主动控制分页位置</h3>
<p>在部分业务场景中，需要对分页位置进行明确控制，例如：</p>
<ul>
<li>一张送货单单独占一页</li>
<li>合计信息必须在新页展示</li>
</ul>
<p>此时可以通过自定义分页样式来实现：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-keyword">@media</span> print {
  <span class="hljs-selector-class">.page-break</span> {
    <span class="hljs-comment">/* 在该元素前强制分页 */</span>
    <span class="hljs-attribute">page-break-before</span>: always;
  }
}
</code></pre>
<h3 data-id="heading-30">5.打印颜色与背景处理</h3>
<p>浏览器在打印时，默认会忽略背景颜色与部分样式，这在以下场景中尤为明显：</p>
<ul>
<li>面单背景色</li>
<li>标签类单据</li>
<li>状态标识区域</li>
</ul>
<pre><code class="hljs language-css" lang="css"><span class="hljs-keyword">@media</span> print {
  <span class="hljs-selector-tag">body</span> {
    <span class="hljs-comment">/* 强制按页面样式输出颜色 */</span>
    -webkit-print-<span class="hljs-attribute">color</span>-adjust: exact;
    print-<span class="hljs-attribute">color</span>-adjust: exact;
  }
}
</code></pre>
<p>注：Window 电脑如果不设置 <code>-webkit-print-color-adjust: exact</code> 打印输出水印内容， 会出现空白现象。</p>
<h2 data-id="heading-31">六、总结</h2>
<p>浏览器打印在供应链系统中看似只是一个基础能力，但在真实项目中，往往涉及<strong>方案选型、技术栈适配、用户体验以及长期维护成本</strong>等多方面的权衡。</p>
<p>本文结合具体的业务背景，对主流 Web 打印方案进行了梳理，并重点分析了基于 <code>window.print</code> 的实现思路及其工程边界。</p>
<p>可以看到，<code>window.print</code> 本身并不复杂，真正的挑战更多来自页面渲染控制、样式管理以及打印流程的工程化处理。这也使得浏览器打印更像是一项系统能力的组合，而非单一 API 的简单调用。</p>
<p>在当前阶段，<code>window.print</code> 配合 <code>iframe</code> 依然是 Web 打印方案中<strong>性价比最高、可控性最强的一种实现方式</strong>。随着业务复杂度的提升，打印方案仍有进一步演进与细化的空间。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[血压飙升，Flutter & Dart 2025 年度巨坑回顾]]></title>    <link>https://juejin.cn/post/7598737609494855699</link>    <guid>https://juejin.cn/post/7598737609494855699</guid>    <pubDate>2026-01-25T22:56:12.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598737609494855699" data-draft-id="7598744870995771435" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="血压飙升，Flutter &amp; Dart 2025 年度巨坑回顾"/> <meta itemprop="keywords" content="前端,Flutter,Android"/> <meta itemprop="datePublished" content="2026-01-25T22:56:12.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="恋猫de小郭"/> <meta itemprop="url" content="https://juejin.cn/user/817692379985752"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            血压飙升，Flutter &amp; Dart 2025 年度巨坑回顾
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/817692379985752/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    恋猫de小郭
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-25T22:56:12.000Z" title="Sun Jan 25 2026 22:56:12 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读13分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>近日，Google 官方发布了<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FHQ5_59Mm1WT1xsiPuy6I2w" target="_blank" title="https://mp.weixin.qq.com/s/HQ5_59Mm1WT1xsiPuy6I2w" ref="nofollow noopener noreferrer">《Flutter &amp; Dart 2025 年度十大高光时刻回顾》</a>，内容包括：</p>
<ul>
<li>Flutter 3.29 - 3.38 版本更新</li>
<li>Dart 3.7 - 3.19 版本更新</li>
<li>Flutter Roadmap &amp; Google I/O</li>
<li>NotebookLM、teamLab、Agape、Universal Destinations &amp; Experiences、Reflection.app 、 GE Appliances 、talabat 等案例展示</li>
<li>Material 和 Cupertino 拆分进度</li>
<li>build_runner 提速速度</li>
<li>Dart 与 Flutter MCP Server</li>
<li>Flutter AI Toolkit 、GenUI</li>
<li>····</li>
</ul>
<p>但是又怎么可以报喜不报忧？既然官方报喜，那我就来点忧的，<strong>2025 在 Flutter 内容上我的大概写了有 60 来篇，稍微整理几个给大家直观回顾下 2025 Flutter 究竟经历了哪些经典巨坑</strong>。</p>
<blockquote>
<p>只能说 Flutter 坑接坑不断，但 iOS 能占一半。</p>
</blockquote>
<h2 data-id="heading-0">宏</h2>
<p>Flutter 在 2025 年 1 月的时候，开年就送上了大礼，官方决定 Dart 宏功能推进暂停，后续专注定制数据处理支持，宏功能是在 2024 年初开始决定推进的，而 2025 年开年，官方得到了一个结论：</p>
<blockquote>
<p><strong>做出来能用是能用，但是质量和性能都达不到一开始的预期，而且维护成本很高</strong>。</p>
</blockquote>
<p>所以对于社区里大家盼星星盼月亮都在等的宏支持就这么夭折了，虽然不久前官方也再次出来解释了为什么暂停：</p>
<ul>
<li>宏执行时序与 Dart 常量模型存在根本冲突</li>
<li>JSON metadata 方案“能跑但不可用”</li>
<li>Analyzer + CFE 双体系导致工作量与复杂度指数级爆炸</li>
<li>性能与 IDE 体验无法接受</li>
<li>无法完全替代 build_runner</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/81e81873180b40cba601194c60110e2b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769986571&amp;x-signature=WFxWKmdWN7oVCpN2RZTh2otLvzw%3D" alt="" loading="lazy"/></p>
<blockquote>
<p>更多可见：<a href="https://juejin.cn/post/7591730714140606506" target="_blank" title="https://juejin.cn/post/7591730714140606506">《Dart 官方再解释为什么放弃了宏编程》</a></p>
</blockquote>
<p>但是宏终归还是凉了，<strong>官方也将精力回归到 build_runer ，也在性能上做出了一些不小的提升</strong>，但是 Augmentation 支持还是没落地（它允许通过 <code>augment</code> 关键字，在新文件里去“补充”旧文件的定义），这也是 2025 官方在宣布宏放弃之后，没能完全填不上的坑。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ea3f5f30f6ce48f0822fdd68a237e75a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769986571&amp;x-signature=nqEX9zEx22E%2Bd91K3e%2BZMBNZVKk%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-1">线程合并</h2>
<p>线程合并是 Flutter 在 3.29 的重大调整，在过去 <strong>Flutter 的 UI Runner 和 Android/iOS 平台的 Platform Runner 是处于不同线程</strong>，其中 Dart 的 root isolate 会在被关联到 UITaskRunner 上。</p>
<p>所以在过去 Flutter 里会有异步 platform channels 的存在，因为 UI Runner 和 Platform Runner 分属不同线程，所以 Dart 和 Native 互相调用时需要序列化和异步消息传递。</p>
<p>而在 3.29 里，作为改进移动平台上 Native 和 Dart 互操作系列调整中的一部分，两个线程被合并了，说人话就是： <code>UI Runner = Platform Runner </code>：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/029fb241548e4f49a85825a6bbe41221~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769986571&amp;x-signature=H63enzHN5IZAM4yEtC3G%2FoO4vUo%3D" alt="" loading="lazy"/></p>
<p>实际上这是一个不错的调整，<strong>因为同步调用是趋势，而且也能解决 Flutter 的许多历史问题，也是一个大趋势</strong>，但是步子迈大了，总会扯出一些问题，而线程合并带来的问题还不少：</p>
<ul>
<li>Android 断点 Dart 代码现在会导致 ANR 弹窗死循环</li>
<li>线程合并之后，启动引擎、应用和设置 Dart 代码都运行的平台线程上，会导致第一个可交互帧的时间变长</li>
<li>Win 出现 Failed to post message to main thread 或者渲染卡死问题</li>
<li>一些插件过去没适配同步线程，导致卡顿明显</li>
<li>······</li>
</ul>
<blockquote>
<p>更多可见：<a href="https://juejin.cn/post/7496397558359162934" target="_blank" title="https://juejin.cn/post/7496397558359162934">《Flutter 在全新 Platform 和 UI 线程合并后，出现了什么大坑和变化？》</a></p>
</blockquote>
<p>这个改动带来的效益和目标是好的，也为 FFI 等同步调用场景打下了基础，但是奈何这类 break change 带来的问题，在初期版本可以说是灾难，在当时生产几乎都是选择暂时关闭这个特性。</p>
<h2 data-id="heading-2">mprotect failed: Permission denied</h2>
<p>iOS 可以说是 2026 Flutter 问题的重灾区，特别因为 iOS 26 的到来，给 Flutter 带来了不少全新的适配成本，其中就包括这个 mprotect failed，<strong>现象就是无法在 iOS 真机上 Debug 运行</strong>，因为 Apple 官方禁止了 JIT 支持的“漏洞”。</p>
<p>这个问题其实也很戏剧性：</p>
<ul>
<li>问题一开始出现在 iOS 18.4 beta，但是在 Flutter 还没处理的时候，但 iOS 18 beta2 该“漏洞”又可以正常使用，所以适配放缓</li>
<li>iOS 26 beta1 mprotect 漏洞又重新禁止了，所以 Flutter 又需要对适配加急</li>
</ul>
<p>所以 Flutter 不得不在 iOS 26 ，通过 LLDB 的 <code>debugserver</code> ，然后利用 python 脚本实现适配黑科技：对同一个内存地址，在 Debug 时做到同时 RW 和 RX 支持 ，实际上就是开了两道门。</p>
<blockquote>
<p>更多可见：<a href="https://juejin.cn/post/7542461507402924075" target="_blank" title="https://juejin.cn/post/7542461507402924075">《Flutter 又双叒叕可以在 iOS 26 的真机上 hotload 运行了》</a></p>
</blockquote>
<p>事实上这个支持一直不太好，成功率不高，经常会出现超时等问题，一直等到 iOS 26 发布之后， devicectl + lldb 的支持才完善，Debug 的真机 JIT 运行才回到正轨。</p>
<p>所以这里还有另外一问题，就是<strong>由于苹果对于 <code>ios-deploy</code> 的“废弃”，导致了 iOS 真机 Debug 运行出现 Timed out * to update 的问题</strong> ，具体表现在：</p>
<blockquote>
<p>如果你直接在 Xcode 直接运行这个 Flutter 项目是可以正常运行，但是通过 flutter 命令运行或者 ide run 就不行。</p>
</blockquote>
<p>这个坑相信有不少人踩过，当时临时解决方式包括有：</p>
<ul>
<li>需要安装 Xcode 并且运行时会弹出 Xcode 窗口</li>
<li>用户在 macOS 的<code>“系统设置 &gt; 隐私与安全性 &gt; 自动化”</code>中给予相应的权限</li>
<li>关闭 Wi-Fi，因为有时候即使 iPhone 通过 USB 数据线连接到 Mac，Xcode 也可能优先选择通过 Wi-Fi 进行调试连接</li>
<li>如果还不行，可以尝试 Xcode 直接运行，然后执行 <code>flutter attatch</code> 尝试连接 Dart VM Observatory 服务</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f2aa15e6f60f4c4f8f021e4747afc47c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769986571&amp;x-signature=lXHqRrkv9WekOT1PKnQGeTT%2FeTI%3D" alt="" loading="lazy"/></p>
<blockquote>
<p>搞笑的是，有一段时间，<code>flutter attatch</code> 尝试连接 Dart VM Observatory 服务也 Timeout 了，详细可见：<a href="https://juejin.cn/post/7529752760076009508" target="_blank" title="https://juejin.cn/post/7529752760076009508">《聊聊 Flutter 在 iOS 真机 Debug 运行出现 Timed out *** to update 的问题》</a></p>
</blockquote>
<p>一直到 <a href="https://juejin.cn/post/754246150740292407" target="_blank" title="https://juejin.cn/post/754246150740292407">《Flutter 完成全新 devicectl + lldb 的 Debug JIT 运行支持》</a> 之后，iOS 的开发运行才回归正轨，这时候已经是接近 2025 的 9 月份了。</p>
<h2 data-id="heading-3">iOS 26 模拟器无法运行</h2>
<p>在 3.35 的时候，Flutter 开发者发现，Flutter 在 iOS 26 模拟器上也“随机”出现无法运行的情况，运行时会出现 <code>Unable to find a destination matching the provided destination specifie</code> 这样的提示：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cb33cc4a9530431f86b18ed7ba37408c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769986571&amp;x-signature=2dUTkqF4CUHDQL1nqZztQkW2zkE%3D" alt="" loading="lazy"/></p>
<p>当然，这个即是 Flutter 的问题，也不是 Flutter 的问题，但是它是真很坑，因为在一开始，大家都不知道为什么会出现这个问题，而且为什么有的项目会有，有的项目不会，经过很长时间排查才发现，<strong>是一些插件和模拟器之间的适配问题</strong>，实际上问题是：</p>
<blockquote>
<p><strong>用的插件不支持 “ARM 模拟器”，而你默认使用的 iOS 26 模拟器只支持 ARM</strong> 。</p>
</blockquote>
<p>而解决问题的方式也很简单，只需在 Mac 上安装 <strong>Rosetta</strong> ，然后从 Xcode 中移除 <strong>iOS 26</strong> 平台，然后运行以下命令：</p>
<blockquote>
<p><code>xcodebuild -downloadPlatform iOS -architectureVariant universal</code></p>
</blockquote>
<p><strong>重新下载的会是具有通用架构支持的 iOS 26</strong>，而不仅仅是基于 Apple 的 ARM 架构默认配置，所以解决方案是强制 Xcode 下载 iOS 26 模拟器的“通用”版本，而不是默认的“Apple Silicon”，通过 <code>xcodebuild -downloadPlatform iOS -architectureVariant universal</code> 之后，就可以看到通用的 iOS 26 模拟器组件以及 Rosetta 模拟器：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/68ecb50f4f5a45f99ad625d402e30265~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769986571&amp;x-signature=Li2%2Be%2Ba0sX4RmF1Q8utgj0jwTt4%3D" alt="" loading="lazy"/></p>
<p>当然，<strong>Rosetta 只能说是一个临时的解决方式，核心还是要看哪些插件仍然无法运行 ARM</strong> ，但是也是一些 Flutter 插件没适配好，这锅 Flutter 也要背。</p>
<blockquote>
<p>详细可见：<a href="https://juejin.cn/post/7560986017034190891" target="_blank" title="https://juejin.cn/post/7560986017034190891">《Flutter 在 iOS 26 模拟器跑不起来？其实很简单》</a></p>
</blockquote>
<h2 data-id="heading-4">iOS 26 WebView</h2>
<p>这也是一个大坑问题，就是 Flutter WebView 在 iOS 26 上有点击问题，原因来自 Flutter 的技术债务，核心原因就是因为一直以来线程合并之前的 <code>MethodChannel</code> 只能异步。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fecb7f0d9ee04307971d881e125c9c99~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769986571&amp;x-signature=43xN8H9Daj4Gcvkk2YZ6%2BAbvNqc%3D" alt="" loading="lazy"/></p>
<blockquote>
<p>可谓是一环扣一环，毕竟线程同步后的 FFI 还真是解决这个的思路。</p>
</blockquote>
<p>那你要说这个问题有多坑，你看我都可以写三篇文章，就知道这个问题有多蛋疼：</p>
<ul>
<li><a href="https://juejin.cn/post/7571306072423448618" target="_blank" title="https://juejin.cn/post/7571306072423448618">《为什么你的 Flutter WebView 在 iOS 26 上有点击问题？》</a></li>
<li><a href="https://juejin.cn/post/7583577045578907674" target="_blank" title="https://juejin.cn/post/7583577045578907674">《Flutter 官方正式解决 WebView 在 iOS 26 上有点击问题》</a></li>
<li><a href="https://juejin.cn/post/7584443518162141220" target="_blank" title="https://juejin.cn/post/7584443518162141220">《再次紧急修复，Flutter 针对 WebView 无法点击问题增加新的快速修复》</a></li>
</ul>
<p>问题最开始出现在 iOS 18.2 beta 版本上，当页面上先触发了某些 Flutter widget（或者 overlay，比如 context menu / Drawer）后，<strong>WKWebView 内的点击（链接、按钮）不再响应</strong>（可高亮，但不会激活），需要重新加载 WebView 才恢复。</p>
<p>而具体原因在于，Flutter 在 iOS 的 PlatformView（例如承载 WKWebView 的视图）上实现了一套“手势拦截/延迟”机制：在需要时会把一个 <code>FlutterDelayingGestureRecognizer</code>（<code>delayingRecognizer</code> ）切到某些状态（<code>possible</code>, <code>ended</code>, <code>failed</code> 等）来告诉 UIKit 或者其他 recognizers 是否应该阻止/允许手势传递。</p>
<p>又因为，Flutter 和 UIKit 都各自有手势识别系统（GestureRecognizer），为了防止互相抢事件，Flutter engine 在 iOS 上加入了一个“<strong>delaying gesture recognizer</strong>”（延迟识别器）：</p>
<blockquote>
<p>它的作用是：当 Flutter 框架检测到某个 widget 想“阻止”事件时（比如 <code>GestureDetector</code> 或 overlay 遮罩），Flutter 会让这个 <code>delayingRecognizer</code> 阻止 UIKit 里的 recognizer（例如 WKWebView 的点击识别器）响应。</p>
</blockquote>
<p>而问题主要出现在 Flutter → UIKit 手势交界，详细的这里就不展开了，反正就是 Flutter 一开始为了解决这个问题做了一件事：</p>
<blockquote>
<p>在 blockGesture 的处理流程里把 <code>delayingRecognizer</code> <strong>移除后再添加回去</strong>，以强制 UIKit/WebKit 刷新识别器关系，解决了问题：<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/252c6d88acca4d5f835b7304c0fd6031~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769986571&amp;x-signature=ZKr7xbhxHR6o7OmjXDX6TMiV9dM%3D" alt="" loading="lazy"/></p>
</blockquote>
<p>但是这个做法在 iOS 26 上不行了，所以官方有做了两个处理：</p>
<ul>
<li>完整修复方案， 利用 FFI 和全新的 HitTest 实现，从底层正式重构修复问题，但是改动很多，没那么快合并到正式版本</li>
<li>临时解决方案，增加一个方式，通过递归操作，再来一下 NO &amp; YES <img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2396c0d2869f41c2a250a4c2fd5ebf13~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769986571&amp;x-signature=%2Fhu32LkUpoe5ZRCaMWoD%2BLtBd%2Fo%3D" alt="" loading="lazy"/><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9ac355b12d7e4fc38d99ead198051a5f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769986571&amp;x-signature=S9a4hijqLgDFYCEti4Cqs4ulY4Y%3D" alt="" loading="lazy"/></li>
</ul>
<p>针对完整解决方案，除了需要改引擎和框架，第三方插件也需要适配，但是属于是彻底解决问题的思路，而临时方案的好处就是：<strong>可以什么插件都不改就生效</strong>。</p>
<blockquote>
<p>所以，这个问题虽然解决了，但是这个坑还在，就看什么时候 break change 了。</p>
</blockquote>
<h2 data-id="heading-5">binary is invalid</h2>
<p>依然还是 iOS 问题，可以看到 2025 大坑，有一半以上都是 iOS 的，问题在于 3.38.1 之后的版本，在提交 App Store 的时候，有概率发现打包提交 iOS 的包会出现 <code>The binary is invalid</code> 的相关错误，简单来说，就是<strong>App Store 拒绝了某个二进制文件，因为它包含了无效的内容</strong>。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/96f12c3999ba437a9365b5847222c920~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769986571&amp;x-signature=0XTg6xwPc%2Fy1RrE04luRX7DoV2k%3D" alt="" loading="lazy"/></p>
<p>那么这个内容是怎么来的？大概率是模拟器架构的 Framework 被错误地打包进了正式发布的 App ，具体原因还要提到最新版本增加的 Native Assets 功能。</p>
<p>Native Assets 的目标是<strong>让在 Flutter/Dart 包中集成 C、C++、Rust 或 Go 代码，可以像集成普通 Dart 包一样简单</strong>，也就是它允许 Dart 包定义如何构建和打包原生代码，开发者不需要深入了解每个平台的底层构建系统，也是 Dart FFI 未来的重要基建。</p>
<p>那它怎么导致了这次这个低级问题的出现？实际上这是一个构建脚本逻辑缺陷导致的“脏构建”问题，当 Flutter 构建依赖于 Native Assets（比如 <code>sqlite3</code> 等库）的 Plugin 时，这些原生资源会被编译并输出到 <code>build/native_assets/$platform</code> 目录（例如 <code>build/native_assets/ios</code>）。</p>
<p>因为在现有的构建脚本（<code>xcode_backend.dart</code>）在打包时，会简单粗暴地将 <code>build/native_assets/ios</code> 目录下的<strong>所有</strong>框架复制到最终的 App Bundle (<code>Runner.app/Frameworks</code>) ，例如：</p>
<ul>
<li>先运行了模拟器跑应用，这时模拟器专用的框架（如 <code>sqlite3arm64ios_sim.framework</code>）就会被生成并留在了 <code>build/native_assets/ios</code> 目录</li>
<li>接着，开发者在<strong>没有运行 <code>flutter clean</code></strong> 的情况下，直接运行了 Release 构建</li>
<li>构建脚本会把之前遗留的“模拟器框架”也一并复制进了 Release 包</li>
<li>App Store 检测到 Release 包中含有模拟器架构的代码，因此拒绝接收</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3ef426a8657b4367beab6976a1354461~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769986571&amp;x-signature=HZHJx9E2sPgCQA6pyLjiKNTyalY%3D" alt="" loading="lazy"/></p>
<p>而且，其实这个问题是存在两个 Bug ，目前 Fix 的 PR 也都已经合并，开发者处理思路有：</p>
<ul>
<li>
<p>存在 native assets 的</p>
<ul>
<li>使用 main - <code>flutter channel main</code></li>
<li>archiving 之前，使用 <code>flutter clean</code> 和 <code>flutter build ios --config-only</code></li>
</ul>
</li>
<li>
<p>没有使用 native assets 的:</p>
<ul>
<li>使用最新 <code>flutter channel main</code></li>
<li>使用稳定版 <code>flutter channel stable</code></li>
</ul>
</li>
</ul>
<blockquote>
<p>因为第二个 bug 是某个 beta 版本弄出来的。</p>
</blockquote>
<p>所以，这也是一个草台版本的 bug ，但是带来的影响还是很坑的，毕竟提交的时候才发现版本不行，而且找起来也很麻烦，虽然解决很容易，但是恶心层度贼高。</p>
<blockquote>
<p>详细可见：<a href="https://juejin.cn/post/7591350620189360134" target="_blank" title="https://juejin.cn/post/7591350620189360134">《Flutter 3.38.1 之后，因为某些框架低级错误导致提交 Store 被拒》</a></p>
</blockquote>
<h2 data-id="heading-6">iOS 键盘问题</h2>
<p>又是 iOS ，这次还是 iOS 26 问题，Flutter 在 iOS 26 上，某些场景会因为出现半透明键盘，而页面底下本来应该被键盘遮挡的 Widget，由于默认没有被绘制，从而出现键盘背景颜色 UI 异常：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/498c49cdcf114c27b07156f662a37723~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769986571&amp;x-signature=e0qEle3TEkqMOekx9g2nHerfvBs%3D" alt="" loading="lazy"/></p>
<p>虽然问题看起来是一个圆角问题，但是实际上这是 <strong>iOS 26 系统键盘增加了“半透明”后带来的问题，Flutter 在键盘后面那一层在某些场景下没有正确渲染内容</strong>，导致键盘半透明区域透出来的不是底下 BottomSheet 的真实内容，而是一整块黑色区域。</p>
<blockquote>
<p>issue 提到问题，问题最明显的场景主要出现在 iOS 26 的 <code>showModalBottomSheet()</code> 下。</p>
</blockquote>
<p>虽然问题看起来是一个圆角问题，但是实际上这是 <strong>iOS 26 系统键盘增加了“半透明”后带来的问题，Flutter 在键盘后面那一层在某些场景下没有正确渲染内容</strong>，导致键盘半透明区域透出来的不是底下 BottomSheet 的真实内容，而是一整块黑色区域。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c382b66b3e324ca680c30e974b85394a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769986571&amp;x-signature=qRmiAi64qS16SCk4AF1XmlqJiRo%3D" alt="" loading="lazy"/></p>
<p>当然，<strong>正常大家使用输入框输入文本内容不会有什么问题</strong>，甚至如果你用 Dialog 场景也不会有什么问题，它主要出现在默认有底色场景的类似 <code>BottomSheet</code> 这种场景，所<strong>针对问题其实可以选择配置 <code>UIDesignRequiresCompatibility = YES</code> 来解决，或者替换为 Dialog 来绕过场景</strong>，但是如果要等官方修复这个场景，可能会需要等待评估是否真的有必要大规模底层改动。</p>
<p>这个问题就在于，官方是真的在考虑是否大规模修改底层来解决问题，毕竟按照之前的尿性，如果真的为了这个大规模修改底层，那么 issue 生 issue ，解一送十也不是不可能。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e66f506501bf48b291a9c1af36a3ca64~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769986571&amp;x-signature=Efk7F5gijaPv2nKkRbsqhv66H3k%3D" alt="" loading="lazy"/></p>
<blockquote>
<p>详细可见：<a href="https://juejin.cn/post/7596245612558319625" target="_blank" title="https://juejin.cn/post/7596245612558319625">《Flutter 又迎大坑修改？iOS 26 键盘变化可能带来大量底层改动》</a></p>
</blockquote>
<h2 data-id="heading-7">最后</h2>
<p>看了 2025 的年度大坑回顾，不知道有没有你踩过的共鸣？但是这只是一些比较典型或者恶心的，其他琐碎小问题其实也不少，但是好在 Flutter 也有在积极解决这些大坑，不过可以看出来 iOS 26 确实带来了不少问题，很多问题也不是 Flutter 特有的，RN 和 KMP 也不可避免，<strong>只能说平台升级带来的坑是真不少</strong>，不然你看，谷歌看 Android 16 没带来什么大问题，所以给大家准备了 AGP 9 整整 KPI ，多贴心：</p>
<blockquote>
<p><a href="https://juejin.cn/post/7597900782910685203" target="_blank" title="https://juejin.cn/post/7597900782910685203">Android Gradle Plugin 9.0 发布，为什么这会是个史诗级大坑版本</a></p>
</blockquote>
<p>那么，2025 你遇到过什么坑呢？</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[子弈的 2025 年度总结]]></title>    <link>https://juejin.cn/post/7598947628468207662</link>    <guid>https://juejin.cn/post/7598947628468207662</guid>    <pubDate>2026-01-25T16:19:14.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598947628468207662" data-draft-id="7598732691769606195" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="子弈的 2025 年度总结"/> <meta itemprop="keywords" content="前端,人工智能,AI编程"/> <meta itemprop="datePublished" content="2026-01-25T16:19:14.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="子弈"/> <meta itemprop="url" content="https://juejin.cn/user/3227821870163176"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            子弈的 2025 年度总结
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3227821870163176/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    子弈
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-25T16:19:14.000Z" title="Sun Jan 25 2026 16:19:14 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读12分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">学习</h2>
<p>2025 年在学习上可以简单分为以下几块内容：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9bbce3a8a2c94932ad09f62b32222a9d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2Q5byI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769962754&amp;x-signature=G%2FZGd%2FX2RineFSC%2F4TCMDXk6oRw%3D" alt="HEIF图像.heic" loading="lazy"/></p>
<h3 data-id="heading-1">AI 实践学习</h3>
<p>每一个同学对于 AI 的了解和学习程度都不一样，我自己简单总结了一下在接触 AI 应用开发过程中可能经历的几个阶段：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/99a79458406448348c9c9d1112227f6a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2Q5byI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769962754&amp;x-signature=LCKj76XlkHeNoJG5pqI%2F6gWS%2BCI%3D" alt="HEIF图像 3.heic" loading="lazy"/></p>
<p>今年我发现身边越来越多的同事从对 AI 保持观望到快速进入 Vibe Coding 时代，大家会积极了解和使用市面上成熟的 AI 产品。当然对于前端开发者而言，IDE 是我们日常最直接接触的工具之一,去年我主要使用 Github Copilot 进行辅助开发，而今年则改为使用更强大的智能 IDE 进行编码：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ac2edbdaa03849d68cd64ed0f7746fa5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2Q5byI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769962754&amp;x-signature=YzHWlhQWods0A9PUwpgpMYA%2Fwas%3D" alt="HEIF图像 5.heic" loading="lazy"/></p>
<p>当然随着 AI 的快速发展，智能编码也将进入更加智能的阶段：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/52a73b4705474983b9e5bf6aa65343fb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2Q5byI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769962754&amp;x-signature=P%2BlSJT6mrvbhgx%2FufnZNcSt8L%2BA%3D" alt="1976183c09fb7d14cd223387225c8739.png" loading="lazy"/></p>
<p>目前市面上的智能 IDE 还无法理解各自领域的专业知识，一些隐形的经验或者历史的技术方案也无法为 AI 所复用，除此之外，IDE 也只能聚焦于当前工程项目的智能代码生成，未来的开发模式还会在 Vibe Coding 的基础上进行衍生，走向更加强大的开发范式，例如 SDD：
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9d6dcf2171aa44b98f0e02ac858b0d21~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2Q5byI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769962754&amp;x-signature=php%2FaocfB2oH2fw1jz9FsSo8adQ%3D" alt="6a524f9594b98a1041dff51f3da78a1b.png" loading="lazy"/></p>
<p>当然我理解的 SDD 只是一种开发范式，其核心是构建复杂的领域知识体系，并且其难点是如何让内部的一些深度领域知识可以精准的被索引，从而基于实际需求精准智能的生成代码。这些领域知识包括跨工程的知识体系、业务的术语表、<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fvitali87%2Fcode-graph-rag" target="_blank" title="https://github.com/vitali87/code-graph-rag" ref="nofollow noopener noreferrer">Codebase Knowledge Graph RAG</a>（代码的关联关系）以及历史经验的复用等，例如 Qoder 的 <a href="https://link.juejin.cn?target=https%3A%2F%2Fqoder.com%2Fblog%2Fquest-refactored" target="_blank" title="https://qoder.com/blog/quest-refactored" ref="nofollow noopener noreferrer">Quest 模式</a>。</p>
<p>除了使用市面上存在的一些 AI 产品，更重要的是了解这些 AI 产品的实现原理或者自己尝试去实践一些 AI 技术。去年我深入学习了 <a href="https://juejin.cn/book/7258893482318626868/section/7459701558843097125" target="_blank" title="https://juejin.cn/book/7258893482318626868/section/7459701558843097125">Github Copilot 的实现原理</a>，对智能代码补全背后的机制有了深刻认知：</p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/bf1ef2b3930c4220b693b3cb001b1b8b~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=663&amp;h=703&amp;s=92947&amp;e=png&amp;a=1&amp;b=f9f9f9" alt="image.png" loading="lazy"/></p>
<p>今年则进一步研究了 OpenManus 的设计思路，持续追踪并借鉴社区中的优秀 AI 开源项目。同时，也尝试使用 Python 系统性设计并实现了一个基于 <a href="https://link.juejin.cn?target=https%3A%2F%2Fplatform.openai.com%2Fdocs%2Fguides%2Ffunction-calling" target="_blank" title="https://platform.openai.com/docs/guides/function-calling" ref="nofollow noopener noreferrer">Function Calling</a> 与 <a href="https://link.juejin.cn?target=https%3A%2F%2Fmodelcontextprotocol.io%2Fdocs%2Fgetting-started%2Fintro" target="_blank" title="https://modelcontextprotocol.io/docs/getting-started/intro" ref="nofollow noopener noreferrer">Mcp</a> 协议、采用 <a href="https://link.juejin.cn?target=https%3A%2F%2Freact-lm.github.io%2F" target="_blank" title="https://react-lm.github.io/" ref="nofollow noopener noreferrer">ReAct</a> 架构的 Agent，从而更直观地理解了基于 Agent 智能调度工具的流程与设计逻辑。</p>
<p>此外，我也系统学习了 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.langchain.com%2F" target="_blank" title="https://www.langchain.com/" ref="nofollow noopener noreferrer">Langchain</a> 框架，并基于该框架结合 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmicrosoft%2Fplaywright-mcp" target="_blank" title="https://github.com/microsoft/playwright-mcp" ref="nofollow noopener noreferrer">Playwright Mcp</a>，设计并实现了一款面向前端研发的提效 Agent。虽然这些尝试都还处于初期阶段，但在过程中我收获了大量关于 AI 应用落地的细节认知。</p>
<h3 data-id="heading-2">OpenManus 原理学习</h3>
<p>OpenManus 的学习过程可以用两个 XMind 思维导图来建立：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bbd6183c8c244e91a31380587e62edc8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2Q5byI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769962754&amp;x-signature=DAMc%2Fqegz6lsIleS6RiBHO7J6p8%3D" alt="6e51879a0d2e689ef48cc53a1ab4865a.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3f24478fc8c44c6fb457ef8f2272eb59~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2Q5byI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769962754&amp;x-signature=jMnn26w1QF%2BF3o%2BvW%2BgRAytvTiA%3D" alt="eb6260db75efa52033b4cb8aa8b4c9b1.png" loading="lazy"/></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FFoundationAgents%2FOpenManus%2Fblob%2Fmain%2FREADME_zh.md" target="_blank" title="https://github.com/FoundationAgents/OpenManus/blob/main/README_zh.md" ref="nofollow noopener noreferrer">OpenManus</a> 是一个开源的 Manus（智能体 / <a href="https://link.juejin.cn?target=https%3A%2F%2Flilianweng.github.io%2Fposts%2F2023-06-23-agent%2F" target="_blank" title="https://lilianweng.github.io/posts/2023-06-23-agent/" ref="nofollow noopener noreferrer">Agent</a>）Python 项目，使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Freact-lm.github.io%2F" target="_blank" title="https://react-lm.github.io/" ref="nofollow noopener noreferrer">ReAct</a> 框架设计 Agent 并可以智能调度内部封装的开发者工具，这些工具包括：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/80f8fd215e37433cb71af49406eea27f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2Q5byI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769962754&amp;x-signature=Y7qkYl%2FfZCH186dokiJlCpp9JzM%3D" alt="image.png" loading="lazy"/></p>
<p>利用内部实现的 ReAct 框架，OpenManus Step by Step 智能决策并使用如下工具来实现用户指令，例如：</p>
<pre><code class="hljs language-bash" lang="bash">使用 Google 搜索“钉钉开放平台的前端 JS API 调用示例”，帮我设计一个 HTML，能够引入 JS API 的 CDN 资源，并编写调用示例。
</code></pre>
<p>OpenManus 会像人一样思考和操作，它首先利用 Google 搜索引擎工具搜索最相关的 10 个网址，然后利用浏览器（<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fbrowser-use%2Fbrowser-use" target="_blank" title="https://github.com/browser-use/browser-use" ref="nofollow noopener noreferrer">Browser Use</a>）工具逐一打开网址查看是否存在前端 JS API 示例相关的内容，如果第一个网址不存在，则会继续浏览第二个搜索到的网址，直到找到相关的内容并进行提取，最后利用文件系统工具生成代码文件。</p>
<p>OpenManus 是一个学习 Agent 知识非常好的开源项目，它的整体框架如下所示：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/257bc13c517f4e20bfa1e8777b7015ed~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2Q5byI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769962754&amp;x-signature=mVyho%2FIKSjlBAEKHa6qLxF9N0qk%3D" alt="2419b064f8ca05eae7a7bc844d0fdab7.png" loading="lazy"/></p>
<p>ReAct 总体执行流程如下所示：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5f3c4818c7c04eed945c7ea0c4e751e5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2Q5byI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769962754&amp;x-signature=6Kw%2FeIICQ5QvOTZ45IRU%2BT9frZQ%3D" alt="2025-流程图.jpg" loading="lazy"/></p>
<p><code>think</code> 执行流程：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/19623e9c873d4823ac92edce60704ffc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2Q5byI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769962754&amp;x-signature=%2B5qSDlxbf2nsZo4azPWuQWLF1Ks%3D" alt="2025-流程图 (1).jpg" loading="lazy"/></p>
<p><code>act</code>执行流程：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3b0fbba975b44366a0de5e90a7cb89b3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2Q5byI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769962754&amp;x-signature=1ZPeSOj3I2LbDi2qBbSjylE7Y3Y%3D" alt="2025-流程图 (2).jpg" loading="lazy"/></p>
<p>Browser Use 执行流程：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dbfe6ab1004742cab0c005d60ab502d0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2Q5byI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769962754&amp;x-signature=yJMhuC%2Bs2h4ipNdYEApDSM8Wx6Y%3D" alt="2025-流程图 (3).jpg" loading="lazy"/></p>
<p>除此之外，OpenManus 也实现了基于 MCP 协议的工具调用方式，并且实现了 Muti-Agent &amp; 任务规划模式，在原来的基础上进行了框架升级，如下所示：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5924a41f39074d5aa73878fa4f330d4f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2Q5byI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769962754&amp;x-signature=pkPferxe5ttDjk2jN46qZZnqpdg%3D" alt="94ad33b118fd6a1007c9f0821909bf42.png" loading="lazy"/></p>
<blockquote>
<p>温馨提示：大家可以思考一下使用这种设计模式可能会存在什么问题？</p>
</blockquote>
<p>在 Muti-Agent 模式下能够对用户输入的指令进行 Plan 规划拆解，然后每一个 Step 会寻找合适的 Agent 进行执行，如下所示：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e175ab3ee5294f7793c360d490c445b1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2Q5byI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769962754&amp;x-signature=Wd%2BcJPxRly%2B88Pp0cjW7x%2B%2BsX9k%3D" alt="image.png" loading="lazy"/></p>
<p>最终我们可以了解一下 OpenManus 的大致执行流程：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/61b19849463840ceba2065b6d64e3f9e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2Q5byI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769962754&amp;x-signature=K56snFQSPCKdVRy0SgSQiGjXvrg%3D" alt="2025 (1).png" loading="lazy"/></p>
<blockquote>
<p>温馨提示：如果 Agent 和 Agent 之间需要通信，也可以使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fgoogle%2FA2A" target="_blank" title="https://github.com/google/A2A" ref="nofollow noopener noreferrer">A2A 标准协议</a>。</p>
</blockquote>
<p>Muti-Agent 模式的总体执行流程：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e9ab4eccd54247adb28a062e0f28ee04~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2Q5byI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769962754&amp;x-signature=Hdku%2BsnyTX9tqL07mO1TeKzvoIk%3D" alt="2025-流程图 (4).jpg" loading="lazy"/></p>
<p>创建流程实例 <code>flow</code> 执行调用了<code>FlowFactory.create_flow</code>，主要用于绑定相应的 Agents 集合：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/44ef9fc1db6d496a800ddd930435bb1a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2Q5byI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769962754&amp;x-signature=NOl0NT1GxRU6z9kHM609eLHyPYY%3D" alt="2025-流程图 (5).jpg" loading="lazy"/></p>
<p>AI 智能请求：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ddec153c58b74f17a685bcc4f2413a37~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2Q5byI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769962754&amp;x-signature=BcJKr9S06a8ExUj%2Ftb%2F9b8SMk8k%3D" alt="2025-流程图 (6).jpg" loading="lazy"/></p>
<p>调用 PlanningTool 生成计划文本，信息如下：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9635cfb9860f4c3094dd644d37dc5b43~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2Q5byI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769962754&amp;x-signature=l3ZvspVKpTGoqrn9S14ZnvCM3kQ%3D" alt="da063dc5ed5e6863bbf6e0e3ab647ce8.png" loading="lazy"/></p>
<p>根据任务步骤调用相应的 Agent 执行 Step：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cef94bf88c4d4a1b83158237f4768257~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2Q5byI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769962754&amp;x-signature=aQexauftcBcRISJRrnaqmPKl8gc%3D" alt="2025-流程图 (7).jpg" loading="lazy"/></p>
<p>ReAct 总体执行流程：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1e0872ea9a954ccc9f0b835ff7c5462e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2Q5byI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769962754&amp;x-signature=sNnHnhLmqIq4t%2BHNReUPul78BIQ%3D" alt="2025-流程图 (8).jpg" loading="lazy"/></p>
<p><code>think</code> 执行流程：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a020d2e72cec461395b03a3f6b9148f6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2Q5byI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769962754&amp;x-signature=SpqTHTfc7NmKyxrRvG71IxyRFe0%3D" alt="2025-流程图 (9).jpg" loading="lazy"/></p>
<p><code>act</code>执行流程：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c5531d93f4ff4c539284a84dc58f7dd0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2Q5byI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769962754&amp;x-signature=Q7LPLtJCuzBWlIGlSIfxY1XvzAw%3D" alt="2025-流程图 (10).jpg" loading="lazy"/></p>
<p>Browser Use 执行流程：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c89267705ae94936916fc07b051652cd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2Q5byI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769962754&amp;x-signature=BkfdH2v7cUu6OAcJutH1QhYSmoI%3D" alt="2025-流程图 (11).jpg" loading="lazy"/></p>
<p>真正在学习的过程中可以了解更多的细节问题，例如：</p>
<ul>
<li>Agent 到底有哪些组成部分？这些组成部分各自有什么功能？</li>
<li>工具的调度方式有哪些？什么是 Funcion Calling？ 它有什么优点？</li>
<li>Function Calling 执行后的对话信息需要包含哪些内容，如何描述工具的执行过程和执行结果并使得 LLM 可以更好的决策下一个执行任务？</li>
<li>没有 Function Calling 之前或者某些模型不支持 Function Calling 时该如何实现工具的智能决策调用？</li>
<li>ReAct 和 CoT 的区别是什么？CoT 相比 ReAct 有什么缺点？ReAct 有哪些优缺点？ReAct 在解决哪些问题时准确性较高？</li>
<li>什么是 ﻿<a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2303.11366" target="_blank" title="https://arxiv.org/abs/2303.11366" ref="nofollow noopener noreferrer">Reflexion 框架</a>，相比 ReAct 它的优点是什么？</li>
<li>ReAct 架构如何防止任务死循环或者卡死（幻觉）？它的优缺点是什么？</li>
<li>我们如何判断 ReAct 规划的策略是否越来越低效（例如规划步骤花费时间过多并且没有成功的迹象以及在环境中遇到一系列连续相同的动作并产生了相同的结果等）？</li>
<li>什么是记忆，什么是短期记忆，什么是长期记忆？记忆超过 LLM 上下文 token 限制该如何处理？</li>
<li>在 OpenMansu 中如何管理对话状态（上下文工程信息），对话状态中会包含哪些信息类型？</li>
<li>简单描述一下基于 Mcp 协议的工具调用执行流程？是否手动实现过该执行流程？</li>
<li>业界有哪些基于任务规划的 Agent 产品（例如 <a href="https://link.juejin.cn?target=https%3A%2F%2Fsame.new%2F" target="_blank" title="https://same.new/" ref="nofollow noopener noreferrer">Same</a>）？</li>
<li>Muti-Agent 适用的场景有哪些？任务规划适合在什么场景下使用？</li>
<li>社区有哪些开源的 Muti-Agent 框架？</li>
<li>Muti-Agent 的优缺点是什么？</li>
<li>OpenManus 是如何设计 Flow 任务规划的 System Prompt、Planning Tools Params Prompt？如何设计 Manus Agent 的 System Prompt、User Input Prompt、Next Step Prompt、Tools Params Prompt、Assistant Prompt、Tools Observed Prompt、Page Prompt（从页面提取用户输入相关的内容）等，整个上下文工程是其内部的精髓！</li>
</ul>
<h3 data-id="heading-3">Langchain 框架学习</h3>
<p>Langchain 的学习过程可以用两个 XMind 思维导图来建立：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f399964f8d3e4ba98b1e064eb304e23d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2Q5byI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769962754&amp;x-signature=%2F1LCP1JhhXyXSELTuFjnpwuL5LQ%3D" alt="444ee29ea348d153912df12affd2384f.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fb4c596252f641308b27e0e1f46725d5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2Q5byI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769962754&amp;x-signature=oGeOZAxFBYFl0361ITIwslshuic%3D" alt="02fb68ad6fdf9ec1fcfa1dcc4bb85c22.png" loading="lazy"/></p>
<p>主要学习了<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.langchain.com%2F" target="_blank" title="https://www.langchain.com/" ref="nofollow noopener noreferrer">Langchain</a> 框架的功能（不包含 LangGraph），也体会到了 Langchain 的强大之处，包括：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4d5766561af74f078137849fec4a0162~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2Q5byI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769962754&amp;x-signature=MD905STA%2BoWTWELy0jGEwriU%2F%2BY%3D" alt="HEIF图像 6.heic" loading="lazy"/></p>
<p>目前正在尝试使用 Langchain 来设计前端产研提效的 Agent 工具，能够支持应用的全链路开发模式。在学习和使用 Langchain 框架的同时也能系统地了解和 Agent 相关的功能设计，当然真正在实践的过程中还是会遇到各种问题，例如：</p>
<ul>
<li>如何整理相应的知识文档，需要包含哪些应用研发信息，如何确保这些信息的 RAG 索引的准确性？</li>
<li>知识文档如何承载，如何实时更新索引信息？</li>
<li>RAG 的实现流程可以分为哪几个步骤？</li>
<li>为什么需要对文档进行切割？文档切割的策略有哪些（<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FFullStackRetrieval-com%2FRetrievalTutorials%2Fblob%2Fmain%2Ftutorials%2FLevelsOfTextSplitting%2F5_Levels_Of_Text_Splitting.ipynb" target="_blank" title="https://github.com/FullStackRetrieval-com/RetrievalTutorials/blob/main/tutorials/LevelsOfTextSplitting/5_Levels_Of_Text_Splitting.ipynb" ref="nofollow noopener noreferrer">Levels Of Text Splitting</a>）？</li>
<li>如何保证检索的连贯性？如何进行国际化检索？RAG 的检索策略有哪些？</li>
<li>嵌入模型如何选择，需要考虑哪些衡量指标？向量数据库有哪些，是否有类似的 GUI 工具？</li>
<li>Agent 设计中常用的 RAG 检索方案是什么？2-Step RAG 和 Agentic RAG 有什么优缺点？</li>
<li>如何评估 RAG 的准确性，有什么评估标准？</li>
<li>如何解决过多 Mcp 服务的连接压力和性能问题（本质是不要让每个 AI Agent / 会话与 N 个 MCP Server 全量长连接，应改成“按需路由 + 连接池 / 复用 + 分层聚合 + 隔离与限流”的架构，把连接数、握手成本、心跳与上下文维持成本从 N×1000 降到“实际用到的少数几个”）？</li>
<li>有哪些压缩记忆的方法方式，各自又有什么优缺点？压缩记忆后如何避免记忆失真？</li>
<li>如何抉择 ReAct 和 Flow 执行流程？</li>
<li>在 ReAct 中如何抉择并行调用多个工具还是单个工具串行调用？</li>
<li>如何处理多步工具调用（multi-step tool calling） 中常见的 "幻觉性规划"（hallucinated planning） 问题？</li>
<li>Mutil-Agent 模式有什么优点？ Tool calling 模式和 Handoffs 模式如何抉择？</li>
<li>什么情况下需要设计 Mutil-Agent 模式？</li>
<li>在 Langchain 中应该如何抉择使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.langchain.com%2Foss%2Fpython%2Fintegrations%2Ftools%2Fplaywright" target="_blank" title="https://docs.langchain.com/oss/python/integrations/tools/playwright" ref="nofollow noopener noreferrer">PlayWright Browser Toolkit</a>、<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fbrowser-use%2Fbrowser-use" target="_blank" title="https://github.com/browser-use/browser-use" ref="nofollow noopener noreferrer">Browser Use</a>、<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmicrosoft%2Fplaywright-mcp" target="_blank" title="https://github.com/microsoft/playwright-mcp" ref="nofollow noopener noreferrer">playwright-mcp</a> 和 <a href="https://link.juejin.cn?target=https%3A%2F%2Fplaywright.dev%2Fpython%2Fdocs%2Fapi%2Fclass-playwright" target="_blank" title="https://playwright.dev/python/docs/api/class-playwright" ref="nofollow noopener noreferrer">playwright</a>？它们各自有什么优缺点？</li>
<li>Playwright 自定义工具封装和 Playwright Mcp 如何抉择（一个可控且消耗 Token 小，一个不可控但功能更灵活）？</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fplaywright.dev%2Fpython%2Fdocs%2Fapi%2Fclass-playwright" target="_blank" title="https://playwright.dev/python/docs/api/class-playwright" ref="nofollow noopener noreferrer">Playwright</a> 如何解决浏览器免登的问题？</li>
<li>在设计 Agent 的过程中有哪些可观测的工具可以追溯 Agent 内部的 ReAct 执行过程？</li>
</ul>
<h3 data-id="heading-4">React 原理学习</h3>
<p>虽然对于 Vue 2.x、Svelte 等框架的原理相对比较清晰，但是对于 React 一直没有深入进行原理了解，尽管学习这些原理可能不如学习 AI 来得实在，从某些程度来讲也稍微有些过时，不过出于好奇心，并且为了速成，参考了<a href="https://link.juejin.cn?target=https%3A%2F%2F7km.top%2F" target="_blank" title="https://7km.top/" ref="nofollow noopener noreferrer">图解 React 原理</a>快速学习了一把，如下所示：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3b980906fc694f62abc3df384c374321~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2Q5byI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769962754&amp;x-signature=Ljih4umQmvySFbOPF6vPc108XiE%3D" alt="e35f69904594fa4fc36eff23b757bbec.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d6aac08fed7a4712af81403bfb1a1a19~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2Q5byI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769962754&amp;x-signature=ny1gYtW4ZzZw%2FbdEc9XIUXJx9G8%3D" alt="9a6ec61739bc6bfd84f971e1b29585ed.png" loading="lazy"/></p>
<p>学习了以后也会产生很多相关的问题，例如：</p>
<ul>
<li>React 的启动模式有哪些？什么是 Concurrent 模式？这些模式有什么区别？</li>
<li>在 Reconciler 运作流程中同步渲染和并发渲染的区别是什么？</li>
<li>React 在哪些情况下会让出代码的执行权（可中断与恢复机制），从而用于提升用户体验？</li>
<li>React 的时间切片为什么是 5ms？</li>
<li>简述 React 的任务调度过程？</li>
<li>React 调度分片工具使用的是什么异步 API ? 为什么不是 rIC、rAF、setTimeout？为什么不使用微任务？</li>
<li>如果 Fiber 树的构造过程非常耗时，如何处理构造的中断和恢复？</li>
<li>简述一下 Fiber 树构造中使用的双缓冲技术？它有什么优点（并发模式、可中断、回退策略）？</li>
<li><code>setState</code> 在什么情况下分别进行同步和异步执行？</li>
<li>在注册调度任务时对于同时连续多次 <code>setState</code>是如何处理的？调度中心是如何处理节流优化的？</li>
<li>为什么 Fiber 是树 + 链表的结构？</li>
<li>渲染阶段和提交阶段都是可中断的吗？</li>
<li>什么是副作用链表？它为什么是链表结构（对于可中断与恢复机制的支持）？</li>
<li>在 Fiber 树构造时如何对副作用链表（例如周期函数、<code>useEffect</code>、<code>useLayoutEffect</code>）进行处理？</li>
<li>从 Fiber 树角度出发讲述父子节点的副作用执行顺序以及如何避免 DOM 的重排？</li>
<li>Fiber 树的渲染可以分为哪几个阶段？<code>useEffect</code> 在 Fiber 树渲染的哪个阶段执行？它是异步执行吗？</li>
<li>React Hooks 和<code>useEffect</code> 是在宏任务中执行还是微任务中执行？它是通过调度任务执行的吗？从原理角度出发讲解它为什么能够模拟 <code>componentDidMount</code> 周期函数？</li>
<li>在初次 Fiber 树渲染中<code>componentDidMount</code>周期函数和 <code>useEffect</code> 副作用的执行时机谁更早？</li>
<li><code>useLayoutEffect</code> 和 <code>componentDidMount</code>、<code>componentDidUpdate</code> 执行时机相等吗？</li>
<li>为什么在 React 中要引入 Hook ？它的动机是什么？</li>
<li>在双缓冲机制中如何复用副作用链表？</li>
<li><code>useReducer</code> 会进行任务调度执行吗？同时连续的多次 <code>dispatch</code> 会进行节流优化吗？</li>
<li><code>useLayoutEffect</code>是同步执行的吗？为什么会阻塞浏览器的绘制？</li>
<li>为什么在 <code>useLayoutEffect</code> 中可以直接拿到 DOM 的尺寸（即在浏览器绘制之前）？</li>
<li>React 是如何判断 Hook 副作用函数的依赖项变化的？</li>
</ul>
<h2 data-id="heading-5">金融</h2>
<p>2025 年开始从 0 到 1 学习理财知识，想要做好理财首先需要学习相关的基础知识，今年学习到的基础知识如下所示：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1b0ebe830fd040008f81b58c4e932613~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2Q5byI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769962754&amp;x-signature=t6FO8DdYPSvHcfhY1FoIPSNYyGo%3D" alt="HEIF图像 7.heic" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5773111ce87242db80621e9bdd045d1e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2Q5byI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769962754&amp;x-signature=hdO5LlcDqw88vJUxcMSu0AVHSwg%3D" alt="image.png" loading="lazy"/></p>
<p>当然在学习的过程中也需要阅读大量的金融书籍，借鉴伟人的经验和一些历史金融大事件经验，包括：
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/77143d0eb59b4b629e0a51a8a4ff3fa2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2Q5byI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769962754&amp;x-signature=fduA6r8FuBGrKbS1adSxs8mJeyc%3D" alt="image.png" loading="lazy"/></p>
<p>自从开始理财后，发现自己会关注国家政策的变化、世界的政治大事件、当日股市波动的利空利好信息等，也会关注一些金融博主的短视频信息。目前作为理财小白觉得自己最重要的几个实操学习点如下：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/afc9920629ae41218a02748961c80613~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2Q5byI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769962754&amp;x-signature=TSkXpQZoQJZxhISQtSvSKQXxmio%3D" alt="HEIF图像 8.heic" loading="lazy"/></p>
<h2 data-id="heading-6">运动</h2>
<p>学习固然重要，但是保持好健康的身体才能有更加持续的学习动力，2025 的整体运动情况如下所示：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0764fd28bc4f426aa70d9ddb6379d7d1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2Q5byI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769962754&amp;x-signature=1S0ltsvKbsywRyQU47vK4OUerC4%3D" alt="HEIF图像 10.heic" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[拥抱PostgreSQL支持UI配置化]]></title>    <link>https://juejin.cn/post/7598710324167688207</link>    <guid>https://juejin.cn/post/7598710324167688207</guid>    <pubDate>2026-01-25T16:19:43.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598710324167688207" data-draft-id="7598588085597880360" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="拥抱PostgreSQL支持UI配置化"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-25T16:19:43.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="神奇的程序员"/> <meta itemprop="url" content="https://juejin.cn/user/3984285870859614"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            拥抱PostgreSQL支持UI配置化
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3984285870859614/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    神奇的程序员
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-25T16:19:43.000Z" title="Sun Jan 25 2026 16:19:43 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>前阵子写的日志分析工具<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.kaisir.cn%2Fpost%2F186" target="_blank" title="https://www.kaisir.cn/post/186" ref="nofollow noopener noreferrer">NginxPulse</a>，自开源以来，已过去2周时间，目前GitHub已收获1.5k的star。收到了不少用户的反馈建议，花了点时间将这些问题都处理了下。</p>
<p>本文就跟大家分享下新版本都解决了哪些问题，优化了哪些内容，欢迎各位感兴趣的开发者阅读本文。</p>
<h2 data-id="heading-1">抛弃SQLite</h2>
<p>有不少用户反馈说日志文件很大的时候（10G+），解析速度非常慢，需要解析好几个小时，解析完成之后数据看板的查询也比较慢（接口响应在5秒左右）。</p>
<p>于是，我重写了日志解析策略（解析阶段不做IP归属地查询，仅入库其他数据，将日志中IP记录起来），日志解析完毕后，将记录的IP做去重处理，随后去做归属地的查询处理（优先本地的ip2region库，远程的API调用查询做兜底），最后将解析到的归属地回填至对应的数据库表中，这样一套下来就可以大大提升日志的解析速度。</p>
<p>数据库的数据量大了之后，SQLite的表现就有点差强人意了，请教了一些后端朋友，他们给了我一些方案，结合我自身的实际场景后，最后选定了PostgreSQL作为新的数据库选型。</p>
<p>这套方案落地后，用户群的好兄弟说：他原先需要解析1个小时的日志，新版只需要10多分钟。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cd6e86840d434ca5ae4800b854768f90~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We5aWH55qE56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769962783&amp;x-signature=fN793q6uWZX%2FRyv5KfqOxH%2Ba%2FIo%3D" alt="6c1c8781ddb810d57c9f508fdaf47025" loading="lazy"/></p>
<h2 data-id="heading-2">UI配置可视化使用</h2>
<p>有一部分用户反馈说他非专业人士，这些晦涩的配置对他来说使用门槛太高了，希望能有一个UI配置页面，他只需要点一点、敲敲键盘，就能完成这些配置。</p>
<p>我将整个配置流程做成了4步，同时也准备一个<a href="https://link.juejin.cn?target=NginxPulse%25E6%2594%25AF%25E6%258C%2581UI%25E9%2585%258D%25E7%25BD%25AE%25E5%258C%2596%25E4%25BA%2586" target="_blank" title="NginxPulse%E6%94%AF%E6%8C%81UI%E9%85%8D%E7%BD%AE%E5%8C%96%E4%BA%86" ref="nofollow noopener noreferrer">演示视频</a> -  <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.bilibili.com%2Fvideo%2FBV1hqzyBVEU9%25EF%25BC%259A" target="_blank" title="https://www.bilibili.com/video/BV1hqzyBVEU9%EF%BC%9A" ref="nofollow noopener noreferrer">www.bilibili.com/video/BV1hq…</a></p>
<ul>
<li>配置站点</li>
<li>配置数据库</li>
<li>配置运行参数</li>
<li>确认最终配置</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/174544088dce4a47bc520d2783ec71fa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We5aWH55qE56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769962783&amp;x-signature=FojkkkVuohYcOeMkuqYfkZOAAsE%3D" alt="image-20260125235847464" loading="lazy"/></p>
<h2 data-id="heading-3">新增wiki文档</h2>
<p>因为配置过于庞大，仓库主页浏览README.md比较费劲，希望能整理一份wiki文档发上去。</p>
<p>花了点时间，简化了下README，整理了一份：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Flikaia%2Fnginxpulse%2Fwiki" target="_blank" title="https://github.com/likaia/nginxpulse/wiki" ref="nofollow noopener noreferrer">github.com/likaia/ngin…</a></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f145009761c2444a8c9f55673e23399c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We5aWH55qE56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769962783&amp;x-signature=Eb7RYmkMr9%2F3LdugfIex57PyrJQ%3D" alt="image-20260126000555725" loading="lazy"/></p>
<h2 data-id="heading-4">访问明细模块优化</h2>
<p>有部分用户反馈说希望增加更多的筛选条件以及导出Excel功能，现在它来了：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1aec7d5d5ced41cbb9f28cf3b6381253~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We5aWH55qE56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769962783&amp;x-signature=%2FEtlJdb6wD01j%2B9TvLIf2kgbS5g%3D" alt="image-20260126001010068" loading="lazy"/></p>
<h2 data-id="heading-5">概况模块优化</h2>
<p>概况页面的日期筛选之前放在趋势分析卡片的上方，但是他的切换影响的维度还包含了指标，于是我就调整了下它的位置，新版如下图所示：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/62f71695dc874885b9f383302ba6517e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We5aWH55qE56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769962783&amp;x-signature=V6XnZtWYynd5GF5P9fUSMU6%2FGpA%3D" alt="image-20260126001325265" loading="lazy"/></p>
<h2 data-id="heading-6">项目地址</h2>
<ul>
<li>GitHub地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Flikaia%2Fnginxpulse" target="_blank" title="https://github.com/likaia/nginxpulse" ref="nofollow noopener noreferrer">github.com/likaia/ngin…</a></li>
<li>dockerhub地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fhub.docker.com%2Fr%2Fmagiccoders%2Fnginxpulse%2F" target="_blank" title="https://hub.docker.com/r/magiccoders/nginxpulse/" ref="nofollow noopener noreferrer">hub.docker.com/r/magiccode…</a></li>
</ul>
<h2 data-id="heading-7">写在最后</h2>
<p>至此，文章就分享完毕了。</p>
<p>我是<strong>神奇的程序员</strong>，一位前端开发工程师。</p>
<p>如果你对我感兴趣，请移步我的<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.kaisir.cn%2F" target="_blank" title="https://www.kaisir.cn/" ref="nofollow noopener noreferrer">个人网站</a>，进一步了解。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[PicGo:为高效创作者而生的终极图片上传工具]]></title>    <link>https://juejin.cn/post/7598767580306243638</link>    <guid>https://juejin.cn/post/7598767580306243638</guid>    <pubDate>2026-01-25T15:04:33.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598767580306243638" data-draft-id="7598737609494675475" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="PicGo:为高效创作者而生的终极图片上传工具"/> <meta itemprop="keywords" content="开源"/> <meta itemprop="datePublished" content="2026-01-25T15:04:33.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="修己xj"/> <meta itemprop="url" content="https://juejin.cn/user/2641475936724142"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            PicGo:为高效创作者而生的终极图片上传工具
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2641475936724142/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    修己xj
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-25T15:04:33.000Z" title="Sun Jan 25 2026 15:04:33 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在内容创作的世界里，图片处理常常是打断创作流程的“绊脚石”。写博客、做笔记、编写技术文档时，如何快速、优雅地上传并引用图片？今天我要向大家推荐一款堪称“神器”的开源工具——PicGo。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1d924c99857941b6a08098b6b74d1912~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769958272&amp;x-signature=w0%2FIRtk8IW1fNuag2xaVbkNoe3M%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-0">❓PicGo是什么？</h2>
<p>PicGo是一款跨平台的桌面应用，致力于<strong>将图片上传无缝集成到你的创作工作流中</strong>。无论你是Markdown爱好者、技术博主，还是日常需要处理图片的创作者，PicGo都能让你彻底告别繁琐的上传步骤。</p>
<p>github地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FMolunerfinn%2FPicGo" target="_blank" title="https://github.com/Molunerfinn/PicGo" ref="nofollow noopener noreferrer">github.com/Molunerfinn…</a></p>
<p>官网地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fpicgo.app%2F" target="_blank" title="https://picgo.app/" ref="nofollow noopener noreferrer">picgo.app/</a></p>
<p>文档地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.picgo.app%2Fzh%2F" target="_blank" title="https://docs.picgo.app/zh/" ref="nofollow noopener noreferrer">docs.picgo.app/zh/</a></p>
<p>该项目目前在github已有26.2k ⭐️ star</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3232e42e9afa4459806cf931602c3888~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769958272&amp;x-signature=WvtfnFnVhv4ijT3cPe54Uau1MpQ%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-1">✔️为什么你需要PicGo？</h2>
<p>想象一下这个场景：你在写一篇技术博客，需要插入多张截图。传统流程是：</p>
<ol>
<li>截图保存</li>
<li>打开浏览器</li>
<li>登录图床</li>
<li>上传图片</li>
<li>复制链接</li>
<li>回到编辑器粘贴</li>
</ol>
<p><strong>PicGo将这个六步流程简化为一键操作</strong>。</p>
<h2 data-id="heading-2">🎯核心功能亮点</h2>
<h3 data-id="heading-3">📸 多维度上传方式</h3>
<ul>
<li><strong>拖拽上传</strong>：把图片直接拖到PicGo窗口</li>
<li><strong>剪贴板粘贴</strong>：截图后直接粘贴到PicGo</li>
<li><strong>快捷键上传</strong>：默认<code>Cmd/Ctrl+Shift+P</code>快速唤起</li>
<li><strong>右键菜单上传</strong>：在macOS/Windows上右键图片即可上传</li>
</ul>
<h3 data-id="heading-4">🔗 智能链接处理</h3>
<p>上传成功后，PicGo会自动将链接复制到剪贴板，并支持多种格式：</p>
<ul>
<li>Markdown格式：<code>![图片描述](链接)</code></li>
<li>HTML格式：<code>&lt;img src="链接" alt="描述"&gt;</code></li>
<li>原始URL</li>
<li>自定义模板</li>
</ul>
<h3 data-id="heading-5">☁️ 广泛的图床支持</h3>
<p>PicGo原生支持主流图床平台：</p>
<ul>
<li><strong>国内云服务</strong>：七牛云、腾讯云COS、又拍云、阿里云OSS</li>
<li><strong>国际平台</strong>：GitHub、SM.MS、Imgur</li>
<li><strong>无限扩展</strong>：通过插件支持AWS S3、Cloudflare R2、MinIO、chevereto等</li>
</ul>
<h3 data-id="heading-6">🔌 强大的插件生态</h3>
<p>PicGo拥有丰富的插件系统，你可以在<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FPicGo%2FAwesome-PicGo" target="_blank" title="https://github.com/PicGo/Awesome-PicGo" ref="nofollow noopener noreferrer">Awesome-PicGo</a>中找到：</p>
<ul>
<li>图片压缩插件</li>
<li>水印添加插件</li>
<li>文件名重命名插件</li>
<li>Markdown图片迁移工具</li>
<li>更多第三方图床支持</li>
</ul>
<h3 data-id="heading-7">💻 开发者友好特性</h3>
<p>对于技术用户，PicGo提供了更多高级功能：</p>
<ul>
<li><strong>HTTP API支持</strong>：v2.2.0+版本可通过HTTP请求调用上传</li>
<li><strong>命令行接口</strong>：完美集成到Shell脚本和CI/CD流程</li>
</ul>

<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 一行命令上传图片</span>
npx picgo upload /path/to/image.png
</code></pre>
<ul>
<li><strong>Node.js SDK</strong>：轻松集成到你的应用中</li>
</ul>

<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> { <span class="hljs-title class_">PicGo</span> } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'picgo'</span>)
<span class="hljs-keyword">const</span> picgo = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PicGo</span>()
picgo.<span class="hljs-title function_">upload</span>([<span class="hljs-string">'/path/to/image.png'</span>])
</code></pre>
<h2 data-id="heading-8">🚀无缝集成你的工作流</h2>
<p>PicGo最大的优势在于“隐形”——它能在你几乎察觉不到的情况下工作：</p>
<h3 data-id="heading-9">✍️编辑器集成</h3>
<p>通过原生支持或社区插件，PicGo可以与几乎所有主流编辑器无缝协作：</p>
<ul>
<li><strong>Obsidian</strong>：知识管理神器</li>
<li><strong>VS Code</strong>：程序员的最爱</li>
<li><strong>Typora</strong>：优雅的Markdown编辑器</li>
<li><strong>Neovim</strong>：终端编辑器王者</li>
<li><strong>MarkText</strong>：开源Markdown编辑器</li>
<li><strong>思源笔记</strong>：新一代知识管理系统</li>
<li><strong>Yank Note</strong>：可扩展的Markdown编辑器</li>
</ul>
<h3 data-id="heading-10">🔄零上下文切换</h3>
<p>你不需要离开当前的编辑器窗口。只需截图、粘贴（或拖拽），PicGo在后台默默完成上传，并将格式化好的链接复制到剪贴板，你只需要粘贴即可。</p>
<h2 data-id="heading-11">📦安装与使用</h2>
<h3 data-id="heading-12">📥多种安装方式</h3>
<p>PicGo提供了丰富的安装渠道，确保无论你在哪个平台都能轻松获取：</p>





























<table><thead><tr><th>平台</th><th>安装方式</th></tr></thead><tbody><tr><td>Windows</td><td>Scoop: <code>scoop install picgo</code> Chocolatey: <code>choco install picgo</code></td></tr><tr><td>macOS</td><td>Homebrew: <code>brew install picgo --cask</code></td></tr><tr><td>Linux</td><td>AUR: <code>yay -S picgo-appimage</code></td></tr><tr><td>所有平台</td><td>GitHub Release:<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FMolunerfinn%2FPicGo%2Freleases" target="_blank" title="https://github.com/Molunerfinn/PicGo/releases" ref="nofollow noopener noreferrer">github.com/Molunerfinn…</a></td></tr><tr><td>国内用户</td><td>山东大学镜像站:<a href="https://link.juejin.cn?target=https%3A%2F%2Fmirrors.sdu.edu.cn%2Fgithub-release%2FMolunerfinn_PicGo" target="_blank" title="https://mirrors.sdu.edu.cn/github-release/Molunerfinn_PicGo" ref="nofollow noopener noreferrer">mirrors.sdu.edu.cn/github-rele…</a></td></tr></tbody></table>
<h3 data-id="heading-13">🏃快速上手</h3>
<ol>
<li>下载并安装PicGo</li>
<li>配置你喜欢的图床（支持多种平台）</li>
<li>开始享受一键上传的便捷</li>
</ol>
<p>第一次使用可以参考官方[使用文档]<a href="https://link.juejin.cn?target=https%3A%2F%2Fpicgo.github.io%2FPicGo-Doc%2Fguide%2Fgetting-started.html" target="_blank" title="https://picgo.github.io/PicGo-Doc/guide/getting-started.html" ref="nofollow noopener noreferrer">picgo.github.io/PicGo-Doc/g…</a>。</p>
<p>我一直使用的是开源图床chevereto,以下是配置示例：</p>
<ul>
<li>在picgo插件设置中查询<code>chevereto</code>插件并安装（搜索时只是用首字母搜索即可） <img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e34828244b844fc7a36b689b0f3a102f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769958272&amp;x-signature=5GuvoEffpYfuF3FFo6SvCAburnU%3D" alt="" loading="lazy"/></li>
<li>在chevereto 中复制api-key（Dashboard-&gt;setting-&gt;api）</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/98aff837fbb448edad426c113d4b4cc7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769958272&amp;x-signature=5alqroESR8iOZ8DHhem98xD%2FtsA%3D" alt="" loading="lazy"/></p>
<ul>
<li>在picgo 图床设置中设置chevereto 的参数</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f03ad086016a4b019f98aa3d53c2208b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769958272&amp;x-signature=ugnafqPSPkzYieQyKThikkYiLNA%3D" alt="" loading="lazy"/></p>
<ul>
<li>在上传区上传照片，在相册处查看及复制所需链接</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/67208861cc4246c18dc648ac2c758dbe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769958272&amp;x-signature=U7CAWphzRhZTLcZSOmmBxfVG7uU%3D" alt="" loading="lazy"/></p>
<ul>
<li>在其它支持配置picgo的编辑器或者笔记软件中启用配置picgo</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e4e1e43e45714dedabd924e7ba8ef5b2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769958272&amp;x-signature=yaGA8tcFDsYpXT20zLJwAQcJqSE%3D" alt="" loading="lazy"/></p>
<ul>
<li>配置完成后我们就直接可以在编译器或者笔记中通过 <code>CTRL+C</code>、<code>CTRL+V</code> 直接插入图片了</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c6ba21b440074ec2a0c46d6cddee782d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769958272&amp;x-signature=yXJoGaOVRdF6jXEA8a9vdA4oK5I%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-14">📱移动端支持</h2>
<p>除了桌面端，PicGo生态还有移动端应用：</p>
<ul>
<li>flutter-picgo <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FPicGo%2Fflutter-picgo" target="_blank" title="https://github.com/PicGo/flutter-picgo" ref="nofollow noopener noreferrer">github.com/PicGo/flutt…</a>：支持Android和iOS</li>
<li>PicHoro <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FKuingsmile%2FPicHoro" target="_blank" title="https://github.com/Kuingsmile/PicHoro" ref="nofollow noopener noreferrer">github.com/Kuingsmile/…</a>：另一款Android应用</li>
</ul>
<h2 data-id="heading-15">🎯结语</h2>
<p>在效率至上的今天，每一秒的注意力都弥足珍贵。PicGo正是这样一款工具——它不追求花哨的功能，而是专注于解决创作者最实际的痛点：<strong>让图片上传变得无感，让你专注于内容本身</strong>。</p>
<p>无论你是技术博主、文档工程师，还是日常需要处理图片的创作者，PicGo都能显著提升你的工作效率。今天就试试吧，你会发现，原来图片管理可以如此简单优雅。</p>
<p>本文使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fmdnice.com%2F%3Ffrom%3Djuejin" target="_blank" title="https://mdnice.com/?from=juejin" ref="nofollow noopener noreferrer">mdnice</a> 排版</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Button Pattern 详解]]></title>    <link>https://juejin.cn/post/7598737609494773779</link>    <guid>https://juejin.cn/post/7598737609494773779</guid>    <pubDate>2026-01-25T15:24:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598737609494773779" data-draft-id="7598699872552992804" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Button Pattern 详解"/> <meta itemprop="keywords" content="前端,HTML"/> <meta itemprop="datePublished" content="2026-01-25T15:24:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="anOnion"/> <meta itemprop="url" content="https://juejin.cn/user/553809592722589"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Button Pattern 详解
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/553809592722589/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    anOnion
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-25T15:24:23.000Z" title="Sun Jan 25 2026 15:24:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读12分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Button Pattern 详解：构建无障碍按钮组件</h2>
<p>按钮是 Web 界面中最基础的交互元素之一，它让用户能够触发特定的操作或事件，如提交表单、打开对话框、取消操作或执行删除操作。根据 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.w3.org%2FWAI%2FARIA%2Fapg%2Fpatterns%2Fbutton%2F" target="_blank" title="https://www.w3.org/WAI/ARIA/apg/patterns/button/" ref="nofollow noopener noreferrer">W3C WAI-ARIA Button Pattern 规范</a>，正确实现的按钮组件不仅要具备良好的视觉效果，更需要确保所有用户都能顺利使用，包括依赖屏幕阅读器等辅助技术的用户。本文将深入探讨 Button Pattern 的核心概念、实现要点以及最佳实践。</p>
<h3 data-id="heading-1">一、按钮的定义与核心功能</h3>
<p>按钮是一个允许用户触发动作或事件的界面组件。从功能角度来看，按钮执行的是<strong>动作</strong>而非<strong>导航</strong>，这是按钮与链接的本质区别。常见的按钮功能包括：提交表单数据、打开对话框窗口、取消正在进行的操作、删除特定内容等。一个设计良好的按钮应当让用户清晰地感知到点击它将产生什么效果，这种可预期性是良好用户体验的重要组成部分。</p>
<p>在实际开发中，有一个广为接受的约定值得注意：如果按钮的操作会打开一个对话框或其他需要进一步交互的界面，应该在按钮标签后加上省略号（...）来提示用户。例如，**保存为...**这样的标签能够告诉用户，点击这个按钮后会弹出额外的对话框需要填写。这种细节虽然看似微小，却能显著提升用户对界面行为的理解。</p>
<h3 data-id="heading-2">二、按钮的三种类型</h3>
<p>WAI-ARIA 规范支持三种类型的按钮，每种类型都有其特定的用途和实现要求。理解这三种类型的区别对于构建正确无障碍的界面至关重要。</p>
<h4 data-id="heading-3">2.1 普通按钮</h4>
<p>普通按钮是最常见的按钮类型，它执行单一的操作而不涉及状态的切换。提交表单的<strong>提交</strong>按钮、触发某个动作的<strong>执行</strong>按钮都属于这一类别。普通按钮在激活时会执行预定义的操作，操作完成后通常会根据操作的性质决定焦点的移动位置。例如，打开对话框的按钮在激活后，焦点应移动到对话框内部；而执行原地操作的按钮则可能保持焦点在原位。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"submit"</span>&gt;</span>提交表单<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
</code></pre>
<h4 data-id="heading-4">2.2 切换按钮</h4>
<p>切换按钮是一种具有两种状态的按钮，可以处于<strong>未按下</strong>或<strong>已按下</strong>的状态。这种按钮通过 aria-pressed 属性向辅助技术传达其当前状态。例如，音频播放器中的<strong>静音</strong>按钮就可以实现为切换按钮：当声音处于静音状态时，按钮的 aria-pressed 值为 true；当声音正常播放时，该值为 false。</p>
<p>实现切换按钮时有一个关键原则需要牢记：按钮的标签在状态改变时不应发生变化。无论按钮是处于按下还是未按下状态，其可访问名称应该保持一致。屏幕阅读器用户依赖这个稳定的标签来理解按钮的功能。如果设计要求在状态改变时显示不同的文本，那么就不应使用 aria-pressed 属性，而是应该通过其他方式传达状态变化。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">button</span>
  <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span>
  <span class="hljs-attr">aria-pressed</span>=<span class="hljs-string">"false"</span>
  <span class="hljs-attr">id</span>=<span class="hljs-string">"muteButton"</span>&gt;</span>
  静音
<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
  muteButton.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> isMuted = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getAttribute</span>(<span class="hljs-string">'aria-pressed'</span>) === <span class="hljs-string">'true'</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setAttribute</span>(<span class="hljs-string">'aria-pressed'</span>, !isMuted);
  });
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<h4 data-id="heading-5">2.3 菜单按钮</h4>
<p>菜单按钮是一种特殊的按钮，点击后会展开一个菜单或其他弹出式界面。根据 WAI-ARIA 规范，通过将 aria-haspopup 属性设置为 menu 或 true，可以将按钮向辅助技术揭示为菜单按钮。这种按钮在用户界面中非常常见，例如许多应用中的<strong>文件</strong>菜单、<strong>编辑</strong>菜单等。</p>
<p>菜单按钮的实现需要遵循菜单模式的相关规范，确保用户能够通过键盘导航菜单项，屏幕阅读器能够正确播报菜单状态，视觉用户能够清晰地看到菜单的展开和收起状态。正确实现的菜单按钮应当提供平滑的用户体验，无论用户使用何种输入方式或辅助技术。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">button</span>
  <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span>
  <span class="hljs-attr">aria-haspopup</span>=<span class="hljs-string">"menu"</span>
  <span class="hljs-attr">id</span>=<span class="hljs-string">"fileMenu"</span>&gt;</span>
  文件
<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
</code></pre>
<h3 data-id="heading-6">三、键盘交互规范</h3>
<p>键盘可访问性是 Web 无障碍设计的核心要素之一。按钮组件必须支持完整的键盘交互，确保无法使用鼠标的用户也能顺利操作。根据 Button Pattern 规范，当按钮获得焦点时，用户应能通过以下按键与按钮交互：</p>
<p><strong>空格键和回车键</strong>是激活按钮的主要方式。当用户按下空格键或回车键时，按钮被触发执行其预定义的操作。这个设计遵循了用户对表单控件的既有认知，与传统桌面应用的交互模式保持一致。</p>
<p>按钮激活后焦点的处理需要根据具体情境来决定，这是实现良好键盘体验的关键。如果按钮打开了一个对话框，焦点应移动到对话框内部，通常是对话框的第一个可聚焦元素或默认焦点元素。如果按钮关闭了对话框，焦点通常应返回到打开该对话框的按钮，除非对话框中的操作逻辑上应该导致焦点移动到其他位置。例如，在确认删除操作的对话框中点击<strong>确认</strong>后，焦点可能会移动到页面上的其他相关元素。</p>
<p>对于不会关闭当前上下文的按钮（如<strong>应用</strong>按钮、<strong>重新计算</strong>按钮），激活后焦点通常应保持在原位。如果按钮的操作表示上下文将要发生变化（如向导中的<strong>下一步</strong>），则应将焦点移动到该操作的起始位置。对于通过快捷键触发的按钮，焦点通常应保持在触发快捷键时的上下文中。</p>
<h3 data-id="heading-7">四、WAI-ARIA 角色、状态和属性</h3>
<p>正确使用 WAI-ARIA 属性是构建无障碍按钮组件的技术基础。虽然语义化的 HTML 按钮元素（button）本身已经具备正确的角色和基本行为，但在某些情况下需要使用自定义实现或 ARIA 属性来增强可访问性。</p>
<p><strong>角色声明</strong>是基础要求。按钮元素的 role 属性应设置为 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.w3.org%2FTR%2Fwai-aria-1.2%2F%23button" target="_blank" title="https://www.w3.org/TR/wai-aria-1.2/#button" ref="nofollow noopener noreferrer">button</a>，向辅助技术表明这是一个按钮组件。对于使用 button 这样的原生 HTML 元素，浏览器会自动处理角色声明，无需开发者手动添加。</p>
<p>示例：使用 div 元素模拟按钮时需要添加 role="button"：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>
  <span class="hljs-attr">role</span>=<span class="hljs-string">"button"</span>
  <span class="hljs-attr">tabindex</span>=<span class="hljs-string">"0"</span>
  <span class="hljs-attr">onclick</span>=<span class="hljs-string">"handleClick()"</span>&gt;</span>
  提交
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p><strong>可访问名称</strong>是按钮最重要的可访问性特征之一。按钮必须有可访问的名称，这个名称可以通过多种方式提供：按钮内部的文本内容是最常见的来源；在某些情况下，可以使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.w3.org%2FTR%2Fwai-aria-1.2%2F%23aria-labelledby" target="_blank" title="https://www.w3.org/TR/wai-aria-1.2/#aria-labelledby" ref="nofollow noopener noreferrer">aria-labelledby</a> 引用页面上的其他元素作为标签；或者使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.w3.org%2FTR%2Fwai-aria-1.2%2F%23aria-label" target="_blank" title="https://www.w3.org/TR/wai-aria-1.2/#aria-label" ref="nofollow noopener noreferrer">aria-label</a> 直接提供标签文本。屏幕阅读器用户主要依赖这个名称来理解按钮的功能。</p>
<p>示例 1：使用 aria-labelledby 引用其他元素作为标签：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"save-heading"</span>&gt;</span>保存设置<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">button</span>
  <span class="hljs-attr">role</span>=<span class="hljs-string">"button"</span>
  <span class="hljs-attr">aria-labelledby</span>=<span class="hljs-string">"save-heading"</span>&gt;</span>
  图标
<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
</code></pre>
<p>示例 2：使用 aria-label 直接提供标签文本：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">button</span>
  <span class="hljs-attr">aria-label</span>=<span class="hljs-string">"关闭对话框"</span>
  <span class="hljs-attr">onclick</span>=<span class="hljs-string">"closeDialog()"</span>&gt;</span>
  ×
<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
</code></pre>
<p><strong>描述信息</strong>可以通过 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.w3.org%2FTR%2Fwai-aria-1.2%2F%23aria-describedby" target="_blank" title="https://www.w3.org/TR/wai-aria-1.2/#aria-describedby" ref="nofollow noopener noreferrer">aria-describedby</a> 属性关联。如果页面上存在对按钮功能的详细描述说明，应将描述元素的 ID 赋给这个属性，辅助技术会在播报按钮名称后继续播报描述内容。</p>
<p>示例：使用 aria-describedby 提供详细描述：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">aria-describedby</span>=<span class="hljs-string">"delete-warning"</span>&gt;</span>删除<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"delete-warning"</span>&gt;</span>此操作无法撤销，将永久删除所选数据。<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
</code></pre>
<p><strong>禁用状态</strong>需要正确使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.w3.org%2FTR%2Fwai-aria-1.2%2F%23aria-disabled" target="_blank" title="https://www.w3.org/TR/wai-aria-1.2/#aria-disabled" ref="nofollow noopener noreferrer">aria-disabled</a> 属性。当按钮的关联操作不可用时，应设置 aria-disabled="true"。这个属性向辅助技术传达按钮当前处于禁用状态，用户无法与之交互。需要注意的是，对于原生 HTML button 元素，应使用 disabled 属性而非 aria-disabled。</p>
<p>示例：使用 aria-disabled 禁用非原生按钮：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>
  <span class="hljs-attr">role</span>=<span class="hljs-string">"button"</span>
  <span class="hljs-attr">tabindex</span>=<span class="hljs-string">"-1"</span>
  <span class="hljs-attr">aria-disabled</span>=<span class="hljs-string">"true"</span>
  <span class="hljs-attr">aria-label</span>=<span class="hljs-string">"保存"</span>&gt;</span>
  保存
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p><strong>切换状态</strong>使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.w3.org%2FTR%2Fwai-aria-1.2%2F%23aria-pressed" target="_blank" title="https://www.w3.org/TR/wai-aria-1.2/#aria-pressed" ref="nofollow noopener noreferrer">aria-pressed</a> 属性来传达，这个属性只用于实现为切换按钮的组件。属性值应为 true（按下状态）、false（未按下状态）或 mixed（部分选中状态，用于三态树节点等场景）。</p>
<p>示例：使用 aria-pressed 实现切换按钮：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">button</span>
  <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span>
  <span class="hljs-attr">aria-pressed</span>=<span class="hljs-string">"false"</span>
  <span class="hljs-attr">id</span>=<span class="hljs-string">"toggleBtn"</span>
  <span class="hljs-attr">onclick</span>=<span class="hljs-string">"toggleState()"</span>&gt;</span>
  夜间模式
<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
</code></pre>
<h3 data-id="heading-8">五、按钮与链接的区别</h3>
<p>在 Web 开发中，一个常见的混淆点是何时应该使用按钮，何时应该使用链接。这两者的功能定位有着本质的区别，理解这个区别对于构建语义正确的页面至关重要。</p>
<p>按钮用于<strong>触发动作</strong>，如提交表单、打开对话框、执行计算、删除数据等。这些操作会产生副作用，改变应用的状态或数据。链接用于<strong>导航</strong>，将用户带到另一个页面、页面的不同位置或不同的应用状态。链接的本质是超文本引用，它告诉用户<strong>这里有你可能感兴趣的另一个资源</strong>。</p>
<p>从技术实现角度，这个区别直接影响了可访问性。屏幕阅读器对按钮和链接的播报方式不同，用户会根据这些提示形成对界面功能的预期。如果一个元素看起来像链接（蓝色下划线文本）但点击后执行的是按钮的动作（提交表单），会给用户造成困惑。即使出于设计考虑必须使用这种视觉与功能的组合，也应通过 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.w3.org%2FTR%2Fwai-aria-1.2%2F%23button" target="_blank" title="https://www.w3.org/TR/wai-aria-1.2/#button" ref="nofollow noopener noreferrer">role="button"</a> 属性明确告诉辅助技术这个元素的真实功能，避免给依赖辅助技术的用户带来困惑。</p>
<p>更好的做法是调整视觉设计，使其与功能保持一致。如果某个元素执行的是动作，就应该看起来像一个按钮；如果用户需要被导航到新页面，就应该使用标准的链接样式。这种设计上的统一能够减少所有用户的认知负担。</p>
<h3 data-id="heading-9">六、其他示例</h3>
<p>以下是一个常见按钮场景的实现示例——打开对话框的按钮，展示了如何正确应用 Button Pattern 规范。</p>
<p>使用 HTML 原生 <code>&lt;dialog&gt;</code> 元素配合按钮实现对话框功能：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">button</span>
  <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span>
  <span class="hljs-attr">aria-haspopup</span>=<span class="hljs-string">"dialog"</span>
  <span class="hljs-attr">aria-expanded</span>=<span class="hljs-string">"false"</span>
  <span class="hljs-attr">id</span>=<span class="hljs-string">"openDialog"</span>&gt;</span>
  设置...
<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">dialog</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"settingsDialog"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">method</span>=<span class="hljs-string">"dialog"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"checkbox"</span> /&gt;</span> 启用通知 <span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"confirm"</span>&gt;</span>确定<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dialog</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
  <span class="hljs-keyword">const</span> dialog = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'settingsDialog'</span>);
  <span class="hljs-keyword">const</span> openBtn = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'openDialog'</span>);

  openBtn.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-function">() =&gt;</span> {
    dialog.<span class="hljs-title function_">showModal</span>();
    openBtn.<span class="hljs-title function_">setAttribute</span>(<span class="hljs-string">'aria-expanded'</span>, <span class="hljs-string">'true'</span>);
  });

  dialog.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'close'</span>, <span class="hljs-function">() =&gt;</span> {
    openBtn.<span class="hljs-title function_">setAttribute</span>(<span class="hljs-string">'aria-expanded'</span>, <span class="hljs-string">'false'</span>);
  });
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p>当按钮会打开对话框时，使用省略号提示用户后面还有额外交互。<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.w3.org%2FTR%2Fwai-aria-1.2%2F%23aria-haspopup" target="_blank" title="https://www.w3.org/TR/wai-aria-1.2/#aria-haspopup" ref="nofollow noopener noreferrer">aria-haspopup</a> 表明按钮会弹出内容，<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.w3.org%2FTR%2Fwai-aria-1.2%2F%23aria-expanded" target="_blank" title="https://www.w3.org/TR/wai-aria-1.2/#aria-expanded" ref="nofollow noopener noreferrer">aria-expanded</a> 用于传达弹出内容的当前状态。</p>
<h3 data-id="heading-10">七、CSS 伪类与交互样式</h3>
<p>以下 CSS 伪类可用于增强按钮的键盘交互体验：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* Tab 键导航到按钮时显示焦点框 */</span>
<span class="hljs-selector-tag">button</span><span class="hljs-selector-pseudo">:focus</span> {
  <span class="hljs-attribute">outline</span>: <span class="hljs-number">2px</span> solid blue;
  <span class="hljs-attribute">outline-offset</span>: <span class="hljs-number">2px</span>;
}

<span class="hljs-comment">/* 仅键盘焦点显示样式，鼠标点击不显示 */</span>
<span class="hljs-selector-tag">button</span><span class="hljs-selector-pseudo">:focus</span>-visible {
  <span class="hljs-attribute">outline</span>: <span class="hljs-number">2px</span> solid currentColor;
  <span class="hljs-attribute">outline-offset</span>: <span class="hljs-number">2px</span>;
}

<span class="hljs-comment">/* 空格键或回车键按下时的样式 */</span>
<span class="hljs-selector-tag">button</span><span class="hljs-selector-pseudo">:active</span> {
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">scale</span>(<span class="hljs-number">0.98</span>);
}

<span class="hljs-comment">/* 鼠标悬停效果（可选，增强视觉反馈） */</span>
<span class="hljs-selector-tag">button</span><span class="hljs-selector-pseudo">:hover</span> {
  <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0.9</span>;
}

<span class="hljs-comment">/* Tab + Space 组合键激活样式（需 JS 添加类） */</span>
<span class="hljs-selector-tag">button</span><span class="hljs-selector-class">.keyboard-active</span> {
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">scale</span>(<span class="hljs-number">0.95</span>);
  <span class="hljs-attribute">background-color</span>: <span class="hljs-built_in">oklch</span>(from currentColor <span class="hljs-number">0.8</span>);
}

<span class="hljs-comment">/* Tab + Enter 组合键激活样式（需 JS 添加类） */</span>
<span class="hljs-selector-tag">button</span><span class="hljs-selector-class">.keyboard-enter</span> {
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">scale</span>(<span class="hljs-number">0.95</span>);
  <span class="hljs-attribute">background-color</span>: <span class="hljs-built_in">oklch</span>(from currentColor <span class="hljs-number">0.8</span>);
}
</code></pre>
<p><strong>各伪类说明：</strong></p>






























<table><thead><tr><th>伪类</th><th>触发方式</th><th>用途</th></tr></thead><tbody><tr><td><code>:focus</code></td><td>Tab 键/鼠标点击</td><td>元素获得焦点时</td></tr><tr><td><code>:focus-visible</code></td><td>仅键盘 Tab</td><td>仅键盘焦点显示，避免鼠标点击时出现框</td></tr><tr><td><code>:active</code></td><td>按下空格/回车/鼠标</td><td>元素被激活时</td></tr><tr><td><code>:hover</code></td><td>鼠标悬停</td><td>鼠标悬停时的视觉反馈</td></tr></tbody></table>
<h4 data-id="heading-11">7.1 组合键交互示例</h4>
<p>CSS 本身无法直接检测组合键，但可以通过 JavaScript 增强体验：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"submitBtn"</span>&gt;</span>提交<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
  <span class="hljs-comment">/* Tab + Space 激活状态 */</span>
  <span class="hljs-selector-tag">button</span><span class="hljs-selector-class">.space-pressed</span> {
    <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">scale</span>(<span class="hljs-number">0.95</span>);
    <span class="hljs-attribute">box-shadow</span>: inset <span class="hljs-number">0</span> <span class="hljs-number">2px</span> <span class="hljs-number">4px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.2</span>);
  }

  <span class="hljs-comment">/* Tab + Enter 激活状态 */</span>
  <span class="hljs-selector-tag">button</span><span class="hljs-selector-class">.enter-pressed</span> {
    <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">scale</span>(<span class="hljs-number">0.95</span>);
    <span class="hljs-attribute">background-color</span>: <span class="hljs-built_in">oklch</span>(from <span class="hljs-built_in">var</span>(--btn-bg, currentColor) <span class="hljs-number">0.8</span>);
  }
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
  <span class="hljs-keyword">const</span> btn = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'submitBtn'</span>);

  <span class="hljs-comment">// Tab + Space 组合键</span>
  btn.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'keydown'</span>, <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
    <span class="hljs-keyword">if</span> (e.<span class="hljs-property">key</span> === <span class="hljs-string">' '</span> &amp;&amp; e.<span class="hljs-property">target</span> === <span class="hljs-variable language_">document</span>.<span class="hljs-property">activeElement</span>) {
      btn.<span class="hljs-property">classList</span>.<span class="hljs-title function_">add</span>(<span class="hljs-string">'space-pressed'</span>);
    }
    <span class="hljs-keyword">if</span> (e.<span class="hljs-property">key</span> === <span class="hljs-string">'Enter'</span> &amp;&amp; e.<span class="hljs-property">target</span> === <span class="hljs-variable language_">document</span>.<span class="hljs-property">activeElement</span>) {
      btn.<span class="hljs-property">classList</span>.<span class="hljs-title function_">add</span>(<span class="hljs-string">'enter-pressed'</span>);
    }
  });

  btn.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'keyup'</span>, <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
    <span class="hljs-keyword">if</span> (e.<span class="hljs-property">key</span> === <span class="hljs-string">' '</span>) {
      btn.<span class="hljs-property">classList</span>.<span class="hljs-title function_">remove</span>(<span class="hljs-string">'space-pressed'</span>);
    }
    <span class="hljs-keyword">if</span> (e.<span class="hljs-property">key</span> === <span class="hljs-string">'Enter'</span>) {
      btn.<span class="hljs-property">classList</span>.<span class="hljs-title function_">remove</span>(<span class="hljs-string">'enter-pressed'</span>);
    }
  });
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p><strong>组合键说明：</strong></p>




















<table><thead><tr><th>组合键</th><th>效果</th><th>触发元素</th></tr></thead><tbody><tr><td>Tab + Space</td><td>聚焦并激活按钮</td><td><code>&lt;button&gt;</code></td></tr><tr><td>Tab + Enter</td><td>聚焦并触发按钮</td><td><code>&lt;button&gt;</code>、<code>&lt;div role="button"&gt;</code></td></tr></tbody></table>
<p><strong>原生 HTML 按钮的行为：</strong></p>
<ul>
<li><code>&lt;button&gt;</code>：Tab 聚焦后按 Space/Enter 都会触发点击</li>
<li><code>&lt;div role="button"&gt;</code>：需要额外 JS 处理 Space 键</li>
</ul>
<h3 data-id="heading-12">八、总结</h3>
<p>构建无障碍的按钮组件需要关注多个层面的细节。从视觉设计角度，按钮应该让用户清晰地感知到它是一个可交互的元素；从键盘交互角度，必须支持空格键和回车键的激活操作；从 ARIA 属性角度，需要正确使用角色、状态和属性来传达组件的语义和当前状态。</p>
<p>按钮与链接的功能区分是 Web 语义化的基础之一，遵循这个原则不仅有助于辅助技术用户理解页面结构，也能提升所有用户的使用体验。在实际开发中，优先使用语义化的原生 HTML 元素，只有在必要时才考虑使用自定义实现，并确保为这些实现添加完整的无障碍支持。</p>
<p>WAI-ARIA Button Pattern 为我们提供了清晰的指导方针，将这些规范内化为开发习惯，能够帮助我们创建更加包容和易用的 Web 应用。每一个正确实现的按钮组件，都是构建无障碍网络环境的重要一步。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[墨梅博客 1.2.0 发布与 AI 开发实践 | 2026 年第 4 周草梅周报]]></title>    <link>https://juejin.cn/post/7598921649888804891</link>    <guid>https://juejin.cn/post/7598921649888804891</guid>    <pubDate>2026-01-25T15:33:36.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598921649888804891" data-draft-id="7598947628468092974" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="墨梅博客 1.2.0 发布与 AI 开发实践 | 2026 年第 4 周草梅周报"/> <meta itemprop="keywords" content="GitHub,开源,AI编程"/> <meta itemprop="datePublished" content="2026-01-25T15:33:36.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="草梅友仁"/> <meta itemprop="url" content="https://juejin.cn/user/3043088413495815"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            墨梅博客 1.2.0 发布与 AI 开发实践 | 2026 年第 4 周草梅周报
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3043088413495815/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    草梅友仁
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-25T15:33:36.000Z" title="Sun Jan 25 2026 15:33:36 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>本文在 <a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmyr.ltd" target="_blank" title="https://blog.cmyr.ltd" ref="nofollow noopener noreferrer">草梅友仁的博客</a> 发布和更新，并在多个平台同步发布。如有更新，以博客上的版本为准。您也可以通过文末的 <code>原文链接</code> 查看最新版本。</p>
</blockquote>
<h2 data-id="heading-0">前言</h2>
<p>欢迎来到草梅周报！这是一个由草梅友仁基于 AI 整理的周报，旨在为您提供最新的博客更新、GitHub 动态、个人动态和其他周刊文章推荐等内容。</p>
<hr/>
<h2 data-id="heading-1">开源动态</h2>
<p>本周依旧在开发 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FCaoMeiYouRen%2Fmomei" target="_blank" title="https://github.com/CaoMeiYouRen/momei" ref="nofollow noopener noreferrer">墨梅 (Momei)</a> 中。</p>
<blockquote>
<p>您可以前往 Demo 站试用：<a href="https://link.juejin.cn?target=https%3A%2F%2Fdemo.momei.app%2F" target="_blank" title="https://demo.momei.app/" ref="nofollow noopener noreferrer">demo.momei.app/</a></p>
<ul>
<li>您可以通过邮箱 <code>admin@example.com</code>，密码<code>momei123456</code>登录演示用管理员账号。</li>
</ul>
<p>或前往官网注册：<a href="https://link.juejin.cn?target=https%3A%2F%2Fmomei.app%2F" target="_blank" title="https://momei.app/" ref="nofollow noopener noreferrer">momei.app/</a></p>
<p>也可以前往文档站来了解项目整体规划和未来开发路线图：<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.momei.app%2F" target="_blank" title="https://docs.momei.app/" ref="nofollow noopener noreferrer">docs.momei.app/</a></p>
</blockquote>
<p>当前墨梅博客已经正式发布了 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FCaoMeiYouRen%2Fmomei%2Freleases%2Ftag%2Fv1.2.0" target="_blank" title="https://github.com/CaoMeiYouRen/momei/releases/tag/v1.2.0" ref="nofollow noopener noreferrer">1.2.0</a> 版本，以下是页面和功能的一些截图。</p>
<p>增加了邮箱订阅和 RSS 订阅功能</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/22a716ef6070436f849c8c18397ee813~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I2J5qKF5Y-L5LuB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769960016&amp;x-signature=2TT4Rxnl9n2Z4LUHiqIyHpM8QgE%3D" alt="image-20260125213101001" loading="lazy"/></p>
<p>增加了搜索功能（ctrl+K 可快捷调用）</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7a475c1cc13744cc867d161e89e3c65c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I2J5qKF5Y-L5LuB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769960016&amp;x-signature=zWsRnskT6%2B%2FnfmcFsTQNEcfHdnQ%3D" alt="image-20260125214529879" loading="lazy"/></p>
<p>优化了国际化功能，目前可自动切换文章、分类、标签等文本的语言</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9002bc0c6a74419d939f2682fa633bfb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I2J5qKF5Y-L5LuB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769960016&amp;x-signature=s4WnSifnLem4%2FHbV5BzsP6pcOjQ%3D" alt="image-20260125214137560" loading="lazy"/></p>
<p>新增了 AI 辅助功能，可以自动生成标题、路径别名、标签、分类、摘要等。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e59afe0205b1444cb213d48f2a18d201~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I2J5qKF5Y-L5LuB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769960016&amp;x-signature=ac9QOu%2BiNT68Yzp1ohii9%2Fcvf%2Fk%3D" alt="image-20260125214330435" loading="lazy"/></p>
<p>新增了主题定制功能，可以更加自由的设计 UI 样式。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e51dd35faada4bbabca0c2b6afe3942a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I2J5qKF5Y-L5LuB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769960016&amp;x-signature=MXH0rUIcfHNYOjjG3wqcrBpkmw8%3D" alt="image-20260125212120340" loading="lazy"/></p>
<p>文章增加了多种访问权限控制，例如私密、密码保护、登录可见、订阅可见等。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0c75e1da0d474059a00631dbfba4ce46~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I2J5qKF5Y-L5LuB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769960016&amp;x-signature=UgF2pzIruFuTDQHSDJcKvnffv%2B8%3D" alt="image-20260125212214155" loading="lazy"/></p>
<p>在 Markdown 支持上，添加了自定义提示、代码组、GitHub 警报、Emoji、LaTeX 等功能支持。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/44b0e1d252d3419eac7be0f207943f17~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I2J5qKF5Y-L5LuB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769960016&amp;x-signature=YGJAKfCo2eYynIeQxoDAPgMU1R0%3D" alt="image-20260125212618490" loading="lazy"/></p>
<p>更多页面可以前往<a href="https://link.juejin.cn?target=https%3A%2F%2Fmomei.app%2F" target="_blank" title="https://momei.app/" ref="nofollow noopener noreferrer">官网</a>体验，也可前往<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmyr.ltd%2Farchives%2F2025-51-caomei-weekly-momei-blog-mvp-caomei-auth-update.html" target="_blank" title="https://blog.cmyr.ltd/archives/2025-51-caomei-weekly-momei-blog-mvp-caomei-auth-update.html" ref="nofollow noopener noreferrer">之前的博客</a>查看截图。</p>
<p>欢迎各位用户体验。并提出意见和建议。</p>
<p>接下来的话还会继续按照路线图和待办进行开发功能，敬请期待。</p>
<p>当然，目前墨梅博客还有很多需要打磨的细节，功能上也还不完善，如有任何意见和建议，都可以在项目的  <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FCaoMeiYouRen%2Fmomei%2Fissues" target="_blank" title="https://github.com/CaoMeiYouRen/momei/issues" ref="nofollow noopener noreferrer">GitHub issues</a> 中提出。</p>
<p>如果你也对墨梅博客感兴趣，欢迎参与开发和测试。</p>
<h2 data-id="heading-2">开发日常</h2>
<p>最近也是尝试了使用语音编程，效果确实不错。虽然有些错误，但目前的 AI 也已经足以正确识别，所以大部分情况下都是 OK 的，感觉和 AI 的沟通效率更高了。</p>
<p>在 VSCode 里面装一下 VS Code Speech 这个扩展就行，Copilot 的对话框里面就会出现一个麦克风，之后就直接聊天吧。
记得再安装中文支持插件，不然识别不出中文。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a71f518735e1432482a92c95cf70cb2c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I2J5qKF5Y-L5LuB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769960016&amp;x-signature=eqkjzhd14Fn%2FMcM3PlQRvfXvPjQ%3D" alt="image-20260125215750890" loading="lazy"/></p>
<p>然后是研究了下如何在手机上远程用 AI 开发的事情。</p>
<p>目前是采用了 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fslopus%2Fhappy" target="_blank" title="https://github.com/slopus/happy" ref="nofollow noopener noreferrer">Happy Coder</a> + <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fanthropics%2Fclaude-code" target="_blank" title="https://github.com/anthropics/claude-code" ref="nofollow noopener noreferrer">Claude Code</a> 来实现这一点。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/55dbc1e1a734402cbbb91e4e5f33d6bd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I2J5qKF5Y-L5LuB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769960016&amp;x-signature=GnTS2bt1mIole%2BZI9Af2Rf4pHOU%3D" alt="Screenshot_2026-01-23-11-05-52-86_57f62d029f3be71" loading="lazy"/></p>
<p><code>happy</code> 从本质上来讲就是个远程调用 <code>claude</code> 或  <code>codex</code> 的工具，所以要在本地电脑有 <code>claude</code> 或  <code>codex</code> 。</p>
<p>所以只要安装了 <code>claude</code> 或  <code>codex</code> ，再安装 <code>happy</code> 就可以愉快的远程开发了。</p>
<blockquote>
<p>语音助手的简体中文口音有点难绷，感觉有点粤语口音，不过识别的还挺准确的，不是直接转文本，而是再整理过后发送到主机。</p>
</blockquote>
<h2 data-id="heading-3">GitHub Release</h2>
<h3 data-id="heading-4">caomei-auth</h3>
<h4 data-id="heading-5"><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FCaoMeiYouRen%2Fcaomei-auth%2Freleases%2Ftag%2Fv1.12.3" target="_blank" title="https://github.com/CaoMeiYouRen/caomei-auth/releases/tag/v1.12.3" ref="nofollow noopener noreferrer">v1.12.3</a> - 2026-01-17 20:14:59</h4>
<p>摘要:
版本 1.12.3 (2026-01-17)</p>
<p>Bug 修复：</p>
<ol>
<li>优化生成纯文本版本的逻辑，移除了 script 标签及其内容</li>
<li>修复了获取微信和抖音 openid 的逻辑，同时简化了相关代码</li>
<li>添加了 sanitize-html 依赖并进一步优化了纯文本生成逻辑</li>
</ol>
<p>代码重构：</p>
<ol>
<li>将注册和修改密码表单的基础 Schema 提取为单独的常量</li>
<li>更新了文档结构，优化了开发、设计和标准相关的链接</li>
</ol>
<h3 data-id="heading-6">momei</h3>
<h4 data-id="heading-7"><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FCaoMeiYouRen%2Fmomei%2Freleases%2Ftag%2Fv1.2.0" target="_blank" title="https://github.com/CaoMeiYouRen/momei/releases/tag/v1.2.0" ref="nofollow noopener noreferrer">v1.2.0</a> - 2026-01-24 20:06:12</h4>
<p>摘要:
版本 1.2.0 摘要 (2026-01-24)</p>
<p>【性能优化】</p>
<ul>
<li>优化 Lighthouse 跑分，修复 SEO、无障碍及 CLS 问题</li>
</ul>
<p>【新功能】</p>
<ul>
<li>新增图片懒加载支持，提升页面性能</li>
<li>实现国际化文本统一，优化提示信息</li>
<li>评论系统改进：支持游客评论身份凭证，移除邮箱查询</li>
<li>新增 Markdown 渲染器，支持图片懒加载、Lightbox 预览和代码组功能</li>
<li>AI 服务增加用户 ID 支持，优化日志记录</li>
<li>主题设置增强：新增深色模式、自定义 CSS 注入、颜色配置选项</li>
<li>新增备案信息展示功能</li>
<li>评论系统前端 UI 实现，支持文章访问限制</li>
<li>数据库结构更新，新增用户、文章、评论等表字段</li>
<li>新增 PV 缓存系统，优化阅读量统计</li>
<li>新增外部资源 URL 白名单配置，增强安全性</li>
<li>新增文章可见性策略（公开/私密/密码保护）</li>
<li>新增流式翻译功能，支持长文章分段处理</li>
<li>新增演示模式功能，集成引导和模拟 AI 服务</li>
<li>新增用户协议和隐私政策页面</li>
<li>新增管理员账号配置，首位注册用户自动获得管理员角色</li>
<li>新增评论管理功能，支持创建、删除和批量操作</li>
</ul>
<p>【Bug 修复】</p>
<ul>
<li>修复多个高危安全漏洞（devalue, tar, h3）</li>
<li>优化响应式样式和媒体查询条件</li>
<li>修复 TypeORM 实体元数据丢失问题</li>
<li>修复评论内容展示问题和游客信息读取逻辑</li>
<li>更新依赖项解决兼容性和安全问题</li>
<li>修复管理员菜单项类型定义和点击事件</li>
</ul>
<p>【代码重构】</p>
<ul>
<li>优化 PV 缓存系统，支持 Redis</li>
<li>更新 Markdown 格式化规则，禁用标点符号处理</li>
<li>添加无服务器环境检测功能</li>
<li>统一主题设置接口字段命名</li>
<li>迁移字数统计和阅读时间估算功能</li>
</ul>
<h4 data-id="heading-8"><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FCaoMeiYouRen%2Fmomei%2Freleases%2Ftag%2Fv1.1.0" target="_blank" title="https://github.com/CaoMeiYouRen/momei/releases/tag/v1.1.0" ref="nofollow noopener noreferrer">v1.1.0</a> - 2026-01-17 20:05:30</h4>
<p>摘要:
版本 1.1.0 主要更新摘要：</p>
<p>新功能：</p>
<ol>
<li>多语言支持：实现文章、分类和标签的跨语言切换，添加语言切换器组件，支持(slug, language)复合索引</li>
<li>SEO 优化：引入 sitemap 生成功能，支持动态路由，添加 Google/Bing 搜索控制台支持</li>
<li>订阅功能：实现 RSS 订阅和基础邮件订阅，支持按语言过滤</li>
<li>AI 集成：添加标题建议、摘要生成、标签推荐和翻译功能，支持多语言同步</li>
<li>用户管理：增加 Google 登录支持，实现 API 密钥管理功能</li>
<li>内容管理：优化版权声明系统，支持多种 CC 协议，添加文章状态机和预览功能</li>
</ol>
<p>Bug 修复：</p>
<ol>
<li>修复 RSS 订阅内容格式问题，确保输出为 HTML</li>
<li>修正分类/标签页 400 错误，优化 i18n 显示</li>
<li>修复数据库查询中的字段名错误</li>
<li>优化 API 密钥管理界面样式和验证逻辑</li>
<li>修正标签和分类名称在不同语言下的唯一性校验</li>
</ol>
<p>代码重构：</p>
<ol>
<li>优化 AI 功能接口，提升内容创作效率</li>
<li>提取 AI 服务配置到环境变量</li>
<li>更新查询构建器类型定义增强安全性</li>
<li>优化错误处理和语言检测逻辑</li>
</ol>
<p>其他改进：</p>
<ol>
<li>优化搜索功能，增加频率限制和索引</li>
<li>增强权限管理，支持多角色校验</li>
<li>更新管理后台样式和功能</li>
<li>添加文章字数统计和阅读时长预估功能</li>
</ol>
<h3 data-id="heading-9">eslint-config-cmyr</h3>
<h4 data-id="heading-10"><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FCaoMeiYouRen%2Feslint-config-cmyr%2Freleases%2Ftag%2Fv2.1.0" target="_blank" title="https://github.com/CaoMeiYouRen/eslint-config-cmyr/releases/tag/v2.1.0" ref="nofollow noopener noreferrer">v2.1.0</a> - 2026-01-12 21:23:59</h4>
<p>摘要:
版本 2.1.0 更新摘要：</p>
<p>新功能：</p>
<ul>
<li>新增对 TypeScript 的支持和相关语言选项配置</li>
</ul>
<p>Bug 修复：</p>
<ul>
<li>移除了不必要的导入语句</li>
<li>优化了解析器选项的类型注释</li>
</ul>
<p>本次更新主要增强了 TypeScript 支持并进行了代码优化。</p>
<h4 data-id="heading-11"><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FCaoMeiYouRen%2Feslint-config-cmyr%2Freleases%2Ftag%2Fv2.1.0-beta.1" target="_blank" title="https://github.com/CaoMeiYouRen/eslint-config-cmyr/releases/tag/v2.1.0-beta.1" ref="nofollow noopener noreferrer">v2.1.0-beta.1</a> - 2026-01-12 21:13:22</h4>
<p>摘要:
版本 2.1.0-beta.1 (2026-01-12)</p>
<p>新功能：</p>
<ul>
<li>新增对 TypeScript 的支持和语言选项配置</li>
</ul>
<p>Bug 修复：</p>
<ul>
<li>移除了不必要的导入</li>
<li>优化了解析器选项的类型注释</li>
</ul>
<h2 data-id="heading-12">最新 GitHub 加星仓库</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Flint-md%2Flint-md" target="_blank" title="https://github.com/lint-md/lint-md" ref="nofollow noopener noreferrer">CaoMeiYouRen starred lint-md</a> - 2026-01-25 03:13:06
中文 Markdown 格式检查命令行工具，基于 AST 技术实现，可集成 CI 流程。主要功能包括博客文档格式校验，支持 API 调用。使用 TypeScript 开发，GitHub 获 954 星。</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fwecode-ai%2FWegent" target="_blank" title="https://github.com/wecode-ai/Wegent" ref="nofollow noopener noreferrer">CaoMeiYouRen starred Wegent</a> - 2026-01-25 01:41:01
开源 AI 原生操作系统，用于定义、组织和运行智能代理团队。主要使用 Python 语言开发，已获得 207 个星标。</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnumman-ali%2Fopenskills" target="_blank" title="https://github.com/numman-ali/openskills" ref="nofollow noopener noreferrer">CaoMeiYouRen starred openskills</a> - 2026-01-24 02:28:20
Universal skills loader for AI coding agents is available as an npm package called openskills. Written primarily in TypeScript, it has gained notable popularity with over 7,000 stargazers on its repository. The package can be installed globally using npm install -g openskills command.</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FGoogleChrome%2Flighthouse-ci" target="_blank" title="https://github.com/GoogleChrome/lighthouse-ci" ref="nofollow noopener noreferrer">CaoMeiYouRen starred lighthouse-ci</a> - 2026-01-24 01:49:45
自动化运行 Lighthouse 测试每个提交，查看变更并防止性能退化。该项目使用 JavaScript 开发，已在 GitHub 获得 6839 个星标。核心功能包括提交级别的性能监测、变更可视化对比和回归预防机制。通过集成 CI/CD 流程，确保代码质量与性能指标的持续监控。</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fblader%2Fhumanizer" target="_blank" title="https://github.com/blader/humanizer" ref="nofollow noopener noreferrer">CaoMeiYouRen starred humanizer</a> - 2026-01-23 21:20:28
该工具旨在消除 AI 生成文本的特征痕迹，使其更接近人类写作风格。项目在 GitHub 上获得 2907 个星标，显示其受欢迎程度。功能包括识别并修改 AI 写作的典型模式，如过度正式的表达、特定词汇偏好等。通过算法调整文本风格，使其更自然流畅。适用于需要隐藏 AI 生成来源的场景，如内容创作、学术写作等。项目支持多种语言处理，帮助用户规避 AI 检测工具的识别。</li>
</ul>
<h2 data-id="heading-13">其他博客或周刊推荐</h2>
<h3 data-id="heading-14">阮一峰的网络日志</h3>
<ul>
<li><a href="https://link.juejin.cn?target=http%3A%2F%2Fwww.ruanyifeng.com%2Fblog%2F2026%2F01%2Fweekly-issue-382.html" target="_blank" title="http://www.ruanyifeng.com/blog/2026/01/weekly-issue-382.html" ref="nofollow noopener noreferrer">科技爱好者周刊（第 382 期）：独立软件的黄昏</a> - 2026-01-23 08:13:47</li>
<li><a href="https://link.juejin.cn?target=http%3A%2F%2Fwww.ruanyifeng.com%2Fblog%2F2026%2F01%2Fai-native-workspace.html" target="_blank" title="http://www.ruanyifeng.com/blog/2026/01/ai-native-workspace.html" ref="nofollow noopener noreferrer">AI native Workspace 也许是智能体的下一阶段</a> - 2026-01-22 19:46:37</li>
<li><a href="https://link.juejin.cn?target=http%3A%2F%2Fwww.ruanyifeng.com%2Fblog%2F2026%2F01%2Fweekly-issue-381.html" target="_blank" title="http://www.ruanyifeng.com/blog/2026/01/weekly-issue-381.html" ref="nofollow noopener noreferrer">科技爱好者周刊（第 381 期）：中国 AI 大模型领导者在想什么</a> - 2026-01-16 08:13:47</li>
</ul>
<h3 data-id="heading-15">阿猫的博客</h3>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fameow.xyz%2Farchives%2Fweekly-091" target="_blank" title="https://ameow.xyz/archives/weekly-091" ref="nofollow noopener noreferrer">猫鱼周刊 vol. 091 2026 新年快乐</a> - 2026-01-18 21:09:56</li>
</ul>
<h3 data-id="heading-16">潮流周刊</h3>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fweekly.tw93.fun%2Fposts%2F255%2F" target="_blank" title="https://weekly.tw93.fun/posts/255/" ref="nofollow noopener noreferrer">第 255 期 - 好吃鸡翅</a> - 2026-01-26 08:00:00</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fweekly.tw93.fun%2Fposts%2F254%2F" target="_blank" title="https://weekly.tw93.fun/posts/254/" ref="nofollow noopener noreferrer">第 254 期 - 二零二六</a> - 2026-01-19 08:00:00</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fweekly.tw93.fun%2Fposts%2F253%2F" target="_blank" title="https://weekly.tw93.fun/posts/253/" ref="nofollow noopener noreferrer">第 253 期 - 爱无人机</a> - 2026-01-12 08:00:00</li>
</ul>
<h3 data-id="heading-17">二丫讲梵的学习周刊</h3>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwiki.eryajf.net%2Fpages%2Fd06784%2F" target="_blank" title="https://wiki.eryajf.net/pages/d06784/" ref="nofollow noopener noreferrer">学习周刊-总第 246 期-2026 年第 03 周</a> - 2026-01-15 20:56:42</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwiki.eryajf.net%2Fpages%2F12031d%2F" target="_blank" title="https://wiki.eryajf.net/pages/12031d/" ref="nofollow noopener noreferrer">学习周刊-总第 247 期-2026 年第 04 周</a> - 2026-01-22 21:26:13</li>
</ul>
<h2 data-id="heading-18">总结</h2>
<p>本周的更新和动态如上所示。感谢您的阅读！
您可以通过以下方式订阅草梅周报的更新：</p>
<ul>
<li><strong>博客</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmyr.ltd" target="_blank" title="https://blog.cmyr.ltd" ref="nofollow noopener noreferrer">草梅友仁的博客</a></li>
<li><strong>墨梅博客</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fmomei.app" target="_blank" title="https://momei.app" ref="nofollow noopener noreferrer">墨梅博客</a></li>
<li><strong>RSS</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmyr.ltd%2Fweekly.xml" target="_blank" title="https://blog.cmyr.ltd/weekly.xml" ref="nofollow noopener noreferrer">草梅周报</a></li>
<li><strong>公众号</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Foss.cmyr.dev%2Fimages%2F20241025184516839-21n2ctv.png" target="_blank" title="https://oss.cmyr.dev/images/20241025184516839-21n2ctv.png" ref="nofollow noopener noreferrer">草梅友仁的后花园</a></li>
<li><strong>邮箱订阅</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Flistmonk.cmyr.dev%2Fsubscription%2Fform" target="_blank" title="https://listmonk.cmyr.dev/subscription/form" ref="nofollow noopener noreferrer">草梅友仁的博客订阅</a></li>
</ul>
<p>本文作者：草梅友仁<br/>本文地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmyr.ltd%2Farchives%2F2026-04-caomei-weekly-momei-1-2-0-release-ai-development.html" target="_blank" title="https://blog.cmyr.ltd/archives/2026-04-caomei-weekly-momei-1-2-0-release-ai-development.html" ref="nofollow noopener noreferrer">blog.cmyr.ltd/archives/20…</a><br/>版权声明：本文采用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fcreativecommons.org%2Flicenses%2Fby-nc-sa%2F4.0%2Fdeed.zh-hans" target="_blank" title="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh-hans" ref="nofollow noopener noreferrer">CC BY-NC-SA 4.0 协议</a> 进行分发，转载请注明出处！<br/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ES 基本操作]]></title>    <link>https://juejin.cn/post/7598737609494790163</link>    <guid>https://juejin.cn/post/7598737609494790163</guid>    <pubDate>2026-01-25T15:36:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598737609494790163" data-draft-id="7598767580306292790" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ES 基本操作"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-25T15:36:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="左Python右Java"/> <meta itemprop="url" content="https://juejin.cn/user/4107431173952525"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ES 基本操作
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4107431173952525/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    左Python右Java
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-25T15:36:53.000Z" title="Sun Jan 25 2026 15:36:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><pre><code class="hljs language-bash" lang="bash">GET _search
{
  <span class="hljs-string">"query"</span>: {
    <span class="hljs-string">"match_all"</span>: {}
  }
}

<span class="hljs-comment"># 查看es的信息</span>
GET /

<span class="hljs-comment"># 新增索引库</span>
PUT /order
{
  <span class="hljs-string">"mappings"</span>: {
    <span class="hljs-string">"properties"</span>: {
      <span class="hljs-string">"info"</span>:{
        <span class="hljs-string">"type"</span>: <span class="hljs-string">"text"</span>,
        <span class="hljs-string">"analyzer"</span>: <span class="hljs-string">"ik_smart"</span>
      },
      <span class="hljs-string">"brand"</span>:{
        <span class="hljs-string">"type"</span>: <span class="hljs-string">"keyword"</span>
      }
    }
  }
}

<span class="hljs-comment"># 查询索引库</span>
GET /order
GET /shopping
GET /user

<span class="hljs-comment"># 删除索引库</span>
DELETE /order

<span class="hljs-comment"># 修改索引库,只能是新增字段</span>
PUT /order/_mapping
{
  <span class="hljs-string">"properties"</span>:{
    <span class="hljs-string">"number"</span>:{
      <span class="hljs-string">"type"</span>: <span class="hljs-string">"integer"</span>
    }
  }
}

<span class="hljs-comment"># 修改索引库，旧的字段报错</span>
PUT /order/_mapping
{
  <span class="hljs-string">"properties"</span>:{
    <span class="hljs-string">"number"</span>:{
      <span class="hljs-string">"type"</span>: <span class="hljs-string">"long"</span>
    }
  }
}


<span class="hljs-comment"># 插入文档</span>
POST /order/_doc/1
{
  <span class="hljs-string">"info"</span>:<span class="hljs-string">"华为Mate5"</span>,
  <span class="hljs-string">"brand"</span>:<span class="hljs-string">"华为"</span>,
  <span class="hljs-string">"number"</span>: 10000
}

<span class="hljs-comment"># 全量修改，如果文档存在，先删除，后新增</span>
PUT /order/_doc/2
{
  <span class="hljs-string">"info"</span>:<span class="hljs-string">"苹果16"</span>,
  <span class="hljs-string">"brand"</span>:<span class="hljs-string">"苹果"</span>,
  <span class="hljs-string">"number"</span>: 30000
}

<span class="hljs-comment"># 局部修改</span>
POST /order/_doc/1/_update
{
    <span class="hljs-string">"doc"</span>:{
        <span class="hljs-string">"number"</span>: 111
    }
}


<span class="hljs-comment">#查看文档</span>
GET /order/_doc/1

<span class="hljs-comment">#删除</span>
DELETE /order/_doc/2

<span class="hljs-comment">#查看文档</span>
GET /shopping/_doc/1001
GET /user/_doc/1

<span class="hljs-comment"># 测试分词</span>
POST  /_analyze
{
  <span class="hljs-string">"text"</span>:<span class="hljs-string">"站稳啦，要上高速啦，apple"</span>,
  <span class="hljs-string">"analyzer"</span>: <span class="hljs-string">"standard"</span>
}

POST  /_analyze
{
  <span class="hljs-string">"text"</span>:<span class="hljs-string">"站稳啦，要上高速啦，apple"</span>,
  <span class="hljs-string">"analyzer"</span>: <span class="hljs-string">"english"</span>
}

POST  /_analyze
{
  <span class="hljs-string">"text"</span>:<span class="hljs-string">"站稳啦，要上高速啦，apple"</span>,
  <span class="hljs-string">"analyzer"</span>: <span class="hljs-string">"ik_max_word"</span>
}

POST  /_analyze
{
  <span class="hljs-string">"text"</span>:<span class="hljs-string">"站稳啦，要上高速啦，apple"</span>,
  <span class="hljs-string">"analyzer"</span>: <span class="hljs-string">"ik_smart"</span>
}

</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[🤖 从零到一：如何将 AI 多模态项目拆解为可复用的 Skills 模块]]></title>    <link>https://juejin.cn/post/7598563188112556084</link>    <guid>https://juejin.cn/post/7598563188112556084</guid>    <pubDate>2026-01-25T14:46:38.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598563188112556084" data-draft-id="7598588085597683752" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="🤖 从零到一：如何将 AI 多模态项目拆解为可复用的 Skills 模块"/> <meta itemprop="keywords" content="前端,Vue.js,人工智能"/> <meta itemprop="datePublished" content="2026-01-25T14:46:38.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="编程干货铺"/> <meta itemprop="url" content="https://juejin.cn/user/52383084474680"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            🤖 从零到一：如何将 AI 多模态项目拆解为可复用的 Skills 模块
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/52383084474680/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    编程干货铺
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-25T14:46:38.000Z" title="Sun Jan 25 2026 14:46:38 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读12分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"/>
<p>最近完成了一个 AI 多模态应用项目，包含聊天、笔记、图像生成等功能。技术栈，前端采用 Vue3.5 ，后端采用 Node.js 的 Express 框架开发过程中，我发现很多功能模块在其他项目中也会用到。于是我开始思考：能否将这些功能封装成可复用的 Skills，让未来的项目开发更高效？经过实践和总结，我整理出了一套完整的模块化封装方案。今天分享给大家，希望能帮助到有类似需求的开发者。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9807d688ebf7448887103c584edc8bf7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg57yW56iL5bmy6LSn6ZO6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769957198&amp;x-signature=FvdFIg3ZprpQ5SkmAalCIC%2ByazE%3D" alt="87167886-be09-4656-875a-4f21afc0d71b.png" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-1">❓ 为什么需要封装 Skills？</h2>
<p>在开发 AI 应用时，我发现很多功能需要重新实现：用户认证、文件上传、流式响应处理... 这些功能在第一个项目中已经做过了，但代码散落在各处，难以复用。⚠️ 痛点：</p>
<ul>
<li>重复造轮子，开发效率低</li>
<li>代码质量参差不齐，维护成本高</li>
<li>前后端接口不统一，协作困难</li>
<li>最佳实践难以沉淀和复用</li>
</ul>
<p>✅ 解决方案：将功能按业务模块封装成 Skills，包含完整的前后端实现，开箱即用。</p>
<hr/>
<h2 data-id="heading-2">💡 我们的封装思路</h2>
<h2 data-id="heading-3">📜 核心原则</h2>
<ul>
<li>业务完整性：按业务功能模块拆分，包含完整的前后端实现</li>
<li>技术独立性：功能可独立使用，不依赖特定业务逻辑</li>
<li>接口一致性：前后端接口规范保持一致，便于协作</li>
<li>配置驱动：通过配置对象控制行为，而非硬编码</li>
</ul>
<h2 data-id="heading-4">🗂️ 模块划分策略</h2>
<p>我们将项目拆分为 10 个核心模块，每个模块都是完整的功能单元，可以独立使用，也可以组合使用。</p>
<hr/>
<h2 data-id="heading-5">🔍 核心模块详解</h2>
<h2 data-id="heading-6">🔐 Module 1: 用户认证与授权 - 每个应用的基础</h2>
<h3 data-id="heading-7">📖 场景</h3>
<p>几乎每个 Web 应用都需要用户系统，但每次都要从零开始实现认证逻辑。</p>
<h3 data-id="heading-8">📝 我们的方案</h3>
<h3 data-id="heading-9">⚙️ 后端实现：</h3>
<ul>
<li>JWT 认证系统：使用 JWT 生成 Token，存储在 HttpOnly Cookie 中，防止 XSS 攻击。支持 Token 刷新机制，用户无需频繁重新登录。</li>
<li>密码加密：使用 bcryptjs 加密密码，支持可配置的盐值轮数，确保密码安全。</li>
<li>智能提取：优先从 Cookie 获取 Token，其次从 Authorization Header，兼容多种场景。</li>
<li>统一响应：扩展 Express Response 对象，添加() 方法，统一响应格式为 {status, message, data}。</li>
</ul>
<h3 data-id="heading-10">🖥️ 前端实现：</h3>
<ul>
<li>状态管理：使用 Pinia 管理用户信息和认证状态，登录后自动更新全局状态。</li>
<li>请求拦截：在 axios 请求拦截器中自动添加 Token，检测到 401 错误时自动刷新 Token。</li>
<li>路由守卫：未登录用户自动跳转到登录页，登录后自动跳转到原访问页面。</li>
<li>记住登录：支持 "记住我" 功能，延长登录有效期，提升用户体验。</li>
</ul>
<h3 data-id="heading-11">📈 实际效果</h3>
<p>新项目集成认证模块只需 1 天，而不是 1 周统一的接口规范，前后端协作更顺畅安全机制完善，经过生产环境验证</p>
<hr/>
<h2 data-id="heading-12">💬 Module 2: AI 对话与流式响应 - 让 AI 对话更流畅</h2>
<h3 data-id="heading-13">📖 场景</h3>
<p>AI 对话应用需要实时显示 AI 回复，传统的请求 - 响应模式体验差，用户需要等待完整回复。</p>
<h3 data-id="heading-14">📝 我们的方案</h3>
<h3 data-id="heading-15">⚙️ 后端实现：</h3>
<ul>
<li>SSE 流式响应：使用 Server-Sent Events 技术，实时推送 AI 回复给前端。配置正确的响应头，禁用 Nginx 缓冲，确保数据实时传输。</li>
<li>缓冲区机制：解决流式数据分割导致的 JSON 解析问题，确保数据完整性。</li>
<li>多模型支持：支持快速模型和深度思考模型，根据场景动态切换。深度思考模型支持思维链展示，让用户了解 AI 的思考过程。</li>
<li>错误处理：网络错误、解析错误等情况通过 SSE 推送错误信息，前端可以实时处理。</li>
</ul>
<h3 data-id="heading-16">🖥️ 前端实现：</h3>
<ul>
<li>流式数据处理：使用 fetch API 建立 SSE 连接，解析流式数据，实现打字机效果。</li>
<li>多轮对话：自动构建包含完整对话历史的 messages 数组，最多保留最近 20 条消息，平衡上下文长度和性能。</li>
<li>Markdown 渲染：使用 MarkdownIt 解析 Markdown 语法，Prism.js 高亮代码块，支持一键复制。</li>
<li>虚拟滚动：使用虚拟滚动技术，仅渲染可视区域的消息，支持动态高度和分页加载。</li>
</ul>
<h3 data-id="heading-17">📈 实际效果</h3>
<p>AI 回复实时显示，用户体验大幅提升支持数万条消息的流畅滚动，性能优异代码高亮、表格优化等细节完善，专业感强</p>
<hr/>
<h2 data-id="heading-18">📤 Module 3: 文件上传与管理 - 安全可靠的文件处理</h2>
<h3 data-id="heading-19">📖 场景</h3>
<p>用户上传头像、图片、文档是常见需求，但文件验证、存储管理、安全防护等细节容易出错。</p>
<h3 data-id="heading-20">📝 我们的方案</h3>
<h3 data-id="heading-21">⚙️ 后端实现：</h3>
<ul>
<li>文件验证：使用 Multer 中间件，配置文件类型白名单、大小限制，防止恶意文件上传。</li>
</ul>

<ul>
<li>唯一文件名：时间戳 + 随机数 + 原始扩展名，确保文件名唯一，避免覆盖。</li>
</ul>

<ul>
<li>旧文件清理：上传新文件时自动删除旧文件，避免存储浪费。</li>
</ul>

<ul>
<li>路径管理：统一管理上传文件路径，按类型分类存储（avatars、images、documents），便于后续迁移。</li>
</ul>
<h3 data-id="heading-22">🖥️ 前端实现：</h3>
<ul>
<li>文件预览：上传前预览图片，支持裁剪和旋转，提升用户体验。</li>
<li>上传进度：显示上传进度条，支持取消功能，让用户了解上传状态。</li>
<li>多文件上传：支持批量上传，显示每个文件的上传状态，便于管理。</li>
<li>图片懒加载：使用 Intersection Observer 实现图片懒加载，优化首屏加载性能。</li>
</ul>
<h3 data-id="heading-23">📈 实际效果</h3>
<p>文件上传安全可靠，经过生产环境验证用户体验友好，支持预览、进度显示等功能存储管理规范，便于后续维护和迁移</p>
<hr/>
<h2 data-id="heading-24">📋 Module 4: 会话管理系统 - 多场景会话管理</h2>
<h3 data-id="heading-25">📖 场景</h3>
<p>聊天、笔记、图像生成等不同场景都需要会话管理，但每个场景的实现方式不同，难以统一。</p>
<h3 data-id="heading-26">📝 我们的方案</h3>
<h3 data-id="heading-27">⚙️ 后端实现：</h3>
<ul>
<li>多类型支持：使用 ENUM 类型定义会话类型（chat、note、image），统一管理不同场景的会话。</li>
<li>级联删除：删除会话时自动删除关联的消息、笔记、图片等数据，保证数据一致性。</li>
<li>分页查询：支持按类型筛选、分页查询，按时间倒序排列，提升查询效率。</li>
<li>会话统计：统计会话数量、消息数量等，支持数据分析。</li>
</ul>
<h3 data-id="heading-28">🖥️ 前端实现：</h3>
<ul>
<li>多模块支持：支持聊天、笔记、绘画三个模块，监听路由自动切换。</li>
<li>独立缓存：每个模块的会话列表独立缓存，互不干扰，提升切换速度。</li>
<li>智能选中：切换模块时优先使用缓存的选中 ID，缓存为空时选中第一个，提升用户体验。</li>
<li>状态持久化：当前会话 ID 持久化到 localStorage，页面刷新后恢复，保持用户操作连续性。</li>
</ul>
<h3 data-id="heading-29">📈 实际效果</h3>
<p>统一管理不同场景的会话，代码更简洁用户体验流畅，切换模块无卡顿状态管理完善，页面刷新后状态恢复</p>
<hr/>
<h2 data-id="heading-30">⭐ Module 5: 收藏系统 - 让用户轻松管理内容</h2>
<h3 data-id="heading-31">📖 场景</h3>
<p>用户需要收藏重要的聊天记录、图片等内容，但收藏功能涉及批量操作、分组展示等复杂逻辑。</p>
<h3 data-id="heading-32">📝 我们的方案</h3>
<h3 data-id="heading-33">⚙️ 后端实现：</h3>
<ul>
<li>批量收藏：支持批量标记收藏，生成统一的批次 ID（UUID），便于后续管理和统计。</li>
<li>批次管理：使用批次 ID 关联同一批收藏的内容，支持按批次查询和删除。</li>
<li>统一接口：提供统一的收藏接口，支持不同类型的内容（消息、图片等）。</li>
<li>收藏统计：统计收藏数量、批次数量等，支持热门内容推荐。</li>
</ul>
<h3 data-id="heading-34">🖥️ 前端实现：</h3>
<ul>
<li>批量选择：点击收藏按钮进入选择模式，显示复选框，支持多选。</li>
<li>分组展示：按收藏批次分组，使用折叠面板展示，便于用户管理。</li>
<li>搜索过滤：支持按内容搜索，实时过滤展示，提升查找效率。</li>
<li>状态同步：收藏状态变更时同步更新 UI 和全局状态，保证数据一致性。</li>
</ul>
<h3 data-id="heading-35">📈 实际效果</h3>
<p>收藏功能完善，支持批量操作和分组展示用户体验友好，查找和管理收藏内容便捷数据统计完善，支持热门内容推荐</p>
<hr/>
<h2 data-id="heading-36">✍️ Module 6: 提示词管理系统 - AI 应用的效率工具</h2>
<h3 data-id="heading-37">📖 场景</h3>
<p>AI 应用需要频繁使用提示词，但每次都要手动输入，效率低。用户希望有提示词库，快速复用常用提示词。</p>
<h3 data-id="heading-38">📝 我们的方案</h3>
<h3 data-id="heading-39">⚙️ 后端实现：</h3>
<ul>
<li>分类管理：支持创建、删除、查询提示词分类，便于用户组织提示词。</li>
<li>批量操作：支持批量添加、更新、删除提示词，提升管理效率。</li>
<li>使用统计：记录提示词使用次数、最后使用时间，支持热门推荐。</li>
<li>搜索功能：支持按标题和内容搜索提示词，支持模糊匹配。</li>
</ul>
<h3 data-id="heading-40">🖥️ 前端实现：</h3>
<ul>
<li>提示词面板：监听输入框输入，检测斜杠字符（/）触发面板，展示提示词列表。</li>
<li>实时搜索：支持按标题和内容搜索，实时过滤，提升查找效率。</li>
<li>键盘导航：支持上下箭头键导航，回车键选择，提升操作效率。</li>
<li>快速插入：选择提示词后自动插入到输入框，删除斜杠，无缝体验。</li>
</ul>
<h3 data-id="heading-41">📈 实际效果</h3>
<p>提示词使用效率大幅提升，用户满意度高支持分类管理和搜索，便于组织大量提示词使用统计完善，支持热门推荐，提升用户体验</p>
<hr/>
<h2 data-id="heading-42">📓 Module 7: 笔记管理系统 - 完整的写作工具</h2>
<h3 data-id="heading-43">📖 场景</h3>
<p>用户需要写笔记，但传统的文本编辑器功能单一，缺乏 AI 辅助、语音输入等现代功能。</p>
<h3 data-id="heading-44">📝 我们的方案</h3>
<h3 data-id="heading-45">⚙️ 后端实现：</h3>
<ul>
<li>笔记管理：支持创建、查询、更新、删除笔记，关联笔记会话，支持软删除。</li>
<li>AI 辅助写作：支持润色、摘要、翻译、续写四种操作类型，使用 SSE 流式返回 AI 生成内容。</li>
<li>语音识别：使用 WebSocket 连接语音识别服务，支持实时语音转文字，插入到笔记中。</li>
</ul>
<h3 data-id="heading-46">🖥️ 前端实现：</h3>
<ul>
<li>富文本编辑器：集成 WangEditor，支持丰富的文本编辑功能，自定义菜单扩展 AI 功能。</li>
<li>AI 写作助手：支持快捷键触发（Ctrl+Alt），根据选中文本、光标位置准备 AI 输入，流式插入生成内容。</li>
<li>语音识别：使用 AudioWorklet 处理音频，实时转换为 PCM 格式，通过 WebSocket 传输，识别结果插入编辑器。</li>
<li>自动保存：监听编辑器内容变化，2 秒后自动保存，避免数据丢失。</li>
</ul>
<h3 data-id="heading-47">📈 实际效果</h3>
<p>笔记功能完善，支持 AI 辅助和语音输入用户体验流畅，自动保存、流式插入等功能完善编辑器功能丰富，满足专业写作需求</p>
<hr/>
<h2 data-id="heading-48">🎨 Module 8: AI 图像生成 - 让创作更简单</h2>
<h3 data-id="heading-49">📖 场景</h3>
<p>用户需要生成 AI 图片，但参数配置复杂，生成的图片需要管理和分享。</p>
<h3 data-id="heading-50">📝 我们的方案</h3>
<h3 data-id="heading-51">⚙️ 后端实现：</h3>
<ul>
<li>图像生成：集成豆包 Seedream 4.0 图像生成 API，支持多种尺寸和风格参数。</li>
<li>图片管理：下载生成的图片到本地，记录图像信息到数据库，关联会话和用户。</li>
<li>收藏功能：支持收藏和取消收藏图像，支持按用户查询收藏的图像。</li>
</ul>
<h3 data-id="heading-52">🖥️ 前端实现：</h3>
<ul>
<li>对话式交互：使用对话界面展示用户输入和 AI 回复，生成过程可视化。</li>
<li>参数配置：支持选择图片尺寸（1:1、3:4、16:9、4:3）和风格（写实、科幻、现代、幻想），配置简单直观。</li>
<li>图片展示：展示生成的图片，支持放大查看，图片懒加载优化性能。</li>
<li>分享功能：生成分享卡片，包含图片、提示词、风格、时间等信息，支持复制到剪贴板。</li>
</ul>
<h3 data-id="heading-53">📈 实际效果</h3>
<p>图像生成流程顺畅，用户体验友好参数配置简单，支持多种尺寸和风格图片管理和分享功能完善，满足用户需求</p>
<hr/>
<h2 data-id="heading-54">🔊 Module 9: 语音功能 - 让交互更自然</h2>
<h3 data-id="heading-55">📖 场景</h3>
<p>用户需要语音输入和语音朗读功能，但音频处理复杂，需要处理格式转换、流式传输等问题。</p>
<h3 data-id="heading-56">📝 我们的方案</h3>
<h3 data-id="heading-57">⚙️ 后端实现：</h3>
<ul>
<li>语音合成（TTS）：使用 WebSocket 连接火山引擎 TTS，实时音频数据流式写入响应，不缓存，O (1) 内存。</li>
<li>语音识别（ASR）：使用适配器模式，作为客户端和服务端的桥梁，处理协议转换，支持实时语音识别。</li>
</ul>
<h3 data-id="heading-58">🖥️ 前端实现：</h3>
<ul>
<li>语音朗读：Audio src 指向流式接口，浏览器自动流式加载，支持播放 / 暂停 / 恢复。使用文本 Hash 作为缓存 key，缓存最近 10 个音频，同样内容秒级播放。</li>
<li>语音识别：使用 AudioWorklet 处理音频，实时转换为 PCM 格式，通过 WebSocket 传输，识别结果实时显示，插入到输入框或编辑器。</li>
</ul>
<h3 data-id="heading-59">📈 实际效果</h3>
<p>语音功能完善，支持实时识别和流式播放智能缓存机制，提升用户体验音频处理高效，性能优异</p>
<hr/>
<h2 data-id="heading-60">📤 Module 10: 内容导出与分享 - 让内容传播更便捷</h2>
<h3 data-id="heading-61">📖 场景</h3>
<p>用户需要导出聊天记录、笔记等内容，但导出功能复杂，需要支持多种格式和水印保护。</p>
<h3 data-id="heading-62">📝 我们的方案</h3>
<h3 data-id="heading-63">⚙️ 后端实现：</h3>
<ul>
<li>内容导出：支持导出为文本、Markdown、HTML 等格式，支持批量导出。</li>
<li>分享链接：生成分享链接，支持设置有效期和访问权限。</li>
</ul>
<h3 data-id="heading-64">🖥️ 前端实现：</h3>
<ul>
<li>批量导出：支持多选聊天记录，预览后导出为图片或文档。</li>
<li>防篡改水印：使用 Canvas 生成水印，MutationObserver 监听 DOM 变化，检测到删除或修改时 100ms 内自动恢复。</li>
<li>分享卡片：生成分享卡片，使用 html2canvas 转换为图片，支持复制到剪贴板。</li>
</ul>
<h3 data-id="heading-65">📈 实际效果</h3>
<p>导出功能完善，支持多种格式水印保护机制完善，防止内容被删除分享功能便捷，支持一键复制</p>
<h5 data-id="heading-66">多模态AI应用设计图，右下角可以扫码了解：</h5>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/481cbf65366a432fba96b5901f5f6195~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg57yW56iL5bmy6LSn6ZO6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769957198&amp;x-signature=JShiNdnLz%2FZAWezf8qtDlgH4Vx8%3D" alt="设计图（带二维码）.png" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Git 任务切换血泪指南：从手忙脚乱到勉强拿捏]]></title>    <link>https://juejin.cn/post/7599017594519601178</link>    <guid>https://juejin.cn/post/7599017594519601178</guid>    <pubDate>2026-01-25T14:52:14.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599017594519601178" data-draft-id="7598921649888657435" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Git 任务切换血泪指南：从手忙脚乱到勉强拿捏"/> <meta itemprop="keywords" content="Git,前端,后端"/> <meta itemprop="datePublished" content="2026-01-25T14:52:14.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="再学一点就睡Orz"/> <meta itemprop="url" content="https://juejin.cn/user/671151992348125"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Git 任务切换血泪指南：从手忙脚乱到勉强拿捏
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/671151992348125/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    再学一点就睡Orz
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-25T14:52:14.000Z" title="Sun Jan 25 2026 14:52:14 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读19分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在日常开发中，我们常需临时切换分支处理紧急需求、并行开发多任务。本文系统整理了 Git 切换任务的常用方法，涵盖不同场景的适配方案、操作细节及最佳实践，帮你高效应对各类任务切换场景。</p>
<hr/>
<h2 data-id="heading-0">方法一览</h2>








































<table><thead><tr><th>方法</th><th>核心思路</th><th>适用场景</th></tr></thead><tbody><tr><td>git stash</td><td>暂存修改到本地栈中</td><td>短暂切换（分钟级，临时查看/修小问题）</td></tr><tr><td>git commit</td><td>提交半成品为临时记录</td><td>中长期切换（小时/天级，跨时段开发）</td></tr><tr><td>git worktree</td><td>多目录共享仓库并行检出</td><td>长期并行开发（多任务同步推进）</td></tr><tr><td>git clone</td><td>克隆多份独立仓库副本</td><td>完全隔离环境（需独立配置/测试破坏性操作）</td></tr><tr><td>git branch + reset</td><td>保存进度到临时分支</td><td>需保留分支级进度记录（团队协作分享进度）</td></tr><tr><td>Patch 文件</td><td>导出修改为独立文件</td><td>跨仓库/跨机器迁移修改（无网络/离线传输）</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-1">一、git stash - 临时暂存修改</h2>
<h3 data-id="heading-2">核心原理</h3>
<p>将当前工作区、暂存区的未提交修改，临时保存到 Git 内置的栈结构中，同时将工作区恢复至干净状态（与最近一次提交一致），方便快速切换分支。</p>
<h3 data-id="heading-3">完整操作指南</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 基础暂存（无描述，不推荐）</span>
git stash

<span class="hljs-comment"># 带描述暂存（推荐，便于后续识别）</span>
git stash save <span class="hljs-string">"feat: 用户登录 - 完成表单验证逻辑"</span>
<span class="hljs-comment"># 新版语法（更灵活，支持部分暂存等参数）</span>
git stash push -m <span class="hljs-string">"feat: 用户登录 - 完成表单验证逻辑"</span>

<span class="hljs-comment"># 暂存未跟踪文件（新创建未add的文件）</span>
git stash -u  <span class="hljs-comment"># 简写</span>
git stash --include-untracked  <span class="hljs-comment"># 完整写法</span>

<span class="hljs-comment"># 暂存所有文件（含.gitignore忽略的文件，如日志、依赖包）</span>
git stash -a  <span class="hljs-comment"># 简写</span>
git stash --all  <span class="hljs-comment"># 完整写法</span>

<span class="hljs-comment"># 交互式部分暂存（按需选择要暂存的文件/代码块）</span>
git stash -p  <span class="hljs-comment"># 简写</span>
git stash --patch  <span class="hljs-comment"># 完整写法</span>

<span class="hljs-comment"># 查看暂存列表（所有已暂存的进度记录）</span>
git stash list

<span class="hljs-comment"># 查看指定暂存的内容（stash@{0}为最近一次暂存，数字递增）</span>
git stash show stash@{0}  <span class="hljs-comment"># 显示简要变更统计</span>
git stash show -p stash@{0}  <span class="hljs-comment"># 显示详细diff（推荐，查看具体修改内容）</span>

<span class="hljs-comment"># 恢复暂存内容</span>
git stash pop  <span class="hljs-comment"># 恢复最近一次暂存，并从栈中删除该记录</span>
git stash apply  <span class="hljs-comment"># 恢复最近一次暂存，保留栈中记录（可多次复用）</span>

<span class="hljs-comment"># 恢复指定暂存（适用于多暂存场景）</span>
git stash pop stash@{2}
git stash apply stash@{2}

<span class="hljs-comment"># 删除暂存记录</span>
git stash drop stash@{0}  <span class="hljs-comment"># 删除指定暂存</span>
git stash clear  <span class="hljs-comment"># 清空所有暂存记录（谨慎使用）</span>

<span class="hljs-comment"># 从暂存创建分支（解决恢复时冲突的最优方案）</span>
git stash branch feature/login-fix stash@{0}
</code></pre>
<h3 data-id="heading-4">优缺点分析</h3>

























<table><thead><tr><th>优点</th><th>缺点</th></tr></thead><tbody><tr><td>操作简洁快速，适合临时切换</td><td>仅支持单目录工作，无法并行操作</td></tr><tr><td>不产生冗余提交，保持分支历史干净</td><td>恢复时可能与目标分支产生冲突</td></tr><tr><td>支持多暂存栈管理，可保留多个进度</td><td>暂存仅存储本地，无法远程备份（本地故障易丢失）</td></tr><tr><td>支持交互式部分暂存，灵活度高</td><td>暂存过多时易混乱，需依赖清晰描述区分</td></tr></tbody></table>
<h3 data-id="heading-5">最佳实践</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 暂存必带描述，明确业务场景和进度</span>
git stash push -m <span class="hljs-string">"feat: 用户登录 - 完成表单验证，待联调接口"</span>

<span class="hljs-comment"># 2. 定期清理过期暂存，避免堆积</span>
git stash list  <span class="hljs-comment"># 先查看所有暂存</span>
git stash drop stash@{5}  <span class="hljs-comment"># 删除5天前的过期暂存</span>

<span class="hljs-comment"># 3. 恢复前先验证暂存内容，避免误操作</span>
git stash show -p stash@{0}  <span class="hljs-comment"># 确认修改内容</span>
git stash pop  <span class="hljs-comment"># 确认无误后恢复</span>
</code></pre>
<hr/>
<h2 data-id="heading-6">二、git commit - 提交半成品暂存</h2>
<h3 data-id="heading-7">核心原理</h3>
<p>将当前未完成的修改，以 WIP（Work In Progress，工作中）为前缀提交为临时记录，使工作区干净可切换分支。后续完成开发后，通过改写提交、合并提交等方式整理分支历史，保证历史记录的整洁性。</p>
<h3 data-id="heading-8">完整操作指南</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 提交半成品（统一前缀WIP，便于后续识别整理）</span>
git add .  <span class="hljs-comment"># 暂存所有修改（也可按需add指定文件）</span>
git commit -m <span class="hljs-string">"WIP: 用户登录功能 - 开发中（完成表单与验证）"</span>

<span class="hljs-comment"># 2. 切换分支处理其他任务</span>
git checkout hotfix/online-bug  <span class="hljs-comment"># 切换到线上bug修复分支</span>
<span class="hljs-comment"># ... 完成bug修复并提交 ...</span>
git checkout feature/login  <span class="hljs-comment"># 切回原开发分支</span>

<span class="hljs-comment"># 3. 继续开发后，整理临时提交（5种常用方式）</span>
<span class="hljs-comment"># 方式1：改写最后一次提交（适用于仅需补充修改，无需新增记录）</span>
git add .
git commit --amend -m <span class="hljs-string">"feat: 完成用户登录功能（含表单验证与接口联调）"</span>

<span class="hljs-comment"># 方式2：追加修改到最后一次提交（不改写提交信息）</span>
git add .
git commit --amend --no-edit

<span class="hljs-comment"># 方式3：交互式合并多个临时提交（适用于多个WIP提交，需整理为一个完整提交）</span>
git rebase -i HEAD~3  <span class="hljs-comment"># HEAD~3表示合并最近3次提交（按需调整数字）</span>
<span class="hljs-comment"># 编辑器中操作（按i进入编辑模式，修改指令后按ESC+:wq保存退出）：</span>
<span class="hljs-comment"># pick abc1234 WIP: 开始开发用户登录</span>
<span class="hljs-comment"># squash def5678 WIP: 完成表单验证</span>
<span class="hljs-comment"># squash ghi9012 WIP: 联调接口完成</span>
<span class="hljs-comment"># 保存后进入提交信息编辑页，整合为完整描述</span>

<span class="hljs-comment"># 方式4：软重置后重新提交（适用于需彻底重构提交内容）</span>
git reset --soft HEAD~3  <span class="hljs-comment"># 回到3次提交前的状态（修改仍保留在工作区）</span>
git add .
git commit -m <span class="hljs-string">"feat: 完成用户登录功能（表单验证+接口联调+异常处理）"</span>

<span class="hljs-comment"># 方式5：fixup自动合并（适用于快速合并到目标提交，丢弃临时信息）</span>
git commit --fixup=HEAD~2  <span class="hljs-comment"># 将当前修改合并到倒数第2次提交</span>
git rebase -i --autosquash HEAD~3  <span class="hljs-comment"># 自动整理提交（无需手动调整顺序）</span>
</code></pre>
<h3 data-id="heading-9">交互式 Rebase 指令说明</h3>
<p>执行 <code>git rebase -i</code> 后，编辑器中支持以下指令，用于整理提交历史：</p>
<pre><code class="hljs language-bash" lang="bash">pick   = 保留该提交（默认指令）
reword = 保留提交内容，修改提交信息
edit   = 保留提交，暂停rebase过程以便补充修改
squash = 合并到上一个提交，保留该提交的信息
fixup  = 合并到上一个提交，丢弃该提交的信息（仅保留内容）
drop   = 删除该提交
</code></pre>
<h3 data-id="heading-10">优缺点分析</h3>

























<table><thead><tr><th>优点</th><th>缺点</th></tr></thead><tbody><tr><td>提交记录可远程推送备份，数据安全度高</td><td>产生临时提交，需后续手动整理历史</td></tr><tr><td>支持长时间跨分支切换，进度不易丢失</td><td>Rebase 操作有学习成本，新手易出错</td></tr><tr><td>可分享临时进度给团队成员，便于协作</td><td>已推送到远程的临时提交，整理后需强制推送（影响团队协作）</td></tr><tr><td>提交历史可灵活整理，最终保持整洁</td><td>临时提交过多时，整理效率较低</td></tr></tbody></table>
<h3 data-id="heading-11">最佳实践</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 临时提交统一规范前缀，便于批量识别</span>
git commit -m <span class="hljs-string">"WIP: [用户登录] 表单验证开发中"</span>
git commit -m <span class="hljs-string">"WIP: [订单模块] 支付流程联调中"</span>

<span class="hljs-comment"># 2. 开发完成后一次性整理，避免频繁操作</span>
git rebase -i HEAD~n  <span class="hljs-comment"># n为临时提交数量，按需调整</span>

<span class="hljs-comment"># 3. 团队协作时，优先使用fixup+autosquash，提高整理效率</span>
git commit --fixup=&lt;目标提交哈希&gt;
git rebase -i --autosquash HEAD~n
</code></pre>
<hr/>
<h2 data-id="heading-12">三、git worktree - 多目录并行开发</h2>
<h3 data-id="heading-13">核心原理</h3>
<p>在文件系统中创建多个独立工作目录，所有目录共享同一个 .git 仓库（避免重复存储），每个目录可检出不同分支，实现多任务并行开发，无需频繁暂存/提交修改。</p>
<h3 data-id="heading-14">完整操作指南</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 添加worktree（检出已有分支到指定目录）</span>
git worktree add &lt;目录路径&gt; &lt;分支名&gt;
<span class="hljs-comment"># 示例：在上级目录创建hotfix分支的工作目录</span>
git worktree add ../project-hotfix hotfix/online-01

<span class="hljs-comment"># 2. 添加worktree并创建新分支</span>
git worktree add -b &lt;新分支名&gt; &lt;目录路径&gt; [起始分支]
<span class="hljs-comment"># 示例：基于main分支创建登录功能分支的worktree</span>
git worktree add -b feature/login ../project-login main

<span class="hljs-comment"># 3. 检出特定提交（脱离分支，仅用于查看/测试历史版本）</span>
git worktree add --detach &lt;目录路径&gt; &lt;提交哈希/标签&gt;
<span class="hljs-comment"># 示例：检出v1.0.0版本查看历史代码</span>
git worktree add --detach ../project-v1.0 v1.0.0

<span class="hljs-comment"># 4. 查看所有worktree（含路径、分支、状态）</span>
git worktree list
git worktree list --porcelain  <span class="hljs-comment"># 机器可读格式（脚本自动化用）</span>

<span class="hljs-comment"># 5. 删除worktree（工作完成后清理）</span>
git worktree remove &lt;目录路径&gt;
<span class="hljs-comment"># 示例：删除hotfix分支的worktree</span>
git worktree remove ../project-hotfix

<span class="hljs-comment"># 6. 强制删除（目录内有未提交修改时）</span>
git worktree remove --force ../project-hotfix

<span class="hljs-comment"># 7. 移动worktree目录（调整存储路径）</span>
git worktree move &lt;原路径&gt; &lt;新路径&gt;

<span class="hljs-comment"># 8. 清理无效worktree记录（目录被手动删除后，清理残留记录）</span>
git worktree prune

<span class="hljs-comment"># 9. 锁定/解锁worktree（防止误删除/清理）</span>
git worktree lock &lt;目录路径&gt;  <span class="hljs-comment"># 锁定</span>
git worktree unlock &lt;目录路径&gt;  <span class="hljs-comment"># 解锁</span>
</code></pre>
<h3 data-id="heading-15">典型目录结构</h3>
<pre><code class="hljs language-text" lang="text">~/projects/
├── my-project/          # 主工作目录（检出main分支）
│   ├── .git/            # 所有worktree共享的Git仓库
│   └── src/             # 业务代码目录
├── my-project-hotfix/   # Worktree目录（检出hotfix分支）
│   └── src/             # 独立开发hotfix，不影响主目录
└── my-project-login/    # Worktree目录（检出feature/login分支）
    └── src/             # 并行开发登录功能
</code></pre>
<h3 data-id="heading-16">优缺点分析</h3>

























<table><thead><tr><th>优点</th><th>缺点</th></tr></thead><tbody><tr><td>多目录并行开发，无需暂存/提交</td><td>每个worktree占用独立磁盘空间（重复存储代码文件）</td></tr><tr><td>共享.git仓库，节省存储资源</td><td>同一分支无法在多个worktree中同时检出</td></tr><tr><td>切换任务仅需切换目录，效率极高</td><td>需管理多个目录，路径切换略繁琐</td></tr><tr><td>各目录环境独立，互不影响</td><td>初次使用需熟悉指令，有一定学习成本</td></tr></tbody></table>
<h3 data-id="heading-17">最佳实践</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 目录命名规范，关联分支用途（便于识别）</span>
git worktree add ../project-hotfix-01 hotfix/online-01
git worktree add ../project-feat-login feature/login

<span class="hljs-comment"># 2. 任务完成后及时清理，避免目录堆积</span>
git worktree remove ../project-hotfix-01
git worktree prune  <span class="hljs-comment"># 清理残留记录</span>

<span class="hljs-comment"># 3. 定期查看worktree状态，掌握所有并行任务</span>
git worktree list
</code></pre>
<hr/>
<h2 data-id="heading-18">四、git clone - 多仓库独立部署</h2>
<h3 data-id="heading-19">核心原理</h3>
<p>直接克隆多份完整的仓库副本，每份副本拥有独立的 .git 仓库、工作区及配置，完全隔离互不影响。适合需要独立环境配置、测试破坏性操作的场景。</p>
<h3 data-id="heading-20">完整操作指南</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 从远程仓库克隆多份（不同目录名区分）</span>
git <span class="hljs-built_in">clone</span> git@github.com:user/my-project.git project-main  <span class="hljs-comment"># 主仓库（main分支）</span>
git <span class="hljs-built_in">clone</span> git@github.com:user/my-project.git project-hotfix  <span class="hljs-comment"># hotfix专用仓库</span>

<span class="hljs-comment"># 2. 从本地仓库克隆（速度更快，避免重复拉取远程代码）</span>
git <span class="hljs-built_in">clone</span> ./project-main ./project-hotfix

<span class="hljs-comment"># 3. 浅克隆（仅拉取最新版本代码，节省磁盘空间和时间）</span>
git <span class="hljs-built_in">clone</span> --depth 1 git@github.com:user/my-project.git project-quick
<span class="hljs-comment"># 浅克隆仅含最近1次提交，如需完整历史可补充拉取</span>
git fetch --unshallow
</code></pre>
<h3 data-id="heading-21">优缺点分析</h3>

























<table><thead><tr><th>优点</th><th>缺点</th></tr></thead><tbody><tr><td>环境完全独立，无相互影响风险</td><td>多份仓库占用大量磁盘空间（重复存储.git和代码）</td></tr><tr><td>可配置不同远程仓库/用户名，灵活度高</td><td>需分别拉取/推送代码，同步成本高</td></tr><tr><td>操作简单直接，无需学习复杂指令</td><td>分支状态不共享，需手动同步进度</td></tr><tr><td>支持测试破坏性操作（如强制重置、删除分支）</td><td>管理成本高，多仓库切换繁琐</td></tr></tbody></table>
<h3 data-id="heading-22">适用场景</h3>
<ul>
<li>需要独立配置（如不同环境变量、依赖版本）的开发场景；</li>
<li>测试破坏性操作（如重构分支、强制合并），避免影响主开发环境；</li>
<li>多账号开发（如同时使用个人账号和工作账号操作同一仓库）。</li>
</ul>
<hr/>
<h2 data-id="heading-23">五、git branch + reset - 临时分支保存进度</h2>
<h3 data-id="heading-24">核心原理</h3>
<p>创建临时分支保存当前开发进度（含未提交修改），然后将原分支重置到干净状态以切换任务。后续可通过合并、拣选提交等方式，将临时分支的进度恢复到原分支，保留完整的分支进度记录。</p>
<h3 data-id="heading-25">完整操作指南</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 方法一：完整流程（保留详细记录）</span>
git stash  <span class="hljs-comment"># 暂存未提交修改</span>
git branch temp-save-$(<span class="hljs-built_in">date</span> +%Y%m%d)  <span class="hljs-comment"># 创建带日期的临时分支（避免命名冲突）</span>
git stash pop  <span class="hljs-comment"># 恢复暂存内容</span>
git add .  <span class="hljs-comment"># 暂存所有修改</span>
git commit -m <span class="hljs-string">"temp: 保存用户登录开发进度（表单验证完成）"</span>
git checkout main  <span class="hljs-comment"># 切换到其他分支处理任务</span>
<span class="hljs-comment"># ... 完成其他任务后 ...</span>
git checkout feature/login  <span class="hljs-comment"># 切回原开发分支</span>
git cherry-pick temp-save-20240124  <span class="hljs-comment"># 拣选临时分支的进度</span>
git branch -D temp-save-20240124  <span class="hljs-comment"># 清理临时分支</span>

<span class="hljs-comment"># 方法二：简化流程（快速备份）</span>
git checkout -b temp-backup  <span class="hljs-comment"># 创建并切换到临时分支</span>
git add .  <span class="hljs-comment"># 暂存所有修改</span>
git commit -m <span class="hljs-string">"temp: 备份用户登录开发进度"</span>
git checkout feature/login  <span class="hljs-comment"># 切回原分支</span>
git reset --hard HEAD~1  <span class="hljs-comment"># 重置到提交前状态（干净工作区）</span>
<span class="hljs-comment"># ... 完成其他任务后 ...</span>
git merge temp-backup  <span class="hljs-comment"># 合并临时分支进度</span>
git branch -D temp-backup  <span class="hljs-comment"># 清理临时分支</span>
</code></pre>
<h3 data-id="heading-26">优缺点分析</h3>

























<table><thead><tr><th>优点</th><th>缺点</th></tr></thead><tbody><tr><td>进度以分支形式存储，可远程推送备份</td><td>操作步骤较多，比stash繁琐</td></tr><tr><td>支持拣选、合并等操作，灵活复用进度</td><td>产生临时分支，需手动清理避免堆积</td></tr><tr><td>分支记录清晰，便于团队协作分享进度</td><td>合并/拣选时可能产生冲突，需手动解决</td></tr><tr><td>可保留细分进度，便于回溯</td><td>不适合频繁临时切换（效率低）</td></tr></tbody></table>
<h3 data-id="heading-27">适用场景</h3>
<ul>
<li>需要保留分支级进度记录，便于后续回溯或复盘；</li>
<li>团队协作中，需将未完成进度分享给其他成员；</li>
<li>进度需在多个分支中复用（如跨分支同步功能片段）。</li>
</ul>
<hr/>
<h2 data-id="heading-28">六、Patch 文件 - 跨环境迁移修改</h2>
<h3 data-id="heading-29">核心原理</h3>
<p>将工作区、暂存区的修改或指定提交，导出为独立的 Patch 文件（文本格式，含代码变更细节），通过文件传输（邮件、U盘等）在不同仓库、不同机器间迁移修改，无需依赖 Git 远程仓库。</p>
<h3 data-id="heading-30">完整操作指南</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 一、导出Patch文件</span>
<span class="hljs-comment"># 1. 导出工作区未提交修改（不含暂存区）</span>
git diff &gt; my-changes.patch

<span class="hljs-comment"># 2. 导出暂存区已add的修改</span>
git diff --cached &gt; staged-changes.patch

<span class="hljs-comment"># 3. 导出工作区+暂存区的所有修改（相对于最近一次提交）</span>
git diff HEAD &gt; all-changes.patch

<span class="hljs-comment"># 4. 导出指定提交为Patch（含提交信息，推荐）</span>
git format-patch -1 &lt;提交哈希&gt;  <span class="hljs-comment"># 导出单个提交</span>
git format-patch HEAD~3..HEAD  <span class="hljs-comment"># 导出最近3次提交（生成3个Patch文件）</span>

<span class="hljs-comment"># 二、应用Patch文件</span>
<span class="hljs-comment"># 1. 应用普通Patch（仅导入代码修改，不保留提交信息）</span>
git apply my-changes.patch

<span class="hljs-comment"># 2. 应用format-patch生成的Patch（保留提交信息，推荐）</span>
git am &lt; 0001-feat-login-form-validation.patch

<span class="hljs-comment"># 3. 验证Patch可用性（检查是否可正常应用，无冲突）</span>
git apply --check my-changes.patch

<span class="hljs-comment"># 4. 查看Patch变更统计（了解修改范围）</span>
git apply --<span class="hljs-built_in">stat</span> my-changes.patch

<span class="hljs-comment"># 5. 部分应用Patch（按需选择修改片段）</span>
git apply -p1 --include=<span class="hljs-string">"src/login/**"</span> my-changes.patch
</code></pre>
<h3 data-id="heading-31">优缺点分析</h3>

























<table><thead><tr><th>优点</th><th>缺点</th></tr></thead><tbody><tr><td>跨仓库/跨机器迁移，不依赖Git远程连接</td><td>操作繁琐，需手动导出/传输/应用</td></tr><tr><td>支持离线传输（邮件、U盘等），适配无网络场景</td><td>代码差异较大时易产生冲突，排查复杂</td></tr><tr><td>可部分应用修改，灵活度高</td><td>不适合大量修改（Patch文件过大，管理不便）</td></tr><tr><td>format-patch可保留提交信息，便于复用</td><td>对二进制文件支持较差，易丢失信息</td></tr></tbody></table>
<h3 data-id="heading-32">适用场景</h3>
<ul>
<li>跨仓库迁移修改（如从个人仓库同步到公司仓库）；</li>
<li>无网络环境下，在不同机器间传输代码修改；</li>
<li>邮件列表式代码审查（通过Patch分享修改内容）；</li>
<li>备份重要修改到非Git系统（如本地文件服务器）。</li>
</ul>
<hr/>
<h2 data-id="heading-33">七、方法对比与场景选型</h2>
<h3 data-id="heading-34">按场景快速选型</h3>


















































<table><thead><tr><th>业务场景</th><th>推荐方法</th><th>核心原因</th></tr></thead><tbody><tr><td>临时查看其他分支（5分钟内完成）</td><td>git stash</td><td>操作最快，无需额外整理</td></tr><tr><td>紧急修复线上小Bug（30分钟内完成）</td><td>git stash</td><td>简单高效，切换后可快速恢复进度</td></tr><tr><td>跨天/跨时段切换任务（需备份进度）</td><td>git commit</td><td>可远程备份，进度不易丢失，后续可整理历史</td></tr><tr><td>多任务并行开发（需同时运行多个版本）</td><td>git worktree</td><td>多目录独立运行，无需频繁暂存/提交</td></tr><tr><td>频繁切换多个功能分支（高效迭代）</td><td>git worktree</td><td>切换仅需换目录，效率远超其他方法</td></tr><tr><td>需要完全隔离的开发/测试环境</td><td>git clone</td><td>环境独立，无相互影响，支持破坏性测试</td></tr><tr><td>跨机器/跨仓库迁移修改（无网络）</td><td>Patch文件</td><td>离线传输，不依赖Git远程连接</td></tr><tr><td>需保留分支级进度记录（团队协作）</td><td>git branch + reset</td><td>进度可分享，便于回溯和复用</td></tr></tbody></table>
<h3 data-id="heading-35">按核心特性对比</h3>




































































<table><thead><tr><th>特性</th><th>stash</th><th>commit</th><th>worktree</th><th>clone</th><th>branch+reset</th><th>patch</th></tr></thead><tbody><tr><td>操作复杂度</td><td>低</td><td>中</td><td>中</td><td>低</td><td>中</td><td>高</td></tr><tr><td>磁盘占用</td><td>无</td><td>无</td><td>中</td><td>高</td><td>无</td><td>无</td></tr><tr><td>可远程备份</td><td>否</td><td>是</td><td>是</td><td>是</td><td>是</td><td>是（文件传输）</td></tr><tr><td>并行工作能力</td><td>否</td><td>否</td><td>是</td><td>是</td><td>否</td><td>否</td></tr><tr><td>数据安全度</td><td>低</td><td>高</td><td>高</td><td>高</td><td>高</td><td>中</td></tr><tr><td>学习成本</td><td>低</td><td>中</td><td>中</td><td>低</td><td>中</td><td>高</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-36">八、实战工作流示例</h2>
<h3 data-id="heading-37">场景：开发中突发线上Bug，需紧急修复</h3>
<h4 data-id="heading-38">方案一：快速切换（git stash，适合1小时内可完成修复）</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 暂存当前开发进度（带描述，便于识别）</span>
git stash push -m <span class="hljs-string">"feat: 用户登录 - 完成表单验证，待联调接口"</span>

<span class="hljs-comment"># 2. 切换到主分支并拉取最新代码</span>
git checkout main
git pull origin main

<span class="hljs-comment"># 3. 创建hotfix分支并修复Bug</span>
git checkout -b hotfix/online-login-error
<span class="hljs-comment"># ... 定位并修复Bug ...</span>
git add .
git commit -m <span class="hljs-string">"fix: 线上登录失败问题（修复参数校验逻辑）"</span>

<span class="hljs-comment"># 4. 推送hotfix分支，等待合并上线</span>
git push origin hotfix/online-login-error

<span class="hljs-comment"># 5. 切回原开发分支，恢复进度继续开发</span>
git checkout feature/login
git stash pop  <span class="hljs-comment"># 恢复暂存的进度</span>
</code></pre>
<h4 data-id="heading-39">方案二：稳妥备份（git commit，适合修复耗时较长）</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 提交当前半成品进度（WIP前缀）</span>
git add .
git commit -m <span class="hljs-string">"WIP: feat: 用户登录 - 表单验证开发中"</span>

<span class="hljs-comment"># 2. 切换主分支拉取最新代码，创建hotfix分支</span>
git checkout main
git pull origin main
git checkout -b hotfix/online-login-error

<span class="hljs-comment"># 3. 修复Bug并提交</span>
git add .
git commit -m <span class="hljs-string">"fix: 线上登录失败问题（修复参数校验逻辑）"</span>
git push origin hotfix/online-login-error

<span class="hljs-comment"># 4. 切回原开发分支，继续开发</span>
git checkout feature/login
<span class="hljs-comment"># ... 补充开发剩余功能 ...</span>
git add .
<span class="hljs-comment"># 5. 整理临时提交，合并为完整提交</span>
git commit --amend -m <span class="hljs-string">"feat: 完成用户登录功能（表单验证+接口联调）"</span>
</code></pre>
<h4 data-id="heading-40">方案三：并行开发（git worktree，适合需同时推进开发与修复）</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 创建hotfix分支的worktree，并行处理</span>
git worktree add ../project-hotfix main
<span class="hljs-built_in">cd</span> ../project-hotfix

<span class="hljs-comment"># 2. 创建hotfix分支并修复Bug</span>
git checkout -b hotfix/online-login-error
<span class="hljs-comment"># ... 修复Bug ...</span>
git add .
git commit -m <span class="hljs-string">"fix: 线上登录失败问题（修复参数校验逻辑）"</span>
git push origin hotfix/online-login-error

<span class="hljs-comment"># 3. 原目录继续开发登录功能（无需暂存/提交）</span>
<span class="hljs-built_in">cd</span> ../my-project
<span class="hljs-comment"># ... 继续开发登录功能 ...</span>

<span class="hljs-comment"># 4. Bug修复完成后，删除hotfix的worktree</span>
git worktree remove ../project-hotfix
git worktree prune
</code></pre>
<hr/>
<h2 data-id="heading-41">九、常见问题与解决方案</h2>
<h3 data-id="heading-42">Q1：git stash pop 恢复时冲突了怎么办？</h3>
<p>冲突后，stash 记录不会自动删除，需手动处理：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 打开冲突文件，手动解决冲突（标记为 &lt;&lt;&lt;&lt;&lt;&lt;&lt;、=======、&gt;&gt;&gt;&gt;&gt;&gt;&gt; 的部分）</span>
<span class="hljs-comment"># 2. 解决完成后，暂存冲突文件</span>
git add &lt;冲突文件路径&gt;
<span class="hljs-comment"># 3. 手动删除对应的stash记录</span>
git stash drop stash@{0}
</code></pre>
<h3 data-id="heading-43">Q2：git worktree 报错 “already checked out” 如何处理？</h3>
<p>原因：同一分支已在其他 worktree 或主目录检出，Git 不允许同一分支多处检出。解决方案：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 查看所有worktree，确认分支所在目录</span>
git worktree list
<span class="hljs-comment"># 2. 删除已检出该分支的worktree，或切换到其他分支</span>
git worktree remove ../project-old
<span class="hljs-comment"># 3. 重新创建worktree（使用其他分支或新分支）</span>
git worktree add ../project-new feature/new-branch
</code></pre>
<h3 data-id="heading-44">Q3：git rebase 整理提交时操作失误，如何恢复？</h3>
<p>可通过 Git 引用日志（reflog）找回操作前的状态：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 查看引用日志，找到rebase前的提交哈希（标注为HEAD@{n}）</span>
git reflog
<span class="hljs-comment"># 2. 强制重置到该状态，恢复分支原貌</span>
git reset --hard HEAD@{2}  <span class="hljs-comment"># HEAD@{2}为rebase前的状态，按需调整数字</span>
<span class="hljs-comment"># 3. 若rebase过程中卡住，可直接放弃rebase</span>
git rebase --abort
</code></pre>
<h3 data-id="heading-45">Q4：如何查看某个 stash 对应的分支？</h3>
<p>执行 <code>git stash list</code> 时，输出结果会显示 stash 对应的分支：</p>
<pre><code class="hljs language-bash" lang="bash">git stash list
<span class="hljs-comment"># 输出示例：</span>
<span class="hljs-comment"># stash@{0}: WIP on feature/login: abc1234 feat: 优化表单样式</span>
<span class="hljs-comment"># 其中 “on feature/login” 即为该stash对应的分支</span>
</code></pre>
<hr/>
<h2 data-id="heading-46">十、总结</h2>
<p>Git 切换任务的核心是“安全保存当前进度，确保工作区干净可切换”，不同方法适配不同场景，核心选型原则如下：</p>
<ul>
<li><strong>短暂临时切换</strong>：优先用 <code>git stash</code>，高效快捷；</li>
<li><strong>中长期跨时段切换</strong>：用 <code>git commit</code>，支持备份与历史整理；</li>
<li><strong>多任务并行开发</strong>：用 <code>git worktree</code>，多目录独立运行，效率最优；</li>
<li><strong>完全隔离环境需求</strong>：用 <code>git clone</code>，避免相互影响；</li>
<li><strong>分支级进度记录/协作</strong>：用 <code>git branch + reset</code>，可分享可回溯；</li>
<li><strong>跨环境迁移修改</strong>：用 <code>Patch 文件</code>，适配离线/跨仓库场景。</li>
</ul>
<p>实际开发中，无需拘泥于单一方法，可根据任务时长、协作需求、环境限制灵活组合使用，核心目标是“高效切换、安全保存、整洁历史”。</p>
<hr/>
<p>如果您觉得这篇文章对您有帮助，欢迎点赞和收藏，大家的支持是我继续创作优质内容的动力🌹🌹🌹也希望您能在😉😉😉<a href="https://juejin.cn/user/671151992348125" target="_blank" title="https://juejin.cn/user/671151992348125">我的主页</a> 😉😉😉找到更多对您有帮助的内容。</p>
<ul>
<li>致敬每一位赶路人</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[浅谈RAG与Agent智能体区别]]></title>    <link>https://juejin.cn/post/7598710324167409679</link>    <guid>https://juejin.cn/post/7598710324167409679</guid>    <pubDate>2026-01-25T13:07:00.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598710324167409679" data-draft-id="7598563188112392244" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="浅谈RAG与Agent智能体区别"/> <meta itemprop="keywords" content="人工智能"/> <meta itemprop="datePublished" content="2026-01-25T13:07:00.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="前端的阶梯"/> <meta itemprop="url" content="https://juejin.cn/user/2604076678261512"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            浅谈RAG与Agent智能体区别
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2604076678261512/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    前端的阶梯
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-25T13:07:00.000Z" title="Sun Jan 25 2026 13:07:00 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>大模型RAG与agent的区别是什么？RAG 与 Agent 分别代表了大模型时代的 “知识增强” 与 “自主决策” 两大核心方向。RAG 通过检索外部知识提升生成准确性，而 Agent 通过动态规划与工具调用实现复杂任务自动化。</p>
<h2 data-id="heading-0"><strong>一、核心定义：RAG 与 Agent 的本质差异</strong></h2>
<p><strong>RAG</strong> <strong>（检索增强生成）</strong></p>
<p>定义：结合检索与生成的 “知识外挂” 技术，通过外部知识库降低模型幻觉。</p>
<p>典型架构：</p>
<p>检索器：使用 BM25、SentenceBERT 等算法从知识库（如向量数据库）中检索相关信息。</p>
<p>生成器：基于检索结果生成文本，如 Hugging Face 的 RAG 模型。</p>
<p>知识库：支持动态更新，如腾讯云 ES 的混合搜索能力。</p>
<p>典型应用：企业级问答系统（如腾讯乐享通过 RAG 整合内部文档库）。</p>
<p><strong>Agent</strong> <strong>（智能体）</strong></p>
<p>定义：具备感知、推理、决策与执行能力的 “行动者”，可自主完成复杂任务。</p>
<p>核心模块：</p>
<p>规划：如 ReAct 框架通过 “思考 - 行动 - 观察” 循环动态调整策略。</p>
<p>记忆：存储历史交互信息，如 <a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D256172650%26content_type%3DArticle%26match_order%3D1%26q%3DLangChain%26zd_token%3DeyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJ6aGlkYV9zZXJ2ZXIiLCJleHAiOjE3Njk1MTcxMjQsInEiOiJMYW5nQ2hhaW4iLCJ6aGlkYV9zb3VyY2UiOiJlbnRpdHkiLCJjb250ZW50X2lkIjoyNTYxNzI2NTAsImNvbnRlbnRfdHlwZSI6IkFydGljbGUiLCJtYXRjaF9vcmRlciI6MSwiemRfdG9rZW4iOm51bGx9.HLODpf27ZMjuUFm9Ii-dbjwgkp0gh_Q-pwFm-yUk-eo%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=256172650&amp;content_type=Article&amp;match_order=1&amp;q=LangChain&amp;zd_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJ6aGlkYV9zZXJ2ZXIiLCJleHAiOjE3Njk1MTcxMjQsInEiOiJMYW5nQ2hhaW4iLCJ6aGlkYV9zb3VyY2UiOiJlbnRpdHkiLCJjb250ZW50X2lkIjoyNTYxNzI2NTAsImNvbnRlbnRfdHlwZSI6IkFydGljbGUiLCJtYXRjaF9vcmRlciI6MSwiemRfdG9rZW4iOm51bGx9.HLODpf27ZMjuUFm9Ii-dbjwgkp0gh_Q-pwFm-yUk-eo&amp;zhida_source=entity" ref="nofollow noopener noreferrer">LangChain</a> 的对话式 Agent。</p>
<p>工具调用：支持 API、数据库等外部工具，如自动驾驶 Agent 调用传感器数据。</p>
<p>典型应用：自动驾驶（如特斯拉 FSD 的环境感知与决策）。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e2c916680dae4ee1bb031964614c0853~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv55qE6Zi25qKv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769951313&amp;x-signature=nG1OQ24PR4EQSSU6Ry4F%2BjPj0Ac%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-1"><strong>二、技术对比：从流程到能力的全方位差异</strong></h2>
<p><strong>工作原理</strong></p>
<p>RAG：固定流程（检索→生成→评估），如阿里云 RAG 系统通过向量检索生成答案。</p>
<p>Agent：动态规划（感知→推理→决策→执行），如 LangChain 的 ReAct Agent 逐步拆解任务。</p>
<p><strong>关键技术</strong></p>
<p>RAG：</p>
<p>向量数据库：如腾讯云 ES 支持 10 亿级向量毫秒级检索。</p>
<p>语义检索：GraphRAG 通过知识图谱提升检索精度。</p>
<p>Agent：</p>
<p>多模块协同：如实在 Agent 的 TARS 大模型与 ISSUT 视觉技术结合。</p>
<p>工具调用：OpenAI Function Call 支持结构化输出。</p>
<p><strong>适用场景</strong></p>
<p>RAG：</p>
<p>知识密集型任务：医疗问答（整合 PubMed 文献）、法律条文解析（结合判例库）。</p>
<p>实时数据整合：金融报告生成（接入股票 API）。</p>
<p>Agent：</p>
<p>复杂任务拆解：电商客服全流程自动化（从需求分析到订单处理）。</p>
<p>动态环境交互：自动驾驶（实时调整路线）。</p>
<p><strong>应用场景</strong></p>
<p>金融行业：</p>
<p>RAG 整合实时数据：通过检索股市行情、财报数据，Agent 自主生成投资分析报告。</p>
<p>电商客服：</p>
<p>动态响应用户需求：Agent 调用 RAG 检索商品知识库，结合用户历史订单推荐个性化方案。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0d5b1428f91a406c9a510649c472a65d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv55qE6Zi25qKv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769951313&amp;x-signature=JsxIVSloqkUnjiehuGrY0zI%2BmeY%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-2"><strong>三、未来趋势：RAG 与 Agent 的协同进化</strong></h2>
<p><strong>技术融合方向</strong></p>
<p>Agentic RAG（智能体驱动的动态检索生成）：</p>
<p>动态检索策略：Agent 根据问题类型选择向量搜索、SQL 查询或 Web 搜索，如腾讯云 ES 的混合搜索。</p>
<p>多跳推理：跨文档对比（如科研论文分析）或结合外部 API 数据（如天气、股市）。</p>
<p>典型案例：</p>
<p>医疗领域：Agentic RAG 整合最新临床试验数据，生成个性化治疗方案。</p>
<p>法律领域：Agent 动态调用法规库与判例库，生成合规分析报告。</p>
<h2 data-id="heading-3"><strong>四、结语</strong></h2>
<p>未来，两者的深度融合（如 Agentic RAG）将推动 AI 从 “信息提供者” 向 “问题解决者” 演进，为医疗、法律、金融等领域带来更智能、高效的解决方案。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[大数据-221 离线数仓分层实战：ODS/DWD/DWS/DIM/ADS 怎么划，数据集市如何避免数据孤岛]]></title>    <link>https://juejin.cn/post/7598587406708113449</link>    <guid>https://juejin.cn/post/7598587406708113449</guid>    <pubDate>2026-01-25T13:11:33.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598587406708113449" data-draft-id="7598699872552845348" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="大数据-221 离线数仓分层实战：ODS/DWD/DWS/DIM/ADS 怎么划，数据集市如何避免数据孤岛"/> <meta itemprop="keywords" content="后端,大数据,Hadoop"/> <meta itemprop="datePublished" content="2026-01-25T13:11:33.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="武子康"/> <meta itemprop="url" content="https://juejin.cn/user/149189314230039"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            大数据-221 离线数仓分层实战：ODS/DWD/DWS/DIM/ADS 怎么划，数据集市如何避免数据孤岛
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/149189314230039/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    武子康
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-25T13:11:33.000Z" title="Sun Jan 25 2026 13:11:33 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读14分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">TL;DR</h2>
<ul>
<li>场景：部门自建数据集市越多，口径不一、接口不通，形成数据孤岛，查数成本爆炸。</li>
<li>结论：用“分层 + 一致性维度 + 可复用汇总层”控复杂度；ER 适合稳态大组织，维度模型更适合敏捷交付。</li>
<li>产出：一套离线数仓分层定义（ODS→DW→ADS）+ 建模方法对比 + 常见故障速查卡。</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a373e9ac83904233a7eae676104bf596~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769951493&amp;x-signature=M2YqwBOeBnwUAHFO7nmN7kaTEzs%3D" alt="大数据-221 离线数仓分层实战：ODS/DWD/DWS/DIM/ADS 怎么划，数据集市如何避免数据孤岛" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ab13761524a647c19eb6fd78319368c4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769951493&amp;x-signature=TXx0a41wFho75VCf1dvHy5Ku5zc%3D" alt="离线数仓 架构图" loading="lazy"/></p>
<h2 data-id="heading-1">数据集市</h2>
<p>数据仓库（DW）是一种反映主题的全局性数据组织，但全局性数据仓库往往太大，在实际应用中他们按部门或业务分别建立反映各个子主题的局部性数据组织，即数据集市（Data Mart），有时也称它为数据仓库。
数据集市：是按照主题域组织的数据集合，用于支持部门级的数据分析与决策。如在商品销售的数据仓库中可以建立多个不同主题的数据集市：</p>
<ul>
<li>商品采购数据集市</li>
<li>商品库存数据集市</li>
<li>商品销售数据集市</li>
</ul>
<p>数据集市仅仅是数据仓库的某一部分，实施难度大大降低，并且能够满足企业内部部分业务部分的迫切需求，在初期获得了较大的成功。但随着数据集市的不断增多，这种架构的缺陷也逐步显现。企业内部独立建设的数据集市由于遵循不同的标准和建设原则，以至于多个数据集市的数据混乱和不一致，形成众多的数据孤岛。</p>
<h3 data-id="heading-2">数据孤岛现象详解</h3>
<p>随着企业业务的不断扩展，组织架构通常会划分为多个事业部门（Business Unit）。例如，一个大型零售企业可能分为电商事业部、线下零售事业部、供应链事业部等。每个事业部门在运营过程中都会产生大量业务数据，包括销售记录、库存信息、客户资料等。</p>
<h4 data-id="heading-3">数据孤岛的形成原因</h4>
<ol>
<li>
<p><strong>独立的数据存储系统</strong>：</p>
<ul>
<li>各部门往往使用不同的数据库系统（如电商用MySQL，财务用Oracle）</li>
<li>数据格式不统一（如日期格式有YYYY-MM-DD和MM/DD/YYYY之分）</li>
<li>命名规范不一致（如客户ID字段可能被命名为cust_id、customerID或client_no）</li>
</ul>
</li>
<li>
<p><strong>部门壁垒</strong>：</p>
<ul>
<li>缺乏跨部门数据共享机制</li>
<li>出于数据安全考虑而设置的访问限制</li>
<li>部门间的竞争关系导致数据保护主义</li>
</ul>
</li>
<li>
<p><strong>技术障碍</strong>：</p>
<ul>
<li>系统架构不兼容（如部分使用云服务，部分使用本地服务器）</li>
<li>缺乏统一的数据接口标准</li>
<li>历史遗留系统的技术债务</li>
</ul>
</li>
</ol>
<h4 data-id="heading-4">数据孤岛的具体表现</h4>
<p>以零售企业为例：</p>
<ul>
<li>电商事业部掌握的客户网购行为数据无法与线下门店的会员数据打通</li>
<li>供应链部门的库存数据无法实时同步给销售部门</li>
<li>市场营销部门的活动效果数据难以与财务部门的ROI分析关联</li>
</ul>
<h4 data-id="heading-5">数据孤岛的负面影响</h4>
<ol>
<li>
<p><strong>决策效率低下</strong>：</p>
<ul>
<li>管理层无法获取完整的业务视图</li>
<li>需要人工整合多份报告才能做出决策</li>
</ul>
</li>
<li>
<p><strong>运营成本增加</strong>：</p>
<ul>
<li>重复的数据采集和清洗工作</li>
<li>需要维护多个独立的数据系统</li>
</ul>
</li>
<li>
<p><strong>客户体验受损</strong>：</p>
<ul>
<li>无法实现跨渠道的个性化服务</li>
<li>客户在不同部门需要重复提供相同信息</li>
</ul>
</li>
<li>
<p><strong>创新受阻</strong>：</p>
<ul>
<li>难以开展跨部门的数据分析项目</li>
<li>无法充分挖掘数据的潜在价值</li>
</ul>
</li>
</ol>
<h4 data-id="heading-6">典型场景示例</h4>
<p>场景：客户投诉处理</p>
<ul>
<li>客服部门：记录投诉内容，但无法查看该客户的历史订单数据</li>
<li>售后部门：处理退换货，但不知道客户之前的咨询记录</li>
<li>质量部门：分析产品问题，但缺乏完整的客户反馈数据</li>
</ul>
<p>这种情况导致客户问题需要多次转接，处理周期长，客户满意度下降。</p>
<h2 data-id="heading-7">建模方法</h2>
<p>数据模型就是数据组织和存储方法，它强调业务、数据存取和使用角度合理存储数据。有了适合的基础数据存储环境的模型，能获得以下好处：</p>
<ul>
<li>性能：良好的数据模型能够帮助我们快速查询所需要的数据，减少数据的I/O吞吐</li>
<li>成本：良好的数据模型能极大的减少不必要的数据冗余，也能实现计算结果复用，极大的降低数据系统中的存储和计算成本。</li>
<li>效率：良好的数据模型能极大的改善使用使用数据的体验，提高使用数据的效率</li>
<li>质量：良好的数据模型能够改善数据统计口径不一致性，减少数据计算错误的可能性。</li>
</ul>
<p>大数据系统需要数据模型的方法来帮助更好的组织和存储数据，以便在性能、成本、效率和质量之间取得最佳的平衡。</p>
<h2 data-id="heading-8">ER模型</h2>
<p>数据仓库之父Bill Inmon提出的建模方法是从全企业的高度设计一个3NF模型，用实体关系（Entity RelationShip，ER）模型描述企业业务，在范式理论上符合3NF。数据仓库中的3NF与OLTP系统中的3NF的区别在于，它是站在企业角度面向主题的抽象，而不是针对某个具体业务流程的实体对象的抽象。其具体有以下几个特点：</p>
<ul>
<li>需要全面的了解整个企业业务和数据</li>
<li>实施周期非常的长</li>
<li>对建模人员的能力要求非常高</li>
</ul>
<p>采用ER模型建设数据仓库模型的出发点是整合数据，将各个系统中的数据以整个企业角度按主题进行相似性组合和合并，并进行一致性处理，为数据分析决策服务，但是并不能直接用于分析决策，其建模步骤分为三个阶段：</p>
<ul>
<li>高层模型：一个高度抽象的模型，描述主要的主题以及主题间的关系，用于描述企业的业务总体概况</li>
<li>中层模型：在高层模型的基础上，细化主题的数据项</li>
<li>物理模型（也叫底层模型）：在中层模型的基础上，考虑物理存储，同时基于性能和平台特点进行物理属性的设计，也可能做一些表的合并、分区的设计等等</li>
</ul>
<h2 data-id="heading-9">维度模型</h2>
<p>维度模型是数据仓库领域的Palph Kimball 大师所倡导的，他的《数据仓库工具箱》是数据仓库工程领域最流行的数据仓库建模经典。
维度模型从分析决策的需求出发构建模型，为分析需求服务，重点关注用户如何更快的完成需求分析，同时具有较好的大规模复杂查询的响应性能。其典型的代表是星型模型，以及在一些特殊场景下的雪花模型。
其设计主要分为以下步骤：</p>
<ul>
<li>选择需要进行分析决策的业务过程，业务过程可以是：单个业务事件，比如交易的支付、退款的。某个事件的状态，比如当前的账户余额等。一系列相关业务事件组成的业务流程。</li>
<li>选择数据的粒度，在事件分析中，我们要预判所有分析需要细分的程度，从而决定选择的粒度。</li>
<li>识别维表，选择好粒度之后，就需要基于此粒度设计维度表，包括维度属性，用于分析时进行分组和筛选。</li>
<li>选择事实，确定分析需要衡量的指标</li>
</ul>
<p>现代企业业务变化快、人员流动频繁、业务知识功底不够全面，导致ER模型设计产出周期长。大多企业实施数据仓库的经验说明：在不太成熟、快速变化的业务面前，构建ER模型的风险非常大，不太适合去构建ER模型。而维度建模对技术要求不高，快速上手，敏捷迭代，快速交付，更快速完成分析需求，有较好的大规模复杂查询的响应性能。</p>
<h2 data-id="heading-10">数仓分层</h2>
<p>数据仓库更多代表的是一种对数据的管理和使用的方式，它是一整套包括了数据建模、ETL（数据抽取、转换、加载）、作业调度等在内的完整的理论体系流程。数据仓库在构建过程中通常需要进行分层处理。业务不同，分层的技术处理手段也不同。
分层的主要原因是在管理数据的时候，能对数据有一个更加清晰的掌控。详细来讲，主要有下面几个原因：</p>
<ul>
<li>清晰的数据结构：每一个数据分层都有它的作用域，在使用表的时候能更方便的定位和理解。</li>
<li>将复杂的问题简单化：将一个复杂的任务分解成多个步骤来完成，每一层只处理单一的问题，比较简单和容易理解，而且便于维护数据的准确性，当数据出现问题之后，可以不用修复所有的数据，只需要从有问题的地方开始修复。</li>
<li>减少重复开发：规范数据分层，开发一些通用的中间层数据，能够极大减少重复计算</li>
<li>屏蔽原始数据的异常：屏蔽业务的影响，不必改一次业务就重新接入数据</li>
<li>数据血缘的追踪：最终给业务呈现的是一个能直接使用业务表，但是它的来源很多，如果有一张来源表出问题了，借助血缘最终能够快速准确的定位到问题，并清楚它的危害范围。</li>
</ul>
<p>数仓的常见分层一般为3层，分别为：</p>
<ul>
<li>数据操作层</li>
<li>数据仓库层</li>
<li>应用数据层（数据集市层）。</li>
</ul>
<p>当然根据研究人员经验或者业务，可以分为更多不同的层，只要能达到流程清晰，方便查数即可。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/41afe8b2b57048ddb3dd28339bcfd4f2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769951493&amp;x-signature=7zSK7FJTMjAfKih2jnd1IgFljQA%3D" alt="离线数仓 整体架构图" loading="lazy"/></p>
<h2 data-id="heading-11">ODS</h2>
<p>ODS（Operation Data Store 数据准备区），数据仓库源头系统的数据表通常会原封不同的存储一份，这称为ODS层，也称为准备区。它们是后续数据仓库加工数据的来源。ODS层数据的主要来源包括：</p>
<ul>
<li>业务数据库，可用DataX、Sqoop等工具来抽取，每天定时抽取一次，在实时的应用中，可用Canal监听MySQL Binlog，实时接入变更的数据。</li>
<li>埋点日志，线上系统会打入各种日志，这些日志一般以文件的形式保存，可以用Flume定时抽取</li>
<li>其他数据源，从第三方购买的数据，或是网络爬虫的数据</li>
</ul>
<h2 data-id="heading-12">DW</h2>
<p>DW（Data WareHouse 数据仓库层），包含DWD、DWS、DIM层，由ODS层数据加工而成，主要完成数据加工与整合，建立一致性的维度，构建可复用的面向分析和统计的明细事实表，以及汇总公共粒度的指标。</p>
<ul>
<li>DWD（Data WareHouse Detail 细节数据层），是业务与数据仓库的隔离层，以业务过程为建模驱动，基于每个具体的业务过程特点，构建细粒度的明细层事实表。可以结合企业的数据使用特点，将明细事实表的某些重要维度属性字段做适当地冗余，也即宽表化处理。</li>
<li>DWS（Data WareHouse Service 服务数据层），基于DWD的基础数据，整合汇总成分析某个主题域的服务数据。以分析的主题为建模驱动，基于上层的应用和产品的指标需求，构建公共粒度的汇总指标事实表。</li>
<li>公共维度层（DIM）：基于维度建模理念思想，建立一致性维度</li>
<li>TMP层：临时层，存放计算过程中临时产生的数据</li>
</ul>
<h2 data-id="heading-13">ADS</h2>
<p>ADS（Application Data Store）应用数据层，基于DW数据，整合汇总成主题域的服务数据，用于提供后续的业务查询等。</p>
<h2 data-id="heading-14">简单总结</h2>
<p>数据仓库层次的划分不是固定不变的，可以根据实际需求进行适当裁剪或者是添加，如果业务相对简单和独立，可以将DWD、DWS进行合并。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2de879f5258b4bc5a3f1f11b184e10d7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769951493&amp;x-signature=AHH9Ski2g%2FtdP%2Fya%2Fqldi4BpS%2FI%3D" alt="离线数仓 ADS ETL" loading="lazy"/></p>
<h2 data-id="heading-15">错误速查</h2>













































<table><thead><tr><th>症状</th><th>根因定位</th><th>修复方案</th></tr></thead><tbody><tr><td>同一个指标在不同报表数值不一致</td><td>口径分散在各数据集市/各团队脚本里，维度不一致、过滤条件不一致</td><td>拉齐指标定义：统计周期、去重规则、状态过滤；对比各表 SQL/ETL 逻辑差异；指标上收：沉到 DWS 公共粒度汇总层；统一 DIM 维度与主键映射；禁止 ADS 私自改口径</td></tr><tr><td>反复做相同清洗/Join，任务链越来越长</td><td>分层边界不清，ODS/DWD 直接服务上层；缺少可复用中间层</td><td>看 DAG：相同 Join/过滤在多个任务重复出现；看数据血缘同源多产出；抽公共逻辑到 DWD（明细事实）或 DIM（一致性维度）；DWS 提供公共粒度汇总复用</td></tr><tr><td>查数慢、扫描量巨大</td><td>明细层粒度过细且无分区/无宽表策略；维度表设计不合理</td><td>看执行计划：全表扫描、Shuffle 过大；看分区字段是否命中；DWD 按业务过程定粒度并分区；适度宽表化；维度表拆分热字段与低频字段</td></tr><tr><td>业务一改字段/逻辑，上层大面积重跑</td><td>ODS 未做“原始留存 + 变化隔离”；上游异常直接污染 DW</td><td>比对 ODS 原始与 DWD 清洗后差异；检查字段变更是否有兼容层；ODS 只做原样落地与最小规范化；在 DWD 做稳定抽象；新增过渡字段与兼容视图</td></tr><tr><td>维度口径混乱：同一客户在不同系统 ID 不同</td><td>主数据缺失，缺少一致性维度（DIM）与映射表</td><td>抽样核对：订单、会员、CRM 等系统的 ID 映射覆盖率；建立统一主键（surrogate key）与映射表；DIM 维护生命周期与 SCD 策略（慢变维）</td></tr><tr><td>ADS 表越来越多、像“另一个数仓”</td><td>ADS 承担了建模与加工职责，越权</td><td>看 ADS 是否包含复杂 Join/清洗/口径计算；ADS 只做面向应用的轻度整合与出数；重加工回收至 DW（DWD/DWS/DIM）</td></tr><tr><td>临时 TMP 表长期存在、口径不可追溯</td><td>TMP 被当成正式产出，缺少治理与生命周期</td><td>查元数据：TMP 存活时间、引用链、是否有 owner；TMP 设 TTL 与命名规范；引用必须落到 DWD/DWS；纳入血缘与质量校验</td></tr></tbody></table>
<h2 data-id="heading-16">其他系列</h2>
<h3 data-id="heading-17">🚀 AI篇持续更新中（长期更新）</h3>
<p><strong>AI炼丹日志-29 - 字节跳动 DeerFlow 深度研究框<em>斜体样式</em>架 私有部署 测试上手 架构研究</strong>，持续打造实用AI工具指南！
<strong>AI研究-132 Java 生态前沿 2025：Spring、Quarkus、GraalVM、CRaC 与云原生落地</strong></p>
<h3 data-id="heading-18">💻 Java篇持续更新中（长期更新）</h3>
<p><strong>Java-218 RocketMQ Java API 实战：同步/异步 Producer 与 Pull/Push Consumer</strong>
MyBatis 已完结，Spring 已完结，Nginx已完结，Tomcat已完结，分布式服务已完结，Dubbo已完结，MySQL已完结，MongoDB已完结，Neo4j已完结，FastDFS 已完结，OSS已完结，GuavaCache已完结，EVCache已完结，RabbitMQ已完结，RocketMQ正在更新... 深入浅出助你打牢基础！</p>
<h3 data-id="heading-19">📊 大数据板块已完成多项干货更新（300篇）：</h3>
<p>包括 Hadoop、Hive、Kafka、Flink、ClickHouse、Elasticsearch 等二十余项核心组件，覆盖离线+实时数仓全栈！
<strong>大数据-278 Spark MLib - 基础介绍 机器学习算法 梯度提升树 GBDT案例 详解</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Agent Skills、Rules、Prompt、MCP，一文把它们理清楚了]]></title>    <link>https://juejin.cn/post/7599268297201958950</link>    <guid>https://juejin.cn/post/7599268297201958950</guid>    <pubDate>2026-01-25T13:54:58.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599268297201958950" data-draft-id="7598921649888559131" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Agent Skills、Rules、Prompt、MCP，一文把它们理清楚了"/> <meta itemprop="keywords" content="前端,人工智能,AI编程"/> <meta itemprop="datePublished" content="2026-01-25T13:54:58.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="不如摸鱼去"/> <meta itemprop="url" content="https://juejin.cn/user/26044011388510"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Agent Skills、Rules、Prompt、MCP，一文把它们理清楚了
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/26044011388510/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    不如摸鱼去
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-25T13:54:58.000Z" title="Sun Jan 25 2026 13:54:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/da0cde99a53249d78feb581f3a6ad055~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5aaC5pG46bG85Y67:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769954097&amp;x-signature=P06QY2A6CIp%2BX5s3QPJaI7BzePI%3D" alt="" loading="lazy"/></p>
<p>我的关注者里，经常有人问我同一个问题：</p>
<blockquote>
<p>"Agent Skills、Rules、Prompt、MCP到底有什么区别？我也想用AI，但每次看到这些词就头大。"</p>
</blockquote>
<p>说实话，我理解这种困惑。</p>
<p>这就好比你去一家餐厅，菜单上写着"前菜"、"主菜"、"配菜"、"佐料"，但没人告诉你它们到底是什么关系。 <img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5ec6620cc14e400d94ab9081fdef6c43~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5aaC5pG46bG85Y67:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769954097&amp;x-signature=KfsC12H%2BYBcA4sIBmm73qLGm9sw%3D" alt="" loading="lazy"/></p>
<p>今天，我们就把这些概念彻底掰开揉碎了讲清楚。</p>
<h2 data-id="heading-0">01</h2>
<p>一个真实的AI困惑</p>
<p>上周有个程序员朋友跟我说：</p>
<p>"我写了一个Prompt，让AI帮我写代码，但它总理解不对我的需求。后来听说要加Rules，然后又有人说要用Skills，现在又冒出个MCP……我到底该用哪个？"</p>
<p>这不是某个人的困惑，而是很多AI使用者的普遍困境。</p>
<p>因为AI生态发展太快，新概念层出不穷，但这些概念之间往往有重叠，边界不清。</p>
<p>更让人头大的是，不同的平台、不同的文档，对同一个词的叫法还不一样。</p>
<p><strong>但这四个概念，确实有本质的区别。</strong></p>
<h2 data-id="heading-1">02</h2>
<p>Prompt：你和AI的对话基础</p>
<p>先说最基础的：Prompt。</p>
<p>Prompt就是你给AI的输入，是你和AI对话的基础。</p>
<p>它可以是一句话、一段文字、一个问题、一个任务描述。</p>
<blockquote>
<p><strong>Prompt = 你对AI说的话</strong></p>
</blockquote>
<p>比如：</p>
<ul>
<li>"帮我写一篇关于春天的诗"</li>
<li>"这段代码有什么bug？"</li>
<li>"解释一下量子纠缠"</li>
</ul>
<p><strong>Prompt的特点</strong>：</p>
<ul>
<li>简单直接，就像你在跟人聊天</li>
<li>每次对话都可以不同</li>
<li>适合一次性任务</li>
</ul>
<p><strong>Prompt的问题</strong>：</p>
<ul>
<li>如果你经常要做类似的事情，每次都要重新输入Prompt</li>
<li>AI可能会"忘记"你之前的设置</li>
<li>无法复用和共享</li>
</ul>
<h2 data-id="heading-2">03</h2>
<p>Rules：给AI的"行为准则"</p>
<p>当你发现需要反复告诉AI同样的事情时，就需要Rules了。</p>
<p>Rules就是你给AI设定的长期规则，就像你给助理制定的"工作手册"。</p>
<blockquote>
<p><strong>Rules = AI的行为准则</strong></p>
</blockquote>
<p>比如：</p>
<ul>
<li>"你是一个专业的程序员，写代码时要遵循PEP8规范"</li>
<li>"回复时要简短精炼，不要超过100字"</li>
<li>"遇到不确定的信息，要明确告诉用户"</li>
</ul>
<p><strong>Rules的特点</strong>：</p>
<ul>
<li>一次设置，长期生效</li>
<li>定义了AI的"人设"和"行为模式"</li>
<li>适合长期稳定的需求</li>
</ul>
<p><strong>Rules的问题</strong>：</p>
<ul>
<li>只能定义"做什么"和"不做什么"，无法定义"怎么做"</li>
<li>无法包含复杂的操作步骤</li>
<li>仍然比较抽象</li>
</ul>
<h2 data-id="heading-3">04</h2>
<p>Skills：AI的"超能力模板"</p>
<p>现在进入重头戏：Skills。</p>
<p>Skills是AI的"超能力模板"，是一套完整的、可复用的、能解决特定问题的方案。</p>
<blockquote>
<p><strong>Skills = AI的超能力模板</strong></p>
</blockquote>
<p>一个Skill通常包含：</p>
<ul>
<li><strong>Prompt模板</strong>：定义任务目标</li>
<li><strong>Rules</strong>：设定行为规范</li>
<li><strong>操作步骤</strong>：具体的执行流程</li>
<li><strong>工具调用</strong>：需要用到的外部工具或API</li>
<li><strong>输出格式</strong>：标准化的结果呈现</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/845df433e73d44a2aa3c50dc556ec0e1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5aaC5pG46bG85Y67:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769954097&amp;x-signature=x8mF3Ynayfyp3Y8W4tUfTU4F07g%3D" alt="" loading="lazy"/></p>
<p><strong>举个例子</strong>：</p>
<p>假设你经常需要从网页抓取数据并生成报告。</p>
<ul>
<li><strong>用Prompt</strong>：每次都要输入"帮我访问这个网页，提取XX数据，然后生成报告"</li>
<li><strong>用Rules</strong>：可以设定"你是个数据分析师，生成报告时要包含XX部分"</li>
<li><strong>用Skill</strong>：直接调用"网页数据抓取Skill"，它会自动完成访问→提取→分析→生成报告的全流程</li>
</ul>
<p><strong>Skills的特点</strong>：</p>
<ul>
<li><strong>完整性</strong>：从输入到输出的完整方案</li>
<li><strong>可复用</strong>：一次创建，多次使用</li>
<li><strong>可共享</strong>：可以被其他用户或Agent调用</li>
<li><strong>可组合</strong>：多个Skill可以组合完成复杂任务</li>
</ul>
<p><strong>Skills的价值</strong>：</p>
<ul>
<li>不用每次都重新描述需求</li>
<li>保证了输出的质量和一致性</li>
<li>可以在社区中共享和交换</li>
<li>让AI真正成为你的"数字员工"</li>
</ul>
<h2 data-id="heading-4">05</h2>
<p>MCP：连接AI和世界的"桥梁"</p>
<p>最后说MCP。</p>
<p>MCP（Model Context Protocol）是一个技术协议，它的作用是让AI能够安全、规范地访问外部数据和服务。</p>
<blockquote>
<p><strong>MCP = AI和世界连接的协议</strong></p>
</blockquote>
<p>你可以把MCP理解成一套"插座标准"。</p>
<ul>
<li><strong>AI</strong>是电器</li>
<li><strong>外部系统</strong>（数据库、API、文件系统）是电源</li>
<li><strong>MCP</strong>是插座标准</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c59f8eb19d1547a39ea0498a87721f00~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5aaC5pG46bG85Y67:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769954097&amp;x-signature=4ksd3GqdtmhF8l4yOEIiY2fxyr4%3D" alt="" loading="lazy"/></p>
<p>有了统一的插座标准，电器就可以方便地连接各种电源，而不用担心接口不匹配。</p>
<p><strong>MCP解决的问题</strong>：</p>
<ul>
<li><strong>安全问题</strong>：如何让AI安全地访问敏感数据</li>
<li><strong>标准化问题</strong>：不同的系统用统一的方式连接</li>
<li><strong>权限管理</strong>：AI能做什么、不能做什么</li>
<li><strong>数据隔离</strong>：避免AI越界访问不该访问的内容</li>
</ul>
<p><strong>MCP与Skills的关系</strong>：</p>
<p>Skills是"做什么"，MCP是"怎么安全地做"。</p>
<p>一个Skill在执行过程中，如果需要访问外部系统，就会通过MCP协议来连接。</p>
<h2 data-id="heading-5">06</h2>
<p>一张图看懂它们的关系</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e0f0c19086ec49328acca84f2ff82eae~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5aaC5pG46bG85Y67:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769954097&amp;x-signature=wbMurCuPzF4gincbNbH1RUCKEVs%3D" alt="" loading="lazy"/></p>
<ul>
<li><strong>Prompt</strong>：是你和AI对话的起点</li>
<li><strong>Rules</strong>：定义AI的基本行为规范</li>
<li><strong>Skills</strong>：封装了完整的任务解决方案</li>
<li><strong>MCP</strong>：让AI能够安全地连接外部世界</li>
</ul>
<h2 data-id="heading-6">07</h2>
<p>实际场景中该用哪个？</p>
<p><strong>场景1：偶尔让AI帮个小忙</strong> → 用 <strong>Prompt</strong> 就够了</p>
<p>比如："帮我写个生日祝福语"</p>
<p><strong>场景2：AI要长期扮演某个角色</strong> → 用 <strong>Rules</strong></p>
<p>比如：设定AI是"你的私人英语老师"，回复时要用简单英语，不超过50个单词</p>
<p><strong>场景3：经常要做一件复杂的事</strong> → 用 <strong>Skills</strong></p>
<p>比如：每周都要分析行业新闻并生成报告，那就创建一个"行业报告生成Skill"</p>
<p><strong>场景4：要让AI访问你的私有数据或API</strong> → 需要配置 <strong>MCP</strong></p>
<p>比如：让AI能够查询你的数据库、调用你的业务API</p>
<h2 data-id="heading-7">08</h2>
<p>为什么Skills这么重要？</p>
<p>你可能发现，这四个概念里，Skills是最"重"的。</p>
<p>它需要你花时间去设计、去调试、去优化。</p>
<p><strong>但为什么还要用Skills？</strong></p>
<p>因为当你用AI不再是为了"偶尔玩玩"，而是为了真正提升工作效率、解决实际问题时，你会发现：</p>
<ul>
<li><strong>时间成本</strong>：一次创建，长期受益</li>
<li><strong>质量保证</strong>：每次输出都稳定可靠</li>
<li><strong>团队协作</strong>：可以分享给同事使用</li>
<li><strong>持续优化</strong>：可以不断改进和完善</li>
</ul>
<p>更重要的是，Skills让AI从"聊天工具"变成了"生产力工具"。</p>
<h2 data-id="heading-8">09</h2>
<p>最后的建议</p>
<p>如果你刚开始用AI：</p>
<ol>
<li><strong>从Prompt开始</strong>：先学会和AI对话，了解它的能力边界</li>
<li><strong>积累常用Prompt</strong>：把经常用到的Prompt保存起来，形成"个人Prompt库"</li>
<li><strong>尝试Rules</strong>：当发现需要反复设定同样规则时，开始用Rules</li>
<li><strong>创建Skills</strong>：当有明确、重复的复杂任务时，尝试创建第一个Skill</li>
<li><strong>了解MCP</strong>：如果需要让AI访问你的系统，再深入学习MCP</li>
</ol>
<p><strong>别被概念吓到。</strong></p>
<p>它们本质上都是为了让你更好地使用AI，从"偶尔问一问"进化到"把它当成真正的数字助手"。</p>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[CLAUDE.md 全局规则分析]]></title>    <link>https://juejin.cn/post/7598563188112375860</link>    <guid>https://juejin.cn/post/7598563188112375860</guid>    <pubDate>2026-01-25T12:07:38.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598563188112375860" data-draft-id="7598588085597503528" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="CLAUDE.md 全局规则分析"/> <meta itemprop="keywords" content="Claude"/> <meta itemprop="datePublished" content="2026-01-25T12:07:38.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="小兵张健"/> <meta itemprop="url" content="https://juejin.cn/user/1257497032405229"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            CLAUDE.md 全局规则分析
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1257497032405229/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    小兵张健
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-25T12:07:38.000Z" title="Sun Jan 25 2026 12:07:38 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>我是把电脑信息, PowerShell 信息(这个好像没啥用, win 的 Bash 用的 git 的),语言规范, Context7(好像没看到调用), Superpowers skills(这个非常有用)都配进去了.</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">-</span> Environment: Windows 11
<span class="hljs-bullet">-</span> Shell: PowerShell 7
<span class="hljs-bullet">-</span> Language: Always reply in Chinese (简体中文), including code comments, logs, and ALL artifacts/files generated by skills (plans, todos, etc.). Even if skill instructions are in English, the output MUST be in Chinese.
<span class="hljs-bullet">-</span> Web Search: When executing web search related tasks, you MUST use the markitdown MCP tool (e.g. mcp<span class="hljs-strong">__markitdown__</span>convert<span class="hljs-emphasis">_to_</span>markdown) to process content.
<span class="hljs-bullet">-</span> Always use Context7 MCP when I need library/API documentation, code generation, setup or configuration steps without me having to explicitly ask.
<span class="hljs-bullet">-</span> Superpowers: MUST ALWAYS invoke the "superpowers:using-superpowers" skill at the very beginning of every conversation or interaction. This is a MANDATORY requirement for all tasks.
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[40 岁程序员的“强制进厂维修”记录]]></title>    <link>https://juejin.cn/post/7598734303173984308</link>    <guid>https://juejin.cn/post/7598734303173984308</guid>    <pubDate>2026-01-25T12:12:04.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598734303173984308" data-draft-id="7598588085596766248" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="40 岁程序员的“强制进厂维修”记录"/> <meta itemprop="keywords" content="程序员"/> <meta itemprop="datePublished" content="2026-01-25T12:12:04.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="陈佬昔编程人生"/> <meta itemprop="url" content="https://juejin.cn/user/3087084378402445"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            40 岁程序员的“强制进厂维修”记录
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3087084378402445/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    陈佬昔编程人生
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-25T12:12:04.000Z" title="Sun Jan 25 2026 12:12:04 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>这些天，32岁程序员猝死的新闻又在网上刷屏了。这类消息似乎隔段时间就会出现一次，技术圈里最让人唏嘘的，大概是23年技术大拿陈皓（左耳朵耗子）的突然离世。但唏嘘归唏嘘，日子一久，大家也就慢慢淡忘了。</p>
<p>说起来，我自己前几年也经历过一次“强制进厂维修”——因为心肌炎住了七天院。现在回想起来，也算是一次身体发出的、不容忽视的严重警告。</p>
<h2 data-id="heading-0">事件经过</h2>
<p><strong>出事前两周</strong>，我和同事自驾走318国道去西藏，虽然因为疫情中途折返到了香格里拉，但一路都在高海拔缺氧的环境里折腾。每天开三四个小时车，身体其实已经积累了不少疲惫。</p>
<p><strong>出事前一周</strong>，工作压力特别大，我连续好几天睡眠不足。身体开始发出抗议信号——浑身酸痛。奇怪的是，这疼痛像在“打游击”，今天肩膀疼，明天腰疼，休息一下好像又好点。我当时没太当回事，以为就是普通的劳累。</p>
<p><strong>出事前三天</strong>，疼痛升级了，主要集中在背部，晚上疼得翻来覆去睡不着。</p>
<p><strong>出事当天</strong>，凌晨时分，疼痛开始向胸口蔓延。我有点慌了，赶紧请假去医院。可更奇怪的事情发生了：到了医院，一阵剧痛过后，我居然感觉“好了”！心电图、抽血都没查出大问题，医生也说不出个所以然。我心想，可能是虚惊一场，就又回去上班了。</p>
<p><strong>到了晚上</strong>，熟悉的疼痛卷土重来。一开始还能忍，我甚至自己开车回了家。可到家一坐下，完了，稍微一动就疼得龇牙咧嘴，根本忍不住。最后是打车去的急诊。拍CT的时候，疼得需要人搀扶才能爬上检查床。</p>
<p>打完止痛针，疼痛缓解了一些，但那一晚还是在煎熬中度过的。之后，我就被正式收治住院，一住就是七天。住院的头三天晚上，疼痛还会时不时来“拜访”一下，之后才彻底消停。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/12d256cd0d09495fb4b396d0f2b9316a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6ZmI5L2s5piU57yW56iL5Lq655Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769947923&amp;x-signature=8xy0I%2BNMSxsLMinqHGN8kxO0ZQE%3D" alt="IMG_3313.HEIC" loading="lazy"/></p>
<h2 data-id="heading-1">总结：身体是自己的，得自己疼</h2>
<p>这次经历让我想明白了几件事：</p>
<ol>
<li>
<p><strong>身体是唯一的，且没有备用零件。</strong> 躺在病床上我才深切体会到，再厉害的医生也只能提供医疗帮助，真正的痛苦和恢复过程，只能自己承受。我记得在急诊室疼得叫出声时，护士过来看了一眼，确认没有生命危险就走了——在他们看来，能喊出来反而说明情况不算最危急。所以，最该关心你身体的，永远是你自己。</p>
</li>
<li>
<p><strong>一定要学会“听”身体的话。</strong> 身体比我们想象中更聪明，困了、累了、疼了，都是它在发求救信号。千万别硬扛。我查过资料，心梗前常伴有后背疼痛，我亲身体验，心肌炎也有类似征兆。<strong>任何不明原因的疼痛持续超过三天，别犹豫，立刻去医院。</strong></p>
</li>
<li>
<p><strong>睡眠是顶级补药。</strong> 住院那几天，医院晚上九点就熄灯，环境安静得只能睡觉。我被迫过上了规律的作息，结果身体恢复得出奇地快。这让我意识到，平时那些“熬夜赶工”的效率，可能远比不上睡个好觉后清醒的头脑。</p>
</li>
<li>
<p><strong>有些伤害可能是永久的。</strong> 出院后，每次熬夜或过度劳累，胸口和后背总会隐隐有些不适，仿佛在提醒我那段经历。虽然复查一切正常，但这种“心理阴影”或者说身体的“记忆”，告诉我它并没有完全忘记那次创伤。</p>
</li>
<li>
<p><strong>别怕看病，有保障。</strong> 我这次住院总花费大概五千多，医保、公司的补充商业保险，再加上我自己买的住院险，几乎全额报销了。在经济上几乎没造成负担。所以，身体有问题千万别拖，该治就治。在国内，有正规工作的程序员，医疗保障这块通常还是不错的。</p>
</li>
</ol>
<h2 data-id="heading-2">对于工作：学会“放权”与“放手”</h2>
<p>这次生病也让我重新审视了和工作关系：</p>
<ul>
<li>
<p><strong>对公司而言，没有谁是不可替代的。</strong> 一家运作良好的公司就像一台精密的机器，流程完备，任何一个零件（包括人）都是可以更换的。千万别陷入“公司没我不行”的自我感动里，出于过度责任心大包大揽，最后累垮的只有自己。</p>
</li>
<li>
<p><strong>对管理者而言，核心价值是“背锅”与“放权”。</strong> 作为一个团队的小领导，你的成功不是体现在自己多能干，而是<strong>确保团队在没有你的情况下依然能正常运转</strong>。对上，你要承担责任和压力；对下，你要敢于信任和放权。凡事亲力亲为，不是负责，是瓶颈，更是对自己和团队的不负责。</p>
</li>
<li>
<p><strong>对普通员工而言，干不完一定要说。</strong> 工作量超出合理范围，一定要及时、明确地向上级反馈。硬撑不会换来感激，只会导致工作质量下降或自己崩溃。公司总有办法调整，但你的健康耗不起。</p>
</li>
</ul>
<h2 data-id="heading-3">后记：在病床上读《毫无意义的工作》</h2>
<p>住院期间，我带了一本大卫·格雷伯的《毫无意义的工作》。在那种环境下读这本书，感受格外复杂。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c9dc8d4613a346849c28d0235f6222a8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6ZmI5L2s5piU57yW56iL5Lq655Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769947923&amp;x-signature=WseivGX0EJKwj9JONA%2FVUQKMY%2FU%3D" alt="IMG_3298.HEIC" loading="lazy"/></p>
<p>书里对现代社会中种种“狗屁工作”的辛辣讽刺。我躺在病床上忍不住想：平日里的那些忙碌、焦虑、熬夜，其中有多少是真正创造价值的，又有多少只是陷入了某种“表演性忙碌”的惯性里？</p>
<p>出院后，我并没有立刻做出什么惊天动地的改变，但我开始接受一个事实：<strong>工作的意义，不应该以牺牲健康为代价来证明。</strong></p>
<p>那本皱巴巴的《毫无意义的工作》现在还放在我的书架上。它不再只是一本社会学的畅销书，更像一个来自病床上的书签，标记着我人生中一次重要的“宕机”与“修复”记录。它提醒我，在追求效率和产出的同时，更要时常检视这一切的“意义”何在，以及为此付出的代价是否值得。</p>
<p>毕竟，人生这场“项目”，最重要的KPI是健康地活着，并且清醒地知道为何而活。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[第5章、控制结构——条件、循环与跳转语句]]></title>    <link>https://juejin.cn/post/7598737609494347795</link>    <guid>https://juejin.cn/post/7598737609494347795</guid>    <pubDate>2026-01-25T12:34:00.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598737609494347795" data-draft-id="7598587406708047913" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="第5章、控制结构——条件、循环与跳转语句"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-25T12:34:00.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="怕浪猫"/> <meta itemprop="url" content="https://juejin.cn/user/2832784963939438"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            第5章、控制结构——条件、循环与跳转语句
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2832784963939438/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    怕浪猫
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-25T12:34:00.000Z" title="Sun Jan 25 2026 12:34:00 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读18分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>大家好～ 上一章我们吃透了简单数据类型，今天进入Go编程的“流程掌控”环节——控制结构。控制结构是代码的“骨架”，用来决定程序执行的顺序：比如根据条件执行不同逻辑（if/switch）、重复执行一段代码（for）、或者强制改变执行流程（break/continue/goto）。</p>
<p>Go的控制结构设计非常简洁，没有冗余的语法（比如没有do-while循环、switch无需break自动终止），但细节里藏着很多提升效率的技巧。本文会结合实际开发场景，把每个控制结构的用法、注意事项和最佳实践讲透，还会附上可直接运行的代码示例，建议边看边敲，加深理解。</p>
<h2 data-id="heading-0">1. if语句与条件表达式</h2>
<p>if语句是最基础的条件控制结构，用来根据“条件是否成立”执行不同的代码块。Go中的if语句语法简洁，且支持“初始化语句”，这是日常开发中非常实用的特性。</p>
<h3 data-id="heading-1">1.1 基本语法与用法</h3>
<p>Go的if语句有两种核心形式：基础形式和带初始化语句的形式，语法如下：</p>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-comment">// 基础形式</span>
<span class="hljs-keyword">if</span> 条件表达式 {
    <span class="hljs-comment">// 条件为true时执行</span>
} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> 条件表达式<span class="hljs-number">2</span> {
    <span class="hljs-comment">// 条件1为false，条件2为true时执行</span>
} <span class="hljs-keyword">else</span> {
    <span class="hljs-comment">// 所有条件都为false时执行</span>
}

<span class="hljs-comment">// 带初始化语句的形式（推荐！）</span>
<span class="hljs-keyword">if</span> 初始化语句; 条件表达式 {
    <span class="hljs-comment">// 初始化的变量仅在if-else块内有效</span>
}

</code></pre>
<p>关键注意点：</p>
<ul>
<li>
<p>条件表达式必须是<strong>布尔类型</strong>（true/false），不能是其他类型（如int的0/非0，这和C语言不同，避免了隐式类型转换的坑）；</p>
</li>
<li>
<p>大括号<code>{}</code>必须存在，即使只有一行代码（Go强制代码风格统一，避免歧义）；</p>
</li>
<li>
<p>带初始化语句的形式中，初始化的变量（如临时变量、函数返回值）仅在if-else块内有效，外部无法访问，减少变量作用域，提升代码可读性。</p>
</li>
</ul>
<h3 data-id="heading-2">1.2 代码示例：实际开发场景</h3>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span>

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// 场景1：基础条件判断（用户登录状态校验）</span>
    isLogin := <span class="hljs-literal">true</span>
    username := <span class="hljs-string">"go_dev"</span>
    <span class="hljs-keyword">if</span> isLogin {
        fmt.Printf(<span class="hljs-string">"欢迎回来，%s！\n"</span>, username)
    } <span class="hljs-keyword">else</span> {
        fmt.Println(<span class="hljs-string">"请先登录～"</span>)
    }

    <span class="hljs-comment">// 场景2：带初始化语句的if（校验函数返回值）</span>
    <span class="hljs-comment">// 初始化语句：调用函数获取返回值，直接在if中判断</span>
    <span class="hljs-keyword">if</span> userID, err := getUserID(username); err == <span class="hljs-literal">nil</span> {
        fmt.Printf(<span class="hljs-string">"用户ID：%d\n"</span>, userID)
    } <span class="hljs-keyword">else</span> {
        fmt.Printf(<span class="hljs-string">"获取用户ID失败：%v\n"</span>, err)
    }
    <span class="hljs-comment">// 注意：userID和err仅在上面的if-else块内有效，这里无法访问</span>
    <span class="hljs-comment">// fmt.Println(userID)  // 编译报错：undefined: userID</span>

    <span class="hljs-comment">// 场景3：多条件判断（成绩分级）</span>
    score := <span class="hljs-number">85</span>
    <span class="hljs-keyword">if</span> score &gt;= <span class="hljs-number">90</span> {
        fmt.Println(<span class="hljs-string">"成绩：优秀"</span>)
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> score &gt;= <span class="hljs-number">80</span> {
        fmt.Println(<span class="hljs-string">"成绩：良好"</span>)
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> score &gt;= <span class="hljs-number">60</span> {
        fmt.Println(<span class="hljs-string">"成绩：及格"</span>)
    } <span class="hljs-keyword">else</span> {
        fmt.Println(<span class="hljs-string">"成绩：不及格"</span>)
    }
}

<span class="hljs-comment">// 模拟获取用户ID的函数</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">getUserID</span><span class="hljs-params">(username <span class="hljs-type">string</span>)</span></span> (<span class="hljs-type">int</span>, <span class="hljs-type">error</span>) {
    <span class="hljs-keyword">if</span> username == <span class="hljs-string">"go_dev"</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-number">10001</span>, <span class="hljs-literal">nil</span>
    }
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>, fmt.Errorf(<span class="hljs-string">"用户不存在：%s"</span>, username)
}

</code></pre>
<h3 data-id="heading-3">1.3 最佳实践</h3>
<ul>
<li>
<p>优先使用“带初始化语句的if”：将临时变量（如函数返回值、循环变量）的作用域限制在if-else块内，避免变量污染；</p>
</li>
<li>
<p>条件表达式尽量简洁：如果条件复杂，可抽成单独的函数（如<code>if isValidUser(username) { ... }</code>），提升代码可读性；</p>
</li>
<li>
<p>避免嵌套过深：如果if-else嵌套超过3层，建议重构（用switch或函数拆分），否则代码会变得难以维护。</p>
</li>
</ul>
<h2 data-id="heading-4">2. switch语句：表达式与类型选择</h2>
<p>switch语句用于“多分支条件判断”，相比多层if-else，switch的代码更简洁、逻辑更清晰。Go的switch功能比其他语言更强大，不仅支持“值匹配”，还支持“类型匹配”（type switch），且默认自动break（无需手动添加）。</p>
<h3 data-id="heading-5">2.1 基础用法：值匹配</h3>
<p>核心语法：根据switch后的“表达式值”，匹配case中的值，执行对应的代码块。</p>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span>

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// 场景1：简单值匹配（用户角色权限判断）</span>
    role := <span class="hljs-string">"editor"</span>
    <span class="hljs-keyword">switch</span> role {
    <span class="hljs-keyword">case</span> <span class="hljs-string">"admin"</span>:
        fmt.Println(<span class="hljs-string">"权限：全量操作"</span>)
    <span class="hljs-keyword">case</span> <span class="hljs-string">"editor"</span>:
        fmt.Println(<span class="hljs-string">"权限：编辑内容"</span>)
    <span class="hljs-keyword">case</span> <span class="hljs-string">"viewer"</span>:
        fmt.Println(<span class="hljs-string">"权限：仅查看"</span>)
    <span class="hljs-keyword">default</span>:
        fmt.Println(<span class="hljs-string">"权限：未知角色"</span>)
    }

    <span class="hljs-comment">// 场景2：case多值匹配（多个值对应同一逻辑）</span>
    day := <span class="hljs-number">3</span>
    <span class="hljs-keyword">switch</span> day {
    <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>:
        fmt.Println(<span class="hljs-string">"工作日"</span>)
    <span class="hljs-keyword">case</span> <span class="hljs-number">6</span>, <span class="hljs-number">7</span>:
        fmt.Println(<span class="hljs-string">"周末"</span>)
    <span class="hljs-keyword">default</span>:
        fmt.Println(<span class="hljs-string">"无效日期"</span>)
    }

    <span class="hljs-comment">// 场景3：带初始化语句的switch（类似if的初始化特性）</span>
    <span class="hljs-keyword">switch</span> hour := getCurrentHour(); {  <span class="hljs-comment">// 表达式为空，直接判断case条件</span>
    <span class="hljs-keyword">case</span> hour &gt;= <span class="hljs-number">6</span> &amp;&amp; hour &lt; <span class="hljs-number">12</span>:
        fmt.Println(<span class="hljs-string">"上午好～"</span>)
    <span class="hljs-keyword">case</span> hour &gt;= <span class="hljs-number">12</span> &amp;&amp; hour &lt; <span class="hljs-number">18</span>:
        fmt.Println(<span class="hljs-string">"下午好～"</span>)
    <span class="hljs-keyword">default</span>:
        fmt.Println(<span class="hljs-string">"晚上好～"</span>)
    }
}

<span class="hljs-comment">// 模拟获取当前小时</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">getCurrentHour</span><span class="hljs-params">()</span></span> <span class="hljs-type">int</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-number">14</span>  <span class="hljs-comment">// 测试用固定值</span>
}

</code></pre>
<p>关键特性：</p>
<ul>
<li>
<p>自动break：执行完匹配的case后，默认不会继续执行后续case（和Java、C不同，无需手动写break）；</p>
</li>
<li>
<p>case多值：一个case可以匹配多个值，用逗号分隔；</p>
</li>
<li>
<p>空表达式：switch后可以不带表达式，此时相当于if-else的简化版，每个case是独立的条件表达式；</p>
</li>
<li>
<p>default可选：当所有case都不匹配时，执行default（顺序不影响，建议放在最后）。</p>
</li>
</ul>
<h3 data-id="heading-6">2.2 高级用法：类型匹配（type switch）</h3>
<p>type switch用于“判断变量的动态类型”，核心场景是处理接口类型变量（后续章节会详细讲接口）。语法：<code>switch 变量.(type) { ... }</code>。</p>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span>

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// 定义接口变量，赋值不同类型的值</span>
    <span class="hljs-keyword">var</span> data <span class="hljs-keyword">interface</span>{}
    data = <span class="hljs-string">"hello go"</span>  <span class="hljs-comment">// 可修改为：100、3.14、true等不同类型</span>

    <span class="hljs-comment">// type switch：判断data的动态类型</span>
    <span class="hljs-keyword">switch</span> v := data.(<span class="hljs-keyword">type</span>) {
    <span class="hljs-keyword">case</span> <span class="hljs-type">string</span>:
        fmt.Printf(<span class="hljs-string">"类型：字符串，值：%s，长度：%d\n"</span>, v, <span class="hljs-built_in">len</span>(v))
    <span class="hljs-keyword">case</span> <span class="hljs-type">int</span>:
        fmt.Printf(<span class="hljs-string">"类型：整数，值：%d，平方：%d\n"</span>, v, v*v)
    <span class="hljs-keyword">case</span> <span class="hljs-type">float64</span>:
        fmt.Printf(<span class="hljs-string">"类型：浮点数，值：%.2f\n"</span>, v)
    <span class="hljs-keyword">case</span> <span class="hljs-type">bool</span>:
        fmt.Printf(<span class="hljs-string">"类型：布尔值，值：%t\n"</span>, v)
    <span class="hljs-keyword">default</span>:
        fmt.Println(<span class="hljs-string">"未知类型"</span>)
    }
}

</code></pre>
<p>说明：</p>
<ul>
<li>
<p>data是interface{}类型（空接口），可以接收任意类型的值；</p>
</li>
<li>
<p>data.(type)只能在switch中使用，用于获取变量的动态类型；</p>
</li>
<li>
<p>v是data的“类型断言后的值”，在对应case中，v的类型就是匹配的类型（如case string中，v是string类型）。</p>
</li>
</ul>
<h3 data-id="heading-7">2.3 最佳实践与注意事项</h3>
<ul>
<li>
<p>多分支优先用switch：当条件是“固定值匹配”或“类型匹配”时，用switch比多层if-else更简洁；</p>
</li>
<li>
<p>需要穿透用fallthrough：如果需要执行完当前case后继续执行下一个case，可在case末尾加<code>fallthrough</code>（慎用，容易导致逻辑混乱）；</p>
</li>
<li>
<p>type switch慎用：仅在需要判断接口动态类型时使用，避免过度依赖（会降低代码的可读性）。</p>
</li>
</ul>
<h2 data-id="heading-8">3. for循环的多种写法</h2>
<p>for循环是Go中唯一的循环结构（没有while、do-while），但通过不同的语法变形，可以实现其他循环的功能。Go的for循环语法灵活，支持“计数循环”“条件循环”“无限循环”“迭代循环”四种核心写法。</p>
<h3 data-id="heading-9">3.1 四种核心写法</h3>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span>

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// 写法1：计数循环（类似C语言的for）</span>
    <span class="hljs-comment">// 语法：for 初始化; 条件; 增量 { ... }</span>
    fmt.Println(<span class="hljs-string">"计数循环（0-4）："</span>)
    <span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++ {
        fmt.Printf(<span class="hljs-string">"%d "</span>, i)
    }
    fmt.Println()

    <span class="hljs-comment">// 写法2：条件循环（类似while）</span>
    <span class="hljs-comment">// 语法：for 条件 { ... }（省略初始化和增量）</span>
    fmt.Println(<span class="hljs-string">"条件循环（10-13）："</span>)
    num := <span class="hljs-number">10</span>
    <span class="hljs-keyword">for</span> num &lt; <span class="hljs-number">14</span> {
        fmt.Printf(<span class="hljs-string">"%d "</span>, num)
        num++
    }
    fmt.Println()

    <span class="hljs-comment">// 写法3：无限循环（无任何条件）</span>
    <span class="hljs-comment">// 语法：for { ... }（必须用break终止，否则无限执行）</span>
    fmt.Println(<span class="hljs-string">"无限循环（执行3次后终止）："</span>)
    count := <span class="hljs-number">0</span>
    <span class="hljs-keyword">for</span> {
        <span class="hljs-keyword">if</span> count &gt;= <span class="hljs-number">3</span> {
            <span class="hljs-keyword">break</span>  <span class="hljs-comment">// 终止循环</span>
        }
        fmt.Printf(<span class="hljs-string">"循环次数：%d "</span>, count)
        count++
    }
    fmt.Println()

    <span class="hljs-comment">// 写法4：迭代循环（for range，遍历集合）</span>
    <span class="hljs-comment">// 语法：for 索引, 值 := range 集合 { ... }</span>
    <span class="hljs-comment">// 支持遍历：字符串、数组、切片、map、通道等</span>
    fmt.Println(<span class="hljs-string">"遍历字符串（for range）："</span>)
    str := <span class="hljs-string">"hello go"</span>
    <span class="hljs-keyword">for</span> idx, char := <span class="hljs-keyword">range</span> str {
        fmt.Printf(<span class="hljs-string">"索引：%d，字符：%c "</span>, idx, char)
    }
    fmt.Println()

    fmt.Println(<span class="hljs-string">"遍历切片（for range）："</span>)
    nums := []<span class="hljs-type">int</span>{<span class="hljs-number">10</span>, <span class="hljs-number">20</span>, <span class="hljs-number">30</span>, <span class="hljs-number">40</span>}
    <span class="hljs-keyword">for</span> idx, val := <span class="hljs-keyword">range</span> nums {
        fmt.Printf(<span class="hljs-string">"索引：%d，值：%d "</span>, idx, val)
    }
    fmt.Println()
}

</code></pre>
<h3 data-id="heading-10">3.2 for range遍历的关键细节</h3>
<p>for range是Go中最常用的迭代方式，但有几个细节容易踩坑，必须注意：</p>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span>

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// 细节1：遍历字符串时，for range会自动处理UTF-8编码（返回rune类型）</span>
    str := <span class="hljs-string">"你好go"</span>
    fmt.Println(<span class="hljs-string">"遍历多语言字符串："</span>)
    <span class="hljs-keyword">for</span> idx, char := <span class="hljs-keyword">range</span> str {
        fmt.Printf(<span class="hljs-string">"索引：%d，字符：%c（Unicode：%d）\n"</span>, idx, char, char)
    }
    <span class="hljs-comment">// 输出说明：中文占3字节，所以索引是0、3、6、7</span>

    <span class="hljs-comment">// 细节2：遍历切片/数组时，val是副本，修改val不影响原切片</span>
    nums := []<span class="hljs-type">int</span>{<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>}
    <span class="hljs-keyword">for</span> _, val := <span class="hljs-keyword">range</span> nums {
        val *= <span class="hljs-number">2</span>  <span class="hljs-comment">// 修改的是副本，原切片不变</span>
    }
    fmt.Println(<span class="hljs-string">"修改val后的切片："</span>, nums)  <span class="hljs-comment">// 输出：[1 2 3]</span>

    <span class="hljs-comment">// 正确修改原切片：通过索引操作</span>
    <span class="hljs-keyword">for</span> idx := <span class="hljs-keyword">range</span> nums {
        nums[idx] *= <span class="hljs-number">2</span>
    }
    fmt.Println(<span class="hljs-string">"通过索引修改后的切片："</span>, nums)  <span class="hljs-comment">// 输出：[2 4 6]</span>

    <span class="hljs-comment">// 细节3：忽略索引或值</span>
    <span class="hljs-comment">// 忽略索引：用_代替</span>
    <span class="hljs-keyword">for</span> _, val := <span class="hljs-keyword">range</span> nums {
        fmt.Printf(<span class="hljs-string">"%d "</span>, val)
    }
    fmt.Println()

    <span class="hljs-comment">// 忽略值：只写索引</span>
    <span class="hljs-keyword">for</span> idx := <span class="hljs-keyword">range</span> nums {
        fmt.Printf(<span class="hljs-string">"索引：%d "</span>, idx)
    }
    fmt.Println()
}
</code></pre>
<h3 data-id="heading-11">3.3 最佳实践</h3>
<ul>
<li>
<p>遍历集合优先用for range：代码简洁，且能自动处理UTF-8编码（字符串）、边界条件（无需手动控制索引）；</p>
</li>
<li>
<p>修改集合元素用索引：如果需要修改切片/数组的元素，必须通过<code>nums[idx]</code>操作，不能修改for range的val（副本）；</p>
</li>
<li>
<p>无限循环慎用：仅在需要“持续运行直到特定条件”时使用（如服务监听），且必须确保有break终止逻辑；</p>
</li>
<li>
<p>计数循环注意溢出：如果循环次数极大，要注意索引变量的类型（如用int64避免溢出）。</p>
</li>
</ul>
<h2 data-id="heading-12">4. 无限循环与循环控制</h2>
<p>无限循环（<code>for { ... }</code>）是for循环的特殊形式，没有终止条件，必须通过“循环控制语句”（break、continue）或外部信号来终止。核心应用场景是“持续运行的服务”（如HTTP服务、消息队列消费者）。</p>
<h3 data-id="heading-13">4.1 无限循环的典型场景</h3>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"fmt"</span>
    <span class="hljs-string">"time"</span>
)

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// 场景1：模拟服务监听（持续运行，直到用户中断）</span>
    fmt.Println(<span class="hljs-string">"服务启动，持续监听请求...（按Ctrl+C终止）"</span>)
    <span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> {
        <span class="hljs-comment">// 模拟用户中断信号（3秒后触发）</span>
        time.Sleep(<span class="hljs-number">3</span> * time.Second)
        fmt.Println(<span class="hljs-string">"\n收到终止信号，准备关闭服务..."</span>)
        closeService()
    }()

    <span class="hljs-comment">// 无限循环：服务主逻辑</span>
    <span class="hljs-keyword">for</span> {
        <span class="hljs-comment">// 模拟处理请求</span>
        handleRequest()
        time.Sleep(<span class="hljs-number">1</span> * time.Second)  <span class="hljs-comment">// 每秒处理一次</span>
    }
}

<span class="hljs-comment">// 模拟处理请求</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">handleRequest</span><span class="hljs-params">()</span></span> {
    fmt.Printf(<span class="hljs-string">"处理请求中... %s\n"</span>, time.Now().Format(<span class="hljs-string">"15:04:05"</span>))
}

<span class="hljs-comment">// 模拟关闭服务</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">closeService</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// 实际开发中，这里会做资源清理（关闭数据库、释放连接等）</span>
    fmt.Println(<span class="hljs-string">"服务关闭完成！"</span>)
    <span class="hljs-comment">// 退出程序（终止所有goroutine）</span>
    <span class="hljs-built_in">panic</span>(<span class="hljs-string">"exit"</span>)  <span class="hljs-comment">// 简单模拟，实际用os.Exit(0)</span>
}

</code></pre>
<h3 data-id="heading-14">4.2 循环控制的核心逻辑</h3>
<p>无限循环的控制依赖于“内部条件判断”和“循环控制语句”，常见逻辑：</p>
<ul>
<li>
<p>条件终止：在循环内部判断特定条件（如收到终止信号、处理次数达到上限），用break终止；</p>
</li>
<li>
<p>错误重试：如果处理失败，用continue跳过当前循环，直接进入下一次重试；</p>
</li>
<li>
<p>资源清理：终止循环前，必须清理资源（如关闭文件、数据库连接、网络连接），避免内存泄漏。</p>
</li>
</ul>
<h2 data-id="heading-15">5. break、continue、goto的使用场景</h2>
<p>break、continue、goto是Go中的“跳转语句”，用于强制改变程序的执行流程。它们的作用和使用场景差异很大，其中goto因为容易导致代码逻辑混乱，被很多规范限制使用，需要格外谨慎。</p>
<h3 data-id="heading-16">5.1 三大跳转语句对比</h3>





























<table><thead><tr><th>语句</th><th>核心作用</th><th>使用场景</th><th>注意事项</th></tr></thead><tbody><tr><td>break</td><td>终止当前循环（for）或switch语句</td><td>1. 无限循环的终止；2. 满足特定条件时退出循环；3. switch中提前终止（较少用）</td><td>默认只终止“最内层”的循环/switch，如需终止外层循环，需配合标签</td></tr><tr><td>continue</td><td>跳过当前循环的剩余部分，直接进入下一次循环</td><td>1. 过滤不符合条件的数据（如遍历切片时跳过空值）；2. 错误重试（跳过失败的处理逻辑）</td><td>仅对当前循环有效，不影响外层循环</td></tr><tr><td>goto</td><td>无条件跳转到同一函数内的标签语句</td><td>1. 统一的错误处理（跳转到函数末尾的清理逻辑）；2. 简化多层循环的终止</td><td>禁止跨函数跳转；禁止跳转到循环/if内部（破坏代码结构）；尽量少用</td></tr></tbody></table>
<h3 data-id="heading-17">5.2 代码示例：实际应用</h3>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span>

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// 1. break的使用：终止循环</span>
    fmt.Println(<span class="hljs-string">"break示例（找到5就终止）："</span>)
    <span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++ {
        <span class="hljs-keyword">if</span> i == <span class="hljs-number">5</span> {
            <span class="hljs-keyword">break</span>  <span class="hljs-comment">// 找到5，终止循环</span>
        }
        fmt.Printf(<span class="hljs-string">"%d "</span>, i)
    }
    fmt.Println()

    <span class="hljs-comment">// 2. continue的使用：跳过偶数</span>
    fmt.Println(<span class="hljs-string">"continue示例（只打印奇数）："</span>)
    <span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++ {
        <span class="hljs-keyword">if</span> i%<span class="hljs-number">2</span> == <span class="hljs-number">0</span> {
            <span class="hljs-keyword">continue</span>  <span class="hljs-comment">// 跳过偶数，直接进入下一次循环</span>
        }
        fmt.Printf(<span class="hljs-string">"%d "</span>, i)
    }
    fmt.Println()

    <span class="hljs-comment">// 3. goto的使用：统一错误处理</span>
    fmt.Println(<span class="hljs-string">"goto示例（错误处理）："</span>)
    err := doSomething()
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        <span class="hljs-keyword">goto</span> errorHandler  <span class="hljs-comment">// 发生错误，跳转到错误处理标签</span>
    }
    fmt.Println(<span class="hljs-string">"执行成功！"</span>)
    <span class="hljs-keyword">return</span>

errorHandler:  <span class="hljs-comment">// 错误处理标签</span>
    fmt.Printf(<span class="hljs-string">"执行失败：%v\n"</span>, err)
    <span class="hljs-comment">// 这里可以做资源清理逻辑（如关闭文件、释放连接）</span>
}

<span class="hljs-comment">// 模拟执行任务，可能返回错误</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">doSomething</span><span class="hljs-params">()</span></span> <span class="hljs-type">error</span> {
    <span class="hljs-comment">// 模拟错误场景（可修改为nil测试成功案例）</span>
    <span class="hljs-keyword">return</span> fmt.Errorf(<span class="hljs-string">"任务执行失败：连接超时"</span>)
}

</code></pre>
<h2 data-id="heading-18">6. 标签语句与跨层跳转</h2>
<p>标签（Label）是Go中的“标记语句”，语法：<code>标签名: 语句</code>。标签主要用于配合break、continue、goto实现“跨层跳转”（如终止外层循环、跳转到函数内特定位置）。</p>
<h3 data-id="heading-19">6.1 核心用法：配合break终止外层循环</h3>
<p>当存在嵌套循环时，默认的break/continue只能作用于最内层循环。如果需要终止外层循环，就需要给外层循环添加标签，然后用<code>break 标签名</code>实现跨层跳转。</p>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span>

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// 场景：嵌套循环，找到符合条件的元素后终止外层循环</span>
    <span class="hljs-comment">// 给外层循环添加标签：outerLoop</span>
    outerLoop:
    <span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">3</span>; i++ {
        fmt.Printf(<span class="hljs-string">"外层循环：i=%d\n"</span>, i)
        <span class="hljs-keyword">for</span> j := <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">3</span>; j++ {
            fmt.Printf(<span class="hljs-string">"  内层循环：j=%d\n"</span>, j)
            <span class="hljs-keyword">if</span> i == <span class="hljs-number">1</span> &amp;&amp; j == <span class="hljs-number">1</span> {
                fmt.Println(<span class="hljs-string">"  找到目标（i=1,j=1），终止外层循环"</span>)
                <span class="hljs-keyword">break</span> outerLoop  <span class="hljs-comment">// 终止标签为outerLoop的外层循环</span>
            }
        }
    }
    fmt.Println(<span class="hljs-string">"循环结束"</span>)
}

</code></pre>
<h3 data-id="heading-20">6.2 其他用法：配合continue和goto</h3>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span>

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// 1. 配合continue：跳过外层循环的当前迭代</span>
    fmt.Println(<span class="hljs-string">"标签+continue："</span>)
    outer:
    <span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">3</span>; i++ {
        <span class="hljs-keyword">for</span> j := <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">3</span>; j++ {
            <span class="hljs-keyword">if</span> j == <span class="hljs-number">1</span> {
                fmt.Printf(<span class="hljs-string">"i=%d,j=%d：跳过外层当前迭代\n"</span>, i, j)
                <span class="hljs-keyword">continue</span> outer  <span class="hljs-comment">// 跳过外层循环的当前迭代，直接进入i+1</span>
            }
            fmt.Printf(<span class="hljs-string">"i=%d,j=%d\n"</span>, i, j)
        }
    }

    <span class="hljs-comment">// 2. 配合goto：跳转到标签位置（简化多层循环终止）</span>
    fmt.Println(<span class="hljs-string">"\n标签+goto："</span>)
    <span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">3</span>; i++ {
        <span class="hljs-keyword">for</span> j := <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">3</span>; j++ {
            <span class="hljs-keyword">if</span> i == <span class="hljs-number">2</span> &amp;&amp; j == <span class="hljs-number">2</span> {
                fmt.Printf(<span class="hljs-string">"i=%d,j=%d：跳转到循环结束标签\n"</span>, i, j)
                <span class="hljs-keyword">goto</span> loopEnd  <span class="hljs-comment">// 跳转到循环结束标签</span>
            }
            fmt.Printf(<span class="hljs-string">"i=%d,j=%d\n"</span>, i, j)
        }
    }
loopEnd:
    fmt.Println(<span class="hljs-string">"循环结束"</span>)
}

</code></pre>
<h3 data-id="heading-21">6.3 注意事项</h3>
<ul>
<li>
<p>标签名必须唯一：同一函数内的标签名不能重复；</p>
</li>
<li>
<p>标签必须在跳转语句之前：不能跳转到函数中未定义的标签，也不能跳转到标签之前的位置；</p>
</li>
<li>
<p>避免过度使用：标签和跨层跳转会破坏代码的“线性执行流程”，增加阅读难度，仅在必要时使用（如多层循环终止、统一错误处理）。</p>
</li>
</ul>
<h2 data-id="heading-22">7. 条件判断中的常见陷阱</h2>
<p>控制结构的逻辑错误是开发中最常见的bug来源之一，尤其是一些“隐蔽的陷阱”。下面总结几个高频陷阱，帮你避开坑。</p>
<h3 data-id="heading-23">7.1 陷阱1：条件表达式的隐式类型转换</h3>
<p>Go不允许条件表达式中出现非布尔类型（如int、string），但新手容易下意识地写类似C语言的代码：</p>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span>

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    num := <span class="hljs-number">10</span>
    <span class="hljs-comment">// 错误：条件表达式必须是布尔类型，不能是int</span>
    <span class="hljs-comment">// if num {  // 编译报错：non-bool num (type int) used as if condition</span>
    <span class="hljs-comment">//     fmt.Println("num非0")</span>
    <span class="hljs-comment">// }</span>

    <span class="hljs-comment">// 正确：明确写出布尔表达式</span>
    <span class="hljs-keyword">if</span> num != <span class="hljs-number">0</span> {
        fmt.Println(<span class="hljs-string">"num非0"</span>)
    }
}

</code></pre>
<h3 data-id="heading-24">7.2 陷阱2：for range的val是副本，修改无效</h3>
<p>前面提到过，for range遍历切片/数组时，val是元素的副本，修改val不会影响原切片。这个陷阱非常容易踩，尤其是在遍历结构体切片时：</p>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span>

<span class="hljs-keyword">type</span> User <span class="hljs-keyword">struct</span> {
    Name <span class="hljs-type">string</span>
    Age  <span class="hljs-type">int</span>
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    users := []User{{<span class="hljs-string">"Alice"</span>, <span class="hljs-number">20</span>}, {<span class="hljs-string">"Bob"</span>, <span class="hljs-number">25</span>}}

    <span class="hljs-comment">// 错误：修改val的副本，原切片不变</span>
    <span class="hljs-keyword">for</span> _, u := <span class="hljs-keyword">range</span> users {
        u.Age++  <span class="hljs-comment">// 仅修改副本</span>
    }
    fmt.Println(<span class="hljs-string">"错误修改后："</span>, users)  <span class="hljs-comment">// 输出：[{Alice 20} {Bob 25}]</span>

    <span class="hljs-comment">// 正确：通过索引修改原切片元素</span>
    <span class="hljs-keyword">for</span> idx := <span class="hljs-keyword">range</span> users {
        users[idx].Age++  <span class="hljs-comment">// 直接修改原切片</span>
    }
    fmt.Println(<span class="hljs-string">"正确修改后："</span>, users)  <span class="hljs-comment">// 输出：[{Alice 21} {Bob 26}]</span>
}

</code></pre>
<h3 data-id="heading-25">7.3 陷阱3：switch的case穿透（忘记fallthrough）</h3>
<p>Go的switch默认自动break，新手如果从Java/C转过来，容易忘记这一点，导致需要“穿透执行”时逻辑错误：</p>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span>

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    role := <span class="hljs-string">"admin"</span>
    <span class="hljs-comment">// 需求：admin需要执行editor和admin的权限逻辑（穿透）</span>
    <span class="hljs-keyword">switch</span> role {
    <span class="hljs-keyword">case</span> <span class="hljs-string">"admin"</span>:
        fmt.Println(<span class="hljs-string">"admin权限：全量操作"</span>)
        <span class="hljs-keyword">fallthrough</span>  <span class="hljs-comment">// 必须加fallthrough，否则不会执行下一个case</span>
    <span class="hljs-keyword">case</span> <span class="hljs-string">"editor"</span>:
        fmt.Println(<span class="hljs-string">"editor权限：编辑内容"</span>)
    <span class="hljs-keyword">case</span> <span class="hljs-string">"viewer"</span>:
        fmt.Println(<span class="hljs-string">"viewer权限：仅查看"</span>)
    }
}

</code></pre>
<h3 data-id="heading-26">7.4 陷阱4：goto跳转到循环内部</h3>
<p>goto禁止跳转到循环/if内部，这会破坏代码的结构完整性，编译直接报错：</p>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span>

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// 错误：goto不能跳转到循环内部</span>
    <span class="hljs-comment">// goto insideLoop  // 编译报错：goto insideLoop jumps into block starting at</span>

    <span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">3</span>; i++ {
insideLoop:
        fmt.Println(i)
    }
}

</code></pre>
<h2 data-id="heading-27">8. 控制结构的性能与可读性</h2>
<p>好的控制结构代码，既要性能高效，也要可读性强。很多时候，“可读性优先”（除非有明确的性能瓶颈），因为维护成本远高于微小的性能差异。下面从性能和可读性两个维度，给出优化建议。</p>
<h3 data-id="heading-28">8.1 性能优化建议</h3>
<ul>
<li>
<p>减少循环内的重复计算：将循环内不变的计算（如切片长度、函数调用结果）提取到循环外；</p>
</li>
<li>
<p>优先用for range遍历切片/数组：for range的性能和手动计数循环接近，且代码更简洁，不易出错；</p>
</li>
<li>
<p>避免不必要的嵌套：多层嵌套会增加CPU的分支预测开销，同时降低可读性，可通过“提前return”“函数拆分”简化；</p>
</li>
<li>
<p>goto的性能优势：在多层循环终止或统一错误处理场景，goto的性能比多层break更优（减少条件判断），但需权衡可读性。</p>
</li>
</ul>
<h3 data-id="heading-29">8.2 可读性优化建议</h3>
<ul>
<li>
<p>命名清晰：循环变量、标签名、条件变量的命名要直观（如用i/j/k表示索引，用isLogin、hasError表示布尔条件）；</p>
</li>
<li>
<p>拆分复杂条件：将复杂的条件表达式抽成单独的函数（如<code>isValidRequest(req)</code>），让代码逻辑更清晰；</p>
</li>
<li>
<p>控制循环长度：一个循环的代码长度不宜过长（建议不超过20行），如果过长，可拆分成多个函数；</p>
</li>
<li>
<p>优先用if-else/switch，少用goto：除非有明确的需求（如统一错误处理），否则尽量避免使用goto，降低代码阅读难度；</p>
</li>
<li>
<p>注释关键逻辑：对于复杂的循环控制（如跨层跳转、条件过滤），添加简洁的注释，说明逻辑目的。</p>
</li>
</ul>
<h3 data-id="heading-30">8.3 性能与可读性的平衡原则</h3>
<ol>
<li>
<p>大多数场景下，可读性优先于微小的性能提升：除非通过性能测试发现控制结构是瓶颈，否则不要为了“极致性能”牺牲可读性；</p>
</li>
<li>
<p>性能优化要有数据支撑：通过<code>testing</code>包的性能测试（如<code>go test -bench</code>）验证优化效果，不要凭感觉优化；</p>
</li>
<li>
<p>优先通过“结构优化”提升性能：如减少嵌套、提前return、避免重复计算，这些优化同时能提升可读性。</p>
</li>
</ol>
<h2 data-id="heading-31">总结</h2>
<p>本章我们全面讲解了Go的控制结构，核心要点总结如下：</p>
<ol>
<li>
<p>if语句：支持初始化语句，条件必须是布尔类型，优先用带初始化的形式，减少变量作用域；</p>
</li>
<li>
<p>switch语句：支持值匹配和类型匹配，默认自动break，多分支场景比if-else更简洁；</p>
</li>
<li>
<p>for循环：四种写法（计数、条件、无限、for range），for range是遍历集合的首选，注意val是副本的坑；</p>
</li>
<li>
<p>跳转语句：break终止循环/switch，continue跳过当前迭代，goto慎用，仅用于统一错误处理或多层循环终止；</p>
</li>
<li>
<p>标签语句：配合break/continue/goto实现跨层跳转，注意标签的使用规范；</p>
</li>
<li>
<p>避坑指南：避免隐式类型转换、for range副本修改、switch穿透遗漏、goto跳转到循环内部；</p>
</li>
<li>
<p>性能与可读性：优先保证可读性，通过结构优化提升性能，性能优化要有数据支撑。</p>
</li>
</ol>
<p>控制结构是Go编程的基础，熟练掌握这些知识点，能让你的代码更简洁、高效、可维护。建议多动手写不同场景的代码（如嵌套循环、错误处理、集合遍历），加深对控制结构的理解。如果有任何问题，欢迎在评论区交流～</p>
<p>参考链接：</p>
<ul>
<li>
<p>Go官方文档 - 控制结构：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgo.dev%2Fref%2Fspec%23Control_structures" target="_blank" title="https://go.dev/ref/spec#Control_structures" ref="nofollow noopener noreferrer">go.dev/ref/spec#Co…</a></p>
</li>
<li>
<p>Go标准库 - testing包（性能测试）：<a href="https://link.juejin.cn?target=https%3A%2F%2Fpkg.go.dev%2Ftesting" target="_blank" title="https://pkg.go.dev/testing" ref="nofollow noopener noreferrer">pkg.go.dev/testing</a></p>
</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[为什么说 Prompt 不够用了？Agent Skill 才是 AI 应用的核心抽象]]></title>    <link>https://juejin.cn/post/7598537739516936234</link>    <guid>https://juejin.cn/post/7598537739516936234</guid>    <pubDate>2026-01-25T13:00:10.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598537739516936234" data-draft-id="7599017594519191578" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="为什么说 Prompt 不够用了？Agent Skill 才是 AI 应用的核心抽象"/> <meta itemprop="keywords" content="程序员,人工智能,前端"/> <meta itemprop="datePublished" content="2026-01-25T13:00:10.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="西陵"/> <meta itemprop="url" content="https://juejin.cn/user/4353721774379054"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            为什么说 Prompt 不够用了？Agent Skill 才是 AI 应用的核心抽象
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4353721774379054/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    西陵
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-25T13:00:10.000Z" title="Sun Jan 25 2026 13:00:10 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读12分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>随着大模型能力的持续提升，Agent 已经不再只是对话式 AI，而是逐步演进为能够<strong>直接操作真实计算环境</strong>的智能执行体。以 Claude Code 为代表的新一代 Agent，可以访问本地文件系统、执行代码、修改项目结构，甚至完成跨领域的复杂任务。这种能力的跃迁，使 Agent 开始真正参与到软件开发、数据处理、内容生产等实际工作流中。</p>
<p>但与此同时，一个问题也愈发明显：<strong>模型越强，并不意味着 Agent 在所有场景下都足够专业。</strong></p>
<p>通用 Agent 在面对具体领域任务时，仍然需要大量上下文说明、重复指令和人工引导。不同项目、不同团队往往会各自维护一套隐性流程和经验做法，这些知识既难以复用，也难以规模化共享。结果就是：</p>
<ul>
<li>Agent 能力强，但每次都要重新教</li>
<li>Prompt 越写越长，上下文成本越来越高</li>
<li>专业经验沉淀在个人，而不是系统中</li>
</ul>
<p>为了解决这一问题，我们需要一种新的方式，将<strong>人的流程经验、工具使用方式和领域知识</strong>，以结构化、可组合的形式交给 Agent。</p>
<h2 data-id="heading-1">Agent Skills的诞生</h2>
<p>2025 年 10 月，Anthropic 推出了 Agent Skills 能力，在 Claude 网页端、API 以及 Claude Code等产品都可以使用。</p>
<p>Agent Skills 主要解决的问题是把特定的工作流、特定领域的能力打包成可复用的<code>技能包</code>， 在Agent 上可以丰富出更多的应用生态。那些日常工作中琐碎但重复的任务，借助 Skill 的能力可以被高度自动化。</p>
<p>一个非常贴近真实工程场景的例子是 <code>Code Review</code>，在团队协作中，<code>Code Review</code> 本身就是一项<strong>耗时且高度依赖经验的流程</strong>。通用 Agent 并不了解团队内部的代码规范、设计原则和优化偏好，也无法自然地复现真实开发者的审查思路。</p>
<p>通过将代码规范、Review 规则、常见问题模式以及优化策略沉淀为专门的 Code Review Skill，Agent 就可以按照真实开发流程执行 CR：</p>
<ul>
<li>识别结构性问题</li>
<li>指出潜在风险</li>
<li>给出符合团队规范的优化建议</li>
</ul>
<p>刚开始 Agent Skills 这套机制只支持 Claude，后面像 Cursor、codex 都陆续开始支持该能力，因此在 2025 年 12 月，Anthropic 正式将 Agent Skills 发布为<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.anthropic.com%2Fengineering%2Fequipping-agents-for-the-real-world-with-agent-skills" target="_blank" title="https://www.anthropic.com/engineering/equipping-agents-for-the-real-world-with-agent-skills" ref="nofollow noopener noreferrer">开放标准</a>，支持跨平台跨产品复用。</p>
<h2 data-id="heading-2">Agent Skills结构剖析</h2>
<p>Agent Skills 本质上就是一个文件夹，文件夹的结构如下：</p>
<pre><code class="hljs language-jsx" lang="jsx">my-skill/
├── <span class="hljs-variable constant_">SKILL</span>.<span class="hljs-property">md</span>          # <span class="hljs-title class_">Required</span>: instructions + metadata
├── scripts/          # <span class="hljs-title class_">Optional</span>: executable code
├── references/       # <span class="hljs-title class_">Optional</span>: documentation
└── assets/           # <span class="hljs-title class_">Optional</span>: templates, resources
</code></pre>
<p>下面会详细介绍每个文件的作用，这里以 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fwshobson%2Fagents%2Ftree%2Fmain%2Fplugins%2Fllm-application-dev%2Fskills%2Fprompt-engineering-patterns" target="_blank" title="https://github.com/wshobson/agents/tree/main/plugins/llm-application-dev/skills/prompt-engineering-patterns" ref="nofollow noopener noreferrer">prompt-engineering-patterns</a> 这个开源的 skill 为例：</p>
<ul>
<li>
<p><a href="https://link.juejin.cn?target=http%3A%2F%2FSKILL.md" target="_blank" title="http://SKILL.md" ref="nofollow noopener noreferrer">SKILL.md</a> 文件</p>
<p>这个文件是每个 skill 必须要有的文件，里面包含这个 skill 的元数据和指令。</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-comment">// 元数据</span>
---
<span class="hljs-attr">name</span>: prompt-engineering-patterns
<span class="hljs-attr">description</span>: <span class="hljs-title class_">Master</span> advanced prompt engineering techniques to maximize <span class="hljs-variable constant_">LLM</span> performance, reliability, and controllability <span class="hljs-keyword">in</span> production. <span class="hljs-title class_">Use</span> when optimizing prompts, improving <span class="hljs-variable constant_">LLM</span> outputs, or designing production prompt templates.
---

<span class="hljs-comment">// 指令</span>
# <span class="hljs-title class_">Prompt</span> <span class="hljs-title class_">Engineering</span> <span class="hljs-title class_">Patterns</span>

<span class="hljs-title class_">Master</span> advanced prompt engineering techniques to maximize <span class="hljs-variable constant_">LLM</span> performance, reliability, and controllability.

## <span class="hljs-title class_">When</span> to <span class="hljs-title class_">Use</span> <span class="hljs-title class_">This</span> <span class="hljs-title class_">Skill</span>

- <span class="hljs-title class_">Designing</span> complex prompts <span class="hljs-keyword">for</span> production <span class="hljs-variable constant_">LLM</span> applications
- <span class="hljs-title class_">Optimizing</span> prompt performance and consistency
- <span class="hljs-title class_">Implementing</span> structured reasoning patterns (chain-<span class="hljs-keyword">of</span>-thought, tree-<span class="hljs-keyword">of</span>-thought)
- <span class="hljs-title class_">Building</span> few-shot learning systems <span class="hljs-keyword">with</span> dynamic example selection
- <span class="hljs-title class_">Creating</span> reusable prompt templates <span class="hljs-keyword">with</span> variable interpolation
- <span class="hljs-title class_">Debugging</span> and refining prompts that produce inconsistent outputs
- <span class="hljs-title class_">Implementing</span> system prompts <span class="hljs-keyword">for</span> specialized <span class="hljs-variable constant_">AI</span> assistants

## <span class="hljs-title class_">Core</span> <span class="hljs-title class_">Capabilities</span>
...
</code></pre>
<p><strong>元数据</strong>：元数据就是文件中最开始的信息，必须包含 name 和 description 两个字段，用于 Agent 识别，其余字段都是可选的，可参考<a href="https://link.juejin.cn?target=https%3A%2F%2Fagentskills.io%2Fspecification" target="_blank" title="https://agentskills.io/specification" ref="nofollow noopener noreferrer">官网</a>。</p>
<p><strong>指令</strong>：指令指的是文件中的正文信息，包含技能使用的详细说明。文档内容格式没有限制，只需要能够让 Agent 理解并有效完完成任务即可，官方推荐指令中应该要包含以下内容：</p>
<ul>
<li>Step-by-step instructions（执行步骤）</li>
<li>Examples of inputs and outputs（输入输出示例）</li>
<li>Common edge cases（边界情况）</li>
</ul>
</li>
<li>
<p>scripts/</p>
<p>scripts 是<strong>可选的</strong>，目录下包含的是 Agent 可执行的代码，这些代码会在 skill 的执行过程中被调用，就当前这个例子来说，它提供了一个 prompt 自动优化的脚本 <a href="https://link.juejin.cn?target=http%3A%2F%2Foptimize-prompt.py" target="_blank" title="http://optimize-prompt.py" ref="nofollow noopener noreferrer"><code>optimize-prompt.py</code></a> ，当用户需要优化 prompt 时会执行这个脚本，<strong>这里要注意的是执行脚本不会占用模型上下文</strong>。</p>
<pre><code class="hljs language-jsx" lang="jsx">## <span class="hljs-title class_">Resources</span>

- **scripts/optimize-prompt.<span class="hljs-property">py</span>**: <span class="hljs-title class_">Automated</span> prompt optimization tool
</code></pre>
</li>
<li>
<p>references/</p>
<p>references 是<strong>可选的</strong>，目录下包含的是一些参考资料，Agent 会根据场景需求按需加载，加载reference 时会占用模型上下文，合理的利用 references 能够有效的减少上下文。</p>
<p>就当前的例子来说，它提供了<a href="https://link.juejin.cn?target=http%3A%2F%2Fchain-of-thought.md%2F" target="_blank" title="http://chain-of-thought.md/" ref="nofollow noopener noreferrer">chain-of-thought.md</a>、<a href="https://link.juejin.cn?target=http%3A%2F%2Ffew-shot-learning.md%2F" target="_blank" title="http://few-shot-learning.md/" ref="nofollow noopener noreferrer">few-shot-learning.md</a> 等提示词优化方案的参考资料，并在 <a href="https://link.juejin.cn?target=http%3A%2F%2FSKILL.md" target="_blank" title="http://SKILL.md" ref="nofollow noopener noreferrer">SKILL.md</a> 文件中进行引用说明。</p>
<pre><code class="hljs language-jsx" lang="jsx">## <span class="hljs-title class_">Resources</span>

- **references/few-shot-learning.<span class="hljs-property">md</span>**: <span class="hljs-title class_">Deep</span> dive on example selection and construction
- **references/chain-<span class="hljs-keyword">of</span>-thought.<span class="hljs-property">md</span>**: <span class="hljs-title class_">Advanced</span> reasoning elicitation techniques
- **references/prompt-optimization.<span class="hljs-property">md</span>**: <span class="hljs-title class_">Systematic</span> refinement workflows
- **references/prompt-templates.<span class="hljs-property">md</span>**: <span class="hljs-title class_">Reusable</span> template patterns
- **references/system-prompts.<span class="hljs-property">md</span>**: <span class="hljs-title class_">System</span>-level prompt design
</code></pre>
</li>
<li>
<p>assets/</p>
<p>assets 是<strong>可选的</strong>，目录下包含的是一些静态文件，例如图片、html文件、css文件等，Agent 会根据场景需求按需加载，例如示例中的 <a href="https://link.juejin.cn?target=http%3A%2F%2Fprompt-template-library.md" target="_blank" title="http://prompt-template-library.md" ref="nofollow noopener noreferrer">prompt-template-library.md</a> 文件，作为创建 prompt 的模板文件，加载 assets 会占用模型上下文。</p>
<pre><code class="hljs language-jsx" lang="jsx">## <span class="hljs-title class_">Resources</span>

- assets/prompt-template-library.<span class="hljs-property">md</span>: <span class="hljs-title class_">Battle</span>-tested prompt templates
- assets/few-shot-examples.<span class="hljs-property">json</span>: <span class="hljs-title class_">Curated</span> example datasets
</code></pre>
</li>
</ul>
<h2 data-id="heading-3">Agent Skill执行原理</h2>
<p>下面是一个完整的流程图。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/66989d3d6a324fb5a7371997e2166631~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6KW_6Zm1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769950809&amp;x-signature=BmFLkGFQG4EHBA4WiVdJvWNCIBE%3D" alt="image.png" loading="lazy"/></p>
<p>skill 采用三级加载系统来高效管理上下文，具体如下：</p>
<ul>
<li>用户发送 query 后， claude code（cursor）会将所有 skills 的元信息带给大模型，由大模型判断需要使用哪个 skill。</li>
<li>大模型确认使用某一个 skill 后，claude code 才会将 <a href="https://link.juejin.cn?target=http%3A%2F%2Fskil.md" target="_blank" title="http://skil.md" ref="nofollow noopener noreferrer">skill.md</a> 的完整信息带给大模型。</li>
<li>大模型根据场景需求按需加载 reference 、assets 和 scripts 资源。</li>
</ul>
<h2 data-id="heading-4">安装Agent Skill</h2>
<p>Agent Skill 的安装方式有很多种，这里以 Claude Code 进行介绍。</p>
<ul>
<li>
<p>简单粗暴，直接从 github 上下载 skill 文件。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ea23b9c5f2b84001b2c1e10d254c3cab~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6KW_6Zm1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769950809&amp;x-signature=AQ9i%2BA3mhEZD0Nq9EQvejOmZ8OM%3D" alt="image.png" loading="lazy"/></p>
<p>这里展示的是 Anthropics 官方提供的 skills（<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fanthropics%2Fskills" target="_blank" title="https://github.com/anthropics/skills" ref="nofollow noopener noreferrer">github.com/anthropics/…</a>） 。</p>
</li>
<li>
<p>使用 skill 命令行工具安装</p>
<p>vercel 近期发布了一个 skill 安装工具 <a href="https://link.juejin.cn?target=https%3A%2F%2Fskills.sh%2F" target="_blank" title="https://skills.sh/" ref="nofollow noopener noreferrer">skills</a>，支持一键下载 github 上的开源 skill</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/64dd46ce61fc4b5d9757431ef8f7c909~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6KW_6Zm1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769950809&amp;x-signature=k6QOe5SLpY%2Bxjvng9bn7jvuGpA4%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ee2cc9e5fbfb4121a92fc442de2ab2d4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6KW_6Zm1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769950809&amp;x-signature=tD8Q7ys0Kr%2FkTe8nW9%2BjOKElnH4%3D" alt="image.png" loading="lazy"/></p>
<p>同时下载的 skill 支持多平台，例如 Claude Code、Cursor、GitHub Copilot 等：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c6681e213495456c8b2a2c35887f49eb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6KW_6Zm1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769950809&amp;x-signature=wEASeBr6zrra7Ctc%2F4tjyVJK05Y%3D" alt="image.png" loading="lazy"/></p>
</li>
<li>
<p>官方安装方案</p>
<p>以 Claude Code 为例，在 Claude Code 中提供了一个新的概念——plugin。</p>
<p>插件（Plugin）是 Claude Code 中最高级别的扩展机制，用于将command、agent、Skills、hooks、MCP、LSP 等能力<strong>打包、版本化、共享和分发</strong>。</p>
<p>在 Claude Code 中可以通过 /plugin 命令来安装 plugin，以 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fanthropics%2Fskills" target="_blank" title="https://github.com/anthropics/skills" ref="nofollow noopener noreferrer">Anthropics 官方的 skills 为例</a>，它本身是一个 plugin：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ff2b75cb00fa47bdb6e71bdd9115d253~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6KW_6Zm1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769950809&amp;x-signature=qm7WRHeLvsEUVb0QVKhN3e%2BON0Q%3D" alt="image.png" loading="lazy"/></p>
<p>可以先通过 <code>/plugin marketplace add anthropics/skills</code> 这行命令先添加插件市场，然后通过下面两种方案从插件中安装对应的 skills。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d9a1bdc051ad4a728d73ab1ef95d03ad~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6KW_6Zm1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769950809&amp;x-signature=jxm6O1Lqhv%2FT9NxleYmAuLPenEo%3D" alt="image.png" loading="lazy"/></p>
<p>现在社区已经提供了可以查看 github 上开源的 skill 的网站—— <a href="https://link.juejin.cn?target=https%3A%2F%2Fskillsmp.com%2Fzh" target="_blank" title="https://skillsmp.com/zh" ref="nofollow noopener noreferrer">skillsmp.com</a> ，目前已经集成了 <strong>80,948+</strong> 个 skill。</p>
</li>
</ul>
<h2 data-id="heading-5">Skill Creator</h2>
<p>现在我们已经了解了什么是 agent skill 及其原理，但对于不少开发者来说，首次开发一个标准的 skill 也是有一定难度的，当然现在社区已经有很多非常优秀的开源 skill 可以学习。</p>
<p>为了降低开发 skill 的成本，官方专门提供了一个用来创建标准 skill 的 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fanthropics%2Fskills%2Fblob%2Fmain%2Fskills%2Fskill-creator%2FSKILL.md" target="_blank" title="https://github.com/anthropics/skills/blob/main/skills/skill-creator/SKILL.md" ref="nofollow noopener noreferrer">skill</a>，文档中详细介绍创建 skill 的准则以及步骤，大模型会根据 <a href="https://link.juejin.cn?target=http%3A%2F%2FSKILL.md" target="_blank" title="http://SKILL.md" ref="nofollow noopener noreferrer">SKILL.md</a> 中的要求一步步引导开发者并创建 skill。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6d0c75cd32734c20b28fcf0d22f8cf75~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6KW_6Zm1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769950809&amp;x-signature=Hd2TTKX7uxf7R2BVjVNXT%2FD05KU%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-6">安装 skill-creator</h3>
<pre><code class="hljs language-jsx" lang="jsx">npx skills add <span class="hljs-attr">https</span>:<span class="hljs-comment">//github.com/anthropics/skills --skill skill-creator</span>
</code></pre>
<p>使用 skills 命令行工具在全局/项目中安装 skill，安装完之后可以在 .claude/ 目录下进行查看。</p>
<h3 data-id="heading-7">创建 skill</h3>
<p>下面我会使用 Claude Code 实现一个 code review skill 来学习整个创建过程。</p>
<ul>
<li>
<p>输入指令及要求</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c7e7f04154ef4670a409d6e13de01a8b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6KW_6Zm1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769950809&amp;x-signature=kznNgrbFTL6KWtMKnKRU%2BFkYmkQ%3D" alt="image.png" loading="lazy"/></p>
<p>Claude Code 发现有一个 skill-creator 的技能可以使用，询问我是否使用。</p>
</li>
<li>
<p>需求描述</p>
<p>接下来大模型会读取 skill-creator 并按照要求来引导用户进行信息补充，我们只需要按照提示一步步进行信息补充。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3cc1905e509241878a02fb03e2af903a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6KW_6Zm1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769950809&amp;x-signature=0qK5I1e8Fd2%2FAhwoU2XcDM5uSAQ%3D" alt="image.png" loading="lazy"/></p>
<p>下面是生成完的 SKILL.md，整体效果还是非常好的。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5e77c57fb5c44f38ad5b7be7e0961ddd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6KW_6Zm1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769950809&amp;x-signature=U%2BepeE4IyaXYaXPoTyD7ip2CNpw%3D" alt="image.png" loading="lazy"/></p>
</li>
<li>
<p>调整skill</p>
<p>基于生成的 skill 进行调整，例如补充 script、references 等，例如在审查范围中只列举了需要审查的点，缺少代码示例以及背景知识介绍：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b25d018b0c374badb2016545d22d1682~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6KW_6Zm1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769950809&amp;x-signature=3Yn7CqC%2F8iX4etzyrDAhXgvd5w8%3D" alt="image.png" loading="lazy"/></p>
<p>比如红框中光说不必要的重新渲染，但是却不告诉大模型 React 的渲染机制，不提供重渲染的优化策略和示例，最终的大模型可能就自行发挥，偏离预期。</p>
<p>为了解决这一问题，我们可以为每一个审查点提供一个具体的 <a href="https://link.juejin.cn?target=http%3A%2F%2Freference.md" target="_blank" title="http://reference.md" ref="nofollow noopener noreferrer">reference.md</a> 文件，包含相关背景知识、错误示例和正确示例等，下面是我简化后的版本：</p>
<pre><code class="hljs language-jsx" lang="jsx">---
<span class="hljs-attr">name</span>: react-code-review
<span class="hljs-attr">description</span>: 全面的<span class="hljs-title class_">React</span>代码审查工具，主要检查react的最佳实践。当用户需要审查<span class="hljs-title class_">React</span>代码文件或代码片段时使用，提供具体的改进建议和代码示例。
---

# <span class="hljs-title class_">React</span>代码审查

## 概述

这个skill用于对<span class="hljs-title class_">React</span>代码进行全面的审查，主要检查react的最佳实践，审查结果包含具体的代码示例和改进建议。

## 快速开始

### 审查流程

<span class="hljs-number">1.</span> **获取代码** - 用户提供要审查的<span class="hljs-title class_">React</span>代码文件路径或代码片段
<span class="hljs-number">2.</span> **多维度分析** - 按照审查检查清单进行全面分析
<span class="hljs-number">3.</span> **优化代码** - 根据修改意见优化代码

### 基本审查命令

用户请求审查时通常的表述方式：
- <span class="hljs-string">"帮我审查这个React组件：`src/components/Header.tsx`"</span>
- <span class="hljs-string">"请对这段React代码进行 code review"</span>

## 审查范围

完整的代码审查涵盖以下<span class="hljs-number">5</span>个方面：

- 条件渲染
- <span class="hljs-title class_">Effect</span>依赖
- 状态更新
- 状态初始化
- useMemo滥用

## 使用建议

<span class="hljs-number">1.</span> **准备代码** - 确保提供的代码文件可以被访问
<span class="hljs-number">2.</span> **明确目标** - 如需重点审查某个方面，可以特别说明
<span class="hljs-number">3.</span> **上下文信息** - 提供项目相关的背景信息（框架版本、规范等）
<span class="hljs-number">4.</span> **反复迭代** - 根据建议进行改进，可再次审查

## 限制和注意

- 审查基于代码静态分析，不能检测运行时的所有问题
- 某些性能问题需要实际测试才能确认
- 对于复杂的业务逻辑，建议配合单元测试

## 资源文件

此skill包含以下参考资源文件：

### references/
- **[条件渲染](references/rendering-conditional-render.<span class="hljs-property">md</span>)** - 在react中使用条件渲染的最佳实践
- **[<span class="hljs-title class_">Effect</span>依赖](references/rerender-dependencies.<span class="hljs-property">md</span>)** - 填写useEffect依赖的最佳实践
- **[状态更新](references/rerender-functional-setstate.<span class="hljs-property">md</span>)** - 在react中更新状态的最佳实践
- **[状态初始化](references/rerender-lazy-state-init.<span class="hljs-property">md</span>)** - 在react中初始化状态的最佳实践
- **[useMemo滥用](references/rerender-simple-expression-<span class="hljs-keyword">in</span>-memo.<span class="hljs-property">md</span>)** - 滥用useMemo的场景介绍
</code></pre>
<p>react 最佳实践的原则可以参考 vercel 开源的 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fvercel-labs%2Fagent-skills" target="_blank" title="https://github.com/vercel-labs/agent-skills" ref="nofollow noopener noreferrer">skill</a>。</p>
</li>
</ul>
<h2 data-id="heading-8">Skill VS 提示词</h2>
<p>很多人写完 skill 可能会觉得和写提示词并没有什区别，skill 不就是一段很长的提示词吗？这个理解对了一半。<a href="https://link.juejin.cn?target=http%3A%2F%2Fskill.md%2F" target="_blank" title="http://skill.md/" ref="nofollow noopener noreferrer">SKILL.md</a> 的核心确实是指令文本，但 skill 却远不止如此，下面列举了 skill 相比提示词的核心优势。</p>
<ul>
<li>
<p>可复用</p>
<p>skill 写一次之后，后续 Agent 会自动加载，不需要重复的复制黏贴。</p>
</li>
<li>
<p>可渐进加载</p>
<p>Skill 的指令文本和附带的资源文件不会一次性全部发送给大模型，而是会根据需求渐进加载，而提示词不管再怎么组织，发给大模型的就是全部内容，会占用大量的上下文。</p>
</li>
<li>
<p>面向 Agent</p>
<p>Skill 的全名是 Agent Skill，即它面向的是 Agent，而非普通的 ChatBot。因为 Agent 是具备工具调用的能力。</p>
</li>
</ul>
<h2 data-id="heading-9">什么时候需要封装 Skill？</h2>
<p>在学习和引入新技术时，最常见的误区是“拿着锤子找钉子”——为了使用某个技术而强行套用场景。任何技术都只有在<strong>合适的抽象层级和边界内使用</strong>，才能最大化其价值，否则只会引入不必要的复杂度。</p>
<p>对 Agent Skill 也是同样的原则。Skill 的本质并不是“把能力都包一层”，而是用于<strong>补齐 Agent 自身不具备、但又高频复用的能力模块</strong>。它更像是一个能力插件，而不是业务逻辑的简单封装。</p>
<p>例如，将 code review 封装为一个 Skill 是合理的，因为它具备以下特征：</p>
<ul>
<li>Agent 原生能力不足以稳定覆盖该任务，代码风格没有一个很严格的标准。</li>
<li>code review 是开发者每天重复要做且非常重要任务。</li>
</ul>
<p>反过来，如果某个能力 Agent 已经可以通过 Prompt 或上下文稳定完成，那么再额外封装成 Skill，往往只会增加系统复杂度（配置成本、调用成本、维护成本），却无法带来实质性的能力增益。</p>
<h2 data-id="heading-10">总结</h2>
<p>Agent Skills 的出现，本质上是为了解决通用 Agent 在专业领域中的能力不足问题。将人的流程经验、工具使用方式和领域知识封装为可复用、可组合的能力模块，使 Agent 能够以更低的上下文成本执行专业任务。</p>
<p>但 Skill 并不适合被滥用，它的核心价值在于补齐能力缺口，而不是包装已有能力。当某项任务已经可以通过上下文和指令稳定完成时，引入 Skill 往往只会增加系统复杂度，却无法带来实际收益。真正值得封装的，应当是高频、结构化、强依赖专业知识且具有长期复用价值的能力，否则 Skill 本身就会成为新的技术负担。</p>
<h2 data-id="heading-11">参考资料</h2>
<ul>
<li>skill 官方解读：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.anthropic.com%2Fengineering%2Fequipping-agents-for-the-real-world-with-agent-skills" target="_blank" title="https://www.anthropic.com/engineering/equipping-agents-for-the-real-world-with-agent-skills" ref="nofollow noopener noreferrer">www.anthropic.com/engineering…</a></li>
<li>Anthropic 官方 Skills 仓库：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fanthropics%2Fskills" target="_blank" title="https://github.com/anthropics/skills" ref="nofollow noopener noreferrer">github.com/anthropics/…</a></li>
<li>Vercel <em>Agent Skills：</em><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fvercel-labs%2Fagent-skills" target="_blank" title="https://github.com/vercel-labs/agent-skills" ref="nofollow noopener noreferrer">github.com/vercel-labs…</a></li>
<li><em>Prompt Engineering Patterns Skill：</em><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fwshobson%2Fagents%2Ftree%2Fmain%2Fplugins%2Fllm-application-dev%2Fskills%2Fprompt-engineering-patterns" target="_blank" title="https://github.com/wshobson/agents/tree/main/plugins/llm-application-dev/skills/prompt-engineering-patterns" ref="nofollow noopener noreferrer">github.com/wshobson/ag…</a></li>
<li>Skills 脚手架：<a href="https://link.juejin.cn?target=https%3A%2F%2Fskills.sh%2F" target="_blank" title="https://skills.sh/" ref="nofollow noopener noreferrer">skills.sh</a></li>
<li>Skills 广场：<a href="https://link.juejin.cn?target=https%3A%2F%2Fskillsmp.com%2F" target="_blank" title="https://skillsmp.com/" ref="nofollow noopener noreferrer">skillsmp.com</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>