<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>掘金文章推荐</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>一个帮助开发者成长的社区</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[Next.js第九章(AI)]]></title>    <link>https://juejin.cn/post/7574916588719538218</link>    <guid>https://juejin.cn/post/7574916588719538218</guid>    <pubDate>2025-11-21T13:24:50.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574916588719538218" data-draft-id="7574916588719521834" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Next.js第九章(AI)"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-11-21T13:24:50.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="小满zs"/> <meta itemprop="url" content="https://juejin.cn/user/2463384809252397"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Next.js第九章(AI)
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2463384809252397/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    小满zs
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T13:24:50.000Z" title="Fri Nov 21 2025 13:24:50 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">AI</h2>
<p>Vercel提供了AI SDK，可以让我们在Next.js中轻松集成AI功能。<a href="https://link.juejin.cn?target=https%3A%2F%2Fai-sdk.dev%2Fgetting-started" target="_blank" title="https://ai-sdk.dev/getting-started" ref="nofollow noopener noreferrer">AI SDK 官网</a></p>
<h4 data-id="heading-1">安装AI-SDK</h4>
<pre><code class="hljs language-sh" lang="sh">npm i ai @ai-sdk/deepseek @ai-sdk/react
</code></pre>
<p>这儿我们使用<code>deepseek</code>作为AI模型，<code>@ai-sdk/react</code>封装了流式输出和上下文管理hook，可以让我们在Next.js中轻松集成AI功能。如果你要安装其他模型，只需要将<code>deepseek</code>替换为其他模型即可。</p>
<p>例如：安装<code>openai</code>模型</p>
<pre><code class="hljs language-sh" lang="sh">npm i ai @ai-sdk/openai @ai-sdk/react
</code></pre>
<blockquote>
<p>为什么使用<code>deepseek</code>模型？因为<code>deepseek</code>比较便宜，充10元可以测试很久(非广告)。</p>
</blockquote>
<h4 data-id="heading-2">获取deepSeek API Key</h4>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3b389b99973b48f483f7d3ea52bddc6b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5ruhenM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764336290&amp;x-signature=6KRncuUWJT7bgvIrd4t7eRTZr1I%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/afdb38c5928a4b319f5790d732cd7b16~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5ruhenM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764336290&amp;x-signature=Zl1EeQPi9jh3iLQUdOPyKtx51hw%3D" alt="image.png" loading="lazy"/></p>
<p>然后把生成的API Key复制一下保存起来。</p>
<h4 data-id="heading-3">编写API接口</h4>
<p>src/app/api/chat/route.ts</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">NextRequest</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"next/server"</span>;
<span class="hljs-keyword">import</span> { streamText,convertToModelMessages } <span class="hljs-keyword">from</span> <span class="hljs-string">'ai'</span>
<span class="hljs-keyword">import</span> { createDeepSeek } <span class="hljs-keyword">from</span> <span class="hljs-string">"@ai-sdk/deepseek"</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-variable constant_">DEEPSEEK_API_KEY</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"./key"</span>;
<span class="hljs-keyword">const</span> deepSeek = <span class="hljs-title function_">createDeepSeek</span>({
    <span class="hljs-attr">apiKey</span>: <span class="hljs-variable constant_">DEEPSEEK_API_KEY</span>, <span class="hljs-comment">//设置API密钥</span>
});
<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">POST</span>(<span class="hljs-params">req: NextRequest</span>) {
    <span class="hljs-keyword">const</span> { messages } = <span class="hljs-keyword">await</span> req.<span class="hljs-title function_">json</span>(); <span class="hljs-comment">//获取请求体</span>
    <span class="hljs-comment">//这里为什么接受messages 因为我们使用前端的useChat 他会自动注入这个参数，所有可以直接读取</span>
    <span class="hljs-keyword">const</span> result = <span class="hljs-title function_">streamText</span>({
        <span class="hljs-attr">model</span>: <span class="hljs-title function_">deepSeek</span>(<span class="hljs-string">'deepseek-chat'</span>), <span class="hljs-comment">//使用deepseek-chat模型</span>
        <span class="hljs-attr">messages</span>:<span class="hljs-title function_">convertToModelMessages</span>(messages), <span class="hljs-comment">//转换为模型消息</span>
        <span class="hljs-comment">//前端传过来的额messages不符合sdk格式所以需要convertToModelMessages转换一下</span>
        <span class="hljs-comment">//转换之后的格式：</span>
        <span class="hljs-comment">//[</span>
            <span class="hljs-comment">//{ role: 'user', content: [ [Object] ] },</span>
            <span class="hljs-comment">//{ role: 'assistant', content: [ [Object] ] },</span>
            <span class="hljs-comment">//{ role: 'user', content: [ [Object] ] },</span>
            <span class="hljs-comment">//{ role: 'assistant', content: [ [Object] ] },</span>
            <span class="hljs-comment">//{ role: 'user', content: [ [Object] ] },</span>
            <span class="hljs-comment">//{ role: 'assistant', content: [ [Object] ] },</span>
            <span class="hljs-comment">//{ role: 'user', content: [ [Object] ] }</span>
        <span class="hljs-comment">//]</span>
        <span class="hljs-attr">system</span>: <span class="hljs-string">'你是一个高级程序员，请根据用户的问题给出回答'</span>, <span class="hljs-comment">//系统提示词</span>
    });
   
    <span class="hljs-keyword">return</span> result.<span class="hljs-title function_">toUIMessageStreamResponse</span>() <span class="hljs-comment">//返回流式响应</span>
}
</code></pre>
<p>src/app/page.tsx</p>
<p>我们在前端使用<code>useChat</code>组件来实现AI对话，这个组件内部封装了流式响应，默认会向<code>/api/chat</code>发送请求。</p>
<ul>
<li><code>messages</code>: 消息列表，包含用户和AI的对话内容</li>
<li><code>sendMessage</code>: 发送消息的函数，参数为消息内容</li>
<li><code>onFinish</code>: 消息发送完成后回调函数，可以在这里进行一些操作，例如清空输入框</li>
</ul>
<p><strong>messages</strong>：数据结构解析</p>
<pre><code class="hljs language-ts" lang="ts">[
    {
        <span class="hljs-string">"parts"</span>: [
            {
                <span class="hljs-string">"type"</span>: <span class="hljs-string">"text"</span>, <span class="hljs-comment">//文本类型</span>
                <span class="hljs-string">"text"</span>: <span class="hljs-string">"你知道 api router 吗"</span>
            }
        ],
        <span class="hljs-string">"id"</span>: <span class="hljs-string">"FPHwY1udRrkEoYgR"</span>, <span class="hljs-comment">//消息ID</span>
        <span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span> <span class="hljs-comment">//用户角色</span>
    },
    {
        <span class="hljs-string">"id"</span>: <span class="hljs-string">"qno6vcWcwFM4Yc8J"</span>, <span class="hljs-comment">//消息ID</span>
        <span class="hljs-string">"role"</span>: <span class="hljs-string">"assistant"</span>, <span class="hljs-comment">//AI角色</span>
        <span class="hljs-string">"parts"</span>: [
            {
                <span class="hljs-string">"type"</span>: <span class="hljs-string">"step-start"</span> <span class="hljs-comment">//步骤开始 </span>
            },
            {
                <span class="hljs-string">"type"</span>: <span class="hljs-string">"text"</span>, <span class="hljs-comment">//文本类型</span>
                <span class="hljs-string">"text"</span>: <span class="hljs-string">"是的，我知道 **API Router**。"</span>, <span class="hljs-comment">//文本内容</span>
                <span class="hljs-string">"state"</span>: <span class="hljs-string">"done"</span> <span class="hljs-comment">//步骤完成</span>
            }
        ]
    }
]
</code></pre>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-string">'use client'</span>;
<span class="hljs-keyword">import</span> { useState, useRef, useEffect } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Button</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/components/ui/button'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Textarea</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/components/ui/textarea'</span>;
<span class="hljs-keyword">import</span> { useChat } <span class="hljs-keyword">from</span> <span class="hljs-string">'@ai-sdk/react'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">HomePage</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> [input, setInput] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">''</span>); <span class="hljs-comment">//输入框的值</span>
    <span class="hljs-keyword">const</span> messagesEndRef = useRef&lt;<span class="hljs-title class_">HTMLDivElement</span>&gt;(<span class="hljs-literal">null</span>); <span class="hljs-comment">//获取消息结束的ref</span>
    <span class="hljs-comment">//useChat 内部封装了流式响应 默认会向/api/chat 发送请求</span>
    <span class="hljs-keyword">const</span> { messages, sendMessage } = <span class="hljs-title function_">useChat</span>({
        <span class="hljs-attr">onFinish</span>: <span class="hljs-function">() =&gt;</span> {
            <span class="hljs-title function_">setInput</span>(<span class="hljs-string">''</span>);
        }
    });

    <span class="hljs-comment">// 自动滚动到底部</span>
    <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
        messagesEndRef.<span class="hljs-property">current</span>?.<span class="hljs-title function_">scrollIntoView</span>({ <span class="hljs-attr">behavior</span>: <span class="hljs-string">'smooth'</span> });
    }, [messages]);
    <span class="hljs-comment">//回车发送消息</span>
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleKeyDown</span> = (<span class="hljs-params">e: React.KeyboardEvent&lt;HTMLTextAreaElement&gt;</span>) =&gt; {
        <span class="hljs-keyword">if</span> (e.<span class="hljs-property">key</span> === <span class="hljs-string">'Enter'</span> &amp;&amp; !e.<span class="hljs-property">shiftKey</span>) {
            e.<span class="hljs-title function_">preventDefault</span>();
            <span class="hljs-keyword">if</span> (input.<span class="hljs-title function_">trim</span>()) {
                <span class="hljs-title function_">sendMessage</span>({ <span class="hljs-attr">text</span>: input });
            }
        }
    };

    <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">'flex flex-col h-screen bg-linear-to-br from-blue-50 via-white to-purple-50'</span>&gt;</span>
            {/* 头部标题 */}
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">'bg-white/80 backdrop-blur-sm shadow-sm border-b border-gray-200'</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">'max-w-4xl mx-auto px-6 py-4'</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">className</span>=<span class="hljs-string">'text-2xl font-bold bg-linear-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent'</span>&gt;</span>
                        AI 智能助手
                    <span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">className</span>=<span class="hljs-string">'text-sm text-gray-500 mt-1'</span>&gt;</span>随时为您解答问题<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

            {/* 消息区域 */}
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">'flex-1 overflow-y-auto px-4 py-6'</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">'max-w-4xl mx-auto space-y-4'</span>&gt;</span>
                    {messages.length === 0 ? (
                        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">'flex flex-col items-center justify-center h-full text-center py-20'</span>&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">'bg-linear-to-br from-blue-100 to-purple-100 rounded-full p-6 mb-4'</span>&gt;</span>
                                <span class="hljs-tag">&lt;<span class="hljs-name">svg</span> <span class="hljs-attr">className</span>=<span class="hljs-string">'w-12 h-12 text-blue-600'</span> <span class="hljs-attr">fill</span>=<span class="hljs-string">'none'</span> <span class="hljs-attr">stroke</span>=<span class="hljs-string">'currentColor'</span> <span class="hljs-attr">viewBox</span>=<span class="hljs-string">'0 0 24 24'</span>&gt;</span>
                                    <span class="hljs-tag">&lt;<span class="hljs-name">path</span> <span class="hljs-attr">strokeLinecap</span>=<span class="hljs-string">'round'</span> <span class="hljs-attr">strokeLinejoin</span>=<span class="hljs-string">'round'</span> <span class="hljs-attr">strokeWidth</span>=<span class="hljs-string">{2}</span> <span class="hljs-attr">d</span>=<span class="hljs-string">'M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z'</span> /&gt;</span>
                                <span class="hljs-tag">&lt;/<span class="hljs-name">svg</span>&gt;</span>
                            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">className</span>=<span class="hljs-string">'text-xl font-semibold text-gray-700 mb-2'</span>&gt;</span>开始对话<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">className</span>=<span class="hljs-string">'text-gray-500'</span>&gt;</span>输入您的问题，我会尽力帮助您<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
                        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                    ) : (
                        messages.map((message) =&gt; (
                            <span class="hljs-tag">&lt;<span class="hljs-name">div</span>
                                <span class="hljs-attr">key</span>=<span class="hljs-string">{message.id}</span>
                                <span class="hljs-attr">className</span>=<span class="hljs-string">{</span>`<span class="hljs-attr">flex</span> ${<span class="hljs-attr">message.role</span> === <span class="hljs-string">'user'</span> ? '<span class="hljs-attr">justify-end</span>' <span class="hljs-attr">:</span> '<span class="hljs-attr">justify-start</span>'} <span class="hljs-attr">animate-in</span> <span class="hljs-attr">fade-in</span> <span class="hljs-attr">slide-in-from-bottom-4</span> <span class="hljs-attr">duration-500</span>`}
                            &gt;</span>
                                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{</span>`<span class="hljs-attr">flex</span> <span class="hljs-attr">gap-3</span> <span class="hljs-attr">max-w-</span>[<span class="hljs-attr">80</span>%] ${<span class="hljs-attr">message.role</span> === <span class="hljs-string">'user'</span> ? '<span class="hljs-attr">flex-row-reverse</span>' <span class="hljs-attr">:</span> '<span class="hljs-attr">flex-row</span>'}`}&gt;</span>
                                    {/* 头像 */}
                                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{</span>`<span class="hljs-attr">shrink-0</span> <span class="hljs-attr">w-8</span> <span class="hljs-attr">h-8</span> <span class="hljs-attr">rounded-full</span> <span class="hljs-attr">flex</span> <span class="hljs-attr">items-center</span> <span class="hljs-attr">justify-center</span> <span class="hljs-attr">text-white</span> <span class="hljs-attr">font-semibold</span> ${
                                        <span class="hljs-attr">message.role</span> === <span class="hljs-string">'user'</span> 
                                            ? '<span class="hljs-attr">bg-linear-to-br</span> <span class="hljs-attr">from-blue-500</span> <span class="hljs-attr">to-blue-600</span>' 
                                            <span class="hljs-attr">:</span> '<span class="hljs-attr">bg-linear-to-br</span> <span class="hljs-attr">from-purple-500</span> <span class="hljs-attr">to-purple-600</span>'
                                    }`}&gt;</span>
                                        {message.role === 'user' ? '你' : 'AI'}
                                    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                                    
                                    {/* 消息内容 */}
                                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{</span>`<span class="hljs-attr">flex</span> <span class="hljs-attr">flex-col</span> ${<span class="hljs-attr">message.role</span> === <span class="hljs-string">'user'</span> ? '<span class="hljs-attr">items-end</span>' <span class="hljs-attr">:</span> '<span class="hljs-attr">items-start</span>'}`}&gt;</span>
                                        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{</span>`<span class="hljs-attr">rounded-2xl</span> <span class="hljs-attr">px-4</span> <span class="hljs-attr">py-3</span> <span class="hljs-attr">shadow-sm</span> ${
                                            <span class="hljs-attr">message.role</span> === <span class="hljs-string">'user'</span>
                                                ? '<span class="hljs-attr">bg-linear-to-br</span> <span class="hljs-attr">from-blue-500</span> <span class="hljs-attr">to-blue-600</span> <span class="hljs-attr">text-white</span>'
                                                <span class="hljs-attr">:</span> '<span class="hljs-attr">bg-white</span> <span class="hljs-attr">border</span> <span class="hljs-attr">border-gray-200</span> <span class="hljs-attr">text-gray-800</span>'
                                        }`}&gt;</span>
                                            {message.parts.map((part, index) =&gt; {
                                                switch (part.type) {
                                                    case 'text':
                                                        return (
                                                            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{message.id</span> + <span class="hljs-attr">index</span>} <span class="hljs-attr">className</span>=<span class="hljs-string">'whitespace-pre-wrap wrap-break-word'</span>&gt;</span>
                                                                {part.text}
                                                            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                                                        );
                                                }
                                            })}
                                        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                                    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                        ))
                    )}
                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">{messagesEndRef}</span> /&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

            {/* 输入区域 */}
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">'bg-white/80 backdrop-blur-sm border-t border-gray-200 shadow-lg'</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">'max-w-4xl mx-auto px-4 py-4'</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">'flex gap-3 items-end'</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">'flex-1 relative'</span>&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">Textarea</span>
                                <span class="hljs-attr">value</span>=<span class="hljs-string">{input}</span>
                                <span class="hljs-attr">onChange</span>=<span class="hljs-string">{(e)</span> =&gt;</span> setInput(e.target.value)}
                                onKeyDown={handleKeyDown}
                                placeholder='请输入你的问题... (按 Enter 发送，Shift + Enter 换行)'
                                className='min-h-[60px] max-h-[200px] resize-none rounded-xl border-gray-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all shadow-sm'
                            /&gt;
                        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">Button</span>
                            <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> {
                                if (input.trim()) {
                                    sendMessage({ text: input });
                                }
                            }}
                            disabled={!input.trim()}
                            className='h-[60px] px-6 rounded-xl bg-linear-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 transition-all shadow-md hover:shadow-lg disabled:opacity-50 disabled:cursor-not-allowed'
                        &gt;
                            <span class="hljs-tag">&lt;<span class="hljs-name">svg</span> <span class="hljs-attr">className</span>=<span class="hljs-string">'w-5 h-5'</span> <span class="hljs-attr">fill</span>=<span class="hljs-string">'none'</span> <span class="hljs-attr">stroke</span>=<span class="hljs-string">'currentColor'</span> <span class="hljs-attr">viewBox</span>=<span class="hljs-string">'0 0 24 24'</span>&gt;</span>
                                <span class="hljs-tag">&lt;<span class="hljs-name">path</span> <span class="hljs-attr">strokeLinecap</span>=<span class="hljs-string">'round'</span> <span class="hljs-attr">strokeLinejoin</span>=<span class="hljs-string">'round'</span> <span class="hljs-attr">strokeWidth</span>=<span class="hljs-string">{2}</span> <span class="hljs-attr">d</span>=<span class="hljs-string">'M12 19l9 2-9-18-9 18 9-2zm0 0v-8'</span> /&gt;</span>
                            <span class="hljs-tag">&lt;/<span class="hljs-name">svg</span>&gt;</span>
                        <span class="hljs-tag">&lt;/<span class="hljs-name">Button</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
    );
}
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3f37ae3e6f2c40f48901a37251cabd7e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5ruhenM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764336290&amp;x-signature=HPVslXZQ2loQfJLIFrfmb5ONPQ8%3D" alt="5.gif" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[从 Cloudflare 服务中断，看建立多维度风险应对机制的必要]]></title>    <link>https://juejin.cn/post/7575006095388901385</link>    <guid>https://juejin.cn/post/7575006095388901385</guid>    <pubDate>2025-11-21T13:42:52.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575006095388901385" data-draft-id="7575006095388868617" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="从 Cloudflare 服务中断，看建立多维度风险应对机制的必要"/> <meta itemprop="keywords" content="人工智能,云计算,云原生"/> <meta itemprop="datePublished" content="2025-11-21T13:42:52.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="AKAMAI"/> <meta itemprop="url" content="https://juejin.cn/user/829502942352628"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            从 Cloudflare 服务中断，看建立多维度风险应对机制的必要
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/829502942352628/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    AKAMAI
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T13:42:52.000Z" title="Fri Nov 21 2025 13:42:52 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>11月18日，Cloudflare 出现技术问题，致使全球互联网多处停止运行，多个主要网站瘫痪。求职网站 Indeed、Anthropic 的 Claude 聊天机器人、X（前 Twitter）、电影评论网站 Letterboxd 等平台均受到波及，部分用户短暂无法访问。用户访问这些平台时，收到显示因 Cloudflare 问题导致页面无法加载的错误消息，成千上万的用户报告了相关问题 。</p>
<p>由于此次中断对许多高知名度网站造成了重大影响，该事件已被报道为全球突发新闻。Cloudflare 发言人表示，中断的“根本原因”是用于管理威胁流量的自动生成的配置文件，该文件“超出了预期的条目大小”，从而引发了处理多项服务流量的软件系统崩溃。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9d539a9dafd94f4698b82b3d949143bf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUtBTUFJ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764337371&amp;x-signature=M0C0qZAYf5lkh6y0KQfLKHzunTE%3D" alt="" loading="lazy"/></p>
<p>（图片源自互联网）</p>
<p>无独有偶，在此前不久，在亚马逊发布相关服务不到一个月后，其 Web 服务便遭受了长达一天的中断，导致大量在线服务瘫痪。随后，Microsoft 在全球范围内也出现服务中断情况。</p>
<p>时间往前回溯，2024 年 7 月，网络安全公司 CrowdStrike 的一次错误升级导致大范围停电，不仅致使航班暂时停飞，金融服务受到严重冲击，还迫使医院推迟手术。</p>
<p>这些事件凸显了互联网安全的复杂性与脆弱性，即便是一个看似细微的配置问题，都可能引发大规模的服务中断，给企业和用户带来一定的损失。企业需要在危机发生之前，部署可靠、全面的安全解决方案来应对各种潜在问题与威胁。</p>
<p>Akamai 一直将弹性能力和防止宕机视为首要任务。正如负责这一全球最分布式计算平台团队的高级副总裁兼首席技术官 James Kretchmar 所说——</p>
<blockquote>
<p>虽然没有任何一家服务提供商能够完全免于风险，但选择那些始终坚持完善实践的提供商至关重要——包括弹性工程与架构级防护措施、稳健的运营与变更安全流程、完善的治理体系以及深入的情景预案规划，例如 Akamai。</p>
<p>作为网络安全领域的利益相关者与专家，Akamai 深知任何人都有可能遭受零日攻击或意料之外的漏洞影响。同样，我们也清楚全球最大的组织都依赖 Akamai，因此持续投入建设我们的平台始终是首要任务。</p>
</blockquote>
<p>借助Akamai 规模宏大、覆盖全球的平台，以及卓越的威胁监测能力，企业能够全天候、7×24h不间断地在本地与云环境中有效防范、精准检测并强力抵御各类网络威胁，进而树立品牌信任度，稳步实现企业愿景：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cde0d6e8e2a64ce3b0d2e75836c2fab7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUtBTUFJ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764337371&amp;x-signature=21o30z5VcgpuT8wPiyDB48b6WW8%3D" alt="" loading="lazy"/></p>
<p>（图片源自互联网）</p>
<p>在超过25 年的时间里，Akamai 一直是全球各大顶级组织值得信赖的合作伙伴，包括：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cc19114714aa4220bdbf3a90a450367f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUtBTUFJ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764337371&amp;x-signature=C19DAIWmbs4I5Ch%2BjIXWWycrrRg%3D" alt="" loading="lazy"/></p>
<p>（图片源自互联网）</p>
<p>在我们所处的数字世界中，所有人都彼此紧密相连。Akamai 以平台的高弹性为荣，只为更好地支持全球企业。我们深知自己在客户业务中所扮演的重要角色，并对此高度重视。客户对 Akamai 的信任，是我们支持并保护数字世界的核心所在。</p>
<p>如您希望了解更多Akamai所提供的服务，欢迎您拨打 400-609-1609 预约咨询，您也可以<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.akamai.com%2Fzh%2Fproducts%2Fweb-performance-optimization%23free-trial%3Futm_campaign%3Df-mc-65893%26utm_id%3Dapj_cc%26utm_source%3Djuejin%26utm_medium%3Darticle_advertorial%26utm_content%3Djuejin_251121_blogarticles229_end" target="_blank" title="https://www.akamai.com/zh/products/web-performance-optimization#free-trial?utm_campaign=f-mc-65893&amp;utm_id=apj_cc&amp;utm_source=juejin&amp;utm_medium=article_advertorial&amp;utm_content=juejin_251121_blogarticles229_end" ref="nofollow noopener noreferrer">点击此处</a>，借助 Akamai 规模庞大的全球平台以及出色的威胁监测能力，在本地和云环境中防范、检测和抵御网络威胁，建立品牌信任度并实现您的愿景。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[计算机毕业设计推荐：基于springboot的快递物流仓库管理系统【Java+spring boot+MySQL、Java项目、Java毕设、Java项目定制定]]></title>    <link>https://juejin.cn/post/7574972697677709348</link>    <guid>https://juejin.cn/post/7574972697677709348</guid>    <pubDate>2025-11-21T12:15:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574972697677709348" data-draft-id="7574996958516576275" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="计算机毕业设计推荐：基于springboot的快递物流仓库管理系统【Java+spring boot+MySQL、Java项目、Java毕设、Java项目定制定"/> <meta itemprop="keywords" content="Java,Spring Boot,MySQL"/> <meta itemprop="datePublished" content="2025-11-21T12:15:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="计算机毕业设计小途"/> <meta itemprop="url" content="https://juejin.cn/user/3344059640330504"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            计算机毕业设计推荐：基于springboot的快递物流仓库管理系统【Java+spring boot+MySQL、Java项目、Java毕设、Java项目定制定
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3344059640330504/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    计算机毕业设计小途
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T12:15:17.000Z" title="Fri Nov 21 2025 12:15:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>💖💖作者：计算机毕业设计小途
💙💙个人简介：曾长期从事计算机专业培训教学，本人也热爱上课教学，语言擅长Java、微信小程序、Python、Golang、安卓Android等，开发项目包括大数据、深度学习、网站、小程序、安卓、算法。平常会做一些项目定制化开发、代码讲解、答辩教学、文档编写、也懂一些降重方面的技巧。平常喜欢分享一些自己开发中遇到的问题的解决办法，也喜欢交流技术，大家有技术代码这一块的问题可以问我！
💛💛想说的话：感谢大家的关注与支持！
💜💜
<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2F2501_92808674%2Fcategory_13011385.html" target="_blank" title="https://blog.csdn.net/2501_92808674/category_13011385.html" ref="nofollow noopener noreferrer">网站实战项目</a>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2F2501_92808674%2Fcategory_13011386.html" target="_blank" title="https://blog.csdn.net/2501_92808674/category_13011386.html" ref="nofollow noopener noreferrer">安卓/小程序实战项目</a>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2F2501_92808674%2Fcategory_13011387.html" target="_blank" title="https://blog.csdn.net/2501_92808674/category_13011387.html" ref="nofollow noopener noreferrer">大数据实战项目</a>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2F2501_92808674%2Fcategory_13011390.html%3Fspm%3D1001.2014.3001.5482" target="_blank" title="https://blog.csdn.net/2501_92808674/category_13011390.html?spm=1001.2014.3001.5482" ref="nofollow noopener noreferrer">深度学习实战项目</a></p>
</blockquote>
<p>@<a href="https://link.juejin.cn?target=%25E7%259B%25AE%25E5%25BD%2595" target="_blank" title="%E7%9B%AE%E5%BD%95" ref="nofollow noopener noreferrer">TOC</a></p>
<h2 data-id="heading-0">基于springboot的快递物流仓库管理系统介绍</h2>
<p>本《基于SpringBoot的快递物流仓库管理系统》是一套专为模拟和管理现代快递物流仓储业务而设计的综合性信息管理平台，旨在通过信息化手段实现对快递包裹从揽收到运输完成全生命周期的精细化管控。系统采用当前业界主流且成熟的前后端分离架构进行开发，后端核心技术栈为Java语言结合轻量级、高效率的SpringBoot框架，整合了Spring、SpringMVC与MyBatis，实现了业务逻辑与数据访问的清晰分层；前端界面则基于Vue.js框架，并选用ElementUI组件库进行构建，打造了美观、响应式且用户体验友好的操作界面。整体系统基于B/S架构，通过IDEA或PyCharm作为开发工具，并选用稳定可靠的MySQL关系型数据库作为数据持久化存储方案。在功能层面，系统全面覆盖了快递物流的核心运营环节，构建了一个完整的业务闭环：首先，系统提供了完善的基础数据管理功能，包括对司机信息、快递员信息、客户信息、快递类型以及物流仓库等基础档案的统一维护；其次，核心业务流程模块精确追踪了包裹的每一个动态节点，从“快递揽件”的源头信息录入，到“快递入库”与“快递出库”的仓储作业管理，再到“快递运输”的过程监控，直至“运输完成”的状态确认，确保了物流信息流的完整与准确。此外，系统还特别设计了与人力成本相关的“司机津贴”和“快递员津贴”管理模块，实现了对运营成本的初步核算。最后，系统还配备了基础的“系统管理”与“个人中心”功能，保障了系统的安全与个性化使用，并通过“系统首页”为用户提供了关键业务数据的可视化概览，从而构成了一个功能完备、流程清晰、技术先进的计算机毕业设计项目。</p>
<h2 data-id="heading-1">基于springboot的快递物流仓库管理系统演示视频</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.bilibili.com%2Fvideo%2FBV1AZULBzExc%2F%3Fspm_id_from%3D333.1387.homepage.video_card.click" target="_blank" title="https://www.bilibili.com/video/BV1AZULBzExc/?spm_id_from=333.1387.homepage.video_card.click" ref="nofollow noopener noreferrer">演示视频</a></p>
<h2 data-id="heading-2">基于springboot的快递物流仓库管理系统演示图片</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/36d62975c92a404186bbc663b58e3772~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6h566X5py65q-V5Lia6K6-6K6h5bCP6YCU:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764332117&amp;x-signature=JNZoHGTtTFpYUIXpLVsVFNTuMtY%3D" alt="仓库物流.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/18f2830f33594e51ae7e8b09b93de563~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6h566X5py65q-V5Lia6K6-6K6h5bCP6YCU:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764332117&amp;x-signature=K6cErDCqyNu1JiYqS%2FCw9c%2BjOY8%3D" alt="客户信息.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/35601eb79a83486c9d7f8c1cb4714473~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6h566X5py65q-V5Lia6K6-6K6h5bCP6YCU:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764332117&amp;x-signature=L1R1PwmoJC%2Fr04qdv%2FoDOQDAjxg%3D" alt="快递出库.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c74c4b5536a74dfeb7ea30990ce4e3ae~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6h566X5py65q-V5Lia6K6-6K6h5bCP6YCU:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764332117&amp;x-signature=ZevKebCKcXigFyrCSLCOwyRql%2F8%3D" alt="快递揽件.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/711cbd79bb454cf8ace9e8a0ac1e88e0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6h566X5py65q-V5Lia6K6-6K6h5bCP6YCU:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764332117&amp;x-signature=ZGCDFco5rPSy9BL4OpOCuQo0%2FEk%3D" alt="快递入库.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/56ae0aba6fd84665b12aa9fb9c81f5ea~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6h566X5py65q-V5Lia6K6-6K6h5bCP6YCU:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764332117&amp;x-signature=Ri27unHt6QJLTaQ05xl4JLAbwno%3D" alt="快递信息.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6c54cec246564d22ba48208c76effa17~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6h566X5py65q-V5Lia6K6-6K6h5bCP6YCU:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764332117&amp;x-signature=4qxbskUeQtsd%2FtVDhwRX3e21PXE%3D" alt="快递员津贴.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6013efdd7d2b4d1f8efb3edbb012d6c4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6h566X5py65q-V5Lia6K6-6K6h5bCP6YCU:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764332117&amp;x-signature=6fMGdpTXl5r5ox6ADuUD86GEi0s%3D" alt="快递员信息.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3234cb79941f485b83532bc2e34fbb9f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6h566X5py65q-V5Lia6K6-6K6h5bCP6YCU:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764332117&amp;x-signature=x1RIg5bUqfqhPDJP5T7vr4nUpZs%3D" alt="快递运输.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5973d3ceb2144c919724fc1828f81cb0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6h566X5py65q-V5Lia6K6-6K6h5bCP6YCU:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764332117&amp;x-signature=HPE1aGd6FXyEz1tNvR0KWnxrINc%3D" alt="司机津贴.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5545ba3e4219408483a0a616eb0f0827~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6h566X5py65q-V5Lia6K6-6K6h5bCP6YCU:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764332117&amp;x-signature=GrCphB2XH1HQyuw8ug753Zwehlw%3D" alt="司机信息.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d9cb83818b04495b92f38e73a4bd1e22~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6h566X5py65q-V5Lia6K6-6K6h5bCP6YCU:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764332117&amp;x-signature=bK5S2zdDBPoa1HvGQlaCYoizBO8%3D" alt="运输完成.png" loading="lazy"/></p>
<h2 data-id="heading-3">基于springboot的快递物流仓库管理系统代码展示</h2>
<pre><code class="hljs language-dart" lang="dart">from pyspark.sql <span class="hljs-keyword">import</span> SparkSession
from pyspark.sql.functions <span class="hljs-keyword">import</span> col, when, count, avg, lit, round
# 初始化SparkSession，这是所有大数据处理的入口点
spark = SparkSession.builder.appName(<span class="hljs-string">"StrokeAnalysisSystem"</span>).master(<span class="hljs-string">"local[*]"</span>).getOrCreate()
# 模拟从HDFS或数据库加载数据到Spark DataFrame
# 实际项目中，这里会是 spark.read.csv(<span class="hljs-string">"hdfs://..."</span>) 或 spark.read.jdbc(...)
schema = <span class="hljs-string">"id INT, gender STRING, age DOUBLE, hypertension INT, heart_disease INT, ever_married STRING, work_type STRING, Residence_type STRING, avg_glucose_level DOUBLE, bmi DOUBLE, smoking_status STRING, stroke INT"</span>
# 此处使用模拟数据代替真实数据加载过程
mock_data = [(<span class="hljs-number">51676</span>, <span class="hljs-string">"Male"</span>, <span class="hljs-number">67.0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-string">"Yes"</span>, <span class="hljs-string">"Private"</span>, <span class="hljs-string">"Urban"</span>, <span class="hljs-number">228.69</span>, <span class="hljs-number">36.6</span>, <span class="hljs-string">"formerly smoked"</span>, <span class="hljs-number">1</span>),
             (<span class="hljs-number">31112</span>, <span class="hljs-string">"Male"</span>, <span class="hljs-number">80.0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-string">"Yes"</span>, <span class="hljs-string">"Private"</span>, <span class="hljs-string">"Rural"</span>, <span class="hljs-number">105.92</span>, <span class="hljs-number">32.5</span>, <span class="hljs-string">"never smoked"</span>, <span class="hljs-number">1</span>),
             (<span class="hljs-number">60182</span>, <span class="hljs-string">"Female"</span>, <span class="hljs-number">49.0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"Yes"</span>, <span class="hljs-string">"Private"</span>, <span class="hljs-string">"Urban"</span>, <span class="hljs-number">171.23</span>, <span class="hljs-number">34.4</span>, <span class="hljs-string">"smokes"</span>, <span class="hljs-number">1</span>),
             (<span class="hljs-number">1665</span>, <span class="hljs-string">"Female"</span>, <span class="hljs-number">79.0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"Yes"</span>, <span class="hljs-string">"Self-employed"</span>, <span class="hljs-string">"Rural"</span>, <span class="hljs-number">174.12</span>, <span class="hljs-number">24.0</span>, <span class="hljs-string">"never smoked"</span>, <span class="hljs-number">1</span>),
             (<span class="hljs-number">58202</span>, <span class="hljs-string">"Male"</span>, <span class="hljs-number">81.0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"Yes"</span>, <span class="hljs-string">"Private"</span>, <span class="hljs-string">"Urban"</span>, <span class="hljs-number">186.21</span>, <span class="hljs-number">29.0</span>, <span class="hljs-string">"formerly smoked"</span>, <span class="hljs-number">1</span>),
             (<span class="hljs-number">7009</span>, <span class="hljs-string">"Female"</span>, <span class="hljs-number">50.0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"Yes"</span>, <span class="hljs-string">"Private"</span>, <span class="hljs-string">"Urban"</span>, <span class="hljs-number">88.5</span>, <span class="hljs-number">27.5</span>, <span class="hljs-string">"never smoked"</span>, <span class="hljs-number">0</span>),
             (<span class="hljs-number">47649</span>, <span class="hljs-string">"Female"</span>, <span class="hljs-number">25.0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"No"</span>, <span class="hljs-string">"Private"</span>, <span class="hljs-string">"Rural"</span>, <span class="hljs-number">92.5</span>, <span class="hljs-number">22.5</span>, <span class="hljs-string">"smokes"</span>, <span class="hljs-number">0</span>),
             (<span class="hljs-number">12175</span>, <span class="hljs-string">"Male"</span>, <span class="hljs-number">45.0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"Yes"</span>, <span class="hljs-string">"Govt_job"</span>, <span class="hljs-string">"Urban"</span>, <span class="hljs-number">110.5</span>, <span class="hljs-number">33.5</span>, <span class="hljs-string">"never smoked"</span>, <span class="hljs-number">0</span>)]
patient_df = spark.createDataFrame(mock_data, schema)
# ======================== <span class="hljs-number">1.</span> 高风险特征组合画像分析核心代码 ========================
def analyze_high_risk_profiles(df, risk_threshold=<span class="hljs-number">0.6</span>):
    <span class="hljs-string">"""
    分析高风险特征组合，找出中风概率超过阈值的群体画像。
    例如：分析同时患有高血压和心脏病的群体的中风风险。
    """</span>
    # 选择关键的二元特征进行组合分析：高血压、心脏病
    # 使用 a.alias() 来避免列名冲突，并提高代码可读性
    feature_combinations_df = df.groupBy(<span class="hljs-string">"hypertension"</span>, <span class="hljs-string">"heart_disease"</span>, <span class="hljs-string">"smoking_status"</span>).agg(
        count(<span class="hljs-string">"*"</span>).alias(<span class="hljs-string">"total_count"</span>),
        count(when(col(<span class="hljs-string">"stroke"</span>) == <span class="hljs-number">1</span>, True)).alias(<span class="hljs-string">"stroke_count"</span>)
    )
    # 计算每个特征组合下的中风风险概率
    risk_analysis_df = feature_combinations_df.withColumn(
        <span class="hljs-string">"stroke_risk_rate"</span>, round(col(<span class="hljs-string">"stroke_count"</span>) / col(<span class="hljs-string">"total_count"</span>), <span class="hljs-number">4</span>)
    )
    # 筛选出总人数大于一定数量（例如<span class="hljs-number">1</span>人以上，避免小样本偏差）且风险率高于设定阈值的组合
    high_risk_profiles_df = risk_analysis_df.filter(
        (col(<span class="hljs-string">"total_count"</span>) &gt; <span class="hljs-number">1</span>) &amp; (col(<span class="hljs-string">"stroke_risk_rate"</span>) &gt;= risk_threshold)
    ).orderBy(col(<span class="hljs-string">"stroke_risk_rate"</span>).desc())
    # 为了方便前端Echarts等工具使用，将Spark DataFrame转换为JSON格式列表
    high_risk_results = high_risk_profiles_df.toJSON().map(lambda j: eval(j)).collect()
    # 构造最终返回给前端的数据结构
    formatted_results = []
    <span class="hljs-keyword">for</span> row <span class="hljs-keyword">in</span> high_risk_results:
        profile_desc = f<span class="hljs-string">"高血压:{'是' if row['hypertension']==1 else '否'}, 心脏病:{'是' if row['heart_disease']==1 else '否'}, 吸烟:{row['smoking_status']}"</span>
        formatted_results.append({
            <span class="hljs-string">"profile"</span>: profile_desc,
            <span class="hljs-string">"totalCount"</span>: row[<span class="hljs-string">"total_count"</span>],
            <span class="hljs-string">"strokeCount"</span>: row[<span class="hljs-string">"stroke_count"</span>],
            <span class="hljs-string">"riskRate"</span>: row[<span class="hljs-string">"stroke_risk_rate"</span>]
        })
    <span class="hljs-keyword">return</span> formatted_results
# ======================== <span class="hljs-number">2.</span> 多维度交叉与深度钻取分析核心代码 ========================
def analyze_multi_dimensional_cross(df, dimensions, filters=None):
    <span class="hljs-string">"""
    根据前端请求的维度列表进行动态的交叉分析，并支持过滤条件进行钻取。
    例如：dimensions=["gender", "work_type"], filters={"Residence_type": "Urban"}
    """</span>
    # 应用钻取过滤条件
    filtered_df = df
    <span class="hljs-keyword">if</span> filters:
        <span class="hljs-keyword">for</span> key, value <span class="hljs-keyword">in</span> filters.items():
            filtered_df = filtered_df.filter(col(key) == value)
    # 检查传入的维度列表是否为空，如果为空则无法分组
    <span class="hljs-keyword">if</span> not dimensions:
        <span class="hljs-keyword">return</span> {<span class="hljs-string">"error"</span>: <span class="hljs-string">"维度列表不能为空"</span>}
    # 使用传入的维度列表进行动态分组聚合
    cross_analysis_df = filtered_df.groupBy(*dimensions).agg(
        count(<span class="hljs-string">"*"</span>).alias(<span class="hljs-string">"total_count"</span>),
        count(when(col(<span class="hljs-string">"stroke"</span>) == <span class="hljs-number">1</span>, True)).alias(<span class="hljs-string">"stroke_count"</span>)
    )
    # 增加中风占比列，用于前端图表展示
    result_df = cross_analysis_df.withColumn(
        <span class="hljs-string">"stroke_percentage"</span>, round((col(<span class="hljs-string">"stroke_count"</span>) / col(<span class="hljs-string">"total_count"</span>)) * <span class="hljs-number">100</span>, <span class="hljs-number">2</span>)
    ).orderBy(*dimensions)
    # 将最终的分析结果转换为JSON格式，方便API返回
    analysis_results_list = result_df.toJSON().map(lambda j: eval(j)).collect()
    # 构造返回给前端的完整数据，包括维度信息和数据本身
    final_response = {
        <span class="hljs-string">"dimensions"</span>: dimensions,
        <span class="hljs-string">"filtersApplied"</span>: filters <span class="hljs-keyword">if</span> filters <span class="hljs-keyword">else</span> <span class="hljs-string">"无"</span>,
        <span class="hljs-string">"analysisData"</span>: analysis_results_list,
        <span class="hljs-string">"totalRecordsAnalyzed"</span>: result_df.count()
    }
    <span class="hljs-keyword">return</span> final_response
# ======================== <span class="hljs-number">3.</span> 中风核心风险因素关联分析核心代码 ========================
def analyze_risk_factor_correlation(df):
    <span class="hljs-string">"""
    分析核心健康指标（数值型变量）与是否中风的关联性。
    通过对比中风患者与非中风患者在这些指标上的平均值差异来体现关联度。
    """</span>
    # 选择需要进行关联分析的核心数值型指标
    numeric_factors = [<span class="hljs-string">"age"</span>, <span class="hljs-string">"avg_glucose_level"</span>, <span class="hljs-string">"bmi"</span>]
    # 构建聚合表达式列表，对每个指标计算平均值
    agg_expressions = [avg(col(factor)).alias(f<span class="hljs-string">"avg_{factor}"</span>) <span class="hljs-keyword">for</span> factor <span class="hljs-keyword">in</span> numeric_factors]
    # 按是否中风（stroke=<span class="hljs-number">0</span>或<span class="hljs-number">1</span>）进行分组，并应用上面的聚合表达式
    correlation_df = df.groupBy(<span class="hljs-string">"stroke"</span>).agg(*agg_expressions).orderBy(<span class="hljs-string">"stroke"</span>)
    # 清理列名，并对结果进行四舍五入，使其更适合展示
    <span class="hljs-keyword">for</span> factor <span class="hljs-keyword">in</span> numeric_factors:
        correlation_df = correlation_df.withColumn(
            f<span class="hljs-string">"avg_{factor}"</span>, round(col(f<span class="hljs-string">"avg_{factor}"</span>), <span class="hljs-number">2</span>)
        )
    # 将宽表（多列）转换为长表，这种格式更适合Echarts等图表库进行分组柱状图的渲染
    # 例如：(factor, stroke_group, value) -&gt; (age, <span class="hljs-number">0</span>, <span class="hljs-number">55.2</span>), (age, <span class="hljs-number">1</span>, <span class="hljs-number">78.5</span>)
    unpivoted_results = []
    collected_data = correlation_df.collect()
    stroke_group_data = collected_data[<span class="hljs-number">1</span>] <span class="hljs-keyword">if</span> len(collected_data) &gt; <span class="hljs-number">1</span> and collected_data[<span class="hljs-number">1</span>][<span class="hljs-string">'stroke'</span>] == <span class="hljs-number">1</span> <span class="hljs-keyword">else</span> None
    non_stroke_group_data = collected_data[<span class="hljs-number">0</span>] <span class="hljs-keyword">if</span> len(collected_data) &gt; <span class="hljs-number">0</span> and collected_data[<span class="hljs-number">0</span>][<span class="hljs-string">'stroke'</span>] == <span class="hljs-number">0</span> <span class="hljs-keyword">else</span> None
    <span class="hljs-keyword">for</span> factor <span class="hljs-keyword">in</span> numeric_factors:
        factor_data = {<span class="hljs-string">"factorName"</span>: factor, <span class="hljs-string">"strokeValue"</span>: <span class="hljs-number">0</span>, <span class="hljs-string">"nonStrokeValue"</span>: <span class="hljs-number">0</span>}
        <span class="hljs-keyword">if</span> stroke_group_data:
            factor_data[<span class="hljs-string">"strokeValue"</span>] = stroke_group_data[f<span class="hljs-string">"avg_{factor}"</span>]
        <span class="hljs-keyword">if</span> non_stroke_group_data:
            factor_data[<span class="hljs-string">"nonStrokeValue"</span>] = non_stroke_group_data[f<span class="hljs-string">"avg_{factor}"</span>]
        unpivoted_results.append(factor_data)
    # 返回最终处理好的、适合前端渲染的数据
    <span class="hljs-keyword">return</span> unpivoted_results
# 模拟调用这些函数并打印结果
<span class="hljs-built_in">print</span>(<span class="hljs-string">"--- 高风险特征组合画像分析结果 ---"</span>)
<span class="hljs-built_in">print</span>(analyze_high_risk_profiles(patient_df, risk_threshold=<span class="hljs-number">0.5</span>))
<span class="hljs-built_in">print</span>(<span class="hljs-string">"\n--- 多维度交叉与深度钻取分析结果 ---"</span>)
<span class="hljs-built_in">print</span>(analyze_multi_dimensional_cross(patient_df, dimensions=[<span class="hljs-string">"gender"</span>, <span class="hljs-string">"Residence_type"</span>]))
<span class="hljs-built_in">print</span>(<span class="hljs-string">"\n--- 中风核心风险因素关联分析结果 ---"</span>)
<span class="hljs-built_in">print</span>(analyze_risk_factor_correlation(patient_df))
</code></pre>
<h2 data-id="heading-4">基于springboot的快递物流仓库管理系统文档展示</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c4c65e4fdb614c3794e891848a46d9d1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6h566X5py65q-V5Lia6K6-6K6h5bCP6YCU:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764332117&amp;x-signature=0ygMDq%2Fidwl67sq%2B54qmS9ES5eM%3D" alt="文档.png" loading="lazy"/></p>
<blockquote>
<p>💖💖作者：计算机毕业设计小途
💙💙个人简介：曾长期从事计算机专业培训教学，本人也热爱上课教学，语言擅长Java、微信小程序、Python、Golang、安卓Android等，开发项目包括大数据、深度学习、网站、小程序、安卓、算法。平常会做一些项目定制化开发、代码讲解、答辩教学、文档编写、也懂一些降重方面的技巧。平常喜欢分享一些自己开发中遇到的问题的解决办法，也喜欢交流技术，大家有技术代码这一块的问题可以问我！
💛💛想说的话：感谢大家的关注与支持！
💜💜
<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2F2501_92808674%2Fcategory_13011385.html" target="_blank" title="https://blog.csdn.net/2501_92808674/category_13011385.html" ref="nofollow noopener noreferrer">网站实战项目</a>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2F2501_92808674%2Fcategory_13011386.html" target="_blank" title="https://blog.csdn.net/2501_92808674/category_13011386.html" ref="nofollow noopener noreferrer">安卓/小程序实战项目</a>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2F2501_92808674%2Fcategory_13011387.html" target="_blank" title="https://blog.csdn.net/2501_92808674/category_13011387.html" ref="nofollow noopener noreferrer">大数据实战项目</a>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2F2501_92808674%2Fcategory_13011390.html" target="_blank" title="https://blog.csdn.net/2501_92808674/category_13011390.html" ref="nofollow noopener noreferrer">深度学习实战项目</a></p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Spec Kit 实践：从 Prompt 工程到规范驱动开发]]></title>    <link>https://juejin.cn/post/7574916588719505450</link>    <guid>https://juejin.cn/post/7574916588719505450</guid>    <pubDate>2025-11-21T12:51:49.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574916588719505450" data-draft-id="7575022279567228969" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Spec Kit 实践：从 Prompt 工程到规范驱动开发"/> <meta itemprop="keywords" content="VibeCoding,AI编程"/> <meta itemprop="datePublished" content="2025-11-21T12:51:49.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="严老湿"/> <meta itemprop="url" content="https://juejin.cn/user/3034307824991006"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Spec Kit 实践：从 Prompt 工程到规范驱动开发
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3034307824991006/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    严老湿
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T12:51:49.000Z" title="Fri Nov 21 2025 12:51:49 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">当前 Vibe Coding 的困扰</h2>
<p>是否已经遇到过以下问题？</p>
<ul>
<li>花费大量时间编写和修改 Prompt，但 AI 生成的代码与预期不符？</li>
<li>完成需求后难以追溯设计原则和具体改动点？</li>
<li>开发完成后希望补充文档，但上下文已被压缩丢失？</li>
<li>编码规则和规范散落在不同编辑器中，缺乏统一管理？</li>
<li>难以建立标准化的 AI 编程流程和质量保障机制？</li>
</ul>
<p>例如下面的提示词语言排行榜：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/66c4d0cc82574828a327a76abdfedff3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lil6ICB5rm_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764334309&amp;x-signature=qkBKxCxbj8Dbi%2BPSY7MxxQDQfMQ%3D" alt="图源GitHub" loading="lazy"/></p>
<p>而 Spec Kit 提供了一种"规范即代码"的解决方案，旨在解决传统 Prompt 工程中存在的重复修改、缺乏系统性信息留存等问题。</p>
<h2 data-id="heading-1">什么是 Spec Kit</h2>
<p>Spec Kit 是 GitHub 团队近期推出的开发工具套件，倡导"规范即代码"的开发理念。</p>
<p>它引入了<strong>规范驱动开发</strong>的新型软件开发模式，通过 AI 技术提升代码质量和开发效率。其核心思想是将需求规格置于开发流程的中心，让开发者首先精确定义"做什么"和"为什么"，再由 AI 基于清晰的规范生成代码。</p>
<p>简而言之，Spec Kit 通过文档先行的方式，建立系统化的开发工作流。</p>
<h2 data-id="heading-2">环境准备与安装</h2>
<h3 data-id="heading-3">支持的环境</h3>
<p>目前 Spec Kit 支持 <strong>Claude</strong>、<strong>Gemini</strong>、<strong>Copilot</strong> 等 AI 助手。如果无法使用 Claude，也可以将模型替换为 Qwen、DeepSeek 等其他兼容模型。</p>
<p>本文以 Claude Code 作为演示环境。</p>
<h3 data-id="heading-4">系统要求</h3>
<ul>
<li>Python ≥ 3.11</li>
<li>Git（任意版本）</li>
</ul>
<h3 data-id="heading-5">安装步骤</h3>
<p>打开终端（PowerShell、Terminal 等），执行以下命令安装 specify-cli：</p>
<pre><code class="hljs language-shell" lang="shell">uv tool install specify-cli --from git+https://github.com/github/spec-kit.git
</code></pre>
<p>或在项目内直接安装：</p>
<pre><code class="hljs language-shell" lang="shell">uvx --from git+https://github.com/github/spec-kit.git specify init &lt;PROJECT_NAME&gt;
</code></pre>
<h2 data-id="heading-6">项目初始化</h2>
<p>在已有项目目录中执行初始化命令（<code>claude</code> 可替换为其他支持的 AI 助手）：</p>
<pre><code class="hljs language-shell" lang="shell">specify init . --ai claude
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/de244bb2cac342d78d921a35de709bd8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lil6ICB5rm_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764334309&amp;x-signature=KFEGFbCzq76tTAgehsLVb9FbzNY%3D" alt="" loading="lazy"/></p>
<p>初始化完成后，项目目录中会生成 <code>.specify</code> 目录，包含以下结构：</p>
<ul>
<li><code>memory/</code> - 存储项目级原则和规范</li>
<li><code>scripts/bash/</code> - Spec Kit 的调用脚本</li>
<li><code>template/</code> - 执行命令时使用的模板文件</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fd0aa477d44b492c81d7ecc95fa4076e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lil6ICB5rm_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764334309&amp;x-signature=zvkAWMiFElXW1NxWUGh5OadEUN0%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-7">核心命令参考</h3>
<p>所有 Spec Kit 命令都以 <code>/speckit.</code> 开头：</p>


















































<table><thead><tr><th>命令</th><th>用途描述</th><th>使用时机</th></tr></thead><tbody><tr><td><code>/speckit.constitution</code></td><td>制定或更新项目级开发原则和指南</td><td>项目初始化或引入新规范时</td></tr><tr><td><code>/speckit.specify</code></td><td>明确需求范围和用户故事</td><td>开始新功能开发时</td></tr><tr><td><code>/speckit.plan</code></td><td>基于技术栈创建实施方案</td><td>需求明确后</td></tr><tr><td><code>/speckit.tasks</code></td><td>生成可执行的任务清单</td><td>方案确定后</td></tr><tr><td><code>/speckit.implement</code></td><td>按计划执行所有开发任务</td><td>任务分解完成后</td></tr><tr><td><code>/speckit.clarify</code></td><td>澄清需求中的模糊领域</td><td>制定计划前</td></tr><tr><td><code>/speckit.analyze</code></td><td>跨工件一致性和覆盖率分析</td><td>任务生成后，实施前</td></tr><tr><td><code>/speckit.checklist</code></td><td>生成质量检查清单</td><td>需求验证阶段</td></tr></tbody></table>
<p>常用的核心命令包括：<code>specify</code>、<code>plan</code>、<code>tasks</code>、<code>implement</code>。</p>
<p><code>constitution</code> 主要用于项目初始化阶段或引入新的技术规范时。<code>clarify</code> 用于补充说明需求中的边界条件。<code>checklist</code> 生成验证清单，类似于文本形式的测试用例。</p>
<p>以下是 Spec Kit 的完整工作和核心流程参考：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/033e43829e104419a45d33bd0f8de5ad~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lil6ICB5rm_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764334309&amp;x-signature=N6ug4Vp1XzOydvXdRGT2qikNdCY%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/884f094e9aae44ed8caf8c9e20566650~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lil6ICB5rm_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764334309&amp;x-signature=ORMu9qQX0V%2F9jAGI8E3jK2MUfdU%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-8">实战演示：二维码生成工具开发</h2>
<h3 data-id="heading-9">启动开发环境</h3>
<p>通过终端或编辑器插件启动 Claude Code（为提升效率，可启用 YOLO 模式跳过权限确认）：</p>
<pre><code class="hljs language-shell" lang="shell">claude --dangerously-skip-permissions
</code></pre>
<h3 data-id="heading-10">建立项目规范</h3>
<p>在对话中输入以下命令，可根据实际项目背景补充具体规范：</p>
<pre><code class="hljs language-shell" lang="shell">/speckit.constitution 创建专注于代码质量、测试标准、用户体验一致性和性能要求的原则。
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cd6ab23fa4224fe2820f2b5e4ac5ce8a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lil6ICB5rm_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764334309&amp;x-signature=hbk%2B2%2BEEWJ6CSj0ZFyFcFleKmhM%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/30f03554bcc84827b8a06e62ca47fc11~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lil6ICB5rm_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764334309&amp;x-signature=GTu0j8tts%2FVaBCMbh%2B0vaYabRt8%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-11">定义功能需求</h3>
<p>使用 specify 命令定义二维码生成工具的需求：</p>
<pre><code class="hljs language-shell" lang="shell">/speckit.specify 需要开发一个二维码生成工具库，支持 color、size、logo 等基本配置，提供使用示例，满足常见使用场景。
</code></pre>
<p>此步骤会生成 <code>spec.md</code> 和 <code>requirements.md</code>，明确功能需求和验收标准，为后续开发奠定基础。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/132186143deb486bb615b09162e54804~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lil6ICB5rm_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764334309&amp;x-signature=B5wvDaCHV%2B3ib2LsKF54EwWZYro%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-12">澄清需求边界</h3>
<p>如果发现生成的需求存在模糊之处，可使用 clarify 进行澄清：</p>
<pre><code class="hljs language-shell" lang="shell">/speckit.clarify 不需要考虑 Node.js 环境，仅针对 Web 端使用。
</code></pre>
<p>clarify 会记录澄清过程，并提出其他需要明确的边界问题，通过交互式对话完善需求文档。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c387c63d3fcd42bb852176630c9b9dd4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lil6ICB5rm_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764334309&amp;x-signature=4JelOhleeg2lShE2hKEFlEEGegU%3D" alt="" loading="lazy"/></p>
<p>例如，系统可能会提出以下澄清问题：</p>
<p><strong>问题 1: Logo 图像输入方式</strong></p>
<pre><code class="hljs language-sql" lang="sql">基于用户明确只针对 Web 端使用，Logo 的输入方式需要明确。

推荐方案: 选项 C (File 对象<span class="hljs-operator">/</span><span class="hljs-type">Blob</span> <span class="hljs-operator">+</span> URL 字符串) <span class="hljs-operator">-</span>
覆盖 Web 开发中最常见的所有场景，实现复杂度适中。

<span class="hljs-operator">|</span> 选项    <span class="hljs-operator">|</span> 描述                                 <span class="hljs-operator">|</span>
<span class="hljs-operator">|</span><span class="hljs-comment">-------|------------------------------------|</span>
<span class="hljs-operator">|</span> A     <span class="hljs-operator">|</span> 仅支持 URL 字符串                    <span class="hljs-operator">|</span>
<span class="hljs-operator">|</span> B     <span class="hljs-operator">|</span> 仅支持 File 对象或 <span class="hljs-type">Blob</span>              <span class="hljs-operator">|</span>
<span class="hljs-operator">|</span> C     <span class="hljs-operator">|</span> 同时支持 File 对象<span class="hljs-operator">/</span><span class="hljs-type">Blob</span> 和 URL 字符串 <span class="hljs-operator">|</span>
<span class="hljs-operator">|</span> D     <span class="hljs-operator">|</span> 支持 HTMLImageElement 或 Canvas 元素 <span class="hljs-operator">|</span>

<span class="hljs-operator">&gt;</span> yes
</code></pre>
<p><strong>问题 2: 颜色对比度处理策略</strong></p>
<pre><code class="hljs language-less" lang="less">当用户设置的前景色和背景色对比度过低时，系统应该如何处理？

推荐方案: 选项 <span class="hljs-selector-tag">B</span> (警告但允许生成) <span class="hljs-selector-tag">-</span>
既尊重开发者的设计自由度，又通过警告提醒潜在问题。

| 选项    | 描述             |
|<span class="hljs-selector-tag">-------</span>|<span class="hljs-selector-tag">----------------</span>|
| <span class="hljs-selector-tag">A</span>     | 拒绝生成并返回错误  |
| <span class="hljs-selector-tag">B</span>     | 发出警告但仍允许生成 |
| <span class="hljs-selector-tag">C</span>     | 自动调整颜色对比度  |
| <span class="hljs-selector-tag">D</span>     | 静默生成不做提示    |

&gt; <span class="hljs-selector-tag">yes</span>
</code></pre>
<p>澄清过程会记录所有决策，确保需求文档的完整性。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/73cb1a4583a743dfabc6a5eab3f15024~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lil6ICB5rm_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764334309&amp;x-signature=kHs46xBgaqQSTTcjXQJmfXC1BXE%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-13">制定技术方案</h3>
<p>使用 plan 命令生成技术实施方案：</p>
<pre><code class="hljs language-shell" lang="shell">/speckit.plan
</code></pre>
<p>plan 会综合分析 spec.md、requirements.md 和 constitution.md，制定完整的技术方案，包括市场调研、技术选型和架构设计。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/064db304ba04404a97c630e903e88afa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lil6ICB5rm_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764334309&amp;x-signature=Dn%2FC%2FOirJP5679y8A8s1ZBS9McM%3D" alt="" loading="lazy"/></p>
<p>系统会进行技术调研，分析现有解决方案，并基于调研结果设计数据模型和系统架构。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/863dce78e0a44705a4f7422769f4665a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lil6ICB5rm_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764334309&amp;x-signature=WRUAfmxaA4dB2yVo7ablHK0G9tw%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-14">任务分解与执行</h3>
<p>基于设计方案进行任务拆分：</p>
<pre><code class="hljs language-shell" lang="shell">/speckit.tasks
</code></pre>
<p>系统会将项目分解为多个用户故事，每个故事包含详细的任务清单。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d079a4ead4124c5fafb28f2307e1cc6b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lil6ICB5rm_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764334309&amp;x-signature=xrGnnKxCX4S9Ai2Z1AxJtUM1OTg%3D" alt="" loading="lazy"/></p>
<p>执行所有开发任务：</p>
<pre><code class="hljs language-shell" lang="shell">/speckit.implement
</code></pre>
<pre><code class="hljs language-shell" lang="shell">正在执行 Phase 1: Setup… (esc to interrupt · ctrl+t to hide todos · 2m 15s · ↑ 1.2k tokens)
  ⎿  ☒ 验证并创建项目 ignore 文件
     ☐ Phase 1: Setup (7个任务)
     ☐ Phase 2: Foundational (7个任务)
     ☐ Phase 3: User Story 1 - MVP (7个任务)
     ☐ Phase 4: User Story 2 (5个任务)
     ☐ Phase 5: User Story 5 (5个任务)
     ☐ Phase 6: User Story 3 (7个任务)
     ☐ Phase 7: User Story 4 (4个任务)
     ☐ Phase 8: Polish (8个任务)
</code></pre>
<p>如果执行过程中断，可使用以下命令继续：</p>
<pre><code class="hljs language-shell" lang="shell">/speckit.implement 继续执行
</code></pre>
<p>直到执行完成所有 Task</p>
<h2 data-id="heading-15">开发成果</h2>
<p>通过 Spec Kit 完成的二维码生成工具开发，从需求定义到代码实现，整体耗时约 1 小时（包含网络延迟和指令等待时间）。这种方法相比传统的即时 Prompt 工程，提供了更系统化的开发体验。</p>
<p>项目实现了完整的二维码生成功能，包括：</p>
<ul>
<li>基础二维码生成</li>
<li>颜色和尺寸定制</li>
<li>Logo 嵌入支持</li>
<li>完整的文档和示例</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e51204b120804539b1a38534d8008138~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lil6ICB5rm_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764334309&amp;x-signature=n24ZYliuPL%2BeK4mYm9gNKX0o%2BAY%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/45b713148d3f418890023aef9c5411e5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lil6ICB5rm_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764334309&amp;x-signature=wtA2%2F%2BmK53bJw5bKDwLqWcJ6ZGs%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/54242b1bb8094d9c953d26d63619ac22~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lil6ICB5rm_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764334309&amp;x-signature=a0dfYTuALqYIy5b0964YzQZcjI8%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-16">总结</h2>
<p>Spec Kit 通过规范驱动的开发方法，将产品需求、技术架构、测试标准和开发实现有机结合，提供了系统化的 AI 辅助编程解决方案。相比传统的即时 Prompt 工程，它能够：</p>
<ul>
<li>确保需求实现的准确性</li>
<li>提供完整的设计决策记录</li>
<li>生成一致且可维护的代码</li>
<li>建立标准化的开发流程</li>
</ul>
<p>完整项目代码仓库：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FCrazyMrYan%2Fqrcode-gen" target="_blank" title="https://github.com/CrazyMrYan/qrcode-gen" ref="nofollow noopener noreferrer">github.com/CrazyMrYan/…</a></p>
<h2 data-id="heading-17">文献</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.yanfukun.com%2Fread%2Fspec-kit%2Fwhat" target="_blank" title="https://www.yanfukun.com/read/spec-kit/what" ref="nofollow noopener noreferrer">www.yanfukun.com/read/spec-k…</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fgithub%2Fspec-kit" target="_blank" title="https://github.com/github/spec-kit" ref="nofollow noopener noreferrer">github.com/github/spec…</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[win11上wsl本地安装版本ubuntu25.10]]></title>    <link>https://juejin.cn/post/7574848503731929134</link>    <guid>https://juejin.cn/post/7574848503731929134</guid>    <pubDate>2025-11-21T11:11:02.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574848503731929134" data-draft-id="7574991051435311114" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="win11上wsl本地安装版本ubuntu25.10"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-21T11:11:02.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Livingbody"/> <meta itemprop="url" content="https://juejin.cn/user/4213771487417944"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            win11上wsl本地安装版本ubuntu25.10
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4213771487417944/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Livingbody
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T11:11:02.000Z" title="Fri Nov 21 2025 11:11:02 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1.安装wsl2</h2>
<pre><code class="hljs language-cmd" lang="cmd">   dism.exe /online /enable-feature /featurename:VirtualMachinePlatform /all /norestart
   dism.exe /online /enable-feature /featurename:Microsoft-Windows-Subsystem-Linux /all /norestart
   wsl --set-default-version 2
   
</code></pre>
<h2 data-id="heading-1">2.下载镜像</h2>
<p>从163镜像下载
<a href="https://link.juejin.cn?target=https%3A%2F%2Fmirrors.163.com%2Fubuntu-releases%2F25.10%2Fubuntu-25.10-wsl-amd64.wsl" target="_blank" title="https://mirrors.163.com/ubuntu-releases/25.10/ubuntu-25.10-wsl-amd64.wsl" ref="nofollow noopener noreferrer">mirrors.163.com/ubuntu-rele…</a>
速度很快，1分钟不到即可完成。</p>
<h2 data-id="heading-2">3.使用wsl命令安装</h2>
<pre><code class="hljs language-cmd" lang="cmd">   cd .\Downloads\
   wsl --install --from-file .\ubuntu-25.10-wsl-amd64.wsl
   
   
  Linux gaint 6.6.87.2-microsoft-standard-WSL2 #1 SMP PREEMPT_DYNAMIC Thu Jun  5 18:30:46 UTC 2025 x86_64 GNU/Linux   
</code></pre>
<p>安装完成</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9efd92b3b591477086770cbbab1c1c47~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTGl2aW5nYm9keQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764328262&amp;x-signature=%2FCiutyPN4GAHCth9Ao915genr%2Bg%3D" alt="ScreenShot_2025-11-21_191012_647.png" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[面向电力生产调度系统的数据库实践：从时序处理到多中心容灾]]></title>    <link>https://juejin.cn/post/7574996958516314131</link>    <guid>https://juejin.cn/post/7574996958516314131</guid>    <pubDate>2025-11-21T10:04:13.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574996958516314131" data-draft-id="7574892669375234102" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="面向电力生产调度系统的数据库实践：从时序处理到多中心容灾"/> <meta itemprop="keywords" content="数据库"/> <meta itemprop="datePublished" content="2025-11-21T10:04:13.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="倔强的石头_"/> <meta itemprop="url" content="https://juejin.cn/user/3168119757484368"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            面向电力生产调度系统的数据库实践：从时序处理到多中心容灾
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3168119757484368/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    倔强的石头_
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T10:04:13.000Z" title="Fri Nov 21 2025 10:04:13 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/45b009beeabc40b580f87778be5842f3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764324253&amp;x-signature=IW6TRcbyd8wpjZPJPf3josShveY%3D" alt="640.gif" loading="lazy"/></p>
<h2 data-id="heading-0">引言</h2>
<p>电力生产与调度系统，说白了就是一套典型的“高并发、高可靠、高安全”的关键基础设施。机组运行、DCS/EMS/SCADA 监控、负荷预测、现货交易这些业务，时时刻刻都在产生高频数据流，而且要 7×24 小时不间断地稳定运行。随着“中长期+现货”电力市场的推进，以及新能源并网规模不断扩大，行业对数据库的要求也水涨船高——事务性能要更强、时序写入要更稳、跨区域同步和容灾切换要更快更可靠，安全与合规也必须做到位。</p>
<p>这几年，金仓数据库（KingbaseES）在电力行业的核心系统里持续上车——不管是发电企业的生产运行核心系统，还是国家电网的智能调度系统、现货交易辅助决策系统，都有它的身影。基于这些落地，我们也积累了一套能拿得出手的工程方法论。下面我会结合技术能力与行业案例做一次系统梳理，并给出贴近业务场景的实现示例。</p>
<p>@[toc]</p>
<h2 data-id="heading-1">金仓数据库的介绍</h2>
<p>金仓数据库管理系统 KingbaseES（简称 KES）是一款面向关键应用的企业级通用融合数据库。它既能撑起事务处理，也能胜任数据分析和海量时序数据的采集与检索，互联网场景同样不在话下。落到具体应用上，管理信息系统、业务与生产系统、决策支持、多维分析、运行日志、全文检索、地理信息系统（GIS）、时序数据处理等，都可以把 KES 作为可靠的数据库底座。</p>
<ul>
<li>生态与兼容：对 Oracle/MySQL 的模式兼容持续完善，接口覆盖 JDBC/ODBC/.NET；工具链也很齐（KDTS 迁移、KStudio 开发、KFS 异构同步等），迁移与集成的成本显著降低。</li>
<li>行业落地：在电力、政务、金融、通信等重点行业沉淀了大量最佳实践，长期稳定支撑国家电网电力调度系统；具备多中心容灾与并行复制能力，适配国产 CPU/OS 与主流云平台部署。</li>
<li>安全与合规：通过多项权威安全认证（含商用密码认证、EAL4+ 等），支持纵深防御与完善审计，能够满足高安全关键业务的合规要求。</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4047ae4d769d4eef8fce62757f041c73~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764324253&amp;x-signature=4cLotSneUVXZopXZiD9gsKI1Z08%3D" alt="e3eea818365b9bdc4d9ce82fc8268cfb.png" loading="lazy"/></p>
<h2 data-id="heading-2">技术解读（结合电力场景）</h2>
<h3 data-id="heading-3">架构与高可用</h3>
<p>多层次高可用方面，主备，读写分离以及多活共享存储（RAC）均能搭建，计划内时可执行滚动升级，碰到计划外故障时能够快速察觉并切换，系统连续性因而更为有保障。</p>
<p>两地三中心容灾机制下，利用并行流复制并结合日志分析来做逻辑同步，同城的双中心就能达成 RPO 约等于 0 ，其 RTO 时间接近秒级别。对于异地灾备而言，RPO 也可以被限制在秒级别之内，这符合电力核心系统的需求。</p>
<p>统一性能与健康监测功能可给出近即时负载及历史会话报告，其从主机/ OS / 数据库 / 会话等诸多层面执行全方位监测，有益于找出性能瓶颈，并为容量规划给予参考。</p>
<h3 data-id="heading-4">高并发与高吞吐</h3>
<ul>
<li>MVCC 并发控制：在高并发场景下有效减少读写锁竞争，既保吞吐又保事务隔离。</li>
<li>区分与执行方案改良：按照时间或者业务方面实施分区裁剪，把索引和方案缓存融合起来，可以缩减事务的响应时间，特别适合海量时序的写入和查询操作。</li>
<li>快速加载与批量写入：具备 COPY/批处理等能力，在机组遥测，计量采集，交易日志入库这些场景下会大幅加快速度。</li>
</ul>
<h3 data-id="heading-5">安全与合规</h3>
<ul>
<li>访问控制与审计：身份鉴别、权限控制、审计体系完善，能够满足等保与行业监管要求。</li>
<li>加密与传输安全：基于 SSL/TLS 的可信传输，配合国密算法，静态与传输数据的安全防护一并覆盖。</li>
</ul>
<h3 data-id="heading-6">生态兼容与迁移</h3>
<ul>
<li>模式兼容：对 Oracle/MySQL 的常用语法与接口进行适配，迁移改造的工作量更可控。</li>
<li>工具与方法：借助 KDTS 做结构与数据迁移，配合 KFS/FlySync 做异构同步；迁移策略遵循“评估—改造—并行验证—切换—运维优化”的全周期流程。</li>
</ul>
<h3 data-id="heading-7">贴近场景的实现示例</h3>
<p>下面的示例围绕发电企业与电网侧的典型需求展开：高频时序数据写入、分区管理、跨区同步与安全控制，以及业务数据的批量入库。</p>
<h4 data-id="heading-8">1）时序分区与高频写入</h4>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> telemetry (
  point_id <span class="hljs-type">int</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  ts <span class="hljs-type">timestamp</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  val <span class="hljs-type">numeric</span>(<span class="hljs-number">12</span>,<span class="hljs-number">4</span>),
  quality <span class="hljs-type">smallint</span>,
  <span class="hljs-keyword">PRIMARY</span> KEY (point_id, ts)
) <span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">BY</span> <span class="hljs-keyword">RANGE</span> (ts);

<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> telemetry_2025_11
  <span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">OF</span> telemetry
  <span class="hljs-keyword">FOR</span> <span class="hljs-keyword">VALUES</span> <span class="hljs-keyword">FROM</span> (<span class="hljs-string">'2025-11-01'</span>) <span class="hljs-keyword">TO</span> (<span class="hljs-string">'2025-12-01'</span>);

<span class="hljs-keyword">CREATE</span> INDEX idx_telemetry_2025_11_ts <span class="hljs-keyword">ON</span> telemetry_2025_11 (ts);
<span class="hljs-keyword">CREATE</span> INDEX idx_telemetry_2025_11_point <span class="hljs-keyword">ON</span> telemetry_2025_11 (point_id);
</code></pre>
<p>批量写入示例：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">COPY</span> telemetry (point_id, ts, val, quality)
<span class="hljs-keyword">FROM</span> STDIN <span class="hljs-keyword">WITH</span> (FORMAT csv);
</code></pre>
<p>按月维护分区与归档：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> telemetry DETACH <span class="hljs-keyword">PARTITION</span> telemetry_2025_05;
<span class="hljs-keyword">DROP</span> <span class="hljs-keyword">TABLE</span> telemetry_2025_05;
</code></pre>
<h4 data-id="heading-9">2）跨区逻辑同步（同城双中心 + 异地灾备）</h4>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> PUBLICATION pub_telemetry <span class="hljs-keyword">FOR</span> <span class="hljs-keyword">TABLE</span> telemetry;

<span class="hljs-keyword">CREATE</span> SUBSCRIPTION sub_telemetry
CONNECTION <span class="hljs-string">'host=dr-site.example.com port=54321 dbname=power user=replicator password=***'</span>
PUBLICATION pub_telemetry
<span class="hljs-keyword">WITH</span> (create_slot <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>, copy_data <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>, enabled <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>);
</code></pre>
<h4 data-id="heading-10">3）行级安全（RLS）控制示例</h4>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> spot_bid ENABLE <span class="hljs-type">ROW</span> LEVEL SECURITY;

<span class="hljs-keyword">CREATE</span> POLICY p_user_read
<span class="hljs-keyword">ON</span> spot_bid
<span class="hljs-keyword">FOR</span> <span class="hljs-keyword">SELECT</span>
<span class="hljs-keyword">USING</span> (owner_id <span class="hljs-operator">=</span> current_setting(<span class="hljs-string">'app.user_id'</span>)::<span class="hljs-type">int</span>);

<span class="hljs-keyword">SET</span> app.user_id <span class="hljs-operator">=</span> <span class="hljs-string">'10001'</span>;
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> spot_bid;
</code></pre>
<h4 data-id="heading-11">4）JDBC 批量入库（KingbaseES 官方驱动）</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.sql.*;

<span class="hljs-keyword">class</span> <span class="hljs-title class_">BatchInsertExample</span> {
  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception {
    Class.forName(<span class="hljs-string">"com.kingbase8.Driver"</span>);
    <span class="hljs-type">String</span> <span class="hljs-variable">url</span> <span class="hljs-operator">=</span> <span class="hljs-string">"jdbc:kingbase8://db-primary:54321/power"</span>;
    <span class="hljs-keyword">try</span> (<span class="hljs-type">Connection</span> <span class="hljs-variable">conn</span> <span class="hljs-operator">=</span> DriverManager.getConnection(url, <span class="hljs-string">"system"</span>, <span class="hljs-string">"secret"</span>)) {
      conn.setAutoCommit(<span class="hljs-literal">false</span>);
      <span class="hljs-type">String</span> <span class="hljs-variable">sql</span> <span class="hljs-operator">=</span> <span class="hljs-string">"INSERT INTO telemetry(point_id, ts, val, quality) VALUES (?, ?, ?, ?)"</span>;
      <span class="hljs-keyword">try</span> (<span class="hljs-type">PreparedStatement</span> <span class="hljs-variable">ps</span> <span class="hljs-operator">=</span> conn.prepareStatement(sql)) {
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">100000</span>; i++) {
          ps.setInt(<span class="hljs-number">1</span>, i % <span class="hljs-number">1000</span>);
          ps.setTimestamp(<span class="hljs-number">2</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Timestamp</span>(System.currentTimeMillis()));
          ps.setBigDecimal(<span class="hljs-number">3</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">java</span>.math.BigDecimal(<span class="hljs-string">"123.4567"</span>));
          ps.setShort(<span class="hljs-number">4</span>, (<span class="hljs-type">short</span>)<span class="hljs-number">1</span>);
          ps.addBatch();
          <span class="hljs-keyword">if</span> (i % <span class="hljs-number">1000</span> == <span class="hljs-number">0</span>) {
            ps.executeBatch();
          }
        }
        ps.executeBatch();
      }
      conn.commit();
    }
  }
}
</code></pre>
<p>这个 Java 示例使用的是 KingbaseES 官方 JDBC 驱动 <code>com.kingbase8.Driver</code>，连接串写成 <code>jdbc:kingbase8://host:port/database</code>，默认端口为 <code>54321</code>；在生产环境里可以结合读写分离与多节点部署策略。</p>
<h2 data-id="heading-12">案例分析</h2>
<h3 data-id="heading-13">发电行业五大生产运行核心系统上线</h3>
<ul>
<li>发电行业“五大生产运行核心系统”完成国产数据库上线，底层采用金仓数据库，既验证了其工程可靠性，也展现了在发电企业核心场景下的高安全适配能力。</li>
<li>价值点：满足高频数据入库与分析、统一账务与生产管理、跨系统协同与审计追溯，为集团级运行指挥与资源优化提供坚实的数据底座。</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/46125fd339f245518d350011938d9cc4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764324253&amp;x-signature=hmX5I0v1bVT6pdwmCpxHxUIFhnE%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-14">大唐集团：电力现货交易辅助决策系统</h3>
<p>在“中长期 + 现货”这种模式之下，交易品种变得更多，交易的频率也大幅加强，集团总部必要做到统一而高效地去指挥调度，还要执行资源的改良工作，省公司以及基层单位得要预先判别市场的供需状况和负荷情况，从而迅速应对节点竞价以及区域竞争。</p>
<p>技术要点在于，该系统形成于集团统一平台之上，其职责是给予现货交易辅助决策，金仓数据库则承担起交易数据接入，计算结果归档以及报表生成这些重要任务，从而减轻了用户对于国产数据库存在并发吞吐量小和响应迟缓的忧虑。</p>
<p>效果：系统运行平稳，数据处理效率显著提升，帮助企业实现营销经济利益最大化，并保障业务连续性。
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4c4117c0a8654d13b53107b6ffcb4d75~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764324253&amp;x-signature=sE27CW14cBQP9qVlFsE%2BOxWgDSc%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-15">国家电网：智能电网调度控制系统（国产化迁移）</h3>
<ul>
<li>项目特点：数据录入高频、持续且可靠；安全要求高；定制化需求包括宽表支持、大并发高吞吐与跨区同步。原 Open3000 基于 Oracle，需完成国产化迁移。</li>
<li>技术实现：以 KingbaseES 为底层数据库，构建跨区域同步与多中心容灾；适配宽表与高并发写入，通过工具链与模式兼容实现从 Oracle 的平滑替代与应用改造。</li>
<li>支撑情况：长期稳定支撑智能调度控制业务，满足 7×24 小时运行与关键业务的合规要求。</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2179148d76f640209907ff227a0b00bf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764324253&amp;x-signature=hPKyWfnHZlKP7VqSrda69VCSbWs%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/68e6b27412ef41c2876d7fbc004cacba~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764324253&amp;x-signature=06UPiT22mj%2BQGjj1AXy4R1OxAw4%3D" alt="741c43759b85d02c8a8c189b764f4180.png" loading="lazy"/></p>
<h2 data-id="heading-16">结语</h2>
<p>电力行业做数据库选型，不只是看几项性能指标，更看工程能否落地以及全生命周期的保障。金仓数据库在发电与电网核心场景的持续实践表明：在高并发写入、跨区同步与容灾、安全合规、生态适配等方面，已经具备产业级的可用能力。配合分区与批量入库的建模策略、逻辑复制与两地三中心架构、行级安全与完整审计，完全可以在现有 IT 条件下，循序渐进地把关键模块到核心系统实现国产化替代与能力升级。</p>
<h2 data-id="heading-17">参考资料</h2>
<ul>
<li>KingbaseES 产品手册（JDBC）：<code>https://help.kingbase.com.cn/v8.6.7.12/development/client-interfaces/jdbc/jdbc-2.html</code></li>
<li>金仓数据库行业百科与最佳实践（墨天轮）：<code>https://www.modb.pro/wiki/13</code></li>
<li>KingbaseES 版本与能力脉络（SegmentFault）：<code>https://segmentfault.com/a/1190000045324574</code></li>
<li>电力现货交易辅助决策系统（大唐集团）：<code>https://www.kingbase.com.cn/case2/details_568_30126.html</code></li>
<li>智能电网调度控制系统（国家电网）：<code>https://www.kingbase.com.cn/case1/details_568_22561.html</code></li>
<li>资讯报道：发电行业“五大生产运行核心系统”上线（微信）：<code>http://mp.weixin.qq.com/s?__biz=MjM5NjgwMDMxMg==&amp;mid=2652201033&amp;idx=1&amp;sn=2eeae7735c0c412ba078678e9ecdb657&amp;chksm=bce15129f099d0c230f0528db3b20fdaaaae5a93bd9abef12aa334a7ff8738674530a221c0ae&amp;scene=27#wechat_redirect</code></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[并发丢数据深度剖析：JED的锁机制与事务实战踩坑及解决方案]]></title>    <link>https://juejin.cn/post/7574817463449255987</link>    <guid>https://juejin.cn/post/7574817463449255987</guid>    <pubDate>2025-11-21T10:11:07.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574817463449255987" data-draft-id="7574991051435163658" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="并发丢数据深度剖析：JED的锁机制与事务实战踩坑及解决方案"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-21T10:11:07.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="京东零售技术"/> <meta itemprop="url" content="https://juejin.cn/user/4233576972293643"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            并发丢数据深度剖析：JED的锁机制与事务实战踩坑及解决方案
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4233576972293643/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    京东零售技术
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T10:11:07.000Z" title="Fri Nov 21 2025 10:11:07 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读26分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1、理论来源于实践</h2>
<p><strong>现象</strong>：于2025-08-13 21:45:35，事实逻辑表将自身的指标与维度同步到原子服务的实现时，出现同步过来的指标与维度丢失。</p>
<p><strong>核心原因</strong>：两次重复的事实逻辑表同步时间非常相近，导致同步过来的指标与维度丢失。</p>
<p>﻿</p>
<p>﻿</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9d1a930f468b4c73abba942fc5e15c98~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic6Zu25ZSu5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764324666&amp;x-signature=SpF6bFOxb2wrzSX8H49brUzGBuI%3D" alt="" loading="lazy"/></p>
<p>﻿﻿</p>
<h2 data-id="heading-1">2、倒带进事故现场</h2>
<p>逻辑表向原子服务同步的核心逻辑是 “先删后增”：删除旧数据→对比新老数据→插入新增数据，具体流程如下：</p>
<p>﻿</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ecc2396cd39d43428e13d24cf1e296c0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic6Zu25ZSu5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764324666&amp;x-signature=Jx0dqZFg1hb6%2FnYECiYiTjdTq3k%3D" alt="" loading="lazy"/></p>
<p>﻿﻿</p>
<p>整体业务代码精简逻辑如下：</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-keyword">@Transactional</span>(rollbackFor = Exception.class)
public Map&lt;String, Object&gt; driveToAtomService(Map logicTableData, String erp) {
<span class="hljs-comment">//获得环境信息</span>
String env = driveLogicTable<span class="hljs-selector-class">.getString</span>(DRIVE_LOGIC_TABLE_ENV);
<span class="hljs-comment">//获取/更新实现id</span>
 Long logicTableId = <span class="hljs-built_in">getOrAddLogicTableId</span>(atomicServiceId, driveLogicTable, erp, EnvType.of(env));
<span class="hljs-comment">//删除关联指标</span>
 metricImplMapper<span class="hljs-selector-class">.deleteByLogicTableIds</span>(Collections.singletonList(logicId));
<span class="hljs-comment">//获取请求中的所有的指标信息</span>
List&lt;MetricImplBO&gt; metricList = <span class="hljs-built_in">getMetricImpls</span>(logicTableData, logicTableId);
<span class="hljs-comment">//获取需要新增的指标实现(包含了查询库里现有的指标实现)</span>
List&lt;MetricImplRelBO&gt; metricImpls = metricImplMapper<span class="hljs-selector-class">.getMetricImpls</span>(logicTableId);
Set&lt;Long&gt; metricDefIdSet = metricImpls<span class="hljs-selector-class">.stream</span>()
            <span class="hljs-selector-class">.map</span>(MetricImplRelBO::getMetricDefId)<span class="hljs-selector-class">.collect</span>(Collectors.toSet());
List&lt;MetricImplBO&gt; addList = metricList<span class="hljs-selector-class">.stream</span>()
            <span class="hljs-selector-class">.filter</span>(s -&gt; !metricDefIdSet.contains(s.getMetricDefId()))<span class="hljs-selector-class">.collect</span>(Collectors.toList());
<span class="hljs-comment">//将需要新增的指标实现插入数据库</span>
 <span class="hljs-built_in">addMetricImpl</span>(addList);

}
</code></pre>
<p>用一个请求进行举例：</p>
<p>共计15个指标，64个维度</p>


















































































<table><thead><tr><th>请求1(事务)</th><th>请求2(事务)</th><th>﻿</th><th/><th/></tr></thead><tbody><tr><td>21:06:17.262</td><td>进入同步方法</td><td>21:06:17.263</td><td>进入同步方法</td><td>﻿</td></tr><tr><td>21:06:17.063</td><td>select unify_metric_impl where logic_id = 3245 查询出15条数据(快照读，readview1)</td><td>21:06:17.363</td><td>select unify_metric_impl where logic_id = 3245 查询出15条数据(快照读，readview2)</td><td>﻿</td></tr><tr><td>21:06:17.363</td><td>delete from unify_metric_impl where logic_id = 3245</td><td>21:06:17.372</td><td>delete from unify_metric_impl where logic_id = 3245</td><td>﻿</td></tr><tr><td>21:06:17.459</td><td>select unify_metric_impl where logic_id = 3245 查询出0条数据</td><td>﻿</td><td>delete 由于logic_id不是索引，会表锁阻塞</td><td>﻿</td></tr><tr><td>21:06:18.459</td><td>insert into unify_metric_impl 插入的logic_id = 3245的数据，15条</td><td>﻿</td><td>﻿</td><td>﻿</td></tr><tr><td>21:06:19.408</td><td>方法结束</td><td>﻿</td><td>﻿</td><td>﻿</td></tr><tr><td>﻿</td><td>﻿</td><td>21:06:19.529</td><td>删除成功</td><td>﻿</td></tr><tr><td>﻿</td><td>﻿</td><td>21:06:20.362</td><td>select unify_metric_impl where logic_id = 3245 得到 15条数据</td><td>﻿</td></tr><tr><td>﻿</td><td>﻿</td><td>21:06:20.435</td><td>读出15条数据，比较本次是否有新增指标， 得出没有新增指标，因此不进行新增。addAtomicMetricNameForDrive addList empty</td><td>﻿</td></tr><tr><td>﻿</td><td>﻿</td><td>21:06:21.435</td><td>方法结束</td><td>﻿</td></tr></tbody></table>
<p>﻿</p>
<p><strong>核心结论点</strong>：</p>
<p>1.请求2的删除操作被阻塞了，直到请求1执行完整个方法。</p>
<p>2.请求2中去查看当前实现的指标的时候，发现库里已经存在所有指标不会进行新增，与上一步删除的逻辑相悖。</p>
<p>﻿</p>
<h2 data-id="heading-2">3、结论点深度剖析</h2>
<h3 data-id="heading-3">3.1 分析结论一</h3>
<p>请求2的删除操作被阻塞了，直到请求1执行完整个方法。</p>
<h4 data-id="heading-4">3.1.1 复习JED(京东自研数据库)的锁机制</h4>
<h5 data-id="heading-5">3.1.1.1 不是“一把锁”，而是 “锁矩阵”</h5>



































<table><thead><tr><th>锁粒度</th><th>共享锁（S 锁） （读锁，允许多读）</th><th>排他锁（X 锁） （写锁，独占）</th><th>意向锁（表级，辅助判断）</th></tr></thead><tbody><tr><td><strong>表级</strong></td><td>表 S 锁（极少用，如<code>LOCK TABLES ... READ</code>）</td><td>表 X 锁（极少用，如<code>LOCK TABLES ... WRITE</code>）</td><td>意向 S 锁（IS）、意向 X 锁（IX）</td></tr><tr><td><strong>行级</strong></td><td>行 S 锁（<code>SELECT ... FOR SHARE</code>）</td><td>行 X 锁（<code>UPDATE/DELETE/INSERT</code>默认加）</td><td>（行锁无需意向锁）</td></tr><tr><td><strong>间隙级</strong></td><td>间隙 S 锁（无，间隙只防插入）</td><td>间隙 X 锁（防其他事务插入相同间隙）</td><td>无</td></tr><tr><td><strong>Next-Key</strong></td><td>无</td><td>Next-Key 锁（行锁 + 间隙锁，默认行锁算法）</td><td>无</td></tr></tbody></table>
<p>﻿</p>
<h5 data-id="heading-6">3.1.1.2 一张图总结：锁的 “决策逻辑”</h5>
<p>﻿</p>
<p>﻿</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/02c2c30e567f41f98e89d2ebb08315a7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic6Zu25ZSu5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764324666&amp;x-signature=Kfoez49CE2SG5dlaN9Beo7HY6ZI%3D" alt="" loading="lazy"/></p>
<p>﻿﻿</p>
<p>﻿</p>
<h4 data-id="heading-7">3.1.2 理论应用实践</h4>
<h5 data-id="heading-8">3.1.2.1 本次事故的物料：</h5>
<p>JED的表结构：</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">CREATE</span> <span class="hljs-selector-tag">TABLE</span> `<span class="hljs-selector-tag">unify_metric_impl</span>` (
  <span class="hljs-built_in">`id`</span> <span class="hljs-built_in">bigint</span>(<span class="hljs-number">50</span>) unsigned <span class="hljs-keyword">NOT</span> NULL AUTO_INCREMENT COMMENT <span class="hljs-string">'自增ID'</span>,
  <span class="hljs-built_in">`metric_def_id`</span> <span class="hljs-built_in">bigint</span>(<span class="hljs-number">11</span>) unsigned <span class="hljs-keyword">NOT</span> NULL DEFAULT <span class="hljs-string">'0'</span> COMMENT <span class="hljs-string">'指标定义id'</span>,
  <span class="hljs-built_in">`logic_table_id`</span> <span class="hljs-built_in">bigint</span>(<span class="hljs-number">11</span>) unsigned <span class="hljs-keyword">NOT</span> NULL DEFAULT <span class="hljs-string">'0'</span> COMMENT <span class="hljs-string">'逻辑表id'</span>,
  <span class="hljs-built_in">`name_en_atomic`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">256</span>) <span class="hljs-keyword">NOT</span> NULL DEFAULT <span class="hljs-string">''</span> COMMENT <span class="hljs-string">'真实指标名'</span>,
  <span class="hljs-built_in">`committer`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">64</span>) <span class="hljs-keyword">NOT</span> NULL DEFAULT <span class="hljs-string">''</span> COMMENT <span class="hljs-string">'负责人'</span>,
  <span class="hljs-built_in">`create_time`</span> timestamp <span class="hljs-keyword">NOT</span> NULL DEFAULT CURRENT_TIMESTAMP COMMENT <span class="hljs-string">'开始时间'</span>,
  <span class="hljs-built_in">`update_time`</span> timestamp <span class="hljs-keyword">NOT</span> NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT <span class="hljs-string">'修改时间'</span>,
  <span class="hljs-built_in">`metric_atomic_name_temp`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">32</span>) <span class="hljs-keyword">NOT</span> NULL DEFAULT <span class="hljs-string">''</span> COMMENT <span class="hljs-string">'原子指标id'</span>,
  <span class="hljs-built_in">`decorate_id_list_temp`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">32</span>) <span class="hljs-keyword">NOT</span> NULL DEFAULT <span class="hljs-string">''</span> COMMENT <span class="hljs-string">'修饰列表'</span>,
  <span class="hljs-built_in">`name_cn_alias_temp`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">32</span>) <span class="hljs-keyword">NOT</span> NULL DEFAULT <span class="hljs-string">''</span> COMMENT <span class="hljs-string">'中文别名'</span>,
  <span class="hljs-built_in">`metric_type_temp`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">32</span>) <span class="hljs-keyword">NOT</span> NULL DEFAULT <span class="hljs-string">''</span> COMMENT <span class="hljs-string">'指标类型：DERIVE 衍生指标，FORMULA 复合指标'</span>,
  <span class="hljs-built_in">`description_temp`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">64</span>) <span class="hljs-keyword">NOT</span> NULL DEFAULT <span class="hljs-string">''</span> COMMENT <span class="hljs-string">'指标说明'</span>,
  <span class="hljs-built_in">`data_type_temp`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">16</span>) <span class="hljs-keyword">NOT</span> NULL DEFAULT <span class="hljs-string">''</span> COMMENT <span class="hljs-string">'数据类型：STRING，DOUBLE, LONG, INT'</span>,
  <span class="hljs-built_in">`data_accuracy_temp`</span> <span class="hljs-built_in">tinyint</span>(<span class="hljs-number">4</span>) <span class="hljs-keyword">NOT</span> NULL DEFAULT <span class="hljs-string">'2'</span> COMMENT <span class="hljs-string">'数据精度-小数点后几位'</span>,
  <span class="hljs-built_in">`security_level_temp`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">16</span>) DEFAULT <span class="hljs-string">'-1'</span> COMMENT <span class="hljs-string">'安全等级'</span>,
  <span class="hljs-built_in">`logic_table_id_excel_temp`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">16</span>) DEFAULT <span class="hljs-string">'-1'</span> COMMENT <span class="hljs-string">'模型excelId'</span>,
  <span class="hljs-built_in">`implement_type`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">32</span>) <span class="hljs-keyword">NOT</span> NULL DEFAULT <span class="hljs-string">''</span> COMMENT <span class="hljs-string">'指标实现类型：APP、ATOMIC 原子服务'</span>,
  <span class="hljs-built_in">`app_ori_metric_name_temp`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">16</span>) DEFAULT <span class="hljs-string">''</span> COMMENT <span class="hljs-string">'所依赖的app层原始名字（适用于导数任务改变字段的情况）'</span>,
  <span class="hljs-built_in">`name_en_depend_atomic`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">256</span>) <span class="hljs-keyword">NOT</span> NULL DEFAULT <span class="hljs-string">''</span> COMMENT <span class="hljs-string">'指标依赖字段'</span>,
  <span class="hljs-built_in">`name_en_depend_app`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">16</span>) DEFAULT <span class="hljs-string">''</span> COMMENT <span class="hljs-string">'所依赖的app层原始名字（适用于导数任务改变字段的情况）'</span>,
  <span class="hljs-built_in">`update_status`</span> <span class="hljs-built_in">tinyint</span>(<span class="hljs-number">4</span>) <span class="hljs-keyword">NOT</span> NULL DEFAULT <span class="hljs-string">'0'</span> COMMENT <span class="hljs-string">'信息更新状态 0-未完成更新，1-完成更新'</span>,
  <span class="hljs-built_in">`status`</span> <span class="hljs-built_in">tinyint</span>(<span class="hljs-number">4</span>) <span class="hljs-keyword">NOT</span> NULL DEFAULT <span class="hljs-string">'0'</span> COMMENT <span class="hljs-string">'信息更新状态 0-未完成更新，1-完成更新'</span>,
  <span class="hljs-built_in">`light_decorate_id_list`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">1024</span>) <span class="hljs-keyword">NOT</span> NULL DEFAULT <span class="hljs-string">''</span> COMMENT <span class="hljs-string">'点灯修饰id列表'</span>,
  <span class="hljs-built_in">`extend_decorate_id_list`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">1024</span>) <span class="hljs-keyword">NOT</span> NULL DEFAULT <span class="hljs-string">''</span> COMMENT <span class="hljs-string">'支持的动态修饰id列表'</span>,
  <span class="hljs-built_in">`extend_function_id_list`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">1024</span>) <span class="hljs-keyword">NOT</span> NULL DEFAULT <span class="hljs-string">''</span> COMMENT <span class="hljs-string">'支持的原子服务函数id列表'</span>,
  <span class="hljs-built_in">`aggregation_type`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">64</span>) <span class="hljs-keyword">NOT</span> NULL DEFAULT <span class="hljs-string">''</span> COMMENT <span class="hljs-string">'聚合类型:ORIGINAL 原值 COUNT 计数 DISTINCT 指定字段去重 SUM 求和 AVG  均值 MIN 求最大值 MAX 求最小值 QUANTITLE 求分位数'</span>,
  <span class="hljs-built_in">`middle_aggregation_type`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">30</span>) <span class="hljs-keyword">NOT</span> NULL DEFAULT <span class="hljs-string">''</span> COMMENT <span class="hljs-string">'中间层类型,UNKNOWN:未知,AGG_BY_FIELD:按聚合字段分组后聚合,AGG_BY_DAY:按天去重后累加'</span>,
  <span class="hljs-built_in">`static_decorate_id_list_combination`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">1024</span>) <span class="hljs-keyword">NOT</span> NULL DEFAULT <span class="hljs-string">''</span> COMMENT <span class="hljs-string">'支持的固化修饰id列表组合,[[d1,d2],[d2]]'</span>,
  PRIMARY KEY (<span class="hljs-built_in">`id`</span>),
  KEY <span class="hljs-built_in">`idx_metric_def_id`</span> (<span class="hljs-built_in">`metric_def_id`</span>,<span class="hljs-built_in">`logic_table_id`</span>)
);
</code></pre>
<h5 data-id="heading-9">3.1.2.2 实践分析</h5>
<p>通过JED的锁决策，可以得出</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-comment">//删除关联指标</span>
 <span class="hljs-selector-tag">metricImplMapper</span><span class="hljs-selector-class">.deleteByLogicTableIds</span>(Collections.<span class="hljs-built_in">singletonList</span>(logicId));
</code></pre>

<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-function">delete <span class="hljs-keyword">from</span> unify_metric_impl <span class="hljs-keyword">where</span> logic_table_id <span class="hljs-title">in</span> (<span class="hljs-params"><span class="hljs-number">45631</span></span>)</span>;
</code></pre>
<p>JED的索引：KEY <code>idx_metric_def_id</code> (<code>metric_def_id</code>,<code>logic_table_id</code>)</p>
<p>删除写操作，不符合最左匹配原则，因此为表x锁。</p>
<p>﻿</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dd92beff5a3a4a24a64fa98ee2b8bbb7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic6Zu25ZSu5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764324666&amp;x-signature=xBk4Go6g0L5JIj4tGcunLoWs%2BJI%3D" alt="" loading="lazy"/></p>
<p>﻿﻿</p>
<p>因此请求2的删除操作需要等待请求1的事务释放表锁后才可继续进行，符合当时场景。</p>
<p>﻿</p>
<h3 data-id="heading-10">3.2 分析结论二</h3>
<p>请求2中去查看当前实现的指标的时候，发现库里已经存在所有指标不会进行新增，与上一步删除的逻辑相悖。</p>
<h4 data-id="heading-11">3.2.1 复习JED的事务</h4>
<h5 data-id="heading-12">3.2.1.1 ACID 不是 "四个独立特性"，而是 "因果链"</h5>
<p>﻿</p>
<p>﻿</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/63952d445b014f019a3bde75b5fe42fd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic6Zu25ZSu5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764324666&amp;x-signature=0N5KKTNtBD11Wt0W7erpOyxT4Ow%3D" alt="" loading="lazy"/></p>
<p>﻿﻿</p>
<p>•<strong>一句话</strong>：ACID 的核心是<strong>一致性</strong>，其他三个特性都是为了实现它的手段。</p>
<p>•<strong>一致性</strong>（Consistency）：一致性确保事务将数据库从一个一致的状态转变到另一个一致的状态。即使在多个事务同时执行的情况下，数据库也能保持数据的一致性。</p>
<p>•<strong>原子性</strong>（Atomicity）：事务是 "不可分割的工作单元"（要么全成，要么全败），是一致性的<strong>前提</strong>（如果步骤能拆分，中间失败就会破坏一致性）。</p>
<p>•<strong>隔离性</strong>（Isolation）：通过控制多事务并发规则，避免互相干扰，是一致性的<strong>保障</strong>（并发混乱会直接破坏一致性）。</p>
<p>•<strong>耐久性</strong>（Durability）：事务提交后结果永久保存，是一致性的<strong>最终落点</strong>（否则重启后数据丢失，之前的一致性白搭）。</p>
<p>﻿</p>
<h5 data-id="heading-13">3.2.1.2 隔离级别：不是 "越严越好"，而是 "成本与需求的平衡术"</h5>
<p>JED 的 4 种隔离级别，本质是用 "数据可见性" 换 "并发性能"的选择：</p>








































<table><thead><tr><th>隔离级别</th><th>解决的问题</th><th>无法解决的问题</th><th>性能消耗</th><th>典型场景</th></tr></thead><tbody><tr><td>读未提交（RU）</td><td>无</td><td>脏读、不可重复读、幻读</td><td>极低</td><td>实时监控（允许脏数据）</td></tr><tr><td>读已提交（RC）</td><td>脏读</td><td>不可重复读、幻读</td><td>低</td><td>互联网普通业务</td></tr><tr><td>可重复读（RR，默认）</td><td>脏读、不可重复读</td><td>幻读（被 Next-Key 锁解决）</td><td>中</td><td>金融交易、库存管理</td></tr><tr><td>串行化（Serializable）</td><td>所有并发问题</td><td>无</td><td>极高</td><td>银行对账（无并发需求）</td></tr></tbody></table>
<p>﻿</p>
<h5 data-id="heading-14">3.2.1.3 MVCC：事务的 "平行宇宙" 机制（为什么读写不冲突？）</h5>
<p><strong>多版本并发控制</strong>是 "无锁读" 的核心，它让读和写像在平行宇宙中运行：</p>
<p><strong>底层逻辑（用 "时间戳" 理解</strong>）：</p>
<p>•每个事务启动时，会拿到一个<strong>全局递增的事务 ID（trx_id）</strong> 。</p>
<p>•每行数据隐藏 3 个字段：</p>
<p>◦<code>DB_TRX_ID</code>：最后修改该行的事务 ID；</p>
<p>◦<code>DB_ROLL_PTR</code>：指向 undo 日志的指针（存储历史版本）；</p>
<p>◦<code>DB_DELETED</code>：标记是否删除（逻辑删除）。</p>
<p><strong>读操作的 "幻术"</strong> ：</p>
<p>•<strong>快照读</strong>（普通 SELECT）：只看 "事务 ID ≤ 自己 ID" 且 "未被删除" 的版本，完全不加锁。 例：事务 A（ID=100）查询时，会忽略所有被 ID&gt;100 的事务修改的数据。</p>
<p>包含 4 个核心字段：</p>
<p>•<code>m_ids</code>：生成 Read View 时，<strong>当前活跃的事务 ID 列表</strong>（未提交的事务）。</p>
<p>•<code>min_trx_id</code>：<code>m_ids</code>中最小的事务 ID。</p>
<p>•<code>max_trx_id</code>：下一个将要分配的事务 ID（非活跃事务 ID，仅用于判断 “未来事务”）。</p>
<p>•<code>creator_trx_id</code>：生成该 Read View 的事务自身 ID。</p>
<p><strong>可见性判断规则</strong>（一条记录是否对当前事务可见，取决于其 “最后修改事务 ID”，记为<code>db_trx_id</code>）：</p>
<p>1.若db_trx_id == creator_trx_id：可见（自己修改的自己可见）。</p>
<p>2.若db_trx_id &lt; min_trx_id：可见（修改记录的事务在当前快照生成前已提交）。</p>
<p>3.若db_trx_id &gt;= max_trx_id：不可见（修改记录的事务在当前快照生成后才启动）。</p>
<p>4.若min_trx_id ≤ db_trx_id &lt; max_trx_id：</p>
<p>◦若db_trx_id在m_ids中：不可见（该事务仍活跃，未提交）。</p>
<p>◦若db_trx_id不在m_ids中：可见（该事务已提交）。</p>
<p>5.当前读（加锁读 / 写操作）：读取最新版本，并加锁防止其他事务修改。</p>
<h5 data-id="heading-15">3.2.1.4 事务日志："安全与性能" 平衡术</h5>
<p>事务能既保证 durability 又不慢，全靠两大日志：</p>
<p>1.<strong>redo log（重做日志）</strong> ：</p>
<p>◦作用：崩溃后恢复未写入磁盘的数据（保证 durability）。</p>
<p>◦反直觉：事务提交时，数据先写 redo log（内存 + 磁盘），再异步刷到数据文件（这叫 WAL 技术）。</p>
<p>◦为什么快？redo log 是<strong>顺序写</strong>（磁盘顺序写比随机写快 100 倍 +）。</p>
<p>2.<strong>undo log（回滚日志）</strong> ：</p>
<p>◦作用：保存数据修改前的版本，用于事务回滚（保证 atomicity）和 MVCC 快照读。</p>
<p>◦注意：undo log 会被 purge 线程定期清理（当没有事务需要旧版本时）。</p>
<h5 data-id="heading-16">3.2.1.5 终极心法：事务设计的 "3 个凡是"</h5>
<p>1.<strong>凡是不需要事务的操作，坚决不用</strong>（如日志插入可关闭自动提交，批量提交）。</p>
<p>2.<strong>凡是能在 RC 解决的，绝不升 RR</strong>（互联网业务优先选 RC，用业务逻辑防不可重复读）。</p>
<p>3.<strong>凡是大事务，必拆分成 "读 - 算 - 写" 三步</strong>（读阶段不加锁，算阶段在应用层，写阶段用最短事务加锁）。</p>
<p>记住：事务的本质不是 "约束"，而是 "工具"—— 能解决问题的最简单事务，才是最好的事务。</p>
<p>﻿</p>
<h4 data-id="heading-17">3.2.2 理论应用实践</h4>
<h5 data-id="heading-18">3.2.2.1 本次事故的物料：</h5>
<p>表的事务等级：</p>
<pre><code class="hljs language-scss" lang="scss">SELECT @<span class="hljs-keyword">@transaction</span>_isolation;
</code></pre>
<p>﻿</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/326dd49249a04d45a256c06cc1341235~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic6Zu25ZSu5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764324666&amp;x-signature=LSNnpm%2FcOS2xUS1hfYRe3XDgkgA%3D" alt="" loading="lazy"/></p>
<p>﻿﻿</p>
<p>﻿</p>
<p>需要删除的指标实现(根据实现id):</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-function">delete <span class="hljs-keyword">from</span> unify_metric_impl <span class="hljs-keyword">where</span> logic_table_id <span class="hljs-title">in</span> (<span class="hljs-params"><span class="hljs-number">45631</span></span>)</span>;
</code></pre>
<p>需要插入的指标实现：</p>
<pre><code class="hljs language-go" lang="go">INSERT INTO <span class="hljs-string">`unify_metric_impl`</span> (<span class="hljs-string">`id`</span>, <span class="hljs-string">`metric_def_id`</span>, <span class="hljs-string">`logic_table_id`</span>, <span class="hljs-string">`name_en_atomic`</span>, <span class="hljs-string">`committer`</span>, <span class="hljs-string">`create_time`</span>, <span class="hljs-string">`update_time`</span>, <span class="hljs-string">`metric_atomic_name_temp`</span>, <span class="hljs-string">`decorate_id_list_temp`</span>, <span class="hljs-string">`name_cn_alias_temp`</span>, <span class="hljs-string">`metric_type_temp`</span>, <span class="hljs-string">`description_temp`</span>, <span class="hljs-string">`data_type_temp`</span>, <span class="hljs-string">`data_accuracy_temp`</span>, <span class="hljs-string">`security_level_temp`</span>, <span class="hljs-string">`logic_table_id_excel_temp`</span>, <span class="hljs-string">`implement_type`</span>, <span class="hljs-string">`app_ori_metric_name_temp`</span>, <span class="hljs-string">`name_en_depend_atomic`</span>, <span class="hljs-string">`name_en_depend_app`</span>, <span class="hljs-string">`update_status`</span>, <span class="hljs-string">`status`</span>, <span class="hljs-string">`light_decorate_id_list`</span>, <span class="hljs-string">`extend_decorate_id_list`</span>, <span class="hljs-string">`extend_function_id_list`</span>, <span class="hljs-string">`aggregation_type`</span>, <span class="hljs-string">`middle_aggregation_type`</span>, <span class="hljs-string">`static_decorate_id_list_combination`</span>)
VALUES
	(<span class="hljs-number">1358195</span>, <span class="hljs-number">19872</span>, <span class="hljs-number">45631</span>, <span class="hljs-string">'jdr_7fresh_trade_complete_ord_user_qtty_deal_7fresh'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">2</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'4556,8012,8270,7247,7248,7249,7250,2134,7254,7255,5997,7867'</span>, <span class="hljs-string">'25,6,5,7,23,22,20,21,19,18,4,1,2,3,24'</span>, <span class="hljs-string">'toSql'</span>, <span class="hljs-string">'DEFAULT'</span>, <span class="hljs-string">''</span>),
	(<span class="hljs-number">1358196</span>, <span class="hljs-number">19873</span>, <span class="hljs-number">45631</span>, <span class="hljs-string">'jdr_7fresh_trade_complete_ord_sku_dis_qtty_deal_7fresh'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">2</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'4556,8012,8270,7247,7248,7249,7250,2134,7254,7255,5997,7867'</span>, <span class="hljs-string">'25,6,5,7,23,22,20,21,19,18,4,1,2,3,24'</span>, <span class="hljs-string">'toSql'</span>, <span class="hljs-string">'DEFAULT'</span>, <span class="hljs-string">''</span>),
	(<span class="hljs-number">1358197</span>, <span class="hljs-number">19875</span>, <span class="hljs-number">45631</span>, <span class="hljs-string">'jdr_7fresh_trade_complete_ord_ord_dis_qtty_deal_7fresh'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">2</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'4556,8012,8270,7247,7248,7249,7250,2134,7254,7255,5997,7867'</span>, <span class="hljs-string">'25,6,5,7,23,22,20,21,19,18,4,1,2,3,24'</span>, <span class="hljs-string">'toSql'</span>, <span class="hljs-string">'DEFAULT'</span>, <span class="hljs-string">''</span>),
	(<span class="hljs-number">1358198</span>, <span class="hljs-number">19945</span>, <span class="hljs-number">45631</span>, <span class="hljs-string">'jdr_7fresh_sku_deal_ord_sku_dis_qtty_main_img_video_num'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">2</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'4556,8012,8270,7247,7248,7249,7250,2134,7254,7255,5997,7867'</span>, <span class="hljs-string">'25,6,5,7,23,22,20,21,19,18,4,1,2,3,24'</span>, <span class="hljs-string">'toSql'</span>, <span class="hljs-string">'DEFAULT'</span>, <span class="hljs-string">''</span>),
	(<span class="hljs-number">1358199</span>, <span class="hljs-number">17263</span>, <span class="hljs-number">45631</span>, <span class="hljs-string">'jdr_7fresh_trade_deal_ord_ord_dis_qtty_deal_7fresh'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">2</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'4556,8012,8270,7247,7248,7249,7250,2134,7254,7255,5997,7867'</span>, <span class="hljs-string">'25,6,5,7,23,22,20,21,19,18,4,1,2,3,24'</span>, <span class="hljs-string">'toSql'</span>, <span class="hljs-string">'DEFAULT'</span>, <span class="hljs-string">''</span>),
	(<span class="hljs-number">1358200</span>, <span class="hljs-number">28017</span>, <span class="hljs-number">45631</span>, <span class="hljs-string">'jdr_7fresh_bd_bd_attendance_offline__store_cnt_bd_attendance_cnt'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">2</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'4556,8012,8270,7247,7248,7249,7250,2134,7254,7255,5997,7867'</span>, <span class="hljs-string">'25,6,5,7,23,22,20,21,19,18,4,1,2,3,24'</span>, <span class="hljs-string">'COUNT_DISTINCT'</span>, <span class="hljs-string">'DEFAULT'</span>, <span class="hljs-string">''</span>),
	(<span class="hljs-number">1358201</span>, <span class="hljs-number">20242</span>, <span class="hljs-number">45631</span>, <span class="hljs-string">'jdr_7fresh_trade_deal_ord_app__ord_qtty_deal_7fresh'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">2</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'4556,8012,8270,7247,7248,7249,7250,2134,7254,7255,5997,7867'</span>, <span class="hljs-string">'25,6,5,7,23,22,20,21,19,18,4,1,2,3,24'</span>, <span class="hljs-string">'toSql'</span>, <span class="hljs-string">'DEFAULT'</span>, <span class="hljs-string">''</span>),
	(<span class="hljs-number">1358202</span>, <span class="hljs-number">18450</span>, <span class="hljs-number">45631</span>, <span class="hljs-string">'jdr_7fresh_trade_deal_ord_ord_amt_deal_7fresh'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">2</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'4556,8012,8270,7247,7248,7249,7250,2134,7254,7255,5997,7867'</span>, <span class="hljs-string">'25,6,5,7,23,22,20,21,19,18,4,1,2,3,24'</span>, <span class="hljs-string">'toSql'</span>, <span class="hljs-string">'DEFAULT'</span>, <span class="hljs-string">''</span>),
	(<span class="hljs-number">1358203</span>, <span class="hljs-number">20276</span>, <span class="hljs-number">45631</span>, <span class="hljs-string">'jdr_7fresh_trade_deal_ord_app__ord_cnt_deal_7fresh'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">2</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'4556,8012,8270,7247,7248,7249,7250,2134,7254,7255,5997,7867'</span>, <span class="hljs-string">'25,6,5,7,23,22,20,21,19,18,4,1,2,3,24'</span>, <span class="hljs-string">'toSql'</span>, <span class="hljs-string">'DEFAULT'</span>, <span class="hljs-string">''</span>),
	(<span class="hljs-number">1358204</span>, <span class="hljs-number">18452</span>, <span class="hljs-number">45631</span>, <span class="hljs-string">'jdr_7fresh_trade_deal_ord_sku_qtty_deal_7fresh'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">2</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'4556,8012,8270,7247,7248,7249,7250,2134,7254,7255,5997,7867'</span>, <span class="hljs-string">'25,6,5,7,23,22,20,21,19,18,4,1,2,3,24'</span>, <span class="hljs-string">'toSql'</span>, <span class="hljs-string">'DEFAULT'</span>, <span class="hljs-string">''</span>),
	(<span class="hljs-number">1358205</span>, <span class="hljs-number">18453</span>, <span class="hljs-number">45631</span>, <span class="hljs-string">'jdr_7fresh_trade_deal_ord_user_qtty_deal_7fresh'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">2</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'4556,8012,8270,7247,7248,7249,7250,2134,7254,7255,5997,7867'</span>, <span class="hljs-string">'25,6,5,7,23,22,20,21,19,18,4,1,2,3,24'</span>, <span class="hljs-string">'toSql'</span>, <span class="hljs-string">'DEFAULT'</span>, <span class="hljs-string">''</span>),
	(<span class="hljs-number">1358206</span>, <span class="hljs-number">18456</span>, <span class="hljs-number">45631</span>, <span class="hljs-string">'jdr_7fresh_trade_deal_ord_sku_dis_qtty_deal_7fresh'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">2</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'4556,8012,8270,7247,7248,7249,7250,2134,7254,7255,5997,7867'</span>, <span class="hljs-string">'25,6,5,7,23,22,20,21,19,18,4,1,2,3,24'</span>, <span class="hljs-string">'toSql'</span>, <span class="hljs-string">'DEFAULT'</span>, <span class="hljs-string">''</span>),
	(<span class="hljs-number">1358207</span>, <span class="hljs-number">19866</span>, <span class="hljs-number">45631</span>, <span class="hljs-string">'jdr_7fresh_trade_complete_ord_ord_amt_deal_7fresh'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">2</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'4556,8012,8270,7247,7248,7249,7250,2134,7254,7255,5997,7867'</span>, <span class="hljs-string">'25,6,5,7,23,22,20,21,19,18,4,1,2,3,24'</span>, <span class="hljs-string">'toSql'</span>, <span class="hljs-string">'DEFAULT'</span>, <span class="hljs-string">''</span>),
	(<span class="hljs-number">1358208</span>, <span class="hljs-number">21691</span>, <span class="hljs-number">45631</span>, <span class="hljs-string">'jdr_7fresh_trade_deal_ord_ord_amt_include_moutai'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">2</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'4556,8012,8270,7247,7248,7249,7250,2134,7254,7255,5997,7867'</span>, <span class="hljs-string">'25,6,5,7,23,22,20,21,19,18,4,1,2,3,24'</span>, <span class="hljs-string">'toSql'</span>, <span class="hljs-string">'DEFAULT'</span>, <span class="hljs-string">''</span>),
	(<span class="hljs-number">1358209</span>, <span class="hljs-number">19871</span>, <span class="hljs-number">45631</span>, <span class="hljs-string">'jdr_7fresh_trade_complete_ord_sku_qtty_deal_7fresh'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">2</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'4556,8012,8270,7247,7248,7249,7250,2134,7254,7255,5997,7867'</span>, <span class="hljs-string">'25,6,5,7,23,22,20,21,19,18,4,1,2,3,24'</span>, <span class="hljs-string">'toSql'</span>, <span class="hljs-string">'DEFAULT'</span>, <span class="hljs-string">''</span>);
</code></pre>
<h5 data-id="heading-19">3.2.2.2 实践分析：</h5>
<p>用sql模拟两个事务的执行过程：</p>
<p>事务1：</p>
<pre><code class="hljs language-javascript" lang="javascript">begin;

select * <span class="hljs-keyword">from</span> unify_metric_impl umi where logic_table_id =  <span class="hljs-number">45631</span>;

<span class="hljs-keyword">delete</span> <span class="hljs-keyword">from</span> unify_metric_impl where logic_table_id <span class="hljs-keyword">in</span> (<span class="hljs-number">45631</span>);

select * <span class="hljs-keyword">from</span> unify_metric_impl umi where logic_table_id =  <span class="hljs-number">45631</span>;

<span class="hljs-variable constant_">INSERT</span> <span class="hljs-variable constant_">INTO</span> <span class="hljs-string">`unify_metric_impl`</span> ( <span class="hljs-string">`metric_def_id`</span>, <span class="hljs-string">`logic_table_id`</span>, <span class="hljs-string">`name_en_atomic`</span>, <span class="hljs-string">`committer`</span>, <span class="hljs-string">`create_time`</span>, <span class="hljs-string">`update_time`</span>, <span class="hljs-string">`metric_atomic_name_temp`</span>, <span class="hljs-string">`decorate_id_list_temp`</span>, <span class="hljs-string">`name_cn_alias_temp`</span>, <span class="hljs-string">`metric_type_temp`</span>, <span class="hljs-string">`description_temp`</span>, <span class="hljs-string">`data_type_temp`</span>, <span class="hljs-string">`data_accuracy_temp`</span>, <span class="hljs-string">`security_level_temp`</span>, <span class="hljs-string">`logic_table_id_excel_temp`</span>, <span class="hljs-string">`implement_type`</span>, <span class="hljs-string">`app_ori_metric_name_temp`</span>, <span class="hljs-string">`name_en_depend_atomic`</span>, <span class="hljs-string">`name_en_depend_app`</span>, <span class="hljs-string">`update_status`</span>, <span class="hljs-string">`status`</span>, <span class="hljs-string">`light_decorate_id_list`</span>, <span class="hljs-string">`extend_decorate_id_list`</span>, <span class="hljs-string">`extend_function_id_list`</span>, <span class="hljs-string">`aggregation_type`</span>, <span class="hljs-string">`middle_aggregation_type`</span>, <span class="hljs-string">`static_decorate_id_list_combination`</span>)
<span class="hljs-variable constant_">VALUES</span>
	(<span class="hljs-number">19872</span>, <span class="hljs-number">45631</span>, <span class="hljs-string">'jdr_7fresh_trade_complete_ord_user_qtty_deal_7fresh'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">2</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'4556,8012,8270,7247,7248,7249,7250,2134,7254,7255,5997,7867'</span>, <span class="hljs-string">'25,6,5,7,23,22,20,21,19,18,4,1,2,3,24'</span>, <span class="hljs-string">'toSql'</span>, <span class="hljs-string">'DEFAULT'</span>, <span class="hljs-string">''</span>),
	(<span class="hljs-number">19873</span>, <span class="hljs-number">45631</span>, <span class="hljs-string">'jdr_7fresh_trade_complete_ord_sku_dis_qtty_deal_7fresh'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">2</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'4556,8012,8270,7247,7248,7249,7250,2134,7254,7255,5997,7867'</span>, <span class="hljs-string">'25,6,5,7,23,22,20,21,19,18,4,1,2,3,24'</span>, <span class="hljs-string">'toSql'</span>, <span class="hljs-string">'DEFAULT'</span>, <span class="hljs-string">''</span>),
	(<span class="hljs-number">19875</span>, <span class="hljs-number">45631</span>, <span class="hljs-string">'jdr_7fresh_trade_complete_ord_ord_dis_qtty_deal_7fresh'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">2</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'4556,8012,8270,7247,7248,7249,7250,2134,7254,7255,5997,7867'</span>, <span class="hljs-string">'25,6,5,7,23,22,20,21,19,18,4,1,2,3,24'</span>, <span class="hljs-string">'toSql'</span>, <span class="hljs-string">'DEFAULT'</span>, <span class="hljs-string">''</span>),
	(<span class="hljs-number">19945</span>, <span class="hljs-number">45631</span>, <span class="hljs-string">'jdr_7fresh_sku_deal_ord_sku_dis_qtty_main_img_video_num'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">2</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'4556,8012,8270,7247,7248,7249,7250,2134,7254,7255,5997,7867'</span>, <span class="hljs-string">'25,6,5,7,23,22,20,21,19,18,4,1,2,3,24'</span>, <span class="hljs-string">'toSql'</span>, <span class="hljs-string">'DEFAULT'</span>, <span class="hljs-string">''</span>),
	(<span class="hljs-number">17263</span>, <span class="hljs-number">45631</span>, <span class="hljs-string">'jdr_7fresh_trade_deal_ord_ord_dis_qtty_deal_7fresh'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">2</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'4556,8012,8270,7247,7248,7249,7250,2134,7254,7255,5997,7867'</span>, <span class="hljs-string">'25,6,5,7,23,22,20,21,19,18,4,1,2,3,24'</span>, <span class="hljs-string">'toSql'</span>, <span class="hljs-string">'DEFAULT'</span>, <span class="hljs-string">''</span>),
	(<span class="hljs-number">28017</span>, <span class="hljs-number">45631</span>, <span class="hljs-string">'jdr_7fresh_bd_bd_attendance_offline__store_cnt_bd_attendance_cnt'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">2</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'4556,8012,8270,7247,7248,7249,7250,2134,7254,7255,5997,7867'</span>, <span class="hljs-string">'25,6,5,7,23,22,20,21,19,18,4,1,2,3,24'</span>, <span class="hljs-string">'COUNT_DISTINCT'</span>, <span class="hljs-string">'DEFAULT'</span>, <span class="hljs-string">''</span>),
	(<span class="hljs-number">20242</span>, <span class="hljs-number">45631</span>, <span class="hljs-string">'jdr_7fresh_trade_deal_ord_app__ord_qtty_deal_7fresh'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">2</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'4556,8012,8270,7247,7248,7249,7250,2134,7254,7255,5997,7867'</span>, <span class="hljs-string">'25,6,5,7,23,22,20,21,19,18,4,1,2,3,24'</span>, <span class="hljs-string">'toSql'</span>, <span class="hljs-string">'DEFAULT'</span>, <span class="hljs-string">''</span>),
	(<span class="hljs-number">18450</span>, <span class="hljs-number">45631</span>, <span class="hljs-string">'jdr_7fresh_trade_deal_ord_ord_amt_deal_7fresh'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">2</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'4556,8012,8270,7247,7248,7249,7250,2134,7254,7255,5997,7867'</span>, <span class="hljs-string">'25,6,5,7,23,22,20,21,19,18,4,1,2,3,24'</span>, <span class="hljs-string">'toSql'</span>, <span class="hljs-string">'DEFAULT'</span>, <span class="hljs-string">''</span>),
	(<span class="hljs-number">20276</span>, <span class="hljs-number">45631</span>, <span class="hljs-string">'jdr_7fresh_trade_deal_ord_app__ord_cnt_deal_7fresh'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">2</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'4556,8012,8270,7247,7248,7249,7250,2134,7254,7255,5997,7867'</span>, <span class="hljs-string">'25,6,5,7,23,22,20,21,19,18,4,1,2,3,24'</span>, <span class="hljs-string">'toSql'</span>, <span class="hljs-string">'DEFAULT'</span>, <span class="hljs-string">''</span>),
	(<span class="hljs-number">18452</span>, <span class="hljs-number">45631</span>, <span class="hljs-string">'jdr_7fresh_trade_deal_ord_sku_qtty_deal_7fresh'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">2</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'4556,8012,8270,7247,7248,7249,7250,2134,7254,7255,5997,7867'</span>, <span class="hljs-string">'25,6,5,7,23,22,20,21,19,18,4,1,2,3,24'</span>, <span class="hljs-string">'toSql'</span>, <span class="hljs-string">'DEFAULT'</span>, <span class="hljs-string">''</span>),
	(<span class="hljs-number">18453</span>, <span class="hljs-number">45631</span>, <span class="hljs-string">'jdr_7fresh_trade_deal_ord_user_qtty_deal_7fresh'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">2</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'4556,8012,8270,7247,7248,7249,7250,2134,7254,7255,5997,7867'</span>, <span class="hljs-string">'25,6,5,7,23,22,20,21,19,18,4,1,2,3,24'</span>, <span class="hljs-string">'toSql'</span>, <span class="hljs-string">'DEFAULT'</span>, <span class="hljs-string">''</span>),
	(<span class="hljs-number">18456</span>, <span class="hljs-number">45631</span>, <span class="hljs-string">'jdr_7fresh_trade_deal_ord_sku_dis_qtty_deal_7fresh'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">2</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'4556,8012,8270,7247,7248,7249,7250,2134,7254,7255,5997,7867'</span>, <span class="hljs-string">'25,6,5,7,23,22,20,21,19,18,4,1,2,3,24'</span>, <span class="hljs-string">'toSql'</span>, <span class="hljs-string">'DEFAULT'</span>, <span class="hljs-string">''</span>),
	(<span class="hljs-number">19866</span>, <span class="hljs-number">45631</span>, <span class="hljs-string">'jdr_7fresh_trade_complete_ord_ord_amt_deal_7fresh'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">2</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'4556,8012,8270,7247,7248,7249,7250,2134,7254,7255,5997,7867'</span>, <span class="hljs-string">'25,6,5,7,23,22,20,21,19,18,4,1,2,3,24'</span>, <span class="hljs-string">'toSql'</span>, <span class="hljs-string">'DEFAULT'</span>, <span class="hljs-string">''</span>),
	(<span class="hljs-number">21691</span>, <span class="hljs-number">45631</span>, <span class="hljs-string">'jdr_7fresh_trade_deal_ord_ord_amt_include_moutai'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">2</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'4556,8012,8270,7247,7248,7249,7250,2134,7254,7255,5997,7867'</span>, <span class="hljs-string">'25,6,5,7,23,22,20,21,19,18,4,1,2,3,24'</span>, <span class="hljs-string">'toSql'</span>, <span class="hljs-string">'DEFAULT'</span>, <span class="hljs-string">''</span>),
	(<span class="hljs-number">19871</span>, <span class="hljs-number">45631</span>, <span class="hljs-string">'jdr_7fresh_trade_complete_ord_sku_qtty_deal_7fresh'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">2</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'4556,8012,8270,7247,7248,7249,7250,2134,7254,7255,5997,7867'</span>, <span class="hljs-string">'25,6,5,7,23,22,20,21,19,18,4,1,2,3,24'</span>, <span class="hljs-string">'toSql'</span>, <span class="hljs-string">'DEFAULT'</span>, <span class="hljs-string">''</span>);

commit;
</code></pre>
<p>﻿</p>
<p>事务2：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">begin</span>;

<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> unify_metric_impl umi <span class="hljs-keyword">where</span> logic_table_id <span class="hljs-operator">=</span>  <span class="hljs-number">45631</span>;

<span class="hljs-keyword">delete</span> <span class="hljs-keyword">from</span> unify_metric_impl <span class="hljs-keyword">where</span> logic_table_id <span class="hljs-keyword">in</span> (<span class="hljs-number">45631</span>);

<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> unify_metric_impl umi <span class="hljs-keyword">where</span> logic_table_id <span class="hljs-operator">=</span>  <span class="hljs-number">45631</span>;

<span class="hljs-keyword">commit</span>;
</code></pre>
<p>﻿</p>
<p>流程图(用一行数据进行演示版本控制)：</p>
<p>﻿</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b0d9d2c99860406a9937e465477eeb92~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic6Zu25ZSu5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764324666&amp;x-signature=zi797ZwXL3vWGldl9xgALf%2B7qCQ%3D" alt="" loading="lazy"/></p>
<p>﻿﻿</p>
<p>﻿</p>
<p>为何事务1的select查询出“为空”，事务2的select查询出“不为空”：</p>






























<table><thead><tr><th>对比维度</th><th>事务 1 查询（读自己的删除版本 V2）</th><th>事务 2 查询（读readview前的V1版本）</th></tr></thead><tbody><tr><td>自己生成的版本</td><td>V2（trx_id=17190，已删除）</td><td>V4（trx_id=17191，已删除）</td></tr><tr><td>对自己版本的处理</td><td>可见，且<strong>事务内需反映自己的删除操作</strong>，所以不追溯前驱 V1</td><td>不可见，但<strong>当前删除的版本是由其他事务得到(V3)</strong> ，并非在readview之前的数据。</td></tr><tr><td>追溯的终止条件</td><td>遇到自己生成的版本，即使已删除，也终止追溯</td><td>遇到自己生成的已删除版本，但不符合"有效删除"，需继续追溯</td></tr><tr><td>最终返回结果</td><td>v2（已删除版本，反映自己的删除操作）</td><td>V1（readview之前有效的版本）</td></tr></tbody></table>
<p>﻿</p>
<h2 data-id="heading-20">4.解决办法</h2>
<p>为了解决事务2的查询"不为空"的问题，分别列出以下方案：</p>

































<table><thead><tr><th>﻿</th><th>解决办法</th><th>优点</th><th>缺点</th><th>倾向</th></tr></thead><tbody><tr><td>方式1</td><td>针对同一个逻辑表的同步添加分布式锁</td><td>实现成本低，影响范围小</td><td>存在长事务的问题</td><td>短期解法</td></tr><tr><td>方式2</td><td>将事务2的select改为当前读(使用slecet...for update)，这样就能查询出最新的数据为空</td><td>实现成本低，</td><td>存在长事务的问题，影响范围大(长事务涉及逻辑多)</td><td>不推荐</td></tr><tr><td>方式3</td><td>将长事务拆分， <strong>"读 - 算 - 写" 三步</strong> 1. 读：无锁读取原子服务与实现数据； 2. 算：在应用层对比新增 / 删除数据； 3. 写：仅对差异数据执行短事务操作</td><td>从根源解决问题</td><td>实现成本大，重构该方法</td><td>长期解法</td></tr></tbody></table>
<p><strong>当前落地情况</strong>：已通过 “分布式锁控制同一逻辑表同步并发” 的短期方案解决事故，后续将在业务迭代中推进 “读 - 算 - 写” 拆分的长期优化，进一步降低事务粒度与锁冲突风险。</p>
<h2 data-id="heading-21">5.附录</h2>
<h3 data-id="heading-22">5.1名词解释</h3>
<p>事实逻辑表：由物理数仓中的事实表和维度逻辑表关联形成的语义表，可以描述业务过程的详细信息，是指标的数据来源。</p>
<p>原子服务：指标的实现方式，一个指标可以有多个实现。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[UModel 数据治理：运维世界模型构建实践]]></title>    <link>https://juejin.cn/post/7574803558878937103</link>    <guid>https://juejin.cn/post/7574803558878937103</guid>    <pubDate>2025-11-21T10:18:19.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574803558878937103" data-draft-id="7574749664492978210" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="UModel 数据治理：运维世界模型构建实践"/> <meta itemprop="keywords" content="云原生"/> <meta itemprop="datePublished" content="2025-11-21T10:18:19.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="阿里云云原生"/> <meta itemprop="url" content="https://juejin.cn/user/3808363977648493"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            UModel 数据治理：运维世界模型构建实践
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3808363977648493/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    阿里云云原生
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T10:18:19.000Z" title="Fri Nov 21 2025 10:18:19 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>作者：元乙</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.aliyun.com%2Flive%2F255499" target="_blank" title="https://developer.aliyun.com/live/255499" ref="nofollow noopener noreferrer">点击此处，观看视频解读！</a></p>
<h2 data-id="heading-0">从可观测再出发</h2>
<p>回顾数十年可观测的演进历程，本质上反映了我们对复杂系统认知方式的变化。</p>
<p>最初，我们面向单一数据类型构建监控体系——CPU、内存、磁盘，一个个孤立的指标告诉我们“什么地方出了问题”。随着系统复杂度提升，我们开始收集多类数据——日志、指标、链路并行发展，试图从不同维度观察同一个系统。</p>
<p>进一步，我们意识到这些数据间存在“关联性”，开始尝试将 Logs、Metrics、Traces 关联分析，这就是所谓的“三大支柱”。但这种关联往往停留在时间维度、资源维度、调用链维度上的简单拼接，缺乏深层的语义联系。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5ad6306831224ffe9ec34a92cc271122~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764325099&amp;x-signature=xYuCpYGPvgw9JY6JRyclR%2FlHO50%3D" alt="图片" loading="lazy"/></p>
<p>然而，这些演进路径都基于一个隐含假设：先收集数据，再从数据中推理出系统的真实状态。这种“由数据到世界”的认知路径，在面对日益复杂的分布式系统时，逐渐暴露出根本性局限。</p>
<p>这里核心困境在于：从海量、异构、动态变化的数据中准确推理出真实世界的状态，本质上是一个极其困难的逆向工程问题。数据只是现象，而现象与本质之间往往存在巨大的认知鸿沟。</p>
<p>如果从第一性原则重新审视这个问题，一个更有效的路径是：先建模真实/IT世界，再针对性地获取数据。这意味着我们需要从“数据驱动”转向“模型驱动”，从面向现象的观测转向面向本质的建模。</p>
<h2 data-id="heading-1">AI 时代的建模必要性</h2>
<p>大模型的出现给了我们强大的工具，但实践中我们发现，当把这些“大脑”直接接入到“原始”的可观测数据流中时，却发现效果有限，往往还出现反作用。AI 缺乏对特定领域的结构化理解，面对没有上下文、没有关系的原始数据，几乎不可能做出精准判断。而这一现象在可观测领域更为明显。</p>
<p>基于在可观测领域尤其是 AIOps 的多年经验，阿里云可观测团队在 19 年开始了可观测数据建模的过程，并逐渐迭代和优化。这里我们经历了几个提升过程：</p>
<ol>
<li><strong>数据标准化：</strong> 解决数据格式混乱问题，借助 OpenTelemetry 开放标准，定义各类可观测数据的互操作。</li>
<li><strong>实体与关联：</strong> 引入 EntitySet 概念描述 IT 世界的核心对象，通过 Link 建立实体间的调用、依赖、归属等关系，构建起 IT 系统的拓扑图谱。</li>
<li><strong>知识表达：</strong> 沉淀领域专家经验，通过 Semantic 的 Set 表达“知识”，让系统不仅有数据，还有相关背景和分析数据的方法。</li>
<li><strong>行动能力：</strong> 支持操作能力建模，将“如何响应”的行动知识也纳入体系，实现从观测到分析到行动的闭环。</li>
</ol>
<p>这些阶段本身也是我们在做 AIOps 逐渐试错和优化的过程，面对 AI 逐渐从理论、落地到改变世界的迅速推进，我们推出的 UModel 这一结构化的运维世界模型，将数据、逻辑和行动串联起来，为 AI 提供了可推理、可交互的知识图谱。</p>
<h2 data-id="heading-2">UModel：可泛化的运维数字化本体</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/69bcc9ee5c1e401891d89b09ccc86408~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764325099&amp;x-signature=caMFixTbmIYI%2FdgePGq17mx1xbA%3D" alt="图片" loading="lazy"/></p>
<p>UModel 是从可观测领域出发，基于本体论思想构建的 IT 世界统一建模框架。它不仅仅是数据的抽象，更是一个融合数据、知识、行动三位一体的完整体系。</p>
<p>这一建模过程和业界领先的 Palantir 类似，Palantir 从国防安全领域出发逐渐做到通用 AI 应用领域的领先，其股价也坐火箭式上升。仔细分析 Palantir 的成功，其核心价值不在于 AI 算法本身，而在于底层的“本体”（Ontology）的落地。</p>
<p>上图和 Palantir 的介绍类似，旨在描述运维数字化领域，以 UModel 为核心的可观测运维数字化平台的能力。</p>
<p>借鉴 Palantir 的设计理念，UModel 通过图模型将 IT 世界的三大要素统一：</p>
<ol>
<li><strong>数据层：</strong> 涵盖全域实体和观测数据，尤其包括各类关联关系。</li>
<li><strong>知识层：</strong> 沉淀领域专业知识，运维知识、分析模板、领域模型等。</li>
<li><strong>行动层：</strong> 支撑自动化决策执行的各类操作定义。</li>
</ol>
<h2 data-id="heading-3">为什么 UModel 是可落地的、可持续的</h2>
<p>建模这个概念并不新鲜，任何企业都可以提出“统一数据模型”的愿景。但真正在企业落地且持续发挥作用，很容易走到技术至上论、项目化思维、数据湖即数据能力、重分析轻行动等认知误区，最终导致“数据孤岛与认知隔阂”、“洞察与行动脱节”、“智能化技术与业务割裂”等问题。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/800fdd8f7cd64f2b9fa180547eb53826~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764325099&amp;x-signature=6HX68%2F%2FoOdWpjus4obO%2BsCBiCAI%3D" alt="图片" loading="lazy"/></p>
<p>UModel 之所以能够真正落地，在于我们系统性地解决了从理念到实践的完整链路问题：</p>
<ol>
<li><strong>面向业务价值的系统设计：</strong> 阿里云可观测团队服务数十万家客户，且可观测领域碎片化极其严重，UModel 从一开始就面向可观测业务场景的核心痛点设计。不是为了建模而建模，而是为了解决实际的运维效率、故障定位、系统优化等具体业务问题。</li>
<li><strong>构建持续进化的生态系统：</strong> 本身 UModel 不是一个“一次性交付”的项目，我们的目标是构建一个具备进化能力的生态系统，上述的几个发展阶段本身也是进化的结果。通过元模型架构，新的实体类型、数据类型、关系类型都可以在不影响现有系统的前提下平滑扩展。</li>
<li><strong>客户价值与平台能力的双飞轮效应：</strong> 我们一直致力于构建一个不仅能够让客户实现数据获取、价值提取、决策、执行到验证的客户价值闭环。同时在打造背后可观测平台能力提升的闭环，包括 UModel、Agent、领域模型等，最终形成双飞轮效应。</li>
</ol>
<h2 data-id="heading-4">UModel 概述：用 Set 和 Link 构建 IT 世界</h2>
<p>UModel 的设计与信息学“本体论”一致：用图来描述对象与关系，用 Field 约束语义与质量。</p>
<h4 data-id="heading-5">核心 Set 类型</h4>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f4fe1409cade4947a4624f7c09bcdf75~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764325099&amp;x-signature=7LgEy0b2M1ltaHGEobiQho1lqqU%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-6">核心 Link 类型</h4>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8db519dcc2224b8899ca2d56bb09972c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764325099&amp;x-signature=iXI2Eyi8OBf4yUuhWZ%2Bawap618M%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-7">典型例子：应用调用数据库</h4>
<ol>
<li>定义 <code>Service</code> 与 <code>DB</code> 两类 EntitySet，并建立 <code>Service -&gt; DB</code> 的 <code>Calls</code> 关系。</li>
<li>定义 <code>ServiceLogs</code>、<code>ServiceMetrics</code>、<code>Traces</code> 等 TelemetryDataSet，描述自身数据与调用产生的数据。</li>
<li>建立 TelemetryDataSet 与 EntitySet 的 DataLink。</li>
<li>定义具体实例及其 Storage 与 StorageLink。</li>
<li>定义 <code>Service</code> 与 <code>DB</code> 的 Runbook，描述操作手册、分析模板、领域知识等。</li>
</ol>
<p>通过上述建模，我们能直接获知系统中有哪些 Service/DB 实例、产生了哪些数据、存储位置与字段含义，以及操作手册、分析模板、领域知识等，从而支持人/程序/大模型的统一分析。</p>
<h2 data-id="heading-8">UModel 的工程体系：从理念到系统工程</h2>
<p>UModel 不是一个“静态定义”，而是一套工程体系：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d1223df1a3364c7a8dbdbf7ed14cc3e0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764325099&amp;x-signature=Tewzrb1yK6eK%2BXiI1oKYuMRaufM%3D" alt="图片" loading="lazy"/></p>
<ul>
<li><strong>元模型架构：</strong> UModel 并不直接定义 Field、DataSet、EntityLink 等概念，而是提供了一套“元模型”。基于元模型定义基础属性字段，通过组合、引用、继承等关系，最终生成 UModel 定义，保证其可扩展性。整体迭代路径符合“道生一、一生二、二生三、三生万物”的思想。</li>
<li><strong>标准化与自动化：</strong> 提供标准化的可观测 UModel 定义，大幅降低使用门槛；内部建立 CommonSchema 维护机制，保证 UModel 定义的高质量发展；提供自动化的实体关系生成、数据同步、元数据更新等管理能力，提升可操作性。</li>
<li><strong>技术基础设施：</strong> 专为可观测场景构建的实体、关系的存储计算引擎，能够快速回溯到任意时刻的系统状态，支持高性能的图查询、关系计算、多维分析等能力。提供管道式、高性能 SPL 统一计算框架，支持关联 UModel、实体、关系、观测数据等各类数据。</li>
<li><strong>面向对象的分析：</strong> 从传统面向数据的分析语法，进化到面向对象的“编程式”分析方式，支持运行时多态、动态方法调用等高级特性，让分析过程更加贴近真实世界的对象交互模式。</li>
<li><strong>面向 AGI 的能力：</strong> 集成语义化搜索、GraphRAG 等面向 AI 的核心能力，上层接口提供 MCP、PaaS API 等，各方面均考虑 LLM 友好特性。</li>
</ul>
<p>在工程化落地上，我们进一步强化了易用性与生产化能力：</p>
<ul>
<li><strong>CommonSchema：</strong> 沉淀阿里云产品、K8s、APM 等常见数据结构，兼容 OpenTelemetry 等标准</li>
<li><strong>实体关系自动生成：</strong> 基于先验知识与计算框架，自动从“应用&amp;业务视角信息”关联到“资源&amp;云产品视角信息”，生成跨域关系</li>
<li><strong>分析最佳实践：</strong> 为 TelemetryDataSet 附加分析最佳实践，包括开箱即用的大盘和告警等</li>
</ul>
<h4 data-id="heading-9">基于 UModel 的可观测应用与实践</h4>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/203574237a824afb895345a9d31da512~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764325099&amp;x-signature=ZDHRgUsPJt4iGBy9zpKyUEMSy1s%3D" alt="图片" loading="lazy"/></p>
<p>上图是一个典型的 UModel 配置，在系统中定义了一系列的实体，包括应用层的服务/服务实例、K8s 相关实体、底层数据库/主机、CICD 相关的 Job/Repo/操作人等。同时这一系列实体对应的可观测数据也分别进行建模（受限于篇幅，实际这里还会定义相关的 Explorer，便于快速查看数据，例如标准的 K8s、MySQL、服务大盘等；同时还有相关的告警配置）。上述所有的实例均以图的方式进行连接。</p>
<p>基于上述的 UModel 配置，我们能够构造出下图所示的具体实体拓扑（受限于篇幅，只显示一些示例实体）。接收到告警事件时，我们能够进行多种排查方式：</p>
<ol>
<li>根据实体的连接关系一步步排查，每类实体都有对应的可观测数据，按图索骥。</li>
<li>基于先验知识进行定向排查，例如 Service 出现异常后，优先排查依赖的 Service、DB、中间件等调用是否出现问题。</li>
<li>由于故障多数由变更引起，可以优先查看近期相关的服务变更，优先排查变更服务。</li>
<li>通常故障时多个实体均会有告警事件产生，可以将所有告警事件关联实体找出，画出最小连接子图辅助排查。</li>
</ol>
<p>而上述这些排查方式，无论是人、程序还是大模型都可以基于 UModel 这一标准化定义而顺畅工作，发挥出可观测数据真正的价值。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/885cd2f19c054bc4aea20dba85d44ca4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764325099&amp;x-signature=2lYooumkaiz7GJAAOx%2F6eVR2jus%3D" alt="图片" loading="lazy"/></p>
<h2 data-id="heading-10">基于 UModel 的可观测应用</h2>
<p>类似于 MVC 模型，UModel 在可观测团队中承载着 Model 的工作，在此之上我们彻底融合了原<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.aliyun.com%2Fproduct%2Fcms%3Fspm%3Da1z389.11499242.0.0.65452413vvcY0e%26utm_content%3Dg_1000408141" target="_blank" title="https://www.aliyun.com/product/cms?spm=a1z389.11499242.0.0.65452413vvcY0e&amp;utm_content=g_1000408141" ref="nofollow noopener noreferrer">云监控</a>、<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.aliyun.com%2Fproduct%2Farms%3Fspm%3Da1z389.11499242.0.0.65452413yOc5rP%26utm_content%3Dg_1000408142" target="_blank" title="https://www.aliyun.com/product/arms?spm=a1z389.11499242.0.0.65452413yOc5rP&amp;utm_content=g_1000408142" ref="nofollow noopener noreferrer">ARMS</a>、<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.aliyun.com%2Fproduct%2Fsls%3Fspm%3Da1z389.11499242.0.0.65452413PLWe13%26utm_content%3Dg_1000408139" target="_blank" title="https://www.aliyun.com/product/sls?spm=a1z389.11499242.0.0.65452413PLWe13&amp;utm_content=g_1000408139" ref="nofollow noopener noreferrer">SLS</a> 团队的各类观测应用，构成全新的“可观测 2.0”：</p>
<ul>
<li>覆盖所有类型的数据，从前端到网关、后端，从应用到中间件、基础设施，从运维类数据到安全、业务。</li>
<li>抽象并建模各类实体和关系，并生成各类跨域的实体关系，完成所有观测实体的打通。</li>
<li>基于 UModel 的统一 UI 能力，在任意界面、任意场景均可以接入可观测“互联网”。</li>
<li>算法、模型不再是针对某个数据而设计，只要是 UModel 描述的数据都能够被支持。</li>
</ul>
<p>关于可观测 2.0 相关的产品和设计理念，可参考：《<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzkwODY2NTk0OQ%3D%3D%26mid%3D2247485489%26idx%3D1%26sn%3D1b44928dab36242369be1f238429c279%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzkwODY2NTk0OQ==&amp;mid=2247485489&amp;idx=1&amp;sn=1b44928dab36242369be1f238429c279&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">云栖实录：重构可观测 - 打造大模型驱动的云监控 2.0 与 AIOps 新范式</a>》。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4531fe404f484b3fb4514832ca298822~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764325099&amp;x-signature=GRKxXAUkJ8DngcSp6bEvuRuBsVk%3D" alt="图片" loading="lazy"/></p>
<h2 data-id="heading-11">More Than UModel：走向 AGI 的运维数字化</h2>
<p>UModel 的核心是一种范式迁移：从“被动收集数据”到“主动建模世界”。当 AGI 成熟时，运维将从“人管机器”转向“AI 理解并优化世界”的新范式：</p>
<ul>
<li>完整上下文感知：瞬间理解任意系统状态的全域背景。</li>
<li>主动系统优化：从被动响应告警到持续主动优化。</li>
<li>预测性架构演进：基于业务趋势提前规划并自动完成复杂技术迁移。</li>
</ul>
<p>我们相信，这一愿景一定会实现！</p>
<blockquote>
<p>"The best way to predict the future is to create it." </p>
<p> —— Peter Ducker</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【原理到实战】实验异质性分析]]></title>    <link>https://juejin.cn/post/7574978545144250403</link>    <guid>https://juejin.cn/post/7574978545144250403</guid>    <pubDate>2025-11-21T10:21:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574978545144250403" data-draft-id="7574992086715154447" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【原理到实战】实验异质性分析"/> <meta itemprop="keywords" content="数据挖掘"/> <meta itemprop="datePublished" content="2025-11-21T10:21:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="京东零售技术"/> <meta itemprop="url" content="https://juejin.cn/user/4233576972293643"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【原理到实战】实验异质性分析
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4233576972293643/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    京东零售技术
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T10:21:20.000Z" title="Fri Nov 21 2025 10:21:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><ol>
<li>什么是实验的异质性</li>
<li>
<ol>
<li>什么是异质性</li>
</ol>
</li>
</ol>
<p>当我们看到如下实验平台指标结果时</p>





















<table><thead><tr><th>实验分组</th><th>指标值</th></tr></thead><tbody><tr><td>对照组</td><td>100</td></tr><tr><td>实验组</td><td>99.96</td></tr><tr><td>相对差异</td><td>-0.04%</td></tr></tbody></table>
<p>在进行分析前，可能我们的第一直觉是这样的</p>
<p><img src="" alt="" loading="lazy"/></p>
<p>经过异质性分析后，可能会发现实际情况是这样的</p>
<p><img src="" alt="" loading="lazy"/></p>
<ol>
<li>概念解析与定义</li>
</ol>
<p>一般来讲，HTE的全称为Heterogeneous Treatment Effects，即异质处理效应，意为实验中同一个treatment对不同的实验样本，得到的策略效果可能是不一样的。另外还有一些重要的概念需要大家理解</p>


































<table><thead><tr><th>英文简称</th><th>英文全称</th><th>中文译名</th><th>含义</th><th>公式</th></tr></thead><tbody><tr><td>ATE</td><td>Average Treatment Effect</td><td>平均处理效应</td><td>所有实验对象的平均实验效果</td><td>ATE=E[Y(1)-Y(0)]</td></tr><tr><td>CATE</td><td>Conditional Average Treatment Effect</td><td>条件平均处理效应</td><td>满足一定条件的实验对象的平均实验效果</td><td>CATE_X=E[Y_x(1)-Y_x(0)</td><td>x \in X]</td></tr><tr><td>ITE</td><td>Individual Treatment Effect</td><td>个体处理效应</td><td>某个实验对象的实验效果</td><td>ITE_i=E[Y_i(1)-Y_i(0)], i=1,2,...N</td></tr></tbody></table>
<p>** 此处采用Donald Rubin提出的潜在因果框架（Potencial outcome）来对实验效果进行统计公式上的描述 [1]*</p>
<ul>
<li><em>由于业内并没有统一的定义，HTE、CATE、ITE概念在一定程度上会有混用的情况，读者需要参考描述以及上下文综合判断名词的含义</em></li>
</ul>
<ol>
<li>异质性分析对于业务的意义</li>
<li>
<ol>
<li>了解策略对于不同用户的不同效果，协助挖掘背后的业务逻辑，辅助迭代、进行新一轮的实验</li>
<li>尝试寻找策略最优子人群，让整体无效的策略，有机会进行部分先推全；反之依然，让部分负向的策略，减少损失</li>
<li>对实验结果建模后预测，对线上提供动态的最优人群支持</li>
</ol>
</li>
</ol>
<blockquote>
<p>根据实验平台数据科学团队测算，以京东零售某产品线下6月运行中的实验为例，仅23%左右的实验没有在实验人群视角发现异质性</p>
</blockquote>
<ol>
<li>异质性分析方法概述</li>
<li>
<ol>
<li>异质性分析的维度选择</li>
<li>
<ol>
<li>对于<strong>分流单元的维度X</strong>，当X满足以下条件时，可以作为异质性的维度进行后续分析</li>
<li>
<ul>
<li>T \perp X，即<strong>分析维度与实验分流无关</strong> (Unconfoundedness)</li>
<li>分析工具化的常见简化方式：对于一个分流ID，<strong>选取他在首次进入实验前一天的标签取值</strong></li>
<li>简单推导：</li>
</ul>
</li>
</ol>
</li>
</ol>
</li>
</ol>
<p>CATE_X</p>
<p>= E[Y_x(1) - Y_x(0)|x \in X] \qquad\qquad\qquad\qquad\qquad \dots (1)</p>
<p>= E[Y_x(1)|x \in X] - E[Y_x(0)|x \in X] \qquad\qquad\qquad\dots (2)</p>
<p>= E[Y_x(1)|T_i=1, x \in X] - E[Y_x(0)|T_i=0, x \in X] \dots (3)= E[Y_i|T_i=1, x \in X] - E[Y_i|T_i=0, x \in X] \qquad\dots (4)</p>
<p><em>T是随机化的，</em> T \perp Y, T \perp X <em>，所以</em>E[Y_i(1)|x \in X]=E[Y_i(1)｜T_i=1,x \in X] <em>，所以（3）成立</em></p>
<ol>
<li>异质性分析的维度分析bad case举例</li>
</ol>














<table><thead><tr><th><strong>分析目标 &amp; 常见错误方法举例</strong></th><th><strong>不成立原因简述</strong></th><th><strong>推荐的实验分析方式</strong></th></tr></thead><tbody><tr><td>-   不同活跃度人群的策略效果</td><td/></tr></tbody></table>
<ul>
<li>在实验运行7天后，利用实验用户在第7天的活跃度标签进行结果拆解                       | 在实验开始后，用户的活跃度标签受到了策略影响，即T \perp X不成立                          | 使用用户在进入实验前1天的活跃度标签值                                     |
| -   分别分析低频策略、中频策略、高频策略对于低、中、高频用户的策略效果</li>
<li>按天取每天用户的活跃度标签，对实验结果进行拆解          | -   用户的活跃度标签受到了策略影响，即T \perp X不成立</li>
<li>用户所在分组应该是确定的，不随时间改变     | 分别建立3个人群正交实验                                            |
| -   分析高单价类目商品（3C家电）和低单价类目商品（休闲食品）的转化率差异</li>
<li>选取xx类目曝光用户，计算实验周期内对应类目的曝光订单转化率 | 分析目标是面向指标维度的（sku所在类目），而非分流单元的维度（C端实验通常为账号、设备），不适用本文提到的异质性分析方法 | 1.  应该使用指标维度下钻进行分析</li>
</ul>
<ol>
<li>
<p>曝光订单转化率的分子、分母均受到策略影响，需在观测全面后综合判断 |</p>
</li>
<li>
<p>异质性分析的方法选择</p>
</li>
</ol>

















<table><thead><tr><th><strong>研究对象</strong></th><th><strong>研究方法</strong></th><th><strong>适用场景</strong></th><th><strong>pros &amp; cons</strong></th></tr></thead><tbody><tr><td>CATE</td><td>维度下钻</td><td>-   低维</td><td/></tr></tbody></table>
<ul>
<li>分析目标明确                                                                                                                                                              | + 快速简单，便于理解+ 产品化容易- 维度选择依赖分析师经验- 交互效应处理困难                                                                                                                                           |
| 方差分析（ANOVA，ANCOVA） | -   低维</li>
<li>分析目标较明确</li>
<li>交互效应评估         | + 解释性强，统计学理论背书+ 可以处理低维度交互效应+ 可作为feature selection的候选方法- 基于线性模型假设- 高维度交互效应解读困难                                                                                             |                                                                                                                                                                                         |
| 因果树（Causal Tree）   | -   高维</li>
<li>分析目标不明确，希望探索               | + 建模方法符合分析直觉- 模型复杂度不足，无法准确描述复杂的现实世界效果- 本方法为现代机器学习因果算法的基石之一，有更好的替代方案                                                                                                         |                                                                                                                                                                                         |
| ITE                | Meta - Learner                        | -   高维</li>
<li>希望输出ITE</li>
<li>算法训练                                                                                                                                                    | + 算法常用，可大规模并行，有工程化先例+ 在过往的simulation中X-learner对ITE估计的准确度表现优秀+ X-learner通常使用xgboost模型，对各种feature有较强的处理能力- 计算量大，耗资源- 需要调参- 由于缺乏统计推断结果，一般不会直接产出p-value，存在对于ITE数值准确性的质疑，算法利用结果的rank居多 |
| DML                | -   高维</li>
<li>希望输出ITE和置信区间               | + 有严谨统计理论证明ITE估计的无偏有效性，可产出样本级的ITE以及置信区间+ 在过往的simulation中Causal Forest DML对ITE估计的准确度表现优秀+ DML模型框架本身具备一定的robust特性，在结合Forest模型后，调参需求低，不容易过拟合，对各种feature有较强的处理能力- 慢，耗资源，工程化先例少 |                                                                                                                                                                                         |
| ITE + CATE hybrid  | ITE Model + Decision Tree Interpreter | -   高维</li>
<li>分析目标不明确，希望探索                                                                                                                                                        | + 决策树的建模方法符合分析直觉+ ITE模型可以较好的对复杂的现实世界进行抽象总结- ITE模型可能会慢                                                                                                                                |</li>
</ul>
<ol>
<li>实验CATE下钻探索工具MVP版逻辑介绍</li>
</ol>
<p>实验平台数据科学团队已经产出python工具包，可以半自动化的利用6行代码实现平台上实验异质性的探索分析，可以实现以下功能</p>
<ol>
<li>通过填写YAML配置，自动生成实验分析SQL，并执行取数，目前包括</li>
<li>
<ol>
<li>自动获取试金石实验分流信息</li>
<li>自动获取试金石实验指标信息</li>
<li>解析实验CATE研究使用的用户标签表</li>
<li>自动生成所有数据源的关联关系</li>
</ol>
</li>
<li>为实验CATE研究提供自动化工具，目前包括</li>
<li>
<ol>
<li>自动化生成实验目标指标的CATE差异最大化子人群</li>
<li>提供调参接口，高级用户可自定义模型参数</li>
<li>提供可视化的模型结果输出，高级用户可根据输出调节模型表现</li>
</ol>
</li>
<li>为实验的下钻分析提供探索、分析功能，目前包括</li>
<li>
<ol>
<li>CATE人群的实验效果统计检验</li>
<li>CATE人群的多指标拆解</li>
<li>CATE人群的特征描述</li>
</ol>
</li>
<li>实验异质性分析show case</li>
<li>
<ol>
<li>某真实实验case的CATE结果分析，此项目整体实验指标为负向不显著，但通过运行分析工具后发现，有两类子人群分别具有正向和负向的显著效果</li>
</ol>
</li>
</ol>













<table><thead><tr><th>自动探索分析模型的树结构</th><th>自动探索分析模型产出的异质性人群实验结果</th></tr></thead><tbody><tr><td><img src="" alt="" loading="lazy"/></td><td><img src="" alt="" loading="lazy"/></td></tr></tbody></table>
<ol>
<li>对于这些子人群，我们发现他们的用户画像具备不同的特征，在业务漏斗的实验结果也不一致，那么下次对频道再次进行迭代时，产品经理可以有针对性的对负向人群的体验进行优化</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[如何在 C# 中自动化生成 PDF 表格]]></title>    <link>https://juejin.cn/post/7574978545144184867</link>    <guid>https://juejin.cn/post/7574978545144184867</guid>    <pubDate>2025-11-21T10:06:41.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574978545144184867" data-draft-id="7574978545144168483" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="如何在 C# 中自动化生成 PDF 表格"/> <meta itemprop="keywords" content="后端,C#"/> <meta itemprop="datePublished" content="2025-11-21T10:06:41.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="用户835629078051"/> <meta itemprop="url" content="https://juejin.cn/user/3150554985403516"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            如何在 C# 中自动化生成 PDF 表格
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3150554985403516/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    用户835629078051
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T10:06:41.000Z" title="Fri Nov 21 2025 10:06:41 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/94cdbe765d5f43b5bae00efc6a9367ab~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3ODM1NjI5MDc4MDUx:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764324400&amp;x-signature=LUrYApa%2Bv9lPM4czKljB6hGPPNM%3D" alt="C#绘制PDF表格" loading="lazy"/></p>
<p>在现代商业应用中，PDF文档因其跨平台、内容固定和易于共享的特性，成为信息传递的重要载体。无论是财务报表、发票、合同，还是产品目录，结构化的数据往往需要以表格的形式呈现。手动创建这些PDF表格不仅效率低下，而且极易出错。幸运的是，借助C#编程，我们可以自动化这一过程，实现高效、精确的PDF表格生成。</p>
<p>本文将深入探讨如何使用一款功能强大的PDF处理库——Spire.PDF for .NET，在C#中创建和定制PDF表格。我们将从基础的表格构建开始，逐步讲解样式设置、单元格合并、动态数据绑定等进阶功能，旨在为开发者提供一份从入门到精通的实践指南。</p>
<h2 data-id="heading-0">一、准备工作与基础表格创建</h2>
<p>首先，我们需要将Spire.PDF for .NET库集成到我们的C#项目中。最便捷的方式是通过NuGet包管理器：</p>
<pre><code class="hljs language-bash" lang="bash">Install-Package Spire.PDF
</code></pre>
<p>安装完成后，我们就可以开始创建最简单的PDF表格了。Spire.PDF库提供了<code>PdfTable</code>类来表示表格，并通过<code>PdfTableColumn</code>和数据填充来构建表格内容。</p>
<p>下面是一个创建2行3列基础表格的示例：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">using</span> Spire.Pdf;
<span class="hljs-keyword">using</span> Spire.Pdf.Graphics;
<span class="hljs-keyword">using</span> Spire.Pdf.Tables;
<span class="hljs-keyword">using</span> System.Drawing;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">BasicTableExample</span>
{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">CreateSimpleTable</span>()</span>
    {
        <span class="hljs-comment">// 创建PDF文档</span>
        PdfDocument doc = <span class="hljs-keyword">new</span> PdfDocument();
        <span class="hljs-comment">// 添加一个页面</span>
        PdfPageBase page = doc.Pages.Add();

        <span class="hljs-comment">// 创建PdfTable实例</span>
        PdfTable table = <span class="hljs-keyword">new</span> PdfTable();

        <span class="hljs-comment">// 定义表格列</span>
        table.Columns.Add(<span class="hljs-keyword">new</span> PdfTableColumn(<span class="hljs-string">"Header 1"</span>));
        table.Columns.Add(<span class="hljs-keyword">new</span> PdfTableColumn(<span class="hljs-string">"Header 2"</span>));
        table.Columns.Add(<span class="hljs-keyword">new</span> PdfTableColumn(<span class="hljs-string">"Header 3"</span>));

        <span class="hljs-comment">// 准备表格数据</span>
        <span class="hljs-built_in">string</span>[,] data = 
        {
            { <span class="hljs-string">"Row 1, Cell 1"</span>, <span class="hljs-string">"Row 1, Cell 2"</span>, <span class="hljs-string">"Row 1, Cell 3"</span> },
            { <span class="hljs-string">"Row 2, Cell 1"</span>, <span class="hljs-string">"Row 2, Cell 2"</span>, <span class="hljs-string">"Row 2, Cell 3"</span> }
        };

        <span class="hljs-comment">// 设置表格数据源</span>
        table.DataSource = data;

        <span class="hljs-comment">// 绘制表格到PDF页面，并指定位置</span>
        table.Draw(page, <span class="hljs-keyword">new</span> PointF(<span class="hljs-number">50</span>, <span class="hljs-number">50</span>));

        <span class="hljs-comment">// 保存PDF文档</span>
        doc.SaveToFile(<span class="hljs-string">"SimpleTable.pdf"</span>);
        doc.Close();
        System.Diagnostics.Process.Start(<span class="hljs-string">"SimpleTable.pdf"</span>);
    }
}
</code></pre>
<blockquote>
<p><strong>核心API提示:</strong></p>
<ul>
<li><code>PdfDocument</code>: PDF文档的顶层对象。</li>
<li><code>PdfPageBase</code>: 代表PDF文档中的一个页面。</li>
<li><code>PdfTable</code>: 用于创建和管理PDF表格。</li>
<li><code>PdfTableColumn</code>: 定义表格的列，可以设置列标题。</li>
<li><code>table.DataSource</code>: 可以接受二维数组、<code>DataTable</code>或自定义对象集合作为数据源。</li>
</ul>
</blockquote>
<h2 data-id="heading-1">二、表格样式与布局进阶</h2>
<p>一个美观且易读的表格离不开精心的样式设计。Spire.PDF允许我们精细控制表格的边框、背景色、字体样式以及单元格的合并与对齐。</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">using</span> Spire.Pdf;
<span class="hljs-keyword">using</span> Spire.Pdf.Graphics;
<span class="hljs-keyword">using</span> Spire.Pdf.Tables;
<span class="hljs-keyword">using</span> System.Drawing;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">AdvancedTableExample</span>
{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">CreateStyledTable</span>()</span>
    {
        PdfDocument doc = <span class="hljs-keyword">new</span> PdfDocument();
        PdfPageBase page = doc.Pages.Add();

        PdfTable table = <span class="hljs-keyword">new</span> PdfTable();

        <span class="hljs-comment">// 定义列并设置列宽</span>
        table.Columns.Add(<span class="hljs-keyword">new</span> PdfTableColumn(<span class="hljs-string">"产品名称"</span>) { Width = <span class="hljs-number">100</span> });
        table.Columns.Add(<span class="hljs-keyword">new</span> PdfTableColumn(<span class="hljs-string">"单价"</span>) { Width = <span class="hljs-number">60</span> });
        table.Columns.Add(<span class="hljs-keyword">new</span> PdfTableColumn(<span class="hljs-string">"数量"</span>) { Width = <span class="hljs-number">60</span> });
        table.Columns.Add(<span class="hljs-keyword">new</span> PdfTableColumn(<span class="hljs-string">"小计"</span>) { Width = <span class="hljs-number">80</span> });

        <span class="hljs-comment">// 设置表格边框</span>
        table.Style.BorderPen = <span class="hljs-keyword">new</span> PdfPen(Color.Black, <span class="hljs-number">0.5f</span>);
        table.Style.CellPadding = <span class="hljs-number">5</span>; <span class="hljs-comment">// 单元格内边距</span>

        <span class="hljs-comment">// 设置表头样式</span>
        table.Style.HeaderSource = PdfHeaderSource.Rows;
        table.Style.HeaderRowCount = <span class="hljs-number">1</span>; <span class="hljs-comment">// 第一行为表头</span>
        table.Style.ShowHeader = <span class="hljs-literal">true</span>;
        table.Style.HeaderStyle.BackgroundBrush = PdfBrushes.DarkSlateGray; <span class="hljs-comment">// 表头背景色</span>
        table.Style.HeaderStyle.TextBrush = PdfBrushes.White; <span class="hljs-comment">// 表头文字颜色</span>
        table.Style.HeaderStyle.Font = <span class="hljs-keyword">new</span> PdfTrueTypeFont(<span class="hljs-keyword">new</span> Font(<span class="hljs-string">"Arial"</span>, <span class="hljs-number">12f</span>, FontStyle.Bold));
        table.Style.HeaderStyle.StringFormat = <span class="hljs-keyword">new</span> PdfStringFormat(PdfTextAlignment.Center, PdfVerticalAlignment.Middle);

        <span class="hljs-comment">// 设置默认单元格样式</span>
        table.Style.DefaultStyle.Font = <span class="hljs-keyword">new</span> PdfTrueTypeFont(<span class="hljs-keyword">new</span> Font(<span class="hljs-string">"Arial"</span>, <span class="hljs-number">10f</span>));
        table.Style.DefaultStyle.BackgroundBrush = PdfBrushes.LightGray;

        <span class="hljs-comment">// 设置交替行样式，提升可读性</span>
        table.Style.AlternateStyle = <span class="hljs-keyword">new</span> PdfCellStyle();
        table.Style.AlternateStyle.BackgroundBrush = PdfBrushes.WhiteSmoke;

        <span class="hljs-comment">// 准备数据</span>
        <span class="hljs-built_in">string</span>[,] data =
        {
            { <span class="hljs-string">"笔记本电脑"</span>, <span class="hljs-string">"8999.00"</span>, <span class="hljs-string">"1"</span>, <span class="hljs-string">"8999.00"</span> },
            { <span class="hljs-string">"机械键盘"</span>, <span class="hljs-string">"799.00"</span>, <span class="hljs-string">"2"</span>, <span class="hljs-string">"1598.00"</span> },
            { <span class="hljs-string">"无线鼠标"</span>, <span class="hljs-string">"299.00"</span>, <span class="hljs-string">"3"</span>, <span class="hljs-string">"897.00"</span> },
            { <span class="hljs-string">"总计"</span>, <span class="hljs-string">""</span>, <span class="hljs-string">""</span>, <span class="hljs-string">"11494.00"</span> }
        };
        table.DataSource = data;

        <span class="hljs-comment">// 合并“总计”行的单元格</span>
        <span class="hljs-comment">// 合并第4行（索引为3）的第2列到第3列</span>
        table.MergeCells(<span class="hljs-number">3</span>, <span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">2</span>); 
        
        <span class="hljs-comment">// 设置合并后单元格的文本对齐方式</span>
        table.Rows[<span class="hljs-number">3</span>].Cells[<span class="hljs-number">1</span>].StringFormat = <span class="hljs-keyword">new</span> PdfStringFormat(PdfTextAlignment.Right, PdfVerticalAlignment.Middle);

        table.Draw(page, <span class="hljs-keyword">new</span> PointF(<span class="hljs-number">50</span>, <span class="hljs-number">50</span>));

        doc.SaveToFile(<span class="hljs-string">"StyledTable.pdf"</span>);
        doc.Close();
        System.Diagnostics.Process.Start(<span class="hljs-string">"StyledTable.pdf"</span>);
    }
}
</code></pre>
<blockquote>
<p><strong>样式控制要点:</strong></p>
<ul>
<li><code>table.Style.BorderPen</code>: 设置表格整体边框的画笔。</li>
<li><code>table.Style.CellPadding</code>: 设置单元格内边距。</li>
<li><code>table.Style.HeaderStyle</code>: 控制表头样式，包括背景、字体、对齐等。</li>
<li><code>table.Style.DefaultStyle</code>: 设置非表头单元格的默认样式。</li>
<li><code>table.Style.AlternateStyle</code>: 用于设置交替行的样式，常用于提升表格可读性。</li>
<li><code>table.MergeCells(startRow, startColumn, endRow, endColumn)</code>: 合并指定范围的单元格。</li>
<li><code>PdfStringFormat</code>: 精确控制文本的水平和垂直对齐方式。</li>
</ul>
</blockquote>
<h2 data-id="heading-2">三、动态数据绑定与复杂场景</h2>
<p>在实际应用中，表格数据通常来源于数据库、API或其他动态源。Spire.PDF支持将<code>DataTable</code>或自定义对象集合直接绑定到<code>PdfTable</code>，极大地简化了数据处理。</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">using</span> Spire.Pdf;
<span class="hljs-keyword">using</span> Spire.Pdf.Graphics;
<span class="hljs-keyword">using</span> Spire.Pdf.Tables;
<span class="hljs-keyword">using</span> System.Data;
<span class="hljs-keyword">using</span> System.Drawing;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">DynamicDataTableExample</span>
{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">CreateTableFromDataTable</span>()</span>
    {
        PdfDocument doc = <span class="hljs-keyword">new</span> PdfDocument();
        PdfPageBase page = doc.Pages.Add();

        <span class="hljs-comment">// 创建一个DataTable作为数据源</span>
        DataTable dataTable = <span class="hljs-keyword">new</span> DataTable();
        dataTable.Columns.Add(<span class="hljs-string">"ID"</span>, <span class="hljs-keyword">typeof</span>(<span class="hljs-built_in">int</span>));
        dataTable.Columns.Add(<span class="hljs-string">"姓名"</span>, <span class="hljs-keyword">typeof</span>(<span class="hljs-built_in">string</span>));
        dataTable.Columns.Add(<span class="hljs-string">"年龄"</span>, <span class="hljs-keyword">typeof</span>(<span class="hljs-built_in">int</span>));
        dataTable.Columns.Add(<span class="hljs-string">"城市"</span>, <span class="hljs-keyword">typeof</span>(<span class="hljs-built_in">string</span>));

        <span class="hljs-comment">// 填充数据</span>
        dataTable.Rows.Add(<span class="hljs-number">1</span>, <span class="hljs-string">"张三"</span>, <span class="hljs-number">30</span>, <span class="hljs-string">"北京"</span>);
        dataTable.Rows.Add(<span class="hljs-number">2</span>, <span class="hljs-string">"李四"</span>, <span class="hljs-number">25</span>, <span class="hljs-string">"上海"</span>);
        dataTable.Rows.Add(<span class="hljs-number">3</span>, <span class="hljs-string">"王五"</span>, <span class="hljs-number">35</span>, <span class="hljs-string">"广州"</span>);
        dataTable.Rows.Add(<span class="hljs-number">4</span>, <span class="hljs-string">"赵六"</span>, <span class="hljs-number">28</span>, <span class="hljs-string">"深圳"</span>);
        dataTable.Rows.Add(<span class="hljs-number">5</span>, <span class="hljs-string">"钱七"</span>, <span class="hljs-number">40</span>, <span class="hljs-string">"杭州"</span>);
        <span class="hljs-comment">// 更多数据...</span>

        PdfTable table = <span class="hljs-keyword">new</span> PdfTable();
        <span class="hljs-comment">// 直接绑定DataTable</span>
        table.DataSource = dataTable;

        <span class="hljs-comment">// 设置列宽</span>
        table.Columns[<span class="hljs-number">0</span>].Width = <span class="hljs-number">50</span>;
        table.Columns[<span class="hljs-number">1</span>].Width = <span class="hljs-number">80</span>;
        table.Columns[<span class="hljs-number">2</span>].Width = <span class="hljs-number">60</span>;
        table.Columns[<span class="hljs-number">3</span>].Width = <span class="hljs-number">100</span>;

        <span class="hljs-comment">// 设置表头样式</span>
        table.Style.HeaderStyle.BackgroundBrush = PdfBrushes.DarkBlue;
        table.Style.HeaderStyle.TextBrush = PdfBrushes.White;
        table.Style.HeaderStyle.Font = <span class="hljs-keyword">new</span> PdfTrueTypeFont(<span class="hljs-keyword">new</span> Font(<span class="hljs-string">"Arial"</span>, <span class="hljs-number">11f</span>, FontStyle.Bold));
        table.Style.HeaderStyle.StringFormat = <span class="hljs-keyword">new</span> PdfStringFormat(PdfTextAlignment.Center, PdfVerticalAlignment.Middle);

        <span class="hljs-comment">// 设置默认单元格样式</span>
        table.Style.DefaultStyle.Font = <span class="hljs-keyword">new</span> PdfTrueTypeFont(<span class="hljs-keyword">new</span> Font(<span class="hljs-string">"Arial"</span>, <span class="hljs-number">9f</span>));
        table.Style.DefaultStyle.StringFormat = <span class="hljs-keyword">new</span> PdfStringFormat(PdfTextAlignment.Center, PdfVerticalAlignment.Middle);
        table.Style.DefaultStyle.BackgroundBrush = PdfBrushes.LightCyan;

        <span class="hljs-comment">// 处理大数据量时的分页（简要提及）</span>
        <span class="hljs-comment">// 当表格内容超出当前页面时，Spire.PDF会自动进行分页。</span>
        <span class="hljs-comment">// 可以通过 PdfTableLayoutFormat 控制分页行为，例如设置重复表头：</span>
        PdfTableLayoutFormat format = <span class="hljs-keyword">new</span> PdfTableLayoutFormat();
        format.Break = PdfLayoutBreakType.FitPage; <span class="hljs-comment">// 自动适应页面</span>
        format.Layout = PdfLayoutType.Paginate; <span class="hljs-comment">// 启用分页</span>
        table.Style.RepeatHeader = <span class="hljs-literal">true</span>; <span class="hljs-comment">// 每页重复表头</span>

        table.Draw(page, <span class="hljs-keyword">new</span> PointF(<span class="hljs-number">50</span>, <span class="hljs-number">50</span>), format); <span class="hljs-comment">// 绘制时传入布局格式</span>

        doc.SaveToFile(<span class="hljs-string">"DynamicTableFromDataTable.pdf"</span>);
        doc.Close();
        System.Diagnostics.Process.Start(<span class="hljs-string">"DynamicTableFromDataTable.pdf"</span>);
    }
}
</code></pre>
<blockquote>
<p><strong>动态绑定与分页:</strong></p>
<ul>
<li><code>table.DataSource = dataTable;</code>: 将<code>DataTable</code>直接赋值给<code>DataSource</code>属性，Spire.PDF会自动识别列名作为表头，并填充数据。</li>
<li><code>PdfTableLayoutFormat</code>: 用于控制表格的布局和分页行为，是处理大数据量表格的关键。</li>
<li><code>table.Style.RepeatHeader = true;</code>: 在表格分页时，确保每一页的顶部都显示表头，极大地提升了报表的阅读体验。</li>
<li><strong>图片和超链接:</strong> Spire.PDF也支持在单元格中插入<code>PdfImage</code>或<code>PdfUriAnnotation</code>来添加图片和超链接，这使得报表内容更加丰富。</li>
</ul>
</blockquote>
<h2 data-id="heading-3">四、提升用户体验与性能考量</h2>
<p>在开发过程中，除了功能实现，我们还需要关注性能和代码的健壮性。</p>
<ul>
<li><strong>性能优化:</strong> 频繁创建字体对象会消耗资源。建议将常用的<code>PdfTrueTypeFont</code>实例缓存起来，避免重复创建。对于大型表格，合理设置<code>PdfTableLayoutFormat</code>的分页参数，可以优化渲染速度。</li>
<li><strong>错误处理:</strong> 在实际项目中，应加入必要的<code>try-catch</code>块来处理文件操作、数据绑定等可能发生的异常，确保程序的稳定性。</li>
<li><strong>代码健壮性:</strong> 检查数据源的有效性，防止空引用或格式错误导致的问题。</li>
<li><strong>表格模板:</strong> 对于结构相似但内容不同的报表，可以考虑设计表格模板。预设好表格的样式、列定义，然后根据不同的数据源动态填充，提高代码复用性。</li>
</ul>
<h2 data-id="heading-4">总结</h2>
<p>通过本文的讲解，我们深入了解了如何利用C#和Spire.PDF for .NET库在PDF文档中创建功能丰富、样式多样的表格。从基础的表格构建到复杂的样式控制、动态数据绑定和分页处理，Spire.PDF提供了一整套强大且易用的API，极大地简化了PDF报表的开发工作。</p>
<p>自动化生成PDF表格不仅能够提高开发效率，减少人工错误，还能为企业提供更灵活、更专业的文档输出方案。希望这篇教程能帮助您在C#项目中轻松应对PDF表格的生成需求。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[SpringBoot实战一：五分钟创建第一个Web应用]]></title>    <link>https://juejin.cn/post/7574967214128316442</link>    <guid>https://juejin.cn/post/7574967214128316442</guid>    <pubDate>2025-11-21T10:15:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574967214128316442" data-draft-id="7574840547807903754" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="SpringBoot实战一：五分钟创建第一个Web应用"/> <meta itemprop="keywords" content="Java"/> <meta itemprop="datePublished" content="2025-11-21T10:15:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="智语言"/> <meta itemprop="url" content="https://juejin.cn/user/45498495414779"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            SpringBoot实战一：五分钟创建第一个Web应用
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/45498495414779/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    智语言
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T10:15:46.000Z" title="Fri Nov 21 2025 10:15:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    2
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>​</p>
<blockquote>
<p> 本文的实验操作步骤放在第三步骤，第二部分是理论讲解</p>
</blockquote>
<h2 data-id="heading-0">一、实验目标</h2>
<ul>
<li>使用Spring Initializr在5分钟内创建SpringBoot项目</li>
<li>理解SpringBoot自动配置原理</li>
</ul>
<h3 data-id="heading-1">二、核心理论</h3>
<h3 data-id="heading-2">SpringBoot自动配置原理</h3>
<blockquote>
<p>// SpringBoot通过@SpringBootApplication注解实现自动配置<br/>
@SpringBootApplication // 组合注解：包含@Configuration @EnableAutoConfiguration</p>
<p>@ComponentScan<br/>
public class Application {<br/>
public static void main(String[] args) {<br/>
SpringApplication.run(Application.class, args);<br/>
}<br/>
}</p>
</blockquote>






























<table><thead><tr><th>对比角度</th><th><code>@Configuration</code></th><th><code>@EnableAutoConfiguration</code></th></tr></thead><tbody><tr><td>核心功能</td><td>手动定义配置和 Bean</td><td>自动根据环境 / 依赖配置 Bean</td></tr><tr><td>使用方式</td><td>标记配置类，配合 <code>@Bean</code> 使用</td><td>通常通过 <code>@SpringBootApplication</code> 间接使用</td></tr><tr><td>依赖关系</td><td>是 Spring 核心注解，不依赖 Spring Boot</td><td>是 Spring Boot 特有的自动配置入口</td></tr><tr><td>作用场景</td><td>自定义 Bean 或配置逻辑</td><td>简化默认配置，减少手动编码</td></tr></tbody></table>
<h4 data-id="heading-3">1.1、 <code>@Configuration</code> 注解</h4>
<h5 data-id="heading-4">作用</h5>
<p>标记一个类为<strong>配置类</strong>，用于替代传统的 XML 配置文件，在类中可以通过 <code>@Bean</code> 注解定义 Spring 容器管理的 Bean。</p>
<h5 data-id="heading-5">核心特性</h5>
<ul>
<li><strong>替代 XML 配置</strong>：传统 Spring 中通过 <code>&lt;bean&gt;</code> 标签定义 Bean，<code>@Configuration</code> 类配合 <code>@Bean</code> 可实现完全相同的功能，更符合 Java 代码的编写习惯。</li>
<li><strong>Bean 定义</strong>：在 <code>@Configuration</code> 类中，用 <code>@Bean</code> 注解修饰方法，方法返回值会被注册为 Spring 容器中的 Bean，默认单例。</li>
<li><strong>配置类本身也是 Bean</strong>：<code>@Configuration</code> 类会被 Spring 自动注册为容器中的一个 Bean，可被其他组件注入。</li>
<li><strong>支持嵌套配置</strong>：可以在 <code>@Configuration</code> 类中嵌套其他 <code>@Configuration</code> 类（通过内部类），简化配置结构。</li>
<li><strong>CGLIB 代理增强</strong>：Spring 会通过 CGLIB 代理 <code>@Configuration</code> 类，确保 <code>@Bean</code> 方法之间的调用返回的是容器中已注册的 Bean（而非新实例），保证单例特性。</li>
</ul>
<p><strong>示例</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AppConfig</span> {
    <span class="hljs-comment">// 定义一个 Bean，id 默认为方法名 "userService"</span>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">UserService</span> <span class="hljs-title function_">userService</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserService</span>();
    }
    
    <span class="hljs-comment">// 依赖其他 Bean（通过方法调用，Spring 会自动注入）</span>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">OrderService</span> <span class="hljs-title function_">orderService</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderService</span>(<span class="hljs-title function_">userService</span>()); <span class="hljs-comment">// 此处调用返回容器中的 userService 实例</span>
    }
}
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<h4 data-id="heading-6">2. <code>@EnableAutoConfiguration</code> 注解</h4>
<h5 data-id="heading-7">作用</h5>
<p>开启 Spring Boot 的<strong>自动配置机制</strong>，让 Spring Boot 根据项目依赖、类路径资源等自动配置 Spring 容器中的 Bean，简化开发（无需手动编写大量配置）。</p>
<h5 data-id="heading-8">核心原理</h5>
<ul>
<li><strong>类路径扫描</strong>：Spring Boot 启动时，<code>@EnableAutoConfiguration</code> 会触发对类路径下的 <code>META-INF/spring.factories</code> 文件的扫描，该文件中定义了大量自动配置类（<code>XXXAutoConfiguration</code>）。</li>
<li><strong>条件注解筛选</strong>：自动配置类通常通过 <code>@Conditional</code> 系列注解（如 <code>@ConditionalOnClass</code>、<code>@ConditionalOnMissingBean</code> 等）判断是否满足配置条件，只有条件成立时才会注册对应的 Bean。例如：<code>DataSourceAutoConfiguration</code> 会检查类路径是否有 JDBC 相关类，若存在且用户未手动定义 <code>DataSource</code> Bean，则自动配置默认数据源。</li>
<li><strong>优先级机制</strong>：自动配置类可通过 <code>@AutoConfigureBefore</code>、<code>@AutoConfigureAfter</code> 等注解控制加载顺序，确保依赖关系正确。</li>
</ul>
<h5 data-id="heading-9">使用场景</h5>
<ul>
<li>通常不单独使用，而是通过 <code>@SpringBootApplication</code> 间接生效（<code>@SpringBootApplication</code> 包含 <code>@EnableAutoConfiguration</code>）。</li>
<li>若需排除特定自动配置类，可通过 <code>@EnableAutoConfiguration(exclude = XXXAutoConfiguration.class)</code> 实现。</li>
</ul>
<h5 data-id="heading-10">示例</h5>
<pre><code class="hljs language-less" lang="less"><span class="hljs-comment">// 等价于 @SpringBootApplication（包含 @EnableAutoConfiguration）</span>
<span class="hljs-variable">@EnableAutoConfiguration</span>
<span class="hljs-variable">@ComponentScan</span>
public class Application {
    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">static</span> <span class="hljs-selector-tag">void</span> <span class="hljs-selector-tag">main</span>(String[] args) {
        <span class="hljs-selector-tag">SpringApplication</span><span class="hljs-selector-class">.run</span>(Application.class, args);
    }
}

<span class="hljs-comment">// 排除特定自动配置类</span>
@<span class="hljs-selector-tag">EnableAutoConfiguration</span>(exclude = DataSourceAutoConfiguration.class)
<span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">class</span> <span class="hljs-selector-tag">Application</span> { ... }
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<h2 data-id="heading-11">三、实验操作步骤</h2>
<p>1、打开IDEA，选择新建springboot项目</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b5a27b76c9d54db0a0be637fcc2bcc7c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm66K-t6KiA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764325278&amp;x-signature=BBWpFfZcExDGJFEIXAzanFYfmnE%3D" alt="" loading="lazy"/><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<h3 data-id="heading-12">2、选择自己想要添加的依赖，比如：</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f8955973fdc349b982ecbc7c4948eb76~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm66K-t6KiA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764325278&amp;x-signature=%2FoCytKHpF6urb7zpj4Ft6FaWcUg%3D" alt="" loading="lazy"/><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<h3 data-id="heading-13">3、点击创建后，添加为maven项目</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a49e3ee3b56b45d8bf07dabc8b20ad2c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm66K-t6KiA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764325278&amp;x-signature=e2e30OGnAUBsl21%2BVPf3OB9LpWs%3D" alt="" loading="lazy"/><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<h3 data-id="heading-14">4、依赖更新完成后，可以点击运行</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/acf4809be26748db962ad6466ea43034~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm66K-t6KiA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764325278&amp;x-signature=raMa%2BaH9qq274M96GPBdRMPp9Ys%3D" alt="" loading="lazy"/><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<h3 data-id="heading-15">5、创建第一个controller</h3>
<p>在com.lingyi.springboot_demo包下创建controller包，再创建如下java类</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">package</span> com.lingyi.springboot_demo.controller;

<span class="hljs-keyword">import</span> org.springframework.web.bind.<span class="hljs-keyword">annotation</span>.GetMapping;
<span class="hljs-keyword">import</span> org.springframework.web.bind.<span class="hljs-keyword">annotation</span>.RestController;
<span class="hljs-keyword">import</span> java.time.LocalDateTime;

<span class="hljs-meta">@RestController</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HelloController</span> {

    <span class="hljs-comment">/**
     * 基础Hello World接口
     * <span class="hljs-doctag">@return</span> 欢迎信息
     */</span>
    <span class="hljs-meta">@GetMapping(<span class="hljs-string">"/hello"</span>)</span>
    <span class="hljs-keyword">public</span> String sayHello() {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"Hello World! 当前时间："</span> + LocalDateTime.now();
    }
}
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<h3 data-id="heading-16">6、重新启动服务</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/efea655a8bac4b8f941e97acce75582c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm66K-t6KiA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764325278&amp;x-signature=n9TBw1JPnggqCwykQKKim%2BuY3MI%3D" alt="" loading="lazy"/><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<h3 data-id="heading-17">7、测试</h3>
<p>打开浏览器访问地址</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9006f51476624eeda4d0e0ae55d43ed3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm66K-t6KiA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764325278&amp;x-signature=ytr6vbsc5xA5vQ7Y6e09oQorv3w%3D" alt="" loading="lazy"/><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<p>​</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[uni-app D4 实战（小兔鲜）]]></title>    <link>https://juejin.cn/post/7574817463449223219</link>    <guid>https://juejin.cn/post/7574817463449223219</guid>    <pubDate>2025-11-21T09:55:02.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574817463449223219" data-draft-id="7574991051434901514" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="uni-app D4 实战（小兔鲜）"/> <meta itemprop="keywords" content="架构,Vue.js,前端"/> <meta itemprop="datePublished" content="2025-11-21T09:55:02.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="爱泡脚的鸡腿"/> <meta itemprop="url" content="https://juejin.cn/user/4466663535419179"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            uni-app D4 实战（小兔鲜）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4466663535419179/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    爱泡脚的鸡腿
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T09:55:02.000Z" title="Fri Nov 21 2025 09:55:02 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1. 首页-封装通用轮播组件提高复用</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/336329f9e365420e829cdb35963efd1f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5rOh6ISa55qE6bih6IW_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764323959&amp;x-signature=TqJSGRK%2B6H5Xw7MpH2xVFRFS8J8%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-1">1.1 轮播图的静态结构（直接复制就好）</h3>
<pre><code class="hljs language-ts" lang="ts">&lt;script setup lang=<span class="hljs-string">"ts"</span>&gt;
<span class="hljs-keyword">import</span> { ref } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">const</span> activeIndex = <span class="hljs-title function_">ref</span>(<span class="hljs-number">0</span>)
&lt;/script&gt;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"carousel"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">swiper</span> <span class="hljs-attr">:circular</span>=<span class="hljs-string">"true"</span> <span class="hljs-attr">:autoplay</span>=<span class="hljs-string">"false"</span> <span class="hljs-attr">:interval</span>=<span class="hljs-string">"3000"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">swiper-item</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">navigator</span> <span class="hljs-attr">url</span>=<span class="hljs-string">"/pages/index/index"</span> <span class="hljs-attr">hover-class</span>=<span class="hljs-string">"none"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"navigator"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">image</span>
            <span class="hljs-attr">mode</span>=<span class="hljs-string">"aspectFill"</span>
            <span class="hljs-attr">class</span>=<span class="hljs-string">"image"</span>
            <span class="hljs-attr">src</span>=<span class="hljs-string">"https://pcapi-xiaotuxian-front-devtest.itheima.net/miniapp/uploads/slider_1.jpg"</span>
          &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">image</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">navigator</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">swiper-item</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">swiper-item</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">navigator</span> <span class="hljs-attr">url</span>=<span class="hljs-string">"/pages/index/index"</span> <span class="hljs-attr">hover-class</span>=<span class="hljs-string">"none"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"navigator"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">image</span>
            <span class="hljs-attr">mode</span>=<span class="hljs-string">"aspectFill"</span>
            <span class="hljs-attr">class</span>=<span class="hljs-string">"image"</span>
            <span class="hljs-attr">src</span>=<span class="hljs-string">"https://pcapi-xiaotuxian-front-devtest.itheima.net/miniapp/uploads/slider_2.jpg"</span>
          &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">image</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">navigator</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">swiper-item</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">swiper-item</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">navigator</span> <span class="hljs-attr">url</span>=<span class="hljs-string">"/pages/index/index"</span> <span class="hljs-attr">hover-class</span>=<span class="hljs-string">"none"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"navigator"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">image</span>
            <span class="hljs-attr">mode</span>=<span class="hljs-string">"aspectFill"</span>
            <span class="hljs-attr">class</span>=<span class="hljs-string">"image"</span>
            <span class="hljs-attr">src</span>=<span class="hljs-string">"https://pcapi-xiaotuxian-front-devtest.itheima.net/miniapp/uploads/slider_3.jpg"</span>
          &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">image</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">navigator</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">swiper-item</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">swiper</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 指示点 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"indicator"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">text</span>
        <span class="hljs-attr">v-for</span>=<span class="hljs-string">"(item, index) in 3"</span>
        <span class="hljs-attr">:key</span>=<span class="hljs-string">"item"</span>
        <span class="hljs-attr">class</span>=<span class="hljs-string">"dot"</span>
        <span class="hljs-attr">:class</span>=<span class="hljs-string">"{ active: index === activeIndex }"</span>
      &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">text</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></span>

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"scss"</span>&gt;</span><span class="css">
<span class="hljs-comment">/* 轮播图 */</span>
<span class="hljs-selector-class">.carousel</span> {
  <span class="hljs-attribute">height</span>: <span class="hljs-number">280</span>rpx;
  <span class="hljs-attribute">position</span>: relative;
  <span class="hljs-attribute">overflow</span>: hidden;
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateY</span>(<span class="hljs-number">0</span>);
  <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#efefef</span>;
  <span class="hljs-selector-class">.indicator</span> {
    <span class="hljs-attribute">position</span>: absolute;
    <span class="hljs-attribute">left</span>: <span class="hljs-number">0</span>;
    <span class="hljs-attribute">right</span>: <span class="hljs-number">0</span>;
    <span class="hljs-attribute">bottom</span>: <span class="hljs-number">16</span>rpx;
    <span class="hljs-attribute">display</span>: flex;
    <span class="hljs-attribute">justify-content</span>: center;
    <span class="hljs-selector-class">.dot</span> {
      <span class="hljs-attribute">width</span>: <span class="hljs-number">30</span>rpx;
      <span class="hljs-attribute">height</span>: <span class="hljs-number">6</span>rpx;
      <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> <span class="hljs-number">8</span>rpx;
      <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">6</span>rpx;
      <span class="hljs-attribute">background-color</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0.4</span>);
    }
    <span class="hljs-selector-class">.active</span> {
      <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#fff</span>;
    }
  }
  <span class="hljs-selector-class">.navigator</span>,
  <span class="hljs-selector-class">.image</span> {
    <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
    <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
  }
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span></span>
</code></pre>
<h3 data-id="heading-2">1.2 修改一下组件引入规则（pages.json）</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/884c653aa36a48f489b66aa57abc75f9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5rOh6ISa55qE6bih6IW_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764323959&amp;x-signature=oaiAXIKp2S1oeu5d2WSj0P02BSk%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-3">1.2.1 添加组件类型声明</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7a96f70735754d53b2a74e33f391edb0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5rOh6ISa55qE6bih6IW_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764323959&amp;x-signature=3FfWs3Sfy4UZWibiH0KAK%2BOd9bM%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/57857eda5afc44cf93f8da0bf2af029e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5rOh6ISa55qE6bih6IW_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764323959&amp;x-signature=T1ywLdkku8GxJ7AgjINKQ1I%2B5IM%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-4">1.3 轮播图的dots实现动态</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9636c18f2c5c444e9c434a2f7cf93ab5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5rOh6ISa55qE6bih6IW_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764323959&amp;x-signature=L61QzYcsDVHU1YN00RDUPhF2UVw%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6fc8585d7f0b4188a8cbc0d0cf3fbb28~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5rOh6ISa55qE6bih6IW_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764323959&amp;x-signature=5%2FExRwflkvuw2K7t5TbJi34Vt9M%3D" alt="image.png" loading="lazy"/>
结果：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5522ac398f8f43edb91bffb824425f2c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5rOh6ISa55qE6bih6IW_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764323959&amp;x-signature=sCzLe4KWu0GXybvmREkupSWBoYk%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eb8801cc2c1e48fb927cb61870df4cea~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5rOh6ISa55qE6bih6IW_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764323959&amp;x-signature=bhDtkm%2F0g1NFLL%2BCxQIqeerBor0%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5e988a2e80c84f789427dc3f7590690c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5rOh6ISa55qE6bih6IW_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764323959&amp;x-signature=kOWNlOE87ZnGsRINpWCUzwMEv44%3D" alt="image.png" loading="lazy"/>
**本次练习重点知识点：
**
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d329a704c0034e80a42204caa9f1bf71~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5rOh6ISa55qE6bih6IW_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764323959&amp;x-signature=%2F4Z4RMv4awBZIhoB92166lFflV4%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-5">1.4 首页-获取轮播图数据</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b8f54223302449ed9d4edb2b463a6d17~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5rOh6ISa55qE6bih6IW_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764323959&amp;x-signature=E2gn9CNNV%2FMV2WY1WOQMdFvcDSg%3D" alt="image.png" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[钉钉小程序直传文件到 阿里云OSS]]></title>    <link>https://juejin.cn/post/7574749664493289506</link>    <guid>https://juejin.cn/post/7574749664493289506</guid>    <pubDate>2025-11-21T10:13:08.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574749664493289506" data-draft-id="7574978847151308840" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="钉钉小程序直传文件到 阿里云OSS"/> <meta itemprop="keywords" content="前端,uni-app,Vue.js"/> <meta itemprop="datePublished" content="2025-11-21T10:13:08.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="广白"/> <meta itemprop="url" content="https://juejin.cn/user/231309974726702"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            钉钉小程序直传文件到 阿里云OSS
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/231309974726702/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    广白
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T10:13:08.000Z" title="Fri Nov 21 2025 10:13:08 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="" data-highlight-key="tomorrow">.hljs-comment,.hljs-quote{color:#8e908c}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#c82829}.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#f5871f}.hljs-attribute{color:#eab700}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:#718c00}.hljs-section,.hljs-title{color:#4271ae}.hljs-keyword,.hljs-selector-tag{color:#8959a8}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#fff;color:#4d4d4c}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>举个🌰，用钉钉小程序将一段视频在 前端 直接传到阿里云上。</p>
<p>由于 <code>js-base64</code> 这个npm包在钉钉小程序使用不了，而目前钉钉小程序又没有base64ToArrayBuffer这类方法，故只能曲线救国，使用 <code>dd.writeFile</code>和 <code>dd.readFile</code>来做<code>base64</code>的转换。</p>
<p>首先，我们得先处理OSS配置，具体如下：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> crypto <span class="hljs-keyword">from</span> <span class="hljs-string">"crypto-js"</span>

<span class="hljs-keyword">const</span> <span class="hljs-title class_">OSSConfig</span> = {
  <span class="hljs-title class_">AccessKeyId</span>: <span class="hljs-string">"xxxx"</span>,
  <span class="hljs-title class_">AccessKeySecret</span>: <span class="hljs-string">"xxxxxx"</span>,
  <span class="hljs-title class_">Host</span>: <span class="hljs-string">"xxxxx"</span>, <span class="hljs-comment">// 具体某个账号下,</span>
  <span class="hljs-title class_">SecurityToken</span>: <span class="hljs-string">"xx"</span>, <span class="hljs-comment">// 可选，使用STS签名时必传。</span>
}

<span class="hljs-comment">// 计算签名。</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">computeSignature</span> = (<span class="hljs-params">accessKeySecret, canonicalString</span>) =&gt; {
  <span class="hljs-keyword">return</span> crypto.<span class="hljs-property">enc</span>.<span class="hljs-property">Base64</span>.<span class="hljs-title function_">stringify</span>(
    crypto.<span class="hljs-title class_">HmacSHA1</span>(canonicalString, accessKeySecret)
  )
}

<span class="hljs-keyword">let</span> ossData = <span class="hljs-literal">null</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">getOssConfig</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">const</span> date = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>()
  date.<span class="hljs-title function_">setHours</span>(date.<span class="hljs-title function_">getHours</span>() + <span class="hljs-number">24</span>) <span class="hljs-comment">//加 1个小时</span>
  <span class="hljs-keyword">const</span> policyText = {
    <span class="hljs-attr">expiration</span>: date.<span class="hljs-title function_">toISOString</span>(), <span class="hljs-comment">// 设置policy过期时间。</span>
    <span class="hljs-attr">conditions</span>: [
      <span class="hljs-comment">// 限制上传大小。</span>
      [<span class="hljs-string">"content-length-range"</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>],
    ],
  }
  <span class="hljs-keyword">let</span> fileManager = dd.<span class="hljs-title function_">getFileSystemManager</span>()
  fileManager.<span class="hljs-title function_">writeFile</span>({
    <span class="hljs-attr">filePath</span>: <span class="hljs-string">`<span class="hljs-subst">${dd.env.USER_DATA_PATH}</span>/test.txt`</span>,
    <span class="hljs-attr">data</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(policyText),
    <span class="hljs-attr">success</span>: <span class="hljs-function">() =&gt;</span> {
      fileManager.<span class="hljs-title function_">readFile</span>({
        <span class="hljs-attr">filePath</span>: <span class="hljs-string">`<span class="hljs-subst">${dd.env.USER_DATA_PATH}</span>/test.txt`</span>,
        <span class="hljs-attr">encoding</span>: <span class="hljs-string">"base64"</span>,
        <span class="hljs-attr">success</span>: <span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> {
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(res.<span class="hljs-property">data</span>, <span class="hljs-string">"readFile"</span>)
          <span class="hljs-keyword">const</span> signature = <span class="hljs-title function_">computeSignature</span>(
            <span class="hljs-title class_">OSSConfig</span>.<span class="hljs-property">AccessKeySecret</span>,
            res.<span class="hljs-property">data</span>
          )
          ossData = {
            <span class="hljs-title class_">OSSAccessKeyId</span>: <span class="hljs-title class_">OSSConfig</span>.<span class="hljs-property">AccessKeyId</span>,
            signature,
            <span class="hljs-attr">policy</span>: res.<span class="hljs-property">data</span>,
            <span class="hljs-comment">// "x-oss-security-token": OSSConfig.SecurityToken,</span>
          }
        },
        <span class="hljs-attr">fail</span>: <span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> {
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(err)
        },
      })
    },
    <span class="hljs-attr">fail</span>: <span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(err)
    },
  })
}
</code></pre>
<p>这个ossData就是我们处理好后的配置项，接下来将其填充到 <code>dd.uploadFile</code> 里就大功告成了！</p>
<pre><code class="hljs language-js" lang="js">dd.<span class="hljs-title function_">chooseVideo</span>({
        <span class="hljs-attr">sourceType</span>: [<span class="hljs-string">"album"</span>, <span class="hljs-string">"camera"</span>],
        <span class="hljs-attr">maxDuration</span>: <span class="hljs-number">60</span>,
        <span class="hljs-attr">success</span>: <span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> {
          <span class="hljs-keyword">let</span> uniqueId = <span class="hljs-string">`<span class="hljs-subst">${dirPath}</span>xcx-<span class="hljs-subst">${<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>().getTime()}</span>.mp4`</span> <span class="hljs-comment">// dirPath为存储的文件夹路径， 比如"dev/front-end/video/"</span>
          uni.<span class="hljs-title function_">showLoading</span>({
            <span class="hljs-attr">title</span>: <span class="hljs-string">"视频上传中..."</span>,
          })
          dd.<span class="hljs-title function_">uploadFile</span>({
            <span class="hljs-attr">url</span>: <span class="hljs-title class_">OSSConfig</span>.<span class="hljs-property">Host</span>,
            <span class="hljs-attr">fileType</span>: <span class="hljs-string">"video"</span>,
            <span class="hljs-attr">fileName</span>: <span class="hljs-string">"file"</span>,
            <span class="hljs-attr">formData</span>: {
              ...ossData, <span class="hljs-comment">// 上述getOssConfig方法得到的结果</span>
              <span class="hljs-attr">key</span>: uniqueId, <span class="hljs-comment">// 该值为你存在在oss上的位置  后面上传成功之后拼接得到链接需要使用</span>
              <span class="hljs-attr">success_action_status</span>: <span class="hljs-string">"200"</span>, <span class="hljs-comment">// 默认上传成功状态码为204，此处被success_action_status设置为200。</span>
            },
            <span class="hljs-attr">filePath</span>: res.<span class="hljs-property">tempFilePath</span>,
            <span class="hljs-attr">success</span>: <span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> {
              uni.<span class="hljs-title function_">hideLoading</span>()
              <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"视频上传成功,地址为："</span>,<span class="hljs-string">`<span class="hljs-subst">${OSSConfig.Host}</span>/<span class="hljs-subst">${uniqueId}</span>`</span>)
            },
            <span class="hljs-attr">fail</span>: <span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> {
              uni.<span class="hljs-title function_">hideLoading</span>()
            },
          })
        },
        <span class="hljs-attr">fail</span>: <span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> {
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(err)
        },
      })
</code></pre>
<p><br/><br/>
<strong>欢迎小伙伴留言讨论，互相学习！</strong></p>
<p><strong>❤❤❤ 如果对你有帮助，记得点赞收藏哦！❤❤❤</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[iFlyCode+SpecKit应用：照片等比智能压缩功能实现]]></title>    <link>https://juejin.cn/post/7574992086715088911</link>    <guid>https://juejin.cn/post/7574992086715088911</guid>    <pubDate>2025-11-21T09:58:38.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574992086715088911" data-draft-id="7574749664493109282" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="iFlyCode+SpecKit应用：照片等比智能压缩功能实现"/> <meta itemprop="keywords" content="前端,JavaScript"/> <meta itemprop="datePublished" content="2025-11-21T09:58:38.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="星火飞码iFlyCode"/> <meta itemprop="url" content="https://juejin.cn/user/4378703548127657"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            iFlyCode+SpecKit应用：照片等比智能压缩功能实现
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4378703548127657/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    星火飞码iFlyCode
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T09:58:38.000Z" title="Fri Nov 21 2025 09:58:38 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong>iFlyCode+SpecKit</strong></p>
<p><strong>项目背景</strong></p>
<p>**需求来源：**业务上需要上传考生相片，支持历年存储，预期每年新增20w+，上传质量大小不一，除了大小判断外，需要对相片超过配置阈值（默认300KB）的照片进行智能压缩，还不能影响显示效果，同时考虑压缩性能，否则前端返回时间比较久，用户等待时间长。</p>
<p><strong>核心特性</strong></p>
<ul>
<li>
<p>✅ <strong>可配置阈值</strong>: 通过系统配置 <code>KsXpCompressSize</code> 动态调整压缩阈值</p>
</li>
<li>
<p>✅ <strong>智能压缩</strong>: 质量递减压缩 + 尺寸缩放双重策略</p>
</li>
<li>
<p>✅ <strong>大图优化</strong>: 超大图片预缩放，显著降低内存占用</p>
</li>
<li>
<p>✅ <strong>透明通道支持</strong>: 智能识别图片类型，支持PNG/GIF透明背景</p>
</li>
<li>
<p>✅ <strong>三重清理机制</strong>: 正常清理 + 异常清理 + JVM退出清理</p>
</li>
<li>
<p>✅ <strong>详细日志</strong>: 完整的压缩过程日志记录</p>
</li>
</ul>
<p><strong>提问过程</strong></p>
<p>将上述需求描述提交给iFlyCode，使用项目环境和设计智能体。<br/>
（执行片段如下图：）</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/869096c39443422ba5c1751f9f26cbbb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pif54Gr6aOe56CBaUZseUNvZGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764323917&amp;x-signature=i7TBF4quaK239IEvTkoiNd70GXM%3D" alt="" loading="lazy"/></p>
<p><strong>技术架构</strong></p>
<h3 data-id="heading-0">压缩流程图</h3>
<h3 data-id="heading-1">核心方法调用链</h3>
<blockquote>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">readXpFile</span>()    ├─ 判断文件大小 &gt; KsXpCompressSize    ├─ <span class="hljs-built_in">compressImage</span>()    │   ├─ 读取原始图片    │   ├─ 大图片检测与预缩放    │   │   ├─ 计算缩放比例    │   │   ├─ <span class="hljs-built_in">resizeImage</span>() - 预缩放    │   │   └─ 释放原图内存    │   ├─ 质量压缩循环    │   │   └─ <span class="hljs-built_in">compressImageWithQuality</span>()    │   ├─ 尺寸缩放备选    │   │   └─ <span class="hljs-built_in">resizeImage</span>()    │   └─ 返回压缩文件    ├─ fileHandler<span class="hljs-selector-class">.uploadFile</span>()    └─ 清理临时文件
</code></pre>
</blockquote>
<p><strong>核心代码实现</strong></p>
<h3 data-id="heading-2">1. 主压缩逻辑（readXpFile方法集成）</h3>
<p><strong>位置</strong>: <code>BkKsxpServiceImpl.java</code> 第822-849行</p>
<ul>
<li/>
</ul>
<h3 data-id="heading-3">2. 智能压缩方法（compressImage）</h3>
<p><strong>位置</strong>: <code>BkKsxpServiceImpl.java</code> 第1960-2090行</p>
<p><strong>核心特性</strong>:</p>
<ul>
<li>
<p>大图片预缩放优化（&gt;2MB或&gt;2000px）</p>
</li>
<li>
<p><strong>二分查找压缩算法</strong></p>
<p>（压缩次数减少50%）</p>
</li>
<li>
<p>尺寸缩放备选方案（80%）</p>
</li>
<li>
<p>完整的内存管理</p>
</li>
<li>
<p>三重临时文件清理</p>
</li>
<li/>
<li/>
</ul>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">3.</span> 质量压缩方法（compressImageWithQuality）
</code></pre>
<p><strong>位置</strong>: <code>BkKsxpServiceImpl.java</code> 第2096-2116行</p>
<pre><code class="hljs language-java" lang="java">privatevoidcompressImageWithQuality(BufferedImage image, File outputFile, <span class="hljs-type">float</span> quality) <span class="hljs-keyword">throws</span> IOException {    javax.imageio.<span class="hljs-type">ImageWriter</span> <span class="hljs-variable">writer</span> <span class="hljs-operator">=</span> ImageIO.getImageWritersByFormatName(<span class="hljs-string">"jpg"</span>).next();    javax.imageio.<span class="hljs-type">ImageWriteParam</span> <span class="hljs-variable">param</span> <span class="hljs-operator">=</span> writer.getDefaultWriteParam();        <span class="hljs-keyword">if</span> (param.canWriteCompressed()) {        param.setCompressionMode(javax.imageio.ImageWriteParam.MODE_EXPLICIT);        param.setCompressionQuality(quality);    }        <span class="hljs-keyword">try</span> (<span class="hljs-type">FileOutputStream</span> <span class="hljs-variable">fos</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(outputFile);         javax.imageio.stream.<span class="hljs-type">ImageOutputStream</span> <span class="hljs-variable">ios</span> <span class="hljs-operator">=</span> ImageIO.createImageOutputStream(fos)) {        writer.setOutput(ios);        writer.write(<span class="hljs-literal">null</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">javax</span>.imageio.IIOImage(image, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>), param);    } <span class="hljs-keyword">finally</span> {        writer.dispose();    }}
</code></pre>
<h3 data-id="heading-4">4. 尺寸缩放方法（resizeImage）</h3>
<p><strong>位置</strong>: <code>BkKsxpServiceImpl.java</code> 第2118-2141行</p>
<p><strong>特性</strong>: 支持透明通道（ARGB）</p>
<pre><code class="hljs language-perl" lang="perl">private BufferedImage resizeImage(BufferedImage originalImage, <span class="hljs-keyword">int</span> targetWidth, <span class="hljs-keyword">int</span> targetHeight){    <span class="hljs-regexp">//</span> 保持原图的图片类型，支持透明通道    <span class="hljs-keyword">int</span> imageType = originalImage.getType();    <span class="hljs-keyword">if</span> (imageType == <span class="hljs-number">0</span>) {        imageType = originalImage.getTransparency() == BufferedImage.OPAQUE            ? BufferedImage.TYPE_INT_RGB            : BufferedImage.TYPE_INT_ARGB;    }        BufferedImage resizedImage = new BufferedImage(targetWidth, targetHeight, imageType);    Graphics2D graphics = resizedImage.createGraphics();        <span class="hljs-regexp">//</span> 设置高质量渲染    graphics.setRenderingHint(RenderingHints.KEY_INTERPOLATION, RenderingHints.VALUE_INTERPOLATION_BILINEAR);    graphics.setRenderingHint(RenderingHints.KEY_RENDERING, RenderingHints.VALUE_RENDER_QUALITY);    graphics.setRenderingHint(RenderingHints.KEY_ANTIALIASING, RenderingHints.VALUE_ANTIALIAS_ON);        graphics.drawImage(originalImage, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, targetWidth, targetHeight, null);    graphics.dispose();        <span class="hljs-keyword">return</span> resizedImage;}
</code></pre>
<p><strong>配置说明</strong></p>
<h3 data-id="heading-5">系统配置参数</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/80ab9ee4a6d6490ea55fc891f8a30cd9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pif54Gr6aOe56CBaUZseUNvZGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764323917&amp;x-signature=HO1VeEPrs9nzuhCaGJmt356R3OY%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-6">配置方法</h3>
<h4 data-id="heading-7">方法1: 数据库配置（推荐）</h4>
<pre><code class="hljs language-java" lang="java">-- 插入配置（如果不存在）INSERT INTO <span class="hljs-title function_">basis_syscfg</span><span class="hljs-params">(syscfg_key, syscfg_value, syscfg_desc)</span>VALUES(<span class="hljs-string">'KsXpCompressSize'</span>, <span class="hljs-string">'300'</span>, <span class="hljs-string">'照片压缩阈值（KB）'</span>);-- 更新配置UPDATE basis_syscfg <span class="hljs-type">SET</span> <span class="hljs-variable">syscfg_value</span> <span class="hljs-operator">=</span> <span class="hljs-string">'500'</span><span class="hljs-type">WHERE</span> <span class="hljs-variable">syscfg_key</span> <span class="hljs-operator">=</span> <span class="hljs-string">'KsXpCompressSize'</span>;
</code></pre>
<h4 data-id="heading-8">方法2: 系统管理界面</h4>
<ol>
<li>
<p>登录系统管理后台</p>
</li>
<li>
<p>进入"系统配置"模块</p>
</li>
<li>
<p>查找或添加 <code>KsXpCompressSize</code> 配置项</p>
</li>
<li>
<p>设置期望的阈值（单位：KB）</p>
</li>
<li>
<p>保存配置</p>
</li>
</ol>
<p><strong>性能优化详解</strong></p>
<h3 data-id="heading-9">1. 大图片预缩放策略</h3>
<h4 data-id="heading-10">优化前后对比</h4>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a21d91ef3a0243a18fc21535412ed753~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pif54Gr6aOe56CBaUZseUNvZGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764323917&amp;x-signature=CI0j11Oi56K5ES1VyjHHHRHFGyc%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-11">预缩放触发条件</h4>
<pre><code class="hljs language-ruby" lang="ruby">finallong <span class="hljs-variable constant_">LARGE_FILE_THRESHOLD</span> = <span class="hljs-number">2</span> * <span class="hljs-number">1024</span> * 1024L; <span class="hljs-regexp">//</span> 2MBfinalint <span class="hljs-variable constant_">LARGE_DIMENSION_THRESHOLD</span> = <span class="hljs-number">2000</span>; <span class="hljs-regexp">//</span> <span class="hljs-number">2000</span>像素/<span class="hljs-regexp">/ 满足以下任一条件触发预缩放：/</span><span class="hljs-regexp">/ 1. 文件大小 &gt; 2MB/</span><span class="hljs-regexp">/ 2. 宽度 &gt; 2000px/</span><span class="hljs-regexp">/ 3. 高度 &gt; 2000px
</span></code></pre>
<h4 data-id="heading-12">缩放比例计算</h4>
<pre><code class="hljs language-erlang" lang="erlang"><span class="hljs-function"><span class="hljs-title">printf</span><span class="hljs-params">(<span class="hljs-string">"hello world!"</span>)</span>;// 策略1: 尺寸超标 - 等比例缩放到2000<span class="hljs-title">px</span>以内<span class="hljs-title">if</span> <span class="hljs-params">(width &gt; <span class="hljs-number">2000</span> || height &gt; <span class="hljs-number">2000</span>)</span> {    <span class="hljs-title">scaleFactor</span> = <span class="hljs-title">min</span><span class="hljs-params">(<span class="hljs-number">2000</span>/width, <span class="hljs-number">2000</span>/height)</span>;}// 策略2: 文件超大但尺寸正常 - 缩小到70%<span class="hljs-title">if</span> <span class="hljs-params">(fileSize &gt; <span class="hljs-number">2</span>MB &amp;&amp; scaleFactor == <span class="hljs-number">1.0</span>)</span> {    <span class="hljs-title">scaleFactor</span> = 0.7;}
</span></code></pre>
<h3 data-id="heading-13">2. 内存管理优化</h3>
<h4 data-id="heading-14">内存释放时机</h4>
<h4 data-id="heading-15">代码示例</h4>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">//</span> <span class="hljs-number">1</span><span class="hljs-string">.</span> <span class="hljs-string">预缩放后释放原图workingImage</span> <span class="hljs-string">=</span> <span class="hljs-string">resizeImage(originalImage,</span> <span class="hljs-string">preScaledWidth,</span> <span class="hljs-string">preScaledHeight);originalImage.flush();</span>  <span class="hljs-string">//</span> <span class="hljs-string">立即释放originalImage</span> <span class="hljs-string">=</span> <span class="hljs-literal">null</span><span class="hljs-string">;//</span> <span class="hljs-number">2</span><span class="hljs-string">.</span> <span class="hljs-string">压缩完成后释放工作图workingImage.flush();workingImage</span> <span class="hljs-string">=</span> <span class="hljs-literal">null</span><span class="hljs-string">;//</span> <span class="hljs-number">3</span><span class="hljs-string">.</span> <span class="hljs-string">finally块确保释放finally</span> {    <span class="hljs-string">if</span> <span class="hljs-string">(workingImage</span> <span class="hljs-type">!=</span> <span class="hljs-literal">null</span><span class="hljs-string">)</span> {        <span class="hljs-string">workingImage.flush();</span>    }}
</code></pre>
<h3 data-id="heading-16">3. 临时文件清理机制</h3>
<h4 data-id="heading-17">三重保障</h4>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9c435e0d197242e8ae59f6f5aee7f4bb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pif54Gr6aOe56CBaUZseUNvZGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764323917&amp;x-signature=VSEWHAPscK4xgYwoeQS0cZNfiso%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-18">清理代码</h4>
<pre><code class="hljs language-vbnet" lang="vbnet">// <span class="hljs-number">1</span>. 创建时设置自动清理compressedFile = File.createTempFile(<span class="hljs-string">"compressed_"</span>, <span class="hljs-string">".jpg"</span>);compressedFile.deleteOnExit();  // JVM退出时自动删除// <span class="hljs-number">2</span>. 正常使用后清理<span class="hljs-keyword">if</span> (fileToUpload != readFile &amp;&amp; fileToUpload.exists()) {    fileToUpload.delete();}// <span class="hljs-number">3</span>. 异常情况清理<span class="hljs-keyword">catch</span> (Exception e) {    <span class="hljs-keyword">if</span> (compressedFile != null &amp;&amp; compressedFile.exists()) {        <span class="hljs-keyword">try</span> {            compressedFile.delete();        } <span class="hljs-keyword">catch</span> (Exception deleteEx) {            SysLogUtils.printLogger(<span class="hljs-string">"删除临时文件失败"</span>);        }    }}
</code></pre>
<p><strong>单元测试</strong></p>
<h3 data-id="heading-19">测试场景</h3>
<h4 data-id="heading-20">1. 功能测试</h4>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/946aa40fea8c49db9eb787762c83c5b3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pif54Gr6aOe56CBaUZseUNvZGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764323917&amp;x-signature=844SPxRfc9itqJtGh4%2FAt0YkCzk%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-21">2. 性能测试</h4>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">测试场景1: 单张大图片- 文件: 4000x3000, 2MB- 预期: 内存占用 &lt; 20MB, 处理时间 &lt; 3秒<span class="hljs-comment"># 测试场景2: 批量上传- 文件: 100张混合大小照片- 预期: 无内存溢出, 总时间 &lt; 30秒# 测试场景3: 极限测试- 文件: 8000x6000, 10MB- 预期: 成功压缩, 无崩溃</span></span>
</code></pre>
<h4 data-id="heading-22">3. 边界测试</h4>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// 测试用例1. 损坏的图片文件 → 应返回null，使用原图2. 非JPG格式 → 应正常处理（PNG/GIF）3. 阈值为0 → 应使用默认值300KB4. 极小图片（10KB） → 不压缩5. 正方形图片 → 等比例缩放6. 极窄/极宽图片 → 正确计算缩放比例</span>
</code></pre>
<h3 data-id="heading-23">测试步骤</h3>
<h4 data-id="heading-24">准备工作</h4>
<pre><code class="hljs language-arduino" lang="arduino">-- <span class="hljs-number">1.</span> 配置压缩阈值<span class="hljs-function">INSERT INTO <span class="hljs-title">basis_syscfg</span><span class="hljs-params">(syscfg_key, syscfg_value, syscfg_desc)</span><span class="hljs-title">VALUES</span><span class="hljs-params">(<span class="hljs-string">'KsXpCompressSize'</span>, <span class="hljs-string">'300'</span>, <span class="hljs-string">'照片压缩阈值（KB）'</span>)</span></span>;
</code></pre>
<h4 data-id="heading-25">执行测试</h4>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">2. 准备测试照片- 小照片: 150KB (不压缩)- 中照片: 500KB (质量压缩)- 大照片: 2MB (预缩放+压缩)- PNG照片: 带透明背景<span class="hljs-comment"># 3. 批量上传测试- 打包成ZIP文件- 通过系统上传- 检查日志输出- 验证存储结果# 4. 验证结果- 检查照片大小是否符合阈值- 检查照片质量是否可接受- 检查透明通道是否保留- 检查临时文件是否清理</span></span>
</code></pre>
<p><strong>日志示例</strong></p>
<h3 data-id="heading-26">正常压缩日志</h3>
<pre><code class="hljs language-scss" lang="scss">照片 <span class="hljs-number">20240101001</span><span class="hljs-selector-class">.jpg</span> 从 <span class="hljs-number">450</span>KB 压缩到 <span class="hljs-number">280</span>KB (阈值: <span class="hljs-number">300</span>KB)
</code></pre>
<h3 data-id="heading-27">大图片预缩放日志</h3>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">大图片预缩放: IMG_4000x3000.jpg, 原尺寸: 4000x3000, 预缩放到: 2000x1500 (比例: 0.50)压缩成功: IMG_4000x3000.jpg, 质量: 0.7, 大小: 285KB</span>
</code></pre>
<h3 data-id="heading-28">尺寸缩放日志</h3>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">通过缩小尺寸压缩: large_photo.jpg, 新尺寸: 1600x1200, 大小: 295KB</span>
</code></pre>
<h3 data-id="heading-29">压缩失败日志</h3>
<pre><code class="hljs language-lua" lang="lua">压缩照片失败: corrupted.jpg, Cannot <span class="hljs-built_in">read</span> <span class="hljs-built_in">input</span> file!
</code></pre>
<p><strong>性能指标</strong></p>
<h3 data-id="heading-30">压缩效果统计</h3>
<h3 data-id="heading-31"/>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/efdea862258c435fa9203f935c53da6a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pif54Gr6aOe56CBaUZseUNvZGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764323917&amp;x-signature=RI8aYIgsWUpLIDUhu64nFqjxry0%3D" alt="" loading="lazy"/></p>
<p><strong>效果总结</strong></p>
<p>1、原计划3个工作日完成，使用iFlyCode，省去寻找方案的时间，1天左右完成，提效66%；<br/>
2、经过生产验证，该压缩方案成功率100%，效果符合预期，即300k以上相片压缩至300k内，不影响打印效果呈现，满足业务需求，后期可以将本方法抽象成为通用方法进行复用。</p>
<p>— END —</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【底层机制】Android图形渲染体系深度解析：VSync信号机制]]></title>    <link>https://juejin.cn/post/7574967214128365594</link>    <guid>https://juejin.cn/post/7574967214128365594</guid>    <pubDate>2025-11-21T10:26:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574967214128365594" data-draft-id="7574991051435130890" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【底层机制】Android图形渲染体系深度解析：VSync信号机制"/> <meta itemprop="keywords" content="Android,面试"/> <meta itemprop="datePublished" content="2025-11-21T10:26:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="沐怡旸"/> <meta itemprop="url" content="https://juejin.cn/user/2875978146656750"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【底层机制】Android图形渲染体系深度解析：VSync信号机制
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2875978146656750/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    沐怡旸
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T10:26:42.000Z" title="Fri Nov 21 2025 10:26:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在Android图形渲染体系中，VSync（Vertical Synchronization，垂直同步）是贯穿CPU、GPU与显示器协同工作的核心机制。它不仅解决了画面撕裂、卡顿等关键问题，更定义了Android渲染的"时间节拍"。本文将从底层原理、Android实现架构、关键细节到开发实践，系统拆解VSync信号机制的核心逻辑。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fc8f52138b3346d6b0e4c9c446905f2d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rKQ5oCh5pe4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764325602&amp;x-signature=IuI9nAthKoDx1mhs%2FWX8yyjnfIw%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<h2 data-id="heading-0">一、核心定义：什么是VSync信号？</h2>
<p>VSync信号本质是<strong>显示器硬件产生的周期性同步信号</strong>，其周期与显示器刷新率强相关（例如60Hz刷新率对应16.67ms/帧，90Hz对应11.11ms/帧）。</p>
<h3 data-id="heading-1">关键背景：显示器的工作原理</h3>
<p>现代显示器通常采用"逐行扫描"方式刷新画面：</p>
<ol>
<li><strong>有效扫描期</strong>：从屏幕左上角开始，逐行扫描至右下角，完成一帧画面的显示；</li>
<li><strong>垂直消隐期（VBlank Period）</strong>：一帧扫描结束后，电子束返回左上角准备下一次扫描的间隙，此时显示器暂不更新画面。</li>
</ol>
<p>VSync信号恰好产生于<strong>垂直消隐期的起始时刻</strong>——这个时间点是显示器"准备好接收新帧"的关键窗口期，也是CPU/GPU同步工作的基准时间点。</p>
<h2 data-id="heading-2">二、设计初衷：为什么需要VSync？</h2>
<p>没有VSync时，Android渲染存在两个致命问题，而VSync通过"强制同步"从根源上解决了这些问题。</p>
<h3 data-id="heading-3">1. 画面撕裂（Screen Tearing）</h3>
<ul>
<li><strong>问题本质</strong>：GPU渲染新帧的速度与显示器刷新速度不同步。当显示器还在扫描当前帧时，GPU已完成新帧渲染并写入帧缓冲区，导致显示器同时显示"上一帧下半部分"和"新帧上半部分"，形成撕裂线。</li>
<li><strong>VSync的解决逻辑</strong>：强制GPU只能在<strong>VSync信号触发后的垂直消隐期</strong>更新帧缓冲区。这样确保显示器在有效扫描期只读取完整的一帧数据。</li>
</ul>
<h3 data-id="heading-4">2. 帧数据浪费（Wasted Frames）</h3>
<ul>
<li><strong>问题本质</strong>：GPU渲染速度过快时，会在一个显示器周期内生成多帧数据，但显示器只能按自身节奏读取一帧，其余帧数据被覆盖丢弃，造成计算资源浪费。</li>
<li><strong>VSync的解决逻辑</strong>：通过信号同步GPU的渲染节奏，使其仅在每个VSync周期内执行一次完整的渲染提交流程，确保每帧渲染都有对应的显示时机。</li>
</ul>
<h3 data-id="heading-5">3. 双缓冲与VSync的协同</h3>
<p>双缓冲机制（Double Buffering）本身不能完全解决同步问题：</p>
<ul>
<li>若GPU在有效扫描期完成后台缓冲更新，缓冲切换仍可能导致撕裂；</li>
<li>双缓冲未定义"何时开始渲染"的基准，GPU可能在帧周期内任意时间启动工作。</li>
</ul>
<p>VSync为双缓冲机制增加了"时间基准"——只有在VSync信号到来时，才允许后台缓冲与前台缓冲交换，彻底解决同步问题。</p>
<h2 data-id="heading-6">三、底层原理：VSync的工作机制</h2>
<p>VSync的核心逻辑是"<strong>以显示器刷新率为基准，强制GPU的渲染节奏与显示器保持一致</strong>"，其完整工作流程可拆解为三个关键阶段：</p>
<h3 data-id="heading-7">1. VSync信号的产生与分发</h3>
<ul>
<li><strong>信号源</strong>：由显示器控制器硬件生成，周期固定为显示器刷新率的倒数；</li>
<li><strong>分发路径</strong>：硬件信号通过显示驱动（如DRM/KMS子系统）传递至SurfaceFlinger，再由SurfaceFlinger分发至应用进程。</li>
</ul>
<h3 data-id="heading-8">2. 渲染流程的同步控制</h3>
<p>以60Hz刷新率（16.67ms周期）为例：</p>
<ol>
<li><strong>T0时刻</strong>：VSync信号触发，垂直消隐期开始；</li>
<li><strong>应用工作阶段（T0-T1）</strong>：应用进程接收VSync信号，执行UI线程的Measure、Layout、Draw；</li>
<li><strong>RenderThread工作（T1-T2）</strong>：将绘制命令转换为GL命令，提交给GPU；</li>
<li><strong>GPU工作阶段（T2-T3）</strong>：GPU执行渲染，将最终帧写入缓冲区；</li>
<li><strong>缓冲区交换（下次VSync）</strong>：SurfaceFlinger在垂直消隐期执行缓冲区交换。</li>
</ol>
<p><strong>关键约束</strong>：应用测量布局+渲染+GPU处理的总耗时必须≤16.67ms（60Hz场景），否则会导致掉帧。</p>
<h3 data-id="heading-9">3. 三重缓冲（Triple Buffering）的优化</h3>
<p>当渲染耗时偶尔超过VSync周期时，双缓冲会导致严重卡顿，三重缓冲提供优化：</p>
<ul>
<li><strong>核心逻辑</strong>：增加一个额外的缓冲区。当应用准备好新帧但前缓冲区仍被占用时，新帧可写入第三个缓冲区；</li>
<li><strong>优势</strong>：避免应用因等待缓冲区而阻塞，保持渲染流水线的持续运转；</li>
<li><strong>代价</strong>：增加内存占用和潜在的显示延迟。</li>
</ul>
<h2 data-id="heading-10">四、Android中的实现架构</h2>
<p>Android将VSync机制深度集成到图形渲染栈中，形成"SurfaceFlinger + Choreographer + RenderThread"的协同架构。</p>
<h3 data-id="heading-11">1. 核心组件分工</h3>



































<table><thead><tr><th>组件</th><th>角色定位</th><th>核心职责</th></tr></thead><tbody><tr><td>显示器硬件</td><td>信号源</td><td>产生原始VSync信号</td></tr><tr><td>显示驱动</td><td>信号中转</td><td>接收硬件VSync，通过内核接口暴露</td></tr><tr><td>SurfaceFlinger</td><td>系统级同步中枢</td><td>管理VSync分发、缓冲区交换、图层合成</td></tr><tr><td>Choreographer</td><td>应用级同步代理</td><td>接收VSync信号，调度UI更新、动画、绘制</td></tr><tr><td>RenderThread</td><td>应用渲染线程</td><td>将View树转换为GL命令，管理GPU渲染</td></tr></tbody></table>
<h3 data-id="heading-12">2. VSync信号的传递链路</h3>
<pre><code class="hljs language-swift" lang="swift">显示器硬件 <span class="hljs-operator">→</span> 显示驱动 <span class="hljs-operator">→</span> <span class="hljs-type">SurfaceFlinger</span> <span class="hljs-operator">→</span> <span class="hljs-type">Binder</span> <span class="hljs-type">IPC</span> <span class="hljs-operator">→</span> <span class="hljs-type">Choreographer</span> <span class="hljs-operator">→</span> <span class="hljs-type">UI线程</span><span class="hljs-operator">/</span><span class="hljs-type">RenderThread</span>
</code></pre>
<p><strong>关键实现细节</strong>：</p>
<ul>
<li>SurfaceFlinger通过<code>EventThread</code>管理VSync分发；</li>
<li>Choreographer通过<code>FrameDisplayEventReceiver</code>接收VSync信号；</li>
<li>应用通过<code>Choreographer#postFrameCallback</code>注册渲染回调。</li>
</ul>
<h3 data-id="heading-13">3. 双VSync机制：APP与SF的分离</h3>
<p>Android引入双VSync设计，将应用渲染与系统合成解耦：</p>
<ul>
<li><strong>VSYNC_APP</strong>：触发应用进程的渲染工作；</li>
<li><strong>VSYNC_SF</strong>：触发SurfaceFlinger的图层合成工作。</li>
</ul>
<p><strong>设计价值</strong>：为SurfaceFlinger预留固定的合成时间，避免因应用渲染耗时接近周期上限而导致合成超时。</p>
<h2 data-id="heading-14">五、关键细节与进阶认知</h2>
<h3 data-id="heading-15">1. VSync周期的动态调整（可变刷新率）</h3>
<p>现代Android设备支持可变刷新率（Variable Refresh Rate）：</p>
<ul>
<li><strong>节能模式</strong>：静态内容时降低至30Hz、60Hz；</li>
<li><strong>流畅模式</strong>：滑动、游戏时提升至90Hz、120Hz；</li>
<li><strong>实现机制</strong>：通过显示驱动动态调整VSync信号周期。</li>
</ul>
<h3 data-id="heading-16">2. VSync偏移（VSync Offset）的精确控制</h3>
<p>VSync偏移优化应用渲染与系统合成的时间分配：</p>
<ul>
<li><strong>目标</strong>：确保应用渲染完成后，SurfaceFlinger有足够时间完成合成；</li>
<li><strong>计算依据</strong>：基于显示器的VBlank时长、合成耗时等因素动态调整。</li>
</ul>
<h3 data-id="heading-17">3. 离线渲染与VSync的协同</h3>
<p>当应用使用<code>SurfaceTexture</code>进行相机预览、视频播放时：</p>
<ul>
<li>生产者（Camera、MediaCodec）异步写入帧数据；</li>
<li>消费者（应用/SurfaceFlinger）在VSync时刻获取最新帧；</li>
<li>通过<code>FrameAvailableListener</code>实现生产-消费的同步。</li>
</ul>
<h2 data-id="heading-18">六、开发实践：基于VSync的优化技巧</h2>
<h3 data-id="heading-19">1. 使用Choreographer精准控制渲染时机</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyView</span> : <span class="hljs-type">View</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> choreographer = Choreographer.getInstance()
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> frameCallback = <span class="hljs-keyword">object</span> : Choreographer.FrameCallback {
        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">doFrame</span><span class="hljs-params">(frameTimeNanos: <span class="hljs-type">Long</span>)</span></span> {
            <span class="hljs-comment">// 基于VSync执行动画或渲染</span>
            updateAnimation(frameTimeNanos)
            invalidate()
            <span class="hljs-comment">// 注册下一帧回调</span>
            choreographer.postFrameCallback(<span class="hljs-keyword">this</span>)
        }
    }
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">startAnimation</span><span class="hljs-params">()</span></span> {
        choreographer.postFrameCallback(frameCallback)
    }
}
</code></pre>
<h3 data-id="heading-20">2. 监控和优化帧率</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 帧率监控实现</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">FrameRateMonitor</span> : <span class="hljs-type">Choreographer.FrameCallback</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> lastFrameTime = <span class="hljs-number">0L</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> frameIntervals = mutableListOf&lt;<span class="hljs-built_in">Long</span>&gt;()
    
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">doFrame</span><span class="hljs-params">(frameTimeNanos: <span class="hljs-type">Long</span>)</span></span> {
        <span class="hljs-keyword">if</span> (lastFrameTime &gt; <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">val</span> interval = (frameTimeNanos - lastFrameTime) / <span class="hljs-number">1_000_000</span> <span class="hljs-comment">// 转换为ms</span>
            frameIntervals.add(interval)
            <span class="hljs-comment">// 分析帧间隔，检测掉帧</span>
            <span class="hljs-keyword">if</span> (interval &gt; <span class="hljs-number">16.67</span>) { <span class="hljs-comment">// 60Hz标准周期</span>
                onFrameDropped(interval)
            }
        }
        lastFrameTime = frameTimeNanos
        Choreographer.getInstance().postFrameCallback(<span class="hljs-keyword">this</span>)
    }
}
</code></pre>
<h3 data-id="heading-21">3. 渲染性能优化策略</h3>
<ul>
<li><strong>UI线程优化</strong>：减少View层级，避免测量布局的重复计算</li>
<li><strong>渲染线程优化</strong>：控制Canvas操作复杂度，减少路径和阴影使用</li>
<li><strong>GPU优化</strong>：减少过度绘制，合理使用硬件层缓存</li>
</ul>
<h3 data-id="heading-22">4. 高级调试技巧</h3>
<p>使用系统工具深入分析VSync相关问题：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 查看VSync调试信息</span>
adb shell dumpsys SurfaceFlinger --vsync

<span class="hljs-comment"># 分析应用帧率统计  </span>
adb shell dumpsys gfxinfo &lt;package_name&gt; framestats
</code></pre>
<h2 data-id="heading-23">七、总结</h2>
<p>VSync信号机制为Android渲染建立了"显示器驱动"的时间同步基准。通过硬件信号触发、系统级分发、应用级响应的全链路设计，解决了画面撕裂、帧率不稳定等核心问题。</p>
<p>对于Android开发者，深入理解VSync机制能够：</p>
<ul>
<li>建立"帧级精度"的性能优化思维</li>
<li>准确诊断和解决卡顿、掉帧问题</li>
<li>设计出符合显示刷新特性的流畅动画</li>
<li>为高刷新率、可变刷新率等新技术做好准备</li>
</ul>
<p>随着120Hz+高刷新率显示器的普及和可变刷新率技术的成熟，VSync机制继续演进，但其"同步渲染节奏、保障画面完整性"的核心价值始终不变。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[文件下载：后端配置、前端方式与进度监控]]></title>    <link>https://juejin.cn/post/7574978545143840803</link>    <guid>https://juejin.cn/post/7574978545143840803</guid>    <pubDate>2025-11-21T09:05:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574978545143840803" data-draft-id="7574704948152516660" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="文件下载：后端配置、前端方式与进度监控"/> <meta itemprop="keywords" content="前端,JavaScript,浏览器"/> <meta itemprop="datePublished" content="2025-11-21T09:05:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="拉不动的猪"/> <meta itemprop="url" content="https://juejin.cn/user/1429793504759630"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            文件下载：后端配置、前端方式与进度监控
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1429793504759630/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    拉不动的猪
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T09:05:23.000Z" title="Fri Nov 21 2025 09:05:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="" data-highlight-key="an-old-hope">.hljs-comment,.hljs-quote{color:#b6b18b}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#eb3c54}.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#e7ce56}.hljs-attribute{color:#ee7c2b}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:#4fb4d7}.hljs-section,.hljs-title{color:#78bb65}.hljs-keyword,.hljs-selector-tag{color:#b45ea4}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#1c1d21;color:#c0c5ce}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">一、后端核心配置：决定下载的 “基础规则”</h3>
<p>后端通过 HTTP 响应头控制文件的传输行为，这是所有下载逻辑的起点，关键配置有 3 个：</p>
<h4 data-id="heading-1">1. <code>Content-Disposition</code>：控制 “下载” 或 “预览”</h4>
<ul>
<li>
<p><strong>配置 1（强制下载）</strong> ：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-attribute">Content</span>-Disposition: attachment; filename="file<span class="hljs-selector-class">.xlsx</span>"
</code></pre>
<ul>
<li>作用：告诉浏览器 “这是一个需要下载的附件”，无论文件类型是什么（图片 / PDF/Excel），都会直接触发下载弹窗。</li>
<li>细节：<code>filename</code> 指定默认下载文件名，支持 UTF-8 编码（需处理中文：<code>filename*=UTF-8''%E6%88%91%E7%9A%84%E6%96%87%E4%BB%B6.xlsx</code>）。</li>
</ul>
</li>
<li>
<p><strong>配置 2（在线预览）</strong> ：</p>
<pre><code class="hljs language-scala" lang="scala"><span class="hljs-type">Content</span>-<span class="hljs-type">Disposition</span>: <span class="hljs-keyword">inline</span>
</code></pre>
<ul>
<li>作用：告诉浏览器 “直接在页面内预览文件”，比如图片直接显示、PDF 在浏览器打开、TXT 直接渲染。</li>
<li>细节：若不设置该字段，浏览器会根据 <code>Content-Type</code> 自动判断（图片 / PDF 默认预览，Excel / 压缩包默认下载）。</li>
</ul>
</li>
</ul>
<h4 data-id="heading-2">2. <code>Content-Type</code>：定义文件的 “类型标识”</h4>
<ul>
<li>
<p>作用：告诉浏览器文件的 MIME 类型，决定浏览器如何解析文件（即使配置了 <code>attachment</code>，浏览器也会根据类型处理下载）。</p>
</li>
<li>
<p>常见配置：
# Excel 文件
Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet
# PDF 文件
Content-Type: application/pdf
# 图片
Content-Type: image/jpeg
# 二进制流（通用，推荐大文件）
Content-Type: application/octet-stream</p>
</li>
<li>
<p>关键：若后端返回 <code>application/octet-stream</code>（二进制流），浏览器会直接判定为 “可下载文件”，优先级高于 <code>inline</code>。</p>
</li>
</ul>
<h4 data-id="heading-3">3. <code>Content-Length</code>：提供文件的 “总大小”</h4>
<ul>
<li>
<p>配置：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">Content-Length:</span> <span class="hljs-number">10485760</span>  <span class="hljs-comment"># 表示文件大小为 10MB</span>
</code></pre>
</li>
<li>
<p>作用：告诉前端文件的总字节数，是前端计算下载进度的<strong>必要条件</strong>（没有这个头，前端无法知道 “总大小”，只能显示 “已下载字节”，无法算百分比）。</p>
</li>
<li>
<p>注意：若后端用 “分块传输”（<code>Transfer-Encoding: chunked</code>），则不会返回 <code>Content-Length</code>，前端无法计算进度。</p>
</li>
</ul>
<h4 data-id="heading-4">4. 其他辅助配置</h4>
<ul>
<li><code>Accept-Ranges: bytes</code>：支持断点续传，前端可请求文件的某一部分（<code>Range: bytes=0-1023</code>），适合大文件分段下载。</li>
<li><code>Access-Control-Expose-Headers: Content-Length</code>：跨域场景下，允许前端读取 <code>Content-Length</code> 等响应头（否则前端拿不到总大小）。</li>
</ul>
<h3 data-id="heading-5">二、前端下载方式：根据需求选择 “策略”</h3>
<p>前端有 3 种主流下载方式，对应不同场景，和后端配置直接关联：</p>
<h4 data-id="heading-6">方式 1：原生 <code>&lt;a&gt;</code> 标签（最简单，无进度）</h4>
<ul>
<li>
<p><strong>用法</strong>：</p>
<pre><code class="hljs language-ini" lang="ini">&lt;a <span class="hljs-attr">href</span>=<span class="hljs-string">"/api/download/file"</span> download=<span class="hljs-string">"自定义文件名.xlsx"</span>&gt;下载&lt;/a&gt;
</code></pre>
</li>
<li>
<p><strong>适用场景</strong>：后端已配置 <code>Content-Disposition: attachment</code>，且无需监控进度（小文件、对进度无要求）。</p>
</li>
<li>
<p><strong>和后端配置的关联</strong>：</p>
<ul>
<li>若后端配了 <code>attachment</code>：点击直接下载，<code>download</code> 属性可自定义文件名（优先级高于后端的 <code>filename</code>）。</li>
<li>若后端配了 <code>inline</code>：浏览器会预览文件，此时加 <code>download</code> 属性可强制触发下载（部分浏览器支持）。</li>
</ul>
</li>
<li>
<p><strong>局限性</strong>：无法监控进度、无法处理复杂逻辑（如权限验证、Token 携带）。</p>
</li>
</ul>
<h4 data-id="heading-7">方式 2：<code>window.open()</code>（和 <code>&lt;a&gt;</code> 标签类似）</h4>
<ul>
<li>
<p><strong>用法</strong>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">window</span>.<span class="hljs-title function_">open</span>(<span class="hljs-string">'/api/download/file?token=xxx'</span>);
</code></pre>
</li>
<li>
<p><strong>适用场景</strong>：需要携带参数（如 Token）的下载，或需要新开窗口处理。</p>
</li>
<li>
<p><strong>缺点</strong>：同样无法监控进度，且可能被浏览器拦截（弹窗拦截）。</p>
</li>
</ul>
<h4 data-id="heading-8">方式 3：AJAX/fetch + Blob（支持进度，最灵活）</h4>
<ul>
<li>
<p><strong>核心逻辑</strong>：前端主动请求文件二进制流，监控传输过程，最后模拟下载。</p>
</li>
<li>
<p><strong>和后端配置的关联</strong>：</p>
<ul>
<li>后端需返回二进制流（<code>Content-Type: application/octet-stream</code> 或对应文件类型）。</li>
<li>若后端配了 <code>Content-Length</code>，可计算精确进度；否则只能监控 “已下载字节”。</li>
</ul>
</li>
<li>
<p><strong>完整代码示例（带进度）</strong> ：</p>
<pre><code class="hljs language-ini" lang="ini">// 1. 创建请求对象
const <span class="hljs-attr">xhr</span> = new XMLHttpRequest()<span class="hljs-comment">;</span>
xhr.open('GET', '/api/download/large-file.zip', true)<span class="hljs-comment">;</span>
<span class="hljs-attr">xhr.responseType</span> = <span class="hljs-string">'blob'</span><span class="hljs-comment">; // 关键：以 Blob 接收响应</span>

// 2. 监控进度
xhr.addEventListener('progress', (e) =&gt; {
  if (e.lengthComputable) {
    const <span class="hljs-attr">progress</span> = (e.loaded / e.total) * <span class="hljs-number">100</span><span class="hljs-comment">; // 进度百分比</span>
    console.log(`下载进度：${progress.toFixed(2)}%`)<span class="hljs-comment">;</span>
    // 更新 UI：比如进度条宽度、文字提示
    document.getElementById('progress-bar').<span class="hljs-attr">style.width</span> = `<span class="hljs-variable">${progress}</span>%`<span class="hljs-comment">;</span>
  } else {
    console.log(`已下载：${e.loaded} 字节`)<span class="hljs-comment">; // 无总大小，只能显示已下载</span>
  }
})<span class="hljs-comment">;</span>

// 3. 请求成功：生成下载链接
xhr.addEventListener('load', () =&gt; {
  if (<span class="hljs-attr">xhr.status</span> === <span class="hljs-number">200</span>) {
    const <span class="hljs-attr">blob</span> = xhr.response<span class="hljs-comment">;</span>
    const <span class="hljs-attr">url</span> = URL.createObjectURL(blob)<span class="hljs-comment">;</span>
    const <span class="hljs-attr">a</span> = document.createElement(<span class="hljs-string">'a'</span>)<span class="hljs-comment">;</span>
    <span class="hljs-attr">a.href</span> = url<span class="hljs-comment">;</span>
    <span class="hljs-attr">a.download</span> = <span class="hljs-string">'大文件.zip'</span><span class="hljs-comment">; // 自定义文件名</span>
    a.click()<span class="hljs-comment">;</span>
    URL.revokeObjectURL(url)<span class="hljs-comment">; // 释放内存</span>
  }
})<span class="hljs-comment">;</span>

// 4. 发送请求（可携带 Token）
xhr.setRequestHeader('Authorization', 'Bearer ' + token)<span class="hljs-comment">;</span>
xhr.send()<span class="hljs-comment">;</span>
</code></pre>
</li>
<li>
<p><strong>优势</strong>：</p>
<ul>
<li>可监控实时进度；</li>
<li>可携带自定义请求头（如 Token），处理权限验证；</li>
<li>可中断请求（<code>xhr.abort()</code>）；</li>
<li>可处理后端返回的错误（如权限不足时，后端返回 JSON 而非文件，前端可捕获）。</li>
</ul>
</li>
</ul>
<h3 data-id="heading-9">三、下载进度的关联逻辑：为什么只有 Blob 方式能监控？</h3>
<p>进度监控的核心是<strong>前端能感知 “数据传输的每一步”</strong> ，这和请求方式直接相关：</p>
<h4 data-id="heading-10">1. <code>&lt;a&gt;</code> 标签 /<code>window.open()</code>：进度 “不可见”</h4>
<ul>
<li>
<p>这两种方式是<strong>浏览器直接和后端通信</strong>，前端 JS 被排除在传输过程之外：</p>
<ul>
<li>浏览器接收到后端的响应头后，直接启动下载进程，JS 无法获取 “已下载多少字节”“总字节数”。</li>
<li>相当于 “把下载交给浏览器，前端只能等结果”，自然无法监控进度。</li>
</ul>
</li>
</ul>
<h4 data-id="heading-11">2. AJAX/fetch + Blob：进度 “可感知”</h4>
<ul>
<li>
<p>这种方式是<strong>前端 JS 主动和后端通信</strong>，数据先流经 JS，再交给浏览器：</p>
<ul>
<li>后端以 “流” 的形式分段返回数据，每返回一段，就触发 <code>progress</code> 事件；</li>
<li>事件对象 <code>e</code> 包含 <code>loaded</code>（已接收字节）和 <code>total</code>（总字节，来自 <code>Content-Length</code>），前端可实时计算进度；</li>
<li>所有数据接收完成后，JS 将二进制流封装成 Blob，再模拟 <code>&lt;a&gt;</code> 标签下载。</li>
</ul>
</li>
</ul>
<h4 data-id="heading-12">3. 进度监控的关键前提</h4>
<ul>
<li>后端必须返回 <code>Content-Length</code>（否则 <code>e.lengthComputable</code> 为 <code>false</code>，无法算百分比）；</li>
<li>后端不能用 “分块传输”（<code>Transfer-Encoding: chunked</code>），否则无 <code>Content-Length</code>；</li>
<li>跨域时，后端需配置 <code>Access-Control-Expose-Headers: Content-Length</code>，否则前端拿不到 <code>total</code>。</li>
</ul>
<h3 data-id="heading-13">四、完整关联链总结</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b21fc3c0e8034eeeb9a67131dd7d8cfa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ouJ5LiN5Yqo55qE54yq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764320723&amp;x-signature=fWEbgRq6KnshXsnqEnwpXIvOGpM%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-14">核心关键点回顾</h3>
<ol>
<li><strong>后端是基础</strong>：<code>Content-Disposition</code> 决定默认行为，<code>Content-Length</code> 决定能否算进度，<code>Content-Type</code> 决定文件解析方式。</li>
<li><strong>前端选方式</strong>：小文件 / 无进度需求用 <code>&lt;a&gt;</code> 标签，大文件 / 需进度用 AJAX+Blob。</li>
<li><strong>进度靠流控</strong>：只有让文件以二进制流形式流经前端 JS，才能捕获传输进度，<code>&lt;a&gt;</code> 标签做不到这一点。</li>
</ol>
<p>简单说：后端定 “规则”，前端选 “策略”，进度靠 “流控”—— 这就是三者的核心关联！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[HarmonyOS：属性动画]]></title>    <link>https://juejin.cn/post/7574803558878396431</link>    <guid>https://juejin.cn/post/7574803558878396431</guid>    <pubDate>2025-11-21T09:11:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574803558878396431" data-draft-id="7574749664492945442" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="HarmonyOS：属性动画"/> <meta itemprop="keywords" content="HarmonyOS"/> <meta itemprop="datePublished" content="2025-11-21T09:11:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ChinaDragon"/> <meta itemprop="url" content="https://juejin.cn/user/3966693681410840"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            HarmonyOS：属性动画
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3966693681410840/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ChinaDragon
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T09:11:37.000Z" title="Fri Nov 21 2025 09:11:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">一、属性动画概述</h3>
<blockquote>
<p>属性接口（以下简称属性）包含尺寸属性、布局属性、位置属性等多种类型，用于控制组件的行为。针对当前界面上的组件，其部分属性（如位置属性）的变化会引起UI的变化。添加动画可以让属性值从起点逐渐变化到终点，从而产生连续的动画效果。为保障动画起点和终点的正确性，属性动画会将当前在标脏队列内的所有节点进行刷新。如果发现当前动画时长较长时，需要确认当前是否有额外的节点刷新。根据变化时是否能够添加动画，可以将属性分为可动画属性和不可动画属性。判断一种属性是否适合作为可动画属性主要有两个标准：</p>
<ol>
<li>属性变化能够引起UI的变化。例如，enabled属性用于控制组件是否可以响应点击、触摸等事件，但enabled属性的变化不会引起UI的变化，因此不适合作为可动画属性。</li>
<li>属性在变化时适合添加动画作为过渡。例如，focusable属性决定当前组件是否可以获得焦点，当focusable属性发生变化时，应立即切换到终点值以响应用户行为，不应该加入动画效果，因此不适合作为可动画属性。</li>
</ol>
</blockquote>
<h4 data-id="heading-1">1.1 属性接口分类说明：</h4>
<p><strong>可动画属性：</strong></p>
<ul>
<li>系统可动画属性：</li>
</ul>









































<table><thead><tr><th align="left">分类</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left">布局属性</td><td align="left">位置、大小、内边距、外边距、对齐方式、权重等。</td></tr><tr><td align="left">仿射变换</td><td align="left">平移、旋转、缩放、锚点等。</td></tr><tr><td align="left">背景</td><td align="left">背景颜色、背景模糊等。</td></tr><tr><td align="left">内容</td><td align="left">文字大小、文字颜色，图片对齐方式、模糊等。</td></tr><tr><td align="left">前景</td><td align="left">前景颜色等。</td></tr><tr><td align="left">Overlay</td><td align="left">Overlay属性等。</td></tr><tr><td align="left">外观</td><td align="left">透明度、圆角、边框、阴影等。</td></tr><tr><td align="left">...</td><td align="left">...</td></tr></tbody></table>
<ul>
<li>自定义可动画属性：通过自定义属性动画机制抽象出的可动画属性。</li>
</ul>
<p><strong>不可动画属性：zIndex、focusable等。</strong></p>
<blockquote>
<p>通常，可动画属性的参数数据类型必须具备连续性，即可以通过插值方法来填补数据点之间的空隙，达到视觉上的连续效果。但属性的参数数据类型是否能够进行插值并非决定属性是否可动画的关键因素。例如，对于设置元素水平方向布局的<strong>direction</strong>属性，其参数数据类型是枚举值。但是，由于位置属性是可动画属性，ArkUI同样支持在其属性值改变引起组件位置变化时添加动画。</p>
</blockquote>
<blockquote>
<p>对于可动画属性，系统不仅提供通用属性，还支持自定义可动画属性。</p>
<ul>
<li>系统可动画属性：组件自带的支持改变UI界面的属性接口，如位置、缩放、模糊等。</li>
<li>自定义可动画属性：ArkUI提供@AnimatableExtend装饰器用于自定义可动画属性。开发者可从自定义绘制的内容中抽象出可动画属性，用于控制每帧绘制的内容，如自定义绘制音量图标。通过自定义可动画属性，可以为ArkUI中部分原本不支持动画的属性添加动画。</li>
</ul>
</blockquote>
<h3 data-id="heading-2">二、实现属性动画</h3>
<blockquote>
<p>通过可动画属性改变引起UI上产生的连续视觉效果，即为属性动画。属性动画是最基础易懂的动画，ArkUI提供三种动画接口<strong>animateTo、animation和keyframeAnimateTo</strong>驱动组件属性按照动画曲线等动画参数进行连续的变化，产生属性动画。</p>
</blockquote>
<blockquote>
<p><strong>说明</strong>
本章节讨论的属性动画不是狭义的属性动画接口，而是通过给定新的可动画属性终值，对属性产生动画的方式。</p>
</blockquote>

































<table><thead><tr><th align="left">动画接口</th><th align="left">作用域</th><th align="left">原理</th><th align="left">使用场景</th><th/></tr></thead><tbody><tr><td align="left">animateTo</td><td align="left">闭包内改变属性引起的界面变化。<br/>作用于出现消失转场。</td><td align="left">通用函数，对闭包前界面和闭包中的状态变量引起的界面之间的差异做动画。<br/> 支持多次调用，支持嵌套。</td><td align="left">适用对多个可动画属性配置相同动画参数的动画。<br/>需要嵌套使用动画的场景。</td><td/></tr><tr><td align="left">animation</td><td align="left">组件通过属性接口绑定的属性变化引起的界面变化。</td><td align="left">识别组件的可动画属性变化，自动添加动画。</td><td align="left">组件的接口调用是从下往上执行，animation只会作用于在其之上的属性调用。<br/>组件可以根据调用顺序对多个属性设置不同的animation。</td><td>适用于对多个可动画属性配置不同参数动画的场景。</td></tr><tr><td align="left">keyframeAnimateTo</td><td align="left">多个闭包内改变属性引起的分段属性动画。</td><td align="left">通用函数，每一段闭包中的状态变量与前一次的差异做动画。<br/>支持多次调用，不推荐嵌套。</td><td align="left">适用于同一属性需要做连续多个动画的场景。</td><td/></tr></tbody></table>
<h4 data-id="heading-3">2.1 使用animateTo产生属性动画</h4>
<pre><code class="hljs language-c" lang="c">animateTo(value: AnimateParam, event: () =&gt; <span class="hljs-type">void</span>): <span class="hljs-type">void</span>
</code></pre>
<blockquote>
<p>animateTo接口参数中，value指定AnimateParam对象（包括时长、Curve等）event为动画的闭包函数，闭包内变量改变产生的属性动画将遵循相同的动画参数。</p>
</blockquote>
<blockquote>
<p><strong>说明</strong>
直接使用animateTo可能导致UI上下文不明确的问题，建议使用getUIContext()获取UIContext实例，并使用animateTo调用绑定实例的animateTo。</p>
</blockquote>
<blockquote>
<p><strong>效果图</strong> <br/>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f99b0781622445dca7ef066aa200765b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ2hpbmFEcmFnb24=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764321097&amp;x-signature=f5yj4faRUl4dhy3CzxO02ugLIxs%3D" alt="在这里插入图片描述" loading="lazy"/></p>
</blockquote>
<p><strong>示例代码</strong></p>
<pre><code class="hljs language-c" lang="c">import { curves } from <span class="hljs-string">'@kit.ArkUI'</span>;

@Entry
@Component
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">AnimateToDemo</span> {</span>
  @State animate: boolean = <span class="hljs-literal">false</span>;
  <span class="hljs-comment">// 第一步: 声明相关状态变量</span>
  @State rotateValue: number = <span class="hljs-number">0</span>; <span class="hljs-comment">// 组件一旋转角度</span>
  @State translateX: number = <span class="hljs-number">0</span>; <span class="hljs-comment">// 组件二偏移量</span>
  @State opacityValue: number = <span class="hljs-number">1</span>; <span class="hljs-comment">// 组件二透明度</span>

  <span class="hljs-comment">// 第二步：将状态变量设置到相关可动画属性接口</span>
  build() {
    Row() {
      <span class="hljs-comment">// 组件一</span>
      Column() {
      }
      .rotate({ angle: this.rotateValue })
      .backgroundColor(<span class="hljs-string">'#317AF7'</span>)
      .justifyContent(FlexAlign.Center)
      .width(<span class="hljs-number">100</span>)
      .height(<span class="hljs-number">100</span>)
      .borderRadius(<span class="hljs-number">30</span>)
      .onClick(() =&gt; {
        this.getUIContext()?.animateTo({ curve: curves.springMotion() }, () =&gt; {
          this.animate = !this.animate;
          <span class="hljs-comment">// 第三步：闭包内通过状态变量改变UI界面</span>
          <span class="hljs-comment">// 这里可以写任何能改变UI的逻辑比如数组添加，显隐控制，系统会检测改变后的UI界面与之前的UI界面的差异，对有差异的部分添加动画</span>
          <span class="hljs-comment">// 组件一的rotate属性发生变化，所以会给组件一添加rotate旋转动画</span>
          this.rotateValue = this.animate ? <span class="hljs-number">90</span> : <span class="hljs-number">0</span>;
          <span class="hljs-comment">// 组件二的透明度发生变化，所以会给组件二添加透明度的动画</span>
          this.opacityValue = this.animate ? <span class="hljs-number">0.6</span> : <span class="hljs-number">1</span>;
          <span class="hljs-comment">// 组件二的translate属性发生变化，所以会给组件二添加translate偏移动画</span>
          this.translateX = this.animate ? <span class="hljs-number">50</span> : <span class="hljs-number">0</span>;
        })
      })

      <span class="hljs-comment">// 组件二</span>
      Column() {

      }
      .justifyContent(FlexAlign.Center)
      .width(<span class="hljs-number">100</span>)
      .height(<span class="hljs-number">100</span>)
      .backgroundColor(<span class="hljs-string">'#D94838'</span>)
      .borderRadius(<span class="hljs-number">30</span>)
      .opacity(this.opacityValue)
      .translate({ x: this.translateX })
    }
    .width(<span class="hljs-string">'100%'</span>)
    .height(<span class="hljs-string">'100%'</span>)
    .justifyContent(FlexAlign.Center)
  }
}
</code></pre>
<h4 data-id="heading-4">2.2 使用animation产生属性动画</h4>
<blockquote>
<p>相比于animateTo接口需要把要执行动画的属性的修改放在闭包中，<strong>animation</strong>接口无需使用闭包，把animation接口加在要做属性动画的可动画属性后即可。animation只要检测到其绑定的可动画属性发生变化，就会自动添加属性动画，animateTo则必须在动画闭包内改变可动画属性的值从而生成动画。</p>
</blockquote>
<blockquote>
<p><strong>效果图</strong> <br/>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/13c609d4f6ae429885126f9ce0c2272d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ2hpbmFEcmFnb24=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764321097&amp;x-signature=vxiTKyb0%2BXqdHRCFU%2FJp02t9u%2FE%3D" alt="在这里插入图片描述" loading="lazy"/></p>
</blockquote>
<p><strong>示例代码</strong></p>
<pre><code class="hljs language-c" lang="c">import { curves } from <span class="hljs-string">'@kit.ArkUI'</span>;

@Entry
@Component
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">AnimationDemo2</span> {</span>
  @State animate: boolean = <span class="hljs-literal">false</span>;
  <span class="hljs-comment">// 第一步: 声明相关状态变量</span>
  @State rotateValue: number = <span class="hljs-number">0</span>; <span class="hljs-comment">// 组件一旋转角度</span>
  @State translateX: number = <span class="hljs-number">0</span>; <span class="hljs-comment">// 组件二偏移量</span>
  @State opacityValue: number = <span class="hljs-number">1</span>; <span class="hljs-comment">// 组件二透明度</span>

  <span class="hljs-comment">// 第二步：将状态变量设置到相关可动画属性接口</span>
  build() {
    Row() {
      <span class="hljs-comment">// 组件一</span>
      Column() {
      }
      .opacity(this.opacityValue)
      .rotate({ angle: this.rotateValue })
      <span class="hljs-comment">// 第三步：通过属性动画接口开启属性动画</span>
      .animation({ curve: curves.springMotion() })
      .backgroundColor(<span class="hljs-string">'#ff4f31f7'</span>)
      .justifyContent(FlexAlign.Center)
      .width(<span class="hljs-number">100</span>)
      .height(<span class="hljs-number">100</span>)
      .borderRadius(<span class="hljs-number">30</span>)
      .onClick(() =&gt; {
        this.animate = !this.animate;
        <span class="hljs-comment">// 第四步：闭包内通过状态变量改变UI界面</span>
        <span class="hljs-comment">// 这里可以写任何能改变UI的逻辑比如数组添加，显隐控制，系统会检测改变后的UI界面与之前的UI界面的差异，对有差异的部分添加动画</span>
        <span class="hljs-comment">// 组件一的rotate属性发生变化，所以会给组件一添加rotate旋转动画</span>
        this.rotateValue = this.animate ? <span class="hljs-number">90</span> : <span class="hljs-number">0</span>;
        <span class="hljs-comment">// 组件二的translate属性发生变化，所以会给组件二添加translate偏移动画</span>
        this.translateX = this.animate ? <span class="hljs-number">50</span> : <span class="hljs-number">0</span>;
        <span class="hljs-comment">// 父组件column的opacity属性有变化，会导致其子节点的透明度也变化，所以这里会给column和其子节点的透明度属性都加动画</span>
        this.opacityValue = this.animate ? <span class="hljs-number">0.6</span> : <span class="hljs-number">1</span>;
      })

      <span class="hljs-comment">// 组件二</span>
      Column() {
      }
      .justifyContent(FlexAlign.Center)
      .width(<span class="hljs-number">100</span>)
      .height(<span class="hljs-number">100</span>)
      .backgroundColor(<span class="hljs-string">'#ff46bcf3'</span>)
      .borderRadius(<span class="hljs-number">30</span>)
      .opacity(this.opacityValue)
      .translate({ x: this.translateX })
      .animation({ curve: curves.springMotion() })
    }
    .width(<span class="hljs-string">'100%'</span>)
    .height(<span class="hljs-string">'100%'</span>)
    .justifyContent(FlexAlign.Center)
  }
}
</code></pre>
<h4 data-id="heading-5">2.3 使用keyframeAnimateTo产生属性动画</h4>
<pre><code class="hljs language-c" lang="c">keyframeAnimateTo(param: KeyframeAnimateParam, keyframes: Array&lt;KeyframeState&gt;): <span class="hljs-type">void</span>
</code></pre>
<blockquote>
<p>keyframeAnimateTo接口参数中，第一个参数KeyframeAnimateParam为关键帧动画的整体参数（包括延时、播放次数、结束回调、期望帧率），第二个参数是一个数组，每一项表示一个关键帧内的动画行为；每一段动画可单独控制动画参数（包括时长、Curve等）。</p>
</blockquote>
<blockquote>
<p>在同一属性存在多段动画过程的场景，可通过在结束回调中再创建新动画实现，但写法更复杂，且每次创建新动画需要耗时，会有衔接卡顿现象。此场景更适宜用关键帧动画实现。</p>
</blockquote>
<blockquote>
<p>以下示例主要演示如何通过keyframeAnimateTo来设置关键帧动画。</p>
</blockquote>
<blockquote>
<p><strong>效果图</strong> <br/>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d5598c7887a24212837f0cabcf617200~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ2hpbmFEcmFnb24=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764321097&amp;x-signature=9wdWP4r3TXa0W4%2BpeFgAHG5y4x0%3D" alt="在这里插入图片描述" loading="lazy"/></p>
</blockquote>
<p><strong>示例代码</strong></p>
<pre><code class="hljs language-c" lang="c">@Entry
@Component
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">KeyframeAnimateToDemo</span> {</span>
  <span class="hljs-comment">// 第一步: 声明相关状态变量</span>
  @State rotateValue: number = <span class="hljs-number">0</span>; <span class="hljs-comment">// 组件一旋转角度</span>
  @State translateX: number = <span class="hljs-number">0</span>; <span class="hljs-comment">// 组件二偏移量</span>
  @State opacityValue: number = <span class="hljs-number">1</span>; <span class="hljs-comment">// 组件二透明度</span>
  <span class="hljs-comment">// 第二步：将状态变量设置到相关可动画属性接口</span>
  build() {
    Row() {
      <span class="hljs-comment">// 组件一</span>
      Column() {
      }
      .rotate({ angle: this.rotateValue })
      .backgroundColor(<span class="hljs-string">'#317AF7'</span>)
      .justifyContent(FlexAlign.Center)
      .width(<span class="hljs-number">100</span>)
      .height(<span class="hljs-number">100</span>)
      .borderRadius(<span class="hljs-number">30</span>)
      .onClick(() =&gt; {
        <span class="hljs-comment">// 第三步：调用keyframeAnimateTo接口</span>
        this.getUIContext()?.keyframeAnimateTo({
          iterations: <span class="hljs-number">1</span>
        }, [
          {
            <span class="hljs-comment">// 第一段关键帧动画时长为800ms，组件一顺时针旋转90度，组件二的透明度变从1变为0.6，组件二的translate从0位移到50</span>
            duration: <span class="hljs-number">800</span>,
            event: () =&gt; {
              this.rotateValue = <span class="hljs-number">90</span>;
              this.opacityValue = <span class="hljs-number">0.6</span>;
              this.translateX = <span class="hljs-number">50</span>;
            }
          },
          {
            <span class="hljs-comment">// 第二段关键帧动画时长为500ms，组件一逆时针旋转90度恢复至0度，组件二的透明度变从0.6变为1，组件二的translate从50位移到0</span>
            duration: <span class="hljs-number">500</span>,
            event: () =&gt; {
              this.rotateValue = <span class="hljs-number">0</span>;
              this.opacityValue = <span class="hljs-number">1</span>;
              this.translateX = <span class="hljs-number">0</span>;
            }
          }
        ]);
      })
      <span class="hljs-comment">// 组件二</span>
      Column() {
      }
      .justifyContent(FlexAlign.Center)
      .width(<span class="hljs-number">100</span>)
      .height(<span class="hljs-number">100</span>)
      .backgroundColor(<span class="hljs-string">'#D94838'</span>)
      .borderRadius(<span class="hljs-number">30</span>)
      .opacity(this.opacityValue)
      .translate({ x: this.translateX })
    }
    .width(<span class="hljs-string">'100%'</span>)
    .height(<span class="hljs-string">'100%'</span>)
    .justifyContent(FlexAlign.Center)
  }
}
</code></pre>
<blockquote>
<p><strong>说明</strong></p>
<ul>
<li>在对组件的位置大小的变化做动画的时候，由于布局属性的改变会触发测量布局，性能开销大。<strong>scale</strong>属性的改变不会触发测量布局，性能开销小。因此，在组件位置大小持续发生变化的场景，如跟手触发组件大小变化的场景，推荐使用scale。</li>
<li>属性动画应该作用于始终存在的组件，对于将要出现或者将要消失的组件的动画应该使用<strong>转场动画</strong>。</li>
<li>尽量不要使用动画结束回调。属性动画是对已经发生的状态进行的动画，不需要开发者去处理结束的逻辑。如果要使用结束回调，一定要正确处理连续操作的数据管理。</li>
</ul>
</blockquote>
<h3 data-id="heading-6">三、自定义属性动画</h3>
<blockquote>
<p>属性动画是可动画属性的参数值发生变化时，引起UI上产生的连续视觉效果。当参数值发生连续变化，且设置到可以引起UI发生变化的属性接口上时，就可以实现属性动画。</p>
</blockquote>
<blockquote>
<p>ArkUI提供@AnimatableExtend装饰器，用于自定义可动画属性接口。由于参数的数据类型必须具备一定程度的连续性，自定义可动画属性接口的参数类型仅支持number类型和实现AnimatableArithmetic&lt;T&gt;接口的自定义类型。通过自定义可动画属性接口和可动画数据类型，在使用animateTo或animation执行动画时，通过逐帧回调函数修改不可动画属性接口的值，能够让不可动画属性接口实现动画效果。也可通过逐帧回调函数每帧修改可动画属性的值，实现逐帧布局的效果。</p>
</blockquote>
<h4 data-id="heading-7">3.1 使用number数据类型和@AnimatableExtend装饰器改变Text组件宽度实现逐帧布局的效果</h4>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// 第一步：使用@AnimatableExtend装饰器，自定义可动画属性接口</span>
@AnimatableExtend(Text)
function <span class="hljs-title function_">animatableWidth</span><span class="hljs-params">(width: number)</span> {
  .width(width) <span class="hljs-comment">// 调用系统属性接口，逐帧回调函数每帧修改可动画属性的值，实现逐帧布局的效果。</span>
}

@Entry
@Component
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">AnimatablePropertyExample</span> {</span>
  @State textWidth: number = <span class="hljs-number">80</span>;

  build() {
    Column() {
      Text(<span class="hljs-string">"AnimatableProperty"</span>)
        .animatableWidth(this.textWidth)<span class="hljs-comment">// 第二步：将自定义可动画属性接口设置到组件上</span>
        .animation({ duration: <span class="hljs-number">2000</span>, curve: Curve.Ease }) <span class="hljs-comment">// 第三步:为自定义可动画属性接口绑定动画</span>
      Button(<span class="hljs-string">"Play"</span>)
        .onClick(() =&gt; {
          this.textWidth = this.textWidth == <span class="hljs-number">80</span> ? <span class="hljs-number">160</span> : <span class="hljs-number">80</span>; <span class="hljs-comment">// 第四步：改变自定义可动画属性的参数，产生动画</span>
        })
    }.width(<span class="hljs-string">"100%"</span>)
    .padding(<span class="hljs-number">10</span>)
  }
}
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[AlphaEvolve：基于 Gemini 的高级算法设计编程代理]]></title>    <link>https://juejin.cn/post/7574848503731355694</link>    <guid>https://juejin.cn/post/7574848503731355694</guid>    <pubDate>2025-11-21T09:14:27.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574848503731355694" data-draft-id="7574840547807199242" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AlphaEvolve：基于 Gemini 的高级算法设计编程代理"/> <meta itemprop="keywords" content="LLM"/> <meta itemprop="datePublished" content="2025-11-21T09:14:27.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="是魔丸啊"/> <meta itemprop="url" content="https://juejin.cn/user/3217622495411292"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AlphaEvolve：基于 Gemini 的高级算法设计编程代理
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3217622495411292/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    是魔丸啊
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T09:14:27.000Z" title="Fri Nov 21 2025 09:14:27 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>一篇5月份的老文</p>
</blockquote>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeepmind.google%2Fblog%2Falphaevolve-a-gemini-powered-coding-agent-for-designing-advanced-algorithms%2F" target="_blank" title="https://deepmind.google/blog/alphaevolve-a-gemini-powered-coding-agent-for-designing-advanced-algorithms/" ref="nofollow noopener noreferrer">转载</a></p>
<p><strong>AlphaEvolve 团队</strong></p>
<p>新型 AI 代理通过结合大型语言模型的创造力与自动化评估器，为数学和计算中的实际应用演化算法</p>
<p>大型语言模型（LLMs）具有卓越的多功能性。它们可以总结文档、生成代码，甚至头脑风暴出新想法。现在，我们已将这些能力扩展到解决数学和现代计算中基础性且高度复杂的问题。</p>
<p>今天，我们宣布推出 <strong>AlphaEvolve</strong>，这是一个基于大型语言模型的进化编程代理，用于通用算法发现和优化。AlphaEvolve 将我们 <strong>Gemini 模型</strong> 的创造性问题解决能力与验证答案的自动化评估器配对，并使用进化框架来改进最有前景的想法。</p>
<p>AlphaEvolve 提升了 Google 数据中心、芯片设计和 AI 训练过程的效率——包括训练 AlphaEvolve 本身所用的大型语言模型。它还帮助设计了更快的矩阵乘法算法，并为开放的数学问题找到了新的解决方案，在许多领域的应用中展现出令人难以置信的前景。</p>
<h2 data-id="heading-0">使用大型语言模型设计更好的算法</h2>
<p>2023年，我们首次展示了大型语言模型可以生成用计算机代码编写的函数，以帮助<strong>在开放的科学问题上发现新的且可证明正确的知识</strong>。AlphaEvolve 是一个能够超越单一函数发现，进而进化整个代码库并开发更复杂算法的代理。</p>
<p>AlphaEvolve 利用了一套最先进的大型语言模型集成：我们最快、最高效的模型 <strong>Gemini Flash</strong> 最大化了探索想法的广度，而我们最强大的模型 <strong>Gemini Pro</strong> 则通过富有洞察力的建议提供了关键的深度。这些模型共同提出实现算法解决方案的计算机程序。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a247ea56a51944ceba07046406166f5b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5piv6a2U5Li45ZWK:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764321267&amp;x-signature=kPs9%2FjMbMrYSRWWEzew%2FKI%2F%2FF8c%3D" alt="" loading="lazy"/></p>
<p>图示显示了提示采样器如何首先为语言模型组装提示，然后生成新的程序。这些程序由评估器评估并存储在程序数据库中。该数据库实现了一个进化算法，确定哪些程序将用于未来的提示。</p>
<p>AlphaEvolve 使用自动化评估指标来验证、运行和评分提议的程序。这些指标为每个解决方案的准确性和质量提供了客观、可量化的评估。这使得 AlphaEvolve 在数学和计算机科学等可以清晰、系统地衡量进展的广泛领域中特别有用。</p>
<h3 data-id="heading-1">优化我们的计算生态系统</h3>
<p>在过去一年中，我们在 Google 的计算生态系统中部署了 AlphaEvolve 发现的算法，包括我们的数据中心、硬件和软件。这些改进中的每一个的影响都在我们的 AI 和计算基础设施中被放大，为所有用户构建一个更强大、更可持续的数字生态系统。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cb04c07f12d34125aef79341c09a44ff~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5piv6a2U5Li45ZWK:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764321267&amp;x-signature=hlhTBowqaYUb05TENTHlYbNzwY8%3D" alt="" loading="lazy"/></p>
<p>图示显示了 AlphaEvolve 如何帮助 Google 提供更高效的数字生态系统，从数据中心调度和硬件设计到 AI 模型训练。</p>
<h4 data-id="heading-2">改进数据中心调度</h4>
<p>AlphaEvolve 发现了一个简单但非常有效的启发式算法，以帮助 <strong>Borg</strong> 更高效地编排 Google 广阔的数据中心。这个解决方案现已投入生产超过一年，平均持续回收 Google 全球计算资源的 0.7%。这种持续的效率提升意味着在任何给定时刻，相同的计算足迹可以完成更多任务。AlphaEvolve 的解决方案不仅带来强大的性能，还提供了人类可读代码的重要操作优势：可解释性、可调试性、可预测性和易于部署。</p>
<h4 data-id="heading-3">协助硬件设计</h4>
<p>AlphaEvolve 提出了一个 <strong>Verilog</strong> 重写，移除了用于矩阵乘法的关键、高度优化的算术电路中不必要的位。至关重要的是，该提议必须通过鲁棒的验证方法来确认修改后的电路保持功能正确性。这个提议被集成到即将推出的 <strong>Tensor Processing Unit (TPU)</strong> 中，这是 Google 的定制 AI 加速器。通过以芯片设计师的标准语言提出修改建议，AlphaEvolve 促进了 AI 和硬件工程师之间的协作方法，以加速未来专用芯片的设计。</p>
<h4 data-id="heading-4">增强 AI 训练和推理</h4>
<p>AlphaEvolve 正在加速 AI 性能和研究速度。通过找到更智能的方法将大型矩阵乘法操作分解为更可管理的子问题，它将 Gemini 架构中这个关键的 <strong>kernel</strong> 加速了 23%，导致 Gemini 训练时间减少了 1%。由于开发生成式 AI 模型需要大量计算资源，获得的每一点效率都能转化为可观的节省。除了性能提升外，AlphaEvolve 还显著减少了 kernel 优化所需的工程时间，从数周的专家努力减少到数天的自动化实验，让研究人员能够更快地创新。</p>
<p>AlphaEvolve 还可以优化低级 GPU 指令。这个极其复杂的领域通常已经被编译器大量优化，因此人类工程师通常不会直接修改它。AlphaEvolve 为 <strong>FlashAttention</strong> 在 <strong>Transformer</strong> 架构 AI 模型中的 kernel 实现实现了高达 32.5% 的加速。这种优化帮助专家精确定位性能瓶颈，并轻松将改进集成到他们的代码库中，提高他们的生产力并实现未来计算和能源的节省。</p>
<h4 data-id="heading-5">推进数学和算法发现的前沿</h4>
<p>AlphaEvolve 还可以为复杂的数学问题提出新方法。在提供了计算机程序的最小代码骨架后，AlphaEvolve 设计了一种新颖的 <strong>梯度优化</strong> 程序的许多组件，该程序发现了矩阵乘法的多个新算法——这是计算机科学中的一个基本问题。</p>
<p><img alt="转存失败，建议直接上传图片文件" src="" loading="lazy"/></p>
<p><em>视频：AlphaEvolve 为发现更快的矩阵乘法算法而提出的变更列表。在这个例子中，AlphaEvolve 在多个组件中提出了广泛的变更，包括优化器和权重初始化、损失函数和超参数扫描。这些变更都是高度非平凡的，在进化过程中需要 15 次突变。</em></p>
<p>AlphaEvolve 的程序找到了一个使用 48 次标量乘法来乘以 4x4 复值矩阵的算法，改进了 <strong>Strassen 的 1969 年算法</strong>——该算法此前被认为是这种情况下的最佳算法。这一发现展示了对我们先前工作 <strong>AlphaTensor</strong> 的重大进展，后者专门从事矩阵乘法算法，对于 4x4 矩阵，仅发现了二进制算术的改进。</p>
<p>为探究 AlphaEvolve 的广度，我们将系统应用于数学分析、几何、组合数学和数论中的 50 多个开放问题。系统的灵活性使我们能够在几小时内完成大多数实验的设置。在大约 75% 的情况下，它重新发现了当前最先进的解决方案（据我们所知）。</p>
<p>在 20% 的情况下，AlphaEvolve 改进了先前已知的最佳解决方案，在相应的开放问题上取得了进展。例如，它推进了 <strong>接触数问题</strong>（kissing number problem）。这个几何挑战已经<strong>吸引了数学家超过 300 年</strong>，涉及接触一个公共单位球体的不重叠球体的最大数量。AlphaEvolve 发现了 593 个外球的配置，并在 11 维中建立了一个新的下界。</p>
<h3 data-id="heading-6">前进的道路</h3>
<p>AlphaEvolve 展现了从为特定领域发现算法，到为广泛的真实世界挑战开发更复杂算法的发展进程。我们期望 AlphaEvolve 随着大型语言模型能力的提升而持续改进，特别是当它们在编程能力方面变得更加强大时。</p>
<p>与 <strong>People + AI Research 团队</strong>合作，我们一直在构建与 AlphaEvolve 交互的友好用户界面。我们正在为选定的学术用户规划早期访问计划，并探索让 AlphaEvolve 更广泛可用的可能性。如需注册兴趣，请填写<strong>此表单</strong>。</p>
<p>虽然 AlphaEvolve 目前主要应用于数学和计算领域，但其通用性意味着它可以应用于任何解决方案能够被描述为算法并自动验证的问题。我们相信 AlphaEvolve 可能在更多领域产生变革性影响，如材料科学、药物发现、可持续发展以及更广泛的技术和商业应用。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fstorage.googleapis.com%2Fdeepmind-media%2FDeepMind.com%2FBlog%2Falphaevolve-a-gemini-powered-coding-agent-for-designing-advanced-algorithms%2FAlphaEvolve.pdf%3Futm_source%3Ddeepmind.google%26utm_medium%3Dreferral%26utm_campaign%3Dgdm%26utm_content%3D" target="_blank" title="https://storage.googleapis.com/deepmind-media/DeepMind.com/Blog/alphaevolve-a-gemini-powered-coding-agent-for-designing-advanced-algorithms/AlphaEvolve.pdf?utm_source=deepmind.google&amp;utm_medium=referral&amp;utm_campaign=gdm&amp;utm_content=" ref="nofollow noopener noreferrer">阅读更多详细信息请参阅我们的白皮书</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fforms.gle%2FWyqAoh1ixdfq6tgN8%3Futm_source%3Ddeepmind.google%26utm_medium%3Dreferral%26utm_campaign%3Dgdm%26utm_content%3D" target="_blank" title="https://forms.gle/WyqAoh1ixdfq6tgN8?utm_source=deepmind.google&amp;utm_medium=referral&amp;utm_campaign=gdm&amp;utm_content=" ref="nofollow noopener noreferrer">注册您对使用 AlphaEvolve 的兴趣</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fcolab.research.google.com%2Fgithub%2Fgoogle-deepmind%2Falphaevolve_results%2Fblob%2Fmaster%2Fmathematical_results.ipynb%3Futm_source%3Ddeepmind.google%26utm_medium%3Dreferral%26utm_campaign%3Dgdm%26utm_content%3D" target="_blank" title="https://colab.research.google.com/github/google-deepmind/alphaevolve_results/blob/master/mathematical_results.ipynb?utm_source=deepmind.google&amp;utm_medium=referral&amp;utm_campaign=gdm&amp;utm_content=" ref="nofollow noopener noreferrer">在 Google Colab 中查看 AlphaEvolve 的数学结果</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[2025 SECon+AgentX 大会 — AI 原生应用架构专场]]></title>    <link>https://juejin.cn/post/7574749664492961826</link>    <guid>https://juejin.cn/post/7574749664492961826</guid>    <pubDate>2025-11-21T09:10:49.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574749664492961826" data-draft-id="7574749664492208162" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="2025 SECon+AgentX 大会 — AI 原生应用架构专场"/> <meta itemprop="keywords" content="云原生"/> <meta itemprop="datePublished" content="2025-11-21T09:10:49.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="阿里云云原生"/> <meta itemprop="url" content="https://juejin.cn/user/3808363977648493"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            2025 SECon+AgentX 大会 — AI 原生应用架构专场
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3808363977648493/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    阿里云云原生
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T09:10:49.000Z" title="Fri Nov 21 2025 09:10:49 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>2025 SECon+AgentX 智能时代软件工程技术大会将于 11 月 21 日在上海举办，大会专注于软件开发技术的最新趋势，深度探讨大模型驱动的技术革新以及智能体在工程化落地过程中的关键技术突破与产品商业化验证的会议。重点打造覆盖全产业链的智能体技术实践平台和行业应用产品交流平台。</p>
<p>在本次大会上，阿里云携手信通院联合出品「AI 原生应用架构」专场，欢迎感兴趣的用户报名现场参会。</p>
<h3 data-id="heading-0">AI 原生应用架构专场介绍：</h3>
<p>随着人工智能技术的迅猛演进，尤其是大模型在理解、生成与推理能力上的突破，软件架构正迎来一场深刻的范式迁移——我们正步入“AI 原生架构”时代。在这一新阶段，软件系统不再仅由人类设计逻辑驱动，而是与 AI 模型深度融合，形成具备自适应、自演化与自优化能力的智能架构体系。</p>
<p>AI 原生架构与云原生体系如何深度融合？二者在弹性调度、服务治理与可观测性层面的结合点在哪里？如何构建覆盖观测、评估与模型训练的端到端数据飞轮闭环，实现 AI 能力的持续进化？面对大模型应用带来的安全风险与高可用挑战，又该如何在架构层面设计可信、稳定、可审计的智能系统？本专场将聚焦 AI 原生应用架构的核心命题，探讨从基础设施到应用层的协同演进策略与工程实践。</p>
<h3 data-id="heading-1">专场出品人介绍：</h3>
<p><strong>李艳林  阿里云智能中间件技术负责人</strong></p>
<ul>
<li>Nacos 创始人，阿里云 MSE 创始人，阿里中间件上云负责人，阿里云资深技术专家。</li>
<li>作品：《AI 原生应用架构》、《Nacos架构与原理》、《云原生应用架构白皮书》 关键作者。</li>
<li>履历：十年微服务研发经验，参与阿里异地多活架构演进，全链路压测，百万实例架构演进，全面上云，开源和阿里云等关键战役。</li>
</ul>
<p><strong>马龙飞  中国信息通信研究院</strong></p>
<p><strong>云计算与大数据研究所 云计算部高级业务主管</strong></p>
<ul>
<li>主要负责软件工程智能化、汽车、金融、低空经济等领域研究。</li>
<li>牵头或参与编写《云上软件测试成熟度模型》、《云上智能体评测能力要求》、《汽车行业智能化成熟度模型》、《2023年度中国企业软件研发管理白皮书》、《2025年软件工程智能化标准体系建设指南》、《AIGC驱动Devops智能化应用研究报告》、《2025年AI技术在项目管理中的应用洞察报告》等行业标准和研究报告。</li>
<li>具备多年软件工程&amp;测试领域项目管理经验，发表云计算相关领域专利十余篇，软著十余篇。</li>
</ul>
<h3 data-id="heading-2">专场邀请函，欢迎您报名参会：</h3>
<p><strong>活动时间：</strong> 11.21 13:40-17:25</p>
<p><strong>地点：</strong> 上海明捷万丽酒店二层宴会厅 大宴会厅 2</p>
<p><strong>说明：</strong> 扫描底部二维码即可报名，报名采用审核制，通过审核后将短信/邮件通知，凭通知即可免费现场参会哦！</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/66a24731dc48474292b773e000b10cfe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764321049&amp;x-signature=ndcJnb1Gxtv4CeqzmG6QbikENwQ%3D" alt="图片" loading="lazy"/></p>
<h3 data-id="heading-3">专场各议题讲师及内容介绍：</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8f6596ad88874521bbc4ef0b8e7c66dd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764321049&amp;x-signature=FeuL0QsajnU1isJIhswtEuElGa8%3D" alt="图片" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4d500cb5b5dc4cc2914dc808aba533a1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764321049&amp;x-signature=Nu9eMfNlvdden8HCBy7oZdNzWJc%3D" alt="图片" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0bad79965a574fe7a4fde8a055406014~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764321049&amp;x-signature=a3DdQkdjlnY%2F5wC0Q4QAInQ3IEU%3D" alt="图片" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fbe0b6d123b34f1083b6ce6f704bd0a0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764321049&amp;x-signature=nFQikataM2%2BaWI%2BNITSxsTdNJc8%3D" alt="图片" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[日增千万数据：数据库表设计与高效插入存储方案]]></title>    <link>https://juejin.cn/post/7574958975159959595</link>    <guid>https://juejin.cn/post/7574958975159959595</guid>    <pubDate>2025-11-21T09:18:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574958975159959595" data-draft-id="7574972697677021220" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="日增千万数据：数据库表设计与高效插入存储方案"/> <meta itemprop="keywords" content="后端,分布式"/> <meta itemprop="datePublished" content="2025-11-21T09:18:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="回家路上绕了弯"/> <meta itemprop="url" content="https://juejin.cn/user/536217404587134"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            日增千万数据：数据库表设计与高效插入存储方案
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/536217404587134/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    回家路上绕了弯
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T09:18:17.000Z" title="Fri Nov 21 2025 09:18:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读16分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">日增千万数据：数据库表设计与高效插入存储方案</h2>
<p>当业务场景涉及 “日增 1000 万条数据”（如日志采集、用户行为追踪、IoT 设备上报）时，传统 “单表 + 默认配置” 的数据库设计会迅速面临瓶颈：单表数据量超亿级后插入延迟从 1ms 飙升至 100ms，磁盘空间半年内耗尽，甚至出现 “锁表导致写入中断”。</p>
<p>本文针对 “日增千万级数据” 的核心诉求 ——<strong>极致插入效率</strong>（写入延迟 &lt; 10ms）、<strong>低成本海量存储</strong>（支持年级数据留存）、<strong>基础查询可用</strong>（非实时复杂查询），从表结构、分表分库、存储引擎、参数调优等维度，提供完整的数据库设计方案。</p>
<h3 data-id="heading-1">一、先明确：日增千万数据的业务特征与核心约束</h3>
<p>设计前需先锚定业务场景的关键特征，避免 “为技术而技术”，不同场景的设计侧重点差异极大：</p>





























<table><thead><tr><th>业务场景</th><th>数据特征</th><th>核心诉求</th><th>非核心诉求</th></tr></thead><tbody><tr><td>日志采集（如 API 日志）</td><td>写入密集（读少写多）、无更新、单条数据小（100-500 字节）</td><td>插入效率优先、存储成本低</td><td>复杂查询（如多条件聚合）可容忍离线计算</td></tr><tr><td>用户行为追踪（如点击日志）</td><td>写入密集、部分字段需更新（如会话结束标记）、数据中等（500-1KB）</td><td>插入 + 轻量查询效率、数据保留 3-6 个月</td><td>无需事务强一致性</td></tr><tr><td>IoT 设备上报（如传感器数据）</td><td>写入均匀（每秒～116 条）、数据结构固定、无更新</td><td>高可用（不丢数据）、插入稳定</td><td>支持按设备 ID / 时间范围查询</td></tr></tbody></table>
<p><strong>核心共性约束</strong>：</p>
<ol>
<li>写入吞吐量：日均 1000 万 → 每秒约 116 条（峰值可能达 500 条 / 秒），需支持批量写入；</li>
</ol>

<ol start="2">
<li>存储成本：单条数据按 500 字节算，日均 500GB，年存 182TB，需低成本存储方案；</li>
</ol>

<ol start="3">
<li>数据生命周期：多数场景数据保留 3-12 个月，过期需高效清理 / 归档。</li>
</ol>
<h3 data-id="heading-2">二、核心设计：分表分库 —— 突破单表瓶颈的唯一选择</h3>
<p>日增 1000 万数据，单表无法支撑（MySQL 单表超 2000 万行后，插入 / 查询性能断崖式下降），<strong>分表分库是必选项</strong>，需优先确定分表策略。</p>
<h4 data-id="heading-3">1. 分表策略选型：时间分表（最适配 “按天写入” 场景）</h4>
<p>“日增千万数据” 多为时序数据（按时间顺序产生），<strong>按时间分表</strong>是最优选择，可灵活适配数据生命周期管理，常见分表粒度：</p>

































<table><thead><tr><th>分表粒度</th><th>单表数据量</th><th>适用场景</th><th>优点</th><th>缺点</th></tr></thead><tbody><tr><td>按天分表</td><td>1000 万条</td><td>日志、行为追踪（需按天查询 / 清理）</td><td>单表数据量可控、过期清理高效（直接删表）</td><td>表数量多（年 365 张），需中间件管理</td></tr><tr><td>按周分表</td><td>7000 万条</td><td>IoT 数据（查询频率低）</td><td>表数量少（年 52 张）</td><td>单表数据量较大，查询略慢</td></tr><tr><td>按月分表</td><td>3 亿条</td><td>非实时归档数据（如历史账单）</td><td>表数量极少</td><td>单表超亿级，插入后期性能下降</td></tr></tbody></table>
<p><strong>推荐方案</strong>：按天分表（优先），表名格式为biz_table_yyyyMMdd（如api_log_20251121），理由：</p>
<ul>
<li>单表 1000 万条在 MySQL/PostgreSQL 中性能可控；</li>
</ul>

<ul>
<li>过期数据清理直接DROP TABLE（毫秒级完成），无需删除行（避免表碎片）；</li>
</ul>

<ul>
<li>按天查询时直接路由到对应表，无跨表扫描。</li>
</ul>
<h4 data-id="heading-4">2. 分库策略：当单库写入达瓶颈时的扩展方案</h4>
<p>若单库写入压力过大（如峰值 5000 条 / 秒，MySQL 单库写入上限约 1 万条 / 秒），需按 “时间范围分库” 或 “哈希分库” 扩展：</p>
<h5 data-id="heading-5">（1）时间分库（适配时序数据）</h5>
<ul>
<li>策略：按 “月” 分库，每个库存储当月的按天分表（如db_log_202511库存储api_log_20251101~api_log_20251130）；</li>
</ul>

<ul>
<li>优势：库内表时间连续，跨天查询（如查 11 月 20-22 日数据）仅需访问 1 个库，无需跨库；</li>
</ul>

<ul>
<li>适用场景：查询多为 “近期连续时间范围”（如近 7 天日志）。</li>
</ul>
<h5 data-id="heading-6">（2）哈希分库（适配均匀查询）</h5>
<ul>
<li>策略：按 “分表键哈希” 分库（如用DATE_FORMAT(created_time, '%Y%m%d')计算哈希值，模 32 得到库索引）；</li>
</ul>

<ul>
<li>优势：写入压力均匀分散到多个库，无单库瓶颈；</li>
</ul>

<ul>
<li>适用场景：查询无明显时间偏好（如随机查询任意日期的 IoT 数据）。</li>
</ul>
<h5 data-id="heading-7">（3）分库分表中间件：透明化操作</h5>
<p>手动管理分表分库复杂度极高，需借助中间件实现 “业务无感知”：</p>
<ul>
<li><strong>MySQL 生态</strong>：ShardingSphere-JDBC（轻量级，嵌入应用）、MyCat（独立服务，支持读写分离）；</li>
</ul>

<ul>
<li><strong>PostgreSQL 生态</strong>：pg_shardman（开源分表插件）、TimescaleDB（时序数据库扩展，自动分表）；</li>
</ul>

<ul>
<li><strong>核心能力</strong>：自动路由（按时间路由到对应表）、批量插入优化、跨表查询聚合（如查近 3 天数据自动合并 3 张表结果）。</li>
</ul>
<h4 data-id="heading-8">3. 分表分表示例（ShardingSphere 配置）</h4>
<p>以 “API 日志表按天分表、按月分库” 为例，ShardingSphere-JDBC 配置（YAML）：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">spring:</span>
  <span class="hljs-attr">shardingsphere:</span>
    <span class="hljs-attr">datasource:</span>
      <span class="hljs-comment"># 配置3个分库（202511、202512、202601）</span>
      <span class="hljs-attr">names:</span> <span class="hljs-string">db_log_202511,db_log_202512,db_log_202601</span>
      <span class="hljs-attr">db_log_202511:</span> <span class="hljs-comment"># 2025年11月库</span>
        <span class="hljs-attr">type:</span> <span class="hljs-string">com.zaxxer.hikari.HikariDataSource</span>
        <span class="hljs-attr">driver-class-name:</span> <span class="hljs-string">com.mysql.cj.jdbc.Driver</span>
        <span class="hljs-attr">jdbc-url:</span> <span class="hljs-string">jdbc:mysql://192.168.1.10:3306/db_log_202511?useSSL=false</span>
        <span class="hljs-attr">username:</span> <span class="hljs-string">root</span>
        <span class="hljs-attr">password:</span> <span class="hljs-number">123456</span>
      <span class="hljs-comment"># 其他库配置省略...</span>
    <span class="hljs-attr">rules:</span>
      <span class="hljs-attr">sharding:</span>
        <span class="hljs-attr">tables:</span>
          <span class="hljs-attr">api_log:</span> <span class="hljs-comment"># 逻辑表名（业务代码中使用）</span>
            <span class="hljs-attr">actual-data-nodes:</span> <span class="hljs-string">db_log_${yearmonth}.api_log_${yearmonthday}</span> <span class="hljs-comment"># 实际表名规则</span>
            <span class="hljs-attr">database-strategy:</span> <span class="hljs-comment"># 分库策略（按年月分库）</span>
              <span class="hljs-attr">standard:</span>
                <span class="hljs-attr">sharding-column:</span> <span class="hljs-string">created_time</span> <span class="hljs-comment"># 分库字段（时间戳）</span>
                <span class="hljs-attr">sharding-algorithm-name:</span> <span class="hljs-string">db_inline</span> <span class="hljs-comment"># 分库算法</span>
            <span class="hljs-attr">table-strategy:</span> <span class="hljs-comment"># 分表策略（按天分表）</span>
              <span class="hljs-attr">standard:</span>
                <span class="hljs-attr">sharding-column:</span> <span class="hljs-string">created_time</span>
                <span class="hljs-attr">sharding-algorithm-name:</span> <span class="hljs-string">table_inline</span>
        <span class="hljs-attr">sharding-algorithms:</span>
          <span class="hljs-attr">db_inline:</span> <span class="hljs-comment"># 分库算法：提取年月（如202511）</span>
            <span class="hljs-attr">type:</span> <span class="hljs-string">INLINE</span>
            <span class="hljs-attr">props:</span>
              <span class="hljs-attr">algorithm-expression:</span> <span class="hljs-string">db_log_${date_format(created_time,</span> <span class="hljs-string">'yyyyMM'</span><span class="hljs-string">)}</span>
          <span class="hljs-attr">table_inline:</span> <span class="hljs-comment"># 分表算法：提取年月日（如20251121）</span>
            <span class="hljs-attr">type:</span> <span class="hljs-string">INLINE</span>
            <span class="hljs-attr">props:</span>
              <span class="hljs-attr">algorithm-expression:</span> <span class="hljs-string">api_log_${date_format(created_time,</span> <span class="hljs-string">'yyyyMMdd'</span><span class="hljs-string">)}</span>
</code></pre>
<h3 data-id="heading-9">三、表结构优化：为 “插入效率” 和 “存储成本” 服务</h3>
<p>表结构设计直接影响插入速度和存储占用，需遵循 “最小字段、合适类型、少索引” 原则：</p>
<h4 data-id="heading-10">1. 字段设计：精简 + 适配存储</h4>
<h5 data-id="heading-11">（1）数据类型选择：够用即可，避免冗余</h5>









































<table><thead><tr><th>业务字段</th><th>推荐类型</th><th>避免使用</th><th>理由</th></tr></thead><tbody><tr><td>时间戳（创建时间）</td><td>DATETIME (3)（毫秒级，占 5 字节）</td><td>TIMESTAMP（依赖时区）、VARCHAR</td><td>毫秒级精度满足多数场景，比 TIMESTAMP 更稳定</td></tr><tr><td>设备 ID / 用户 ID</td><td>BIGINT（8 字节）或 CHAR (32)（UUID）</td><td>VARCHAR (64)（冗余）</td><td>BIGINT 比 UUID 存储更省空间，查询更快</td></tr><tr><td>状态标识（如成功 / 失败）</td><td>TINYINT（1 字节，0 = 失败，1 = 成功）</td><td>INT（4 字节）、VARCHAR</td><td>状态值少，TINYINT 足够，省空间</td></tr><tr><td>日志内容 / 上报数据</td><td>VARCHAR (1024)（按需调整）或 TEXT</td><td>LONGTEXT（无限制，易冗余）</td><td>多数场景 1KB 内足够，TEXT 需额外磁盘空间</td></tr><tr><td>数值型指标（如耗时、大小）</td><td>INT（4 字节，需 &gt; 20 亿用 BIGINT）</td><td>VARCHAR（无法参与数值计算）</td><td>数值型支持聚合查询，存储更省空间</td></tr></tbody></table>
<h5 data-id="heading-12">（2）避免 NULL 值：用默认值替代</h5>
<p>NULL 值会增加存储开销（需额外标记），且影响索引效率，所有字段尽量设默认值：</p>
<ul>
<li>字符串字段：默认空字符串（DEFAULT ''）；</li>
</ul>

<ul>
<li>数值字段：默认 0（DEFAULT 0）；</li>
</ul>

<ul>
<li>时间字段：默认当前时间（DEFAULT CURRENT_TIMESTAMP(3)）。</li>
</ul>
<h4 data-id="heading-13">2. 索引设计：插入场景 “索引越少越好”</h4>
<p>索引加速查询，但严重拖慢插入（每插入一条数据需更新所有索引），日增千万数据场景下，索引需 “极简”：</p>
<h5 data-id="heading-14">（1）必建索引：主键索引</h5>
<ul>
<li>选择自增 ID（如id BIGINT AUTO_INCREMENT）或雪花 ID（分布式场景）作为主键；</li>
</ul>

<ul>
<li>理由：InnoDB 主键为聚簇索引，自增 ID 插入时不会产生页分裂，插入效率最高；雪花 ID 确保分布式场景下主键唯一。</li>
</ul>
<h5 data-id="heading-15">（2）可选索引：仅建 “高频查询字段”</h5>
<p>仅对 “必须按该字段查询” 的字段建索引，且优先选择 “过滤性好” 的字段：</p>
<ul>
<li>如 IoT 场景需按 “设备 ID + 时间范围” 查询，建联合索引idx_device_time (device_id, created_time)；</li>
</ul>

<ul>
<li>避免单字段索引（如仅device_id），联合索引可覆盖 “设备 + 时间” 查询，无需回表。</li>
</ul>
<h5 data-id="heading-16">（3）延迟建索引：进一步提升插入效率</h5>
<p>若插入后短期内无需查询（如当天数据仅需次日统计），可<strong>延迟建索引</strong>：</p>
<ul>
<li>插入时：仅保留主键索引，无其他索引；</li>
</ul>

<ul>
<li>凌晨低峰期：对前一天的表执行CREATE INDEX（如CREATE INDEX idx_device_time ON api_log_20251121(device_id, created_time)）；</li>
</ul>

<ul>
<li>效果：插入速度提升 30%~50%（无索引更新开销）。</li>
</ul>
<h4 data-id="heading-17">3. 表结构示例（API 日志表）</h4>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 逻辑表结构（实际按天分表，表名api_log_20251121）</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> api_log_20251121 (
  id <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="hljs-string">'主键ID'</span>,
  device_id <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span> COMMENT <span class="hljs-string">'设备ID'</span>,
  api_url <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">256</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">''</span> COMMENT <span class="hljs-string">'API地址'</span>,
  status TINYINT <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span> COMMENT <span class="hljs-string">'状态：0=失败，1=成功'</span>,
  cost_time <span class="hljs-type">INT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span> COMMENT <span class="hljs-string">'耗时（毫秒）'</span>,
  request_data <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">1024</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">''</span> COMMENT <span class="hljs-string">'请求数据'</span>,
  created_time DATETIME(<span class="hljs-number">3</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>(<span class="hljs-number">3</span>) COMMENT <span class="hljs-string">'创建时间（毫秒级）'</span>,
  <span class="hljs-keyword">PRIMARY</span> KEY (id) COMMENT <span class="hljs-string">'主键聚簇索引'</span>
  <span class="hljs-comment">-- 凌晨延迟创建联合索引：idx_device_time (device_id, created_time)</span>
) ENGINE<span class="hljs-operator">=</span>InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8mb4 COMMENT<span class="hljs-operator">=</span><span class="hljs-string">'API日志表（20251121）'</span>;
</code></pre>
<h3 data-id="heading-18">四、存储引擎与数据库选型：适配 “写入密集” 场景</h3>
<p>不同数据库 / 存储引擎的写入性能差异极大，需优先选择 “写入优化型” 引擎：</p>
<h4 data-id="heading-19">1. 关系型数据库：MySQL vs PostgreSQL</h4>
<h5 data-id="heading-20">（1）MySQL：InnoDB 引擎（默认首选）</h5>
<ul>
<li><strong>优势</strong>：支持事务（可选关闭）、聚簇索引插入高效、生态成熟（分表中间件多）；</li>
</ul>

<ul>
<li><strong>关键优化参数</strong>（my.cnf）：</li>
</ul>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-section">[mysqld]</span>
<span class="hljs-comment"># 存储引擎选择InnoDB</span>
<span class="hljs-attr">default-storage-engine</span>=InnoDB
<span class="hljs-comment"># 缓冲池大小：设为物理内存的50%-70%（如32GB内存设20GB），减少磁盘IO</span>
<span class="hljs-attr">innodb_buffer_pool_size</span>=<span class="hljs-number">20</span>G
<span class="hljs-comment"># 写入刷盘策略：每秒刷盘（平衡性能与安全性，避免掉电丢1秒内数据）</span>
<span class="hljs-attr">innodb_flush_log_at_trx_commit</span>=<span class="hljs-number">2</span>
<span class="hljs-comment"># 批量插入缓冲区：调大至64MB，提升批量插入效率</span>
<span class="hljs-attr">bulk_insert_buffer_size</span>=<span class="hljs-number">64</span>M
<span class="hljs-comment"># 日志文件大小：设为4GB，减少日志切换频率</span>
<span class="hljs-attr">innodb_log_file_size</span>=<span class="hljs-number">4</span>G
<span class="hljs-comment"># 关闭自动提交：批量插入时手动控制事务，减少事务开销</span>
<span class="hljs-attr">autocommit</span>=<span class="hljs-number">0</span>
<span class="hljs-comment"># 禁用查询缓存：写入密集场景查询缓存无效，反而增加开销</span>
<span class="hljs-attr">query_cache_type</span>=<span class="hljs-number">0</span>
</code></pre>
<ul>
<li><strong>性能测试</strong>：单表日插 1000 万条，批量插入（每次 1000 条）延迟约 5ms / 批，CPU 使用率 &lt; 30%。</li>
</ul>
<h5 data-id="heading-21">（2）PostgreSQL：TimescaleDB 扩展（时序数据最优）</h5>
<p>PostgreSQL 原生对海量时序数据支持一般，需安装<strong>TimescaleDB</strong>（时序数据库扩展）：</p>
<ul>
<li><strong>优势</strong>：自动按时间分表（无需手动管理表名）、支持时序函数（如按分钟聚合）、压缩比高（原始数据压缩 3-10 倍）；</li>
</ul>

<ul>
<li><strong>创建时序表示例</strong>：</li>
</ul>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 1. 创建扩展</span>
<span class="hljs-keyword">CREATE</span> EXTENSION IF <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> timescaledb;
<span class="hljs-comment">-- 2. 创建基础表</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> api_log (
  id <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  device_id <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  api_url <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">256</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  status TINYINT <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  cost_time <span class="hljs-type">INT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  created_time TIMESTAMPTZ(<span class="hljs-number">3</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> NOW()
);
<span class="hljs-comment">-- 3. 转换为时序表，按天分块（自动分表）</span>
<span class="hljs-keyword">SELECT</span> create_hypertable(<span class="hljs-string">'api_log'</span>, <span class="hljs-string">'created_time'</span>, chunk_time_interval <span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span> <span class="hljs-type">INTERVAL</span> <span class="hljs-string">'1 day'</span>);
<span class="hljs-comment">-- 4. 开启压缩（对3天前的块自动压缩）</span>
<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> api_log <span class="hljs-keyword">SET</span> (
  timescaledb.compress,
  timescaledb.compress_orderby <span class="hljs-operator">=</span> <span class="hljs-string">'created_time ASC'</span>,
  timescaledb.compress_segmentby <span class="hljs-operator">=</span> <span class="hljs-string">'device_id'</span>
);
<span class="hljs-keyword">SELECT</span> add_compression_policy(<span class="hljs-string">'api_log'</span>, <span class="hljs-type">INTERVAL</span> <span class="hljs-string">'3 days'</span>);
</code></pre>
<ul>
<li><strong>优势</strong>：压缩后存储成本降低 70%，年存 182TB 数据压缩后仅需 50TB 以内。</li>
</ul>
<h4 data-id="heading-22">2. NoSQL 数据库：适合 “非结构化 + 极高写入” 场景</h4>
<p>若数据无需关系约束（如日志、行为数据），可选择 NoSQL 数据库，写入性能更高：</p>
<h5 data-id="heading-23">（1）MongoDB：文档型数据库</h5>
<ul>
<li><strong>优势</strong>：支持批量插入（insertMany）、无固定表结构（适配多变数据）、分片集群支持水平扩展；</li>
</ul>

<ul>
<li><strong>分片策略</strong>：按created_time（时间范围分片），每个分片存储 1 个月数据；</li>
</ul>

<ul>
<li><strong>不足</strong>：不支持事务，复杂查询（如多表关联）性能差。</li>
</ul>
<h5 data-id="heading-24">（2）Cassandra：分布式列存储</h5>
<ul>
<li><strong>优势</strong>：写入性能极高（单节点支持 10 万条 / 秒写入）、多副本高可用、无单点故障；</li>
</ul>

<ul>
<li><strong>适用场景</strong>：IoT 设备上报（写入均匀，无复杂查询）；</li>
</ul>

<ul>
<li><strong>不足</strong>：学习成本高，生态不如 MySQL 成熟。</li>
</ul>
<h3 data-id="heading-25">五、插入性能优化：从 “单条写入” 到 “批量高效写入”</h3>
<p>即使表结构和引擎优化到位，写入方式不当仍会导致性能瓶颈，需优先采用 “批量写入”：</p>
<h4 data-id="heading-26">1. 批量插入：替代单条 INSERT</h4>
<p>单条INSERT（如INSERT INTO api_log VALUES (1, ...), (2, ...)）每次需建立连接、解析 SQL，效率极低，<strong>批量插入</strong>是提升写入效率的核心手段：</p>
<h5 data-id="heading-27">（1）MySQL 批量插入示例（每次 1000 条）</h5>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 批量插入1000条数据，手动控制事务</span>
<span class="hljs-keyword">START</span> TRANSACTION;
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> api_log_20251121 (device_id, api_url, status, cost_time)
<span class="hljs-keyword">VALUES</span> 
(<span class="hljs-number">1001</span>, <span class="hljs-string">'/api/login'</span>, <span class="hljs-number">1</span>, <span class="hljs-number">50</span>),
(<span class="hljs-number">1002</span>, <span class="hljs-string">'/api/pay'</span>, <span class="hljs-number">0</span>, <span class="hljs-number">200</span>),
<span class="hljs-comment">-- ... 省略998条 ...</span>
(<span class="hljs-number">2000</span>, <span class="hljs-string">'/api/order'</span>, <span class="hljs-number">1</span>, <span class="hljs-number">150</span>);
<span class="hljs-keyword">COMMIT</span>;
</code></pre>
<ul>
<li><strong>批量大小选择</strong>：每次 1000-5000 条（太大易导致 SQL 解析超时，太小则连接开销大）；</li>
</ul>

<ul>
<li><strong>性能提升</strong>：批量插入比单条插入效率提升 5-10 倍（从 100ms / 条降至 5ms / 批）。</li>
</ul>
<h5 data-id="heading-28">（2）应用层批量处理（Java 示例）</h5>
<p>用 MyBatis 批量插入，避免手动拼接 SQL：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// Mapper接口</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ApiLogMapper</span> {
    <span class="hljs-meta">@Insert</span>(<span class="hljs-string">"&lt;script&gt;"</span> +
            <span class="hljs-string">"INSERT INTO api_log_${dateStr} (device_id, api_url, status, cost_time) "</span> +
            <span class="hljs-string">"VALUES "</span> +
            <span class="hljs-string">"&lt;foreach collection='list' item='item' separator=','&gt;"</span> +
            <span class="hljs-string">"(#{item.deviceId}, #{item.apiUrl}, #{item.status}, #{item.costTime})"</span> +
            <span class="hljs-string">"&lt;/foreach&gt;"</span> +
            <span class="hljs-string">"&lt;/script&gt;"</span>)
    <span class="hljs-built_in">void</span> <span class="hljs-title function_">batchInsert</span>(<span class="hljs-meta">@Param</span>(<span class="hljs-string">"list"</span>) <span class="hljs-title class_">List</span>&lt;<span class="hljs-title class_">ApiLogDO</span>&gt; list, <span class="hljs-meta">@Param</span>(<span class="hljs-string">"dateStr"</span>) <span class="hljs-title class_">String</span> dateStr);
}
<span class="hljs-comment">// 业务代码：积累1000条批量插入</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ApiLogService</span> {
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">ApiLogMapper</span> apiLogMapper;
    
    <span class="hljs-comment">// 内存队列：临时缓存待插入数据</span>
    <span class="hljs-keyword">private</span> final <span class="hljs-title class_">BlockingQueue</span>&lt;<span class="hljs-title class_">ApiLogDO</span>&gt; queue = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayBlockingQueue</span>&lt;&gt;(<span class="hljs-number">10000</span>);
    
    <span class="hljs-comment">// 定时任务：每1秒批量插入一次（或队列满1000条插入）</span>
    <span class="hljs-meta">@Scheduled</span>(fixedRate = <span class="hljs-number">1000</span>)
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">batchInsertTask</span>(<span class="hljs-params"/>) {
        <span class="hljs-title class_">List</span>&lt;<span class="hljs-title class_">ApiLogDO</span>&gt; batchList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;(<span class="hljs-number">1000</span>);
        queue.<span class="hljs-title function_">drainTo</span>(batchList, <span class="hljs-number">1000</span>); <span class="hljs-comment">// 从队列取最多1000条</span>
        <span class="hljs-keyword">if</span> (!batchList.<span class="hljs-title function_">isEmpty</span>()) {
            <span class="hljs-title class_">String</span> dateStr = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleDateFormat</span>(<span class="hljs-string">"yyyyMMdd"</span>).<span class="hljs-title function_">format</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());
            apiLogMapper.<span class="hljs-title function_">batchInsert</span>(batchList, dateStr);
        }
    }
    
    <span class="hljs-comment">// 接收单条数据，加入队列</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">addLog</span>(<span class="hljs-params">ApiLogDO logDO</span>) {
        <span class="hljs-keyword">try</span> {
            queue.<span class="hljs-title function_">put</span>(logDO); <span class="hljs-comment">// 队列满时阻塞，避免数据丢失</span>
        } <span class="hljs-keyword">catch</span> (<span class="hljs-title class_">InterruptedException</span> e) {
            <span class="hljs-title class_">Thread</span>.<span class="hljs-title function_">currentThread</span>().<span class="hljs-title function_">interrupt</span>();
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"日志插入队列满"</span>);
        }
    }
}
</code></pre>
<h4 data-id="heading-29">2. 异步写入：解耦业务与写入</h4>
<p>若业务无需 “写入成功” 同步返回（如日志采集），可采用 “异步写入” 进一步提升性能：</p>
<ul>
<li><strong>架构</strong>：业务系统 → Kafka（消息队列）→ 消费端（批量写入数据库）；</li>
</ul>

<ul>
<li><strong>优势</strong>：</li>
</ul>
<ol>
<li>
<ol>
<li>业务系统无需等待数据库写入，响应时间从 50ms 降至 1ms；</li>
</ol>
</li>
</ol>

<ol>
<li>
<ol start="2">
<li>Kafka 缓冲峰值流量（如秒杀时日志突增），避免数据库被压垮；</li>
</ol>
</li>
</ol>

<ol>
<li>
<ol start="3">
<li>消费端可横向扩展（多实例消费），支撑更高写入吞吐量；</li>
</ol>
</li>
</ol>
<ul>
<li><strong>注意</strong>：需开启 Kafka 消息持久化（避免掉电丢数据），消费端需处理重复消息（数据库主键唯一约束去重）。</li>
</ul>
<h3 data-id="heading-30">六、数据归档与清理：控制存储成本</h3>
<p>日增 500GB 数据，若不清理，半年后磁盘空间将超 90TB，需制定<strong>数据生命周期管理策略</strong>：</p>
<h4 data-id="heading-31">1. 数据分层存储：热数据 + 冷数据</h4>
<ul>
<li><strong>热数据</strong>（近 30 天）：存储在高性能数据库（如 MySQL/PostgreSQL），支持实时查询；</li>
</ul>

<ul>
<li><strong>冷数据</strong>（30 天 - 1 年）：归档到低成本存储（如 HDFS、对象存储 S3/OSS），用 Parquet/Orc 格式压缩（压缩比 3-5 倍）；</li>
</ul>

<ul>
<li><strong>归档工具</strong>：</li>
</ul>

<ul>
<li>
<ul>
<li>MySQL：用mysqldump或xtrabackup导出冷数据，再导入 HDFS；</li>
</ul>
</li>
</ul>

<ul>
<li>
<ul>
<li>PostgreSQL/TimescaleDB：用COPY命令导出为 CSV，再压缩上传至对象存储。</li>
</ul>
</li>
</ul>
<h4 data-id="heading-32">2. 过期数据清理：高效删除</h4>
<ul>
<li><strong>按天分表场景</strong>：直接DROP TABLE api_log_20250821（毫秒级完成），比DELETE FROM快 1000 倍；</li>
</ul>

<ul>
<li><strong>TimescaleDB 场景</strong>：用drop_chunks命令删除旧块（如删除 3 个月前数据）：</li>
</ul>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> drop_chunks(<span class="hljs-type">interval</span> <span class="hljs-string">'3 months'</span>, <span class="hljs-string">'api_log'</span>);
</code></pre>
<ul>
<li><strong>清理频率</strong>：每天凌晨执行，删除 “超过保留期” 的表 / 块。</li>
</ul>
<h3 data-id="heading-33">七、高可用设计：避免写入中断</h3>
<p>日增千万数据场景下，数据库不可用将导致数据丢失，需构建高可用架构：</p>
<h4 data-id="heading-34">1. 主从复制：读写分离</h4>
<ul>
<li><strong>架构</strong>：1 主 N 从，主库负责写入，从库负责查询（如统计分析）；</li>
</ul>

<ul>
<li><strong>MySQL</strong>：开启半同步复制（rpl_semi_sync_master_enabled=1），确保至少 1 个从库收到 binlog 后再返回成功，避免主库宕机丢数据；</li>
</ul>

<ul>
<li><strong>PostgreSQL</strong>：用流复制构建主从架构，从库实时同步主库数据。</li>
</ul>
<h4 data-id="heading-35">2. 分库分表高可用：避免单库故障</h4>
<ul>
<li>每个分库部署主从架构，某分库主库宕机后，从库自动切换为新主库；</li>
</ul>

<ul>
<li>中间件（如 ShardingSphere）支持故障自动路由，业务无感知。</li>
</ul>
<h4 data-id="heading-36">3. 监控告警：提前发现问题</h4>
<ul>
<li><strong>核心监控指标</strong>：</li>
</ul>

<ul>
<li>
<ul>
<li>写入延迟（批量插入耗时 &gt; 20ms 告警）；</li>
</ul>
</li>
</ul>

<ul>
<li>
<ul>
<li>数据库连接数（超过 80% 上限告警）；</li>
</ul>
</li>
</ul>

<ul>
<li>
<ul>
<li>磁盘空间（使用率 &gt; 85% 告警）；</li>
</ul>
</li>
</ul>

<ul>
<li>
<ul>
<li>主从同步延迟（超过 10 秒告警）；</li>
</ul>
</li>
</ul>

<ul>
<li><strong>工具选型</strong>：Prometheus+Grafana 监控，AlertManager 触发短信 / 钉钉告警。</li>
</ul>
<h3 data-id="heading-37">总结：日增千万数据的核心设计原则</h3>
<ol>
<li><strong>分表分库是基础</strong>：按时间分表，单表数据量控制在 1000 万以内，避免单表瓶颈；</li>
</ol>

<ol start="2">
<li><strong>表结构极简</strong>：用合适数据类型，少索引，避免 NULL 值，为插入效率服务；</li>
</ol>

<ol start="3">
<li><strong>存储引擎适配</strong>：MySQL InnoDB（通用）、PostgreSQL+TimescaleDB（时序数据）、NoSQL（非结构化）；</li>
</ol>

<ol start="4">
<li><strong>写入方式优化</strong>：批量插入 + 异步写入，最大化吞吐量；</li>
</ol>

<ol start="5">
<li><strong>生命周期管理</strong>：热冷数据分层，过期数据高效清理，控制存储成本；</li>
</ol>

<ol start="6">
<li><strong>高可用保障</strong>：主从复制 + 分库高可用，避免写入中断。</li>
</ol>
<p>这套方案可支撑 “日增 1000 万条数据” 的高效插入与存储，同时兼顾查询需求与成本控制，已在日志采集、IoT 上报等场景落地验证，插入延迟稳定在 5-10ms，存储成本降低 60% 以上。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[如何抓包 (How to Capture Packets) - 完整指南与实用技巧]]></title>    <link>https://juejin.cn/post/7574803558878494735</link>    <guid>https://juejin.cn/post/7574803558878494735</guid>    <pubDate>2025-11-21T09:22:36.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574803558878494735" data-draft-id="7574749664493060130" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="如何抓包 (How to Capture Packets) - 完整指南与实用技巧"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-21T09:22:36.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="00后程序员"/> <meta itemprop="url" content="https://juejin.cn/user/1159358440539900"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            如何抓包 (How to Capture Packets) - 完整指南与实用技巧
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1159358440539900/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    00后程序员
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T09:22:36.000Z" title="Fri Nov 21 2025 09:22:36 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>如何抓包 (How to Capture Packets)</p>
<p>在现代网络环境中，抓包（Packet Capture）是一项非常重要的技能。无论是网络故障排查、安全分析，还是性能优化，掌握抓包的技巧都能帮助我们更好地理解网络流量和数据传输的过程。本文将详细介绍抓包的基本概念、工具、方法以及一些实用的技巧。</p>
<p>什么是抓包 (What is Packet Capture)</p>
<p>抓包是指在网络传输过程中，捕获并分析数据包的过程。数据包是网络通信中传输的基本单位，它包含了源地址、目的地址、协议类型、数据负载等信息。通过抓包，我们可以深入了解网络流量，识别潜在问题，甚至发现安全隐患。</p>
<p>抓包的应用场景 (Applications of Packet Capture)</p>
<p>抓包技术广泛应用于多个领域，主要包括：</p>
<ol>
<li><strong>网络故障排查</strong>：通过分析抓取的数据包，可以快速定位网络故障的原因，例如丢包、延迟等问题。</li>
<li><strong>安全分析</strong>：抓包可以帮助安全专家识别恶意流量、攻击行为和数据泄露等安全问题。</li>
<li><strong>性能优化</strong>：通过监测网络流量，识别性能瓶颈，从而优化网络配置和应用性能。</li>
<li><strong>协议分析</strong>：抓包可以帮助开发人员理解和调试网络协议，确保其正常工作。</li>
</ol>
<p>常用的抓包工具 (Common Packet Capture Tools)</p>
<p>在抓包过程中，选择合适的工具至关重要。以下是一些常用的抓包工具：</p>
<ol>
<li><strong>Wireshark</strong>：Wireshark 是一款功能强大的开源抓包工具，支持多种操作系统。它提供了丰富的分析功能，能够对捕获的数据包进行深度解析。</li>
<li><strong>tcpdump</strong>：tcpdump 是一个命令行工具，适用于 Unix/Linux 系统。它轻量级且高效，适合在服务器上进行抓包。</li>
<li><strong>Fiddler</strong>：Fiddler 是一款专注于 HTTP/HTTPS 流量的抓包工具，常用于Web开发和调试。</li>
<li><strong>Charles Proxy</strong>：类似于 Fiddler，Charles Proxy 也是一款用于 HTTP/HTTPS 流量抓包的工具，支持多平台。</li>
<li><strong>Burp Suite</strong>：Burp Suite 是一款集成的Web应用安全测试工具，提供了强大的抓包和分析功能。</li>
<li><strong>Sniffmaster</strong>：Sniffmaster 是一款全平台抓包工具，支持 HTTPS、TCP 和 UDP 协议，可在 iOS、Android、Mac 和 Windows 设备上实现无需代理、越狱或 root 的抓包操作，提供免费的代理抓包功能，适合各种抓包需求。</li>
</ol>
<p>如何使用 Wireshark 抓包 (How to Use Wireshark for Packet Capture)</p>
<p>Wireshark 是最常用的抓包工具之一，下面是使用 Wireshark 抓包的基本步骤：</p>
<ol>
<li>安装 Wireshark (Install Wireshark)</li>
</ol>
<p>首先，从 Wireshark 的官方网站下载并安装最新版本的 Wireshark。安装过程中，可以选择安装 WinPcap 或 Npcap（用于捕获网络流量的驱动程序）。</p>
<ol start="2">
<li>启动 Wireshark (Launch Wireshark)</li>
</ol>
<p>安装完成后，启动 Wireshark。在主界面上，你会看到可用的网络接口列表。</p>
<ol start="3">
<li>选择网络接口 (Select Network Interface)</li>
</ol>
<p>选择你想要抓包的网络接口。如果你在使用无线网络，可以选择 Wi-Fi 接口；如果是有线网络，选择相应的以太网接口。</p>
<ol start="4">
<li>开始抓包 (Start Capturing)</li>
</ol>
<p>点击“开始捕获”按钮，Wireshark 将开始捕获经过所选接口的所有数据包。你可以在界面上看到实时更新的数据包列表。</p>
<ol start="5">
<li>停止抓包 (Stop Capturing)</li>
</ol>
<p>完成抓包后，点击“停止捕获”按钮。此时，你可以对捕获到的数据包进行分析。</p>
<ol start="6">
<li>分析数据包 (Analyze Packets)</li>
</ol>
<p>Wireshark 提供了强大的过滤和分析功能。你可以使用过滤器来查找特定类型的数据包，例如 HTTP、TCP 或 UDP。点击某个数据包，可以查看其详细信息，包括协议层、源地址、目的地址等。</p>
<p>使用 tcpdump 抓包 (Using tcpdump for Packet Capture)</p>
<p>tcpdump 是一款命令行工具，适合在服务器上进行抓包。以下是使用 tcpdump 的基本步骤：</p>
<ol>
<li>安装 tcpdump (Install tcpdump)</li>
</ol>
<p>在大多数 Linux 发行版中，tcpdump 可以通过包管理器直接安装。例如，在 Ubuntu 中，可以使用以下命令：</p>
<p>sudo apt-get install tcpdump</p>
<ol start="2">
<li>查看网络接口 (List Network Interfaces)</li>
</ol>
<p>使用以下命令查看可用的网络接口：</p>
<p>tcpdump -D</p>
<ol start="3">
<li>开始抓包 (Start Capturing)</li>
</ol>
<p>选择一个网络接口并开始抓包。例如，抓取 eth0 接口的数据包：</p>
<p>sudo tcpdump -i eth0</p>
<ol start="4">
<li>保存抓包文件 (Save Capture File)</li>
</ol>
<p>如果需要保存抓包数据，可以使用 -w参数。例如：</p>
<p>sudo tcpdump -i eth0 -w capture.pcap</p>
<ol start="5">
<li>停止抓包 (Stop Capturing)</li>
</ol>
<p>在终端中按 Ctrl+C停止抓包。</p>
<ol start="6">
<li>分析抓包文件 (Analyze Capture File)</li>
</ol>
<p>可以使用 Wireshark 打开保存的 .pcap文件进行详细分析。</p>
<p>抓包的注意事项 (Considerations for Packet Capture)</p>
<p>在进行抓包时，有几个注意事项需要牢记：</p>
<ol>
<li><strong>法律和隐私</strong>：在抓包之前，确保你有权限捕获网络流量。未经授权的抓包可能会违反法律或公司政策。</li>
<li><strong>数据量</strong>：抓包可能会产生大量数据，尤其是在高流量网络中。确保你有足够的存储空间，并定期清理不必要的抓包文件。</li>
<li><strong>性能影响</strong>：在高负载环境下，抓包可能会影响网络性能。尽量在非高峰时段进行抓包，或使用过滤器限制捕获的数据量。</li>
<li><strong>分析能力</strong>：抓包只是第一步，后续的数据分析和问题定位同样重要。学习如何有效地分析数据包是抓包技能的重要组成部分。</li>
</ol>
<p>实用的抓包技巧 (Practical Packet Capture Tips)</p>
<p>以下是一些实用的抓包技巧，可以帮助你更高效地进行抓包和分析：</p>
<ol>
<li><strong>使用过滤器</strong>：在抓包时，使用过滤器可以减少捕获的数据量。例如，在 Wireshark 中，可以使用http过滤器仅捕获 HTTP 流量。</li>
<li><strong>标记重要数据包</strong>：在抓包过程中，可以使用 Wireshark 的标记功能标记重要的数据包，以便后续分析。</li>
<li><strong>分析流量图</strong>：Wireshark 提供了流量图功能，可以帮助你直观地了解网络流量的变化情况。</li>
<li><strong>结合其他工具</strong>：抓包可以与其他网络分析工具结合使用，例如性能监控工具，提供更全面的网络分析视角。</li>
<li><strong>定期复习</strong>：网络协议和抓包工具的更新较快，定期复习相关知识和技能，保持与时俱进。</li>
</ol>
<p>结论 (Conclusion)</p>
<p>抓包是一项重要的网络技能，能够帮助我们深入了解网络流量、排查故障和提升安全性。通过掌握抓包工具和技巧，我们可以更有效地进行网络分析和问题解决。希望本文能为你提供实用的指导，帮助你在抓包的道路上不断进步。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【压力】一位一线炼钢工人的消失]]></title>    <link>https://juejin.cn/post/7574992086714843151</link>    <guid>https://juejin.cn/post/7574992086714843151</guid>    <pubDate>2025-11-21T09:25:38.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574992086714843151" data-draft-id="7574978847151423528" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【压力】一位一线炼钢工人的消失"/> <meta itemprop="keywords" content="前端,后端"/> <meta itemprop="datePublished" content="2025-11-21T09:25:38.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="狗头大军之江苏分军"/> <meta itemprop="url" content="https://juejin.cn/user/2955079655907879"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【压力】一位一线炼钢工人的消失
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2955079655907879/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    狗头大军之江苏分军
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T09:25:38.000Z" title="Fri Nov 21 2025 09:25:38 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>来源于 三联生活周刊 · 2021年第16期<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.lifeweek.com.cn%2Fmagazine%2F2763" target="_blank" title="https://www.lifeweek.com.cn/magazine/2763" ref="nofollow noopener noreferrer">《寻访一座咖啡城市》</a></p>
<p>2010年，王龙大学毕业后进入包钢集团做转炉工，成为一线炼钢工人。这个家庭在缓慢脱离贫穷的过去，试图迈入更好的生活。但2021年3月24日，他在自己工作了11年的生产线上结束了这一切。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3e8fb3a6ac384df5a17f29a94e5dcb8f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54uX5aS05aSn5Yab5LmL5rGf6IuP5YiG5Yab:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764321938&amp;x-signature=l8Ciwr156cFywQ5vVzehIsuyf1M%3D" alt="" loading="lazy"/></p>
<p>（插图 老牛）</p>
<p>编辑·陈晓</p>
<h3 data-id="heading-0">消失</h3>
<p>2021年3月24日，一个晴朗的周三。晚上8点前，包钢集团〔全称包头钢铁（集团）有限责任公司〕的夜班工人要准时和白班工人交接。直到次日清晨8点，炼钢工人要在封闭的厂房里工作12个小时。王龙是集团制钢二部的炼钢工人，今年34岁，2010年大学毕业后就进入包钢集团炼钢厂，已工作了11年，勉强够得上“老员工”的称呼。</p>
<p>这天轮到王龙所在班组值夜班，说是傍晚8点交班，工人们大多6点多钟吃完饭就往集团赶。包钢集团位于内蒙古包头市昆都仑区西北侧，成立于1954年，1959年投产，是国家在“一五”期间建设的156个重点项目之一，目前是世界最大的稀土工业基地和我国重要的钢铁工业基地，有在册职工4.8万人，也是包头市吸纳员工最多的国企。当地有一种说法——包头市昆都仑区80%的人都与包钢有关系，要么是包钢员工，要么是员工家属。</p>
<p>“包钢”两个字渗进这个城市的各个角落。以“包钢”开头命名的学校，从幼儿园到高中，排到了包钢第26小学。医院、小区、公交站，也带有包钢名称，甚至一条通往包钢集团的主路，也被命名为“钢铁大街”。每到上下班时间，昆都仑区南桥、中桥、北桥三座平行的大桥上，电动车、自行车和各种车辆往来穿梭，大桥连接着从市区进入包钢集团的道路。</p>
<p>3月24日这天傍晚，王龙骑着自行车穿过南桥，进入集团。他是炼钢工，更确切一点说，是炼钢工序里的转炉工，负责把铁水炼成钢水，也被称为一线工人。通常五个一线工人一组，分为甲、乙、丙、丁四个班组，每组12个小时轮流倒白班、夜班，全年不停歇地负责一台转炉。王龙负责7号转炉，在班组里当一助手，是除了炉长外第二等级的员工。</p>
<p>晚上7点多，王龙到公司，换上深蓝色防热工服、戴上红色安全帽，7点45分开交接会，之后进厂房工作。在炼钢过程中，一助手的工作之一是看氧枪。转炉炼钢的过程中，氧枪会沾上钢和渣子，一助手负责清理氧枪上的渣子，防止渣子聚集，影响生产。这个程序在每个转炉炼钢过程中都要执行一次。但当晚22点54分，在这个7层、52米高的厂房里，工友发现，一助手王龙消失了。</p>
<p>没人看见他离开岗位，也没人发现他去了哪里，直到调出监控，才发现王龙的踪迹。在当晚22点54分18秒到22点54分44秒的监控视频中，王龙独自走到正在运作的7号转炉喷渣口，面前是闪着红光的大坑。他站在坑边，探头往里看了看，随后取下头上的帽子，往前走了几步。接下来将近9秒的时间，他慢慢往坑边踱步，弯腰，探头往下看了两次，第三次探头后，他跳入坑中。两三秒后，坑中腾起一团团黑烟。</p>
<p>包钢集团一位老工人高盛，和集团内大多数员工一样，在3月25日看到那则视频。他告诉本刊记者，视频中王龙跳入的喷渣口下方三四米处，是一个梯形敞口渣罐，渣罐大口朝上，直径约2米，装着转炉炼钢时产生的废渣。“一炉钢水120吨，温度在1500～1600摄氏度之间，刚倒下去的废渣，最少也有1200摄氏度。”他根据视频里模糊的转炉形状判断，王龙是在出钢时，废渣刚倒入罐中不久跳入的。“那么高的温度,渣罐表面那一层应该已经没有氧气了，估计瞬间就窒息了。”</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[循环神经网络RNN是什么？终于有人讲清楚了！]]></title>    <link>https://juejin.cn/post/7574916588718850090</link>    <guid>https://juejin.cn/post/7574916588718850090</guid>    <pubDate>2025-11-21T09:32:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574916588718850090" data-draft-id="7574996958516051987" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="循环神经网络RNN是什么？终于有人讲清楚了！"/> <meta itemprop="keywords" content="LLM"/> <meta itemprop="datePublished" content="2025-11-21T09:32:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="智泊AI"/> <meta itemprop="url" content="https://juejin.cn/user/3572727470361578"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            循环神经网络RNN是什么？终于有人讲清楚了！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3572727470361578/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    智泊AI
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T09:32:03.000Z" title="Fri Nov 21 2025 09:32:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong>一、循环神经网络基本概念</strong></p>
<p>循环神经网络（RNN）‌作为人工神经网络的一种，其核心特性在于能够处理具有时序依赖的数据。</p>
<p>与传统神经网络不同，常规神经网络（如卷积神经网络）通常独立处理每个输入输出样本，例如图像分类中每张图片的特征提取互不关联。</p>
<p>而RNN通过‌记忆机制‌捕捉序列数据的前后关联性。以句子"我想吃北京烤鸭"为例：</p>
<p>首字"我"作为主语，会引导后续动词"吃"的出现概率提升；</p>
<p>动词"吃"进一步约束后续名词类型，使"食物"类词汇（如"烤鸭"）的生成概率显著高于其他名词；</p>
<p>地域词"北京"与食物"烤鸭"的搭配也受到前文语义的直接影响。</p>
<p>这种‌序列建模能力‌使RNN在自然语言处理、时序预测等深度学习领域成为不可替代的工具。</p>
<p><strong>二、为什么需要RNN</strong></p>
<p>CNN存在两个主要局限性：其一，其特征传递是单向的，导致同层特征间缺乏交互；其二，输入层要求固定长度特征（例如100个单元），若需扩充输入信息则处理难度较大。</p>
<p>CNN更擅长处理二维图像数据，能够提取并归纳图像的深层特征。</p>
<p>然而现实场景中存在大量随时间演变的数据（如气温年度波动、人体生理信号、陀螺仪输出等），这类时序数据具有显著的时间依赖性，前后数据存在关联性。</p>
<p>因此需要一种能够保留历史特征记忆的模型，这正是RNN的用武之地。</p>
<p><strong>三、最简单的RNN模型</strong></p>
<p>大家应该都见过网上这类图片吧？左图简洁到抽象，但第一眼真让人摸不着头脑。</p>
<p>转到右侧的时间展开图就清晰多了：初始状态h0之后，依次排列着4个时间步的输入x1到x4。</p>
<p>这些特征可能是向量/矩阵，甚至单个数值，但那个h到底代表什么？还是得继续往下看才能明白。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a86608b4fb4c45468bd140301d613f72~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm65rOKQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764322323&amp;x-signature=t0zYqPUBBqNwCIKCkXtL9yHdrjY%3D" alt="图片" loading="lazy"/></p>
<p>看下面这个图，表达的就很清楚了，Wih就是输入到神经网络的权重参数，与输入有关，所以用i。Whh是隐藏层到神经网络的权重参数，所以用h标记，b就是偏置了。</p>
<p>ht-1和xt都是神经网络的输入，与各自的权重系数相乘，再加上偏置，就是标准的神经元运算过程，只不过后面加了一步求和再激活，h的数值和过去有关，相当于一个记忆。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ab3508d5aecc47bfa44c3e5b9844301e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm65rOKQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764322323&amp;x-signature=Q41juu2rJ96ZJxRuIUD5eW9ZHR4%3D" alt="图片" loading="lazy"/></p>
<p>为了更清晰地展示细节，下图直观呈现了关键结构。需特别说明的是，图中虽显示为两个隐藏层，但实际为同一隐藏层在不同时间步的复用。</p>
<p>由于各时间步的权重矩阵存在差异，因此隐藏层的运算结果也会相应变化。该图完整展示了RNN单步的计算流程，理解此图即可掌握RNN的核心原理。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/75bbda6e66e94dd5a5e534024796fc88~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm65rOKQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764322323&amp;x-signature=RxZvOOaE3Eqgsuijw7hCpUvQ6Go%3D" alt="图片" loading="lazy"/></p>
<p>‌输入特征x的维度取决于数据本身的性质‌：例如在气候分析场景中，通常将风速、大气温度、相对湿度等作为特征变量；而对于心电信号而言，输入特征则是单通道体表电位测量值。</p>
<p>如图示案例所示，心电信号的时间序列包含300个采样点（即300个时间步长），由于每个时间步仅对应1个测量值，因此其特征维度为1。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ac1d2333e1bc40e59577332338cb0068~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm65rOKQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764322323&amp;x-signature=%2F8%2F5wN1HuPuRoNIll3mz24GrSdM%3D" alt="图片" loading="lazy"/></p>
<p>隐藏层中神经元的数量由hidden_size参数决定，显然，神经元数量增加会导致计算量上升。</p>
<p>接下来说明RNN为何能适应变长输入。</p>
<p>观察下方动图可知，在自然语言处理中，每个词作为独立的输入特征按序传递即可，句子长度不会构成限制，本质上只需增加数据传递的频次。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1fde577a812c4affb00551b870940914~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm65rOKQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764322323&amp;x-signature=AoyxFrP54uIZKe91Q5%2BcnlGirGo%3D" alt="图片" loading="lazy"/></p>
<p>但是，RNN的计算复杂度是和序列长度（时间步长度）呈线性关系的。</p>
<p>RNN的隐藏层可以不只1层，但是一般不超过3层。</p>
<p><strong>四、双向RNN</strong></p>
<p>传统的RNN结构模型仅能处理历史时序数据，无法纳入未来信息。</p>
<p>为解决这一局限，双向RNN结构通过将输入特征序列进行倒序排列，并在模型中引入反向传播隐藏层，最终将反向传播结果与前向输出相结合作为整体输出。</p>
<p>以隐藏层神经元数量为25为例，每个时间步的输出结果会由正向25维和反向25维数据共同构成，形成50维的最终输出特征。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8c540c7e75d349e9a649d8b21d3fe3c4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm65rOKQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764322323&amp;x-signature=M%2BQYDcLoqXjlcjlqghwjPi45HYg%3D" alt="图片" loading="lazy"/></p>
<p>通过提取最终时间步的输出特征，该特征已整合了所有输入时间步的信息，从而有效捕捉时序数据的动态关联性。</p>
<p>对于分类任务，仅需在模型末端叠加全连接层即可实现类别预测。</p>
<p><strong>五、重要参数</strong></p>
<p>先看pytorch官网对于RNN的模型定义</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/035fc1ad5172430db42feeaa231d84e1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm65rOKQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764322323&amp;x-signature=HkHKaWc%2BRmnl64dcPlm6ZH55n4A%3D" alt="图片" loading="lazy"/></p>
<p>下面结合实例来看一下，这个RNN模型接收上面的心电信号，共300个采样数据，也就是300个时间步，每次输入的特征只有一个：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a5898c81b414490fba1d8b5fc567d4ba~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm65rOKQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764322323&amp;x-signature=vjAyYnjse500nzcdziH8d0wYEz0%3D" alt="图片" loading="lazy"/></p>
<p>该RNN模型采用单样本输入方式，每个样本包含300个采样点。模型在内部会执行300次迭代计算，由于配置了50个神经元，因此每次迭代都会产生一个50维的输出向量。</p>
<p>在训练过程中，我们仅保留最终时间步（第300步）的输出结果Y300，将其作为特征输入到全连接层。</p>
<p>通过构建一个从50维特征空间到5类输出的神经网络映射关系，最终实现五分类任务。</p>
<p>具体实现方式如图所示：提取Y300中的50个特征维度，建立50到5的线性变换结构完成分类输出。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ba6ce58418074f29bb4a86a169dd0806~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm65rOKQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764322323&amp;x-signature=ONJ0DRF8rrp%2BelPCt5PgeDDmiGY%3D" alt="图片" loading="lazy"/></p>
<p><strong>六、结语</strong></p>
<p>有了上面的RNN模型基础，针对RNN模型的很多变种，如LSTM、GRU等，就可以很快理解并使用了。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[51 岁周志华、53 岁刘云浩，当选中国科学院院士！]]></title>    <link>https://juejin.cn/post/7575006095388213257</link>    <guid>https://juejin.cn/post/7575006095388213257</guid>    <pubDate>2025-11-21T09:29:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575006095388213257" data-draft-id="7575006095388147721" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="51 岁周志华、53 岁刘云浩，当选中国科学院院士！"/> <meta itemprop="keywords" content="人工智能,OpenAI"/> <meta itemprop="datePublished" content="2025-11-21T09:29:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="新智元"/> <meta itemprop="url" content="https://juejin.cn/user/952600743642312"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            51 岁周志华、53 岁刘云浩，当选中国科学院院士！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/952600743642312/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    新智元
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T09:29:23.000Z" title="Fri Nov 21 2025 09:29:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读12分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/22dfe20b6bd24bb69e7dcc3666714e69~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764322163&amp;x-signature=PZXwXWxhCSPqP47sl7Q32NaI1z8%3D" alt="" loading="lazy"/></p>
<h5 data-id="heading-0"><strong>「【新智元导读】刚刚，清华大学刘云浩和南京大学周志华，正式当选中国科学院院士。」</strong></h5>
<p>2025 年中国科学院院士增选当选院士公布！</p>
<p>中国科学院选举产生了 73 名中国科学院院士和 27 名中国科学院外籍院士。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4220cee5dcc04d11adeb5e7fd77d2ffb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764322163&amp;x-signature=uYPKPBBxqB%2BSBwpID4dS8K5E8OE%3D" alt="" loading="lazy"/></p>
<p>计算机领域，清华大学的刘云浩教授，正式当选中国科学院院士。</p>
<p>人工智能领域，南京大学周志华教授，正式当选中国科学院院士。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a56ffa8bbd1b4a5ebfd0fa7e1b0fea98~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764322163&amp;x-signature=ZZkXvgrmoNIMjv2BWbpTF0zCUME%3D" alt="" loading="lazy"/></p>
<p><strong>「刘云浩」</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/31de56980bb249aea3a63b0439f46bf8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764322163&amp;x-signature=i3%2B1Q2yS68npvj8fH1ych48yJMA%3D" alt="" loading="lazy"/></p>
<p>刘云浩，1971 年 11 月出生，现年 53 岁。</p>
<p>他于 1995 年在清华大学自动化系，获得工学学士学位；1997 年在北京外国语大学高级翻译学院，获得文学硕士学位。</p>
<p>随后，他分别于 2003 年和 2004 年，在美国密歇根州立大学计算机系，获得工学硕士和工学博士学位。</p>
<p>他曾出任：</p>
<ul>
<li>信息产业部邮政电子办副主任兼党支部书记；</li>
<li>香港科技大学计算机科学与工程系副教授、系研究生部主任；</li>
<li>清华大学信息科学与技术国家实验室特别研究员；</li>
<li>教育部信息系统安全重点实验室主任；</li>
<li>清华大学可信网络与系统研究所所长；</li>
<li>清华大学软件学院院长。</li>
</ul>
<p>2011 年，入选国家首批青千、国家杰青、长江学者。2014 年 11 月，入选 IEEE Fellow；2015 年 12 月，入选 ACM Fellow。</p>
<p>刘云浩在一年之内，拿遍国家青千、国家杰青、长江学者。</p>
<p>有人称赞他，仅用一年时间，就走完了很多人可能一辈子都走不完的科研之路。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ea985a2a274b4170901ab8f4d127f4e5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764322163&amp;x-signature=H9ERwM3KwWDQpGlPc6R70wEGlAA%3D" alt="" loading="lazy"/></p>
<p><strong>「<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f329e7f1f2c148958e74c93a76f82c38~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764322163&amp;x-signature=6IO3RhU%2FaAtPvR5tP0vhkyoE5s8%3D" alt="" loading="lazy"/>」</strong></p>
<p><strong>「国家邮电部最年轻的处长」</strong>，却弃政从学</p>
<p><strong>「看完他的履历，你肯定会惊叹，为什么有这么牛的人？」</strong></p>
<p>刘云浩身高 193cm，90 年代初在清华大学自动化系读本科，获工学学士学位。</p>
<p>在校期间曾是排球国家级运动员，北京代表队队员，还代表北京获得全国比赛亚军。</p>
<p>在校期间还写过历史小说，开过创业公司，据说当时一年的流水就过了千万。</p>
<p>本科毕业后放弃保研，选择报考北京外国语大学高级翻译学院，获得文学硕士学位。</p>
<p>北外毕业后出人意料地选择从政，<strong>「不到 30 岁就成为当时国家邮电部最年轻的处长。」</strong></p>
<p>30 岁时，刘云浩突然意识到，最适合自己的还是科研工作。</p>
<p>而立之年选择出国去美国密西根州立大学留学，<strong>「仅三年多就拿下计算机硕士和博士。」</strong></p>
<p>他用不到 20 天时间准备并考完 TOFEL 和 GRE，在美国密西根州立大学三年零九个月就拿到了硕士和博士。</p>
<p>而且博士论文在美国密歇根州立大学获得优秀奖，成为该系历史上第二快毕业的博士。</p>
<p>博士毕业在香港科技大学任教数年后又回到清华大学做教授，入选首批青年千人、国家杰青、长江学者、IEEE Fellow、ACM Fellow，2011 年以第一完成人获得国家自然科学二等奖。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0c375be0b73b4da4b0ef1557f0656b6f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764322163&amp;x-signature=T9O8hZkJt4vdeBlelqWUf18aKCE%3D" alt="" loading="lazy"/></p>
<p><strong>「<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/279736adc75e41538201e82e4f0003c5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764322163&amp;x-signature=8kRaPWiwpXYg4mjxghgqJr14bjo%3D" alt="" loading="lazy"/>」</strong></p>
<p><strong>「全中国最早正式定义物联网的学者」</strong></p>
<p>此外，他还是全中国最早正式定义物联网的学者。</p>
<p>2011 年，出版教材《物联网导论》，作为物联网领域的开篇专著备受业内人士好评。</p>
<p>刘云浩长期从事计算机网络与系统研究。</p>
<p>建立物联网节点可定位性理论，设计并实现全球首个基于射频识别技术（RFID）的非测距定位系统 LANDMARC。</p>
<p>提出基于物联网的具身导航方法体系，部署全球首个地下煤矿物联网系统，获香港最佳创新及研究奖（Best Innovation and Research Award）。</p>
<p>建立物联网可扩展性理论与技术体系，研制同期世界上规模最大的自组织物联网系统绿野千传（GreenOrbs），获 ACM 嵌入式网络传感系统会议（ACM SenSys）时间检验奖（Test of Time Award）。</p>
<p>因在物联网领域的贡献当选电气与电子工程师协会会士（IEEE Fellow）和国际计算机学会会士（ACM Fellow），是首位获得 ACM 主席奖的中国学者。</p>
<p>以第一完成人获得国家自然科学二等奖、教育部自然科学一等奖、教育部技术发明一等奖、中国电子学会自然科学一等奖，以及中国计算机学会「王选奖」等。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2aed500d0f5946caa45c3be2dfc929c4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764322163&amp;x-signature=Fc9VribkopqBx1TaJjCYcHSPlrY%3D" alt="" loading="lazy"/></p>
<p><strong>「周志华」</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9737b86d301c4407af2032fc9330ff54~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764322163&amp;x-signature=YYGuX1%2Byf5KDPefZM5u34dchgpc%3D" alt="" loading="lazy"/></p>
<p>周志华，1973 年 11 月出生，现年 51 岁。</p>
<p>他于 1992 年考入南京大学计算机科学与技术系，并先后于 1996 年 6 月、1998 年 6 月和 2000 年 12 月，获得学士、硕士和博士学位。</p>
<p>23 岁本科毕业，读完硕士和博士，他都只用了两年。</p>
<p>2001 年 1 月，周志华选择留校任教，紧接着便在 2002 年 3 月被破格晋升为副教授。</p>
<p>2003 年获得国家杰出青年科学基金后，于同年 11 月被聘任为教授，2004 年 4 月获博生导师资格。</p>
<p>2009 年，他入选新世纪百千万人才工程国家级人选；2017 年当选欧洲科学院院士；2018 年担任南京大学计算机系主任兼人工智能学院院长。</p>
<p>在升任副校长前，他担任南京大学计算机软件新技术国家重点实验室常务副主任、机器学习与数据挖掘研究所（LAMDA）所长、人工智能教研室主任。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dddf7f98f35d483488d55347241e0d70~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764322163&amp;x-signature=MWFp%2Bt2Sik%2BzQF%2FoQwz0R5p1vPw%3D" alt="" loading="lazy"/></p>
<p><strong>「<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/950d44d83d064830b81ecf220a85b05e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764322163&amp;x-signature=EA93CsJMyi0xy6HQDSh9ZrW0b3U%3D" alt="" loading="lazy"/>」</strong></p>
<p><strong>「学术成果颇丰，Fellow 大满贯」</strong></p>
<p>周志华主要从事人工智能、机器学习、数据挖掘、模式识别等领域的研究工作。</p>
<p>他撰写的《机器学习》一书被视为入门 AI 必备的经典读物，涵盖了机器学习领域的基本概念和算法，被大家亲切称为「西瓜书」。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2a29fa86bade4c77b1ea3d12276000f8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764322163&amp;x-signature=ii%2BI2dSRPKYb%2Fwi4O%2BGU2aDouz8%3D" alt="" loading="lazy"/></p>
<p>2023 年 8 月，南京大学周志华教授当选为新一届的国际人工智能联合会理事会（IJCAI Trustee）主席。</p>
<p>他是 1969 年 IJCAl 大会创办以来，首位担任 IJCAI President（国际人工智能联合会理事会主席）的中国大陆学者。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f7aeb6be755b4640a96fce83c4e3fd0c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764322163&amp;x-signature=ZKKtiZF5oGhs8%2F4KkXfL2itRb8s%3D" alt="" loading="lazy"/></p>
<p>在此之前，他于 2017 年当选 IJCAI 2021 程序委员会主席，同样也是首位担任这一职位的中国大陆学者。</p>
<p>2018 年，当选为 IJCAI 理事会委员，任期 5 年（2018-2023）。</p>
<p>2019 年，他与密歇根大学一位著名教授一起，担任国际人工智能学会 AAAI 2019 大会的程序委员会主席，成为 1980 年该会议创办以来美欧之外国家首位担任大会程序委员会主席的学者。</p>
<p>值得一提的是，2016 年他还当选了国际人工智能学会（AAAI）、美国计算机学会（ACM）、美国科学促进会（AAAS）的会士，加上此前已经是国际电气电子工程师学会（IEEE）和国际模式识别学会（IAPR）的会士，他已成为在人工智能相关的五大主流国际学会的华人「大满贯」会士第一人。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b7bf7b5cafc6480985f9fd6eca50b541~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764322163&amp;x-signature=%2BokGxRPdejdNH4N10xzAmjUlXoQ%3D" alt="" loading="lazy"/></p>
<p>2019 年 7 月，IEEE 计算机学会主席 Cecilia Metra 教授向南京大学人工智能学院院长、计算机系主任周志华教授颁发 2019 年度 IEEE 计算机学会 Edward J. McCluskey 技术成就奖</p>
<p>在 AI 及其教学领域，他的成就可谓战果累累。</p>
<ul>
<li>首届「微软学者奖」（1999）</li>
<li>第五届全国优秀博士学位论文奖（2003）</li>
<li>中国青年科技奖（2006）</li>
<li>微软青年教授奖（2006）</li>
<li>霍英东青年教师奖一等奖（2010）</li>
<li>国际工程技术学会 IET/IEE Fellow（2010）</li>
<li>ACM 杰出科学家（2013）</li>
<li>中国计算机学会（CCF）Fellow（2013）</li>
<li>IEEE 计算智能学会杰出青年成就奖（2013）</li>
<li>IEEE 数据挖掘杰出服务奖（2016）</li>
<li>欧洲科学院院士（2017）</li>
<li>CCF 王选奖（2017）</li>
<li>亚洲机器学习卓越贡献奖（2019）</li>
<li>首届 CCF-ACM 人工智能奖（2020）</li>
</ul>
<p>除了在南京大学任教，周志华也在香港科技大学等校兼职教授，在复旦大学智能信息处理重点实验室、浙江大学视觉感知重点实验室、吉林大学符号计算与知识工程重点实验室等机构任学术委员会委员。</p>
<p>作为学者，周志华曾在多个学术期刊和顶级会议中任职，包括 lEEE Transactions on Knowledge and Data Engineering 、ACM Transactions on Intelligent Systems and Technology 等刊的 Associate Editor，以及 Machine Learning、Pattern Recognition、IEEE Intelligent Systems 等刊客座编辑。</p>
<p><strong>「<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/97a91ccebf9742c093070fd72ce8c49a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764322163&amp;x-signature=zC63upeck3v4yOWul%2Bd8dBG3SJo%3D" alt="" loading="lazy"/>」</strong></p>
<p><strong>「机器学习发展的亲历者和见证者」</strong></p>
<p>近几年的研究之路，已经让我们见证了中国科研力量的起步和崛起。</p>
<p>谈起科研道路，周志华坦言自己是我国人工智能特别是机器学习领域发展的亲历者和见证者。</p>
<p>机器学习主要是研究如何利用计算机来进行数据分析的理论和方法。大数据好比是矿山，要得到矿山的价值还需要有效的数据分析技术，机器学习就是为大家提供这种技术。</p>
<p>他回忆说，1995 年读本科时，在图书馆偶然翻看了《机器学习: 通往人工智能的途径》，这是他接触机器学习的开始。</p>
<p>当年学校还没有网络，这本 1983 年出版的书从科研角度看观点已经很老了，但仍让他着迷。</p>
<p>当时国内的相关研究还没有起步，直到 2005 年他在一些学术会议上讲到机器学习时，还有业内人士问，机器学习是学习采棉花还是摘葡萄?</p>
<p>从「看不到国际文献」到「能随时看到国际文献」，从「看到国际文献才知道别人在做什么」到「研究的问题与国际前沿接轨」，在过去 20 年里，我国在 AI 研究领域，已经取得了飞跃式的突破。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/81694b618ede464998e0c456d6a0951c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764322163&amp;x-signature=fv0LW4bK6%2FBbzqGEBV810j2mF50%3D" alt="" loading="lazy"/></p>
<p>2017 年的国际人工智能联合大会上，中国的录用论文数首次超过了美国。</p>
<p>并且，越来越多的中国科学家担任顶级国际学术会议主席。</p>
<p>2018 年，当国家将人工智能上升为战略重点时，周志华带领团队在南京大学创办了全国第一所人工智能学院，并建立了本科阶段人工智能专业的学科体系。</p>
<p>周志华坦言赶上了时代机遇——</p>
<p>国家不断强大、经济实力增强、政府和企业对科研的投入在增大。对我们研究者来说，看到人工智能被写进了十九大报告，很受鼓舞。</p>
<p>在 2007 年，周志华创建了南京大学机器学习与数据挖掘研究所。</p>
<p>经过 10 年的发展，实验室现有教师 11 人，研究生 60 余人，同时还有越来越多有志于 AI 的青年学子慕名而来。</p>
<p>在学生们眼里，周志华勤奋、精力旺盛。</p>
<p>「有时凌晨两点刚回复完邮件，早晨 7 点就在微信上提出修改意见，7 点半又通知去办公室开会。」博士生赵鹏说。</p>
<p>虽然机器学习领域很热，但周志华会刻意「控制」论文数量，时常鼓励大家要坐得住冷板凳，通过深入钻研提高质量。</p>
<p>他热心于让更多人了解机器学习，不仅开通了微博，用所学知识点评热点，还为关心 AlphaGO 的科技迷点评背后的技术。</p>
<p>他撰写的机器学习教科书，出版一年多就重印 20 多次，也让他收获了「畅销书作家」的头衔。</p>
<p>在学校里，他坚持给本科生上课，深入浅出的语言、旁征博引的案例、幽默生动的教学，不仅吸引了理工科院系的学生选修，还吸引来大批文科学院的学生，甚至有从外地学校赶来蹭课的。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4d9ead06cda24096ae6c35cbf5cdd411~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764322163&amp;x-signature=S5Qiw0IX0NrrfqdW5NXSJUKnNaI%3D" alt="" loading="lazy"/></p>
<p><strong>「科学院完整名单」</strong></p>
<p>本次科学院名单共涉及 6 个专业学部。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2aebc4f58d5e4014bae540f7b4ed2d44~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764322163&amp;x-signature=PZcUv5UltBOodz9lsjpk3hTimr4%3D" alt="" loading="lazy"/></p>
<p>其中，各学部院士数量如下，数学物理学部 14 人，化学部 11 人，生命科学和医学学部 13 人，地学部 9 人，信息技术科学部 11 人，技术科学部 15 人，共 73 人。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f88b971419344dda91a18befc70b92c7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764322163&amp;x-signature=HdZz6X1EyMMluDyKV1SUMiu3cGQ%3D" alt="" loading="lazy"/></p>
<p>研究方向共 72 个，其中数论方向入选两位，其他方向均不相同。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d5d40afa165542fd9811478f671b36eb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764322163&amp;x-signature=x3JEKxNjKFsTR7qjfJNc%2B6acA%2F4%3D" alt="" loading="lazy"/></p>
<p>年龄分布上，最大的 66 岁，最小的 44 岁。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/82995f0b04b741e2ab1af212699cbe10~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764322163&amp;x-signature=jvS0xSxIrhNivJw4Y%2B5dVC%2FCv4Q%3D" alt="" loading="lazy"/></p>
<p>本次公布名单，清华大学入选人数最多为 8 人，第二名是北京大学，人数为 5 人。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d4804c34b66b45d89302812735a66ce6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764322163&amp;x-signature=KUhlKBl%2FSjwxlTC6LISE5NPXxNg%3D" alt="" loading="lazy"/></p>
<p>完整名单如下。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7c1a571740d64d29891e5f66e9fde02b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764322163&amp;x-signature=4VE%2FckVsCGgixthZeiRbhIzuztw%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cf62ab4825c5400596c9071be6ea093e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764322163&amp;x-signature=vTxhct3mGkr5qSfVV5APP0HImKs%3D" alt="" loading="lazy"/></p>
<p><strong>「工程院完整名单」</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fad19f0ceafa42f2adeb75c801dac859~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764322163&amp;x-signature=uP4QRBnbdH7Kfnc3ben%2FTbzf3vk%3D" alt="" loading="lazy"/></p>
<p>参考资料：</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fyszx.casad.cas.cn%2Ftzgg%2F202511%2Ft20251120_5089431.html" target="_blank" title="https://yszx.casad.cas.cn/tzgg/202511/t20251120_5089431.html" ref="nofollow noopener noreferrer">yszx.casad.cas.cn/tzgg/202511…</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.cae.cn%2Fcae%2Fhtml%2Fmain%2Fcol245%2F2025-11%2F21%2F20251121085534729719452_1.html" target="_blank" title="https://www.cae.cn/cae/html/main/col245/2025-11/21/20251121085534729719452_1.html" ref="nofollow noopener noreferrer">www.cae.cn/cae/html/ma…</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwenhui.whb.cn%2Fzhuzhan%2Fxue%2F20200815%2F366174.html" target="_blank" title="https://wenhui.whb.cn/zhuzhan/xue/20200815/366174.html" ref="nofollow noopener noreferrer">wenhui.whb.cn/zhuzhan/xue…</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzI3MTA0MTk1MA%3D%3D%26mid%3D2652257265%26idx%3D5%26sn%3D66410bf47b4b689a219bf54981972be8%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzI3MTA0MTk1MA==&amp;mid=2652257265&amp;idx=5&amp;sn=66410bf47b4b689a219bf54981972be8&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">2022 年 CCF 会士评选结果出炉！清华刘云浩、阿里李飞飞等 9 人当选</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzI3MTA0MTk1MA%3D%3D%26mid%3D2652506955%26idx%3D1%26sn%3D9eccd828a1629e0975e1d1cea26121f2%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzI3MTA0MTk1MA==&amp;mid=2652506955&amp;idx=1&amp;sn=9eccd828a1629e0975e1d1cea26121f2&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">周志华，出任南京大学副校长</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Google Antigravity 测评：免费的智能体 IDE 有多强]]></title>    <link>https://juejin.cn/post/7574967214128168986</link>    <guid>https://juejin.cn/post/7574967214128168986</guid>    <pubDate>2025-11-21T09:40:16.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574967214128168986" data-draft-id="7574991051435016202" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Google Antigravity 测评：免费的智能体 IDE 有多强"/> <meta itemprop="keywords" content="后端,AI编程,Gemini"/> <meta itemprop="datePublished" content="2025-11-21T09:40:16.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="该用户已不存在"/> <meta itemprop="url" content="https://juejin.cn/user/64217584778579"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Google Antigravity 测评：免费的智能体 IDE 有多强
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/64217584778579/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    该用户已不存在
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T09:40:16.000Z" title="Fri Nov 21 2025 09:40:16 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在发布 Gemini 3.0 的同时，还上线了一个名为 <strong>Google Antigravity</strong> 的全新开发平台。谷歌的说法是这是 VS Code的分支。</p>
<p>但这不是一个简单的 VS Code 插件，也不是在侧边栏加个对话框那么简单。Antigravity 是一个完全基于“智能体优先”（Agent-First）理念构建的 IDE，由 Gemini 3 Pro 提供算力支持。目前的预览版是免费的。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e516bad12bd04725b658c136d267ffbb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K-l55So5oi35bey5LiN5a2Y5Zyo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764322816&amp;x-signature=Aw22L9lrPUTT5VA8kccmQ2mQOYA%3D" alt="" loading="lazy"/></p>
<p>今天我们就来聊聊 Antigravity 到底有哪些实质性的新特性，它与 Cursor、GitHub Copilot Workspace 等竞品相比有何不同。</p>
<h3 data-id="heading-0">Antigravity 的核心特性：不只是写代码，更是管代码</h3>
<p>Antigravity 的核心优点在于，程序员不再是那个逐行敲代码的工具人了，而是指挥多个 AI 智能体干活的项目经理。</p>
<h4 data-id="heading-1">原生经理视图与多智能体并行</h4>
<p>这是 Antigravity 最显著的特点。它引入了一个 Manager View（经理视图）。用户可以在这里同时从宏观层面指挥多个智能体。</p>
<ul>
<li><strong>并行</strong> <strong>工作</strong>：用户可以让一个智能体去重构后端的 API 接口，同时让另一个智能体去更新前端的 React 组件，再派第三个智能体去写单元测试。它们互不干扰，并行推进。</li>
<li><strong>上下文隔离</strong>：每个智能体都有自己的工作区，不会像单线程对话那样因为上下文过长而幻觉频发。</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7f6f3b37324f4885956b24eb180119a2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K-l55So5oi35bey5LiN5a2Y5Zyo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764322816&amp;x-signature=2fR2xz9HKdyXiyWx5d38gvD1T6E%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-2">真实的浏览器控制权</h4>
<p>大多数 AI 编程工具只能处理文本（代码）。但 Antigravity 通过内置的 Chrome 扩展，赋予了智能体操作浏览器的能力。</p>
<ul>
<li>
<p>智能体写完代码后，会自动打开浏览器。</p>
</li>
<li>
<p>它能像真人测试员一样点击按钮、填写表单、检查页面跳转。</p>
</li>
<li>
<p><strong>它能看</strong>：如果页面样式崩了，它能通过视觉识别发现问题并自动修复。</p>
</li>
</ul>
<h4 data-id="heading-3">交付物与异步反馈</h4>
<p>为了解决 AI 编程黑盒不可信的问题，Antigravity 引入了 交付物 （Artifacts） 机制。智能体不会直接把代码甩给程序员，而是生成可视化的交付物：</p>
<ul>
<li>详细的实施计划书。</li>
<li>待办事项清单。</li>
<li>UI 渲染截图。</li>
<li><strong>操作</strong> <strong>录屏</strong>：这是最杀手级的功能。用户可以回放智能体在浏览器里的测试过程，亲眼看到它是如何验证功能的。</li>
</ul>
<p>用户可以像在 Google Docs 里批注一样，直接在这些交付物上留言，智能体会根据反馈继续调整。</p>
<h4 data-id="heading-4">双模式切换：规划 vs 急速</h4>
<ul>
<li>
<p><strong>Planning Mode (规划模式)</strong> ：适合复杂任务。智能体会先写文档，列计划，确认后再动手。</p>
</li>
<li>
<p><strong>Fast Mode (急速模式)</strong> ：适合原型开发。智能体直接上手写代码，主打一个快。</p>
</li>
</ul>
<h3 data-id="heading-5">竞品横向对比：Antigravity vs 市场主流</h3>
<p>根据官方公布的信息及实际体验，我们将 Antigravity 与 Cursor、GitHub Copilot Workspace 以及 Windsurf 进行了对比：</p>





























































<table><thead><tr><th>特性</th><th>Google Antigravity</th><th>Cursor</th><th>GitHub Copilot Workspace</th><th>Windsurf / Devonshire</th></tr></thead><tbody><tr><td><strong>核心模型</strong></td><td><strong>Gemini 3</strong> <strong>Pro</strong> **(默认)**支持切换其他模型</td><td>GPT-4o / Claude 3.5</td><td>GPT-4o / Copilot 模型</td><td>Claude 3.5 / 本地模型</td></tr><tr><td><strong>自主程度</strong></td><td><strong>高</strong>（完全控制编辑器/终端/浏览器）</td><td>中-高</td><td>中等（规划器 + 执行器）</td><td>高（但仅限本地）</td></tr><tr><td><strong>结果验证</strong></td><td><strong>Artifacts +</strong> <strong>录屏</strong>（可视化程度最高）</td><td>Diff 预览 + 聊天确认</td><td>计划 + 测试结果</td><td>实时预览</td></tr><tr><td><strong>多</strong> <strong>智能体</strong> <strong>并行</strong></td><td><strong>原生的经理视图（Manager View）</strong></td><td>有限支持（Composer 功能）</td><td>无</td><td>无</td></tr><tr><td><strong>浏览器集成</strong></td><td><strong>内置 Chrome 扩展</strong></td><td>通过 Playwright 脚本间接实现</td><td>有限</td><td>无</td></tr><tr><td><strong>价格</strong></td><td><strong>免费预览版</strong>（额度大方）</td><td>$20+/月</td><td>包含在 Copilot 订阅中</td><td>免费/开源</td></tr><tr><td><strong>适用场景</strong></td><td><strong>复杂的全栈任务</strong>需要高度验证和可视化反馈</td><td>快速原型开发追求单点代码速度</td><td>深度绑定 GitHub 工作流</td><td>离线开发，注重隐私</td></tr></tbody></table>
<ul>
<li>
<p><strong>Antigravity 的优势</strong>在于全栈控制力和验证机制。它不只是生成代码，还能替用户运行和测试，并提供录屏证据，这对于复杂的全栈任务非常有效。</p>
</li>
<li>
<p><strong>Cursor</strong> 依然是快速写代码的利器，但在多任务并行处理和浏览器自动化测试上，Antigravity 目前更胜一筹。</p>
</li>
<li>
<p><strong>Windsurf</strong> 主打本地和隐私，适合对数据安全极度敏感的场景。</p>
</li>
</ul>
<h3 data-id="heading-6">程序员的新选择：Vibe Coding 与本地化部署</h3>
<p>Antigravity 的出现进一步推动了 Vibe Coding的趋势。开发者不再纠结于语法细节，而是通过自然语言把控逻辑和功能，剩下的交给 AI。</p>
<p>但完全依赖云端（如 Antigravity 依赖 Google 服务）也带来了隐私顾虑和网络依赖问题。这时候，本地化 AI + 快速环境部署成为了完美的互补方案，而 <strong>ServBay</strong> 正是为此而生。</p>
<h4 data-id="heading-7">ServBay：本地 Vibe Coding 的最佳拍档</h4>
<p>如果你想在享受 AI 便利的同时，保持代码的私密性，或者只是想快速验证一个想法，ServBay 是一个极其友好的选择。</p>
<h5 data-id="heading-8"><strong>一键部署本地 AI 模型</strong>：</h5>
<ul>
<li>Antigravity 强在云端算力，而 ServBay 强在本地隐私。ServBay 支持一键在本地部署 Gemma、Qwen 3 等开源模型。用户不需要<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.servbay.com%2Ffeatures%2Fpython" target="_blank" title="https://www.servbay.com/features/python" ref="nofollow noopener noreferrer">配置复杂的 Python 环境</a>或显卡驱动，点一下就能在本地跑起一个 AI 编程助手。这对于处理公司敏感代码或无网环境开发至关重要。</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5f3142e2ea0842bfb5f36644733a2935~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K-l55So5oi35bey5LiN5a2Y5Zyo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764322816&amp;x-signature=87ivAJBtMZJr0JdHlJ588W460hc%3D" alt="" loading="lazy"/></p>
<p><strong>全栈环境秒级准备</strong>：</p>
<ul>
<li>
<p>Vibe Coding 的核心是快。当 AI 写好了代码，需要一个环境立刻运行它。ServBay 集成了 Web 服务器、数据库（Redis/MariaDB）、语言环境（PythonPHP/Node.js），开箱即用。</p>
<ul>
<li><em>场景</em>：可以用 Antigravity 生成架构，然后拉到本地，用 ServBay 提供的环境运行，并结合本地的 Qwen 3 模型进行私密的业务逻辑填充。</li>
</ul>
</li>
</ul>
<p><strong>零门槛上手</strong>：</p>
<ul>
<li>
<p>对于不想折腾 Docker 或虚拟机的前端/后端开发者，ServBay 这种原生、轻量化的管理工具，能把精力集中在指挥 AI而不是修环境上。</p>
</li>
<li>
<p>如果是Gemini CLI感兴趣，想要体验一下。ServBay也支持<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.servbay.com%2Ffeatures%2Fnodejs" target="_blank" title="https://www.servbay.com/features/nodejs" ref="nofollow noopener noreferrer">一键安装的Node.js环境</a>，无需任何门槛。</p>
</li>
</ul>
<h3 data-id="heading-9">代码演示：智能体的工作逻辑</h3>
<p>为了展示 Antigravity 是如何通过指令生成代码的，我们看一个简单的 Python 任务：创建一个带日志记录的简单的 HTTP 服务。</p>
<p>在 Antigravity 中，只需要输入：“写一个基于 Flask 的服务，包含一个 <code>/status</code> 接口，并把每次访问记录到 SQLite 数据库中。”</p>
<p>AI 生成的代码逻辑如下：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> sqlite3
<span class="hljs-keyword">import</span> datetime
<span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, jsonify, request

app = Flask(__name__)
DB_FILE = <span class="hljs-string">'access_logs.db'</span>

<span class="hljs-keyword">def</span> <span class="hljs-title function_">init_db</span>():
    <span class="hljs-string">"""初始化数据库表结构"""</span>
    <span class="hljs-keyword">with</span> sqlite3.connect(DB_FILE) <span class="hljs-keyword">as</span> conn:
        cursor = conn.cursor()
        cursor.execute(<span class="hljs-string">'''
            CREATE TABLE IF NOT EXISTS logs (
                id INTEGER PRIMARY KEY AUTOINCREMENT,
                ip_address TEXT,
                timestamp TEXT,
                user_agent TEXT
            )
        '''</span>)
        conn.commit()

<span class="hljs-keyword">def</span> <span class="hljs-title function_">log_request</span>(<span class="hljs-params">req</span>):
    <span class="hljs-string">"""记录请求信息"""</span>
    <span class="hljs-keyword">with</span> sqlite3.connect(DB_FILE) <span class="hljs-keyword">as</span> conn:
        cursor = conn.cursor()
        now = datetime.datetime.now().isoformat()
        cursor.execute(
            <span class="hljs-string">'INSERT INTO logs (ip_address, timestamp, user_agent) VALUES (?, ?, ?)'</span>,
            (req.remote_addr, now, req.headers.get(<span class="hljs-string">'User-Agent'</span>))
        )
        conn.commit()

<span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">'/status'</span>, methods=[<span class="hljs-string">'GET'</span>]</span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">status_check</span>():
    <span class="hljs-comment"># 记录访问</span>
    log_request(request)
    <span class="hljs-keyword">return</span> jsonify({
        <span class="hljs-string">"status"</span>: <span class="hljs-string">"running"</span>, 
        <span class="hljs-string">"service"</span>: <span class="hljs-string">"Antigravity_Demo"</span>,
        <span class="hljs-string">"checked_at"</span>: datetime.datetime.now().isoformat()
    })

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:
    init_db()
    <span class="hljs-comment"># 智能体通常会选择调试模式以便于反馈</span>
    app.run(debug=<span class="hljs-literal">True</span>, port=<span class="hljs-number">5000</span>)
</code></pre>
<p>在 Antigravity 中，智能体会自动运行这段代码，打开浏览器访问 <code>localhost:5000/status</code>，并录制下返回的 JSON 数据作为验证通过的证据。</p>
<h3 data-id="heading-10">结语</h3>
<p>Google Antigravity 的发布，标志着 AI 辅助开发从代码补全向任务托管的转变。它提供的多智能体协作和可视化验证机制，确实解决了不少痛点。</p>
<p>而对于开发者来说，工具的选择变得更加灵活。可以使用 Antigravity 处理庞大的全栈架构，同时利用 ServBay 配合本地的 Qwen 3 或 Gemma 模型，在本地安全、快速地进行业务逻辑的精细打磨。这种云端规划 + 本地执行的混合模式，或许正是未来高效开发的标准答案。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[🔥告别 20 分钟等待！NestJS 生产级消息队列 BullMQ 实践指南]]></title>    <link>https://juejin.cn/post/7574978847151554600</link>    <guid>https://juejin.cn/post/7574978847151554600</guid>    <pubDate>2025-11-21T09:40:21.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574978847151554600" data-draft-id="7574749664493010978" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="🔥告别 20 分钟等待！NestJS 生产级消息队列 BullMQ 实践指南"/> <meta itemprop="keywords" content="后端,前端"/> <meta itemprop="datePublished" content="2025-11-21T09:40:21.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="zyfts"/> <meta itemprop="url" content="https://juejin.cn/user/1292681406582968"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            🔥告别 20 分钟等待！NestJS 生产级消息队列 BullMQ 实践指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1292681406582968/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    zyfts
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T09:40:21.000Z" title="Fri Nov 21 2025 09:40:21 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">🎯 背景：为什么要使用消息队列？</h2>
<p>您的业务中是否也有处理时间长达 <strong>30 分钟甚至更久</strong>的“生成报告”、“大数据分析”或“文件导出”等耗时任务？</p>
<p>❌ <strong>传统同步处理的弊端：</strong></p>
<ul>
<li><strong>糟糕的用户体验：</strong> 用户请求长时间阻塞，浏览器可能超时，导致用户必须干等着或反复尝试。</li>
<li><strong>服务器资源浪费：</strong> Web 服务器（如 Node.js Event Loop）被长时间占用，无法响应其他用户的快速请求。</li>
<li><strong>请求失败风险高：</strong> 任何网络波动或服务器重启都可能导致任务中断，功亏一篑。</li>
</ul>
<p>✅ <strong>我们的解决方案：</strong> <strong>异步任务处理</strong></p>
<ol>
<li><strong>立即响应：</strong> 收到请求后，后端应<strong>立即返回</strong>“任务已创建，请稍后查询结果”。</li>
<li><strong>异步解耦：</strong> 将耗时任务从主请求线程剥离，交给后台队列（BullMQ Worker）默默处理。</li>
<li><strong>最终通知/更新：</strong> 任务执行完成后，Worker 自动修改数据库状态，完成整个流程。</li>
</ol>
<p>💡 <strong>技术栈：</strong></p>
<ul>
<li><strong>后端框架</strong>：NestJS（TypeScript优先的企业级Node.js框架）</li>
<li><strong>消息队列</strong>：BullMQ（基于Redis的高性能消息队列，专为Node.js优化）</li>
<li><strong>依赖工具</strong>：ioredis（Redis客户端，用于BullMQ的连接支撑）</li>
</ul>
<blockquote>
<p><strong>BullMQ 的优势：</strong> 基于高性能 <code>ioredis</code> 实现，拥有自动重试、失败处理、Job 状态跟踪等生产级功能，并且与 NestJS 的集成优雅方便。</p>
</blockquote>
<p>官网BullMQ链接：<a href="https://link.juejin.cn?target=https%3A%2F%2Fnest.nodejs.cn%2Ftechniques%2Fqueues" target="_blank" title="https://nest.nodejs.cn/techniques/queues" ref="nofollow noopener noreferrer">nest.nodejs.cn/techniques/…</a></p>
<p>先看下整体结构和结果</p>
<p>文件结构</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d37f284975a14c6fac44f4fc2d15157d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgenlmdHM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764323092&amp;x-signature=Imo4krJrv1b5rZq43XV%2BsZeETUE%3D" alt="" loading="lazy"/></p>
<p>结果</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/abfed4f2c72642b2bf3a9125af70832f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgenlmdHM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764323092&amp;x-signature=NIMEIjgOi9d4PvUN%2Bi2Ygx4KAgU%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-1">🛠️ 1. 项目初始化：安装 BullMQ 与配置 Redis</h2>
<p>BullMQ 依赖于 Redis 来存储队列信息和任务状态。</p>
<h3 data-id="heading-2">1.1 安装所需依赖</h3>
<pre><code class="hljs language-bash" lang="bash">pnpm install @nestjs/bullmq bullmq ioredis
</code></pre>
<h3 data-id="heading-3">1.2 配置 Redis 连接信息</h3>
<p>在你的 <code>.env</code> 文件中配置 Redis 地址。这是 BullMQ Worker 和 Queue 共享的连接信息。</p>
<p>代码段</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># redis 配置</span>
<span class="hljs-attr">REDIS_HOST</span>=localhost
<span class="hljs-attr">REDIS_PORT</span>=<span class="hljs-number">6379</span>
</code></pre>
<hr/>
<h2 data-id="heading-4">🏭 2. 核心模块：创建 BullMQ 队列与处理器</h2>
<p>创建一个专用于消息队列的模块 <code>QueueModule</code>。</p>
<h3 data-id="heading-5">2.1 配置 QueueModule：连接 Redis 和注册队列</h3>
<p>配置 NestJS 的 <code>BullModule.forRootAsync</code> 来连接 Redis，并使用 <code>BullModule.registerQueue</code> 注册一个名为 <code>shortUrl_queue</code> 的队列。</p>
<p>queue.module.ts</p>
<pre><code class="hljs language-js" lang="js">    <span class="hljs-keyword">import</span> { <span class="hljs-title class_">Module</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@nestjs/common'</span>;
    <span class="hljs-keyword">import</span> { <span class="hljs-title class_">ConfigModule</span>, <span class="hljs-title class_">ConfigService</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@nestjs/config'</span>;
    <span class="hljs-keyword">import</span> { <span class="hljs-title class_">BullModule</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@nestjs/bullmq'</span>;
    <span class="hljs-keyword">import</span> { <span class="hljs-title class_">ShortUrlProcessor</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./short-url.processor'</span>;
    <span class="hljs-keyword">import</span> { <span class="hljs-title class_">QueueService</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./queue.service'</span>;

    @<span class="hljs-title class_">Module</span>({
      <span class="hljs-attr">imports</span>: [
        <span class="hljs-comment">// 1. 全局配置 BullMQ：连接到 Redis</span>
        <span class="hljs-title class_">BullModule</span>.<span class="hljs-title function_">forRootAsync</span>({
          <span class="hljs-attr">imports</span>: [<span class="hljs-title class_">ConfigModule</span>],
          <span class="hljs-attr">useFactory</span>: <span class="hljs-keyword">async</span> (<span class="hljs-attr">configService</span>: <span class="hljs-title class_">ConfigService</span>) =&gt; ({
            <span class="hljs-attr">connection</span>: {
              <span class="hljs-attr">host</span>: configService.<span class="hljs-property">get</span>&lt;string&gt;(<span class="hljs-string">'REDIS_HOST'</span>),
              <span class="hljs-attr">port</span>: configService.<span class="hljs-property">get</span>&lt;number&gt;(<span class="hljs-string">'REDIS_PORT'</span>),
            },
          }),
          <span class="hljs-attr">inject</span>: [<span class="hljs-title class_">ConfigService</span>],
        }),
        <span class="hljs-comment">// 2. 注册具体的队列：命名为 'shortUrl_queue'</span>
        <span class="hljs-title class_">BullModule</span>.<span class="hljs-title function_">registerQueue</span>({
          <span class="hljs-attr">name</span>: <span class="hljs-string">'shortUrl_queue'</span>,
        })
      ],
      <span class="hljs-attr">providers</span>: [
        <span class="hljs-title class_">QueueService</span>,
        <span class="hljs-title class_">ShortUrlProcessor</span>, <span class="hljs-comment">// 注册处理器 Worker</span>
      ],
      <span class="hljs-comment">// ⚠️ 必须导出 BullModule，才能在其他业务模块中使用 @InjectQueue</span>
      <span class="hljs-attr">exports</span>: [<span class="hljs-title class_">BullModule</span>]
    })
    <span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">QueueModule</span> { }
</code></pre>
<h3 data-id="heading-6">2.2 Processor：编写真正的耗时任务逻辑</h3>
<p>处理器（Worker）是真正执行任务的地方。它会监听特定队列，并执行 <code>process</code> 方法。</p>
<p><code>short-url.processor.ts</code></p>
<pre><code class="hljs language-js" lang="js">
    <span class="hljs-keyword">import</span> { <span class="hljs-title class_">OnWorkerEvent</span>, <span class="hljs-title class_">Processor</span>, <span class="hljs-title class_">WorkerHost</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@nestjs/bullmq"</span>;
    <span class="hljs-keyword">import</span> { <span class="hljs-title class_">Job</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"bullmq"</span>; <span class="hljs-comment">// 引入 Job 类型</span>

    <span class="hljs-comment">// @Processor('队列名称'): 告知 NestJS 此 Worker 监听哪个队列</span>
    @<span class="hljs-title class_">Processor</span>(<span class="hljs-string">'shortUrl_queue'</span>)
    <span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ShortUrlProcessor</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">WorkerHost</span> {
      <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">super</span>();
      }
      
      <span class="hljs-comment">// 任务处理逻辑：这里可以包含数据库操作、文件处理等耗时任务</span>
      <span class="hljs-keyword">async</span> <span class="hljs-title function_">process</span>(<span class="hljs-params">job: Job</span>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`==== 任务 ID: <span class="hljs-subst">${job.id}</span>，开始执行消息队列 ====`</span>);
        <span class="hljs-keyword">try</span> {
          <span class="hljs-keyword">const</span> data = job.<span class="hljs-property">data</span>;
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'任务接收到的数据: '</span>, data);
          
          <span class="hljs-comment">// ----------------------------------------------------</span>
          <span class="hljs-comment">// 核心逻辑：这里模拟 30 分钟甚至更长的耗时任务</span>
          <span class="hljs-comment">// ----------------------------------------------------</span>
          <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function"><span class="hljs-params">resolve</span> =&gt;</span> <span class="hljs-built_in">setTimeout</span>(resolve, <span class="hljs-number">3</span> * <span class="hljs-number">1000</span>)); <span class="hljs-comment">// 实际应为 30 分钟以上的业务逻辑</span>
          
          <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> 任务完成后，在这里修改数据库中任务的状态（例如：已完成，并更新结果链接）</span>
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'==== 消息队列执行完毕，修改数据库状态 ===='</span>);
          
          <span class="hljs-comment">// process 必须返回结果，否则 BullMQ 会认为任务失败</span>
          <span class="hljs-keyword">return</span> { <span class="hljs-attr">status</span>: <span class="hljs-string">'success'</span>, <span class="hljs-attr">message</span>: <span class="hljs-string">'任务成功完成'</span> };
        } <span class="hljs-keyword">catch</span> (error) {
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'==== 消息队列执行失败 ===='</span>, error);
          <span class="hljs-comment">// 抛出错误或返回失败信息，BullMQ 会根据配置进行重试</span>
          <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'任务执行过程中出错'</span>);
        }
      }

      <span class="hljs-comment">// 可选：监听任务完成事件 (可用于日志记录)</span>
      @<span class="hljs-title class_">OnWorkerEvent</span>(<span class="hljs-string">'completed'</span>)
      <span class="hljs-title function_">onCompleted</span>(<span class="hljs-params">job: Job, result: any</span>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`[成功] 任务 <span class="hljs-subst">${job.id}</span> 完成。`</span>);
      }

      <span class="hljs-comment">// 可选：监听任务失败事件 (可用于发送告警通知)</span>
      @<span class="hljs-title class_">OnWorkerEvent</span>(<span class="hljs-string">'failed'</span>)
      <span class="hljs-title function_">onFailed</span>(<span class="hljs-params">job: Job, err: any</span>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`[失败] 任务 <span class="hljs-subst">${job.id}</span> 失败，原因: <span class="hljs-subst">${err.message}</span>`</span>);
      }
    }

</code></pre>
<h2 data-id="heading-7">🚀 3. 业务集成：将耗时任务推送到队列</h2>
<p>现在，我们在业务 Controller 中使用 <code>BullModule</code> 提供的工具将任务推送到队列。</p>
<h3 data-id="heading-8">3.1 导入 QueueModule</h3>
<p>在需要使用队列的业务模块中导入 <code>QueueModule</code>。</p>
<pre><code class="hljs language-js" lang="js">
    <span class="hljs-keyword">import</span> { <span class="hljs-title class_">QueueModule</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'../queue/queue.module'</span>;

    @<span class="hljs-title class_">Module</span>({
      <span class="hljs-attr">imports</span>: [
        <span class="hljs-title class_">QueueModule</span>, <span class="hljs-comment">// 导入我们创建的队列模块</span>
      ],
    })
    <span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HongguoModule</span> { }
</code></pre>
<h3 data-id="heading-9">3.2 在 Controller 中注入并推送任务</h3>
<p>在 Controller 中，我们使用 <code>@InjectQueue('队列名称')</code> 注入 BullMQ 的 Queue 实例，然后调用 <code>queue.add()</code> 方法。</p>
<p><code>hongguo.controller.ts</code></p>
<pre><code class="hljs language-js" lang="js">    <span class="hljs-keyword">import</span> { <span class="hljs-title class_">InjectQueue</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@nestjs/bullmq'</span>;
    <span class="hljs-keyword">import</span> { <span class="hljs-title class_">Queue</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'bullmq'</span>;
    <span class="hljs-comment">// ... 其他 NestJS 装饰器</span>

    @<span class="hljs-title class_">Controller</span>(<span class="hljs-string">'hongguo'</span>)
    <span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HongguoController</span> {
      <span class="hljs-title function_">constructor</span>(<span class="hljs-params">
        private readonly hongguoService: HongguoService,
        <span class="hljs-comment">// 注入我们注册的 'shortUrl_queue' 队列实例</span>
        @InjectQueue(<span class="hljs-string">'shortUrl_queue'</span>)
        private taskQueue: Queue,
      </span>) { }

      @<span class="hljs-title class_">ApiOperation</span>({ <span class="hljs-attr">summary</span>: <span class="hljs-string">'长耗时任务 API'</span> })
      @<span class="hljs-title class_">Post</span>(<span class="hljs-string">'task'</span>)
      <span class="hljs-keyword">async</span> <span class="hljs-title function_">createTask</span>(<span class="hljs-params">@Body() params: any</span>) {
        <span class="hljs-comment">// 1. 业务逻辑：先在数据库创建一条任务记录，状态为“待处理”</span>
        <span class="hljs-keyword">const</span> taskRes = { <span class="hljs-attr">id</span>: <span class="hljs-number">111</span>, <span class="hljs-attr">status</span>: <span class="hljs-string">'PENDING'</span> } 
        
        <span class="hljs-comment">// 2. 将任务推送到消息队列</span>
        <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">taskQueue</span>.<span class="hljs-title function_">add</span>(
          <span class="hljs-string">'shortUrl-process'</span>, <span class="hljs-comment">// 队列中任务的唯一名称 (Job name)</span>
          { <span class="hljs-attr">taskId</span>: taskRes.<span class="hljs-property">id</span>, <span class="hljs-attr">inputParams</span>: params }, <span class="hljs-comment">// 传递给处理器的实际数据</span>
          {
            <span class="hljs-attr">removeOnComplete</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 任务成功完成后自动清除 Job 记录</span>
            <span class="hljs-attr">removeOnFail</span>: <span class="hljs-literal">false</span>,   <span class="hljs-comment">// 任务失败后保留，方便调试和手动重试</span>
            <span class="hljs-attr">attempts</span>: <span class="hljs-number">3</span>, <span class="hljs-comment">// 失败后最多重试 3 次</span>
          }
        );

        <span class="hljs-comment">// 3. 立即返回响应给前端</span>
        <span class="hljs-keyword">return</span> {
          <span class="hljs-attr">data</span>: taskRes,
          <span class="hljs-attr">msg</span>: <span class="hljs-string">'✅ 任务已创建，后台正在异步处理中，请稍后查询结果'</span>
        };
      }
    }
    
</code></pre>
<h2 data-id="heading-10">💡 效果与结果展示</h2>






























<table><thead><tr><th><strong>场景</strong></th><th><strong>同步处理</strong></th><th><strong>异步处理（BullMQ）</strong></th></tr></thead><tbody><tr><td><strong>API 响应时间</strong></td><td>&gt; 30 分钟（或超时）</td><td><strong>&lt; 100ms</strong>，立即返回</td></tr><tr><td><strong>服务器负载</strong></td><td>Event Loop 阻塞，吞吐量骤降</td><td>主线程无阻塞，可继续处理其他请求</td></tr><tr><td><strong>任务可靠性</strong></td><td>中断即丢失</td><td>支持重试、持久化、失败告警</td></tr><tr><td><strong>用户体验</strong></td><td>卡顿、焦虑、反复刷新</td><td>流畅、可轮询状态、体验友好</td></tr></tbody></table>
<h2 data-id="heading-11">🚀 总结与进阶</h2>
<p>通过 <strong>NestJS + BullMQ</strong>，我们成功将长耗时任务从主线程剥离，实现了<strong>高可用、可扩展、易维护</strong>的异步架构。</p>
<p><strong>进阶思考：</strong></p>
<ol>
<li>
<p><strong>Job 状态查询：</strong> 如何让用户实时查询任务进度？</p>
<ul>
<li>可以通过 BullMQ 的 <code>taskQueue.getJob(jobId)</code> 方法结合 WebSocket 实现实时进度推送。</li>
</ul>
</li>
<li>
<p><strong>可视化监控：</strong> 生产环境需要一个面板来监控队列健康和失败任务。</p>
<ul>
<li>可以集成 <strong>[Bull Board]</strong> 等工具，提供友好的 Web UI 来管理和查看 BullMQ 队列状态。</li>
</ul>
</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Android 13 (API 33)上自定义广播]]></title>    <link>https://juejin.cn/post/7575006095388295177</link>    <guid>https://juejin.cn/post/7575006095388295177</guid>    <pubDate>2025-11-21T09:42:06.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575006095388295177" data-draft-id="7574840547807821834" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Android 13 (API 33)上自定义广播"/> <meta itemprop="keywords" content="Android"/> <meta itemprop="datePublished" content="2025-11-21T09:42:06.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="BoomHe"/> <meta itemprop="url" content="https://juejin.cn/user/1513407128012333"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Android 13 (API 33)上自定义广播
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1513407128012333/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    BoomHe
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T09:42:06.000Z" title="Fri Nov 21 2025 09:42:06 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong>在 Android 13 (API 33) 及更高版本上，由于 Google 对隐式广播和安全性进行了严格限制，我们需要使用最佳实践来确保自定义广播的完整性和可靠性。下面是一个完整的自定义显式广播示例，包括 Kotlin 接收器代码、AndroidManifest.xml 配置以及 adb 测试命令。</strong></p>
<h2 data-id="heading-0">🛠️ Android 13 自定义显式广播示例</h2>
<h3 data-id="heading-1">1. 定义常量 (Constants)</h3>
<p>在一个 Kotlin 文件中定义 Action 名称和所需的权限。<br/>
Kotlin</p>
<p>// Constants.kt</p>
<p>const val ACTION_CUSTOM_REFRESH = "com.example.action.CUSTOM_REFRESH"<br/>
const val EXTRA_DATA_KEY = "data_payload"</p>
<h3 data-id="heading-2">2. 编写 BroadcastReceiver (Kotlin)</h3>
<p>这是接收广播并处理逻辑的核心类。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// CustomDataReceiver.kt  </span>
<span class="hljs-keyword">package</span> com.example.myautomotiveapp  
  
<span class="hljs-keyword">import</span> android.content.BroadcastReceiver  
<span class="hljs-keyword">import</span> android.content.Context  
<span class="hljs-keyword">import</span> android.content.Intent  
<span class="hljs-keyword">import</span> android.util.Log  
  
<span class="hljs-keyword">class</span> <span class="hljs-title class_">CustomDataReceiver</span> : <span class="hljs-type">BroadcastReceiver</span>() {  
  
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> TAG = <span class="hljs-string">"CustomReceiver"</span>  
  
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onReceive</span><span class="hljs-params">(context: <span class="hljs-type">Context</span>?, intent: <span class="hljs-type">Intent</span>?)</span></span> {  
        <span class="hljs-comment">// 必须检查 Intent 是否为 null  </span>
        <span class="hljs-keyword">if</span> (intent == <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span>  
  
        <span class="hljs-keyword">val</span> action = intent.action  
         
        <span class="hljs-comment">// 1. 检查 Action 是否匹配  </span>
        <span class="hljs-keyword">if</span> (action == ACTION_CUSTOM_REFRESH) {  
             
            <span class="hljs-comment">// 2. 提取附加数据  </span>
            <span class="hljs-keyword">val</span> payload = intent.getStringExtra(EXTRA_DATA_KEY)  
             
            Log.d(TAG, <span class="hljs-string">"✅ 接收到自定义广播: <span class="hljs-variable">$ACTION_CUSTOM_REFRESH</span>"</span>)  
            Log.d(TAG, <span class="hljs-string">"   接收到的数据 Payload: <span class="hljs-variable">$payload</span>"</span>)  
  
            <span class="hljs-comment">// 3. 执行应用逻辑 (例如：刷新 UI, 更新数据)  </span>
            <span class="hljs-comment">// if (payload == "full_sync") { /* 执行同步操作 */ }  </span>
             
            <span class="hljs-comment">// 4. (可选) 如果是耗时操作，通常会启动一个 JobIntentService 或 WorkManager  </span>
        } <span class="hljs-keyword">else</span> {  
            Log.w(TAG, <span class="hljs-string">"接收到不匹配的 Action: <span class="hljs-variable">$action</span>"</span>)  
        }  
    }  
}  
</code></pre>
<h3 data-id="heading-3">3. 配置 Manifest (AndroidManifest.xml)</h3>
<p>在 Android 13 上，必须明确设置 android:exported 属性，以便接收来自系统或外部（adb）的广播。</p>
<pre><code class="hljs language-ini" lang="ini">&lt;manifest xmlns:<span class="hljs-attr">android</span>=<span class="hljs-string">"http://schemas.android.com/apk/res/android"</span>&gt;  
    &lt;application&gt;  
         
        &lt;receiver  
            android:<span class="hljs-attr">name</span>=<span class="hljs-string">".CustomDataReceiver"</span>  
            android:<span class="hljs-attr">enabled</span>=<span class="hljs-string">"true"</span>  
            android:<span class="hljs-attr">exported</span>=<span class="hljs-string">"true"</span>&gt; &lt;intent-filter&gt;  
                &lt;action android:<span class="hljs-attr">name</span>=<span class="hljs-string">"com.example.action.CUSTOM_REFRESH"</span> /&gt;  
            &lt;/intent-filter&gt;  
        &lt;/receiver&gt;  
         
    &lt;/application&gt;  
&lt;/manifest&gt;  
</code></pre>
<h3 data-id="heading-4">4. 使用 ADB 命令测试广播</h3>
<p>现在，您可以使用 adb shell am broadcast 命令来模拟外部系统发送广播。</p>
<h4 data-id="heading-5">A. 准备命令参数：</h4>

























<table><thead><tr><th>参数</th><th>值</th><th>含义</th></tr></thead><tbody><tr><td>-a</td><td>com.example.action.CUSTOM_REFRESH</td><td>指定 Action 名称</td></tr><tr><td>-p</td><td>com.example.myautomotiveapp</td><td>关键： 指定目标应用的包名 (显式广播)</td></tr><tr><td>--es</td><td>"data_payload" "full_sync"</td><td>发送一个名为 data_payload 的字符串附加数据</td></tr></tbody></table>
<h4 data-id="heading-6">B. 执行命令：</h4>
<p>请将 com.example.myautomotiveapp 替换为您应用的实际包名。</p>
<pre><code class="hljs language-css" lang="css">adb shell am broadcast \  
    -<span class="hljs-selector-tag">a</span> com<span class="hljs-selector-class">.example</span><span class="hljs-selector-class">.action</span><span class="hljs-selector-class">.CUSTOM_REFRESH</span> \  
    -<span class="hljs-selector-tag">p</span> com<span class="hljs-selector-class">.example</span><span class="hljs-selector-class">.myautomotiveapp</span> \  
    <span class="hljs-attr">--es</span> "data_payload" "full_sync"  
</code></pre>
<h4 data-id="heading-7">C. 验证结果：</h4>
<p>在执行命令后，立即检查 Logcat。您应该能看到：1.  ADB 输出： Broadcast completed: result=0</p>
<ol>
<li>Logcat 输出：<br/>
代码段<br/>
D/CustomReceiver: ✅ 接收到自定义广播: com.example.action.CUSTOM_REFRESH<br/>
D/CustomReceiver:    接收到的数据 Payload: full_sync</li>
</ol>
<p>如果 Logcat 出现了这些信息，说明您的自定义广播在 Android 13 上已完整工作。**</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[谷歌 Nano Banana Pro 炸了！硅谷 AI 半壁江山同框，网友：PS 已死]]></title>    <link>https://juejin.cn/post/7574848503731568686</link>    <guid>https://juejin.cn/post/7574848503731568686</guid>    <pubDate>2025-11-21T09:40:14.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574848503731568686" data-draft-id="7574991051434999818" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="谷歌 Nano Banana Pro 炸了！硅谷 AI 半壁江山同框，网友：PS 已死"/> <meta itemprop="keywords" content="人工智能,OpenAI"/> <meta itemprop="datePublished" content="2025-11-21T09:40:14.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="新智元"/> <meta itemprop="url" content="https://juejin.cn/user/952600743642312"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            谷歌 Nano Banana Pro 炸了！硅谷 AI 半壁江山同框，网友：PS 已死
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/952600743642312/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    新智元
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T09:40:14.000Z" title="Fri Nov 21 2025 09:40:14 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0acf0728716d40738a335014caa36247~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764322814&amp;x-signature=c93AbA75fQJOobafwXrFG4tnqso%3D" alt="" loading="lazy"/></p>
<h5 data-id="heading-0"><strong>「【新智元导读】Gemini 3 Pro 刚炸完，谷歌又在深夜扔出了「AI 图像新神」Nano Banana Pro！它用像素级的恐怖细节和完美的汉字渲染告诉世界，谁才是 AI 生图真正的王者。」</strong></h5>
<p>Gemini 3 Pro 甫一亮相，新一代模型又接踵而至。</p>
<p>就在刚刚，谷歌正式祭出最强图像生成模型——Nano Banana Pro，基于最新 Gemini 3 Pro 打造。</p>
<p>官名称作，Gemini 3 Pro Image。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6a1f43e776da41148357419e8b11eb5b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764322814&amp;x-signature=alwpfx8fZu1rgNVUQsOE%2BaBt0xE%3D" alt="" loading="lazy"/></p>
<p>正如传闻中所言，Nano Banana Pro 就是 AI 图像界的「新神」，不论在图像编辑还是在生成上，都实现了史诗级进化。</p>
<p>它的知识储备更广，文字渲染超强，而且细节把控精准到了「像素级」。</p>
<p>不仅如此，Nano Banana Pro 在做复杂信息图简直开挂，接近工程师眼中的世界。</p>
<p>基准测试中，新版 Nano Banana 相较于上一代性能显著提升，GPT-Image、Flux Pro Kontext Max 根本无法相提并论。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0573c980dd4e4f75a87a2e250b79568d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764322814&amp;x-signature=OwtMtGJydqoXClHGzeO6c20OHoI%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dd63021695044f22868c2d361ffaa822~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764322814&amp;x-signature=vWfqOBJ3qFJAPzunciLYJ7FKtho%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b00df594eea6446f9757813386fbfbd1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764322814&amp;x-signature=gEc3OnKQ6YvOHgasD6ilbqc4XNI%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bfca0c3fdc574ef492d9f436c07bddbd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764322814&amp;x-signature=RHM03U5k0DlNloetbo0DWh0qZy0%3D" alt="" loading="lazy"/></p>
<p>左右滑动查看</p>
<p>这一次，Nano Banana Pro 还支持 4K 原生，速度更快，成本也有所提升。</p>
<p>生成的细节，只能用「恐怖」形容。尤其是以前生成的中文就像「鬼画符」，如今汉字水平一流。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2be56a442ec749fc9c63f3a39dfa932e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764322814&amp;x-signature=buRxBEn%2FAmQaKuoqitb%2FioEHVP8%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/211795f34db04d1b97675acd0e27701a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764322814&amp;x-signature=aHIYWDwNfVlBDRLnFrJRzgfPvBk%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ba6a17fe16f64df6a297b492ec88e912~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764322814&amp;x-signature=hB1b5H1lNX%2FgXc7k6gDHrlW8SWY%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e6cb2a0f2b1c496e9c93b673087cdf8c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764322814&amp;x-signature=lFJ4MyFn8I%2B4Xu4U0t5c3VU9VFU%3D" alt="" loading="lazy"/></p>
<p>左右滑动查看</p>
<p>谷歌刚官宣没几分钟，全网再度陷入狂欢，一大波实测汹涌来袭。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/de1d58be021241c99a3eaf0a10ddcd55~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764322814&amp;x-signature=RFMuoPo2UMEYnlSyKS5p%2F0FRCCE%3D" alt="" loading="lazy"/></p>
<p>一句鸡汤、一句古诗，甚至是一大段文言文，Nano Banana Pro 一键直出颇有意境的图片，而且手写汉字完美到几乎没有一点瑕疵。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/121aa3cc1d05480db7c6f682fc5f8443~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764322814&amp;x-signature=OonBwPTlxxHp0b2EBvSyanqyCG4%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f57ac182c5f94e7a9f47d2d86bbbecdc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764322814&amp;x-signature=lRN%2B04TMsDapd02mJMbI6oyzcB4%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0d970142134c4865ba0f30786b88df66~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764322814&amp;x-signature=ydMZM4%2FxZeI8dpf1%2BPI4AUK3Mtc%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/37256cd1670b4c89b6493e0d3f941e31~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764322814&amp;x-signature=E7NhQiwYmt9YCCMPXAyjRRdz8Vg%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2d116bcfab7b4f0ba2b8469c363c0e7d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764322814&amp;x-signature=crQjk9iui6lr4rJI4qR2glx0K40%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/61eb16c7f73f413185cc95f523d9ddec~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764322814&amp;x-signature=6%2FqmFJiCMpdUEg%2BLAYX3I%2BYg80c%3D" alt="" loading="lazy"/></p>
<p>左右滑动查看</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2c327488cfed41bd9a776d178016cd06~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764322814&amp;x-signature=wFQDf%2FARqEiK6fr90c2%2Bx71u%2Bkw%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/434ec047e9f944f48cc8c8648dbb794c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764322814&amp;x-signature=R4tOuvYTtA1KL3oVP7y6x3ynwtU%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/763d38279f0841b9900c6f8e2675fc75~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764322814&amp;x-signature=jxFMX7Al6zuPPTKTsnKdlIEqito%3D" alt="" loading="lazy"/></p>
<p>左右滑动查看</p>
<p>以上中文作品来自 X 网友：@CaomuQ625、@0xbisc、@Peanut_zhc、@frxiaobei、@0xPlato、@dylandddeng</p>
<p>真 PS 时代终结者，降临了！</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f303ea9d925047be95a2977c1448ae03~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764322814&amp;x-signature=eUFEPmS%2FrSU%2BHEYZyFKwUTa0pUk%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/953cb587c7a6479e9d86d5f9885e781c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764322814&amp;x-signature=H95Xe9AwnSkZQFdYmVplJzeX%2FB4%3D" alt="" loading="lazy"/></p>
<p><strong>「三个月，终极进化」</strong></p>
<p>三个月前，为创意而生的 Nano Banana（Gemini 2.5 Flash）出世后，一夜爆红全网。</p>
<p>从修复老照片到生成 3D 迷你手办，Nano Banana 在图像编辑上树立了新里程碑。</p>
<p>任何人天马行空的想法，皆可变为现实。</p>
<p>如今，进阶版 Nano Banana Pro 出世，谷歌仅用三个月的时间，完成了另一次蜕变。</p>
<p>不管是产品原型，还是将数据、手写笔记转变为信息 / 专业图表，它都能一键可视化设计，让创意轻松成真！</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cb461855bf1d4c21b31f4e9987ebb0a1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764322814&amp;x-signature=ry5XL4hXekRZ40HwuF1AIaTTdic%3D" alt="" loading="lazy"/></p>
<p>Hassabis 称自己长期以来梦想之一，是创造出室温超导体。</p>
<p>这不，他让 Nano Banana Pro 帮忙脑补了一下。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e5556af4245e469baed57772e9d3b718~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764322814&amp;x-signature=ksXvK0dCnQTigYq093RqmqZwEjo%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/51db8cb8c1884b2fa6459be9ae1c2df5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764322814&amp;x-signature=nNqxWY11Ih3sqKsbEyhMjkI8C28%3D" alt="" loading="lazy"/></p>
<p><strong>「知识推理更强，直连搜索」</strong></p>
<p>背靠 Gemini 3 高级推理能力，Nano Banana Pro 不仅能生成精美图像，还能创作更有用的内容。</p>
<p>它可以连接到 Google 搜索的庞大的知识库，从快速生成食谱，到可视化天气、体育赛事等实时信息，皆可轻松实现。</p>
<p>如下图所示，Nano Banana Pro 通过搜索获取实时天气信息，构建了一张波普艺术风格的信息图表。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4daf937a43544ab790f911c36d98d64d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764322814&amp;x-signature=WdomvjY%2BdHFjlurWR0SolQ5BtN0%3D" alt="" loading="lazy"/></p>
<p>相比之前的图像生成模型，Nano Banana Pro 在内容准确性上显著提升，能生成更贴近事实的素材。</p>
<p>当启用基于 Google 搜索的功能时，模型将直接连接实时网络内容，确保输出内容与最新数据一致。</p>
<p>这对于需要精确呈现的应用场景特别有价值，比如生物结构图、历史地图。</p>
<p>就比如，让 Nano Banana Pro 创建一个室内植物「海龟串」（String of Turtles）的信息图表，包含原产地、养护要点和生长习性等信息。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/adbe6f89b91c4c4ea4a05fb7092027d2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764322814&amp;x-signature=oyG2eifJlLgLAXUNpcZynTz6ne4%3D" alt="" loading="lazy"/></p>
<p><em>提示词：制作一张关于这种植物的信息图表，重点关注有趣的信息</em></p>
<p>它还可以生成精准的教育演示图，无论是理解全新知识，还是呈现复杂信息。</p>
<p>下图中，Nano Banana Pro 生成了自行车护理的步骤图。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b98d0d68808949df8b888381a48f5e25~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764322814&amp;x-signature=%2BoHYZ6LUPNL7UaOnc6mcxSzVXD8%3D" alt="" loading="lazy"/></p>
<p>再比如，它可以直出白光通过三棱镜被分解成彩色光，又通过第二个三棱镜重新组合成白光的过程。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/17c8e53b74474a4c85d41b8a1b380f3e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764322814&amp;x-signature=3Ms1HbNAkQi5uB2Xlqj3OoHma4M%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6954f9913e824544894cb24a66304188~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764322814&amp;x-signature=I21sknAhAvbaeiKOwHdAh9gamcQ%3D" alt="" loading="lazy"/></p>
<p><strong>「文字秒生，还支持多语种」</strong></p>
<p>在文字渲染上，Nano Banana Pro 再次刷新天花板。</p>
<p>不论是简短的标语，还是长段落，它都能在图像中直接生成渲染精准、清晰易读的文本，堪称目前最佳模型。</p>
<p>这正是因为在理解图像深度与细节方面的卓越表现，Gemini 3 为图像编辑与创作开启了全新可能。</p>
<p>如今，人们可以在样品、海报中融入更丰富的文字细节，体验更多元的纹理、字体与书法效果。</p>
<p>相较于 Nano Banana，Pro 版更擅长处理逻辑和语言，生成清晰、准确且完美融合的文本。</p>
<p>下图中，生成了一张创意美食摄影，其中每个单词都用与食物相关的实际食材，以艺术形式拼写出来。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1ba9c17646f24b52bcbff09d9256cd75~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764322814&amp;x-signature=3L272XjFlxZWHd5BRrKWsAzKJUM%3D" alt="" loading="lazy"/></p>
<p><em>提示词：制作 8 个精致的极简主义 Logo，每个都是一个有趣的食物单词，并用逼真的食物制作字母来表达这个单词的含义。构图：在单一纯白色背景上渲染所有 Logo</em></p>
<p>而且，用 Nano Banana Pro 做营销物料、教育内容、应用程序等，特别合适。</p>
<p>在 Google AI Studio 漫画生成器中，可以生成独一无二的多页漫画，连对白字体、画风都可以玩出高级花样。</p>
<p><strong>「<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/696b303e20984331b7ab52c9c9c8474d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764322814&amp;x-signature=tbGgjNOx16VWm3%2Fchy1nwXwuWaQ%3D" alt="" loading="lazy"/>」</strong></p>
<p><strong>「细化细节：相机、灯光与格式」</strong></p>
<p>虽然简单的提示词依然有效，但要获得专业级的结果，需要更具体的指令。在编写提示词时，请超越基础描述，考虑以下高级要素：</p>
<ul>
<li>**构图与纵横比：**定义画布。（例如：一张 9:16 的垂直海报；富有电影感的 21:9 广角镜头）</li>
<li>**相机与灯光细节：**像电影摄影师那样执导镜头。（例如：低角度镜头，浅景深（f/1.8）；黄金时刻的逆光创造出长长的阴影；带有柔和青色调的电影色彩分级）</li>
<li>**特定文本集成：**清楚说明应该出现的文本内容及其外观。（例如：标题「URBAN EXPLORER」以粗体、白色无衬线字体呈现在顶部）</li>
<li>**事实约束（用于图表）：**说明对准确性的要求，并确保你的输入本身是符合事实的。（例如：科学准确的横截面图；确保维多利亚时代的历史准确性）</li>
<li>**参考输入：**使用上传的图像时，明确定义每张图像的作用。（例如：使用图像 A 作为角色的姿势，图像 B 作为艺术风格，图像 C 作为背景环境）</li>
</ul>
<p><strong>「<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/44c6d7e6a14b48aaa09a668064b0c857~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764322814&amp;x-signature=tou5FXJR1JSbT7W6Sx0mWfjeTnw%3D" alt="" loading="lazy"/>」</strong></p>
<p><strong>「提示词示例：创意技巧展示」</strong></p>
<p>不同的提示词策略可以帮助你创作从超写实编辑到奇幻新世界的各种内容。</p>
<p><strong>「1. 生成具有惊人文本渲染效果的视觉作品」</strong></p>
<p>清晰、易读的文本有助于创作出极具冲击力的海报、复杂的图表，甚至是精细的产品样品。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/66705a3e7f7b48d2ba9e1a5ae448bd25~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764322814&amp;x-signature=yQNRTKIz8jBMrzA7%2BqRb9cvHemI%3D" alt="" loading="lazy"/></p>
<p>提示词：为这个场景创建一个黑白故事板草图，展示电影的定场镜头、中景镜头、特写镜头和 POV 镜头</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9de10ce3a67d495b8a5c63a43377d36a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764322814&amp;x-signature=hwC%2Bp0Xzz2fGQ9wjgCVGDb8u%2BLs%3D" alt="" loading="lazy"/></p>
<p>提示词：创建一张图片，显示短语「How much wood would a woodchuck chuck if a woodchuck could chuck wood」（如果一只土拨鼠能扔木头，它能扔多少木头）由土拨鼠扔出的木头拼成</p>
<p><strong>「2. 利用现实世界知识进行创作」</strong></p>
<p>Nano Banana Pro 可利用 Gemini 3 的现实世界知识和深度推理能力，提供精确、详尽且丰富的图像结果。</p>
<p>比如，制作一个豆蔻茶（Elaichi Chai）的分步信息图表：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c81d33edab954fbe82b8ea01276cde24~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764322814&amp;x-signature=S4UtKUMU4QQplPlVDYW4Dw3Zd1s%3D" alt="" loading="lazy"/></p>
<p><strong>「3. 翻译并将你的创意本地化」</strong></p>
<p>生成本地化文本，或翻译图像内的文本。</p>
<p>在多种语言下，预览产品的外观，为进军国际市场做好准备，并创建适用于不同地区的海报和信息图表。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/717468d37ff345febaf10dbcd9bf5a06~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764322814&amp;x-signature=n5d0gOa7MRNJ1It2gtEuh7Ji5UY%3D" alt="" loading="lazy"/></p>
<p>提示词：将三个黄色和蓝色易拉罐上的所有英文文本翻译成韩文，同时保持其他所有内容不变</p>
<p><strong>「4. 使用工作室级控制进行编辑」</strong></p>
<p>利用丰富的控制选项，可以直接调整灯光和相机设置，如角度、焦点、色彩分级等，进而实现专业级的效果。</p>
<p>比如，应用照明和焦点控制将场景从白天转换为夜晚：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ccb6cf81af6a494f8eac30956b043fbc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764322814&amp;x-signature=KXksRhuJ2CnLdFIe2mtiZRi5AU4%3D" alt="" loading="lazy"/></p>
<p>提示词：将此场景变为夜间</p>
<p>自然，也可以反过来：将此场景从夜晚变为白天：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/80e14308b34948fba77575bfbd404b83~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764322814&amp;x-signature=XKaLKtbiH5ht4ygp34b%2FSf3b5eE%3D" alt="" loading="lazy"/></p>
<p>或者，通过调整景深或焦点（例如，聚焦于花朵）来突出构图的细节：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bf27f0aa5131410882e4ac1442562230~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764322814&amp;x-signature=W%2Bb7VKNVkbup4W0YNv%2Fc%2Fl%2BbAZ0%3D" alt="" loading="lazy"/></p>
<p>提示词：聚焦于花朵</p>
<p><strong>「5. 精确调整尺寸」</strong></p>
<p>尝试不同的纵横比，并在各种产品中生成 1K、2K 或 4K 分辨率的清晰视觉效果。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1d8b0ac36a4d4e9a92595015a730ee68~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764322814&amp;x-signature=miGfwm5mYz1XAP00K9P5dpYO%2FCc%3D" alt="" loading="lazy"/></p>
<p>提示词：通过减少背景将纵横比更改为 1:1。角色保持在当前位置</p>
<p><strong>「6. 混合图像并保持多角色一致性」</strong></p>
<p>即便多个角色出现在同一画面中，也能保持其特征的一致性和相似度。</p>
<p>提取多达 6 到 14 张（输入数量因平台而异）完全不相关的图像，并将它们融合以创造全新的作品。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7649b27c45a64a16b2070321560f3ce9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764322814&amp;x-signature=Wh%2BUhFfMrmFs3eags2%2BkG2iNPig%3D" alt="" loading="lazy"/></p>
<p>提示词：将这些图像组合成一张 16:9 格式的适当排列的电影感图像，并将人体模型上的裙子更改为图像中的裙子</p>
<p><strong>「7. 创建并保持你的品牌外观与调性」</strong></p>
<p>渲染并应用具有一致品牌风格的设计，轻松将概念可视化。</p>
<p>将图案、Logo 和艺术作品无缝贴合在 3D 物体和表面上——从服装到包装——同时保留自然的光照和纹理效果。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b3f7a76ddb3946b6b425db2cdacced5e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764322814&amp;x-signature=t%2Ba7zZyS1KXSJE4kSi6xZhMglr4%3D" alt="" loading="lazy"/></p>
<p><em>提示词 1：</em></p>
<p>创建一个图形风格的流畅 Logo，这是一种充满活力且趣味盎然的文字插图形式，深深植根于 20 世纪 60 年代和 70 年代的复古美学，大致基于草图进行创作。其标志性特征是一种时髦的、受迷幻艺术启发的字体，具有柔和、圆润且流畅的字母形态。不要完全照搬草图，而是从中汲取灵感。字母被巧妙地扭曲、拉伸和压缩，摒弃僵硬的结构，相互融合形成一个连贯、可识别的形状。</p>
<p>这种被称为图形文字（Calligram）的技法巧妙地融合了文本与图像，单词的形态在视觉上体现了其含义。单词「WAVE」被艺术地排列成波浪的流线型轮廓。该设计是一个巧妙的视觉双关语，使信息瞬间可被理解且令人难忘。</p>
<p>配色方案强化了复古感，采用简单的双色调方案，以温暖、通常柔和或大地色调的浅蓝色为背景，搭配深蓝色的 Logo。这种选择增强了作品的怀旧魅力。整体效果呈现出一种异想天开的怀旧感和巧妙的平面设计风格。这是一种大胆而平易近人的风格，通过形状和单词的无缝结合传达简单、积极的信息，产生直接而令人愉悦的视觉冲击。</p>
<p><em>提示词 2：</em></p>
<p>现在逐个创建视觉识别系统，使用 10 个高质量样品，包含各种相关产品、广告、广告牌、公交车站牌等。一次生成一个，每个均为 16:9 比例。</p>
<p><strong>「<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d64f698e0f794a3a8cdba340e8cd718d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764322814&amp;x-signature=ZjB8PEPtFDRCKKRs%2BRWnNDZaQSE%3D" alt="" loading="lazy"/>」</strong></p>
<p><strong>「使用和局限性」</strong></p>
<p>想要体验 Nano Banana Pro，只需在 Gemini 应用程序中选择「使用 Thinking 模型创建图像」即可。</p>
<p>免费用户的赠送额度用完之后，将恢复到原始的 Nano Banana 模型；而氪金的 Google AI Plus、Pro 和 Ultra 会员，则会有更高的 Pro 额度。</p>
<p>对于专业人士，谷歌将会陆续上线到所有的平台，包括 Google Ads，Google Slides，Google Vids，Gemini API，Google AI Studio，Google Antigravity，Vertex AI，Gemini Enterprise，Flow 等。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/680cb57cb05149299a597d387ff8b37d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764322814&amp;x-signature=N11I89jjUQ%2Bse1cIA23cpxb%2BjUM%3D" alt="" loading="lazy"/></p>
<p>不过，虽然 Nano Banana Pro 已经很强了，但它在一些领域仍有待改进：</p>
<ul>
<li>**视觉与文本保真度：**在渲染小字号文本、精细细节以及生成准确拼写方面，效果可能尚不完美。</li>
<li>**数据与事实准确性：**请务必核实图表、信息图等基于数据的视觉内容的事实准确性。</li>
<li>**翻译与本地化：**多语言文本生成可能会出现语法错误，或未能精准捕捉特定的文化差异。</li>
<li>**复杂编辑与图像融合：**图像融合或光照调整等高级编辑任务，有时可能会产生不自然的伪影。</li>
<li>**角色特征：**虽然通常表现可靠，但在多次编辑过程中，角色特征的一致性可能会出现波动。</li>
</ul>
<p>值得一提的是，在 SynthID 数字水印技术的加持下，我们可以将图像上传到 Gemini 应用中，直接询问它是否由 Google AI 生成。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1bb0730f4989437ca50ff688c06a8eb4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764322814&amp;x-signature=e5UVelZJmllJ2AwUQnMNUd9OKNY%3D" alt="" loading="lazy"/></p>
<p>最后的最后，还是想要吐槽一下，一周内 AI 大事件四连更，真是有点心力交瘁了...</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d6a89afc15684b959d94794246b04c5d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764322814&amp;x-signature=mSxz9Seknlo%2F1tsZNruvS0d2QuI%3D" alt="" loading="lazy"/></p>
<p>参考资料：</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.google%2Ftechnology%2Fdevelopers%2Fgemini-3-pro-image-developers%2F" target="_blank" title="https://blog.google/technology/developers/gemini-3-pro-image-developers/" ref="nofollow noopener noreferrer">blog.google/technology/…</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.google%2Fproducts%2Fgemini%2Fprompting-tips-nano-banana-pro%2F" target="_blank" title="https://blog.google/products/gemini/prompting-tips-nano-banana-pro/" ref="nofollow noopener noreferrer">blog.google/products/ge…</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.google%2Ftechnology%2Fai%2Fnano-banana-pro%2F" target="_blank" title="https://blog.google/technology/ai/nano-banana-pro/" ref="nofollow noopener noreferrer">blog.google/technology/…</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fx.com%2FGorden_Sun%2Fstatus%2F1991441658941173902%3Fs%3D20" target="_blank" title="https://x.com/Gorden_Sun/status/1991441658941173902?s=20" ref="nofollow noopener noreferrer">x.com/Gorden_Sun/…</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fx.com%2F0xbisc%2Fstatus%2F1991471506099171363%3Fs%3D20" target="_blank" title="https://x.com/0xbisc/status/1991471506099171363?s=20" ref="nofollow noopener noreferrer">x.com/0xbisc/stat…</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fx.com%2FCaomuQ625%2Fstatus%2F1990831026239943060%3Fs%3D20" target="_blank" title="https://x.com/CaomuQ625/status/1990831026239943060?s=20" ref="nofollow noopener noreferrer">x.com/CaomuQ625/s…</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fx.com%2FPeanut_zhc%2Fstatus%2F1991524507098791986%3Fs%3D20" target="_blank" title="https://x.com/Peanut_zhc/status/1991524507098791986?s=20" ref="nofollow noopener noreferrer">x.com/Peanut_zhc/…</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fx.com%2Ffrxiaobei%2Fstatus%2F1991474928596709747%3Fs%3D20" target="_blank" title="https://x.com/frxiaobei/status/1991474928596709747?s=20" ref="nofollow noopener noreferrer">x.com/frxiaobei/s…</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fx.com%2F0xPlato%2Fstatus%2F1991511443641094418%3Fs%3D20" target="_blank" title="https://x.com/0xPlato/status/1991511443641094418?s=20" ref="nofollow noopener noreferrer">x.com/0xPlato/sta…</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fx.com%2Fdylandddeng%2Fstatus%2F1991507274813096153%3Fs%3D20" target="_blank" title="https://x.com/dylandddeng/status/1991507274813096153?s=20" ref="nofollow noopener noreferrer">x.com/dylandddeng…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[打包生成的苹果APP上架到苹果官方appstore商店的详细流程与教程]]></title>    <link>https://juejin.cn/post/7574967214128250906</link>    <guid>https://juejin.cn/post/7574967214128250906</guid>    <pubDate>2025-11-21T09:48:26.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574967214128250906" data-draft-id="7574848503731634222" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="打包生成的苹果APP上架到苹果官方appstore商店的详细流程与教程"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-21T09:48:26.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="疯狂的程序猴"/> <meta itemprop="url" content="https://juejin.cn/user/2760245749234147"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            打包生成的苹果APP上架到苹果官方appstore商店的详细流程与教程
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2760245749234147/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    疯狂的程序猴
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T09:48:26.000Z" title="Fri Nov 21 2025 09:48:26 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>打包生成的苹果APP上架到苹果官方appstore商店的详细流程与教程</p>
<p>第一步：创建app发布证书以及配置文件</p>
<p>1、打开苹果开发者中心网站：<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.apple.com%25EF%25BC%258C%25E7%2582%25B9%25E5%2587%25BB%25E5%258F%25B3%25E4%25B8%258A%25E8%25A7%2592" target="_blank" title="https://developer.apple.com%EF%BC%8C%E7%82%B9%E5%87%BB%E5%8F%B3%E4%B8%8A%E8%A7%92" ref="nofollow noopener noreferrer">developer.apple.com，点击右上角</a> Account 使用开发者账号登录</p>
<p>​</p>
<p>2、登录成功后，点击 Certificates, ldentifiers &amp; Profiles</p>
<p>​</p>
<ol start="2">
<li>点击进入 Certificates，Identifiers &amp; Profiles</li>
</ol>
<p>​</p>
<p>说明：因为这次需要的是发布app，所以证书需要选择的是Production版本，而开发测试的话是Development版本。</p>
<ol start="3">
<li>在Identifers中创建App IDs</li>
</ol>
<p>​</p>
<p>说明：APPid也叫包名，APPid必须是唯一的，不能包含 特殊符号。填写AppID名称, 输入AppID Deion Name，用来描述您的AppID。（注意，必须输入英文）,下方App ID Suffix输 入Bundle ID：这是您AppID的后缀，这个需要仔细命名，因为这个内容和您的程序直接相关，很多地方都需要用到，最好是com.yourcompany.yourappname的格式。当然对于没有公司名的个人开发者，也可以用您自己的英文名字或者拼音。</p>
<p>​</p>
<p>App Services服务选择推送服务
​</p>
<p>说明：这里勾选“推送”服务，下一步“完成”。</p>
<p>第二步：导出本地证书文件</p>
<p>1、打开“应用程序”–&gt;“实用工具”–&gt;“钥匙串访问”–&gt;“证书助理”中选择“从证书颁发机构请求证书”
2、选择从证书颁发机构请求证书</p>
<p>​</p>
<p>3、打开后进入下图所示界面</p>
<p>“用户电子邮件地址”：必须填开发者账号所用的邮箱地址,</p>
<p>“常用名称”：用户可以自定义名称，建议直接填写APP名称，后面导出证书的时候容易分辨</p>
<p>选择存储到磁盘,点击“继续”。将本地证书文件文件保存到电脑中备用。</p>
<p>注：本地证书文件（即CSR文件）</p>
<p>第三步：创建发布证书
​</p>
<p>这里选择的类型是Production下的，然后选择 App Store and Ad Hoc.
​</p>
<p>选择本地的CSR请求文件，下一步“完成”。</p>
<p>5.创建推送证书：
​</p>
<p>选择刚才创建的APPID</p>
<p>下一步，选择本地生成的CSR文件。</p>
<p>第四步：创建配置文件</p>
<p>选择App Store，进入下一步。</p>
<p>选择刚才创建的APP ID</p>
<p>​</p>
<p>选择创建好的发布证书，进入下一步。</p>
<p>​</p>
<p>填写配置文件，进入下一步“完成”，下载即可。</p>
<p>第五步：创建推送证书</p>
<p>​</p>
<p>至此，申请苹果证书步骤完成，我们得到三个有效的文件</p>
<p>​</p>
<p>可以看到上述证书，描述文件制作是非常复杂的。我们可以借助辅助工具appuploder， 一键制作证书描述文件 "一键制作证书描述文件")，还有 打包IPA上架 "打包IPA上架") 功能。</p>
<p>APP Store上架需要注意以下几点：</p>
<p>1、不能有产品下载（非iOS，以及企业发布地址）的链接及二维码。2、不能带有升级的按钮以及提示。3、在app提交平台填上该网站的测试帐号。4、页面要保持简洁美观。5、网站不能出现测试页面、Beta等。</p>
<p>6、APP内容完善，不能访问各页面都是空的。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【穿越Effective C++】23.宁以non-member、non-friend替换member函数]]></title>    <link>https://juejin.cn/post/7574840547807887370</link>    <guid>https://juejin.cn/post/7574840547807887370</guid>    <pubDate>2025-11-21T09:47:12.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574840547807887370" data-draft-id="7574840547807870986" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【穿越Effective C++】23.宁以non-member、non-friend替换member函数"/> <meta itemprop="keywords" content="C++,面试"/> <meta itemprop="datePublished" content="2025-11-21T09:47:12.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="沐怡旸"/> <meta itemprop="url" content="https://juejin.cn/user/2875978146656750"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【穿越Effective C++】23.宁以non-member、non-friend替换member函数
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2875978146656750/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    沐怡旸
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T09:47:12.000Z" title="Fri Nov 21 2025 09:47:12 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>这个条款揭示了C++软件设计的一个重要原则：通过使用非成员非友元函数来最大化类的封装性。这种方法不仅减少了类接口的复杂度，还提高了代码的可维护性和可扩展性，是构建模块化软件系统的关键策略。</p>
<hr/>
<h3 data-id="heading-0"><strong>思维导图：非成员函数设计的完整体系</strong></h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4d74765d4c04493289650058debc95bd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rKQ5oCh5pe4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764323232&amp;x-signature=uDZHS%2FzZEpMKhKTd7NiKILfoJKA%3D" alt="image.png" loading="lazy"/></p>
<hr/>
<h3 data-id="heading-1"><strong>关键洞见与行动指南</strong></h3>
<h4 data-id="heading-2"><strong>必须遵守的核心原则：</strong></h4>
<ol>
<li><strong>封装性最大化</strong>：优先选择无法访问私有成员的非成员函数</li>
<li><strong>接口最小化</strong>：类的公有接口应该只包含核心功能</li>
<li><strong>功能正交性</strong>：相关但不核心的功能应该作为非成员函数提供</li>
<li><strong>命名空间组织</strong>：使用命名空间将相关功能逻辑分组</li>
</ol>
<h4 data-id="heading-3"><strong>现代C++开发建议：</strong></h4>
<ol>
<li><strong>ADL的充分利用</strong>：依靠参数依赖查找自动发现相关函数</li>
<li><strong>概念约束应用</strong>：为非成员函数添加编译期接口约束</li>
<li><strong>移动语义支持</strong>：在工具函数中正确处理值类别</li>
<li><strong>模块化设计</strong>：将相关功能组织在独立的命名空间中</li>
</ol>
<h4 data-id="heading-4"><strong>设计原则总结：</strong></h4>
<ol>
<li><strong>最小知识原则</strong>：函数应该只与其直接相关的类型交互</li>
<li><strong>高内聚低耦合</strong>：功能相关的代码应该组织在一起，依赖应该最小化</li>
<li><strong>组合优于继承</strong>：通过函数组合构建复杂行为，而非类继承</li>
<li><strong>显式优于隐式</strong>：依赖关系应该明确而非隐藏在类继承中</li>
</ol>
<h4 data-id="heading-5"><strong>需要警惕的陷阱：</strong></h4>
<ol>
<li><strong>过度分解</strong>：将紧密相关的操作不合理地分离</li>
<li><strong>命名空间污染</strong>：在全局命名空间中定义过多函数</li>
<li><strong>ADL意外</strong>：参数依赖查找可能导致意外的函数调用</li>
<li><strong>接口碎片化</strong>：功能分散在过多位置导致使用困难</li>
</ol>
<p><strong>最终建议：</strong> 将类视为数据和行为的核心容器，而非所有相关功能的聚集地。培养"非成员思维"——在设计每个功能时都思考："这个操作真的需要访问私有成员吗？能否通过公有接口实现？" 这种思考方式是构建松耦合、高内聚软件系统的关键。</p>
<p>记住：<strong>在C++设计中，非成员非友元函数是最大化封装性的有力工具。它们让类保持精简和专注，同时通过命名空间提供清晰的扩展机制。</strong> 条款23教会我们的不仅是一种技术选择，更是软件模块化设计哲学的体现。</p>
<hr/>
<h3 data-id="heading-6"><strong>深入解析：封装性最大化的核心价值</strong></h3>
<h4 data-id="heading-7"><strong>1. 封装性的本质</strong></h4>
<p><strong>封装性的层级比较：</strong></p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">WebBrowser</span> {
<span class="hljs-keyword">private</span>:
    <span class="hljs-comment">// 私有实现细节</span>
    std::vector&lt;std::string&gt; cookies;
    std::vector&lt;std::string&gt; history;
    std::string cache;
    
<span class="hljs-keyword">public</span>:
    <span class="hljs-comment">// 核心成员函数 - 必须访问私有成员</span>
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">clearCache</span><span class="hljs-params">()</span> </span>{ cache.<span class="hljs-built_in">clear</span>(); }
    
    <span class="hljs-comment">// 有争议的成员函数 - 可以通过公有接口实现</span>
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">clearEverything</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-built_in">clearCookies</span>();    <span class="hljs-comment">// 公有接口</span>
        <span class="hljs-built_in">clearHistory</span>();    <span class="hljs-comment">// 公有接口  </span>
        <span class="hljs-built_in">clearCache</span>();      <span class="hljs-comment">// 公有接口</span>
    }
    
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">clearCookies</span><span class="hljs-params">()</span> </span>{ cookies.<span class="hljs-built_in">clear</span>(); }
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">clearHistory</span><span class="hljs-params">()</span> </span>{ history.<span class="hljs-built_in">clear</span>(); }
};

<span class="hljs-comment">// 更好的设计：非成员函数</span>
<span class="hljs-keyword">namespace</span> WebBrowserUtils {
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">clearEverything</span><span class="hljs-params">(WebBrowser&amp; browser)</span> </span>{
        browser.<span class="hljs-built_in">clearCookies</span>();
        browser.<span class="hljs-built_in">clearHistory</span>(); 
        browser.<span class="hljs-built_in">clearCache</span>();
    }
    
    <span class="hljs-comment">// 可以轻松添加新功能而不修改WebBrowser类</span>
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">backupAndClear</span><span class="hljs-params">(WebBrowser&amp; browser)</span> </span>{
        <span class="hljs-keyword">auto</span> backup = <span class="hljs-built_in">createBackup</span>(browser);
        <span class="hljs-built_in">clearEverything</span>(browser);
        <span class="hljs-built_in">saveBackup</span>(backup);
    }
}
</code></pre>
<h4 data-id="heading-8"><strong>2. 编译依赖的减少</strong></h4>
<p><strong>减少编译依赖的实际收益：</strong></p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// 成员函数方式 - 增加编译依赖</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">DataProcessor</span> {
<span class="hljs-keyword">private</span>:
    ComplexDataType data;  <span class="hljs-comment">// 需要包含ComplexDataType的定义</span>
    
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">processAndExport</span><span class="hljs-params">()</span> </span>{  <span class="hljs-comment">// 需要知道export格式</span>
        <span class="hljs-built_in">processData</span>();
        <span class="hljs-built_in">exportToJSON</span>();   <span class="hljs-comment">// 强制依赖JSON库</span>
    }
};

<span class="hljs-comment">// 非成员函数方式 - 减少编译依赖</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">DataProcessor</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">processData</span><span class="hljs-params">()</span> </span>{ <span class="hljs-comment">/* 只处理数据 */</span> }
    <span class="hljs-comment">// 不强制依赖特定导出格式</span>
};

<span class="hljs-keyword">namespace</span> DataExport {
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">exportToJSON</span><span class="hljs-params">(<span class="hljs-type">const</span> DataProcessor&amp; processor)</span></span>;
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">exportToXML</span><span class="hljs-params">(<span class="hljs-type">const</span> DataProcessor&amp; processor)</span></span>;
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">exportToCSV</span><span class="hljs-params">(<span class="hljs-type">const</span> DataProcessor&amp; processor)</span></span>;
    <span class="hljs-comment">// 新增格式无需修改DataProcessor类</span>
}
</code></pre>
<hr/>
<h3 data-id="heading-9"><strong>解决方案：非成员函数设计模式</strong></h3>
<h4 data-id="heading-10"><strong>1. 工具函数命名空间</strong></h4>
<p><strong>逻辑分组的命名空间设计：</strong></p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Document</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-comment">// 核心操作 - 必须访问私有成员</span>
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">save</span><span class="hljs-params">(<span class="hljs-type">const</span> std::string&amp; filename)</span></span>;
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">load</span><span class="hljs-params">(<span class="hljs-type">const</span> std::string&amp; filename)</span></span>;
    <span class="hljs-function">std::string <span class="hljs-title">getContent</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>;
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">setContent</span><span class="hljs-params">(<span class="hljs-type">const</span> std::string&amp; content)</span></span>;
    
    <span class="hljs-comment">// 基础查询接口</span>
    <span class="hljs-function"><span class="hljs-type">size_t</span> <span class="hljs-title">wordCount</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>;
    <span class="hljs-function"><span class="hljs-type">size_t</span> <span class="hljs-title">charCount</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>;
};

<span class="hljs-keyword">namespace</span> DocumentUtils {
    <span class="hljs-comment">// 便利操作 - 通过公有接口实现</span>
    <span class="hljs-function"><span class="hljs-type">double</span> <span class="hljs-title">calculateReadability</span><span class="hljs-params">(<span class="hljs-type">const</span> Document&amp; doc)</span></span>;
    <span class="hljs-function">std::string <span class="hljs-title">generateSummary</span><span class="hljs-params">(<span class="hljs-type">const</span> Document&amp; doc, <span class="hljs-type">size_t</span> maxLength)</span></span>;
    <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">isPlagiarized</span><span class="hljs-params">(<span class="hljs-type">const</span> Document&amp; doc1, <span class="hljs-type">const</span> Document&amp; doc2)</span></span>;
    
    <span class="hljs-comment">// 批量操作</span>
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">batchProcess</span><span class="hljs-params">(std::vector&lt;Document&gt;&amp; docs)</span></span>;
    <span class="hljs-function">std::vector&lt;std::string&gt; <span class="hljs-title">extractKeywords</span><span class="hljs-params">(<span class="hljs-type">const</span> Document&amp; doc)</span></span>;
    
    <span class="hljs-comment">// 格式转换</span>
    <span class="hljs-function">Document <span class="hljs-title">convertFromPDF</span><span class="hljs-params">(<span class="hljs-type">const</span> std::string&amp; pdfContent)</span></span>;
    <span class="hljs-function">std::string <span class="hljs-title">convertToHTML</span><span class="hljs-params">(<span class="hljs-type">const</span> Document&amp; doc)</span></span>;
}

<span class="hljs-comment">// 使用示例</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">processDocument</span><span class="hljs-params">(Document&amp; doc)</span> </span>{
    doc.<span class="hljs-built_in">save</span>(<span class="hljs-string">"original.txt"</span>);
    
    <span class="hljs-comment">// 使用工具函数</span>
    <span class="hljs-keyword">auto</span> readability = DocumentUtils::<span class="hljs-built_in">calculateReadability</span>(doc);
    <span class="hljs-keyword">auto</span> summary = DocumentUtils::<span class="hljs-built_in">generateSummary</span>(doc, <span class="hljs-number">200</span>);
    
    <span class="hljs-comment">// 新增功能不影响Document类接口</span>
}
</code></pre>
<h4 data-id="heading-11"><strong>2. 算法与数据分离</strong></h4>
<p><strong>STL设计哲学的借鉴：</strong></p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// 遵循STL的算法与容器分离原则</span>
<span class="hljs-keyword">namespace</span> GeometryAlgorithms {
    <span class="hljs-comment">// 几何算法 - 独立于具体几何类型</span>
    <span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> Point&gt;
    <span class="hljs-type">double</span> <span class="hljs-title">distance</span><span class="hljs-params">(<span class="hljs-type">const</span> Point&amp; p1, <span class="hljs-type">const</span> Point&amp; p2)</span></span>;
    
    <span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> Polygon&gt;
    <span class="hljs-type">double</span> <span class="hljs-title">area</span><span class="hljs-params">(<span class="hljs-type">const</span> Polygon&amp; poly)</span></span>;
    
    <span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> Shape1, <span class="hljs-keyword">typename</span> Shape2&gt;
    <span class="hljs-type">bool</span> <span class="hljs-title">intersects</span><span class="hljs-params">(<span class="hljs-type">const</span> Shape1&amp; s1, <span class="hljs-type">const</span> Shape2&amp; s2)</span></span>;
    
    <span class="hljs-comment">// 几何变换</span>
    <span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> Shape&gt;
    Shape <span class="hljs-title">scale</span><span class="hljs-params">(<span class="hljs-type">const</span> Shape&amp; shape, <span class="hljs-type">double</span> factor)</span></span>;
    
    <span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> Shape&gt;  
    Shape <span class="hljs-title">rotate</span><span class="hljs-params">(<span class="hljs-type">const</span> Shape&amp; shape, <span class="hljs-type">double</span> angle)</span></span>;
}

<span class="hljs-comment">// 具体几何类保持精简</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Rectangle</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-comment">// 只提供基础访问接口</span>
    <span class="hljs-function">Point <span class="hljs-title">getTopLeft</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>;
    <span class="hljs-function">Point <span class="hljs-title">getBottomRight</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>;
    <span class="hljs-function"><span class="hljs-type">double</span> <span class="hljs-title">getWidth</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>;
    <span class="hljs-function"><span class="hljs-type">double</span> <span class="hljs-title">getHeight</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>;
    
    <span class="hljs-comment">// 不包含复杂算法</span>
};

<span class="hljs-comment">// 使用方式</span>
Rectangle rect;
<span class="hljs-keyword">auto</span> area = GeometryAlgorithms::<span class="hljs-built_in">area</span>(rect);
<span class="hljs-keyword">auto</span> scaled = GeometryAlgorithms::<span class="hljs-built_in">scale</span>(rect, <span class="hljs-number">2.0</span>);
</code></pre>
<hr/>
<h3 data-id="heading-12"><strong>实际应用场景分析</strong></h3>
<h4 data-id="heading-13"><strong>1. 输入输出操作符</strong></h4>
<p><strong>经典的非成员函数应用：</strong></p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Complex</span> {
<span class="hljs-keyword">private</span>:
    <span class="hljs-type">double</span> real, imag;
    
<span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">Complex</span>(<span class="hljs-type">double</span> r, <span class="hljs-type">double</span> i) : <span class="hljs-built_in">real</span>(r), <span class="hljs-built_in">imag</span>(i) {}
    
    <span class="hljs-comment">// 基础访问接口</span>
    <span class="hljs-function"><span class="hljs-type">double</span> <span class="hljs-title">getReal</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>{ <span class="hljs-keyword">return</span> real; }
    <span class="hljs-function"><span class="hljs-type">double</span> <span class="hljs-title">getImag</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>{ <span class="hljs-keyword">return</span> imag; }
    
    <span class="hljs-comment">// 算术运算可以作为成员或非成员</span>
    Complex <span class="hljs-keyword">operator</span>+(<span class="hljs-type">const</span> Complex&amp; other) <span class="hljs-type">const</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">Complex</span>(real + other.real, imag + other.imag);
    }
};

<span class="hljs-comment">// 非成员函数 - 更好的封装性</span>
std::ostream&amp; <span class="hljs-keyword">operator</span>&lt;&lt;(std::ostream&amp; os, <span class="hljs-type">const</span> Complex&amp; c) {
    <span class="hljs-keyword">return</span> os &lt;&lt; c.<span class="hljs-built_in">getReal</span>() &lt;&lt; <span class="hljs-string">" + "</span> &lt;&lt; c.<span class="hljs-built_in">getImag</span>() &lt;&lt; <span class="hljs-string">"i"</span>;
}

std::istream&amp; <span class="hljs-keyword">operator</span>&gt;&gt;(std::istream&amp; is, Complex&amp; c) {
    <span class="hljs-type">double</span> real, imag;
    <span class="hljs-type">char</span> plus, imaginary;
    <span class="hljs-keyword">if</span> (is &gt;&gt; real &gt;&gt; plus &gt;&gt; imag &gt;&gt; imaginary) {
        <span class="hljs-keyword">if</span> (plus == <span class="hljs-string">'+'</span> &amp;&amp; imaginary == <span class="hljs-string">'i'</span>) {
            c = <span class="hljs-built_in">Complex</span>(real, imag);
            <span class="hljs-keyword">return</span> is;
        }
    }
    is.<span class="hljs-built_in">setstate</span>(std::ios::failbit);
    <span class="hljs-keyword">return</span> is;
}

<span class="hljs-comment">// 额外的非成员运算</span>
Complex <span class="hljs-keyword">operator</span>*(<span class="hljs-type">const</span> Complex&amp; a, <span class="hljs-type">const</span> Complex&amp; b) {
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">Complex</span>(a.<span class="hljs-built_in">getReal</span>() * b.<span class="hljs-built_in">getReal</span>() - a.<span class="hljs-built_in">getImag</span>() * b.<span class="hljs-built_in">getImag</span>(),
                  a.<span class="hljs-built_in">getReal</span>() * b.<span class="hljs-built_in">getImag</span>() + a.<span class="hljs-built_in">getImag</span>() * b.<span class="hljs-built_in">getReal</span>());
}
</code></pre>
<h4 data-id="heading-14"><strong>2. 策略模式的非成员实现</strong></h4>
<p><strong>通过函数对象实现策略：</strong></p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">DataSorter</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-comment">// 核心数据访问</span>
    <span class="hljs-function"><span class="hljs-type">const</span> std::vector&lt;<span class="hljs-type">int</span>&gt;&amp; <span class="hljs-title">getData</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>;
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">setData</span><span class="hljs-params">(<span class="hljs-type">const</span> std::vector&lt;<span class="hljs-type">int</span>&gt;&amp; data)</span></span>;
    
    <span class="hljs-comment">// 不包含具体排序算法</span>
};

<span class="hljs-keyword">namespace</span> SortingStrategies {
    <span class="hljs-comment">// 排序策略作为函数对象</span>
    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">AscendingSort</span> {
        <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">operator</span><span class="hljs-params">()</span><span class="hljs-params">(std::vector&lt;<span class="hljs-type">int</span>&gt;&amp; data)</span> <span class="hljs-type">const</span></span>;
    };
    
    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">DescendingSort</span> {
        <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">operator</span><span class="hljs-params">()</span><span class="hljs-params">(std::vector&lt;<span class="hljs-type">int</span>&gt;&amp; data)</span> <span class="hljs-type">const</span></span>;  
    };
    
    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">CustomSort</span> {
        std::function&lt;<span class="hljs-type">bool</span>(<span class="hljs-type">int</span>, <span class="hljs-type">int</span>)&gt; comparator;
        <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">operator</span><span class="hljs-params">()</span><span class="hljs-params">(std::vector&lt;<span class="hljs-type">int</span>&gt;&amp; data)</span> <span class="hljs-type">const</span></span>;
    };
    
    <span class="hljs-comment">// 非成员排序函数</span>
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">sortData</span><span class="hljs-params">(DataSorter&amp; sorter, <span class="hljs-type">const</span> AscendingSort&amp; strategy)</span></span>;
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">sortData</span><span class="hljs-params">(DataSorter&amp; sorter, <span class="hljs-type">const</span> DescendingSort&amp; strategy)</span></span>;
}

<span class="hljs-comment">// 使用示例</span>
DataSorter sorter;
SortingStrategies::<span class="hljs-built_in">sortData</span>(sorter, SortingStrategies::AscendingSort{});
</code></pre>
<hr/>
<h3 data-id="heading-15"><strong>现代C++的增强特性</strong></h3>
<h4 data-id="heading-16"><strong>1. 参数依赖查找(ADL)</strong></h4>
<p><strong>利用ADL简化代码：</strong></p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">namespace</span> MyLibrary {
    <span class="hljs-keyword">class</span> <span class="hljs-title class_">String</span> {
    <span class="hljs-keyword">public</span>:
        <span class="hljs-built_in">String</span>(<span class="hljs-type">const</span> <span class="hljs-type">char</span>* str);
        <span class="hljs-function"><span class="hljs-type">const</span> <span class="hljs-type">char</span>* <span class="hljs-title">c_str</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>;
        <span class="hljs-comment">// 不定义输出操作符</span>
    };
    
    <span class="hljs-comment">// ADL会找到这个函数</span>
    std::ostream&amp; <span class="hljs-keyword">operator</span>&lt;&lt;(std::ostream&amp; os, <span class="hljs-type">const</span> String&amp; str) {
        <span class="hljs-keyword">return</span> os &lt;&lt; str.<span class="hljs-built_in">c_str</span>();
    }
}

<span class="hljs-comment">// 使用ADL - 不需要限定命名空间</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">useString</span><span class="hljs-params">()</span> </span>{
    MyLibrary::String str = <span class="hljs-string">"Hello"</span>;
    std::cout &lt;&lt; str;  <span class="hljs-comment">// 自动找到MyLibrary::operator&lt;&lt;</span>
}
</code></pre>
<h4 data-id="heading-17"><strong>2. 概念约束的编译期验证</strong></h4>
<p><strong>为工具函数添加接口约束：</strong></p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">namespace</span> RangeAlgorithms {
    <span class="hljs-comment">// 概念约束确保接口正确性</span>
    <span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> Range&gt;
    <span class="hljs-keyword">concept</span> ReadableRange = <span class="hljs-built_in">requires</span>(Range r) {
        r.<span class="hljs-built_in">begin</span>();
        r.<span class="hljs-built_in">end</span>();
    };
    
    <span class="hljs-function"><span class="hljs-keyword">template</span>&lt;ReadableRange Range&gt;
    <span class="hljs-keyword">auto</span> <span class="hljs-title">findMax</span><span class="hljs-params">(<span class="hljs-type">const</span> Range&amp; range)</span> </span>{
        <span class="hljs-keyword">return</span> *std::<span class="hljs-built_in">max_element</span>(range.<span class="hljs-built_in">begin</span>(), range.<span class="hljs-built_in">end</span>());
    }
    
    <span class="hljs-function"><span class="hljs-keyword">template</span>&lt;ReadableRange Range&gt;  
    <span class="hljs-type">bool</span> <span class="hljs-title">contains</span><span class="hljs-params">(<span class="hljs-type">const</span> Range&amp; range, <span class="hljs-type">const</span> <span class="hljs-keyword">typename</span> Range::value_type&amp; value)</span> </span>{
        <span class="hljs-keyword">return</span> std::<span class="hljs-built_in">find</span>(range.<span class="hljs-built_in">begin</span>(), range.<span class="hljs-built_in">end</span>(), value) != range.<span class="hljs-built_in">end</span>();
    }
}

<span class="hljs-comment">// 可用于任何满足概念的类型</span>
std::vector&lt;<span class="hljs-type">int</span>&gt; vec = {<span class="hljs-number">1</span>, <span class="hljs-number">5</span>, <span class="hljs-number">3</span>, <span class="hljs-number">9</span>, <span class="hljs-number">2</span>};
std::array&lt;<span class="hljs-type">double</span>, 4&gt; arr = {<span class="hljs-number">1.1</span>, <span class="hljs-number">2.2</span>, <span class="hljs-number">3.3</span>, <span class="hljs-number">4.4</span>};

<span class="hljs-keyword">auto</span> maxVec = RangeAlgorithms::<span class="hljs-built_in">findMax</span>(vec);    <span class="hljs-comment">// 编译期验证</span>
<span class="hljs-keyword">auto</span> maxArr = RangeAlgorithms::<span class="hljs-built_in">findMax</span>(arr);    <span class="hljs-comment">// 编译期验证</span>
</code></pre>
<hr/>
<h3 data-id="heading-18"><strong>工程实践中的权衡</strong></h3>
<h4 data-id="heading-19"><strong>1. 性能与封装的平衡</strong></h4>
<p><strong>内联工具函数的性能优化：</strong></p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Vector3D</span> {
<span class="hljs-keyword">private</span>:
    <span class="hljs-type">double</span> x, y, z;
    
<span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">Vector3D</span>(<span class="hljs-type">double</span> x, <span class="hljs-type">double</span> y, <span class="hljs-type">double</span> z) : <span class="hljs-built_in">x</span>(x), <span class="hljs-built_in">y</span>(y), <span class="hljs-built_in">z</span>(z) {}
    
    <span class="hljs-comment">// 基础访问函数 - 可内联</span>
    <span class="hljs-function"><span class="hljs-type">double</span> <span class="hljs-title">getX</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> <span class="hljs-keyword">noexcept</span> </span>{ <span class="hljs-keyword">return</span> x; }
    <span class="hljs-function"><span class="hljs-type">double</span> <span class="hljs-title">getY</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> <span class="hljs-keyword">noexcept</span> </span>{ <span class="hljs-keyword">return</span> y; }
    <span class="hljs-function"><span class="hljs-type">double</span> <span class="hljs-title">getZ</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> <span class="hljs-keyword">noexcept</span> </span>{ <span class="hljs-keyword">return</span> z; }
};

<span class="hljs-keyword">namespace</span> VectorOperations {
    <span class="hljs-comment">// 内联工具函数 - 零开销抽象</span>
    <span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-type">double</span> <span class="hljs-title">dotProduct</span><span class="hljs-params">(<span class="hljs-type">const</span> Vector3D&amp; a, <span class="hljs-type">const</span> Vector3D&amp; b)</span> </span>{
        <span class="hljs-keyword">return</span> a.<span class="hljs-built_in">getX</span>() * b.<span class="hljs-built_in">getX</span>() + a.<span class="hljs-built_in">getY</span>() * b.<span class="hljs-built_in">getY</span>() + a.<span class="hljs-built_in">getZ</span>() * b.<span class="hljs-built_in">getZ</span>();
    }
    
    <span class="hljs-function"><span class="hljs-keyword">inline</span> Vector3D <span class="hljs-title">crossProduct</span><span class="hljs-params">(<span class="hljs-type">const</span> Vector3D&amp; a, <span class="hljs-type">const</span> Vector3D&amp; b)</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">Vector3D</span>(
            a.<span class="hljs-built_in">getY</span>() * b.<span class="hljs-built_in">getZ</span>() - a.<span class="hljs-built_in">getZ</span>() * b.<span class="hljs-built_in">getY</span>(),
            a.<span class="hljs-built_in">getZ</span>() * b.<span class="hljs-built_in">getX</span>() - a.<span class="hljs-built_in">getX</span>() * b.<span class="hljs-built_in">getZ</span>(), 
            a.<span class="hljs-built_in">getX</span>() * b.<span class="hljs-built_in">getY</span>() - a.<span class="hljs-built_in">getY</span>() * b.<span class="hljs-built_in">getX</span>()
        );
    }
}

<span class="hljs-comment">// 使用示例 - 性能与封装的完美结合</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">physicsCalculation</span><span class="hljs-params">(<span class="hljs-type">const</span> Vector3D&amp; v1, <span class="hljs-type">const</span> Vector3D&amp; v2)</span> </span>{
    <span class="hljs-keyword">auto</span> dot = VectorOperations::<span class="hljs-built_in">dotProduct</span>(v1, v2);  <span class="hljs-comment">// 可能内联</span>
    <span class="hljs-keyword">auto</span> cross = VectorOperations::<span class="hljs-built_in">crossProduct</span>(v1, v2);
}
</code></pre>
<h4 data-id="heading-20"><strong>2. 团队协作的便利性</strong></h4>
<p><strong>跨团队开发的模块化支持：</strong></p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// 核心团队维护 - 稳定接口</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">DatabaseConnection</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">connect</span><span class="hljs-params">(<span class="hljs-type">const</span> std::string&amp; connectionString)</span></span>;
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">disconnect</span><span class="hljs-params">()</span></span>;
    <span class="hljs-function">QueryResult <span class="hljs-title">executeQuery</span><span class="hljs-params">(<span class="hljs-type">const</span> std::string&amp; query)</span></span>;
    
<span class="hljs-keyword">private</span>:
    <span class="hljs-comment">// 实现细节隐藏</span>
};

<span class="hljs-comment">// 工具团队开发 - 独立演进</span>
<span class="hljs-keyword">namespace</span> DatabaseUtilities {
    <span class="hljs-comment">// 连接管理工具</span>
    <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConnectionPool</span> {
    <span class="hljs-keyword">public</span>:
        <span class="hljs-function">DatabaseConnection&amp; <span class="hljs-title">getConnection</span><span class="hljs-params">()</span></span>;
        <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">returnConnection</span><span class="hljs-params">(DatabaseConnection&amp; conn)</span></span>;
    };
    
    <span class="hljs-comment">// 查询构建工具</span>
    <span class="hljs-keyword">class</span> <span class="hljs-title class_">QueryBuilder</span> {
    <span class="hljs-keyword">public</span>:
        <span class="hljs-function">QueryBuilder&amp; <span class="hljs-title">select</span><span class="hljs-params">(<span class="hljs-type">const</span> std::string&amp; columns)</span></span>;
        <span class="hljs-function">QueryBuilder&amp; <span class="hljs-title">from</span><span class="hljs-params">(<span class="hljs-type">const</span> std::string&amp; table)</span></span>;
        <span class="hljs-function">QueryBuilder&amp; <span class="hljs-title">where</span><span class="hljs-params">(<span class="hljs-type">const</span> std::string&amp; condition)</span></span>;
        <span class="hljs-function">std::string <span class="hljs-title">build</span><span class="hljs-params">()</span></span>;
    };
    
    <span class="hljs-comment">// 性能监控工具</span>
    <span class="hljs-keyword">class</span> <span class="hljs-title class_">PerformanceMonitor</span> {
    <span class="hljs-keyword">public</span>:
        <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">startQuery</span><span class="hljs-params">(<span class="hljs-type">const</span> std::string&amp; query)</span></span>;
        <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">endQuery</span><span class="hljs-params">()</span></span>;
        <span class="hljs-function">QueryStatistics <span class="hljs-title">getStatistics</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>;
    };
}

<span class="hljs-comment">// 不同团队可以独立开发和测试</span>
</code></pre>
<hr/>
<h3 data-id="heading-21"><strong>总结：非成员函数的设计智慧</strong></h3>
<p><strong>最终设计框架：</strong></p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// 核心类保持精简和稳定</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">CoreComponent</span> {
<span class="hljs-keyword">private</span>:
    ImplementationDetails details_;
    
<span class="hljs-keyword">public</span>:
    <span class="hljs-comment">// 只包含必须访问私有成员的核心操作</span>
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">essentialOperation1</span><span class="hljs-params">()</span></span>;
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">essentialOperation2</span><span class="hljs-params">()</span></span>;
    
    <span class="hljs-comment">// 基础查询接口</span>
    <span class="hljs-function">State <span class="hljs-title">getCurrentState</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>;
    <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">isValid</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>;
};

<span class="hljs-comment">// 相关功能在命名空间中组织</span>
<span class="hljs-keyword">namespace</span> ComponentFeatures {
    <span class="hljs-comment">// 便利操作</span>
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">complexOperation</span><span class="hljs-params">(CoreComponent&amp; comp)</span></span>;
    <span class="hljs-function">Result <span class="hljs-title">calculateDerivedValue</span><span class="hljs-params">(<span class="hljs-type">const</span> CoreComponent&amp; comp)</span></span>;
    
    <span class="hljs-comment">// 组合操作</span>
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">multiStepProcess</span><span class="hljs-params">(CoreComponent&amp; comp, <span class="hljs-type">const</span> Parameters&amp; params)</span></span>;
    
    <span class="hljs-comment">// 工具函数</span>
    <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">validateConfiguration</span><span class="hljs-params">(<span class="hljs-type">const</span> CoreComponent&amp; comp)</span></span>;
    <span class="hljs-function">std::string <span class="hljs-title">generateReport</span><span class="hljs-params">(<span class="hljs-type">const</span> CoreComponent&amp; comp)</span></span>;
    
    <span class="hljs-comment">// 工厂函数</span>
    <span class="hljs-function">CoreComponent <span class="hljs-title">createFromFile</span><span class="hljs-params">(<span class="hljs-type">const</span> std::string&amp; filename)</span></span>;
    <span class="hljs-function">CoreComponent <span class="hljs-title">createOptimized</span><span class="hljs-params">(<span class="hljs-type">const</span> Specifications&amp; specs)</span></span>;
}

<span class="hljs-comment">// 扩展功能在子命名空间中</span>
<span class="hljs-keyword">namespace</span> ComponentFeatures::Advanced {
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">advancedAnalysis</span><span class="hljs-params">(CoreComponent&amp; comp)</span></span>;
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">optimizationPass</span><span class="hljs-params">(CoreComponent&amp; comp)</span></span>;
}

<span class="hljs-comment">// 使用示例展示清晰的分层</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">applicationLogic</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">auto</span> component = ComponentFeatures::<span class="hljs-built_in">createOptimized</span>(specs);
    
    component.<span class="hljs-built_in">essentialOperation1</span>();  <span class="hljs-comment">// 核心操作</span>
    
    ComponentFeatures::<span class="hljs-built_in">complexOperation</span>(component);  <span class="hljs-comment">// 高级功能</span>
    ComponentFeatures::Advanced::<span class="hljs-built_in">advancedAnalysis</span>(component);  <span class="hljs-comment">// 专家功能</span>
}
</code></pre>
<p><strong>最终建议：</strong> 将非成员非友元函数视为软件设计的"扩展插件"。它们为核心类功能提供无侵入的增强，同时保持核心接口的稳定和精简。通过命名空间的逻辑组织，我们创建了清晰的功能层次和自然的扩展机制。</p>
<p>记住：<strong>优秀的软件设计不是将所有功能塞进类中，而是通过精心的职责分离创建清晰、可维护的架构。</strong> 条款23教会我们的不仅是一种技术模式，更是构建可持续演化软件系统的设计哲学。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[写代码不怕Bug，就怕合同里有“竞业陷阱”]]></title>    <link>https://juejin.cn/post/7574992086715105295</link>    <guid>https://juejin.cn/post/7574992086715105295</guid>    <pubDate>2025-11-21T10:00:12.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574992086715105295" data-draft-id="7574614157956235298" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="写代码不怕Bug，就怕合同里有“竞业陷阱”"/> <meta itemprop="keywords" content="面试"/> <meta itemprop="datePublished" content="2025-11-21T10:00:12.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="TF男孩"/> <meta itemprop="url" content="https://juejin.cn/user/615370768790158"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            写代码不怕Bug，就怕合同里有“竞业陷阱”
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/615370768790158/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    TF男孩
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T10:00:12.000Z" title="Fri Nov 21 2025 10:00:12 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读14分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>你可能刚入职那天，HR就悄悄在合同里给你种下了一枚“三尸脑神丹”。<br/>
平时无事，你好我好大家好，一旦你有更好的机会想跳槽，或者单纯是他不想要你，这玩意可能就发作。<br/>
解药？当然在他们手里。你不是不听话，是不敢不听话。</p>
</blockquote>
<p>很多人都不了解竞业限制，我也是遇到事儿才开始了解的。以至于仔细翻看10年前刚工作时的合同，发现那时公司就已经开始下毒了。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d1a8c33fb4444431aa8c095c770b9ff6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVEbnlLflrak=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764324101&amp;x-signature=hffwm7LwpEEE8lTNJoI6uUEOZHs%3D" alt="" loading="lazy"/></p>
<p>讲这个问题，咱首先得谈它的初心。</p>
<p><strong>竞业限制的出现是为了保护企业的核心机密</strong>。想象一下，你开了一家公司，花了5年时间研发出了一款软件，你的公司就靠这个软件生存。结果，有个员工复制这套代码去了你死对头的公司，他们部署完就往外卖。因为他免费偷的，没成本，因此售价是你的一半。结果，你的公司倒闭了。这明显不公平，得加以限制。</p>
<p>于是，法律就有了竞业限制。它比保密协议更严格。<strong>保密协议只是让你不乱说话，但竞业限制却让你不能再干这行了</strong>。就像你是个知名饭店的厨师，可能掌握他们百年老菜的秘密，如果你把这道菜带去别的饭店，那不行。最好的办法就是让你不再接触炒菜。厨师说那不行，这是我吃饭的手艺，你不能饿死我呀！法律说，好吧，你承诺两年内不去相关行业，企业承诺养你两年。你们达成一致，我立法保护你们。</p>
<p>看起来，这没有什么问题。甚至很融洽，因为签合同是双方自愿的，没有人强迫你。<strong>你是个成年人了，有自己的判断力</strong>。</p>
<p>但是，既然两者签了合同。那员工按照公司的要求来，我不干这一行了，你要是不给我钱，我就告你。公司也按照合同办事，我养你，但是如果你偷偷去干这一行，我也一样告你。</p>
<p>然而，事情往往会违背它的初心。<strong>对于公司，它想既能限制你，又不想给钱。对于员工，他既想拿钱又不想受限制</strong>。</p>
<p>于是，他们就闹上公堂，这类案由为“竞业限制”的案件在劳动纠纷中最常见。从裁判文书网来看，<strong>它的数量远超过了劳动合同纠纷</strong>。而且都是新鲜热乎的，发布没几天。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8d6fd716920143f280cfde8e3e71bfa1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVEbnlLflrak=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764324101&amp;x-signature=zLevOS32PjXCU3Km2jLqwqIp0h0%3D" alt="" loading="lazy"/></p>
<p>下面这个是双方签了协议，虽然员工遵守了，但是公司不给钱。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b5bbe8a897804665b0c767357925febc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVEbnlLflrak=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764324101&amp;x-signature=Yg%2FHgW9wwoSDyqN1be4bMws8JGs%3D" alt="" loading="lazy"/></p>
<p>下面这个是公司给钱了，但是员工不遵守。一般情况下，<strong>员工的违约金都是非常高</strong>，一般都是几十万起步（下面这个是要员工赔偿210万）。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2875d9b7aa9545adb014bdff956cc82a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVEbnlLflrak=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764324101&amp;x-signature=maqu%2BJIrPK0gN2QzShCPpC8QfdI%3D" alt="" loading="lazy"/></p>
<p>我之所以写这篇文章，是因为我一个朋友去一家公司面试，HR问他对公司有什么想要了解的。他说，咱们签合同是一式两份吗？HR说不是，<strong>任何协议，包括劳动合同、保密协议，都只签一份，留在公司</strong>。他说，为什么不给员工一份。HR说，你要这个有什么用呢？没有任何必要。他说，万一拿合同限制我，我会很被动。HR说，<strong>你要是没有道德问题，公司为什么要限制你</strong>？被限制的人，肯定是道德有问题。</p>
<p>我告诉朋友但凡还能找到其他工作，别去那里了。还搞出来道德问题了。随后，我查了这家公司，确实有公开的劳动纠纷诉讼。公司认为没有书面证据，没事。后来员工拿出来微信聊天记录、电话录音等资料，证明确实是公司在法官面前演戏。最后公司官司输了，也不给钱，让员工走强制执行。<strong>基本就是“家长式”、“工厂式”的管理模式，但凡你不听话，属于道德有问题，就有你难受的地方</strong>。</p>
<p>不过，她的这段话，让我想起之前的一个小经历。我曾经入职过一家公司，入职当天就签订了一份保密协议，里面说不能对外泄露公司的源代码什么的，倒也正常。但是里面有一句话很刺眼，说<strong>员工离职之后2年内不得入职任何同行业的公司。否则，将向公司赔偿违约金，金额为在职期间工资的总额</strong>。</p>
<p>我当时就找HR，我说我肯定要在这个行业混的，而且这个违约金什么意思？<strong>HR说模板就是这样的，大家都这么写</strong>。于是，我就签了。他们也是只有一份，留给公司。</p>
<p>几年后，我要离职了。我隐约记起这回事，于是问当时和我签协议的HR。那时，她已经离职一年多了，因为受不了公司的各类违规操作走的。她说，其实<strong>那个协议是众多法务制定的策略，属于保密协议中的竞业限制条款</strong>。大体运行规则是这样的。每一个离职的员工，HR都要加他们的微信，观察他们的动态，甚至询问亲近的同事。一旦发现员工入职了同类公司，就给员工发函要求遵守竞业限制，必要时索要违约金。如果员工去了别的行业，那么就当没有这回事。就算员工有意识自愿遵守，也没法主张向公司要钱，因为<strong>员工手里没有协议</strong>。</p>
<p>那时，我查了查“竞业限制”这四个字。果然，广受诟病。主要是被严重滥用，法律规定竞业限制适用于高级管理人员、高级技术人员以及其他负有保密义务的人员。但是，企业常常和每个员工，比如前台、客服、销售等都签订，说他们是那个“其他”。至于理由嘛，销售掌握的客户信息，如果他们把客户信息带给对手，那岂不是严重损害单位利益。</p>
<p>我们的认识，甚至很多自媒体博主都这么说。<strong>公司不给你钱，竞业限制协议就无效。他们的知识来源都是HR</strong>。我们看司法实践是怎么样的。</p>
<p>以下是2025年7月发布的一个案例。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f11838bcb42b4e24921a69ae5ff7001c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVEbnlLflrak=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764324101&amp;x-signature=yRCbC46mIdzIHo%2B77e4YGQBDjmI%3D" alt="" loading="lazy"/></p>
<p>周某是一名工程师，离职去了同行业公司，他被原公司起诉，一审法院判他需要向原公司支付18.9万元的违约金。然后周某不服，向上级法院上诉，<strong>最终二审维持原判，周某就要向公司支付18.9万元</strong>，而且二审认为这还是很仁义了，因为约定的是一百万，只要了他不到20万。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fdf887002e2d41fdb8e47d79049549e1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVEbnlLflrak=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764324101&amp;x-signature=tQG91z9mR8SEObTh62D32pq7Tk0%3D" alt="" loading="lazy"/></p>
<p>那我们看周某的遭遇是什么样的呢？他认为自己无罪的理由如下：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/983d2da9db5844b8bd9361a606fe75e5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVEbnlLflrak=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764324101&amp;x-signature=DIIIEpREqJr5r4%2FGRi%2B09uJDfXk%3D" alt="" loading="lazy"/></p>
<p>第一，签的不是专门的竞业限制协议书，是隐藏在劳动合同的附件之保密协议中的一项小字条款。而且<strong>从入职到离职，公司从没有提及与过问，没有特别说明</strong>。</p>
<p>第二，两年时间内，<strong>公司从来没有给过补偿金</strong>。不给钱就无效。</p>
<p>因此，周某认为，这个协议无效。</p>
<p>正可谓是：人情似铁非似铁，官法如炉真如炉！</p>
<p>我们看公司那边怎么说的。</p>
<p>第一，<strong>字是你签的，签了就要认</strong>。我们有这个约定。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/361037c786fc4114919d520737b5dc27~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVEbnlLflrak=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764324101&amp;x-signature=%2FxZ1rXt15XgQCJ8YNdfcOFz%2FKjA%3D" alt="" loading="lazy"/></p>
<p>第二，<strong>我们虽然没给钱，但是你有权解除这个协议。然而，你并没有行使这个解除权利，而是直接违约了</strong>。因此要赔偿我们。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5522ff92930f474abc6e381269985666~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVEbnlLflrak=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764324101&amp;x-signature=IjAyDiftetVH%2FFgjtpjUULh8QBQ%3D" alt="" loading="lazy"/></p>
<p>这里面好像和普通大众理解的不一样。为什么公司违约就行，但是员工违约就不行。我不是研究法律的，但是靠推测大概理解逻辑，这就好比你被人打了，<strong>你可以去找帽子叔叔维权，这是你的权利，但是你不能直接去打人家</strong>（他违法不是你也违法的理由）。</p>
<p>后面还有很多拉扯，比如周某说入职的不是竞争对手公司，但是公司这边给出了两家公司的营业执照范围一样等等。</p>
<p>看最终法院怎么判呢？</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/444958a1c1f144c0a9487ba2eb846bf2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVEbnlLflrak=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764324101&amp;x-signature=SY4vbF0x6s3F8CRZHrkI9oqiuCs%3D" alt="" loading="lazy"/></p>
<p>法院认为争议点：1、协议是否有效 2、周某是否违约，违约的话赔多少。</p>
<p>关于第一点，<strong>协议有效，签了就是得认可。没提经济补偿，不影响协议生效</strong>。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6f7623bd2be546209ec77f7429666066~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVEbnlLflrak=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764324101&amp;x-signature=GlYWFfO3bdNEvnS4t3OqBQYYM0o%3D" alt="" loading="lazy"/></p>
<p>关于第二点，<strong>周某确实违约了，得赔钱</strong>，但是不是一百万，18.9万就行。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/23a3acd1fc73433aa744cb88f322407d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVEbnlLflrak=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764324101&amp;x-signature=B9C5phzy4O9FhHFfWG458LB%2Boj4%3D" alt="" loading="lazy"/></p>
<p>这里面大家可能还是那个疑问，我感觉公司没给钱协议应当终止呀！</p>
<p>但是，大家要明白，所有判决都要有法律依据。你俩都是成年人，签协议了，你们的协议就受法律保护，你俩都要遵守。也不是说非得有人特别通知或者催促你遵守。但是，在条例中<strong>找不到任何一条说：他违约，整个协议就自动失效了</strong>。他违约不给钱，你有权利去告他，让他给钱。也有权利在一段时间（一般三个月）后申请解除限制，因为他违约，我申请协议失效。但唯独没有权利你直接违约。法官是看文件的，他看的第一个文件是你俩有协议。如果你能拿出第二个文件，证明协议已解除，那么就不用赔钱了。</p>
<p><strong>你们可能觉得离你们很远。其实身边有很多人，已经对簿公堂了</strong>。像济南这类二线城市，从大集团当研发，到小培训学校做老师，都被限制了。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/183bf330ffd240a095adf4f6345c8342~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVEbnlLflrak=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764324101&amp;x-signature=6aNO%2FxvrzDvyQ3P45X%2FT1z0Vi6Y%3D" alt="" loading="lazy"/></p>
<p>你们看，小到一个月几千块钱的音乐老师去别的地方教音乐，也要赔10万。而且也是没有竞业补偿金，因为都包含在工资里面了。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/140bbc0d657b43cbbdad7b2b9e893278~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVEbnlLflrak=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764324101&amp;x-signature=FgpSYjjy4MjgF8y5u2JdtVdNiug%3D" alt="" loading="lazy"/></p>
<p>最终判决结果是这个<strong>小老师需要向学校赔钱</strong>，但是数额没有那么多。</p>
<p>以上只是部分案例，不是全部都这样，各地有各地实践，并不完全统一。但是，<strong>有个共同的准则，“签字即认可”是普遍的原则</strong>。裁判他们更看重签字和印章。因为故事它不是证据。</p>
<p>立法的初衷是我保你机密，你养我生活。但是，没有企业真的去签一份光明正大的竞业限制协议，多数条款躲在保密协议中或者劳动合同中。签的时候说没什么，这是通用格式条款，对你没影响。<strong>就像是在每个员工身体里埋下一颗雷。而遥控器就握在他的手里</strong>。</p>
<p>更有甚者，<strong>有的让员工签空白劳动合同，或者签完不给员工</strong>。不给员工合同原件，目的不是怕他们去劳动仲裁。因为现在规范了，社保、报税、发工资都是对公账户，这些都可以证明劳动关系。<strong>不给员工原件的目的是什么呢</strong>？</p>
<p>如果你问HR，她会说<strong>便于管理、统一要求、节省纸张</strong>。其实，给员工一份原件并不增加她管理的难度，还是管理她手里的那一份。想节省纸张，可以走人社平台的电子签，人社局给背书。如果你再多问，那……你可能就是居心叵测，诉诸于道德。你看，她可以不守法，但是你得守道德。这不像现代文明下的合作关系（一份好工作不是雇佣关系，而是合作关系，是双赢关系），更像……。<strong>这只是一个公司行事风格的起点，而非终点</strong>。</p>
<p>为什么合同要一式两份？有的还要三份。试想两个公司之间签了合同，价格是50万，结果他改成500万。请问，怎么破？不用破，他那里改了（修改痕迹），咱这里没改。一式三份的还会给第三方监督平台一份，这类似于区块链技术。</p>
<p>但是，如果只有一份的话。那……有些公司就能任意发挥了，空白处写点东西，甚至替换里面的部分页面。反正<strong>你手里又没有，你没法反驳他</strong>。但是，<strong>他手里的有你签名的那一页，你仍然没有办法反驳他</strong>。至于你的复印件（不管是电子的还是纸质的）或者自己拍摄的照片，那些都是你自己PS的嘛，<strong>打印个文档放工位自己拍摄，谁不会</strong>？AI生成也行。但是，他那儿有凹凸的签名，鲜红的印章。猜猜谁更有说服力。</p>
<p>咱们不说所有企业，起码我工作的每一个单位，都是一式两份签字盖章给到个人。可能仅仅是部分企业吧，有那么一点点儿小心思。可能……他们没有意识到这个问题，<strong>可能就是懒，这种你可以提醒他们</strong>。但是，如果他们是故意的，这种你一提，他们就火了。</p>
<p>总之，不能细琢磨为啥不给原件。或许要在必要时刻，做特殊手段。有这一招，他就不怕你胡来。甚至员工离职后一段时间，也有控制效果。员工肯定不会胡来，但是关键这个“胡来”谁来定义？<strong>原来有个漂亮的女测试工程师，被客户看上了，老板说去陪人家吃一次饭能掉肉还是咋地</strong>？他认为这很正常，不去就是胡来。</p>
<p>平时，绝对是你好、我好、大家好，称兄道弟，相安无事。<strong>这就好像是原子弹，他们可以不用，但是不能没有</strong>。而你，每天除了兢兢业业工作，还要跪拜与祈祷，别撞上老板不开心的时候。这种感觉，<strong>知情的人，很压抑。不知情，反而很快乐</strong>。</p>
<p>据我所知，有些地方劳动合同原件内容不让员工知情（填完不留空，给你看一眼）的公司是存在的，很多打工者为了留下个好印象，为了不违逆公司，为了一份糊口的工作，选择不过问。<strong>同时，这也是一个筛选</strong>，筛掉不符合公司内部价值观的人。我们没有能力去填坑，但是我们可以不跳进去。坑不坑的……很难说，并不绝对。但是，起码，他们在你还没来的时候，就已经想好怎么对付你了。</p>
<p><strong>打工本应该是风险极小的事情</strong>，起码不会有赔钱的风险。尽管现在有法律规定签了霸王条款算无效。但是，集体的力量是强大的，<strong>一堆儿专业的人总会找出里面的漏洞</strong>。就像上面的案例，竞业限制不给钱还能要违约金。</p>
<p>不过，现在越来越完善了。2025年9月4日发布的《企业实施竞业限制合规指引》规定，前台、保安啥的不能签竞业了，并且经过员工提醒一个月不支付或超过三个月不支付，<strong>竞业限制可以自动失效</strong>。</p>
<p>但是，<strong>前提是你手里得有一份原件</strong>。否则，依然是只能他打你，你只有挨揍的份儿。</p>
<p>看着那么多打工者默认摘下自己的铠甲，伸长了脖子打饭，我开始不自信了。还好，我还算是个正常人（截止目前而已）。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/848d3fb86fa04bd689c9f0a61aea6441~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVEbnlLflrak=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764324101&amp;x-signature=rOX7kuhj2kMR8WZTalNARhmEafE%3D" alt="1.png" loading="lazy"/></p>
<p>我认识一个资深HR（50多岁）说过，他们作为HR也不是非得这样搞，包括合同上写实际工资还是最低工资都可以商量，其实就是“糊弄一个是一个”，目的尽量给企业降低风险。他们也是打工人，不想做得太绝，但又得跟老板交差。<strong>反正吧，有一个博弈。能要一份原件就要一份，就能填满就别留空白，能写个骑缝签就写个骑缝</strong>。咱不想打人，但是也不想无缘无故被打，更不想被打之后还被戴上道德有问题的帽子。</p>
<p><strong>原件（信息透明）是一副铠甲，不是一把长枪。我们没想去攻击人，只是肚皮太薄了</strong>。</p>
<p>远处传来一句温柔的声音：兄弟，跟我干一点信任都没有吗？脱了它，好好干，不会亏待你的...</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[GBASE南大通用技术分享：GBase 8c数据库集群部署服务器时间一致性配置解析（下）]]></title>    <link>https://juejin.cn/post/7574739133946888234</link>    <guid>https://juejin.cn/post/7574739133946888234</guid>    <pubDate>2025-11-21T06:17:26.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574739133946888234" data-draft-id="7574821757665132585" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="GBASE南大通用技术分享：GBase 8c数据库集群部署服务器时间一致性配置解析（下）"/> <meta itemprop="keywords" content="数据库"/> <meta itemprop="datePublished" content="2025-11-21T06:17:26.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="GBASE"/> <meta itemprop="url" content="https://juejin.cn/user/4364376217774956"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            GBASE南大通用技术分享：GBase 8c数据库集群部署服务器时间一致性配置解析（下）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4364376217774956/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    GBASE
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T06:17:26.000Z" title="Fri Nov 21 2025 06:17:26 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0"><strong>2. CentOS/RHEL 系统</strong></h3>
<h4 data-id="heading-1"><strong>步骤 1：安装 chrony</strong></h4>
<p>bash：运行</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># CentOS 7/RHEL 7</span>
sudo yum install chrony -y
<span class="hljs-comment"># CentOS 8/RHEL 8+</span>
sudo dnf install chrony -y
</code></pre>
<h4 data-id="heading-2"><strong>步骤 2：配置 chrony（同 Ubuntu）</strong></h4>
<p>编辑配置文件 <code>/etc/chrony.conf</code>：</p>
<p>bash：</p>
<pre><code class="hljs language-bash" lang="bash">sudo vim /etc/chrony.conf
</code></pre>
<ul>
<li>
<p>替换上游服务器：</p>
<p> </p>
<pre><code class="hljs language-vbscript" lang="vbscript"><span class="hljs-built_in">server</span> ntp.aliyun.com iburst
<span class="hljs-built_in">server</span> time.nist.gov iburst  # 美国NIST服务器（备用）
</code></pre>
<p> </p>
</li>
<li>
<p>允许局域网客户端（例如 10.0.0.0/24 网段）：</p>
<pre><code class="hljs">allow 10.0.0.0/24
</code></pre>
<p> </p>
</li>
</ul>
<h4 data-id="heading-3"><strong>步骤 3：重启服务并设置自启</strong></h4>
<p>bash：</p>
<pre><code class="hljs language-bash" lang="bash">sudo systemctl restart chronyd
sudo systemctl <span class="hljs-built_in">enable</span> chronyd
</code></pre>
<h4 data-id="heading-4"><strong>步骤 4：验证</strong></h4>
<p>bash：</p>
<pre><code class="hljs language-bash" lang="bash">chronyc sources -v  <span class="hljs-comment"># 查看同步状态</span>
chronyc tracking    <span class="hljs-comment"># 查看本地时间同步详情</span>
</code></pre>
<h3 data-id="heading-5"><strong>3. 传统 ntp 服务</strong></h3>
<p>若需使用传统 <code>ntp</code> 服务（而非 chrony），步骤如下：</p>
<h4 data-id="heading-6"><strong>Ubuntu/Debian 安装 ntp：</strong></h4>
<p>bash：</p>
<pre><code class="hljs">sudo apt install ntp -y
</code></pre>
<p>配置文件：<code>/etc/ntp.conf</code>，添加上游服务器和允许的客户端（同 chrony 配置逻辑），然后重启服务：</p>
<p>bash：</p>
<pre><code class="hljs">sudo systemctl restart ntp
</code></pre>
<h4 data-id="heading-7"><strong>CentOS/RHEL 安装 ntp：</strong></h4>
<p>bash：</p>
<pre><code class="hljs language-bash" lang="bash">sudo yum install ntp -y  <span class="hljs-comment"># CentOS 7</span>
sudo systemctl restart ntpd
sudo systemctl <span class="hljs-built_in">enable</span> ntpd
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[徽标（Badge）的实现与优化铁壁猿版（简易版）]]></title>    <link>https://juejin.cn/post/7574967214127677466</link>    <guid>https://juejin.cn/post/7574967214127677466</guid>    <pubDate>2025-11-21T08:35:19.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574967214127677466" data-draft-id="7574728397374488628" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="徽标（Badge）的实现与优化铁壁猿版（简易版）"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-11-21T08:35:19.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="西西西西胡萝卜鸡"/> <meta itemprop="url" content="https://juejin.cn/user/2918532014943187"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            徽标（Badge）的实现与优化铁壁猿版（简易版）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2918532014943187/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    西西西西胡萝卜鸡
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T08:35:19.000Z" title="Fri Nov 21 2025 08:35:19 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#2b2b2b;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(159,219,252,.15) 3%,transparent 0),linear-gradient(1turn,rgba(159,219,252,.15) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin-top:35px;margin-bottom:10px;color:#4dd0e1}.markdown-body h1{font-size:30px;text-align:center;position:relative;width:max-content;margin:0 auto}.markdown-body h1:before{position:absolute;content:"";z-index:-1;top:-20px;height:100%;width:100px;left:0;right:0;margin:0 auto;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA6CAYAAAAOeSEWAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAABkLSURBVGhDtZoHnJ1llcbP3Om9ZiYzmfSQhCQQIbRQVQKI9CYC68qKriJK0UXcZRcINqStIoiIqKCi1NACQihBWiCkkJ5MJlMyvd7p7d759v989/sy34yTbIj48Atz71ff855znvOc971xDrB/EtoGI7a9Z8Aq+wZML0mNj7dE95NZ1OKsj1dHo1GbnJpss9OTbWJyonvun4VP1Njuoagtb+m0it4By0iIt8LEeMvkr8XFWcfgkA1gYDLf47i2PzpsyU7UspKSLDoctagTZ7Vc08MzClMS7awJ2ZaflBB78CeET8TYla1dtrKt2w5KS7YCDGzEoz2RqKUmhGw6x2bhuXyOp2BoRXef1Q1E7Lj8TIsMD1sbxu1kcnYSAX1810RMTUmyMB7f2j1gC7NS7byinNiL/kH8Q8a+2NRh77b32El56VaPAe0YeGR2mh2bm+FdMRqP1rbZe+3dFsHT35qcb/Oz0rwzo7Gxs9feYPLS4kM2h8lawee5hPmlJXneFQeGAzJ2F564v7rFzi7Msu3d/Xgjzq5g8ArX8VCNN2vJ28daey0zZJabmGCLslP5HOf+Oygr3UzDGOf+JxrauXfQjslJt+dbuuyMgiwmk+sPAB/b2Lt2NdoMZnuY21qHIvbvUyZ4Z0ZQiXGrWjvsmPxsK4R0nmHA8ZCTQvxVQn5eRipklIBtcVbV1WtHYsjati47ZWKuTUpP9Z4yGk/xDBGe3v1mW4/dOrvYO7P/2G9jRSjf31FnXyaUXiB8r51WaJkM3kcfOSa2FR6qarIenooTLQHPLcC4mYThyw1tVpKWYlVERlZ8nC3Oz3Jzdn1nn5uvQ8OOHYvhR/CvsqffJbkCkZTvcYZ6Z0WTfTovw5Y1dtjXp+TbFPhgf7FfxpYxuMfr2uwo8rEtMmwXF+d6Z8wGmIR2PLyjo8cqOFffP2SLGexJEJCP9R29thkPXlpa4A5Y3w/jmuVNYYwO2QkY7WMtz3mVcE1hkualJdmSolzX8GnpKd4VZq80d1o7zN0RdWxGaqItgbn3B/+vsasgh/UMNBOvzYMZDxtDKp289KGaVguFQvb1yQWWwuB97GaSXqUUnVaYbSUwrDCEBz/C2CM8EhNrP13fbkeSh3OJgCAe2N1CWXKsGOc6TOr5U4q8MwYhDtkTda02MyPN+nnGBQEH7A37NHYz5KOZVv08qyjbSseEzKauPnsMj98wc6Ibcj5UUv7M8QWZTE52jEwGOVaD8U1Dw1YNWX0qM8VKyb80L/TrOPYOzH4KBJQTrK8M7+7KZjuM63sHBt17FubGoibCuf+tarWFGUmuwWeT8/vCXo1tZOYeZcazCaez8MwEzzM+HqhqtiJI5twxL1jeGLYk7jmKMF1JOCbg6Qj5nAdRqX7q3BYm8VAmQvW1lfcMc58IT95uIA3q+gftrDHPXUXJWkVEHJme5Bp5UmHsvIZ/O3l8ECE/FWcsItX2hr0ae8O2Wjs+J43QTbOZzGYQ/7Wtxq6eXjRK3r0By4YJ6Ty8EiYSJqcm2eGeV4Pox/ANENJR49RiEdfqcLflUJrEBZqgxYHrBjn2ExFURqKdVETN9YirJxKxR2rbrYeQv5ISmB6IsiDGNfZGWPeMgkzr58xnPaJ5p6XDZPKz4T77wayJ7jGhhXLwanOHTWBgq5n5q6YUwNJ7l3kKcRl7OJ7fF56l1GzvHbSD8dghTPi0wIRfv6XafjJ3ssv0PnZQ7nZx/etwzO1zJ3lHR2OETTw8x0tOx1AN3De0D7YV+63oGthjaJQ5Ur7eVVZjcdGInUyuaT73ZWg3efV8fZs7cc2E777Qi5eunVbghvPPymrt/krKGfcLd8ybYjdxrK6333Z09rjHZkNuLYzz0uIc+xWCZzz8nbHbe4dsY1e/XUOY+nimvtUaSazv4jXhaQasSbmYmpuenGwHZ8TKggSEQm08rMD7ahBOoExcMqXQegjnZ+CEvaEa1ZQUQkt39dj0zDS7krq+ARmpdws/nlNqD9WFbWN7l5u3wr9MyrcXKUsqWy3jTOaoML4DdaQ83YIoT4VYpEXvYQZLmbX5SLohBrgOj186Kc/iKTUPUhq+Rrm5ekOl3TWv1Mr6hqwbY0VOQXwEo+Moq4Z47q5qsU489G944LyJOW4LOLZOKtT/iI6+nGe/0dhuEd4ltj2NmiuCU4hnk5fHIi7+RK4uTEu0e+s7rAiRcw1CYy3OejvcYz+eXeI9MYY9nu3lYZl0KavJJ7Vjibzgjp319rUZE20j7CkJqFr5JQYgQ39f3eQaKpQk0afy8nl4uBzvjUUTRk7k3iebOm0pabDiyFn2XGu3dRME41CGVeBVqSiVnc6hIUpekp1VjHLDSOEcQlui5W/U8C7IKREjv1Gabw3wRwUTvpv7jybPtzHmIPZ49q6KRjuccqBQVCOtGvqXhrCFUUXJzOYSHt7Kw5Ix9H08dSje1o1JyL73IYXpEMmE5CRbw6wuykx2pR+Pd6/J4JpLiJKV6N9OnrcQNfQ0Zem6qQX2MmFXyWTE+DMO0kGx4e08DEjnXbsYuOq7niHB8jdY/wQ8Srm2XCZZUrOakF1CY5EKX0h93Tu/1J4kRdbDMT8MamgZK9xe3uDcvrPe++Y4f61rcZr7B53rN1c5N2ytcV5rCrvHt3T2Og19g+5nH7dvq3bqunr4NOwgK2MHA1jeEDuG7HNuLmtw7qpocl5t6nCPvdTQ7v4N4u3WTqeyu9cZHIo4f6lqdFoHh7wzMbzDeeGv3Hvzjlrnh2W1zofhHuftxpFn3VFe7zxS0+p0DlKVPbhhvBxhvwiFMgfP+mjHA08gEC4pybeLyK1iZldh8zC5VJQyUl8l59KZ0WJk2xaiYWxNrkXXJhA8r3PvZRur7ZZZRfadaRPsfiTmX9HGajC2tXd6V8dQTMhX0h8rNdJx9Ra8F8SbRNLzhPRnJmTZIUTYueTyWxyr7uv3rjC3OkzE8495oS+4xq6D5WoI0bO5WVCOSerl8rIeBrOI/Hkaw6ME5W1zSuzx2la3CRdWi3zIG+FDBvUp9LMgI/vggUmE7KkT81yGvOOgEYa/aUahhRAF5xLec3OzbF1r2O17BbVxIi7hzJIC64IYhXdJA+nh/5xVbOmE9J0QqjSxWk0pp37M2YEtgjS8GpimACu7xkqxdKJ6fEXyYl2Lre0ZtC8yELVewtWUnbfCPIhrvgDFz8WI5yhJKgcnFMZWEFrwhgzo5uWDDDA1oGSOzcu0xfx7vTlsv6posIMpJ6cGWPiw/BxL4PU7vbrpjgf8bMdu5OYwOdhm83DARUSa0ELknYIeEAaILuWxlhGa0M8+EuJCrpJT+ymENhN60pXBxa3LZ5TsucnlGaCmIEQ4Evru91yuz0xMtKaeXluI5zdh9Mm8vAlBn4aR07X64EH3vEKdXQkZJXPP/JxMvNRpLxEtHZ5RQgmNewnpouvVTpYTHdfOnmy5kFUGnpRTfEhXD9DiBdFFJB0/YWS9aj6pmc89r0BaQmgTRkgI+EsdKsYasJZOBF+QqTH474NK7LbyBvf7W+RgOxNyxfQY2/2hrp2+NkroxrzrQ55fSZkpJIa28znCgF6rb7H1hOSslATyvNflAh9pvHcX3lVE/Ya8FjTJIexa2Rq77nfU96unTnD7aME3+TAm6BFKYrPnqCNIqV5sq0ZGCiEV+Db+qWMQqpFgb5KPx48R6omeDl2EuP9DTYt9iGA/f1KBS1w/La+H4ktsSmLItvZHXLUkrCeflVtJ9DVVg1H7+sxiGvVM975rZpfabuqHVhuP5F1vewav5O8GamUe91yDanoYw47FWzC929O+DJnKA2opFY1Rjru5CE7kOcO0jJtQVUIynzuZEMeb+1CEOFXN8iFSGeRpCm1BTlJxVg49Azm819SO7Bu0axEbwn27GuxMck+TMQHDP8fn48gfDVIL4R8xKVPJ73MQBUIfA/Z54LMw5vmlE+w+VFo2A78X/SsyPA/RMD0z3e2qVLtfo7aeBslpMX0N0TEnLcUlKym1jyBFqSohmYntI5enBhYB9CY/2kNarhwJhNiMtRGyWnkQdKaCFyQwgydjyNUw4VchKxXv2/DoKdC+lkQbCX1NlKCGvJiBJkSGbCus6jfo4yGBNySgr+u7e20BCsxdVAcFlJ/tHd32+cIsNxSXUULUUx+dg/d47g7OPYFw2MxkSuyMwLHVTI6PBN6dS8Sppw45zHJSgDXV3aQzmz40Z6fDgBfiAXU0uZxby2zejee+j3eltoQMzhV6qSBogXwrEXDj7ElWxUQ8RrnSaoU0dxIsKaiMvMykXTu90NqJsGHP4z78SdLigUrLKat32nFwy/E07pfDFRdQ/7N5r57pQ1482uvWhMGhQcviGkVrKDUp0ToCxfhQal5n4Hs/g1jOgH4LWdwFOd1b1WzHET4vLZppv+Czjxo840OrDlG8jAJzv2tp5mLK1dsU/lfIOeWy5NxFxfl2BoYImlQtx9QF6mJRQKBsQYYuO2yaLYPBUXvu/VqYPxtHhNy7Y4hCkNLGPtKSklzCVKSHtMQxcqm5Kw1DhI2PTGZtcGDAvoLQ/u7MifYtWFBlxz2H9zo8RkwKzC5UYiG+p44ccqE62YAxLeT/TOpf8MXx8Qk0IJFRY1Go+viQVJpE5Ehjf49xfAZeqGIy/7us3nqxwQfCkjZypPxobVr/6YpQHIalUvuCyEwbSXC9PC8QnkFcXlrgLpoLIhIfKuaqlQkYIAwQnr/f3eyu7KttOw2lNpv8/BPHyjzVNER3o72gvEBKqRMTflndbP8BMweRDyeciEj5bFayFXqTLzheivgYJC0jwzwHa0MDDEotm48ndze5BBBElAnxxcRYHAFh3FfZaA9UNRmC354kNwUx8eHkmVj5dcTE5ZMnuEyr1QqlhtaJLuOYZv4v3KNo0TKrGPUZ1NILPKuWcvVn5Trv10SMB6h0j/ARMnlOuafCBIfnSWEx/Raif3HDzofYMM31dOyY9LBaLK3TjoX2fEqT4+2qaUVWSTQvyM6wC8nNJyEetXIyuLKrx04P7MKNnbJZlKUtNAIHo7i2dA/YU3Vtdi5l6jCepXy8hOedSSSsI8/HQg5Q+gxTKXwkMHkbESo+hjG0lbRRzQ3Fc5LOzDuFhs3Ptumpie7ilRDhlEJOq/hjsZljCxjkt7fWuPS/EekpXMggJQIk0G+eN9Xu2VmHWIkJe0nJRN4ptBBit2yutG9ML7J1DHAxebiAMrZ4VZlduqGS8I2tJc2iborUxmIN79c+kTovFxivPvrcSaP3n7RSKYTUmKt4N3rMOcw4JOneD3sP956jNaMglIeTER5Xbdlt15Tm2W10NEsYrA/N5JLCHHsR9tSqwxq08G3bqm1ZTbOtagnbo6SLvH/VzBL7W7jPzqFea0LmMLFzUuLtdwumuO3i1Vtq7OK15Xgw3l1PDmIXak+6QBEkvB9YJIzBcc/L20JIYaSZ/qAzVm5Ut4oowk3QehC+N3xo/1wTqt7zsYawfX9no9XjqdPXVLhrwyo/wucJYQkE1e4j8rLcBuHUItQQKqgMXb6LGvxFQlXw33AdZLR0V5P9Fr29lP73scNnosoyvdWPv4fPJ+uJrLVtMakqaL1M1cTvv0OLIZE6wk2a2IcIRUQh+DaejpdcXepBa7bKDRGM9PIVxTl2EwarZ72rooVuY4RQtMypdk6e1lLLehhY2lt7QEd7WxlCDvdIli6E9B4+ZIodmZEMccUGqgiZOqru9tkR3iJ8nCcXRWRZCSPMLPEjlx2LjQL1OM5qKAm+vhSuRqSfV5Ttrg8FdWcrnhMqCTex7DEM6qTsVEuM1+8hovaHQ6e6a1Fz0xLd3nUt4ToWWuzWNkhcoAIIjUx2ZpxjLzWF9+SYmngR1lok4TEoJxGfuijhI/7OICoFmadl2llcL9b1oRVJtbD+JLlv1KrhHG5811t9ELbzgk14ICUwqE+TDzftqHPz98vUSy3jSIwP8dCpkNqLDPTx+rArz4T5qLG3G2PrvJKKPoLBWE501NC3ilUX5mVjVIb9nIbgWcpPMiSXjbcL8K62UkR86m1/yfkSeMaHFuK04X0CE3J6SWzFUxw0BSNHlSzi3RmIRJwHq5udO3c16quLp6sbnffbupxbt+12vzOrzuvNHc7ycRbIxuJHgYU7YSASdQgxp7qz2ynv6HJeqW91doa7nLruXof+17sqhhu31Xif9o7HalqczV29Dnrb/f5EXZvzdH27U98/6LR5i3N0UM5zjHU71/lwjRWWltU5CAIn7F1MqLp/r9hQ5RoaxG+qmrxP4yNKcfsFLwuiprffeb2l03m2scO5h3Or2rudzjGrhk8x4Cqu2xcexilBvNEcdi5Yu4tKF3Ue4tzPy+td5/1md4tzw5iJ27NuXEYobYUdlb8z6GTWkdxaCvk2zHjd5mpKQ459mv5TkAp6mQb9Aq9HHQ8S6mrZnuc6vUG6WHusIhCJGNXl9byvnJyaiE7+Eoz8c5TYNQiUveENGpJpcIJ+biS8R0+rlcazGNs7pKB+zPLTOSX2KNWhlDAf4r2Spj72JORB5OyHULX+dlD/FOky/HFy5ygYU0sey/i8moeqdunXK1qC3RuaMOYHlI/raQMl3M+EeTV5WxD3Km8a8PkM8nr648sQ9+esKbf5e/nxiKBfAOQkxbv3SU9LYmqPV9V/Pn+V20VwTyVjTqCI6edEQUOFUXs9WmfSll8DyX2dt7GlnwkswaM3l9XZ0oNK3MTXbxpOV2sGk69s6XCJw4cY8KbyRrt9TrHt7Bm0rRBQe1+fHUWNfaapU0KbqxzbORC1M/LS3dJwIl3KOrwykQG/E+61q+isgniztdOKqNOziDgZqZIzFwPvqGiyg5NCtoCqoG5NxHhPZTOsnORulKskjoKMDeLuXQ3OmnC3syxARFXdfc57LR3OrdtrvSOOs55rnqhtcdoGhpxHdjc5EfJUuHZTlftX+G15rXPlhkrnLe59F7Lz8VGHdg8c5y2OLeMZ126qduq9XC3v7nd+FchLvYPJd15gPCu8XQnh/qpm59WGVudZzvvQO97kXTcGxhnEuJvR39tWY8cwK4uhcikk4a3Gdstg9l5B2t0wfaTdWkEou5vCPOV5PH73vFL3+DfXltnh6OxjkJD6Wd5F3g88tMe6CW/7YmI99VIL4u0oqUK8ocW4d8hFrXMVoOQU8s3U97MnjvDD/XRYkyhHM1MT3GVZQR2Tdv70U8EbA5vlo+CaPAaaSWoZXm50otGodxQ6L6txGKxzw5ZYORrBsPPrykZKQIy1n8bTjwb2fO4Te3ue7x6KOKvaYns1wtIddd4nx3mwot55qyl2360cp81zurg+CGqwU8v4/Of5uAVvPgObrwvHomY8jOtZ4fXWLnefdHVXv9044+8ZklCx75DXwcV1Sb27y+vInUQEuVYSaMgRJYfAwtoj0raFxIUW1A8nz35f02qLc9Lc9lG7CBkwtUR7bf+A+5uL6ehnH9Lat+5sIEfj3Cbj3NKRvP7Rjlo7FSmqavKvpSP8MRZ7NVbQYLSkqlC9ZW4sPH18gBTcORjrhMWmQWzFmK2UsvO90qQ1oZcI8UhkCLZPtRqMy0NirobAvjIpb4/sW06qKGyPR2oGIdlazjOOTk+kLYzaaYGSp63Wz6HsXsQ51wd+LTAuZOy+8GBNq7tF+IOdDU4kENJthNID5YRafZtzZ3mDs9LbRgzixcZ2l1h83OKFbDmEd0/FiFp7DWHgp0AQGzq6nf8hPF+oa3EehOz0ziCWcm4NpBRMhX1hn571oR9wqVVSDVPtUi32sQ0vbu7scZdY9aOt2ZSEL9BEBIW+dv20AKDd9/ep09oimYqHpyImkKDuRllS4PrlHNuIqDmCJmNJQba7q1joEaUQJuR/WdXsLrJrq/L6cdJsPOyXscJ7GLKqo8cOpqhrO//yQG6oS3kZwS9xPkRB3wi7diFMtDN+PLk5m1ath+8f0Fy80dbjhvVXub+U5mEqeal27UP+dWpPlknNxW79Ak6/7Tg3UMOF52j1xA1qK7Trd6nXC+8P9ttYQcumIonLSnJtBdJNa77axw1C2x3qR4Wqnj73x9f6MbV+CCYFBZO6y51aSh3gzVrsmwzJnULEbCJC1oZ7vIZ/9Iqmfvn2u5oWO5n8fApxcuWUApum5diPgY9lrA9EtvUNOzYf8vqAcJPsU5iOh7XtXQgt2uZhjKU2amF7HQyfEYWcZk5yQ1RDKNrLcq02k/9IGmldrB93KiokPw8EB2SsoKWXO5FmxXhlckqi+3vEUvLqwok5PHVkIWAszlqzy1p54zuLpnPZ3q9bod08JlLSb5DrNxDm38Sbvsg5EBywsT7oH+3XNW3uasGirFSrxRNdCllKiPZHZzJYLZb5qEcpae3pxMCuu9oibS5/QCOiLcYUrp+MmtJeURjFdVlxzqiae6D4h40NQt54HyGv3JRo10aVfv8YhtC0pSlVKcPFuxIXahr08mzCO4VzMlLSsZuomZ+RaucU0rXsw/sfF5+osUFonWob/7TrLdaUgdpV93fl9X+VIC0Y6tek2uI8OD3J5gT2Vj9ZmP0f4IM4iY7RQ5gAAAAASUVORK5CYII=) no-repeat 50%;background-size:64px 64px;opacity:.84}.markdown-body h1:after{position:absolute;content:"";width:150%;left:-25%;height:50%;bottom:12px;border-radius:50%;background:linear-gradient(transparent 80%,rgba(77,208,225,.8));background-size:400% 200%;opacity:.6;animation:h1Animate 6s linear infinite}@keyframes h1Animate{0%{background-position:100% 100%}50%{background-position:100% 50%}to{background-position:100% 100%}}.markdown-body h2{display:block;border-bottom:4px solid #4dd0e1;position:relative;font-size:24px;padding:12px 32px;margin:30px 0}.markdown-body h2:before{width:24px;height:24px;left:0;top:0;margin:auto;background-size:24px 24px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADGklEQVRYR81X32vTYBQ999s6mFjQgQ+DrbHiVFZYU4cDcQ/6pGhTFVYFEXGi82H+Bz448UnEF1Fx9ccEEcXpZE3d5tP2ooKiTacTHaLNpigMHDgnU9tcSbrWrkwWR0sbyEOSe885ObnfvV8IRT6oyPwoLQHBx+OVM5WJvSyEVAhnBOjt7yU/+/rr6r6l8TMO+F/EN0JQhICqQpD/xaRpcpAc9tS+M+9lBCia/oqBamK+zeDuQogQZaKJk3wcQjxSva7tGQGB2Ke1zIk3DNyMyNL+QpCnMQOaPsDAVuGAp9cjvbYc8Ec/bCYSg0zoiHilk1tHxqsqEsYlML4kjIpT/eurJxRNPweQU5VdrWaOEo1fgKAVbBgXIz73kF3R/ph+ghgdzMYWM29eAWlBJqgZaFlFYtC6nhWpaDqnSGlIlV1WjJ3DloDNgyNLncudqgX//Ucg3LxuStHGuhi8pqKCW3rqV342rwFjRznKm+/LNaN2yC237ThgF2wxcfMLeP6+ncrKzoPoKTGeLQbYbg4TNoC5iZPJY5HGVRdSNZAWYBclD3FzBQzrR8hACAKdzBzKA/4/IYioDQaOskBbpEG6PO8qKKSAEi3CnEb0Pw4oMf0OmKbTDWqh3Lw6EIiNBZi5lxh3wz4puBD5ovqAMvxhHSdFKxE1CQe3m/07TeTX4lcJdAhE+1Sv65Z5P/ByvIGTRowIZ9igbtXnmrOsbTvgj+kHBNMuBu9OdVw8EeU4nC1A0cYmAHZOTRrLhra4Z8ywnSN6vZHAFTA2WnnMfQB3qz73ddsOZM8CACFDIPSgQXqebXEgqgeZcAeEe6pXasm1f8ew3igMtAHWac0Uc/jYdyAaP0xEBwFsmgUPqbJ0NE2UKj4EGcahiOzuyhagaHpnmtgcVgTcCMuua7YdyAHbA3ArQNscVFbb4635aD6fnYaTvxxi9UNP7ddMXaRWVBdAcaLk6bDXPZCNZ9uBXEsDUX1T2Cc9yjig6Z0EHg3LK8/aqf6MwJKchkXfks1+0+JtSq3qLPa23BRR1B+T/6nkfMaW1r9hPt/MLtYfTLEpP+T9FNoAAAAASUVORK5CYII=)}.markdown-body h2:after,.markdown-body h2:before{content:"";display:block;position:absolute;bottom:0}.markdown-body h2:after{right:0;width:400px;height:10px;border-top-right-radius:24px;background:linear-gradient(90deg,#fff,#4dd0e1);max-width:50vw}.markdown-body h3{margin:30px 0;font-size:18px;position:relative;padding:4px 32px;width:max-content}.markdown-body h3:before{border-bottom:2px solid #4dd0e1;width:100%;content:"";display:block;height:28px;position:absolute;left:0;top:0;bottom:-2px;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);background-repeat:no-repeat;animation:h3AnimationBefore 2s infinite alternate}@keyframes h3AnimationBefore{0%{width:28px}25%{width:100%}50%{width:100%}to{width:100%}}.markdown-body h3:after{content:"";display:block;width:28px;height:28px;position:absolute;border:2px solid #4dd0e1;border-radius:50%;right:-15px;top:0;bottom:0;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);animation:h3AnimationAfter 2s infinite alternate}@keyframes h3AnimationAfter{0%{transform:rotate(0)}10%{transform:rotate(0)}50%{transform:rotate(-1turn)}to{transform:rotate(-1turn)}}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin:22px 0;letter-spacing:2px;font-size:14px;word-spacing:2px}.markdown-body img{max-width:80%;border-radius:6px;display:block;margin:20px auto!important;object-fit:contain;box-shadow:0 0 16px hsla(0,0%,43.1%,.45)}.markdown-body figcaption{display:block;font-size:13px;color:#2b2b2b}.markdown-body figcaption:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEVHcExAuPtAuPpAuPtAuPpAuPtAvPxAuPokzOX5AAAAB3RSTlMAkDLqNegkoiUM7wAAAGBJREFUKM9jYBhcgMkBTUDVBE1BeDGqEtXychNUBeXlKEqACsrLQxB8lnCQQClCiWt5OYoSiAIkJVAF5eVBqAqAShTAAs7l5ShKWMwRAmAlSArASpAVgJUkCqIAscESHwCVVjMBK9JnbQAAAABJRU5ErkJggg==);display:inline-block;width:18px;height:18px;background-size:18px;background-repeat:no-repeat;background-position:50%;margin-right:5px;margin-bottom:-5px}.markdown-body hr{border:none;border-top:1px solid #4dd0e1;margin-top:32px;margin-bottom:32px}.markdown-body del{color:#4dd0e1}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(77,208,225,.08);color:#26c6da;padding:.195em .4em}.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#4dd0e1;border-bottom:1px solid #4dd0e1;font-weight:400;text-decoration:none;margin:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(77,208,225,.1)}.markdown-body strong{color:#26c6da}.markdown-body strong:before{content:"「"}.markdown-body strong:after{content:"」"}.markdown-body em{font-style:normal;color:#4dd0e1;font-weight:700}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(77,208,225,.05)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{margin:2em 0;padding:24px 32px;border-left:4px solid #26c6da;background:rgba(77,208,225,.15);position:relative}.markdown-body blockquote:before{content:"❝";top:8px;left:8px;color:#4dd0e1;font-size:30px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"❞";font-size:30px;position:absolute;right:8px;bottom:0;color:#4dd0e1;opacity:.7}.markdown-body blockquote p{color:#595959;line-height:2}.markdown-body ol,.markdown-body ul{color:#595959;padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>本文基于vue3+ts+tailwindcss，从逻辑拆解到代码细节带你实现一个简易版的右上角提示徽标组件</p>
</blockquote>
<h2 data-id="heading-0">一、需求分析与TS类型定义</h2>
<p>在实现组件前我们先明确Badge的能力范围，并通过TS将其规范化，这个步骤是我们实现所有组件都必须要有的，根据这一步骤再像拼积木一样一点一点“搭起来”。</p>
<p>首先在badge组件文件夹下创建一个types.ts，导出组件的各个api来控制每一个细节</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">BadgeProps</span>{
    value?:<span class="hljs-built_in">number</span>|<span class="hljs-built_in">string</span>      <span class="hljs-comment">//显示的值（数字或文本）</span>
    max?:<span class="hljs-built_in">number</span>               <span class="hljs-comment">//最大显示值，超过显示max+</span>
    <span class="hljs-keyword">type</span>?:<span class="hljs-string">'primary'</span>|<span class="hljs-string">'success'</span>|<span class="hljs-string">'warning'</span>|<span class="hljs-string">'danger'</span>|<span class="hljs-string">'info'</span> <span class="hljs-comment">//其实就是默认可选集中常见颜色</span>
    color?:<span class="hljs-built_in">string</span>             <span class="hljs-comment">//自定义文本颜色</span>
    backgroundColor?:<span class="hljs-built_in">string</span>   <span class="hljs-comment">//自定义背景色</span>
    isDot?:<span class="hljs-built_in">boolean</span>            <span class="hljs-comment">//是否为小圆点（简洁版不显示文字）</span>
    hidden?:<span class="hljs-built_in">boolean</span>           <span class="hljs-comment">//是否隐藏（比如已读情况）</span>
    showZero?:<span class="hljs-built_in">boolean</span>         <span class="hljs-comment">//这个主要用于处理需要显示0的情况，少见但是还是要有</span>
}
</code></pre>
<p><strong>特别说明</strong>：这里的types是一个典型的联合类型（ts）,保证types只能是这五种，既限制了错误，又给予编译器完美的提示</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">type</span> <span class="hljs-title class_">BadgeType</span>=<span class="hljs-string">'primary'</span>|<span class="hljs-string">'success'</span>|<span class="hljs-string">'warning'</span>|<span class="hljs-string">'danger'</span>|<span class="hljs-string">'info'</span>
</code></pre>
<h2 data-id="heading-1">二、组件实现总体思路</h2>
<p>要写好一个Badge，需要处理以下核心部分：</p>
<h3 data-id="heading-2">1.内容逻辑</h3>
<ul>
<li>isDot和显示数字要做出那些判断？</li>
<li>需要实现哪些部分的计算？</li>
<li>需要考虑哪些类型特殊判断（检查如非0、null等）？</li>
</ul>
<h3 data-id="heading-3">2.显示条件</h3>
<ul>
<li>hidden是否隐藏</li>
<li>内容为空时是否显示</li>
</ul>
<h3 data-id="heading-4">3.样式逻辑</h3>
<ul>
<li>type类型切换颜色</li>
<li>自定义颜色与默认的优先级</li>
<li>根据内容长度决定尺寸</li>
<li>默认位置为右上角</li>
</ul>
<h3 data-id="heading-5">4.动画体验</h3>
<ul>
<li>显示/隐藏使用缩放过渡</li>
</ul>
<p>拆解完问题后，下面按模块实现</p>
<h2 data-id="heading-6">三、内容逻辑：displayValue</h2>
<p>内容逻辑决定当前Badge应该显示什么内容。</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">const</span> displayValue=<span class="hljs-title function_">computed</span>(<span class="hljs-function">()=&gt;</span>{
    <span class="hljs-keyword">if</span>(props.<span class="hljs-property">isDot</span>) <span class="hljs-keyword">return</span> <span class="hljs-string">''</span>   <span class="hljs-comment">//点状不需要考虑数字逻辑</span>
    <span class="hljs-keyword">const</span> val=props.<span class="hljs-property">value</span>       <span class="hljs-comment">//获取值</span>
    <span class="hljs-keyword">if</span>(val===<span class="hljs-string">''</span>||val===<span class="hljs-literal">null</span>||val===<span class="hljs-literal">undefined</span>) <span class="hljs-keyword">return</span> <span class="hljs-string">''</span><span class="hljs-comment">//特殊值返回空</span>
    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">typeof</span> val===<span class="hljs-string">'number'</span>){
        <span class="hljs-keyword">if</span>(val&lt;<span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-string">'0'</span>                           <span class="hljs-comment">//负值（特殊值）返回0</span>
        <span class="hljs-keyword">if</span>(val===<span class="hljs-number">0</span>&amp;&amp;!props.<span class="hljs-property">showZero</span>) <span class="hljs-keyword">return</span> <span class="hljs-string">''</span>         <span class="hljs-comment">//是否显示0</span>
        <span class="hljs-keyword">if</span>(val&gt;props.<span class="hljs-property">max</span>) <span class="hljs-keyword">return</span> <span class="hljs-string">`<span class="hljs-subst">${props.max}</span>+`</span>       <span class="hljs-comment">//超出正常值显示max+</span>
        <span class="hljs-keyword">return</span> val.<span class="hljs-title function_">toString</span>()                          <span class="hljs-comment">//正常值正常返回</span>
    }
    <span class="hljs-keyword">return</span> val.<span class="hljs-title function_">toString</span>()
})
</code></pre>
<p>这一块逻辑清晰地处理了 Badge 最常见的展示需求。</p>
<h2 data-id="heading-7">四、显示控制：shouldShow</h2>
<p>Badge有一些特殊场景需要隐藏，例如消息已读、需要动画时先不显示等。</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">const</span> shouldShow=<span class="hljs-title function_">computed</span>(<span class="hljs-function">()=&gt;</span>{
    <span class="hljs-keyword">if</span>(props.<span class="hljs-property">hidden</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>
    <span class="hljs-keyword">if</span>(props.<span class="hljs-property">isDot</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>
    <span class="hljs-keyword">return</span> displayValue.<span class="hljs-property">value</span>!==<span class="hljs-string">''</span>
})
</code></pre>
<p>这一层的逻辑避免了空内容闪烁问题。</p>
<h2 data-id="heading-8">五、样式处理：类型+自定义颜色+动态大小</h2>
<h5 data-id="heading-9">1.类型class（typeClasses）</h5>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">const</span> typeClasses=<span class="hljs-title function_">computed</span>(<span class="hljs-function">()=&gt;</span>{
<span class="hljs-comment">//自定义优先级高于默认</span>
    <span class="hljs-keyword">if</span>(props.<span class="hljs-property">color</span>||props.<span class="hljs-property">backgroundColor</span>){
        <span class="hljs-keyword">return</span> <span class="hljs-string">''</span>
    }
<span class="hljs-comment">//默认就根据types来获取对应颜色</span>
    <span class="hljs-keyword">const</span> types={
        <span class="hljs-attr">primary</span>:<span class="hljs-string">'bg-blue-500 text-white'</span>,
        <span class="hljs-attr">success</span>: <span class="hljs-string">'bg-green-500 text-white'</span>,
        <span class="hljs-attr">warning</span>: <span class="hljs-string">'bg-yellow-500 text-white'</span>,
        <span class="hljs-attr">danger</span>: <span class="hljs-string">'bg-red-500 text-white'</span>,
        <span class="hljs-attr">info</span>: <span class="hljs-string">'bg-gray-500 text-white'</span>,
    }
    <span class="hljs-keyword">return</span> types[props.<span class="hljs-property">type</span>]
})
</code></pre>
<h5 data-id="heading-10">2.自定义样式</h5>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">const</span> customStyle=<span class="hljs-title function_">computed</span>(<span class="hljs-function">()=&gt;</span>{
    <span class="hljs-keyword">const</span> <span class="hljs-attr">style</span>:<span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>,<span class="hljs-built_in">string</span>&gt;={}
    <span class="hljs-keyword">if</span>(props.<span class="hljs-property">color</span>) style.<span class="hljs-property">color</span>=props.<span class="hljs-property">color</span>
    <span class="hljs-keyword">if</span>(props.<span class="hljs-property">backgroundColor</span>) style.<span class="hljs-property">backgroundColor</span>=props.<span class="hljs-property">backgroundColor</span>
    <span class="hljs-keyword">return</span> style
})
</code></pre>
<h5 data-id="heading-11">3.尺寸逻辑（sizeClasses）</h5>
<p>Badge的宽应随内容长度自动变化，比如9+、99+长度或者是点。这个逻辑保证badge不会因为数字长度不好看。</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">const</span> sizeClasses=<span class="hljs-title function_">computed</span>(<span class="hljs-function">()=&gt;</span>{
    <span class="hljs-comment">//设置属于点的小盒子宽度</span>
    <span class="hljs-keyword">if</span>(props.<span class="hljs-property">isDot</span>){
        <span class="hljs-keyword">return</span> <span class="hljs-string">'w-2 h-2 min-w-0'</span>
    }
    <span class="hljs-comment">//设置字长不同的盒子自适应</span>
    <span class="hljs-keyword">const</span> content=displayValue.<span class="hljs-property">value</span>
    <span class="hljs-keyword">if</span>(content.<span class="hljs-property">length</span>===<span class="hljs-number">1</span>){
        <span class="hljs-keyword">return</span> <span class="hljs-string">'w-5 h-5 min-w-[20px]'</span>
    }<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(content.<span class="hljs-property">length</span>===<span class="hljs-number">2</span>){
        <span class="hljs-keyword">return</span> <span class="hljs-string">'w-6 h-5 min-w-[24px]'</span>
    }<span class="hljs-keyword">else</span>{
        <span class="hljs-keyword">return</span> <span class="hljs-string">'h-5 min-w-[24px] px-1'</span>
    }
    
})
</code></pre>
<h2 data-id="heading-12">六、Badge模板</h2>
<p>Badge会自动叠加在插槽内容的右上角，并带有平滑缩放动画</p>
<pre><code class="hljs language-ts" lang="ts">&lt;template&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"relative inline-block"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">slot</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">slot</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">Transition</span>
      <span class="hljs-attr">enter-active-class</span>=<span class="hljs-string">"transition-all duration-200 ease-out"</span>
      <span class="hljs-attr">enter-from-class</span>=<span class="hljs-string">"opacity-0 transform scale-0"</span>
      <span class="hljs-attr">enter-to-class</span>=<span class="hljs-string">"opacity-100 transform scale-100"</span>
      <span class="hljs-attr">leave-active-class</span>=<span class="hljs-string">"transition-all duration-200 ease-in"</span>
      <span class="hljs-attr">leave-from-class</span>=<span class="hljs-string">"opacity-100 transform scale-100"</span>
      <span class="hljs-attr">leave-to-class</span>=<span class="hljs-string">"opacity-0 transform scale-0"</span>
    &gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">span</span>
        <span class="hljs-attr">v-if</span>=<span class="hljs-string">"shouldShow"</span>
        <span class="hljs-attr">:class</span>=<span class="hljs-string">"[
          'text-white',
          'absolute top-0 right-0 transform translate-x-1/2 -translate-y-1/2 flex items-center justify-center rounded-full text-xs font-medium leading-none z-10',
          typeClasses,
          sizeClasses,
          props.isDot ? '' : 'border-2 border-white',
        ]"</span>
        <span class="hljs-attr">:style</span>=<span class="hljs-string">"customStyle"</span>
      &gt;</span>
        {{ displayValue }}
      <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">Transition</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
&lt;/template&gt;

</code></pre>
<h2 data-id="heading-13"><strong>七、细节优化与思考</strong></h2>
<p><strong>1. 负数显示为 0</strong>：避免出现 <code>-1 条消息</code> 这种不符合直觉的结果。</p>
<p><strong>2. 超出最大值显示 max+</strong>：限制宽度，防止 UI 崩坏：</p>
<pre><code class="hljs">99+  ✔
12999  ✘
</code></pre>
<p><strong>3. 自定义颜色优先级更高</strong>：使 Badge 可高度定制：</p>
<pre><code class="hljs language-ini" lang="ini">&lt;Badge <span class="hljs-attr">backgroundColor</span>=<span class="hljs-string">"#ff8800"</span> color=<span class="hljs-string">"#fff"</span> /&gt;
</code></pre>
<p><strong>4. 小圆点模式省略所有内容检查</strong>：非常适合在线状态指示。</p>
<p><strong>5. 过渡动画提升体验</strong>：从 "出现/消失" 变为 "缩放展开"，更柔和自然。</p>
<h2 data-id="heading-14">八、使用实例</h2>
<p>这样我们就完成一个简易的徽标组件，下面在外面的父组件这样使用就可以啦！</p>
<pre><code class="hljs language-js" lang="js">&lt;<span class="hljs-title class_">Badge</span> :value=<span class="hljs-string">"3"</span>&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"relative px-3 py-1 bg-gray-200 rounded"</span>&gt;</span>消息<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span>
&lt;/<span class="hljs-title class_">Badge</span>&gt;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Badge</span> <span class="hljs-attr">:isDot</span>=<span class="hljs-string">"true"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"success"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"w-8 h-8 bg-gray-300 rounded-full"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">Badge</span>&gt;</span></span>

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Badge</span> <span class="hljs-attr">:value</span>=<span class="hljs-string">"120"</span> <span class="hljs-attr">:max</span>=<span class="hljs-string">"99"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"danger"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">Badge</span>&gt;</span></span>

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Badge</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"New"</span> <span class="hljs-attr">backgroundColor</span>=<span class="hljs-string">"#f60"</span> <span class="hljs-attr">color</span>=<span class="hljs-string">"#fff"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">Badge</span>&gt;</span></span>

</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[分布式锁工具类]]></title>    <link>https://juejin.cn/post/7574958975159697451</link>    <guid>https://juejin.cn/post/7574958975159697451</guid>    <pubDate>2025-11-21T08:40:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574958975159697451" data-draft-id="7574892669374627894" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="分布式锁工具类"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-21T08:40:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="小夏coding"/> <meta itemprop="url" content="https://juejin.cn/user/2403977616186251"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            分布式锁工具类
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2403977616186251/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    小夏coding
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T08:40:39.000Z" title="Fri Nov 21 2025 08:40:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">业务背景：</h2>
<p>在多节点部署、事件回调或定时任务并发执行的场景中，需要同一份业务数据只被处理一次，否则会导致重复推送、资源竞争或脏数据。传统 synchronized 或数据库锁难以满足跨进程、跨机器的互斥需求。通常的做法都是使用Redisson 加一个分布式锁。</p>
<p>每次加分布式锁要写一堆代码，特别的麻烦，而且由于不断有新人进组，导致加分布式锁的代码并不规范，会导致加锁的异常处理存在安全风险，因此就封装了一个工具类给项目组成员使用，通过这个工具类，一来可以避免每次加锁写很多的代码，二来通过工具类可以保证加锁的安全性。</p>
<h2 data-id="heading-1">技术设计</h2>
<p>1、分布式锁还是使用Redisson来作为核心技术组件；</p>
<p>2、由于加锁时有一些参数需要调用方传入，如果放在方法里面作为参数会导致参数过多，因此封装了一个LockCallOptions类作为参数信息类，并为参数提供默认值，大部分情况下只需要使用默认值即可。这些参数信息有：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-string">`lockKey`</span>：加锁的键值；
<span class="hljs-string">`lockSeconds`</span>：锁过期时间，默认 <span class="hljs-number">5</span> 秒，可自定义（需在 <span class="hljs-number">1</span>~<span class="hljs-number">1000</span> 秒区间）。
<span class="hljs-string">`errorLogMsg`</span>：加锁和业务执行时如果抛出异常会打印日志，这个参数表示打印的日志信息内容。
<span class="hljs-string">`throwWhenLockFail`</span>：未抢到锁时是否抛异常，默认 <span class="hljs-literal">true</span>。
<span class="hljs-string">`throwMsgWhenLockFail`</span>：未抢到锁时如果抛出异常，内容就是这个参数。
LockCallOptions再实现一个checkParams方法检查参数值的合法性。
</code></pre>
<p>3、业务方法可以使用java的函数来实现，比如Function等，但由于业务方法需要传入的参数可能不同，比如有的不传参数，有的一个参数，有的两个参数，因此可以实现多个方法，分别用Supplier、Function、BiFunction来实现。</p>
<p>如果有更多参数怎么办，第一种办法是继续函数式接口，然后再实现一个方法，比如针对三个参数的可以定义这个函数式接口：</p>
<pre><code class="hljs language-csharp" lang="csharp">@FunctionalInterface
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">ThreeFunction</span>&lt;<span class="hljs-title">T</span>, <span class="hljs-title">U</span>, <span class="hljs-title">V</span>, <span class="hljs-title">R</span>&gt; {

    <span class="hljs-function">R <span class="hljs-title">apply</span>(<span class="hljs-params">T t, U u, V v</span>)</span>;
}
</code></pre>
<p>还有一种方式是可以定义一个map，将所有的参数都推入这个map，然后在工具类方法中从map中取参数；</p>
<h2 data-id="heading-2">关键代码</h2>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> RedissonClient <span class="hljs-title">getRedissonClient</span>()</span> {
    RedissonClient result = SpringContextHolder.getBean(RedissonClient.<span class="hljs-keyword">class</span>);
    <span class="hljs-keyword">if</span> (Objects.isNull(result)) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(<span class="hljs-string">"获取分布式锁失败"</span>);
    }

    <span class="hljs-keyword">return</span> result;
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;R&gt; <span class="hljs-function">R <span class="hljs-title">callWithLock</span>(<span class="hljs-params">LockCallOptions options, Supplier&lt;R&gt; bizFunc</span>)</span> {
    <span class="hljs-comment">//参数检查</span>
    options.check();

    RLock <span class="hljs-keyword">lock</span> = <span class="hljs-literal">null</span>;
    boolean locked = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">lock</span> = getRedissonClient().getLock(options.getLockKey());
        locked = <span class="hljs-keyword">lock</span>.tryLock(options.getLockSeconds(), TimeUnit.SECONDS);
        <span class="hljs-keyword">if</span> (!locked) {
            <span class="hljs-comment">//没获取到锁则丢弃</span>
            log.error(<span class="hljs-string">"获取分布式锁失败，键值key: {}"</span>, options.getLockKey());
            <span class="hljs-keyword">if</span> (options.getThrowWhenLockFail()) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(options.getThrowMsgWhenLockFail());
            }
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        }

        <span class="hljs-comment">//业务处理</span>
        <span class="hljs-keyword">return</span> bizFunc.<span class="hljs-keyword">get</span>();
    }  <span class="hljs-keyword">catch</span> (Exception ex) {
        log.error(<span class="hljs-string">"{}: 异常信息：{}"</span>, options.getErrorLogMsg(), ex.getMessage(), ex);
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    } <span class="hljs-keyword">finally</span> {
        <span class="hljs-keyword">if</span> (locked &amp;&amp; <span class="hljs-keyword">lock</span> != <span class="hljs-literal">null</span> &amp;&amp; <span class="hljs-keyword">lock</span>.isHeldByCurrentThread()) {
            <span class="hljs-keyword">lock</span>.unlock();
        }
    }
}
</code></pre>
<h2 data-id="heading-3">使用示例</h2>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">String</span> <span class="hljs-variable">lockKey</span> <span class="hljs-operator">=</span> String.format(<span class="hljs-string">"lcok:%s:%s"</span>, type, userId);
<span class="hljs-type">LockCallOptions</span> <span class="hljs-variable">callOptions</span> <span class="hljs-operator">=</span> LockCallOptions.builder()
        .lockKey(lockKey)
        .errorLogMsg(<span class="hljs-string">"业务处理异常"</span>)
        .throwWhenLockFail(<span class="hljs-literal">false</span>)
        .build();
LockUtils.callWithLock(callOptions, () -&gt; handler.process(requestData));
</code></pre>
<p><strong>注意：</strong></p>
<p>LockCallOptions的定义如下：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Data</span>
<span class="hljs-meta">@Builder</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LockCallOptions</span> {

    <span class="hljs-comment">// 锁的键值</span>
    <span class="hljs-keyword">private</span> String lockKey;

    <span class="hljs-comment">//锁的秒数   </span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">long</span> <span class="hljs-variable">lockSeconds</span> <span class="hljs-operator">=</span> <span class="hljs-number">5</span>;

    <span class="hljs-comment">//加锁异常时记录的错误日志信息    </span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">String</span> <span class="hljs-variable">errorLogMsg</span> <span class="hljs-operator">=</span> <span class="hljs-string">"加锁执行方法异常"</span>;

    <span class="hljs-comment">// 加锁失败时是否抛异常    </span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">Boolean</span> <span class="hljs-variable">throwWhenLockFail</span> <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>;

    <span class="hljs-comment">// 加锁失败时抛异常信息内容（throwWhenLockFail = true时才会使用这个值）    </span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">String</span> <span class="hljs-variable">throwMsgWhenLockFail</span> <span class="hljs-operator">=</span> <span class="hljs-string">"请稍后重试"</span>;
}
</code></pre>
<p>由于使用了@Builder注解，在使用LockCallOptions.builder().build()时发现创建的LockCallOptions对象并没有上面定义时指定的默认值，要解决这个办法就是在有默认值的属性定义上加上注解：@Builder.Default即可解决。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[续集：Vite 字体插件重构之路 —— 从“能用”到“生产级稳定”]]></title>    <link>https://juejin.cn/post/7574967214127775770</link>    <guid>https://juejin.cn/post/7574967214127775770</guid>    <pubDate>2025-11-21T08:45:57.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574967214127775770" data-draft-id="7574991051434622986" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="续集：Vite 字体插件重构之路 —— 从“能用”到“生产级稳定”"/> <meta itemprop="keywords" content="JavaScript,Vue.js,Vite"/> <meta itemprop="datePublished" content="2025-11-21T08:45:57.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="特级业务专家"/> <meta itemprop="url" content="https://juejin.cn/user/2101921961481512"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            续集：Vite 字体插件重构之路 —— 从“能用”到“生产级稳定”
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2101921961481512/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    特级业务专家
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T08:45:57.000Z" title="Fri Nov 21 2025 08:45:57 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">续集：Vite 字体插件重构之路 —— 从“能用”到“生产级稳定”</h2>
<blockquote>
<p><strong>前言</strong>：
在上一篇文章《把 16MB 中文字体压到 400KB：我写了一个 Vite 字体子集插件》中，我分享了如何通过自研插件 <code>@fe-fast/vite-plugin-font-subset</code> 解决中文字体体积过大的问题。</p>
<p>文章发出后，不少朋友试用并反馈了意见。更重要的是，在实际生产环境的复杂构建链路中，我发现 v0.1 版本存在一些设计上的“硬伤”。</p>
<p>开源不仅仅是发布代码，更是一个持续迭代的过程。今天这篇“续集”，就来聊聊这次 v0.3.x 重构背后的故事：<strong>如何解决路径 404 问题、生命周期竞态，以及如何更优雅地接入 Vite 构建流。</strong></p>
</blockquote>
<h3 data-id="heading-1">一、遇到的问题：本地跑得欢，上线 404</h3>
<p>在 v0.1 版本中，我的实现逻辑非常简单粗暴：</p>
<ol>
<li>插件运行，调用 <code>subset-font</code> 生成 <code>.woff2</code> 文件。</li>
<li>使用 <code>fs.writeFileSync</code> 直接把文件写到 <code>src/assets/fonts/subset</code> 目录下。</li>
<li>生成一个 <code>font.css</code>，里面写着 <code>src: url('./subset/xxx.woff2')</code>。</li>
<li>用户手动引入这个 CSS。</li>
</ol>
<p><strong>看起来没问题？但在真实项目中，这个方案有两个致命缺陷：</strong></p>
<h4 data-id="heading-2">1. 路径引用的“相对论”陷阱</h4>
<p>当我们在开发环境（<code>vite dev</code>）时，文件都在本地磁盘上，相对路径 <code>url('./subset/...')</code> 能正常工作。
但在 <code>vite build</code> 生产构建时，Vite 会把 CSS 内联到 HTML 中，或者打包成独立的 CSS 文件放在 <code>assets</code> 目录深处。
一旦目录结构发生变化（例如设置了 <code>base: '/app/'</code>），原本写死的相对路径就会失效，导致浏览器报 <strong>404 Not Found</strong>。</p>
<h4 data-id="heading-3">2. “脏”文件与构建副作用</h4>
<p>直接用 <code>fs</code> 模块往 <code>src</code> 目录写文件，是一种“副作用”很强的做法：</p>
<ul>
<li>这些生成的临时文件会被 Git 识别，污染工作区。</li>
<li>它们没有经过 Vite 的资源处理管道（Asset Pipeline），导致文件名没有 Hash（缓存问题），也不会出现在 <code>manifest.json</code> 中。</li>
</ul>
<h3 data-id="heading-4">二、重构核心：拥抱 Vite/Rollup 标准流</h3>
<p>为了解决上述问题，我决定对插件进行彻底重构。核心目标是：<strong>不再手动写磁盘，而是把资源“交给” Vite 处理。</strong></p>
<h4 data-id="heading-5">1. 弃用 <code>fs.write</code>，改用 <code>emitFile</code></h4>
<p>Vite（基于 Rollup）提供了一个标准的 API <code>this.emitFile</code>，专门用于在构建过程中发射文件。</p>
<p><strong>Before (v0.1):</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ❌ 坏味道：直接操作磁盘，脱离构建流</span>
fs.<span class="hljs-title function_">writeFileSync</span>(outputPath, subsetBuffer);
</code></pre>
<p><strong>After (v0.3):</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ✅ 最佳实践：告诉构建工具“我有一个文件要打包”</span>
<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">emitFile</span>({
  <span class="hljs-attr">type</span>: <span class="hljs-string">'asset'</span>,
  <span class="hljs-attr">fileName</span>: <span class="hljs-string">'assets/fonts/my-font.woff2'</span>,
  <span class="hljs-attr">source</span>: subsetBuffer
});
</code></pre>
<p>这样做的好处是，Vite 会自动处理这些文件，把它们放到正确的 <code>dist</code> 目录，并且我们可以利用 Vite 的机制来处理路径。</p>
<h4 data-id="heading-6">2. 解决生命周期的“竞态问题”</h4>
<p>在重构过程中，我踩了一个深坑：<strong>生命周期执行顺序</strong>。</p>
<p>我最初想在 <code>transformIndexHtml</code> 钩子（处理 HTML 时）去注入 CSS 标签。但是，字体子集化是一个耗时操作（CPU 密集型），如果放在错误的钩子执行，会导致 HTML 已经处理完了，字体还没生成好。</p>
<p><strong>最终的架构方案：</strong></p>
<ul>
<li>
<p><strong><code>buildStart</code> 阶段</strong>：
这是构建开始的最早阶段。我在这里执行最耗时的“字体子集化”和“字符扫描”工作。计算出所有的 Hash 文件名，准备好要发射的数据。
<em>为什么在这里？</em> 确保后续任何钩子执行时，数据都已经准备就绪。</p>
</li>
<li>
<p><strong><code>generateBundle</code> 阶段</strong>：
在这里统一调用 <code>emitFile</code> 发射所有字体文件和生成的 CSS 文件。</p>
</li>
<li>
<p><strong><code>transformIndexHtml</code> 阶段</strong>：
因为在 <code>buildStart</code> 阶段我们已经计算好了最终的文件名（包含 Hash），所以在这里可以直接生成 <code>&lt;link rel="stylesheet"&gt;</code> 标签并注入到 HTML 的 <code>&lt;head&gt;</code> 中。</p>
</li>
</ul>
<h4 data-id="heading-7">3. 自动注入：从“手动挡”变“自动挡”</h4>
<p>v0.1 版本需要用户手动在 <code>main.ts</code> 里 <code>import './subset/font.css'</code>。
现在，得益于对 <code>transformIndexHtml</code> 的利用，插件默认开启 <code>injectCss: true</code>。</p>
<p><strong>用户什么都不用做</strong>，构建完成后，<code>index.html</code> 里会自动多出一行：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/assets/fonts/font-a1b2c3d4.css"</span>&gt;</span>
</code></pre>
<p>这不仅省事，更重要的是<strong>路径绝对正确</strong>。插件会根据 Vite 配置的 <code>base</code> 自动拼接路径，无论你部署在根目录还是子目录，都能完美加载。</p>
<h3 data-id="heading-8">三、代码细节：一个小 Bug 的教训</h3>
<p>在 v0.3.1 的迭代中，我还修复了一个变量作用域的小 Bug。</p>
<p><strong>Bug 现场：</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ❌ 错误代码</span>
<span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> <span class="hljs-title function_">processFont</span>(...)
<span class="hljs-comment">// 这里试图解构 fontPath，但 processFont 返回值里漏传了这个字段</span>
<span class="hljs-keyword">const</span> { fontPath } = result 
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(path.<span class="hljs-title function_">basename</span>(fontPath)) <span class="hljs-comment">// -&gt; undefined</span>
</code></pre>
<p><strong>修复与优化：</strong>
在 v0.3.3 中，我不仅修复了变量传递，还反思了一下：<strong>为什么需要传递这个变量？</strong>
其实 <code>cssEntry</code> 对象里已经包含了 <code>relativePath</code>，完全可以通过它推导出文件名。于是我删除了冗余的 <code>fontPath</code> 返回值，让数据流更清晰。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ✅ 优化后：减少冗余数据传递</span>
<span class="hljs-keyword">const</span> { cssEntry } = result
<span class="hljs-comment">// 直接从已有数据推导</span>
<span class="hljs-keyword">const</span> fileName = path.<span class="hljs-title function_">basename</span>(cssEntry.<span class="hljs-property">relativePath</span>)
</code></pre>
<p><em>这提醒我们：重构不仅是改架构，更是清理冗余逻辑的好时机。</em></p>
<h3 data-id="heading-9">四、v0.3.x 版本的新特性总结</h3>
<p>经过这次“伤筋动骨”的重构，<code>@fe-fast/vite-plugin-font-subset</code> 现在具备了生产级的能力：</p>
<ol>
<li><strong>零配置自动注入</strong>：默认自动生成 CSS 并注入 HTML，无需手动 import。</li>
<li><strong>构建产物纯净</strong>：不再污染 <code>src</code> 源码目录，所有产物直接进入 <code>dist</code>。</li>
<li><strong>路径安全</strong>：完美支持 Vite 的 <code>base</code> 配置，支持 CDN 部署路径。</li>
<li><strong>Hash 缓存友好</strong>：生成的文件名带有内容 Hash，利于浏览器长效缓存。</li>
</ol>
<h3 data-id="heading-10">五、写在最后</h3>
<p>从 v0.1 到 v0.3，代码量增加了不少，但使用者的心智负担却降低了。</p>
<p>做开源项目往往就是这样：<strong>把复杂留给自己，把简单留给用户。</strong>
最初只是为了解决自己项目的 16MB 字体问题，现在它已经变成了一个更加健壮的通用解决方案。</p>
<p>如果你也在使用 Vite 开发中文项目，深受字体体积困扰，欢迎尝试一下这个插件，也欢迎在 GitHub 上提 Issue 或 PR，我们一起把它打磨得更好。</p>
<blockquote>
<p><strong>GitHub</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fwilliam-xue%2Fvite-plugin-font-subset" target="_blank" title="https://github.com/william-xue/vite-plugin-font-subset" ref="nofollow noopener noreferrer">github.com/william-xue…</a>
<strong>NPM</strong>: <code>npm install @fe-fast/vite-plugin-font-subset -D</code></p>
</blockquote>
<hr/>
<p><strong>下一阶段计划：</strong>
目前插件主要针对 Build 阶段优化。接下来我可能会探索一下如何在 Dev 开发阶段提供更好的体验（比如利用缓存避免重复构建），敬请期待！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[百万QPS防刷赞系统设计实录：从TRAE SOLO生成到生产级改造]]></title>    <link>https://juejin.cn/post/7574916588718293034</link>    <guid>https://juejin.cn/post/7574916588718293034</guid>    <pubDate>2025-11-21T07:47:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574916588718293034" data-draft-id="7574734686494375972" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="百万QPS防刷赞系统设计实录：从TRAE SOLO生成到生产级改造"/> <meta itemprop="keywords" content="Trae"/> <meta itemprop="datePublished" content="2025-11-21T07:47:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="zhouzhouya"/> <meta itemprop="url" content="https://juejin.cn/user/3931509312987511"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            百万QPS防刷赞系统设计实录：从TRAE SOLO生成到生产级改造
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3931509312987511/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    zhouzhouya
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T07:47:05.000Z" title="Fri Nov 21 2025 07:47:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body blockquote&gt;:first-child{margin-top:0}.markdown-body blockquote&gt;:last-child{margin-bottom:0}.markdown-body{overflow:hidden;line-height:1.75;font-size:15px;background-image:linear-gradient(90deg,rgba(72,42,10,.05) 5%,rgba(72,42,10,0) 0),linear-gradient(1turn,rgba(72,42,10,.05) 5%,rgba(72,42,10,0) 0);background-size:20px 20px;background-position:50%;padding-top:0!important}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{position:relative;display:flex;border-bottom:5px solid #6d4e00;line-height:35px;letter-spacing:1px;font-size:25px;padding-left:25px;color:#664900;text-shadow:1px 1px 1px #8a6200;padding-bottom:0}.markdown-body h1:before{content:"";display:flex;position:absolute;left:0;top:3px;bottom:0;margin:auto;width:20px;height:20px;background-size:20px 20px;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAMAAACahl6sAAAAQlBMVEVHcEwlRnqtZBj76q4lRnolRnolRnolRnolRnokRnr/gGtrVUeLXDBKTl+hYSHasW7Ik0zs0JG4dCvUdEE0SW+rYxrLQJfjAAAACnRSTlMA////0H/xUaMi5MCoTwAACfVJREFUeNrtnQl3qygUgJ9GXAqosfL//+pgmgXwXmRNJGdu55xO+6rx8+6I8O9fehmGriN93zdN07bVXdpW/ih/SbpuGP6dXbpOXv7z2i3S9ISck2eQOnAhMHG64VQQbmrAaM4B05GmipaGdB+m6BNQPBXzMYtKR3EPbB/RS5eY4g+lIW9WBqnySCvVMrzRpqqs0g9nwVg5p1KYlHEchRT5bftp+y3n6xlQDjAkABtrKULU9f377ev+4/1/NiT+URRiZRhrcZP6WLa/Gq005BORaqXsdYEuHPIP798ZxSyt6d5sVfxJESRCsvB32lfXwhRjnUBGmKXNoJQe04VIASJqRC/9G7yDsyQMiloYz+0pHYghEoPISAGgpDSvHsCoMwmA0mfjSG5UOsqah2RodkljzMkhZZdamiEDB8+Nsbk9T04yGNljDXGOZZ6u0+Tj9DuvbyNJBuPO0ABtLNPlJtfZJ4CNNCWJoY8gddwxNpm9YrHh9DEkBoeMud4Kma8XRZaYpBJOYvg59U9wOsblMvmGrzQe30dyqFZ1dxPfO0FT5BOdw989THVs4q1TFk+iN4PMu7CaLpd4EJOExNaJLE4d0xQKYpJ0cY5Ozcwwu6WOu2cs9TUYxPB4b4fvLRzTUXbT1HH7y0BnB0j6CAehkPFfFzd1TMsi6sU1/P4VM9NiISHBlYnBMR+kad075sXlmMehj1twnfTUqJH4GJfqIKte7S72emPnHbdiYHIB0e6ATjKq1UoTaFh6wBL2csMIVo9fH/v6QRHAgoxrOHQQxG/36tC1ODmGOeBGBRmXalgcdhDQ1xF1vI6a3DF2d4r7G1enOUgNOshlFq7qUCxrca9ldiCam7ilxRbP6JbOYsYtfLFmkcXEgLG1DN/6eroxHjqh5bh+Uw27e1oWVK7pN+AqwzUcq/UYTPw8nWufLFBHN2zcxLRYlmGPs6rA2Wy0uJe/E7TknbHIa1WH1bLA8DAj3JpxET+FCNCWZ5uNT6jxTPZK/1mXoCBeKlGLRT2lP69XN3XdqqCojKX1ZVda6iD2McjeXSHa0I+AHd2InGAJgjRVM6gOBfygDrarRJnho6eQBbrns+HkcNUCWtYClJa66qFgPbqqZEBTCOAgRqxCOhQBWpZeIC6QBq91hEoI5unTjsMsK9DCFigY9WNn19hgVCrELalrTw6WnYMYzjHhQ2/7G2xTx1HvwpzSe4cVi5ORQQwMW9+72FU5L4gGsa6Yu1RcDeIhs64Qs8izt0vGH+n9/IKaIlYpM2UqkYOrwwq5CgBjWpyGtxaonxe4KaJ3hx+7O0HaqVkxLBPj8FmBVmjNevIUFhUuDmMq5NDV9RwyPe/95IvxAhG7ymqxHGE5sZJL2kPLUhUinkXfrnFwGFwXD99djNLSFh/meXEb2B6Oyiwm0I7BC+OlTlOVPk9K8CIYzu5YHwKDTI6XAo5lz3WEqEXwQRKhh5cyLa6D81P4PXBw984as9YaGXHwx4Ba8rmOldUat/BHt9cQ38AaljnBdCJqs60OcXVDJZP//ZwSWtV9FpHNtgg22KuYx/U2tB5Mcp1TYOiphNhiFjgWeJ3DL2OZpuuUisIoUyzZEJ76I+LmyqWdv8LwnEiwMYczihjxeqtBsuFJSTg2oD1ETQx4v6D1VleSZW1xCwvAfVGWpQ069kgrQksAUW2rReYzsboIjSABuDQX0QJwB9cnZVgWVgE31vrklAJnEmVObykgYCk/VGX5OlpuKb5eiovUAvJ2tMstw0kIkNdpiSA91K6XA6K8CVCyr4PePhTo65q3DyX7OpTbSVk1PB62mhJ9HSpSqtKaESxsFRm0tLBVcvTV+vbBrLRK4hC7aitN9B0ZpX6vNMgjGIt5ZdmMv32KrmprD1afsPd4FEhThK0+WfTl3kpd482AGvG3jQdZK1+t8ireDswhofigRb3fxfI/4jj+xkffUX/1ccxxhEP9qyyBEH9Cx9vhf8TB7eiSpBHjZVSa4whQMJC1TqIR6q8RERtjOr2ID0yx3oYi0oAIvZCPz4eG64p3ObuREeOHUIR3MBVJwq9yll5P7KHdiPBOiOoRa/AjXz21J3k04l+i8OjErj4kaXWQiIVO/EvA+KLRAEnUVomtjPd6SvR3RLoeMT54nKFH1EqtkkEGFaQuTlSQrsxhRiOIt51S/Ho8B11+FUlwRaHnU4utEI38/mgSjRJ8PhWEtN6Z6WcncQOU4efjKoh3zfi7/+DfhPrwOZ9a/iYBiVJJxPlei3CqIDTYEqAPFow5/c71fAdVIwmo4n+cTIGbr2n9NULAE5ifcNNS63hvEOFk0wxYnICBBZ0I9xERBVILF0uggNdxuOkR4S6ngvgPmArzHv4KpMKGQFjQ+Rw6q9dC6R6dgZaJF7RVWIH0BTY9h+fz0ohHOyLuy+He/hN4GUR3/RxcBx2f76izarI9CaXmzRmhNQuSfIgJkva5GzN6HJbhQxCNsDGDSh56plmef6sg2eaXPsYBt5W+H6VE6omG6hOS1w4hiTWiThbJ1YO+RSO1vrpMlomf6nhQGz0m7qT6W04XOUHyzhZ4rkG+0hxL66oDW9mnPWyL3TMmssxyQUwr01CHX7b2OvUIaqS48TnMtAoEQTQixJeAlDfSiGmk/l8jpwIpTyFqOfeNIHWBooC036ERtUQp2tm/CKT5jjySbxTlvUVj2yhjvyWDVL3yfKRojXwLSEWUp7q0PBAKPp7m5YGoT3WH7wAZ1BeOywNZv3Gak/LIqriwxbQ5jaTcsEW1eb+FvoWo+zr5V/IUOvNtsapU2zJXSyj0xVB13sPfq0kkZA7dubIIKXIlJ8Cy7u+BN22RVcr+peOuxHdcBbA04FAVmEoEtO5vX55K4KVZS1QJvBBzU1rgUl8JapBNYIowLoZtD9NWRTWKqqe36L48BSz8QPH9epqqIDehlh2UuqocEmrdV7AvhuRoM74m80yeDIEX3ppreNN235FxV58DNjhswn5K8zK21+5ctjut6NmUIoy9tVvitnHr2VDM3ahtW8KQ/Vbsp9GGiWHfk8skyTSFz9/HdxhHe4uR/RxX/mG1SGXwypcDJNmCMfucZ/C1CuCQUbiBUDYbe7tiRkZX8GIat50d+wqR1fdN7ygGzrHrcN4kGFHK02cil5M6INgQVsvnNz77T5PqUFYJJInYmIBplJfP5On4eiOwYfhuCD44oLyYVs43rI1rk3H7usttzq8Qo3j84vavN9mOkAeuq8dHEd9NtCVKX51Oen+MM6IEYvz5StOehKLpIjD+nKU5AQWJpLizdB+1sb5LQvFRxbSJVGHmSdK/0WWaPguEYmcSJ68aWkK6rAw6jwSSCmrTWVHT96R7HwHANEgqybVJL+E2vE2q7Uu91Gr73SbbNUvZDtiOlCeIv4r/AI+0XUwz1lvcAAAAAElFTkSuQmCC")}.markdown-body h2{position:relative;padding:0 0 0 20px;font-size:20px;font-weight:700;color:#614500}.markdown-body h2:before{content:"";position:absolute;top:3px;bottom:0;left:0;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAMAAACahl6sAAAAQlBMVEVHcEwlRnqtZBj76q4lRnolRnolRnolRnolRnokRnr/gGtrVUeLXDBKTl+hYSHasW7Ik0zs0JG4dCvUdEE0SW+rYxrLQJfjAAAACnRSTlMA////0H/xUaMi5MCoTwAACfVJREFUeNrtnQl3qygUgJ9GXAqosfL//+pgmgXwXmRNJGdu55xO+6rx8+6I8O9fehmGriN93zdN07bVXdpW/ih/SbpuGP6dXbpOXv7z2i3S9ISck2eQOnAhMHG64VQQbmrAaM4B05GmipaGdB+m6BNQPBXzMYtKR3EPbB/RS5eY4g+lIW9WBqnySCvVMrzRpqqs0g9nwVg5p1KYlHEchRT5bftp+y3n6xlQDjAkABtrKULU9f377ev+4/1/NiT+URRiZRhrcZP6WLa/Gq005BORaqXsdYEuHPIP798ZxSyt6d5sVfxJESRCsvB32lfXwhRjnUBGmKXNoJQe04VIASJqRC/9G7yDsyQMiloYz+0pHYghEoPISAGgpDSvHsCoMwmA0mfjSG5UOsqah2RodkljzMkhZZdamiEDB8+Nsbk9T04yGNljDXGOZZ6u0+Tj9DuvbyNJBuPO0ABtLNPlJtfZJ4CNNCWJoY8gddwxNpm9YrHh9DEkBoeMud4Kma8XRZaYpBJOYvg59U9wOsblMvmGrzQe30dyqFZ1dxPfO0FT5BOdw989THVs4q1TFk+iN4PMu7CaLpd4EJOExNaJLE4d0xQKYpJ0cY5Ozcwwu6WOu2cs9TUYxPB4b4fvLRzTUXbT1HH7y0BnB0j6CAehkPFfFzd1TMsi6sU1/P4VM9NiISHBlYnBMR+kad075sXlmMehj1twnfTUqJH4GJfqIKte7S72emPnHbdiYHIB0e6ATjKq1UoTaFh6wBL2csMIVo9fH/v6QRHAgoxrOHQQxG/36tC1ODmGOeBGBRmXalgcdhDQ1xF1vI6a3DF2d4r7G1enOUgNOshlFq7qUCxrca9ldiCam7ilxRbP6JbOYsYtfLFmkcXEgLG1DN/6eroxHjqh5bh+Uw27e1oWVK7pN+AqwzUcq/UYTPw8nWufLFBHN2zcxLRYlmGPs6rA2Wy0uJe/E7TknbHIa1WH1bLA8DAj3JpxET+FCNCWZ5uNT6jxTPZK/1mXoCBeKlGLRT2lP69XN3XdqqCojKX1ZVda6iD2McjeXSHa0I+AHd2InGAJgjRVM6gOBfygDrarRJnho6eQBbrns+HkcNUCWtYClJa66qFgPbqqZEBTCOAgRqxCOhQBWpZeIC6QBq91hEoI5unTjsMsK9DCFigY9WNn19hgVCrELalrTw6WnYMYzjHhQ2/7G2xTx1HvwpzSe4cVi5ORQQwMW9+72FU5L4gGsa6Yu1RcDeIhs64Qs8izt0vGH+n9/IKaIlYpM2UqkYOrwwq5CgBjWpyGtxaonxe4KaJ3hx+7O0HaqVkxLBPj8FmBVmjNevIUFhUuDmMq5NDV9RwyPe/95IvxAhG7ymqxHGE5sZJL2kPLUhUinkXfrnFwGFwXD99djNLSFh/meXEb2B6Oyiwm0I7BC+OlTlOVPk9K8CIYzu5YHwKDTI6XAo5lz3WEqEXwQRKhh5cyLa6D81P4PXBw984as9YaGXHwx4Ba8rmOldUat/BHt9cQ38AaljnBdCJqs60OcXVDJZP//ZwSWtV9FpHNtgg22KuYx/U2tB5Mcp1TYOiphNhiFjgWeJ3DL2OZpuuUisIoUyzZEJ76I+LmyqWdv8LwnEiwMYczihjxeqtBsuFJSTg2oD1ETQx4v6D1VleSZW1xCwvAfVGWpQ069kgrQksAUW2rReYzsboIjSABuDQX0QJwB9cnZVgWVgE31vrklAJnEmVObykgYCk/VGX5OlpuKb5eiovUAvJ2tMstw0kIkNdpiSA91K6XA6K8CVCyr4PePhTo65q3DyX7OpTbSVk1PB62mhJ9HSpSqtKaESxsFRm0tLBVcvTV+vbBrLRK4hC7aitN9B0ZpX6vNMgjGIt5ZdmMv32KrmprD1afsPd4FEhThK0+WfTl3kpd482AGvG3jQdZK1+t8ireDswhofigRb3fxfI/4jj+xkffUX/1ccxxhEP9qyyBEH9Cx9vhf8TB7eiSpBHjZVSa4whQMJC1TqIR6q8RERtjOr2ID0yx3oYi0oAIvZCPz4eG64p3ObuREeOHUIR3MBVJwq9yll5P7KHdiPBOiOoRa/AjXz21J3k04l+i8OjErj4kaXWQiIVO/EvA+KLRAEnUVomtjPd6SvR3RLoeMT54nKFH1EqtkkEGFaQuTlSQrsxhRiOIt51S/Ho8B11+FUlwRaHnU4utEI38/mgSjRJ8PhWEtN6Z6WcncQOU4efjKoh3zfi7/+DfhPrwOZ9a/iYBiVJJxPlei3CqIDTYEqAPFow5/c71fAdVIwmo4n+cTIGbr2n9NULAE5ifcNNS63hvEOFk0wxYnICBBZ0I9xERBVILF0uggNdxuOkR4S6ngvgPmArzHv4KpMKGQFjQ+Rw6q9dC6R6dgZaJF7RVWIH0BTY9h+fz0ohHOyLuy+He/hN4GUR3/RxcBx2f76izarI9CaXmzRmhNQuSfIgJkva5GzN6HJbhQxCNsDGDSh56plmef6sg2eaXPsYBt5W+H6VE6omG6hOS1w4hiTWiThbJ1YO+RSO1vrpMlomf6nhQGz0m7qT6W04XOUHyzhZ4rkG+0hxL66oDW9mnPWyL3TMmssxyQUwr01CHX7b2OvUIaqS48TnMtAoEQTQixJeAlDfSiGmk/l8jpwIpTyFqOfeNIHWBooC036ERtUQp2tm/CKT5jjySbxTlvUVj2yhjvyWDVL3yfKRojXwLSEWUp7q0PBAKPp7m5YGoT3WH7wAZ1BeOywNZv3Gak/LIqriwxbQ5jaTcsEW1eb+FvoWo+zr5V/IUOvNtsapU2zJXSyj0xVB13sPfq0kkZA7dubIIKXIlJ8Cy7u+BN22RVcr+peOuxHdcBbA04FAVmEoEtO5vX55K4KVZS1QJvBBzU1rgUl8JapBNYIowLoZtD9NWRTWKqqe36L48BSz8QPH9epqqIDehlh2UuqocEmrdV7AvhuRoM74m80yeDIEX3ppreNN235FxV58DNjhswn5K8zK21+5ctjut6NmUIoy9tVvitnHr2VDM3ahtW8KQ/Vbsp9GGiWHfk8skyTSFz9/HdxhHe4uR/RxX/mG1SGXwypcDJNmCMfucZ/C1CuCQUbiBUDYbe7tiRkZX8GIat50d+wqR1fdN7ygGzrHrcN4kGFHK02cil5M6INgQVsvnNz77T5PqUFYJJInYmIBplJfP5On4eiOwYfhuCD44oLyYVs43rI1rk3H7usttzq8Qo3j84vavN9mOkAeuq8dHEd9NtCVKX51Oen+MM6IEYvz5StOehKLpIjD+nKU5AQWJpLizdB+1sb5LQvFRxbSJVGHmSdK/0WWaPguEYmcSJ68aWkK6rAw6jwSSCmrTWVHT96R7HwHANEgqybVJL+E2vE2q7Uu91Gr73SbbNUvZDtiOlCeIv4r/AI+0XUwz1lvcAAAAAElFTkSuQmCC");background-size:100% 100%;background-repeat:no-repeat;width:15px;height:15px;margin:auto}.markdown-body h3{width:100%;text-align:left;margin:20px 10px 0 0;font-size:18px;font-weight:700;display:inline-block;padding-left:10px;padding-bottom:0;border-left:5px solid #8f6600;color:#614500}.markdown-body h4,.markdown-body h5,.markdown-body h6{font-weight:700;color:#a37400}.markdown-body h4{font-size:17px}.markdown-body h5,.markdown-body h6{display:flex;align-items:center}.markdown-body h5:after,.markdown-body h6:after{display:inline-block;border:2px solid #fff6e0;color:rgba(189,134,0,.5);border-radius:50%;text-align:center;margin-left:5px}.markdown-body h5{font-size:14px}.markdown-body h5:after{content:"5";width:15px;height:15px;line-height:15px;font-size:13px}.markdown-body h6{font-size:12px}.markdown-body h6:after{content:"6";width:13px;height:13px;line-height:13px;font-size:12px}.markdown-body p{color:#412c0c;letter-spacing:1px;font-weight:400;margin-bottom:16px}.markdown-body img{max-width:100%;display:block;margin:auto}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#755300;font-weight:400;border-bottom:1px solid #755300;font-weight:bolder;text-decoration:none}.markdown-body table{width:100%!important;margin:0;font-size:12px;width:auto;max-width:100%;overflow:auto;border-collapse:collapse;border-spacing:0}.markdown-body table img{box-shadow:none}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body thead tr th{text-align:center}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px;box-sizing:border-box;border:1px solid rgba(72,42,10,.1)}.markdown-body blockquote{position:relative;text-size-adjust:100%;line-height:25px;font-weight:400;border-radius:10px;font-style:normal;text-align:left;box-sizing:inherit;border:1px solid #ffd87a;background-color:rgba(189,134,0,.5);margin:20px 0;padding:20px}.markdown-body blockquote p{color:#fff6e0;letter-spacing:2px;margin:0}.markdown-body blockquote:after,.markdown-body blockquote:before{position:absolute;color:#cc9100;font-size:34px;font-weight:700}.markdown-body blockquote:before{content:"❝";top:8px;left:5px}.markdown-body blockquote:after{content:"❞";right:5px;bottom:-5px}.markdown-body strong{color:#c28a00;font-weight:bolder}.markdown-body strong:before{content:"「"}.markdown-body strong:after{content:"」"}.markdown-body em{color:#c28a00}.markdown-body em strong{font-style:normal;color:#c28a00;background-color:#8a6200}.markdown-body s{color:#c28a00}.markdown-body hr{border-top:1px solid #805b00}.markdown-body code,.markdown-body li code,.markdown-body p code{color:#996d00;background-color:rgba(130,98,0,.3)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit;color:#858585;font-family:bold;letter-spacing:1px}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection,.markdown-body img::selection{color:rgba(189,134,0,.5);background-color:#fff}.markdown-body a::selection,.markdown-body b::selection,.markdown-body del::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:transparent}.markdown-body pre&gt;code::selection{background-color:rgba(189,134,0,.5)}.markdown-body .math .math-inline::selection,.markdown-body blockquote::selection,.markdown-body ol::selection,.markdown-body p::selection,.markdown-body strong::selection,.markdown-body table::selection,.markdown-body ul::selection{background-color:rgba(189,134,0,.5)}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">背景</h2>
<p>想看看TRAE SOLO到底有多强大，正好脑子里闪过一个防刷赞系统，于是开始构思，防刷赞系统是什么？防刷赞系统主要应用于<strong>营销活动、内容平台、社交网络</strong>等场景，需要保护点赞功能的真实性和公正性。在电商平台、短视频平台、社交媒体等应用中，点赞功能非常重要，直接影响内容推荐、热门排行和商业价值，好了，说做就做，拿出TRAE SOLO，直接开始进行实践。</p>
<h2 data-id="heading-1">TRAE SOLO在实践时能做什么</h2>
<p>在开始进行实践前，我需要思考下，TRAE SOLO应该帮我做哪些事情，</p>
<h4 data-id="heading-2"><strong>技术要求上，需要考虑此系统的：</strong></h4>
<p><strong>1.高并发处理能力：</strong> 特别是在热点内容出现时，QPS（每秒查询率）可能达到数十万甚至上百万次。系统必须具备强大的并发处理能力和水平扩展能力。</p>
<p><strong>2.数据一致性要求：</strong>
系统需要保证<strong>强一致性</strong>确保一个用户对同一目标只能点赞一次，防止重复统计和数据不一致问题。这要求系统具备幂等性处理和分布式事务能力。</p>
<p><strong>3. 实时性要求：</strong>
用户点赞操作需要<strong>秒级响应</strong>，从用户点击到界面反馈的端到端延迟必须控制在200ms以内，否则会影响用户体验</p>
<h4 data-id="heading-3"><strong>安全威胁背景，需要考虑此系统的：</strong></h4>
<p><strong>1. 攻击手段多样化</strong></p>
<ul>
<li><strong>自动化脚本</strong>：防止有些黑客使用机器人程序进行批量点赞。</li>
<li><strong>IP池轮换</strong>：通过代理IP池绕过IP限制。</li>
<li><strong>设备指纹伪造</strong>：修改设备信息绕过设备限制。</li>
<li><strong>分布式攻击</strong>：利用僵尸网络进行大规模攻击。</li>
</ul>
<p><strong>2. 黑产产业链成熟</strong>
很多人为了赚钱想尽一切办法，使用写好的脚本，使刷赞目前形成了完整的产业链。包括账号注册、设备伪装、IP代理、自动化工具等环节，攻击成本低但防御成本高。</p>
<p>简化放刷赞系统，暂时只考虑以上提及的两部分，开始使用TRAE SOLO完成后续步骤。</p>
<h2 data-id="heading-4">具体实践步骤</h2>
<h4 data-id="heading-5"><strong>第一步：向TRAE SOLO下达精准的“初始指令”</strong></h4>
<p>“请作为一名首席架构师，基于以下核心需求，设计并生成一个高性能防刷赞系统的完整代码：</p>
<p><strong>系统核心目标</strong></p>
<ol>
<li>高并发处理：支持百万QPS的点赞请求。</li>
<li>强一致性：确保用户对同一内容仅能点赞一次，绝对防止重复。</li>
<li>低延迟：端到端响应时间控制在200毫秒内。</li>
<li>安全风控：有效防御自动化脚本、IP池轮换、设备指纹伪造、分布式攻击等多样化威胁。
【技术指示】</li>
</ol>
<ul>
<li>前端：Vue 3 + TypeScript + Vite</li>
<li>后端：Node.js + Express</li>
<li>缓存/数据库：Redis + PostgreSQL</li>
<li>风控：自研轻量级规则引擎
请输出完整的项目结构、API接口代码、数据库Schema及安全风控核心算法。</li>
</ul>
<p>指令下达完成后，只需要静静等待即可，经过TRAE SOLO给的提示操作，TRAE SOLO生成了一个结构清晰、技术选型合理的项目脚手架。</p>
<h4 data-id="heading-6"><strong>第二步：生成架构与核心代码，应对技术挑战</strong></h4>
<h5 data-id="heading-7"><strong>1. 应对高并发：生成异步削峰与缓存代码</strong></h5>
<p>TRAE SOLO会识别“百万QPS”的需求，并自动编写以下关键代码：</p>
<pre><code class="hljs language-javascript" lang="javascript">
<span class="hljs-comment">// TRAE SOLO 可能生成的核心代码示例 - 点赞接口</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Redis</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'ioredis'</span>;
<span class="hljs-keyword">const</span> redis = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Redis</span>(process.<span class="hljs-property">env</span>.<span class="hljs-property">REDIS_URL</span>);

<span class="hljs-comment">// 使用Redis Pipeline批量处理，极大提升吞吐量</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">likeContent</span>(<span class="hljs-params">userId, contentId</span>) {
  <span class="hljs-keyword">const</span> pipeline = redis.<span class="hljs-title function_">pipeline</span>();
  <span class="hljs-keyword">const</span> key = <span class="hljs-string">`like:<span class="hljs-subst">${contentId}</span>`</span>;
  <span class="hljs-keyword">const</span> userKey = <span class="hljs-string">`user_like:<span class="hljs-subst">${userId}</span>:<span class="hljs-subst">${contentId}</span>`</span>;

<span class="hljs-comment">// 1. 检查是否已点赞 (原子操作)</span>
  <span class="hljs-keyword">const</span> alreadyLiked = <span class="hljs-keyword">await</span> pipeline.<span class="hljs-title function_">sismember</span>(key, userId).<span class="hljs-title function_">exec</span>();
  <span class="hljs-keyword">if</span> (alreadyLiked) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'Already liked'</span>);
  }
<span class="hljs-comment">// 2. 记录点赞 (事务处理)</span>
pipeline.<span class="hljs-title function_">multi</span>()
   .<span class="hljs-title function_">sadd</span>(key, userId) <span class="hljs-comment">// 添加到内容点赞集合</span>
   .<span class="hljs-title function_">setex</span>(userKey, <span class="hljs-number">86400</span>, <span class="hljs-string">'1'</span>) <span class="hljs-comment">// 设置用户点赞标记，24小时过期</span>
   .<span class="hljs-title function_">incr</span>(<span class="hljs-string">`like_count:<span class="hljs-subst">${contentId}</span>`</span>) <span class="hljs-comment">// 点赞数+1</span>
   .<span class="hljs-title function_">exec</span>();
}

</code></pre>
<p>生成代码之后。我对此代码进行审查，基本满足处理<strong>高并发</strong>的需求。</p>
<h5 data-id="heading-8"><strong>2. 保证强一致性：生成幂等性处理与分布式锁</strong></h5>
<p>针对“防止重复统计”，TRAE SOLO会注入防重逻辑：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 幂等性处理 - 确保同一请求仅处理一次</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">likeContentWithIdempotency</span>(<span class="hljs-params">userId, contentId, requestId</span>) {
  <span class="hljs-keyword">const</span> idempotencyKey = <span class="hljs-string">`idempotency:<span class="hljs-subst">${requestId}</span>`</span>;
  
  <span class="hljs-comment">// 使用SETNX实现分布式锁，防止并发重复请求</span>
  <span class="hljs-keyword">const</span> lockAcquired = <span class="hljs-keyword">await</span> redis.<span class="hljs-title function_">setnx</span>(idempotencyKey, <span class="hljs-string">'processing'</span>);
  <span class="hljs-keyword">if</span> (!lockAcquired) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'Request processing'</span>);
  }
  <span class="hljs-keyword">await</span> redis.<span class="hljs-title function_">expire</span>(idempotencyKey, <span class="hljs-number">30</span>); <span class="hljs-comment">// 30秒自动过期</span>
  
  <span class="hljs-comment">// ... 核心点赞逻辑</span>
}
</code></pre>
<h5 data-id="heading-9"><strong>3. 满足实时性：生成轻量级API与高效查询</strong></h5>
<p>为确保“200毫秒响应”，TRAE SOLO会设计最简API：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 极简查询接口，所有数据在Redis中完成</span>
app.<span class="hljs-keyword">get</span>(<span class="hljs-string">'/api/content/:id/like-count'</span>, <span class="hljs-keyword">async</span> (req, res) =&gt; {
  <span class="hljs-keyword">const</span> count = <span class="hljs-keyword">await</span> redis.<span class="hljs-keyword">get</span>(`like_count:${req.<span class="hljs-keyword">params</span>.id}`);
  res.json({ count: parseInt(count) || <span class="hljs-number">0</span> });
});

</code></pre>
<h4 data-id="heading-10"><strong>第三步：集成风控规则，抵御安全威胁</strong></h4>
<p>针对上述提到的<strong>多样化攻击手段</strong>，提示TRAE SOLO生成动态规则引擎。</p>
<h5 data-id="heading-11"><strong>风控核心代码示例</strong>：</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// TRAE SOLO生成的风控规则引擎核心</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AntiSpamService</span> {
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">checkLikeSafety</span>(<span class="hljs-params">userId, ip, deviceFingerprint</span>) {
    <span class="hljs-keyword">const</span> rules = [
      <span class="hljs-comment">// 规则1: IP频率限制 (防IP池轮换/分布式攻击)</span>
      { <span class="hljs-attr">key</span>: <span class="hljs-string">`ip:<span class="hljs-subst">${ip}</span>`</span>, <span class="hljs-attr">limit</span>: <span class="hljs-number">100</span>, <span class="hljs-attr">window</span>: <span class="hljs-number">3600</span> }, <span class="hljs-comment">// 1小时内最多100次</span>
      
      <span class="hljs-comment">// 规则2: 用户频率限制 (防自动化脚本)</span>
      { <span class="hljs-attr">key</span>: <span class="hljs-string">`user:<span class="hljs-subst">${userId}</span>`</span>, <span class="hljs-attr">limit</span>: <span class="hljs-number">60</span>, <span class="hljs-attr">window</span>: <span class="hljs-number">3600</span> },
      
      <span class="hljs-comment">// 规则3: 设备指纹限制 (防设备指纹伪造)</span>
      { <span class="hljs-attr">key</span>: <span class="hljs-string">`device:<span class="hljs-subst">${deviceFingerprint}</span>`</span>, <span class="hljs-attr">limit</span>: <span class="hljs-number">50</span>, <span class="hljs-attr">window</span>: <span class="hljs-number">3600</span> }
    ];

    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> rule <span class="hljs-keyword">of</span> rules) {
      <span class="hljs-keyword">const</span> count = <span class="hljs-keyword">await</span> redis.<span class="hljs-title function_">incr</span>(rule.<span class="hljs-property">key</span>);
      <span class="hljs-keyword">if</span> (count === <span class="hljs-number">1</span>) <span class="hljs-keyword">await</span> redis.<span class="hljs-title function_">expire</span>(rule.<span class="hljs-property">key</span>, rule.<span class="hljs-property">window</span>);
      <span class="hljs-keyword">if</span> (count &gt; rule.<span class="hljs-property">limit</span>) {
        <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">reportSuspiciousActivity</span>(userId, ip, <span class="hljs-string">'FREQUENCY_OVERFLOW'</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>; <span class="hljs-comment">// 触发风控</span>
      }
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>; <span class="hljs-comment">// 安全</span>
  }
}


</code></pre>
<h4 data-id="heading-12"><strong>总结</strong></h4>
<p>通过以上步骤，我们借助TRAE SOLO将防刷赞系统，系统性地转化为一个具备可用性的防刷赞系统。它不仅解决了<strong>高并发、强一致性、低延迟</strong>的技术挑战，还通过动态风控规则有效抵御了<strong>多样化、产业化的安全威胁</strong>。</p>
<p>TRAE SOLO在此过程中的角色远不止代码生成器，它更是一个<strong>架构顾问、安全专家和自动化工程师</strong>，将抽象的需求和威胁分析，转化为可执行、可维护的高质量代码，极大提升了复杂系统开发的效率与可靠性。</p>
<h2 data-id="heading-13">TRAE SOLO的强大性是什么</h2>
<p>TRAE SOLO的强大性体现在“加速”而非“替代”。它并不能凭空变出这样一个完美的系统，而在于它如何<strong>重塑我们构建防刷赞系统这种复杂系统的流程和效率</strong>。静思考过后，我觉得TRAE SOLO的“不断强大”依赖于“强大的使用者”。
重新定义了“强大”的协作模式，它能<strong>将我们构建这种系统的能力，提升了一个数量级</strong>。</p>
<p>此文章对防刷赞系统的设计并不全面，后续会根据具体情况不断完善。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[openGauss进阶：使用DBeaver可视化管理与实战]]></title>    <link>https://juejin.cn/post/7574972697676365860</link>    <guid>https://juejin.cn/post/7574972697676365860</guid>    <pubDate>2025-11-21T07:51:28.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574972697676365860" data-draft-id="7574958975159369771" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="openGauss进阶：使用DBeaver可视化管理与实战"/> <meta itemprop="keywords" content="数据库"/> <meta itemprop="datePublished" content="2025-11-21T07:51:28.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="倔强的石头_"/> <meta itemprop="url" content="https://juejin.cn/user/3168119757484368"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            openGauss进阶：使用DBeaver可视化管理与实战
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3168119757484368/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    倔强的石头_
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T07:51:28.000Z" title="Fri Nov 21 2025 07:51:28 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读12分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>@[toc]</p>
<h2 data-id="heading-0">一、引言</h2>
<p>在上一篇文章中，我们成功地在CentOS 7.9上部署了openGauss数据库，并通过<code>gsql</code>命令行验证了其基本功能。命令行虽然直接高效，但在处理复杂SQL、进行数据分析和日常管理时，图形化界面（GUI）工具往往能提供更直观、更便捷的操作体验。本篇将使用通用且强大的数据库客户端——DBeaver（Community Edition）进行演示。</p>
<p>本文将承接上文，详细介绍如何安装和使用DBeaver来连接openGauss数据库，并通过实际操作，演示如何利用它进行数据库的可视化管理、复杂SQL查询及基础特性验证。无论您是数据库管理员（DBA）还是初级开发者，本文都将帮助您更高效地玩转openGauss。
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1c5ed74f945c4a908d5e5f4027d20f87~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764316288&amp;x-signature=bpArnXmFD5w4X%2Fu7kXS%2Fww9P1CE%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-1">二、DBeaver 简介</h2>
<p>DBeaver是一款跨平台的通用数据库客户端，支持包括PostgreSQL在内的众多数据库。openGauss兼容PostgreSQL生态，因此使用DBeaver的PostgreSQL驱动即可稳定连接与操作openGauss。DBeaver提供丰富的特性，适合日常开发与DBA管理。</p>
<h3 data-id="heading-2">主要功能</h3>
<ul>
<li><strong>连接管理</strong>：集中管理多个连接，支持会话复用与独立会话。</li>
<li><strong>对象浏览器</strong>：树状结构展示模式、表、视图、函数等对象。</li>
<li><strong>SQL编辑器</strong>：语法高亮、代码补全、格式化、结果集可视化与导出。</li>
<li><strong>数据导入/导出</strong>：支持CSV、JSON等格式的数据导入与导出。</li>
<li><strong>事务与会话控制</strong>：支持自动提交与手动事务，便于并发与隔离性实验。</li>
</ul>
<h2 data-id="heading-3">三、安装与配置DBeaver</h2>
<p>DBeaver是一款客户端工具，您需要在本地的Windows、macOS或Linux开发机上安装。本篇以“CentOS 7.9 + openGauss 极简版（simpleInstall）”为后端环境为例，演示从本地开发机远程连接到服务器。</p>
<h3 data-id="heading-4">3.1下载 DBeaver（社区版）</h3>
<p>访问<a href="https://link.juejin.cn?target=https%3A%2F%2Fdbeaver.io%2Fdownload%2F" target="_blank" title="https://dbeaver.io/download/" ref="nofollow noopener noreferrer">DBeaver官方下载页面</a>下载适配您的操作系统的安装包
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b7e04927f37e4890a70ae437e34f290c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764316288&amp;x-signature=4xgV7HpPbz5MhjP59qJfs5a5PJw%3D" alt="c3769cdfcdc5f86e322786b52023bbcc.png" loading="lazy"/></p>
<h3 data-id="heading-5">3.2 安装 DBeaver</h3>
<p>以Windows为例，双击下载的<code>.exe</code>文件，按照安装向导提示完成安装</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0675f6fe485d4442a6288b36adc7c266~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764316288&amp;x-signature=87U5mPQuXX95NjNDzfK8Kk8a43M%3D" alt="image.png" loading="lazy"/></p>
<p>安装界面中的组件含义如下（以社区版为例）：</p>



































<table><thead><tr><th>组件名称</th><th>功能说明</th><th>是否必选</th></tr></thead><tbody><tr><td><strong>DBeaver Community</strong></td><td>DBeaver 主程序（核心功能，包括数据库连接、SQL 编辑、数据管理等）。</td><td>✅ 必选</td></tr><tr><td><strong>Include Java</strong></td><td>安装 DBeaver 自带的 Java 运行环境（JRE）。</td><td>❗ 可选</td></tr><tr><td><strong>Reset Settings</strong></td><td>安装后将 DBeaver 配置重置为默认（如界面布局、连接配置等）。</td><td>❌ 不推荐</td></tr><tr><td><strong>Associate .SQL files</strong></td><td>将 <code>.sql</code> 文件与 DBeaver 关联，双击 SQL 文件默认用 DBeaver 打开。</td><td>❗ 可选</td></tr><tr><td><strong>Associate SQLite database files</strong></td><td>将 SQLite 数据库文件（<code>.db</code>）与 DBeaver 关联。</td><td>❗ 可选</td></tr></tbody></table>
<h3 data-id="heading-6">3.3 环境要求与驱动说明</h3>
<ul>
<li>DBeaver依赖 <code>JRE 1.8+</code>。Windows安装版自带JRE（在刚刚安装时选择组件），免安装版需自行安装JRE。</li>
<li>openGauss可直接使用DBeaver内置的PostgreSQL驱动进行连接；如遇兼容问题，可按官方指南手动添加openGauss JDBC驱动（详见后文“可选方案”）。</li>
</ul>
<h3 data-id="heading-7">3.4 创建数据库连接</h3>
<p>安装完成后，启动DBeaver。首次使用时，我们需要创建一个到openGauss服务器的连接：</p>
<ol>
<li>
<p>点击顶部菜单 <code>数据库 -&gt; 新建数据库连接</code>。
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7f8f1864b5ad426d913b1dfb17441cbc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764316288&amp;x-signature=7nTPvVEicf5MnCQHS5HOzUwD%2B6w%3D" alt="17922c2e0ac4a49a81d08e9ae6771fb7.png" loading="lazy"/></p>
</li>
<li>
<p>方案A（推荐）：在数据库列表中选择 <code>PostgreSQL</code> 驱动。
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1644a099a1414527a50ce7b5affe8387~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764316288&amp;x-signature=HFfMy0luapq6ZRIsKsaHSTAINlQ%3D" alt="image.png" loading="lazy"/></p>
</li>
<li>
<p>方案B（可选）：若已按官方指南添加了 openGauss JDBC 驱动，则在列表中选择该自定义驱动。[0]</p>
</li>
<li>
<p>在弹出的连接配置窗口中，填写以下信息：</p>
<ul>
<li><code>Host</code>：您在华为云上部署的openGauss服务器的公网IP地址。</li>
<li><code>Port</code>：默认为 <code>5432</code>。</li>
<li><code>Database</code>：例如 <code>postgres</code>。</li>
<li><code>Username</code>：安装时创建的 <code>omm</code> 用户或其他用户。</li>
<li><code>Password</code>：对应的用户密码。</li>
</ul>
</li>
<li>
<p>首次使用可能提示下载PostgreSQL驱动，点击确认。
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/49cef5f17be64a81ad1d49139bacc1b4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764316288&amp;x-signature=bWJW0ZjMl8z5TR7SmxOo7C%2FoCtc%3D" alt="image.png" loading="lazy"/></p>
</li>
<li>
<p>点击“Test Connection”进行测试，成功后点击“Finish”保存配置。
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/73b40287d17741d487edcef9c859bdcd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764316288&amp;x-signature=MuU%2BPqIaEic3qDbeaCiZh%2BAHrlE%3D" alt="image.png" loading="lazy"/></p>
</li>
</ol>
<p>连接成功后，您将在左侧的对象浏览器（Database Navigator）中看到数据库的完整结构。</p>
<h3 data-id="heading-8">3.5 远程连接前的必要准备（与极简版匹配）</h3>
<p>极简版安装默认仅在本机监听，若从本地 DBeaver 远程连接，需要完成以下准备（在服务器的<code>omm</code>用户下执行）：</p>
<ol>
<li>调整监听地址（<code>postgresql.conf</code>）：</li>
</ol>
<pre><code class="hljs language-bash" lang="bash">vi /opt/opengauss/data/single_node/postgresql.conf
<span class="hljs-comment"># 将 listen_addresses 改为允许远程（推荐为'*'，或指定内网/公网IP）</span>
listen_addresses = <span class="hljs-string">'*'</span>
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/015a703b4cd349ae8849caa510f3d3ca~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764316288&amp;x-signature=c7406qKQYUuh5bqF7VFXIwRNdNk%3D" alt="image.png" loading="lazy"/></p>
<ol start="2">
<li>允许远程客户端访问（<code>pg_hba.conf</code>）：</li>
</ol>
<pre><code class="hljs language-bash" lang="bash">vi /opt/opengauss/data/single_node/pg_hba.conf
<span class="hljs-comment"># 在文件末尾添加一行（按需收敛网段）</span>
host    all     all     0.0.0.0/0       md5
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3a7085640b774863a039645665ae449a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764316288&amp;x-signature=GmNWROPcpa%2BUo0B9Dx12J1We2Yg%3D" alt="image.png" loading="lazy"/></p>
<ol start="3">
<li>重启数据库使配置生效：</li>
</ol>
<pre><code class="hljs language-bash" lang="bash">gs_ctl restart -D /opt/opengauss/data/single_node -Z single_node
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b85991ba719e4a6d80b122f8e4850cff~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764316288&amp;x-signature=9y3O5sFi2cOKl3fbJ6gP07TDfXQ%3D" alt="image.png" loading="lazy"/></p>
<ol start="4">
<li>检查端口监听（确保5432启动）：</li>
</ol>
<pre><code class="hljs language-bash" lang="bash">ss -ltnp | grep 5432
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5d1292c3b05b446abe5f24c2618cf5c5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764316288&amp;x-signature=BO9LonoomfacGb%2B2REB4a194Gw8%3D" alt="image.png" loading="lazy"/></p>
<ol start="5">
<li>云服务器安全组/防火墙：</li>
</ol>
<ul>
<li>在云控制台开放<code>TCP 5432</code>入站规则到您的开发机IP段。</li>
<li>若之前在入门篇中关闭了<code>firewalld</code>，通常无需额外开放系统防火墙，但仍需确认云安全组规则。</li>
</ul>
<p>完成以上准备后，回到 DBeaver 测试连接即可。</p>
<h3 data-id="heading-9">3.6连接参数示例</h3>
<p>若您按入门篇极简版安装并设置了示例密码<code>Gauss@123456</code>，可参考如下参数：</p>
<pre><code class="hljs language-text" lang="text">主机：&lt;您的服务器公网IP&gt;
端口：5432
数据库：postgres
用户：omm
密码：Gauss@123456
</code></pre>
<h3 data-id="heading-10">3.7使用 openGauss JDBC 驱动（可选方案）</h3>
<p>当内置PostgreSQL驱动在您的openGauss版本上出现兼容性问题时，可按官方指南添加openGauss JDBC驱动：[0]</p>
<ol>
<li>菜单 <code>Database -&gt; Driver Manager</code>，点击“New”。</li>
<li>添加JDBC驱动文件（从openGauss官网获取JDBC驱动Jar）。</li>
<li>选择JDBC Driver类：<code>org.postgresql.Driver</code>。</li>
<li>设置URL模板：<code>jdbc:postgresql://{host}:{port}/{database}</code>，并勾选“Embed”。[0]</li>
<li>保存驱动后，在“新建连接”时选择该自定义驱动，按前述参数填写并测试连接。</li>
<li>如数据库仅能通过SSH访问，可在连接属性中配置 <code>SSH Tunnel</code>（Connection settings -&gt; SSH）。</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c7270a1a322f4783ac0a2b1ed4b10a8a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764316288&amp;x-signature=xWscr9Q1O5OdFRZPV9zBGhQ82j4%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-11">四、使用DBeaver进行数据库实战</h2>
<p>现在，让我们通过几个实际场景，体验DBeaver带来的便捷。</p>
<h3 data-id="heading-12">4.1 可视化数据查询与编辑</h3>
<p>在上一篇文章中，我们创建了一个<code>test</code>表。现在，我们可以在DBeaver中轻松地对它进行操作。</p>
<ol>
<li>在对象浏览器中，依次展开连接 -&gt; <code>Schemas -&gt; public -&gt; Tables</code>，找到<code>test</code>表。</li>
<li>右键点击<code>test</code>表，选择“View Data”。DBeaver会执行查询并在新的数据编辑器标签页中以表格形式展示数据。</li>
<li>您可以直接在结果表格中修改数据，然后点击工具栏上的“Save”按钮，DBeaver会自动生成对应的<code>UPDATE</code>语句并执行。</li>
<li>同样，也可以通过工具栏按钮插入或删除行。
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/53c4c07b10a64b339b3f181890c8cf72~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764316288&amp;x-signature=PaiqUsek1WOCI1adz8kbmfrvkKU%3D" alt="image.png" loading="lazy"/></li>
</ol>
<h3 data-id="heading-13">4.2 编写和执行复杂SQL</h3>
<p>DBeaver的SQL编辑器是其核心功能之一。让我们来尝试一个稍复杂的查询。[0]</p>
<p>假设我们需要分析一个“订单”表（<code>orders</code>）和一个“用户”表（<code>users</code>），找出消费总额最高的前10位用户。</p>
<p>首先，我们创建并填充一些示例数据。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 创建用户表</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> users (
    user_id <span class="hljs-type">INT</span> <span class="hljs-keyword">PRIMARY</span> KEY,
    user_name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>)
);

<span class="hljs-comment">-- 创建订单表</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> orders (
    order_id <span class="hljs-type">INT</span> <span class="hljs-keyword">PRIMARY</span> KEY,
    user_id <span class="hljs-type">INT</span>,
    order_amount <span class="hljs-type">DECIMAL</span>(<span class="hljs-number">10</span>, <span class="hljs-number">2</span>),
    order_date <span class="hljs-type">DATE</span>
);

<span class="hljs-comment">-- 插入示例数据</span>
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> users <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">1</span>, <span class="hljs-string">'Alice'</span>), (<span class="hljs-number">2</span>, <span class="hljs-string">'Bob'</span>), (<span class="hljs-number">3</span>, <span class="hljs-string">'Charlie'</span>);
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> orders <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">101</span>, <span class="hljs-number">1</span>, <span class="hljs-number">150.00</span>, <span class="hljs-string">'2023-10-01'</span>), (<span class="hljs-number">102</span>, <span class="hljs-number">2</span>, <span class="hljs-number">200.50</span>, <span class="hljs-string">'2023-10-02'</span>), (<span class="hljs-number">103</span>, <span class="hljs-number">1</span>, <span class="hljs-number">75.25</span>, <span class="hljs-string">'2023-10-03'</span>);
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4d20e2973a6743ffa73d04bec0338f44~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764316288&amp;x-signature=y%2BeEloNZtGd59ngXQI6yLECvKuo%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1d330175f5a94591826e3d795d0485b3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764316288&amp;x-signature=ZeRJsjx5cd07bj50vQuZGAx1Ntg%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e896efdf80ea4f1e95c41fb5a7be3f3b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764316288&amp;x-signature=WfqsrbzZ%2Bt2A%2BQsbDS8VJIawshs%3D" alt="image.png" loading="lazy"/></p>
<p>现在，我们可以在SQL编辑器中编写<code>JOIN</code>和<code>GROUP BY</code>查询。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> 
    u.user_name,
    <span class="hljs-built_in">SUM</span>(o.order_amount) <span class="hljs-keyword">AS</span> total_spent
<span class="hljs-keyword">FROM</span> 
    users u
<span class="hljs-keyword">JOIN</span> 
    orders o <span class="hljs-keyword">ON</span> u.user_id <span class="hljs-operator">=</span> o.user_id
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> 
    u.user_name
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> 
    total_spent <span class="hljs-keyword">DESC</span>
LIMIT <span class="hljs-number">10</span>;
</code></pre>
<p>在编写过程中，你会体验到DBeaver的代码补全与格式化功能。按下<code>Ctrl+Enter</code>或点击编辑器工具栏的“Execute”按钮，查询结果会立即显示在下方的结果面板。也可按<code>F3</code>打开或切换到SQL编辑器。</p>
<h3 data-id="heading-14">4.3 验证基础特性：事务处理</h3>
<p>数据库的事务特性（ACID）是保证数据一致性的基石。我们可以通过DBeaver来直观地验证openGauss的事务处理能力。</p>
<p>在DBeaver中关闭自动提交、并打开两个独立会话的SQL编辑器，模拟并发事务场景。</p>
<p>准备：在SQL编辑器工具栏取消勾选“Auto-commit”，确保使用显式事务；并在同一连接上通过“Open New SQL Console”打开两个控制台，或复制连接以获得两个独立会话。</p>
<p><strong>窗口1：</strong></p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 开始一个事务</span>
<span class="hljs-keyword">START</span> TRANSACTION;

<span class="hljs-comment">-- 更新Alice的用户名</span>
<span class="hljs-keyword">UPDATE</span> users <span class="hljs-keyword">SET</span> user_name <span class="hljs-operator">=</span> <span class="hljs-string">'Alice_new'</span> <span class="hljs-keyword">WHERE</span> user_id <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;

<span class="hljs-comment">-- 在本事务中查询，可以看到修改后的结果</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> user_id <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;
</code></pre>
<p><strong>窗口2：</strong></p>
<p>在窗口1执行<code>UPDATE</code>后，但在执行<code>COMMIT</code>或<code>ROLLBACK</code>之前，在窗口2中执行查询。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 在另一个会话中查询，由于事务未提交，看到的是旧数据</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> user_id <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;
</code></pre>
<p>您会发现，窗口2查询到的仍然是<code>Alice</code>，而不是<code>Alice_new</code>。这体现了事务的隔离性。</p>
<p>现在，回到<strong>窗口1</strong>，在编辑器工具栏点击“Commit”或执行：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 提交事务</span>
<span class="hljs-keyword">COMMIT</span>;
</code></pre>
<p>再次在<strong>窗口2</strong>中执行查询，您会看到用户名已经变成了<code>Alice_new</code>。若需回滚，可点击“Rollback”。</p>
<h3 data-id="heading-15">4.4 常见远程连接失败排查</h3>
<ul>
<li>确认数据库已启动：</li>
</ul>
<pre><code class="hljs language-bash" lang="bash">gs_ctl status -D /opt/opengauss/data/single_node
</code></pre>
<ul>
<li>端口未监听：检查<code>postgresql.conf</code>的<code>listen_addresses</code>是否为<code>'*'</code>；重新启动后用<code>ss -ltnp | grep 5432</code>确认。</li>
<li>认证失败：检查<code>pg_hba.conf</code>是否有匹配的<code>host</code>规则，认证方式为<code>md5</code>；密码是否正确。</li>
<li>外网不可达：检查云安全组入站规则是否开放<code>5432</code>到您的本地IP范围。</li>
</ul>
<h3 data-id="heading-16">4.5 常见客户端驱动问题排查（DBeaver）</h3>
<ul>
<li>报错 <code>javax.xml.bind.DatatypeConverter</code> 类型转换错误：
<ul>
<li>现象：执行连接或查询时抛出<code>javax.xml.bind</code>相关异常。</li>
<li>解决：在添加JDBC驱动Jar时额外加入<code>jaxb-api</code>包（例如<code>javax.xml.bind:jaxb-api:2.2.2</code>）。</li>
</ul>
</li>
<li>报错 <code>No suitable driver found for jdbc:postgresql://...</code>：
<ul>
<li>现象：测试连接失败，提示未找到合适的驱动。</li>
<li>解决：在自定义驱动中不要勾选“Use legacy JDBC instantiation”；确认已选择正确的Driver类与URL模板。</li>
</ul>
</li>
</ul>
<h2 data-id="heading-17">五、openGauss 安全性与优势补充（基于本次实战）</h2>
<p>openGauss 在安全性上秉承“安全缺省（secure-by-default）”的设计理念，本次连接排查过程中触达的多项机制正体现了这种优势。以下结合实战现象，归纳其关键安全特性与使用建议。</p>
<ul>
<li>安全默认策略（防止弱配置被远程利用）
<ul>
<li>初始用户远程登录禁止：当使用安装时的初始超级用户（如 <code>omm</code>）从远程登录时，服务器会直接拒绝，报错类似于 <code>FATAL: Forbid remote connection with initial user.</code>。这能有效降低默认高权限账户被远程暴力尝试或泄露后的风险。建议在服务器本机使用初始用户进行运维，并为业务创建独立账户用于远程访问：</li>
</ul>
</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/26b72b535e17454298e19d3f481210db~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764316288&amp;x-signature=E%2FMNubR%2BQyLG0N3Sdhkj4jUjlUs%3D" alt="d76ea1e97709d50f602bc02a8d55cf15.png" loading="lazy"/></p>
<pre><code class="hljs language-sql" lang="sql">```<span class="hljs-keyword">sql</span>
<span class="hljs-comment">-- 在服务器本机以初始用户登录后创建业务账户</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">USER</span> dbuser <span class="hljs-keyword">WITH</span> PASSWORD <span class="hljs-string">'S@fePwd_2025'</span>;
<span class="hljs-comment">-- 仅在确有需要时再授予更高权限</span>
<span class="hljs-comment">-- ALTER USER dbuser SYSADMIN;</span>
```
</code></pre>
<ul>
<li>
<p>远程 trust 认证禁止：远程连接命中 <code>trust</code> 规则时会被明确拒绝，常见报错为 <code>FATAL: Forbid remote connection with trust method!</code>。这迫使远程访问必须进行口令或更强认证，减少误用与错配带来的潜在风险。
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/711ff28a45da4f41bdb2162534ca4a93~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764316288&amp;x-signature=api%2FjA%2Bon9PCEsExH6nAaYWj6CI%3D" alt="f756de60b788ba641b22edca86dcb57c.png" loading="lazy"/></p>
</li>
<li>
<p>细粒度访问控制（可按网段/IP 精准授权）</p>
<ul>
<li>通过 <code>pg_hba.conf</code> 对不同来源、用户、数据库设定认证方式，规则按“自上而下”匹配，靠前规则优先。推荐为远程访问使用 <code>sha256</code> 或至少 <code>md5</code>，并按需收敛到具体 IP 段：
# IPv4 与 IPv6 的远程访问示例（建议收敛网段）
host  all  all  0.0.0.0/0    sha256
host  all  all  ::0/0        sha256
# 仅允许某公网 IP 的更严格示例
host  all  all  218.12.13.160/32  sha256</li>
<li>远程 <code>trust</code> 不应启用；本机访问可以保留 <code>local/127.0.0.1/::1</code> 的 <code>trust</code> 以便便捷运维。</li>
</ul>
</li>
<li>
<p>强口令与加密策略（与认证方式协同）</p>
<ul>
<li>支持设置 <code>password_encryption_type=2</code>（SHA-256）。当切换加密策略后，需要为相关用户“重置密码”，以新的策略生成密文；否则可能出现认证失败或握手异常（例如客户端报 <code>EOF Exception</code>）。</li>
<li>与 <code>pg_hba.conf</code> 规则保持一致：若采用 <code>sha256</code>，远程规则也应为 <code>sha256</code>，避免命中 <code>md5</code> 或其他不一致导致的失败。</li>
</ul>
</li>
<li>
<p>网络与 SSL 行为（避免握手错配）</p>
<ul>
<li><code>listen_addresses='*'</code> 或指定监听 IP，确保对外服务可达；</li>
<li>若服务器 <code>ssl=off</code>，客户端需使用 <code>sslmode=disable</code>；若服务器启用 SSL，则在客户端改为 <code>sslmode=require</code> 并正确配置证书。以 DBeaver 为例，也可在 JDBC URL 里直接带参数：
jdbc:opengauss://:5432/?sslmode=disable&amp;preferQueryMode=simple</li>
</ul>
</li>
<li>
<p>可观测性与热加载（降低维护成本）</p>
<ul>
<li>日志会明确记录拒绝原因，如 <code>no pg_hba.conf entry</code>、<code>password authentication failed</code>、<code>Forbid remote connection with initial user</code> 等，便于快速定位；</li>
<li>通过 <code>gs_ctl reload</code> 可在不重启的情况下加载 <code>pg_hba.conf/postgresql.conf</code> 的部分变更，提升运维效率。</li>
</ul>
</li>
<li>
<p>生态兼容优势（客户端与驱动）</p>
<ul>
<li>兼容 PostgreSQL 生态，DBeaver 等主流客户端可稳定使用；</li>
<li>使用 openGauss JDBC 驱动或内置 PostgreSQL 驱动，配合属性如 <code>preferQueryMode=simple</code>、<code>BCmptMode=true</code>，可在多版本场景下获得更好的兼容体验。</li>
</ul>
</li>
</ul>
<p>小结：openGauss 的安全默认策略与可配置认证机制，使其在对外服务时具备更高的安全基线，同时保留足够的灵活性供运维人员按需收敛授权范围与加密策略。这些特性在企业生产环境中能有效降低误配置风险并提升合规性。</p>
<h2 data-id="heading-18">六、总结与展望</h2>
<p>通过本文的介绍，您应该已经掌握了如何使用DBeaver来高效地管理和开发openGauss数据库。DBeaver将繁琐的命令行操作简化为直观的图形化点击，无论是数据查询、SQL开发还是特性验证，都变得更加轻松。</p>
<p>然而，对于应用开发者而言，更关心的是如何在代码中与数据库进行交互。在下一篇，也是本系列的最后一篇文章中，我们将以Python语言为例，深入探讨如何通过编程方式连接openGauss，并结合“用户管理系统”和“订单支付流程”等具体业务场景，编写包含CRUD（增删改查）和事务处理的完整代码示例，敬请期待！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[约课小程序增加候补功能]]></title>    <link>https://juejin.cn/post/7574803558878281743</link>    <guid>https://juejin.cn/post/7574803558878281743</guid>    <pubDate>2025-11-21T08:47:00.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574803558878281743" data-draft-id="7571156741396938767" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="约课小程序增加候补功能"/> <meta itemprop="keywords" content="前端,小程序·云开发,微信小程序"/> <meta itemprop="datePublished" content="2025-11-21T08:47:00.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="gongzemin"/> <meta itemprop="url" content="https://juejin.cn/user/3931509311681192"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            约课小程序增加候补功能
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3931509311681192/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    gongzemin
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T08:47:00.000Z" title="Fri Nov 21 2025 08:47:00 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body cache result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>先前写了一个<a href="https://juejin.cn/post/7469648317317038115" target="_blank" title="https://juejin.cn/post/7469648317317038115">约课小程序</a>，最近想增加候补功能。举个例子，课程容量20人，预约满了后，用户可以选择候补，加入候补队列。一旦有人取消预约，系统将自动按候补顺序递补名额。</p>
<p>我们先梳理下候补要修改的逻辑</p>






























<table><thead><tr><th>功能模块</th><th>详细说明</th><th>关键点</th></tr></thead><tbody><tr><td>✅ 按钮状态智能判断</td><td>根据课程状态和用户预约情况动态显示按钮</td><td><strong>预约</strong>：课程未满员<br/><strong>候补</strong>：课程已满员（确认预约 &gt;= 容量）<br/><strong>取消预约</strong>：用户已正式预约<br/><strong>取消候补(第X位)</strong>：用户在候补列表中</td></tr><tr><td>✅ 候补队列管理</td><td>完整的候补排队机制</td><td>按预约时间顺序自动排队<br/>显示候补位置（第1位、第2位...）<br/>候补用户不消耗次数</td></tr><tr><td>✅ 自动提升机制</td><td>候补自动转正式预约流程</td><td>有人取消正式预约时触发<br/>候补第一位自动转为确认预约<br/>自动扣除该用户的次数<br/>其他候补用户位置自动前移</td></tr><tr><td>✅ 数据结构变更</td><td>reservations 表添加新字段</td><td><code>status</code>: "confirmed" | "waitlist"（预约状态）<br/><code>waitlist_position</code>: Number（候补位置，仅候补时有值）</td></tr></tbody></table>
<p>我们想要的效果，如果课程预约已满，那么就显示候补按钮；如果已经成功候补，那么就显示候补中，并且告知用户候补排名</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4c846c76a34f43ebbebc848e226663d1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZ29uZ3plbWlu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764319619&amp;x-signature=l%2FjeS%2FMpZYNgQEnr0Vt7E22gP%2Fg%3D" alt="image.png" loading="lazy"/></p>
<p>我们主要分为以下几部分</p>
<ul>
<li>修改用户预约表: 新增预约状态、候补位置字段</li>
<li>修改后端: 预约/取消预约逻辑; 新增/取消候补 候补位置</li>
<li>修改前端: 显示候补、已候补按钮 候补排名</li>
</ul>
<h5 data-id="heading-0">修改用户预约表: 新增预约状态、候补位置字段</h5>
<p>这是我们的<code>user-reserve</code>表结构，user-reserve.schema.json文件，我们需要增加2个字段<code>status</code>, <code> waitlist_position</code></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"bsonType"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"object"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"required"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"permission"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"read"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"create"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"update"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"delete"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"properties"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ID，系统自动生成"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    ...
    <span class="hljs-attr">"status"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"bsonType"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"string"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"预约状态"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"预约状态：confirmed(已确认) / waitlist(候补)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"enum"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"confirmed"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"waitlist"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"defaultValues"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"confirmed"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"waitlist_position"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"bsonType"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"int"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"候补位置"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"如果是候补状态，记录候补顺序位置"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h5 data-id="heading-1">后端预约的逻辑</h5>
<ul>
<li><strong>查询预约那节课的可容纳人数</strong>：  因为我们现在要判断用户是否需要候补，我们需要获取课程的<code>capacity</code>，每节课的可容纳人数，去查询<code>class-schedule</code>表，如下面代码，我们查询后获取capacity字段</li>
</ul>

<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">classInfo</span> = await db
        .collection("class-schedule")
        .doc(queryClassId)
        .get()<span class="hljs-comment">;</span>
if (!classInfo.data.length) {
    return {
      code: 404,
      message: "未找到课程信息",
    }<span class="hljs-comment">;</span>
}
uniCloud.logger.info("classInfo", classInfo)<span class="hljs-comment">;</span>
const <span class="hljs-attr">classData</span> = classInfo.data[<span class="hljs-number">0</span>]<span class="hljs-comment">;</span>
const <span class="hljs-attr">classCapacity</span> = classData.capacity || <span class="hljs-number">10</span><span class="hljs-comment">;</span>
uniCloud.logger.info("params", queryClassId, clickDate)<span class="hljs-comment">;</span>
</code></pre>
<ul>
<li><strong>查询预约那节课的已预约人数</strong>： 我们查询<code>user-reserve</code>用户预约表，因为我们的课表是每周周而复始的，不同星期同一时间段的课表ID是一样的，所以我们查询的时候，要加上日期（上课的那天），这样就查不出历史上课数据了，免得受历史数据影响，而且我们设置了查询上课那天的一整天，这样也不会漏数据了</li>
</ul>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 传给bookCourse方法的参数</span>
<span class="hljs-keyword">const</span> { userId, avatar, queryClassId, clickDate, cardId, cardType } =
  params;
<span class="hljs-keyword">const</span> db = uniCloud.<span class="hljs-title function_">database</span>();
<span class="hljs-keyword">const</span> _ = db.<span class="hljs-property">command</span>;
<span class="hljs-comment">// 获取当天的起始时间 clickDate就是上课那天（预约时候点击日历对应的那天）</span>
<span class="hljs-keyword">const</span> startOfDay = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(clickDate);
startOfDay.<span class="hljs-title function_">setHours</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>); <span class="hljs-comment">// 设置为当天 00:00:00.000</span>

<span class="hljs-comment">// 获取当天的结束时间</span>
<span class="hljs-keyword">const</span> endOfDay = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(clickDate);
endOfDay.<span class="hljs-title function_">setHours</span>(<span class="hljs-number">23</span>, <span class="hljs-number">59</span>, <span class="hljs-number">59</span>, <span class="hljs-number">999</span>); <span class="hljs-comment">// 设置为当天 23:59:59.999</span>
<span class="hljs-keyword">const</span> confirmedCount = (
    <span class="hljs-keyword">await</span> db
      .<span class="hljs-title function_">collection</span>(<span class="hljs-string">"user-reserve"</span>)
      .<span class="hljs-title function_">where</span>({
        <span class="hljs-attr">class_id</span>: queryClassId,
        <span class="hljs-attr">reserve_class_date</span>: _.<span class="hljs-title function_">gte</span>(startOfDay).<span class="hljs-title function_">and</span>(db.<span class="hljs-property">command</span>.<span class="hljs-title function_">lte</span>(endOfDay)),
        <span class="hljs-attr">canceled</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-attr">status</span>: <span class="hljs-string">"confirmed"</span>,
      })
      .<span class="hljs-title function_">count</span>()
  ).<span class="hljs-property">total</span>;
</code></pre>
<ul>
<li><strong>查询用户是否已预约</strong>： 可能先前取消过，再次预约，数据库里还存有预约记录；如果先前没取消，前端逻辑没问题的话，那显示的就是取消预约、取消候补，就不会走这个逻辑</li>
</ul>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 3. 检查用户是否已有预约</span>
<span class="hljs-keyword">const</span> existingReservation = <span class="hljs-keyword">await</span> db
.<span class="hljs-title function_">collection</span>(<span class="hljs-string">"user-reserve"</span>)
.<span class="hljs-title function_">where</span>({
  <span class="hljs-attr">user_id</span>: userId,
  <span class="hljs-attr">class_id</span>: queryClassId,
  <span class="hljs-attr">reserve_class_date</span>: _.<span class="hljs-title function_">gte</span>(startOfDay).<span class="hljs-title function_">and</span>(db.<span class="hljs-property">command</span>.<span class="hljs-title function_">lte</span>(endOfDay)), <span class="hljs-comment">// 筛选上课日期今天及以后的 同一个日期不存在相同课程ID的课 不然过去预约了 现在就无法预约</span>
})
.<span class="hljs-title function_">get</span>();
</code></pre>
<ul>
<li><strong>查询用户是否已预约</strong>：如果用户先前预约过，我们先判断是不是需要候补，如果需要候补，我们还要计算候补排名；如果不需要候补，就是成功预约，我们用.update()更新那条用户数据，如果是次卡，我们要减去1次</li>
</ul>

<pre><code class="hljs language-ini" lang="ini"> if (existingReservation.data.length &gt; 0) {
    const <span class="hljs-attr">reservation</span> = existingReservation.data[<span class="hljs-number">0</span>]<span class="hljs-comment">;</span>
    if (!reservation.canceled) {
      return {
        code: 400,
        message: "该课程已预约，无需重复预约",
      }<span class="hljs-comment">;</span>
    }

    // 曾取消过 → 恢复预约
    const <span class="hljs-attr">newStatus</span> =
      confirmedCount &lt; classCapacity ? "confirmed" : "waitlist"<span class="hljs-comment">;</span>

    // 如果是候补状态,需要计算候补位置
    let <span class="hljs-attr">updateData</span> = {
      canceled: false,
      reserve_class_date: clickDate,
      reserve_time: Date.now(),
      status: newStatus,
    }<span class="hljs-comment">;</span>

    if (<span class="hljs-attr">newStatus</span> === <span class="hljs-string">"waitlist"</span>) {
      // 获取当前候补队列人数
      const <span class="hljs-attr">waitlistCount</span> = (
        await db
          .collection("user-reserve")
          .where({
            class_id: queryClassId,
            reserve_class_date: _.gte(startOfDay).and(
              db.command.lte(endOfDay)
            ),
            status: "waitlist",
            canceled: false,
          })
          .count()
      ).total<span class="hljs-comment">;</span>

      <span class="hljs-attr">updateData.waitlist_position</span> = waitlistCount + <span class="hljs-number">1</span><span class="hljs-comment">;</span>
    } else {
      // 如果是确认状态,清空候补位置
      <span class="hljs-attr">updateData.waitlist_position</span> = null<span class="hljs-comment">;</span>
    }

    await db
      .collection("user-reserve")
      .doc(reservation._id)
      .update(updateData)<span class="hljs-comment">;</span>

    uniCloud.logger.info(
      "恢复预约状态",
      newStatus,
      updateData.waitlist_position
    )<span class="hljs-comment">;</span>

    // 扣减次卡(仅确认状态)
    if (<span class="hljs-attr">cardType</span> === <span class="hljs-string">"sessionCard"</span> &amp;&amp; newStatus === <span class="hljs-string">"confirmed"</span>) {
      await db
        .collection("user-membership-card")
        .doc(cardId)
        .update({
          remainingSessions: _.inc(-1),
        })<span class="hljs-comment">;</span>
    }

    return {
      code: 200,
      message:
        <span class="hljs-attr">newStatus</span> === <span class="hljs-string">"confirmed"</span> ? <span class="hljs-string">"预约成功"</span> : <span class="hljs-string">"课程已满,已进入候补名单"</span>,
      status: newStatus,
      waitlist_position: updateData.waitlist_position, // 返回候补位置信息
    }<span class="hljs-comment">;</span>
  }
</code></pre>
<p>如果用户先前没有预约过，那就是新预约；我们同样先判断是不是要候补，候补计算候补排名，如果不是候补，成功预约，更新次卡</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 4. 新预约</span>
<span class="hljs-keyword">let</span> newReservationData = {
    <span class="hljs-attr">user_id</span>: userId,
    <span class="hljs-attr">class_id</span>: queryClassId,
    <span class="hljs-attr">reserve_class_date</span>: clickDate,
    <span class="hljs-attr">reserve_time</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>(),
    <span class="hljs-attr">canceled</span>: <span class="hljs-literal">false</span>,
};

<span class="hljs-keyword">if</span> (confirmedCount &gt;= classCapacity) {
    <span class="hljs-keyword">const</span> waitlistCount = (
      <span class="hljs-keyword">await</span> db
        .<span class="hljs-title function_">collection</span>(<span class="hljs-string">"user-reserve"</span>)
        .<span class="hljs-title function_">where</span>({
          <span class="hljs-attr">class_id</span>: queryClassId,
          <span class="hljs-attr">reserve_class_date</span>: _.<span class="hljs-title function_">gte</span>(startOfDay).<span class="hljs-title function_">and</span>(
            db.<span class="hljs-property">command</span>.<span class="hljs-title function_">lte</span>(endOfDay)
          ),
          <span class="hljs-attr">status</span>: <span class="hljs-string">"waitlist"</span>,
        })
        .<span class="hljs-title function_">count</span>()
    ).<span class="hljs-property">total</span>;
    uniCloud.<span class="hljs-property">logger</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"waitlistCount"</span>, waitlistCount);

    newReservationData.<span class="hljs-property">status</span> = <span class="hljs-string">"waitlist"</span>;
    newReservationData.<span class="hljs-property">waitlist_position</span> = waitlistCount + <span class="hljs-number">1</span>;
} <span class="hljs-keyword">else</span> {
    newReservationData.<span class="hljs-property">status</span> = <span class="hljs-string">"confirmed"</span>;
    newReservationData.<span class="hljs-property">waitlist_position</span> = <span class="hljs-literal">null</span>;
}

<span class="hljs-keyword">const</span> addRes = <span class="hljs-keyword">await</span> db
.<span class="hljs-title function_">collection</span>(<span class="hljs-string">"user-reserve"</span>)
.<span class="hljs-title function_">add</span>(newReservationData);

<span class="hljs-comment">// 5. 扣减次卡</span>
<span class="hljs-keyword">if</span> (
cardType === <span class="hljs-string">"sessionCard"</span> &amp;&amp;
newReservationData.<span class="hljs-property">status</span> === <span class="hljs-string">"confirmed"</span>
) {
<span class="hljs-keyword">await</span> db
  .<span class="hljs-title function_">collection</span>(<span class="hljs-string">"user-membership-card"</span>)
  .<span class="hljs-title function_">doc</span>(cardId)
  .<span class="hljs-title function_">update</span>({
    <span class="hljs-attr">remainingSessions</span>: _.<span class="hljs-title function_">inc</span>(-<span class="hljs-number">1</span>),
  });
}
</code></pre>
<blockquote>
<p>上面就是预约的逻辑，判断预约/候补, 逻辑好像有点冗余；因为用户点击按钮的时候，那个按钮就有文字预约/候补，直接做为参数传过来就行</p>
</blockquote>
<p>我们这样相当于双保险，以防前端判断逻辑出现问题，我们后端也能校验，确保预约/候补 逻辑正确</p>
<h5 data-id="heading-2">前端按钮文案 预约/候补 取消预约/取消候补 判断</h5>
<p>我们先回顾下我们课表逻辑，</p>
<pre><code class="hljs language-bash" lang="bash">管理员创建课程模板（循环课表）
   ↓
每周复用这些模板
   ↓
用户预约时，我们有预约课程的具体日期
   ↓
通过 class_id + reserve_class_date 来唯一标识<span class="hljs-string">"某天的某节课"</span>
</code></pre>
<h6 data-id="heading-3">每天课表的渲染逻辑</h6>
<p>当用户点击某天的时候，我们知道某天对应是周几，我们查询课表<code>class-schedule</code>，根据对应的周几，就可以渲染出那天对应的排课安排</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> <span class="hljs-title function_">fetchCourses</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">if</span> (!loading) {
      loading = <span class="hljs-literal">true</span>;
      <span class="hljs-comment">// uni.showLoading({ title: "加载中...", mask: true });</span>
    }
    <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> db.<span class="hljs-title function_">collection</span>(<span class="hljs-string">"class-schedule"</span>).<span class="hljs-title function_">get</span>();
    <span class="hljs-keyword">if</span> (res.<span class="hljs-property">result</span>?.<span class="hljs-property">errCode</span> === <span class="hljs-number">0</span>) {
      courseList.<span class="hljs-property">value</span> = res.<span class="hljs-property">result</span>.<span class="hljs-property">data</span> || [];
    } <span class="hljs-keyword">else</span> {
      uni.<span class="hljs-title function_">showToast</span>({ <span class="hljs-attr">title</span>: <span class="hljs-string">"课程加载失败"</span>, <span class="hljs-attr">icon</span>: <span class="hljs-string">"none"</span> });
    }
  } <span class="hljs-keyword">catch</span> (error) {
    uni.<span class="hljs-title function_">showToast</span>({ <span class="hljs-attr">title</span>: <span class="hljs-string">"网络异常"</span>, <span class="hljs-attr">icon</span>: <span class="hljs-string">"none"</span> });
  } <span class="hljs-keyword">finally</span> {
    <span class="hljs-keyword">if</span> (loading) {
      loading = <span class="hljs-literal">false</span>;
      <span class="hljs-comment">// uni.hideLoading();</span>
    }
  }
};

<span class="hljs-comment">// 数据过滤：根据指定的星期过滤课程</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">filterCoursesByDay</span> = (<span class="hljs-params">day</span>) =&gt;
  courseList.<span class="hljs-property">value</span>.<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">course</span>) =&gt;</span> course.<span class="hljs-property">day</span> === day);
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/43daceebf5bb46ce90ea1874a72da2ff~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZ29uZ3plbWlu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764319619&amp;x-signature=sTTD26YAYNn%2FIEB6HpzYaT0ivXQ%3D" alt="image.png" loading="lazy"/></p>
<p>我们课表卡片上有显示，预约用户列表；我们用联合查询，查询用户预约表<code>user-reserve</code>, <code>user-reserve</code>表里面的<code>user_id</code>字段关联<code>users</code>表，这样用户预约的那条记录里就有用户的详细信息了，就是说可以获得预约用户的用户头像了</p>
<h6 data-id="heading-4">判断当前用户这节课是否已预约/已候补</h6>
<p>dayCourses.value是每一天的课程</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 筛选并格式化课程数据</span>
dayCourses.<span class="hljs-property">value</span> = <span class="hljs-title function_">filterCoursesByDay</span>(targetDay).<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> ({
    ...item,
    <span class="hljs-attr">time</span>: <span class="hljs-title function_">formatCourseTime</span>(item.<span class="hljs-property">startTime</span>, item.<span class="hljs-property">endTime</span>),
    <span class="hljs-attr">isReserved</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">reservedUsers</span>: [],
}));
</code></pre>
<p>每天的课程信息，我们循环处理每节课，根据<strong>课程ID和课程日期</strong>查询每节课的预约信息</p>
<p><strong>利用课程预约信息列表里用户ID是否和当前用户的ID一样，就可以判断当前用户是否已经预约/候补</strong></p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> course <span class="hljs-keyword">of</span> dayCourses.<span class="hljs-property">value</span>) {
    <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getReserveRecords</span>(course, props.<span class="hljs-property">clickDate</span>); <span class="hljs-comment">// 获取预约用户信息</span>
    <span class="hljs-keyword">if</span> (res.<span class="hljs-property">result</span>.<span class="hljs-property">errCode</span> === <span class="hljs-number">0</span>) {
      <span class="hljs-keyword">if</span> (res.<span class="hljs-property">result</span>.<span class="hljs-property">data</span>.<span class="hljs-property">length</span>) {
        <span class="hljs-keyword">const</span> reserveRecords = res.<span class="hljs-property">result</span>.<span class="hljs-property">data</span>;
        <span class="hljs-comment">// 保存预约记录（包括用户信息等）</span>
        course.<span class="hljs-property">reserveRecords</span> = reserveRecords;
        <span class="hljs-comment">// 因为是联合查询 所以这个user_id是一个数组</span>
        <span class="hljs-comment">// 判断当前用户这节课是否已预约</span>
        course.<span class="hljs-property">isReserved</span> = reserveRecords.<span class="hljs-title function_">some</span>(
          <span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span>
            item.<span class="hljs-property">user_id</span>?.[<span class="hljs-number">0</span>]?.<span class="hljs-property">_id</span> === storedUserInfo.<span class="hljs-property">value</span>.<span class="hljs-property">userId</span> &amp;&amp;
            item.<span class="hljs-property">status</span> === <span class="hljs-string">"confirmed"</span>
        );
        <span class="hljs-comment">// 判断当前用户这节课是否已候补</span>
        course.<span class="hljs-property">isWaited</span> = reserveRecords.<span class="hljs-title function_">some</span>(
          <span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span>
            item.<span class="hljs-property">user_id</span>?.[<span class="hljs-number">0</span>]?.<span class="hljs-property">_id</span> === storedUserInfo.<span class="hljs-property">value</span>.<span class="hljs-property">userId</span> &amp;&amp;
            item.<span class="hljs-property">status</span> === <span class="hljs-string">"waitlist"</span>
        );
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"course---"</span>, course);
      } <span class="hljs-keyword">else</span> {
        course.<span class="hljs-property">isReserved</span> = <span class="hljs-literal">false</span>;
        course.<span class="hljs-property">isWaited</span> = <span class="hljs-literal">false</span>;
        course.<span class="hljs-property">reservedUsers</span> = [];
      }
    }
}
</code></pre>
<p>下面这个方法作用： 精准查询某节课在指定日期的所有有效预约记录（包括候补），并把用户的头像，联表带出来，按预约时间倒序排列，获取预约/候补用户列表</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> <span class="hljs-title function_">getReserveRecords</span> = (<span class="hljs-params">course, targetDate</span>) =&gt; {
  <span class="hljs-comment">// 获取当天的起始时间</span>
  <span class="hljs-keyword">const</span> startOfDay = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(targetDate);
  startOfDay.<span class="hljs-title function_">setHours</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>); <span class="hljs-comment">// 设置为当天 00:00:00.000</span>

  <span class="hljs-comment">// 获取当天的结束时间</span>
  <span class="hljs-keyword">const</span> endOfDay = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(targetDate);
  endOfDay.<span class="hljs-title function_">setHours</span>(<span class="hljs-number">23</span>, <span class="hljs-number">59</span>, <span class="hljs-number">59</span>, <span class="hljs-number">999</span>); <span class="hljs-comment">// 设置为当天 23:59:59.999</span>

  <span class="hljs-keyword">let</span> reserveTemp = db
    .<span class="hljs-title function_">collection</span>(<span class="hljs-string">"user-reserve"</span>)
    .<span class="hljs-title function_">where</span>({
      <span class="hljs-attr">class_id</span>: course.<span class="hljs-property">_id</span>,
      <span class="hljs-attr">canceled</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// 增加canceled为false的条件</span>
      <span class="hljs-attr">reserve_class_date</span>: db.<span class="hljs-property">command</span>
        .<span class="hljs-title function_">gte</span>(startOfDay)
        .<span class="hljs-title function_">and</span>(db.<span class="hljs-property">command</span>.<span class="hljs-title function_">lte</span>(endOfDay)), <span class="hljs-comment">// 日期范围查询})</span>
    })
    .<span class="hljs-title function_">getTemp</span>();
  <span class="hljs-keyword">let</span> userTemp = db.<span class="hljs-title function_">collection</span>(<span class="hljs-string">"users"</span>).<span class="hljs-title function_">field</span>(<span class="hljs-string">"_id, avatar"</span>).<span class="hljs-title function_">getTemp</span>();

  <span class="hljs-comment">// 不能加 .limit(course.capacity) 因为还有候补的 不然导致用户预约了 不显示</span>
  <span class="hljs-keyword">return</span> db
    .<span class="hljs-title function_">collection</span>(reserveTemp, userTemp)
    .<span class="hljs-title function_">orderBy</span>(<span class="hljs-string">"reserve_time desc"</span>)
    .<span class="hljs-title function_">get</span>();
};
</code></pre>
<p>在我们的课程卡片组件，<code>course-card.vue</code>，我们要显示按钮文案，用户头像列表</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 计算确认预约的用户</span>
<span class="hljs-keyword">const</span> confirmedUsers = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">return</span> (
    props.<span class="hljs-property">courseInfo</span>.<span class="hljs-property">reserveRecords</span>?.<span class="hljs-title function_">filter</span>(
      <span class="hljs-function">(<span class="hljs-params">record</span>) =&gt;</span> record.<span class="hljs-property">status</span> === <span class="hljs-string">"confirmed"</span>
    ) || []
  );
});

<span class="hljs-comment">// 计算候补用户</span>
<span class="hljs-keyword">const</span> waitlistUsers = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">return</span> (
    props.<span class="hljs-property">courseInfo</span>.<span class="hljs-property">reserveRecords</span>?.<span class="hljs-title function_">filter</span>(
      <span class="hljs-function">(<span class="hljs-params">record</span>) =&gt;</span> record.<span class="hljs-property">status</span> === <span class="hljs-string">"waitlist"</span>
    ) || []
  );
});

<span class="hljs-comment">// 确认预约人数</span>
<span class="hljs-keyword">const</span> confirmedCount = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> confirmedUsers.<span class="hljs-property">value</span>.<span class="hljs-property">length</span>);

<span class="hljs-comment">// 候补人数</span>
<span class="hljs-keyword">const</span> waitlistCount = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> waitlistUsers.<span class="hljs-property">value</span>.<span class="hljs-property">length</span>);

<span class="hljs-comment">// 课程是否已满</span>
<span class="hljs-keyword">const</span> isFull = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">return</span> confirmedCount.<span class="hljs-property">value</span> &gt;= (props.<span class="hljs-property">courseInfo</span>?.<span class="hljs-property">capacity</span> || <span class="hljs-number">20</span>);
});

<span class="hljs-comment">// 当前用户的预约状态 confirmed waitlist</span>
<span class="hljs-keyword">const</span> userReservationStatus = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> currentUserReserve = props.<span class="hljs-property">courseInfo</span>.<span class="hljs-property">reserveRecords</span>?.<span class="hljs-title function_">find</span>(
    <span class="hljs-function">(<span class="hljs-params">record</span>) =&gt;</span> record.<span class="hljs-property">user_id</span>?.[<span class="hljs-number">0</span>]?.<span class="hljs-property">_id</span> === userInfo.<span class="hljs-property">userId</span>
  );
  <span class="hljs-keyword">return</span> currentUserReserve?.<span class="hljs-property">status</span> || <span class="hljs-literal">null</span>;
});
</code></pre>
<p>看下我们的课程卡片需要展示的信息，基本上都满足了
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/97617d5764bf4bdeaa7c08533021445e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZ29uZ3plbWlu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764319619&amp;x-signature=WdhIU3NSg8h4HR2FiGI3kudu%2FmQ%3D" alt="image.png" loading="lazy"/>
我们把按钮抽离出来了一个组件<code>card-reserve-button.vue</code>， 我们只需要一个view标签，来显示按钮的8种状态</p>
<pre><code class="hljs language-Vue" lang="Vue">&lt;template&gt;
  &lt;view class="reserve-btn" :class="buttonClass"&gt;
    {{ buttonText }}
  &lt;/view&gt;
&lt;/template&gt;
</code></pre>
<p>按钮的8种状态</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 按钮文本</span>
<span class="hljs-keyword">const</span> buttonText = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> textMap = {
    <span class="hljs-attr">courseCancelled</span>: <span class="hljs-string">"已取消"</span>,
    <span class="hljs-attr">userConfirmed</span>: <span class="hljs-string">"已预约"</span>,
    <span class="hljs-attr">userWaitlist</span>: <span class="hljs-string">"候补中"</span>,
    <span class="hljs-attr">ended</span>: <span class="hljs-string">"已结束"</span>,
    <span class="hljs-attr">ongoing</span>: <span class="hljs-string">"进行中"</span>,
    <span class="hljs-attr">waitlistAvailable</span>: <span class="hljs-string">"候补"</span>,
    <span class="hljs-attr">reserveAvailable</span>: <span class="hljs-string">"预约"</span>,
    <span class="hljs-attr">notOpenYet</span>: <span class="hljs-string">"暂未开放预约"</span>,
  };
  <span class="hljs-keyword">return</span> textMap[buttonStatus.<span class="hljs-property">value</span>] || <span class="hljs-string">"预约"</span>;
});
</code></pre>
<p>看下按钮文案显示的逻辑</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 当前用户的预约状态</span>
<span class="hljs-keyword">const</span> buttonStatus = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-comment">// 1. 优先判断是否已取消</span>
  <span class="hljs-keyword">if</span> (props.<span class="hljs-property">isCourseCancelled</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-string">"courseCancelled"</span>;
  }

  <span class="hljs-comment">// 2. 判断用户预约状态</span>
  <span class="hljs-keyword">if</span> (userReservationStatus.<span class="hljs-property">value</span> === <span class="hljs-string">"confirmed"</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-string">"userConfirmed"</span>;
  }
  <span class="hljs-keyword">if</span> (userReservationStatus.<span class="hljs-property">value</span> === <span class="hljs-string">"waitlist"</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-string">"userWaitlist"</span>;
  }

  <span class="hljs-comment">// 3. 判断时间状态</span>
  <span class="hljs-keyword">const</span> currentMinutes = now.<span class="hljs-property">value</span>.<span class="hljs-title function_">getHours</span>() * <span class="hljs-number">60</span> + now.<span class="hljs-property">value</span>.<span class="hljs-title function_">getMinutes</span>();
  <span class="hljs-keyword">const</span> diffDays = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(
    (props.<span class="hljs-property">clickDate</span>.<span class="hljs-title function_">getTime</span>() - today.<span class="hljs-property">value</span>.<span class="hljs-title function_">getTime</span>()) / (<span class="hljs-number">1000</span> * <span class="hljs-number">60</span> * <span class="hljs-number">60</span> * <span class="hljs-number">24</span>)
  );

  <span class="hljs-keyword">if</span> (diffDays &lt; <span class="hljs-number">0</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-string">"ended"</span>;
  }

  <span class="hljs-keyword">if</span> (diffDays === <span class="hljs-number">0</span>) {
    <span class="hljs-keyword">if</span> (currentMinutes &gt; endTime) {
      <span class="hljs-keyword">return</span> <span class="hljs-string">"ended"</span>;
    }
    <span class="hljs-keyword">if</span> (currentMinutes &gt;= startTime &amp;&amp; currentMinutes &lt;= endTime) {
      <span class="hljs-keyword">return</span> <span class="hljs-string">"ongoing"</span>;
    }
    <span class="hljs-keyword">return</span> isFull.<span class="hljs-property">value</span> ? <span class="hljs-string">"waitlistAvailable"</span> : <span class="hljs-string">"reserveAvailable"</span>;
  }

  <span class="hljs-keyword">if</span> (diffDays &gt; <span class="hljs-number">0</span> &amp;&amp; diffDays &lt;= <span class="hljs-number">2</span>) {
    <span class="hljs-keyword">if</span> (diffDays === <span class="hljs-number">2</span>) {
      <span class="hljs-keyword">if</span> (now.<span class="hljs-property">value</span> &gt;= today12PM.<span class="hljs-property">value</span>) {
        <span class="hljs-keyword">return</span> isFull.<span class="hljs-property">value</span> ? <span class="hljs-string">"waitlistAvailable"</span> : <span class="hljs-string">"reserveAvailable"</span>;
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"notOpenYet"</span>;
      }
    }
    <span class="hljs-keyword">return</span> isFull.<span class="hljs-property">value</span> ? <span class="hljs-string">"waitlistAvailable"</span> : <span class="hljs-string">"reserveAvailable"</span>;
  }

  <span class="hljs-keyword">return</span> <span class="hljs-string">"notOpenYet"</span>;
});
</code></pre>
<p>代码逻辑解释</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section">## 状态判断逻辑（按优先级）</span>

<span class="hljs-section">### 1. 课程状态检查（最高优先级）</span>
<span class="hljs-bullet">-</span> 课程被取消 → <span class="hljs-code">`courseCancelled`</span>

<span class="hljs-section">### 2. 用户预约状态检查</span>
<span class="hljs-bullet">-</span> 用户已确认预约 → <span class="hljs-code">`userConfirmed`</span>
<span class="hljs-bullet">-</span> 用户在候补名单 → <span class="hljs-code">`userWaitlist`</span>

<span class="hljs-section">### 3. 时间相对位置检查</span>
计算课程日期与今天的天数差 <span class="hljs-code">`diffDays = (课程日期 - 今天) / 天`</span>

<span class="hljs-section">### 4. 根据时间位置判断</span>

<span class="hljs-section">#### 4.1 过去的日期 (diffDays &lt; 0)</span>
→ <span class="hljs-code">`ended`</span>

<span class="hljs-section">#### 4.2 今天的课程 (diffDays = 0)</span>
<span class="hljs-bullet">-</span> 当前时间 &gt; 课程结束时间 → <span class="hljs-code">`ended`</span>
<span class="hljs-bullet">-</span> 课程开始时间 ≤ 当前时间 ≤ 课程结束时间 → <span class="hljs-code">`ongoing`</span>
<span class="hljs-bullet">-</span> 今天但还未开始 → 满员 ? <span class="hljs-code">`waitlistAvailable`</span> : <span class="hljs-code">`reserveAvailable`</span>

<span class="hljs-section">#### 4.3 明天的课程 (diffDays = 1)</span>
→ 满员 ? <span class="hljs-code">`waitlistAvailable`</span> : <span class="hljs-code">`reserveAvailable`</span>

<span class="hljs-section">#### 4.4 后天的课程 (diffDays = 2)</span>
<span class="hljs-bullet">-</span> 现在时间 ≥ 今天12:00 → 满员 ? <span class="hljs-code">`waitlistAvailable`</span> : <span class="hljs-code">`reserveAvailable`</span>
<span class="hljs-bullet">-</span> 现在时间 &lt; 今天12:00 → <span class="hljs-code">`notOpenYet`</span>

<span class="hljs-section">#### 4.5 三天后的课程 (diffDays &gt; 2)</span>
→ <span class="hljs-code">`notOpenYet`</span>
</code></pre>
<p>按钮状态说明</p>



























































<table><thead><tr><th>状态</th><th>说明</th><th>可点击</th><th>优先级</th></tr></thead><tbody><tr><td><code>courseCancelled</code></td><td>课程因人数不足被取消</td><td>(跳转详情)</td><td>1</td></tr><tr><td><code>userConfirmed</code></td><td>用户已确认预约</td><td>(跳转详情)</td><td>2</td></tr><tr><td><code>userWaitlist</code></td><td>用户在候补名单</td><td>(跳转详情)</td><td>2</td></tr><tr><td><code>ended</code></td><td>课程已结束</td><td>(跳转详情)</td><td>3</td></tr><tr><td><code>ongoing</code></td><td>课程正在进行中</td><td>(跳转详情)</td><td>3</td></tr><tr><td><code>waitlistAvailable</code></td><td>可以候补（满员）</td><td>✅ (预约)</td><td>4</td></tr><tr><td><code>reserveAvailable</code></td><td>可以预约（有名额）</td><td>✅ (预约)</td><td>4</td></tr><tr><td><code>notOpenYet</code></td><td>暂未开放预约</td><td>(跳转详情)</td><td>4</td></tr></tbody></table>
<p>课程卡片和课程详情页的按钮不一样，比如课程卡片如果显示<strong>已预约</strong>，那么课程详情页就要显示<strong>取消预约</strong>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ef4788bf81bf4387b60c065e299ccdfa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZ29uZ3plbWlu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764319619&amp;x-signature=XudwbU2kpmHqkkLkNoyx2cqVZzM%3D" alt="image.png" loading="lazy"/></p>
<p>如果有候补，要显示候补信息
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f53150b2ebda4ce69298904c00c8d3c0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZ29uZ3plbWlu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764319619&amp;x-signature=ClXxP0OSp77GbXPAegy%2FHChDqiA%3D" alt="image.png" loading="lazy"/></p>
<p>代码已经提交到waitlist分支，完整逻辑看<a title="" ref="nofollow noopener noreferrer" href="https://link.juejin.cn?target=">源码</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Spring Boot 4.0 正式发布，真学不动了！]]></title>    <link>https://juejin.cn/post/7574749664492781602</link>    <guid>https://juejin.cn/post/7574749664492781602</guid>    <pubDate>2025-11-21T08:49:08.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574749664492781602" data-draft-id="7574749664492765218" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Spring Boot 4.0 正式发布，真学不动了！"/> <meta itemprop="keywords" content="Java,Spring Boot"/> <meta itemprop="datePublished" content="2025-11-21T08:49:08.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="JavaGuide"/> <meta itemprop="url" content="https://juejin.cn/user/166781497383294"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Spring Boot 4.0 正式发布，真学不动了！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/166781497383294/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    JavaGuide
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T08:49:08.000Z" title="Fri Nov 21 2025 08:49:08 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>好家伙，就在昨晚，Spring Boot 团队悄悄地把 4.0.0 正式版发布了！这是 Spring Boot 真正意义上的新一代起点。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/23d80d4ad67248b6b0100dd423a5ab4f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YUd1aWRl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764319748&amp;x-signature=32ERRNleV0VuoWdq6SqktCwKV5Q%3D" alt="" loading="lazy"/></p>
<p>Spring Boot 4.0 基于 Spring Framework 7.0，带来了模块化更彻底的代码库、对 Java 25 的原生支持、全面拥抱 JSpecify 空安全体系、API 版本管理，以及一大波开发者期待已久的新特性。</p>
<p>话不多说，我们直击重点，看看这次更新到底有多香。概览：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/047377e438b84901a78c858ec14b8121~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YUd1aWRl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764319748&amp;x-signature=OD1GSkiyiUmRzoYnX79eBLwQfnc%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-0"><strong>新特性概览</strong></h2>
<h3 data-id="heading-1"><strong>HTTP Service Clients（终于来了！）</strong></h3>
<p>你是否已经厌倦了编写冗长的 <code>RestTemplate</code> 或 <code>WebClient</code> 样板代码？</p>
<p>现在，你再也不用手写 HTTP 调用的实现类了，直接写一个接口就行：</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-comment">// 只需定义一个接口，Spring Boot会自动为你创建实现</span>
<span class="hljs-variable">@HttpExchange</span>(url = <span class="hljs-string">"https://echo.zuplo.io"</span>)
public interface EchoService {

    <span class="hljs-variable">@PostExchange</span>
    Map&lt;?, ?&gt; <span class="hljs-built_in">echo</span>(<span class="hljs-variable">@RequestBody</span> Map&lt;String, String&gt; message);
}
</code></pre>
<p>Spring Boot 4.0 为其提供了完整的自动配置和属性支持。这意味着，<strong>后端服务间的调用，从此将变得像本地方法调用一样简洁、直观</strong>，极大地降低了微服务开发的复杂性。</p>
<h3 data-id="heading-2"><strong>原生 API 版本管理</strong></h3>
<p>API 版本管理是后端开发中一个棘手但又无法回避的问题。现在，Spring Boot 为 Spring MVC 和 WebFlux 提供了原生的 API 版本控制支持。</p>
<p>通过简单的 <code>spring.mvc.apiversion.*</code>或 <code>spring.webflux.apiversion.*</code> 属性配置，或注入自定义的 <code>ApiVersionResolver</code> 等 Bean，你就可以轻松地实现基于 URL 路径、请求头或参数的版本控制策略。</p>
<h3 data-id="heading-3"><strong>支持 Gradle 9</strong></h3>
<p>Spring Boot 4.0 支持使用 Gradle 9 构建 Spring Boot 应用程序，同时仍然支持 Gradle 8.x（8.14 或更高版本）。</p>
<h3 data-id="heading-4"><strong>全面拥抱 JSpecify 空安全体系</strong></h3>
<p>Spring Boot 4.0 全面拥抱 JSpecify 空安全体系，核心变化只有一句话：<strong>默认非空（<code>@NullMarked</code>）+ 明确标注可空（<code>@Nullable</code>）</strong>，让空指针从“运行时炸弹”变成“编译期报错”。</p>
<p>在类或包上加一个 <code>@NullMarked</code>，里面所有引用类型默认都是非空的，只有明确标了 <code>@Nullable</code> 的才可能为 null。这样：</p>
<ul>
<li>方法签名一目了然：返回值、参数到底会不会 null；</li>
<li>配合 NullAway 后，漏检查的地方直接编译失败；</li>
<li>零运行时开销，完全兼容现有代码；</li>
<li>比 Optional 更轻量、更适合做大规模重构。</li>
</ul>
<h3 data-id="heading-5"><strong>全面拥抱 Java 25</strong></h3>
<p>新版本正式提供对 Java 25 的顶级支持（LTS 版本 Java 17 依然兼容）。</p>
<p>当你在 <code>application.properties</code> 中开启虚拟线程 (<code>spring.threads.virtual.enabled=true</code>) 时，自动配置的 JDK HttpClient 将会默认使用虚拟线程，让你的 IO 密集型应用能够轻松获得巨大的性能提升。</p>
<h3 data-id="heading-6"><strong>依赖版本大跃进</strong></h3>
<p>Spring Boot 4.0 迎来了一次“全家桶”式的依赖升级：<strong>Spring Framework 7.0、Jackson 3.0、Hibernate 7.1、Tomcat 11、Jetty 12、Kafka 4.1、Kotlin 2.2.20</strong>……</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7ffa8abaa5bf4b6599d4d1d65fa5585e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YUd1aWRl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764319748&amp;x-signature=kp5H2OyxwdIM%2BriQSztyEuVTs0w%3D" alt="" loading="lazy"/></p>
<p>几乎所有核心和第三方组件都同步到了最新稳定版。这相当于给你的整个技术栈做了一次“集体换代”，带来了性能、安全性和新特性的全面提升。</p>
<h3 data-id="heading-7"><strong>Redis 静态主从支持</strong></h3>
<p>Lettuce 用户有福了！现在只需一行 <code>spring.data.redis.masterreplica.nodes</code> 配置，就能轻松搞定静态主从模式，不再强制依赖 Sentinel 或 Cluster。</p>
<p>这是我让 AI 总结的：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3c3abe68cd474fcc8d1b52f2e4e3334a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YUd1aWRl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764319748&amp;x-signature=wR7p1iZIQtxm9joInfTKbvSPRsQ%3D" alt="图片" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cb805bba7ce94fe183e3794daf400160~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YUd1aWRl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764319748&amp;x-signature=tua4MYhL9fQKSxQVyjqqtbAXMqQ%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-8"><strong>移除 Undertow</strong></h3>
<p>Spring Boot 4.0 完全移除了对 Undertow 的内嵌支持——不仅删掉了 <strong>spring-boot-starter-undertow</strong>，也不再提供任何 Undertow 相关的自动配置。移除的根本原因是：Spring Boot 4.0 基线升级到 Servlet 6.1（也就是说必须支持 Servlet 6.1 才能留在 starter 列表里），而截至 2025-10 官方发布说明时，Undertow 尚未兼容该版本。</p>
<p>这些新特性很多我都已经同步更新到了<a href="https://link.juejin.cn?target=https%3A%2F%2Fjavaguide.cn%2Fzhuanlan%2Fjava-mian-shi-zhi-bei.html" target="_blank" title="https://javaguide.cn/zhuanlan/java-mian-shi-zhi-bei.html" ref="nofollow noopener noreferrer">《Java 面试指北》</a>（后端面试指南）中，保证内容与时俱进！</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b913dca776604bad9cf8b5627fdc7007~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YUd1aWRl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764319748&amp;x-signature=0%2BctyfHh4YD%2FRnZNPZ8aVBkcE0M%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c7ee48d1f04a49c79e158954196a79c9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YUd1aWRl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764319748&amp;x-signature=rk8EItKyn4JOHHXlDyQwYX4fquc%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-9"><strong>升级建议</strong></h2>
<p>4.0 是大版本，升级比平时麻烦一点。官方的强烈建议是：如果你现在还在 3.3、3.4 甚至更老的版本 → 先升到 3.5 再升 4.0。这条路径能帮你少踩 90% 的坑，强烈建议别跳过！</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f599d3003de54ae6be883c8570f8bcdf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YUd1aWRl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764319748&amp;x-signature=LAY2EHToZj2%2BZPY0sWuh%2FcLjSpU%3D" alt="" loading="lazy"/></p>
<p>详细的迁移指南可以参考官方文档：<strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fspring-projects%2Fspring-boot%2Fwiki%2FSpring-Boot-4.0-Migration-Guide" target="_blank" title="https://github.com/spring-projects/spring-boot/wiki/Spring-Boot-4.0-Migration-Guide" ref="nofollow noopener noreferrer">github.com/spring-proj…</a></strong> 。</p>
<h2 data-id="heading-10"><strong>总结</strong></h2>
<p>Spring Boot 4.0.0 正式发布，基于 Spring Framework 7.0，全面支持 Java 25（含虚拟线程优化）。核心新特性包括：HTTP Service Clients 简化远程调用；原生 API 版本管理；全面采用 JSpecify 空安全体系（默认非空，编译期防 NPE）；关键依赖升级至 Jackson 3.0、Tomcat 11、Hibernate 7.1 等；支持 Gradle 9；Redis 静态主从配置；移除 Undertow。</p>
<p>如果要升级的话，建议先迁移到 3.5 版本再升级。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[开源项目|不一样的思维导图]]></title>    <link>https://juejin.cn/post/7574803558878314511</link>    <guid>https://juejin.cn/post/7574803558878314511</guid>    <pubDate>2025-11-21T08:54:25.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574803558878314511" data-draft-id="7574749664492814370" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="开源项目|不一样的思维导图"/> <meta itemprop="keywords" content="后端,人工智能"/> <meta itemprop="datePublished" content="2025-11-21T08:54:25.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="周末程序猿"/> <meta itemprop="url" content="https://juejin.cn/user/3245414056989757"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            开源项目|不一样的思维导图
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3245414056989757/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    周末程序猿
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T08:54:25.000Z" title="Fri Nov 21 2025 08:54:25 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>最近在参加公司的 <code>Agent</code> 比赛，尝试将一个想法用完整的 <code>Vibe Coding</code> 流程来实现，经过一些曲折，最后完成了，比传统Coding的效率的确提升了5倍左右，先介绍项目，最后再写开发总结。</p>
<h2 data-id="heading-0">1. 思维导图介绍</h2>
<p>体验地址： <a href="https://link.juejin.cn?target=https%3A%2F%2Fmind.su007.club%2F" target="_blank" title="https://mind.su007.club/" ref="nofollow noopener noreferrer">mind.su007.club/</a><br/>
项目github地址： <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Flinkxzhou%2FSimpleMind" target="_blank" title="https://github.com/linkxzhou/SimpleMind" ref="nofollow noopener noreferrer">github.com/linkxzhou/S…</a></p>
<h3 data-id="heading-1">1.1 功能介绍</h3>
<p>之前使用过市场上各种思维导图，虽然很多搭载了AI的功能，但是基本上都需要自己写提示词，其实使用思维导图往往是想整理思路，如果能将自己的思路再用提示词整理一遍，其实已经不需要思维导图了，所以开发脑图的目的是为了让使用者沉浸式思路，AI辅助续写。<br/>
基于以上思考，开发这块产品首先用户需要设置的东西要少，界面要简单，所以首页是这样的：</p>
<ul>
<li>PC浏览器上：</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aa96fc71647246a280b08e5840009f84~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZGo5pyr56iL5bqP54y_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764320064&amp;x-signature=swVY6qbyZ5TmA5R1AksVgRpB37k%3D" alt="图片" loading="lazy"/></p>
<ul>
<li>手机端：</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f5d2cab13f5d4d4d825db644bf79e117~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZGo5pyr56iL5bqP54y_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764320064&amp;x-signature=mI0NJiTTM%2FWDTjIYfR9r72QtD7s%3D" alt="图片" loading="lazy"/></p>
<p>为了减少用户对功能的焦虑，<code>toolbar</code> 只提供常用的功能：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e76578b3c59c46158346ef84eaf5f6f0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZGo5pyr56iL5bqP54y_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764320064&amp;x-signature=TJKR0CCzUfj%2BKRlUQ1cmm15NsYU%3D" alt="图片" loading="lazy"/></p>
<p>设置中的功能主要功能包括：</p>
<ul>
<li>AI的通用设置</li>
<li>布局：支持思维导图，逻辑结构图，组织结构图，目录组织图，时间轴，鱼骨图</li>
<li>生成节点数</li>
<li>私有知识库</li>
<li>导入JSON等</li>
<li>导出JSON，图片等</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d12ef35564d74a0fa25580f9136bb580~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZGo5pyr56iL5bqP54y_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764320064&amp;x-signature=4BooCDIOiCi97MYKx2b2jDRYywM%3D" alt="图片" loading="lazy"/></p>
<h3 data-id="heading-2">1.2 模版列表</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b010618f80184ae3943fea0b8d3a3a62~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZGo5pyr56iL5bqP54y_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764320064&amp;x-signature=lcqnaWuGA6J1PUmWC1MGLduaJpY%3D" alt="图片" loading="lazy"/></p>
<p>模版列表的目的是方便用户不需要关心提示词，比如读书笔记，在思维导图中是有一种通用的模式，充分利用大模型已有的知识，整理思考方式，当前功能后续会扩充更多的思考模版，目前支持：</p>
<ul>
<li>读书笔记</li>
<li>第一性原理分析问题</li>
</ul>
<h3 data-id="heading-3">1.3 提示词</h3>
<p>对于知识整理，提示词比较重要，为了大家方便复现生成，所以生成过程中会展示提示词，比如《如何制造火箭？》</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/91e721acd8fa482d9780417dda5873bf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZGo5pyr56iL5bqP54y_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764320064&amp;x-signature=l2Vb0O%2FSRWXK0IsYBLltYW9lzrI%3D" alt="图片" loading="lazy"/></p>
<h2 data-id="heading-4">2. 总结</h2>
<h3 data-id="heading-5">2.1 <code>Vibe Coding</code> 还是 <code>Spec Coding</code> 开发方式对比</h3>
<ul>
<li>Andrej Karpathy在2025年初提出的 "Vibe Coding" 概念，强调 "忘记代码存在，专注创意表达" 的开发模式，是一种直觉驱动的快速原型方法，通过自然语言与AI对话，以极高的速度将模糊想法转化为可运行代码。</li>
<li>"Spec Coding" 则是一种规范驱动的可控工程方法，强调在编码前通过结构化的文档明确需求和设计，再让AI在严格约束下生成代码。</li>
</ul>
<p>以上两种编程方式各有利弊，对于团队协作和需要长期维护的系统，必须要有一套规范化的工程文件，比如 <code>requirements.md、design.md、tasks.md</code>，定义清楚功能边界，设计边界，任务边界等，所以 "Spec Coding" 是必须的。<br/>
对于创意探索和MVP验证，不在乎质量，只是为了做原型验证，"Vibe Coding" 能快速搭建工程。不过我个人用AI开发一些工具经验而言，无论什么项目，其实都可以从 "Vibe Coding"，当你完整探索了这个项目的边界的时候，再转向 "Spec Coding"，对于工程开发人员这个可能是比较自然的过程。</p>
<p>就像《黑客与画家》一书中描述程序员和画家的相似之处在于不断修改你工程，让其更丰富，除非重构型的项目，一般项目开始定义的功能拆解，AI可能比我们想的功能更丰富。<br/>
所以想使用 <code>Vibe Coding</code> 开发，不断探索边界，然后将边界框定好了以后，整理规范化的工程文件，对项目进行重构，进入 <code>Spec Coding</code>，这个也是我开发思维导图的方式。</p>
<h3 data-id="heading-6">2.2 <code>Code is cheap, show me the product</code></h3>
<p>之前一直说：<code>Code is cheap, show me the talk</code>，其实产品才是 <code>AI</code> 时代最应该关注的。<br/>
现在利用 <code>CodeBuddy</code>, <code>Codex</code>，<code>TRAE</code> 等编程工具，10分钟就可以实现一个完整的 <code>Demo</code>，但是要将这个 <code>Demo</code> 打造成一款伟大的产品却很难。<br/>
虽然做过很多小的demo，这个方面没有发言权，不过我觉得我会一直遵循精益求精的原则，不断是完善一个工具。</p>
<h3 data-id="heading-7">2.3 如何减少代码出错的概率</h3>
<p>之前写过很多 <code>Prompt</code> 技巧，这里就不说了，这里总结项目减少出错可能在于框架的选择：</p>
<ul>
<li>优先选择开源社区通用的框架，比如前端使用 <code>vue</code> + <code>ant-design</code>，首先模型已经有相关知识，出错的概率比较少，另一个组件比较丰富，复用的组件越多，使用的代码就越少，出错的概率就越小；</li>
<li>作为一个后端开发，个人经验是，如果能用前端实现的，就必要用到后端功能，即使必须要用后端，可以优先考虑 <code>Supabase</code>, <code>FireBase</code> 等 <code>BaaS</code> 框架解决后端问题；</li>
<li>不要将功能堆到一个文件中，单个文件不建议超过 500 行，如果超过就尝试将功能拆解出来，毕竟现在的大模型上下文太大，会遇到各种幻觉问题；</li>
<li>尽量写好 <code>requirements.md、design.md</code>，这样能定义功能边界，防止模型太过于发散导致重构的困难加大；</li>
<li>....</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[可验证性是极限]]></title>    <link>https://juejin.cn/post/7574816159754747955</link>    <guid>https://juejin.cn/post/7574816159754747955</guid>    <pubDate>2025-11-21T07:55:29.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574816159754747955" data-draft-id="7574775334681821194" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="可验证性是极限"/> <meta itemprop="keywords" content="AI编程"/> <meta itemprop="datePublished" content="2025-11-21T07:55:29.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="是魔丸啊"/> <meta itemprop="url" content="https://juejin.cn/user/3217622495411292"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            可验证性是极限
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3217622495411292/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    是魔丸啊
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T07:55:29.000Z" title="Fri Nov 21 2025 07:55:29 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><a href="https://link.juejin.cn?target=http%3A%2F%2Falperenkeles.com%2Fposts%2Fverifiability-is-the-limit%2F" target="_blank" title="http://alperenkeles.com/posts/verifiability-is-the-limit/" ref="nofollow noopener noreferrer">转载</a></p>
<p>在过去 5 年中，LLM 在软件工程社区引发了巨大动荡，大部分讨论都围绕着一个核心问题：<strong>我们这个职业的未来是什么？</strong></p>
<p>一系列具有不同程度人工干预和控制的竞争范式已经出现：一方面是几乎无需人工参与的 agents，最近流行的"vibe coding"理念不鼓励手动修改代码，而是通过 LLM 与代码库交互；实现独立模块或功能的聊天机器人，有时甚至使用代码解释功能运行代码；另一方面是预测用户意图的编码助手，充当"强化版自动完成"。</p>
<p>关于这些模型的极限、实用性和潜力，存在诸多不同观点。一些人相信，这些模型将在前所未有的时间和资源投入下发展到人类水平能力，并将能够自动化构建生产级软件系统；而怀疑者则贬低这些模型，声称其生成的代码平庸且琐碎，无法扩展到任何生产环境。</p>
<p>我并非在此争论模型本身的极限或能力，有比我更优秀的专家具备深厚的理论知识和实践经验。然而，我将论证以下观点。</p>
<p><strong>世界上的每一件软件都必须相对于某种正确性标准而"正确"。在 LLM 出现之前，我们的时间被分配在编写、阅读和验证代码上。有了 LLM，我们能够将代码编写阶段卸载给 LLM，但验证过程无法被卸载，只能被推到不同的层面。</strong></p>
<p>外界有人争论正确性只是一小部分领域的事务，比如火箭或密码学。别搞错，正确性所需的严格程度会变化，但对正确性的要求不会改变。软件<strong>总是</strong>为某种目的而创建，无论是消费和转换数据，向用户提供信息，还是允许用户交互并创建新数据。正确性是指创建的软件符合创建者意图的概念，而创建者<strong>必须</strong>验证这种符合性。</p>
<p>在不太关键的应用和领域中，正确性是一个<strong>试验</strong>问题。如果我制作一个网站来展示关于我举办的派对的信息，我会检查网站是否显示了我希望的所有相关信息。如果只是和朋友的派对，这样就足够了。如果是工作派对，我除了在电脑上测试外，还会在手机上尝试，甚至可能请几个使用不同设备的朋友检查，确保一切正常。</p>
<p>即使在上述例子中，正确性的重要性也是上下文相关的。随着领域和规模的变化，我们验证正确性的机制也会改变。当我们创建商业应用软件时，会聘请"<strong>测试</strong>"（QA）专家来测试程序中的许多路径，以发现意外行为，即所谓的<strong>缺陷</strong>。典型公司除了<strong>测试</strong>外，还会花费大量时间<strong>测试</strong>代码，测试的严格程度随用户数量、资金规模、应用领域关键性的变化而变化。小型 SaaS 公司可能只编写一些集成测试来检查特定场景，或为某些组件实现单元测试，而 AWS 则会数学证明每天处理 PB 级数据的 S3 实现的正确性。</p>
<p>那么，基于目前的讨论，LLM 应该能够生成不需要严格正确性的代码库。也许它甚至可以生成测试，或为其编写的代码编写证明，对吗？也许 LLM 真的能从流程中移除人类，作为一组协作的 agents 工作；即使不是现在，也许在未来可以。我在讨论中多次听到这种论点。问题在于，我们没有考虑到<strong>代码的可验证性</strong>。我们谈论了严格性和规模，但严格性作为领域 LLM 适应性的参数是不够的，我们需要讨论 LLM 生成的代码如何被验证，这也包括测试代码。</p>
<p>让我们退一步思考 UI 编程（主要与前端开发相关）。许多从业者的经验表明，LLM 能够在单个提示中生成整个前端应用程序，甚至基于餐巾纸上的草图。我们看到像 V0 这样的专门工具专注于 UI 生成。然而，它们在其他领域并不那么成功，或至少没有普及。关于这种现象的一个流行观点是，LLM 是在公共代码库上训练的，UI 编程占据这些代码的很大比例。然而，这无法解释为什么 LLM 在 Web 服务器应用程序（主要与后端开发相关）中不那么受欢迎，这些应用可能与 UI 编程同样普遍，甚至在代码中具有更少的多样性和更多的结构。</p>
<p>尽管关于前端和后端流行度差异有一些心理学解释，主要是创建炫酷且令人印象深刻的 UI 比创建能吸引同等注意力的后端更容易，因此关于前后端比较的流行性或可用性的轶事证据不应被赋予太多可信度，<strong>我假设 UI 比我们编写代码的任何其他领域都更容易验证</strong>。</p>
<p>UI 的验证几乎字面上就是"查看"。当我们查看网页时，我们几乎立即识别出生成的代码与我们的意图之间的偏差，并能向 LLM 提供即时反馈。Web 服务器的验证需要设置一组测试输入，将其发送到服务器，可能创建一些临时状态，并检查输出是否符合我们的预期。事实上，这比尝试更容易编写测试，而编写 UI 测试是一个困扰业界 30 年的长期痛点，至今尚未解决。</p>
<p>上周"vibe coding games"的兴起似乎源于同一根源。生成的游戏虽然令人印象深刻，但其验证可以通过尝试实现。通常在没有持久状态的单服务器上实现，游戏通过降低用户体验或删除导致问题的功能来回避复杂的网络或性能问题，而不是解决这些问题本身。这并非说这不是有效的选择，但这种选择的原因不是因为这些问题不重要，而是因为它们更难验证正确性，需要自定义测试基础设施或领域知识。</p>
<p>回到标题，<strong>可验证性是极限。</strong></p>
<p><strong>这是告诉我们什么无法通过 LLM 实现的极限，它无法通过 agent 方法解决。</strong> 安全 agent 理论上可以为应用程序添加安全检查，但如果不以打算生成代码的人的身份验证这些检查，它们就是无价值的。测试 agent 可以为程序添加测试，但在我们验证测试是否符合我们的意图之前，测试本身是无意义的。</p>
<p>到目前为止，我通过理论化 LLM 和我们生产软件的方式阐述了我的观点。<strong>现在，我应该分享我认为我们应该做什么。</strong></p>
<p>如果可验证性是极限，如果它是使用 LLM 编程的瓶颈，那么自然的问题就是<strong>我们如何提高这个极限，我们如何使验证更容易？</strong></p>
<p>我相信我们需要采取的第一步是放弃无限强大和可扩展的软件 agent 意识形态。如果可验证性真的是极限，那么再多的 agents 也无法解决问题。在我看来，我们需要更好的验证工具和界面。例如，与其让程序员阅读 LLM 生成的测试，不如将生成的测试总结为人类可读的格式，当然，总结也存在信息丢失的风险。我们应该更多地依赖声明式随机测试方法，如基于属性的测试，程序员定义一个应该在所有可能输入上成立的谓词，并通过生成随机输入并传递给程序来测试这个谓词。这种方法已在许多领域用于增强程序可靠性，但尚未被软件工程社区广泛采用。这种方法的优点是，拥有一个通用谓词比多个单元测试更容易检查和理解，此外还有增强的测试强度。</p>
<p>我们需要增加讨论正确性时使用的词汇量。我们需要对性能、安全性、可访问性、灵活性有更广泛的理解，以及如何衡量程序的这些质量，以便我们知道在应用程序中寻找什么，并拥有验证这些质量的机制。在当前状态下，正确性通常被归因于功能正确性，主要意味着"输入输出符合预期"，而应用程序的大多数其他期望被归类为"非功能属性"，软件工程社区在很大程度上忽视了正确地衡量和验证它们。</p>
<p><strong>让我用一个预测来总结。</strong> 很长时间以来，我一直相信 LLM 不会成为优秀的程序员，即使有进一步改进。在它们在竞赛编程中取得成功后，我的观点发生了转变，也许作为一个改过自新的竞赛程序员，那是我的李世石时刻。<strong>我现在，虽然暂时地，相信 LLM 确实可以在所有拥有完美预言机的领域取得成功。</strong></p>
<p>重要的是要理解，这并不意味着 LLM 将成为产生 100x 代码的神，因为实际上软件工程有用的几乎所有领域都没有完美预言机。完美预言机是一种反馈机制，每次都给你"正确/错误"的答案，它们几乎只出现在游戏中，因为现实世界通常没有完美的正确性模型。赢得或输掉一场游戏是完美预言机，创建能在竞赛编程竞赛中通过评判的程序也是如此。</p>
<p>即使是编程中最形式化的方面，用户可以证明代码正确的定理证明器，也不是完美预言机，因为它们无法告诉你是否在证明的中间步骤上走在正确的道路上，只在你的证明正确或遇到困难时提供信息。我希望这个不完美的预言机足以赢得证明这场游戏，LLM 在自动化证明方面会比我们更优秀。如果这一天到来，我们的下一个工作可能是创造新的定理，要求 LLM 生成代码和证明，并将这样的系统安全可靠地扩展到生产级代码库。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[大模型平民化：3块钱、2小时，MiniMind开源项目全解析]]></title>    <link>https://juejin.cn/post/7574972697676562468</link>    <guid>https://juejin.cn/post/7574972697676562468</guid>    <pubDate>2025-11-21T08:16:50.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574972697676562468" data-draft-id="7574916588718440490" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="大模型平民化：3块钱、2小时，MiniMind开源项目全解析"/> <meta itemprop="keywords" content="Agent,程序员,LLM"/> <meta itemprop="datePublished" content="2025-11-21T08:16:50.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="大模型教程"/> <meta itemprop="url" content="https://juejin.cn/user/1145012233707299"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            大模型平民化：3块钱、2小时，MiniMind开源项目全解析
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1145012233707299/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    大模型教程
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T08:16:50.000Z" title="Fri Nov 21 2025 08:16:50 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>本文较长，建议点赞收藏。更多AI大模型应用开发学习视频及资料，在<a href="https://link.juejin.cn?target=https%3A%2F%2Fhy.zhipoai.cn%2F" target="_blank" title="https://hy.zhipoai.cn/" ref="nofollow noopener noreferrer">智泊AI</a>。</p>
</blockquote>
<p>印象里大模型参数动辄千亿万亿，训练成本更是天文数字，感觉像是普通人遥不可及的“屠龙之术”。但今天想跟你们聊个有意思的反例，一个叫 MiniMind 的开源项目，它反其道而行之，主打一个“大道至简”。</p>
<p>这个项目的目标听起来有点不可思议：只花3块钱的服务器成本，用2个小时，就能从零开始训练一个属于你自己的语言模型。当然，这里的“2小时”是在NVIDIA 3090这种还算不错的个人显卡上测试的，“3块钱”也是指租用这块显卡的云服务费用。即便如此，这个门槛也低得让人心动。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eae132211ee745f396415f32ae26b6cf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764317810&amp;x-signature=h%2FnoJRX4t8AcvrMNliTvOBekcBU%3D" alt="" loading="lazy"/></p>
<p>这几年AI圈子实在太浮躁，各种框架和工具库把一切都封装得严严实实。比如用<code>transformers</code>库，十几行代码就能跑完一个模型的训练流程。这当然很方便，但给我的感觉就像是坐在飞船的头等舱里，速度是快，可你永远不知道这飞船的引擎是怎么造的。MiniMind的作者显然也有同感，他觉得“用乐高拼出一架飞机，远比坐在头等舱里飞行更让人兴奋”。</p>
<p>所以，这个项目最大的特点就是“透明”。它把大模型训练的全过程，包括数据清洗、预训练、监督微调、强化学习等等，全部用最基础的PyTorch代码从头实现了一遍，几乎不依赖那些高度抽象的第三方库。这相当于把大模型的“黑盒子”拆开，把里面的零件一个个摆在你面前，让你看清楚、摸明白。对于想真正入门LLM的人来说，这简直是一份宝藏级的教程。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ec20ae8582d9485181f9add8e4b7dbe7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764317810&amp;x-signature=879%2BYk8TK7h6sj%2FMVeOm78s%2B%2F4A%3D" alt="" loading="lazy"/></p>
<p>MiniMind训练出来的模型有多大呢？最小的版本只有25.8M，作为对比，几年前的GPT-3模型体积是它的7000多倍。这意味着，你不仅能在自己的普通电脑上训练它，还能轻松地部署和运行它。</p>
<p>当然，这么小的模型，你不能指望它有GPT-4的智商。但它的意义不在于挑战巨头，而在于“祛魅”。它让你亲身体验一个语言模型是如何从一堆杂乱的文本数据中“学会”知识，再通过对话练习“学会”交流的。</p>
<p>整个过程大概分几步。首先是<strong>预训练</strong>，就像让一个刚出生的婴儿去读海量的书籍报刊，虽然它还不懂怎么说话，但脑子里已经装满了各种知识。MiniMind用的是一份约1.6GB的高质量中文语料，让模型在这个阶段埋头“学习接龙”，比如看到“秦始皇”，它得学会接“是中国的第一位皇帝”。</p>
<p>然后是<strong>监督微调（SFT）</strong> 。模型学富五车但不会聊天，怎么办？就给它看大量的对话范例，告诉它看到“问题”后面要跟“回答”。这个过程就像教一个书呆子社交礼仪，让他知道聊天的基本格式。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4c179c011a69407ab978c4e937ecc9d1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764317810&amp;x-signature=Gkl%2Fmg4Lj7zxWhM%2FaAtuyl5tpYY%3D" alt="" loading="lazy"/></p>
<p>再往后，还有更高级的玩法，比如<strong>强化学习（RLHF/RLAIF）</strong> 。简单说，就是让模型知道什么样的回答是“好”的，什么样的回答是“坏”的。比如用DPO（直接偏好优化）方法，你给模型看一对答案，告诉它哪个更受人类喜欢，模型就会慢慢调整自己的说话风格，变得更讨人喜欢。MiniMind甚至还从零实现了PPO、GRPO这些更前沿的强化学习算法，用一个AI“裁判”来给模型的回答打分，引导它进化。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/de919692ab2740c1875aad6688175936~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764317810&amp;x-signature=kNttsrxV%2Bxx9T1l2udusCfe7%2Ff4%3D" alt="" loading="lazy"/></p>
<p>那么，花3块钱训练出来的模型效果到底怎么样？项目作者也坦诚地给出了测试结果。在一些客观的中文评测榜单上，比如C-Eval，MiniMind的得分基本在25%上下徘徊。要知道，四选一的选择题，瞎猜的正确率就是25%。所以，从“智商”上说，它确实只是个“宝宝”。</p>
<p>但在实际对话中，它已经能有模有样地回答一些基本问题了。比如你问它“介绍一下自己”，它会说“我是一个人工智能，被设计用来帮助用户解答问题”。你让它推荐杭州美食，它也能说出几个像样的菜名。虽然偶尔会犯傻，比如问它美国历史，它可能会蹦出一段不知所云的中文。但考虑到它的体量和训练成本，能做到这样已经相当不错了。</p>
<p>我个人觉得，MiniMind这个项目最有价值的地方，不是它最终训练出的模型有多强，而是它提供了一个可动手、低成本的实验平台。它证明了理解和构建一个语言模型，并不一定需要庞大的算力和资金。它更像一个“厨房”，备齐了所有食材和厨具，鼓励你自己下厨，而不是永远只当一个点外卖的食客。</p>
<p>现在，这个项目已经兼容了像<code>llama.cpp</code>、<code>ollama</code>这些流行的本地推理框架，你可以很方便地把自己训练的模型跑在个人电脑上，甚至把它打包成一个API服务，接入各种聊天界面。</p>
<p>总而言之，如果你也对AI的底层原理感到好奇，厌倦了那些云里雾里的概念，想亲手“拼”一个属于自己的语言模型，那MiniMind绝对值得你花上一个下午去研究一下。毕竟，能用一杯奶茶的钱，换来一次深入AI核心腹地的机会，这笔买卖怎么看都挺划算的。</p>
<h2 data-id="heading-0">学习资源推荐</h2>
<p>如果你想更深入地学习大模型，以下是一些非常有价值的学习资源，这些资源将帮助你从不同角度学习大模型，提升你的实践能力。</p>
<blockquote>
<p>本文较长，建议点赞收藏。更多AI大模型应用开发学习视频及资料，在<a href="https://link.juejin.cn?target=https%3A%2F%2Fhy.zhipoai.cn%2F" target="_blank" title="https://hy.zhipoai.cn/" ref="nofollow noopener noreferrer">智泊AI</a>。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[跨平台开发地图：客户端技术选型指南 | 2025年11月 |（Valdi 加入战场）]]></title>    <link>https://juejin.cn/post/7574916588718489642</link>    <guid>https://juejin.cn/post/7574916588718489642</guid>    <pubDate>2025-11-21T08:27:44.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574916588718489642" data-draft-id="7574958975159599147" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="跨平台开发地图：客户端技术选型指南 | 2025年11月 |（Valdi 加入战场）"/> <meta itemprop="keywords" content="Flutter,客户端,React Native"/> <meta itemprop="datePublished" content="2025-11-21T08:27:44.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员老刘"/> <meta itemprop="url" content="https://juejin.cn/user/662360127965769"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            跨平台开发地图：客户端技术选型指南 | 2025年11月 |（Valdi 加入战场）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/662360127965769/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员老刘
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T08:27:44.000Z" title="Fri Nov 21 2025 08:27:44 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读28分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong>哈喽，我是老刘</strong></p>
<p>2024年全球移动应用下载量突破2570亿次，但开发者面对的现实是：平台越来越多、成本翻倍、体验难统一。iOS/Android/鸿蒙/桌面端/Web/小程序，各有一套开发与设计规范，原生很难在多设备上做到一致。</p>
<p>跨平台是机会，却更是选择题：Flutter讲性能、React Native讲生态、uni-app讲覆盖、KMP讲原生。</p>
<p>如何做好这道选择题，把有限的资源发挥出最大的效率？</p>
<p>老刘每个月为大家画出最新的跨平台技术选型地图，帮你快速做决策。</p>
<p>本月很多跨平台框架都有更新，另外新框架<strong>Valdi</strong>加入战场，为跨平台开发带来了新的可能性。</p>
<hr/>
<h2 data-id="heading-0">一、2025年跨平台技术趋势</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/737dbad8190640a692b5c0320f462962~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6ICB5YiY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764318464&amp;x-signature=Kt1jKlr6EarAYoyh56HqrqpwEZI%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p><strong>第一个变化：性能差距在缩小</strong></p>
<p>现在Flutter的自渲染引擎已经能达到60fps的流畅度。</p>
<p>uni-app x的UTS编译技术，直接把代码转成原生Kotlin和Swift。</p>
<p>跨平台方案与原生的性能差距已经小到用户感知不到的程度。</p>
<p><strong>第二个变化：大厂开始重注跨平台</strong></p>
<p>2024年5月，微软正式停止Xamarin支持，全力推.NET MAUI。</p>
<p>同一时间，Google官方开始支持Kotlin Multiplatform。</p>
<p><strong>第三个变化：AI加持下的开发效率暴增</strong></p>
<p>现在用Claude Code、Cursor等工具写Flutter代码，效率比以前高了3倍。</p>
<p>特别是UI界面，直接传入设计图就能生成可用的代码。</p>
<p>跨平台开发的学习门槛大幅降低。</p>
<h3 data-id="heading-1">最新技术动态</h3>
<h4 data-id="heading-2">React Native 新架构全面启用</h4>
<p><strong>React Native 0.82 里程碑版本</strong></p>
<p>React Native 0.82 - A New Era: <a href="https://link.juejin.cn?target=https%3A%2F%2Freactnative.dev%2Fblog" target="_blank" title="https://reactnative.dev/blog" ref="nofollow noopener noreferrer">reactnative.dev/blog</a></p>
<ul>
<li>2025年10月8日发布，完全基于新架构运行</li>
<li>0.82.1 已在10月推送</li>
<li>0.83 作为下一小版本尚未在11月正式 GA</li>
</ul>
<h4 data-id="heading-3">Kotlin Multiplatform 生态成熟加速</h4>
<p><strong>Compose Multiplatform 1.9.3 发布</strong></p>
<ul>
<li>
<p>Compose Multiplatform 1.9.3 于11月6日发布</p>
<p>带来对最新 AGP 的兼容建议、引入实验性的 MaterialExpressiveTheme 、并将 Material3 与 Gradle 插件版本解耦</p>
</li>
</ul>
<h4 data-id="heading-4">.NET MAUI 企业级发展</h4>
<p><strong>.NET 10 预览与 MAUI 增强</strong></p>
<p>.NET Multi-platform App UI：<a href="https://link.juejin.cn?target=https%3A%2F%2Fdotnet.microsoft.com%2Fen-us%2Fapps%2Fmaui" target="_blank" title="https://dotnet.microsoft.com/en-us/apps/maui" ref="nofollow noopener noreferrer">dotnet.microsoft.com/en-us/apps/…</a></p>
<ul>
<li>.NET 10 已在 .NET Conf 2025（11月11–13日）正式发布并成为 LTS（支持到 2028-11-10）</li>
<li>Uno Platform 6.3 带来 .NET 10（RC）支持、VS 2026 兼容，以及 WebAssembly 端通过 WebWorkers 的图像解码性能提升；官方宣布与微软 .NET 团队深度协作推进 MAUI/.NET for Android
Uno 博客与资讯： platform.uno/blog/uno-platform-6-3</li>
</ul>
<h4 data-id="heading-5">Flutter 平台更新</h4>
<p>Flutter 3.38 技术更新: <a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.flutter.dev%2Frelease%2Fwhats-new" target="_blank" title="https://docs.flutter.dev/release/whats-new" ref="nofollow noopener noreferrer">docs.flutter.dev/release/wha…</a></p>
<ul>
<li>3.38 于11月发布，支持 Apple 强制的 UIScene 生命周期，需要进行代码迁移</li>
<li>文档站点迁移到 Jaspr（Dart Web 框架），开发者文档与工具集成改进</li>
<li>Widget Previewer 在 VS Code/IntelliJ 进一步集成，提升预览与调试效率</li>
<li>平台支持同步 iOS 26、Xcode 26、macOS 26，稳定性与兼容性提升</li>
<li>Dart 3.6 点速记语法（Dot shorthands）默认开启，减少样板代码（如 <code>.start</code>）</li>
<li>Web 开发增强：<code>web_dev_config.yaml</code> 支持配置开发服务器与代理，热重载可多浏览器连接</li>
<li>OverlayPortal 新能力：子 Widget 可渲染到任意 Overlay，适合弹窗、气泡、提示等复杂浮层</li>
<li>Windows 桌面增强：<code>PlatformDispatcher.displays</code> 可获取显示器分辨率、刷新率、DPR、物理尺寸等</li>
<li>修复 Android 端 Activity 销毁内存泄漏（issue #173770），影响自 3.29.0 引入的缺陷</li>
</ul>
<h4 data-id="heading-6">升级提示（3.38）</h4>
<ul>
<li>Android：默认 NDK 升级到 r28，满足 Google Play 16 KB 页面大小兼容要求</li>
<li>iOS：严格按 UIScene 生命周期迁移，参考官方迁移指南</li>
<li>版本选择策略：观察期 2–3 个月，稳定后再提升为主力版本</li>
</ul>
<h4 data-id="heading-7">uni-app x 11月进展</h4>
<p>uni-app x 4.84/4.85 更新日志: <a href="https://link.juejin.cn?target=https%3A%2F%2Funiapp.dcloud.io%2Frelease" target="_blank" title="https://uniapp.dcloud.io/release" ref="nofollow noopener noreferrer">uniapp.dcloud.io/release</a></p>
<ul>
<li>新增 API <code>uni.createWorker</code> 支持 Worker 线程，提升计算与渲染并发能力（4.84）</li>
<li>App(iOS/Android) 新增 <code>image</code> 支持 SVG、<code>live-player</code>/<code>live-pusher</code> 实时音视频、广告视频等能力</li>
<li>HarmonyOS 增强：<code>themeChange</code> 主题切换、登录/分享、屏幕亮度 API、逻辑层 JSVM 迁移至子线程</li>
<li>多平台稳定性修复：list-view 拖动加载崩溃、编译器 async 嵌套报错、web-view/scroll-view 等问题修复（4.85）</li>
</ul>
<h4 data-id="heading-8">新的跨平台框架 Valdi 加入战场</h4>
<ul>
<li>4.3章节会详细介绍 Valdi 框架的设计与实现</li>
</ul>
<p>接下来老刘按照跨平台技术框架的三种路线，分别介绍一下目前主流的跨平台技术。</p>
<hr/>
<h2 data-id="heading-9">二、自渲染类框架</h2>
<p><strong>什么是自渲染？</strong></p>
<p>简单来说，就是框架自己画界面，不用系统提供的组件。</p>
<p>就像游戏引擎一样，每个像素都是自己控制的。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/be8db77b4f024519a78af5cf246461c6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6ICB5YiY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764318464&amp;x-signature=kfejaHyE31VQCKpwQrwz3VAopEk%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p>这样做有什么好处？</p>
<p><strong>第一，界面完全一致</strong></p>
<p>在iPhone上看到的按钮，和在Android上看到的按钮，一模一样。</p>
<p>同样的UI代码，在不同平台上运行，不会因为转嫁到系统的UI组件而导致展示效果或者逻辑不一致。</p>
<p><strong>第二，性能媲美原生</strong></p>
<p>因为跳过了系统的UI层，直接操作GPU绘制。</p>
<p>本质上和原生系统框架采用相同的架构，因此性能上也不会有太大的区别。</p>
<p><strong>第三，没有兼容性bug</strong></p>
<p>其它两种方案不管是中间层还是转义，最终都会去调用系统原生的组件。</p>
<p>这个过程中因为不同系统的组件功能差异和实现方案不同就会导致一些兼容性问题。</p>
<p>其中比较复杂的问题可能需要开发者自己去原生代码的层面去定位和解决。</p>
<p>而自渲染的框架，因为跳过了系统的UI层，所以不会有这个问题。</p>
<h3 data-id="heading-10">2.1 Flutter</h3>
<h4 data-id="heading-11">Flutter现在有多火？</h4>
<p>2024年Stack Overflow调查显示，Flutter是最受欢迎的跨平台框架。</p>
<p>全球有超过500万开发者在使用。</p>
<p>连阿里巴巴、腾讯、字节跳动都在使用Flutter。</p>
<p><strong>为什么这么多大厂选择Flutter？</strong></p>
<p><strong>原因一：性能真的强</strong></p>
<p>自从切换了Impeller引擎，Flutter真的是和原生应用性能一致。</p>
<p><strong>原因二：开发效率高</strong></p>
<p>热重载功能让你改代码后，1秒钟就能看到效果。</p>
<p>不用重新编译，不用重新安装。</p>
<p>同时，Dart语言本身的在编码复杂性和功能性方面平衡做的非常好，日常开发的效率很高。</p>
<p><strong>原因三：生态成熟</strong></p>
<p>pub.dev上有超过4万个插件包。</p>
<p>基本上你能想到的功能，都有现成的插件。</p>
<p>地图、支付、推送、数据库...应有尽有。</p>
<p><strong>原因四：对单元测试的良好支持</strong></p>
<p>Flutter是目前为止客户端开发领域中对单元测试支持最好的框架。</p>
<p>这一点比原生开发都要好，是Flutter独有的优势。</p>
<p>如果你的团队使用TDD或者敏捷流程，Flutter可能是最优选择。</p>
<p><strong>原因五：AI的积极跟进</strong></p>
<p>Flutter在AI时代的表现让人刮目相看。</p>
<p>Google官方推出了Flutter AI Toolkit，直接集成了Gemini API。</p>
<p>开发者可以用几行代码就实现AI聊天、图像识别、语音转文字等功能。</p>
<p>而且Flutter对AI模型的本地部署支持也很好。</p>
<p>TensorFlow Lite、ONNX Runtime都有官方插件。</p>
<p>你可以把AI模型直接打包到应用里，不依赖网络也能跑AI功能。</p>
<p>这在隐私要求高的场景下特别有用。</p>
<p>最近还有个新玩意儿——Dart MCP Server。</p>
<p>简单说，就是让AI助手能直接理解和操作你的Dart/Flutter项目。</p>
<p>你可以让AI直接帮你写Flutter代码、读取运行中的组件树、调试问题、优化性能。</p>
<p>总之，可以看到Flutter团队在对接AI方面的前瞻性和重视度。</p>
<h4 data-id="heading-12">Flutter适合什么项目？</h4>
<p><strong>高性能应用</strong>：比如音视频应用</p>
<p><strong>复杂UI应用</strong>：比如电商、社交应用</p>
<p><strong>需要快速迭代的项目</strong>：比如创业公司的MVP产品</p>
<p><strong>但Flutter也有坑</strong></p>
<p><strong>学习成本高</strong>：需要学Dart语言，和JavaScript差别挺大</p>
<p><strong>包体积大</strong>：最小的Flutter应用也要10MB+</p>
<p><strong>原生功能调用复杂</strong>：需要写Platform Channel</p>
<p><strong>总结一下</strong></p>
<p>如果你的项目对性能要求高，UI比较复杂，团队有时间学习新技术。</p>
<p>Flutter是最佳选择。</p>
<p>特别是如果你们团队之前没有移动端开发经验，Flutter的学习曲线反而比原生开发更平缓。</p>
<hr/>
<h2 data-id="heading-13">三、中间层类框架</h2>
<p><strong>什么是中间层框架？</strong></p>
<p>简单来说，就是在你的代码和系统原生组件之间，加了一个"翻译官"。</p>
<p>你用JavaScript写界面逻辑，框架帮你"翻译"成原生的Button、TextView。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/67b36baf13a2443b93a42b4e83e35f82~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6ICB5YiY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764318464&amp;x-signature=RPnBf4evMbqps3EQrP4%2BP9aQWH0%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p>这种方案有什么特点？</p>
<p><strong>第一，开发体验接近Web</strong></p>
<p>如果你的团队熟悉React、Vue这些Web框架，上手会很快。</p>
<p>基本上就是把Web开发的那套思路搬到移动端。</p>
<p><strong>第二，能调用原生组件</strong></p>
<p>最终渲染的还是系统原生的Button、Input。</p>
<p>所以界面看起来很"原生"，符合各平台的设计规范。</p>
<p><strong>第三，存在性能损耗</strong></p>
<p>因为有个"翻译"的过程，JavaScript和原生代码之间要频繁通信。</p>
<p>就像两个人通过翻译官对话，肯定比直接对话慢一些。</p>
<p>但这个损耗在交互不频繁的界面中，用户是感知不到的。</p>
<h3 data-id="heading-14">3.1 React Native</h3>
<h4 data-id="heading-15">React Native的优势</h4>
<p><strong>原因一：Web开发者的福音</strong></p>
<p>如果你会React，学React Native基本没有门槛。</p>
<p>同样的JSX语法，同样的组件化思想，同样的状态管理。</p>
<p>一个熟练的React开发者，一周就能上手React Native。</p>
<p><strong>原因二：生态系统超级丰富</strong></p>
<p>npm上有超过15万个React Native相关的包。</p>
<p>导航、动画、图表、支付...你能想到的功能都有现成的库。</p>
<p>而且因为和React共享生态，很多Web端的库稍作修改就能用。</p>
<p><strong>原因三：热更新能力</strong></p>
<p>这是React Native的杀手锏功能。</p>
<p>发现bug？不用重新发版，直接推送补丁代码就能修复。</p>
<p>新功能上线？用户打开App就能看到，不用去应用商店更新。</p>
<p>这对产品迭代速度的提升是巨大的。</p>
<p><strong>原因四：Meta的持续投入</strong></p>
<p>2024年Meta发布了新架构（New Architecture）。</p>
<p>引入了Fabric渲染器和TurboModules，性能提升了30%。</p>
<p>2025年10月8日，React Native 0.82 正式发布，新架构全面启用，旧架构正式退役。</p>
<h4 data-id="heading-16">React Native适合什么项目？</h4>
<p><strong>快速迭代的产品</strong>：比如社交应用、内容应用</p>
<p><strong>Web技术栈团队</strong>：已经有React开发经验的团队</p>
<p><strong>需要热更新的应用</strong>：比如电商、新闻类应用</p>
<p><strong>但React Native也有局限</strong></p>
<p><strong>性能瓶颈</strong>：复杂动画和大量数据处理时，桥接开销明显</p>
<p><strong>原生功能依赖</strong>：新的系统API需要等社区或自己封装</p>
<p><strong>版本升级成本</strong>：大版本升级可能需要改很多代码</p>
<h3 data-id="heading-17">3.2 .NET MAUI</h3>
<h4 data-id="heading-18">.NET MAUI是什么来头？</h4>
<p>2024年5月，微软正式停止了Xamarin的支持。</p>
<p>.NET MAUI（Multi-platform App UI）成为微软官方的跨平台解决方案。</p>
<p>这不是简单的换个名字，而是架构的全面升级。</p>
<p><strong>MAUI相比Xamarin有什么改进？</strong></p>
<p><strong>第一，统一的项目结构</strong></p>
<p>以前Xamarin需要为每个平台创建单独的项目。</p>
<p>MAUI只需要一个项目，就能构建所有平台的应用。</p>
<p><strong>第二，性能大幅提升</strong></p>
<p>新的渲染引擎减少了50%的内存占用。</p>
<p>启动速度比Xamarin快了30%。</p>
<p><strong>第三，开发体验优化</strong></p>
<p>热重载功能让你改C#代码后，立即看到效果。</p>
<p>集成了最新的.NET 8特性，开发效率更高。</p>
<h4 data-id="heading-19">.NET MAUI的独特优势</h4>
<p><strong>企业级支持</strong></p>
<p>微软提供长期技术支持（LTS）。</p>
<p>对于企业应用来说，这种稳定性保障非常重要。</p>
<p><strong>强大的数据处理能力</strong></p>
<p>C#在处理复杂业务逻辑方面有天然优势。</p>
<p>特别是金融、ERP这类数据密集型应用。</p>
<p><strong>与微软生态深度集成</strong></p>
<p>如果你的后端用Azure、数据库用SQL Server。</p>
<p>MAUI能提供最佳的集成体验。</p>
<h4 data-id="heading-20">.NET MAUI适合什么项目？</h4>
<p><strong>企业级应用</strong>：比如CRM、ERP、办公应用</p>
<p><strong>.NET技术栈团队</strong>：已经有C#开发经验的团队</p>
<p><strong>数据密集型应用</strong>：比如金融、医疗、教育管理系统</p>
<p><strong>但MAUI也有短板</strong></p>
<p><strong>学习门槛高</strong>：需要掌握C#和.NET生态</p>
<p><strong>社区相对较小</strong>：第三方库没有React Native丰富</p>
<p><strong>移动端特性支持滞后</strong>：新的移动端API支持可能会慢一些</p>
<h4 data-id="heading-21">中间层框架怎么选？</h4>
<p><strong>如果你的团队主要是Web开发者</strong></p>
<p>选React Native，学习成本最低，生态最丰富。</p>
<p><strong>如果你的项目是企业级应用</strong></p>
<p>选.NET MAUI，稳定性和长期支持更有保障。</p>
<p><strong>如果你需要频繁的热更新</strong></p>
<p>选React Native，这是它的核心优势。</p>
<p><strong>如果你的应用数据处理逻辑复杂</strong></p>
<p>选.NET MAUI，C#在这方面更有优势。</p>
<p><strong>总结一下中间层框架的特点</strong></p>
<p>优势：学习成本低，能复用Web开发经验，界面原生感强。</p>
<p>劣势：存在桥接性能损耗，依赖第三方库封装原生功能。</p>
<p>适合场景：快速开发、团队技术栈匹配、对原生感要求高的项目。</p>
<hr/>
<h2 data-id="heading-22">四、转译类框架</h2>
<p><strong>什么是转译？</strong></p>
<p>简单来说，就是把你写的高级语言代码，"翻译"成目标平台的原生代码。</p>
<p>比如你用Kotlin写业务逻辑，框架帮你"翻译"成iOS的Swift代码。</p>
<p>或者你用类TypeScript的语法写界面，框架帮你"翻译"成Android的Kotlin和iOS的Swift。
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9149bba906fd41ada947ec5c06960ba4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6ICB5YiY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764318464&amp;x-signature=Mz%2FJyRbRFQlmq%2BtXeWLEcuuqNkQ%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p>这种方案有什么特点？</p>
<p><strong>第一，性能最接近原生</strong></p>
<p>因为最终运行的就是原生代码，没有任何中间层损耗。</p>
<p>就像你直接用Swift写iOS应用，用Kotlin写Android应用一样。</p>
<p><strong>第二，能享受原生生态</strong></p>
<p>转译后的代码可以直接调用平台的所有API。</p>
<p><strong>第三，转译效果可能不完美</strong></p>
<p>毕竟是机器"翻译"的代码，有时候可能不如手写的原生代码优雅。</p>
<p>特别是复杂的业务逻辑，转译后的代码可能需要人工优化。</p>
<p>但这个问题随着AI技术的发展，正在快速改善。</p>
<h3 data-id="heading-23">4.1 Kotlin Multiplatform (KMP)</h3>
<h4 data-id="heading-24">KMP为什么突然火了？</h4>
<p>2024年是KMP的爆发年。</p>
<p>5月份，Google在I/O大会上宣布官方支持KMP。</p>
<p>以前KMP只是JetBrains的"个人项目"，现在有了Google的官方背书。</p>
<p>Android开发者可以放心使用，不用担心被抛弃。</p>
<p><strong>Kotlin-to-Swift 导出功能已公开发布（10月首次发布），仍处早期阶段。</strong></p>
<p>你用Kotlin写的业务逻辑，可以直接转成Swift代码。</p>
<p>iOS开发者拿到的就是纯Swift代码，可以像原生项目一样调试和优化。</p>
<h4 data-id="heading-25">KMP的核心理念</h4>
<p><strong>"业务逻辑用KMP共享，UI用Compose Multiplatform统一开发"</strong></p>
<p>这是KMP的最新发展方向，结合了Compose Multiplatform的强大能力。</p>
<p>传统的KMP是"业务逻辑共享，UI各平台原生"。</p>
<p>但现在有了更好的选择——Compose Multiplatform。</p>
<p>一套Compose代码可以运行在Android、iOS、Desktop、Web等所有平台。</p>
<p>业务逻辑用KMP共享，UI用Compose Multiplatform统一开发。</p>
<p><strong>这样做有什么好处？</strong></p>
<p><strong>第一，真正的一套代码多平台</strong></p>
<p>不仅业务逻辑共享，UI也可以共享，开发效率大幅提升。</p>
<p><strong>第二，保持原生性能</strong></p>
<p>Compose Multiplatform在各平台都编译为原生代码，性能接近原生应用。</p>
<p><strong>第三，技术栈统一</strong></p>
<p>全部使用Kotlin生态，学习成本更低，团队协作更高效。</p>
<p><strong>第四，渐进式迁移</strong></p>
<p>你不需要重写整个应用，可以先从一个模块开始。</p>
<p>比如先把网络层用KMP重写，然后逐步迁移UI到Compose Multiplatform。</p>
<h4 data-id="heading-26">KMP + Compose Multiplatform适合什么项目？</h4>
<p><strong>需要快速多平台发布的项目</strong></p>
<p>一套代码可以同时发布到Android、iOS、Desktop、Web等平台。</p>
<p>开发效率比传统KMP方案大幅提升。</p>
<p><strong>密集调用原生API的项目</strong></p>
<p>比如游戏、金融交易、实时通信应用。</p>
<p>KMP + Compose Multiplatform能提供真正的原生无缝调用。</p>
<p><strong>Kotlin技术栈的团队</strong></p>
<p>如果团队熟悉Kotlin和Jetpack Compose。</p>
<p>这个组合是最自然的选择，学习成本最低。</p>
<p><strong>已有原生应用的团队</strong></p>
<p>可以渐进式迁移，先迁移业务逻辑，再迁移UI。</p>
<p>风险可控，收益明显。</p>
<p><strong>但这个组合也有挑战</strong></p>
<p><strong>Compose Multiplatform 在 iOS 端已稳定</strong>：生态仍在加速建设，注意版本兼容与插件成熟度</p>
<p><strong>学习成本相对较高</strong>：需要掌握Kotlin和Compose</p>
<p><strong>生态还在建设中</strong>：第三方库相对较少，但发展很快</p>
<h3 data-id="heading-27">4.2 uni-app / uni-app x</h3>
<h4 data-id="heading-28">uni-app的进化之路</h4>
<p>说到uni-app，很多人的印象还停留在"小程序开发工具"。</p>
<p>但2024年，uni-app发生了质的变化。</p>
<p><strong>传统uni-app</strong>：基于Vue.js + JavaScript，更适用于小程序开发</p>
<p><strong>uni-app x</strong>：全新架构，使用UTS语言，性能达到原生级别</p>
<p>这不是简单的版本升级，而是技术路线的根本改变。</p>
<h4 data-id="heading-29">uni-app x的技术突破</h4>
<p><strong>第一，UTS语言</strong></p>
<p>UTS（UniTypeScript）是DCloud自研的编程语言。</p>
<p>语法类似TypeScript，但编译后直接生成原生代码。</p>
<p>Android平台编译成Kotlin，iOS平台编译成Swift，鸿蒙平台编译成ArkTS。</p>
<p><strong>第二，uvue渲染引擎</strong></p>
<p>这是uni-app x的核心技术。</p>
<p>不同于传统的WebView渲染，uvue直接调用原生渲染引擎。</p>
<p>性能和原生应用完全一致，没有任何损耗。</p>
<p><strong>第三，无桥接架构</strong></p>
<p>传统跨平台框架都有个"桥接层"，用来连接JavaScript和原生代码。</p>
<p>uni-app x直接编译成原生代码，完全没有桥接层。</p>
<p>这意味着没有跨语言通信损耗，性能达到原生级别。</p>
<p><strong>第四，直接调用原生API</strong></p>
<p>因为编译后就是原生代码，可以直接调用平台的所有API。</p>
<p>不需要等插件封装，新的系统功能立即可用。</p>
<h4 data-id="heading-30">uni-app x的独特优势</h4>
<p><strong>平台支持最全</strong></p>
<p>这是uni-app的传统优势。</p>
<p>一套代码可以发布到：iOS、Android、Web、各种小程序、快应用、鸿蒙...</p>
<p>总共支持14+个平台，这是其他框架做不到的。</p>
<p><strong>小程序优先的设计理念</strong></p>
<p>如果你的产品需要同时支持App和小程序。</p>
<p>uni-app是唯一的选择。</p>
<p>其他框架都是"App优先"，小程序支持都是后加的。</p>
<p><strong>国产化支持</strong></p>
<p>对鸿蒙、信创等国产化平台支持最好。</p>
<p>这对国内企业来说非常重要。</p>
<p><strong>学习成本低</strong></p>
<p>如果你会Vue.js，学uni-app基本没有门槛。</p>
<p>语法、组件、生态都和Vue高度一致。</p>
<p><strong>但uni-app也有局限</strong></p>
<p><strong>生态相对封闭</strong>：主要依赖DCloud的生态</p>
<p><strong>国际化程度低</strong>：海外开发者使用较少</p>
<p><strong>技术栈绑定</strong>：主要适合Vue技术栈</p>
<h3 data-id="heading-31">4.3 Valdi 加入战场</h3>
<h4 data-id="heading-32">Valdi 是啥？</h4>
<p><strong>Snapchat憋了8年的大招</strong></p>
<p>这个叫Valdi的框架，在Snapchat内部默默服役了整整8年，扛住了8.5亿月活的洪荒流量。</p>
<p>开源仅仅7天，GitHub星标就冲破了4.2k，直接霸榜Trending。</p>
<p><strong>为什么Snapchat要自己造轮子？</strong></p>
<p>2016年，Snapchat用户数爆炸式增长。</p>
<p>React Native刚出，性能和生态都不足以让大型应用放心。</p>
<p>Flutter还没发布（2017年才发布Beta版）。</p>
<p>纯原生开发又意味着iOS/Android两套代码，开发效率很难满足高速增长的需求。</p>
<p>于是Snapchat决定拉起一支小分队，用TypeScript写UI，让编译器直接吐出原生控件。</p>
<p>内部代号"Valdi"，源自北欧神话的"力量之神"。</p>
<p><strong>8年过去，200+版本，5000+次MR</strong></p>
<h4 data-id="heading-33">Valdi 的基本原理</h4>
<p>Valdi的核心思路属于转义方案的范畴，但是并发代码级转义。</p>
<p>具体怎么做到的？</p>
<p><strong>1. 编译时转译</strong></p>
<ul>
<li>TSX代码 → 原生视图代码（OC/Swift + Java/Kotlin）</li>
<li>布局引擎用C++重写，支持独立重渲染和视图回收</li>
<li>编译阶段就生成类型安全的绑定，空指针异常直接堵在编译期</li>
</ul>
<p><strong>2. 运行时架构</strong></p>
<ul>
<li>无JS Bridge，零跨线程通信开销</li>
<li>业务逻辑可分层：性能关键路径用C++/Swift/Kotlin写"Polyglot模块"，框架自动生成TS绑定</li>
<li>非关键逻辑留在JS端，配合Worker线程做后台任务</li>
</ul>
<p><strong>3. 热重载机制</strong></p>
<ul>
<li>文件保存 → 200ms内看到刷新</li>
<li>不丢状态、不重启App</li>
<li>VSCode调试链完整，断点直接断在TS源码</li>
</ul>
<p><strong>4. 内存管理</strong></p>
<ul>
<li>自动视图回收</li>
<li>增量渲染</li>
</ul>
<p>这种技术方案其实是介于转译和中间层之间的一种方式。</p>
<p>UI组件树翻译成原生组件，组件的生命周期交给C++编写的引擎管理，业务逻辑部分则保留在TS层。</p>
<p>这样的好处是在一定程度上避免了转译类方案代码翻译不到位造成的一些问题。</p>
<p>但是仍然会有中间层方案在高UI交互场景下的性能问题，这部分就需要把处理逻辑放到C++/Swift/Kotlin编写的"Polyglot模块"解决。</p>
<p>总的来说，这套架构在Snapchat内部跑了8年，扛住了8.5亿月活的洪荒流量。</p>
<p>现在开源出来，就是把踩过的坑都帮你填平了。</p>
<h4 data-id="heading-34">Valdi 尚处于生命周期的早起</h4>
<p><strong>平台限制</strong></p>
<p>目前仅支持iOS、Android和 macOS</p>
<p>Windows版本要等到2026年Q1。</p>
<p>Web支持也还在路上，预计2026年Q2才会发布。</p>
<p><strong>生态建设初期</strong></p>
<p>相比React Native和Flutter，Valdi的开源生态和第三方组件库还在早期阶段。</p>
<p>复杂图表、地图等高级组件需要自己动手桥接原生SDK。</p>
<p>虽然可以通过"Polyglot模块"和custom-view嵌入原生控件，但短期还是需要投入额外开发成本。</p>
<p><strong>API稳定性风险</strong></p>
<p>当前版本还是Beta-0.0.1，API可能会微调。</p>
<p>官方建议先在独立模块或小业务试水，不要直接all in。</p>
<p><strong>对原生能力的要求</strong></p>
<p>虽然主打"零原生代码"，但性能关键路径还是需要写C++/Swift/Kotlin的"Polyglot模块"。</p>
<p>平台API调用、生命周期管理等也需要一定的原生开发经验。</p>
<p><strong>CI/CD复杂度</strong></p>
<p>需要搭建成熟的CI构建流程和代码生成规范。</p>
<p>多端工程和绑定管理相对复杂，对团队的技术栈要求较高。</p>
<p><strong>总结一句话：Valdi很有潜力，但现在更适合技术探索，不是生产环境的首选。</strong></p>
<p>站在纯粹客户端跨平台开发的角度，转义类方案老刘目前更推荐KMP。</p>
<p>Valdi可以作为一个有潜力的备选，等生态更加成熟后再重新考虑。</p>
<h3 data-id="heading-35">转译类框架怎么选？</h3>
<p><strong>如果你有现有的原生应用</strong></p>
<p>选KMP，可以渐进式迁移，风险最小。</p>
<p><strong>如果你需要支持小程序</strong></p>
<p>选uni-app，这是它的核心优势。</p>
<p><strong>如果你对性能要求极高</strong></p>
<p>KMP和uni-app x都可以，看团队技术栈。</p>
<p><strong>如果你的团队是Vue技术栈</strong></p>
<p>选uni-app，学习成本最低。</p>
<p><strong>如果你的团队是Android技术栈</strong></p>
<p>选KMP，Kotlin是你们的强项。</p>
<p><strong>总结一下转译类框架的特点</strong></p>
<p>优势：性能最接近原生，能享受原生生态，没有运行时损耗。</p>
<p>劣势：学习成本相对较高，转译效果可能需要优化。</p>
<p>适合场景：对性能要求高、需要调用大量原生功能、有原生开发基础的团队。</p>
<hr/>
<h2 data-id="heading-36">五、技术选型指南</h2>
<p>看了这么多框架，是不是更纠结了？</p>
<p>别慌，老刘给你一个简单粗暴的选型指南。
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/999fb95e5f2e4c5ca6555115e960f788~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6ICB5YiY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764318464&amp;x-signature=eeCXdmY7Yq0Y90ygB%2Bs7GkQ0Mis%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<h3 data-id="heading-37">5.1 Flutter：大多数App的不二之选</h3>
<p>其实对于大多数App来说，Flutter都是当前阶段最合适的选择</p>
<p>为什么这么说？</p>
<p><strong>性能足够强悍</strong></p>
<p>如果在大街上随机找100个人，把他们手机里面的非游戏类App都拿出来，那么其中99%都是Flutter可以胜任的。</p>
<p>对于性能有极端要求的App来说其实大概率原生开发也不行，需要更深度的优化方式。</p>
<p>比如把数据加解密、视频编解码等工作封装到更底层的so库中。</p>
<p>而这种优化方案在Flutter项目中也能使用，工作量和原生中差不多。</p>
<p><strong>开发效率够高</strong></p>
<p>Flutter的热重载功能，改代码后1秒内就能看到效果。</p>
<p>这比原生开发快了10倍不止。</p>
<p>而且Flutter的组件库非常丰富。</p>
<p>Material Design和Cupertino组件开箱即用。</p>
<p>对于更复杂的组件和绘制定制场景，由于Flutter自带渲染引擎，因此也可以直接在暴露给开发者的canvas上进行更复杂的渲染定制。</p>
<p><strong>TDD开发流程的完美搭档</strong></p>
<p>Flutter天生支持单元测试、集成测试、UI测试。</p>
<p>测试覆盖率可以轻松达到90%以上。</p>
<p>CI/CD集成也非常简单，GitHub Actions、GitLab CI都有现成的模板。</p>
<p>如果计划采用TDD相关的开发流程，Flutter可能是目前唯一的选择。</p>
<p><strong>AI时代的宠儿</strong></p>
<p>Google全力加持Flutter，AI工具链日趋完善。</p>
<p>GPT、Cursor、Claude Code对Flutter的支持都很好。</p>
<p>写Flutter代码，AI能帮你完成80%的重复工作。</p>
<p><strong>Flutter适合什么项目？</strong></p>
<ul>
<li>需要高性能的应用（游戏、视频、图形处理）</li>
<li>对UI一致性要求高的应用</li>
<li>团队有充足的学习时间</li>
<li>需要长期维护的项目</li>
<li>对包体积不是特别敏感的应用</li>
</ul>
<h3 data-id="heading-38">5.2 KMP：潜力股还是画饼？先别急着上车</h3>
<p><strong>Kotlin Multiplatform：Google亲儿子的野心与现实</strong></p>
<p>KMP确实很香，但现在上车可能还早了点。</p>
<p><strong>现状分析：技术很香，但生态还在"襁褓期"</strong></p>
<p>KMP的技术理念非常先进。</p>
<p>但问题是——生态还不够成熟。</p>
<p>第三方库支持有限，很多常用功能需要自己封装。</p>
<p>调试工具也不够完善，出了问题排查起来比较麻烦。</p>
<p><strong>适用场景：密集调用原生API的项目可以关注</strong></p>
<p>如果你的应用需要大量调用原生API：</p>
<ul>
<li>相机、麦克风、传感器</li>
<li>蓝牙、NFC、GPS</li>
<li>系统级权限管理</li>
</ul>
<p>KMP确实有优势。</p>
<p>因为它可以直接调用原生代码，没有性能损耗。</p>
<p><strong>风险提醒：早期采用者需要踩坑的心理准备</strong></p>
<p>选择KMP，你需要做好这些准备：</p>
<ul>
<li>遇到问题时，Stack Overflow上的答案可能很少</li>
<li>第三方库可能不支持，需要自己写原生桥接</li>
<li>团队需要同时掌握Kotlin、Swift、Android、iOS开发</li>
<li>项目初期开发效率可能不如Flutter</li>
</ul>
<p><strong>未来展望：如果KMP真正成熟，将是原生开发的强力补充</strong></p>
<p>Google已经把KMP列为官方支持的技术。</p>
<p>JetBrains也在大力投入。</p>
<p>如果生态能在2025年下半年成熟起来，KMP确实值得考虑。</p>
<p><strong>建议：除非你是技术极客，否则再等等</strong></p>
<p>如果你的团队技术实力很强，喜欢尝试新技术，可以在小项目上试试KMP。</p>
<p>但如果你需要稳定可靠的解决方案，建议再等一年。</p>
<p>等KMP的生态更成熟一些，再考虑大规模使用。</p>
<h3 data-id="heading-39">5.3 App + 小程序：别被"一套代码走天下"忽悠了</h3>
<p><strong>App和小程序一套代码？这可能是个伪命题！</strong></p>
<p>很多人被"一套代码，多端运行"的口号忽悠了。</p>
<p>以为App和小程序可以用同一套代码。</p>
<p>但现实是——这样做可能得不偿失。</p>
<p><strong>思维误区：把小程序当App的"乞丐版"是大错特错</strong></p>
<p>很多人觉得小程序就是App的简化版。</p>
<p>功能少一点，界面简单一点，用户体验差一点。</p>
<p>这种想法完全错了。</p>
<p>App和小程序应该承担不同的产品职责。</p>
<p><strong>正确姿势：App和小程序应该承担不同的产品职责</strong></p>
<p>App的优势：</p>
<ul>
<li>性能更好，可以做复杂交互</li>
<li>可以离线使用</li>
<li>推送通知更及时</li>
<li>用户粘性更高</li>
</ul>
<p>小程序的优势：</p>
<ul>
<li>获客成本更低</li>
<li>分享传播更容易</li>
<li>用户使用门槛更低</li>
<li>可以借助平台流量</li>
</ul>
<p><strong>成功案例解析：微信读书的智慧分工</strong></p>
<p>微信读书就是一个很好的例子。</p>
<p><strong>App承担重交互功能：</strong></p>
<ul>
<li>长时间阅读体验优化</li>
<li>个性化推荐算法</li>
<li>离线下载功能</li>
<li>复杂的社交互动</li>
</ul>
<p><strong>小程序专注营销拉新：</strong></p>
<ul>
<li>好友推荐分享</li>
<li>读书打卡活动</li>
<li>限时免费活动</li>
<li>新用户引导体验</li>
</ul>
<p>这样分工，App和小程序各司其职，效果比"一套代码"好得多。</p>
<p><strong>技术选型建议</strong></p>
<p><strong>功能重叠度高的情况：</strong></p>
<p>如果你的App和小程序功能重叠度超过70%，可以考虑uni-app等跨端方案。</p>
<p>比如电商类应用，商品展示、购物车、订单管理这些功能，App和小程序基本一样。</p>
<p><strong>功能差异化大的情况：</strong></p>
<p>如果App和小程序的功能差异很大，建议分别选择最适合的技术栈。</p>
<p>App用Flutter或原生开发，专注用户体验。</p>
<p>小程序用原生小程序开发，专注营销转化。</p>
<p><strong>避坑指南：不要为了技术统一而牺牲用户体验</strong></p>
<p>很多团队为了技术栈统一，强行用一套代码开发App和小程序。</p>
<p>结果App体验不如原生，小程序功能又太复杂。</p>
<p>两边都不讨好。</p>
<p>记住：技术是为产品服务的，不是为了技术而技术。</p>
<p><strong>总结一下技术选型的核心原则</strong></p>
<ol>
<li>
<p><strong>大多数情况选Flutter</strong>：性能、生态、开发效率都很均衡</p>
</li>
<li>
<p><strong>KMP可以关注但别急着用</strong>：等生态成熟一些再说</p>
</li>
<li>
<p><strong>App和小程序要差异化定位</strong>：不要被"一套代码"忽悠</p>
</li>
<li>
<p><strong>根据团队技术栈选择</strong>：学习成本也是成本</p>
</li>
<li>
<p><strong>考虑项目的长期维护</strong>：选择有长期支持的技术</p>
</li>
</ol>
<hr/>
<h2 data-id="heading-40">六、总结与建议</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5cf0224e1b3843ecb4c86125e626460f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6ICB5YiY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764318464&amp;x-signature=u5AFvNoAjL3uD4otT5zS2eUS06g%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p>写了这么多，老刘最后给你一个终极建议。</p>
<p><strong>2025年跨平台开发，记住这三个关键词：务实、聚焦、长期主义。</strong></p>
<h3 data-id="heading-41">务实：别追求完美的技术方案</h3>
<p>很多团队陷入"技术洁癖"。</p>
<p>总想找到一个完美的跨平台方案，既要性能好，又要学习成本低，还要生态丰富。</p>
<p>醒醒吧，这样的方案不存在。</p>
<p><strong>每种技术都有trade-off。</strong></p>
<p>Flutter性能好但包体积大。</p>
<p>React Native生态好但有桥接损耗。</p>
<p>KMP接近原生但生态不成熟。</p>
<p>uni-app平台全但主要适合Vue技术栈。</p>
<p><strong>选择技术的核心是：在当前约束条件下，哪个方案的收益最大。</strong></p>
<p>不要追求完美，要追求合适。</p>
<h3 data-id="heading-42">聚焦：一个团队最多掌握两种跨平台技术</h3>
<p>很多公司什么技术都想试。</p>
<p>Flutter也搞，React Native也搞，KMP也要研究。</p>
<p>结果每个都不精通，遇到问题都解决不了。</p>
<p><strong>建议：选定一个主力技术栈，最多再备一个备选方案。</strong></p>
<h3 data-id="heading-43">长期主义：技术选型要考虑3年后的维护成本</h3>
<p>很多人以为选定技术栈就万事大吉了。</p>
<p>其实真正决定项目生死的，是你选定技术栈之后做的那些事。</p>
<p><strong>架构设计够不够清晰？</strong></p>
<p>模块划分是否合理，接口设计是否稳定，这些直接影响后续迭代的难度。</p>
<p><strong>开发流程够不够规范？</strong></p>
<p>CI/CD流水线、代码审查、测试覆盖率，这些看似繁琐的流程，3年后会救你的命。</p>
<p><strong>代码规范够不够严格？</strong></p>
<p>命名规范、注释规范、目录结构，新人能不能快速上手，老代码能不能看懂。</p>
<p><strong>技术债务管理够不够及时？</strong></p>
<p>每次为了赶进度留下的坑，3年后都会变成巨坑。</p>
<p>选定技术栈不是终点，而是起点。</p>
<p>做好这些基础建设，才是项目能持续健康演进的根本。</p>
<p>否则，再好的技术栈也救不了你。</p>
<h3 data-id="heading-44">最后的最后：技术选型没有标准答案</h3>
<p>老刘写这篇文章，不是为了告诉你"必须选哪个技术"。</p>
<p>而是希望你在选择时，能有一个清晰的思考框架。</p>
<p><strong>2025年，跨平台开发已经不是"能不能做"的问题，而是"怎么做得更好"的问题。</strong></p>
<p>选对了技术栈，团队效率起飞。</p>
<p>选错了技术栈，就是几个月的坑。</p>
<p>希望这篇"跨平台开发地图"能帮你避开那些坑，找到最适合你的路。</p>
<blockquote>
<p>如果看到这里的同学对客户端或者Flutter开发感兴趣，欢迎联系老刘，我们互相学习。</p>
<p>私信免费领老刘整理的《Flutter开发手册》，覆盖90%应用开发场景。</p>
<p>可以作为Flutter学习的知识地图。</p>
<p>—— laoliu_dev</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[初识 ACP （Agent Client Protocol）]]></title>    <link>https://juejin.cn/post/7574992086714630159</link>    <guid>https://juejin.cn/post/7574992086714630159</guid>    <pubDate>2025-11-21T08:41:55.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574992086714630159" data-draft-id="7574749664492519458" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="初识 ACP （Agent Client Protocol）"/> <meta itemprop="keywords" content="AI编程,MCP,人工智能"/> <meta itemprop="datePublished" content="2025-11-21T08:41:55.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="魁首"/> <meta itemprop="url" content="https://juejin.cn/user/3817931570691031"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            初识 ACP （Agent Client Protocol）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3817931570691031/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    魁首
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T08:41:55.000Z" title="Fri Nov 21 2025 08:41:55 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读15分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#2b2b2b;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(159,219,252,.15) 3%,transparent 0),linear-gradient(1turn,rgba(159,219,252,.15) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin-top:35px;margin-bottom:10px;color:#4dd0e1}.markdown-body h1{font-size:30px;text-align:center;position:relative;width:max-content;margin:0 auto}.markdown-body h1:before{position:absolute;content:"";z-index:-1;top:-20px;height:100%;width:100px;left:0;right:0;margin:0 auto;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA6CAYAAAAOeSEWAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAABkLSURBVGhDtZoHnJ1llcbP3Om9ZiYzmfSQhCQQIbRQVQKI9CYC68qKriJK0UXcZRcINqStIoiIqKCi1NACQihBWiCkkJ5MJlMyvd7p7d759v989/sy34yTbIj48Atz71ff855znvOc971xDrB/EtoGI7a9Z8Aq+wZML0mNj7dE95NZ1OKsj1dHo1GbnJpss9OTbWJyonvun4VP1Njuoagtb+m0it4By0iIt8LEeMvkr8XFWcfgkA1gYDLf47i2PzpsyU7UspKSLDoctagTZ7Vc08MzClMS7awJ2ZaflBB78CeET8TYla1dtrKt2w5KS7YCDGzEoz2RqKUmhGw6x2bhuXyOp2BoRXef1Q1E7Lj8TIsMD1sbxu1kcnYSAX1810RMTUmyMB7f2j1gC7NS7byinNiL/kH8Q8a+2NRh77b32El56VaPAe0YeGR2mh2bm+FdMRqP1rbZe+3dFsHT35qcb/Oz0rwzo7Gxs9feYPLS4kM2h8lawee5hPmlJXneFQeGAzJ2F564v7rFzi7Msu3d/Xgjzq5g8ArX8VCNN2vJ28daey0zZJabmGCLslP5HOf+Oygr3UzDGOf+JxrauXfQjslJt+dbuuyMgiwmk+sPAB/b2Lt2NdoMZnuY21qHIvbvUyZ4Z0ZQiXGrWjvsmPxsK4R0nmHA8ZCTQvxVQn5eRipklIBtcVbV1WtHYsjati47ZWKuTUpP9Z4yGk/xDBGe3v1mW4/dOrvYO7P/2G9jRSjf31FnXyaUXiB8r51WaJkM3kcfOSa2FR6qarIenooTLQHPLcC4mYThyw1tVpKWYlVERlZ8nC3Oz3Jzdn1nn5uvQ8OOHYvhR/CvsqffJbkCkZTvcYZ6Z0WTfTovw5Y1dtjXp+TbFPhgf7FfxpYxuMfr2uwo8rEtMmwXF+d6Z8wGmIR2PLyjo8cqOFffP2SLGexJEJCP9R29thkPXlpa4A5Y3w/jmuVNYYwO2QkY7WMtz3mVcE1hkualJdmSolzX8GnpKd4VZq80d1o7zN0RdWxGaqItgbn3B/+vsasgh/UMNBOvzYMZDxtDKp289KGaVguFQvb1yQWWwuB97GaSXqUUnVaYbSUwrDCEBz/C2CM8EhNrP13fbkeSh3OJgCAe2N1CWXKsGOc6TOr5U4q8MwYhDtkTda02MyPN+nnGBQEH7A37NHYz5KOZVv08qyjbSseEzKauPnsMj98wc6Ibcj5UUv7M8QWZTE52jEwGOVaD8U1Dw1YNWX0qM8VKyb80L/TrOPYOzH4KBJQTrK8M7+7KZjuM63sHBt17FubGoibCuf+tarWFGUmuwWeT8/vCXo1tZOYeZcazCaez8MwEzzM+HqhqtiJI5twxL1jeGLYk7jmKMF1JOCbg6Qj5nAdRqX7q3BYm8VAmQvW1lfcMc58IT95uIA3q+gftrDHPXUXJWkVEHJme5Bp5UmHsvIZ/O3l8ECE/FWcsItX2hr0ae8O2Wjs+J43QTbOZzGYQ/7Wtxq6eXjRK3r0By4YJ6Ty8EiYSJqcm2eGeV4Pox/ANENJR49RiEdfqcLflUJrEBZqgxYHrBjn2ExFURqKdVETN9YirJxKxR2rbrYeQv5ISmB6IsiDGNfZGWPeMgkzr58xnPaJ5p6XDZPKz4T77wayJ7jGhhXLwanOHTWBgq5n5q6YUwNJ7l3kKcRl7OJ7fF56l1GzvHbSD8dghTPi0wIRfv6XafjJ3ssv0PnZQ7nZx/etwzO1zJ3lHR2OETTw8x0tOx1AN3De0D7YV+63oGthjaJQ5Ur7eVVZjcdGInUyuaT73ZWg3efV8fZs7cc2E777Qi5eunVbghvPPymrt/krKGfcLd8ybYjdxrK6333Z09rjHZkNuLYzz0uIc+xWCZzz8nbHbe4dsY1e/XUOY+nimvtUaSazv4jXhaQasSbmYmpuenGwHZ8TKggSEQm08rMD7ahBOoExcMqXQegjnZ+CEvaEa1ZQUQkt39dj0zDS7krq+ARmpdws/nlNqD9WFbWN7l5u3wr9MyrcXKUsqWy3jTOaoML4DdaQ83YIoT4VYpEXvYQZLmbX5SLohBrgOj186Kc/iKTUPUhq+Rrm5ekOl3TWv1Mr6hqwbY0VOQXwEo+Moq4Z47q5qsU489G944LyJOW4LOLZOKtT/iI6+nGe/0dhuEd4ltj2NmiuCU4hnk5fHIi7+RK4uTEu0e+s7rAiRcw1CYy3OejvcYz+eXeI9MYY9nu3lYZl0KavJJ7Vjibzgjp319rUZE20j7CkJqFr5JQYgQ39f3eQaKpQk0afy8nl4uBzvjUUTRk7k3iebOm0pabDiyFn2XGu3dRME41CGVeBVqSiVnc6hIUpekp1VjHLDSOEcQlui5W/U8C7IKREjv1Gabw3wRwUTvpv7jybPtzHmIPZ49q6KRjuccqBQVCOtGvqXhrCFUUXJzOYSHt7Kw5Ix9H08dSje1o1JyL73IYXpEMmE5CRbw6wuykx2pR+Pd6/J4JpLiJKV6N9OnrcQNfQ0Zem6qQX2MmFXyWTE+DMO0kGx4e08DEjnXbsYuOq7niHB8jdY/wQ8Srm2XCZZUrOakF1CY5EKX0h93Tu/1J4kRdbDMT8MamgZK9xe3uDcvrPe++Y4f61rcZr7B53rN1c5N2ytcV5rCrvHt3T2Og19g+5nH7dvq3bqunr4NOwgK2MHA1jeEDuG7HNuLmtw7qpocl5t6nCPvdTQ7v4N4u3WTqeyu9cZHIo4f6lqdFoHh7wzMbzDeeGv3Hvzjlrnh2W1zofhHuftxpFn3VFe7zxS0+p0DlKVPbhhvBxhvwiFMgfP+mjHA08gEC4pybeLyK1iZldh8zC5VJQyUl8l59KZ0WJk2xaiYWxNrkXXJhA8r3PvZRur7ZZZRfadaRPsfiTmX9HGajC2tXd6V8dQTMhX0h8rNdJx9Ra8F8SbRNLzhPRnJmTZIUTYueTyWxyr7uv3rjC3OkzE8495oS+4xq6D5WoI0bO5WVCOSerl8rIeBrOI/Hkaw6ME5W1zSuzx2la3CRdWi3zIG+FDBvUp9LMgI/vggUmE7KkT81yGvOOgEYa/aUahhRAF5xLec3OzbF1r2O17BbVxIi7hzJIC64IYhXdJA+nh/5xVbOmE9J0QqjSxWk0pp37M2YEtgjS8GpimACu7xkqxdKJ6fEXyYl2Lre0ZtC8yELVewtWUnbfCPIhrvgDFz8WI5yhJKgcnFMZWEFrwhgzo5uWDDDA1oGSOzcu0xfx7vTlsv6posIMpJ6cGWPiw/BxL4PU7vbrpjgf8bMdu5OYwOdhm83DARUSa0ELknYIeEAaILuWxlhGa0M8+EuJCrpJT+ymENhN60pXBxa3LZ5TsucnlGaCmIEQ4Evru91yuz0xMtKaeXluI5zdh9Mm8vAlBn4aR07X64EH3vEKdXQkZJXPP/JxMvNRpLxEtHZ5RQgmNewnpouvVTpYTHdfOnmy5kFUGnpRTfEhXD9DiBdFFJB0/YWS9aj6pmc89r0BaQmgTRkgI+EsdKsYasJZOBF+QqTH474NK7LbyBvf7W+RgOxNyxfQY2/2hrp2+NkroxrzrQ55fSZkpJIa28znCgF6rb7H1hOSslATyvNflAh9pvHcX3lVE/Ya8FjTJIexa2Rq77nfU96unTnD7aME3+TAm6BFKYrPnqCNIqV5sq0ZGCiEV+Db+qWMQqpFgb5KPx48R6omeDl2EuP9DTYt9iGA/f1KBS1w/La+H4ktsSmLItvZHXLUkrCeflVtJ9DVVg1H7+sxiGvVM975rZpfabuqHVhuP5F1vewav5O8GamUe91yDanoYw47FWzC929O+DJnKA2opFY1Rjru5CE7kOcO0jJtQVUIynzuZEMeb+1CEOFXN8iFSGeRpCm1BTlJxVg49Azm819SO7Bu0axEbwn27GuxMck+TMQHDP8fn48gfDVIL4R8xKVPJ73MQBUIfA/Z54LMw5vmlE+w+VFo2A78X/SsyPA/RMD0z3e2qVLtfo7aeBslpMX0N0TEnLcUlKym1jyBFqSohmYntI5enBhYB9CY/2kNarhwJhNiMtRGyWnkQdKaCFyQwgydjyNUw4VchKxXv2/DoKdC+lkQbCX1NlKCGvJiBJkSGbCus6jfo4yGBNySgr+u7e20BCsxdVAcFlJ/tHd32+cIsNxSXUULUUx+dg/d47g7OPYFw2MxkSuyMwLHVTI6PBN6dS8Sppw45zHJSgDXV3aQzmz40Z6fDgBfiAXU0uZxby2zejee+j3eltoQMzhV6qSBogXwrEXDj7ElWxUQ8RrnSaoU0dxIsKaiMvMykXTu90NqJsGHP4z78SdLigUrLKat32nFwy/E07pfDFRdQ/7N5r57pQ1482uvWhMGhQcviGkVrKDUp0ToCxfhQal5n4Hs/g1jOgH4LWdwFOd1b1WzHET4vLZppv+Czjxo840OrDlG8jAJzv2tp5mLK1dsU/lfIOeWy5NxFxfl2BoYImlQtx9QF6mJRQKBsQYYuO2yaLYPBUXvu/VqYPxtHhNy7Y4hCkNLGPtKSklzCVKSHtMQxcqm5Kw1DhI2PTGZtcGDAvoLQ/u7MifYtWFBlxz2H9zo8RkwKzC5UYiG+p44ccqE62YAxLeT/TOpf8MXx8Qk0IJFRY1Go+viQVJpE5Ehjf49xfAZeqGIy/7us3nqxwQfCkjZypPxobVr/6YpQHIalUvuCyEwbSXC9PC8QnkFcXlrgLpoLIhIfKuaqlQkYIAwQnr/f3eyu7KttOw2lNpv8/BPHyjzVNER3o72gvEBKqRMTflndbP8BMweRDyeciEj5bFayFXqTLzheivgYJC0jwzwHa0MDDEotm48ndze5BBBElAnxxcRYHAFh3FfZaA9UNRmC354kNwUx8eHkmVj5dcTE5ZMnuEyr1QqlhtaJLuOYZv4v3KNo0TKrGPUZ1NILPKuWcvVn5Trv10SMB6h0j/ARMnlOuafCBIfnSWEx/Raif3HDzofYMM31dOyY9LBaLK3TjoX2fEqT4+2qaUVWSTQvyM6wC8nNJyEetXIyuLKrx04P7MKNnbJZlKUtNAIHo7i2dA/YU3Vtdi5l6jCepXy8hOedSSSsI8/HQg5Q+gxTKXwkMHkbESo+hjG0lbRRzQ3Fc5LOzDuFhs3Ptumpie7ilRDhlEJOq/hjsZljCxjkt7fWuPS/EekpXMggJQIk0G+eN9Xu2VmHWIkJe0nJRN4ptBBit2yutG9ML7J1DHAxebiAMrZ4VZlduqGS8I2tJc2iborUxmIN79c+kTovFxivPvrcSaP3n7RSKYTUmKt4N3rMOcw4JOneD3sP956jNaMglIeTER5Xbdlt15Tm2W10NEsYrA/N5JLCHHsR9tSqwxq08G3bqm1ZTbOtagnbo6SLvH/VzBL7W7jPzqFea0LmMLFzUuLtdwumuO3i1Vtq7OK15Xgw3l1PDmIXak+6QBEkvB9YJIzBcc/L20JIYaSZ/qAzVm5Ut4oowk3QehC+N3xo/1wTqt7zsYawfX9no9XjqdPXVLhrwyo/wucJYQkE1e4j8rLcBuHUItQQKqgMXb6LGvxFQlXw33AdZLR0V5P9Fr29lP73scNnosoyvdWPv4fPJ+uJrLVtMakqaL1M1cTvv0OLIZE6wk2a2IcIRUQh+DaejpdcXepBa7bKDRGM9PIVxTl2EwarZ72rooVuY4RQtMypdk6e1lLLehhY2lt7QEd7WxlCDvdIli6E9B4+ZIodmZEMccUGqgiZOqru9tkR3iJ8nCcXRWRZCSPMLPEjlx2LjQL1OM5qKAm+vhSuRqSfV5Ttrg8FdWcrnhMqCTex7DEM6qTsVEuM1+8hovaHQ6e6a1Fz0xLd3nUt4ToWWuzWNkhcoAIIjUx2ZpxjLzWF9+SYmngR1lok4TEoJxGfuijhI/7OICoFmadl2llcL9b1oRVJtbD+JLlv1KrhHG5811t9ELbzgk14ICUwqE+TDzftqHPz98vUSy3jSIwP8dCpkNqLDPTx+rArz4T5qLG3G2PrvJKKPoLBWE501NC3ilUX5mVjVIb9nIbgWcpPMiSXjbcL8K62UkR86m1/yfkSeMaHFuK04X0CE3J6SWzFUxw0BSNHlSzi3RmIRJwHq5udO3c16quLp6sbnffbupxbt+12vzOrzuvNHc7ycRbIxuJHgYU7YSASdQgxp7qz2ynv6HJeqW91doa7nLruXof+17sqhhu31Xif9o7HalqczV29Dnrb/f5EXZvzdH27U98/6LR5i3N0UM5zjHU71/lwjRWWltU5CAIn7F1MqLp/r9hQ5RoaxG+qmrxP4yNKcfsFLwuiprffeb2l03m2scO5h3Or2rudzjGrhk8x4Cqu2xcexilBvNEcdi5Yu4tKF3Ue4tzPy+td5/1md4tzw5iJ27NuXEYobYUdlb8z6GTWkdxaCvk2zHjd5mpKQ459mv5TkAp6mQb9Aq9HHQ8S6mrZnuc6vUG6WHusIhCJGNXl9byvnJyaiE7+Eoz8c5TYNQiUveENGpJpcIJ+biS8R0+rlcazGNs7pKB+zPLTOSX2KNWhlDAf4r2Spj72JORB5OyHULX+dlD/FOky/HFy5ygYU0sey/i8moeqdunXK1qC3RuaMOYHlI/raQMl3M+EeTV5WxD3Km8a8PkM8nr648sQ9+esKbf5e/nxiKBfAOQkxbv3SU9LYmqPV9V/Pn+V20VwTyVjTqCI6edEQUOFUXs9WmfSll8DyX2dt7GlnwkswaM3l9XZ0oNK3MTXbxpOV2sGk69s6XCJw4cY8KbyRrt9TrHt7Bm0rRBQe1+fHUWNfaapU0KbqxzbORC1M/LS3dJwIl3KOrwykQG/E+61q+isgniztdOKqNOziDgZqZIzFwPvqGiyg5NCtoCqoG5NxHhPZTOsnORulKskjoKMDeLuXQ3OmnC3syxARFXdfc57LR3OrdtrvSOOs55rnqhtcdoGhpxHdjc5EfJUuHZTlftX+G15rXPlhkrnLe59F7Lz8VGHdg8c5y2OLeMZ126qduq9XC3v7nd+FchLvYPJd15gPCu8XQnh/qpm59WGVudZzvvQO97kXTcGxhnEuJvR39tWY8cwK4uhcikk4a3Gdstg9l5B2t0wfaTdWkEou5vCPOV5PH73vFL3+DfXltnh6OxjkJD6Wd5F3g88tMe6CW/7YmI99VIL4u0oqUK8ocW4d8hFrXMVoOQU8s3U97MnjvDD/XRYkyhHM1MT3GVZQR2Tdv70U8EbA5vlo+CaPAaaSWoZXm50otGodxQ6L6txGKxzw5ZYORrBsPPrykZKQIy1n8bTjwb2fO4Te3ue7x6KOKvaYns1wtIddd4nx3mwot55qyl2360cp81zurg+CGqwU8v4/Of5uAVvPgObrwvHomY8jOtZ4fXWLnefdHVXv9044+8ZklCx75DXwcV1Sb27y+vInUQEuVYSaMgRJYfAwtoj0raFxIUW1A8nz35f02qLc9Lc9lG7CBkwtUR7bf+A+5uL6ehnH9Lat+5sIEfj3Cbj3NKRvP7Rjlo7FSmqavKvpSP8MRZ7NVbQYLSkqlC9ZW4sPH18gBTcORjrhMWmQWzFmK2UsvO90qQ1oZcI8UhkCLZPtRqMy0NirobAvjIpb4/sW06qKGyPR2oGIdlazjOOTk+kLYzaaYGSp63Wz6HsXsQ51wd+LTAuZOy+8GBNq7tF+IOdDU4kENJthNID5YRafZtzZ3mDs9LbRgzixcZ2l1h83OKFbDmEd0/FiFp7DWHgp0AQGzq6nf8hPF+oa3EehOz0ziCWcm4NpBRMhX1hn571oR9wqVVSDVPtUi32sQ0vbu7scZdY9aOt2ZSEL9BEBIW+dv20AKDd9/ep09oimYqHpyImkKDuRllS4PrlHNuIqDmCJmNJQba7q1joEaUQJuR/WdXsLrJrq/L6cdJsPOyXscJ7GLKqo8cOpqhrO//yQG6oS3kZwS9xPkRB3wi7diFMtDN+PLk5m1ath+8f0Fy80dbjhvVXub+U5mEqeal27UP+dWpPlknNxW79Ak6/7Tg3UMOF52j1xA1qK7Trd6nXC+8P9ttYQcumIonLSnJtBdJNa77axw1C2x3qR4Wqnj73x9f6MbV+CCYFBZO6y51aSh3gzVrsmwzJnULEbCJC1oZ7vIZ/9Iqmfvn2u5oWO5n8fApxcuWUApum5diPgY9lrA9EtvUNOzYf8vqAcJPsU5iOh7XtXQgt2uZhjKU2amF7HQyfEYWcZk5yQ1RDKNrLcq02k/9IGmldrB93KiokPw8EB2SsoKWXO5FmxXhlckqi+3vEUvLqwok5PHVkIWAszlqzy1p54zuLpnPZ3q9bod08JlLSb5DrNxDm38Sbvsg5EBywsT7oH+3XNW3uasGirFSrxRNdCllKiPZHZzJYLZb5qEcpae3pxMCuu9oibS5/QCOiLcYUrp+MmtJeURjFdVlxzqiae6D4h40NQt54HyGv3JRo10aVfv8YhtC0pSlVKcPFuxIXahr08mzCO4VzMlLSsZuomZ+RaucU0rXsw/sfF5+osUFonWob/7TrLdaUgdpV93fl9X+VIC0Y6tek2uI8OD3J5gT2Vj9ZmP0f4IM4iY7RQ5gAAAAASUVORK5CYII=) no-repeat 50%;background-size:64px 64px;opacity:.84}.markdown-body h1:after{position:absolute;content:"";width:150%;left:-25%;height:50%;bottom:12px;border-radius:50%;background:linear-gradient(transparent 80%,rgba(77,208,225,.8));background-size:400% 200%;opacity:.6;animation:h1Animate 6s linear infinite}@keyframes h1Animate{0%{background-position:100% 100%}50%{background-position:100% 50%}to{background-position:100% 100%}}.markdown-body h2{display:block;border-bottom:4px solid #4dd0e1;position:relative;font-size:24px;padding:12px 32px;margin:30px 0}.markdown-body h2:before{width:24px;height:24px;left:0;top:0;margin:auto;background-size:24px 24px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADGklEQVRYR81X32vTYBQ999s6mFjQgQ+DrbHiVFZYU4cDcQ/6pGhTFVYFEXGi82H+Bz448UnEF1Fx9ccEEcXpZE3d5tP2ooKiTacTHaLNpigMHDgnU9tcSbrWrkwWR0sbyEOSe885ObnfvV8IRT6oyPwoLQHBx+OVM5WJvSyEVAhnBOjt7yU/+/rr6r6l8TMO+F/EN0JQhICqQpD/xaRpcpAc9tS+M+9lBCia/oqBamK+zeDuQogQZaKJk3wcQjxSva7tGQGB2Ke1zIk3DNyMyNL+QpCnMQOaPsDAVuGAp9cjvbYc8Ec/bCYSg0zoiHilk1tHxqsqEsYlML4kjIpT/eurJxRNPweQU5VdrWaOEo1fgKAVbBgXIz73kF3R/ph+ghgdzMYWM29eAWlBJqgZaFlFYtC6nhWpaDqnSGlIlV1WjJ3DloDNgyNLncudqgX//Ucg3LxuStHGuhi8pqKCW3rqV342rwFjRznKm+/LNaN2yC237ThgF2wxcfMLeP6+ncrKzoPoKTGeLQbYbg4TNoC5iZPJY5HGVRdSNZAWYBclD3FzBQzrR8hACAKdzBzKA/4/IYioDQaOskBbpEG6PO8qKKSAEi3CnEb0Pw4oMf0OmKbTDWqh3Lw6EIiNBZi5lxh3wz4puBD5ovqAMvxhHSdFKxE1CQe3m/07TeTX4lcJdAhE+1Sv65Z5P/ByvIGTRowIZ9igbtXnmrOsbTvgj+kHBNMuBu9OdVw8EeU4nC1A0cYmAHZOTRrLhra4Z8ywnSN6vZHAFTA2WnnMfQB3qz73ddsOZM8CACFDIPSgQXqebXEgqgeZcAeEe6pXasm1f8ew3igMtAHWac0Uc/jYdyAaP0xEBwFsmgUPqbJ0NE2UKj4EGcahiOzuyhagaHpnmtgcVgTcCMuua7YdyAHbA3ArQNscVFbb4635aD6fnYaTvxxi9UNP7ddMXaRWVBdAcaLk6bDXPZCNZ9uBXEsDUX1T2Cc9yjig6Z0EHg3LK8/aqf6MwJKchkXfks1+0+JtSq3qLPa23BRR1B+T/6nkfMaW1r9hPt/MLtYfTLEpP+T9FNoAAAAASUVORK5CYII=)}.markdown-body h2:after,.markdown-body h2:before{content:"";display:block;position:absolute;bottom:0}.markdown-body h2:after{right:0;width:400px;height:10px;border-top-right-radius:24px;background:linear-gradient(90deg,#fff,#4dd0e1);max-width:50vw}.markdown-body h3{margin:30px 0;font-size:18px;position:relative;padding:4px 32px;width:max-content}.markdown-body h3:before{border-bottom:2px solid #4dd0e1;width:100%;content:"";display:block;height:28px;position:absolute;left:0;top:0;bottom:-2px;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);background-repeat:no-repeat;animation:h3AnimationBefore 2s infinite alternate}@keyframes h3AnimationBefore{0%{width:28px}25%{width:100%}50%{width:100%}to{width:100%}}.markdown-body h3:after{content:"";display:block;width:28px;height:28px;position:absolute;border:2px solid #4dd0e1;border-radius:50%;right:-15px;top:0;bottom:0;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);animation:h3AnimationAfter 2s infinite alternate}@keyframes h3AnimationAfter{0%{transform:rotate(0)}10%{transform:rotate(0)}50%{transform:rotate(-1turn)}to{transform:rotate(-1turn)}}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin:22px 0;letter-spacing:2px;font-size:14px;word-spacing:2px}.markdown-body img{max-width:80%;border-radius:6px;display:block;margin:20px auto!important;object-fit:contain;box-shadow:0 0 16px hsla(0,0%,43.1%,.45)}.markdown-body figcaption{display:block;font-size:13px;color:#2b2b2b}.markdown-body figcaption:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEVHcExAuPtAuPpAuPtAuPpAuPtAvPxAuPokzOX5AAAAB3RSTlMAkDLqNegkoiUM7wAAAGBJREFUKM9jYBhcgMkBTUDVBE1BeDGqEtXychNUBeXlKEqACsrLQxB8lnCQQClCiWt5OYoSiAIkJVAF5eVBqAqAShTAAs7l5ShKWMwRAmAlSArASpAVgJUkCqIAscESHwCVVjMBK9JnbQAAAABJRU5ErkJggg==);display:inline-block;width:18px;height:18px;background-size:18px;background-repeat:no-repeat;background-position:50%;margin-right:5px;margin-bottom:-5px}.markdown-body hr{border:none;border-top:1px solid #4dd0e1;margin-top:32px;margin-bottom:32px}.markdown-body del{color:#4dd0e1}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(77,208,225,.08);color:#26c6da;padding:.195em .4em}.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#4dd0e1;border-bottom:1px solid #4dd0e1;font-weight:400;text-decoration:none;margin:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(77,208,225,.1)}.markdown-body strong{color:#26c6da}.markdown-body strong:before{content:"「"}.markdown-body strong:after{content:"」"}.markdown-body em{font-style:normal;color:#4dd0e1;font-weight:700}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(77,208,225,.05)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{margin:2em 0;padding:24px 32px;border-left:4px solid #26c6da;background:rgba(77,208,225,.15);position:relative}.markdown-body blockquote:before{content:"❝";top:8px;left:8px;color:#4dd0e1;font-size:30px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"❞";font-size:30px;position:absolute;right:8px;bottom:0;color:#4dd0e1;opacity:.7}.markdown-body blockquote p{color:#595959;line-height:2}.markdown-body ol,.markdown-body ul{color:#595959;padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">初识 ACP 协议：AI 编码助手的标准化通信协议</h2>
<blockquote>
<p>从 MCP 到 ACP，探索 AI Agent 生态的标准化之路</p>
</blockquote>
<h3 data-id="heading-1">目录</h3>
<ul>
<li><a href="#%E4%B8%80%E5%BC%95%E8%A8%80ai-agent-%E7%94%9F%E6%80%81%E7%9A%84%E6%A0%87%E5%87%86%E5%8C%96%E6%8C%91%E6%88%98" title="#%E4%B8%80%E5%BC%95%E8%A8%80ai-agent-%E7%94%9F%E6%80%81%E7%9A%84%E6%A0%87%E5%87%86%E5%8C%96%E6%8C%91%E6%88%98">一、引言：AI Agent 生态的标准化挑战</a></li>
<li><a href="#%E4%BA%8C%E4%BB%8E-mcp-%E8%AF%B4%E8%B5%B7%E7%90%86%E8%A7%A3-ai-%E5%8D%8F%E8%AE%AE%E7%9A%84%E6%BC%94%E8%BF%9B" title="#%E4%BA%8C%E4%BB%8E-mcp-%E8%AF%B4%E8%B5%B7%E7%90%86%E8%A7%A3-ai-%E5%8D%8F%E8%AE%AE%E7%9A%84%E6%BC%94%E8%BF%9B">二、从 MCP 说起：理解 AI 协议的演进</a></li>
<li><a href="#%E4%B8%89acp-%E6%98%AF%E4%BB%80%E4%B9%88" title="#%E4%B8%89acp-%E6%98%AF%E4%BB%80%E4%B9%88">三、ACP 是什么？</a></li>
<li><a href="#%E5%9B%9Bacp-%E6%A0%B8%E5%BF%83%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1" title="#%E5%9B%9Bacp-%E6%A0%B8%E5%BF%83%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1">四、ACP 核心架构设计</a></li>
<li><a href="#%E4%BA%94acp-%E5%8D%8F%E8%AE%AE%E8%AF%A6%E8%A7%A3" title="#%E4%BA%94acp-%E5%8D%8F%E8%AE%AE%E8%AF%A6%E8%A7%A3">五、ACP 协议详解</a></li>
<li><a href="#%E5%85%ADacp-%E5%AE%9E%E6%88%98%E4%BB%8E%E4%BB%A3%E7%A0%81%E7%9C%8B%E5%AE%9E%E7%8E%B0" title="#%E5%85%ADacp-%E5%AE%9E%E6%88%98%E4%BB%8E%E4%BB%A3%E7%A0%81%E7%9C%8B%E5%AE%9E%E7%8E%B0">六、ACP 实战：从代码看实现</a></li>
<li><a href="#%E4%B8%83acp-vs-mcp%E4%B8%A4%E4%B8%AA%E5%8D%8F%E8%AE%AE%E7%9A%84%E5%AF%B9%E6%AF%94%E4%B8%8E%E4%BA%92%E8%A1%A5" title="#%E4%B8%83acp-vs-mcp%E4%B8%A4%E4%B8%AA%E5%8D%8F%E8%AE%AE%E7%9A%84%E5%AF%B9%E6%AF%94%E4%B8%8E%E4%BA%92%E8%A1%A5">七、ACP vs MCP：两个协议的对比与互补</a></li>
<li><a href="#%E5%85%AB%E7%94%9F%E6%80%81%E7%B3%BB%E7%BB%9F%E4%B8%8E%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8" title="#%E5%85%AB%E7%94%9F%E6%80%81%E7%B3%BB%E7%BB%9F%E4%B8%8E%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8">八、生态系统与实际应用</a></li>
<li><a href="#%E4%B9%9D%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5%E4%B8%8E%E5%AE%89%E5%85%A8%E8%80%83%E9%87%8F" title="#%E4%B9%9D%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5%E4%B8%8E%E5%AE%89%E5%85%A8%E8%80%83%E9%87%8F">九、最佳实践与安全考量</a></li>
<li><a href="#%E5%8D%81%E6%9C%AA%E6%9D%A5%E5%B1%95%E6%9C%9B" title="#%E5%8D%81%E6%9C%AA%E6%9D%A5%E5%B1%95%E6%9C%9B">十、未来展望</a></li>
</ul>
<hr/>
<h3 data-id="heading-2">一、引言：AI Agent 生态的标准化挑战</h3>
<h4 data-id="heading-3">1.1 当前 AI 开发工具面临的问题</h4>
<p>在 AI 辅助编程工具快速发展的今天，我们看到了各种强大的 AI 编码助手：</p>
<ul>
<li><strong>GitHub Copilot</strong>：微软的 AI 代码补全工具</li>
<li><strong>Cursor</strong>：AI 驱动的代码编辑器</li>
<li><strong>Claude Code</strong>：Anthropic 的智能编码助手</li>
<li><strong>Codex CLI</strong>：OpenAI 的命令行编码工具</li>
<li><strong>Gemini Code Assist</strong>：Google 的编码助手</li>
</ul>
<p>然而，这些工具之间存在严重的<strong>互操作性问题</strong>：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB
    subgraph "现状：信息孤岛"
        VSCode[VS Code] --&gt;|锁定| Copilot[Copilot]
        Zed[Zed] --&gt;|锁定| Agent[Agent]

        Claude[Claude]
        Gemini[Gemini]

        VSCode -.X.- Claude
        VSCode -.X.- Gemini
        Zed -.X.- Claude
        Zed -.X.- Copilot

        style VSCode fill:#e1f5ff
        style Zed fill:#e1f5ff
        style Copilot fill:#fff4e6
        style Agent fill:#fff4e6
        style Claude fill:#f3e5f5
        style Gemini fill:#f3e5f5
    end

    Note["每个编辑器只能用特定的 Agent&lt;br/&gt;用户无法自由选择和切换"]

    style Note fill:#ffebee,stroke:#c62828
</code></pre>
<p><strong>核心挑战：</strong></p>
<ol>
<li><strong>编辑器锁定</strong>：用户必须为特定 AI Agent 切换编辑器</li>
<li><strong>重复开发</strong>：每个编辑器都要为每个 Agent 单独开发集成</li>
<li><strong>用户体验割裂</strong>：不同 Agent 的交互方式完全不同</li>
<li><strong>生态碎片化</strong>：难以形成统一的开发者社区</li>
</ol>
<h4 data-id="heading-4">1.2 标准化协议的价值</h4>
<p>正如 <strong>Language Server Protocol (LSP)</strong> 将语言智能从单一 IDE 中解放出来，我们需要一个类似的标准来解决 AI Agent 的互操作性问题。</p>
<p>这就是 <strong>Agent Client Protocol (ACP)</strong> 诞生的背景。</p>
<hr/>
<h3 data-id="heading-5">二、从 MCP 说起：理解 AI 协议的演进</h3>
<h4 data-id="heading-6">2.1 什么是 MCP？</h4>
<p>在介绍 ACP 之前，我们需要先了解 <a href="https://juejin.cn/post/7555815079645036598" target="_blank" title="https://juejin.cn/post/7555815079645036598">MCP (Model Context Protocol)</a>。</p>
<p><strong>MCP</strong> 是 Anthropic 推出的开源标准协议，用于连接 <strong>AI 模型</strong>与<strong>外部系统</strong>（数据源、工具、API 等）。</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    AIModel["AI Model&lt;br/&gt;(Claude, GPT, etc.)"]

    AIModel --&gt;|MCP Protocol| MCPServers

    subgraph MCPServers["MCP Servers"]
        DB[Database Server]
        FS[File System]
        API[API Services]
        KB[Knowledge Base]
    end

    style AIModel fill:#e3f2fd
    style MCPServers fill:#f3e5f5
    style DB fill:#fff3e0
    style FS fill:#fff3e0
    style API fill:#fff3e0
    style KB fill:#fff3e0
</code></pre>
<p><strong>MCP 的三大核心原语：</strong></p>
<h5 data-id="heading-7">2.1.1 Resources（资源）</h5>
<p>类似文件系统的只读数据源，供 AI 模型读取上下文。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// MCP Resource 示例</span>
{
  <span class="hljs-string">"uri"</span>: <span class="hljs-string">"file:///workspace/README.md"</span>,
  <span class="hljs-string">"name"</span>: <span class="hljs-string">"项目文档"</span>,
  <span class="hljs-string">"mimeType"</span>: <span class="hljs-string">"text/markdown"</span>,
  <span class="hljs-string">"description"</span>: <span class="hljs-string">"项目需求和架构文档"</span>
}
</code></pre>
<h5 data-id="heading-8">2.1.2 Tools（工具）</h5>
<p>AI 模型可调用的可执行函数。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> mcp.server.fastmcp <span class="hljs-keyword">import</span> FastMCP

mcp = FastMCP(<span class="hljs-string">"code-tools"</span>)

<span class="hljs-meta">@mcp.tool()</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">run_tests</span>(<span class="hljs-params">test_file: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">str</span>:
    <span class="hljs-string">"""运行指定的测试文件"""</span>
    result = subprocess.run([<span class="hljs-string">'pytest'</span>, test_file], capture_output=<span class="hljs-literal">True</span>)
    <span class="hljs-keyword">return</span> result.stdout.decode()
</code></pre>
<h5 data-id="heading-9">2.1.3 Prompts（提示模板）</h5>
<p>预编写的任务模板，标准化常见操作。</p>
<pre><code class="hljs language-typescript" lang="typescript">{
  <span class="hljs-string">"name"</span>: <span class="hljs-string">"code_review"</span>,
  <span class="hljs-string">"description"</span>: <span class="hljs-string">"代码审查提示模板"</span>,
  <span class="hljs-string">"arguments"</span>: [
    {
      <span class="hljs-string">"name"</span>: <span class="hljs-string">"language"</span>,
      <span class="hljs-string">"description"</span>: <span class="hljs-string">"编程语言"</span>,
      <span class="hljs-string">"required"</span>: <span class="hljs-literal">true</span>
    }
  ]
}
</code></pre>
<h4 data-id="heading-10">2.2 MCP 的局限性</h4>
<p>虽然 MCP 解决了 AI 模型与工具的连接问题，但它<strong>并不解决编辑器与 AI Agent 的通信问题</strong>。</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph LR
    Editor["编辑器&lt;br/&gt;(Zed)"] -.-&gt;|"❓ 没有标准协议"| Agent["AI Agent&lt;br/&gt;(Claude)"]
    Agent --&gt;|"✓ MCP 协议"| Tools["工具&lt;br/&gt;(DB/API)"]

    style Editor fill:#ffebee
    style Agent fill:#e8f5e9
    style Tools fill:#e8f5e9
</code></pre>
<p>这就是 <strong>ACP</strong> 要解决的问题。</p>
<hr/>
<h3 data-id="heading-11">三、ACP 是什么？</h3>
<h4 data-id="heading-12">3.1 定义</h4>
<p><strong>Agent Client Protocol (ACP)</strong> 是一个<strong>开放标准协议</strong>，用于规范<strong>代码编辑器</strong>与 **AI 编码助手（Coding Agent）**之间的通信。</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph LR
    Editor["Editor&lt;br/&gt;(Zed)"]
    Agent["Agent&lt;br/&gt;(Claude)"]
    Tools["Tools &amp; Resources"]

    Editor &lt;--&gt;|ACP Protocol| Agent
    Agent --&gt;|MCP Protocol| Tools

    style Editor fill:#e3f2fd
    style Agent fill:#fff3e0
    style Tools fill:#e8f5e9
</code></pre>
<p><strong>核心理念：</strong></p>
<blockquote>
<p>就像 USB-C 接口可以连接任何设备，ACP 让任何编辑器都能使用任何 AI Agent。</p>
</blockquote>
<h4 data-id="heading-13">3.2 设计目标</h4>

























<table><thead><tr><th>目标</th><th>说明</th></tr></thead><tbody><tr><td><strong>通用性</strong></td><td>任何编辑器都能集成任何符合 ACP 的 Agent</td></tr><tr><td><strong>隐私优先</strong></td><td>本地通信，不经过第三方服务器</td></tr><tr><td><strong>开源开放</strong></td><td>Apache 2.0 许可证，任何人都可以实现</td></tr><tr><td><strong>可扩展性</strong></td><td>支持未来的新功能和新场景</td></tr></tbody></table>
<h4 data-id="heading-14">3.3 与 LSP 的类比</h4>
<p>如果你熟悉 <strong>Language Server Protocol (LSP)</strong>，可以这样理解 ACP：</p>
<p><strong>LSP 之于语言智能 = ACP 之于 AI 编码助手</strong></p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph LR
    subgraph LSP["LSP 模式"]
        E1[VS Code] &lt;--&gt;|LSP| L1[TypeScript]
        E2[Vim] &lt;--&gt;|LSP| L2[Python]
        E3[Emacs] &lt;--&gt;|LSP| L3[Go]
    end

    subgraph ACP["ACP 模式"]
        E4[Zed] &lt;--&gt;|ACP| A1[Claude Code]
        E5[Neovim] &lt;--&gt;|ACP| A2[Gemini]
        E6[JetBrains] &lt;--&gt;|ACP| A3[Codex]
    end

    style LSP fill:#e3f2fd
    style ACP fill:#fff3e0
</code></pre>
<hr/>
<h3 data-id="heading-15">四、ACP 核心架构设计</h3>
<h4 data-id="heading-16">4.1 通信模型</h4>
<p>ACP 采用 <strong>JSON-RPC 2.0</strong> 协议，基于 **stdio（标准输入输出）**进行通信。</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    Editor["Editor&lt;br/&gt;(主进程)"]
    Agent["Agent&lt;br/&gt;(子进程)"]

    Editor --&gt;|"spawn()"| Agent
    Editor --&gt;|"写入 stdin&lt;br/&gt;(JSON-RPC 2.0)"| Agent
    Agent --&gt;|"写入 stdout&lt;br/&gt;(JSON-RPC 2.0)"| Editor

    style Editor fill:#e3f2fd
    style Agent fill:#fff3e0

    Note["通信方式：&lt;br/&gt;• Editor 写入 Agent 的 stdin&lt;br/&gt;• Agent 写入 stdout 返回给 Editor&lt;br/&gt;• 消息格式：JSON-RPC 2.0"]
    style Note fill:#e8f5e9
</code></pre>
<p><strong>优势：</strong></p>
<ol>
<li><strong>简单高效</strong>：无需网络层，直接进程间通信</li>
<li><strong>隐私安全</strong>：所有数据都在本地，不经过外部服务器</li>
<li><strong>跨平台</strong>：stdin/stdout 是所有操作系统的标准</li>
</ol>
<h4 data-id="heading-17">4.2 协议层次</h4>
<p>ACP 分为两个核心层：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    subgraph Application["应用层 (Application Layer)"]
        SM[Session Management]
        TC[Tool Calls]
        PR[Permission Requests]
        FO[File Operations]
    end

    subgraph Protocol["协议层 (Protocol Layer)"]
        JSON[JSON-RPC 2.0]
        RR[Request/Response]
        NT[Notifications]
        EH[Error Handling]
    end

    subgraph Transport["传输层 (Transport Layer)"]
        STDIO[stdio - stdin/stdout]
    end

    Application --&gt; Protocol
    Protocol --&gt; Transport

    style Application fill:#e3f2fd
    style Protocol fill:#fff3e0
    style Transport fill:#e8f5e9
</code></pre>
<h4 data-id="heading-18">4.3 消息类型</h4>
<p>ACP 支持三种消息类型：</p>
<h5 data-id="heading-19">4.3.1. Request（请求）</h5>
<p>客户端向服务器发送请求，期待响应。</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"jsonrpc"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2.0"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"method"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"initialize"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"params"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"protocolVersion"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"0.1.0"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"clientInfo"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Zed"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"0.158.0"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h5 data-id="heading-20">4.3.2. Response（响应）</h5>
<p>服务器对请求的响应。</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"jsonrpc"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2.0"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"result"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"protocolVersion"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"0.1.0"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"serverInfo"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Claude Code"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1.0.0"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"capabilities"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"tools"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"resources"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h5 data-id="heading-21">4.3.3. Notification（通知）</h5>
<p>单向消息，不期待响应。</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"jsonrpc"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2.0"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"method"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"session/update"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"params"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"sessionId"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"session-123"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"update"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"sessionUpdate"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"agent_message_chunk"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"content"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"text"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"text"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"正在分析代码..."</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<hr/>
<h3 data-id="heading-22">五、ACP 协议详解</h3>
<h4 data-id="heading-23">5.1 核心方法</h4>
<p>ACP 定义了一系列标准方法：</p>























































<table><thead><tr><th>方法</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td><code>initialize</code></td><td>Request</td><td>初始化连接，交换能力信息</td></tr><tr><td><code>authenticate</code></td><td>Request</td><td>身份验证（可选）</td></tr><tr><td><code>session/new</code></td><td>Request</td><td>创建新的对话会话</td></tr><tr><td><code>session/prompt</code></td><td>Request</td><td>向 Agent 发送用户消息</td></tr><tr><td><code>session/update</code></td><td>Notification</td><td>Agent 推送会话更新</td></tr><tr><td><code>session/request_permission</code></td><td>Notification</td><td>Agent 请求用户权限</td></tr><tr><td><code>fs/read_text_file</code></td><td>Request</td><td>读取文件内容</td></tr><tr><td><code>fs/write_text_file</code></td><td>Request</td><td>写入文件内容</td></tr><tr><td><code>end_turn</code></td><td>Notification</td><td>Agent 完成一轮响应</td></tr></tbody></table>
<h4 data-id="heading-24">5.2 初始化流程</h4>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant Editor
    participant Agent

    Editor-&gt;&gt;Agent: spawn(agent-cli)
    Note over Editor,Agent: 启动 Agent 子进程

    Editor-&gt;&gt;Agent: initialize request
    Note right of Editor: {clientInfo, version}

    Agent--&gt;&gt;Editor: initialize response
    Note left of Agent: {serverInfo, capabilities}

    Editor-&gt;&gt;Agent: authenticate (optional)
    Agent--&gt;&gt;Editor: auth response

    Editor-&gt;&gt;Agent: session/new
    Note right of Editor: {cwd, mcpServers}

    Agent--&gt;&gt;Editor: session created
    Note left of Agent: {sessionId}

    Note over Editor,Agent: ● 连接建立完成，可以开始对话
</code></pre>
<p><strong>详细说明：</strong></p>
<h5 data-id="heading-25">步骤 1：启动 Agent 进程</h5>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// AionUi 项目中的实际代码</span>
<span class="hljs-comment">// src/agent/acp/AcpConnection.ts</span>

<span class="hljs-keyword">async</span> <span class="hljs-title function_">connect</span>(<span class="hljs-params">backend: AcpBackend, cliPath?: <span class="hljs-built_in">string</span>, workingDir?: <span class="hljs-built_in">string</span></span>) {
  <span class="hljs-keyword">const</span> command = cliPath || <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getDefaultCliPath</span>(backend);

  <span class="hljs-comment">// 使用 spawn 启动 Agent 子进程</span>
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">agentProcess</span> = <span class="hljs-title function_">spawn</span>(command, [], {
    <span class="hljs-attr">cwd</span>: workingDir,
    <span class="hljs-attr">env</span>: process.<span class="hljs-property">env</span>,
  });

  <span class="hljs-comment">// 监听 stdout（Agent 的输出）</span>
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">agentProcess</span>.<span class="hljs-property">stdout</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">'data'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">handleStdout</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>));

  <span class="hljs-comment">// 监听 stderr（Agent 的日志）</span>
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">agentProcess</span>.<span class="hljs-property">stderr</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">'data'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">handleStderr</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>));

  <span class="hljs-comment">// 初始化协议</span>
  <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">initialize</span>();
}
</code></pre>
<h5 data-id="heading-26">步骤 2：发送初始化请求</h5>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">private</span> <span class="hljs-keyword">async</span> <span class="hljs-title function_">initialize</span>(): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">AcpResponse</span>&gt; {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">sendRequest</span>(<span class="hljs-string">'initialize'</span>, {
    <span class="hljs-attr">protocolVersion</span>: <span class="hljs-string">'0.1.0'</span>,
    <span class="hljs-attr">clientInfo</span>: {
      <span class="hljs-attr">name</span>: <span class="hljs-string">'AionUi'</span>,
      <span class="hljs-attr">version</span>: <span class="hljs-string">'1.0.0'</span>,
    },
  });
}
</code></pre>
<h5 data-id="heading-27">步骤 3：接收能力信息</h5>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"jsonrpc"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2.0"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"result"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"protocolVersion"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"0.1.0"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"serverInfo"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Claude Code"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1.0.128"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"capabilities"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"tools"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"resources"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"streaming"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-28">5.3 会话更新类型</h4>
<p>ACP 定义了丰富的会话更新类型，让编辑器能实时显示 Agent 的思考和操作过程。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// AionUi 项目中的类型定义</span>
<span class="hljs-comment">// src/types/acpTypes.ts</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> <span class="hljs-title class_">AcpSessionUpdate</span> =
  | <span class="hljs-title class_">AgentMessageChunkUpdate</span> <span class="hljs-comment">// Agent 消息块</span>
  | <span class="hljs-title class_">AgentThoughtChunkUpdate</span> <span class="hljs-comment">// Agent 思考过程</span>
  | <span class="hljs-title class_">ToolCallUpdate</span> <span class="hljs-comment">// 工具调用</span>
  | <span class="hljs-title class_">ToolCallUpdateStatus</span> <span class="hljs-comment">// 工具状态更新</span>
  | <span class="hljs-title class_">PlanUpdate</span> <span class="hljs-comment">// 任务计划</span>
  | <span class="hljs-title class_">AvailableCommandsUpdate</span> <span class="hljs-comment">// 可用命令列表</span>
  | <span class="hljs-title class_">UserMessageChunkUpdate</span>; <span class="hljs-comment">// 用户消息块</span>
</code></pre>
<h5 data-id="heading-29">5.3.1. Agent 消息块（AgentMessageChunkUpdate）</h5>
<p>Agent 向用户发送的普通消息。</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"method"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"session/update"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"params"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"sessionId"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"sess-123"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"update"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"sessionUpdate"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"agent_message_chunk"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"content"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"text"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"text"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"我已经分析了你的代码，发现了以下问题..."</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h5 data-id="heading-30">5.3.2. Agent 思考过程（AgentThoughtChunkUpdate）</h5>
<p>Agent 的内部思考过程，类似 "思维链"。</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"method"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"session/update"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"params"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"sessionId"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"sess-123"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"update"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"sessionUpdate"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"agent_thought_chunk"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"content"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"text"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"text"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"首先，我需要检查 package.json 中的依赖版本..."</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h5 data-id="heading-31">5.3.3. 工具调用（ToolCallUpdate）</h5>
<p>最重要的更新类型，表示 Agent 要执行某个操作。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">ToolCallUpdate</span> {
  <span class="hljs-attr">sessionUpdate</span>: <span class="hljs-string">'tool_call'</span>;
  <span class="hljs-attr">toolCallId</span>: <span class="hljs-built_in">string</span>; <span class="hljs-comment">// 工具调用唯一 ID</span>
  <span class="hljs-attr">status</span>: <span class="hljs-string">'pending'</span> | <span class="hljs-string">'in_progress'</span> | <span class="hljs-string">'completed'</span> | <span class="hljs-string">'failed'</span>;
  <span class="hljs-attr">title</span>: <span class="hljs-built_in">string</span>; <span class="hljs-comment">// 操作描述</span>
  <span class="hljs-attr">kind</span>: <span class="hljs-string">'read'</span> | <span class="hljs-string">'edit'</span> | <span class="hljs-string">'execute'</span>; <span class="hljs-comment">// 操作类型</span>
  rawInput?: <span class="hljs-built_in">any</span>; <span class="hljs-comment">// 原始输入参数</span>
  content?: <span class="hljs-title class_">Array</span>&lt;{
    <span class="hljs-attr">type</span>: <span class="hljs-string">'content'</span> | <span class="hljs-string">'diff'</span>;
    <span class="hljs-comment">// ... 内容详情</span>
  }&gt;;
  locations?: <span class="hljs-title class_">Array</span>&lt;{
    <span class="hljs-attr">path</span>: <span class="hljs-built_in">string</span>; <span class="hljs-comment">// 受影响的文件路径</span>
  }&gt;;
}
</code></pre>
<p><strong>示例：读取文件</strong></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"method"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"session/update"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"params"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"sessionId"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"sess-123"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"update"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"sessionUpdate"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"tool_call"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"toolCallId"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"tool-001"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"status"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"pending"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"读取 src/index.ts"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"kind"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"read"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"locations"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span> <span class="hljs-attr">"path"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"/workspace/src/index.ts"</span> <span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>示例：编辑文件</strong></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"method"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"session/update"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"params"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"sessionId"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"sess-123"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"update"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"sessionUpdate"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"tool_call"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"toolCallId"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"tool-002"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"status"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"in_progress"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"修复 TypeScript 类型错误"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"kind"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"edit"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"content"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"diff"</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"diff"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"--- a/src/index.ts\n+++ b/src/index.ts\n@@ -10,7 +10,7 @@\n-function add(a, b) {\n+function add(a: number, b: number): number {\n   return a + b;\n }"</span>
        <span class="hljs-punctuation">}</span>
      <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"locations"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span> <span class="hljs-attr">"path"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"/workspace/src/index.ts"</span> <span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h5 data-id="heading-32">5.3.4. 计划更新（PlanUpdate）</h5>
<p>Agent 的任务执行计划。</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"method"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"session/update"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"params"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"sessionId"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"sess-123"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"update"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"sessionUpdate"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"plan"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"entries"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">"content"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"分析现有代码结构"</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"status"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"completed"</span>
        <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
        <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">"content"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"识别类型错误位置"</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"status"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"in_progress"</span>
        <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
        <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">"content"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"修复类型定义"</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"status"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"pending"</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"priority"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"high"</span>
        <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
        <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">"content"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"运行 TypeScript 编译检查"</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"status"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"pending"</span>
        <span class="hljs-punctuation">}</span>
      <span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-33">5.4 权限请求机制</h4>
<p>ACP 的一个重要安全特性是<strong>权限请求机制</strong>。Agent 在执行敏感操作前必须获得用户许可。</p>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant Agent
    participant Editor
    participant User

    Agent-&gt;&gt;Editor: session/request_permission
    Note right of Agent: {toolCall, options}

    Editor-&gt;&gt;User: 显示对话框
    Note right of Editor: 用户选择：&lt;br/&gt;• 仅此一次允许&lt;br/&gt;• 始终允许&lt;br/&gt;• 拒绝

    User--&gt;&gt;Editor: 选择权限选项
    Editor--&gt;&gt;Agent: permission response
    Note left of Editor: {optionId: "allow_once"}
</code></pre>
<p><strong>权限请求消息格式：</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">AcpPermissionRequest</span> {
  <span class="hljs-attr">sessionId</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">options</span>: <span class="hljs-title class_">Array</span>&lt;{
    <span class="hljs-attr">optionId</span>: <span class="hljs-built_in">string</span>;
    <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;
    <span class="hljs-attr">kind</span>: <span class="hljs-string">'allow_once'</span> | <span class="hljs-string">'allow_always'</span> | <span class="hljs-string">'reject_once'</span> | <span class="hljs-string">'reject_always'</span>;
  }&gt;;
  <span class="hljs-attr">toolCall</span>: {
    <span class="hljs-attr">toolCallId</span>: <span class="hljs-built_in">string</span>;
    <span class="hljs-attr">title</span>: <span class="hljs-built_in">string</span>;
    <span class="hljs-attr">kind</span>: <span class="hljs-string">'read'</span> | <span class="hljs-string">'edit'</span> | <span class="hljs-string">'execute'</span>;
    content?: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-built_in">any</span>&gt;;
    locations?: <span class="hljs-title class_">Array</span>&lt;{ <span class="hljs-attr">path</span>: <span class="hljs-built_in">string</span> }&gt;;
  };
}
</code></pre>
<p><strong>示例：请求写入文件权限</strong></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"method"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"session/request_permission"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"params"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"sessionId"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"sess-123"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"options"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
      <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"optionId"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"allow_once"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"仅此一次允许"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"kind"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"allow_once"</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"optionId"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"allow_always"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"始终允许对此文件的写入"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"kind"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"allow_always"</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"optionId"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"reject"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"拒绝"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"kind"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"reject_once"</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"toolCall"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"toolCallId"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"tool-003"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"写入文件 src/config.ts"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"kind"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"edit"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"locations"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span> <span class="hljs-attr">"path"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"/workspace/src/config.ts"</span> <span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"content"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"diff"</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"diff"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"... (修改内容) ..."</span>
        <span class="hljs-punctuation">}</span>
      <span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>AionUi 中的权限 UI 实现：</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// src/renderer/messages/acp/MessageAcpPermission.tsx</span>

<span class="hljs-keyword">const</span> <span class="hljs-title class_">MessageAcpPermission</span>: <span class="hljs-title class_">React</span>.<span class="hljs-property">FC</span>&lt;<span class="hljs-title class_">Props</span>&gt; = <span class="hljs-function">(<span class="hljs-params">{ message }</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleConfirm</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">optionId: <span class="hljs-built_in">string</span></span>) =&gt; {
    <span class="hljs-comment">// 调用 IPC Bridge 确认权限</span>
    <span class="hljs-keyword">await</span> ipcBridge.<span class="hljs-property">acpConversation</span>.<span class="hljs-property">confirmMessage</span>.<span class="hljs-title function_">invoke</span>({
      <span class="hljs-attr">confirmKey</span>: message.<span class="hljs-property">confirmKey</span>,
      <span class="hljs-attr">msg_id</span>: message.<span class="hljs-property">msg_id</span>,
      <span class="hljs-attr">conversation_id</span>: message.<span class="hljs-property">conversation_id</span>,
      <span class="hljs-attr">callId</span>: message.<span class="hljs-property">toolCall</span>.<span class="hljs-property">toolCallId</span>,
    });
  };

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"permission-dialog"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>{message.toolCall.title}<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"options"</span>&gt;</span>
        {message.options.map(option =&gt; (
          <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{option.optionId}</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> handleConfirm(option.optionId)}&gt;
            {option.name}
          <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
        ))}
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
};
</code></pre>
<hr/>
<h3 data-id="heading-34">六、ACP 实战：从代码看实现</h3>
<p>让我们通过 AionUi 项目的实际代码，深入理解 ACP 的实现细节。</p>
<h4 data-id="heading-35">6.1 AcpConnection 类：协议通信层</h4>
<p>这是 ACP 客户端的核心实现，负责与 Agent 进程的通信。</p>
<p><strong>完整实现流程：</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// src/agent/acp/AcpConnection.ts (605 行)</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AcpConnection</span> {
  <span class="hljs-keyword">private</span> <span class="hljs-attr">agentProcess</span>: <span class="hljs-title class_">ChildProcess</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;
  <span class="hljs-keyword">private</span> <span class="hljs-attr">pendingRequests</span>: <span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">number</span>, <span class="hljs-title class_">PendingRequest</span>&gt; = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();
  <span class="hljs-keyword">private</span> requestIdCounter = <span class="hljs-number">0</span>;

  <span class="hljs-comment">// 事件回调</span>
  <span class="hljs-keyword">public</span> onSessionUpdate?: <span class="hljs-function">(<span class="hljs-params">data: AcpSessionUpdate</span>) =&gt;</span> <span class="hljs-built_in">void</span>;
  <span class="hljs-keyword">public</span> onPermissionRequest?: <span class="hljs-function">(<span class="hljs-params">data: AcpPermissionRequest</span>) =&gt;</span> <span class="hljs-title class_">Promise</span>&lt;{ <span class="hljs-attr">optionId</span>: <span class="hljs-built_in">string</span> }&gt;;
  <span class="hljs-keyword">public</span> onEndTurn?: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span>;
  <span class="hljs-keyword">public</span> onFileOperation?: <span class="hljs-function">(<span class="hljs-params">operation: <span class="hljs-built_in">any</span></span>) =&gt;</span> <span class="hljs-built_in">void</span>;

  <span class="hljs-comment">/**
   * 连接到 Agent
   */</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">connect</span>(<span class="hljs-params">backend: AcpBackend, cliPath?: <span class="hljs-built_in">string</span>, workingDir?: <span class="hljs-built_in">string</span></span>) {
    <span class="hljs-keyword">const</span> command = cliPath || <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getDefaultCliPath</span>(backend);

    <span class="hljs-comment">// 启动 Agent 子进程</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">agentProcess</span> = <span class="hljs-title function_">spawn</span>(command, [], {
      <span class="hljs-attr">cwd</span>: workingDir,
      <span class="hljs-attr">env</span>: process.<span class="hljs-property">env</span>,
      <span class="hljs-attr">stdio</span>: [<span class="hljs-string">'pipe'</span>, <span class="hljs-string">'pipe'</span>, <span class="hljs-string">'pipe'</span>], <span class="hljs-comment">// stdin, stdout, stderr</span>
    });

    <span class="hljs-comment">// 监听输出</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">agentProcess</span>.<span class="hljs-property">stdout</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">'data'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">handleStdout</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>));
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">agentProcess</span>.<span class="hljs-property">stderr</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">'data'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">handleStderr</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>));

    <span class="hljs-comment">// 初始化协议</span>
    <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">initialize</span>();
  }

  <span class="hljs-comment">/**
   * 发送 JSON-RPC 请求
   */</span>
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">async</span> <span class="hljs-title function_">sendRequest</span>(<span class="hljs-attr">method</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">params</span>: <span class="hljs-built_in">any</span>, timeout = <span class="hljs-number">60000</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">AcpResponse</span>&gt; {
    <span class="hljs-keyword">const</span> id = ++<span class="hljs-variable language_">this</span>.<span class="hljs-property">requestIdCounter</span>;

    <span class="hljs-keyword">const</span> <span class="hljs-attr">request</span>: <span class="hljs-title class_">AcpRequest</span> = {
      <span class="hljs-attr">jsonrpc</span>: <span class="hljs-title class_">JSON</span>RPC_VERSION,
      id,
      method,
      params,
    };

    <span class="hljs-comment">// 创建 Promise，等待响应</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
      <span class="hljs-keyword">const</span> timer = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">pendingRequests</span>.<span class="hljs-title function_">delete</span>(id);
        <span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`Request <span class="hljs-subst">${method}</span> timeout after <span class="hljs-subst">${timeout}</span>ms`</span>));
      }, timeout);

      <span class="hljs-variable language_">this</span>.<span class="hljs-property">pendingRequests</span>.<span class="hljs-title function_">set</span>(id, { resolve, reject, timer });

      <span class="hljs-comment">// 写入 Agent 的 stdin</span>
      <span class="hljs-keyword">const</span> message = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(request) + <span class="hljs-string">'\n'</span>;
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">agentProcess</span>.<span class="hljs-property">stdin</span>.<span class="hljs-title function_">write</span>(message);
    });
  }

  <span class="hljs-comment">/**
   * 处理 Agent 的输出
   */</span>
  <span class="hljs-keyword">private</span> <span class="hljs-title function_">handleStdout</span>(<span class="hljs-params">data: Buffer</span>) {
    <span class="hljs-keyword">const</span> lines = data
      .<span class="hljs-title function_">toString</span>()
      .<span class="hljs-title function_">split</span>(<span class="hljs-string">'\n'</span>)
      .<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">line</span>) =&gt;</span> line.<span class="hljs-title function_">trim</span>());

    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> line <span class="hljs-keyword">of</span> lines) {
      <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">const</span> message = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(line);

        <span class="hljs-keyword">if</span> (<span class="hljs-string">'id'</span> <span class="hljs-keyword">in</span> message &amp;&amp; <span class="hljs-string">'result'</span> <span class="hljs-keyword">in</span> message) {
          <span class="hljs-comment">// Response: 匹配请求并 resolve</span>
          <span class="hljs-keyword">const</span> pending = <span class="hljs-variable language_">this</span>.<span class="hljs-property">pendingRequests</span>.<span class="hljs-title function_">get</span>(message.<span class="hljs-property">id</span>);
          <span class="hljs-keyword">if</span> (pending) {
            <span class="hljs-built_in">clearTimeout</span>(pending.<span class="hljs-property">timer</span>);
            pending.<span class="hljs-title function_">resolve</span>(message);
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">pendingRequests</span>.<span class="hljs-title function_">delete</span>(message.<span class="hljs-property">id</span>);
          }
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-string">'method'</span> <span class="hljs-keyword">in</span> message) {
          <span class="hljs-comment">// Notification: 触发回调</span>
          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">handleNotification</span>(message);
        }
      } <span class="hljs-keyword">catch</span> (error) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Failed to parse message:'</span>, line, error);
      }
    }
  }

  <span class="hljs-comment">/**
   * 处理通知消息
   */</span>
  <span class="hljs-keyword">private</span> <span class="hljs-title function_">handleNotification</span>(<span class="hljs-params">notification: AcpNotification</span>) {
    <span class="hljs-keyword">const</span> { method, params } = notification;

    <span class="hljs-keyword">switch</span> (method) {
      <span class="hljs-keyword">case</span> <span class="hljs-string">'session/update'</span>:
        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">onSessionUpdate</span>) {
          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">onSessionUpdate</span>(params.<span class="hljs-property">update</span>);
        }
        <span class="hljs-keyword">break</span>;

      <span class="hljs-keyword">case</span> <span class="hljs-string">'session/request_permission'</span>:
        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">onPermissionRequest</span>) {
          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">handlePermissionRequest</span>(params);
        }
        <span class="hljs-keyword">break</span>;

      <span class="hljs-keyword">case</span> <span class="hljs-string">'end_turn'</span>:
        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">onEndTurn</span>) {
          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">onEndTurn</span>();
        }
        <span class="hljs-keyword">break</span>;

      <span class="hljs-keyword">case</span> <span class="hljs-string">'fs/read_text_file'</span>:
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">handleReadOperation</span>(params);
        <span class="hljs-keyword">break</span>;

      <span class="hljs-keyword">case</span> <span class="hljs-string">'fs/write_text_file'</span>:
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">handleWriteOperation</span>(params);
        <span class="hljs-keyword">break</span>;
    }
  }

  <span class="hljs-comment">/**
   * 创建新会话
   */</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">newSession</span>(<span class="hljs-attr">cwd</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">AcpResponse</span>&gt; {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">sendRequest</span>(
      <span class="hljs-string">'session/new'</span>,
      {
        cwd,
        <span class="hljs-attr">mcpServers</span>: [], <span class="hljs-comment">// 可配置 MCP 服务器</span>
      },
      <span class="hljs-number">120000</span>
    ); <span class="hljs-comment">// 120 秒超时</span>
  }

  <span class="hljs-comment">/**
   * 发送用户消息
   */</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">sendPrompt</span>(<span class="hljs-attr">prompt</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">AcpResponse</span>&gt; {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">sendRequest</span>(
      <span class="hljs-string">'session/prompt'</span>,
      {
        prompt,
      },
      <span class="hljs-number">120000</span>
    );
  }

  <span class="hljs-comment">/**
   * 断开连接
   */</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">disconnect</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">agentProcess</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">agentProcess</span>.<span class="hljs-title function_">kill</span>();
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">agentProcess</span> = <span class="hljs-literal">null</span>;
    }
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">pendingRequests</span>.<span class="hljs-title function_">clear</span>();
  }
}
</code></pre>
<h4 data-id="heading-36">6.2 AcpAgent 类：业务逻辑层</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// src/agent/acp/index.ts (607 行)</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AcpAgent</span> {
  <span class="hljs-keyword">private</span> <span class="hljs-attr">connection</span>: <span class="hljs-title class_">AcpConnection</span>;
  <span class="hljs-keyword">private</span> <span class="hljs-attr">sessionId</span>: <span class="hljs-built_in">string</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;
  <span class="hljs-keyword">private</span> <span class="hljs-attr">onStreamEvent</span>: <span class="hljs-function">(<span class="hljs-params">event: <span class="hljs-built_in">any</span></span>) =&gt;</span> <span class="hljs-built_in">void</span>;

  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">options: { id: <span class="hljs-built_in">string</span>; backend: AcpBackend; cliPath?: <span class="hljs-built_in">string</span>; workingDir?: <span class="hljs-built_in">string</span>; onStreamEvent: (event: <span class="hljs-built_in">any</span>) =&gt; <span class="hljs-built_in">void</span> }</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">onStreamEvent</span> = options.<span class="hljs-property">onStreamEvent</span>;

    <span class="hljs-comment">// 创建连接</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">connection</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AcpConnection</span>();

    <span class="hljs-comment">// 注册回调</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">connection</span>.<span class="hljs-property">onSessionUpdate</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">handleSessionUpdate</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>);
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">connection</span>.<span class="hljs-property">onPermissionRequest</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">handlePermissionRequest</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>);
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">connection</span>.<span class="hljs-property">onEndTurn</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">handleEndTurn</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>);
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">connection</span>.<span class="hljs-property">onFileOperation</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">handleFileOperation</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>);
  }

  <span class="hljs-comment">/**
   * 启动 Agent
   */</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">start</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">connection</span>.<span class="hljs-title function_">connect</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">backend</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">cliPath</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">workingDir</span>);

    <span class="hljs-comment">// 创建会话</span>
    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">connection</span>.<span class="hljs-title function_">newSession</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">workingDir</span>);
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">sessionId</span> = response.<span class="hljs-property">result</span>.<span class="hljs-property">sessionId</span>;
  }

  <span class="hljs-comment">/**
   * 发送消息
   */</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">sendMessage</span>(<span class="hljs-attr">data</span>: { <span class="hljs-attr">content</span>: <span class="hljs-built_in">string</span>; files?: <span class="hljs-built_in">string</span>[]; msg_id?: <span class="hljs-built_in">string</span> }): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">AcpResult</span>&gt; {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">connection</span>.<span class="hljs-title function_">sendPrompt</span>(data.<span class="hljs-property">content</span>);
      <span class="hljs-keyword">return</span> { <span class="hljs-attr">success</span>: <span class="hljs-literal">true</span> };
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-keyword">return</span> { <span class="hljs-attr">success</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">error</span>: error.<span class="hljs-property">message</span> };
    }
  }

  <span class="hljs-comment">/**
   * 处理会话更新
   */</span>
  <span class="hljs-keyword">private</span> <span class="hljs-title function_">handleSessionUpdate</span>(<span class="hljs-params">update: AcpSessionUpdate</span>) {
    <span class="hljs-comment">// 使用适配器转换为统一格式</span>
    <span class="hljs-keyword">const</span> event = <span class="hljs-title class_">AcpAdapter</span>.<span class="hljs-title function_">convertUpdate</span>(update);

    <span class="hljs-comment">// 触发流事件</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">onStreamEvent</span>(event);
  }

  <span class="hljs-comment">/**
   * 处理权限请求
   */</span>
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">async</span> <span class="hljs-title function_">handlePermissionRequest</span>(<span class="hljs-attr">params</span>: <span class="hljs-title class_">AcpPermissionRequest</span>): <span class="hljs-title class_">Promise</span>&lt;{ <span class="hljs-attr">optionId</span>: <span class="hljs-built_in">string</span> }&gt; {
    <span class="hljs-comment">// 创建权限消息，显示给用户</span>
    <span class="hljs-keyword">const</span> permissionMessage = {
      <span class="hljs-attr">role</span>: <span class="hljs-string">'permission_request'</span>,
      <span class="hljs-attr">options</span>: params.<span class="hljs-property">options</span>,
      <span class="hljs-attr">toolCall</span>: params.<span class="hljs-property">toolCall</span>,
      <span class="hljs-attr">confirmKey</span>: <span class="hljs-title function_">generateConfirmKey</span>(),
    };

    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">onStreamEvent</span>(permissionMessage);

    <span class="hljs-comment">// 等待用户响应（通过 confirmMessage 方法）</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">pendingPermissionResolve</span> = resolve;
    });
  }

  <span class="hljs-comment">/**
   * 确认权限（用户选择后调用）
   */</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">confirmMessage</span>(<span class="hljs-params">data: { confirmKey: <span class="hljs-built_in">string</span>; msg_id: <span class="hljs-built_in">string</span>; callId: <span class="hljs-built_in">string</span> }</span>) {
    <span class="hljs-comment">// 将用户选择的 optionId 返回给 Agent</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">pendingPermissionResolve</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">pendingPermissionResolve</span>({ <span class="hljs-attr">optionId</span>: data.<span class="hljs-property">confirmKey</span> });
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">pendingPermissionResolve</span> = <span class="hljs-literal">null</span>;
    }
  }
}
</code></pre>
<h4 data-id="heading-37">6.3 前端 UI 集成</h4>
<p><strong>聊天界面：</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// src/renderer/pages/conversation/acp/AcpChat.tsx</span>

<span class="hljs-keyword">const</span> <span class="hljs-title class_">AcpChat</span>: <span class="hljs-title class_">React</span>.<span class="hljs-property">FC</span>&lt;{
  <span class="hljs-attr">conversation_id</span>: <span class="hljs-built_in">string</span>;
  workspace?: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">backend</span>: <span class="hljs-title class_">AcpBackend</span>;
}&gt; = <span class="hljs-function">(<span class="hljs-params">{ conversation_id, workspace, backend }</span>) =&gt;</span> {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">ConversationProvider</span> <span class="hljs-attr">value</span>=<span class="hljs-string">{{</span>
      <span class="hljs-attr">conversationId:</span> <span class="hljs-attr">conversation_id</span>,
      <span class="hljs-attr">workspace</span>,
      <span class="hljs-attr">type:</span> '<span class="hljs-attr">acp</span>',
    }}&gt;</span>
      {/* 消息列表 */}
      <span class="hljs-tag">&lt;<span class="hljs-name">MessageList</span> /&gt;</span>

      {/* 输入框 */}
      <span class="hljs-tag">&lt;<span class="hljs-name">AcpSendBox</span> <span class="hljs-attr">conversation_id</span>=<span class="hljs-string">{conversation_id}</span> <span class="hljs-attr">backend</span>=<span class="hljs-string">{backend}</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">ConversationProvider</span>&gt;</span></span>
  );
};
</code></pre>
<p><strong>工具调用 UI：</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// src/renderer/messages/acp/MessageAcpToolCall.tsx</span>

<span class="hljs-keyword">const</span> <span class="hljs-title class_">MessageAcpToolCall</span>: <span class="hljs-title class_">React</span>.<span class="hljs-property">FC</span>&lt;{ <span class="hljs-attr">toolCall</span>: <span class="hljs-title class_">ToolCallUpdate</span> }&gt; = <span class="hljs-function">(<span class="hljs-params">{ toolCall }</span>) =&gt;</span> {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"tool-call"</span>&gt;</span>
      {/* 工具图标 */}
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"tool-icon"</span>&gt;</span>
        {toolCall.kind === 'read' &amp;&amp; <span class="hljs-tag">&lt;<span class="hljs-name">FileIcon</span> /&gt;</span>}
        {toolCall.kind === 'edit' &amp;&amp; <span class="hljs-tag">&lt;<span class="hljs-name">EditIcon</span> /&gt;</span>}
        {toolCall.kind === 'execute' &amp;&amp; <span class="hljs-tag">&lt;<span class="hljs-name">TerminalIcon</span> /&gt;</span>}
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

      {/* 工具标题 */}
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"tool-title"</span>&gt;</span>{toolCall.title}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

      {/* 状态指示器 */}
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{</span>`<span class="hljs-attr">tool-status</span> <span class="hljs-attr">tool-status-</span>${<span class="hljs-attr">toolCall.status</span>}`}&gt;</span>
        {toolCall.status === 'pending' &amp;&amp; <span class="hljs-tag">&lt;<span class="hljs-name">ClockIcon</span> /&gt;</span>}
        {toolCall.status === 'in_progress' &amp;&amp; <span class="hljs-tag">&lt;<span class="hljs-name">SpinnerIcon</span> /&gt;</span>}
        {toolCall.status === 'completed' &amp;&amp; <span class="hljs-tag">&lt;<span class="hljs-name">CheckIcon</span> /&gt;</span>}
        {toolCall.status === 'failed' &amp;&amp; <span class="hljs-tag">&lt;<span class="hljs-name">XIcon</span> /&gt;</span>}
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

      {/* 文件路径 */}
      {toolCall.locations &amp;&amp; (
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"tool-locations"</span>&gt;</span>
          {toolCall.locations.map(loc =&gt; (
            <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{loc.path}</span>&gt;</span>{loc.path}<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
          ))}
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      )}

      {/* Diff 内容 */}
      {toolCall.content &amp;&amp; toolCall.content[0]?.type === 'diff' &amp;&amp; (
        <span class="hljs-tag">&lt;<span class="hljs-name">DiffViewer</span> <span class="hljs-attr">diff</span>=<span class="hljs-string">{toolCall.content[0].diff}</span> /&gt;</span>
      )}
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
};
</code></pre>
<h4 data-id="heading-38">6.4 IPC Bridge 集成</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// src/process/bridge/acpConversationBridge.ts</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">initAcpConversationBridge</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// 确认权限</span>
  ipcBridge.<span class="hljs-property">acpConversation</span>.<span class="hljs-property">confirmMessage</span>.<span class="hljs-title function_">provider</span>(<span class="hljs-keyword">async</span> ({ confirmKey, msg_id, conversation_id, callId }) =&gt; {
    <span class="hljs-keyword">const</span> task = <span class="hljs-title class_">WorkerManage</span>.<span class="hljs-title function_">getTaskById</span>(conversation_id) <span class="hljs-keyword">as</span> <span class="hljs-title class_">AcpAgentManager</span>;
    <span class="hljs-keyword">await</span> task.<span class="hljs-title function_">confirmMessage</span>({ confirmKey, msg_id, callId });
    <span class="hljs-keyword">return</span> { <span class="hljs-attr">success</span>: <span class="hljs-literal">true</span> };
  });

  <span class="hljs-comment">// 检测可用的 Agent</span>
  ipcBridge.<span class="hljs-property">acpConversation</span>.<span class="hljs-property">getAvailableAgents</span>.<span class="hljs-title function_">provider</span>(<span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">const</span> agents = acpDetector.<span class="hljs-title function_">getDetectedAgents</span>();
    <span class="hljs-keyword">return</span> { <span class="hljs-attr">success</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">data</span>: agents };
  });

  <span class="hljs-comment">// 检测 CLI 路径</span>
  ipcBridge.<span class="hljs-property">acpConversation</span>.<span class="hljs-property">detectCliPath</span>.<span class="hljs-title function_">provider</span>(<span class="hljs-keyword">async</span> ({ backend }) =&gt; {
    <span class="hljs-keyword">const</span> agents = acpDetector.<span class="hljs-title function_">getDetectedAgents</span>();
    <span class="hljs-keyword">const</span> agent = agents.<span class="hljs-title function_">find</span>(<span class="hljs-function">(<span class="hljs-params">a</span>) =&gt;</span> a.<span class="hljs-property">backend</span> === backend);
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">success</span>: !!agent?.<span class="hljs-property">cliPath</span>,
      <span class="hljs-attr">data</span>: { <span class="hljs-attr">path</span>: agent?.<span class="hljs-property">cliPath</span> },
    };
  });
}
</code></pre>
<hr/>
<h3 data-id="heading-39">七、ACP vs MCP：两个协议的对比与互补</h3>
<h4 data-id="heading-40">7.1 核心区别</h4>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB
    subgraph ACP["ACP (Agent Client Protocol)"]
        A1["作用：编辑器 ←→ AI Agent"]
        A2["场景：代码编辑、重构、调试"]
        A3["通信：双向（请求/响应 + 通知）"]
        A4["传输：stdio (本地进程通信)"]
        A5["创建者：Zed Industries"]
    end

    subgraph MCP["MCP (Model Context Protocol)"]
        M1["作用：AI 模型 ←→ 工具/资源"]
        M2["场景：数据库查询、API调用、文件系统操作"]
        M3["通信：主要是单向（模型调用工具）"]
        M4["传输：stdio / HTTP with SSE"]
        M5["创建者：Anthropic"]
    end

    style ACP fill:#e3f2fd
    style MCP fill:#fff3e0
</code></pre>
<h4 data-id="heading-41">7.2 详细对比表</h4>






































































<table><thead><tr><th>维度</th><th>ACP</th><th>MCP</th></tr></thead><tbody><tr><td><strong>完整名称</strong></td><td>Agent Client Protocol</td><td>Model Context Protocol</td></tr><tr><td><strong>主要用途</strong></td><td>编辑器与 AI 编码助手的通信</td><td>AI 模型与外部工具/资源的通信</td></tr><tr><td><strong>通信方向</strong></td><td>双向（编辑器 ↔ Agent）</td><td>主要单向（Model → Tools）</td></tr><tr><td><strong>协议基础</strong></td><td>JSON-RPC 2.0 over stdio</td><td>JSON-RPC 2.0 over stdio/HTTP</td></tr><tr><td><strong>传输方式</strong></td><td>stdio（标准输入输出）</td><td>stdio / HTTP with SSE</td></tr><tr><td><strong>生命周期</strong></td><td>编辑器启动 Agent 子进程</td><td>Host 启动 MCP Server</td></tr><tr><td><strong>状态管理</strong></td><td>有状态（会话持久化）</td><td>有状态（连接生命周期）</td></tr><tr><td><strong>权限控制</strong></td><td>内置权限请求机制</td><td>依赖 Host 实现</td></tr><tr><td><strong>典型场景</strong></td><td>代码生成、重构、调试</td><td>数据库查询、API 调用</td></tr><tr><td><strong>作者</strong></td><td>Zed Industries</td><td>Anthropic</td></tr><tr><td><strong>发布时间</strong></td><td>2025 年</td><td>2024 年</td></tr><tr><td><strong>开源协议</strong></td><td>Apache 2.0</td><td>MIT</td></tr></tbody></table>
<h4 data-id="heading-42">7.3 协作关系</h4>
<p>ACP 和 MCP 不是竞争关系，而是<strong>互补关系</strong>。</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    Editor["Editor&lt;br/&gt;(Zed)"]
    Agent["AI Agent&lt;br/&gt;(Claude Code)"]

    subgraph MCPServers["MCP Servers"]
        DB[Database Server]
        FS[File System]
        Git[Git Server]
        Web[Web Fetch]
        Mem[Memory/Knowledge]
    end

    Editor &lt;--&gt;|ACP Protocol| Agent
    Agent --&gt;|MCP Protocol| MCPServers

    style Editor fill:#e3f2fd
    style Agent fill:#fff3e0
    style MCPServers fill:#e8f5e9
</code></pre>
<p><strong>实际工作流程：</strong></p>
<ol>
<li><strong>用户</strong> 在 Zed 编辑器中输入："帮我重构这个函数，并将结果保存到数据库"</li>
<li><strong>Zed</strong> 通过 <strong>ACP</strong> 将消息发送给 <strong>Claude Code Agent</strong></li>
<li><strong>Claude</strong> 分析代码，生成重构后的代码</li>
<li><strong>Claude</strong> 通过 <strong>MCP</strong> 调用 <strong>Database Server</strong> 将结果保存</li>
<li><strong>Claude</strong> 通过 <strong>ACP</strong> 将结果返回给 <strong>Zed</strong></li>
<li><strong>Zed</strong> 在编辑器中显示重构后的代码和执行结果</li>
</ol>
<h4 data-id="heading-43">7.4 在 AionUi 中的集成</h4>
<p>AionUi 项目同时支持 ACP 和 MCP：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// src/agent/acp/AcpConnection.ts</span>

<span class="hljs-keyword">async</span> <span class="hljs-title function_">newSession</span>(<span class="hljs-attr">cwd</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">AcpResponse</span>&gt; {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">sendRequest</span>(<span class="hljs-string">'session/new'</span>, {
    cwd,
    <span class="hljs-comment">// 可以在创建 ACP 会话时配置 MCP 服务器</span>
    <span class="hljs-attr">mcpServers</span>: [
      {
        <span class="hljs-attr">name</span>: <span class="hljs-string">'database'</span>,
        <span class="hljs-attr">command</span>: <span class="hljs-string">'node'</span>,
        <span class="hljs-attr">args</span>: [<span class="hljs-string">'./mcp-servers/database-server.js'</span>],
      },
      {
        <span class="hljs-attr">name</span>: <span class="hljs-string">'git'</span>,
        <span class="hljs-attr">command</span>: <span class="hljs-string">'node'</span>,
        <span class="hljs-attr">args</span>: [<span class="hljs-string">'./mcp-servers/git-server.js'</span>],
      },
    ],
  });
}
</code></pre>
<p>这样，Claude Code Agent 就可以同时：</p>
<ul>
<li>通过 <strong>ACP</strong> 与编辑器通信</li>
<li>通过 <strong>MCP</strong> 访问数据库、Git 等工具</li>
</ul>
<hr/>
<h3 data-id="heading-44">八、生态系统与实际应用</h3>
<h4 data-id="heading-45">8.1 支持 ACP 的编辑器</h4>
<pre><code class="hljs language-mermaid" lang="mermaid">mindmap
  root((ACP 编辑器生态))
    已支持
      Zed
        官方支持
        原生集成
      Neovim
        社区插件
      JetBrains IDEs
        官方合作
      Marimo
        数据科学笔记本
    计划中
      VS Code
      Emacs
        社区开发中
</code></pre>
<p><strong>Zed 的 ACP 配置示例：</strong></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-comment">// ~/.config/zed/settings.json</span>
<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"agents"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"claude"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"claude-code"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"args"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"env"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"ANTHROPIC_API_KEY"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"sk-ant-..."</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"gemini"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"gemini-cli"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"args"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"--model"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"gemini-1.5-pro"</span><span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"codex"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"codex"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"args"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"--api-key"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"sk-..."</span><span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-46">8.2 支持 ACP 的 AI Agent</h4>









































<table><thead><tr><th>Agent</th><th>厂商</th><th>模型</th><th>特性</th></tr></thead><tbody><tr><td><strong>Claude Code</strong></td><td>Anthropic</td><td>Claude 3.5 Sonnet</td><td>长上下文、思维链、代码理解强</td></tr><tr><td><strong>Gemini CLI</strong></td><td>Google</td><td>Gemini 1.5 Pro</td><td>多模态、快速响应</td></tr><tr><td><strong>Codex CLI</strong></td><td>OpenAI</td><td>GPT-4</td><td>广泛的编程语言支持</td></tr><tr><td><strong>Qwen Code</strong></td><td>阿里云</td><td>Qwen Coder</td><td>中文编程、本地化</td></tr><tr><td><strong>goose</strong></td><td>Block</td><td>多模型支持</td><td>开源、可定制</td></tr></tbody></table>
<h4 data-id="heading-47">8.3 实际应用场景</h4>
<h5 data-id="heading-48">场景 1：代码重构</h5>
<p><strong>用户输入：</strong></p>
<blockquote>
<p>"将这个组件从 Class 组件重构为 Function 组件，使用 Hooks"</p>
</blockquote>
<p><strong>ACP 工作流程：</strong></p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-number">1.</span> [Agent Message] "我会帮你重构这个组件..."

<span class="hljs-number">2.</span> [Tool <span class="hljs-keyword">Call</span> <span class="hljs-operator">-</span> Read]
   读取 src<span class="hljs-operator">/</span>components<span class="hljs-operator">/</span>UserList.tsx

<span class="hljs-number">3.</span> [Agent Thought]
   "这是一个 Class 组件，有三个生命周期方法和一个状态..."

<span class="hljs-number">4.</span> [Tool <span class="hljs-keyword">Call</span> <span class="hljs-operator">-</span> Edit]
   生成重构后的代码（使用 useState、useEffect）

<span class="hljs-number">5.</span> [Permission Request]
   "是否允许修改 UserList.tsx?"

<span class="hljs-number">6.</span> [<span class="hljs-keyword">User</span>] 点击"允许"

<span class="hljs-number">7.</span> [Tool <span class="hljs-keyword">Call</span> <span class="hljs-operator">-</span> <span class="hljs-keyword">Execute</span>]
   运行 `npm run lint` 检查语法

<span class="hljs-number">8.</span> [Agent Message]
   "重构完成！代码已通过 lint 检查。"
</code></pre>
<h5 data-id="heading-49">场景 2：Bug 修复</h5>
<p><strong>用户输入：</strong></p>
<blockquote>
<p>"修复这个 TypeScript 类型错误"</p>
</blockquote>
<p><strong>ACP 工作流程：</strong></p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-number">1</span>. <span class="hljs-selector-attr">[Tool Call - Read]</span>
   读取当前文件

<span class="hljs-number">2</span>. <span class="hljs-selector-attr">[Agent Thought]</span>
   "类型错误是因为函数返回值类型不匹配..."

<span class="hljs-number">3</span>. <span class="hljs-selector-attr">[Plan Update]</span>
   - <span class="hljs-selector-attr">[✓]</span> 分析类型错误
   - <span class="hljs-selector-attr">[→]</span> 修改函数签名
   - <span class="hljs-selector-attr">[ ]</span> 添加类型注解
   - <span class="hljs-selector-attr">[ ]</span> 运行 tsc 检查

<span class="hljs-number">4</span>. <span class="hljs-selector-attr">[Tool Call - Edit]</span>
   修改函数类型定义

<span class="hljs-number">5</span>. <span class="hljs-selector-attr">[Tool Call - Execute]</span>
   运行 `tsc <span class="hljs-attr">--noEmit</span>`

<span class="hljs-number">6</span>. <span class="hljs-selector-attr">[Agent Message]</span>
   "类型错误已修复！TypeScript 编译通过。"
</code></pre>
<h5 data-id="heading-50">场景 3：集成 MCP 的复杂场景</h5>
<p><strong>用户输入：</strong></p>
<blockquote>
<p>"从数据库中查询用户列表，生成一个 React 表格组件"</p>
</blockquote>
<p><strong>ACP + MCP 协作流程：</strong></p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-number">1</span>. <span class="hljs-selector-attr">[ACP]</span> Agent 收到请求

<span class="hljs-number">2</span>. <span class="hljs-selector-attr">[MCP]</span> Agent 调用 Database Server
   Tool: <span class="hljs-built_in">query_users</span>()

<span class="hljs-number">3</span>. [MCP] Database Server 返回数据
   Result: [{id: <span class="hljs-number">1</span>, name: <span class="hljs-string">"Alice"</span>}, ...]

<span class="hljs-number">4</span>. <span class="hljs-selector-attr">[ACP]</span> Agent 思考如何生成组件

<span class="hljs-number">5</span>. <span class="hljs-selector-attr">[ACP]</span> Agent 创建新文件
   Tool Call: <span class="hljs-built_in">write_file</span>(<span class="hljs-string">"UserTable.tsx"</span>)

<span class="hljs-number">6</span>. [ACP] Agent 生成组件代码
   基于数据库结构生成 TypeScript 类型

<span class="hljs-number">7</span>. [ACP] Agent 运行测试
   Tool Call: <span class="hljs-built_in">execute</span>(<span class="hljs-string">"npm test UserTable"</span>)

<span class="hljs-number">8</span>. [ACP] Agent 返回结果
   <span class="hljs-string">"组件已创建，所有测试通过！"</span>
</code></pre>
<hr/>
<h3 data-id="heading-51">九、最佳实践与安全考量</h3>
<h4 data-id="heading-52">9.1 实现 ACP Agent 的最佳实践</h4>
<h5 data-id="heading-53">9.1.1. 日志处理</h5>
<p><strong>❌ 错误做法：</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 不要写入 stdout！</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Agent is processing...'</span>);
</code></pre>
<p><strong>✅ 正确做法：</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 使用 stderr 或文件日志</span>
<span class="hljs-keyword">import</span> fs <span class="hljs-keyword">from</span> <span class="hljs-string">'fs'</span>;

<span class="hljs-keyword">const</span> logFile = fs.<span class="hljs-title function_">createWriteStream</span>(<span class="hljs-string">'/tmp/agent.log'</span>);

<span class="hljs-keyword">function</span> <span class="hljs-title function_">log</span>(<span class="hljs-params">message: <span class="hljs-built_in">string</span></span>) {
  logFile.<span class="hljs-title function_">write</span>(<span class="hljs-string">`[<span class="hljs-subst">${<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>().toISOString()}</span>] <span class="hljs-subst">${message}</span>\n`</span>);
}

<span class="hljs-title function_">log</span>(<span class="hljs-string">'Agent is processing...'</span>);
</code></pre>
<p><strong>原因：</strong> ACP 使用 stdout 传输 JSON-RPC 消息，任何非 JSON 输出都会破坏协议。</p>
<h5 data-id="heading-54">9.1.2. 错误处理</h5>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">try</span> {
  <span class="hljs-keyword">await</span> <span class="hljs-title function_">executeToolCall</span>(toolCall);
} <span class="hljs-keyword">catch</span> (error) {
  <span class="hljs-comment">// 返回标准错误格式</span>
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">jsonrpc</span>: <span class="hljs-string">'2.0'</span>,
    <span class="hljs-attr">id</span>: requestId,
    <span class="hljs-attr">error</span>: {
      <span class="hljs-attr">code</span>: -<span class="hljs-number">32603</span>,
      <span class="hljs-attr">message</span>: error.<span class="hljs-property">message</span>,
      <span class="hljs-attr">data</span>: {
        <span class="hljs-attr">stack</span>: error.<span class="hljs-property">stack</span>,
      },
    },
  };
}
</code></pre>
<h5 data-id="heading-55">9.1.3. 超时管理</h5>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">TOOL_CALL_TIMEOUT</span> = <span class="hljs-number">30000</span>; <span class="hljs-comment">// 30 秒</span>

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">executeToolCallWithTimeout</span>(<span class="hljs-params">toolCall: ToolCall</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">race</span>([<span class="hljs-title function_">executeToolCall</span>(toolCall), <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">_, reject</span>) =&gt;</span> <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'Tool call timeout'</span>)), <span class="hljs-variable constant_">TOOL_CALL_TIMEOUT</span>))]);
}
</code></pre>
<h5 data-id="heading-56">9.1.4. 流式响应</h5>
<p>对于长时间的操作，使用流式更新：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">generateCode</span>(<span class="hljs-params">prompt: <span class="hljs-built_in">string</span></span>) {
  <span class="hljs-comment">// 发送进度更新</span>
  <span class="hljs-title function_">sendNotification</span>(<span class="hljs-string">'session/update'</span>, {
    <span class="hljs-attr">update</span>: {
      <span class="hljs-attr">sessionUpdate</span>: <span class="hljs-string">'agent_thought_chunk'</span>,
      <span class="hljs-attr">content</span>: { <span class="hljs-attr">type</span>: <span class="hljs-string">'text'</span>, <span class="hljs-attr">text</span>: <span class="hljs-string">'正在分析需求...'</span> },
    },
  });

  <span class="hljs-comment">// 生成代码</span>
  <span class="hljs-keyword">const</span> code = <span class="hljs-keyword">await</span> llm.<span class="hljs-title function_">generate</span>(prompt);

  <span class="hljs-comment">// 发送代码块</span>
  <span class="hljs-title function_">sendNotification</span>(<span class="hljs-string">'session/update'</span>, {
    <span class="hljs-attr">update</span>: {
      <span class="hljs-attr">sessionUpdate</span>: <span class="hljs-string">'agent_message_chunk'</span>,
      <span class="hljs-attr">content</span>: { <span class="hljs-attr">type</span>: <span class="hljs-string">'text'</span>, <span class="hljs-attr">text</span>: code },
    },
  });
}
</code></pre>
<h4 data-id="heading-57">9.2 安全考量</h4>
<h5 data-id="heading-58">9.2.1. 文件系统访问控制</h5>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 定义允许的工作目录</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">ALLOWED_WORKSPACE</span> = process.<span class="hljs-property">env</span>.<span class="hljs-property">WORKSPACE_DIR</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">validateFilePath</span>(<span class="hljs-params">path: <span class="hljs-built_in">string</span></span>): <span class="hljs-built_in">boolean</span> {
  <span class="hljs-keyword">const</span> resolvedPath = path.<span class="hljs-title function_">resolve</span>(path);

  <span class="hljs-comment">// 检查路径是否在允许的工作目录内</span>
  <span class="hljs-keyword">if</span> (!resolvedPath.<span class="hljs-title function_">startsWith</span>(<span class="hljs-variable constant_">ALLOWED_WORKSPACE</span>)) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'Access denied: path outside workspace'</span>);
  }

  <span class="hljs-comment">// 检查是否访问敏感文件</span>
  <span class="hljs-keyword">const</span> sensitivePatterns = [<span class="hljs-string">'.env'</span>, <span class="hljs-string">'.git/config'</span>, <span class="hljs-string">'id_rsa'</span>];
  <span class="hljs-keyword">if</span> (sensitivePatterns.<span class="hljs-title function_">some</span>(<span class="hljs-function">(<span class="hljs-params">pattern</span>) =&gt;</span> resolvedPath.<span class="hljs-title function_">includes</span>(pattern))) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'Access denied: sensitive file'</span>);
  }

  <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
}
</code></pre>
<h5 data-id="heading-59">9.2.2. 命令执行安全</h5>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 白名单机制</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">ALLOWED_COMMANDS</span> = [<span class="hljs-string">'npm test'</span>, <span class="hljs-string">'npm run lint'</span>, <span class="hljs-string">'tsc --noEmit'</span>, <span class="hljs-string">'git status'</span>];

<span class="hljs-keyword">function</span> <span class="hljs-title function_">validateCommand</span>(<span class="hljs-params">command: <span class="hljs-built_in">string</span></span>): <span class="hljs-built_in">boolean</span> {
  <span class="hljs-keyword">return</span> <span class="hljs-variable constant_">ALLOWED_COMMANDS</span>.<span class="hljs-title function_">some</span>(<span class="hljs-function">(<span class="hljs-params">allowed</span>) =&gt;</span> command.<span class="hljs-title function_">startsWith</span>(allowed));
}

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">executeCommand</span>(<span class="hljs-params">command: <span class="hljs-built_in">string</span></span>) {
  <span class="hljs-keyword">if</span> (!<span class="hljs-title function_">validateCommand</span>(command)) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'Command not allowed'</span>);
  }

  <span class="hljs-comment">// 执行命令</span>
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">execAsync</span>(command, {
    <span class="hljs-attr">timeout</span>: <span class="hljs-number">30000</span>,
    <span class="hljs-attr">cwd</span>: <span class="hljs-variable constant_">WORKSPACE_DIR</span>,
  });
}
</code></pre>
<h5 data-id="heading-60">9.2.3. 权限请求实现</h5>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">requestPermission</span>(<span class="hljs-params">toolCall: ToolCall</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">boolean</span>&gt; {
  <span class="hljs-comment">// 发送权限请求</span>
  <span class="hljs-title function_">sendNotification</span>(<span class="hljs-string">'session/request_permission'</span>, {
    <span class="hljs-attr">sessionId</span>: currentSessionId,
    <span class="hljs-attr">options</span>: [
      { <span class="hljs-attr">optionId</span>: <span class="hljs-string">'allow_once'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'仅此一次允许'</span>, <span class="hljs-attr">kind</span>: <span class="hljs-string">'allow_once'</span> },
      { <span class="hljs-attr">optionId</span>: <span class="hljs-string">'allow_always'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'始终允许'</span>, <span class="hljs-attr">kind</span>: <span class="hljs-string">'allow_always'</span> },
      { <span class="hljs-attr">optionId</span>: <span class="hljs-string">'reject'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'拒绝'</span>, <span class="hljs-attr">kind</span>: <span class="hljs-string">'reject_once'</span> },
    ],
    toolCall,
  });

  <span class="hljs-comment">// 等待用户响应</span>
  <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">waitForPermissionResponse</span>();

  <span class="hljs-comment">// 缓存权限决策</span>
  <span class="hljs-keyword">if</span> (response.<span class="hljs-property">kind</span> === <span class="hljs-string">'allow_always'</span>) {
    permissionCache.<span class="hljs-title function_">set</span>(toolCall.<span class="hljs-property">kind</span>, <span class="hljs-literal">true</span>);
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (response.<span class="hljs-property">kind</span> === <span class="hljs-string">'reject_always'</span>) {
    permissionCache.<span class="hljs-title function_">set</span>(toolCall.<span class="hljs-property">kind</span>, <span class="hljs-literal">false</span>);
  }

  <span class="hljs-keyword">return</span> response.<span class="hljs-property">kind</span>.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">'allow'</span>);
}
</code></pre>
<h5 data-id="heading-61">9.2.4. 敏感信息处理</h5>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 过滤敏感信息</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">sanitizeContent</span>(<span class="hljs-params">content: <span class="hljs-built_in">string</span></span>): <span class="hljs-built_in">string</span> {
  <span class="hljs-comment">// 移除 API 密钥</span>
  content = content.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/sk-[a-zA-Z0-9]{48}/g</span>, <span class="hljs-string">'***API_KEY***'</span>);

  <span class="hljs-comment">// 移除密码</span>
  content = content.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/password\s*=\s*['"][^'"]+['"]/gi</span>, <span class="hljs-string">'password=***'</span>);

  <span class="hljs-comment">// 移除 Token</span>
  content = content.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/Bearer\s+[a-zA-Z0-9._-]+/g</span>, <span class="hljs-string">'Bearer ***'</span>);

  <span class="hljs-keyword">return</span> content;
}
</code></pre>
<h4 data-id="heading-62">9.3 性能优化</h4>
<h5 data-id="heading-63">9.3.1. 批量操作</h5>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 批量读取文件</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">readMultipleFiles</span>(<span class="hljs-params">paths: <span class="hljs-built_in">string</span>[]</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">string</span>&gt;&gt; {
  <span class="hljs-keyword">const</span> results = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();

  <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>(
    paths.<span class="hljs-title function_">map</span>(<span class="hljs-keyword">async</span> (path) =&gt; {
      <span class="hljs-keyword">const</span> content = <span class="hljs-keyword">await</span> fs.<span class="hljs-title function_">readFile</span>(path, <span class="hljs-string">'utf-8'</span>);
      results.<span class="hljs-title function_">set</span>(path, content);
    })
  );

  <span class="hljs-keyword">return</span> results;
}
</code></pre>
<h5 data-id="heading-64">9.3.2. 增量更新</h5>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 只发送变化的内容</span>
<span class="hljs-keyword">let</span> lastContent = <span class="hljs-string">''</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">sendDiffUpdate</span>(<span class="hljs-params">newContent: <span class="hljs-built_in">string</span></span>) {
  <span class="hljs-keyword">const</span> diff = <span class="hljs-title function_">computeDiff</span>(lastContent, newContent);

  <span class="hljs-keyword">if</span> (diff) {
    <span class="hljs-title function_">sendNotification</span>(<span class="hljs-string">'session/update'</span>, {
      <span class="hljs-attr">update</span>: {
        <span class="hljs-attr">sessionUpdate</span>: <span class="hljs-string">'agent_message_chunk'</span>,
        <span class="hljs-attr">content</span>: { <span class="hljs-attr">type</span>: <span class="hljs-string">'diff'</span>, diff },
      },
    });
  }

  lastContent = newContent;
}
</code></pre>
<h5 data-id="heading-65">9.3.3. 缓存机制</h5>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 缓存文件内容</span>
<span class="hljs-keyword">const</span> fileCache = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">LRU</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">string</span>&gt;({
  <span class="hljs-attr">max</span>: <span class="hljs-number">100</span>,
  <span class="hljs-attr">maxAge</span>: <span class="hljs-number">5</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000</span>, <span class="hljs-comment">// 5 分钟</span>
});

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">readFileWithCache</span>(<span class="hljs-params">path: <span class="hljs-built_in">string</span></span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">string</span>&gt; {
  <span class="hljs-keyword">const</span> cached = fileCache.<span class="hljs-title function_">get</span>(path);
  <span class="hljs-keyword">if</span> (cached) <span class="hljs-keyword">return</span> cached;

  <span class="hljs-keyword">const</span> content = <span class="hljs-keyword">await</span> fs.<span class="hljs-title function_">readFile</span>(path, <span class="hljs-string">'utf-8'</span>);
  fileCache.<span class="hljs-title function_">set</span>(path, content);

  <span class="hljs-keyword">return</span> content;
}
</code></pre>
<hr/>
<h3 data-id="heading-66">十、未来展望</h3>
<h4 data-id="heading-67">10.1 协议演进方向</h4>
<h5 data-id="heading-68">10.1.1. 更丰富的内容类型</h5>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 未来可能支持的内容类型</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">FutureContent</span> {
  <span class="hljs-attr">type</span>: <span class="hljs-string">'text'</span> | <span class="hljs-string">'image'</span> | <span class="hljs-string">'video'</span> | <span class="hljs-string">'audio'</span> | <span class="hljs-string">'diagram'</span> | <span class="hljs-string">'3d-model'</span>;
  <span class="hljs-comment">// ...</span>
}

<span class="hljs-comment">// 示例：Agent 生成架构图</span>
{
  <span class="hljs-attr">sessionUpdate</span>: <span class="hljs-string">'agent_message_chunk'</span>,
  <span class="hljs-attr">content</span>: {
    <span class="hljs-attr">type</span>: <span class="hljs-string">'diagram'</span>,
    <span class="hljs-attr">format</span>: <span class="hljs-string">'mermaid'</span>,
    <span class="hljs-attr">data</span>: <span class="hljs-string">`
      graph TD
        A[Client] --&gt;|HTTP| B[Server]
        B --&gt; C[Database]
    `</span>
  }
}
</code></pre>
<h5 data-id="heading-69">10.1.2. 多 Agent 协作</h5>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    Editor[Editor]

    CodeAgent[Code Agent&lt;br/&gt;负责代码生成]
    TestAgent[Test Agent&lt;br/&gt;负责测试]
    ReviewAgent[Review Agent&lt;br/&gt;负责代码审查]
    DeployAgent[Deploy Agent&lt;br/&gt;负责部署]

    Editor --&gt; CodeAgent
    Editor --&gt; TestAgent
    Editor --&gt; ReviewAgent
    Editor --&gt; DeployAgent

    CodeAgent &lt;-.协作.-&gt; TestAgent
    TestAgent &lt;-.协作.-&gt; ReviewAgent
    ReviewAgent &lt;-.协作.-&gt; DeployAgent

    style Editor fill:#e3f2fd
    style CodeAgent fill:#fff3e0
    style TestAgent fill:#e8f5e9
    style ReviewAgent fill:#f3e5f5
    style DeployAgent fill:#fce4ec

    Note["Agent 之间可以互相通信和协作"]
    style Note fill:#fffde7
</code></pre>
<h5 data-id="heading-70">10.1.3. 增强的上下文管理</h5>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 未来的会话上下文</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">EnhancedSessionContext</span> {
  <span class="hljs-comment">// 项目元数据</span>
  <span class="hljs-attr">project</span>: {
    <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;
    <span class="hljs-attr">language</span>: <span class="hljs-built_in">string</span>[];
    <span class="hljs-attr">framework</span>: <span class="hljs-built_in">string</span>[];
    <span class="hljs-attr">dependencies</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">string</span>&gt;;
  };

  <span class="hljs-comment">// 代码图谱</span>
  <span class="hljs-attr">codeGraph</span>: {
    <span class="hljs-attr">files</span>: <span class="hljs-title class_">FileNode</span>[];
    <span class="hljs-attr">imports</span>: <span class="hljs-title class_">ImportEdge</span>[];
    <span class="hljs-attr">exports</span>: <span class="hljs-title class_">ExportEdge</span>[];
  };

  <span class="hljs-comment">// 历史操作</span>
  <span class="hljs-attr">history</span>: <span class="hljs-title class_">Operation</span>[];

  <span class="hljs-comment">// 用户偏好</span>
  <span class="hljs-attr">preferences</span>: {
    <span class="hljs-attr">codingStyle</span>: <span class="hljs-built_in">string</span>;
    <span class="hljs-attr">testFramework</span>: <span class="hljs-built_in">string</span>;
    <span class="hljs-comment">// ...</span>
  };
}
</code></pre>
<h4 data-id="heading-71">10.2 生态系统建设</h4>
<h5 data-id="heading-72">10.2.1. ACP Agent 市场</h5>
<pre><code class="hljs language-mermaid" lang="mermaid">mindmap
  root((ACP Agent 市场))
    Agent类型
      官方Agent
        Claude
        Gemini
        Codex
      社区Agent
        开源
        定制化
      企业Agent
        私有部署
        定制模型
    用户功能
      浏览和搜索Agent
      查看评分和评论
      一键安装和配置
      分享自己的Agent
</code></pre>
<h5 data-id="heading-73">10.2.2. 标准化的 Agent 能力声明</h5>
<pre><code class="hljs language-json" lang="json"><span class="hljs-comment">// agent-manifest.json</span>
<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"my-custom-agent"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1.0.0"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"A custom coding agent for Rust projects"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"author"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Your Name"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"capabilities"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"languages"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"rust"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"toml"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"frameworks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"tokio"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"actix"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"tools"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"code_generation"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"refactoring"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"testing"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"debugging"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"requirements"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"gpt-4"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"apiKey"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"required"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"minEditorVersion"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"0.158.0"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h5 data-id="heading-74">10.2.3. 跨编辑器同步</h5>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 未来的跨编辑器配置同步</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">AgentConfig</span> {
  <span class="hljs-attr">agents</span>: {
    [<span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>]: {
      <span class="hljs-attr">command</span>: <span class="hljs-built_in">string</span>;
      <span class="hljs-attr">args</span>: <span class="hljs-built_in">string</span>[];
      <span class="hljs-attr">env</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">string</span>&gt;;
      <span class="hljs-attr">settings</span>: <span class="hljs-built_in">any</span>;
    };
  };
  <span class="hljs-attr">preferences</span>: {
    <span class="hljs-attr">defaultAgent</span>: <span class="hljs-built_in">string</span>;
    <span class="hljs-attr">autoStart</span>: <span class="hljs-built_in">boolean</span>;
    <span class="hljs-comment">// ...</span>
  };
}

<span class="hljs-comment">// 同步到云端</span>
<span class="hljs-keyword">await</span> <span class="hljs-title function_">syncConfigToCloud</span>(config);

<span class="hljs-comment">// 在另一台设备上</span>
<span class="hljs-keyword">const</span> config = <span class="hljs-keyword">await</span> <span class="hljs-title function_">loadConfigFromCloud</span>();
</code></pre>
<h4 data-id="heading-75">10.3 与其他标准的集成</h4>
<h5 data-id="heading-76">10.3.1. 与 LSP 的深度集成</h5>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    Editor[Editor]

    subgraph LSP["LSP (提供语言智能)"]
        L1[自动补全]
        L2[类型检查]
        L3[重构建议]
    end

    subgraph ACP["ACP (提供 AI 能力)"]
        A1[理解 LSP 的诊断信息]
        A2[生成符合项目规范的代码]
        A3[自动修复 LSP 报告的错误]
    end

    Editor --&gt; LSP
    Editor --&gt; ACP
    ACP -.读取诊断.-&gt; LSP

    style Editor fill:#e3f2fd
    style LSP fill:#fff3e0
    style ACP fill:#e8f5e9
</code></pre>
<h5 data-id="heading-77">10.3.2. 与 Debug Adapter Protocol (DAP) 集成</h5>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// Agent 可以理解调试信息</span>
{
  <span class="hljs-attr">sessionUpdate</span>: <span class="hljs-string">'debug_analysis'</span>,
  <span class="hljs-attr">breakpoint</span>: {
    <span class="hljs-attr">file</span>: <span class="hljs-string">'src/index.ts'</span>,
    <span class="hljs-attr">line</span>: <span class="hljs-number">42</span>,
    <span class="hljs-attr">variables</span>: {
      <span class="hljs-attr">user</span>: { <span class="hljs-attr">id</span>: <span class="hljs-number">123</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Alice'</span> },
      <span class="hljs-attr">error</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'Invalid token'</span>)
    }
  },
  <span class="hljs-attr">suggestion</span>: <span class="hljs-string">"错误是因为 token 已过期，建议添加 token 刷新逻辑"</span>
}
</code></pre>
<h4 data-id="heading-78">10.4 AI 原生编程范式</h4>
<p>ACP 正在推动一种新的编程范式：<strong>AI 原生编程（AI-Native Programming）</strong>。</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph LR
    subgraph Traditional["传统编程"]
        T1[人类] --&gt; T2[手写代码] --&gt; T3[编译器] --&gt; T4[可执行程序]
    end

    subgraph Current["AI 辅助编程(现在)"]
        C1[人类] --&gt; C2[AI 生成代码片段] --&gt; C3[人类修改] --&gt; C4[编译器] --&gt; C5[可执行程序]
    end

    subgraph Future["AI 原生编程(未来)"]
        F1[人类描述需求] --&gt; F2[AI Agent 理解] --&gt; F3[AI 设计架构]
        F3 --&gt; F4[AI 实现] --&gt; F5[AI 测试] --&gt; F6[AI 部署]
        F6 -.人类审查和指导.-&gt; F1
    end

    style Traditional fill:#ffebee
    style Current fill:#fff3e0
    style Future fill:#e8f5e9
</code></pre>
<p><strong>关键特征：</strong></p>
<ol>
<li><strong>声明式编程</strong>：人类只需描述"要什么"，而不是"怎么做"</li>
<li><strong>持续对话</strong>：编程变成与 AI 的持续对话过程</li>
<li><strong>多层抽象</strong>：从需求 → 架构 → 实现 → 优化，每层都有 AI 辅助</li>
<li><strong>自动化流程</strong>：测试、部署、监控都由 AI 自动化</li>
</ol>
<hr/>
<h3 data-id="heading-79">十一、总结</h3>
<h4 data-id="heading-80">11.1 ACP 的核心价值</h4>
<p>✅ <strong>标准化</strong>：统一的协议规范，消除编辑器与 Agent 的互操作壁垒</p>
<p>✅ <strong>开放性</strong>：开源协议，任何人都可以实现和扩展</p>
<p>✅ <strong>隐私优先</strong>：本地通信，不经过第三方服务器</p>
<p>✅ <strong>可组合性</strong>：与 MCP 等协议协同工作，构建完整的 AI 生态</p>
<p>✅ <strong>易用性</strong>：基于成熟的 JSON-RPC 2.0，简单高效</p>
<h4 data-id="heading-81">11.2 适用场景</h4>
<ul>
<li><strong>代码编辑器开发者</strong>：希望集成多个 AI 编码助手</li>
<li><strong>AI Agent 开发者</strong>：希望让自己的 Agent 被更多编辑器支持</li>
<li><strong>企业开发团队</strong>：需要在统一的编辑器环境中使用不同的 AI 工具</li>
<li><strong>开源社区</strong>：构建开放、协作的 AI 辅助编程生态</li>
</ul>
<h4 data-id="heading-82">11.3 开始使用 ACP</h4>
<h5 data-id="heading-83">11.3.1. 作为编辑器开发者</h5>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 安装 ACP SDK</span>
npm install @agentclientprotocol/sdk

<span class="hljs-comment"># 参考 Zed 的实现</span>
git <span class="hljs-built_in">clone</span> https://github.com/zed-industries/zed
</code></pre>
<h5 data-id="heading-84">11.3.2. 作为 Agent 开发者</h5>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 选择你喜欢的语言 SDK</span>
npm install @agentclientprotocol/sdk       <span class="hljs-comment"># TypeScript</span>
pip install agent-client-protocol          <span class="hljs-comment"># Python</span>
cargo add agent-client-protocol            <span class="hljs-comment"># Rust</span>
</code></pre>
<h5 data-id="heading-85">11.3.3. 作为用户</h5>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 下载支持 ACP 的编辑器</span>
<span class="hljs-comment"># Zed</span>
curl https://zed.dev/install.sh | sh

<span class="hljs-comment"># 配置你喜欢的 Agent</span>
zed --config agents.claude.command=<span class="hljs-string">"claude-code"</span>
</code></pre>
<h4 data-id="heading-86">11.4 学习资源</h4>
<ul>
<li><strong>官方网站</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fagentclientprotocol.com%2F" target="_blank" title="https://agentclientprotocol.com/" ref="nofollow noopener noreferrer">agentclientprotocol.com</a></li>
<li><strong>GitHub 仓库</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fagentclientprotocol%2Fagent-client-protocol" target="_blank" title="https://github.com/agentclientprotocol/agent-client-protocol" ref="nofollow noopener noreferrer">github.com/agentclient…</a></li>
<li><strong>协议规范</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fagentclientprotocol%2Fagent-client-protocol%2Fblob%2Fmain%2Fschema%2Fschema.json" target="_blank" title="https://github.com/agentclientprotocol/agent-client-protocol/blob/main/schema/schema.json" ref="nofollow noopener noreferrer">Schema JSON</a></li>
<li><strong>社区讨论</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fagentclientprotocol%2Fagent-client-protocol%2Fdiscussions" target="_blank" title="https://github.com/agentclientprotocol/agent-client-protocol/discussions" ref="nofollow noopener noreferrer">GitHub Discussions</a></li>
</ul>
<hr/>
<h3 data-id="heading-87">附录：ACP 与 MCP 协议对比速查表</h3>






































































<table><thead><tr><th>特性</th><th>ACP</th><th>MCP</th></tr></thead><tbody><tr><td><strong>完整名称</strong></td><td>Agent Client Protocol</td><td>Model Context Protocol</td></tr><tr><td><strong>主要作用</strong></td><td>编辑器 ↔ AI Agent</td><td>AI Model ↔ Tools</td></tr><tr><td><strong>协议基础</strong></td><td>JSON-RPC 2.0</td><td>JSON-RPC 2.0</td></tr><tr><td><strong>传输方式</strong></td><td>stdio</td><td>stdio / HTTP+SSE</td></tr><tr><td><strong>通信方向</strong></td><td>双向</td><td>主要单向</td></tr><tr><td><strong>生命周期管理</strong></td><td>编辑器控制</td><td>Host 控制</td></tr><tr><td><strong>权限控制</strong></td><td>内置机制</td><td>依赖 Host</td></tr><tr><td><strong>流式响应</strong></td><td>支持</td><td>支持</td></tr><tr><td><strong>作者</strong></td><td>Zed Industries</td><td>Anthropic</td></tr><tr><td><strong>开源协议</strong></td><td>Apache 2.0</td><td>MIT</td></tr><tr><td><strong>发布时间</strong></td><td>2025</td><td>2024</td></tr><tr><td><strong>典型场景</strong></td><td>代码生成、重构</td><td>数据库、API 调用</td></tr></tbody></table>
<hr/>
<p><strong>关于本文</strong></p>
<p>本文结合了：</p>
<ul>
<li>MCP 官方文档和社区实践</li>
<li>ACP 官方规范和 Zed 实现</li>
<li>AionUi 项目的实际代码</li>
<li>行业最佳实践和未来趋势</li>
</ul>
<p>希望能帮助你深入理解 ACP 协议，并在实际项目中应用。</p>
<p><strong>作者</strong>：基于掘金文章《MCP 深度解析》、ACP 官方文档、以及 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FiOfficeAI%2FAionUi" target="_blank" title="https://github.com/iOfficeAI/AionUi" ref="nofollow noopener noreferrer">AionUi</a> 开源项目分析，感兴趣可以关注我！</p>
<h3 data-id="heading-88"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0756528722f34e8d940996215c1693af~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6a2B6aaW:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764319314&amp;x-signature=uJj0k0bF%2Bh%2FybrOXmQQ95dFUyUQ%3D" alt="扫码_搜索联合传播样式-白色版.png" loading="lazy"/></h3>
<p><strong>相关阅读</strong></p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmodelcontextprotocol.io" target="_blank" title="https://modelcontextprotocol.io" ref="nofollow noopener noreferrer">MCP 官方文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fagentclientprotocol.com%2F" target="_blank" title="https://agentclientprotocol.com/" ref="nofollow noopener noreferrer">ACP 官方网站</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fzed.dev%2Facp" target="_blank" title="https://zed.dev/acp" ref="nofollow noopener noreferrer">Zed 编辑器 ACP 集成</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FiOfficeAI%2FAionUi" target="_blank" title="https://github.com/iOfficeAI/AionUi" ref="nofollow noopener noreferrer">AionUi 开源项目</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[robfig/cron定时任务库快速入门]]></title>    <link>https://juejin.cn/post/7574958975159828523</link>    <guid>https://juejin.cn/post/7574958975159828523</guid>    <pubDate>2025-11-21T08:58:28.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574958975159828523" data-draft-id="7573776814926807059" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="robfig/cron定时任务库快速入门"/> <meta itemprop="keywords" content="后端,Go,分布式"/> <meta itemprop="datePublished" content="2025-11-21T08:58:28.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Jerris"/> <meta itemprop="url" content="https://juejin.cn/user/154376649325101"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            robfig/cron定时任务库快速入门
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/154376649325101/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Jerris
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T08:58:28.000Z" title="Fri Nov 21 2025 08:58:28 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.7;font-weight:400;font-size:16px;overflow-x:hidden;color:#2c3e50;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;font-weight:600;margin-top:35px;margin-bottom:8px;padding-bottom:5px}.markdown-body h1 :before,.markdown-body h2 :before,.markdown-body h3 :before,.markdown-body h4 :before,.markdown-body h5 :before,.markdown-body h6 :before{content:"#";display:inline-block;color:#3eaf7c;padding-right:.23em}.markdown-body h1{font-size:30px;margin-bottom:5px}.markdown-body h2{padding-bottom:8px;margin-top:50px;font-size:24px;border-bottom:1px solid #eaecef}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #eaecef;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;overflow-x:auto;font-weight:400;background-color:rgba(27,31,35,.05);color:#476582;margin:0;font-size:.85em;border-radius:3px;font-size:.87em;padding:.165em .5em}.markdown-body code,.markdown-body pre{font-family:source-code-pro,Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.6;padding:20px 24px;background-color:#282c34;border-radius:6px}.markdown-body pre&gt;code{font-size:14px;padding:0;margin:0;word-break:normal;display:block;overflow-x:auto;color:#fff}.markdown-body a{text-decoration:none;color:#3eaf7c;font-weight:500}.markdown-body a:active,.markdown-body a:hover{color:#42b983;border-bottom:1px solid #42b983}.markdown-body table{display:inline-block!important;font-size:14px;width:auto;max-width:100%;overflow:auto;margin:16px 0;border-collapse:collapse}.markdown-body thead{background:#f6f6f6;background:#3eaf7c;color:#000;color:#fff;text-align:left}.markdown-body tr:nth-child(2n){background-color:#f6f8fa}.markdown-body td,.markdown-body th{border:1px solid #dfe2e5;padding:10px 16px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{font-size:14px;padding:6px 23px;margin:22px 0;border-left:6px solid #42b983;background-color:#f3f5f7;font-weight:400}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body p,.markdown-body ul{line-height:1.7}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="xcode">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#fff;color:#000}.xml .hljs-meta{color:silver}.hljs-comment,.hljs-quote{color:#007400}.hljs-attribute,.hljs-keyword,.hljs-literal,.hljs-name,.hljs-selector-tag,.hljs-tag{color:#aa0d91}.hljs-template-variable,.hljs-variable{color:#3f6e74}.hljs-code,.hljs-meta-string,.hljs-string{color:#c41a16}.hljs-link,.hljs-regexp{color:#0e0eff}.hljs-bullet,.hljs-number,.hljs-symbol,.hljs-title{color:#1c00cf}.hljs-meta,.hljs-section{color:#643820}.hljs-built_in,.hljs-builtin-name,.hljs-class .hljs-title,.hljs-params,.hljs-type{color:#5c2699}.hljs-attr{color:#836c28}.hljs-subst{color:#000}.hljs-formula{background-color:#eee;font-style:italic}.hljs-addition{background-color:#baeeba}.hljs-deletion{background-color:#ffc8bd}.hljs-selector-class,.hljs-selector-id{color:#9b703f}.hljs-doctag,.hljs-strong{font-weight:700}.hljs-emphasis{font-style:italic}</style><p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cb7c0f562bfc4010ac1780971ef83882~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmVycmlz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764320497&amp;x-signature=XSKb7RzKstD1J%2Fk%2B7gDUVAEGK%2FU%3D" alt="解释 robfig_cron 库的 Cron 表达式.png" loading="lazy"/></p>
<h2 data-id="heading-0">robfig/cron库简介</h2>
<p>robfig/cron 是 Go 生态里最常用、最稳定的定时任务库之一。它支持标准 Cron 表达式、秒级调度、任务并发控制、任务日志、带上下文执行等功能，非常适合生产环境。</p>
<h2 data-id="heading-1">Quick Start</h2>
<h3 data-id="heading-2">安装命令</h3>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">go</span> get github.com/robfig/cron/v3
</code></pre>
<h3 data-id="heading-3">最简单的demo</h3>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"fmt"</span>
    <span class="hljs-string">"github.com/robfig/cron/v3"</span>
)

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    c := cron.New()

    <span class="hljs-comment">// 每隔 1 分钟执行</span>
    c.AddFunc(<span class="hljs-string">"*/1 * * * *"</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> {
        fmt.Println(<span class="hljs-string">"task run"</span>)
    })

    c.Start()

    <span class="hljs-keyword">select</span> {}
}
</code></pre>
<p>上面的程序表示，每隔一分钟就那个执行这个函数，打印 <code>task run</code> 字符串。这仅仅是最简单的用法，还可以添加 <code>job</code> 实例以实现更复杂的逻辑。</p>
<h2 data-id="heading-4">进阶使用</h2>
<h3 data-id="heading-5">熟悉cron表达式</h3>
<p>robfig/cron（v3 版本）完整支持 标准 Cron 表达式，包括可选的秒字段。它的表达式格式十分灵活，同时支持特殊字符（<code>*</code> 、<code>,</code>、<code>-</code>、<code>/</code> 等）以及扩展语法（如 <code>@every</code>）。</p>
<p>robfig/cron 提供两种模式：</p>
<ul>
<li>标准 5 字段（默认）：</li>
</ul>
<pre><code class="hljs language-txt" lang="txt">分 时 日 月 星期
30 2  *  *  *
表示每天 02:30 执行
</code></pre>
<ul>
<li>启用 <code>WithSeconds()</code> 后变成 6 字段：</li>
</ul>
<pre><code class="hljs language-txt" lang="txt">秒 分 时 日 月 星期
0 */5 *  *  *  *
表示每 5 分钟执行一次（带秒，所以第 1 位是秒）
</code></pre>
<p>在 cron 表达式中，有一些特殊字符，如：<code>*</code>、<code>/</code>、<code>-</code>、<code>,</code>、<code>?</code> 符合，这些符号有着特殊含义，用于灵活地指定时间点。</p>
<ul>
<li><code>*</code>（星号）：</li>
</ul>
<p>表示“所有可能的值”。例如，在 “分钟” 字段中使用 <code>*</code>，表示 “每分钟”。</p>
<ul>
<li><code>/</code>（斜杠）：</li>
</ul>
<p>表示 “每隔” 一定时间。例如，在 “分钟” 字段中使用 <code>*/15</code>，表示 “每隔 15 分钟”（即 0, 15, 30, 45 分）。在 “小时” 字段中使用 <code>2/4</code>，表示 “从 2 点开始，每隔 4 小时”（即 2, 6, 10, 14, 18, 22 点）。</p>
<ul>
<li><code>-</code>（连字符）：</li>
</ul>
<p>表示一个 “范围”。例如，在 “小时” 字段中使用 <code>9-17</code>，表示 “从 9 点到 17 点之间的每一小时”（即 9, 10, ..., 17）。</p>
<ul>
<li><code>,</code>（逗号）</li>
</ul>
<p>表示 “列举多个值”。例如，在 “星期” 字段中使用 <code>1,3,5</code>，表示 “星期一、星期三和星期五”。</p>
<ul>
<li><code>?</code>（问号）</li>
</ul>
<p>这个字符是 robfig/cron 库对标准 Cron 的一个扩展（标准 Cron 中没有 <code>?</code>），但它遵循了 Quartz Scheduler 等流行库的约定。它用于在 “日期” 和 “星期” 字段中表示 “不指定值” 或 “任意值”，用于避免这两个字段之间的冲突。因为在 Cron 表达式中，“日期” 和 “星期” 是互斥的（指定了日期，星期就无关紧要了，反之亦然）。</p>
<p>最佳实践：当你想指定一个具体的日期（例如每月 10 号），就在 “星期” 字段使用 <code>?</code>。当你想指定一个具体的星期几（例如每周一），就在 “日期” 字段使用 <code>?</code>。</p>
<p><code>0 0 10 * ?</code> 表示 “每月 10 号的 0 点 0 分”（星期几无关）。</p>
<p><code>0 0 ? * 1</code> 表示 “每周一的 0 点 0 分”（几号无关）。</p>
<p>在 6 字段格式的基础上，再增加一个 <code>年</code> 字段：</p>
<pre><code class="hljs language-txt" lang="txt">┌───────────── 秒 (0 - 59)
│ ┌───────────── 分钟 (0 - 59)
│ │ ┌───────────── 小时 (0 - 23)
│ │ │ ┌───────────── 日期 (1 - 31)
│ │ │ │ ┌───────────── 月份 (1 - 12)
│ │ │ │ │ ┌───────────── 星期 (0 - 6) (星期日为 0 或 7)
│ │ │ │ │ │ ┌───────────── 年 (可选, 1970-2099)
│ │ │ │ │ │ │
* * * * * * *
</code></pre>
<p><code>0 0 0 1 1 ? 2025</code> 表示 “在 2025 年 1 月 1 日 0 点 0 分 0 秒” 执行。</p>
<h3 data-id="heading-6">预定义的时间表</h3>
<p>为了让常见的调度任务更容易编写，robfig/cron 库还支持一些预定义的字符串，它们是标准 Cron 表达式的别名：</p>



































<table><thead><tr><th align="left">预定义字符串</th><th align="left">等价的 Cron 表达式</th><th align="left">含义</th></tr></thead><tbody><tr><td align="left"><code>@yearly</code> 或 <code>@annually</code></td><td align="left"><code>0 0 0 1 1 *</code></td><td align="left">每年执行一次（1 月 1 日 00:00）</td></tr><tr><td align="left"><code>@monthly</code></td><td align="left"><code>0 0 0 1 * *</code></td><td align="left">每月执行一次（每月 1 日 00:00）</td></tr><tr><td align="left"><code>@weekly</code></td><td align="left"><code>0 0 0 * * 0</code></td><td align="left">每周执行一次（每周日 00:00）</td></tr><tr><td align="left"><code>@daily</code> 或 <code>@midnight</code></td><td align="left"><code>0 0 0 * * *</code></td><td align="left">每天执行一次（00:00）</td></tr><tr><td align="left"><code>@hourly</code></td><td align="left"><code>0 0 * * * *</code></td><td align="left">每小时执行一次（整点）</td></tr></tbody></table>
<p>robfig/cron 还提供了一种扩展预定义关键字，<code>@every</code> 它用于表示 “每隔固定的时间间隔” 执行一次任务。这与标准 Cron 表达式基于 “特定时间点” 的调度方式有本质区别。</p>
<ol>
<li>@every 的核心特点：</li>
</ol>
<p>基于间隔，而非时点：标准的 Cron 表达式（如 <code>0 */5 * * * *</code>）是在每个小时的第 0、5、10... 分钟执行。而 <code>@every 5m</code> 是在任务启动后，每隔 5 分钟执行一次，无论当前是几点几分。</p>
<p>不受系统时间变化影响：如果系统时间因为同步或调整而向后跳跃，基于时点的 Cron 任务可能会被跳过或重复执行。而 <code>@every</code> 是基于内部计时器的，它会严格按照设定的间隔来触发，不受系统时间跳跃的影响（只要时间不向前跳跃）。
语法简洁直观：对于简单的周期性任务，<code>@every</code> 比写 Cron 表达式更直观。例如，<code>@every 1h30m</code> 一眼就能看出是每隔 1 小时 30 分钟执行一次。</p>
<ol start="2">
<li>@every 的语法</li>
</ol>
<p>@every 后面紧跟一个时间间隔字符串，格式为：</p>
<pre><code class="hljs language-txt" lang="txt">@every &lt;duration&gt;
</code></pre>
<p>其中 <code>&lt;duration&gt;</code> 是一个符合 Go 语言 time.Duration 格式的字符串，支持的单位包括：</p>
<ul>
<li>ns：纳秒</li>
<li>us：微秒</li>
<li>ms：毫秒</li>
<li>s：秒</li>
<li>m：分钟</li>
<li>h：小时</li>
<li>d：天（注意：d 是 <code>robfig/cron</code> 库支持的扩展单位，标准的 <code>time.Duration</code> 并不直接支持 d，但库内部会将其转换为小时）</li>
</ul>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// 假设现在是 10:03:25</span>
c.AddFunc(<span class="hljs-string">"@every 5m"</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> {
    fmt.Println(<span class="hljs-string">"任务执行了"</span>)
})
</code></pre>
<ul>
<li><strong>第一次执行时间：</strong>  10:03:25（任务添加后立即开始计时，5 分钟后触发）</li>
<li><strong>第二次执行时间：</strong>  10:08:25</li>
<li><strong>第三次执行时间：</strong>  10:13:25</li>
<li><strong>...</strong>  以此类推，严格间隔 5 分钟。</li>
</ul>
<p><strong>使用场景：</strong></p>
<ul>
<li>
<p><strong>使用 <code>@every</code> 的场景：</strong></p>
<ul>
<li>你需要一个简单、固定的时间间隔来执行任务，不关心具体在哪个时间点。</li>
<li>任务的执行间隔较短（如几秒、几分钟）。</li>
<li>你希望任务从启动后就开始按照间隔执行，而不是等待下一个整点。</li>
<li>例如：定期检查某个服务的健康状态、定期从数据库中清理过期数据、实时数据处理等。</li>
</ul>
</li>
<li>
<p><strong>使用标准 Cron 表达式的场景：</strong></p>
<ul>
<li>你需要任务在<strong>特定的时间点</strong>执行，而不是固定的间隔。</li>
<li>任务的执行周期与日历相关（如每天早上 8 点、每周一晚上、每月 15 号）。</li>
<li>例如：每天凌晨 3 点生成日报、每周五下午 5 点备份数据库、每月 1 号结算账单。</li>
</ul>
</li>
</ul>
<p><code>@every</code> 是 <code>robfig/cron</code> 库提供的一个非常方便的工具，它提供了一种<strong>基于固定间隔</strong>的调度方式，与标准 Cron 表达式<strong>基于特定时点</strong>的调度方式形成了很好的互补。</p>
<p>选择使用 <code>@every</code> 还是标准 Cron 表达式，主要取决于你的任务是需要 “每隔多久执行一次” 还是 “在某个特定时间执行”。</p>
<h3 data-id="heading-7">自定义Job实例</h3>
<p>好的，在 robfig/cron/v3 中自定义 Job 实例通常有两种方式：结构体嵌入和函数包装。以下是具体实现和说明：</p>
<h4 data-id="heading-8">结构体嵌入</h4>
<p>通过定义一个结构体，嵌入 <code>cron.Job</code> 接口，然后实现自定义的 <code>Run()</code> 方法。</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"fmt"</span>
    <span class="hljs-string">"time"</span>

    <span class="hljs-string">"github.com/robfig/cron/v3"</span>
)

<span class="hljs-comment">// 定义一个自定义任务结构体</span>
<span class="hljs-keyword">type</span> MyJob <span class="hljs-keyword">struct</span> {
    Name <span class="hljs-type">string</span>
    <span class="hljs-comment">// 可以添加其他字段，比如配置、依赖等</span>
}

<span class="hljs-comment">// 实现 cron.Job 接口的 Run 方法</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(m *MyJob)</span></span> Run() {
    fmt.Printf(<span class="hljs-string">"任务 [%s] 执行时间: %s\n"</span>, m.Name, time.Now().Format(<span class="hljs-string">"2006-01-02 15:04:05"</span>))
    <span class="hljs-comment">// 这里可以写具体的任务逻辑</span>
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// 创建一个 cron 调度器</span>
    c := cron.New()

    <span class="hljs-comment">// 实例化自定义任务</span>
    job1 := &amp;MyJob{Name: <span class="hljs-string">"任务A"</span>}
    job2 := &amp;MyJob{Name: <span class="hljs-string">"任务B"</span>}

    <span class="hljs-comment">// 添加任务到调度器</span>
    _, err := c.AddJob(<span class="hljs-string">"*/5 * * * *"</span>, job1) <span class="hljs-comment">// 每5分钟执行一次</span>
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        fmt.Println(<span class="hljs-string">"添加任务A失败:"</span>, err)
        <span class="hljs-keyword">return</span>
    }

    _, err = c.AddJob(<span class="hljs-string">"@hourly"</span>, job2) <span class="hljs-comment">// 每小时执行一次</span>
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        fmt.Println(<span class="hljs-string">"添加任务B失败:"</span>, err)
        <span class="hljs-keyword">return</span>
    }

    <span class="hljs-comment">// 启动调度器</span>
    c.Start()

    <span class="hljs-comment">// 保持程序运行</span>
    <span class="hljs-keyword">select</span> {}
}
</code></pre>
<p><strong>优点：</strong></p>
<ul>
<li>结构清晰，易于扩展和维护</li>
<li>可以在结构体中存储任务相关的配置和状态</li>
<li>支持依赖注入</li>
</ul>
<h4 data-id="heading-9">带有上下文的任务</h4>
<p>如果你需要在任务中处理上下文（比如取消信号），可以实现 <code>cron.Job</code> 接口并在 <code>Run()</code> 方法中使用上下文。</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"context"</span>
    <span class="hljs-string">"fmt"</span>
    <span class="hljs-string">"time"</span>

    <span class="hljs-string">"github.com/robfig/cron/v3"</span>
)

<span class="hljs-keyword">type</span> ContextJob <span class="hljs-keyword">struct</span> {
    ctx context.Context
    <span class="hljs-comment">// 其他字段</span>
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *ContextJob)</span></span> Run() {
    <span class="hljs-keyword">select</span> {
    <span class="hljs-keyword">case</span> &lt;-c.ctx.Done():
        fmt.Println(<span class="hljs-string">"任务被取消"</span>)
        <span class="hljs-keyword">return</span>
    <span class="hljs-keyword">default</span>:
        fmt.Printf(<span class="hljs-string">"上下文任务执行时间: %s\n"</span>, time.Now().Format(<span class="hljs-string">"2006-01-02 15:04:05"</span>))
    }
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    ctx, cancel := context.WithCancel(context.Background())
    <span class="hljs-keyword">defer</span> cancel()

    c := cron.New()

    job := &amp;ContextJob{ctx: ctx}
    _, err := c.AddJob(<span class="hljs-string">"*/30 * * * *"</span>, job)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        fmt.Println(<span class="hljs-string">"添加任务失败:"</span>, err)
        <span class="hljs-keyword">return</span>
    }

    c.Start()

    <span class="hljs-comment">// 等待用户输入后停止</span>
    fmt.Println(<span class="hljs-string">"按 Enter 键停止程序..."</span>)
    fmt.Scanln()
    cancel() <span class="hljs-comment">// 取消上下文</span>
    c.Stop() <span class="hljs-comment">// 停止调度器</span>
}
</code></pre>
<h4 data-id="heading-10">任务的优先级和并发控制</h4>
<p><code>robfig/cron/v3</code> 默认是并发执行任务的，如果需要控制并发，可以使用 <code>cron.WithMaxConcurrentJobs()</code> 选项。</p>
<pre><code class="hljs language-go" lang="go">c := cron.New(cron.WithMaxConcurrentJobs(<span class="hljs-number">3</span>, cron.DefaultLogger))
</code></pre>
<p>这样可以限制最多同时运行 3 个任务。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[手把手打通 H5 多支付通道（Apple pay、Google pay、第三方卡支付）]]></title>    <link>https://juejin.cn/post/7574992086714662927</link>    <guid>https://juejin.cn/post/7574992086714662927</guid>    <pubDate>2025-11-21T08:51:24.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574992086714662927" data-draft-id="7574978847151095848" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="手把手打通 H5 多支付通道（Apple pay、Google pay、第三方卡支付）"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-11-21T08:51:24.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="喝二两啤酒"/> <meta itemprop="url" content="https://juejin.cn/user/3087895803997325"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            手把手打通 H5 多支付通道（Apple pay、Google pay、第三方卡支付）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3087895803997325/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    喝二两啤酒
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T08:51:24.000Z" title="Fri Nov 21 2025 08:51:24 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    14
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>本文只聚焦支付逻辑：在一个 Vue 组件里同时兼容 Apple Pay、Google Pay 与钱海信用卡（Oceanpayment）。核心思路是“分三条链路获取 quickpayId，最后统一交给 <code>processPayment</code>”。</p>
<hr/>
<h2 data-id="heading-1">代码讲解</h2>
<h3 data-id="heading-2">Apple Pay</h3>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">const</span> <span class="hljs-title function_">createApplePaySession</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">const</span> request = {
    <span class="hljs-attr">countryCode</span>: <span class="hljs-variable constant_">PAYMENT_CONFIG</span>.<span class="hljs-property">applePay</span>.<span class="hljs-property">countryCode</span>,
    <span class="hljs-attr">currencyCode</span>: <span class="hljs-variable constant_">PAYMENT_CONFIG</span>.<span class="hljs-property">applePay</span>.<span class="hljs-property">currencyCode</span>,
    <span class="hljs-attr">supportedNetworks</span>: <span class="hljs-variable constant_">PAYMENT_CONFIG</span>.<span class="hljs-property">applePay</span>.<span class="hljs-property">supportedNetworks</span>,
    <span class="hljs-attr">total</span>: {
      <span class="hljs-attr">label</span>: <span class="hljs-variable constant_">PAYMENT_CONFIG</span>.<span class="hljs-property">applePay</span>.<span class="hljs-property">displayName</span>,
      <span class="hljs-attr">amount</span>: <span class="hljs-built_in">parseFloat</span>(currentPrice.<span class="hljs-property">value</span>).<span class="hljs-title function_">toFixed</span>(<span class="hljs-number">2</span>),
      <span class="hljs-attr">type</span>: <span class="hljs-string">"final"</span>
    }
  };

  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> session = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ApplePaySession</span>(<span class="hljs-number">3</span>, request);

    session.<span class="hljs-property">onvalidatemerchant</span> = <span class="hljs-keyword">async</span> () =&gt; {
      <span class="hljs-keyword">const</span> resp = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getApplePayMerchantValidation</span>({
        <span class="hljs-attr">initiative</span>: <span class="hljs-string">"web"</span>,
        <span class="hljs-attr">initiativeContext</span>: <span class="hljs-string">"h5.tanlinkerp.cn"</span>,
        <span class="hljs-attr">merchantIdentifier</span>: <span class="hljs-variable constant_">PAYMENT_CONFIG</span>.<span class="hljs-property">applePay</span>.<span class="hljs-property">merchantId</span>
      });
      session.<span class="hljs-title function_">completeMerchantValidation</span>(
        <span class="hljs-keyword">typeof</span> resp.<span class="hljs-property">data</span> === <span class="hljs-string">"string"</span> ? <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(resp.<span class="hljs-property">data</span>) : resp.<span class="hljs-property">data</span>
      );
    };

    session.<span class="hljs-property">onpaymentauthorized</span> = <span class="hljs-function"><span class="hljs-params">event</span> =&gt;</span> {
      <span class="hljs-keyword">const</span> token = event.<span class="hljs-property">payment</span>?.<span class="hljs-property">token</span>?.<span class="hljs-property">paymentData</span>;
      session.<span class="hljs-title function_">completePayment</span>(token ? <span class="hljs-title class_">ApplePaySession</span>.<span class="hljs-property">STATUS_SUCCESS</span> : <span class="hljs-title class_">ApplePaySession</span>.<span class="hljs-property">STATUS_FAILURE</span>);
      token ? <span class="hljs-title function_">resolve</span>(token) : <span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">"Invalid payment data"</span>));
    };

    session.<span class="hljs-property">oncancel</span> = <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">"User cancelled"</span>));
    session.<span class="hljs-property">onerror</span> = <span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> <span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(err.<span class="hljs-property">message</span>));

    session.<span class="hljs-title function_">begin</span>();
  });
};
</code></pre>
<blockquote>
<p>图示说明：这段代码做两件事——1）在 <code>onvalidatemerchant</code> 里向后端要 <code>merchantSession</code>；2）在 <code>onpaymentauthorized</code> 中拿到 <code>paymentData</code> 并返回。</p>
</blockquote>
<ul>
<li>拿到 <code>paymentData</code> 后，调用 <code>getGoogleOrAppleBindCard({ methods: "ApplePay", payAccountNumber: token })</code>。</li>
<li>接口返回 <code>quickpayId</code>，再执行 <code>processPayment(quickpayId, "Apple Pay")</code>。</li>
</ul>
<h3 data-id="heading-3">Google Pay</h3>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">const</span> <span class="hljs-title function_">createGooglePaySession</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">const</span> paymentsClient = <span class="hljs-keyword">new</span> google.<span class="hljs-property">payments</span>.<span class="hljs-property">api</span>.<span class="hljs-title class_">PaymentsClient</span>({
    <span class="hljs-attr">environment</span>: <span class="hljs-variable constant_">PAYMENT_CONFIG</span>.<span class="hljs-property">googlePay</span>.<span class="hljs-property">environment</span>
  });

  <span class="hljs-keyword">const</span> paymentDataRequest = {
    <span class="hljs-attr">apiVersion</span>: <span class="hljs-number">2</span>,
    <span class="hljs-attr">allowedPaymentMethods</span>: [{
      <span class="hljs-attr">type</span>: <span class="hljs-string">"CARD"</span>,
      <span class="hljs-attr">parameters</span>: {
        <span class="hljs-attr">allowedAuthMethods</span>: [<span class="hljs-string">"PAN_ONLY"</span>, <span class="hljs-string">"CRYPTOGRAM_3DS"</span>],
        <span class="hljs-attr">allowedCardNetworks</span>: [<span class="hljs-string">"MASTERCARD"</span>, <span class="hljs-string">"VISA"</span>]
      },
      <span class="hljs-attr">tokenizationSpecification</span>: {
        <span class="hljs-attr">type</span>: <span class="hljs-string">"PAYMENT_GATEWAY"</span>,
        <span class="hljs-attr">parameters</span>: { <span class="hljs-attr">gateway</span>: <span class="hljs-string">"example"</span>, <span class="hljs-attr">gatewayMerchantId</span>: <span class="hljs-string">"exampleGatewayMerchantId"</span> }
      }
    }],
    <span class="hljs-attr">transactionInfo</span>: {
      <span class="hljs-attr">totalPriceStatus</span>: <span class="hljs-string">"FINAL"</span>,
      <span class="hljs-attr">totalPrice</span>: <span class="hljs-built_in">parseFloat</span>(currentPrice.<span class="hljs-property">value</span>).<span class="hljs-title function_">toFixed</span>(<span class="hljs-number">2</span>),
      <span class="hljs-attr">currencyCode</span>: <span class="hljs-string">"USD"</span>
    },
    <span class="hljs-attr">merchantInfo</span>: <span class="hljs-variable constant_">PAYMENT_CONFIG</span>.<span class="hljs-property">googlePay</span>
  };

  <span class="hljs-keyword">const</span> paymentData = <span class="hljs-keyword">await</span> paymentsClient.<span class="hljs-title function_">loadPaymentData</span>(paymentDataRequest);
  <span class="hljs-keyword">return</span> paymentData.<span class="hljs-property">paymentMethodData</span>.<span class="hljs-property">tokenizationData</span>.<span class="hljs-property">token</span>;
};
</code></pre>
<ul>
<li>Google Pay 只需要 <code>loadPaymentData</code>，但在展示入口之前最好调用 <code>paymentsClient.isReadyToPay()</code> 过滤不可用设备。</li>
<li>获取的 <code>token</code> 走 <code>getGoogleOrAppleBindCard({ methods: "GooglePay" })</code>，返回 <code>quickpayId</code> 后仍旧调用 <code>processPayment(quickpayId, "Google Pay")</code>。</li>
</ul>
<h3 data-id="heading-4">钱海信用卡</h3>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">const</span> <span class="hljs-title function_">fetchUserCards</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getUserCards</span>({ <span class="hljs-attr">country</span>: userCountry.<span class="hljs-property">value</span> });
  <span class="hljs-keyword">if</span> (response.<span class="hljs-property">code</span> === <span class="hljs-number">200</span>) {
    userCards.<span class="hljs-property">value</span> = response.<span class="hljs-property">data</span>;
    selectedCard.<span class="hljs-property">value</span> = <span class="hljs-number">0</span>;
    selectedPayment.<span class="hljs-property">value</span> = <span class="hljs-string">"credit"</span>;
  }
};

<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleSubmit</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">if</span> (selectedPayment.<span class="hljs-property">value</span> === <span class="hljs-string">"credit"</span>) {
    <span class="hljs-keyword">const</span> quickpayId = userCards.<span class="hljs-property">value</span>[selectedCard.<span class="hljs-property">value</span>]?.<span class="hljs-property">quickPayId</span>;
    <span class="hljs-keyword">await</span> <span class="hljs-title function_">processPayment</span>(quickpayId, <span class="hljs-string">"Credit Card"</span>);
  }
};
</code></pre>
<ul>
<li>信用卡 <code>quickpayId</code> 来自绑卡页（Oceanpayment SDK），支付页只负责取值并回传后端。</li>
<li><code>processPayment</code> 内部会拼 <code>payDetailId</code>、<code>backUrl</code>、<code>payMethod</code>，调用 <code>getSubAndZf</code>。返回 <code>payUrl</code> 时直接 <code>window.location.href = payUrl</code>，否则跳 <code>paymentStatus</code>。</li>
</ul>
<hr/>
<h2 data-id="heading-5">关键知识点</h2>
<ol>
<li><strong>统一出口</strong>：所有方式都必须拿到 <code>quickpayId</code> 才能进入 <code>processPayment</code>，便于维护和埋点。</li>
<li><strong>安全检查</strong>：Apple/Google Pay 均需 HTTPS 或安全上下文，并提前检测 <code>ApplePaySession</code>、<code>google.payments</code> 是否存在。</li>
<li><strong>倒计时 + 状态恢复</strong>：<code>startCountdown</code> 限制 15 分钟窗口，<code>sessionStorage.paymentData</code> 保存 <code>payDetailId</code> 与金额，用于刷新/跳转后的恢复。</li>
<li><strong>SDK 加载</strong>：Google Pay 通过 <code>loadSDKs</code> 按需注入脚本；Apple Pay 无需额外脚本，但要处理商户验证超时。</li>
</ol>
<hr/>
<h2 data-id="heading-6">最佳实践 / 扩展方案</h2>
<ul>
<li><strong>错误分类</strong>：针对“用户取消”“商户验证失败”“绑定失败”分别提示并上报，方便排查。</li>
<li><strong>动态排序</strong>：根据设备或 <code>userCountry</code> 调整支付方式顺序，例如 iOS 优先展示 Apple Pay。</li>
<li><strong>离线兜底</strong>：倒计时结束时提示用户联系人工，避免订单遗失。</li>
<li><strong>监控指标</strong>：在 <code>selectPayment</code>、<code>handleSubmit</code>、<code>processPayment</code> 打点，分析各通道转化。</li>
</ul>
<hr/>
<h2 data-id="heading-7">小结</h2>
<p>整合多支付的关键是把 Apple Pay、Google Pay、钱海信用卡看作三条“获取 quickpayId 的管道”。一旦拿到 <code>quickpayId</code>，就能统一交给 <code>processPayment</code>，并享受相同的倒计时、状态恢复和跳转逻辑。需要扩展新的支付方式时，遵循这套模式即可快速接入。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[工厂模式详解]]></title>    <link>https://juejin.cn/post/7574775334681935882</link>    <guid>https://juejin.cn/post/7574775334681935882</guid>    <pubDate>2025-11-21T07:59:50.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574775334681935882" data-draft-id="7574775334681903114" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="工厂模式详解"/> <meta itemprop="keywords" content="设计模式"/> <meta itemprop="datePublished" content="2025-11-21T07:59:50.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="雨中飘荡的记忆"/> <meta itemprop="url" content="https://juejin.cn/user/694547077666606"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            工厂模式详解
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/694547077666606/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    雨中飘荡的记忆
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T07:59:50.000Z" title="Fri Nov 21 2025 07:59:50 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读19分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">深入理解设计模式之工厂方法模式（Factory Method Pattern）</h2>
<h3 data-id="heading-1">一、引言</h3>
<p>在软件开发中，对象创建是一个非常常见的操作。但是，如果在代码中直接使用<code>new</code>操作符创建对象，会导致代码与具体类紧密耦合，降低系统的灵活性和可扩展性。工厂方法模式正是为了解决这个问题而诞生的一种创建型设计模式。</p>
<p>本文将深入探讨工厂方法模式的原理、实现方式，并结合实际生产场景和开源框架（如JDK、Spring、Guava）中的应用，帮助你全面掌握这一重要的设计模式。</p>
<h3 data-id="heading-2">二、什么是工厂方法模式</h3>
<h4 data-id="heading-3">2.1 定义</h4>
<p>工厂方法模式（Factory Method Pattern）是一种创建型设计模式，它定义了一个创建对象的接口，但由子类决定要实例化的类是哪一个。工厂方法让类的实例化推迟到子类中进行。</p>
<h4 data-id="heading-4">2.2 核心思想</h4>
<ul>
<li><strong>封装对象创建</strong>：将对象的创建逻辑封装在工厂方法中</li>
<li><strong>依赖抽象而非具体</strong>：客户端依赖抽象产品和抽象工厂</li>
<li><strong>开闭原则</strong>：添加新产品时无需修改现有代码</li>
<li><strong>单一职责</strong>：将产品创建职责分离到专门的工厂类</li>
</ul>
<h4 data-id="heading-5">2.3 模式结构</h4>
<pre><code class="hljs language-scss" lang="scss">┌──────────────────────┐
│    &lt;&lt;interface&gt;&gt;     │
│      Product         │    抽象产品
├──────────────────────┤
│ + <span class="hljs-built_in">operation</span>()        │
└──────────────────────┘
           △
           │ 实现
     ┌─────┴──────┐
     │            │
┌────┴─────┐  ┌──┴────────┐
│ConcreteA │  │ConcreteB  │  具体产品
└──────────┘  └───────────┘
     △              △
     │创建          │创建
     │              │
┌────┴─────────────┴────┐
│   &lt;&lt;abstract&gt;&gt;         │
│      Creator           │    抽象创建者
├────────────────────────┤
│ + <span class="hljs-built_in">factoryMethod</span>()      │ &lt;-- 工厂方法（抽象）
│ + <span class="hljs-built_in">operation</span>()          │ &lt;-- 使用产品的业务方法
└────────────────────────┘
           △
           │ 继承
     ┌─────┴──────┐
     │            │
┌────┴────────┐  ┌┴────────────┐
│CreatorA     │  │CreatorB     │  具体创建者
├─────────────┤  ├─────────────┤
│factoryMethod│  │factoryMethod│ &lt;-- 返回具体产品
└─────────────┘  └─────────────┘

调用流程：
Client → Creator<span class="hljs-selector-class">.operation</span>() → <span class="hljs-built_in">factoryMethod</span>() → ConcreteProduct
</code></pre>
<h4 data-id="heading-6">2.4 与简单工厂的区别</h4>
<pre><code class="hljs language-scss" lang="scss">简单工厂（不是GoF23种模式之一）：
┌─────────────┐      ┌──────────────┐
│   Client    │─────→│SimpleFactory │
└─────────────┘      ├──────────────┤
                     │+ <span class="hljs-built_in">create</span>(type)│
                     └───────┬──────┘
                             │创建
                    ┌────────┼────────┐
                    ▼        ▼        ▼
               ProductA  ProductB  ProductC

工厂方法：
┌─────────────┐      ┌──────────────┐
│   Client    │─────→│   Factory    │
└─────────────┘      ├──────────────┤
                     │+ <span class="hljs-built_in">create</span>()    │抽象方法
                     └───────△──────┘
                             │
                    ┌────────┼────────┐
                    │        │        │
                FactoryA FactoryB FactoryC
                    │        │        │
                创建│    创建│    创建│
                    ▼        ▼        ▼
               ProductA  ProductB  ProductC
</code></pre>
<h3 data-id="heading-7">三、基础示例</h3>
<h4 data-id="heading-8">3.1 场景：日志记录器工厂</h4>
<p>不同的应用场景需要不同类型的日志记录器（文件日志、数据库日志、远程日志等）。</p>
<p><strong>抽象产品 - 日志记录器：</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * 抽象产品：日志记录器接口
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Logger</span> {
    <span class="hljs-comment">/**
     * 记录日志
     * <span class="hljs-doctag">@param</span> message 日志消息
     */</span>
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">log</span><span class="hljs-params">(String message)</span>;

    <span class="hljs-comment">/**
     * 获取日志类型
     */</span>
    String <span class="hljs-title function_">getLoggerType</span><span class="hljs-params">()</span>;
}
</code></pre>
<p><strong>具体产品：</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * 具体产品：文件日志记录器
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FileLogger</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Logger</span> {

    <span class="hljs-keyword">private</span> String filePath;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">FileLogger</span><span class="hljs-params">(String filePath)</span> {
        <span class="hljs-built_in">this</span>.filePath = filePath;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">log</span><span class="hljs-params">(String message)</span> {
        System.out.println(<span class="hljs-string">"[FileLogger] 写入文件 "</span> + filePath + <span class="hljs-string">": "</span> + message);
        <span class="hljs-comment">// 实际实现中会写入文件</span>
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getLoggerType</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"FILE"</span>;
    }
}

<span class="hljs-comment">/**
 * 具体产品：数据库日志记录器
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DatabaseLogger</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Logger</span> {

    <span class="hljs-keyword">private</span> String connectionString;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">DatabaseLogger</span><span class="hljs-params">(String connectionString)</span> {
        <span class="hljs-built_in">this</span>.connectionString = connectionString;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">log</span><span class="hljs-params">(String message)</span> {
        System.out.println(<span class="hljs-string">"[DatabaseLogger] 写入数据库 "</span> + connectionString + <span class="hljs-string">": "</span> + message);
        <span class="hljs-comment">// 实际实现中会写入数据库</span>
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getLoggerType</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"DATABASE"</span>;
    }
}

<span class="hljs-comment">/**
 * 具体产品：控制台日志记录器
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConsoleLogger</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Logger</span> {

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">log</span><span class="hljs-params">(String message)</span> {
        System.out.println(<span class="hljs-string">"[ConsoleLogger] "</span> + message);
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getLoggerType</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"CONSOLE"</span>;
    }
}
</code></pre>
<p><strong>抽象工厂：</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * 抽象创建者：日志工厂
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LoggerFactory</span> {

    <span class="hljs-comment">/**
     * 工厂方法：创建日志记录器（由子类实现）
     */</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">abstract</span> Logger <span class="hljs-title function_">createLogger</span><span class="hljs-params">()</span>;

    <span class="hljs-comment">/**
     * 业务方法：记录日志
     * 这个方法使用工厂方法创建的产品
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">writeLog</span><span class="hljs-params">(String message)</span> {
        <span class="hljs-comment">// 使用工厂方法获取日志记录器</span>
        <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> createLogger();

        <span class="hljs-comment">// 添加时间戳</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">timestamp</span> <span class="hljs-operator">=</span> java.time.LocalDateTime.now().toString();
        <span class="hljs-type">String</span> <span class="hljs-variable">formattedMessage</span> <span class="hljs-operator">=</span> <span class="hljs-string">"["</span> + timestamp + <span class="hljs-string">"] "</span> + message;

        <span class="hljs-comment">// 记录日志</span>
        logger.log(formattedMessage);

        <span class="hljs-comment">// 可以添加更多通用逻辑</span>
        System.out.println(<span class="hljs-string">"日志已通过 "</span> + logger.getLoggerType() + <span class="hljs-string">" 记录"</span>);
    }
}
</code></pre>
<p><strong>具体工厂：</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * 具体创建者：文件日志工厂
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FileLoggerFactory</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">LoggerFactory</span> {

    <span class="hljs-keyword">private</span> String filePath;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">FileLoggerFactory</span><span class="hljs-params">(String filePath)</span> {
        <span class="hljs-built_in">this</span>.filePath = filePath;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> Logger <span class="hljs-title function_">createLogger</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileLogger</span>(filePath);
    }
}

<span class="hljs-comment">/**
 * 具体创建者：数据库日志工厂
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DatabaseLoggerFactory</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">LoggerFactory</span> {

    <span class="hljs-keyword">private</span> String connectionString;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">DatabaseLoggerFactory</span><span class="hljs-params">(String connectionString)</span> {
        <span class="hljs-built_in">this</span>.connectionString = connectionString;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> Logger <span class="hljs-title function_">createLogger</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DatabaseLogger</span>(connectionString);
    }
}

<span class="hljs-comment">/**
 * 具体创建者：控制台日志工厂
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConsoleLoggerFactory</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">LoggerFactory</span> {

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> Logger <span class="hljs-title function_">createLogger</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConsoleLogger</span>();
    }
}
</code></pre>
<p><strong>客户端使用：</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LoggerTest</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 根据配置选择不同的工厂</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">logType</span> <span class="hljs-operator">=</span> getLogTypeFromConfig(); <span class="hljs-comment">// 可以从配置文件读取</span>

        LoggerFactory factory;

        <span class="hljs-keyword">switch</span> (logType) {
            <span class="hljs-keyword">case</span> <span class="hljs-string">"file"</span>:
                factory = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileLoggerFactory</span>(<span class="hljs-string">"/var/log/app.log"</span>);
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">"database"</span>:
                factory = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DatabaseLoggerFactory</span>(<span class="hljs-string">"jdbc:mysql://localhost/logs"</span>);
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">default</span>:
                factory = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConsoleLoggerFactory</span>();
        }

        <span class="hljs-comment">// 客户端代码不需要知道具体的日志记录器类型</span>
        factory.writeLog(<span class="hljs-string">"应用程序启动"</span>);
        factory.writeLog(<span class="hljs-string">"用户登录成功"</span>);
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">getLogTypeFromConfig</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// 模拟从配置读取</span>
        <span class="hljs-keyword">return</span> <span class="hljs-string">"file"</span>;
    }
}
</code></pre>
<p><strong>输出：</strong></p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-attr">[FileLogger]</span> 写入文件 /<span class="hljs-selector-tag">var</span>/<span class="hljs-selector-tag">log</span>/<span class="hljs-selector-tag">app</span><span class="hljs-selector-class">.log</span>: <span class="hljs-selector-attr">[2025-01-19T10:30:00]</span> 应用程序启动
日志已通过 <span class="hljs-selector-tag">FILE</span> 记录
<span class="hljs-selector-attr">[FileLogger]</span> 写入文件 /<span class="hljs-selector-tag">var</span>/<span class="hljs-selector-tag">log</span>/<span class="hljs-selector-tag">app</span><span class="hljs-selector-class">.log</span>: <span class="hljs-selector-attr">[2025-01-19T10:30:01]</span> 用户登录成功
日志已通过 <span class="hljs-selector-tag">FILE</span> 记录
</code></pre>
<h3 data-id="heading-9">四、实际生产场景应用</h3>
<h4 data-id="heading-10">4.1 场景：数据库连接工厂</h4>
<p>在企业应用中，需要支持多种数据库（MySQL、PostgreSQL、Oracle等），每种数据库的连接方式不同。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * 抽象产品：数据库连接
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">DatabaseConnection</span> {
    <span class="hljs-comment">/**
     * 连接数据库
     */</span>
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">connect</span><span class="hljs-params">()</span>;

    <span class="hljs-comment">/**
     * 执行SQL
     */</span>
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">executeQuery</span><span class="hljs-params">(String sql)</span>;

    <span class="hljs-comment">/**
     * 断开连接
     */</span>
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">disconnect</span><span class="hljs-params">()</span>;

    <span class="hljs-comment">/**
     * 获取数据库类型
     */</span>
    String <span class="hljs-title function_">getDatabaseType</span><span class="hljs-params">()</span>;
}

<span class="hljs-comment">/**
 * 具体产品：MySQL连接
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MySqlConnection</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">DatabaseConnection</span> {

    <span class="hljs-keyword">private</span> String host;
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> port;
    <span class="hljs-keyword">private</span> String database;
    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">connected</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">MySqlConnection</span><span class="hljs-params">(String host, <span class="hljs-type">int</span> port, String database)</span> {
        <span class="hljs-built_in">this</span>.host = host;
        <span class="hljs-built_in">this</span>.port = port;
        <span class="hljs-built_in">this</span>.database = database;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">connect</span><span class="hljs-params">()</span> {
        System.out.println(<span class="hljs-string">"连接到 MySQL: "</span> + host + <span class="hljs-string">":"</span> + port + <span class="hljs-string">"/"</span> + database);
        <span class="hljs-comment">// 实际实现：使用JDBC连接MySQL</span>
        <span class="hljs-comment">// Connection conn = DriverManager.getConnection(url, user, password);</span>
        connected = <span class="hljs-literal">true</span>;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">executeQuery</span><span class="hljs-params">(String sql)</span> {
        <span class="hljs-keyword">if</span> (!connected) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalStateException</span>(<span class="hljs-string">"未连接到数据库"</span>);
        }
        System.out.println(<span class="hljs-string">"[MySQL] 执行SQL: "</span> + sql);
        <span class="hljs-comment">// 实际实现：执行SQL查询</span>
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">disconnect</span><span class="hljs-params">()</span> {
        System.out.println(<span class="hljs-string">"断开 MySQL 连接"</span>);
        connected = <span class="hljs-literal">false</span>;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getDatabaseType</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"MySQL"</span>;
    }
}

<span class="hljs-comment">/**
 * 具体产品：PostgreSQL连接
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PostgreSqlConnection</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">DatabaseConnection</span> {

    <span class="hljs-keyword">private</span> String host;
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> port;
    <span class="hljs-keyword">private</span> String database;
    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">connected</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">PostgreSqlConnection</span><span class="hljs-params">(String host, <span class="hljs-type">int</span> port, String database)</span> {
        <span class="hljs-built_in">this</span>.host = host;
        <span class="hljs-built_in">this</span>.port = port;
        <span class="hljs-built_in">this</span>.database = database;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">connect</span><span class="hljs-params">()</span> {
        System.out.println(<span class="hljs-string">"连接到 PostgreSQL: "</span> + host + <span class="hljs-string">":"</span> + port + <span class="hljs-string">"/"</span> + database);
        connected = <span class="hljs-literal">true</span>;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">executeQuery</span><span class="hljs-params">(String sql)</span> {
        <span class="hljs-keyword">if</span> (!connected) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalStateException</span>(<span class="hljs-string">"未连接到数据库"</span>);
        }
        System.out.println(<span class="hljs-string">"[PostgreSQL] 执行SQL: "</span> + sql);
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">disconnect</span><span class="hljs-params">()</span> {
        System.out.println(<span class="hljs-string">"断开 PostgreSQL 连接"</span>);
        connected = <span class="hljs-literal">false</span>;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getDatabaseType</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"PostgreSQL"</span>;
    }
}

<span class="hljs-comment">/**
 * 具体产品：Oracle连接
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OracleConnection</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">DatabaseConnection</span> {

    <span class="hljs-keyword">private</span> String host;
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> port;
    <span class="hljs-keyword">private</span> String sid;
    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">connected</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">OracleConnection</span><span class="hljs-params">(String host, <span class="hljs-type">int</span> port, String sid)</span> {
        <span class="hljs-built_in">this</span>.host = host;
        <span class="hljs-built_in">this</span>.port = port;
        <span class="hljs-built_in">this</span>.sid = sid;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">connect</span><span class="hljs-params">()</span> {
        System.out.println(<span class="hljs-string">"连接到 Oracle: "</span> + host + <span class="hljs-string">":"</span> + port + <span class="hljs-string">" SID="</span> + sid);
        connected = <span class="hljs-literal">true</span>;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">executeQuery</span><span class="hljs-params">(String sql)</span> {
        <span class="hljs-keyword">if</span> (!connected) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalStateException</span>(<span class="hljs-string">"未连接到数据库"</span>);
        }
        System.out.println(<span class="hljs-string">"[Oracle] 执行SQL: "</span> + sql);
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">disconnect</span><span class="hljs-params">()</span> {
        System.out.println(<span class="hljs-string">"断开 Oracle 连接"</span>);
        connected = <span class="hljs-literal">false</span>;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getDatabaseType</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"Oracle"</span>;
    }
}
</code></pre>
<p><strong>抽象工厂和具体工厂：</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * 抽象创建者：数据库连接工厂
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DatabaseConnectionFactory</span> {

    <span class="hljs-comment">/**
     * 工厂方法：创建数据库连接
     */</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">abstract</span> DatabaseConnection <span class="hljs-title function_">createConnection</span><span class="hljs-params">()</span>;

    <span class="hljs-comment">/**
     * 模板方法：执行数据库操作
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">executeOperation</span><span class="hljs-params">(String sql)</span> {
        <span class="hljs-type">DatabaseConnection</span> <span class="hljs-variable">connection</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;

        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 1. 创建连接</span>
            connection = createConnection();

            <span class="hljs-comment">// 2. 连接数据库</span>
            connection.connect();

            <span class="hljs-comment">// 3. 执行SQL</span>
            connection.executeQuery(sql);

        } <span class="hljs-keyword">catch</span> (Exception e) {
            System.err.println(<span class="hljs-string">"数据库操作失败: "</span> + e.getMessage());
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-comment">// 4. 关闭连接</span>
            <span class="hljs-keyword">if</span> (connection != <span class="hljs-literal">null</span>) {
                connection.disconnect();
            }
        }
    }

    <span class="hljs-comment">/**
     * 获取连接池（高级功能）
     */</span>
    <span class="hljs-keyword">public</span> DatabaseConnection <span class="hljs-title function_">getConnection</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> createConnection();
    }
}

<span class="hljs-comment">/**
 * 具体创建者：MySQL连接工厂
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MySqlConnectionFactory</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">DatabaseConnectionFactory</span> {

    <span class="hljs-keyword">private</span> String host;
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> port;
    <span class="hljs-keyword">private</span> String database;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">MySqlConnectionFactory</span><span class="hljs-params">(String host, <span class="hljs-type">int</span> port, String database)</span> {
        <span class="hljs-built_in">this</span>.host = host;
        <span class="hljs-built_in">this</span>.port = port;
        <span class="hljs-built_in">this</span>.database = database;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> DatabaseConnection <span class="hljs-title function_">createConnection</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MySqlConnection</span>(host, port, database);
    }
}

<span class="hljs-comment">/**
 * 具体创建者：PostgreSQL连接工厂
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PostgreSqlConnectionFactory</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">DatabaseConnectionFactory</span> {

    <span class="hljs-keyword">private</span> String host;
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> port;
    <span class="hljs-keyword">private</span> String database;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">PostgreSqlConnectionFactory</span><span class="hljs-params">(String host, <span class="hljs-type">int</span> port, String database)</span> {
        <span class="hljs-built_in">this</span>.host = host;
        <span class="hljs-built_in">this</span>.port = port;
        <span class="hljs-built_in">this</span>.database = database;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> DatabaseConnection <span class="hljs-title function_">createConnection</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PostgreSqlConnection</span>(host, port, database);
    }
}

<span class="hljs-comment">/**
 * 具体创建者：Oracle连接工厂
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OracleConnectionFactory</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">DatabaseConnectionFactory</span> {

    <span class="hljs-keyword">private</span> String host;
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> port;
    <span class="hljs-keyword">private</span> String sid;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">OracleConnectionFactory</span><span class="hljs-params">(String host, <span class="hljs-type">int</span> port, String sid)</span> {
        <span class="hljs-built_in">this</span>.host = host;
        <span class="hljs-built_in">this</span>.port = port;
        <span class="hljs-built_in">this</span>.sid = sid;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> DatabaseConnection <span class="hljs-title function_">createConnection</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OracleConnection</span>(host, port, sid);
    }
}
</code></pre>
<p><strong>客户端使用：</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DatabaseTest</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 从配置文件读取数据库类型</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">dbType</span> <span class="hljs-operator">=</span> System.getProperty(<span class="hljs-string">"db.type"</span>, <span class="hljs-string">"mysql"</span>);

        <span class="hljs-comment">// 根据配置创建对应的工厂</span>
        <span class="hljs-type">DatabaseConnectionFactory</span> <span class="hljs-variable">factory</span> <span class="hljs-operator">=</span> createFactory(dbType);

        <span class="hljs-comment">// 执行数据库操作（客户端不需要知道具体数据库类型）</span>
        factory.executeOperation(<span class="hljs-string">"SELECT * FROM users WHERE id = 1"</span>);
        factory.executeOperation(<span class="hljs-string">"INSERT INTO logs VALUES (1, 'test')"</span>);
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> DatabaseConnectionFactory <span class="hljs-title function_">createFactory</span><span class="hljs-params">(String dbType)</span> {
        <span class="hljs-keyword">switch</span> (dbType.toLowerCase()) {
            <span class="hljs-keyword">case</span> <span class="hljs-string">"mysql"</span>:
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MySqlConnectionFactory</span>(<span class="hljs-string">"localhost"</span>, <span class="hljs-number">3306</span>, <span class="hljs-string">"mydb"</span>);
            <span class="hljs-keyword">case</span> <span class="hljs-string">"postgresql"</span>:
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PostgreSqlConnectionFactory</span>(<span class="hljs-string">"localhost"</span>, <span class="hljs-number">5432</span>, <span class="hljs-string">"mydb"</span>);
            <span class="hljs-keyword">case</span> <span class="hljs-string">"oracle"</span>:
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OracleConnectionFactory</span>(<span class="hljs-string">"localhost"</span>, <span class="hljs-number">1521</span>, <span class="hljs-string">"ORCL"</span>);
            <span class="hljs-keyword">default</span>:
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"不支持的数据库类型: "</span> + dbType);
        }
    }
}
</code></pre>
<h4 data-id="heading-11">4.2 场景：消息推送工厂</h4>
<p>在现代应用中，需要支持多种消息推送渠道（邮件、短信、微信、App推送等）。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * 抽象产品：消息推送器
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">MessagePusher</span> {
    <span class="hljs-comment">/**
     * 发送消息
     */</span>
    <span class="hljs-type">boolean</span> <span class="hljs-title function_">send</span><span class="hljs-params">(String recipient, String title, String content)</span>;

    <span class="hljs-comment">/**
     * 批量发送
     */</span>
    <span class="hljs-type">int</span> <span class="hljs-title function_">batchSend</span><span class="hljs-params">(java.util.List&lt;String&gt; recipients, String title, String content)</span>;

    <span class="hljs-comment">/**
     * 获取推送类型
     */</span>
    String <span class="hljs-title function_">getPusherType</span><span class="hljs-params">()</span>;
}

<span class="hljs-comment">/**
 * 具体产品：邮件推送
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EmailPusher</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">MessagePusher</span> {

    <span class="hljs-keyword">private</span> String smtpServer;
    <span class="hljs-keyword">private</span> String username;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">EmailPusher</span><span class="hljs-params">(String smtpServer, String username)</span> {
        <span class="hljs-built_in">this</span>.smtpServer = smtpServer;
        <span class="hljs-built_in">this</span>.username = username;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">send</span><span class="hljs-params">(String recipient, String title, String content)</span> {
        System.out.println(<span class="hljs-string">"=== 发送邮件 ==="</span>);
        System.out.println(<span class="hljs-string">"SMTP服务器: "</span> + smtpServer);
        System.out.println(<span class="hljs-string">"发件人: "</span> + username);
        System.out.println(<span class="hljs-string">"收件人: "</span> + recipient);
        System.out.println(<span class="hljs-string">"主题: "</span> + title);
        System.out.println(<span class="hljs-string">"内容: "</span> + content);
        <span class="hljs-comment">// 实际实现：使用JavaMail API发送邮件</span>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">batchSend</span><span class="hljs-params">(java.util.List&lt;String&gt; recipients, String title, String content)</span> {
        <span class="hljs-type">int</span> <span class="hljs-variable">successCount</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
        <span class="hljs-keyword">for</span> (String recipient : recipients) {
            <span class="hljs-keyword">if</span> (send(recipient, title, content)) {
                successCount++;
            }
        }
        <span class="hljs-keyword">return</span> successCount;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getPusherType</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"EMAIL"</span>;
    }
}

<span class="hljs-comment">/**
 * 具体产品：短信推送
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SmsPusher</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">MessagePusher</span> {

    <span class="hljs-keyword">private</span> String apiKey;
    <span class="hljs-keyword">private</span> String gateway;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">SmsPusher</span><span class="hljs-params">(String apiKey, String gateway)</span> {
        <span class="hljs-built_in">this</span>.apiKey = apiKey;
        <span class="hljs-built_in">this</span>.gateway = gateway;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">send</span><span class="hljs-params">(String recipient, String title, String content)</span> {
        System.out.println(<span class="hljs-string">"=== 发送短信 ==="</span>);
        System.out.println(<span class="hljs-string">"网关: "</span> + gateway);
        System.out.println(<span class="hljs-string">"收件人: "</span> + recipient);
        System.out.println(<span class="hljs-string">"内容: "</span> + content);
        <span class="hljs-comment">// 实际实现：调用短信网关API</span>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">batchSend</span><span class="hljs-params">(java.util.List&lt;String&gt; recipients, String title, String content)</span> {
        System.out.println(<span class="hljs-string">"批量发送短信到 "</span> + recipients.size() + <span class="hljs-string">" 个号码"</span>);
        <span class="hljs-comment">// 实际实现：调用批量短信API</span>
        <span class="hljs-keyword">return</span> recipients.size();
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getPusherType</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"SMS"</span>;
    }
}

<span class="hljs-comment">/**
 * 具体产品：微信推送
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WeChatPusher</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">MessagePusher</span> {

    <span class="hljs-keyword">private</span> String appId;
    <span class="hljs-keyword">private</span> String appSecret;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">WeChatPusher</span><span class="hljs-params">(String appId, String appSecret)</span> {
        <span class="hljs-built_in">this</span>.appId = appId;
        <span class="hljs-built_in">this</span>.appSecret = appSecret;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">send</span><span class="hljs-params">(String recipient, String title, String content)</span> {
        System.out.println(<span class="hljs-string">"=== 发送微信消息 ==="</span>);
        System.out.println(<span class="hljs-string">"AppID: "</span> + appId);
        System.out.println(<span class="hljs-string">"OpenID: "</span> + recipient);
        System.out.println(<span class="hljs-string">"标题: "</span> + title);
        System.out.println(<span class="hljs-string">"内容: "</span> + content);
        <span class="hljs-comment">// 实际实现：调用微信模板消息API</span>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">batchSend</span><span class="hljs-params">(java.util.List&lt;String&gt; recipients, String title, String content)</span> {
        System.out.println(<span class="hljs-string">"批量发送微信消息到 "</span> + recipients.size() + <span class="hljs-string">" 个用户"</span>);
        <span class="hljs-keyword">return</span> recipients.size();
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getPusherType</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"WECHAT"</span>;
    }
}

<span class="hljs-comment">/**
 * 抽象工厂：消息推送工厂
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MessagePusherFactory</span> {

    <span class="hljs-comment">/**
     * 工厂方法
     */</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">abstract</span> MessagePusher <span class="hljs-title function_">createPusher</span><span class="hljs-params">()</span>;

    <span class="hljs-comment">/**
     * 发送通知（带重试机制）
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">sendNotification</span><span class="hljs-params">(String recipient, String title, String content)</span> {
        <span class="hljs-type">MessagePusher</span> <span class="hljs-variable">pusher</span> <span class="hljs-operator">=</span> createPusher();

        <span class="hljs-comment">// 添加重试逻辑</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">maxRetries</span> <span class="hljs-operator">=</span> <span class="hljs-number">3</span>;
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; maxRetries; i++) {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-type">boolean</span> <span class="hljs-variable">success</span> <span class="hljs-operator">=</span> pusher.send(recipient, title, content);
                <span class="hljs-keyword">if</span> (success) {
                    logSuccess(pusher, recipient);
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
                }
            } <span class="hljs-keyword">catch</span> (Exception e) {
                System.err.println(<span class="hljs-string">"发送失败，第 "</span> + (i + <span class="hljs-number">1</span>) + <span class="hljs-string">" 次重试"</span>);
            }
        }

        logFailure(pusher, recipient);
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">logSuccess</span><span class="hljs-params">(MessagePusher pusher, String recipient)</span> {
        System.out.println(<span class="hljs-string">"[SUCCESS] "</span> + pusher.getPusherType() + <span class="hljs-string">" 消息发送成功: "</span> + recipient);
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">logFailure</span><span class="hljs-params">(MessagePusher pusher, String recipient)</span> {
        System.err.println(<span class="hljs-string">"[FAILURE] "</span> + pusher.getPusherType() + <span class="hljs-string">" 消息发送失败: "</span> + recipient);
    }
}

<span class="hljs-comment">/**
 * 具体工厂实现
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EmailPusherFactory</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">MessagePusherFactory</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> MessagePusher <span class="hljs-title function_">createPusher</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">EmailPusher</span>(<span class="hljs-string">"smtp.example.com"</span>, <span class="hljs-string">"noreply@example.com"</span>);
    }
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SmsPusherFactory</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">MessagePusherFactory</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> MessagePusher <span class="hljs-title function_">createPusher</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SmsPusher</span>(<span class="hljs-string">"your-api-key"</span>, <span class="hljs-string">"https://sms.gateway.com"</span>);
    }
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WeChatPusherFactory</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">MessagePusherFactory</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> MessagePusher <span class="hljs-title function_">createPusher</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">WeChatPusher</span>(<span class="hljs-string">"wx1234567890"</span>, <span class="hljs-string">"your-app-secret"</span>);
    }
}
</code></pre>
<h3 data-id="heading-12">五、开源框架中的应用</h3>
<h4 data-id="heading-13">5.1 JDK中的应用</h4>
<p><strong>Collection接口的iterator()方法：</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.util.*;

<span class="hljs-comment">/**
 * JDK中最典型的工厂方法模式应用
 * Collection接口定义了iterator()工厂方法
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JdkIteratorExample</span> {

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// ArrayList实现了iterator()工厂方法</span>
        Collection&lt;String&gt; list = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
        list.add(<span class="hljs-string">"Java"</span>);
        list.add(<span class="hljs-string">"Python"</span>);
        list.add(<span class="hljs-string">"Go"</span>);

        <span class="hljs-comment">// iterator()是工厂方法，返回Iterator对象</span>
        Iterator&lt;String&gt; iterator = list.iterator();

        <span class="hljs-keyword">while</span> (iterator.hasNext()) {
            System.out.println(iterator.next());
        }

        <span class="hljs-comment">// HashSet也实现了iterator()工厂方法，返回不同的迭代器实现</span>
        Collection&lt;String&gt; set = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashSet</span>&lt;&gt;();
        set.add(<span class="hljs-string">"A"</span>);
        set.add(<span class="hljs-string">"B"</span>);

        Iterator&lt;String&gt; setIterator = set.iterator();
        <span class="hljs-comment">// 使用方式相同，但内部实现不同</span>
    }
}

<span class="hljs-comment">/**
 * 简化的Collection接口结构
 */</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">SimpleCollection</span>&lt;E&gt; {
    <span class="hljs-comment">/**
     * 工厂方法：由具体集合类实现
     */</span>
    Iterator&lt;E&gt; <span class="hljs-title function_">iterator</span><span class="hljs-params">()</span>;

    <span class="hljs-type">boolean</span> <span class="hljs-title function_">add</span><span class="hljs-params">(E e)</span>;
    <span class="hljs-type">int</span> <span class="hljs-title function_">size</span><span class="hljs-params">()</span>;
}

<span class="hljs-comment">/**
 * 具体实现：ArrayList
 */</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">SimpleArrayList</span>&lt;E&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title class_">SimpleCollection</span>&lt;E&gt; {
    <span class="hljs-keyword">private</span> Object[] elements = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[<span class="hljs-number">10</span>];
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">size</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Iterator&lt;E&gt; <span class="hljs-title function_">iterator</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// 返回ArrayList特定的迭代器</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayListIterator</span>();
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">add</span><span class="hljs-params">(E e)</span> {
        elements[size++] = e;
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">size</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> size;
    }

    <span class="hljs-comment">/**
     * ArrayList的迭代器实现
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ArrayListIterator</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Iterator</span>&lt;E&gt; {
        <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">cursor</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;

        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">hasNext</span><span class="hljs-params">()</span> {
            <span class="hljs-keyword">return</span> cursor &lt; size;
        }

        <span class="hljs-meta">@Override</span>
        <span class="hljs-meta">@SuppressWarnings("unchecked")</span>
        <span class="hljs-keyword">public</span> E <span class="hljs-title function_">next</span><span class="hljs-params">()</span> {
            <span class="hljs-keyword">if</span> (!hasNext()) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NoSuchElementException</span>();
            }
            <span class="hljs-keyword">return</span> (E) elements[cursor++];
        }
    }
}

<span class="hljs-comment">/**
 * 具体实现：LinkedList
 */</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">SimpleLinkedList</span>&lt;E&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title class_">SimpleCollection</span>&lt;E&gt; {
    <span class="hljs-keyword">private</span> Node&lt;E&gt; first;
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">size</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Iterator&lt;E&gt; <span class="hljs-title function_">iterator</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// 返回LinkedList特定的迭代器</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedListIterator</span>();
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">add</span><span class="hljs-params">(E e)</span> {
        Node&lt;E&gt; newNode = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Node</span>&lt;&gt;(e);
        <span class="hljs-keyword">if</span> (first == <span class="hljs-literal">null</span>) {
            first = newNode;
        } <span class="hljs-keyword">else</span> {
            Node&lt;E&gt; current = first;
            <span class="hljs-keyword">while</span> (current.next != <span class="hljs-literal">null</span>) {
                current = current.next;
            }
            current.next = newNode;
        }
        size++;
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">size</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> size;
    }

    <span class="hljs-comment">/**
     * LinkedList的迭代器实现
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LinkedListIterator</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Iterator</span>&lt;E&gt; {
        <span class="hljs-keyword">private</span> Node&lt;E&gt; current = first;

        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">hasNext</span><span class="hljs-params">()</span> {
            <span class="hljs-keyword">return</span> current != <span class="hljs-literal">null</span>;
        }

        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> E <span class="hljs-title function_">next</span><span class="hljs-params">()</span> {
            <span class="hljs-keyword">if</span> (!hasNext()) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NoSuchElementException</span>();
            }
            <span class="hljs-type">E</span> <span class="hljs-variable">data</span> <span class="hljs-operator">=</span> current.data;
            current = current.next;
            <span class="hljs-keyword">return</span> data;
        }
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Node</span>&lt;E&gt; {
        E data;
        Node&lt;E&gt; next;

        Node(E data) {
            <span class="hljs-built_in">this</span>.data = data;
        }
    }
}
</code></pre>
<h4 data-id="heading-14">5.2 JDBC中的DriverManager</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.sql.*;

<span class="hljs-comment">/**
 * JDBC的DriverManager是工厂方法模式的经典应用
 * getConnection()方法根据URL选择合适的Driver创建Connection
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JdbcFactoryExample</span> {

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">demonstrateJdbcFactory</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> SQLException {
        <span class="hljs-comment">// DriverManager.getConnection()是静态工厂方法</span>
        <span class="hljs-comment">// 根据URL前缀选择对应的Driver</span>

        <span class="hljs-comment">// MySQL Driver</span>
        <span class="hljs-type">Connection</span> <span class="hljs-variable">mysqlConn</span> <span class="hljs-operator">=</span> DriverManager.getConnection(
            <span class="hljs-string">"jdbc:mysql://localhost:3306/mydb"</span>,
            <span class="hljs-string">"user"</span>,
            <span class="hljs-string">"password"</span>
        );

        <span class="hljs-comment">// PostgreSQL Driver</span>
        <span class="hljs-type">Connection</span> <span class="hljs-variable">pgConn</span> <span class="hljs-operator">=</span> DriverManager.getConnection(
            <span class="hljs-string">"jdbc:postgresql://localhost:5432/mydb"</span>,
            <span class="hljs-string">"user"</span>,
            <span class="hljs-string">"password"</span>
        );

        <span class="hljs-comment">// 客户端代码使用相同的Connection接口</span>
        <span class="hljs-type">Statement</span> <span class="hljs-variable">stmt</span> <span class="hljs-operator">=</span> mysqlConn.createStatement();
        <span class="hljs-type">ResultSet</span> <span class="hljs-variable">rs</span> <span class="hljs-operator">=</span> stmt.executeQuery(<span class="hljs-string">"SELECT * FROM users"</span>);
    }
}

<span class="hljs-comment">/**
 * 简化的JDBC工厂方法模式实现
 */</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Driver</span> {
    Connection <span class="hljs-title function_">connect</span><span class="hljs-params">(String url, java.util.Properties info)</span> <span class="hljs-keyword">throws</span> SQLException;
    <span class="hljs-type">boolean</span> <span class="hljs-title function_">acceptsURL</span><span class="hljs-params">(String url)</span> <span class="hljs-keyword">throws</span> SQLException;
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">DriverManager</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> java.util.List&lt;Driver&gt; registeredDrivers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">java</span>.util.ArrayList&lt;&gt;();

    <span class="hljs-comment">/**
     * 工厂方法：根据URL创建合适的Connection
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Connection <span class="hljs-title function_">getConnection</span><span class="hljs-params">(String url, String user, String password)</span>
            <span class="hljs-keyword">throws</span> SQLException {

        <span class="hljs-comment">// 遍历注册的Driver，找到能处理该URL的Driver</span>
        <span class="hljs-keyword">for</span> (Driver driver : registeredDrivers) {
            <span class="hljs-keyword">if</span> (driver.acceptsURL(url)) {
                java.util.<span class="hljs-type">Properties</span> <span class="hljs-variable">info</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">java</span>.util.Properties();
                info.put(<span class="hljs-string">"user"</span>, user);
                info.put(<span class="hljs-string">"password"</span>, password);

                <span class="hljs-comment">// 使用找到的Driver创建Connection</span>
                <span class="hljs-type">Connection</span> <span class="hljs-variable">conn</span> <span class="hljs-operator">=</span> driver.connect(url, info);
                <span class="hljs-keyword">if</span> (conn != <span class="hljs-literal">null</span>) {
                    <span class="hljs-keyword">return</span> conn;
                }
            }
        }

        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SQLException</span>(<span class="hljs-string">"No suitable driver found for "</span> + url);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">registerDriver</span><span class="hljs-params">(Driver driver)</span> {
        registeredDrivers.add(driver);
    }
}
</code></pre>
<h4 data-id="heading-15">5.3 Spring Framework中的FactoryBean</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.springframework.beans.factory.FactoryBean;

<span class="hljs-comment">/**
 * Spring的FactoryBean是工厂方法模式的应用
 * 用于创建复杂对象或需要特殊初始化的对象
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConnectionPoolFactoryBean</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">FactoryBean</span>&lt;ConnectionPool&gt; {

    <span class="hljs-keyword">private</span> String driverClassName;
    <span class="hljs-keyword">private</span> String url;
    <span class="hljs-keyword">private</span> String username;
    <span class="hljs-keyword">private</span> String password;
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">maxConnections</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span>;

    <span class="hljs-comment">/**
     * 工厂方法：创建ConnectionPool对象
     */</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> ConnectionPool <span class="hljs-title function_">getObject</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-type">ConnectionPool</span> <span class="hljs-variable">pool</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConnectionPool</span>();
        pool.setDriverClassName(driverClassName);
        pool.setUrl(url);
        pool.setUsername(username);
        pool.setPassword(password);
        pool.setMaxConnections(maxConnections);

        <span class="hljs-comment">// 初始化连接池</span>
        pool.initialize();

        <span class="hljs-keyword">return</span> pool;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Class&lt;?&gt; getObjectType() {
        <span class="hljs-keyword">return</span> ConnectionPool.class;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isSingleton</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }

    <span class="hljs-comment">// Setters for dependency injection</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setDriverClassName</span><span class="hljs-params">(String driverClassName)</span> {
        <span class="hljs-built_in">this</span>.driverClassName = driverClassName;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setUrl</span><span class="hljs-params">(String url)</span> {
        <span class="hljs-built_in">this</span>.url = url;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setUsername</span><span class="hljs-params">(String username)</span> {
        <span class="hljs-built_in">this</span>.username = username;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setPassword</span><span class="hljs-params">(String password)</span> {
        <span class="hljs-built_in">this</span>.password = password;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setMaxConnections</span><span class="hljs-params">(<span class="hljs-type">int</span> maxConnections)</span> {
        <span class="hljs-built_in">this</span>.maxConnections = maxConnections;
    }
}

<span class="hljs-comment">/**
 * 连接池类
 */</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ConnectionPool</span> {
    <span class="hljs-keyword">private</span> String driverClassName;
    <span class="hljs-keyword">private</span> String url;
    <span class="hljs-keyword">private</span> String username;
    <span class="hljs-keyword">private</span> String password;
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> maxConnections;

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">initialize</span><span class="hljs-params">()</span> {
        System.out.println(<span class="hljs-string">"初始化连接池: "</span> + url);
        <span class="hljs-comment">// 创建初始连接</span>
    }

    <span class="hljs-comment">// Getters and Setters</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setDriverClassName</span><span class="hljs-params">(String driverClassName)</span> {
        <span class="hljs-built_in">this</span>.driverClassName = driverClassName;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setUrl</span><span class="hljs-params">(String url)</span> {
        <span class="hljs-built_in">this</span>.url = url;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setUsername</span><span class="hljs-params">(String username)</span> {
        <span class="hljs-built_in">this</span>.username = username;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setPassword</span><span class="hljs-params">(String password)</span> {
        <span class="hljs-built_in">this</span>.password = password;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setMaxConnections</span><span class="hljs-params">(<span class="hljs-type">int</span> maxConnections)</span> {
        <span class="hljs-built_in">this</span>.maxConnections = maxConnections;
    }
}

<span class="hljs-comment">/**
 * Spring配置文件使用示例：
 *
 * &lt;bean id="connectionPool" class="com.example.ConnectionPoolFactoryBean"&gt;
 *     &lt;property name="driverClassName" value="com.mysql.jdbc.Driver"/&gt;
 *     &lt;property name="url" value="jdbc:mysql://localhost:3306/mydb"/&gt;
 *     &lt;property name="username" value="root"/&gt;
 *     &lt;property name="password" value="password"/&gt;
 *     &lt;property name="maxConnections" value="20"/&gt;
 * &lt;/bean&gt;
 *
 * 当获取connectionPool bean时，实际得到的是FactoryBean.getObject()返回的对象
 */</span>
</code></pre>
<h4 data-id="heading-16">5.4 Guava中的LoadingCache</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> com.google.common.cache.CacheBuilder;
<span class="hljs-keyword">import</span> com.google.common.cache.CacheLoader;
<span class="hljs-keyword">import</span> com.google.common.cache.LoadingCache;

<span class="hljs-comment">/**
 * Guava的CacheBuilder使用工厂方法模式
 * CacheLoader.load()是工厂方法，用于创建缓存值
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GuavaCacheFactoryExample</span> {

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-comment">// CacheLoader定义了如何创建缓存值</span>
        LoadingCache&lt;String, User&gt; userCache = CacheBuilder.newBuilder()
            .maximumSize(<span class="hljs-number">1000</span>)
            .build(<span class="hljs-keyword">new</span> <span class="hljs-title class_">CacheLoader</span>&lt;String, User&gt;() {
                <span class="hljs-meta">@Override</span>
                <span class="hljs-keyword">public</span> User <span class="hljs-title function_">load</span><span class="hljs-params">(String userId)</span> <span class="hljs-keyword">throws</span> Exception {
                    <span class="hljs-comment">// 工厂方法：当缓存中没有该key时，调用此方法创建对象</span>
                    <span class="hljs-keyword">return</span> loadUserFromDatabase(userId);
                }
            });

        <span class="hljs-comment">// 使用缓存</span>
        <span class="hljs-type">User</span> <span class="hljs-variable">user1</span> <span class="hljs-operator">=</span> userCache.get(<span class="hljs-string">"user123"</span>); <span class="hljs-comment">// 第一次访问，调用load()</span>
        <span class="hljs-type">User</span> <span class="hljs-variable">user2</span> <span class="hljs-operator">=</span> userCache.get(<span class="hljs-string">"user123"</span>); <span class="hljs-comment">// 第二次访问，直接从缓存获取</span>

        System.out.println(<span class="hljs-string">"两次获取的是同一个对象: "</span> + (user1 == user2));
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> User <span class="hljs-title function_">loadUserFromDatabase</span><span class="hljs-params">(String userId)</span> {
        System.out.println(<span class="hljs-string">"从数据库加载用户: "</span> + userId);
        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>();
        user.setName(<span class="hljs-string">"User-"</span> + userId);
        user.setEmail(userId + <span class="hljs-string">"@example.com"</span>);
        <span class="hljs-keyword">return</span> user;
    }
}

<span class="hljs-comment">/**
 * 自定义实现类似的缓存工厂
 */</span>
<span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DataLoader</span>&lt;K, V&gt; {
    <span class="hljs-keyword">private</span> java.util.Map&lt;K, V&gt; cache = <span class="hljs-keyword">new</span> <span class="hljs-title class_">java</span>.util.HashMap&lt;&gt;();

    <span class="hljs-comment">/**
     * 工厂方法：由子类实现具体的加载逻辑
     */</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">abstract</span> V <span class="hljs-title function_">load</span><span class="hljs-params">(K key)</span> <span class="hljs-keyword">throws</span> Exception;

    <span class="hljs-comment">/**
     * 获取数据（带缓存）
     */</span>
    <span class="hljs-keyword">public</span> V <span class="hljs-title function_">get</span><span class="hljs-params">(K key)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-keyword">if</span> (cache.containsKey(key)) {
            <span class="hljs-keyword">return</span> cache.get(key);
        }

        <span class="hljs-comment">// 调用工厂方法创建对象</span>
        <span class="hljs-type">V</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> load(key);
        cache.put(key, value);
        <span class="hljs-keyword">return</span> value;
    }
}

<span class="hljs-comment">/**
 * 具体实现：用户数据加载器
 */</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserDataLoader</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">DataLoader</span>&lt;String, User&gt; {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> User <span class="hljs-title function_">load</span><span class="hljs-params">(String userId)</span> <span class="hljs-keyword">throws</span> Exception {
        System.out.println(<span class="hljs-string">"从数据源加载用户: "</span> + userId);
        <span class="hljs-comment">// 实际实现：从数据库、API等加载数据</span>
        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>();
        user.setName(<span class="hljs-string">"User-"</span> + userId);
        <span class="hljs-keyword">return</span> user;
    }
}
</code></pre>
<h3 data-id="heading-17">六、工厂方法模式的优缺点</h3>
<h4 data-id="heading-18">6.1 优点</h4>
<p><strong>1. 符合开闭原则</strong></p>
<pre><code class="hljs language-arduino" lang="arduino">添加新产品时的变化：

不使用工厂方法：
❌ 修改客户端代码中的<span class="hljs-keyword">switch</span>/<span class="hljs-keyword">if</span>语句
❌ 直接在代码中<span class="hljs-keyword">new</span>具体类

使用工厂方法：
✓ 创建新的产品类
✓ 创建新的工厂类
✓ 客户端代码无需修改
</code></pre>
<p><strong>2. 符合单一职责原则</strong></p>
<ul>
<li>产品创建逻辑集中在工厂类中</li>
<li>客户端只关注产品的使用，不关心创建细节</li>
</ul>
<p><strong>3. 符合依赖倒置原则</strong></p>
<pre><code class="hljs language-arduino" lang="arduino">依赖关系：

<span class="hljs-built_in">Client</span> → AbstractFactory → AbstractProduct
              ↑                  ↑
              │                  │
      ConcreteFactory    ConcreteProduct

客户端依赖抽象，不依赖具体实现
</code></pre>
<p><strong>4. 提高代码复用性</strong></p>
<ul>
<li>通用的创建逻辑可以在抽象工厂中实现</li>
<li>子类只需实现特定的创建细节</li>
</ul>
<h4 data-id="heading-19">6.2 缺点</h4>
<p><strong>1. 类的数量增加</strong></p>
<pre><code class="hljs language-diff" lang="diff">每增加一个产品：
<span class="hljs-deletion">- 1个具体产品类</span>
<span class="hljs-deletion">- 1个具体工厂类</span>

产品种类多时，类的数量会快速增长
</code></pre>
<p><strong>2. 增加系统复杂度</strong></p>
<ul>
<li>引入了额外的抽象层</li>
<li>需要理解工厂和产品的关系</li>
</ul>
<p><strong>3. 增加理解难度</strong></p>
<ul>
<li>对象创建逻辑分散在多个类中</li>
<li>新手可能难以快速定位代码</li>
</ul>
<h3 data-id="heading-20">七、最佳实践</h3>
<h4 data-id="heading-21">7.1 使用配置文件驱动工厂选择</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.io.IOException;
<span class="hljs-keyword">import</span> java.io.InputStream;
<span class="hljs-keyword">import</span> java.util.Properties;

<span class="hljs-comment">/**
 * 使用配置文件选择工厂
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConfigDrivenFactory</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">Properties</span> <span class="hljs-variable">config</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Properties</span>();

    <span class="hljs-keyword">static</span> {
        <span class="hljs-keyword">try</span> (<span class="hljs-type">InputStream</span> <span class="hljs-variable">is</span> <span class="hljs-operator">=</span> ConfigDrivenFactory.class
                .getResourceAsStream(<span class="hljs-string">"/factory.properties"</span>)) {
            config.load(is);
        } <span class="hljs-keyword">catch</span> (IOException e) {
            e.printStackTrace();
        }
    }

    <span class="hljs-comment">/**
     * 根据配置创建工厂
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> LoggerFactory <span class="hljs-title function_">createLoggerFactory</span><span class="hljs-params">()</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">logType</span> <span class="hljs-operator">=</span> config.getProperty(<span class="hljs-string">"logger.type"</span>, <span class="hljs-string">"console"</span>);

        <span class="hljs-keyword">switch</span> (logType) {
            <span class="hljs-keyword">case</span> <span class="hljs-string">"file"</span>:
                <span class="hljs-type">String</span> <span class="hljs-variable">filePath</span> <span class="hljs-operator">=</span> config.getProperty(<span class="hljs-string">"logger.file.path"</span>, <span class="hljs-string">"/tmp/app.log"</span>);
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileLoggerFactory</span>(filePath);
            <span class="hljs-keyword">case</span> <span class="hljs-string">"database"</span>:
                <span class="hljs-type">String</span> <span class="hljs-variable">connStr</span> <span class="hljs-operator">=</span> config.getProperty(<span class="hljs-string">"logger.db.connection"</span>);
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DatabaseLoggerFactory</span>(connStr);
            <span class="hljs-keyword">default</span>:
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConsoleLoggerFactory</span>();
        }
    }
}

<span class="hljs-comment">/**
 * factory.properties配置文件内容：
 *
 * logger.type=file
 * logger.file.path=/var/log/application.log
 *
 * # 或者
 * logger.type=database
 * logger.db.connection=jdbc:mysql://localhost/logs
 */</span>
</code></pre>
<h4 data-id="heading-22">7.2 结合反射实现通用工厂</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * 使用反射的通用工厂
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ReflectionFactory</span>&lt;T&gt; {

    <span class="hljs-keyword">private</span> Class&lt;? <span class="hljs-keyword">extends</span> <span class="hljs-title class_">T</span>&gt; productClass;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">ReflectionFactory</span><span class="hljs-params">(Class&lt;? extends T&gt; productClass)</span> {
        <span class="hljs-built_in">this</span>.productClass = productClass;
    }

    <span class="hljs-comment">/**
     * 工厂方法：使用反射创建对象
     */</span>
    <span class="hljs-keyword">public</span> T <span class="hljs-title function_">createProduct</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">return</span> productClass.getDeclaredConstructor().newInstance();
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"无法创建对象: "</span> + productClass.getName(), e);
        }
    }

    <span class="hljs-comment">/**
     * 带参数的工厂方法
     */</span>
    <span class="hljs-keyword">public</span> T <span class="hljs-title function_">createProduct</span><span class="hljs-params">(Object... args)</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 获取参数类型</span>
            Class&lt;?&gt;[] paramTypes = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[args.length];
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; args.length; i++) {
                paramTypes[i] = args[i].getClass();
            }

            <span class="hljs-comment">// 获取构造函数并创建对象</span>
            <span class="hljs-keyword">return</span> productClass.getDeclaredConstructor(paramTypes).newInstance(args);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"无法创建对象: "</span> + productClass.getName(), e);
        }
    }
}

<span class="hljs-comment">/**
 * 使用示例
 */</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ReflectionFactoryTest</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 创建ConsoleLogger</span>
        ReflectionFactory&lt;Logger&gt; factory1 =
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReflectionFactory</span>&lt;&gt;(ConsoleLogger.class);
        <span class="hljs-type">Logger</span> <span class="hljs-variable">logger1</span> <span class="hljs-operator">=</span> factory1.createProduct();
        logger1.log(<span class="hljs-string">"测试消息"</span>);

        <span class="hljs-comment">// 创建FileLogger（带参数）</span>
        ReflectionFactory&lt;Logger&gt; factory2 =
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReflectionFactory</span>&lt;&gt;(FileLogger.class);
        <span class="hljs-type">Logger</span> <span class="hljs-variable">logger2</span> <span class="hljs-operator">=</span> factory2.createProduct(<span class="hljs-string">"/tmp/test.log"</span>);
        logger2.log(<span class="hljs-string">"测试消息"</span>);
    }
}
</code></pre>
<h4 data-id="heading-23">7.3 使用注解标记工厂</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.lang.annotation.*;

<span class="hljs-comment">/**
 * 工厂注解
 */</span>
<span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span>
<span class="hljs-meta">@Target(ElementType.TYPE)</span>
<span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> FactoryProduct {
    String <span class="hljs-title function_">type</span><span class="hljs-params">()</span>;
}

<span class="hljs-comment">/**
 * 使用注解标记产品类型
 */</span>
<span class="hljs-meta">@FactoryProduct(type = "console")</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ConsoleLoggerV2</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Logger</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">log</span><span class="hljs-params">(String message)</span> {
        System.out.println(message);
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getLoggerType</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"CONSOLE"</span>;
    }
}

<span class="hljs-meta">@FactoryProduct(type = "file")</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">FileLoggerV2</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Logger</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">log</span><span class="hljs-params">(String message)</span> {
        System.out.println(<span class="hljs-string">"[File] "</span> + message);
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getLoggerType</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"FILE"</span>;
    }
}

<span class="hljs-comment">/**
 * 基于注解的工厂
 */</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">AnnotationBasedFactory</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> java.util.Map&lt;String, Class&lt;? <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Logger</span>&gt;&gt; registry =
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">java</span>.util.HashMap&lt;&gt;();

    <span class="hljs-comment">/**
     * 注册所有带<span class="hljs-doctag">@FactoryProduct</span>注解的类
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">scanAndRegister</span><span class="hljs-params">(String packageName)</span> {
        <span class="hljs-comment">// 简化实现，实际需要使用classpath扫描</span>
        registerProduct(ConsoleLoggerV2.class);
        registerProduct(FileLoggerV2.class);
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">registerProduct</span><span class="hljs-params">(Class&lt;? extends Logger&gt; clazz)</span> {
        <span class="hljs-type">FactoryProduct</span> <span class="hljs-variable">annotation</span> <span class="hljs-operator">=</span> clazz.getAnnotation(FactoryProduct.class);
        <span class="hljs-keyword">if</span> (annotation != <span class="hljs-literal">null</span>) {
            registry.put(annotation.type(), clazz);
        }
    }

    <span class="hljs-comment">/**
     * 根据类型创建产品
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Logger <span class="hljs-title function_">createLogger</span><span class="hljs-params">(String type)</span> {
        Class&lt;? <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Logger</span>&gt; clazz = registry.get(type);
        <span class="hljs-keyword">if</span> (clazz == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"未找到类型: "</span> + type);
        }

        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">return</span> clazz.getDeclaredConstructor().newInstance();
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"创建失败"</span>, e);
        }
    }
}
</code></pre>
<h4 data-id="heading-24">7.4 工厂方法+单例模式</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * 工厂方法与单例模式结合
 * 确保每种类型的产品只创建一次
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SingletonFactory</span>&lt;T&gt; {

    <span class="hljs-keyword">private</span> T instance;

    <span class="hljs-comment">/**
     * 抽象工厂方法
     */</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">abstract</span> T <span class="hljs-title function_">createInstance</span><span class="hljs-params">()</span>;

    <span class="hljs-comment">/**
     * 获取单例实例
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> T <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">if</span> (instance == <span class="hljs-literal">null</span>) {
            instance = createInstance();
        }
        <span class="hljs-keyword">return</span> instance;
    }
}

<span class="hljs-comment">/**
 * 具体实现
 */</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">DatabaseConnectionSingletonFactory</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">SingletonFactory</span>&lt;DatabaseConnection&gt; {

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> DatabaseConnection <span class="hljs-title function_">createInstance</span><span class="hljs-params">()</span> {
        System.out.println(<span class="hljs-string">"创建数据库连接（仅一次）"</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MySqlConnection</span>(<span class="hljs-string">"localhost"</span>, <span class="hljs-number">3306</span>, <span class="hljs-string">"mydb"</span>);
    }
}

<span class="hljs-comment">/**
 * 使用示例
 */</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">SingletonFactoryTest</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        SingletonFactory&lt;DatabaseConnection&gt; factory =
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">DatabaseConnectionSingletonFactory</span>();

        <span class="hljs-type">DatabaseConnection</span> <span class="hljs-variable">conn1</span> <span class="hljs-operator">=</span> factory.getInstance();
        <span class="hljs-type">DatabaseConnection</span> <span class="hljs-variable">conn2</span> <span class="hljs-operator">=</span> factory.getInstance();

        System.out.println(<span class="hljs-string">"是同一个对象: "</span> + (conn1 == conn2)); <span class="hljs-comment">// true</span>
    }
}
</code></pre>
<h3 data-id="heading-25">八、工厂方法 vs 其他创建型模式</h3>
<h4 data-id="heading-26">8.1 工厂方法 vs 抽象工厂</h4>
<pre><code class="hljs language-diff" lang="diff">工厂方法（Factory Method）:
┌─────────────┐
│   Factory   │
├─────────────┤
│+ create()   │ ──→ 创建一个产品
└─────────────┘

抽象工厂（Abstract Factory）:
┌─────────────────┐
│ AbstractFactory │
├─────────────────┤
│+ createProductA │ ──→ 创建产品A
│+ createProductB │ ──→ 创建产品B
│+ createProductC │ ──→ 创建产品C
└─────────────────┘

区别：
<span class="hljs-deletion">- 工厂方法：一个工厂创建一种产品</span>
<span class="hljs-deletion">- 抽象工厂：一个工厂创建一系列相关产品</span>
</code></pre>
<h4 data-id="heading-27">8.2 工厂方法 vs 建造者模式</h4>
<pre><code class="hljs language-scss" lang="scss">工厂方法：
- 关注点：创建什么产品
- 复杂度：产品创建相对简单
- 使用场景：产品类型多样

建造者模式：
- 关注点：如何创建产品
- 复杂度：产品创建过程复杂
- 使用场景：产品内部结构复杂

示例对比：
<span class="hljs-comment">// 工厂方法</span>
Logger logger = factory<span class="hljs-selector-class">.createLogger</span>();

<span class="hljs-comment">// 建造者</span>
User user = new <span class="hljs-built_in">UserBuilder</span>()
    <span class="hljs-selector-class">.setName</span>("John")
    <span class="hljs-selector-class">.setAge</span>(<span class="hljs-number">30</span>)
    <span class="hljs-selector-class">.setEmail</span>("john@example.com")
    <span class="hljs-selector-class">.build</span>();
</code></pre>
<h3 data-id="heading-28">九、实战演练：构建文档转换器工厂</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * 抽象产品：文档转换器
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">DocumentConverter</span> {
    <span class="hljs-comment">/**
     * 转换文档
     * <span class="hljs-doctag">@param</span> sourceFile 源文件路径
     * <span class="hljs-doctag">@param</span> targetFile 目标文件路径
     * <span class="hljs-doctag">@return</span> 是否转换成功
     */</span>
    <span class="hljs-type">boolean</span> <span class="hljs-title function_">convert</span><span class="hljs-params">(String sourceFile, String targetFile)</span>;

    <span class="hljs-comment">/**
     * 获取支持的源格式
     */</span>
    String <span class="hljs-title function_">getSourceFormat</span><span class="hljs-params">()</span>;

    <span class="hljs-comment">/**
     * 获取支持的目标格式
     */</span>
    String <span class="hljs-title function_">getTargetFormat</span><span class="hljs-params">()</span>;
}

<span class="hljs-comment">/**
 * 具体产品：PDF转Word
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PdfToWordConverter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">DocumentConverter</span> {

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">convert</span><span class="hljs-params">(String sourceFile, String targetFile)</span> {
        System.out.println(<span class="hljs-string">"开始转换: "</span> + sourceFile + <span class="hljs-string">" -&gt; "</span> + targetFile);
        System.out.println(<span class="hljs-string">"使用Apache PDFBox解析PDF..."</span>);
        System.out.println(<span class="hljs-string">"使用Apache POI生成Word文档..."</span>);
        System.out.println(<span class="hljs-string">"转换完成!"</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getSourceFormat</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"PDF"</span>;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getTargetFormat</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"WORD"</span>;
    }
}

<span class="hljs-comment">/**
 * 具体产品：Word转PDF
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WordToPdfConverter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">DocumentConverter</span> {

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">convert</span><span class="hljs-params">(String sourceFile, String targetFile)</span> {
        System.out.println(<span class="hljs-string">"开始转换: "</span> + sourceFile + <span class="hljs-string">" -&gt; "</span> + targetFile);
        System.out.println(<span class="hljs-string">"使用Apache POI解析Word文档..."</span>);
        System.out.println(<span class="hljs-string">"使用iText生成PDF..."</span>);
        System.out.println(<span class="hljs-string">"转换完成!"</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getSourceFormat</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"WORD"</span>;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getTargetFormat</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"PDF"</span>;
    }
}

<span class="hljs-comment">/**
 * 具体产品：Markdown转HTML
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MarkdownToHtmlConverter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">DocumentConverter</span> {

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">convert</span><span class="hljs-params">(String sourceFile, String targetFile)</span> {
        System.out.println(<span class="hljs-string">"开始转换: "</span> + sourceFile + <span class="hljs-string">" -&gt; "</span> + targetFile);
        System.out.println(<span class="hljs-string">"使用CommonMark解析Markdown..."</span>);
        System.out.println(<span class="hljs-string">"生成HTML文件..."</span>);
        System.out.println(<span class="hljs-string">"转换完成!"</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getSourceFormat</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"MARKDOWN"</span>;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getTargetFormat</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"HTML"</span>;
    }
}

<span class="hljs-comment">/**
 * 抽象工厂：文档转换器工厂
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DocumentConverterFactory</span> {

    <span class="hljs-comment">/**
     * 工厂方法：创建转换器
     */</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">abstract</span> DocumentConverter <span class="hljs-title function_">createConverter</span><span class="hljs-params">()</span>;

    <span class="hljs-comment">/**
     * 执行转换（模板方法）
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">performConversion</span><span class="hljs-params">(String sourceFile, String targetFile)</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 1. 验证文件</span>
            validateFiles(sourceFile, targetFile);

            <span class="hljs-comment">// 2. 创建转换器</span>
            <span class="hljs-type">DocumentConverter</span> <span class="hljs-variable">converter</span> <span class="hljs-operator">=</span> createConverter();

            <span class="hljs-comment">// 3. 显示转换信息</span>
            System.out.println(<span class="hljs-string">"\n=== 文档转换任务 ==="</span>);
            System.out.println(<span class="hljs-string">"转换类型: "</span> + converter.getSourceFormat() +
                             <span class="hljs-string">" → "</span> + converter.getTargetFormat());
            System.out.println(<span class="hljs-string">"源文件: "</span> + sourceFile);
            System.out.println(<span class="hljs-string">"目标文件: "</span> + targetFile);
            System.out.println(<span class="hljs-string">"==================\n"</span>);

            <span class="hljs-comment">// 4. 执行转换</span>
            <span class="hljs-type">boolean</span> <span class="hljs-variable">success</span> <span class="hljs-operator">=</span> converter.convert(sourceFile, targetFile);

            <span class="hljs-comment">// 5. 记录日志</span>
            <span class="hljs-keyword">if</span> (success) {
                logSuccess(converter, sourceFile, targetFile);
            } <span class="hljs-keyword">else</span> {
                logFailure(converter, sourceFile, targetFile);
            }

            <span class="hljs-keyword">return</span> success;

        } <span class="hljs-keyword">catch</span> (Exception e) {
            System.err.println(<span class="hljs-string">"转换失败: "</span> + e.getMessage());
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">validateFiles</span><span class="hljs-params">(String sourceFile, String targetFile)</span> {
        <span class="hljs-keyword">if</span> (sourceFile == <span class="hljs-literal">null</span> || targetFile == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"文件路径不能为空"</span>);
        }
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">logSuccess</span><span class="hljs-params">(DocumentConverter converter, String source, String target)</span> {
        System.out.println(<span class="hljs-string">"\n✓ 转换成功: "</span> + converter.getSourceFormat() +
                         <span class="hljs-string">" → "</span> + converter.getTargetFormat());
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">logFailure</span><span class="hljs-params">(DocumentConverter converter, String source, String target)</span> {
        System.err.println(<span class="hljs-string">"\n✗ 转换失败: "</span> + converter.getSourceFormat() +
                         <span class="hljs-string">" → "</span> + converter.getTargetFormat());
    }
}

<span class="hljs-comment">/**
 * 具体工厂实现
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PdfToWordConverterFactory</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">DocumentConverterFactory</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> DocumentConverter <span class="hljs-title function_">createConverter</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PdfToWordConverter</span>();
    }
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WordToPdfConverterFactory</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">DocumentConverterFactory</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> DocumentConverter <span class="hljs-title function_">createConverter</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">WordToPdfConverter</span>();
    }
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MarkdownToHtmlConverterFactory</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">DocumentConverterFactory</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> DocumentConverter <span class="hljs-title function_">createConverter</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MarkdownToHtmlConverter</span>();
    }
}

<span class="hljs-comment">/**
 * 工厂注册表（简化客户端使用）
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConverterFactoryRegistry</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> java.util.Map&lt;String, DocumentConverterFactory&gt; factories =
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">java</span>.util.HashMap&lt;&gt;();

    <span class="hljs-keyword">static</span> {
        <span class="hljs-comment">// 注册所有工厂</span>
        factories.put(<span class="hljs-string">"pdf-to-word"</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">PdfToWordConverterFactory</span>());
        factories.put(<span class="hljs-string">"word-to-pdf"</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">WordToPdfConverterFactory</span>());
        factories.put(<span class="hljs-string">"markdown-to-html"</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">MarkdownToHtmlConverterFactory</span>());
    }

    <span class="hljs-comment">/**
     * 根据转换类型获取工厂
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> DocumentConverterFactory <span class="hljs-title function_">getFactory</span><span class="hljs-params">(String conversionType)</span> {
        <span class="hljs-type">DocumentConverterFactory</span> <span class="hljs-variable">factory</span> <span class="hljs-operator">=</span> factories.get(conversionType);
        <span class="hljs-keyword">if</span> (factory == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"不支持的转换类型: "</span> + conversionType);
        }
        <span class="hljs-keyword">return</span> factory;
    }

    <span class="hljs-comment">/**
     * 列出所有支持的转换类型
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">listSupportedConversions</span><span class="hljs-params">()</span> {
        System.out.println(<span class="hljs-string">"支持的转换类型:"</span>);
        factories.keySet().forEach(type -&gt; System.out.println(<span class="hljs-string">"  - "</span> + type));
    }
}

<span class="hljs-comment">/**
 * 测试类
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DocumentConverterTest</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 列出支持的转换类型</span>
        ConverterFactoryRegistry.listSupportedConversions();

        <span class="hljs-comment">// 场景1: PDF转Word</span>
        <span class="hljs-type">DocumentConverterFactory</span> <span class="hljs-variable">factory1</span> <span class="hljs-operator">=</span>
            ConverterFactoryRegistry.getFactory(<span class="hljs-string">"pdf-to-word"</span>);
        factory1.performConversion(<span class="hljs-string">"/docs/report.pdf"</span>, <span class="hljs-string">"/docs/report.docx"</span>);

        <span class="hljs-comment">// 场景2: Word转PDF</span>
        <span class="hljs-type">DocumentConverterFactory</span> <span class="hljs-variable">factory2</span> <span class="hljs-operator">=</span>
            ConverterFactoryRegistry.getFactory(<span class="hljs-string">"word-to-pdf"</span>);
        factory2.performConversion(<span class="hljs-string">"/docs/article.docx"</span>, <span class="hljs-string">"/docs/article.pdf"</span>);

        <span class="hljs-comment">// 场景3: Markdown转HTML</span>
        <span class="hljs-type">DocumentConverterFactory</span> <span class="hljs-variable">factory3</span> <span class="hljs-operator">=</span>
            ConverterFactoryRegistry.getFactory(<span class="hljs-string">"markdown-to-html"</span>);
        factory3.performConversion(<span class="hljs-string">"/docs/README.md"</span>, <span class="hljs-string">"/docs/README.html"</span>);
    }
}
</code></pre>
<h3 data-id="heading-29">十、总结</h3>
<h4 data-id="heading-30">10.1 核心要点</h4>
<ol>
<li><strong>工厂方法模式的本质</strong>：定义创建对象的接口，由子类决定实例化哪个类</li>
<li><strong>适用场景</strong>：
<ul>
<li>不知道具体需要哪个类的实例</li>
<li>希望通过子类指定创建对象</li>
<li>将对象创建职责委托给子类</li>
</ul>
</li>
<li><strong>关键技巧</strong>：
<ul>
<li>抽象工厂定义工厂方法</li>
<li>具体工厂实现工厂方法</li>
<li>客户端依赖抽象，不依赖具体</li>
</ul>
</li>
</ol>
<h4 data-id="heading-31">10.2 使用建议</h4>
<pre><code class="hljs language-arduino" lang="arduino">选择工厂方法模式的检查清单：

✓ 是否需要在运行时决定创建哪个类的实例？
✓ 是否有多种产品类型，且可能继续增加？
✓ 是否希望将对象创建逻辑与使用逻辑分离？
✓ 是否需要在不修改客户端代码的情况下扩展新产品？

如果以上都是<span class="hljs-string">"是"</span>，那么工厂方法模式是个好选择！
</code></pre>
<h4 data-id="heading-32">10.3 实践原则</h4>
<ol>
<li><strong>合理使用</strong>：不是所有对象创建都需要工厂方法</li>
<li><strong>保持简单</strong>：如果只有2-3个产品，考虑简单工厂</li>
<li><strong>结合其他模式</strong>：可以与单例、原型等模式结合</li>
<li><strong>文档化</strong>：清晰记录各工厂创建的产品类型</li>
</ol>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[听说vite要一统江湖了，我看看怎么个事]]></title>    <link>https://juejin.cn/post/7574749664492830754</link>    <guid>https://juejin.cn/post/7574749664492830754</guid>    <pubDate>2025-11-21T08:57:21.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574749664492830754" data-draft-id="7574816159755239475" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="听说vite要一统江湖了，我看看怎么个事"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-11-21T08:57:21.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="sean聊前端"/> <meta itemprop="url" content="https://juejin.cn/user/2682464101207560"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            听说vite要一统江湖了，我看看怎么个事
            <!----> <!----></h1> <div class="container team-follow" data-v-d326b38e="" data-v-61fb5e44=""><div class="left" data-v-d326b38e=""><a href="/team/7331587707870642210/posts" data-v-d326b38e=""><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c88185b14145426288bf96b1a1cb98ce~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=200&amp;h=200&amp;s=5651&amp;e=png&amp;b=fefefe" class="icon" data-v-d326b38e=""/></a> <div class="content" data-v-d326b38e=""><div style="display: flex" data-v-d326b38e=""><a href="/team/7331587707870642210/posts" data-v-d326b38e=""><p class="title-line" data-v-d326b38e=""><span title="顺丰同城前端技术团队" class="title" data-v-d326b38e="">顺丰同城前端技术团队</span> <img src="//lf-web-assets.juejin.cn/obj/juejin-web/xitu_juejin_web/255e400027b783cbad76dc41527e7695.svg" alt="team icon" class="team-icon" data-v-d326b38e=""/></p></a></div> <div class="meta-box team" data-v-d326b38e="" data-v-61fb5e44=""><time datetime="2025-11-21T08:57:21.000Z" title="Fri Nov 21 2025 08:57:21 GMT+0000 (Coordinated Universal Time)" class="time" data-v-d326b38e="" data-v-61fb5e44="">
                2025-11-21
              </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-d326b38e="" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-d326b38e="" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-d326b38e="" data-v-61fb5e44=""/></svg> <span class="views-count" style="display:none;" data-v-d326b38e="" data-v-61fb5e44="">
                0
              </span> <span class="read-time" data-v-d326b38e="" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-d326b38e="" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-d326b38e="" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-d326b38e="" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-d326b38e="" data-v-61fb5e44=""/></svg>
                阅读23分钟
              </span> <!----> <!----></div></div></div> <button class="jj-follow-button follow-btn" style="display:none;" data-v-b60b2868="" data-v-d326b38e=""><span data-v-b60b2868="" data-v-d326b38e=""><i class="byte-icon byte-icon--plus" data-v-d326b38e=""><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 48 48"><path fill="none" d="M0 0h48v48H0z"/><path d="M24.7 4c.4 0 .6 0 .8.1.2.1.3.2.4.4.1.2.1.3.1.8V22h16.7c.4 0 .6 0 .8.1.2.1.3.2.4.4.1.2.1.3.1.8v1.4c0 .4 0 .6-.1.8-.1.2-.2.3-.4.4-.2.1-.3.1-.8.1H26v16.7c0 .4 0 .6-.1.8-.1.2-.2.3-.4.4-.2.1-.3.1-.8.1h-1.4c-.4 0-.6 0-.8-.1-.2-.1-.3-.2-.4-.4-.1-.2-.1-.3-.1-.8V26H5.3c-.4 0-.6 0-.8-.1-.2-.1-.3-.2-.4-.4-.1-.2-.1-.3-.1-.8v-1.4c0-.4 0-.6.1-.8.1-.2.2-.3.4-.4.2-.1.3-.1.8-.1H22V5.3c0-.4 0-.6.1-.8.1-.2.2-.3.4-.4.2-.1.3-.1.8-.1h1.4z"/></svg></i>
        关注
      </span></button></div> <div class="team-user block-hidden" data-v-61fb5e44=""><div class="avatar jj-avatar avatar" data-v-03256cc6="" data-v-61fb5e44=""><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8AQMAAAAAMksxAAAAA1BMVEUAAACnej3aAAAAAXRSTlMAQObYZgAAAA5JREFUKM9jGAWjAAcAAAIcAAE27nY6AAAAAElFTkSuQmCC" alt="avatar" class="lazy avatar-img" data-v-5244ef91="" data-v-03256cc6=""/> </div> <!----> <span class="position ellipsis" data-v-61fb5e44="">
              html5 @家里蹲
            </span></div> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">抛几个问题大家先聊聊</h3>
<p>1.  大家心目中的vite是个什么样子</p>
<p>2.  vite快在哪</p>
<p>3.  vite 开发环境和生成环境都用什么打包 为啥不能统一</p>
<h3 data-id="heading-1">一、Vite 产生背景</h3>
<p> </p>
<h4 data-id="heading-2">1.  传统构建工具的核心痛点(webpack有啥痛点)</h4>
<p> </p>
<p>以 Webpack 为代表的传统工具，因 “全量打包” 模式难以适配复杂项目，主要痛点集中在四点：</p>
<p>● 🚫 开发体验差：冷启动达分钟级，热更新延迟随模块量增长，常丢失开发状态</p>
<p>● ⚡ 性能瓶颈明显：JS 编写的工具占用 CPU / 内存高，多项目并行时设备压力大</p>
<p>● 🔧 适配成本高：需兼容多模块格式（CJS/UMD/ESM），配置 TypeScript 等功能步骤繁琐</p>
<p>● 🕸️ 未利用浏览器新能力：2018 年后浏览器原生支持 ESM，但传统工具未借力优化</p>
<p> </p>
<h4 data-id="heading-3">2. Vite 诞生的 3 大技术基石（vite有啥优势）</h4>
<p> </p>
<p>Vite 的出现依赖前端生态三大关键进展，缺一不可：</p>
<p>1.  🌐 浏览器原生 ESM 普及</p>
<p>支持 
</p><p>2.  🔨 编译工具语言革新</p>
<p>2020 年 Go 语言编写的 esbuild 发布，依赖预构建速度比 JS 工具快 10-100 倍，解决传统工具性能瓶颈。</p>
<p>3.  🧩 构建理念升级</p>
<p>开发环境借鉴 Snowpack “依赖预构建” 思路，生产环境依托 Rollup 成熟插件生态，实现 “按需编译” 的新型构建模式。</p>
<p> </p>
<h4 data-id="heading-4">3. Vite 诞生历程与关键决策（vite时间线）</h4>
<p> </p>
<p>Vite 从解决 Vue 生态痛点起步，逐步发展为跨框架通用工具：</p>
<p>● 📅 初始动机：2019 年 Vue 3 开发中，模块激增导致 Webpack 启动慢，亟需适配现代框架的轻量工具。</p>
<p>● 🚩 关键时间节点：</p>
<p>● 2020.04：Vite 1.0 发布，仅支持 Vue 项目，验证 ESM 开发模式可行性；</p>
<p>● 2021.02：Vite 2.0 重构，成为跨框架工具，引入 Rollup 负责生产构建；</p>
<p>● 2022-2023：3.0/4.0/5.0 版本持续优化性能，完善生态兼容（如支持 React、Svelte 等）。</p>
<p>● 🎯 核心决策：分模块差异化处理</p>
<p>依赖用 esbuild 预构建 + 源码开发时按需编译 + 全流程缓存，平衡速度与兼容性。</p>
<p> </p>
<h4 data-id="heading-5">4. 构建模式对比流程图（webpack vs vite）</h4>
<p> </p>
<p>通过流程图直观对比传统工具与 Vite 的核心差异，重点关注 “是否全量打包”“更新方式” 两个维度：</p>
<p> </p>
<h5 data-id="heading-6">4.1 传统 Bundle 模式（以 Webpack 为例）</h5>
<p><img src="" alt="" loading="lazy"/></p>
<p> </p>
<h5 data-id="heading-7">4.2 Vite 构建模式（开发 + 生产分离）</h5>
<p><img src="" alt="" loading="lazy"/></p>
<p> </p>
<h4 data-id="heading-8">5. Vite 核心价值总结 (总结)</h4>
<p>Vite 之所以能成为前端构建工具新选择，核心价值体现在四方面：</p>
<p>1.  🔄 范式革新：开发 / 生产分离优化（ESM 按需编译 + Rollup 生产打包），兼顾速度与产物质量；</p>
<p>2.  ⚡ 性能突破：冷启动时间从分钟级压缩至秒级，大型项目开发效率提升显著；</p>
<p>3.  🚀 体验升级：零配置开箱即用，HMR 保持应用状态，减少开发流程中断；</p>
<p>4.  🌍 生态兼容：支持 Vue/React/Svelte 等多框架，兼容 Rollup 插件，降低迁移成本。</p>
<p> </p>
<h3 data-id="heading-9">二. Vite 核心特性解析</h3>
<p> </p>
<p>Vite 颠覆传统构建工具的核心在于利用现代浏览器能力与分层优化策略，其三大核心特性共同实现了 “开发极速响应、生产高效输出” 的体验升级。</p>
<h4 data-id="heading-10">2.1 特性一：极速冷启动（毫秒级启动）</h4>
<p> </p>
<p>传统工具需全量打包后启动服务，而 Vite 通过 “依赖预构建 + 源码按需加载” 实现极速启动，启动时间不受项目体积线性影响。</p>
<p> </p>
<h5 data-id="heading-11">2.1.1 实现原理</h5>
<p>1.  模块分层处理</p>
<p>首次启动时将项目模块拆分为两类，针对性优化：</p>
<p>● 依赖模块：开发中不变的纯 JS 依赖（如 Lodash、Vue 核心库），多含 CJS/UMD 格式，需统一转换为 ESM 并合并减少请求量。</p>
<p><img src="" alt="" loading="lazy"/></p>
<p>● 源码模块：频繁编辑的业务代码（含 JSX、Vue 组件等），直接以原生 ESM 格式提供，浏览器请求时才按需编译。</p>
<p><img src="" alt="" loading="lazy"/></p>
<p>2.  esbuild 预构建依赖</p>
<p>采用 Go 语言编写的 esbuild 处理依赖，速度比 JS 工具快 10-100 倍，预构建结果存入缓存（node_modules/.vite），二次启动直接复用。</p>
<p>3.  浏览器接管部分打包工作</p>
<p>通过 
</p><p> </p>
<h5 data-id="heading-12">2.1.2 冷启动流程可视化</h5>
<p><img src="" alt="" loading="lazy"/></p>
<p> </p>
<h4 data-id="heading-13">2.2 特性二：精准热模块替换（HMR）</h4>
<p> </p>
<p>Vite 的 HMR 基于原生 ESM 实现，更新速度不随项目体积增长而下降，且能保持应用运行状态。</p>
<p> </p>
<h5 data-id="heading-14">2.2.1 核心机制</h5>
<p>1.  模块依赖图追踪</p>
<p>启动时构建 moduleGraph 记录模块间依赖关系（如 A 依赖 B、B 依赖 C），每个模块对应唯一 ModuleNode 对象，包含转换结果与依赖链信息。</p>
<p>packages/vite/src/server/moduleGraph.ts</p>
<p>2.  精准失效范围</p>
<p>文件修改后，仅使变更模块及其最近的 HMR 边界（如 Vue 组件的 
</p><p>3.  WebSocket 实时通信</p>
<p>● 用户修改文件后被 server 端的监听器监听到，监听器遍历文件对应的模块，计算出热更新边界</p>
<p>● server 端通过 websocket 向 client 发送热更新信号</p>
<p>● client 对旧模块进行失活，向 server 请求最新的模块资源</p>
<p>● server 收到请求后将模块代码转换为 js，并将转换后的代码返回给 client</p>
<p>● client 执行返回后的代码，调用更新函数更新页面内容</p>
<p>4.  缓存加速</p>
<p>源码模块通过 304 Not Modified 协商缓存，依赖模块通过 immutable 强缓存，避免重复请求。</p>
<p> </p>
<h5 data-id="heading-15">2.2.2 HMR 工作流程可视化</h5>
<p> </p>
<p><img src="" alt="" loading="lazy"/></p>
<p> </p>
<h4 data-id="heading-16">2.3 特性三：开发与生产双环境优化</h4>
<p>Vite 采用 “开发按需编译、生产优化打包” 的差异化策略，兼顾开发效率与生产性能。</p>
<p> </p>
<h5 data-id="heading-17">2.3.1 双环境设计逻辑</h5>






























<table><thead><tr><th>维度</th><th>开发环境（dev）</th><th>生产环境（build）</th></tr></thead><tbody><tr><td>核心目标</td><td>极速启动、实时反馈</td><td>产物体积小、加载快、兼容性强</td></tr><tr><td>实现方式</td><td>原生 ESM 按需编译 + esbuild 预构建</td><td>Rollup 优化打包 + 多维度性能优化</td></tr><tr><td>关键操作</td><td>模块缓存、HMR 局部更新</td><td>Tree-shaking、代码分割、压缩、预加载注入</td></tr><tr><td>工具依赖</td><td>Koa 服务器、WebSocket、chokidar</td><td>Rollup、Terser、CSSNano</td></tr></tbody></table>
<h5 data-id="heading-18"> </h5>
<h5 data-id="heading-19">2.3.2 生产环境优化细节</h5>
<p>1.  Rollup 打包核心</p>
<p>未采用 esbuild 生产打包的原因：Rollup 拥有更成熟的插件生态与更优的代码分割策略，能实现更精细的 Tree-shaking（剔除无用代码）。未来计划迁移至 Rust 编写的 Rolldown，进一步提升性能。</p>
<p>2.  智能代码分割</p>
<p>自动拆分公共依赖（如 Vue 核心库）与业务代码，生成独立 chunk，利用浏览器缓存提升二次加载速度。</p>
<p>3.  资源优化</p>
<p>● 压缩：JS 用 Terser 压缩，CSS 用 CSSNano 处理；</p>
<p>● 预加载：自动生成 ，提前加载关键模块；</p>
<p>● 兼容性：通过 @vitejs/plugin-legacy 生成 ES5 代码，适配旧浏览器。</p>
<p>为啥不用esbuild在生产环境</p>
<p>● 代码分割（Code Splitting）能力较弱：esbuild 的代码分割逻辑相对简单，对动态导入（import()）的处理、公共模块提取（splitChunks）等高级需求支持不足，而现代前端项目（尤其是大型应用）依赖灵活的代码分割来优化加载性能。</p>
<p>● 生态兼容性有限：esbuild 的插件系统不如 Rollup 成熟，许多前端生态中常用的工具（如处理 CSS 模块化、静态资源、特定框架特性的插件）对 esbuild 的适配不够完善，而 Rollup 拥有丰富的插件生态，能更好地兼容前端工程化的复杂需求。</p>
<p>● 对非 ESM 模块的处理能力较弱：虽然 esbuild 支持转换 CommonJS 模块，但在处理复杂依赖关系（如循环依赖、动态 require）时，可能出现与 Webpack/Rollup 不一致的行为，存在兼容性风险。</p>
<p> </p>
<h5 data-id="heading-20">2.3.3 双环境流程对比</h5>
<p><img src="" alt="" loading="lazy"/></p>
<p> </p>
<h4 data-id="heading-21">2.4 特性总结：为何 Vite 能实现 “快且优”？</h4>
<p>1.  理念革新：让浏览器参与模块解析，将传统打包工具的 “预打包” 改为 “按需编译”，从根源上提升启动速度。</p>
<p>2.  技术选型精准：esbuild 处理依赖、Rollup 负责生产打包、WebSocket 实现 HMR，每一步都采用当前最优工具链。</p>
<p>3.  分层优化思维：针对 “开发 - 生产”“依赖 - 源码” 的不同特性设计差异化策略，既满足开发效率又保证生产性能。</p>
<p> </p>
<h3 data-id="heading-22">三、  Vite 各版本对比及 Demo 展示</h3>
<p> </p>
<h4 data-id="heading-23">3.1版本演进核心脉络与定位</h4>
<p>Vite 的版本迭代围绕「性能突破」与「架构统一」两大主线展开，可划分为三个关键阶段：</p>
<p>1.  基础奠基期（V4.x）：验证「非打包开发」核心模式，奠定极速启动基础</p>
<p>2.  生态拓展期（V5.x-V6.x）：完善框架适配与工具链集成，暴露混合架构瓶颈</p>
<p>3.  架构重构期（V7.x-V8 Beta）：引入 Rust 工具链，实现开发 / 生产流程统一</p>
<p> </p>
<h4 data-id="heading-24">3.2关键版本核心特性对比</h4>






















































<table><thead><tr><th>维度</th><th>V4.x（奠基期）</th><th>V5.x-V6.x（拓展期）</th><th>V7.x（转型期）</th><th>V8 Beta（重构期）</th></tr></thead><tbody><tr><td>核心架构</td><td>esbuild 预打包 + Rollup 生产构建</td><td>保留双工具架构，优化协作逻辑</td><td>引入 Rolldown 试验性支持</td><td>全 Rolldown 驱动，彻底替代双工具</td></tr><tr><td>Node 支持</td><td>Node.js 14.18+</td><td>Node.js 16.14+</td><td>Node.js 20.19+/22.12+（弃用 18）</td><td>同 V7，兼容 LTS 版本</td></tr><tr><td>框架适配</td><td>Vue/React/Svelte 核心支持</td><td>新增 Marko 模板，RedwoodSDK 整合</td><td>完善 Vue 3.5/React 19 适配</td><td>全框架兼容，支持微前端联邦架构</td></tr><tr><td>TypeScript 能力</td><td>基础 TS 转译，依赖 esbuild</td><td>内置 TS 5.8，支持常量枚举内联</td><td>集成 Oxc TS 解析，类型检查提速 30%</td><td>原生 TS 类型优化，支持增量编译</td></tr><tr><td>性能优化点</td><td>冷启动 161ms（对比 Webpack 快 11.7 倍）</td><td>解析逻辑优化，冷启动比 V4.2 提升 70%</td><td>生产构建速度提升 30%，热更新 &lt; 50ms</td><td>跨块优化提速 15 倍，打包体积降 20%</td></tr><tr><td>关键新特性</td><td>HMR 模块依赖图追踪</td><td>模块联邦支持，barrel 文件优化</td><td>新增 buildApp 钩子，Vite DevTools 开发</td><td>全捆绑模式，原生 Importmaps 支持</td></tr></tbody></table>
<p> </p>
<h4 data-id="heading-25">3.3. 核心架构迭代解析</h4>

























<table><thead><tr><th>版本阶段</th><th>架构示意图</th><th>核心痛点解决</th></tr></thead><tbody><tr><td>V4.x-V6.x</td><td><img src="" alt="" loading="lazy"/></td><td>红色虚线框：开发用 esbuild、生产用 Rollup，工具链割裂导致环境差异黄色感叹号：Rollup 单线程处理大型项目时，构建速度瓶颈明显 </td></tr><tr><td>V7.x</td><td><img src="" alt="" loading="lazy"/></td><td>过渡特性标注：绿色模块：新增的 Rolldown 试验性功能，主打性能提升黄色模块：优化后的 Dev Server，内存占用降低 30%分支逻辑：保留双工具链选项，平衡兼容性与性能 </td></tr><tr><td>V8 Beta</td><td><img src="" alt="" loading="lazy"/></td><td>蓝色粗框：Rolldown 统一工具链，消除环境差异绿色模块：多线程 + 增量打包，性能核心产物体积比 V6.x 降 20%，无需手动配置 vendor </td></tr></tbody></table>
<h4 data-id="heading-26"> </h4>
<h4 data-id="heading-27">3.4. 大型项目性能实测（复杂多应用工程）</h4>








































<table><thead><tr><th>指标</th><th>V4.x</th><th>V6.x</th><th>V7.x</th><th>V8 Beta</th></tr></thead><tbody><tr><td>开发冷启动时间</td><td>2.8s</td><td>1.5s</td><td>0.9s</td><td>0.3s</td></tr><tr><td>生产构建时间</td><td>3m12s</td><td>2m0s</td><td>1m15s</td><td>8s</td></tr><tr><td>热更新响应时间</td><td>120ms</td><td>80ms</td><td>45ms</td><td>20ms</td></tr><tr><td>内存占用</td><td>180MB</td><td>120MB</td><td>90MB</td><td>42MB</td></tr></tbody></table>
<p>数据来源：Vite 官方 benchmark 及 PayFit、掘金社区实测案例综合整理</p>
<p> </p>
<h4 data-id="heading-28">3.5. 各版本适用场景</h4>
<p>● V4.x：维护旧项目，依赖 Node.js 18 及以下环境</p>
<p>● V6.x：中型项目稳定运行，需 Marko/Redwood 生态支持</p>
<p>● V7.x：追求性能提升，可接受 Rust 工具链过渡适配</p>
<p>● V8 Beta：大型项目 / 微前端架构，需极致构建性能</p>
<p> </p>
<h4 data-id="heading-29">3.6. 迁移成本与收益对比</h4>





























<table><thead><tr><th>迁移路径</th><th>核心改动点</th><th>预期收益</th><th>潜在风险</th></tr></thead><tbody><tr><td>V4→V6</td><td>升级 Node.js 至 16+，适配 TS 5.8</td><td>冷启动提速 46%，生态工具更丰富</td><td>部分旧插件兼容性问题</td></tr><tr><td>V6→V7</td><td>升级 Node.js 至 20+，适配 Rolldown 试验模式</td><td>生产构建提速 40%，热更新延迟减半</td><td>少数第三方库导入顺序问题</td></tr><tr><td>V7→V8 Beta</td><td>移除 Rollup 配置，启用全捆绑模式</td><td>构建速度提升 15 倍，打包体积降 20%</td><td>部分插件需迁移至 Rust 原生实现</td></tr></tbody></table>
<h4 data-id="heading-30"> </h4>
<h4 data-id="heading-31">3.7. 7+版本演进核心优势</h4>
<p>1.  性能质变节点：V7.x 引入 Rolldown 标志着性能提升从「优化迭代」进入「架构重构」阶段，V8 Beta 实现质的飞跃</p>
<p>2.  架构统一价值：全 Rolldown 驱动解决了 Vite 诞生以来的「开发 / 生产环境不一致」核心痛点</p>
<p>3.  生态适配节奏：每个大版本均保持对主流框架的兼容性，V8 将完成从工具到生态的全面升级</p>
<p>参考 Vite 官方路线图：2025 年底 V8 正式版将实现 Rolldown 全量启用，届时 V4-V7 版本将逐步进入维护期</p>
<h3 data-id="heading-32"> </h3>
<h4 data-id="heading-33">3.8. 快速搭建各版本项目demo</h4>
<pre><code class="hljs language-perl" lang="perl"><span class="hljs-comment"># Vite 3（需指定版本）</span>
npm create vite@3 <span class="hljs-keyword">my</span>-v3-app -- --template vue
<span class="hljs-comment"># Vite 4</span>
npm create vite@4 <span class="hljs-keyword">my</span>-v4-app -- --template vue
<span class="hljs-comment"># Vite 5</span>
npm create vite@5 <span class="hljs-keyword">my</span>-v5-app -- --template vue
<span class="hljs-comment"># Vite 6</span>
npm create vite@6 <span class="hljs-keyword">my</span>-v6-app -- --template vue
<span class="hljs-comment"># Vite 7</span>
npm create vite@7 <span class="hljs-keyword">my</span>-v7-app -- --template vue
</code></pre>
<p> </p>
<h3 data-id="heading-34">四、vite4核心源码解析</h3>
<p> </p>
<h4 data-id="heading-35">4.1、Vite 4 核心架构与源码组织</h4>
<p>Vite 4 采用 monorepo 结构（基于 pnpm workspace），核心代码集中于 <code>packages/vite</code> 目录，整体架构可划分为五大核心模块，各模块职责明确且协同联动。</p>
<p> </p>
<h4 data-id="heading-36">4.2. 核心模块概览</h4>



































<table><thead><tr><th>模块路径</th><th>核心职责</th><th>关键依赖 / 工具</th></tr></thead><tbody><tr><td>src/node/cli.ts</td><td>命令行入口，解析参数分发命令</td><td>cac（命令行解析工具）</td></tr><tr><td>src/node/config/</td><td>配置解析与合并，支持多环境配置</td><td>-</td></tr><tr><td>src/node/server/</td><td>开发服务器实现，集成 HMR 与中间件</td><td>connect（中间件框架）、chokidar（文件监听）</td></tr><tr><td>src/node/build/</td><td>生产构建流程，基于 Rollup 实现</td><td>Rollup 3、esbuild</td></tr><tr><td>src/node/plugin/</td><td>插件系统核心，定义钩子与容器</td><td>-</td></tr></tbody></table>
<p> </p>
<h4 data-id="heading-37">4.3. 核心数据结构</h4>
<p>●  ModuleGraph（<code>src/node/server/moduleGraph.ts</code>）：维护模块依赖关系的核心数据结构，记录 URL 与文件路径映射、模块依赖链及 HMR 状态，是按需编译与热更新的基础。</p>
<p>●  PluginContainer（<code>src/node/pluginContainer.ts</code>）：插件容器，统一调度插件钩子执行，实现模块解析、转换等流程的可扩展性。</p>
<p> </p>
<p> </p>
<h4 data-id="heading-38">4.4、核心流程源码解析</h4>
<p>Vite 4 的核心能力集中体现在开发环境启动、模块按需编译、热更新（HMR） 与生产构建四大流程，以下结合源码片段深度拆解。</p>
<p> </p>
<h5 data-id="heading-39">4.4.1. 开发服务器启动流程（<code>vite dev</code>）</h5>
<p>启动流程是 Vite 4 极速体验的起点，核心是初始化配置、构建中间件链与启动 HMR 服务，源码入口为 <code>src/node/cli.ts</code>，关键逻辑在 <code>createServer</code> 函数中实现。</p>
<p> </p>
<p>关键步骤与源码</p>
<ol>
<li>命令行解析与配置合并</li>
</ol>
<pre><code class="hljs language-scss" lang="scss">   <span class="hljs-comment">// src/node/cli.ts 简化逻辑</span>
   async function <span class="hljs-built_in">createServer</span>(inlineConfig = {}) {
     <span class="hljs-comment">// 1. 解析配置：合并默认配置、用户配置、环境变量</span>
     const config = await <span class="hljs-built_in">resolveConfig</span>(inlineConfig, 'serve')
        
     <span class="hljs-comment">// 2. 创建中间件容器与 HTTP 服务器</span>
     const middlewares = <span class="hljs-built_in">connect</span>()
     const httpServer = await <span class="hljs-built_in">resolveHttpServer</span>(config.server, middlewares)
     
     <span class="hljs-comment">// 3. 初始化 WebSocket 服务（HMR 通信通道）</span>
     const ws = <span class="hljs-built_in">createWebSocketServer</span>(httpServer, config)
     
     <span class="hljs-comment">// 4. 创建文件监听器（监控源码与配置变化）</span>
     const watcher = chokidar<span class="hljs-selector-class">.watch</span>(root, resolvedWatchOptions)
 
     <span class="hljs-comment">// 5. 初始化模块依赖图</span>
     const moduleGraph = new <span class="hljs-built_in">ModuleGraph</span>((url) =&gt; pluginContainer<span class="hljs-selector-class">.resolveId</span>(url))
     
     <span class="hljs-comment">// 6. 注册核心中间件（按顺序执行）</span>
     middlewares<span class="hljs-selector-class">.use</span>(timeMiddleware) <span class="hljs-comment">// 响应时间统计</span>
     middlewares<span class="hljs-selector-class">.use</span>(corsMiddleware(config)) <span class="hljs-comment">// 跨域处理</span>
     middlewares<span class="hljs-selector-class">.use</span>(proxyMiddleware(config)) <span class="hljs-comment">// 代理配置</span>
     middlewares<span class="hljs-selector-class">.use</span>(transformMiddleware(config, moduleGraph, ws)) <span class="hljs-comment">// 模块转换核心</span>
     middlewares<span class="hljs-selector-class">.use</span>(indexHtmlMiddleware(config, moduleGraph)) <span class="hljs-comment">// HTML 处理</span>
     middlewares<span class="hljs-selector-class">.use</span>(errorMiddleware()) <span class="hljs-comment">// 错误捕获</span>
     
     <span class="hljs-comment">// 7. 初始化插件容器</span>
     await pluginContainer<span class="hljs-selector-class">.buildStart</span>({})
     
  <span class="hljs-comment">// 8. 初始化依赖预构建器（后台启动，不阻塞服务器启动）</span>
     await <span class="hljs-built_in">initDepsOptimizer</span>(config, options.force, true);
     
     return { server, moduleGraph, ws }
   }
</code></pre>
<p> </p>
<ol start="2">
<li>依赖预构建优化</li>
</ol>
<p>Vite 4 默认启用 esbuild 处理依赖预构建，将 CommonJS 格式的依赖转换为 ESM 并缓存，避免浏览器兼容性问题，源码位于 <code>src/node/depOptimizer/</code>。预构建产物存储于 <code>node_modules/.vite/deps</code>，首次启动后会缓存，二次启动直接复用。</p>
<p> </p>
<p>启动流程可视化</p>
<p><img src="" alt="" loading="lazy"/></p>
<h5 data-id="heading-40">4.4.2. 模块按需编译流程（核心性能点）</h5>
<p>Vite 4 区别于传统打包工具的核心是按需编译：浏览器请求模块时才触发编译，而非全量预打包，核心实现依赖 <code>transformMiddleware</code> 中间件。</p>
<p> </p>
<p>关键逻辑与源码</p>
<ol>
<li>请求拦截与模块解析</li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript">   <span class="hljs-comment">// src/node/server/middlewares/transform.ts 简化逻辑</span>
   <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">transformMiddleware</span>(<span class="hljs-params">req, res, next</span>) {
     <span class="hljs-keyword">const</span> url = req.<span class="hljs-property">url</span>
     <span class="hljs-comment">// 1. 忽略静态资源与非模块请求</span>
     <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isStaticAsset</span>(url) || !req.<span class="hljs-property">headers</span>.<span class="hljs-property">accept</span>?.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'text/javascript'</span>)) {
       <span class="hljs-keyword">return</span> <span class="hljs-title function_">next</span>()
     }
     
     <span class="hljs-comment">// 2. 从模块图获取或创建模块实例</span>
     <span class="hljs-keyword">let</span> <span class="hljs-variable language_">module</span> = moduleGraph.<span class="hljs-title function_">getModuleByUrl</span>(url)
     <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">module</span>) {
       <span class="hljs-keyword">const</span> resolved = <span class="hljs-keyword">await</span> pluginContainer.<span class="hljs-title function_">resolveId</span>(url)
       <span class="hljs-variable language_">module</span> = <span class="hljs-keyword">await</span> moduleGraph.<span class="hljs-title function_">createModule</span>(resolved.<span class="hljs-property">id</span>, url)
     }
     
     <span class="hljs-comment">// 3. 执行插件转换（如 Vue SFC 解析、TS 转译）</span>
     <span class="hljs-keyword">const</span> transformResult = <span class="hljs-keyword">await</span> pluginContainer.<span class="hljs-title function_">transform</span>(code, <span class="hljs-variable language_">module</span>.<span class="hljs-property">file</span>)
     
     <span class="hljs-comment">// 4. 注入 HMR 客户端代码（开发环境）</span>
     <span class="hljs-keyword">if</span> (!isProduction) {
       transformResult.<span class="hljs-property">code</span> += <span class="hljs-title function_">injectHmrClientCode</span>(url)
     }
     
     <span class="hljs-comment">// 5. 返回编译结果给浏览器</span>
     res.<span class="hljs-title function_">setHeader</span>(<span class="hljs-string">'Content-Type'</span>, <span class="hljs-string">'application/javascript'</span>)
     res.<span class="hljs-title function_">end</span>(transformResult.<span class="hljs-property">code</span>)
   }
</code></pre>
<p>拦截模块请求浏览器的请求先经过 Vite 服务器的中间件链，transformMiddleware 会识别出 “需要编译的模块请求”（如 .vue、.ts、.jsx 等非原生 ESM 模块，或需要转换的 JS 模块）。</p>
<p>定位模块文件</p>
<p>通过 ModuleGraph（之前提到的模块依赖图）将请求的 URL（如 /src/App.vue）映射到本地文件系统的路径（如 ./src/App.vue），确认模块的物理位置。</p>
<p> </p>
<p>调用插件处理（编译）</p>
<p>借助 PluginContainer（插件容器）调用对应插件的转换钩子（如 transform），对模块内容进行实时编译：</p>
<p>例如，.vue 文件会被 @vitejs/plugin-vue 解析为模板、脚本、样式三部分，分别编译为浏览器可执行的 JS 代码；</p>
<p>例如，.ts 文件会被 @vitejs/plugin-typescript 转换为 JS 代码。</p>
<p> </p>
<p>处理依赖关系</p>
<p>编译过程中，若模块依赖其他模块（如 App.vue 中 import Button from './Button.vue'），transformMiddleware 会通过 ModuleGraph 记录这些依赖关系，为后续的热更新做准备。</p>
<p> </p>
<p>返回编译结果</p>
<p>将编译后的代码（符合 ESM 规范）作为 HTTP 响应返回给浏览器，浏览器直接执行该模块。</p>
<p> </p>
<ol start="2">
<li>插件转换机制</li>
</ol>
<p>以 Vue 单文件组件（SFC）为例，<code>@vitejs/plugin-vue</code> 插件通过 <code>transform</code> 钩子拦截 <code>.vue</code> 文件请求，将其拆分为模板、脚本、样式三部分分别处理，再合并为浏览器可识别的 ESM 模块。</p>
<p> </p>
<h5 data-id="heading-41">4.4.3. 热更新（HMR）流程</h5>
<p>Vite 4 升级了 HMR 引擎，大型项目热更新延迟从 1200ms 降至 500ms 内，核心是"精确模块更新"而非全页刷新，依赖文件监听、模块依赖分析与 WebSocket 通信实现。</p>
<p> </p>
<p>关键步骤与源码</p>
<ol>
<li>文件变化监听与依赖分析</li>
</ol>
<pre><code class="hljs language-php" lang="php"><span class="hljs-comment">// vite/src/node/server/hmr.ts 核心逻辑简化版</span>
async <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">handleHMRUpdate</span>(<span class="hljs-params">file: <span class="hljs-keyword">string</span>, server: ViteDevServer</span>) </span>{
  <span class="hljs-keyword">const</span> { ws, config, moduleGraph } = server
  
  <span class="hljs-comment">// 1. 确定受影响的模块</span>
  <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">mods</span> = moduleGraph.<span class="hljs-title function_ invoke__">getModulesByFile</span>(file)
  
  <span class="hljs-comment">// 2. 根据文件类型执行不同更新策略</span>
  <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">isCSSRequest</span>(file)) {
    <span class="hljs-comment">// CSS热更新逻辑</span>
    await Promise.<span class="hljs-title function_ invoke__">all</span>(
      Array.<span class="hljs-keyword">from</span>(mods).<span class="hljs-title function_ invoke__">map</span>((mod) =&gt; {
        <span class="hljs-keyword">return</span> moduleGraph.<span class="hljs-title function_ invoke__">invalidateModule</span>(mod)
      })
    )
    ws.<span class="hljs-title function_ invoke__">send</span>({
      <span class="hljs-attr">type</span>: <span class="hljs-string">'update'</span>,
      <span class="hljs-attr">updates</span>: [{
        <span class="hljs-attr">type</span>: <span class="hljs-string">'css-update'</span>,
        <span class="hljs-attr">path</span>: publicPath,
        <span class="hljs-attr">timestamp</span>: Date.<span class="hljs-title function_ invoke__">now</span>()
      }]
    })
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-comment">// JS/HTML等热更新逻辑</span>
    <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">update</span> = await <span class="hljs-title function_ invoke__">generateUpdate</span>(mods, file, server)
    ws.<span class="hljs-title function_ invoke__">send</span>({
      <span class="hljs-attr">type</span>: <span class="hljs-string">'update'</span>,
      <span class="hljs-attr">updates</span>: update
    })
  }
}
 
</code></pre>
<p> </p>
<ol start="2">
<li>客户端更新处理</li>
</ol>
<p>浏览器端通过 <code>import.meta.hot</code> API 接收更新通知，替换模块并执行自定义更新逻辑（如 Vue 组件重新渲染）：</p>
<pre><code class="hljs language-javascript" lang="javascript">   <span class="hljs-comment">// 客户端 HMR 逻辑（src/client/client.ts）</span>
   <span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">hot</span>.<span class="hljs-title function_">accept</span>(<span class="hljs-string">'./component.js'</span>, <span class="hljs-function">(<span class="hljs-params">newComponent</span>) =&gt;</span> {
     <span class="hljs-comment">// 替换组件并重新挂载</span>
     <span class="hljs-title function_">replaceComponent</span>(newComponent.<span class="hljs-property">default</span>)
   })
</code></pre>
<p> </p>
<p>HMR 流程可视化</p>
<p><img src="" alt="" loading="lazy"/></p>
<h5 data-id="heading-42">4.4.4. 生产构建流程（<code>vite build</code>）</h5>
<p>生产环境下，Vite 4 采用 Rollup 3 进行打包优化，核心是代码分割、压缩与兼容性处理，源码入口为 <code>src/node/build/index.ts</code>。</p>
<p> </p>
<p>关键步骤</p>
<ol>
<li>
<p>配置解析与构建准备：合并生产环境配置，确定目标浏览器与输出格式。</p>
</li>
<li>
<p>Rollup 配置生成：根据 Vite 配置自动生成 Rollup 配置，支持 <code>build.rollupOptions</code> 深度定制。</p>
</li>
<li>
<p>插件适配与执行：将 Vite 插件转换为 Rollup 插件格式，执行模块转换与优化。</p>
</li>
<li>
<p>产物优化：默认启用 Terser 压缩 JS，CSS 压缩通过 <code>cssnano</code> 实现，支持自定义压缩工具。</p>
</li>
</ol>
<p> </p>
<p>核心配置示例</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// Vite 4 生产构建配置</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  build: {
    target: <span class="hljs-string">'es2015'</span>, <span class="hljs-comment">// 目标浏览器兼容性</span>
    minify: <span class="hljs-string">'terser'</span>, <span class="hljs-comment">// 启用 Terser 压缩</span>
    rollupOptions: {
      <span class="hljs-comment">// 自定义代码分割策略</span>
      output: {
        manualChunks: {
          vendor: [<span class="hljs-string">'vue'</span>, <span class="hljs-string">'vue-router'</span>], <span class="hljs-comment">// 第三方依赖单独打包</span>
          utils: [<span class="hljs-string">'lodash'</span>, <span class="hljs-string">'dayjs'</span>]
        }
      }
    }
  }
}
</code></pre>
<p> </p>
<p> </p>
<h4 data-id="heading-43">4.5、Vite 4 核心技术亮点源码解析</h4>
<h5 data-id="heading-44">4.5.1. HMR 性能优化（V4 核心升级点）</h5>
<p>Vite 4 对 HMR 引擎进行了重构，通过差分更新与模块依赖缓存减少重复计算，源码关键优化点在 <code>ModuleGraph</code> 的 <code>invalidateModule</code> 方法中：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// src/node/server/moduleGraph.ts</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">invalidateModule</span>(<span class="hljs-params"><span class="hljs-variable language_">module</span></span>) {
  <span class="hljs-comment">// 仅标记变化模块，不清除整个依赖链缓存</span>
  <span class="hljs-variable language_">module</span>.<span class="hljs-property">invalidated</span> = <span class="hljs-literal">true</span>
  <span class="hljs-comment">// 递归标记依赖模块，但跳过已缓存的无变化模块</span>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> importer <span class="hljs-keyword">of</span> <span class="hljs-variable language_">module</span>.<span class="hljs-property">importers</span>) {
    <span class="hljs-keyword">if</span> (!importer.<span class="hljs-property">invalidated</span>) <span class="hljs-title function_">invalidateModule</span>(importer)
  }
}
</code></pre>
<p> </p>
<h5 data-id="heading-45">4.5.2. 中间件链设计（可扩展性核心）</h5>
<p>Vite 4 中间件按固定顺序执行，确保请求处理的正确性，核心中间件功能如下表：</p>






























<table><thead><tr><th>中间件</th><th>核心功能</th><th>源码路径</th></tr></thead><tbody><tr><td>transformMiddleware</td><td>模块实时编译（TS/Vue 转译）</td><td>src/node/server/middlewares/transform.ts</td></tr><tr><td>indexHtmlMiddleware</td><td>HTML 入口处理与资源注入</td><td>src/node/server/middlewares/indexHtml.ts</td></tr><tr><td>proxyMiddleware</td><td>跨域代理与请求转发</td><td>src/node/server/middlewares/proxy.ts</td></tr><tr><td>errorMiddleware</td><td>全局错误捕获与格式化</td><td>src/node/server/middlewares/error.ts</td></tr></tbody></table>
<p> </p>
<p> </p>
<h4 data-id="heading-46">4.6、核心流程总览流程图</h4>
<p><img src="" alt="" loading="lazy"/></p>
<p> </p>
<p>Vite 4 的源码设计核心是"扬长避短"：用 esbuild 处理快但不灵活的步骤（预构建、转译），用 Rollup 处理灵活但慢的生产打包，用中间件与插件系统保证可扩展性，最终实现"极速开发+优化产物"的双重目标。</p>
<h3 data-id="heading-47"> </h3>
<p> </p>
<p> </p>
<h3 data-id="heading-48">五、Vite 7 核心源码解析</h3>
<p> </p>
<h4 data-id="heading-49">5.1、Vite 7 核心架构与源码组织</h4>
<p>Vite 7 延续 monorepo 结构（基于 pnpm workspace），核心代码集中于 <code>packages/vite</code> 目录，在保留“开发服务器+生产构建”双核心的基础上，新增 Rust 引擎适配层与环境抽象层，形成“四层架构”体系。</p>
<p> </p>
<h4 data-id="heading-50">5.2. 核心模块概览</h4>



































<table><thead><tr><th>模块路径</th><th>核心职责</th><th>关键技术 / 工具</th></tr></thead><tbody><tr><td>src/node/cli.ts</td><td>命令行入口，解析参数并分发命令</td><td>cac（命令行解析）</td></tr><tr><td>src/node/config/</td><td>配置解析与合并，支持多环境配置隔离</td><td>环境抽象 API</td></tr><tr><td>src/node/server/</td><td>开发服务器实现，集成 HMR 与中间件</td><td>connect、chokidar</td></tr><tr><td>src/node/build/</td><td>生产构建核心，支持 Rolldown/Rollup 双引擎</td><td>Rolldown（Rust）、Rollup 3</td></tr><tr><td>src/node/plugin/</td><td>插件系统，兼容 Rollup 插件并扩展新钩子</td><td>插件过滤 API（withFilter）</td></tr></tbody></table>
<p> </p>
<h4 data-id="heading-51">5.3. 核心数据结构升级</h4>
<p>●  <code>ModuleGraph</code>（<code>src/node/server/moduleGraph.ts</code>）：新增 Rust 引擎依赖追踪能力，支持 Rolldown 模块解析结果与 JS 模块图的双向同步，解决双引擎依赖分析不一致问题。</p>
<p>●  <code>BuilderContext</code>（<code>src/node/build/builderContext.ts</code>）：统一构建上下文，封装引擎选择、产物优化等核心逻辑，屏蔽 Rolldown 与 Rollup 的调用差异。</p>
<p>●  <code>Environment</code>（<code>src/node/env/index.ts</code>）：环境描述对象，定义目标运行时（浏览器/Node/边缘）、兼容性标准等属性，为多环境构建提供基础。</p>
<p> </p>
<p> </p>
<h4 data-id="heading-52">5.4、核心流程源码解析</h4>
<p>Vite 7 的核心突破集中于 Rolldown 构建流程、多环境适配场景，以下结合源码片段深度拆解。</p>
<h5 data-id="heading-53">5.4.1Rolldown 预构建优化</h5>
<p>Vite 7 支持通过 Rolldown 处理依赖预构建，替代部分 esbuild 功能，尤其在 CJS 转 ESM 场景下性能提升显著。预构建逻辑位于 <code>src/node/optimizer/rolldownDepPlugin.ts</code> 调用 Rust 接口处理依赖转换，产物存储于 <code>node_modules/.vite/deps</code>，并生成引擎兼容的缓存元数据。</p>
<p> </p>
<p>启动流程可视化</p>
<p><img src="" alt="" loading="lazy"/></p>
<p>源码part1 part2</p>
<h5 data-id="heading-54">5.4.2. 生产构建流程（<code>vite build</code>）—— Rolldown 核心适配</h5>
<p>生产构建是 Vite 7 性能革新的核心场景，默认提供 Rolldown 引擎选项（通过 <code>rolldown-vite</code> 包集成），构建速度较 Rollup 提升 3-7 倍，内存占用减少 40% 以上。</p>
<p> </p>
<p>关键步骤与源码</p>
<ol>
<li>rolldown打包逻辑 part3</li>
</ol>
<pre><code class="hljs language-csharp" lang="csharp">   <span class="hljs-comment">// src/node/build.ts 简化逻辑</span>
   <span class="hljs-function"><span class="hljs-keyword">async</span> function <span class="hljs-title">buildEnvironment</span>(<span class="hljs-params">environment</span>)</span> {
    <span class="hljs-comment">// 1. 创建一个新的ChunkMetadataMap实例，用于存储和管理构建过程中的chunk元数据</span>
<span class="hljs-keyword">const</span> chunkMetadataMap = <span class="hljs-keyword">new</span> ChunkMetadataMap()
 
<span class="hljs-comment">// 2. 解析Rolldown配置选项，将环境配置和chunk元数据映射传递给解析函数</span>
<span class="hljs-comment">// 注意变量名虽然是rollupOptions，但实际返回的是Rolldown的配置</span>
<span class="hljs-keyword">const</span> rollupOptions = resolveRolldownOptions(environment, chunkMetadataMap)
 
<span class="hljs-comment">// 3. 检查是否处于监视模式（watch mode）</span>
<span class="hljs-keyword">if</span> (options.watch) {
  <span class="hljs-comment">// 4. 在控制台输出信息，告知用户正在监视文件变化</span>
  logger.info(colors.cyan(`\nwatching <span class="hljs-keyword">for</span> file changes...`))
 
  <span class="hljs-comment">// 5. 解析输出目录，获取构建产物将被写入的目录路径</span>
  <span class="hljs-keyword">const</span> resolvedOutDirs = getResolvedOutDirs(
    root,
    options.outDir,
    options.rollupOptions.output,  <span class="hljs-comment">// 使用rollupOptions.output作为输出配置</span>
  )
  
  <span class="hljs-comment">// 6. 解析是否需要清空输出目录的设置</span>
  <span class="hljs-keyword">const</span> emptyOutDir = resolveEmptyOutDir(
    options.emptyOutDir,  <span class="hljs-comment">// 用户配置的emptyOutDir选项</span>
    root,
    resolvedOutDirs,      <span class="hljs-comment">// 解析后的输出目录</span>
    logger,
  )
  
  <span class="hljs-comment">// 7. 解析文件监视选项（Chokidar配置）</span>
  <span class="hljs-keyword">const</span> resolvedChokidarOptions = resolveChokidarOptions(
    {
      <span class="hljs-comment">// 8. 合并配置中的chokidar选项（虽然Rolldown没有这个选项，但为了向后兼容保留）</span>
      <span class="hljs-comment">// @ts-expect-error 标记：chokidar选项在rolldown中不存在，但为了向后兼容而使用</span>
      ...(rollupOptions.watch || {}).chokidar,
      <span class="hljs-comment">// @ts-expect-error 同样标记：用户配置的watch.chokidar选项</span>
      ...options.watch.chokidar,
    },
    resolvedOutDirs,      <span class="hljs-comment">// 输出目录</span>
    emptyOutDir,          <span class="hljs-comment">// 是否清空输出目录</span>
    environment.config.cacheDir,  <span class="hljs-comment">// 缓存目录</span>
  )
 
  <span class="hljs-comment">// 9. 动态导入rolldown的watch函数</span>
  <span class="hljs-keyword">const</span> { watch } = <span class="hljs-keyword">await</span> import(<span class="hljs-string">'rolldown'</span>)
  
  <span class="hljs-comment">// 10. 创建Rolldown的watcher实例，传入配置选项</span>
  <span class="hljs-keyword">const</span> watcher = watch({
    ...rollupOptions,  <span class="hljs-comment">// 基础构建配置</span>
    watch: {           <span class="hljs-comment">// 监视模式特定配置</span>
      ...rollupOptions.watch,  <span class="hljs-comment">// 合并原有watch配置</span>
      ...options.watch,        <span class="hljs-comment">// 合并用户提供的watch配置</span>
      <span class="hljs-comment">// 11. 将Chokidar配置转换为Rolldown的notify选项</span>
      notify: convertToNotifyOptions(resolvedChokidarOptions),
    },
  })
 
  <span class="hljs-comment">// 12. 监听watcher事件</span>
  watcher.<span class="hljs-keyword">on</span>(<span class="hljs-string">'event'</span>, (<span class="hljs-keyword">event</span>) =&gt; {
    <span class="hljs-comment">// 13. 当构建开始时的处理</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">event</span>.code === <span class="hljs-string">'BUNDLE_START'</span>) {
      logger.info(colors.cyan(`\nbuild started...`))  <span class="hljs-comment">// 输出构建开始信息</span>
      chunkMetadataMap.clearResetChunks()  <span class="hljs-comment">// 清除并重置chunk元数据</span>
    } 
    <span class="hljs-comment">// 14. 当构建结束时的处理</span>
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">event</span>.code === <span class="hljs-string">'BUNDLE_END'</span>) {
      <span class="hljs-keyword">event</span>.result.close()  <span class="hljs-comment">// 关闭构建结果，释放资源</span>
      logger.info(colors.cyan(`built <span class="hljs-keyword">in</span> ${<span class="hljs-keyword">event</span>.duration}ms.`))  <span class="hljs-comment">// 输出构建耗时</span>
    } 
    <span class="hljs-comment">// 15. 当发生错误时的处理</span>
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">event</span>.code === <span class="hljs-string">'ERROR'</span>) {
      <span class="hljs-keyword">const</span> e = <span class="hljs-keyword">event</span>.<span class="hljs-function">error
      <span class="hljs-title">enhanceRollupError</span>(<span class="hljs-params">e</span>)  <span class="hljs-comment">// 增强错误信息，使其更有用</span>
      <span class="hljs-title">clearLine</span>()  <span class="hljs-comment">// 清除控制台当前行</span>
      logger.<span class="hljs-title">error</span>(<span class="hljs-params">e.message, { error: e }</span>)  <span class="hljs-comment">// 输出错误信息</span>
    }
  })
 
  <span class="hljs-comment">// 16. 返回watcher实例，允许外部控制监视过程</span>
  <span class="hljs-keyword">return</span> watcher
}
 
<span class="hljs-comment">// 17. 非监视模式：使用rolldown进行单次构建</span>
<span class="hljs-comment">// write or generate files with rolldown</span>
<span class="hljs-keyword">const</span></span> { rolldown } = <span class="hljs-keyword">await</span> import(<span class="hljs-string">'rolldown'</span>)  <span class="hljs-comment">// 动态导入rolldown函数</span>
startTime = Date.now()  <span class="hljs-comment">// 记录构建开始时间</span>
 
<span class="hljs-comment">// 18. 使用配置创建rolldown实例</span>
bundle = <span class="hljs-keyword">await</span> rolldown(rollupOptions)
 
<span class="hljs-comment">// 19. 创建一个数组来存储构建输出结果</span>
<span class="hljs-keyword">const</span> res: RolldownOutput[] = []
 
<span class="hljs-comment">// 20. 遍历所有输出配置（可能有多个输出配置）</span>
<span class="hljs-keyword">for</span> (<span class="hljs-function"><span class="hljs-keyword">const</span> output of <span class="hljs-title">arraify</span>(<span class="hljs-params">rollupOptions.output!</span>))</span> {
  <span class="hljs-comment">// 21. 根据options.write决定是写入文件还是仅生成输出内容</span>
  <span class="hljs-comment">// 如果options.write为true则调用bundle.write()，否则调用bundle.generate()</span>
  res.push(<span class="hljs-keyword">await</span> bundle[options.write ? <span class="hljs-string">'write'</span> : <span class="hljs-string">'generate'</span>](output))
}
   }
</code></pre>
<ol start="3">
<li>性能优化关键点</li>
</ol>
<p>●  单一引擎架构：开发与生产环境统一使用 Rolldown 处理依赖解析与模块转换，避免双工具链的数据重复序列化/反序列化开销。</p>
<p>●  Oxc 工具集集成：替代 esbuild 处理代码解析与转译，内存使用效率提升显著，大型项目构建内存占用可减少 100 倍。</p>
<p> </p>
<h5 data-id="heading-55">5.4.3. 多环境适配流程（核心功能升级）</h5>
<p>Vite 7 稳定了多环境 API，支持浏览器、Node、边缘服务器等多运行时目标</p>
<p> </p>
<p>关键逻辑与源码通过代理将rollup转发到rolldown处理</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> setupRollupOptionCompat&lt;
  T <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Pick</span>&lt;<span class="hljs-title class_">BuildEnvironmentOptions</span>, <span class="hljs-string">'rollupOptions'</span> | <span class="hljs-string">'rolldownOptions'</span>&gt;,
&gt;(
  <span class="hljs-attr">buildConfig</span>: T,
): asserts buildConfig is T &amp; {
  <span class="hljs-attr">rolldownOptions</span>: <span class="hljs-title class_">Exclude</span>&lt;T[<span class="hljs-string">'rolldownOptions'</span>], <span class="hljs-literal">undefined</span>&gt;
} {
  <span class="hljs-comment">// if both rollupOptions and rolldownOptions are present,</span>
  <span class="hljs-comment">// ignore rollupOptions and use rolldownOptions</span>
   <span class="hljs-comment">// 如果同时存在rollupOptions和rolldownOptions，忽略rollupOptions</span>
  buildConfig.<span class="hljs-property">rolldownOptions</span> ??= buildConfig.<span class="hljs-property">rollupOptions</span>
 
  <span class="hljs-comment">// proxy rolldownOptions to rollupOptions</span>
  <span class="hljs-comment">// 通过代理将rollupOptions的访问转发到rolldownOptions</span>
  <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(buildConfig, <span class="hljs-string">'rollupOptions'</span>, {
    <span class="hljs-title function_">get</span>(<span class="hljs-params"/>) {
      <span class="hljs-keyword">return</span> buildConfig.<span class="hljs-property">rolldownOptions</span>
    },
    <span class="hljs-title function_">set</span>(<span class="hljs-params">newValue</span>) {
      buildConfig.<span class="hljs-property">rolldownOptions</span> = newValue
    },
    <span class="hljs-attr">configurable</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">enumerable</span>: <span class="hljs-literal">true</span>,
  })
}
 
</code></pre>
<p> </p>
<h4 data-id="heading-56">5.4、核心流程总览流程图</h4>
<p><img src="" alt="" loading="lazy"/></p>
<h4 data-id="heading-57">5.5、源码学习建议</h4>
<ol>
<li>
<p>入门路径：从 <code>vite dev</code> 启动流程切入，先理解 <code>createServer</code> 函数的整体逻辑，再深入中间件与模块图实现。</p>
</li>
<li>
<p>核心突破点：重点分析 <code>transformMiddleware</code> 如何实现按需编译，以及 <code>ModuleGraph</code> 如何维护依赖关系。</p>
</li>
<li>
<p>调试技巧：通过 <code>DEBUG=vite:* vite dev</code> 打印调试日志，追踪请求处理与 HMR 触发流程。</p>
</li>
</ol>
<p>4 . 拥抱ai 配合aiide做源码解析梳理核心流程细节</p>
<p>5 . 先脉络后细节</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[LangGraph智能体开发快速入门]]></title>    <link>https://juejin.cn/post/7574967214127808538</link>    <guid>https://juejin.cn/post/7574967214127808538</guid>    <pubDate>2025-11-21T08:54:47.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574967214127808538" data-draft-id="7574978545143775267" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="LangGraph智能体开发快速入门"/> <meta itemprop="keywords" content="LangChain,Agent,后端"/> <meta itemprop="datePublished" content="2025-11-21T08:54:47.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="FreeCode"/> <meta itemprop="url" content="https://juejin.cn/user/1282499717900794"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            LangGraph智能体开发快速入门
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1282499717900794/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    FreeCode
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T08:54:47.000Z" title="Fri Nov 21 2025 08:54:47 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="" data-highlight-key="agate">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#333;color:#fff}.hljs-name,.hljs-strong{font-weight:700}.hljs-code,.hljs-emphasis{font-style:italic}.hljs-tag{color:#62c8f3}.hljs-selector-class,.hljs-selector-id,.hljs-template-variable,.hljs-variable{color:#ade5fc}.hljs-bullet,.hljs-string{color:#a2fca2}.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-quote,.hljs-section,.hljs-title,.hljs-type{color:#ffa}.hljs-bullet,.hljs-number,.hljs-symbol{color:#d36363}.hljs-keyword,.hljs-literal,.hljs-selector-tag{color:#fcc28c}.hljs-code,.hljs-comment,.hljs-deletion{color:#888}.hljs-link,.hljs-regexp{color:#c6b4f0}.hljs-meta{color:#fc9b9b}.hljs-deletion{background-color:#fc9b9b;color:#333}.hljs-addition{background-color:#a2fca2;color:#333}.hljs a{color:inherit}.hljs a:focus,.hljs a:hover{color:inherit;text-decoration:underline}</style><h2 data-id="heading-0">一、 初识LangGraph</h2>
<p>LangGraph受到诸多引领智能体（agent）未来发展的企业信赖，包括 Klarna、Replit、Elastic等。 它是一款底层编排框架与运行时环境，用于构建、管理和部署长期运行的有状态智能体。
LangGraph属于底层的工具，它专注于智能体编排所需的核心底层能力，包括持久化执行（durable execution）、流式处理（streaming）、人机协同（human-in-the-loop）等。</p>
<p><strong>示例:</strong></p>
<p>安装：
pip install -U langgraph
示例代码：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> langgraph.graph <span class="hljs-keyword">import</span> StateGraph, MessagesState, START, END

<span class="hljs-keyword">def</span> <span class="hljs-title function_">mock_llm</span>(<span class="hljs-params">state: MessagesState</span>):
    <span class="hljs-keyword">return</span> {<span class="hljs-string">"messages"</span>: [{<span class="hljs-string">"role"</span>: <span class="hljs-string">"ai"</span>, <span class="hljs-string">"content"</span>: <span class="hljs-string">"hello world"</span>}]}

graph = StateGraph(MessagesState)
graph.add_node(mock_llm)
graph.add_edge(START, <span class="hljs-string">"mock_llm"</span>)
graph.add_edge(<span class="hljs-string">"mock_llm"</span>, END)
graph = graph.<span class="hljs-built_in">compile</span>()

graph.invoke({<span class="hljs-string">"messages"</span>: [{<span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>: <span class="hljs-string">"hi!"</span>}]})
</code></pre>
<h2 data-id="heading-1">二、核心优势</h2>
<p>LangGraph为所有长期运行的有状态工作流或智能体（agent）提供底层支持架构。LangGraph不封装提示词（prompts）或架构，其核心优势如下：</p>
<ul>
<li>持久化执行（Durable execution）：构建可跨故障持续运行的智能体，支持长时间执行，且能从中断处恢复任务进度。</li>
<li>人机协同（Human-in-the-loop）：支持在任意节点检查和修改智能体状态，从而融入人工监督环节。</li>
<li>全面的记忆能力（Comprehensive memory）：打造有状态智能体，既具备用于实时推理的短期工作记忆，也拥有跨会话的长期记忆。</li>
<li>借助LangSmith调试（Debugging with LangSmith）：通过可视化工具深入洞察复杂智能体的行为 —— 这些工具可追踪执行路径、捕捉状态转换，并提供详细的运行时指标。</li>
<li>可投入生产环境的部署（Production-ready deployment）：依托为应对有状态、长期运行工作流特有挑战而设计的可扩展架构，放心部署复杂的智能体系统。</li>
</ul>
<h2 data-id="heading-2">三、LangGraph生态系统</h2>
<p>LangGraph既可独立使用，也能与任意LangChain产品无缝集成，为开发者提供构建智能体（agent）所需的全套工具。若需提升大语言模型（LLM）应用的开发效率，可将LangGraph与以下工具搭配使用：</p>
<ul>
<li>LangSmith—— 助力智能体评估（agent evals）与可观测性（observability）。可用于调试性能不佳的 LLM 应用运行过程、评估智能体执行轨迹（agent trajectories）、掌握生产环境中的运行状态，并逐步优化性能。</li>
<li>LangGraph（平台服务）—— 借助专为长期运行的有状态工作流设计的部署平台，轻松实现智能体的部署与扩展。支持跨团队发现、复用、配置及共享智能体，还可通过Studio中的可视化原型设计快速迭代。</li>
<li>LangChain—— 提供各类集成能力与可组合组件，简化LLM应用开发流程。其包含基于LangGraph构建的智能体抽象层。</li>
</ul>
<h2 data-id="heading-3">四、LangGraph v1</h2>
<p>LangGraph v1 是一款聚焦智能体运行时（agent runtime）稳定性的版本。该版本保留了核心图 API（graph APIs）与执行模型的原有设计，同时优化了类型安全性（type safety）、文档（docs）以及开发者使用体验（developer ergonomics）。</p>
<p>LangGraph v1 旨在与 LangChain v1 版本协同工作 ——LangChain v1 的 create_agent 功能正是基于 LangGraph 构建 —— 因此，你既可以从高层级抽象开始开发，也能在需要时深入到细粒度控制层面。</p>
<p>下表列出了 LangGraph v1 中所有已弃用的项目：</p>

















































<table><thead><tr><th>已弃用项目（Deprecated item）</th><th>替代方案（Alternative）</th></tr></thead><tbody><tr><td>create_react_agent</td><td>langchain.agents.create_agent</td></tr><tr><td>AgentState</td><td>langchain.agents.AgentState</td></tr><tr><td>AgentStatePydantic</td><td>langchain.agents.AgentState（不再有 Pydantic 状态，no more pydantic state）</td></tr><tr><td>AgentStateWithStructuredResponse</td><td>langchain.agents.AgentState</td></tr><tr><td>AgentStateWithStructuredResponsePydantic</td><td>langchain.agents.AgentState（不再有 Pydantic 状态，no more pydantic state）</td></tr><tr><td>HumanInterruptConfig</td><td>langchain.agents.middleware.human_in_the_loop.InterruptOnConfig</td></tr><tr><td>HumanInterrupt</td><td>langchain.agents.middleware.human_in_the_loop.InterruptOnConfig</td></tr><tr><td>ActionRequest</td><td>langchain.agents.middleware.human_in_the_loop.HITLRequest</td></tr><tr><td>ValidationNode</td><td>工具会自动验证输入</td></tr><tr><td>MessageGraph</td><td>带有 messages 键的 StateGraph，类似 create_agent 所提供的</td></tr></tbody></table>
<h2 data-id="heading-4">五、构建智能体</h2>
<p>LangGraph 提供两种方式构建智能体：Graph API 和 Functional API）</p>
<ul>
<li>若你倾向于将智能体定义为由节点（nodes）和边（edges）构成的图结构，可使用图 API（Graph API）。</li>
<li>若你倾向于将智能体定义为单个函数，可使用函数式 API（Functional API）。</li>
</ul>
<h3 data-id="heading-5">5.1  Graph API构建智能体</h3>
<h4 data-id="heading-6">1. 定义工具与模型</h4>
<p>在本示例中，我们将使用 Claude Sonnet 4.5 模型，并定义用于加法、乘法和除法运算的工具。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> langchain.tools <span class="hljs-keyword">import</span> tool
<span class="hljs-keyword">from</span> langchain.chat_models <span class="hljs-keyword">import</span> init_chat_model
<span class="hljs-keyword">from</span> config <span class="hljs-keyword">import</span> api_key, api_base

model = init_chat_model(
        api_key = api_key,
        base_url = api_base,
        model = <span class="hljs-string">"Qwen/Qwen3-8B"</span>,
        model_provider = <span class="hljs-string">"openai"</span>,
        temperature = <span class="hljs-number">0</span>,
)

<span class="hljs-comment"># Define tools</span>
<span class="hljs-meta">@tool</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">multiply</span>(<span class="hljs-params">a: <span class="hljs-built_in">int</span>, b: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-built_in">int</span>:
    <span class="hljs-string">"""Multiply `a` and `b`.

    Args:
        a: First int
        b: Second int
    """</span>
    <span class="hljs-keyword">return</span> a * b

<span class="hljs-meta">@tool</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">a: <span class="hljs-built_in">int</span>, b: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-built_in">int</span>:
    <span class="hljs-string">"""Adds `a` and `b`.

    Args:
        a: First int
        b: Second int
    """</span>
    <span class="hljs-keyword">return</span> a + b

<span class="hljs-meta">@tool</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">divide</span>(<span class="hljs-params">a: <span class="hljs-built_in">int</span>, b: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-built_in">float</span>:
    <span class="hljs-string">"""Divide `a` and `b`.

    Args:
        a: First int
        b: Second int
    """</span>
    <span class="hljs-keyword">return</span> a / b

<span class="hljs-comment"># Augment the LLM with tools</span>
tools = [add, multiply, divide]
tools_by_name = {tool.name: tool <span class="hljs-keyword">for</span> tool <span class="hljs-keyword">in</span> tools}
model_with_tools = model.bind_tools(tools)
</code></pre>
<h4 data-id="heading-7">2. 定义状态</h4>
<p>图的状态用于存储消息（messages）和大语言模型（LLM）调用次数。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> langchain.messages <span class="hljs-keyword">import</span> AnyMessage
<span class="hljs-keyword">from</span> typing_extensions <span class="hljs-keyword">import</span> TypedDict, Annotated
<span class="hljs-keyword">import</span> operator

<span class="hljs-keyword">class</span> <span class="hljs-title class_">MessagesState</span>(<span class="hljs-title class_ inherited__">TypedDict</span>):
    messages: Annotated[<span class="hljs-built_in">list</span>[AnyMessage], operator.add]
    llm_calls: <span class="hljs-built_in">int</span>
</code></pre>
<h4 data-id="heading-8">3. 定义模型节点</h4>
<p>模型节点用于调用大语言模型（LLM），并判断是否需要调用工具。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> langchain.messages <span class="hljs-keyword">import</span> SystemMessage

<span class="hljs-keyword">def</span> <span class="hljs-title function_">llm_call</span>(<span class="hljs-params">state: <span class="hljs-built_in">dict</span></span>):
    <span class="hljs-string">"""LLM decides whether to call a tool or not"""</span>

    <span class="hljs-keyword">return</span> {
        <span class="hljs-string">"messages"</span>: [
            model_with_tools.invoke(
                [
                    SystemMessage(
                        content=<span class="hljs-string">"You are a helpful assistant tasked with performing arithmetic on a set of inputs."</span>
                    )
                ]
                + state[<span class="hljs-string">"messages"</span>]
            )
        ],
        <span class="hljs-string">"llm_calls"</span>: state.get(<span class="hljs-string">'llm_calls'</span>, <span class="hljs-number">0</span>) + <span class="hljs-number">1</span>
    }
</code></pre>
<h4 data-id="heading-9">4. 定义工具节点</h4>
<p>工具节点用于调用工具并返回结果。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> langchain.messages <span class="hljs-keyword">import</span> ToolMessage

<span class="hljs-keyword">def</span> <span class="hljs-title function_">tool_node</span>(<span class="hljs-params">state: <span class="hljs-built_in">dict</span></span>):
    <span class="hljs-string">"""Performs the tool call"""</span>

    result = []
    <span class="hljs-keyword">for</span> tool_call <span class="hljs-keyword">in</span> state[<span class="hljs-string">"messages"</span>][-<span class="hljs-number">1</span>].tool_calls:
        tool = tools_by_name[tool_call[<span class="hljs-string">"name"</span>]]
        observation = tool.invoke(tool_call[<span class="hljs-string">"args"</span>])
        result.append(ToolMessage(content=observation, tool_call_id=tool_call[<span class="hljs-string">"id"</span>]))
    <span class="hljs-keyword">return</span> {<span class="hljs-string">"messages"</span>: result}
</code></pre>
<h4 data-id="heading-10">5. 定义结束逻辑</h4>
<p>条件边函数（conditional edge function）用于根据大语言模型（LLM）是否发起了工具调用来决定路由至工具节点（tool node）或进入结束状态。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">Literal</span>
<span class="hljs-keyword">from</span> langgraph.graph <span class="hljs-keyword">import</span> StateGraph, START, END

<span class="hljs-keyword">def</span> <span class="hljs-title function_">should_continue</span>(<span class="hljs-params">state: MessagesState</span>) -&gt; <span class="hljs-type">Literal</span>[<span class="hljs-string">"tool_node"</span>, END]:
    <span class="hljs-string">"""Decide if we should continue the loop or stop based upon whether the LLM made a tool call"""</span>

    messages = state[<span class="hljs-string">"messages"</span>]
    last_message = messages[-<span class="hljs-number">1</span>]

    <span class="hljs-comment"># If the LLM makes a tool call, then perform an action</span>
    <span class="hljs-keyword">if</span> last_message.tool_calls:
        <span class="hljs-keyword">return</span> <span class="hljs-string">"tool_node"</span>

    <span class="hljs-comment"># Otherwise, we stop (reply to the user)</span>
    <span class="hljs-keyword">return</span> END
</code></pre>
<h4 data-id="heading-11">6. 构建并编译智能体</h4>
<p>智能体通过 StateGraph 类构建，并使用 compile 方法进行编译。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># Build workflow</span>
agent_builder = StateGraph(MessagesState)

<span class="hljs-comment"># Add nodes</span>
agent_builder.add_node(<span class="hljs-string">"llm_call"</span>, llm_call)
agent_builder.add_node(<span class="hljs-string">"tool_node"</span>, tool_node)

<span class="hljs-comment"># Add edges to connect nodes</span>
agent_builder.add_edge(START, <span class="hljs-string">"llm_call"</span>)
agent_builder.add_conditional_edges(
    <span class="hljs-string">"llm_call"</span>,
    should_continue,
    [<span class="hljs-string">"tool_node"</span>, END]
)
agent_builder.add_edge(<span class="hljs-string">"tool_node"</span>, <span class="hljs-string">"llm_call"</span>)

<span class="hljs-comment"># Compile the agent</span>
agent = agent_builder.<span class="hljs-built_in">compile</span>()

<span class="hljs-comment"># Show the agent</span>
<span class="hljs-keyword">from</span> IPython.display <span class="hljs-keyword">import</span> Image, display
display(Image(agent.get_graph(xray=<span class="hljs-literal">True</span>).draw_mermaid_png()))

<span class="hljs-comment"># Invoke</span>
<span class="hljs-keyword">from</span> langchain.messages <span class="hljs-keyword">import</span> HumanMessage
messages = [HumanMessage(content=<span class="hljs-string">"Add 3 and 4."</span>)]
messages = agent.invoke({<span class="hljs-string">"messages"</span>: messages})
<span class="hljs-keyword">for</span> m <span class="hljs-keyword">in</span> messages[<span class="hljs-string">"messages"</span>]:
    m.pretty_print()
</code></pre>
<h3 data-id="heading-12">5.2 Functional API构建智能体</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># Step 1: Define tools and model</span>

<span class="hljs-keyword">from</span> langchain.tools <span class="hljs-keyword">import</span> tool
<span class="hljs-keyword">from</span> langchain.chat_models <span class="hljs-keyword">import</span> init_chat_model
<span class="hljs-keyword">from</span> config <span class="hljs-keyword">import</span> api_key, api_base

model = init_chat_model(
        api_key = api_key,
        base_url = api_base,
        model = <span class="hljs-string">"Qwen/Qwen3-8B"</span>,
        model_provider = <span class="hljs-string">"openai"</span>,
        temperature = <span class="hljs-number">0</span>,
)

<span class="hljs-comment"># Define tools</span>
<span class="hljs-meta">@tool</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">multiply</span>(<span class="hljs-params">a: <span class="hljs-built_in">int</span>, b: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-built_in">int</span>:
    <span class="hljs-string">"""Multiply `a` and `b`.

    Args:
        a: First int
        b: Second int
    """</span>
    <span class="hljs-keyword">return</span> a * b

<span class="hljs-meta">@tool</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">a: <span class="hljs-built_in">int</span>, b: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-built_in">int</span>:
    <span class="hljs-string">"""Adds `a` and `b`.

    Args:
        a: First int
        b: Second int
    """</span>
    <span class="hljs-keyword">return</span> a + b

<span class="hljs-meta">@tool</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">divide</span>(<span class="hljs-params">a: <span class="hljs-built_in">int</span>, b: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-built_in">float</span>:
    <span class="hljs-string">"""Divide `a` and `b`.

    Args:
        a: First int
        b: Second int
    """</span>
    <span class="hljs-keyword">return</span> a / b

<span class="hljs-comment"># Augment the LLM with tools</span>
tools = [add, multiply, divide]
tools_by_name = {tool.name: tool <span class="hljs-keyword">for</span> tool <span class="hljs-keyword">in</span> tools}
model_with_tools = model.bind_tools(tools)

<span class="hljs-keyword">from</span> langgraph.graph <span class="hljs-keyword">import</span> add_messages
<span class="hljs-keyword">from</span> langchain.messages <span class="hljs-keyword">import</span> (
    SystemMessage,
    HumanMessage,
    ToolCall,
)
<span class="hljs-keyword">from</span> langchain_core.messages <span class="hljs-keyword">import</span> BaseMessage
<span class="hljs-keyword">from</span> langgraph.func <span class="hljs-keyword">import</span> entrypoint, task

<span class="hljs-comment"># Step 2: Define model node</span>

<span class="hljs-meta">@task</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">call_llm</span>(<span class="hljs-params">messages: <span class="hljs-built_in">list</span>[BaseMessage]</span>):
    <span class="hljs-string">"""LLM decides whether to call a tool or not"""</span>
    <span class="hljs-keyword">return</span> model_with_tools.invoke(
        [
            SystemMessage(
                content=<span class="hljs-string">"You are a helpful assistant tasked with performing arithmetic on a set of inputs."</span>
            )
        ]
        + messages
    )

<span class="hljs-comment"># Step 3: Define tool node</span>

<span class="hljs-meta">@task</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">call_tool</span>(<span class="hljs-params">tool_call: ToolCall</span>):
    <span class="hljs-string">"""Performs the tool call"""</span>
    tool = tools_by_name[tool_call[<span class="hljs-string">"name"</span>]]
    <span class="hljs-keyword">return</span> tool.invoke(tool_call)

<span class="hljs-comment"># Step 4: Define agent</span>

<span class="hljs-meta">@entrypoint()</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">agent</span>(<span class="hljs-params">messages: <span class="hljs-built_in">list</span>[BaseMessage]</span>):
    model_response = call_llm(messages).result()

    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> model_response.tool_calls:
            <span class="hljs-keyword">break</span>

        <span class="hljs-comment"># Execute tools</span>
        tool_result_futures = [
            call_tool(tool_call) <span class="hljs-keyword">for</span> tool_call <span class="hljs-keyword">in</span> model_response.tool_calls
        ]
        tool_results = [fut.result() <span class="hljs-keyword">for</span> fut <span class="hljs-keyword">in</span> tool_result_futures]
        messages = add_messages(messages, [model_response, *tool_results])
        model_response = call_llm(messages).result()

    messages = add_messages(messages, model_response)
    <span class="hljs-keyword">return</span> messages

<span class="hljs-comment"># Invoke</span>
messages = [HumanMessage(content=<span class="hljs-string">"Add 3 and 4."</span>)]
<span class="hljs-keyword">for</span> chunk <span class="hljs-keyword">in</span> agent.stream(messages, stream_mode=<span class="hljs-string">"updates"</span>):
    <span class="hljs-built_in">print</span>(chunk)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"\n"</span>)
</code></pre>
<h2 data-id="heading-13">六、总结</h2>
<p>本文带领大家快速认识LangGraph，了解它的优势和生态系统，以及V1.0版本的变化。文章还介绍了LangGraph构建智能体的两种方式Graph API和Functional API。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>