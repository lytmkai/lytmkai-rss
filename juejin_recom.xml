<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>掘金文章推荐</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>一个帮助开发者成长的社区</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[布隆过滤器能解决什么问题？]]></title>    <link>https://juejin.cn/post/7596245612557369353</link>    <guid>https://juejin.cn/post/7596245612557369353</guid>    <pubDate>2026-01-18T11:09:38.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7596245612557369353" data-draft-id="7596299957277917211" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="布隆过滤器能解决什么问题？"/> <meta itemprop="keywords" content="Redis"/> <meta itemprop="datePublished" content="2026-01-18T11:09:38.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="三水不滴"/> <meta itemprop="url" content="https://juejin.cn/user/283045639753100"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            布隆过滤器能解决什么问题？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/283045639753100/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    三水不滴
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-18T11:09:38.000Z" title="Sun Jan 18 2026 11:09:38 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    9
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">布隆过滤器的原理及解决方案</h2>
<p>在海量数据处理场景中，我们经常会面临一个核心问题：<strong>如何快速判断一个元素是否存在于一个集合中</strong>？传统的哈希表、数据库查询等方案，在数据量达到亿级甚至十亿级时，会面临存储空间不足、查询效率低下的瓶颈。而布隆过滤器（Bloom Filter）作为一种空间效率极高的概率型数据结构，能够以极小的空间开销和时间复杂度，高效解决这类 “存在性查询” 问题。</p>
<h3 data-id="heading-1">一、布隆过滤器是什么？（What）</h3>
<p>布隆过滤器是由 Burton Howard Bloom 在 1970 年提出的一种<strong>概率型数据结构</strong>，它的核心作用是 <strong>快速判断一个元素是否属于某个集合</strong>，具有两大显著特点：</p>
<ol>
<li><strong>高效性</strong>：查询和插入的时间复杂度均为 O(k)（k 为哈希函数的个数），与集合大小无关；空间复杂度仅为 O(n)，远低于传统数据结构。</li>
<li><strong>概率性</strong>：布隆过滤器存在<strong>假阳性（False Positive）</strong> —— 可能误判一个不存在的元素 “存在”；但<strong>绝对不会出现假阴性（False Negative）</strong> —— 只要元素确实存在，一定能判断出来。</li>
<li><strong>不支持删除</strong>：传统布隆过滤器一旦插入元素，无法直接删除，因为删除一个元素会影响其他元素的判断（多个元素可能共享同一个哈希位）。</li>
</ol>
<h4 data-id="heading-2">核心组成</h4>
<p>一个布隆过滤器本质上由三部分构成：</p>
<ul>
<li><strong>二进制位数组（Bit Array）</strong> ：长度为 m，初始时所有位都置为 0。</li>
<li><strong>多个独立的哈希函数（Hash Functions）</strong> ：数量为 k，每个哈希函数能将输入元素映射到位数组的一个索引位置。</li>
<li><strong>插入 / 查询算法</strong>：通过哈希函数的映射结果操作位数组，实现元素的添加和存在性判断。</li>
</ul>
<h3 data-id="heading-3">二、为什么需要布隆过滤器？（Why）</h3>
<p>在实际业务中，布隆过滤器的诞生完全是为了解决<strong>传统方案的痛点</strong>，我们可以通过对比来看它的价值：</p>





























<table><thead><tr><th>方案</th><th>优点</th><th>缺点</th><th>适用场景</th></tr></thead><tbody><tr><td>哈希表（HashMap）</td><td>查询准确，支持删除</td><td>空间开销大，数据量大时内存占用极高</td><td>中小规模数据集合</td></tr><tr><td>数据库查询</td><td>持久化，支持复杂查询</td><td>磁盘 IO 耗时，高并发下性能瓶颈明显</td><td>结构化数据的持久化存储</td></tr><tr><td>布隆过滤器</td><td>空间效率极高，查询快</td><td>存在假阳性，不支持直接删除</td><td>海量数据的存在性预查询</td></tr></tbody></table>
<h4 data-id="heading-4">典型痛点场景</h4>
<ol>
<li><strong>缓存穿透</strong>：当用户查询一个不存在于缓存和数据库中的数据时，请求会直接穿透到数据库，高并发下可能压垮数据库。布隆过滤器可以预先存储缓存中存在的 key，拦截不存在的 key，避免缓存穿透。</li>
<li><strong>海量数据去重</strong>：比如爬虫去重（判断 URL 是否已经爬取过）、日志去重，传统方案存储所有 URL 会占用大量内存，布隆过滤器仅需极小空间即可实现。</li>
<li><strong>分布式系统成员判断</strong>：比如分布式缓存中判断某个节点是否存在、分布式文件系统中判断文件是否存在，无需跨节点查询，提升效率。</li>
</ol>
<h3 data-id="heading-5">三、布隆过滤器的工作原理（How）</h3>
<p>布隆过滤器的核心操作只有两个：<strong>插入元素</strong> 和 <strong>查询元素</strong>，其原理基于哈希函数的映射和二进制位的标记。</p>
<h4 data-id="heading-6">1. 插入元素的流程</h4>
<p>假设我们有一个长度为 m 的二进制位数组，以及 k 个独立的哈希函数 h1​,h2​,...,hk​，插入元素 x 的步骤如下：</p>
<ol>
<li>将元素 x 依次传入 k 个哈希函数，得到 k 个哈希值 h1​(x),h2​(x),...,hk​(x)。</li>
<li>将这 k 个哈希值对位数组长度 m 取模，得到 k 个索引位置 i1​,i2​,...,ik​。</li>
<li>将位数组中这 k 个索引位置的位全部置为 1。</li>
</ol>
<p><strong>示例</strong>：插入元素 <code>user123</code>，假设 k=3，哈希后得到索引 2、5、7，则位数组的第 2、5、7 位被置为 1。</p>
<h4 data-id="heading-7">2. 查询元素的流程</h4>
<p>判断元素 y 是否存在于集合中，步骤如下：</p>
<ol>
<li>
<p>将元素 y 依次传入 k 个哈希函数，得到 k 个哈希值，取模后得到 k 个索引位置。</p>
</li>
<li>
<p>检查位数组中这 k 个索引位置的位是否<strong>全部为 1</strong>：</p>
<ul>
<li>如果<strong>有任意一个位为 0</strong> → 元素 y <strong>一定不存在</strong>于集合中。</li>
<li>如果<strong>所有位都为 1</strong> → 元素 y <strong>可能存在</strong>于集合中（存在假阳性）。</li>
</ul>
</li>
</ol>
<h4 data-id="heading-8">3. 假阳性的根源</h4>
<p>假阳性的本质是 <strong>哈希碰撞</strong>：不同的元素经过哈希函数映射后，可能会产生相同的索引位置，导致位数组的同一批位被置为 1。当查询一个不存在的元素时，恰好它的所有哈希索引位都被其他元素置为 1，就会误判为 “存在”。</p>
<p>假阳性的概率与三个参数密切相关：</p>
<ul>
<li>位数组长度 m：m 越大，假阳性概率越低。</li>
<li>哈希函数个数 k：k 存在一个最优值，过多或过少都会提高假阳性概率。</li>
<li>集合中元素个数 n：n 越大，假阳性概率越高。</li>
</ul>
<p>最优哈希函数个数公式：k=nm​ln2≈0.693nm​最小假阳性概率公式：p≈(1−e−mkn​)k</p>
<h3 data-id="heading-9">四、布隆过滤器的核心解决方案</h3>
<p>布隆过滤器的价值在于<strong>用极小的空间成本解决海量数据的存在性查询问题</strong>，针对不同的业务痛点，它有明确的解决方案：</p>
<h4 data-id="heading-10">1. 解决缓存穿透问题</h4>
<p><strong>问题本质</strong>：恶意请求或不存在的 key 频繁穿透缓存，直接访问数据库，导致数据库压力过大。<strong>解决方案</strong>：</p>
<ol>
<li>
<p>初始化一个布隆过滤器，将缓存中所有的 key 插入其中。</p>
</li>
<li>
<p>当用户发起查询请求时，<strong>先通过布隆过滤器判断 key 是否存在</strong>：</p>
<ul>
<li>如果布隆过滤器判断不存在 → 直接返回 “不存在”，无需查询缓存和数据库。</li>
<li>如果布隆过滤器判断存在 → 再依次查询缓存、数据库，正常返回结果。<strong>优势</strong>：拦截所有不存在的 key，将数据库的查询压力降到最低；布隆过滤器内存占用极小，即使缓存有百万、千万级 key，也仅需几 MB 内存。</li>
</ul>
</li>
</ol>
<h4 data-id="heading-11">2. 解决海量数据去重问题</h4>
<p><strong>问题本质</strong>：比如爬虫系统需要判断 URL 是否已爬取，若存储所有已爬取的 URL，会占用大量内存（一个 URL 平均占 50 字节，1 亿 URL 需 5GB 内存）。<strong>解决方案</strong>：</p>
<ol>
<li>
<p>初始化布隆过滤器，设置合适的 m 和 k（根据预期的 URL 数量和可接受的假阳性概率计算）。</p>
</li>
<li>
<p>爬取 URL 时，先查询布隆过滤器：</p>
<ul>
<li>如果判断已存在 → 跳过该 URL。</li>
<li>如果判断不存在 → 爬取该 URL，并将其插入布隆过滤器。<strong>优势</strong>：1 亿 URL 若用布隆过滤器存储，仅需约 100MB 内存，空间效率提升 50 倍以上；查询和插入速度极快，不影响爬虫效率。</li>
</ul>
</li>
</ol>
<h4 data-id="heading-12">3. 优化分布式系统查询</h4>
<p><strong>问题本质</strong>：分布式系统中，判断一个元素是否存在于某个节点，需要跨节点通信，耗时较长。<strong>解决方案</strong>：</p>
<ol>
<li>
<p>在每个节点本地部署一个布隆过滤器，存储该节点的核心数据标识（如用户 ID、文件 ID）。</p>
</li>
<li>
<p>当需要查询元素时，<strong>先通过本地布隆过滤器判断元素是否可能在该节点</strong>：</p>
<ul>
<li>如果判断不存在 → 直接跳过该节点，查询其他节点。</li>
<li>如果判断存在 → 再发起跨节点请求，查询具体数据。<strong>优势</strong>：减少无效的跨节点通信，降低网络延迟，提升分布式系统的查询效率。</li>
</ul>
</li>
</ol>
<h3 data-id="heading-13">五、布隆过滤器的进阶方案：解决 “不支持删除” 的痛点</h3>
<p>传统布隆过滤器的最大缺陷是<strong>不支持删除</strong>，为了解决这个问题，业界衍生出了两种进阶方案：</p>
<h4 data-id="heading-14">1. 计数布隆过滤器（Counting Bloom Filter）</h4>
<p><strong>核心改进</strong>：将二进制位数组替换为 <strong>计数数组</strong>（每个位置存储一个整数，而非 0/1）。</p>
<ul>
<li><strong>插入元素</strong>：将对应索引位置的计数值加 1。</li>
<li><strong>删除元素</strong>：将对应索引位置的计数值减 1（需保证计数值≥0）。</li>
<li><strong>查询元素</strong>：判断对应索引位置的计数值是否均大于 0。<strong>缺点</strong>：计数数组的空间开销高于二进制位数组，且仍存在假阳性问题。</li>
</ul>
<h4 data-id="heading-15">2. 布谷鸟过滤器（Cuckoo Filter）</h4>
<p><strong>核心思想</strong>：基于布谷鸟哈希算法，使用<strong>指纹存储</strong>和<strong>两个哈希函数</strong>，支持高效的插入、查询和删除操作。</p>
<ul>
<li><strong>优势</strong>：删除操作高效，假阳性概率低于布隆过滤器，空间利用率更高。</li>
<li><strong>缺点</strong>：插入操作可能出现 “哈希冲突链”，需要重新哈希或扩容，实现复杂度高于布隆过滤器。</li>
</ul>
<h3 data-id="heading-16">六、布隆过滤器的实战应用场景</h3>
<ol>
<li><strong>Redis 缓存穿透防护</strong>：Redis 4.0 及以上版本支持布隆过滤器插件（RedisBloom），可以直接集成到 Redis 中，用于拦截不存在的 key。</li>
<li><strong>大数据去重</strong>：Hadoop、Spark 等大数据框架中，常用布隆过滤器进行数据去重和关联分析。</li>
<li><strong>浏览器恶意 URL 检测</strong>：浏览器内置布隆过滤器，存储恶意 URL 的哈希值，快速判断用户访问的 URL 是否安全。</li>
<li><strong>分布式文件系统</strong>：如 HDFS，使用布隆过滤器判断文件块是否存在，避免无效的磁盘 IO。</li>
</ol>
<h3 data-id="heading-17">七、布隆过滤器的使用注意事项</h3>
<ol>
<li><strong>合理设置参数</strong>：根据预期的元素数量 n 和可接受的假阳性概率 p，计算最优的位数组长度 m 和哈希函数个数 k，避免参数不合理导致假阳性概率过高或空间浪费。</li>
<li><strong>容忍假阳性</strong>：布隆过滤器的假阳性是无法完全避免的，业务中需要<strong>容忍一定的假阳性率</strong>，或在后续流程中增加验证步骤（如缓存穿透场景中，布隆过滤器判断存在后，仍需查询缓存确认）。</li>
<li><strong>选择合适的哈希函数</strong>：哈希函数需要满足<strong>均匀分布</strong>的特性，避免哈希结果集中在位数组的某一部分，常用的哈希函数有 MurmurHash、FnvHash 等。</li>
</ol>
<h3 data-id="heading-18">八、总结</h3>
<p>布隆过滤器是一种<strong>空间效率极高的概率型数据结构</strong>，它以 “允许一定的假阳性” 为代价，换来了远超传统数据结构的空间和时间效率。在海量数据处理场景中，布隆过滤器是解决 “存在性查询” 问题的最优方案之一，尤其适用于缓存穿透防护、数据去重、分布式系统查询优化等场景。</p>
<p>同时，我们也需要认识到布隆过滤器的局限性，针对 “不支持删除” 的痛点，可以选择计数布隆过滤器或布谷鸟过滤器作为进阶方案。在实际应用中，只要合理设置参数、结合业务场景进行优化，布隆过滤器就能发挥出最大的价值。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[从原理到实战深入理解 MySQL分库分表]]></title>    <link>https://juejin.cn/post/7596299957278048283</link>    <guid>https://juejin.cn/post/7596299957278048283</guid>    <pubDate>2026-01-18T11:43:11.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7596299957278048283" data-draft-id="7595895132261417011" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="从原理到实战深入理解 MySQL分库分表"/> <meta itemprop="keywords" content="数据库"/> <meta itemprop="datePublished" content="2026-01-18T11:43:11.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="三水不滴"/> <meta itemprop="url" content="https://juejin.cn/user/283045639753100"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            从原理到实战深入理解 MySQL分库分表
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/283045639753100/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    三水不滴
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-18T11:43:11.000Z" title="Sun Jan 18 2026 11:43:11 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">MySQL 分库分表：从原理到实战</h2>
<p>在互联网高并发、大数据量的业务场景下，单库单表的存储模式会面临性能瓶颈 —— 数据量达到千万级后，磁盘 IO、索引查询、事务处理的效率会急剧下降。<strong>分库分表</strong>是解决这一问题的核心方案，它通过将数据分散存储到多个数据库或数据表中，提升系统的吞吐量和可用性。</p>
<p>本文将从 <strong>What-Why-How</strong> 三个维度深度解析 MySQL 分库分表，结合实战案例代码，帮助开发者理解并落地这一技术方案。</p>
<h3 data-id="heading-1">一、什么是分库分表？</h3>
<p>分库分表是<strong>水平拆分</strong>和<strong>垂直拆分</strong>的统称，本质是将单一数据库或数据表的数据，按照特定规则分散到多个物理节点上，从而降低单节点的数据压力。</p>
<h4 data-id="heading-2">1. 垂直拆分</h4>
<p>垂直拆分是按照<strong>业务维度</strong>进行拆分，核心思想是 "<strong>专库专用</strong>"。</p>
<ul>
<li><strong>垂直分库</strong>：将一个包含多业务模块的数据库，拆分为多个独立数据库。例如，电商系统可拆分为用户库、订单库、商品库。</li>
<li><strong>垂直分表</strong>：将一个字段繁多的表，拆分为多个结构简单的表。例如，用户表 <code>t_user</code> 可拆分为基础信息表 <code>t_user_base</code> 和详情信息表 <code>t_user_ext</code>。</li>
</ul>
<p><strong>适用场景</strong>：表中字段过多，部分字段访问频率低，或不同字段归属不同业务模块。<strong>优势</strong>：业务隔离，便于维护；降低单表字段数量，提升查询效率。<strong>缺点</strong>：无法解决单表数据量过大的问题。</p>
<h4 data-id="heading-3">2. 水平拆分</h4>
<p>水平拆分是按照<strong>数据维度</strong>进行拆分，核心思想是 "<strong>数据分片</strong>"。</p>
<ul>
<li><strong>水平分库</strong>：将一个表的数据分散到多个数据库的相同表结构中。例如，订单表 <code>t_order</code> 拆分为 <code>db_order_0</code> 到 <code>db_order_3</code> 四个库，每个库都有 <code>t_order</code> 表。</li>
<li><strong>水平分表</strong>：将一个表的数据分散到同一个数据库的多个表中。例如，订单表 <code>t_order</code> 拆分为 <code>t_order_0</code> 到 <code>t_order_7</code> 八个表。</li>
</ul>
<p><strong>适用场景</strong>：单表数据量巨大（千万级以上），查询和写入性能瓶颈明显。<strong>优势</strong>：突破单表数据量上限，提升并发读写能力。<strong>缺点</strong>：引入分布式事务、跨分片查询等复杂问题。</p>
<h3 data-id="heading-4">二、为什么需要分库分表？</h3>
<p>单库单表的性能瓶颈主要体现在以下几个方面，分库分表是解决这些问题的必经之路：</p>
<ol>
<li><strong>磁盘 IO 瓶颈</strong>：单表数据量过大，查询时需要扫描大量数据页，磁盘随机 IO 耗时严重。</li>
<li><strong>索引性能瓶颈</strong>：索引文件随数据量增大而膨胀，B+ 树高度增加，查询时的磁盘 IO 次数增多。</li>
<li><strong>锁竞争瓶颈</strong>：高并发下，单表的行锁、表锁竞争激烈，导致事务等待时间过长。</li>
<li><strong>运维成本瓶颈</strong>：单库数据量过大，备份、恢复、扩容的时间成本极高，甚至影响业务可用性。</li>
</ol>
<p><strong>核心目标</strong>：提升系统的<strong>并发承载能力</strong>和<strong>数据存储能力</strong>，保障业务稳定运行。</p>
<h3 data-id="heading-5">三、分库分表的核心方案</h3>
<h4 data-id="heading-6">1. 分片规则</h4>
<p>分片规则是分库分表的核心，决定了数据如何分配到不同的分片节点。常用的分片规则有以下几种：</p>








































<table><thead><tr><th>分片规则</th><th>原理</th><th>适用场景</th><th>优点</th><th>缺点</th></tr></thead><tbody><tr><td><strong>范围分片</strong></td><td>按数据的范围区间划分，例如按订单创建时间 <code>create_time</code> 分为 2024 年、2025 年分片</td><td>时间序列数据，如订单、日志</td><td>规则简单，便于扩容</td><td>数据热点问题，新分片可能集中承载大量写入</td></tr><tr><td><strong>哈希分片</strong></td><td>对分片键（如 <code>user_id</code>）进行哈希计算，取模后映射到分片</td><td>用户 ID、订单 ID 等均匀分布的数据</td><td>数据分布均匀，避免热点</td><td>扩容时需要迁移数据，复杂度高</td></tr><tr><td><strong>列表分片</strong></td><td>按分片键的枚举值划分，例如按省份 <code>province</code> 分为北京、上海、广东分片</td><td>数据具有明确枚举属性的场景</td><td>规则直观，便于业务隔离</td><td>分片数量固定，扩展灵活度低</td></tr><tr><td><strong>复合分片</strong></td><td>组合多种规则，例如先按时间范围分片，再按用户 ID 哈希分片</td><td>复杂业务场景，如海量订单系统</td><td>兼顾多种规则的优势</td><td>规则复杂，维护成本高</td></tr></tbody></table>
<h4 data-id="heading-7">2. 分片键选择</h4>
<p>分片键是决定数据分片的字段，<strong>选择合适的分片键是分库分表的关键</strong>，需遵循以下原则：</p>
<ul>
<li>优先选择<strong>查询频率高</strong>的字段，例如订单表的 <code>user_id</code>、<code>order_id</code>。</li>
<li>避免选择<strong>更新频繁</strong>的字段，防止数据迁移。</li>
<li>保证数据分布<strong>均匀</strong>，避免出现 "数据倾斜"。</li>
</ul>
<h3 data-id="heading-8">四、实战案例：基于 Sharding-JDBC 实现分库分表</h3>
<p>Sharding-JDBC 是一款轻量级的分库分表框架，它基于 JDBC 层实现，无需独立部署中间件，对业务代码侵入性低，是开发者首选的分库分表方案。</p>
<h4 data-id="heading-9">1. 环境准备</h4>
<h5 data-id="heading-10">（1）技术栈</h5>
<ul>
<li>框架：Spring Boot 2.7.x</li>
<li>分库分表中间件：Sharding-JDBC 5.3.2</li>
<li>数据库：MySQL 8.0</li>
<li>依赖管理：Maven</li>
</ul>
<h5 data-id="heading-11">（2）Maven 依赖</h5>
<p>在 <code>pom.xml</code> 中引入核心依赖：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- Spring Boot Web --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- MyBatis Plus --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.baomidou<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.5.3.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- Sharding-JDBC --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.shardingsphere<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>shardingsphere-jdbc-core-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.3.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- MySQL 驱动 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.mysql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mysql-connector-j<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>runtime<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- Lombok --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.projectlombok<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>lombok<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">optional</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">optional</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>
</code></pre>
<h4 data-id="heading-12">2. 需求场景</h4>
<p>以电商<strong>订单系统</strong>为例，实现以下目标：</p>
<ul>
<li>按 <code>user_id</code> 进行<strong>水平分库</strong>：分为 2 个库 <code>db_order_0</code>、<code>db_order_1</code>。</li>
<li>按 <code>order_id</code> 进行<strong>水平分表</strong>：每个库中分为 4 个表 <code>t_order_0</code>-<code>t_order_3</code>。</li>
<li>分片规则：<code>user_id % 2 = 库索引</code>，<code>order_id % 4 = 表索引</code>。</li>
</ul>
<h4 data-id="heading-13">3. 数据库准备</h4>
<p>创建 2 个分库，每个库创建 4 个分表，表结构完全一致。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 创建分库 db_order_0</span>
<span class="hljs-keyword">CREATE</span> DATABASE IF <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> db_order_0 <span class="hljs-keyword">DEFAULT</span> <span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> utf8mb4;
<span class="hljs-comment">-- 创建分库 db_order_1</span>
<span class="hljs-keyword">CREATE</span> DATABASE IF <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> db_order_1 <span class="hljs-keyword">DEFAULT</span> <span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> utf8mb4;

<span class="hljs-comment">-- 切换到 db_order_0</span>
USE db_order_0;
<span class="hljs-comment">-- 创建订单分表 t_order_0</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> t_order_0 (
    order_id <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">PRIMARY</span> KEY COMMENT <span class="hljs-string">'订单ID'</span>,
    user_id <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'用户ID'</span>,
    order_amount <span class="hljs-type">DECIMAL</span>(<span class="hljs-number">10</span>,<span class="hljs-number">2</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'订单金额'</span>,
    create_time DATETIME <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'创建时间'</span>
) ENGINE<span class="hljs-operator">=</span>InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8mb4;

<span class="hljs-comment">-- 同理，在 db_order_0 创建 t_order_1、t_order_2、t_order_3</span>
<span class="hljs-comment">-- 在 db_order_1 中创建 t_order_0、t_order_1、t_order_2、t_order_3</span>
</code></pre>
<h4 data-id="heading-14">4. 配置 Sharding-JDBC</h4>
<p>在 <code>application.yml</code> 中配置数据源、分片规则、主键生成策略等核心参数：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">spring:</span>
  <span class="hljs-comment"># Sharding-JDBC 配置</span>
  <span class="hljs-attr">shardingsphere:</span>
    <span class="hljs-comment"># 数据源配置</span>
    <span class="hljs-attr">datasource:</span>
      <span class="hljs-comment"># 数据源名称列表</span>
      <span class="hljs-attr">names:</span> <span class="hljs-string">db_order_0,db_order_1</span>
      <span class="hljs-comment"># 配置 db_order_0 数据源</span>
      <span class="hljs-attr">db_order_0:</span>
        <span class="hljs-attr">type:</span> <span class="hljs-string">com.zaxxer.hikari.HikariDataSource</span>
        <span class="hljs-attr">driver-class-name:</span> <span class="hljs-string">com.mysql.cj.jdbc.Driver</span>
        <span class="hljs-attr">jdbc-url:</span> <span class="hljs-string">jdbc:mysql://localhost:3306/db_order_0?useSSL=false&amp;serverTimezone=UTC&amp;allowPublicKeyRetrieval=true</span>
        <span class="hljs-attr">username:</span> <span class="hljs-string">root</span>
        <span class="hljs-attr">password:</span> <span class="hljs-string">root</span>
      <span class="hljs-comment"># 配置 db_order_1 数据源</span>
      <span class="hljs-attr">db_order_1:</span>
        <span class="hljs-attr">type:</span> <span class="hljs-string">com.zaxxer.hikari.HikariDataSource</span>
        <span class="hljs-attr">driver-class-name:</span> <span class="hljs-string">com.mysql.cj.jdbc.Driver</span>
        <span class="hljs-attr">jdbc-url:</span> <span class="hljs-string">jdbc:mysql://localhost:3306/db_order_1?useSSL=false&amp;serverTimezone=UTC&amp;allowPublicKeyRetrieval=true</span>
        <span class="hljs-attr">username:</span> <span class="hljs-string">root</span>
        <span class="hljs-attr">password:</span> <span class="hljs-string">root</span>
    <span class="hljs-comment"># 规则配置</span>
    <span class="hljs-attr">rules:</span>
      <span class="hljs-attr">sharding:</span>
        <span class="hljs-comment"># 分片算法配置</span>
        <span class="hljs-attr">sharding-algorithms:</span>
          <span class="hljs-comment"># 分库算法：基于 user_id 取模</span>
          <span class="hljs-attr">db-mod-algorithm:</span>
            <span class="hljs-attr">type:</span> <span class="hljs-string">INLINE</span>
            <span class="hljs-attr">props:</span>
              <span class="hljs-attr">algorithm-expression:</span> <span class="hljs-string">db_order_${user_id</span> <span class="hljs-string">%</span> <span class="hljs-number">2</span><span class="hljs-string">}</span>
          <span class="hljs-comment"># 分表算法：基于 order_id 取模</span>
          <span class="hljs-attr">table-mod-algorithm:</span>
            <span class="hljs-attr">type:</span> <span class="hljs-string">INLINE</span>
            <span class="hljs-attr">props:</span>
              <span class="hljs-attr">algorithm-expression:</span> <span class="hljs-string">t_order_${order_id</span> <span class="hljs-string">%</span> <span class="hljs-number">4</span><span class="hljs-string">}</span>
        <span class="hljs-comment"># 表规则配置</span>
        <span class="hljs-attr">tables:</span>
          <span class="hljs-comment"># 逻辑表名称</span>
          <span class="hljs-attr">t_order:</span>
            <span class="hljs-comment"># 数据节点：分库.分表</span>
            <span class="hljs-attr">actual-data-nodes:</span> <span class="hljs-string">db_order_${0..1}.t_order_${0..3}</span>
            <span class="hljs-comment"># 分库策略</span>
            <span class="hljs-attr">database-strategy:</span>
              <span class="hljs-attr">standard:</span>
                <span class="hljs-attr">sharding-column:</span> <span class="hljs-string">user_id</span>
                <span class="hljs-attr">sharding-algorithm-name:</span> <span class="hljs-string">db-mod-algorithm</span>
            <span class="hljs-comment"># 分表策略</span>
            <span class="hljs-attr">table-strategy:</span>
              <span class="hljs-attr">standard:</span>
                <span class="hljs-attr">sharding-column:</span> <span class="hljs-string">order_id</span>
                <span class="hljs-attr">sharding-algorithm-name:</span> <span class="hljs-string">table-mod-algorithm</span>
            <span class="hljs-comment"># 主键生成策略</span>
            <span class="hljs-attr">key-generate-strategy:</span>
              <span class="hljs-attr">column:</span> <span class="hljs-string">order_id</span>
              <span class="hljs-attr">key-generator-name:</span> <span class="hljs-string">snowflake</span>
        <span class="hljs-comment"># 主键生成器</span>
        <span class="hljs-attr">key-generators:</span>
          <span class="hljs-attr">snowflake:</span>
            <span class="hljs-attr">type:</span> <span class="hljs-string">SNOWFLAKE</span>
    <span class="hljs-comment"># 属性配置</span>
    <span class="hljs-attr">props:</span>
      <span class="hljs-comment"># 打印 SQL 语句，便于调试</span>
      <span class="hljs-attr">sql-show:</span> <span class="hljs-literal">true</span>
<span class="hljs-comment"># MyBatis Plus 配置</span>
<span class="hljs-attr">mybatis-plus:</span>
  <span class="hljs-attr">mapper-locations:</span> <span class="hljs-string">classpath:mapper/*.xml</span>
  <span class="hljs-attr">type-aliases-package:</span> <span class="hljs-string">com.example.sharding.entity</span>
  <span class="hljs-attr">configuration:</span>
    <span class="hljs-attr">map-underscore-to-camel-case:</span> <span class="hljs-literal">true</span>
    <span class="hljs-attr">log-impl:</span> <span class="hljs-string">org.apache.ibatis.logging.stdout.StdOutImpl</span>
</code></pre>
<h4 data-id="heading-15">5. 业务代码实现</h4>
<h5 data-id="heading-16">（1）实体类 <code>Order.java</code></h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.sharding.entity;

<span class="hljs-keyword">import</span> com.baomidou.mybatisplus.annotation.TableName;
<span class="hljs-keyword">import</span> lombok.Data;
<span class="hljs-keyword">import</span> java.math.BigDecimal;
<span class="hljs-keyword">import</span> java.util.Date;

<span class="hljs-meta">@Data</span>
<span class="hljs-meta">@TableName("t_order")</span> <span class="hljs-comment">// 对应逻辑表名称</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Order</span> {
    <span class="hljs-comment">/**
     * 订单ID，雪花算法生成
     */</span>
    <span class="hljs-keyword">private</span> Long orderId;
    <span class="hljs-comment">/**
     * 用户ID，分库键
     */</span>
    <span class="hljs-keyword">private</span> Long userId;
    <span class="hljs-comment">/**
     * 订单金额
     */</span>
    <span class="hljs-keyword">private</span> BigDecimal orderAmount;
    <span class="hljs-comment">/**
     * 创建时间
     */</span>
    <span class="hljs-keyword">private</span> Date createTime;
}
</code></pre>
<h5 data-id="heading-17">（2）Mapper 接口 <code>OrderMapper.java</code></h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.sharding.mapper;

<span class="hljs-keyword">import</span> com.baomidou.mybatisplus.core.mapper.BaseMapper;
<span class="hljs-keyword">import</span> com.example.sharding.entity.Order;
<span class="hljs-keyword">import</span> org.apache.ibatis.annotations.Mapper;

<span class="hljs-meta">@Mapper</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">OrderMapper</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseMapper</span>&lt;Order&gt; {
}
</code></pre>
<h5 data-id="heading-18">（3）Service 层 <code>OrderService.java</code></h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.sharding.service;

<span class="hljs-keyword">import</span> com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;
<span class="hljs-keyword">import</span> com.example.sharding.entity.Order;
<span class="hljs-keyword">import</span> com.example.sharding.mapper.OrderMapper;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Service;
<span class="hljs-keyword">import</span> java.util.Date;

<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderService</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ServiceImpl</span>&lt;OrderMapper, Order&gt; {

    <span class="hljs-comment">/**
     * 创建订单
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">createOrder</span><span class="hljs-params">(Long userId, Double amount)</span> {
        <span class="hljs-type">Order</span> <span class="hljs-variable">order</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Order</span>();
        order.setUserId(userId);
        order.setOrderAmount(BigDecimal.valueOf(amount));
        order.setCreateTime(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());
        <span class="hljs-keyword">return</span> save(order);
    }
}
</code></pre>
<h5 data-id="heading-19">（4）Controller 层 <code>OrderController.java</code></h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.sharding.controller;

<span class="hljs-keyword">import</span> com.example.sharding.service.OrderService;
<span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.GetMapping;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestParam;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RestController;

<span class="hljs-meta">@RestController</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderController</span> {

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> OrderService orderService;

    <span class="hljs-comment">/**
     * 测试创建订单接口
     */</span>
    <span class="hljs-meta">@GetMapping("/order/create")</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">createOrder</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam</span> Long userId, <span class="hljs-meta">@RequestParam</span> Double amount)</span> {
        <span class="hljs-type">boolean</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> orderService.createOrder(userId, amount);
        <span class="hljs-keyword">return</span> result ? <span class="hljs-string">"订单创建成功"</span> : <span class="hljs-string">"订单创建失败"</span>;
    }
}
</code></pre>
<h4 data-id="heading-20">6. 测试验证</h4>
<p>启动 Spring Boot 项目，调用接口进行测试：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 测试 user_id=1（模2=1，对应 db_order_1）</span>
curl <span class="hljs-string">"http://localhost:8080/order/create?userId=1&amp;amount=100.0"</span>
<span class="hljs-comment"># 测试 user_id=2（模2=0，对应 db_order_0）</span>
curl <span class="hljs-string">"http://localhost:8080/order/create?userId=2&amp;amount=200.0"</span>
</code></pre>
<p>查看控制台打印的 SQL 语句，可以看到 Sharding-JDBC 自动路由到了对应的分库分表：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- user_id=1 时，路由到 db_order_1.t_order_x</span>
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> t_order_1 (order_id, user_id, order_amount, create_time) <span class="hljs-keyword">VALUES</span> (?, ?, ?, ?)
<span class="hljs-comment">-- user_id=2 时，路由到 db_order_0.t_order_y</span>
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> t_order_2 (order_id, user_id, order_amount, create_time) <span class="hljs-keyword">VALUES</span> (?, ?, ?, ?)
</code></pre>
<h3 data-id="heading-21">四、分库分表的核心问题与解决方案</h3>
<p>分库分表虽然解决了性能瓶颈，但也引入了分布式场景下的复杂问题，以下是常见问题及应对方案：</p>
<h4 data-id="heading-22">1. 分布式事务问题</h4>
<p><strong>问题</strong>：跨库操作时，无法保证事务的 ACID 特性，例如用户下单时需要同时操作订单库和库存库。<strong>解决方案</strong>：</p>
<ul>
<li><strong>柔性事务</strong>：采用最终一致性方案，如 <strong>Seata</strong> 的 TCC、SAGA 模式。</li>
<li><strong>本地消息表</strong>：基于消息队列实现事务补偿，保证数据最终一致。</li>
</ul>
<h4 data-id="heading-23">2. 跨分片查询问题</h4>
<p><strong>问题</strong>：按非分片键查询时，需要扫描所有分片，性能低下。<strong>解决方案</strong>：</p>
<ul>
<li><strong>二次查询</strong>：先按分片键查询得到数据分布，再精准查询对应分片。</li>
<li><strong>引入中间件</strong>：使用 Elasticsearch 构建全局索引，通过 ES 先检索数据所在分片，再查询 MySQL。</li>
<li><strong>业务优化</strong>：尽量避免非分片键的查询，设计业务时优先使用分片键作为查询条件。</li>
</ul>
<h4 data-id="heading-24">3. 数据迁移与扩容问题</h4>
<p><strong>问题</strong>：哈希分片扩容时，数据分布规则改变，需要迁移大量数据。<strong>解决方案</strong>：</p>
<ul>
<li><strong>预分片</strong>：提前规划足够的分片数量，例如按 1024 个分片预分配，初期只使用部分分片。</li>
<li><strong>一致性哈希</strong>：使用一致性哈希算法，减少扩容时的数据迁移量。</li>
<li><strong>使用专业工具</strong>：如 ShardingSphere 的数据迁移工具、阿里云 DTS 等。</li>
</ul>
<h4 data-id="heading-25">4. 读写分离结合</h4>
<p><strong>问题</strong>：分库分表后，读压力依然较大。<strong>解决方案</strong>：</p>
<ul>
<li>结合<strong>主从复制</strong>，实现读写分离：主库负责写入，从库负责查询。</li>
<li>Sharding-JDBC 支持读写分离配置，可直接在 <code>application.yml</code> 中配置主从数据源。</li>
</ul>
<h3 data-id="heading-26">五、分库分表的最佳实践</h3>
<ol>
<li><strong>优先垂直拆分，再水平拆分</strong>：垂直拆分成本低、风险小，先通过垂直拆分隔离业务，当单表数据量达到千万级再进行水平拆分。</li>
<li><strong>分片键的选择至关重要</strong>：优先选择查询频率高、数据分布均匀的字段，避免使用时间等易产生热点的字段。</li>
<li><strong>避免过度拆分</strong>：拆分粒度越细，运维复杂度越高，需根据业务规模合理规划分片数量。</li>
<li><strong>监控与运维</strong>：部署分片监控工具，实时监控各分片的负载情况；定期备份数据，制定容灾方案。</li>
</ol>
<h3 data-id="heading-27">六、总结</h3>
<p>分库分表是解决 MySQL 性能瓶颈的核心方案，但它不是 "银弹"—— 它带来了复杂度的提升，需要开发者在性能和复杂度之间做权衡。</p>
<p>在实际项目中，应遵循 "<strong>业务驱动技术</strong>" 的原则：先通过索引优化、SQL 优化、缓存优化等手段提升性能，当这些手段无法满足需求时，再考虑分库分表。</p>
<p>本文提供的 Sharding-JDBC 案例代码，可直接用于项目开发，开发者可根据实际业务场景调整分片规则和配置。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Undertow：高性能Java Web服务器]]></title>    <link>https://juejin.cn/post/7596307289724911658</link>    <guid>https://juejin.cn/post/7596307289724911658</guid>    <pubDate>2026-01-18T12:36:02.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7596307289724911658" data-draft-id="7596230910212980779" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Undertow：高性能Java Web服务器"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-18T12:36:02.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="鲁大波浪"/> <meta itemprop="url" content="https://juejin.cn/user/2010377827388311"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Undertow：高性能Java Web服务器
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2010377827388311/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    鲁大波浪
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-18T12:36:02.000Z" title="Sun Jan 18 2026 12:36:02 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">引言：为何选择Undertow？</h2>
<p>在Java Web容器的世界里，除了大众熟知的Tomcat和Jetty，还有一款性能“炸裂”的后起之秀——Undertow。作为Red Hat开发的高性能Web服务器，Undertow以其<strong>轻量级、高性能和灵活性</strong>成为WildFly应用服务器的默认Web容器，并被Spring Boot官方纳为默认支持的三大嵌入式容器之一。</p>
<p>与传统Web服务器相比，Undertow的优势如同<strong>智能手机相对于功能手机</strong>的进化：更小的资源占用、更快的响应速度和更强的并发处理能力。今天我们一起全面解析这款高性能服务器。</p>
<h2 data-id="heading-1">一、Undertow核心特性解析</h2>
<h3 data-id="heading-2">1.1 轻量级设计</h3>
<p>Undertow的核心jar包仅<strong>不到1MB</strong>，简单嵌入式服务器运行时只需<strong>少于4MB的堆空间</strong>。这种极致轻量化使其特别适合<strong>微服务架构</strong>和<strong>资源受限环境</strong>。</p>
<h3 data-id="heading-3">1.2 高性能非阻塞IO</h3>
<p>Undertow基于<strong>XNIO框架</strong>构建，采用完全非阻塞的IO模型。其线程模型巧妙区分<strong>IO线程</strong>和<strong>工作线程</strong>：IO线程专司网络通信，实现高并发连接；工作线程处理业务逻辑，避免阻塞。</p>
<h3 data-id="heading-4">1.3 灵活的组合式架构</h3>
<p>Undertow采用独特的<strong>组合式架构</strong>，可以通过链式处理器灵活配置功能。这就像<strong>乐高积木</strong>，只需按需组合小型处理器，就能构建满足特定需求的Web服务器。</p>
<h3 data-id="heading-5">1.4 全面协议支持</h3>
<p>Undertow支持<strong>HTTP/1.1、HTTP/2、WebSocket</strong>等多种协议，提供完整的<strong>Servlet 4.0</strong>支持，同时允许混合使用Servlet和原生非阻塞处理程序。</p>
<h2 data-id="heading-6">二、快速入门：构建第一个Undertow服务器</h2>
<p>以下是一个最简单的Undertow服务器示例，只需几行代码就能启动一个HTTP服务：</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-keyword">import</span> io.undertow.Undertow;
<span class="hljs-keyword">import</span> io.undertow.util.Headers;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HelloWorldServer</span> {
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">final</span> <span class="hljs-type">String</span>[] args)</span> </span>{
        Undertow server = Undertow.<span class="hljs-built_in">builder</span>()
                .<span class="hljs-built_in">addHttpListener</span>(<span class="hljs-number">8080</span>, <span class="hljs-string">"localhost"</span>)
                .<span class="hljs-built_in">setHandler</span>(exchange -&gt; {
                    exchange.<span class="hljs-built_in">getResponseHeaders</span>().<span class="hljs-built_in">put</span>(Headers.CONTENT_TYPE, <span class="hljs-string">"text/plain"</span>);
                    exchange.<span class="hljs-built_in">getResponseSender</span>().<span class="hljs-built_in">send</span>(<span class="hljs-string">"Hello World!"</span>);
                }).<span class="hljs-built_in">build</span>();
        server.<span class="hljs-built_in">start</span>();
    }
}
</code></pre>
<p>此代码启动了一个监听8080端口的服务器，对所有请求返回“Hello World!”。</p>
<h2 data-id="heading-7">三、Undertow架构深度解析</h2>
<h3 data-id="heading-8">3.1 核心架构组件</h3>
<p>Undertow的架构分为三个关键层次：</p>
<ul>
<li><strong>XNIO层</strong>：提供底层非阻塞IO抽象</li>
<li><strong>Web服务器层</strong>：处理HTTP协议解析</li>
<li><strong>Servlet容器层</strong>：实现Servlet规范</li>
</ul>
<h3 data-id="heading-9">3.2 内存管理优化</h3>
<p>Undertow使用<strong>直接内存(Direct Buffers)</strong> ​ 和<strong>缓冲池技术</strong>，大幅减少GC压力。与Tomcat使用堆内存不同，Undertow的零拷贝技术使其能直接访问内核空间，提升IO效率。</p>
<h3 data-id="heading-10">3.3 性能对比实测</h3>
<p>根据性能测试数据，Undertow在不同并发场景下相比Tomcat有显著提升：</p>























<table><thead><tr><th>并发用户数</th><th>Tomcat QPS</th><th>Undertow QPS</th><th>性能提升</th></tr></thead><tbody><tr><td>100</td><td>1,200</td><td>1,800</td><td>+50%</td></tr><tr><td>1000</td><td>3,500</td><td>6,200</td><td>+77%</td></tr></tbody></table>
<p>在响应时间方面，Undertow的P99延迟(150ms)比Tomcat(350ms)降低了57%。</p>
<h2 data-id="heading-11">四、Spring Boot集成实战</h2>
<p>在Spring Boot中使用Undertow非常简单，只需排除Tomcat并添加Undertow依赖：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">exclusions</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">exclusion</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-tomcat<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">exclusion</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">exclusions</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-undertow<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>
</code></pre>
<p>应用配置示例：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">server:</span>
  <span class="hljs-attr">undertow:</span>
    <span class="hljs-attr">buffer-size:</span> <span class="hljs-number">1024</span>
    <span class="hljs-attr">direct-buffers:</span> <span class="hljs-literal">true</span>
    <span class="hljs-attr">threads:</span>
      <span class="hljs-attr">io:</span> <span class="hljs-number">8</span>
      <span class="hljs-attr">worker:</span> <span class="hljs-number">256</span>
    <span class="hljs-attr">max-http-post-size:</span> <span class="hljs-number">-1</span>
</code></pre>
<h2 data-id="heading-12">五、性能调优与生产实践</h2>
<h3 data-id="heading-13">5.1 关键参数调优</h3>
<ul>
<li><strong>buffer-size</strong>：缓冲区大小，影响IO性能（推荐512-1024）</li>
<li><strong>io-threads</strong>：IO线程数，建议设置为CPU核心数</li>
<li><strong>worker-threads</strong>：工作线程数，根据业务阻塞程度调整</li>
</ul>
<h3 data-id="heading-14">5.2 监控与诊断</h3>
<p>集成Spring Boot Actuator监控Undertow状态：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">management:</span>
  <span class="hljs-attr">endpoints:</span>
    <span class="hljs-attr">web:</span>
      <span class="hljs-attr">exposure:</span>
        <span class="hljs-attr">include:</span> <span class="hljs-string">health,metrics,undertow</span>
</code></pre>
<p>关键监控指标包括：请求处理统计、连接数、收发字节数等。</p>
<h2 data-id="heading-15">六、适用场景与总结</h2>
<p>Undertow特别适用于以下场景：</p>
<ol>
<li><strong>高并发微服务架构</strong></li>
<li><strong>资源受限的容器环境</strong></li>
<li><strong>需要低延迟响应的实时应用</strong></li>
<li><strong>WebSocket和HTTP/2密集型应用</strong></li>
</ol>
<p>相比之下，Tomcat在稳定性、社区资源和学习材料方面仍有优势，适合传统企业应用。</p>
<p>Undertow如同Java Web服务器领域的“<strong>疾风骑士</strong>”，以其轻量、高效和灵活的特性，为现代云原生应用提供了卓越的解决方案。无论是初学者还是资深架构师，了解并掌握Undertow都将为技术栈增添一款强大的性能利器。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[MyBatis 与 Spring Boot 集成的自定义自动配置启动器，学习如何自定义Starter]]></title>    <link>https://juejin.cn/post/7596171325532569641</link>    <guid>https://juejin.cn/post/7596171325532569641</guid>    <pubDate>2026-01-18T12:37:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7596171325532569641" data-draft-id="7596171325532553257" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="MyBatis 与 Spring Boot 集成的自定义自动配置启动器，学习如何自定义Starter"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-18T12:37:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="左Python右Java"/> <meta itemprop="url" content="https://juejin.cn/user/4107431173952525"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            MyBatis 与 Spring Boot 集成的自定义自动配置启动器，学习如何自定义Starter
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4107431173952525/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    左Python右Java
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-18T12:37:46.000Z" title="Sun Jan 18 2026 12:37:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    11
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">dmybatis-spring-boot-starter</h2>
<p>一个简化 MyBatis 与 Spring Boot 集成的自定义自动配置启动器</p>
<h3 data-id="heading-1">项目介绍</h3>
<p>该项目提供了一个简化的 MyBatis 与 Spring Boot 集成方案，通过自动配置减少开发者的配置工作，实现开箱即用的 MyBatis 集成体验。</p>
<h3 data-id="heading-2">功能特点</h3>
<ul>
<li>✅ 自动配置 SqlSessionFactoryBean</li>
<li>✅ 自动扫描 Mapper 接口并注册为 Spring Bean</li>
<li>✅ 支持自定义 Mapper 扫描包</li>
<li>✅ 与 Spring Boot 无缝集成</li>
</ul>
<h3 data-id="heading-3">依赖要求</h3>
<ul>
<li>Java 8+</li>
<li>Spring Boot 3.0+</li>
<li>MyBatis 3.5+</li>
</ul>
<h3 data-id="heading-4">使用方法</h3>
<h4 data-id="heading-5">1. 添加依赖</h4>
<p>在你的 Spring Boot 项目中添加以下依赖：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.oak<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>dmybatis-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<h4 data-id="heading-6">2. 配置数据源</h4>
<p>在 <code>application.properties</code> 或 <code>application.yml</code> 中配置你的数据源：</p>
<pre><code class="hljs language-properties" lang="properties">spring.datasource.url=jdbc:mysql://localhost:3306/mydb
spring.datasource.username=root
spring.datasource.password=password
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver
</code></pre>
<h4 data-id="heading-7">3. 创建 Mapper 接口</h4>
<p>在你的项目中创建 Mapper 接口，并使用 <code>@Mapper</code> 注解标记：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.mapper;

<span class="hljs-keyword">import</span> org.apache.ibatis.annotations.Mapper;
<span class="hljs-keyword">import</span> org.apache.ibatis.annotations.Select;
<span class="hljs-keyword">import</span> com.example.entity.User;

<span class="hljs-meta">@Mapper</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserMapper</span> {
    
    <span class="hljs-meta">@Select("SELECT * FROM user WHERE id = #{id}")</span>
    User <span class="hljs-title function_">findById</span><span class="hljs-params">(Long id)</span>;
}
</code></pre>
<h4 data-id="heading-8">4. 注入并使用 Mapper</h4>
<p>在你的 Service 或 Controller 中直接注入并使用 Mapper 接口：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.service;

<span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Service;
<span class="hljs-keyword">import</span> com.example.mapper.UserMapper;
<span class="hljs-keyword">import</span> com.example.entity.User;

<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> UserMapper userMapper;
    
    <span class="hljs-keyword">public</span> User <span class="hljs-title function_">getUserById</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-keyword">return</span> userMapper.findById(id);
    }
}
</code></pre>
<h3 data-id="heading-9">配置说明</h3>
<p>该启动器提供了以下可配置项：</p>




















<table><thead><tr><th>配置项</th><th>描述</th><th>默认值</th></tr></thead><tbody><tr><td><code>mybatis.mapper-locations</code></td><td>Mapper XML 文件位置</td><td><code>classpath*:mapper/**/*.xml</code></td></tr><tr><td><code>mybatis.type-aliases-package</code></td><td>实体类包路径</td><td>自动扫描启动类所在包</td></tr></tbody></table>
<h3 data-id="heading-10">项目结构</h3>
<pre><code class="hljs language-bash" lang="bash">spring-code/
├── dmybatis-spring-boot-autoconfigure/  <span class="hljs-comment"># 自动配置模块</span>
│   └── src/main/java/org/oak/config/
│       └── MyBatisAutoConfig.java       <span class="hljs-comment"># 核心配置类</span>
├── dmybatis-spring-boot-starter/         <span class="hljs-comment"># 启动器模块</span>
├── README.md                             <span class="hljs-comment"># 项目说明文档</span>
└── LICENSE                               <span class="hljs-comment"># 许可证文件</span>
</code></pre>
<h3 data-id="heading-11">代码链接</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Ftree_boss%2Fspring-code.git" target="_blank" title="https://gitee.com/tree_boss/spring-code.git" ref="nofollow noopener noreferrer">gitee.com/tree_boss/s…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[堆栈到底是数据类型还是硬件结构？]]></title>    <link>https://juejin.cn/post/7596245612557500425</link>    <guid>https://juejin.cn/post/7596245612557500425</guid>    <pubDate>2026-01-18T12:44:01.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7596245612557500425" data-draft-id="7596245612557402121" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="堆栈到底是数据类型还是硬件结构？"/> <meta itemprop="keywords" content="C++"/> <meta itemprop="datePublished" content="2026-01-18T12:44:01.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="cahoho"/> <meta itemprop="url" content="https://juejin.cn/user/1470480625172570"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            堆栈到底是数据类型还是硬件结构？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1470480625172570/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    cahoho
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-18T12:44:01.000Z" title="Sun Jan 18 2026 12:44:01 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>所有的正在运行的程序都在内存条（RAM）中运行，其中内存的最小单元是字节（最小可寻址单位）。因此，所有概念上的堆栈等，应当建立在内存条这一硬件之上进行讨论。<br/>
内存条（DRAM）出厂时，只是一大块均匀的、无结构的<strong>存储单元</strong>。它并没有被明确的画好哪里是队列，哪里是堆，哪里是栈。就像一张白纸，上面没有预先画好的格子。因此，堆栈并没有真真正正的物理硬件结构。但应当注意，当操作系统启动一个进程时，它会临时在<strong>进程的虚拟地址空间</strong>中进行逻辑划分。<br/>
例如，在操作系统中可能有如下脚本用于分配内存：<br/></p>
<pre><code class="hljs language-c" lang="c">process_address_space = {
    .text   = <span class="hljs-number">0x00400000</span><span class="hljs-number">-0x00401000</span>,   
    .data   = <span class="hljs-number">0x00600000</span><span class="hljs-number">-0x00602000</span>, 
    .heap   = <span class="hljs-number">0x00602000</span><span class="hljs-number">-0x0</span>...,       <span class="hljs-comment">// 这里规定了逻辑上的堆曲</span>
    .<span class="hljs-built_in">stack</span>  = <span class="hljs-number">0x7ffffffdd000</span><span class="hljs-number">-0x7ffffffff000</span>  <span class="hljs-comment">// 这里分配逻辑上的栈区</span>
};
</code></pre>
<p>当线程实际开始执行时，操作系统并不会立即把整个栈区都映射到物理内存，而是只映射最顶部的几页物理内存到栈的虚拟地址范围。随着栈的增长（函数调用加深），如果触及了尚未映射的虚拟地址，会触发页面错误，操作系统才会动态分配新的物理内存页并映射上去。<br/>
因此，并不存在名为堆栈的硬件结构，堆栈只是操作系统给进行的逻辑划分。<br/>
在C++等编程语言中，对于std::stack这样的栈类型，我将与其他数据类型的存储方法在这里一同进行梳理。<br/>
这里的关键在于，变量存储位置由它的定义方式决定，而不是数据类型。<br/>
在内存中，有三大主要部分，分别为堆、栈、静态/全局区。如下图。<br/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ed4e451ab6364cd5bc081e33aa21f827~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY2Fob2hv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769345040&amp;x-signature=BGSGNMz3wcm0sTwLLsng%2BRGfnLk%3D" alt="mermaid-diagram.png" loading="lazy"/></p>
<p>不同位置声明的变量将在不同的位置分配内存。例如：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">example</span><span class="hljs-params">()</span> </span>{ 
    <span class="hljs-type">int</span> a = <span class="hljs-number">10</span>; <span class="hljs-comment">// a作为局部变量，存放在栈上</span>
    <span class="hljs-type">static</span> <span class="hljs-type">int</span> b = <span class="hljs-number">20</span>; <span class="hljs-comment">// b作为静态对象，存放在静态/全局区 </span>
    <span class="hljs-type">int</span>* c = <span class="hljs-keyword">new</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">30</span>); <span class="hljs-comment">// 指针c在栈上，它指向的值(30)在堆上 </span>
} 
<span class="hljs-type">int</span> global = <span class="hljs-number">40</span>; <span class="hljs-comment">// global是全局变量，存放在静态/全局区</span>
</code></pre>
<p>对于C++容器（std::vector, std::stack, std::string等）应当注意，容器对象本身和它管理的数据通常在不同区域。也就是说，容器对象与其数据是分开管理的。</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stack&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;vector&gt;</span></span>

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">containerExample</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-comment">//如果是局部容器：</span>
    std::stack&lt;<span class="hljs-type">int</span>&gt; s1;
    <span class="hljs-function">std::vector&lt;<span class="hljs-type">int</span>&gt; <span class="hljs-title">v1</span><span class="hljs-params">(<span class="hljs-number">100</span>)</span></span>;
    
    <span class="hljs-comment">// s1 是stack对象的本身，在栈上</span>
    <span class="hljs-comment">// v1 是vector对象的本身，也在栈上</span>
    <span class="hljs-comment">// 但是请留意：</span>
    <span class="hljs-comment">// s1 内部存储的int元素在堆上，因为std::stack默认用std::deque，而deque从堆分配</span>
    <span class="hljs-comment">// v1 内部的100个int元素也在堆上，因为vector从堆分配内存</span>
    
    <span class="hljs-comment">//如果是动态分配的容器：</span>
    std::stack&lt;<span class="hljs-type">int</span>&gt;* s2 = <span class="hljs-keyword">new</span> std::<span class="hljs-built_in">stack</span>&lt;<span class="hljs-type">int</span>&gt;();
    
    <span class="hljs-comment">// s2 这个指针在栈上，因为该指针本身作为对象本身。</span>
    <span class="hljs-comment">// s2 指向的std::stack对象在堆上，因为std::stack是栈对象本身。</span>
    <span class="hljs-comment">// s2内部存储的int元素在堆上</span>
}
</code></pre>
<br/>
以上是本文的所有内容。希望对大家有所帮助。如果有需要，我将继续更新【栈帧】的相关内容。</div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Java基础-2：基于JUC工具包并发和多线程编程的实现详细介绍]]></title>    <link>https://juejin.cn/post/7595895132261777459</link>    <guid>https://juejin.cn/post/7595895132261777459</guid>    <pubDate>2026-01-18T14:12:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595895132261777459" data-draft-id="7596698363932753970" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Java基础-2：基于JUC工具包并发和多线程编程的实现详细介绍"/> <meta itemprop="keywords" content="Java"/> <meta itemprop="datePublished" content="2026-01-18T14:12:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="beata"/> <meta itemprop="url" content="https://juejin.cn/user/1839900247461280"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Java基础-2：基于JUC工具包并发和多线程编程的实现详细介绍
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1839900247461280/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    beata
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-18T14:12:37.000Z" title="Sun Jan 18 2026 14:12:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">—— 基于 JUC 工具包的系统性介绍Java并发和多线程</h2>
<p>Java 自 JDK 5 起引入了 <code>java.util.concurrent</code>（简称 <strong>JUC</strong>）包，由并发大师 Doug Lea 设计，彻底改变了 Java 并发编程的范式。相比传统的 <code>synchronized</code> + <code>wait/notify</code> 模型，JUC 提供了更高性能、更强表达力、更少出错的并发原语。</p>
<p>本文将<strong>严格按 JUC 核心组件分类</strong>，逐一详解各类工具的设计思想、适用场景及使用方法，并配以完整可运行的代码示例，助你系统掌握 Java 并发编程。</p>
<hr/>
<h2 data-id="heading-1">一、线程池与任务调度（Executor Framework）</h2>
<h3 data-id="heading-2">1. <code>Executor</code> / <code>ExecutorService</code></h3>
<h4 data-id="heading-3">说明</h4>
<ul>
<li><code>Executor</code> 是最顶层接口，仅定义 <code>void execute(Runnable command)</code>，用于解耦任务提交与执行。</li>
<li><code>ExecutorService</code> 扩展了 <code>Executor</code>，支持：
<ul>
<li>提交带返回值的任务（<code>submit()</code> 返回 <code>Future</code>）；</li>
<li>批量提交（<code>invokeAll</code>, <code>invokeAny</code>）；</li>
<li>优雅关闭（<code>shutdown()</code>, <code>shutdownNow()</code>）。</li>
</ul>
</li>
</ul>
<h4 data-id="heading-4">使用示例</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.util.concurrent.*;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ExecutorServiceExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-type">ExecutorService</span> <span class="hljs-variable">executor</span> <span class="hljs-operator">=</span> Executors.newFixedThreadPool(<span class="hljs-number">2</span>);

        <span class="hljs-comment">// 提交带返回值的任务</span>
        Future&lt;String&gt; future = executor.submit(() -&gt; {
            Thread.sleep(<span class="hljs-number">1000</span>);
            <span class="hljs-keyword">return</span> <span class="hljs-string">"Hello from task!"</span>;
        });

        System.out.println(<span class="hljs-string">"Result: "</span> + future.get()); <span class="hljs-comment">// 阻塞等待结果</span>

        executor.shutdown();
        <span class="hljs-keyword">if</span> (!executor.awaitTermination(<span class="hljs-number">5</span>, TimeUnit.SECONDS)) {
            executor.shutdownNow();
        }
    }
}
</code></pre>
<hr/>
<h3 data-id="heading-5">2. <code>ThreadPoolExecutor</code></h3>
<h4 data-id="heading-6">说明</h4>
<p><strong>线程池的核心实现类</strong>，高度可配置。其工作流程如下：</p>
<ol>
<li>若当前线程数 &lt; <code>corePoolSize</code>，创建新线程；</li>
<li>否则，尝试入队 <code>workQueue</code>；</li>
<li>若队列满且线程数 &lt; <code>maximumPoolSize</code>，创建非核心线程；</li>
<li>否则，触发拒绝策略。</li>
</ol>
<p><strong>七大参数</strong>：</p>
<ul>
<li><code>corePoolSize</code>：核心线程数（常驻）；</li>
<li><code>maximumPoolSize</code>：最大线程数；</li>
<li><code>keepAliveTime</code>：非核心线程空闲存活时间；</li>
<li><code>unit</code>：时间单位；</li>
<li><code>workQueue</code>：任务队列（如 <code>ArrayBlockingQueue</code>）；</li>
<li><code>threadFactory</code>：线程工厂；</li>
<li><code>handler</code>：拒绝策略。</li>
</ul>
<blockquote>
<p>⚠️ <strong>生产建议</strong>：避免使用 <code>Executors</code> 工具类（如 <code>newFixedThreadPool</code> 使用无界队列，易 OOM），应显式构造 <code>ThreadPoolExecutor</code>。</p>
</blockquote>
<h4 data-id="heading-7">使用示例</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.util.concurrent.*;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CustomThreadPoolExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">ThreadPoolExecutor</span> <span class="hljs-variable">executor</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadPoolExecutor</span>(
            <span class="hljs-number">2</span>,                              <span class="hljs-comment">// corePoolSize</span>
            <span class="hljs-number">4</span>,                              <span class="hljs-comment">// maximumPoolSize</span>
            <span class="hljs-number">60L</span>,                            <span class="hljs-comment">// keepAliveTime</span>
            TimeUnit.SECONDS,
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayBlockingQueue</span>&lt;&gt;(<span class="hljs-number">10</span>),   <span class="hljs-comment">// 有界队列</span>
            r -&gt; <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(r, <span class="hljs-string">"MyPool-"</span> + r.hashCode()),
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadPoolExecutor</span>.CallerRunsPolicy()
        );

        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">15</span>; i++) {
            <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">taskId</span> <span class="hljs-operator">=</span> i;
            executor.submit(() -&gt; {
                System.out.println(Thread.currentThread().getName() + <span class="hljs-string">" handles task "</span> + taskId);
                <span class="hljs-keyword">try</span> { Thread.sleep(<span class="hljs-number">500</span>); } <span class="hljs-keyword">catch</span> (InterruptedException e) { Thread.currentThread().interrupt(); }
            });
        }

        executor.shutdown();
    }
}
</code></pre>
<hr/>
<h3 data-id="heading-8">3. <code>ScheduledExecutorService</code></h3>
<h4 data-id="heading-9">说明</h4>
<p>支持<strong>延迟执行</strong>或<strong>周期性执行</strong>任务，替代老旧的 <code>Timer</code>。</p>
<ul>
<li><code>schedule(Runnable, delay, unit)</code>：延迟执行一次；</li>
<li><code>scheduleAtFixedRate(Runnable, initialDelay, period, unit)</code>：固定频率执行；</li>
<li><code>scheduleWithFixedDelay(Runnable, initialDelay, delay, unit)</code>：固定延迟执行（上次结束到下次开始）。</li>
</ul>
<h4 data-id="heading-10">使用示例</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.util.concurrent.Executors;
<span class="hljs-keyword">import</span> java.util.concurrent.ScheduledExecutorService;
<span class="hljs-keyword">import</span> java.util.concurrent.TimeUnit;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ScheduledExecutorExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">ScheduledExecutorService</span> <span class="hljs-variable">scheduler</span> <span class="hljs-operator">=</span> Executors.newScheduledThreadPool(<span class="hljs-number">1</span>);

        <span class="hljs-comment">// 延迟 2 秒后执行</span>
        scheduler.schedule(() -&gt; System.out.println(<span class="hljs-string">"Delayed task executed!"</span>), <span class="hljs-number">2</span>, TimeUnit.SECONDS);

        <span class="hljs-comment">// 每 1 秒执行一次（固定频率）</span>
        scheduler.scheduleAtFixedRate(
            () -&gt; System.out.println(<span class="hljs-string">"Tick at "</span> + System.currentTimeMillis()),
            <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, TimeUnit.SECONDS
        );

        <span class="hljs-comment">// 5 秒后关闭</span>
        scheduler.schedule(scheduler::shutdown, <span class="hljs-number">5</span>, TimeUnit.SECONDS);
    }
}
</code></pre>
<hr/>
<h2 data-id="heading-11">二、同步器（Synchronizers）</h2>
<h3 data-id="heading-12">1. <code>CountDownLatch</code></h3>
<h4 data-id="heading-13">说明</h4>
<p>允许一个或多个线程<strong>等待其他 N 个线程完成操作</strong>。计数器初始化后<strong>不可重置</strong>。</p>
<ul>
<li><code>countDown()</code>：递减计数；</li>
<li><code>await()</code>：阻塞直到计数归零。</li>
</ul>
<h4 data-id="heading-14">使用示例：启动服务前等待所有组件初始化</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.util.concurrent.CountDownLatch;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CountDownLatchExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException {
        <span class="hljs-type">int</span> <span class="hljs-variable">serviceCount</span> <span class="hljs-operator">=</span> <span class="hljs-number">3</span>;
        <span class="hljs-type">CountDownLatch</span> <span class="hljs-variable">latch</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CountDownLatch</span>(serviceCount);

        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; i &lt;= serviceCount; i++) {
            <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">id</span> <span class="hljs-operator">=</span> i;
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
                System.out.println(<span class="hljs-string">"Service "</span> + id + <span class="hljs-string">" initializing..."</span>);
                <span class="hljs-keyword">try</span> { Thread.sleep(<span class="hljs-number">1000</span> + (<span class="hljs-type">long</span>)(Math.random() * <span class="hljs-number">1000</span>)); } <span class="hljs-keyword">catch</span> (InterruptedException e) {}
                System.out.println(<span class="hljs-string">"Service "</span> + id + <span class="hljs-string">" ready."</span>);
                latch.countDown();
            }).start();
        }

        latch.await(); <span class="hljs-comment">// 主线程等待所有服务就绪</span>
        System.out.println(<span class="hljs-string">"All services ready. Application started."</span>);
    }
}
</code></pre>
<hr/>
<h3 data-id="heading-15">2. <code>CyclicBarrier</code></h3>
<h4 data-id="heading-16">说明</h4>
<p>让一组线程<strong>互相等待</strong>，直到所有线程都到达屏障点。<strong>可重复使用</strong>（故名 Cyclic）。</p>
<ul>
<li><code>await()</code>：等待其他线程到达；</li>
<li>可选：提供 <code>Runnable</code> 在屏障触发时执行。</li>
</ul>
<h4 data-id="heading-17">使用示例：多玩家游戏回合同步</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.util.concurrent.BrokenBarrierException;
<span class="hljs-keyword">import</span> java.util.concurrent.CyclicBarrier;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CyclicBarrierExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">int</span> <span class="hljs-variable">playerCount</span> <span class="hljs-operator">=</span> <span class="hljs-number">3</span>;
        <span class="hljs-type">CyclicBarrier</span> <span class="hljs-variable">barrier</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CyclicBarrier</span>(playerCount, () -&gt; 
            System.out.println(<span class="hljs-string">"&gt;&gt;&gt; All players ready. Starting round!"</span>)
        );

        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; i &lt;= playerCount; i++) {
            <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">playerId</span> <span class="hljs-operator">=</span> i;
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
                <span class="hljs-keyword">try</span> {
                    System.out.println(<span class="hljs-string">"Player "</span> + playerId + <span class="hljs-string">" preparing..."</span>);
                    Thread.sleep((<span class="hljs-type">long</span>)(Math.random() * <span class="hljs-number">2000</span>));
                    System.out.println(<span class="hljs-string">"Player "</span> + playerId + <span class="hljs-string">" ready."</span>);
                    barrier.await(); <span class="hljs-comment">// 等待其他玩家</span>
                    System.out.println(<span class="hljs-string">"Player "</span> + playerId + <span class="hljs-string">" playing..."</span>);
                } <span class="hljs-keyword">catch</span> (InterruptedException | BrokenBarrierException e) {
                    e.printStackTrace();
                }
            }).start();
        }
    }
}
</code></pre>
<hr/>
<h3 data-id="heading-18">3. <code>Semaphore</code></h3>
<h4 data-id="heading-19">说明</h4>
<p>控制<strong>同时访问特定资源的线程数量</strong>，常用于<strong>限流</strong>（如数据库连接池、API 调用频率控制）。</p>
<ul>
<li><code>acquire()</code>：获取许可（若无则阻塞）；</li>
<li><code>release()</code>：释放许可。</li>
</ul>
<h4 data-id="heading-20">使用示例：模拟数据库连接池（最多 2 个并发连接）</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.util.concurrent.Semaphore;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SemaphoreExample</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Semaphore</span> <span class="hljs-variable">semaphore</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Semaphore</span>(<span class="hljs-number">2</span>); <span class="hljs-comment">// 最多 2 个许可</span>

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; i &lt;= <span class="hljs-number">5</span>; i++) {
            <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">userId</span> <span class="hljs-operator">=</span> i;
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
                <span class="hljs-keyword">try</span> {
                    semaphore.acquire(); <span class="hljs-comment">// 获取数据库连接</span>
                    System.out.println(<span class="hljs-string">"User "</span> + userId + <span class="hljs-string">" acquired DB connection."</span>);
                    Thread.sleep(<span class="hljs-number">2000</span>); <span class="hljs-comment">// 模拟查询</span>
                    System.out.println(<span class="hljs-string">"User "</span> + userId + <span class="hljs-string">" released DB connection."</span>);
                } <span class="hljs-keyword">catch</span> (InterruptedException e) {
                    Thread.currentThread().interrupt();
                } <span class="hljs-keyword">finally</span> {
                    semaphore.release(); <span class="hljs-comment">// 释放连接</span>
                }
            }).start();
        }
    }
}
</code></pre>
<hr/>
<h3 data-id="heading-21">4. <code>Phaser</code></h3>
<h4 data-id="heading-22">说明</h4>
<p>更灵活的<strong>动态屏障</strong>，支持：</p>
<ul>
<li>动态注册/注销参与方；</li>
<li>分阶段同步（每个阶段可不同参与者）；</li>
<li>支持终止机制。</li>
</ul>
<p>适用于复杂多阶段任务协调。</p>
<h4 data-id="heading-23">使用示例：分阶段数据处理</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.util.concurrent.Phaser;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PhaserExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">Phaser</span> <span class="hljs-variable">phaser</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Phaser</span>(<span class="hljs-number">1</span>); <span class="hljs-comment">// 初始注册主线程</span>

        <span class="hljs-comment">// 注册 3 个工作线程</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">3</span>; i++) {
            phaser.register();
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
                System.out.println(<span class="hljs-string">"Worker doing phase 1"</span>);
                phaser.arriveAndAwaitAdvance(); <span class="hljs-comment">// 等待所有线程完成 phase 1</span>

                System.out.println(<span class="hljs-string">"Worker doing phase 2"</span>);
                phaser.arriveAndDeregister(); <span class="hljs-comment">// 完成后注销</span>
            }).start();
        }

        phaser.arriveAndAwaitAdvance(); <span class="hljs-comment">// 主线程等待 phase 1</span>
        System.out.println(<span class="hljs-string">"Phase 1 completed by all."</span>);

        phaser.arriveAndAwaitAdvance(); <span class="hljs-comment">// 主线程等待 phase 2（此时只有主线程）</span>
        System.out.println(<span class="hljs-string">"Phase 2 completed. All done."</span>);
    }
}
</code></pre>
<hr/>
<h2 data-id="heading-24">三、锁（Locks）</h2>
<h3 data-id="heading-25">1. <code>ReentrantLock</code></h3>
<h4 data-id="heading-26">说明</h4>
<p>可重入的<strong>显式锁</strong>，功能类似 <code>synchronized</code>，但更灵活：</p>
<ul>
<li>支持公平/非公平锁；</li>
<li>可中断（<code>lockInterruptibly()</code>）；</li>
<li>支持超时（<code>tryLock(timeout)</code>）；</li>
<li>可查询锁状态。</li>
</ul>
<h4 data-id="heading-27">使用示例：带超时的锁竞争</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.util.concurrent.locks.ReentrantLock;
<span class="hljs-keyword">import</span> java.util.concurrent.TimeUnit;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ReentrantLockTimeoutExample</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">ReentrantLock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantLock</span>();

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException {
        <span class="hljs-type">Thread</span> <span class="hljs-variable">t1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-keyword">if</span> (lock.tryLock(<span class="hljs-number">1</span>, TimeUnit.SECONDS)) {
                    <span class="hljs-keyword">try</span> {
                        System.out.println(<span class="hljs-string">"T1 got lock, sleeping..."</span>);
                        Thread.sleep(<span class="hljs-number">2000</span>);
                    } <span class="hljs-keyword">finally</span> {
                        lock.unlock();
                    }
                }
            } <span class="hljs-keyword">catch</span> (InterruptedException e) {
                Thread.currentThread().interrupt();
            }
        });

        <span class="hljs-type">Thread</span> <span class="hljs-variable">t2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-keyword">if</span> (lock.tryLock(<span class="hljs-number">500</span>, TimeUnit.MILLISECONDS)) {
                    System.out.println(<span class="hljs-string">"T2 got lock"</span>);
                    lock.unlock();
                } <span class="hljs-keyword">else</span> {
                    System.out.println(<span class="hljs-string">"T2 timed out"</span>);
                }
            } <span class="hljs-keyword">catch</span> (InterruptedException e) {
                Thread.currentThread().interrupt();
            }
        });

        t1.start(); Thread.sleep(<span class="hljs-number">100</span>); t2.start();
        t1.join(); t2.join();
    }
}
</code></pre>
<hr/>
<h3 data-id="heading-28">2. <code>ReadWriteLock</code> / <code>ReentrantReadWriteLock</code></h3>
<h4 data-id="heading-29">说明</h4>
<p>分离读写操作：</p>
<ul>
<li><strong>读锁</strong>：共享锁，允许多个读线程同时访问；</li>
<li><strong>写锁</strong>：独占锁，写时禁止读和其他写。</li>
</ul>
<p>适用于<strong>读多写少</strong>场景（如缓存）。</p>
<h4 data-id="heading-30">使用示例：缓存读写</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.util.HashMap;
<span class="hljs-keyword">import</span> java.util.Map;
<span class="hljs-keyword">import</span> java.util.concurrent.locks.ReadWriteLock;
<span class="hljs-keyword">import</span> java.util.concurrent.locks.ReentrantReadWriteLock;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CacheWithReadWriteLock</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Map&lt;String, String&gt; cache = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">ReadWriteLock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantReadWriteLock</span>();

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">get</span><span class="hljs-params">(String key)</span> {
        lock.readLock().lock();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">return</span> cache.get(key);
        } <span class="hljs-keyword">finally</span> {
            lock.readLock().unlock();
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">put</span><span class="hljs-params">(String key, String value)</span> {
        lock.writeLock().lock();
        <span class="hljs-keyword">try</span> {
            cache.put(key, value);
        } <span class="hljs-keyword">finally</span> {
            lock.writeLock().unlock();
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">CacheWithReadWriteLock</span> <span class="hljs-variable">cache</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CacheWithReadWriteLock</span>();
        cache.put(<span class="hljs-string">"name"</span>, <span class="hljs-string">"Alice"</span>);

        <span class="hljs-comment">// 多个读线程可并发</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">3</span>; i++) {
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; System.out.println(cache.get(<span class="hljs-string">"name"</span>))).start();
        }
    }
}
</code></pre>
<hr/>
<h3 data-id="heading-31">3. <code>StampedLock</code>（JDK 8+）</h3>
<h4 data-id="heading-32">说明</h4>
<p>提供<strong>乐观读锁</strong>机制，在读多写少场景下性能优于 <code>ReadWriteLock</code>。</p>
<ul>
<li><code>tryOptimisticRead()</code>：尝试乐观读（无锁）；</li>
<li><code>validate(stamp)</code>：验证期间是否有写操作；</li>
<li>若验证失败，可升级为悲观读锁。</li>
</ul>
<blockquote>
<p>⚠️ 不支持重入，且不支持条件变量。</p>
</blockquote>
<h4 data-id="heading-33">使用示例</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.util.concurrent.locks.StampedLock;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StampedLockExample</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-type">double</span> <span class="hljs-variable">x</span> <span class="hljs-operator">=</span> <span class="hljs-number">0.0</span>, y = <span class="hljs-number">0.0</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">StampedLock</span> <span class="hljs-variable">sl</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StampedLock</span>();

    <span class="hljs-keyword">public</span> <span class="hljs-type">double</span> <span class="hljs-title function_">distanceFromOrigin</span><span class="hljs-params">()</span> {
        <span class="hljs-type">long</span> <span class="hljs-variable">stamp</span> <span class="hljs-operator">=</span> sl.tryOptimisticRead(); <span class="hljs-comment">// 乐观读</span>
        <span class="hljs-type">double</span> <span class="hljs-variable">currentX</span> <span class="hljs-operator">=</span> x, currentY = y;
        <span class="hljs-keyword">if</span> (!sl.validate(stamp)) { <span class="hljs-comment">// 检查是否被写</span>
            stamp = sl.readLock(); <span class="hljs-comment">// 升级为悲观读</span>
            <span class="hljs-keyword">try</span> {
                currentX = x; currentY = y;
            } <span class="hljs-keyword">finally</span> {
                sl.unlockRead(stamp);
            }
        }
        <span class="hljs-keyword">return</span> Math.sqrt(currentX * currentX + currentY * currentY);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">move</span><span class="hljs-params">(<span class="hljs-type">double</span> deltaX, <span class="hljs-type">double</span> deltaY)</span> {
        <span class="hljs-type">long</span> <span class="hljs-variable">stamp</span> <span class="hljs-operator">=</span> sl.writeLock();
        <span class="hljs-keyword">try</span> {
            x += deltaX;
            y += deltaY;
        } <span class="hljs-keyword">finally</span> {
            sl.unlockWrite(stamp);
        }
    }
}
</code></pre>
<hr/>
<h2 data-id="heading-34">四、原子变量（Atomics）</h2>
<h3 data-id="heading-35">1. <code>AtomicInteger</code> / <code>AtomicLong</code> / <code>AtomicReference</code></h3>
<h4 data-id="heading-36">说明</h4>
<p>基于 <strong>CAS（Compare-And-Swap）</strong> 实现无锁线程安全操作，适用于计数器、状态标志等。</p>
<ul>
<li><code>getAndIncrement()</code>、<code>compareAndSet(expected, update)</code> 等方法均为原子操作。</li>
</ul>
<h4 data-id="heading-37">使用示例：安全计数器</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.util.concurrent.atomic.AtomicInteger;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AtomicCounterExample</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">AtomicInteger</span> <span class="hljs-variable">counter</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicInteger</span>(<span class="hljs-number">0</span>);

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException {
        Thread[] threads = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>[<span class="hljs-number">10</span>];
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; threads.length; i++) {
            threads[i] = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
                <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">1000</span>; j++) {
                    counter.incrementAndGet(); <span class="hljs-comment">// 原子自增</span>
                }
            });
            threads[i].start();
        }

        <span class="hljs-keyword">for</span> (Thread t : threads) t.join();
        System.out.println(<span class="hljs-string">"Final count: "</span> + counter.get()); <span class="hljs-comment">// 输出 10000</span>
    }
}
</code></pre>
<hr/>
<h3 data-id="heading-38">2. <code>LongAdder</code>（JDK 8+）</h3>
<h4 data-id="heading-39">说明</h4>
<p>在<strong>高并发写场景</strong>下，性能优于 <code>AtomicLong</code>。通过<strong>分段累加</strong>减少 CAS 冲突。</p>
<ul>
<li>适用于统计、监控等只增不减的场景；</li>
<li>读取时需调用 <code>sum()</code> 合并各段值。</li>
</ul>
<h4 data-id="heading-40">使用示例</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.util.concurrent.atomic.LongAdder;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LongAdderExample</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">LongAdder</span> <span class="hljs-variable">adder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">LongAdder</span>();

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException {
        Thread[] threads = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>[<span class="hljs-number">10</span>];
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; threads.length; i++) {
            threads[i] = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
                <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">100_000</span>; j++) {
                    adder.increment();
                }
            });
            threads[i].start();
        }

        <span class="hljs-keyword">for</span> (Thread t : threads) t.join();
        System.out.println(<span class="hljs-string">"Sum: "</span> + adder.sum()); <span class="hljs-comment">// 输出 1_000_000</span>
    }
}
</code></pre>
<hr/>
<h2 data-id="heading-41">五、并发集合（Concurrent Collections）</h2>
<h3 data-id="heading-42">1. <code>ConcurrentHashMap</code></h3>
<h4 data-id="heading-43">说明</h4>
<p>线程安全的哈希表，<strong>高性能</strong>：</p>
<ul>
<li>JDK 1.8+：采用 <code>Node</code> 数组 + 链表/红黑树，结合 <strong>CAS + synchronized</strong> 锁单个桶；</li>
<li>支持高并发读写，迭代器弱一致性（不抛 <code>ConcurrentModificationException</code>）。</li>
</ul>
<h4 data-id="heading-44">使用示例</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.util.concurrent.ConcurrentHashMap;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConcurrentHashMapExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        ConcurrentHashMap&lt;String, Integer&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentHashMap</span>&lt;&gt;();
        map.put(<span class="hljs-string">"count"</span>, <span class="hljs-number">0</span>);

        <span class="hljs-comment">// 多线程安全更新</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) {
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
                map.compute(<span class="hljs-string">"count"</span>, (k, v) -&gt; (v == <span class="hljs-literal">null</span>) ? <span class="hljs-number">1</span> : v + <span class="hljs-number">1</span>);
            }).start();
        }

        <span class="hljs-comment">// 等待所有线程完成（简化版）</span>
        <span class="hljs-keyword">try</span> { Thread.sleep(<span class="hljs-number">1000</span>); } <span class="hljs-keyword">catch</span> (InterruptedException e) {}
        System.out.println(<span class="hljs-string">"Final count: "</span> + map.get(<span class="hljs-string">"count"</span>)); <span class="hljs-comment">// 输出 10</span>
    }
}
</code></pre>
<hr/>
<h3 data-id="heading-45">2. <code>CopyOnWriteArrayList</code></h3>
<h4 data-id="heading-46">说明</h4>
<p><strong>写时复制</strong>的线程安全列表：</p>
<ul>
<li>写操作（add/remove）会复制整个底层数组；</li>
<li>读操作无锁，<strong>适合读多写少</strong>场景（如监听器列表）；</li>
<li>迭代器基于快照，不会抛 <code>ConcurrentModificationException</code>。</li>
</ul>
<h4 data-id="heading-47">使用示例</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.util.List;
<span class="hljs-keyword">import</span> java.util.concurrent.CopyOnWriteArrayList;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CopyOnWriteExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        List&lt;String&gt; listeners = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CopyOnWriteArrayList</span>&lt;&gt;();
        listeners.add(<span class="hljs-string">"Listener-A"</span>);

        <span class="hljs-comment">// 读线程遍历</span>
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
            <span class="hljs-keyword">for</span> (String l : listeners) {
                System.out.println(<span class="hljs-string">"Reading: "</span> + l);
                <span class="hljs-keyword">try</span> { Thread.sleep(<span class="hljs-number">100</span>); } <span class="hljs-keyword">catch</span> (InterruptedException e) {}
            }
        }).start();

        <span class="hljs-comment">// 写线程添加</span>
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
            <span class="hljs-keyword">try</span> { Thread.sleep(<span class="hljs-number">50</span>); } <span class="hljs-keyword">catch</span> (InterruptedException e) {}
            listeners.add(<span class="hljs-string">"Listener-B"</span>);
            System.out.println(<span class="hljs-string">"Added Listener-B"</span>);
        }).start();
    }
}
</code></pre>
<hr/>
<h3 data-id="heading-48">3. <code>BlockingQueue</code> 实现类</h3>
<h4 data-id="heading-49">说明</h4>
<p>阻塞队列是<strong>生产者-消费者模式</strong>的核心。常用实现：</p>
<ul>
<li><code>ArrayBlockingQueue</code>：有界，基于数组；</li>
<li><code>LinkedBlockingQueue</code>：可选有界/无界，基于链表；</li>
<li><code>SynchronousQueue</code>：不存储元素，直接传递。</li>
</ul>
<h4 data-id="heading-50">使用示例：生产者-消费者</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.util.concurrent.ArrayBlockingQueue;
<span class="hljs-keyword">import</span> java.util.concurrent.BlockingQueue;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ProducerConsumerExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        BlockingQueue&lt;Integer&gt; queue = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayBlockingQueue</span>&lt;&gt;(<span class="hljs-number">5</span>);

        <span class="hljs-comment">// 生产者</span>
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) {
                <span class="hljs-keyword">try</span> {
                    queue.put(i); <span class="hljs-comment">// 队列满时阻塞</span>
                    System.out.println(<span class="hljs-string">"Produced: "</span> + i);
                } <span class="hljs-keyword">catch</span> (InterruptedException e) {
                    Thread.currentThread().interrupt();
                }
            }
        }).start();

        <span class="hljs-comment">// 消费者</span>
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
            <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
                <span class="hljs-keyword">try</span> {
                    <span class="hljs-type">Integer</span> <span class="hljs-variable">item</span> <span class="hljs-operator">=</span> queue.take(); <span class="hljs-comment">// 队列空时阻塞</span>
                    System.out.println(<span class="hljs-string">"Consumed: "</span> + item);
                    <span class="hljs-keyword">if</span> (item == <span class="hljs-number">9</span>) <span class="hljs-keyword">break</span>;
                } <span class="hljs-keyword">catch</span> (InterruptedException e) {
                    Thread.currentThread().interrupt();
                }
            }
        }).start();
    }
}
</code></pre>
<hr/>
<h2 data-id="heading-51">六、异步编程（Asynchronous Programming）</h2>
<h3 data-id="heading-52">1. <code>CompletableFuture</code></h3>
<h4 data-id="heading-53">说明</h4>
<p>Java 8 引入的<strong>异步组合利器</strong>，支持：</p>
<ul>
<li>非阻塞任务提交；</li>
<li>链式组合（<code>thenApply</code>, <code>thenCombine</code>）；</li>
<li>异常处理（<code>exceptionally</code>, <code>handle</code>）；</li>
<li>多任务协调（<code>allOf</code>, <code>anyOf</code>）；</li>
<li>可指定执行线程池。</li>
</ul>
<blockquote>
<p>默认使用 <code>ForkJoinPool.commonPool()</code>，但 I/O 密集型任务应使用自定义线程池。</p>
</blockquote>
<h4 data-id="heading-54">使用示例：电商订单聚合</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.util.concurrent.CompletableFuture;
<span class="hljs-keyword">import</span> java.util.concurrent.ExecutorService;
<span class="hljs-keyword">import</span> java.util.concurrent.Executors;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CompletableFutureOrderExample</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">ExecutorService</span> <span class="hljs-variable">ioPool</span> <span class="hljs-operator">=</span> Executors.newFixedThreadPool(<span class="hljs-number">4</span>);

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception {
        CompletableFuture&lt;String&gt; user = getUser(<span class="hljs-string">"123"</span>, ioPool);
        CompletableFuture&lt;String&gt; product = getProduct(<span class="hljs-string">"P456"</span>, ioPool);
        CompletableFuture&lt;Integer&gt; stock = getStock(<span class="hljs-string">"P456"</span>, ioPool);

        CompletableFuture&lt;String&gt; order = user
            .thenCombine(product, (u, p) -&gt; u + <span class="hljs-string">" buys "</span> + p)
            .thenCombine(stock, (msg, s) -&gt; msg + <span class="hljs-string">" (stock: "</span> + s + <span class="hljs-string">")"</span>);

        System.out.println(<span class="hljs-string">"Order: "</span> + order.join());
        ioPool.shutdown();
    }

    <span class="hljs-keyword">static</span> CompletableFuture&lt;String&gt; <span class="hljs-title function_">getUser</span><span class="hljs-params">(String id, ExecutorService exec)</span> {
        <span class="hljs-keyword">return</span> CompletableFuture.supplyAsync(() -&gt; {
            sleep(<span class="hljs-number">800</span>); <span class="hljs-keyword">return</span> <span class="hljs-string">"Alice"</span>;
        }, exec);
    }

    <span class="hljs-keyword">static</span> CompletableFuture&lt;String&gt; <span class="hljs-title function_">getProduct</span><span class="hljs-params">(String id, ExecutorService exec)</span> {
        <span class="hljs-keyword">return</span> CompletableFuture.supplyAsync(() -&gt; {
            sleep(<span class="hljs-number">600</span>); <span class="hljs-keyword">return</span> <span class="hljs-string">"Laptop"</span>;
        }, exec);
    }

    <span class="hljs-keyword">static</span> CompletableFuture&lt;Integer&gt; <span class="hljs-title function_">getStock</span><span class="hljs-params">(String id, ExecutorService exec)</span> {
        <span class="hljs-keyword">return</span> CompletableFuture.supplyAsync(() -&gt; {
            sleep(<span class="hljs-number">500</span>); <span class="hljs-keyword">return</span> <span class="hljs-number">50</span>;
        }, exec);
    }

    <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sleep</span><span class="hljs-params">(<span class="hljs-type">int</span> ms)</span> {
        <span class="hljs-keyword">try</span> { Thread.sleep(ms); } <span class="hljs-keyword">catch</span> (InterruptedException e) { Thread.currentThread().interrupt(); }
    }
}
</code></pre>
<hr/>
<h3 data-id="heading-55">2. <code>ForkJoinPool</code></h3>
<h4 data-id="heading-56">说明</h4>
<p>专为 <strong>分治算法（Divide and Conquer）</strong> 设计的线程池，采用 <strong>工作窃取（Work-Stealing）</strong> 策略：</p>
<ul>
<li>每个线程维护一个双端队列；</li>
<li>空闲线程从其他队列尾部“偷”任务；</li>
<li>极大提升 CPU 密集型任务的并行效率。</li>
</ul>
<p>核心类：</p>
<ul>
<li><code>RecursiveTask&lt;V&gt;</code>：有返回值的分治任务；</li>
<li><code>RecursiveAction</code>：无返回值的分治任务。</li>
</ul>
<h4 data-id="heading-57">使用示例：并行数组求和</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.util.concurrent.RecursiveTask;
<span class="hljs-keyword">import</span> java.util.concurrent.ForkJoinPool;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ForkJoinSum</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">RecursiveTask</span>&lt;Long&gt; {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">THRESHOLD</span> <span class="hljs-operator">=</span> <span class="hljs-number">1_000_000</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span>[] array;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> start, end;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">ForkJoinSum</span><span class="hljs-params">(<span class="hljs-type">long</span>[] array)</span> {
        <span class="hljs-built_in">this</span>(array, <span class="hljs-number">0</span>, array.length);
    }

    <span class="hljs-keyword">private</span> <span class="hljs-title function_">ForkJoinSum</span><span class="hljs-params">(<span class="hljs-type">long</span>[] array, <span class="hljs-type">int</span> start, <span class="hljs-type">int</span> end)</span> {
        <span class="hljs-built_in">this</span>.array = array;
        <span class="hljs-built_in">this</span>.start = start;
        <span class="hljs-built_in">this</span>.end = end;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> Long <span class="hljs-title function_">compute</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">if</span> (end - start &lt;= THRESHOLD) {
            <span class="hljs-type">long</span> <span class="hljs-variable">sum</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> start; i &lt; end; i++) sum += array[i];
            <span class="hljs-keyword">return</span> sum;
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-type">int</span> <span class="hljs-variable">mid</span> <span class="hljs-operator">=</span> (start + end) &gt;&gt;&gt; <span class="hljs-number">1</span>;
            <span class="hljs-type">ForkJoinSum</span> <span class="hljs-variable">left</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ForkJoinSum</span>(array, start, mid);
            <span class="hljs-type">ForkJoinSum</span> <span class="hljs-variable">right</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ForkJoinSum</span>(array, mid, end);
            left.fork();
            <span class="hljs-type">long</span> <span class="hljs-variable">rightResult</span> <span class="hljs-operator">=</span> right.compute();
            <span class="hljs-type">long</span> <span class="hljs-variable">leftResult</span> <span class="hljs-operator">=</span> left.join();
            <span class="hljs-keyword">return</span> leftResult + rightResult;
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">long</span>[] data = <span class="hljs-keyword">new</span> <span class="hljs-title class_">long</span>[<span class="hljs-number">10_000_000</span>];
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; data.length; i++) data[i] = i + <span class="hljs-number">1</span>;

        <span class="hljs-type">ForkJoinPool</span> <span class="hljs-variable">pool</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ForkJoinPool</span>();
        <span class="hljs-type">long</span> <span class="hljs-variable">sum</span> <span class="hljs-operator">=</span> pool.invoke(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ForkJoinSum</span>(data));
        System.out.println(<span class="hljs-string">"Sum: "</span> + sum); <span class="hljs-comment">// 应等于 n*(n+1)/2</span>
    }
}
</code></pre>
<hr/>
<h2 data-id="heading-58">七、总结与选型指南</h2>




























































<table><thead><tr><th>组件类别</th><th>推荐工具</th><th>适用场景</th></tr></thead><tbody><tr><td><strong>任务调度</strong></td><td><code>ThreadPoolExecutor</code></td><td>通用异步任务执行</td></tr><tr><td><strong>定时任务</strong></td><td><code>ScheduledExecutorService</code></td><td>延迟/周期性任务</td></tr><tr><td><strong>线程协调</strong></td><td><code>CountDownLatch</code> / <code>CyclicBarrier</code> / <code>Phaser</code></td><td>多线程同步点控制</td></tr><tr><td><strong>资源限流</strong></td><td><code>Semaphore</code></td><td>控制并发访问数</td></tr><tr><td><strong>锁控制</strong></td><td><code>ReentrantLock</code> / <code>ReadWriteLock</code></td><td>需要灵活锁语义</td></tr><tr><td><strong>无锁计数</strong></td><td><code>LongAdder</code> / <code>AtomicInteger</code></td><td>高并发计数、状态更新</td></tr><tr><td><strong>并发容器</strong></td><td><code>ConcurrentHashMap</code> / <code>CopyOnWriteArrayList</code></td><td>线程安全集合</td></tr><tr><td><strong>生产消费</strong></td><td><code>BlockingQueue</code></td><td>解耦生产者与消费者</td></tr><tr><td><strong>异步编排</strong></td><td><code>CompletableFuture</code></td><td>I/O 异步组合、微服务聚合</td></tr><tr><td><strong>并行计算</strong></td><td><code>ForkJoinPool</code></td><td>CPU 密集型分治任务</td></tr></tbody></table>
<blockquote>
<p>💡 <strong>黄金法则</strong>：</p>
<ul>
<li>优先使用 JUC 提供的标准组件，而非手写 <code>wait/notify</code>；</li>
<li>线程池务必显式配置，避免 <code>Executors</code> 陷阱；</li>
<li>I/O 密集型用 <code>CompletableFuture</code> + 自定义线程池；</li>
<li>CPU 密集型用 <code>ForkJoinPool</code> 或并行流；</li>
<li>高并发计数用 <code>LongAdder</code>，非简单 <code>AtomicLong</code>。</li>
</ul>
</blockquote>
<hr/>
<p>掌握 JUC，就掌握了 Java 并发编程的“核武器”。合理选择工具，不仅能写出高性能代码，更能构建稳定、可维护的系统。</p>
<blockquote>
<p>📌 <strong>延伸学习</strong>：</p>
<ul>
<li>AQS（AbstractQueuedSynchronizer）源码；</li>
<li><code>ConcurrentHashMap</code> 分段锁演进；</li>
<li>虚拟线程（Project Loom，JDK 21+）；</li>
<li>响应式编程（Project Reactor）。</li>
<li>乐观锁和悲观锁的区别</li>
<li>公平锁和非公平锁的区别</li>
<li>什么是CAS？
----以上后续解析总结</li>
</ul>
</blockquote>
<hr/>
<blockquote>
<p><strong>作者</strong>：架构师Beata<br/>
<strong>日期</strong>：2026年1月18日<br/>
<strong>版权声明</strong>：本文可自由转载，但请保留出处。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Redis Cluster 高可用部署实践：从单机房到多机房容灾]]></title>    <link>https://juejin.cn/post/7596153767872741410</link>    <guid>https://juejin.cn/post/7596153767872741410</guid>    <pubDate>2026-01-18T12:35:31.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7596153767872741410" data-draft-id="7596241980868968482" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Redis Cluster 高可用部署实践：从单机房到多机房容灾"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-18T12:35:31.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Kevin666"/> <meta itemprop="url" content="https://juejin.cn/user/1549628692501449"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Redis Cluster 高可用部署实践：从单机房到多机房容灾
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1549628692501449/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Kevin666
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-18T12:35:31.000Z" title="Sun Jan 18 2026 12:35:31 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    6
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在分布式系统中，Redis 作为高性能的缓存与存储中间件，其集群的稳定性直接决定业务可用性。而 Redis Cluster 结合主从复制的部署架构，是解决「性能扩展」与「高可用容灾」的核心方案。本文将从架构设计、配置要点、场景适配等维度，拆解 Redis Cluster 从单机房一主一从到多机房一主两从的部署逻辑，助力大家搭建生产级 Redis 集群。</p>
<h2 data-id="heading-0">一、核心架构认知：Redis Cluster + 主从复制</h2>
<p>很多同学在接触 Redis 集群时，容易混淆「分片」与「主从」的概念。实际上，生产级 Redis 集群的核心是「Redis Cluster 分片集群」与「主从复制」的结合，二者各司其职、缺一不可：</p>
<ul>
<li><strong>Redis Cluster（分片集群）</strong> ：解决「单节点性能瓶颈」与「数据容量上限」问题。通过将 16384 个哈希槽均匀分配给多个主节点（分片），实现数据的分布式存储与请求路由，业务无需关心数据分片细节，由集群自动完成键的哈希映射与节点转发。</li>
<li><strong>主从复制（Master-Slave Replication）</strong> ：解决「单节点故障」与「容灾备份」问题。每个主节点绑定若干从节点，从节点通过异步同步机制复制主节点数据，主节点宕机时，从节点可自动晋升为主节点，保证服务不中断。</li>
</ul>
<p>简单来说，分片决定了集群的「性能上限与扩展性」，主从决定了集群的「可用性与容错能力」，二者结合构成生产环境的最优解。</p>
<h2 data-id="heading-1">二、单机房部署：一主一从（低成本高可用）</h2>
<p>单机房部署是中小型业务、非核心业务的首选方案，以「8 分片（主节点）+ 8 从节点」（一主一从）为例，核心目标是用最小资源成本解决单点故障问题。</p>
<h3 data-id="heading-2">1. 架构设计</h3>
<p>每个主节点（分片）对应 1 个从节点，主从节点部署在同一机房的不同物理机/机架（避免机架故障导致同时宕机）。整体架构如下：</p>
<p>总实例数 = 分片数（主节点数）× 2（一主一从），即 8×2=16 个 Redis 实例，每个主节点负责约 2048 个哈希槽（16384/8）。</p>
<h3 data-id="heading-3">2. 核心配置（redis.conf）</h3>
<p>所有节点需开启 Cluster 模式，关键配置项如下（统一配置，节点端口、文件路径差异化）：</p>
<pre><code class="hljs language-perl" lang="perl"><span class="hljs-comment"># 开启 Cluster 模式</span>
cluster-enabled yes
<span class="hljs-comment"># 集群节点配置文件（自动生成，无需手动修改）</span>
cluster-config-file nodes-<span class="hljs-number">6379</span>.conf
<span class="hljs-comment"># 节点超时时间（超过15秒无响应则标记为宕机）</span>
cluster-node-timeout <span class="hljs-number">15000</span>
<span class="hljs-comment"># 允许部分分片故障时仍提供服务</span>
cluster-<span class="hljs-keyword">require</span>-full-coverage <span class="hljs-keyword">no</span>
<span class="hljs-comment"># 后台运行</span>
daemonize yes
<span class="hljs-comment"># 关闭保护模式（生产环境配合密码认证）</span>
protected-mode <span class="hljs-keyword">no</span>
<span class="hljs-comment"># 集群节点认证密码（所有节点必须一致）</span>
requirepass Redis@123456
<span class="hljs-comment"># 从节点同步主节点的认证密码</span>
masterauth Redis@123456
<span class="hljs-comment"># 实例端口（每个实例端口唯一）</span>
port <span class="hljs-number">6379</span>
</code></pre>
<h3 data-id="heading-4">3. 集群搭建命令</h3>
<p>通过 Redis 自带的 redis-cli 工具快速创建集群，指定所有主从节点地址，并设置从节点数量：</p>
<pre><code class="hljs language-sql" lang="sql">redis<span class="hljs-operator">-</span>cli <span class="hljs-comment">--cluster create \</span>
<span class="hljs-number">192.168</span><span class="hljs-number">.1</span><span class="hljs-number">.10</span>:<span class="hljs-number">6379</span> <span class="hljs-number">192.168</span><span class="hljs-number">.1</span><span class="hljs-number">.11</span>:<span class="hljs-number">6379</span> \
<span class="hljs-number">192.168</span><span class="hljs-number">.1</span><span class="hljs-number">.12</span>:<span class="hljs-number">6380</span> <span class="hljs-number">192.168</span><span class="hljs-number">.1</span><span class="hljs-number">.13</span>:<span class="hljs-number">6380</span> \
...（共<span class="hljs-number">16</span>个节点地址）\
<span class="hljs-comment">--cluster-replicas 1 \</span>
<span class="hljs-operator">-</span>a Redis<span class="hljs-variable">@123456</span>
</code></pre>
<p>说明：--cluster-replicas 1 表示每个主节点对应 1 个从节点，工具会自动分配主从关系与哈希槽。</p>
<h3 data-id="heading-5">4. 适用场景与优势</h3>
<p>适合 QPS 中等、数据量适中，且对跨机房容灾无强制要求的业务。核心优势：</p>
<ul>
<li>资源高效：从节点数量与主节点相等，无过多资源浪费；</li>
<li>秒级故障转移：主节点宕机后，本地从节点快速晋升，业务无感知；</li>
<li>部署简单：无需跨机房网络规划，运维成本低。</li>
</ul>
<h2 data-id="heading-6">三、多机房部署：一主两从（双重容灾保障）</h2>
<p>对于核心业务（如支付、内容风控、电商核心链路），需应对机房级故障，此时「一主两从」跨机房部署是标准方案，核心目标是实现「节点级故障 + 机房级故障」双重容错。</p>
<h3 data-id="heading-7">1. 架构设计</h3>
<p>每个主节点配置 2 个从节点，采用「跨机房部署」策略（以两机房为例）：</p>
<p>主节点部署在主机房 A，1 个从节点部署在主机房 A（本地高可用），1 个从节点部署在备机房 B（跨机房容灾），整体架构为「1 主（A）+ 1 从（A）+ 1 从（B）」。</p>
<p>总实例数 = 分片数 × 3（一主两从），若分片数为 8，则总实例数为 24 个。</p>
<h3 data-id="heading-8">2. 关键优化配置</h3>
<p>多机房部署需额外优化以下配置，适配跨机房网络特性：</p>
<ul>
<li><strong>调整同步超时</strong>：跨机房网络延迟较高，增加 repl-timeout（默认 60 秒）至 120 秒，避免同步超时断开；</li>
<li><strong>开启部分同步</strong>：启用 repl-diskless-sync yes，减少跨机房同步的磁盘 IO 开销；</li>
<li><strong>密码与网络隔离</strong>：严格配置密码认证，跨机房网络通过专线或 VPN 连接，禁止公网访问。</li>
</ul>
<h3 data-id="heading-9">3. 集群搭建与主从分配</h3>
<p>多机房搭建需手动指定主从关系（避免从节点集中在同一机房），步骤如下：</p>
<ol>
<li>先在主机房 A 创建主节点集群，分配哈希槽；</li>
<li>将主机房 A 的从节点加入集群，绑定对应主节点；</li>
<li>将备机房 B 的从节点加入集群，绑定同一主节点，完成跨机房同步。</li>
</ol>
<p>示例命令（给主节点 192.168.1.10:6379 添加备机房从节点）：</p>
<pre><code class="hljs language-sql" lang="sql">redis<span class="hljs-operator">-</span>cli <span class="hljs-comment">--cluster add-node \</span>
<span class="hljs-number">192.168</span><span class="hljs-number">.2</span><span class="hljs-number">.10</span>:<span class="hljs-number">6379</span> <span class="hljs-number">192.168</span><span class="hljs-number">.1</span><span class="hljs-number">.10</span>:<span class="hljs-number">6379</span> \
<span class="hljs-comment">--cluster-slave \</span>
<span class="hljs-comment">--cluster-master-id 主节点ID \</span>
<span class="hljs-operator">-</span>a Redis<span class="hljs-variable">@123456</span>
</code></pre>
<h3 data-id="heading-10">4. 容灾能力说明</h3>
<ul>
<li>节点级故障：主机房 A 主节点宕机，本地从节点晋升为主节点，业务流量无延迟切换；</li>
<li>机房级故障：主机房 A 整体宕机，备机房 B 的从节点晋升为主节点，业务流量切换至备机房，服务持续可用；</li>
<li>数据一致性：Redis 异步同步存在微小延迟，可通过业务层幂等性设计弥补少量数据丢失风险。</li>
</ul>
<h3 data-id="heading-11">5. 适用场景与注意事项</h3>
<p>适合核心业务、对可用性要求极高（99.99%+），无法接受机房级故障的场景。需注意：</p>
<ul>
<li>带宽预留：跨机房同步需占用大量带宽，需根据写入 QPS 预留足够带宽；</li>
<li>资源成本：从节点数量是主节点的 2 倍，资源开销高于单机房部署；</li>
<li>运维复杂度：需维护跨机房网络、监控多机房节点状态。</li>
</ul>
<h2 data-id="heading-12">四、两种架构核心差异对比</h2>








































<table><thead><tr><th>对比维度</th><th>单机房一主一从</th><th>多机房一主两从</th></tr></thead><tbody><tr><td>从节点数量</td><td>1 个/主节点</td><td>2 个/主节点</td></tr><tr><td>总实例数</td><td>2 × 分片数</td><td>3 × 分片数</td></tr><tr><td>容灾能力</td><td>应对节点级故障</td><td>应对节点级、机房级故障</td></tr><tr><td>资源开销</td><td>低</td><td>中</td></tr><tr><td>网络延迟</td><td>本地网络，延迟极低</td><td>本地操作低，跨机房同步有延迟</td></tr><tr><td>适用业务</td><td>中小型、非核心业务</td><td>大型、核心业务</td></tr></tbody></table>
<h2 data-id="heading-13">五、生产环境额外优化建议</h2>
<h3 data-id="heading-14">1. 监控与告警</h3>
<p>接入 Prometheus + Grafana 监控集群关键指标，如：哈希槽分布、主从同步延迟、节点存活状态、QPS 与内存使用率，设置告警阈值（如同步延迟超过 10 秒告警）。</p>
<h3 data-id="heading-15">2. 扩容与缩容</h3>
<p>通过 redis-cli --cluster 命令实现无损扩容/缩容，新增主节点时自动迁移哈希槽，缩容时先迁移数据再移除节点，无需停止服务。</p>
<h3 data-id="heading-16">3. 死信队列与数据备份</h3>
<p>结合业务场景设计死信队列，处理失败任务；开启 Redis 持久化（AOF + RDB 混合模式），定期备份数据，应对极端故障。</p>
<h3 data-id="heading-17">4. 客户端适配</h3>
<p>使用支持 Redis Cluster 协议的客户端（如 Java 中的 Redisson、Spring Data Redis），客户端会自动缓存哈希槽映射表，提升路由效率。</p>
<h2 data-id="heading-18">六、总结</h2>
<p>Redis Cluster 结合主从复制的部署架构，是生产级 Redis 集群的核心方案。单机房一主一从是「低成本高可用」的选择，适合非核心业务；多机房一主两从是「双重容灾」的标准，适合核心业务。二者的本质是「资源成本」与「可用性」的权衡，实际部署时需结合业务量级、容灾要求、运维能力综合决策。</p>
<p>后续可进一步探索 Redis Cluster 与第三方工具（如 Codis）的对比、跨区域部署优化等话题，持续打磨 Redis 集群的稳定性与性能。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Java 对象分层定义规范 ：POJO的各种业务实现]]></title>    <link>https://juejin.cn/post/7596245612557811721</link>    <guid>https://juejin.cn/post/7596245612557811721</guid>    <pubDate>2026-01-18T14:33:26.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7596245612557811721" data-draft-id="7596221097865478150" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Java 对象分层定义规范 ：POJO的各种业务实现"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-18T14:33:26.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="白衣鸽子"/> <meta itemprop="url" content="https://juejin.cn/user/3072451409619223"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Java 对象分层定义规范 ：POJO的各种业务实现
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3072451409619223/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    白衣鸽子
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-18T14:33:26.000Z" title="Sun Jan 18 2026 14:33:26 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    5
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>POJO（Plain Old Java Object）是 Java 编程中一个非常基础且重要的概念。简单来说，POJO 就是一个“普通、简单、纯粹”的 Java 对象。判断一个类是不是 POJO，通常遵循以下标准（严格定义，但是可以适当放宽）：</p>
<ol>
<li>不继承特定类</li>
<li>不实现特定接口</li>
<li>没有注解依赖</li>
</ol>
<p><strong>一个标准的 POJO 代码示例：</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> {
    <span class="hljs-keyword">private</span> String name;
    <span class="hljs-keyword">private</span> Integer age;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">User</span><span class="hljs-params">()</span> {
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> name;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setName</span><span class="hljs-params">(String name)</span> {
        <span class="hljs-built_in">this</span>.name = name;
    }

    <span class="hljs-keyword">public</span> Integer <span class="hljs-title function_">getAge</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> age;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setAge</span><span class="hljs-params">(Integer age)</span> {
        <span class="hljs-built_in">this</span>.age = age;
    }
}
</code></pre>
<p>本文主要要介绍POJO类在项目开发中常见的几种业务概念实现。</p>
<h2 data-id="heading-1">1. DO / PO</h2>
<blockquote>
<p>DO (Data Object) / PO (Persistent Object)</p>
</blockquote>
<ul>
<li><strong>中文名称</strong>：数据对象 / 持久化对象</li>
<li><strong>对应层次</strong>：持久层（数据库）</li>
<li><strong>定义</strong>：与数据库表结构一一对应的 Java 对象。</li>
<li><strong>特点</strong>：
<ul>
<li>属性名通常与数据库字段名一致（或通过下划线/驼峰转换）。</li>
<li>只包含基础数据类型。</li>
</ul>
</li>
<li><strong>场景</strong>：当执行 SQL 查询后，数据库返回的数据封装成的对象。</li>
<li><strong>示例</strong>：</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 对应数据库表 user (id, name, password, age)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserDO</span> {
	<span class="hljs-keyword">private</span> Long id;
	<span class="hljs-keyword">private</span> String name;
	<span class="hljs-keyword">private</span> String password; <span class="hljs-comment">// 加密后的密码</span>
	<span class="hljs-keyword">private</span> Integer age;
    }
</code></pre>
<h2 data-id="heading-2">2. DTO</h2>
<blockquote>
<p>DTO (Data Transfer Object)</p>
</blockquote>
<ul>
<li><strong>中文名称</strong>：数据传输对象</li>
<li><strong>对应层次</strong>：在各层之间或网络之间传输</li>
<li><strong>定义</strong>：用于在不同层之间传输数据的对象。</li>
<li><strong>特点</strong>：
<ul>
<li>裁剪与聚合：它可以包含比 DO 更少或更多的字段。</li>
<li>隐藏敏感信息：比如 DO 里有 <code>password</code>，传给前端的 DTO 就不应该有。</li>
<li>组合数据：比如一个 DTO 可能包含 <code>UserDO</code> 和 <code>OrderDO</code> 的部分字段组合。</li>
</ul>
</li>
<li><strong>场景</strong>：
<ul>
<li>接口返回（VO）：传给前端的数据。</li>
<li>远程调用：微服务之间调用时传输的数据。</li>
<li>业务处理：一般业务方法内部处理时可以传递DTO。</li>
</ul>
</li>
<li><strong>示例</strong>：</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 用户查询接口返回给前端的数据</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserDTO</span> {
	<span class="hljs-keyword">private</span> Long id;
	<span class="hljs-keyword">private</span> String name;
	<span class="hljs-keyword">private</span> Integer age;
	<span class="hljs-comment">// 注意：这里没有 password 字段，为了安全</span>
}
</code></pre>
<h2 data-id="heading-3">3. BO</h2>
<blockquote>
<p>BO (Business Object)</p>
</blockquote>
<ul>
<li><strong>中文名称</strong>：业务对象</li>
<li><strong>对应层次</strong>：业务逻辑层</li>
<li><strong>定义</strong>：封装了业务逻辑处理的对象。</li>
<li><strong>特点</strong>：
<ul>
<li>它可能是多个 DO 的组合。</li>
<li>它可能包含复杂的计算逻辑或业务规则。</li>
<li>它是 Service 层内部流转的对象。</li>
</ul>
</li>
<li><strong>场景</strong>：
<ul>
<li>比如“创建订单”业务，需要操作“用户DO”、“商品DO”、“优惠DO”，Service 层会把它们组装成一个 <code>OrderBO</code> 进行处理。</li>
</ul>
</li>
<li><strong>示例</strong>：</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 提交订单时的业务对象</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderBO</span> {
	<span class="hljs-keyword">private</span> UserDO user;       <span class="hljs-comment">// 购买用户信息</span>
	<span class="hljs-keyword">private</span> List&lt;ProductDO&gt; products; <span class="hljs-comment">// 商品列表</span>
	<span class="hljs-keyword">private</span> BigDecimal totalPrice;    <span class="hljs-comment">// 计算后的价格（业务逻辑算出来的）</span>
	<span class="hljs-keyword">private</span> String couponCode;        <span class="hljs-comment">// 优惠券代码</span>
}
</code></pre>
<h2 data-id="heading-4">4. VO</h2>
<blockquote>
<p>VO (View Object)</p>
</blockquote>
<ul>
<li><strong>中文名称</strong>：视图对象 / 展示对象</li>
<li><strong>对应层次</strong>：控制层 -&gt; 前端（展示层）</li>
<li><strong>定义</strong>：专门用于展示给前端（网页、App）的数据对象。</li>
<li><strong>特点</strong>：
<ul>
<li>脱敏：通常会隐藏敏感字段（如手机号中间四位隐藏、不返回密码）。</li>
<li>格式化：将后端的数据格式化为前端易读的形式（如：<code>1.0</code> -&gt; <code>"VIP"</code>, <code>Date</code> -&gt; <code>"2023-10-01"</code>）。</li>
<li>组装：可能聚合了多个 DO 或 BO 的数据，专门为了某个页面设计。</li>
</ul>
</li>
<li><strong>场景</strong>：
<ul>
<li>列表页展示的数据摘要。</li>
<li>详情页返回的完整信息。</li>
<li>前端下拉框需要的选项数据。</li>
</ul>
</li>
<li><strong>示例</strong>：</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 用户详情页返回给前端的数据</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserDetailVO</span> {
	
	<span class="hljs-keyword">private</span> Long id;
	<span class="hljs-keyword">private</span> String username;
	
	<span class="hljs-comment">// 脱敏处理：手机号 138****1234</span>
	<span class="hljs-keyword">private</span> String phoneNumber; 
	
	<span class="hljs-comment">// 格式化处理：将 Date 类型的生日转为字符串 "1990-01-01"</span>
	<span class="hljs-keyword">private</span> String birthdayStr;
	
	<span class="hljs-comment">// 组装处理：数据库里存的是 0/1，前端展示 "男/女"</span>
	<span class="hljs-keyword">private</span> String genderDesc; 
	
	<span class="hljs-comment">// 注意：这里绝对不包含 password 字段</span>
}
</code></pre>
<h2 data-id="heading-5">5. CO</h2>
<blockquote>
<p>有两种用法：1. Config Object 2. Command Object</p>
</blockquote>
<h3 data-id="heading-6">5.1 Config Object</h3>
<ul>
<li><strong>中文名称</strong>：配置对象 / 属性对象</li>
<li><strong>对应层次</strong>：基础设施层 / 配置层</li>
<li><strong>定义</strong>：专门用于接收和绑定配置文件（如 <code>.yml</code>, <code>.properties</code>）中参数的 Java 对象。</li>
<li><strong>特点</strong>：
<ul>
<li>通常配合 <code>@ConfigurationProperties</code> 注解使用，指定配置文件的前缀。</li>
<li>支持松散绑定（如 <code>userName</code> 可匹配 <code>user-name</code> 或 <code>user_name</code>）。</li>
<li>同样支持 JSR-303 校验注解（如 <code>@Min</code>, <code>@Email</code>），确保启动时配置合法。</li>
</ul>
</li>
<li><strong>场景</strong>：
<ul>
<li>数据库连接参数（URL、Username、Password）。</li>
<li>第三方接口的 AppKey 和超时时间。</li>
<li>业务自定义的开关或阈值。</li>
</ul>
</li>
<li><strong>示例</strong>：</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Component</span>
<span class="hljs-meta">@ConfigurationProperties(prefix = "app.sms")</span>
<span class="hljs-meta">@Validated</span> <span class="hljs-comment">// 开启配置参数校验</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SmsConfigCO</span> {
    
    <span class="hljs-meta">@NotBlank(message = "短信服务商Key不能为空")</span>
    <span class="hljs-keyword">private</span> String accessKey;

    <span class="hljs-meta">@Min(value = 1, message = "重试次数最少为1次")</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">Integer</span> <span class="hljs-variable">retryTimes</span> <span class="hljs-operator">=</span> <span class="hljs-number">3</span>; <span class="hljs-comment">// 默认值</span>

    <span class="hljs-keyword">private</span> List&lt;String&gt; whiteList; <span class="hljs-comment">// 支持列表类型绑定</span>

    <span class="hljs-comment">// 标准 Getter and Setter</span>
}
</code></pre>
<h3 data-id="heading-7">5.2 Command Object</h3>
<ul>
<li><strong>中文名称</strong>：命令对象 / 请求对象</li>
<li><strong>对应层次</strong>：控制层</li>
<li><strong>定义</strong>：专门用于接收前端（或调用方）传入的参数的对象。</li>
<li><strong>特点</strong>：
<ul>
<li>通常对应 Controller 的方法参数。</li>
<li>包含校验注解（如 <code>@NotNull</code>, <code>@Email</code>）。</li>
<li>有时也叫 <code>VO</code> (View Object) 或 <code>ReqDTO</code>。</li>
</ul>
</li>
<li><strong>场景</strong>：
<ul>
<li>前端提交的注册表单、查询条件等。</li>
</ul>
</li>
<li><strong>示例</strong>：</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 用户注册请求</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserRegisterCO</span> {
	<span class="hljs-meta">@NotBlank(message = "用户名不能为空")</span>
	<span class="hljs-keyword">private</span> String username;

	<span class="hljs-meta">@NotBlank(message = "密码不能为空")</span>
	<span class="hljs-keyword">private</span> String password;
}
</code></pre>
<h2 data-id="heading-8">6. QO</h2>
<blockquote>
<p>Query (Query Object)</p>
</blockquote>
<ul>
<li><strong>中文名称</strong>：查询对象</li>
<li><strong>对应层次</strong>：控制层 -&gt; 业务层 -&gt; 持久层</li>
<li><strong>定义</strong>：专门用于封装查询条件、分页参数和排序规则的对象。</li>
<li><strong>特点</strong>：
<ul>
<li>参数数量不固定，通常包含多个可选条件（如时间范围、模糊搜索）。</li>
<li>往往继承自一个基础的 <code>BaseQuery</code>（包含 <code>pageNum</code>, <code>pageSize</code> 等分页属性）。</li>
<li>字段通常是基本数据类型或简单对象，用于拼接 SQL 的 <code>WHERE</code> 子句。</li>
</ul>
</li>
<li><strong>场景</strong>：
<ul>
<li>后台管理系统的列表筛选（按状态、按日期、按关键词搜索）。</li>
<li>App 中的商品筛选（按价格区间、按品牌）。</li>
</ul>
</li>
<li><strong>示例</strong>：</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 用户列表查询条件</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserQuery</span> {
	<span class="hljs-keyword">private</span> <span class="hljs-type">Integer</span> <span class="hljs-variable">pageNum</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;      <span class="hljs-comment">// 当前页</span>
	<span class="hljs-keyword">private</span> <span class="hljs-type">Integer</span> <span class="hljs-variable">pageSize</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span>;    <span class="hljs-comment">// 每页条数</span>

	<span class="hljs-keyword">private</span> String keyword;           <span class="hljs-comment">// 关键词（搜姓名或手机号）</span>
	<span class="hljs-keyword">private</span> Integer status;           <span class="hljs-comment">// 状态（0-禁用，1-启用）</span>
	<span class="hljs-keyword">private</span> LocalDate startDate;      <span class="hljs-comment">// 注册开始时间</span>
	<span class="hljs-keyword">private</span> LocalDate endDate;        <span class="hljs-comment">// 注册结束时间</span>
	
	<span class="hljs-comment">// Getter and Setter...</span>
}
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[基于一次真实的Java生产Commit，对比国内外8款主流模型表现]]></title>    <link>https://juejin.cn/post/7596171325532864553</link>    <guid>https://juejin.cn/post/7596171325532864553</guid>    <pubDate>2026-01-18T15:05:57.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7596171325532864553" data-draft-id="7596476124839084074" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="基于一次真实的Java生产Commit，对比国内外8款主流模型表现"/> <meta itemprop="keywords" content="后端,AI编程"/> <meta itemprop="datePublished" content="2026-01-18T15:05:57.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="食尘者"/> <meta itemprop="url" content="https://juejin.cn/user/4075235699079676"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            基于一次真实的Java生产Commit，对比国内外8款主流模型表现
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4075235699079676/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    食尘者
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-18T15:05:57.000Z" title="Sun Jan 18 2026 15:05:57 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读18分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1 引言</h2>
<p>代码审查（Code Review）是软件开发中保证代码质量、统一编码规范、减少潜在缺陷的关键环节。近年来，基于大语言模型（LLM）的智能代码审查工具逐渐成为开发者的辅助手段，它们能够自动分析代码变更、识别潜在问题并提出改进建议。本文基于一次真实的Java生产项目的变更提交记录进行多模型横向对比，考察国内外主流大模型在Java代码审查任务上的表现。</p>
<h2 data-id="heading-1">2 评测背景与方法</h2>
<blockquote>
<p>本文基于真实评测记录整理，旨在客观反映各模型在特定任务上的表现，结果可能受评测场景、提示词设计、工具支持等因素影响，结论仅供参考。</p>
</blockquote>
<h3 data-id="heading-2">2.1 评测目标</h3>
<p>对比不同大模型在真实Java代码变更审查任务中的表现，重点考察其：</p>

































<table><thead><tr><th>维度</th><th>说明</th></tr></thead><tbody><tr><td><strong>问题识别准确性</strong></td><td>是否能准确识别代码变更的核心问题与潜在风险</td></tr><tr><td><strong>审查深度与广度</strong></td><td>是否从多角度分析（如代码质量、设计原则、可维护性、兼容性等）</td></tr><tr><td><strong>建议实用性</strong></td><td>提出的建议是否具体、可操作、有价值</td></tr><tr><td><strong>输出结构化程度</strong></td><td>报告是否结构清晰、逻辑分明、易于阅读</td></tr><tr><td><strong>风险意识</strong></td><td>是否识别出潜在的行为变化、边界情况、兼容性问题</td></tr><tr><td><strong>代码理解能力</strong></td><td>是否准确理解代码语义、重构动机、业务影响</td></tr></tbody></table>
<h3 data-id="heading-3">2.2 评测环境与模型</h3>




































































<table><thead><tr><th>模型名称</th><th>类别</th><th>版本信息</th><th>访问方式</th><th>使用工具</th></tr></thead><tbody><tr><td>Claude-Opus-4.5</td><td>国外模型</td><td>20251101</td><td>三方代理中转</td><td>Claude Code</td></tr><tr><td>Claude-Sonnet-4.5</td><td>国外模型</td><td>20250929</td><td>三方代理中转</td><td>Claude Code</td></tr><tr><td>GPT5.2</td><td>国外模型</td><td>-</td><td>Trae平台提供</td><td>Trae</td></tr><tr><td>Gemini-Pro-3-preview</td><td>国外模型</td><td>200K上下文</td><td>Trae平台提供</td><td>Trae</td></tr><tr><td>MiniMax-M2.1</td><td>国内模型</td><td>-</td><td>国外官网，Coding Plan套餐</td><td>Claude Code</td></tr><tr><td>GLM-4.7</td><td>国内模型</td><td>-</td><td>国内官网，Coding Plan套餐</td><td>Claude Code</td></tr><tr><td>Kimi-K2</td><td>国内模型</td><td>0905</td><td>Trae平台提供</td><td>Trae</td></tr><tr><td>DeepSeek-V3.1</td><td>国内模型</td><td>-</td><td>Trae平台提供</td><td>Trae</td></tr></tbody></table>
<h3 data-id="heading-4">2.3 评测任务</h3>
<ul>
<li>输入统一提示词：</li>
</ul>
<pre><code class="hljs language-ini" lang="ini">review 一下commit <span class="hljs-attr">id</span>=a1834e32c991eff7e0c678d9dacb9cdddfc51e9e的代码变动内容
</code></pre>
<ul>
<li>基于该commit的代码变更内容，进行多角度代码审查，代码变动内容为8个异常类，变动代码如下：</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">//ClientInfoServiceException.java，其它7个异常类的改动内容类似</span>
<span class="hljs-comment">//改动之前的代码</span>
  <span class="hljs-keyword">public</span> <span class="hljs-title function_">ClientInfoServiceException</span><span class="hljs-params">(String pattern, Object... arguments)</span> {
    <span class="hljs-built_in">super</span>(MessageFormat.format(ArrayUtils.isEmpty(arguments) ? replace(pattern) : pattern,
        arguments));
  }

  <span class="hljs-keyword">public</span> <span class="hljs-title function_">ClientInfoServiceException</span><span class="hljs-params">(Throwable cause)</span> {
  }

  <span class="hljs-keyword">public</span> <span class="hljs-title function_">ClientInfoServiceException</span><span class="hljs-params">(Throwable cause, String pattern, Object... arguments)</span> {
    <span class="hljs-built_in">super</span>(
        MessageFormat.format(ArrayUtils.isEmpty(arguments) ? replace(pattern) : pattern, arguments),
        cause);
  }


  <span class="hljs-keyword">protected</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">replace</span><span class="hljs-params">(String pattern)</span> {
    <span class="hljs-keyword">if</span> (StringUtil.isNullOrBlank(pattern)) {
      <span class="hljs-keyword">return</span> pattern;
    }
    <span class="hljs-keyword">return</span> pattern.replaceAll(<span class="hljs-string">"\\{"</span>, <span class="hljs-string">"\\["</span>).replaceAll(<span class="hljs-string">"\\}"</span>, <span class="hljs-string">"\\]"</span>);
  }

<span class="hljs-comment">//改动后提交的代码</span>
  <span class="hljs-keyword">public</span> <span class="hljs-title function_">ClientInfoServiceException</span><span class="hljs-params">(String pattern, Object... arguments)</span> {
    <span class="hljs-built_in">super</span>(formatPattern(pattern, arguments));
  }

  <span class="hljs-keyword">public</span> <span class="hljs-title function_">ClientInfoServiceException</span><span class="hljs-params">(Throwable cause)</span> {
  }

  <span class="hljs-keyword">public</span> <span class="hljs-title function_">ClientInfoServiceException</span><span class="hljs-params">(Throwable cause, String pattern, Object... arguments)</span> {
    <span class="hljs-built_in">super</span>(formatPattern(pattern, arguments), cause);
  }

  <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">formatPattern</span><span class="hljs-params">(String pattern, Object... arguments)</span> {
    <span class="hljs-keyword">if</span> (StringUtil.isNullOrBlank(pattern)) {
      <span class="hljs-keyword">return</span> pattern;
    }

    <span class="hljs-type">String</span> <span class="hljs-variable">formattedPattern</span> <span class="hljs-operator">=</span> ArrayUtils.isEmpty(arguments) ? replace(pattern) : pattern;
    <span class="hljs-keyword">return</span> MessageFormat.format(formattedPattern, arguments);
  }

  <span class="hljs-keyword">protected</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">replace</span><span class="hljs-params">(String pattern)</span> {
    <span class="hljs-keyword">if</span> (StringUtil.isNullOrBlank(pattern)) {
      <span class="hljs-keyword">return</span> pattern;
    }
    <span class="hljs-keyword">return</span> pattern.replaceAll(<span class="hljs-string">"\\{"</span>, <span class="hljs-string">"\\["</span>).replaceAll(<span class="hljs-string">"\\}"</span>, <span class="hljs-string">"\\]"</span>);
  }


</code></pre>
<h2 data-id="heading-5">3 评测结果</h2>
<blockquote>
<p>结论先行</p>
</blockquote>
<h3 data-id="heading-6">3.1 排名</h3>




































































<table><thead><tr><th>排名</th><th>模型</th><th>关键评价</th><th>架构层面贡献</th><th>分析深度</th></tr></thead><tbody><tr><td>1</td><td><strong>Claude-Opus-4.5</strong></td><td>全面性最强，结构化极佳，风险意识到位</td><td>提出基类抽取（继承方案）</td><td>⭐⭐⭐⭐⭐</td></tr><tr><td>2</td><td><strong>MiniMax-M2.1</strong></td><td><strong>架构洞察力最强，提出最实用重构方案</strong></td><td><strong>提出工具类抽取（组合方案）</strong></td><td>⭐⭐⭐⭐⭐</td></tr><tr><td>3</td><td><strong>Claude-Sonnet-4.5</strong></td><td>测试用例建议突出，实操性强</td><td>未提出架构重构</td><td>⭐⭐⭐⭐☆</td></tr><tr><td>4</td><td><strong>GLM-4.7</strong></td><td>结构化极佳，原则评估清晰</td><td>识别可见性问题但无重构方案</td><td>⭐⭐⭐⭐</td></tr><tr><td>5</td><td><strong>GPT5.2</strong></td><td>精炼、直击要害，风险识别准</td><td>无架构层面建议</td><td>⭐⭐⭐☆</td></tr><tr><td>6</td><td><strong>Gemini-3-Pro-Preview</strong></td><td>逻辑清晰，结论明确</td><td>无架构层面建议</td><td>⭐⭐⭐</td></tr><tr><td>7</td><td><strong>Kimi-K2</strong></td><td>简洁清晰，易于理解</td><td>无架构层面建议</td><td>⭐⭐☆</td></tr><tr><td>8</td><td><strong>DeepSeek-V3.1</strong></td><td>分析准确但文件覆盖不全</td><td>无架构层面建议</td><td>⭐⭐</td></tr></tbody></table>
<h3 data-id="heading-7">3.2 维度评分</h3>
<blockquote>
<p>5分制</p>
</blockquote>






















































































<table><thead><tr><th>模型</th><th>问题识别</th><th>架构洞察</th><th>建议实用</th><th>风险意识</th><th>输出结构</th><th><strong>综合</strong></th></tr></thead><tbody><tr><td>Claude-Opus-4.5</td><td>5</td><td>4</td><td>5</td><td>5</td><td>5</td><td><strong>4.8</strong></td></tr><tr><td>MiniMax-M2.1</td><td>5</td><td><strong>5</strong></td><td>5</td><td>5</td><td>4</td><td><strong>4.8</strong></td></tr><tr><td>Claude-Sonnet-4.5</td><td>5</td><td>3</td><td>4</td><td>5</td><td>5</td><td><strong>4.4</strong></td></tr><tr><td>GLM-4.7</td><td>4</td><td>3</td><td>4</td><td>4</td><td>5</td><td><strong>4.0</strong></td></tr><tr><td>GPT5.2</td><td>5</td><td>2</td><td>4</td><td>5</td><td>3</td><td><strong>3.8</strong></td></tr><tr><td>Gemini-3-Pro</td><td>4</td><td>2</td><td>3</td><td>4</td><td>4</td><td><strong>3.4</strong></td></tr><tr><td>Kimi-K2</td><td>3</td><td>1</td><td>2</td><td>3</td><td>4</td><td><strong>2.6</strong></td></tr><tr><td>DeepSeek-V3.1</td><td>2</td><td>1</td><td>2</td><td>2</td><td>4</td><td><strong>2.2</strong></td></tr></tbody></table>
<h2 data-id="heading-8">4 各模型详细表现</h2>
<h3 data-id="heading-9">4.1 Claude-Opus-4.5</h3>
<pre><code class="hljs language-typescript" lang="typescript"> 代码审查报告

  📋 变更概述

  <span class="hljs-title class_">Commit</span> <span class="hljs-attr">ID</span>: a1834e32c991eff7e0c678d9dacb9cdddfc51e9e
  目的: 优化 custom 框架异常类空指针时抛出的异常栈丢失
  影响范围: <span class="hljs-number">8</span> 个异常类文件

  ---
  ✅ 优点

  <span class="hljs-number">1.</span> 修复了空指针问题
    - 新增 <span class="hljs-title function_">formatPattern</span>() 方法在调用 <span class="hljs-title class_">MessageFormat</span>.<span class="hljs-title function_">format</span>() 前进行空值检查
    - 当 pattern 为 <span class="hljs-literal">null</span> 或空白时，直接返回原值，避免 <span class="hljs-title class_">NullPointerException</span>
  <span class="hljs-number">2.</span> 代码重构遵循 <span class="hljs-variable constant_">DRY</span> 原则
    - 将重复的格式化逻辑提取到 <span class="hljs-title function_">formatPattern</span>() 私有静态方法中
    - 减少了代码重复，提高可维护性
  <span class="hljs-number">3.</span> 代码格式统一
    - <span class="hljs-title class_">ZtoOAuthInvalidGrantException</span> 和 <span class="hljs-title class_">ZyOAuthInvalidGrantException</span> 的缩进从 <span class="hljs-number">4</span> 空格改为 <span class="hljs-number">2</span> 空格，与其他类保持一致

  ---
  ⚠️ 潜在问题与建议

  <span class="hljs-number">4.</span> 逻辑行为变化需确认

  问题: 原逻辑当 pattern=<span class="hljs-literal">null</span> 时会抛出 <span class="hljs-title class_">NullPointerException</span>，现在会传递 <span class="hljs-literal">null</span> 给 <span class="hljs-variable language_">super</span>()

  <span class="hljs-keyword">if</span> (<span class="hljs-title class_">StringUtil</span>.<span class="hljs-title function_">isNullOrBlank</span>(pattern)) {
      <span class="hljs-keyword">return</span> pattern;  <span class="hljs-comment">// pattern 为 null 时返回 null</span>
  }

  影响: 异常的 message 将为 <span class="hljs-literal">null</span>，调用 exception.<span class="hljs-title function_">getMessage</span>() 返回 <span class="hljs-literal">null</span>

  建议: 考虑是否应该返回空字符串或默认消息：
  <span class="hljs-keyword">if</span> (<span class="hljs-title class_">StringUtil</span>.<span class="hljs-title function_">isNullOrBlank</span>(pattern)) {
      <span class="hljs-keyword">return</span> pattern != <span class="hljs-literal">null</span> ? pattern : <span class="hljs-string">""</span>;  <span class="hljs-comment">// 或提供默认消息</span>
  }

  <span class="hljs-number">5.</span> 重复代码仍然存在（跨文件）

  <span class="hljs-number">8</span> 个异常类中 <span class="hljs-title function_">formatPattern</span>() 方法实现完全相同，违反 <span class="hljs-variable constant_">DRY</span> 原则。

  建议: 抽取到公共基类或工具类：
  <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AbstractCustomException</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Exception</span> {
      <span class="hljs-keyword">protected</span> <span class="hljs-keyword">static</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">formatPattern</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> pattern, <span class="hljs-built_in">Object</span>... <span class="hljs-variable language_">arguments</span></span>) {
          <span class="hljs-comment">// 统一实现</span>
      }
  }

  <span class="hljs-number">6.</span> <span class="hljs-title function_">replace</span>() 方法风格不一致

  <span class="hljs-title class_">ZtoOAuthInvalidGrantException</span> 和 <span class="hljs-title class_">ZyOAuthInvalidGrantException</span> 中的 <span class="hljs-title function_">replace</span>() 方法没有大括号：
  <span class="hljs-keyword">protected</span> <span class="hljs-keyword">static</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">replace</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> pattern</span>) {
      <span class="hljs-keyword">if</span> (<span class="hljs-title class_">StringUtil</span>.<span class="hljs-title function_">isNullOrBlank</span>(pattern))
          <span class="hljs-keyword">return</span> pattern;  <span class="hljs-comment">// 缺少大括号</span>
      <span class="hljs-keyword">return</span> pattern.<span class="hljs-title function_">replaceAll</span>(<span class="hljs-string">"\\{"</span>, <span class="hljs-string">"\\["</span>).<span class="hljs-title function_">replaceAll</span>(<span class="hljs-string">"\\}"</span>, <span class="hljs-string">"\\]"</span>);
  }

  其他类使用了大括号。建议统一代码风格。

  <span class="hljs-number">7.</span> 新增 <span class="hljs-keyword">import</span> 语句

  <span class="hljs-title class_">AuthorizationValidatorException</span>.<span class="hljs-property">java</span> 新增了 <span class="hljs-title class_">StringUtil</span> 导入，但其他被修改的文件已有此导入，需确认编译正常。

  ---
  📊 总结评分
  ┌────────────┬──────────┬─────────────────────────────────┐
  │    维度    │   评分   │              说明               │
  ├────────────┼──────────┼─────────────────────────────────┤
  │ 功能正确性 │ ⭐⭐⭐⭐ │ 解决了 <span class="hljs-variable constant_">NPE</span> 问题                 │
  ├────────────┼──────────┼─────────────────────────────────┤
  │ 代码质量   │ ⭐⭐⭐   │ 局部 <span class="hljs-variable constant_">DRY</span> 改进，但跨文件仍有重复 │
  ├────────────┼──────────┼─────────────────────────────────┤
  │ 向后兼容   │ ⭐⭐⭐   │ 行为有细微变化，需关注          │
  ├────────────┼──────────┼─────────────────────────────────┤
  │ 可维护性   │ ⭐⭐⭐⭐ │ 逻辑清晰，易于理解              │
  └────────────┴──────────┴─────────────────────────────────┘
  整体评价: 这是一个有效的 bug 修复，解决了空指针导致异常栈丢失的问题。建议后续考虑将 <span class="hljs-title function_">formatPattern</span>() 方法抽取到公共位置以完全消除代码重复。
</code></pre>
<h3 data-id="heading-10">4.2 Claude-Sonnet-4.5</h3>
<pre><code class="hljs language-typescript" lang="typescript">代码<span class="hljs-title class_">Review</span>报告

  <span class="hljs-title class_">Commit</span>信息

  - <span class="hljs-attr">ID</span>: a1834e32c
  - 作者: zhangsan
  - 日期: <span class="hljs-number">2026</span>-<span class="hljs-number">01</span>-<span class="hljs-number">16</span> <span class="hljs-number">16</span>:<span class="hljs-number">42</span>:<span class="hljs-number">10</span>
  - 主题: 优化custom框架异常类空指针时抛出的异常栈丢失

  ---
  ✅ 变更概述

  此commit对<span class="hljs-number">8</span>个异常类进行了统一重构，主要解决了当异常消息pattern为空时可能导致的<span class="hljs-variable constant_">NPE</span>和异常栈丢失问题。

  涉及文件：
  <span class="hljs-number">1.</span> <span class="hljs-title class_">ClientInfoServiceException</span>.<span class="hljs-property">java</span>
  <span class="hljs-number">2.</span> <span class="hljs-title class_">DuplicateRequestServiceException</span>.<span class="hljs-property">java</span>
  <span class="hljs-number">3.</span> <span class="hljs-title class_">CustomServiceException</span>.<span class="hljs-property">java</span>
  <span class="hljs-number">4.</span> <span class="hljs-title class_">PromptException</span>.<span class="hljs-property">java</span>
  <span class="hljs-number">5.</span> <span class="hljs-title class_">AuthorizationValidatorException</span>.<span class="hljs-property">java</span>
  <span class="hljs-number">6.</span> <span class="hljs-title class_">ETLExecuteException</span>.<span class="hljs-property">java</span>
  <span class="hljs-number">7.</span> <span class="hljs-title class_">ZtoOAuthInvalidGrantException</span>.<span class="hljs-property">java</span>
  <span class="hljs-number">8.</span> <span class="hljs-title class_">ZyOAuthInvalidGrantException</span>.<span class="hljs-property">java</span>

  ---
  🎯 核心改进点

  <span class="hljs-number">1.</span> <span class="hljs-variable constant_">DRY</span>原则应用 ✅

  将重复的格式化逻辑提取到私有静态方法：
  <span class="hljs-comment">// 重构前：两处重复代码</span>
  <span class="hljs-variable language_">super</span>(<span class="hljs-title class_">MessageFormat</span>.<span class="hljs-title function_">format</span>(<span class="hljs-title class_">ArrayUtils</span>.<span class="hljs-title function_">isEmpty</span>(<span class="hljs-variable language_">arguments</span>) ? <span class="hljs-title function_">replace</span>(pattern) : pattern, <span class="hljs-variable language_">arguments</span>));

  <span class="hljs-comment">// 重构后：统一调用</span>
  <span class="hljs-variable language_">super</span>(<span class="hljs-title function_">formatPattern</span>(pattern, <span class="hljs-variable language_">arguments</span>));

  <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">formatPattern</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> pattern, <span class="hljs-built_in">Object</span>... <span class="hljs-variable language_">arguments</span></span>) {
      <span class="hljs-keyword">if</span> (<span class="hljs-title class_">StringUtil</span>.<span class="hljs-title function_">isNullOrBlank</span>(pattern)) {
          <span class="hljs-keyword">return</span> pattern;  <span class="hljs-comment">// 空值防护，避免NPE</span>
      }
      <span class="hljs-title class_">String</span> formattedPattern = <span class="hljs-title class_">ArrayUtils</span>.<span class="hljs-title function_">isEmpty</span>(<span class="hljs-variable language_">arguments</span>) ? <span class="hljs-title function_">replace</span>(pattern) : pattern;
      <span class="hljs-keyword">return</span> <span class="hljs-title class_">MessageFormat</span>.<span class="hljs-title function_">format</span>(formattedPattern, <span class="hljs-variable language_">arguments</span>);
  }

  <span class="hljs-number">2.</span> 空指针防护 ✅

  新增空值检查逻辑：
  - 当 pattern 为 <span class="hljs-literal">null</span> 或空白时，直接返回原值
  - 避免 <span class="hljs-title class_">MessageFormat</span>.<span class="hljs-title function_">format</span>(<span class="hljs-literal">null</span>, ...) 抛出 <span class="hljs-title class_">IllegalArgumentException</span>
  - 关键：保留了原始异常的堆栈信息（符合commit目标）

  <span class="hljs-number">3.</span> 代码格式统一 ✅

  对 <span class="hljs-title class_">ZtoOAuthInvalidGrantException</span> 和 <span class="hljs-title class_">ZyOAuthInvalidGrantException</span> 进行了缩进格式化（<span class="hljs-number">2</span>空格 → 标准格式）

  ---
  🔍 潜在问题与建议

  ⚠️ 问题<span class="hljs-number">1</span>：边界情况处理不完整

  场景：当 pattern 为空字符串 <span class="hljs-string">""</span> 但 <span class="hljs-variable language_">arguments</span> 不为空时
  <span class="hljs-comment">// 当前代码：</span>
  <span class="hljs-keyword">if</span> (<span class="hljs-title class_">StringUtil</span>.<span class="hljs-title function_">isNullOrBlank</span>(pattern)) {
      <span class="hljs-keyword">return</span> pattern;  <span class="hljs-comment">// 返回 ""</span>
  }
  <span class="hljs-comment">// MessageFormat.format("", arguments) 仍可能抛出异常</span>

  建议：
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">formatPattern</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> pattern, <span class="hljs-built_in">Object</span>... <span class="hljs-variable language_">arguments</span></span>) {
      <span class="hljs-keyword">if</span> (<span class="hljs-title class_">StringUtil</span>.<span class="hljs-title function_">isNullOrBlank</span>(pattern)) {
          <span class="hljs-keyword">return</span> pattern;
      }

      <span class="hljs-keyword">try</span> {
          <span class="hljs-title class_">String</span> formattedPattern = <span class="hljs-title class_">ArrayUtils</span>.<span class="hljs-title function_">isEmpty</span>(<span class="hljs-variable language_">arguments</span>) ? <span class="hljs-title function_">replace</span>(pattern) : pattern;
          <span class="hljs-keyword">return</span> <span class="hljs-title class_">MessageFormat</span>.<span class="hljs-title function_">format</span>(formattedPattern, <span class="hljs-variable language_">arguments</span>);
      } <span class="hljs-keyword">catch</span> (<span class="hljs-title class_">IllegalArgumentException</span> e) {
          <span class="hljs-comment">// 格式化失败时返回原始pattern，保留异常栈</span>
          <span class="hljs-keyword">return</span> pattern;
      }
  }

  ⚠️ 问题<span class="hljs-number">2</span>：缺少单元测试

  建议：针对核心场景补充测试用例
  <span class="hljs-meta">@Test</span>
  <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">testNullPatternPreservesStackTrace</span>(<span class="hljs-params"/>) {
      <span class="hljs-title class_">Throwable</span> cause = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"root cause"</span>);
      <span class="hljs-title class_">CustomServiceException</span> ex = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CustomServiceException</span>(cause, <span class="hljs-literal">null</span>);

      <span class="hljs-title function_">assertNotNull</span>(ex.<span class="hljs-title function_">getCause</span>());
      <span class="hljs-title function_">assertEquals</span>(<span class="hljs-string">"root cause"</span>, ex.<span class="hljs-title function_">getCause</span>().<span class="hljs-title function_">getMessage</span>());
  }

  <span class="hljs-meta">@Test</span>
  <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">testEmptyPatternWithArguments</span>(<span class="hljs-params"/>) {
      <span class="hljs-comment">// 验证边界情况处理</span>
  }

  💡 问题<span class="hljs-number">3</span>：依赖引入

  <span class="hljs-title class_">AuthorizationValidatorException</span> 新增了 <span class="hljs-title class_">StringUtil</span> 依赖：
  +<span class="hljs-keyword">import</span> com.<span class="hljs-property">hd123</span>.<span class="hljs-property">rumba</span>.<span class="hljs-property">commons</span>.<span class="hljs-property">lang</span>.<span class="hljs-property">StringUtil</span>;
  ✅ 评价：合理，与其他异常类保持一致

  ---
  📊 代码质量评估
  ┌──────────┬────────────┬──────────────────────────────┐
  │  评估项  │    评分    │             说明             │
  ├──────────┼────────────┼──────────────────────────────┤
  │ <span class="hljs-variable constant_">DRY</span>原则  │ ⭐⭐⭐⭐⭐ │ 完美消除重复代码             │
  ├──────────┼────────────┼──────────────────────────────┤
  │ <span class="hljs-variable constant_">KISS</span>原则 │ ⭐⭐⭐⭐   │ 逻辑清晰简洁                 │
  ├──────────┼────────────┼──────────────────────────────┤
  │ 异常处理 │ ⭐⭐⭐     │ 基本防护到位，边界情况可加强 │
  ├──────────┼────────────┼──────────────────────────────┤
  │ 可测试性 │ ⭐⭐⭐     │ 缺少配套测试用例             │
  ├──────────┼────────────┼──────────────────────────────┤
  │ 向后兼容 │ ⭐⭐⭐⭐⭐ │ 完全兼容，仅内部重构         │
  └──────────┴────────────┴──────────────────────────────┘
  ---
  ✅ 最终评价

  总体评分：<span class="hljs-number">8</span>/<span class="hljs-number">10</span>

  优点：
  <span class="hljs-number">4.</span> ✅ 成功解决了异常栈丢失问题（核心目标达成）
  <span class="hljs-number">5.</span> ✅ 代码重构遵循<span class="hljs-variable constant_">DRY</span>和单一职责原则
  <span class="hljs-number">6.</span> ✅ 统一处理了<span class="hljs-number">8</span>个异常类，保持代码库一致性
  <span class="hljs-number">7.</span> ✅ 向后兼容，无破坏性变更

  改进建议：
  <span class="hljs-number">8.</span> 🔧 增强边界情况异常处理（<span class="hljs-keyword">try</span>-<span class="hljs-keyword">catch</span>包裹<span class="hljs-title class_">MessageFormat</span>.<span class="hljs-property">format</span>）
  <span class="hljs-number">9.</span> 🧪 补充单元测试覆盖核心场景
  <span class="hljs-number">10.</span> 📝 考虑在commit message中说明具体修复的场景案例

  ---
  🎯 结论

  这是一次高质量的代码优化重构，有效解决了实际问题并提升了代码可维护性。建议合并前补充测试用例以保障稳定性。
</code></pre>
<h3 data-id="heading-11">4.3 GLM-4.7</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">Commit</span> 代码审查报告

  <span class="hljs-keyword">Commit</span>信息： a1834e32c <span class="hljs-operator">-</span> 优化custom框架异常类空指针时抛出的异常栈丢失

  📊 变更概览

  <span class="hljs-operator">-</span> 影响文件： <span class="hljs-number">8</span>个异常类
  <span class="hljs-operator">-</span> 代码量： <span class="hljs-operator">+</span><span class="hljs-number">120</span> <span class="hljs-operator">/</span> <span class="hljs-number">-70</span> 行

  <span class="hljs-comment">---</span>
  ✅ 变更目的分析

  问题定位：
  原代码在 <span class="hljs-keyword">pattern</span> 为 <span class="hljs-keyword">null</span> 时会直接调用 MessageFormat.format(<span class="hljs-keyword">null</span>, arguments)，抛出 NullPointerException，覆盖原始异常堆栈信息。

  解决方案：
  提取公共的 formatPattern 方法，增加空值检查：
  if (StringUtil.isNullOrBlank(<span class="hljs-keyword">pattern</span>)) {
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">pattern</span>;  <span class="hljs-operator">/</span><span class="hljs-operator">/</span> 提前返回，避免NPE
  }

  <span class="hljs-comment">---</span>
  🎯 原则符合度
  ┌─────────┬─────────┬────────────────────────────┐
  │  原则   │  评价   │            说明            │
  ├─────────┼─────────┼────────────────────────────┤
  │ DRY     │ ✅ 优秀 │ 消除了重复的消息格式化逻辑 │
  ├─────────┼─────────┼────────────────────────────┤
  │ KISS    │ ✅ 良好 │ 逻辑清晰，易于理解         │
  ├─────────┼─────────┼────────────────────────────┤
  │ SOLID<span class="hljs-operator">-</span>S │ ✅ 良好 │ 职责单一，专注格式化       │
  └─────────┴─────────┴────────────────────────────┘
  <span class="hljs-comment">---</span>
  ⚠️ 发现的问题

  <span class="hljs-number">1.</span> 代码风格不一致 (P2 <span class="hljs-operator">-</span> 中等)

  ZtoOAuthInvalidGrantException.java:<span class="hljs-number">44</span> 和 ZyOAuthInvalidGrantException.java:<span class="hljs-number">44</span>
  <span class="hljs-operator">/</span><span class="hljs-operator">/</span> 这两个文件末尾缺少换行符
  }
  \ <span class="hljs-keyword">No</span> newline <span class="hljs-keyword">at</span> <span class="hljs-keyword">end</span> <span class="hljs-keyword">of</span> file

  建议： 添加文件末尾换行符，符合POSIX标准。

  <span class="hljs-comment">---</span>
  <span class="hljs-number">2.</span> import语句不统一 (P3 <span class="hljs-operator">-</span> 较低)

  AuthorizationValidatorException.java 新增了 StringUtil import，但其他异常类本应已有该import。建议统一import风格。

  <span class="hljs-comment">---</span>
  <span class="hljs-number">3.</span> 方法可见性设计可优化 (P2 <span class="hljs-operator">-</span> 中等)

  当前设计：
  private <span class="hljs-keyword">static</span> String formatPattern(...)  <span class="hljs-operator">/</span><span class="hljs-operator">/</span> 私有，子类无法复用
  protected <span class="hljs-keyword">static</span> String replace(...)      <span class="hljs-operator">/</span><span class="hljs-operator">/</span> 受保护，子类可用

  潜在问题： 如果有子类继承这些异常类并需要自定义格式化逻辑，无法复用 formatPattern 方法。

  建议方案：
  <span class="hljs-operator">-</span> 保持 private <span class="hljs-operator">-</span> 如果确认不需要子类复用（当前场景适用）
  <span class="hljs-operator">-</span> 或改为 protected <span class="hljs-operator">-</span> 如果有扩展需求（需评估）

  <span class="hljs-comment">---</span>
  ✅ 优点总结

  <span class="hljs-number">1.</span> 防御性编程： 空值检查有效防止NPE覆盖原始堆栈
  <span class="hljs-number">2.</span> 代码复用： 符合DRY原则，减少重复代码
  <span class="hljs-number">3.</span> 语义清晰： formatPattern 方法名准确表达其功能
  <span class="hljs-number">4.</span> 影响范围可控： 仅修改异常类，不影响业务逻辑

  <span class="hljs-comment">---</span>
  🔍 建议改进
  ┌────────┬────────────────────────────────────────────────────┬─────────────────────────────────────────────────────────────────────────────┐
  │ 优先级 │                        建议                        │                                    位置                                     │
  ├────────┼────────────────────────────────────────────────────┼─────────────────────────────────────────────────────────────────────────────┤
  │ P1     │ 添加文件末尾换行符                                 │ ZtoOAuthInvalidGrantException.java:<span class="hljs-number">46</span>, ZyOAuthInvalidGrantException.java:<span class="hljs-number">46</span> │
  ├────────┼────────────────────────────────────────────────────┼─────────────────────────────────────────────────────────────────────────────┤
  │ P2     │ 评估是否需要统一代码格式（indent从<span class="hljs-number">4</span>空格改为<span class="hljs-number">2</span>空格） │ ZtoOAuthInvalidGrantException.java, ZyOAuthInvalidGrantException.java       │
  ├────────┼────────────────────────────────────────────────────┼─────────────────────────────────────────────────────────────────────────────┤
  │ P3     │ 考虑添加单元测试覆盖 <span class="hljs-keyword">pattern</span><span class="hljs-operator">=</span><span class="hljs-keyword">null</span> 场景             │ 新增测试类                                                                  │
  └────────┴────────────────────────────────────────────────────┴─────────────────────────────────────────────────────────────────────────────┘
  <span class="hljs-comment">---</span>
  📝 审查结论

  总体评价： ✅ 良好

  这是一个质量较高的bug修复提交，有效解决了异常堆栈信息丢失的问题。代码变更符合工程最佳实践，建议在后续提交中修复P1级别的格式问题。
</code></pre>
<h3 data-id="heading-12">4.4 MiniMax-M2.1</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title class_">Code</span> <span class="hljs-title class_">Review</span> - <span class="hljs-title class_">Commit</span> a1834e32c

  📋 提交信息

  - <span class="hljs-title class_">Commit</span> <span class="hljs-attr">ID</span>: a1834e32c
  - 标题: 优化custom框架异常类空指针时抛出的异常栈丢失
  - 作者: zhangsan
  - 日期: <span class="hljs-number">2026</span>-<span class="hljs-number">01</span>-<span class="hljs-number">16</span>

  ---
  📊 变更概览
  ┌────────────┬────────────┐
  │    指标    │    数值    │
  ├────────────┼────────────┤
  │ 修改文件数 │ <span class="hljs-number">8</span> 个异常类 │
  ├────────────┼────────────┤
  │ 新增行数   │ <span class="hljs-number">120</span>        │
  ├────────────┼────────────┤
  │ 删除行数   │ <span class="hljs-number">70</span>         │
  ├────────────┼────────────┤
  │ 净增行数   │ +<span class="hljs-number">50</span>        │
  └────────────┴────────────┘
  ---
  🎯 核心改动分析

  <span class="hljs-number">1.</span> 提取公共方法（<span class="hljs-variable constant_">DRY</span>原则）

  <span class="hljs-comment">// 改动前：格式化逻辑内联在构造函数中</span>
  <span class="hljs-variable language_">super</span>(<span class="hljs-title class_">MessageFormat</span>.<span class="hljs-title function_">format</span>(<span class="hljs-title class_">ArrayUtils</span>.<span class="hljs-title function_">isEmpty</span>(<span class="hljs-variable language_">arguments</span>) ? <span class="hljs-title function_">replace</span>(pattern) : pattern, <span class="hljs-variable language_">arguments</span>));

  <span class="hljs-comment">// 改动后：提取为独立的 formatPattern 方法</span>
  <span class="hljs-variable language_">super</span>(<span class="hljs-title function_">formatPattern</span>(pattern, <span class="hljs-variable language_">arguments</span>));

  <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">formatPattern</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> pattern, <span class="hljs-built_in">Object</span>... <span class="hljs-variable language_">arguments</span></span>) {
      <span class="hljs-keyword">if</span> (<span class="hljs-title class_">StringUtil</span>.<span class="hljs-title function_">isNullOrBlank</span>(pattern)) {
          <span class="hljs-keyword">return</span> pattern;
      }
      <span class="hljs-title class_">String</span> formattedPattern = <span class="hljs-title class_">ArrayUtils</span>.<span class="hljs-title function_">isEmpty</span>(<span class="hljs-variable language_">arguments</span>) ? <span class="hljs-title function_">replace</span>(pattern) : pattern;
      <span class="hljs-keyword">return</span> <span class="hljs-title class_">MessageFormat</span>.<span class="hljs-title function_">format</span>(formattedPattern, <span class="hljs-variable language_">arguments</span>);
  }

  <span class="hljs-number">2.</span> 增加空值保护

  <span class="hljs-keyword">if</span> (<span class="hljs-title class_">StringUtil</span>.<span class="hljs-title function_">isNullOrBlank</span>(pattern)) {
      <span class="hljs-keyword">return</span> pattern;  <span class="hljs-comment">// 提前返回，避免空指针</span>
  }

  ---
  ✅ 优点
  ┌────────────────┬─────────────────────────────────────────────┐
  │      方面      │                    说明                     │
  ├────────────────┼─────────────────────────────────────────────┤
  │ 代码复用 (<span class="hljs-variable constant_">DRY</span>) │ 消除了 <span class="hljs-number">8</span> 个类中重复的格式化逻辑，统一维护点 │
  ├────────────────┼─────────────────────────────────────────────┤
  │ 可读性提升     │ 构造函数更简洁，意图更清晰                  │
  ├────────────────┼─────────────────────────────────────────────┤
  │ 扩展性增强     │ 修改格式化逻辑只需改一处                    │
  ├────────────────┼─────────────────────────────────────────────┤
  │ 防御性编程     │ 增加了空值检查，避免潜在的 <span class="hljs-variable constant_">NPE</span>              │
  ├────────────────┼─────────────────────────────────────────────┤
  │ 一致性         │ 所有异常类采用相同的处理模式                │
  └────────────────┴─────────────────────────────────────────────┘
  ---
  ⚠️ 潜在问题

  <span class="hljs-number">1.</span> 空值处理逻辑存疑

  <span class="hljs-keyword">if</span> (<span class="hljs-title class_">StringUtil</span>.<span class="hljs-title function_">isNullOrBlank</span>(pattern)) {
      <span class="hljs-keyword">return</span> pattern;  <span class="hljs-comment">// 返回 null 或 ""</span>
  }
  <span class="hljs-comment">// 后续 MessageFormat.format 会接收到 null</span>

  问题： 当 pattern 为 <span class="hljs-literal">null</span> 时，直接返回 <span class="hljs-literal">null</span> 仍可能导致 <span class="hljs-title class_">MessageFormat</span>.<span class="hljs-property">format</span> 抛出 <span class="hljs-title class_">NullPointerException</span>，并未真正解决问题。

  建议：
  <span class="hljs-keyword">if</span> (<span class="hljs-title class_">StringUtil</span>.<span class="hljs-title function_">isNullOrBlank</span>(pattern)) {
      <span class="hljs-keyword">return</span> pattern != <span class="hljs-literal">null</span> ? pattern : <span class="hljs-string">""</span>;  <span class="hljs-comment">// 返回空字符串更安全</span>
  }

  <span class="hljs-number">2.</span> <span class="hljs-variable language_">arguments</span> 数组元素未检查

  <span class="hljs-title class_">MessageFormat</span>.<span class="hljs-property">format</span> 当 <span class="hljs-variable language_">arguments</span> 数组中包含 <span class="hljs-literal">null</span> 元素时仍可能抛出 <span class="hljs-variable constant_">NPE</span>，当前未对此进行处理。

  <span class="hljs-number">3.</span> 方法访问权限不一致

  - 大部分类：<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-title class_">String</span> formatPattern
  - <span class="hljs-title class_">Zto</span>/<span class="hljs-title class_">Zy</span> 异常类：<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-title class_">String</span> formatPattern（但从 <span class="hljs-keyword">protected</span> 的 replace 方法改为私有可能影响子类扩展）

  <span class="hljs-number">4.</span> <span class="hljs-title class_">ZtoOAuthInvalidGrantException</span>/<span class="hljs-title class_">ZyOAuthInvalidGrantException</span> 额外改动

  这两个类还进行了代码格式化（缩进从<span class="hljs-number">2</span>空格改为一致），属于次要改动，建议与核心逻辑分开提交。

  ---
  🏗️ <span class="hljs-variable constant_">SOLID</span> 原则评估
  ┌──────────────┬────────┬────────────────────────────────────────┐
  │     原则     │ 符合度 │                  说明                  │
  ├──────────────┼────────┼────────────────────────────────────────┤
  │ S (单一职责) │ ✅     │ formatPattern 方法职责明确：格式化消息 │
  ├──────────────┼────────┼────────────────────────────────────────┤
  │ O (开闭)     │ ⚠️     │ <span class="hljs-keyword">private</span> 方法限制了子类扩展性           │
  ├──────────────┼────────┼────────────────────────────────────────┤
  │ L (里氏替换) │ ✅     │ 不影响继承体系                         │
  ├──────────────┼────────┼────────────────────────────────────────┤
  │ I (接口隔离) │ ✅     │ 不涉及接口                             │
  ├──────────────┼────────┼────────────────────────────────────────┤
  │ D (依赖倒置) │ ✅     │ 依赖抽象的 <span class="hljs-title class_">MessageFormat</span>               │
  └──────────────┴────────┴────────────────────────────────────────┘
  ---
  📝 改进建议

  <span class="hljs-number">5.</span> 空值处理增强：
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">formatPattern</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> pattern, <span class="hljs-built_in">Object</span>... <span class="hljs-variable language_">arguments</span></span>) {
      <span class="hljs-keyword">if</span> (<span class="hljs-title class_">StringUtil</span>.<span class="hljs-title function_">isNullOrBlank</span>(pattern)) {
          <span class="hljs-keyword">return</span> <span class="hljs-title class_">StringUtil</span>.<span class="hljs-title function_">trimToEmpty</span>(pattern);  <span class="hljs-comment">// 返回空字符串而非 null</span>
      }
      <span class="hljs-title class_">String</span> formattedPattern = <span class="hljs-title class_">ArrayUtils</span>.<span class="hljs-title function_">isEmpty</span>(<span class="hljs-variable language_">arguments</span>) ? <span class="hljs-title function_">replace</span>(pattern) : pattern;
      <span class="hljs-keyword">try</span> {
          <span class="hljs-keyword">return</span> <span class="hljs-title class_">MessageFormat</span>.<span class="hljs-title function_">format</span>(formattedPattern, <span class="hljs-variable language_">arguments</span>);
      } <span class="hljs-keyword">catch</span> (<span class="hljs-title class_">Exception</span> e) {
          <span class="hljs-keyword">return</span> formattedPattern;  <span class="hljs-comment">// 格式化失败时返回原始模式</span>
      }
  }
  <span class="hljs-number">6.</span> 增加单元测试，覆盖以下场景：
    - pattern 为 <span class="hljs-literal">null</span>
    - pattern 为空字符串
    - <span class="hljs-variable language_">arguments</span> 包含 <span class="hljs-literal">null</span> 元素
    - <span class="hljs-variable language_">arguments</span> 为空数组
  <span class="hljs-number">7.</span> 考虑使用工具类：如果多个异常类都需要这个逻辑，可以提取到公共工具类

  ---
  📌 总体评价
  ┌──────────┬────────────────────────┐
  │   评分   │          说明          │
  ├──────────┼────────────────────────┤
  │ 代码质量 │ ⭐⭐⭐⭐☆ 良好         │
  ├──────────┼────────────────────────┤
  │ 风险等级 │ 🟡 低-中风险           │
  ├──────────┼────────────────────────┤
  │ 建议     │ 合并前补充边界条件测试 │
  └──────────┴────────────────────────┘
  总结： 这是一个遵循 <span class="hljs-variable constant_">DRY</span> 原则的良好重构，主要提升了代码可维护性和一致性。但空值处理逻辑存在潜在问题，建议加强边界条件处理并补充测试用例。
</code></pre>
<h3 data-id="heading-13">4.5 GPT5.2</h3>
<pre><code class="hljs language-markdown" lang="markdown">变更概览（commit a1834e32c991eff7e0c678d9dacb9cdddfc51e9e）

<span class="hljs-bullet">-</span> 提交信息：优化 custom 框架异常类在 pattern 为空时导致的异常栈丢失
<span class="hljs-bullet">-</span> 影响文件（8 个，均为异常类构造器逻辑调整）
<span class="hljs-bullet">  -</span> ClientInfoServiceException.java
<span class="hljs-bullet">  -</span> DuplicateRequestServiceException.java
<span class="hljs-bullet">  -</span> CustomServiceException.java
<span class="hljs-bullet">  -</span> PromptException.java
<span class="hljs-bullet">  -</span> AuthorizationValidatorException.java
<span class="hljs-bullet">  -</span> ETLExecuteException.java
<span class="hljs-bullet">  -</span> ZtoOAuthInvalidGrantException.java
<span class="hljs-bullet">  -</span> ZyOAuthInvalidGrantException.java
核心改动点（做了什么）

<span class="hljs-bullet">-</span> 把各异常类里直接 MessageFormat.format(...) 的拼消息逻辑抽成 formatPattern(pattern, arguments) ：
<span class="hljs-bullet">  -</span> 先判断 pattern 为空/空白时直接返回（避免 MessageFormat.format(null, ...) 触发 NPE）。
<span class="hljs-bullet">  -</span> 非空时：仍保留原有逻辑（无参数时会先做 replace(pattern) ，把 {} 替换成 [] 之类的处理；有参数时按原 pattern 格式化）。
<span class="hljs-bullet">-</span> 对于带 cause 的构造器，从“先 format 再传 cause”改为“安全 format 后再 super(message, cause) ”，避免在 format 阶段抛异常导致原 cause 栈无法正确挂到目标异常上。
<span class="hljs-bullet">-</span> AuthorizationValidatorException 额外引入了 StringUtil.isNullOrBlank 用于空判断（并新增 import），其 replace 仍使用 StringUtils.isBlank 。
意图与收益（为什么这样改）

<span class="hljs-bullet">-</span> 解决点：当 pattern == null （或某些空白场景）时，旧实现会在 MessageFormat.format(...) 处抛出 NPE，最终抛出的不是你期望的业务异常/封装异常，从而表现为“异常栈丢失/不对”。
<span class="hljs-bullet">-</span> 新实现：在 pattern 为空时让异常对象仍能被构造出来（message 允许为 null），并且 cause 能稳定保留。
风险与建议（评审关注点）

<span class="hljs-bullet">-</span> 行为变化： pattern 为空时不再抛 NPE，而是生成 message 为空的异常；这符合“保留原栈/不中断封装”的目标，但也意味着某些日志里 message 可能变空（可接受的话没问题）。
<span class="hljs-bullet">-</span> 仍可能抛出的情况： pattern 非空但格式非法（如不匹配的 { ）时， MessageFormat 仍会抛 IllegalArgumentException ；该提交未覆盖此类输入（通常也不应静默吞掉）。
<span class="hljs-bullet">-</span> 格式细节： Zto/Zy 两个文件还包含纯缩进调整与文件末尾无换行（ \ No newline at end of file ），可能带来不必要的 diff 噪音。
建议验证

<span class="hljs-bullet">-</span> 加一组回归验证用例/手工验证路径：对上述每个异常类分别传入
<span class="hljs-bullet">  -</span> new XxxException((String) null) 、 new XxxException(cause, (String) null) 、 new XxxException("", args...)
<span class="hljs-bullet">  -</span> 确认：不会因 format 抛 NPE；带 cause 的异常 getCause() 与堆栈链路保持预期。
</code></pre>
<h3 data-id="heading-14">4.6 Gemini-3-Pro-Preview</h3>
<pre><code class="hljs language-typescript" lang="typescript">这是一份针对 commit a1834e32c991eff7e0c678d9dacb9cdddfc51e9e 的代码审查报告。

### 变更概述
- 提交信息 : 优化custom框架异常类空指针时抛出的异常栈丢失
- 作者 : zhangsan
- 涉及范围 : 修改了 custom-commons-biz , custom-commons-core , custom-webframe 模块下的 <span class="hljs-number">8</span> 个自定义异常类 。
### 核心变更内容
此次提交主要重构了异常类的构造函数，将原本直接写在 <span class="hljs-variable language_">super</span>(...) 调用中的消息格式化逻辑提取为了一个私有静态方法 formatPattern ，并增加了空值保护。

修改前 (以 <span class="hljs-title class_">ClientInfoServiceException</span> 为例):

<span class="hljs-keyword">public</span> <span class="hljs-title class_">ClientInfoServiceException</span>(<span class="hljs-title class_">String</span> pattern, <span class="hljs-title class_">Object</span>... <span class="hljs-variable language_">arguments</span>) {
  <span class="hljs-comment">// 逻辑嵌套在 super 中，如果 pattern 为 null，MessageFormat.format 可能会抛出异常</span>
  <span class="hljs-variable language_">super</span>(<span class="hljs-title class_">MessageFormat</span>.<span class="hljs-title function_">format</span>(<span class="hljs-title class_">ArrayUtils</span>.<span class="hljs-title function_">isEmpty</span>(<span class="hljs-variable language_">arguments</span>) ? <span class="hljs-title function_">replace</span>(pattern) : 
  pattern,
      <span class="hljs-variable language_">arguments</span>));
}
修改后:

<span class="hljs-keyword">public</span> <span class="hljs-title class_">ClientInfoServiceException</span>(<span class="hljs-title class_">String</span> pattern, <span class="hljs-title class_">Object</span>... <span class="hljs-variable language_">arguments</span>) {
  <span class="hljs-comment">// 调用提取出的安全格式化方法</span>
  <span class="hljs-variable language_">super</span>(<span class="hljs-title function_">formatPattern</span>(pattern, <span class="hljs-variable language_">arguments</span>));
}

<span class="hljs-comment">// 新增的辅助方法</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">formatPattern</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> pattern, <span class="hljs-built_in">Object</span>... <span class="hljs-variable language_">arguments</span></span>) {
  <span class="hljs-comment">// 1. 增加了空值检查，防止 pattern 为 null 时后续逻辑报错</span>
  <span class="hljs-keyword">if</span> (<span class="hljs-title class_">StringUtil</span>.<span class="hljs-title function_">isNullOrBlank</span>(pattern)) {
    <span class="hljs-keyword">return</span> pattern;
  }
  <span class="hljs-comment">// 2. 原有的格式化逻辑保持不变</span>
  <span class="hljs-title class_">String</span> formattedPattern = <span class="hljs-title class_">ArrayUtils</span>.<span class="hljs-title function_">isEmpty</span>(<span class="hljs-variable language_">arguments</span>) ? <span class="hljs-title function_">replace</span>(pattern) : 
  pattern;
  <span class="hljs-keyword">return</span> <span class="hljs-title class_">MessageFormat</span>.<span class="hljs-title function_">format</span>(formattedPattern, <span class="hljs-variable language_">arguments</span>);
}
### 审查评价
<span class="hljs-number">1.</span> 修复了潜在的 <span class="hljs-variable constant_">NPE</span> 隐患 (<span class="hljs-title class_">Bug</span> <span class="hljs-title class_">Fix</span>) :
   
   - 在修改前，如果传入的 pattern 为 <span class="hljs-literal">null</span> ，直接调用 <span class="hljs-title class_">MessageFormat</span>.<span class="hljs-property">format</span> 可能会导致 <span class="hljs-title class_">NullPointerException</span> 或其他非预期行为。
   - 因为这个异常是在 异常类的构造函数 中抛出的，它会掩盖原本想要抛出的业务异常，导致真正的错误堆栈丢失（即 <span class="hljs-title class_">Commit</span> <span class="hljs-title class_">Message</span> 中提到的问题）。
   - 修改后， formatPattern 会先判断空值并安全返回，确保异常对象能被正常创建。
<span class="hljs-number">2.</span> 代码可读性提升 (<span class="hljs-title class_">Refactoring</span>) :
   
   - 将复杂的单行三元运算符逻辑提取为独立方法，使构造函数更加清晰。
<span class="hljs-number">3.</span> 涉及的类列表 :
   此次修改覆盖了以下异常类，保持了处理逻辑的一致性：
   
   - <span class="hljs-title class_">ClientInfoServiceException</span>
   - <span class="hljs-title class_">DuplicateRequestServiceException</span>
   - <span class="hljs-title class_">CustomServiceException</span>
   - <span class="hljs-title class_">PromptException</span>
   - <span class="hljs-title class_">AuthorizationValidatorException</span> (同时补充了 <span class="hljs-keyword">import</span>)
   - <span class="hljs-title class_">ETLExecuteException</span>
   - <span class="hljs-title class_">ZtoOAuthInvalidGrantException</span> (顺带修复了代码格式/缩进)
   - <span class="hljs-title class_">ZyOAuthInvalidGrantException</span> (顺带修复了代码格式/缩进)
### 结论
这是一个 高质量的防御性编程修改 。它消除了在异常处理过程中再次发生异常的风险，有助于保留现场，方便排查问题。代码改动安全且必要。
</code></pre>
<h3 data-id="heading-15">4.7 Kimi-K2</h3>
<pre><code class="hljs language-typescript" lang="typescript">## 代码变动审查
commit a1834e32c991eff7e0c678d9dacb9cdddfc51e9e 主要优化了 <span class="hljs-title class_">Custom</span> 框架中异常类的空指针处理，主要涉及以下文件：

### 主要改动内容
<span class="hljs-number">1.</span> 异常处理逻辑优化

- 在多个异常类中新增了 <span class="hljs-title function_">formatPattern</span>() 私有静态方法
- 该方法首先检查 pattern 是否为空或空白，避免空指针异常
- 只有在 pattern 非空的情况下才进行 <span class="hljs-title class_">MessageFormat</span>.<span class="hljs-property">format</span> 操作
<span class="hljs-number">2.</span> 涉及的文件

- <span class="hljs-title class_">ClientInfoServiceException</span>.<span class="hljs-property">java</span>
- <span class="hljs-title class_">DuplicateRequestServiceException</span>.<span class="hljs-property">java</span>
- <span class="hljs-title class_">CustomServiceException</span>.<span class="hljs-property">java</span>
- <span class="hljs-title class_">PromptException</span>.<span class="hljs-property">java</span>
- <span class="hljs-title class_">AuthorizationValidatorException</span>.<span class="hljs-property">java</span>
- <span class="hljs-title class_">ETLExecuteException</span>.<span class="hljs-property">java</span>
- <span class="hljs-title class_">ZtoOAuthInvalidGrantException</span>.<span class="hljs-property">java</span>
- <span class="hljs-title class_">ZyOAuthInvalidGrantException</span>.<span class="hljs-property">java</span>
<span class="hljs-number">3.</span> 代码结构改进

- 将重复的 <span class="hljs-title class_">MessageFormat</span>.<span class="hljs-property">format</span> 逻辑抽取到独立方法中
- 统一了异常消息格式化的处理方式
- 修复了当 pattern 为 <span class="hljs-literal">null</span> 时可能导致的空指针异常问题
### 技术细节
优化前的问题：

<span class="hljs-variable language_">super</span>(<span class="hljs-title class_">MessageFormat</span>.<span class="hljs-title function_">format</span>(<span class="hljs-title class_">ArrayUtils</span>.<span class="hljs-title function_">isEmpty</span>(<span class="hljs-variable language_">arguments</span>) ? <span class="hljs-title function_">replace</span>(pattern) : 
pattern, <span class="hljs-variable language_">arguments</span>));
当 pattern 为 <span class="hljs-literal">null</span> 时，直接调用 <span class="hljs-title class_">MessageFormat</span>.<span class="hljs-title function_">format</span>(<span class="hljs-literal">null</span>, <span class="hljs-variable language_">arguments</span>) 会导致空指针异常。

优化后的解决方案：

<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">formatPattern</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> pattern, <span class="hljs-built_in">Object</span>... <span class="hljs-variable language_">arguments</span></span>) {
  <span class="hljs-keyword">if</span> (<span class="hljs-title class_">StringUtil</span>.<span class="hljs-title function_">isNullOrBlank</span>(pattern)) {
    <span class="hljs-keyword">return</span> pattern;  <span class="hljs-comment">// 直接返回 null 或空白字符串，避免空指针</span>
  }
  
  <span class="hljs-title class_">String</span> formattedPattern = <span class="hljs-title class_">ArrayUtils</span>.<span class="hljs-title function_">isEmpty</span>(<span class="hljs-variable language_">arguments</span>) ? <span class="hljs-title function_">replace</span>(pattern) : 
  pattern;
  <span class="hljs-keyword">return</span> <span class="hljs-title class_">MessageFormat</span>.<span class="hljs-title function_">format</span>(formattedPattern, <span class="hljs-variable language_">arguments</span>);
}
这个改动提高了代码的健壮性，确保在异常信息格式化过程中不会因为空指针而丢失原始的异常栈信息。
</code></pre>
<h3 data-id="heading-16">4.8 DeepSeek-V3.1</h3>
<pre><code class="hljs language-markdown" lang="markdown">根据代码变动内容，我来为您分析这个commit的变更：

<span class="hljs-section">## 代码变更总结</span>
这个commit主要修改了两个异常类文件：

<span class="hljs-bullet">1.</span> ZtoOAuthInvalidGrantException.java
<span class="hljs-bullet">2.</span> ZyOAuthInvalidGrantException.java
<span class="hljs-section">## 主要变更内容</span>
<span class="hljs-section">### 1. 代码格式化调整</span>
<span class="hljs-bullet">-</span> 缩进从4个空格改为2个空格
<span class="hljs-bullet">-</span> 代码结构更加紧凑
<span class="hljs-section">### 2. 重构消息格式化逻辑</span>
之前的方式：

super(MessageFormat.format(ArrayUtils.isEmpty(arguments) ? replace(pattern) : 
pattern, arguments));

新的方式：

private static String formatPattern(String pattern, Object... arguments) {
    if (StringUtil.isNullOrBlank(pattern)) {
        return pattern;
    }
    String formattedPattern = ArrayUtils.isEmpty(arguments) ? replace(pattern) : 
    pattern;
    return MessageFormat.format(formattedPattern, arguments);
}

<span class="hljs-section">### 3. 主要改进点</span>
<span class="hljs-bullet">1.</span> 代码可读性提升 ：将复杂的格式化逻辑提取到独立方法 formatPattern 中
<span class="hljs-bullet">2.</span> 错误处理更完善 ：增加了对空模式的显式检查
<span class="hljs-bullet">3.</span> 逻辑更清晰 ：分离了模式替换和格式化两个步骤
<span class="hljs-bullet">4.</span> 代码复用 ：两个异常类使用了相同的重构模式
<span class="hljs-section">### 4. 功能保持不变</span>
<span class="hljs-bullet">-</span> 当没有参数时，自动将 { 和 } 替换为 [ 和 ] （避免MessageFormat的占位符冲突）
<span class="hljs-bullet">-</span> 当有参数时，直接使用原始模式进行格式化
这个commit主要是代码重构，没有改变功能逻辑，但提高了代码的可维护性和可读性。
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[序章：UI动效第一步——放弃控制权，还是接管一切？]]></title>    <link>https://juejin.cn/post/7595960824486363170</link>    <guid>https://juejin.cn/post/7595960824486363170</guid>    <pubDate>2026-01-18T11:17:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595960824486363170" data-draft-id="7595960824486346786" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="序章：UI动效第一步——放弃控制权，还是接管一切？"/> <meta itemprop="keywords" content="前端,HarmonyOS"/> <meta itemprop="datePublished" content="2026-01-18T11:17:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Archilect"/> <meta itemprop="url" content="https://juejin.cn/user/1505660538979515"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            序章：UI动效第一步——放弃控制权，还是接管一切？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1505660538979515/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Archilect
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-18T11:17:37.000Z" title="Sun Jan 18 2026 11:17:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">序章：UI动效第一步——放弃控制权，还是接管一切？</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/68f715eeae1f44218c57289084105e57~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQXJjaGlsZWN0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769339857&amp;x-signature=w4QicYEkdNfLSRg5iR18Hjb4Eto%3D" alt="tab.png" loading="lazy"/></p>
<blockquote>
<p>关键词：声明式 UI / ArkUI / 复杂动效 / 吸顶折叠 / 预计算 / transform / 架构分层</p>
<p><strong>说明</strong>：本文阐述的"控制权决策树"和"三层架构"思路是通用的，适用于任何声明式 UI 框架。但本系列后续文章中的具体实现细节和代码示例均基于 <strong>ArkUI（ArkTS）</strong>。如果你使用的是 React、Flutter、SwiftUI 等其他框架，核心思路仍然适用，只需将具体的 API 调用替换为对应框架的等价实现。</p>
<p>这不是一篇"某个 API 怎么用"的文章，而是在做一个复杂 Tab 导航组件时，最先需要进行的一次设计规划：<strong>到底让谁来决定布局？</strong></p>
</blockquote>
<p>很多同学做动效会先冲进代码：先把 UI 摆出来，再一点点补动画。</p>
<p>但如果你的需求里同时出现这些关键词：</p>
<ul>
<li>吸顶折叠（展开态/折叠态两套视觉）</li>
<li>icon+文字横纵切换</li>
<li>背景形状跟随激活项移动，且折叠后形态变化</li>
<li>首项固定 + 边缘遮挡策略</li>
<li>横向滚动居中</li>
<li>亮暗色、多位置、多业务形态</li>
</ul>
<p>那么建议先停一下。</p>
<p>因为这种组件最容易走向一种"工程债务"：</p>
<ul>
<li>靠系统布局先把效果凑出来</li>
<li>然后为了补齐动效又不断加 Stack、加中间层、加 onAreaChange 兜底</li>
<li>最后会发现：<strong>不是某个 bug 难修，而是整体路线选错了</strong></li>
</ul>
<p>这篇序章，先把"路线选择"讲清楚：通过一棵控制权决策树，可以推导出一整套架构（Material → Geometry → Render）。后续每一篇文章，都只是这棵树的自然展开。</p>
<hr/>
<h3 data-id="heading-1">1）第一性问题：动画期间，谁来决定"位置"？</h3>
<p>可以把方案分成两大类，不以具体容器命名，而以"控制权归属"命名：</p>
<h4 data-id="heading-2">路线 A：布局系统驱动（Layout-driven）</h4>
<p>典型表现：</p>
<ul>
<li>用 <code>listDirection</code> / Flex 方向切换 / 双模板切换 等，让框架在不同状态下自动重排</li>
</ul>
<p>开发者提供的是"规则"，位置是布局算法的输出。</p>
<h4 data-id="heading-3">路线 B：几何驱动（Geometry-driven）</h4>
<p>典型表现：</p>
<ul>
<li>子元素用 <code>position({x:0,y:0})</code> 脱离布局流</li>
<li>自己计算两态的 <code>(x,y,width,height)</code></li>
<li>动画期间主要改变 <code>translate/scale/opacity</code>（渲染变换）</li>
</ul>
<p>开发者提供的是"结果"，框架只负责渲染。</p>
<hr/>
<h3 data-id="heading-4">2）为什么"横纵切换"是架构的关键分岔口？</h3>
<p>因为横纵切换表面是"icon 和文字怎么排"，但本质是：</p>
<blockquote>
<p>是否允许布局系统在动画期间持续参与。</p>
</blockquote>
<p>一旦选择路线 A（布局系统驱动），后面很多能力会被锁上限：</p>
<ul>
<li><strong>端点不确定</strong>：位置往往要等布局结束才知道</li>
<li><strong>轨迹不可控</strong>：想做分段、延迟、overshoot 会非常别扭</li>
<li><strong>re-layout 干扰</strong>：动画过程中改 width/margin/direction，重排会打断补间，导致抖动/跳帧风险</li>
<li><strong>后续复杂需求很难叠</strong>：背景形状变化、首项固定遮挡、滚动居中，会变成补丁叠补丁</li>
</ul>
<p>而一旦选择路线 B（几何驱动），就必须承担相应的代价：</p>
<ul>
<li>必须建立"几何计算层"（要算坐标，要测文本，要缓存）</li>
</ul>
<p>但回报也非常明确：</p>
<ul>
<li><strong>首帧确定性</strong>：动画开始前端点已确定</li>
<li><strong>轨迹可控</strong>：所有元素可用同一时间轴插值</li>
<li><strong>动效稳定</strong>：动画主要在 transform，不被重排打断</li>
<li><strong>复杂能力自然打开</strong>：背景图层化、targetScrollOffset 预计算、首项遮挡状态机，都变成"顺手的扩展"</li>
</ul>
<hr/>
<h3 data-id="heading-5">3）用一棵"控制权决策树"做选型</h3>
<p>可以把它当成一个判断流程：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart TD
    A[开始：需要做横纵切换动画] --&gt; B{需要精确控制轨迹？}
    B --&gt;|不需要| C[路线A：布局驱动]
    B --&gt;|需要| D{能接受动画期间 re-layout？}
    D --&gt;|能接受| C
    D --&gt;|不能接受| E{愿意建立几何预计算层？}
    E --&gt;|不愿意| F[路线A：接受能力上限]
    E --&gt;|愿意| G[路线B：几何驱动]
    
    C --&gt; H[特点：快速实现&lt;br/&gt;代价：轨迹不可控、可能抖动]
    F --&gt; H
    G --&gt; I[特点：完全可控&lt;br/&gt;代价：需要预计算基础设施]
    
    style G fill:#90EE90
    style C fill:#FFB6C1
    style F fill:#FFB6C1
</code></pre>
<p>结论是：当需求复杂到"吸顶折叠 + 背景变形 + 首项固定 + 居中滚动"这个级别，路线 B 基本是唯一能长期维护的选择。</p>
<hr/>
<h3 data-id="heading-6">4）路线 B 的必然结果：将组件拆分为三层闭环</h3>
<p>路线定好，接下来要考虑：</p>
<ul>
<li>位置怎么算？需要知道元素的尺寸（icon 多大、文字多宽）</li>
<li>尺寸怎么定？需要知道样式（颜色、字号、图片）</li>
<li>样式怎么选？需要知道状态（激活/未激活、吸顶/未吸顶、亮色/暗色）</li>
</ul>
<p>于是自然就会把问题拆成三层：</p>
<ol>
<li><strong>状态 → 样式</strong>（Material 物料层）</li>
<li><strong>样式 + 测量 → 位置</strong>（Geometry 几何层）</li>
<li><strong>位置 → 渲染</strong>（Render 渲染层）</li>
</ol>
<p>这样每一层都有明确的输入和输出，复杂度被隔离了。</p>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart LR
    subgraph 输入
        S[State&lt;br/&gt;选中/吸顶/主题/位置]
    end
    
    subgraph 三层架构
        M[Material 物料层&lt;br/&gt;颜色/字号/图片/基础尺寸]
        G[Geometry 几何层&lt;br/&gt;x/y/width/height/bgX]
        R[Render 渲染层&lt;br/&gt;position/translate/scale]
    end
    
    subgraph 输出
        U[UI 最终呈现]
    end
    
    S --&gt; M
    M --&gt; G
    G --&gt; R
    R --&gt; U
    
    style M fill:#E6E6FA
    style G fill:#98FB98
    style R fill:#87CEEB
</code></pre>
<h4 data-id="heading-7">4.1 Material（物料层）：状态 → 颜色/字号/图片/基础尺寸</h4>
<ul>
<li>解决的问题：状态组合爆炸（激活/吸顶/亮暗/位置/业务）</li>
<li>方法：预计算查表缓存</li>
<li>典型实现：<code>StyleManager</code></li>
</ul>
<h4 data-id="heading-8">4.2 Geometry（几何层）：物料 + 测量 → 坐标/宽高/滚动目标</h4>
<ul>
<li>解决的问题：两态几何（展开/折叠）必须在动画前确定</li>
<li>方法：集中计算 + 缓存输出</li>
<li>典型实现：<code>GeometryCalculator</code></li>
</ul>
<h4 data-id="heading-9">4.3 Render（渲染层）：消费几何 → position/translate/scale/visibility</h4>
<ul>
<li>解决的问题：让 UI 代码变薄、变稳定</li>
<li>方法：Modifier 只负责"把结果贴上去"</li>
<li>典型实现：<code>Modifiers</code>（icon/text/bg/scroll 等 modifier）</li>
</ul>
<hr/>
<h3 data-id="heading-10">5）这套闭环带来的"工程收益"是什么？</h3>
<p>与其说"代码更优雅"，不如用工程语言描述它的收益：</p>
<ol>
<li><strong>确定性</strong>：端点确定，首帧就准</li>
<li><strong>可回归</strong>：几何输出可以打印、可以对比、可以做边界测试</li>
<li><strong>可扩展</strong>：新增动效/状态，强调的是"加一个输出维度"，而不是"改一堆 if/else"</li>
<li><strong>性能更稳</strong>：动画期间主要在 transform，减少 re-layout 风险</li>
</ol>
<hr/>
<h3 data-id="heading-11">6）本系列接下来怎么写（从这棵树往下展开）</h3>
<p>后续每篇文章，会围绕这棵决策树展开：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart TD
    A[00 序章：控制权决策树] --&gt; B[01 横纵切换：架构根节点]
    B --&gt; C[02 预计算几何代替运行时测量：确定性]
    C --&gt; D[03 Render层：position+transform]
    D --&gt; E[04 背景图层化：slice拉伸]
    E --&gt; F[05 首项固定：坐标系+状态机]
    F --&gt; G[06 滚动居中：几何输出]
    G --&gt; H[07 状态组合：StyleManager]
    H --&gt; I[08 实现细节手册]
    
    style A fill:#FFD700
    style B fill:#FFA500
</code></pre>
<p>如果只记住一句话：</p>
<blockquote>
<p>复杂动效要做稳，不要问"哪个容器更好"，先问"动画期间谁来决定位置"。</p>
</blockquote>
<hr/>
<p><strong>写在最后</strong>：这是《复杂tab动效组件架构设计》系列专栏的开篇，后续会逐步展开每个技术点的实现细节。感兴趣的话可以关注专栏。如果你也在做类似的复杂动效，或者对"几何驱动"的架构思路有疑问，欢迎在评论区交流。如果觉得这个系列对你有帮助，也欢迎点赞支持，这会是我继续分享的动力。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[跨域问题终极指南：从原理到五种解决方案实战（CORS / JSONP / Nginx / WebSocket / postMessage）]]></title>    <link>https://juejin.cn/post/7596221097865265158</link>    <guid>https://juejin.cn/post/7596221097865265158</guid>    <pubDate>2026-01-18T11:20:08.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7596221097865265158" data-draft-id="7596230910212948011" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="跨域问题终极指南：从原理到五种解决方案实战（CORS / JSONP / Nginx / WebSocket / postMessage）"/> <meta itemprop="keywords" content="前端,后端,浏览器"/> <meta itemprop="datePublished" content="2026-01-18T11:20:08.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="多啦C梦a"/> <meta itemprop="url" content="https://juejin.cn/user/2640348698905129"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            跨域问题终极指南：从原理到五种解决方案实战（CORS / JSONP / Nginx / WebSocket / postMessage）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2640348698905129/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    多啦C梦a
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-18T11:20:08.000Z" title="Sun Jan 18 2026 11:20:08 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>你是不是也被这些报错折磨过？</p>
<p><code>Access to XMLHttpRequest has been blocked by CORS policy...</code></p>
<p>跨域几乎是每一个前端工程师都会遇到的第一道坎。本文将用 <strong>面试 + 实战 + 原理 + 场景</strong> 的方式，带你彻底吃透跨域，并掌握五种主流解决方案：</p>
<p><strong>JSONP、CORS、Nginx 反向代理、WebSocket、postMessage</strong></p>
</blockquote>
<hr/>
<h2 data-id="heading-0">一、什么是跨域？（一句话讲清楚）</h2>
<blockquote>
<p><strong>跨域 = 浏览器的同源策略不允许一个源去读取另一个源的响应结果</strong></p>
</blockquote>
<h3 data-id="heading-1">同源策略（Same-Origin Policy）</h3>
<p>只有当以下三者完全一致时，才是同源：</p>
<pre><code class="hljs">协议 + 域名 + 端口
</code></pre>



































<table><thead><tr><th>URL</th><th>是否同源</th><th>原因</th></tr></thead><tbody><tr><td><a href="https://link.juejin.cn?target=http%3A%2F%2Flocalhost%3A3000%2F" target="_blank" title="http://localhost:3000/" ref="nofollow noopener noreferrer">http://localhost:3000</a></td><td>—</td><td>基准</td></tr><tr><td><a href="https://link.juejin.cn?target=http%3A%2F%2Flocalhost%3A3000%2Fapi" target="_blank" title="http://localhost:3000/api" ref="nofollow noopener noreferrer">http://localhost:3000/api</a></td><td>✅</td><td>路径不同不影响</td></tr><tr><td><a href="https://link.juejin.cn?target=https%3A%2F%2Flocalhost%3A3000%2F" target="_blank" title="https://localhost:3000/" ref="nofollow noopener noreferrer">https://localhost:3000</a></td><td>❌</td><td>协议不同</td></tr><tr><td><a href="https://link.juejin.cn?target=http%3A%2F%2F127.0.0.1%3A3000%2F" target="_blank" title="http://127.0.0.1:3000/" ref="nofollow noopener noreferrer">http://127.0.0.1:3000</a></td><td>❌</td><td>域名不同</td></tr><tr><td><a href="https://link.juejin.cn?target=http%3A%2F%2Flocalhost%3A8080%2F" target="_blank" title="http://localhost:8080/" ref="nofollow noopener noreferrer">http://localhost:8080</a></td><td>❌</td><td>端口不同</td></tr></tbody></table>
<blockquote>
<p>本质：请求可以发出去，但浏览器不让你读响应结果。</p>
</blockquote>
<hr/>
<h2 data-id="heading-2">二、JSONP：最古老的跨域方案（利用 script 标签不受同源限制）</h2>
<h3 data-id="heading-3">1. 原理</h3>
<p><code>&lt;script&gt;</code> 标签的 <code>src</code> 不受同源策略限制，可以加载任意域名的资源。</p>
<p>浏览器：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"http://api.xxx.com/user?callback=cb"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p>服务器返回：</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-title function_ invoke__">cb</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">'Tom'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">18</span> })
</code></pre>
<p>前端定义：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">cb</span>(<span class="hljs-params">data</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(data)
}
</code></pre>
<h3 data-id="heading-4">2. 特点</h3>





















<table><thead><tr><th>优点</th><th>缺点</th></tr></thead><tbody><tr><td>实现简单</td><td>只支持 GET</td></tr><tr><td>兼容性好</td><td>安全性差</td></tr><tr><td>老项目常见</td><td>无法处理复杂请求</td></tr></tbody></table>
<h3 data-id="heading-5">3. 适用场景</h3>
<ul>
<li>老项目兼容方案</li>
<li>第三方接口只支持 JSONP</li>
</ul>
<hr/>
<h2 data-id="heading-6">三、CORS：最主流、最标准的跨域方案 ⭐⭐⭐⭐⭐</h2>
<blockquote>
<p>跨资源共享（Cross-Origin Resource Sharing）</p>
</blockquote>
<h3 data-id="heading-7">1. 原理</h3>
<p>服务器通过响应头告诉浏览器：</p>
<blockquote>
<p>哪些域名可以访问我<br/>
哪些请求方式可以用<br/>
哪些请求头是被允许的</p>
</blockquote>
<p>也就是说：</p>
<blockquote>
<p><strong>跨域不是前端解决的，而是后端“放行”的结果</strong></p>
</blockquote>
<p>当浏览器发起跨域请求时：</p>
<ol>
<li>浏览器先检查响应头</li>
<li>如果看到这些头：</li>
</ol>
<pre><code class="hljs language-js" lang="js"><span class="hljs-title class_">Access</span>-<span class="hljs-title class_">Control</span>-<span class="hljs-title class_">Allow</span>-<span class="hljs-title class_">Origin</span>: <span class="hljs-attr">http</span>:<span class="hljs-comment">//localhost:3000</span>
</code></pre>
<p>就会理解为：</p>
<blockquote>
<p>「服务器允许 <a href="https://link.juejin.cn?target=http%3A%2F%2Flocalhost%3A3000" target="_blank" title="http://localhost:3000" ref="nofollow noopener noreferrer">http://localhost:3000</a> 这个网站访问它」</p>
</blockquote>
<p>于是浏览器才会把响应结果交给前端 JS 使用。</p>
<hr/>
<h3 data-id="heading-8">2. 简单请求 vs 预检请求</h3>
<h4 data-id="heading-9">简单请求</h4>
<p>满足以下条件时，浏览器会<strong>直接发送请求</strong>，不会多做检查：</p>
<ul>
<li>
<p>请求方法是：</p>
<ul>
<li>GET</li>
<li>POST</li>
<li>HEAD</li>
</ul>
</li>
<li>
<p>请求头是“普通的 header”，比如：</p>
<ul>
<li>Content-Type</li>
<li>Accept</li>
</ul>
</li>
<li>
<p>Content-Type 只能是：</p>
<ul>
<li>text/plain</li>
<li>application/x-www-form-urlencoded</li>
<li>multipart/form-data</li>
</ul>
</li>
</ul>
<p>满足这些条件：</p>
<blockquote>
<p>浏览器认为：这个请求是安全的 → 直接放行</p>
</blockquote>
<p>所以你看到的效果是：</p>
<blockquote>
<p><strong>一次请求就成功返回数据</strong></p>
</blockquote>
<hr/>
<h4 data-id="heading-10">预检请求（OPTIONS）</h4>
<p>当你做了“更危险”的事情时，比如：</p>
<ul>
<li>使用 PUT / DELETE</li>
<li>携带 Authorization</li>
<li>自定义请求头</li>
</ul>
<p>浏览器会变得非常谨慎：</p>
<blockquote>
<p>先不发真正请求，而是先问服务器一句话：</p>
</blockquote>
<pre><code class="hljs language-bash" lang="bash">OPTIONS /login
</code></pre>
<p>意思是：</p>
<blockquote>
<p>「我想用 Authorization 头来访问你，你允许吗？」</p>
</blockquote>
<p>服务器返回：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-title class_">Access</span>-<span class="hljs-title class_">Control</span>-<span class="hljs-title class_">Allow</span>-<span class="hljs-title class_">Headers</span>: <span class="hljs-title class_">Authorization</span>
</code></pre>
<p>浏览器看到后：</p>
<blockquote>
<p>「允许的，那我才真正发送 POST /login」</p>
</blockquote>
<p>所以你会看到：</p>
<blockquote>
<p><strong>一次接口调用，其实发了两次请求（OPTIONS + 真正请求）</strong></p>
</blockquote>
<hr/>
<h3 data-id="heading-11">3. Node 实战</h3>
<pre><code class="hljs language-js" lang="js">app.<span class="hljs-title function_">use</span>(<span class="hljs-function">(<span class="hljs-params">req, res, next</span>) =&gt;</span> {
  <span class="hljs-comment">// 允许哪个前端域名访问我</span>
  res.<span class="hljs-title function_">setHeader</span>(<span class="hljs-string">'Access-Control-Allow-Origin'</span>, <span class="hljs-string">'http://localhost:3000'</span>);

  <span class="hljs-comment">// 允许哪些请求方式</span>
  res.<span class="hljs-title function_">setHeader</span>(<span class="hljs-string">'Access-Control-Allow-Methods'</span>, <span class="hljs-string">'GET,POST,PUT,DELETE,OPTIONS'</span>);

  <span class="hljs-comment">// 允许前端携带哪些请求头</span>
  res.<span class="hljs-title function_">setHeader</span>(<span class="hljs-string">'Access-Control-Allow-Headers'</span>, <span class="hljs-string">'Content-Type, Authorization'</span>);

  <span class="hljs-comment">// 是否允许携带 cookie</span>
  res.<span class="hljs-title function_">setHeader</span>(<span class="hljs-string">'Access-Control-Allow-Credentials'</span>, <span class="hljs-string">'true'</span>);

  <span class="hljs-title function_">next</span>();
});
</code></pre>
<p>这一段的意思是：</p>
<blockquote>
<p>后端明确告诉浏览器：</p>
</blockquote>
<ul>
<li>哪个前端能访问</li>
<li>用什么方式访问</li>
<li>能带什么信息访问</li>
<li>能不能带登录态访问</li>
</ul>
<p>浏览器看到后：</p>
<blockquote>
<p>「安全，放行！」</p>
</blockquote>
<hr/>
<h2 data-id="heading-12">四、Nginx 反向代理：开发环境最舒服的方案</h2>
<h3 data-id="heading-13">1. 原理</h3>
<blockquote>
<p>浏览器只和 Nginx 通信 → Nginx 再请求后端 → 浏览器以为是同源</p>
</blockquote>
<pre><code class="hljs language-scss" lang="scss">浏览器 → <span class="hljs-built_in">Nginx</span>(前端域名) → 后端服务器
</code></pre>
<h3 data-id="heading-14">2. 配置示例</h3>
<pre><code class="hljs language-js" lang="js">server {
  listen <span class="hljs-number">80</span>;
  server_name www.<span class="hljs-property">front</span>.<span class="hljs-property">com</span>;

  location /api/ {
    proxy_pass <span class="hljs-attr">http</span>:<span class="hljs-comment">//api.back.com/;</span>
    proxy_set_header <span class="hljs-title class_">Host</span> $host;
  }
}
</code></pre>
<p>前端请求：</p>
<pre><code class="hljs language-js" lang="js">axios.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/api/user/list'</span>)
</code></pre>
<hr/>
<h2 data-id="heading-15">五、WebSocket：天生跨域的通信协议</h2>
<h3 data-id="heading-16">1. 原理</h3>
<p>WebSocket 不受同源策略限制：</p>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">ws</span> = new WebSocket(<span class="hljs-string">'ws://api.xxx.com:8080'</span>)<span class="hljs-comment">;</span>
</code></pre>
<p>建立长连接后即可双向通信。</p>
<h3 data-id="heading-17">2. 特点</h3>

















<table><thead><tr><th>优点</th><th>缺点</th></tr></thead><tbody><tr><td>天生跨域</td><td>不适合普通接口</td></tr><tr><td>实时通信</td><td>维护成本高</td></tr></tbody></table>
<h3 data-id="heading-18">3. 场景</h3>
<ul>
<li>聊天室</li>
<li>实时推送</li>
<li>股票行情</li>
</ul>
<hr/>
<h2 data-id="heading-19">六、postMessage：iframe 跨域通信方案</h2>
<h3 data-id="heading-20">1. 原理</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 父页面</span>
iframe.<span class="hljs-property">contentWindow</span>.<span class="hljs-title function_">postMessage</span>(<span class="hljs-string">'hello'</span>, <span class="hljs-string">'http://child.com'</span>);

<span class="hljs-comment">// 子页面</span>
<span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'message'</span>, <span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(e.<span class="hljs-property">data</span>);
});
</code></pre>
<h3 data-id="heading-21">2. 特点</h3>

















<table><thead><tr><th>优点</th><th>缺点</th></tr></thead><tbody><tr><td>安全可控</td><td>使用复杂</td></tr><tr><td>支持双向通信</td><td>仅限页面通信</td></tr></tbody></table>
<h3 data-id="heading-22">3. 场景</h3>
<ul>
<li>微前端</li>
<li>第三方嵌入页面</li>
<li>登录中台系统</li>
</ul>
<hr/>
<h2 data-id="heading-23">七、五种方案对比总结（面试必背）</h2>









































<table><thead><tr><th>方案</th><th>原理</th><th>使用场景</th><th>面试评价</th></tr></thead><tbody><tr><td>JSONP</td><td>script 无跨域限制</td><td>老项目</td><td>⭐</td></tr><tr><td>CORS</td><td>响应头授权</td><td>正式生产</td><td>⭐⭐⭐⭐⭐</td></tr><tr><td>Nginx</td><td>服务端转发</td><td>开发环境</td><td>⭐⭐⭐⭐</td></tr><tr><td>WebSocket</td><td>天生跨域协议</td><td>实时通信</td><td>⭐⭐⭐</td></tr><tr><td>postMessage</td><td>页面通信</td><td>微前端</td><td>⭐⭐</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-24">八、面试标准回答模板</h2>
<blockquote>
<p>跨域是浏览器同源策略导致的安全限制。实际项目中主要通过 CORS 在服务端设置响应头解决，区分简单请求和预检请求。本地开发阶段使用 Nginx 或 Vite Proxy 代理避免跨域。JSONP 只支持 GET 已逐渐淘汰，WebSocket 天生跨域用于实时通信，postMessage 常用于 iframe 或微前端页面通信。</p>
</blockquote>
<hr/>
<h2 data-id="heading-25">九、结语</h2>
<p>跨域不是 Bug，而是浏览器的安全设计。</p>
<p>真正的高手不是背方案，而是：</p>
<blockquote>
<p><strong>知道什么时候用哪种方案，为什么这样用。</strong></p>
</blockquote>
<p>如果你觉得这篇文章对你有帮助，欢迎点赞 + 收藏 + 关注，后续我会持续输出：</p>
<ul>
<li>前端面试高频知识点深度解析</li>
<li>React/Vue 项目实战拆解</li>
<li>大厂面试通关路线图</li>
</ul>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Promise.xxx 手写之举一反三]]></title>    <link>https://juejin.cn/post/7595895132261482547</link>    <guid>https://juejin.cn/post/7595895132261482547</guid>    <pubDate>2026-01-18T12:09:34.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595895132261482547" data-draft-id="7595901379015819274" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Promise.xxx 手写之举一反三"/> <meta itemprop="keywords" content="前端,JavaScript,性能优化"/> <meta itemprop="datePublished" content="2026-01-18T12:09:34.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="sophie旭"/> <meta itemprop="url" content="https://juejin.cn/user/2559318799692952"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Promise.xxx 手写之举一反三
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2559318799692952/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    sophie旭
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-18T12:09:34.000Z" title="Sun Jan 18 2026 12:09:34 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    5
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读18分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">背景</h2>
<p>这篇文章总结下手写 Promise.xxx 的 核心要点，大家可以交叉对比一下，希望大家可以对这几个API的本质有更清晰的认识，也为我们后面场景应用打下基础。</p>
<h2 data-id="heading-1">Promise.all</h2>
<p>直接上完整实现</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> promiseAll = (iterable) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>)=&gt;</span> {
        <span class="hljs-keyword">let</span> promises = []
        <span class="hljs-keyword">try</span> {
            promises = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(iterable);
        } <span class="hljs-keyword">catch</span> (err) {
            <span class="hljs-keyword">return</span> <span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">TypeError</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-keyword">typeof</span> iterable}</span> <span class="hljs-subst">${iterable}</span> is not iterable (cannot read property Symbol(Symbol.iterator))`</span>)); 
        }
        <span class="hljs-keyword">if</span> (promises?.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-title function_">resolve</span>([])

        <span class="hljs-keyword">let</span> result = []
        <span class="hljs-keyword">let</span> count = <span class="hljs-number">0</span>
        <span class="hljs-keyword">let</span> isRejected = <span class="hljs-literal">false</span>; <span class="hljs-comment">// 标记是否已拒绝，避免重复处理</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; promises.<span class="hljs-property">length</span>; i++) {
            <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(promises[i]).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">res</span>)=&gt;</span> {
                <span class="hljs-keyword">if</span> (isRejected)<span class="hljs-keyword">return</span>
                result[i] = res
                count++
                <span class="hljs-keyword">if</span> (count === promises.<span class="hljs-property">length</span>) <span class="hljs-title function_">resolve</span>(result)
            }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err</span>)=&gt;</span> {
                <span class="hljs-keyword">if</span> (isRejected) <span class="hljs-keyword">return</span>
                isRejected = <span class="hljs-literal">true</span>;

                <span class="hljs-title function_">reject</span>(err)
            })
        }

    })
}
</code></pre>
<p>其实这二十几行代码，没一行是白给的，我们逐行看其必要性</p>
<h3 data-id="heading-2">逐行分析及必要性：‌</h3>
<p>let promises = []‌:</p>
<p>必要性‌: 必要。用于存储将 iterable 转换后得到的数组。</p>
<p>try { promises = Array.from(iterable); } catch (err) { ... }‌:</p>
<p>必要性‌: <code>非常必要。Array.from(iterable) 是 Promise.all 规范要求的步骤，它将一个可迭代对象（如 Array, Set, Map, arguments 等）转换为真正的数组。如果 iterable 不是可迭代对象（例如 null, undefined, number, string 等），Array.from 会抛出 TypeError。</code></p>
<p>不写会怎样‌: <code>如果没有 try...catch 包裹，当 iterable 不是可迭代对象时，Array.from(iterable) 会直接抛出错误，导致整个 promiseAll 函数执行中断，而不是按照 Promise.all 的规范返回一个被拒绝的 Promise。这不符合 Promise.all 的行为。因此，这个 try...catch 块是实现 Promise.all 规范的关键部分。</code></p>
<p>if (promises?.length === 0) return resolve([])‌:</p>
<p>必要性‌: <code>必要。根据 Promise.all 的规范，如果传入的是一个空的可迭代对象（如空数组 []），应该立即返回一个已解决（resolved）状态的 Promise，其值为一个空数组 []。</code></p>
<p>不写会怎样‌: <code>如果没有这个判断，代码会继续执行 for 循环。由于 promises 是空数组，循环体不会执行，count 始终为 0，result 也为空，且没有 resolve 或 reject 被调用。这会导致返回的 Promise 处于挂起（pending）状态，永远不会解决或拒绝。这与 Promise.all([]) 的规范不符。</code></p>
<p>let result = []‌:</p>
<p>必要性‌: 必要。用于收集所有 Promise 的成功结果，并按照输入顺序存储。</p>
<p>let count = 0‌:</p>
<p>必要性‌: 必要。<code>用于跟踪有多少个 Promise 已经成功完成。当 count 等于 promises.length 时，表示所有 Promise 都完成了，可以调用 resolve(result)。</code></p>
<p>let isRejected = false;‌:</p>
<p>必要性‌: <code>非常必要。这是一个关键的标志位，用于防止在第一个 Promise 被拒绝后，后续的 Promise 成功完成时再次调用 resolve 或 reject。Promise.all 的语义是：只要有一个 Promise 被拒绝，整个 Promise 就被拒绝。如果在第一个 Promise 被拒绝后，后续的 Promise 成功了，我们不应该再调用 resolve。</code></p>
<p>for (let i = 0; i &lt; promises.length; i++)‌:</p>
<p>必要性‌: 必要。用于遍历所有需要处理的 Promise。</p>
<p>Promise.resolve(promises[i])‌:</p>
<p>必要性‌: 非常必要。<code>Promise.all 的规范要求，传入的 iterable 中的每个元素都必须被当作 Promise 来处理。如果元素本身不是一个 Promise 对象（例如是一个普通值、一个 thenable 对象），则需要通过 Promise.resolve 来将其包装成一个 Promise。这确保了后续的 .then 和 .catch 能够正确地处理它。</code></p>
<p>不写会怎样‌: <code>如果直接使用 promises[i] 而不调用 Promise.resolve，那么如果 promises[i] 是一个普通值（如 42），它不会被当作 Promise 来处理。后续的 .then 可能不会被触发，或者行为不可预测。如果 promises[i] 是一个 thenable 对象（具有 then 方法的对象），直接使用它可能不会按照 Promise 的标准行为来处理。</code></p>
<p>result[i] = res‌:</p>
<p>必要性‌: 必要。<code>将每个 Promise 成功的结果按顺序存储到 result 数组中。Promise.all 的结果数组必须与输入的 Promise 数组顺序一一对应。</code></p>
<p>if (count === promises.length) resolve(result)‌:</p>
<p>必要性‌: 必要。<code>这是判断所有 Promise 都完成的条件，并在满足条件时 resolve 最终结果。</code></p>
<p>if (isRejected) return (在 .then 中)‌:</p>
<p>必要性‌: 必要。确保在第一个 Promise 被拒绝后，后续的 Promise 成功完成时不会再次触发 resolve。</p>
<p>isRejected = true; (在 .catch 中)‌:</p>
<p>必要性‌: <code>必要。标记已发生拒绝，以便后续处理可以跳过。</code></p>
<p>reject(err)‌:</p>
<p>必要性‌: 必要。<code>当任何一个 Promise 被拒绝时，立即拒绝整个 Promise.all。</code></p>
<p>if (isRejected) return (在 .catch 中)‌:</p>
<p>必要性‌: 必要。<code>确保在第一个 Promise 被拒绝后，后续的 Promise 被拒绝时不会再次调用 reject。</code></p>
<h3 data-id="heading-3">如何记忆</h3>
<h4 data-id="heading-4">一、先明确：核心不是“设计模式”，是“异步控制模式”</h4>
<p><code>Promise.all</code> 本质是<strong>异步任务的批量控制模式</strong>，核心要解决 3 个问题：</p>
<ol>
<li>如何同时执行多个异步任务（并行）；</li>
<li>如何保证结果顺序和任务顺序一致；</li>
<li>如何实现“快速失败”（一个错就立刻返回，不等待其他任务）。</li>
</ol>
<p>它没有套用 GoF 经典设计模式（比如工厂、单例），但用到了几个通用的编程技巧，这些技巧是可复用的，记住它们就记住了实现逻辑。</p>
<h4 data-id="heading-5">二、核心技巧（“巧妙之处”）：拆解成 4 个可记忆的点</h4>
<h5 data-id="heading-6">1. 计数法：用“计数器”判断异步任务全部完成</h5>
<p>这是最核心的技巧，也是异步批量处理的通用思路：</p>
<ul>
<li>初始化一个计数器 <code>resolvedCount = 0</code>；</li>
<li>每个异步任务成功后，计数器 +1；</li>
<li>当计数器等于任务总数时，说明所有任务完成，触发 <code>resolve</code>。</li>
</ul>
<p>👉 为什么不用 <code>forEach + push</code>？<br/>
如果用 <code>push</code> 存储结果，结果顺序会变成“任务完成的顺序”，而不是“任务传入的顺序”；而用<strong>索引+计数器</strong>，既保证了顺序，又能精准判断全部完成。</p>
<h5 data-id="heading-7">2. 状态锁：用 <code>isRejected</code> 实现“快速失败”和“状态保护”</h5>
<p>Promise 的状态是<strong>不可逆</strong>的（一旦 resolve/reject，就不能再改），这是 Promise 的核心规则。<code>isRejected</code> 就是模拟这个“状态锁”：</p>
<ul>
<li>初始状态：<code>isRejected = false</code>（未拒绝）；</li>
<li>一旦有一个任务失败，立刻把 <code>isRejected = true</code>（锁死状态），然后 <code>reject</code>；</li>
<li>后续所有任务的成功回调里，先判断 <code>if (isRejected) return</code>，直接跳过——既保证“快速失败”，又避免重复修改结果/计数器，减少冗余执行。</li>
</ul>
<p>👉 巧妙之处：用一个布尔值就实现了“状态不可逆”的约束，避免多次调用 <code>reject</code>（虽然 Promise 本身会忽略重复的 resolve/reject，但显式控制更优雅）。</p>
<h5 data-id="heading-8">3. 统一包装：用 <code>Promise.resolve()</code> 兼容“非 Promise 任务”</h5>
<p><code>Promise.all</code> 允许传入非 Promise 类型（比如数字、字符串），核心是 <code>Promise.resolve(x)</code>：</p>
<ul>
<li>如果 <code>x</code> 是 Promise，直接用它的状态；</li>
<li>如果 <code>x</code> 是普通值，转为“已成功的 Promise”，值为 <code>x</code>。</li>
</ul>
<p>👉 巧妙之处：不管入参是同步值还是异步 Promise，都统一成 Promise 处理，避免分支判断，简化逻辑。</p>
<h5 data-id="heading-9">4. 兼容处理：用 <code>Array.from()</code> + <code>try/catch</code> 兼容“可迭代对象”</h5>
<p>原生 <code>Promise.all</code> 接收“可迭代对象”（数组、Set、Map 等），而不是仅数组：</p>
<ul>
<li><code>Array.from(iterable)</code>：把所有可迭代对象转为数组，统一处理；</li>
<li><code>try/catch</code> 包裹 <code>Array.from</code>：如果传入非可迭代对象（比如数字、普通对象），捕获错误并抛出和原生一致的 <code>TypeError</code>，保证函数健壮性。</li>
</ul>
<p>👉 巧妙之处：不局限于数组，符合原生 API 规范，同时处理边界错误。</p>
<h4 data-id="heading-10">三、怎么记住？用“口诀 + 步骤”代替死记代码</h4>
<h5 data-id="heading-11">口诀（5 个字）：计、锁、包、序、容</h5>
<ul>
<li>计：计数器判断全部完成；</li>
<li>锁：isRejected 锁死失败状态；</li>
<li>包：Promise.resolve 包装所有任务；</li>
<li>序：索引存储保证结果顺序；</li>
<li>容：兼容可迭代对象 + 错误处理。</li>
</ul>
<h5 data-id="heading-12">记忆步骤（按执行流程记）：</h5>
<ol>
<li><strong>入参处理</strong>：用 <code>Array.from</code> 转可迭代对象为数组，try/catch 处理非可迭代错误；</li>
<li><strong>空值判断</strong>：数组为空直接 resolve 空数组；</li>
<li><strong>初始化变量</strong>：结果数组 + 计数器 + 状态锁；</li>
<li><strong>遍历任务</strong>：
<ul>
<li>用 <code>Promise.resolve</code> 包装每个任务；</li>
<li>成功：按索引存结果 → 计数器+1 → 计数器等于总数则 resolve；</li>
<li>失败：状态锁置为 true → 立即 reject（只执行一次）；</li>
</ul>
</li>
<li><strong>状态保护</strong>：所有回调先判断状态锁，已失败则跳过。</li>
</ol>
<h4 data-id="heading-13">四、对比记忆：和其他 Promise 方法的逻辑关联</h4>
<p>记住 <code>Promise.all</code> 后，其他方法的实现逻辑可以类比，更容易举一反三：</p>
<ul>
<li><code>Promise.allSettled</code>：去掉“状态锁”，不管成功失败都记录结果，计数器等所有任务完成后 resolve；</li>
<li><code>Promise.race</code>：去掉计数器，只要有一个任务（成功/失败），就立刻 resolve/reject；</li>
<li><code>Promise.any</code>：反过来，只要有一个成功就 resolve，所有都失败才 reject。</li>
</ul>
<h4 data-id="heading-14">总结</h4>
<p>要记住 <code>Promise.all</code> 的实现，关键是记住 4 个核心技巧：</p>
<ol>
<li><strong>计数器</strong>：批量异步任务完成的判断标准；</li>
<li><strong>状态锁</strong>：实现“快速失败”和状态保护；</li>
<li><strong>索引存结果</strong>：保证顺序（最容易错的点）；</li>
<li><strong>统一包装/兼容</strong>：让函数更通用、健壮。</li>
</ol>
<p>不用死记每一行代码，只要想清楚“要解决什么问题→用什么技巧解决”，代码自然就能写出来。比如：</p>
<ul>
<li>想“怎么保证顺序？”→ 用索引而不是 push；</li>
<li>想“怎么快速失败？”→ 用布尔值锁死状态；</li>
<li>想“怎么兼容普通值？”→ 用 Promise.resolve 包装。</li>
</ul>
<p>这也是编程的核心：<strong>先想清楚“解决什么问题”，再找“对应的技巧”，而不是反过来记代码</strong>。</p>
<h3 data-id="heading-15">把 <code>for</code> 循环里的 <code>let i</code> 改成 <code>var i</code>可以吗？</h3>
<p><strong>绝对不可以</strong>，会直接导致结果顺序错乱，甚至逻辑错误。我会用通俗的方式解释为什么，以及背后的核心原理。</p>
<h4 data-id="heading-16">一、先看现象：改 <code>var</code> 后会出什么问题？</h4>
<p>我们用一个简单的测试案例验证：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 用你写的 promiseAll，但把 let i 改成 var i</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">promiseAll</span>(<span class="hljs-params">iterable</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
    <span class="hljs-keyword">let</span> promises;
    <span class="hljs-keyword">try</span> {
      promises = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(iterable);
    } <span class="hljs-keyword">catch</span> (err) {
      <span class="hljs-keyword">return</span> <span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">TypeError</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-keyword">typeof</span> iterable}</span> <span class="hljs-subst">${iterable}</span> is not iterable`</span>));
    }
    <span class="hljs-keyword">if</span> (promises.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-title function_">resolve</span>([]);

    <span class="hljs-keyword">const</span> result = [];
    <span class="hljs-keyword">let</span> resolvedCount = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">let</span> isRejected = <span class="hljs-literal">false</span>;

    <span class="hljs-comment">// 关键修改：let → var</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; promises.<span class="hljs-property">length</span>; i++) {
      <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(promises[i]).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> {
        <span class="hljs-keyword">if</span> (isRejected) <span class="hljs-keyword">return</span>;
        result[i] = res; <span class="hljs-comment">// 这里的 i 会出问题！</span>
        resolvedCount++;
        <span class="hljs-keyword">if</span> (resolvedCount === promises.<span class="hljs-property">length</span>) {
          <span class="hljs-title function_">resolve</span>(result);
        }
      }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> {
        <span class="hljs-keyword">if</span> (isRejected) <span class="hljs-keyword">return</span>;
        isRejected = <span class="hljs-literal">true</span>;
        <span class="hljs-title function_">reject</span>(err);
      });
    }
  });
}

<span class="hljs-comment">// 测试：两个异步任务，第二个先完成</span>
<span class="hljs-keyword">const</span> p1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function"><span class="hljs-params">resolve</span> =&gt;</span> <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">resolve</span>(<span class="hljs-number">1</span>), <span class="hljs-number">200</span>));
<span class="hljs-keyword">const</span> p2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function"><span class="hljs-params">resolve</span> =&gt;</span> <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">resolve</span>(<span class="hljs-number">2</span>), <span class="hljs-number">100</span>));
<span class="hljs-title function_">promiseAll</span>([p1, p2]).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(res)); 
<span class="hljs-comment">// 预期：[1,2]，实际输出：[undefined, 2]（甚至可能是 [2, undefined]）</span>
</code></pre>
<h4 data-id="heading-17">二、核心原因：<code>var</code> 和 <code>let</code> 的作用域 + 异步回调的执行时机</h4>
<h5 data-id="heading-18">1. <code>var</code> 的问题：函数级作用域 + 变量提升 + 共享变量</h5>
<ul>
<li><code>var i</code> 是<strong>函数级作用域</strong>（整个 <code>promiseAll</code> 函数内只有一个 <code>i</code>），而不是 <code>let</code> 的<strong>块级作用域</strong>（每次循环都有独立的 <code>i</code>）；</li>
<li>循环会先执行完（<code>i</code> 最终变成 <code>promises.length</code>），然后异步回调（<code>then</code>）才执行；</li>
<li>所有回调里的 <code>i</code> 都指向<strong>同一个变量</strong>（最终的 <code>i</code> 值），导致：
<ul>
<li>比如循环有 2 个任务，循环结束后 <code>i = 2</code>；</li>
<li>第一个回调执行时，<code>result[2] = res</code>（超出数组长度，结果数组里对应位置是 <code>undefined</code>）；</li>
<li>第二个回调执行时，同样用 <code>i=2</code>，覆盖 <code>result[2]</code>，最终结果数组顺序完全错乱。</li>
</ul>
</li>
</ul>
<h5 data-id="heading-19">2. <code>let</code> 的优势：块级作用域 + 每次循环创建独立变量</h5>
<ul>
<li><code>let i</code> 是<strong>块级作用域</strong>，每次循环都会创建一个<strong>独立的 <code>i</code></strong>，绑定到当前循环的回调；</li>
<li>即使循环先执行完，每个回调里的 <code>i</code> 都是自己那一轮的索引（0、1、2...），所以 <code>result[i] = res</code> 能精准对应入参顺序。</li>
</ul>
<h4 data-id="heading-20">三、如果非要用 <code>var</code>，怎么修复？（仅作理解，不推荐）</h4>
<p>如果硬要用 <code>var</code>，需要用<strong>闭包</strong>把每次循环的 <code>i</code> 封装成独立变量，这也是 ES6 之前解决这个问题的方法，但代码更复杂：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 不推荐，仅作理解</span>
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; promises.<span class="hljs-property">length</span>; i++) {
  <span class="hljs-comment">// 用立即执行函数（IIFE）封装独立的 index</span>
  (<span class="hljs-keyword">function</span>(<span class="hljs-params">index</span>) {
    <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(promises[index]).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> {
      <span class="hljs-keyword">if</span> (isRejected) <span class="hljs-keyword">return</span>;
      result[index] = res; <span class="hljs-comment">// 用闭包的 index，而非共享的 i</span>
      resolvedCount++;
      <span class="hljs-keyword">if</span> (resolvedCount === promises.<span class="hljs-property">length</span>) {
        <span class="hljs-title function_">resolve</span>(result);
      }
    }).<span class="hljs-title function_">catch</span>(<span class="hljs-comment">/* 省略 */</span>);
  })(i); <span class="hljs-comment">// 把当前循环的 i 传入</span>
}
</code></pre>
<p>👉 显然，用 <code>let</code> 比闭包简洁得多，这也是 ES6 引入 <code>let/const</code> 块级作用域的核心原因之一。</p>
<h4 data-id="heading-21">总结</h4>
<p>核心要点：</p>
<ol>
<li><strong>绝对不能改</strong>：把 <code>let i</code> 改成 <code>var i</code> 会导致异步回调中 <code>i</code> 指向最终值，结果顺序错乱、逻辑错误；</li>
<li><strong>根本原因</strong>：<code>var</code> 是函数级作用域（共享变量），<code>let</code> 是块级作用域（每次循环独立变量）；</li>
<li><strong>关键逻辑</strong>：<code>result[i] = res</code> 能保证顺序的前提，是每个回调有自己的 <code>i</code>（<code>let</code> 实现）。</li>
</ol>
<p>记住：在异步场景的循环中（比如 Promise 回调、定时器回调），<strong>必须用 <code>let</code> 声明循环变量</strong>，这是避免作用域陷阱的核心原则。</p>
<p><strong>这一点很重要，也是后续其他API 的遍历方法</strong></p>
<h2 data-id="heading-22">Promise.allSettled</h2>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> promiseSettled = (iterable) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>)=&gt;</span> {
        <span class="hljs-keyword">let</span> promises = []
        <span class="hljs-keyword">try</span> {
            promises = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(iterable);
        } <span class="hljs-keyword">catch</span> (err) {
            <span class="hljs-keyword">return</span> <span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">TypeError</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-keyword">typeof</span> iterable}</span> <span class="hljs-subst">${iterable}</span> is not iterable (cannot read property Symbol(Symbol.iterator))`</span>)); 
        }
        <span class="hljs-keyword">if</span> (promises.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-title function_">resolve</span>([])

        <span class="hljs-keyword">let</span> result = []
        <span class="hljs-keyword">let</span> count = <span class="hljs-number">0</span>
        <span class="hljs-comment">//let isRejected = false; // 标记是否已拒绝，避免重复处理 </span>
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; promises.<span class="hljs-property">length</span>; i++) {
            <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(promises[i]).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">res</span>)=&gt;</span> {
               <span class="hljs-comment">// if (isRejected)return --&gt;</span>
                result[i] = {<span class="hljs-attr">status</span>: <span class="hljs-string">'fulfilled'</span>, <span class="hljs-attr">value</span>: res}
                count++
                <span class="hljs-keyword">if</span> (count === promises.<span class="hljs-property">length</span>) <span class="hljs-title function_">resolve</span>(result)
            }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err</span>)=&gt;</span> {
                <span class="hljs-comment">// if (isRejected) return --&gt;</span>
                <span class="hljs-comment">// isRejected = true; --&gt;</span>
                result[i] = {<span class="hljs-attr">status</span>: <span class="hljs-string">'rejected'</span>, <span class="hljs-attr">reason</span>: err}
                count++
                <span class="hljs-keyword">if</span> (count === promises.<span class="hljs-property">length</span>) <span class="hljs-title function_">resolve</span>(result)
                <span class="hljs-comment">//reject(err) --&gt;</span>
            })
        }

    })
}
</code></pre>
<p>之前我们提到，相对 Promise.all , <code>Promise.allSettled是去掉“状态锁”，不管成功失败都记录结果，计数器等所有任务完成后 resolve；</code></p>
<p>所以稍微按照以下改造一下，就成了</p>
<h4 data-id="heading-23">总结</h4>
<p>实现 <code>Promise.allSettled</code> 的核心要点：</p>
<ol>
<li><strong>结果格式</strong>：必须存储 <code>{ status: 'fulfilled/rejected', value/reason }</code> 格式的对象，而非直接存值；</li>
<li><strong>计数器逻辑</strong>：无论成功/失败，都要让计数器+1，等待所有任务完成后统一resolve；</li>
<li><strong>无快速失败</strong>：移除 <code>isRejected</code> 标记，不需要提前终止逻辑；</li>
<li>永远不会 <code>reject</code>（除非入参不是可迭代对象），只会 <code>resolve</code> 最终的结果数组。</li>
</ol>
<p>只要我们抓住Promise.all的原理 和 “不快速失败、等待所有任务完成”的核心，只需要补充结果格式和错误信息存储，就能完全符合原生规范了。</p>
<h2 data-id="heading-24">Promise.all 和 Promise.allSettled 使用场景</h2>
<h4 data-id="heading-25">先明确核心选型原则</h4>






























<table><thead><tr><th>核心诉求</th><th>选 <code>Promise.all</code></th><th>选 <code>Promise.allSettled</code></th></tr></thead><tbody><tr><td>多个任务<strong>缺一不可</strong></td><td>✅（一个失败就没必要继续）</td><td>❌（等待所有无意义）</td></tr><tr><td>要知道<strong>所有任务的成败</strong></td><td>❌（失败就中断，看不到其他结果）</td><td>✅（哪怕部分失败，也要全量结果）</td></tr><tr><td>失败后要<strong>立即终止流程</strong></td><td>✅（快速失败，避免无效操作）</td><td>❌（必须等所有完成）</td></tr><tr><td>失败后要<strong>统计全量错误</strong></td><td>❌（只知道第一个失败原因）</td><td>✅（知道每个任务的失败原因）</td></tr></tbody></table>
<hr/>
<h4 data-id="heading-26">一、Promise.all 的典型使用场景（缺一不可的任务）</h4>
<p><code>Promise.all</code> 适合“多个异步任务必须全部成功，否则整个流程无意义”的场景，失败后立即终止，避免做无用功。</p>
<h5 data-id="heading-27">场景1：表单提交依赖多个接口验证</h5>
<p>比如用户提交注册表单，需要先调用：</p>
<ul>
<li>用户名是否重复接口；</li>
<li>手机号是否已注册接口；</li>
<li>验证码是否正确接口。
<strong>只有这 3 个接口都返回“通过”，才能提交注册信息</strong>，只要有一个失败（比如用户名重复），就没必要调用其他接口，直接提示用户。</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 模拟三个验证接口</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">checkUsername</span> = (<span class="hljs-params">name</span>) =&gt; <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(name !== <span class="hljs-string">'admin'</span>); <span class="hljs-comment">// 用户名不能是admin</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">checkPhone</span> = (<span class="hljs-params">phone</span>) =&gt; <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(phone.<span class="hljs-property">length</span> === <span class="hljs-number">11</span>); <span class="hljs-comment">// 手机号必须11位</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">checkCode</span> = (<span class="hljs-params">code</span>) =&gt; <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(code === <span class="hljs-string">'123456'</span>); <span class="hljs-comment">// 验证码必须是123456</span>

<span class="hljs-comment">// 注册表单提交逻辑</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">submitRegister</span>(<span class="hljs-params">name, phone, code</span>) {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-comment">// 三个验证必须全过，用Promise.all</span>
    <span class="hljs-keyword">const</span> [isUsernameOk, isPhoneOk, isCodeOk] = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>([
      <span class="hljs-title function_">checkUsername</span>(name),
      <span class="hljs-title function_">checkPhone</span>(phone),
      <span class="hljs-title function_">checkCode</span>(code)
    ]);

    <span class="hljs-comment">// 所有验证通过，才提交注册</span>
    <span class="hljs-keyword">if</span> (isUsernameOk &amp;&amp; isPhoneOk &amp;&amp; isCodeOk) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'注册提交成功'</span>);
    }
  } <span class="hljs-keyword">catch</span> (err) {
    <span class="hljs-comment">// 只要一个验证失败，立即进入catch，提示用户</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'注册失败：'</span>, err);
  }
}

<span class="hljs-comment">// 测试：用户名重复（第一个任务失败）</span>
<span class="hljs-title function_">submitRegister</span>(<span class="hljs-string">'admin'</span>, <span class="hljs-string">'13800138000'</span>, <span class="hljs-string">'123456'</span>); 
<span class="hljs-comment">// 输出：注册失败（不会等待后两个接口，直接终止）</span>
</code></pre>
<h5 data-id="heading-28">场景2：页面初始化加载“核心数据”</h5>
<p>比如电商详情页，需要同时加载：</p>
<ul>
<li>商品基本信息接口；</li>
<li>商品价格接口；</li>
<li>商品库存接口。
<strong>这三个数据缺一不可，缺少任何一个，页面都无法正常渲染</strong>，所以用 <code>Promise.all</code>，只要一个接口失败，就提示“数据加载失败”，无需等待其他接口。</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 模拟三个核心接口</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">getGoodsInfo</span> = (<span class="hljs-params"/>) =&gt; <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>({ <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'手机'</span> });
<span class="hljs-keyword">const</span> <span class="hljs-title function_">getGoodsPrice</span> = (<span class="hljs-params"/>) =&gt; <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(<span class="hljs-string">'价格接口异常'</span>); <span class="hljs-comment">// 模拟失败</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">getGoodsStock</span> = (<span class="hljs-params"/>) =&gt; <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(<span class="hljs-number">100</span>);

<span class="hljs-comment">// 页面初始化逻辑</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">initGoodsPage</span>(<span class="hljs-params">goodsId</span>) {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> [info, price, stock] = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>([
      <span class="hljs-title function_">getGoodsInfo</span>(goodsId),
      <span class="hljs-title function_">getGoodsPrice</span>(goodsId),
      <span class="hljs-title function_">getGoodsStock</span>(goodsId)
    ]);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'页面渲染：'</span>, { info, price, stock });
  } <span class="hljs-keyword">catch</span> (err) {
    <span class="hljs-comment">// 价格接口失败，立即提示加载失败</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'商品数据加载失败：'</span>, err);
  }
}

<span class="hljs-title function_">initGoodsPage</span>(<span class="hljs-number">1</span>); 
<span class="hljs-comment">// 输出：商品数据加载失败：价格接口异常（不会等待库存接口返回）</span>
</code></pre>
<hr/>
<h4 data-id="heading-29">二、Promise.allSettled 的典型使用场景（需要全量结果）</h4>
<p><code>Promise.allSettled</code> 适合“多个异步任务相互独立，哪怕部分失败，也需要知道所有任务的结果”的场景，不会提前终止，能统计全量成败。</p>
<h5 data-id="heading-30">场景1：批量获取/同步数据（统计成败）</h5>
<p>比如后台系统需要批量同步 10 个用户的信息到数据库，<strong>哪怕部分用户同步失败，也要知道哪些成功、哪些失败</strong>，方便后续手动处理失败的用户，而不是一个失败就中断整个同步流程。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 模拟同步单个用户的接口（随机成功/失败）</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">syncUser</span> = (<span class="hljs-params">userId</span>) =&gt; {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() &gt; <span class="hljs-number">0.5</span> 
        ? <span class="hljs-title function_">resolve</span>(<span class="hljs-string">`用户<span class="hljs-subst">${userId}</span>同步成功`</span>) 
        : <span class="hljs-title function_">reject</span>(<span class="hljs-string">`用户<span class="hljs-subst">${userId}</span>同步失败：数据格式错误`</span>);
    }, <span class="hljs-number">100</span>);
  });
};

<span class="hljs-comment">// 批量同步10个用户</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">batchSyncUsers</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// 生成1-10的用户ID数组</span>
  <span class="hljs-keyword">const</span> userIds = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>({ <span class="hljs-attr">length</span>: <span class="hljs-number">10</span> }, <span class="hljs-function">(<span class="hljs-params">_, i</span>) =&gt;</span> i + <span class="hljs-number">1</span>);
  <span class="hljs-comment">// 每个用户对应一个同步任务</span>
  <span class="hljs-keyword">const</span> syncTasks = userIds.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">id</span> =&gt;</span> <span class="hljs-title function_">syncUser</span>(id));

  <span class="hljs-comment">// 必须等所有任务完成，用allSettled</span>
  <span class="hljs-keyword">const</span> results = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">allSettled</span>(syncTasks);

  <span class="hljs-comment">// 统计成功/失败</span>
  <span class="hljs-keyword">const</span> successUsers = results.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item.<span class="hljs-property">status</span> === <span class="hljs-string">'fulfilled'</span>).<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item.<span class="hljs-property">value</span>);
  <span class="hljs-keyword">const</span> failUsers = results.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item.<span class="hljs-property">status</span> === <span class="hljs-string">'rejected'</span>).<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item.<span class="hljs-property">reason</span>);

  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'同步完成：'</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'成功：'</span>, successUsers);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'失败：'</span>, failUsers);
}

<span class="hljs-title function_">batchSyncUsers</span>();
<span class="hljs-comment">// 输出示例：</span>
<span class="hljs-comment">// 成功：["用户1同步成功", "用户3同步成功"...]</span>
<span class="hljs-comment">// 失败：["用户2同步失败：数据格式错误", "用户4同步失败：数据格式错误"...]</span>
</code></pre>
<h5 data-id="heading-31">场景2：多渠道推送通知（无需依赖）</h5>
<p>比如用户下单后，需要同时推送：</p>
<ul>
<li>微信消息；</li>
<li>短信通知；</li>
<li>APP 推送。
<strong>这三个推送相互独立，哪怕短信发送失败，也要继续推送微信和APP</strong>，并且需要知道哪些渠道推送成功、哪些失败，方便后续补推。</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 模拟三个推送接口</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">pushWechat</span> = (<span class="hljs-params"/>) =&gt; <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(<span class="hljs-string">'微信推送成功'</span>);
<span class="hljs-keyword">const</span> <span class="hljs-title function_">pushSms</span> = (<span class="hljs-params"/>) =&gt; <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(<span class="hljs-string">'短信推送失败：余额不足'</span>);
<span class="hljs-keyword">const</span> <span class="hljs-title function_">pushApp</span> = (<span class="hljs-params"/>) =&gt; <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(<span class="hljs-string">'APP推送成功'</span>);

<span class="hljs-comment">// 下单后推送通知</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">pushNoticeAfterOrder</span>(<span class="hljs-params">orderId</span>) {
  <span class="hljs-keyword">const</span> results = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">allSettled</span>([
    <span class="hljs-title function_">pushWechat</span>(orderId),
    <span class="hljs-title function_">pushSms</span>(orderId),
    <span class="hljs-title function_">pushApp</span>(orderId)
  ]);

  <span class="hljs-comment">// 遍历结果，记录每个渠道的状态</span>
  results.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">result, index</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> channel = [<span class="hljs-string">'微信'</span>, <span class="hljs-string">'短信'</span>, <span class="hljs-string">'APP'</span>][index];
    <span class="hljs-keyword">if</span> (result.<span class="hljs-property">status</span> === <span class="hljs-string">'fulfilled'</span>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${channel}</span>：<span class="hljs-subst">${result.value}</span>`</span>);
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${channel}</span>：<span class="hljs-subst">${result.reason}</span>（后续需补推）`</span>);
    }
  });
}

<span class="hljs-title function_">pushNoticeAfterOrder</span>(<span class="hljs-number">1001</span>);
<span class="hljs-comment">// 输出：</span>
<span class="hljs-comment">// 微信：微信推送成功</span>
<span class="hljs-comment">// 短信：短信推送失败：余额不足（后续需补推）</span>
<span class="hljs-comment">// APP：APP推送成功</span>
</code></pre>
<h5 data-id="heading-32">场景3：数据看板（多维度统计）</h5>
<p>比如运营看板需要同时拉取：</p>
<ul>
<li>今日订单数；</li>
<li>今日销售额；</li>
<li>今日用户新增数。
<strong>哪怕其中一个接口超时/失败，也要显示其他维度的数据</strong>，而不是整个看板空白，用 <code>allSettled</code> 可以保证看板有数据展示，失败的维度标红即可。</li>
</ul>
<hr/>
<h4 data-id="heading-33">场景对比总结表</h4>























<table><thead><tr><th>场景类型</th><th>示例</th><th>选哪个？</th><th>核心原因</th></tr></thead><tbody><tr><td>核心流程依赖（缺一不可）</td><td>表单验证、核心数据加载、支付流程</td><td>Promise.all</td><td>一个失败就终止，避免无效操作</td></tr><tr><td>批量任务/独立统计</td><td>批量同步数据、多渠道推送、数据看板</td><td>Promise.allSettled</td><td>需全量结果，统计成败，不中断流程</td></tr></tbody></table>
<h4 data-id="heading-34">最后补充：特殊场景的折中方案</h4>
<p>如果你的场景是“想要 <code>all</code> 的快速失败，但又想知道所有失败的结果”，可以先用 <code>allSettled</code> 获取全量结果，再手动判断是否有失败：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">customAllWithAllResults</span>(<span class="hljs-params">tasks</span>) {
  <span class="hljs-keyword">const</span> results = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">allSettled</span>(tasks);
  <span class="hljs-keyword">const</span> failed = results.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item.<span class="hljs-property">status</span> === <span class="hljs-string">'rejected'</span>);
  <span class="hljs-keyword">if</span> (failed.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {
    <span class="hljs-comment">// 有失败，模拟all的快速失败（抛出第一个错误，或汇总所有错误）</span>
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`共<span class="hljs-subst">${failed.length}</span>个任务失败：<span class="hljs-subst">${failed[<span class="hljs-number">0</span>].reason}</span>`</span>);
  }
  <span class="hljs-comment">// 全部成功，返回裸值（和all一致）</span>
  <span class="hljs-keyword">return</span> results.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item.<span class="hljs-property">value</span>);
}
</code></pre>
<h4 data-id="heading-35">总结</h4>
<p>记住两个核心选型口诀：</p>
<ol>
<li><strong>“缺一不可选 all”</strong>：多个任务是核心流程的依赖，失败后流程无意义，用 <code>Promise.all</code>；</li>
<li><strong>“要全量结果选 allSettled”</strong>：多个任务独立，需要统计每个任务的成败，用 <code>Promise.allSettled</code>。</li>
</ol>
<p>这样在实际开发中，你可以快速根据业务诉求做出选择，不会用错 API～</p>
<h2 data-id="heading-36">Promise.any</h2>
<p>Promise.any：<code>Promise.all反过来，只要有一个成功就 resolve，所有都失败才 reject。(你想想，Promise.all 是所有成功才 resolve，一个失败就reject)</code></p>
<p>所以实现如下- <code>一切反着来就对了</code>：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> promiseAny = (iterable) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>)=&gt;</span> {
        <span class="hljs-keyword">let</span> promises = []
        <span class="hljs-keyword">try</span> {
            promises = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(iterable);
        } <span class="hljs-keyword">catch</span> (err) {
            <span class="hljs-keyword">return</span> <span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">TypeError</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-keyword">typeof</span> iterable}</span> <span class="hljs-subst">${iterable}</span> is not iterable (cannot read property Symbol(Symbol.iterator))`</span>)); 
        }
        <span class="hljs-keyword">if</span> (promises.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">AggregateError</span>([], <span class="hljs-string">'All promises were rejected'</span>))

        <span class="hljs-keyword">let</span> result = []
        <span class="hljs-keyword">let</span> count = <span class="hljs-number">0</span>
        <span class="hljs-keyword">let</span> isFulfilled = <span class="hljs-literal">false</span>; <span class="hljs-comment">// 标记是否已拒绝，避免重复处理</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; promises.<span class="hljs-property">length</span>; i++) {
            <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(promises[i]).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">res</span>)=&gt;</span> {
                <span class="hljs-keyword">if</span> (isFulfilled)<span class="hljs-keyword">return</span>
                isFulfilled = <span class="hljs-literal">true</span>;
                <span class="hljs-title function_">resolve</span>(res)
            }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err</span>)=&gt;</span> {
                <span class="hljs-keyword">if</span> (isFulfilled) <span class="hljs-keyword">return</span>
                result[i] = err
                count++
                <span class="hljs-keyword">if</span> (count === promises.<span class="hljs-property">length</span>) <span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">AggregateError</span>(result, <span class="hljs-string">'All promises were rejected'</span>))
            })
        }

</code></pre>
<h2 data-id="heading-37">Promise.race</h2>
<p>Promise.race：<code>去掉计数器，只要有一个任务（成功/失败），就立刻 resolve/reject；</code></p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> promiseRace = (iterable) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>)=&gt;</span> {
        <span class="hljs-keyword">let</span> promises = []
        <span class="hljs-keyword">try</span> {
            promises = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(iterable);
        } <span class="hljs-keyword">catch</span> (err) {
            <span class="hljs-keyword">return</span> <span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">TypeError</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-keyword">typeof</span> iterable}</span> <span class="hljs-subst">${iterable}</span> is not iterable (cannot read property Symbol(Symbol.iterator))`</span>)); 
        }
        <span class="hljs-keyword">if</span> (promises.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> 

        <span class="hljs-comment">// let result = [] --&gt;</span>
        <span class="hljs-comment">// let count = 0 --&gt;</span>
        <span class="hljs-keyword">let</span> isSettle = <span class="hljs-literal">false</span>; <span class="hljs-comment">// 标记是否已拒绝，避免重复处理</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; promises.<span class="hljs-property">length</span>; i++) {
            <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(promises[i]).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">res</span>)=&gt;</span> {
                <span class="hljs-keyword">if</span> (isSettle)<span class="hljs-keyword">return</span>
                isSettle = <span class="hljs-literal">true</span>;

                <span class="hljs-comment">// result[i] = res --&gt;</span>
                <span class="hljs-title function_">resolve</span>(res)
            }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err</span>)=&gt;</span> {
                <span class="hljs-keyword">if</span> (isSettle)<span class="hljs-keyword">return</span>
                isSettle = <span class="hljs-literal">true</span>;
                <span class="hljs-comment">// if (isFulfilled) return --&gt;</span>
                <span class="hljs-comment">// result[i] = err --&gt;</span>
                <span class="hljs-comment">// count++ --&gt;</span>
                <span class="hljs-comment">// if (count === promises.length) reject(new AggregateError(result, 'All promises were rejected')) --&gt;</span>
                <span class="hljs-title function_">reject</span>(err)
            })
        }

    })

</code></pre>
<p><code>Promise.race</code> 的核心要点：</p>
<ul>
<li>✅ 快速响应：第一个完成的 Promise（无论成败）决定最终状态；</li>
<li>✅ 空数组处理：永远挂起（不 resolve/reject）；</li>
<li>✅ 状态保护：<code>isSettled</code> 标记避免重复触发状态改变；</li>
<li>✅ 入参校验：非可迭代对象 reject <code>TypeError</code>。</li>
</ul>
<h2 data-id="heading-38">总结</h2>
<p>通过以上分析，是不是 记住 <code>Promise.all</code> 后，其他方法的实现逻辑可以类比，举一反三了！这篇我们就分享到这，希望能对大家有帮助吧。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【LeetCode 刷题系列｜第 2 篇】详解盛最多水的容器：从暴力到双指针的优化之路💧]]></title>    <link>https://juejin.cn/post/7596241980870000674</link>    <guid>https://juejin.cn/post/7596241980870000674</guid>    <pubDate>2026-01-19T01:55:38.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7596241980870000674" data-draft-id="7565049154553970728" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【LeetCode 刷题系列｜第 2 篇】详解盛最多水的容器：从暴力到双指针的优化之路💧"/> <meta itemprop="keywords" content="前端,面试,算法"/> <meta itemprop="datePublished" content="2026-01-19T01:55:38.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="秋天的一阵风"/> <meta itemprop="url" content="https://juejin.cn/user/3588413946594925"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【LeetCode 刷题系列｜第 2 篇】详解盛最多水的容器：从暴力到双指针的优化之路💧
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3588413946594925/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    秋天的一阵风
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-19T01:55:38.000Z" title="Mon Jan 19 2026 01:55:38 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-19
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读12分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">🌊 前言</h2>
<p>各位掘金的小伙伴们，咱们刷题系列又见面啦！今天要攻克的是 LeetCode 上的经典中等题 ——「盛最多水的容器」。这道题和上一篇讲的「接雨水」虽然都和 “水” 有关，但思路却大不相同：接雨水是算所有低洼能存多少水，而这道题是找<strong>两个柱子之间能装最多水的区域</strong>。看似简单的问题，却藏着从暴力到高效解法的巧妙优化，尤其适合理解 “双指针” 的核心思想。话不多说，咱们一步步拆解，让你彻底搞懂这道题～</p>
<h2 data-id="heading-1">一、LeetCode 盛最多水的容器题目详情</h2>
<h3 data-id="heading-2">1. 题目描述</h3>
<p>给定一个长度为 n 的整数数组 height。有 n 条垂线，第 i 条线的两个端点是 (i, 0) 和 (i, height[i])。找出其中的两条线，使得它们与 x 轴共同构成的容器可以容纳最多的水。</p>
<p><strong>说明</strong>：你不能倾斜容器，且 n 的值至少为 2。</p>
<p><strong>题目链接</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fleetcode.cn%2Fproblems%2Fcontainer-with-most-water%2F" target="_blank" title="https://leetcode.cn/problems/container-with-most-water/" ref="nofollow noopener noreferrer">1</a><a href="https://link.juejin.cn?target=https%3A%2F%2Fleetcode.cn%2Fproblems%2Fcontainer-with-most-water%2F" target="_blank" title="https://leetcode.cn/problems/container-with-most-water/" ref="nofollow noopener noreferrer">1.</a><a href="https://link.juejin.cn?target=https%3A%2F%2Fleetcode.cn%2Fproblems%2Fcontainer-with-most-water%2F" target="_blank" title="https://leetcode.cn/problems/container-with-most-water/" ref="nofollow noopener noreferrer"> 盛最</a><a href="https://link.juejin.cn?target=https%3A%2F%2Fleetcode.cn%2Fproblems%2Fcontainer-with-most-water%2F" target="_blank" title="https://leetcode.cn/problems/container-with-most-water/" ref="nofollow noopener noreferrer">多水的</a><a href="https://link.juejin.cn?target=https%3A%2F%2Fleetcode.cn%2Fproblems%2Fcontainer-with-most-water%2F" target="_blank" title="https://leetcode.cn/problems/container-with-most-water/" ref="nofollow noopener noreferrer">容器</a><a href="https://link.juejin.cn?target=https%3A%2F%2Fleetcode.cn%2Fproblems%2Fcontainer-with-most-water%2F" target="_blank" title="https://leetcode.cn/problems/container-with-most-water/" ref="nofollow noopener noreferrer"> - 力</a><a href="https://link.juejin.cn?target=https%3A%2F%2Fleetcode.cn%2Fproblems%2Fcontainer-with-most-water%2F" target="_blank" title="https://leetcode.cn/problems/container-with-most-water/" ref="nofollow noopener noreferrer">扣（L</a><a href="https://link.juejin.cn?target=https%3A%2F%2Fleetcode.cn%2Fproblems%2Fcontainer-with-most-water%2F" target="_blank" title="https://leetcode.cn/problems/container-with-most-water/" ref="nofollow noopener noreferrer">ee</a><a href="https://link.juejin.cn?target=https%3A%2F%2Fleetcode.cn%2Fproblems%2Fcontainer-with-most-water%2F" target="_blank" title="https://leetcode.cn/problems/container-with-most-water/" ref="nofollow noopener noreferrer">tCo</a><a href="https://link.juejin.cn?target=https%3A%2F%2Fleetcode.cn%2Fproblems%2Fcontainer-with-most-water%2F" target="_blank" title="https://leetcode.cn/problems/container-with-most-water/" ref="nofollow noopener noreferrer">de）</a></p>
<h3 data-id="heading-3">2. 示例演示</h3>
<ul>
<li>输入：height = [1,8,6,2,5,4,8,3,7]</li>
</ul>

<ul>
<li>输出：49</li>
</ul>

<ul>
<li>解释：图中垂直线代表输入数组 [1,8,6,2,5,4,8,3,7]。在此情况下，容器能够容纳水（表示为蓝色部分）的最大值为 49（由索引 1 的 8 和索引 8 的 7 组成，宽度 7，高度取较矮的 7，7×7=49）。</li>
</ul>

<ul>
<li>输入：height = [1,1]</li>
</ul>

<ul>
<li>输出：1</li>
</ul>
<h3 data-id="heading-4">3. 难度级别</h3>
<p>🟠 中等：这道题的难点在于如何从 O (n²) 的暴力解法优化到 O (n) 的高效解法，核心是理解 “为什么双指针移动能保留最优解”。</p>
<h2 data-id="heading-5">二、解题思路大剖析</h2>
<h3 data-id="heading-6">1. 暴力解法：枚举所有可能的容器</h3>
<p>暴力解法的思路很直接：<strong>枚举所有可能的两根柱子组合，计算它们能容纳的水量，取最大值</strong>。</p>
<h4 data-id="heading-7">核心公式：</h4>
<p>容器的水量 = 两根柱子之间的宽度 × 两根柱子中较矮的高度</p>
<p>即：area = (j - i) × Math.min(height[i], height[j])（其中 i &lt; j）</p>
<h4 data-id="heading-8">分步拆解演示（以输入 [1,8,6,2,5,4,8,3,7] 为例）：</h4>
<p>我们需要遍历所有 i &lt; j 的组合：</p>
<ul>
<li><strong>i=0, j=1</strong>：宽度 1，高度 min (1,8)=1 → 面积 1×1=1；</li>
</ul>

<ul>
<li><strong>i=0, j=2</strong>：宽度 2，高度 min (1,6)=1 → 面积 2×1=2；</li>
</ul>

<ul>
<li><strong>i=0, j=3</strong>：宽度 3，高度 min (1,2)=1 → 面积 3×1=3；</li>
</ul>

<ul>
<li>...</li>
</ul>

<ul>
<li><strong>i=1, j=8</strong>：宽度 7（8-1=7），高度 min (8,7)=7 → 面积 7×7=49；</li>
</ul>

<ul>
<li><strong>i=6, j=8</strong>：宽度 2（8-6=2），高度 min (8,7)=7 → 面积 2×7=14；</li>
</ul>

<ul>
<li>所有组合计算完成后，最大值为 49。</li>
</ul>
<h4 data-id="heading-9">JavaScript 代码实现（暴力解法）：</h4>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">/**
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">number[]</span>} <span class="hljs-variable">height</span>
 * <span class="hljs-doctag">@return</span> {<span class="hljs-type">number</span>}
 */</span>
<span class="hljs-keyword">var</span> maxArea = <span class="hljs-keyword">function</span>(<span class="hljs-params">height</span>) {
    <span class="hljs-keyword">const</span> n = height.<span class="hljs-property">length</span>;
    <span class="hljs-keyword">let</span> maxArea = <span class="hljs-number">0</span>; <span class="hljs-comment">// 存储最大面积，初始为0</span>
    <span class="hljs-comment">// 外层循环：枚举左柱子（索引i从0到n-2）</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; n - <span class="hljs-number">1</span>; i++) {
        <span class="hljs-comment">// 内层循环：枚举右柱子（索引j从i+1到n-1）</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> j = i + <span class="hljs-number">1</span>; j &lt; n; j++) {
            <span class="hljs-comment">// 计算当前组合的宽度（j - i）和有效高度（较矮的柱子高度）</span>
            <span class="hljs-keyword">const</span> width = j - i;
            <span class="hljs-keyword">const</span> validHeight = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(height[i], height[j]);
            <span class="hljs-comment">// 计算当前容器面积</span>
            <span class="hljs-keyword">const</span> currentArea = width * validHeight;
            <span class="hljs-comment">// 更新最大面积（取当前面积和历史最大面积的较大值）</span>
            maxArea = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(maxArea, currentArea);
        }
    }
    <span class="hljs-keyword">return</span> maxArea;
};
<span class="hljs-comment">// 测试用例验证</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">maxArea</span>([<span class="hljs-number">1</span>,<span class="hljs-number">8</span>,<span class="hljs-number">6</span>,<span class="hljs-number">2</span>,<span class="hljs-number">5</span>,<span class="hljs-number">4</span>,<span class="hljs-number">8</span>,<span class="hljs-number">3</span>,<span class="hljs-number">7</span>])); <span class="hljs-comment">// 输出49，符合预期</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">maxArea</span>([<span class="hljs-number">1</span>,<span class="hljs-number">1</span>])); <span class="hljs-comment">// 输出1，符合预期</span>
</code></pre>
<h4 data-id="heading-10">暴力解法的优缺点：</h4>
<ul>
<li>优点：思路简单直观，无需复杂逻辑，新手容易理解和实现；</li>
</ul>

<ul>
<li>缺点：时间复杂度为 O (n²)（两层循环，枚举所有组合），当 n 超过 10^4 时会触发超时，无法通过 LeetCode 的所有测试用例。</li>
</ul>
<h3 data-id="heading-11">2. 双指针解法：高效缩小范围找最优解</h3>
<p>双指针的核心思路是<strong>通过左右指针从数组两端向中间移动，每次舍弃较短的柱子，保留可能产生更大面积的组合</strong>，从而将时间复杂度优化到 O (n)（仅需遍历一次数组）。</p>
<h4 data-id="heading-12">核心原理：</h4>
<ol>
<li><strong>初始状态</strong>：左指针 left 指向数组最左侧（索引 0），右指针 right 指向数组最右侧（索引 n-1），此时两根柱子的宽度最大（n-1），是所有组合中宽度的最大值；</li>
</ol>

<ol start="2">
<li><strong>面积计算</strong>：根据核心公式计算当前指针组合的面积，更新最大面积；</li>
</ol>

<ol start="3">
<li><strong>指针移动规则</strong>：<strong>谁矮就移动谁</strong>——</li>
</ol>
<ul>
<li>
<ul>
<li>若 height[left] &lt; height[right]：左柱子更矮，移动左指针（left++）；</li>
</ul>
</li>
</ul>

<ul>
<li>
<ul>
<li>若 height[left] &gt;= height[right]：右柱子更矮（或等高），移动右指针（right--）；</li>
</ul>
</li>
</ul>
<ol start="4">
<li><strong>终止条件</strong>：当 left &gt;= right 时，指针相遇，所有可能的有效组合已遍历完成，循环终止。</li>
</ol>
<h4 data-id="heading-13">关键疑问：为什么 “谁矮移谁” 能保留最优解？</h4>
<p>假设当前左指针 i 对应的柱子高度为 h[i]，右指针 j 对应的柱子高度为 h[j]，且 h[i] &lt; h[j]：</p>
<ul>
<li>此时容器的有效高度由 h[i] 决定（因为高度取较矮值），宽度为 j - i，面积为 (j - i) * h[i]；</li>
</ul>

<ul>
<li>若移动右指针 j 向左（j--），新的宽度变为 j' - i（j' = j-1），宽度一定减小；而有效高度最多还是 h[i]（因为左柱子 i 没动，且 h[i] 是较矮的），所以新面积 (j' - i) * min(h[i], h[j']) &lt;= (j' - i) * h[i] &lt; (j - i) * h[i]，即新面积一定小于当前面积；</li>
</ul>

<ul>
<li>若移动左指针 i 向右（i++），虽然宽度减小，但可能遇到更高的左柱子（h[i'] &gt; h[i]），此时有效高度可能增大，从而获得比当前更大的面积；</li>
</ul>

<ul>
<li>综上，移动较矮的指针是唯一可能找到更大面积的选择，移动较高的指针则一定不会得到更优解，因此 “谁矮移谁” 的规则是合理的。</li>
</ul>
<h2 data-id="heading-14">三、双指针解法分步拆解（带图解 + 每步细节）</h2>
<p>以测试用例 height = [1,8,6,2,5,4,8,3,7] 为例，逐轮拆解指针移动、面积计算和最大面积更新的全过程：</p>
<h3 data-id="heading-15">1. 初始状态说明</h3>
<ul>
<li>数组长度 n=9；</li>
</ul>

<ul>
<li>指针位置：left=0（指向高度 1），right=8（指向高度 7）；</li>
</ul>

<ul>
<li>最大面积：maxArea=0（初始值）。</li>
</ul>
<h3 data-id="heading-16">2. 初始状态图解</h3>
<pre><code class="hljs language-ini" lang="ini">索引：0 1 2 3 4 5 6 7 8
高度：1 8 6 2 5 4 8 3 7
      L                    R  （<span class="hljs-attr">L</span>=<span class="hljs-number">0</span>，R=<span class="hljs-number">8</span>）
当前宽度：<span class="hljs-attr">8-0</span>=<span class="hljs-number">8</span>
当前有效高度：min(1,7)=1
当前面积：8×<span class="hljs-attr">1</span>=<span class="hljs-number">8</span>
maxArea：max(0,8)=8
</code></pre>
<h3 data-id="heading-17">3. 逐轮遍历详细步骤</h3>
<h4 data-id="heading-18">第 1 轮：left=0，right=8</h4>
<ul>
<li>高度对比：height[0]=1 &lt; height[8]=7（左指针更矮）；</li>
</ul>

<ul>
<li>指针移动：left++ → left=1（指向高度 8）；</li>
</ul>

<ul>
<li>计算当前面积：宽度 8-1=7，有效高度 min(8,7)=7，面积 7×7=49；</li>
</ul>

<ul>
<li>更新最大面积：maxArea = max(8,49)=49；</li>
</ul>

<ul>
<li>本轮图解：</li>
</ul>
<pre><code class="hljs language-ini" lang="ini">索引：0 1 2 3 4 5 6 7 8
高度：1 8 6 2 5 4 8 3 7
        L                  R  （<span class="hljs-attr">L</span>=<span class="hljs-number">1</span>，R=<span class="hljs-number">8</span>）
maxArea：49
</code></pre>
<h4 data-id="heading-19">第 2 轮：left=1，right=8</h4>
<ul>
<li>高度对比：height[1]=8 &gt; height[8]=7（右指针更矮）；</li>
</ul>

<ul>
<li>指针移动：right-- → right=7（指向高度 3）；</li>
</ul>

<ul>
<li>计算当前面积：宽度 7-1=6，有效高度 min(8,3)=3，面积 6×3=18；</li>
</ul>

<ul>
<li>更新最大面积：maxArea = max(49,18)=49（无变化）；</li>
</ul>

<ul>
<li>本轮图解：</li>
</ul>
<pre><code class="hljs language-ini" lang="ini">索引：0 1 2 3 4 5 6 7 8
高度：1 8 6 2 5 4 8 3 7
        L              R  （<span class="hljs-attr">L</span>=<span class="hljs-number">1</span>，R=<span class="hljs-number">7</span>）
maxArea：49
</code></pre>
<h4 data-id="heading-20">第 3 轮：left=1，right=7</h4>
<ul>
<li>高度对比：height[1]=8 &gt; height[7]=3（右指针更矮）；</li>
</ul>

<ul>
<li>指针移动：right-- → right=6（指向高度 8）；</li>
</ul>

<ul>
<li>计算当前面积：宽度 6-1=5，有效高度 min(8,8)=8，面积 5×8=40；</li>
</ul>

<ul>
<li>更新最大面积：maxArea = max(49,40)=49（无变化）；</li>
</ul>

<ul>
<li>本轮图解：</li>
</ul>
<pre><code class="hljs language-ini" lang="ini">索引：0 1 2 3 4 5 6 7 8
高度：1 8 6 2 5 4 8 3 7
        L            R  （<span class="hljs-attr">L</span>=<span class="hljs-number">1</span>，R=<span class="hljs-number">6</span>）
maxArea：49
</code></pre>
<h4 data-id="heading-21">第 4 轮：left=1，right=6</h4>
<ul>
<li>高度对比：height[1]=8 == height[6]=8（两根柱子等高）；</li>
</ul>

<ul>
<li>指针移动：任意移动（此处选择移动右指针）→ right-- → right=5（指向高度 4）；</li>
</ul>

<ul>
<li>计算当前面积：宽度 5-1=4，有效高度 min(8,4)=4，面积 4×4=16；</li>
</ul>

<ul>
<li>更新最大面积：maxArea = max(49,16)=49（无变化）；</li>
</ul>

<ul>
<li>本轮图解：</li>
</ul>
<pre><code class="hljs language-ini" lang="ini">索引：0 1 2 3 4 5 6 7 8
高度：1 8 6 2 5 4 8 3 7
        L        R  （<span class="hljs-attr">L</span>=<span class="hljs-number">1</span>，R=<span class="hljs-number">5</span>）
maxArea：49
</code></pre>
<h4 data-id="heading-22">第 5 轮：left=1，right=5</h4>
<ul>
<li>高度对比：height[1]=8 &gt; height[5]=4（右指针更矮）；</li>
</ul>

<ul>
<li>指针移动：right-- → right=4（指向高度 5）；</li>
</ul>

<ul>
<li>计算当前面积：宽度 4-1=3，有效高度 min(8,5)=5，面积 3×5=15；</li>
</ul>

<ul>
<li>更新最大面积：maxArea = max(49,15)=49（无变化）；</li>
</ul>

<ul>
<li>本轮图解：</li>
</ul>
<pre><code class="hljs language-ini" lang="ini">索引：0 1 2 3 4 5 6 7 8
高度：1 8 6 2 5 4 8 3 7
        L      R  （<span class="hljs-attr">L</span>=<span class="hljs-number">1</span>，R=<span class="hljs-number">4</span>）
maxArea：49
</code></pre>
<h4 data-id="heading-23">第 6 轮：left=1，right=4</h4>
<ul>
<li>高度对比：height[1]=8 &gt; height[4]=5（右指针更矮）；</li>
</ul>

<ul>
<li>指针移动：right-- → right=3（指向高度 2）；</li>
</ul>

<ul>
<li>计算当前面积：宽度 3-1=2，有效高度 min(8,2)=2，面积 2×2=4；</li>
</ul>

<ul>
<li>更新最大面积：maxArea = max(49,4)=49（无变化）；</li>
</ul>

<ul>
<li>本轮图解：</li>
</ul>
<pre><code class="hljs language-ini" lang="ini">索引：0 1 2 3 4 5 6 7 8
高度：1 8 6 2 5 4 8 3 7
        L    R  （<span class="hljs-attr">L</span>=<span class="hljs-number">1</span>，R=<span class="hljs-number">3</span>）
maxArea：49
</code></pre>
<h4 data-id="heading-24">第 7 轮：left=1，right=3</h4>
<ul>
<li>高度对比：height[1]=8 &gt; height[3]=2（右指针更矮）；</li>
</ul>

<ul>
<li>指针移动：right-- → right=2（指向高度 6）；</li>
</ul>

<ul>
<li>计算当前面积：宽度 2-1=1，有效高度 min(8,6)=6，面积 1×6=6；</li>
</ul>

<ul>
<li>更新最大面积：maxArea = max(49,6)=49（无变化）；</li>
</ul>

<ul>
<li>本轮图解：</li>
</ul>
<pre><code class="hljs language-ini" lang="ini">索引：0 1 2 3 4 5 6 7 8
高度：1 8 6 2 5 4 8 3 7
        L  R  （<span class="hljs-attr">L</span>=<span class="hljs-number">1</span>，R=<span class="hljs-number">2</span>）
maxArea：49
</code></pre>
<h5 data-id="heading-25">第 8 轮：left=1，right=2</h5>
<ul>
<li>高度对比：height[1]=8 &gt; height[2]=6（右指针更矮）；</li>
</ul>

<ul>
<li>指针移动：right-- → right=1；</li>
</ul>

<ul>
<li>终止判断：此时 left=1，right=1，满足 left &gt;= right，循环终止；</li>
</ul>

<ul>
<li>最终最大面积：49。</li>
</ul>
<h3 data-id="heading-26">4. 最终结果</h3>
<p>最大面积为 49，与测试用例 height = [1,8,6,2,5,4,8,3,7] 的预期输出一致，验证双指针解法的正确性。</p>
<h2 data-id="heading-27">四、JavaScript 代码实现（双指针解法）</h2>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">/**
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">number[]</span>} <span class="hljs-variable">height</span>
 * <span class="hljs-doctag">@return</span> {<span class="hljs-type">number</span>}
 */</span>
<span class="hljs-keyword">var</span> maxArea = <span class="hljs-keyword">function</span>(<span class="hljs-params">height</span>) {
    <span class="hljs-keyword">let</span> left = <span class="hljs-number">0</span>; <span class="hljs-comment">// 左指针：初始指向数组最左侧（索引0）</span>
    <span class="hljs-keyword">let</span> right = height.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>; <span class="hljs-comment">// 右指针：初始指向数组最右侧（索引n-1）</span>
    <span class="hljs-keyword">let</span> maxArea = <span class="hljs-number">0</span>; <span class="hljs-comment">// 存储最大面积，初始为0</span>
    <span class="hljs-comment">// 循环：当左指针小于右指针时，继续遍历</span>
    <span class="hljs-keyword">while</span> (left &lt; right) {
        <span class="hljs-comment">// 1. 计算当前指针组合的宽度和有效高度</span>
        <span class="hljs-keyword">const</span> width = right - left; <span class="hljs-comment">// 宽度 = 右指针索引 - 左指针索引</span>
        <span class="hljs-keyword">const</span> validHeight = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(height[left], height[right]); <span class="hljs-comment">// 有效高度 = 两根柱子的较矮值</span>
        
        <span class="hljs-comment">// 2. 计算当前面积，并更新最大面积</span>
        <span class="hljs-keyword">const</span> currentArea = width * validHeight;
        maxArea = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(maxArea, currentArea);
        <span class="hljs-comment">// 3. 指针移动：谁矮移谁</span>
        <span class="hljs-keyword">if</span> (height[left] &lt; height[right]) {
            left++; <span class="hljs-comment">// 左柱子更矮，左指针右移</span>
        } <span class="hljs-keyword">else</span> {
            right--; <span class="hljs-comment">// 右柱子更矮（或等高），右指针左移</span>
        }
    }
    <span class="hljs-keyword">return</span> maxArea; <span class="hljs-comment">// 返回最大面积</span>
};
<span class="hljs-comment">// 测试用例验证</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">maxArea</span>([<span class="hljs-number">1</span>,<span class="hljs-number">8</span>,<span class="hljs-number">6</span>,<span class="hljs-number">2</span>,<span class="hljs-number">5</span>,<span class="hljs-number">4</span>,<span class="hljs-number">8</span>,<span class="hljs-number">3</span>,<span class="hljs-number">7</span>])); <span class="hljs-comment">// 输出49，符合预期</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">maxArea</span>([<span class="hljs-number">1</span>,<span class="hljs-number">1</span>])); <span class="hljs-comment">// 输出1，符合预期</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">maxArea</span>([<span class="hljs-number">4</span>,<span class="hljs-number">3</span>,<span class="hljs-number">2</span>,<span class="hljs-number">1</span>,<span class="hljs-number">4</span>])); <span class="hljs-comment">// 输出16（索引0和4，宽度4，高度4，4×4=16）</span>
</code></pre>
<h2 data-id="heading-28">五、复杂度分析</h2>
<h3 data-id="heading-29">1. 时间复杂度</h3>
<ul>
<li>暴力解法：O (n²)，两层嵌套循环，枚举所有 i &lt; j 的组合，组合数量为 n(n-1)/2，时间复杂度与 n² 成正比；</li>
</ul>

<ul>
<li>双指针解法：O (n)，左右指针从两端向中间移动，每个指针最多移动 n-1 次，总遍历次数为 O(n)，时间复杂度与数组长度成正比。</li>
</ul>
<h3 data-id="heading-30">2. 空间复杂度</h3>
<ul>
<li>暴力解法：O (1)，仅使用 maxArea、width、validHeight 等常数级变量，额外空间不随数组长度变化；</li>
</ul>

<ul>
<li>双指针解法：O (1)，仅使用 left、right、maxArea 等常数级变量，额外空间同样为常数级。</li>
</ul>
<h2 data-id="heading-31">六、总结与拓展</h2>
<h3 data-id="heading-32">1. 方法对比与推荐</h3>


























<table><thead><tr><th>解法</th><th>时间复杂度</th><th>空间复杂度</th><th>适用场景</th><th>推荐度</th></tr></thead><tbody><tr><td>暴力解法</td><td>O(n²)</td><td>O(1)</td><td>理解题意、新手入门</td><td>⭐⭐</td></tr><tr><td>双指针解法</td><td>O(n)</td><td>O(1)</td><td>面试答题、实际项目、LeetCode 提交</td><td>⭐⭐⭐⭐⭐</td></tr></tbody></table>
<p><strong>面试推荐</strong>：优先选择双指针解法，它不仅效率高，而且逻辑清晰，能体现对 “优化枚举” 思路的理解，是面试官期望看到的解法。</p>
<h3 data-id="heading-33">2. 核心逻辑提炼</h3>
<p>双指针解法的本质是 <strong>“舍次保优”</strong>：通过初始时选择最大宽度的组合，后续每次舍弃 “不可能产生更优解” 的较矮柱子，在宽度减小的同时，尽可能寻找更高的柱子来提升有效高度，从而在一次遍历中找到最优解。这种思路在很多 “枚举优化” 类问题中都有应用。</p>
<h3 data-id="heading-34">3. 拓展思考</h3>
<p>类似的 “双指针优化暴力枚举” 问题：</p>
<ul>
<li>LeetCode 15. 三数之和（排序后用双指针将 O (n³) 优化为 O (n²)）；</li>
</ul>

<ul>
<li>LeetCode 167. 两数之和 II - 输入有序数组（双指针从两端向中间移动，O (n) 时间复杂度）；</li>
</ul>

<ul>
<li>LeetCode 42. 接雨水（双指针优化空间复杂度，从 O (n) 降至 O (1)）。</li>
</ul>
<p>建议大家尝试用 “双指针” 思路解决这些问题，加深对 “指针移动规则” 的理解，做到举一反三。</p>
<h2 data-id="heading-35">七、互动环节</h2>
<p>今天的「盛最多水的容器」就讲解到这里啦！相信大家已经掌握了双指针的核心逻辑 ——“谁矮移谁”。如果在分步拆解过程中还有疑问，或者有其他优化思路（比如是否有更巧妙的指针移动方式），欢迎在评论区留言讨论～</p>
<p>下一篇专栏，咱们会继续攻克 LeetCode 高频题（可能是 “三数之和” 或 “无重复字符的最长子串”），关注我，刷题路上不迷路！咱们下期再见～ 👋</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[JavaScript 核心 —— 彻底搞懂 Window 对象与 BOM 家族]]></title>    <link>https://juejin.cn/post/7596186565270306831</link>    <guid>https://juejin.cn/post/7596186565270306831</guid>    <pubDate>2026-01-18T12:57:10.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7596186565270306831" data-draft-id="7595960824486461474" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="JavaScript 核心 —— 彻底搞懂 Window 对象与 BOM 家族"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-18T12:57:10.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="红色的小鳄鱼"/> <meta itemprop="url" content="https://juejin.cn/user/4501859894316474"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            JavaScript 核心 —— 彻底搞懂 Window 对象与 BOM 家族
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4501859894316474/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    红色的小鳄鱼
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-18T12:57:10.000Z" title="Sun Jan 18 2026 12:57:10 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>很多同学 DOM 玩得很溜，但一到 BOM 就有点懵。其实日常开发中我们大量用到的功能（跳转页面、获取浏览器信息、倒计时、前进后退、获取 URL 参数……）几乎都来自 BOM。</p>
<h2 data-id="heading-0">搞清楚一个最核心的概念：window 到底是谁？</h2>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 这两个写法其实是一样的</span>
<span class="hljs-title function_">alert</span>(<span class="hljs-string">"hi"</span>);
<span class="hljs-variable language_">window</span>.<span class="hljs-title function_">alert</span>(<span class="hljs-string">"hi"</span>);
</code></pre>
<p>window 是：</p>
<ul>
<li>浏览器的顶级对象（BOM 的核心）</li>
<li>JavaScript 的全局对象（所有全局变量、全局函数都是它的属性/方法）</li>
<li>所有 BOM 对象（location、navigator、history、screen...）都是它的子对象</li>
</ul>
<p>一句话总结：
<strong>你写的大部分“全局”东西，其实都是在跟 window 打交道。</strong></p>
<h2 data-id="heading-1">window 常见事件</h2>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 写法1：推荐（能等所有资源加载完，包括图片）</span>
<span class="hljs-variable language_">window</span>.<span class="hljs-property">onload</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"整个页面（包括图片等）都加载完了～"</span>);
};

<span class="hljs-comment">// 写法2：只等 DOM 结构加载完（图片可能还没加载完，速度更快）</span>
<span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">"DOMContentLoaded"</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"DOM 树构建完毕～"</span>);
});
</code></pre>
<blockquote>
<p>现在的项目基本都用框架，window.onload 反而用得少了，但面试还是经常问～</p>
</blockquote>
<h2 data-id="heading-2">定时器 —— 前端最常用的异步手段之一</h2>
<p>详见另一篇文章</p>
<h2 data-id="heading-3">JS 执行机制</h2>
<p>JavaScript 采用单线程模型，这意味着同一时刻主线程只能执行一个任务。为了处理耗时操作（如网络请求、定时器、DOM 操作等），JavaScript 引入了异步机制，其核心就是事件循环（Event Loop）。</p>
<h3 data-id="heading-4">任务分类</h3>
<p>JavaScript 中的任务主要分为两类：</p>
<ul>
<li>
<p>同步任务
在主线程上按顺序立即执行的任务，例如变量声明、函数调用、基本的算术运算等。</p>
</li>
<li>
<p>异步任务
不立即执行、会被推迟处理的任务，主要包括：定时器；DOM 事件回调；网络请求；Promise 的 then/catch/finally 回调等</p>
</li>
</ul>
<h3 data-id="heading-5">经典的事件循环执行流程</h3>
<ol>
<li>执行当前宏任务（从主线程执行栈开始）</li>
<li>执行栈清空后，立即清空当前所有微任务（执行微任务队列）</li>
<li>微任务队列清空后，从宏任务队列中取出一个宏任务，回到步骤1</li>
<li>重复上述过程，直到宏任务队列与微任务队列都为空</li>
</ol>
<h3 data-id="heading-6">经典面试题解析</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'1'</span>);

<span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'2'</span>);
}, <span class="hljs-number">0</span>);

<span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>()
    .<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'3'</span>))
    .<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'4'</span>));

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'5'</span>);
</code></pre>
<p>执行顺序分析：</p>
<ol>
<li>同步代码执行 → 输出 1、5</li>
<li>遇到 setTimeout，将其回调放入宏任务队列</li>
<li>遇到 Promise.then，将其回调放入微任务队列</li>
<li>前宏任务（全局脚本）结束，清空微任务队列 → 输出 3、4</li>
<li>微任务队列空了，从宏任务队列取任务 → 执行 setTimeout 回调 → 输出 2</li>
</ol>
<p>最终输出顺序：</p>
<pre><code class="hljs language-bash" lang="bash">1
5
3
4
2
</code></pre>
<p>理解宏任务与微任务的执行优先级，是掌握现代 JavaScript 异步编程的基础。</p>
<h2 data-id="heading-7">location 对象 —— URL 操作与页面导航</h2>
<p><em><strong>location 对象</strong></em>提供了对当前浏览器地址栏信息的完整读写能力，是前端路由跳转、参数解析最常用的 API 之一。</p>
<h3 data-id="heading-8">页面跳转与刷新方法</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 方法一：最常用，直接赋值</span>
location.<span class="hljs-property">href</span> = <span class="hljs-string">"https://www.example.com"</span>;

<span class="hljs-comment">// 方法二：类似 href，但语义更明确</span>
location.<span class="hljs-title function_">assign</span>(<span class="hljs-string">"https://www.example.com"</span>);

<span class="hljs-comment">// 方法三：替换当前历史记录，无法后退</span>
location.<span class="hljs-title function_">replace</span>(<span class="hljs-string">"https://www.example.com"</span>);

<span class="hljs-comment">// 方法四：刷新当前页面</span>
location.<span class="hljs-title function_">reload</span>();           <span class="hljs-comment">// 正常刷新（优先使用缓存）</span>
location.<span class="hljs-title function_">reload</span>(<span class="hljs-literal">true</span>);       <span class="hljs-comment">// 强制从服务器重新加载（相当于 Ctrl+F5）</span>
</code></pre>
<blockquote>
<p>注意：在现代单页应用（SPA）中，建议优先使用 history.pushState/replaceState 进行无刷新跳转，而非频繁使用 location.href。</p>
</blockquote>
<h2 data-id="heading-9">history 对象 —— 浏览器历史记录管理</h2>
<p>history 对象允许开发者对浏览器前进/后退栈进行读写操作，是实现单页应用路由的核心机制之一。</p>
<h3 data-id="heading-10">基础导航方法</h3>
<pre><code class="hljs language-javascript" lang="javascript">history.<span class="hljs-title function_">back</span>();       <span class="hljs-comment">// 等价于浏览器后退按钮</span>
history.<span class="hljs-title function_">forward</span>();    <span class="hljs-comment">// 等价于前进按钮</span>
history.<span class="hljs-title function_">go</span>(n);        <span class="hljs-comment">// n 可正可负，0 表示刷新当前页</span>
</code></pre>
<h3 data-id="heading-11">7.2 HTML5 History API（SPA 核心）</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 添加一条新历史记录（修改地址栏但不刷新页面）</span>
history.<span class="hljs-title function_">pushState</span>({ <span class="hljs-attr">page</span>: <span class="hljs-number">1</span> }, <span class="hljs-string">""</span>, <span class="hljs-string">"/page1"</span>);

<span class="hljs-comment">// 替换当前历史记录（不增加新条目）</span>
history.<span class="hljs-title function_">replaceState</span>({ <span class="hljs-attr">page</span>: <span class="hljs-number">2</span> }, <span class="hljs-string">""</span>, <span class="hljs-string">"/page2"</span>);

<span class="hljs-comment">// 监听历史状态变化（后退、前进触发）</span>
<span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">"popstate"</span>, <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"当前状态："</span>, event.<span class="hljs-property">state</span>);
    <span class="hljs-comment">// 根据 event.state 重新渲染页面</span>
});
</code></pre>
<blockquote>
<p>推荐实践：现代前端框架（Vue Router、React Router）内部几乎全部基于 pushState / replaceState + popstate 事件实现路由管理。</p>
</blockquote>
<h2 data-id="heading-12">总结</h2>
<p>Window 对象作为浏览器环境的全局根对象，统领整个 BOM 体系；通过定时器实现异步调度，依托单线程事件循环模型处理任务；借助 location、history ，完成 URL 操作、运行时环境识别以及历史记录管理的核心功能，成为连接 JavaScript 运行时与浏览器实际能力的关键桥梁。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【面试必问】手撕 LeetCode “三数之和”：双指针+去重，这一篇图解给你讲透！]]></title>    <link>https://juejin.cn/post/7596245612557549577</link>    <guid>https://juejin.cn/post/7596245612557549577</guid>    <pubDate>2026-01-18T13:12:09.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7596245612557549577" data-draft-id="7596166721628323886" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【面试必问】手撕 LeetCode “三数之和”：双指针+去重，这一篇图解给你讲透！"/> <meta itemprop="keywords" content="面试,算法"/> <meta itemprop="datePublished" content="2026-01-18T13:12:09.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="NEXT06"/> <meta itemprop="url" content="https://juejin.cn/user/1176918763246011"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【面试必问】手撕 LeetCode “三数之和”：双指针+去重，这一篇图解给你讲透！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1176918763246011/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    NEXT06
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-18T13:12:09.000Z" title="Sun Jan 18 2026 13:12:09 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言：为什么你总倒在“三数之和”？</h2>
<p>太多面试者在 <strong>LeetCode 第1题 “两数之和”</strong>  上重拳出击，用 HashMap 秒杀全场；然而一旦题目变成 <strong>第15题 “三数之和”</strong> ，由于无法直接套用 Hash 策略，很多人就开始支支吾吾，最后写出了一个 </p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">O</span>(n3)
</code></pre>
<p> 的暴力三层循环。</p>
<p><strong>兄弟们，面试写</strong></p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">O</span>(n3)
</code></pre>
<p><strong>，基本上就是“回家等通知”的节奏了，还能打包一份"凉面"。</strong>  </p>
<p>其实，这道题是考察  <strong>“排序 + 双指针”</strong>  的经典范例。它的难点不在于找数字，而在于 <strong>如何优雅地去重</strong>。今天，就带你一步步拆解这道大厂必考题，保证你下次遇到能手撕得明明白白！</p>
<hr/>
<h2 data-id="heading-1">一、核心思路：降维打击（排序 + 双指针）</h2>
<p>解决“三数之和”的核心在于将 <strong>三维问题降低到二维</strong>。</p>
<p>如果我们固定其中一个数字（假设为 nums[i]），那么问题就变成了：<strong>在剩下的数组中，找到两个数 left 和 right，使得 nums[left] + nums[right] = -nums[i]</strong> 。</p>
<p>看！这不就变回我们熟悉的“两数之和”了吗？</p>
<p>但是，为了让双指针能跑起来，我们需要一个前提：<strong>数组必须是有序的</strong>。</p>
<h3 data-id="heading-2">1. 为什么要排序？</h3>
<p>这就要我们深刻理解 sort 的意义：</p>
<p>JavaScript</p>
<pre><code class="hljs language-css" lang="css">// <span class="hljs-selector-tag">a</span> - <span class="hljs-selector-tag">b</span> &lt; <span class="hljs-number">0</span>  =&gt; <span class="hljs-selector-tag">a</span> 在前 <span class="hljs-selector-tag">b</span> 在后 (升序)
nums<span class="hljs-selector-class">.sort</span>((<span class="hljs-selector-tag">a</span>, <span class="hljs-selector-tag">b</span>) =&gt; <span class="hljs-selector-tag">a</span> - <span class="hljs-selector-tag">b</span>);
</code></pre>
<p>排序有两个巨大的好处：</p>
<ol>
<li><strong>单调性</strong>：数组有序后，如果三数之和偏大，我们只能通过左移右指针来减小总和；反之亦然。这是双指针能生效的物理基础。</li>
<li><strong>方便去重</strong>：重复的元素会挨在一起，我们只需要判断 nums[i] === nums[i-1] 就能轻松跳过重复项。</li>
</ol>
<h3 data-id="heading-3">2. 双指针布局</h3>
<ol>
<li>一层 for 循环，索引 i 从 0 到 length-2，这是我们的<strong>固定桩</strong>。</li>
<li>left 指针指向 i + 1（桩子的下一位）。</li>
<li>right 指针指向 length - 1（数组末尾）。</li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e3ad53213f6d4666a2298643c6f8ea8e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTkVYVDA2:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769346728&amp;x-signature=wMfGnkyPaGRG79DUXjGqs6Rtvl0%3D" alt="屏幕截图 2026-01-18 210516.png" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-4">二、动图级流程解析：指针怎么动？</h2>
<p>一旦 i 固定了，left 和 right 就开始向中间靠拢。在这个过程中，我们计算 sum = nums[i] + nums[left] + nums[right]。</p>
<p>这里有三种情况，逻辑非常清晰：</p>
<ol>
<li>
<p><strong>sum &gt; 0（和太大了）</strong></p>
<ul>
<li>原因：数组是升序的，右边的数太大。</li>
<li>动作：<strong>right--</strong>（右指针左移，找个小点的数）。</li>
</ul>
</li>
<li>
<p><strong>sum &lt; 0（和太小了）</strong></p>
<ul>
<li>原因：左边的数太小。</li>
<li>动作：<strong>left++</strong> （左指针右移，找个大点的数）。</li>
</ul>
</li>
<li>
<p><strong>sum == 0（中奖了！）</strong></p>
<ul>
<li>动作：把 [nums[i], nums[left], nums[right]] 加入结果集 res。</li>
<li><strong>关键点</strong>：不仅要记录，还要<strong>同时收缩</strong> left++ 和 right--，继续寻找下一组可能的解。</li>
</ul>
</li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5faea8079d374dd98b68f3173c7bf676~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTkVYVDA2:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769346728&amp;x-signature=N9U3GmRPP01v4U6oF0LnegIJVsU%3D" alt="屏幕截图 2026-01-18 210923.png" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-5">三、地狱级细节：如何优雅地去重？💀</h2>
<p>这道题 80% 的挂科率都出在<strong>去重</strong>上。题目要求结果集中不能包含重复的三元组（例如不能出现两个 [-1, 0, 1]）。</p>
<p>我们在两个维度进行去重：</p>
<h3 data-id="heading-6">1. 外层循环去重（固定桩去重）</h3>
<p><strong>代码：</strong></p>
<p>JavaScript</p>
<pre><code class="hljs language-css" lang="css">if (<span class="hljs-selector-tag">i</span> &gt; <span class="hljs-number">0</span> &amp;&amp; nums<span class="hljs-selector-attr">[i]</span> == nums<span class="hljs-selector-attr">[i-1]</span>) {
    continue;
}
</code></pre>
<p><strong>面试官追问：</strong>  为什么是 nums[i] == nums[i-1] 而不是 nums[i] == nums[i+1]？</p>
<p><strong>解析：</strong></p>
<ul>
<li>如果是 nums[i] == nums[i+1]，对于数组 [-1, -1, 2]，当 i 指向第一个 -1 时，你就把它跳过了。那你就会漏掉 [-1, -1, 2] 这个有效解（因为这两个 -1 是不同位置的，可以共存）。</li>
<li>我们用 nums[i] == nums[i-1] 的意思是： <strong>“如果当前的数字和上一个数字一样，说明上一个数字已经把所有可能的组合都找过了，我就不用再找一遍了”</strong> 。</li>
</ul>
<h3 data-id="heading-7">2. 内层双指针去重</h3>
<p>找到一个答案后，还没完！left 和 right 移动后的新位置可能还是和刚才一样的数字。<br/>
<strong>代码：</strong></p>
<p>JavaScript</p>
<pre><code class="hljs language-sql" lang="sql">while(<span class="hljs-keyword">left</span> <span class="hljs-operator">&lt;</span> <span class="hljs-keyword">right</span> <span class="hljs-operator">&amp;&amp;</span> nums[<span class="hljs-keyword">left</span>] <span class="hljs-operator">=</span><span class="hljs-operator">=</span> nums[<span class="hljs-keyword">left</span><span class="hljs-number">-1</span>]) { <span class="hljs-keyword">left</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span>; }
while(<span class="hljs-keyword">left</span> <span class="hljs-operator">&lt;</span> <span class="hljs-keyword">right</span> <span class="hljs-operator">&amp;&amp;</span> nums[<span class="hljs-keyword">right</span>] <span class="hljs-operator">=</span><span class="hljs-operator">=</span> nums[<span class="hljs-keyword">right</span><span class="hljs-operator">+</span><span class="hljs-number">1</span>]) { <span class="hljs-keyword">right</span><span class="hljs-comment">--; }</span>
</code></pre>
<p>这步操作必须在 res.push 并且常规移动 left++/right-- 之后进行，确保彻底跳过重复段。</p>
<hr/>
<h2 data-id="heading-8">四、完整代码展示 (可以直接背诵版)</h2>
<p>优化版本，加上了详细的注释：</p>
<p>JavaScript</p>
<pre><code class="hljs language-css" lang="css">function threeSum(nums) {
    const res = <span class="hljs-selector-attr">[]</span>;
    
    // <span class="hljs-number">1</span>. 必须先排序！这是双指针生效的前提
    // sort 是 JS 内置排序，<span class="hljs-selector-tag">a</span>-<span class="hljs-selector-tag">b</span> &lt; <span class="hljs-number">0</span> 表示升序
    nums<span class="hljs-selector-class">.sort</span>((<span class="hljs-selector-tag">a</span>, <span class="hljs-selector-tag">b</span>) =&gt; <span class="hljs-selector-tag">a</span> - <span class="hljs-selector-tag">b</span>);
    
    const len = nums<span class="hljs-selector-class">.length</span>;
    
    // <span class="hljs-number">2</span>. 遍历每一个数字作为“固定桩” <span class="hljs-selector-tag">i</span>
    for (let <span class="hljs-selector-tag">i</span> = <span class="hljs-number">0</span>; <span class="hljs-selector-tag">i</span> &lt; len - <span class="hljs-number">2</span>; <span class="hljs-selector-tag">i</span>++) {
        
        // 【核心去重<span class="hljs-number">1</span>】：跳过重复的起点
        // 注意是 <span class="hljs-selector-tag">i</span> &gt; <span class="hljs-number">0</span> 且和 <span class="hljs-selector-tag">i</span>-<span class="hljs-number">1</span> 比，不是和 <span class="hljs-selector-tag">i</span>+<span class="hljs-number">1</span> 比
        if (<span class="hljs-selector-tag">i</span> &gt; <span class="hljs-number">0</span> &amp;&amp; nums<span class="hljs-selector-attr">[i]</span> === nums<span class="hljs-selector-attr">[i-1]</span>) {
            continue;
        }
        
        let <span class="hljs-attribute">left</span> = <span class="hljs-selector-tag">i</span> + <span class="hljs-number">1</span>;
        let <span class="hljs-attribute">right</span> = len - <span class="hljs-number">1</span>;
        
        while (<span class="hljs-attribute">left</span> &lt; <span class="hljs-attribute">right</span>) {
            const sum = nums<span class="hljs-selector-attr">[i]</span> + nums<span class="hljs-selector-attr">[left]</span> + nums<span class="hljs-selector-attr">[right]</span>;
            
            if (sum === <span class="hljs-number">0</span>) {
                // 找到一组解
                res<span class="hljs-selector-class">.push</span>(<span class="hljs-selector-attr">[nums[i]</span>, nums<span class="hljs-selector-attr">[left]</span>, nums<span class="hljs-selector-attr">[right]</span>]);
                
                // 无论如何都要移动指针
                <span class="hljs-attribute">left</span>++;
                <span class="hljs-attribute">right</span>--;
                
                // 【核心去重<span class="hljs-number">2</span>】：跳过重复的 <span class="hljs-attribute">left</span>
                while (<span class="hljs-attribute">left</span> &lt; <span class="hljs-attribute">right</span> &amp;&amp; nums<span class="hljs-selector-attr">[left]</span> === nums<span class="hljs-selector-attr">[left-1]</span>) {
                    <span class="hljs-attribute">left</span>++;
                }
                
                // 【核心去重<span class="hljs-number">3</span>】：跳过重复的 <span class="hljs-attribute">right</span>
                while (<span class="hljs-attribute">left</span> &lt; <span class="hljs-attribute">right</span> &amp;&amp; nums<span class="hljs-selector-attr">[right]</span> === nums<span class="hljs-selector-attr">[right+1]</span>) {
                    <span class="hljs-attribute">right</span>--;
                }
                
            } else if (sum &lt; <span class="hljs-number">0</span>) {
                // 和太小，左指针右移让和变大
                <span class="hljs-attribute">left</span>++;
            } else {
                // 和太大，右指针左移让和变小
                <span class="hljs-attribute">right</span>--;
            }
        }
    }
    return res;
}
</code></pre>
<hr/>
<h2 data-id="heading-9">五、复杂度分析</h2>
<ul>
<li>
<p><strong>时间复杂度</strong>：</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">O</span>(n2)
</code></pre>
<ul>
<li>
<p>数组排序通常是快排，复杂度 </p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">O</span>(nlog⁡n)
</code></pre>
<p>。</p>
</li>
<li>
<p>双指针遍历过程：外层循环 </p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">O</span>(n)
</code></pre>
<p>，内层双指针 </p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">O</span>(n)
</code></pre>
<p>，乘积是 </p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">O</span>(n2)
</code></pre>
<p>。</p>
</li>
<li>
<p>总体：</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">O</span>(n2)
</code></pre>
<p>，远优于暴力的 </p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">O</span>(n3)
</code></pre>
<p>。</p>
</li>
</ul>
</li>
<li>
<p><strong>空间复杂度</strong>：</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">O</span>(<span class="hljs-number">1</span>)
</code></pre>
<p> 或 </p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">O</span>(log⁡n)
</code></pre>
<ul>
<li>
<p>如果你不计算存储结果的 res 数组，额外的空间主要是排序算法栈的空间（取决于语言底层实现），通常认为是 </p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">O</span>(log⁡n)
</code></pre>
<p> 或 </p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">O</span>(<span class="hljs-number">1</span>)
</code></pre>
<p>。</p>
</li>
</ul>
</li>
</ul>
<hr/>
<h2 data-id="heading-10">六、总结</h2>
<p>做这道题，心里要默念这句<strong>四步口诀</strong>：</p>
<ol>
<li><strong>一排序</strong>：无序没法玩，sort 走在前。</li>
<li><strong>二定桩</strong>：for 循环定 i，去重要判前（i-1）。</li>
<li><strong>三双指</strong>：left、right 两头堵，大了左移小右顾。</li>
<li><strong>四去重</strong>：找到答案别停步，while 循环跳重复。</li>
</ol>
<p>学会了吗？别光看，赶紧打开编辑器 <strong>手撕</strong> 一遍吧！觉得有用的兄弟，点个赞再走呗！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【LeetCode 刷题系列 | 第 1 篇】前端老司机拆解接雨水问题，从暴力到最优解💦]]></title>    <link>https://juejin.cn/post/7596241980870017058</link>    <guid>https://juejin.cn/post/7596241980870017058</guid>    <pubDate>2026-01-19T01:56:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7596241980870017058" data-draft-id="7564307224267538447" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【LeetCode 刷题系列 | 第 1 篇】前端老司机拆解接雨水问题，从暴力到最优解💦"/> <meta itemprop="keywords" content="前端,面试,算法"/> <meta itemprop="datePublished" content="2026-01-19T01:56:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="秋天的一阵风"/> <meta itemprop="url" content="https://juejin.cn/user/3588413946594925"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【LeetCode 刷题系列 | 第 1 篇】前端老司机拆解接雨水问题，从暴力到最优解💦
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3588413946594925/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    秋天的一阵风
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-19T01:56:42.000Z" title="Mon Jan 19 2026 01:56:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-19
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">🌧️ 前言</h2>
<p><strong/></p><p align="center"><strong>Hello~大家好。我是秋天的一阵风</strong></p><p/>
<p>欢迎来到我的 LeetCode 刷题系列专栏～ 作为一名深耕前端多年的老司机，我深知算法能力对前端工程师的重要性 —— 它不仅能帮我们在面试中脱颖而出，更能提升日常业务代码的逻辑严谨性和性能优化能力。</p>
<p>今天咱们要攻克的是 <strong>LeetCode 中的经典 hard 题「接雨水」</strong>，这道题堪称 “面试高频钉子户”，考察的核心是对数组遍历和边界判断的理解。</p>
<p>很多同学一开始会被它唬住，但只要咱们从基础思路慢慢拆解，再逐步优化，就能轻松拿捏！话不多说，咱们直奔主题～</p>
<h2 data-id="heading-1">一、LeetCode 接雨水题目详情</h2>
<h3 data-id="heading-2">1. 题目描述</h3>
<p>给定 n 个非负整数表示每个宽度为 1 的柱子的高度图，计算按此排列的柱子，下雨之后能接多少雨水。</p>
<p><strong>题目链接</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fleetcode.cn%2Fproblems%2Ftrapping-rain-water%2F" target="_blank" title="https://leetcode.cn/problems/trapping-rain-water/" ref="nofollow noopener noreferrer">42.</a><a href="https://link.juejin.cn?target=https%3A%2F%2Fleetcode.cn%2Fproblems%2Ftrapping-rain-water%2F" target="_blank" title="https://leetcode.cn/problems/trapping-rain-water/" ref="nofollow noopener noreferrer"> 接雨水</a><a href="https://link.juejin.cn?target=https%3A%2F%2Fleetcode.cn%2Fproblems%2Ftrapping-rain-water%2F" target="_blank" title="https://leetcode.cn/problems/trapping-rain-water/" ref="nofollow noopener noreferrer"> - 力扣（</a><a href="https://link.juejin.cn?target=https%3A%2F%2Fleetcode.cn%2Fproblems%2Ftrapping-rain-water%2F" target="_blank" title="https://leetcode.cn/problems/trapping-rain-water/" ref="nofollow noopener noreferrer">LeetC</a><a href="https://link.juejin.cn?target=https%3A%2F%2Fleetcode.cn%2Fproblems%2Ftrapping-rain-water%2F" target="_blank" title="https://leetcode.cn/problems/trapping-rain-water/" ref="nofollow noopener noreferrer">ode）</a></p>
<h3 data-id="heading-3">2. 示例演示</h3>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4ec78c89e89d4b6a9b77daf1efa37754~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56eL5aSp55qE5LiA6Zi16aOO:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769393009&amp;x-signature=a8gDnkLeie50qq56hbVDkhq96lc%3D" alt="image.png" width="100%" loading="lazy"/>
<ul>
<li>输入：height = [0,1,0,2,1,0,1,3,2,1,2,1]</li>
</ul>

<ul>
<li>输出：6</li>
</ul>

<ul>
<li>解释：如题目中的高度图所示，下雨后能接住 6 单位的雨水。</li>
</ul>

<ul>
<li>输入：height = [4,2,0,3,2,5]</li>
</ul>

<ul>
<li>输出：9</li>
</ul>
<h3 data-id="heading-4">3. 难度级别</h3>
<p>🔴 困难：这道题之所以被归为困难，是因为它需要突破常规的遍历思维，从 “局部最优” 推导 “全局最优”。但只要掌握了核心逻辑，它其实是一道 “纸老虎” 题～</p>
<h2 data-id="heading-5">二、解题思路大剖析</h2>
<h3 data-id="heading-6">1. 暴力解法：直捣黄龙的基础思路</h3>
<p>暴力解法的核心逻辑很朴素：<strong>逐个计算每个柱子能接的雨水量，最后求和</strong>。而一个柱子能接多少水，完全取决于它左右两侧的 “最高屏障”—— 也就是左右两侧最高柱子中较矮的那一个，<strong>用这个较矮值减去当前柱子的高度，就是该位置能接的水量</strong>（若结果为负，则接 0 水）。</p>
<h4 data-id="heading-7">核心步骤拆解：</h4>
<ol>
<li>遍历数组中的每一个柱子（索引从 0 到 n-1）；</li>
</ol>

<ol start="2">
<li>对当前柱子 i，向左遍历所有柱子，找到左侧的最高高度<code>leftMax</code>；</li>
</ol>

<ol start="3">
<li>对当前柱子 i，向右遍历所有柱子，找到右侧的最高高度 <code>rightMax</code>；</li>
</ol>

<ol start="4">
<li>计算当前柱子的接水量：<code>Math.max(0, Math.min(leftMax, rightMax) - height[i])；</code></li>
</ol>

<ol start="5">
<li>累加所有柱子的接水量，得到总水量。</li>
</ol>
<h4 data-id="heading-8">分步拆解演示（以输入 [0,1,0,2,1,0,1,3,2,1,2,1] 为例）：</h4>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4ec78c89e89d4b6a9b77daf1efa37754~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56eL5aSp55qE5LiA6Zi16aOO:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769393009&amp;x-signature=a8gDnkLeie50qq56hbVDkhq96lc%3D" alt="image.png" width="100%" loading="lazy"/>
<p>咱们逐个扒开每个位置的接水逻辑，从索引 0 开始：</p>
<ul>
<li><strong>索引 0</strong>：左侧没有柱子，leftMax=0；右侧最高柱子高度是 3。min(0,3)=0，接水量 0-0=0；</li>
</ul>

<ul>
<li><strong>索引 1</strong>：左侧最高是 0，右侧最高是 3。min(0,3)=0，接水量 0-1=-1，取 0；</li>
</ul>

<ul>
<li><strong>索引 2</strong>：左侧遍历 [0,1]，最高是 1；右侧遍历 [2,1,0,1,3,2,1,2,1]，最高是 3。min(1,3)=1，接水量 1-0=1；</li>
</ul>

<ul>
<li><strong>索引 3</strong>：左侧最高是 1，右侧最高是 3。min(1,3)=1，接水量 1-2=-1，取 0；</li>
</ul>

<ul>
<li><strong>索引 4</strong>：左侧最高是 2，右侧最高是 3。min(2,3)=2，接水量 2-1=1；</li>
</ul>

<ul>
<li><strong>索引 5</strong>：左侧最高是 2，右侧最高是 3。min(2,3)=2，接水量 2-0=2；</li>
</ul>

<ul>
<li><strong>索引 6</strong>：左侧最高是 2，右侧最高是 3。min(2,3)=2，接水量 2-1=1；</li>
</ul>

<ul>
<li><strong>索引 7</strong>：左侧最高是 2，右侧最高是 2。min(2,2)=2，接水量 2-2=0;</li>
</ul>

<ul>
<li><strong>索引 8</strong>：左侧最高是 3，右侧最高是 2。min(3,2)=2，接水量 2-2=0；</li>
</ul>

<ul>
<li><strong>索引 9</strong>：左侧最高是 3，右侧最高是 2。min(3,2)=2，接水量 2-1=1；</li>
</ul>

<ul>
<li><strong>索引 10</strong>：左侧最高是 3，右侧最高是 1。min(3,1)=1，接水量 1-2=-1，取 0；</li>
</ul>

<ul>
<li><strong>索引 11</strong>：右侧没有柱子，接水量 0；</li>
</ul>
<p>把这些有效接水量相加：<code>1+1+2+1+1=6</code>，和示例输出一致！</p>
<h4 data-id="heading-9">JavaScript 代码实现（暴力解法）：</h4>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">/**
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">number[]</span>} <span class="hljs-variable">height</span>
 * <span class="hljs-doctag">@return</span> {<span class="hljs-type">number</span>}
 */</span>
<span class="hljs-keyword">var</span> trap = <span class="hljs-keyword">function</span>(<span class="hljs-params">height</span>) {
    <span class="hljs-keyword">const</span> n = height.<span class="hljs-property">length</span>;
    <span class="hljs-keyword">let</span> total = <span class="hljs-number">0</span>; <span class="hljs-comment">// 总接水量</span>
    <span class="hljs-comment">// 遍历每个柱子（除了首尾也可以，但不影响结果，代码更简洁）</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; n; i++) {
        <span class="hljs-keyword">let</span> leftMax = <span class="hljs-number">0</span>; <span class="hljs-comment">// 左侧最高柱子高度</span>
        <span class="hljs-keyword">let</span> rightMax = <span class="hljs-number">0</span>; <span class="hljs-comment">// 右侧最高柱子高度</span>
        <span class="hljs-comment">// 向左遍历，找左侧最高</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> j = i; j &gt;= <span class="hljs-number">0</span>; j--) {
            leftMax = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(leftMax, height[j]);
        }
        <span class="hljs-comment">// 向右遍历，找右侧最高</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> j = i; j &lt; n; j++) {
            rightMax = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(rightMax, height[j]);
        }
        <span class="hljs-comment">// 计算当前柱子的接水量，累加到总水量</span>
        total += <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(leftMax, rightMax) - height[i];
    }
    <span class="hljs-keyword">return</span> total;
};
<span class="hljs-comment">// 测试用例</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">trap</span>([<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>,<span class="hljs-number">2</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">3</span>,<span class="hljs-number">2</span>,<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">1</span>])); <span class="hljs-comment">// 输出6</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">trap</span>([<span class="hljs-number">4</span>,<span class="hljs-number">2</span>,<span class="hljs-number">0</span>,<span class="hljs-number">3</span>,<span class="hljs-number">2</span>,<span class="hljs-number">5</span>])); <span class="hljs-comment">// 输出9</span>
</code></pre>
<h4 data-id="heading-10">暴力解法的优缺点：</h4>
<ul>
<li>优点：思路简单直观，容易理解，适合作为入门思路；</li>
</ul>

<ul>
<li>缺点：时间复杂度极高，为 O (n²)（每个柱子都要左右遍历一次），当 n 较大时（比如 10^4）会直接超时，不适合实际面试场景。</li>
</ul>
<h3 data-id="heading-11">2. 双指针解法：空间优化的最优思路</h3>
<p>暴力解法的问题在于 “重复遍历”，双指针的核心是<strong>利用左右两侧的最大值关系，在一次遍历中完成计算</strong>，把时间复杂度降到 O (n)，空间复杂度优化到 O (1)。</p>
<h4 data-id="heading-12">核心原理：</h4>
<ul>
<li>定义左右指针 left（初始 0）和 right（初始 n-1）；</li>
</ul>

<ul>
<li>定义 leftMax（左侧已遍历的最高高度）和 rightMax（右侧已遍历的最高高度）；</li>
</ul>

<ul>
<li>当 height[left] &lt;= height[right] 时，左侧的最大值 leftMax 决定了当前 left 位置的接水量（因为右侧有更高的柱子兜底）；</li>
</ul>

<ul>
<li>反之，右侧的最大值 rightMax 决定当前 right 位置的接水量；</li>
</ul>

<ul>
<li><strong>遍历过程中不断更新 leftMax、rightMax 和总水量，直到指针相遇。</strong></li>
</ul>
<h4 data-id="heading-13">JavaScript 代码实现（双指针解法）：</h4>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">/**
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">number[]</span>} <span class="hljs-variable">height</span>
 * <span class="hljs-doctag">@return</span> {<span class="hljs-type">number</span>}
 */</span>
<span class="hljs-keyword">var</span> trap = <span class="hljs-keyword">function</span>(<span class="hljs-params">height</span>) {
    <span class="hljs-keyword">const</span> n = height.<span class="hljs-property">length</span>;
    <span class="hljs-keyword">if</span> (n &lt; <span class="hljs-number">3</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>; <span class="hljs-comment">// 少于3个柱子无法接水</span>
    <span class="hljs-keyword">let</span> left = <span class="hljs-number">0</span>, right = n - <span class="hljs-number">1</span>;
    <span class="hljs-keyword">let</span> leftMax = <span class="hljs-number">0</span>, rightMax = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">let</span> total = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">while</span> (left &lt; right) {
        <span class="hljs-comment">// 左侧柱子更矮，以leftMax为基准</span>
        <span class="hljs-keyword">if</span> (height[left] &lt;= height[right]) {
            <span class="hljs-keyword">if</span> (height[left] &gt;= leftMax) {
                leftMax = height[left]; <span class="hljs-comment">// 更新左侧最高</span>
            } <span class="hljs-keyword">else</span> {
                total += leftMax - height[left]; <span class="hljs-comment">// 计算当前位置接水量</span>
            }
            left++; <span class="hljs-comment">// 左指针右移</span>
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// 右侧柱子更矮，以rightMax为基准</span>
            <span class="hljs-keyword">if</span> (height[right] &gt;= rightMax) {
                rightMax = height[right]; <span class="hljs-comment">// 更新右侧最高</span>
            } <span class="hljs-keyword">else</span> {
                total += rightMax - height[right]; <span class="hljs-comment">// 计算当前位置接水量</span>
            }
            right--; <span class="hljs-comment">// 右指针左移</span>
        }
    }
    <span class="hljs-keyword">return</span> total;
};
<span class="hljs-comment">// 测试用例</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">trap</span>([<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>,<span class="hljs-number">2</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">3</span>,<span class="hljs-number">2</span>,<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">1</span>])); <span class="hljs-comment">// 输出6</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">trap</span>([<span class="hljs-number">4</span>,<span class="hljs-number">2</span>,<span class="hljs-number">0</span>,<span class="hljs-number">3</span>,<span class="hljs-number">2</span>,<span class="hljs-number">5</span>])); <span class="hljs-comment">// 输出9</span>
</code></pre>
<h2 data-id="heading-14">三、复杂度分析</h2>
<h3 data-id="heading-15">1. 时间复杂度</h3>
<ul>
<li>暴力解法：O (n²)，双层循环导致重复遍历；</li>
</ul>

<ul>
<li>双指针解法：O (n)，一次遍历完成所有计算；</li>
</ul>
<h3 data-id="heading-16">2. 空间复杂度</h3>
<ul>
<li>暴力解法：O (1)，仅使用常数级额外空间；</li>
</ul>

<ul>
<li>双指针解法：O (1)，同样仅使用常数级额外空间；</li>
</ul>
<h2 data-id="heading-17">总结</h2>
<p>好啦，今天的接雨水问题就讲到这里！相信大家已经对这道题的各种解法了如指掌。如果你有更优的思路，或者在刷题过程中遇到了疑问，欢迎在评论区留言讨论～</p>
<p>下一篇专栏，咱们将攻克另一道前端面试高频题，猜猜是什么？关注我，刷题不迷路！咱们下期再见～ 👋</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[前端文件【上传&下载】姿势大全]]></title>    <link>https://juejin.cn/post/7596230910213029931</link>    <guid>https://juejin.cn/post/7596230910213029931</guid>    <pubDate>2026-01-18T12:48:00.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7596230910213029931" data-draft-id="7596230910212997163" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="前端文件【上传&amp;下载】姿势大全"/> <meta itemprop="keywords" content="前端,JavaScript"/> <meta itemprop="datePublished" content="2026-01-18T12:48:00.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="armantang"/> <meta itemprop="url" content="https://juejin.cn/user/3913917125634183"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            前端文件【上传&amp;下载】姿势大全
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3913917125634183/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    armantang
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-18T12:48:00.000Z" title="Sun Jan 18 2026 12:48:00 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>本文介绍浏览器与服务器之间文件传输的常见方式，涵盖文件的获取、上传、下载全流程，并附带代码示例。</p>
<h2 data-id="heading-0">1 浏览器获取用户本地文件</h2>
<p>在浏览器中根据不同场景，有多种获取文件的方式。</p>
<h3 data-id="heading-1">1.1 点击上传</h3>
<p>通过点击文件表单实现上传，最基础、兼容性最好的方式。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"file"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"file"</span> /&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
  <span class="hljs-keyword">const</span> file = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'file'</span>)
  file.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'change'</span>, <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> file = e.<span class="hljs-property">target</span>.<span class="hljs-property">files</span>[<span class="hljs-number">0</span>]
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'🚀 ~ file --&gt;'</span>, file)
  })
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"file"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"dir"</span> <span class="hljs-attr">webkitdirectory</span> <span class="hljs-attr">multiple</span> /&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
  <span class="hljs-keyword">const</span> input = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'dir'</span>);
  input.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'change'</span>, <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> files = e.<span class="hljs-property">target</span>.<span class="hljs-property">files</span>;
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'🚀 ~ files --&gt;'</span>, files)
  });
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<h3 data-id="heading-2">1.2 拖拽上传</h3>
<p>直接拖动文件到页面，交互体验好，符合直觉，适合批量文件。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"drop"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"width:300px;height:200px;border:2px dashed #999;"</span>&gt;</span>
  Drop files here
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
  <span class="hljs-keyword">const</span> drop = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'drop'</span>);

  drop.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'dragover'</span>, <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
    e.<span class="hljs-title function_">preventDefault</span>();
  });

  drop.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'drop'</span>, <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
    e.<span class="hljs-title function_">preventDefault</span>();
    <span class="hljs-keyword">const</span> files = e.<span class="hljs-property">dataTransfer</span>.<span class="hljs-property">files</span>;
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'🚀 ~ files --&gt;'</span>, files)
  });
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<h3 data-id="heading-3">1.3 粘贴上传</h3>
<p>将剪切板文件粘贴到页面中，交互体验好，效率高，特别适合上传临时截图。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>在此页面 Ctrl / Cmd + V 粘贴文件<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
  <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'paste'</span>, <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> items = e.<span class="hljs-property">clipboardData</span>.<span class="hljs-property">items</span>;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> item <span class="hljs-keyword">of</span> items) {
      <span class="hljs-keyword">if</span> (item.<span class="hljs-property">kind</span> === <span class="hljs-string">'file'</span>) {
        <span class="hljs-keyword">const</span> file = item.<span class="hljs-title function_">getAsFile</span>();
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'🚀 ~ file --&gt;'</span>, file)
      }
    }
  });
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<h3 data-id="heading-4">1.4 通过媒体设备获取资源</h3>
<p>适用于需要捕获摄像头或麦克风媒体资源时的特殊场景。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"btnOpen"</span>&gt;</span>打开摄像头<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"btnShot"</span>&gt;</span>截图<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">video</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"video"</span> <span class="hljs-attr">autoplay</span> <span class="hljs-attr">playsinline</span> <span class="hljs-attr">muted</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">video</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"preview"</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">""</span> /&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
  <span class="hljs-keyword">const</span> btnOpen = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'btnOpen'</span>);
  <span class="hljs-keyword">const</span> btnShot = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'btnShot'</span>);
  <span class="hljs-keyword">const</span> video = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'video'</span>);
  <span class="hljs-keyword">const</span> preview = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'preview'</span>);

  <span class="hljs-keyword">let</span> stream = <span class="hljs-literal">null</span>;
  btnOpen.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-keyword">async</span> () =&gt; {
    stream = <span class="hljs-keyword">await</span> navigator.<span class="hljs-property">mediaDevices</span>.<span class="hljs-title function_">getUserMedia</span>({
      <span class="hljs-attr">video</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-attr">audio</span>: <span class="hljs-literal">false</span>
    });
    video.<span class="hljs-property">srcObject</span> = stream;
  });

  btnShot.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">if</span> (!stream) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'Camera not started'</span>);

    <span class="hljs-keyword">const</span> track = stream.<span class="hljs-title function_">getVideoTracks</span>()[<span class="hljs-number">0</span>];
    <span class="hljs-keyword">const</span> imageCapture = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ImageCapture</span>(track);
    <span class="hljs-keyword">const</span> blob = <span class="hljs-keyword">await</span> imageCapture.<span class="hljs-title function_">takePhoto</span>();
    <span class="hljs-keyword">const</span> url = <span class="hljs-variable constant_">URL</span>.<span class="hljs-title function_">createObjectURL</span>(blob);
    preview.<span class="hljs-property">src</span> = url;

    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'🚀 ~ file --&gt;'</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(
      [blob],
      <span class="hljs-string">`screenshot-<span class="hljs-subst">${<span class="hljs-built_in">Date</span>.now()}</span>.png`</span>,
      { <span class="hljs-attr">type</span>: <span class="hljs-string">'image/png'</span> }
    ))
  });
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<h3 data-id="heading-5">1.5 File System Access API</h3>
<p>非标准的实验性接口，功能强大，支持读写。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"openFile"</span>&gt;</span>打开文件<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"openFiles"</span>&gt;</span>打开多个文件<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"openDir"</span>&gt;</span>打开目录<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
  <span class="hljs-keyword">const</span> buttonFile = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'openFile'</span>);
  buttonFile.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">const</span> [fileHandle] = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">showOpenFilePicker</span>();
    <span class="hljs-keyword">const</span> file = <span class="hljs-keyword">await</span> fileHandle.<span class="hljs-title function_">getFile</span>();
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'🚀 ~ file --&gt;'</span>, file)
  });

  <span class="hljs-keyword">const</span> buttonFiles = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'openFiles'</span>);
  buttonFiles.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">const</span> fileHandles = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">showOpenFilePicker</span>({
      <span class="hljs-attr">multiple</span>: <span class="hljs-literal">true</span>,
    });
    <span class="hljs-keyword">const</span> files = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>(fileHandles.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">fileHandle</span> =&gt;</span> fileHandle.<span class="hljs-title function_">getFile</span>()));
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'🚀 ~ files --&gt;'</span>, files)
  });

  <span class="hljs-keyword">const</span> buttonDir = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'openDir'</span>);
  buttonDir.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">const</span> dir = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">showDirectoryPicker</span>();
    <span class="hljs-keyword">const</span> files = [];
    <span class="hljs-keyword">for</span> <span class="hljs-keyword">await</span> (<span class="hljs-keyword">const</span> entry <span class="hljs-keyword">of</span> dir.<span class="hljs-title function_">values</span>()) {
      <span class="hljs-keyword">if</span> (entry.<span class="hljs-property">kind</span> === <span class="hljs-string">'file'</span>) {
        files.<span class="hljs-title function_">push</span>(<span class="hljs-keyword">await</span> entry.<span class="hljs-title function_">getFile</span>());
      }
    }
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'🚀 ~ files --&gt;'</span>, files)
  });
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<h2 data-id="heading-6">2 浏览器发送文件</h2>
<p>拿到 <code>File</code> 之后，可以使用 <code>fetch</code> 发送，如果需要显示进度可以使用 <code>XMLHttpRequest</code>。</p>
<p>请求体通常使用 <code>multipart/form-data</code> 编码格式，或者直接上传二进制文件数据。</p>
<ul>
<li><code>Content-Type: multipart/form-data</code></li>
<li><code>Content-Type: application/octet-stream</code></li>
<li><code>Content-Type: [mimetype]</code></li>
</ul>
<h3 data-id="heading-7">2.1 FormData</h3>
<p>使用 <code>FormData</code> 作为请求体，最通用的方式，适配大多数后端框架与对象存储直传。</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">const</span> fd = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FormData</span>()
fd.<span class="hljs-title function_">append</span>(<span class="hljs-string">'biz'</span>, <span class="hljs-string">'avatar'</span>)
fd.<span class="hljs-title function_">append</span>(<span class="hljs-string">'file'</span>, file)
<span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'/api/upload'</span>, {
  <span class="hljs-attr">method</span>: <span class="hljs-string">'POST'</span>,
  <span class="hljs-attr">body</span>: fd,
})
<span class="hljs-keyword">if</span> (res.<span class="hljs-property">ok</span>) {
  <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> res.<span class="hljs-title function_">json</span>()
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'🚀 ~ data --&gt;'</span>, data)
}
</code></pre>
<p>浏览器会自动将请求编码为 <code>multipart/form-data</code>，并在请求头中设置合适的 boundary。</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-attribute">Content</span>-Length <span class="hljs-number">123456</span>
<span class="hljs-attribute">Content</span>-Type   multipart/<span class="hljs-selector-tag">form</span>-data; boundary=--<span class="hljs-attr">--WebKitFormBoundaryA1B2C3D4</span>

----<span class="hljs-attr">--WebKitFormBoundaryA1B2C3D4</span>
<span class="hljs-attribute">Content</span>-Disposition: form-data; name="biz"

avatar
----<span class="hljs-attr">--WebKitFormBoundaryA1B2C3D4</span>
<span class="hljs-attribute">Content</span>-Disposition: form-data; name="file"; filename="avatar<span class="hljs-selector-class">.jpg</span>"
<span class="hljs-attribute">Content</span>-Type: image/jpeg

[binary content of JPG...]
------WebKitFormBoundaryA1B2C3D4--
</code></pre>
<h3 data-id="heading-8"><strong>2.2 二进制流</strong></h3>
<p>直接上传裸文件数据，实现简单，服务端无需解析 multipart，直接写入文件。</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'/api/upload'</span>, {
  <span class="hljs-attr">method</span>: <span class="hljs-string">'POST'</span>,
  <span class="hljs-attr">headers</span>: {
    <span class="hljs-string">'Content-Type'</span>: file.<span class="hljs-property">type</span> || <span class="hljs-string">'application/octet-stream'</span>,
    <span class="hljs-string">'X-Filename'</span>: <span class="hljs-built_in">encodeURIComponent</span>(file.<span class="hljs-property">name</span>),
  },
  <span class="hljs-attr">body</span>: file,
})
<span class="hljs-keyword">if</span> (res.<span class="hljs-property">ok</span>) {
  <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> res.<span class="hljs-title function_">json</span>()
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'🚀 ~ data --&gt;'</span>, data)
}
</code></pre>
<pre><code class="hljs language-css" lang="css"><span class="hljs-attribute">Content</span>-Length <span class="hljs-number">123456</span>
<span class="hljs-attribute">Content</span>-Type   image/jpeg
X-Filename     avatar<span class="hljs-selector-class">.jpg</span>
</code></pre>
<h2 data-id="heading-9">3 浏览器下载文件</h2>
<p>下载文件主要有两大类：下载服务端资源，或前端生成/操作文件数据。</p>
<h3 data-id="heading-10">3.1 基于服务端资源</h3>
<p>服务端提供文件下载链接：</p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">Content-Type: image/jpeg</span>
<span class="hljs-section">Content-Disposition: attachment; filename="avatar.jpg"</span>
<span class="hljs-section">Transfer-Encoding: chunked</span>
</code></pre>
<p>前端可以基于静态 <code>&lt;a&gt;</code> 标签，动态创建 <code>&lt;a&gt;</code> 标签，或者通过导航 <code>window.location/window.open</code> 触发下载：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/api/file-stream"</span>&gt;</span>下载<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"download-stream"</span>&gt;</span>按钮下载<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"nav-stream"</span>&gt;</span>导航下载<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
  <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'download-stream'</span>).<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> a = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'a'</span>)
    a.<span class="hljs-property">download</span> = <span class="hljs-string">'avatar.jpg'</span>
    a.<span class="hljs-title function_">click</span>()
  })
  <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'nav-stream'</span>).<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">href</span> = <span class="hljs-string">'/api/file-stream'</span>
  })
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p>如果服务端没有返回 <code>Content-Disposition</code>，浏览器需要通过 <code>&lt;a&gt;</code> 标签配合 <code>download</code> 属性下载文件。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/api/file-stream"</span> <span class="hljs-attr">download</span>=<span class="hljs-string">"avatar.jpg"</span>&gt;</span>下载<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
</code></pre>
<p>如果服务端有通过 <code>Content-Disposition</code> 指定文件名，浏览器通过 <code>download</code> 属性配置的文件名无效。</p>
<h4 data-id="heading-11">💡浏览器导航文件链接大致过程</h4>
<ol>
<li>解析响应头</li>
<li>根据 <code>Content-Type</code> 判断 MIME 类型，决定浏览器如何处理文件</li>
<li>根据 <code>Content-Disposition</code> 决定显示还是下载
<ol>
<li><code>inline</code> → 默认值，在页面中显示文件内容</li>
<li><code>attachment</code> → 下载文件</li>
</ol>
</li>
<li>下载文件时会根据 <code>Content-Length</code> 决定是否显示进度条</li>
<li>接收响应体并写入内存或文件</li>
</ol>
<h3 data-id="heading-12">3.2 基于二进制数据</h3>
<p>适用于前端生成文件或者导出 canvas 等场景。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"download"</span>&gt;</span>下载文本<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"downloadCanvas"</span>&gt;</span>下载 canvas 图片<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">canvas</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"canvas"</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"200"</span> <span class="hljs-attr">height</span>=<span class="hljs-string">"200"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"border: 1px solid #ccc"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">canvas</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
  <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'download'</span>).<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> blob = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Blob</span>([<span class="hljs-string">'Hello world'</span>], { <span class="hljs-attr">type</span>: <span class="hljs-string">'text/plain'</span> })
    <span class="hljs-keyword">const</span> url = <span class="hljs-variable constant_">URL</span>.<span class="hljs-title function_">createObjectURL</span>(blob)
    <span class="hljs-keyword">const</span> a = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'a'</span>)
    a.<span class="hljs-property">href</span> = url
    a.<span class="hljs-property">download</span> = <span class="hljs-string">'hello.txt'</span>
    a.<span class="hljs-title function_">click</span>()
    <span class="hljs-variable constant_">URL</span>.<span class="hljs-title function_">revokeObjectURL</span>(url)
  })

  <span class="hljs-keyword">const</span> canvas = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'canvas'</span>)
  <span class="hljs-keyword">const</span> ctx = canvas.<span class="hljs-title function_">getContext</span>(<span class="hljs-string">'2d'</span>)
  ctx.<span class="hljs-property">fillStyle</span> = <span class="hljs-string">'#4a90d9'</span>
  ctx.<span class="hljs-title function_">fillRect</span>(<span class="hljs-number">20</span>, <span class="hljs-number">20</span>, <span class="hljs-number">160</span>, <span class="hljs-number">160</span>)
  ctx.<span class="hljs-property">fillStyle</span> = <span class="hljs-string">'#fff'</span>
  ctx.<span class="hljs-property">font</span> = <span class="hljs-string">'20px sans-serif'</span>
  ctx.<span class="hljs-title function_">fillText</span>(<span class="hljs-string">'Canvas'</span>, <span class="hljs-number">60</span>, <span class="hljs-number">105</span>)
  <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'downloadCanvas'</span>).<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-function">() =&gt;</span> {
    canvas.<span class="hljs-title function_">toBlob</span>(<span class="hljs-function">(<span class="hljs-params">blob</span>) =&gt;</span> {
      <span class="hljs-keyword">const</span> url = <span class="hljs-variable constant_">URL</span>.<span class="hljs-title function_">createObjectURL</span>(blob)
      <span class="hljs-keyword">const</span> a = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'a'</span>)
      a.<span class="hljs-property">href</span> = url
      a.<span class="hljs-property">download</span> = <span class="hljs-string">'canvas.png'</span>
      a.<span class="hljs-title function_">click</span>()
      <span class="hljs-variable constant_">URL</span>.<span class="hljs-title function_">revokeObjectURL</span>(url)
    }, <span class="hljs-string">'image/png'</span>)
  })
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<h3 data-id="heading-13">3.3 基于 data URL</h3>
<p>适用于极小文本数据，特定场景有用。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"download"</span>&gt;</span>下载 SVG<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="xml">
  const svg = `<span class="hljs-tag">&lt;<span class="hljs-name">svg</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://www.w3.org/2000/svg"</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"200"</span> <span class="hljs-attr">height</span>=<span class="hljs-string">"200"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">rect</span> <span class="hljs-attr">fill</span>=<span class="hljs-string">"#4a90d9"</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"200"</span> <span class="hljs-attr">height</span>=<span class="hljs-string">"200"</span>/&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">text</span> <span class="hljs-attr">x</span>=<span class="hljs-string">"100"</span> <span class="hljs-attr">y</span>=<span class="hljs-string">"110"</span> <span class="hljs-attr">text-anchor</span>=<span class="hljs-string">"middle"</span> <span class="hljs-attr">fill</span>=<span class="hljs-string">"#fff"</span> <span class="hljs-attr">font-size</span>=<span class="hljs-string">"24"</span>&gt;</span>Hello SVG<span class="hljs-tag">&lt;/<span class="hljs-name">text</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">svg</span>&gt;</span>`
  document.getElementById('download').addEventListener('click', () =&gt; {
    const dataUrl = 'data:image/svg+xml;charset=utf-8,' + encodeURIComponent(svg)
    const a = document.createElement('a')
    a.href = dataUrl
    a.download = 'hello.svg'
    a.click()
  })
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<h3 data-id="heading-14">3.4 File System Access API</h3>
<p>非标准的实验性接口，直接保存到指定位置。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"download"</span>&gt;</span>下载文本<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
  <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'download'</span>).<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">const</span> handle = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">showSaveFilePicker</span>({
      <span class="hljs-attr">suggestedName</span>: <span class="hljs-string">'data.txt'</span>,
    })
    <span class="hljs-keyword">const</span> writable = <span class="hljs-keyword">await</span> handle.<span class="hljs-title function_">createWritable</span>()
    <span class="hljs-keyword">await</span> writable.<span class="hljs-title function_">write</span>(<span class="hljs-string">'Hello World!'</span>)
    <span class="hljs-keyword">await</span> writable.<span class="hljs-title function_">close</span>()
  })
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<h2 data-id="heading-15">4 服务端返回文件</h2>
<p><code>NodeJS</code> 一般可以通过 <code>Buffer</code> 或 <code>Stream</code> 的方式返回文件。</p>
<h3 data-id="heading-16">4.1 非流式下载（buffered download）</h3>
<p>同步阻塞，服务器将整个文件读入内存。</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">ctx.body</span> = fs.readFileSync(<span class="hljs-string">'girl.jpg'</span>)
</code></pre>
<p>服务端会返回 <code>Content-Length</code>，浏览器可以据此显示下载进度。</p>
<h3 data-id="heading-17">4.2 流式下载（streaming download）</h3>
<p>异步文件流，分块读取，适合大文件。</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">ctx.body</span> = fs.createReadStream(<span class="hljs-string">'girl.jpg'</span>)
</code></pre>
<p>流式传输不适合使用 <code>Content-Length</code>，所以不需要返回。</p>
<h4 data-id="heading-18">💡流式传输时 HTTP/1.1 和 HTTP/2 区别</h4>
<p>HTTP/1.1 默认使用分块传输 <code>Transfer-Encoding: chunked</code>。因为 HTTP/1.1 使用纯文本 + 字节流的格式实现流式传输，浏览器要么提前知道 <code>Content-Length</code>，要么在服务器主动关闭连接时才算结束。当响应长度“不可能提前知道”时，就只能靠 <code>chunked</code> 解决：遇到 chunk-size 为 0 时即整个响应结束。</p>
<p>HTTP/2 的数据帧机制知道什么时候传输结束，因此不支持 <code>chunked</code>。</p>
<h2 data-id="heading-19">📝 总结</h2>
<p>本文介绍了浏览器与服务器之间文件传输的完整流程：</p>
<ul>
<li><strong>获取文件</strong>：支持表单上传、拖拽、粘贴、设备采集和 File System Access API 等多种方式</li>
<li><strong>发送文件</strong>：FormData 最通用，二进制流更高效</li>
<li><strong>下载文件</strong>：服务器链接、Blob 对象、data URL 和 File System Access API 各有适用场景</li>
<li><strong>服务端返回</strong>：小文件用 Buffer，大文件用 Stream</li>
</ul>
<p>选择合适的文件传输方案需要综合考虑：文件大小、用户体验、浏览器兼容性、服务器资源等因素。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue3 toRef/toRefs 完全指南：作用、场景及父子组件通信实战]]></title>    <link>https://juejin.cn/post/7596181746082857010</link>    <guid>https://juejin.cn/post/7596181746082857010</guid>    <pubDate>2026-01-18T13:16:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7596181746082857010" data-draft-id="7595568525628031028" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vue3 toRef/toRefs 完全指南：作用、场景及父子组件通信实战"/> <meta itemprop="keywords" content="Vue.js,JavaScript"/> <meta itemprop="datePublished" content="2026-01-18T13:16:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="boooooooom"/> <meta itemprop="url" content="https://juejin.cn/user/3078273283917399"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vue3 toRef/toRefs 完全指南：作用、场景及父子组件通信实战
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3078273283917399/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    boooooooom
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-18T13:16:48.000Z" title="Sun Jan 18 2026 13:16:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    7
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;color:#3c9dff}.markdown-body h1{font-size:30px;margin-bottom:5px;padding-bottom:8px;text-align:center}.markdown-body h2{font-size:24px;padding-bottom:6px}.markdown-body h2:before{content:"🍋"}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h3:before{content:"🍓"}.markdown-body h4{font-size:16px}.markdown-body h4:before{content:"🍑"}.markdown-body h5{font-size:15px}.markdown-body h5:before{content:"🍉"}.markdown-body h6{margin-top:5px}.markdown-body h6:before{content:"🍒"}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{display:block;margin:0 auto;max-width:100%;border-radius:4px;padding:1px;border:1px solid #d2e8ff}.markdown-body img:hover{box-shadow:0 1px 3px #5eaeff}.markdown-body hr{height:4px;margin:34px 0;background-size:4px 1px;background-image:linear-gradient(270deg,#5eaeff,#f3f9ff 25%,transparent 50%);border-style:none}.markdown-body code{word-break:break-word;border-radius:3px;overflow-x:auto;background-color:#d2e8ff;color:#3c9dff;font-size:.9em;padding:.1em .5em;margin:0 3px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;transition:all .3s}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;border:1px solid #90c7ff;border-radius:4px}.markdown-body pre:hover{box-shadow:0 1px 10px #beddff}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#3c9dff;border-bottom:1px solid #90c7ff;transition:all .3s}.markdown-body a:hover{color:#007fff;border-bottom:2px solid #5eaeff}.markdown-body a[href]:not(:empty){padding-right:18px}.markdown-body a[href]:not(:empty):after{display:inline-block;width:16px;height:16px;margin-left:2px;content:"";background:url(data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiPjxwYXRoIGQ9Ik0zODQgMTI4YTQ4IDQ4IDAgMDEyLjgxNiA5NS45MkwzODQgMjI0SDI1NmEzMiAzMiAwIDAwLTMxLjkyIDI5LjZMMjI0IDI1NnY1MTJhMzIgMzIgMCAwMDI5LjYgMzEuOTJsMi40LjA4aDUxMmEzMiAzMiAwIDAwMzEuOTItMjkuNmwuMDgtMi40VjY1NmE0OCA0OCAwIDAxOTUuOTItMi44MTZMODk2IDY1NnYxMTJhMTI4IDEyOCAwIDAxLTEyNCAxMjcuOTM2bC00IC4wNjRIMjU2YTEyOCAxMjggMCAwMS0xMjcuOTM2LTEyNGwtLjA2NC00VjI1NmExMjggMTI4IDAgMDExMjQtMTI3LjkzNmw0LS4wNjRoMTI4em0zODQgMGExMjggMTI4IDAgMDExMjcuOTM2IDEyNGwuMDY0IDR2MTYwYTQ4IDQ4IDAgMDEtOTUuOTIgMi44MTZMODAwIDQxNlYyOTEuODcybC0zODIuMDY0IDM4Mi4wOGE0OCA0OCAwIDAxLTcwLjAzMi02NS42bDIuMTYtMi4yODhMNzMyLjA5NiAyMjRINjA4YTQ4IDQ4IDAgMDEtMi44MTYtOTUuOTJMNjA4IDEyOGgxNjB6IiBmaWxsPSIjM2M5ZGZmIiBmaWxsLW9wYWNpdHk9Ii41NiIgZGF0YS1zcG0tYW5jaG9yLWlkPSJhMzEzeC5zZWFyY2hfaW5kZXguMC5pMC41Yzc1M2E4MTgwa2RKWCIgY2xhc3M9InNlbGVjdGVkIi8+PC9zdmc+);background-size:100%}.markdown-body table{margin:0 auto 10px;font-size:12px;width:auto;max-width:100%;overflow:auto;border-collapse:collapse;border:1px solid #3c9dff}.markdown-body thead{text-align:center}.markdown-body thead th{color:#fff;background-color:#5eaeff}.markdown-body tr{text-align:center}.markdown-body tbody tr:hover{background-color:#d2e8ff}.markdown-body tbody tr:hover code{background-color:#90c7ff}.markdown-body tr:nth-child(2n){background-color:#ecf5ff}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#5eaeff}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body b,.markdown-body strong{font-weight:900;padding:0 1px;font-size:17px}.markdown-body small{color:#cbcbcb;padding:0 1px;font-size:22px;zoom:.5}.markdown-body em{padding:0 1px}.markdown-body del{padding:0 1px;text-decoration-thickness:2px}.markdown-body blockquote{color:#1a1b1c;padding:1px 20px;margin:22px 0;border-radius:4px;border-left:4px solid rgba(60,157,255,.5);background-color:rgba(190,221,255,.3)}.markdown-body blockquote blockquote{margin:8px 0}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body details{margin:12px 0;padding:4px 10px;border:2px solid #3c9dff;border-radius:8px;background-color:#ecf5ff;transition:all .3s}.markdown-body details summary{cursor:pointer}.markdown-body input[type=checkbox]{position:relative;appearance:none;width:16px;height:16px;border-radius:2px;vertical-align:middle;transform:translateY(-2px);box-sizing:border-box;border:1px solid #beddff}.markdown-body input[type=checkbox]:checked{border:1px solid #5eaeff;background-color:#5eaeff}.markdown-body input[type=checkbox]:checked:before{position:absolute;top:3px;left:1px;width:11px;height:6px;background-color:transparent;border-left:2px solid #fff;border-bottom:2px solid #fff;transform:rotate(-45deg);content:"";box-sizing:border-box}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="androidstudio">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#a9b7c6;background:#282b2e}.hljs-bullet,.hljs-literal,.hljs-number,.hljs-symbol{color:#6897bb}.hljs-deletion,.hljs-keyword,.hljs-selector-tag{color:#cc7832}.hljs-link,.hljs-template-variable,.hljs-variable{color:#629755}.hljs-comment,.hljs-quote{color:grey}.hljs-meta{color:#bbb529}.hljs-addition,.hljs-attribute,.hljs-string{color:#6a8759}.hljs-section,.hljs-title,.hljs-type{color:#ffc66d}.hljs-name,.hljs-selector-class,.hljs-selector-id{color:#e8bf6a}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在Vue3组合式API开发中，<code>reactive</code>用于创建复杂引用类型的响应式数据，但其存在一个核心痛点——直接解构会丢失响应式。而<code>toRef</code>与<code>toRefs</code>正是为解决这一问题而生的“响应式保留工具”，尤其在将<code>reactive</code>数据拆分传递给子组件时，是保障响应式连贯性的关键。本文将从核心作用、区别对比、典型场景三个维度，结合父子组件通信实例，彻底讲透toRef/toRefs的用法与价值。</p>
<p>此前我们已了解，reactive创建的响应式对象，直接解构会破坏响应式（本质是解构后得到的是普通属性值，脱离了Proxy拦截范围）。而toRef/toRefs能在拆分数据的同时，保留与原reactive对象的响应式关联，这一特性在组件通信、状态拆分场景中至关重要。</p>
<h2 data-id="heading-0">一、核心作用：保留响应式的“拆分工具”</h2>
<h3 data-id="heading-1">1. toRef 的核心作用</h3>
<p><code>toRef</code>用于为<code>reactive</code>对象的单个属性创建一个Ref对象，核心特性的是：</p>
<ul>
<li><strong>响应式关联保留</strong>：创建的Ref对象与原reactive对象属性“双向绑定”——修改Ref对象的.value，会同步更新原reactive对象；反之，原reactive对象属性变化，也会同步到Ref对象。</li>
<li><strong>非拷贝而是引用</strong>：toRef不会拷贝属性值，仅建立引用关系，避免数据冗余，尤其适合大型对象场景。</li>
<li><strong>支持可选属性</strong>：即使原reactive对象中该属性不存在，toRef也能创建对应的Ref对象（值为undefined），不会报错，适配动态属性场景。</li>
</ul>
<p>语法：<code>toRef(reactiveObj, propertyKey)</code>，第一个参数为reactive创建的响应式对象，第二个参数为属性名。</p>
<h3 data-id="heading-2">2. toRefs 的核心作用</h3>
<p><code>toRefs</code>是toRef的“批量版本”，用于将整个<code>reactive</code>对象拆分为多个Ref对象组成的普通对象，核心特性：</p>
<ul>
<li><strong>批量转换</strong>：遍历reactive对象的所有可枚举属性，为每个属性创建对应的Ref对象，最终返回一个普通对象（非响应式），其属性与原reactive对象属性一一对应。</li>
<li><strong>响应式联动</strong>：每个拆分后的Ref对象都与原reactive对象属性保持双向关联，修改任一方向都会同步更新。</li>
<li><strong>解构安全</strong>：将reactive对象转为Ref对象集合后，可安全解构，解构后的属性仍保持响应式，解决了reactive直接解构丢失响应式的痛点。</li>
</ul>
<p>语法：<code>toRefs(reactiveObj)</code>，仅接收一个reactive创建的响应式对象参数。</p>
<h3 data-id="heading-3">3. toRef 与 toRefs 的核心区别</h3>






























<table><thead><tr><th>维度</th><th>toRef</th><th>toRefs</th></tr></thead><tbody><tr><td>转换范围</td><td>单个属性（精准定位）</td><td>所有可枚举属性（批量转换）</td></tr><tr><td>返回值类型</td><td>单个Ref对象</td><td>普通对象（属性均为Ref对象）</td></tr><tr><td>适用场景</td><td>仅需拆分reactive对象的部分属性</td><td>需拆分reactive对象的全部属性，或需解构使用</td></tr><tr><td>性能开销</td><td>极低（仅处理单个属性）</td><td>略高于toRef（遍历对象属性），但可忽略</td></tr></tbody></table>
<h2 data-id="heading-4">二、典型使用场景：从基础到组件通信</h2>
<h3 data-id="heading-5">1. 基础场景：解决reactive解构丢失响应式问题</h3>
<p>这是toRef/toRefs最基础的用法，直接解构reactive对象会导致响应式失效，而通过toRef/toRefs转换后可安全解构。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { reactive, toRef, toRefs } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>;

<span class="hljs-keyword">const</span> form = <span class="hljs-title function_">reactive</span>({
  <span class="hljs-attr">username</span>: <span class="hljs-string">''</span>,
  <span class="hljs-attr">password</span>: <span class="hljs-string">''</span>,
  <span class="hljs-attr">remember</span>: <span class="hljs-literal">false</span>
});

<span class="hljs-comment">// 错误示例：直接解构丢失响应式</span>
<span class="hljs-keyword">const</span> { username, password } = form;
username = <span class="hljs-string">'admin'</span>; <span class="hljs-comment">// 仅修改普通变量，原form无变化</span>

<span class="hljs-comment">// 正确示例1：toRef 转换单个属性</span>
<span class="hljs-keyword">const</span> usernameRef = <span class="hljs-title function_">toRef</span>(form, <span class="hljs-string">'username'</span>);
usernameRef.<span class="hljs-property">value</span> = <span class="hljs-string">'admin'</span>; <span class="hljs-comment">// 原form.username同步更新为'admin'</span>

<span class="hljs-comment">// 正确示例2：toRefs 批量转换后解构</span>
<span class="hljs-keyword">const</span> { <span class="hljs-attr">password</span>: passwordRef, <span class="hljs-attr">remember</span>: rememberRef } = <span class="hljs-title function_">toRefs</span>(form);
passwordRef.<span class="hljs-property">value</span> = <span class="hljs-string">'123456'</span>; <span class="hljs-comment">// 原form.password同步更新</span>
rememberRef.<span class="hljs-property">value</span> = <span class="hljs-literal">true</span>; <span class="hljs-comment">// 原form.remember同步更新</span>
</code></pre>
<h3 data-id="heading-6">2. 核心场景：reactive数据拆分传递给子组件</h3>
<p>在父子组件通信中，若父组件使用reactive管理聚合状态（如表单、用户信息），需将部分/全部属性传递给子组件时，toRef/toRefs能保障子组件修改后同步反馈到父组件，且不破坏响应式链路。这是日常开发中最常用的场景，分为“部分属性传递”和“全部属性传递”两种情况。</p>
<h4 data-id="heading-7">场景1：传递reactive对象的部分属性给子组件</h4>
<p>当子组件仅需父组件reactive对象的个别属性时，用toRef精准转换对应属性，传递给子组件后，子组件修改该Ref对象，父组件原reactive对象会同步更新。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 父组件 Parent.vue</span>
&lt;script setup&gt;
<span class="hljs-keyword">import</span> { reactive, toRef } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Child</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./Child.vue'</span>;

<span class="hljs-comment">// 父组件用reactive管理用户信息</span>
<span class="hljs-keyword">const</span> user = <span class="hljs-title function_">reactive</span>({
  <span class="hljs-attr">name</span>: <span class="hljs-string">'张三'</span>,
  <span class="hljs-attr">age</span>: <span class="hljs-number">20</span>,
  <span class="hljs-attr">info</span>: { <span class="hljs-attr">height</span>: <span class="hljs-number">180</span> }
});

<span class="hljs-comment">// 仅将name属性传递给子组件，用toRef保留响应式</span>
<span class="hljs-keyword">const</span> nameRef = <span class="hljs-title function_">toRef</span>(user, <span class="hljs-string">'name'</span>);
&lt;/script&gt;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>父组件：姓名 {{ user.name }}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">Child</span> <span class="hljs-attr">:name</span>=<span class="hljs-string">"nameRef"</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></span>

<span class="hljs-comment">// 子组件 Child.vue</span>
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { defineProps, <span class="hljs-title class_">Ref</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>;

<span class="hljs-comment">// 子组件接收Ref类型的props</span>
<span class="hljs-keyword">const</span> props = <span class="hljs-title function_">defineProps</span>({
  <span class="hljs-attr">name</span>: {
    <span class="hljs-attr">type</span>: <span class="hljs-title class_">Ref</span>,
    <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span>
  }
});

<span class="hljs-comment">// 子组件修改props（实际开发中建议通过emit触发父组件修改，此处为演示响应式关联）</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">updateName</span> = (<span class="hljs-params"/>) =&gt; {
  props.<span class="hljs-property">name</span>.<span class="hljs-property">value</span> = <span class="hljs-string">'李四'</span>; <span class="hljs-comment">// 父组件user.name同步更新为'李四'</span>
};
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>子组件：姓名 {{ name.value }}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"updateName"</span>&gt;</span>修改姓名<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></span>
</code></pre>
<p>注意：Vue官方建议“单向数据流”——子组件不直接修改props，应通过emit通知父组件修改。上述示例仅演示响应式关联，实际开发中可让子组件触发emit，父组件修改reactive对象，子组件通过props自动同步。</p>
<h4 data-id="heading-8">场景2：传递reactive对象的全部属性给子组件</h4>
<p>当子组件需要父组件reactive对象的全部属性时，用toRefs批量转换后，通过展开运算符传递给子组件，子组件可直接解构使用，且保持响应式。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 父组件 Parent.vue</span>
&lt;script setup&gt;
<span class="hljs-keyword">import</span> { reactive, toRefs } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Child</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./Child.vue'</span>;

<span class="hljs-comment">// 父组件reactive聚合表单状态</span>
<span class="hljs-keyword">const</span> form = <span class="hljs-title function_">reactive</span>({
  <span class="hljs-attr">username</span>: <span class="hljs-string">''</span>,
  <span class="hljs-attr">password</span>: <span class="hljs-string">''</span>,
  <span class="hljs-attr">remember</span>: <span class="hljs-literal">false</span>
});

<span class="hljs-comment">// 批量转换为Ref对象集合</span>
<span class="hljs-keyword">const</span> formRefs = <span class="hljs-title function_">toRefs</span>(form);
&lt;/script&gt;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>父组件：用户名 {{ form.username }}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-comment">&lt;!-- 展开传递所有属性，子组件可按需接收 --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">Child</span> <span class="hljs-attr">v-bind</span>=<span class="hljs-string">"formRefs"</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></span>

<span class="hljs-comment">// 子组件 Child.vue</span>
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { defineProps, <span class="hljs-title class_">Ref</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>;

<span class="hljs-comment">// 子组件按需接收props</span>
<span class="hljs-keyword">const</span> props = <span class="hljs-title function_">defineProps</span>({
  <span class="hljs-attr">username</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">Ref</span>, <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span> },
  <span class="hljs-attr">password</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">Ref</span>, <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span> },
  <span class="hljs-attr">remember</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">Ref</span>, <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span> }
});

<span class="hljs-comment">// 子组件触发父组件修改（遵循单向数据流）</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleInput</span> = (<span class="hljs-params">key, value</span>) =&gt; {
  props[key].<span class="hljs-property">value</span> = value; <span class="hljs-comment">// 父组件form同步更新</span>
};
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">input</span> 
    <span class="hljs-attr">v-model</span>=<span class="hljs-string">"username.value"</span> 
    <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"请输入用户名"</span>
    @<span class="hljs-attr">input</span>=<span class="hljs-string">"handleInput('username', $event.target.value)"</span>
  /&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">input</span> 
    <span class="hljs-attr">v-model</span>=<span class="hljs-string">"password.value"</span> 
    <span class="hljs-attr">type</span>=<span class="hljs-string">"password"</span> 
    <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"请输入密码"</span>
    @<span class="hljs-attr">input</span>=<span class="hljs-string">"handleInput('password', $event.target.value)"</span>
  /&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">input</span> 
    <span class="hljs-attr">v-model</span>=<span class="hljs-string">"remember.value"</span> 
    <span class="hljs-attr">type</span>=<span class="hljs-string">"checkbox"</span>
  /&gt;</span> 记住我
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></span>
</code></pre>
<p>该场景的优势的是：父组件无需逐个传递属性，子组件可按需接收，且所有属性的响应式链路完整，父组件状态与子组件同步一致。</p>
<h3 data-id="heading-9">3. 进阶场景：组合式API中拆分状态逻辑</h3>
<p>在组合式API中，常将复杂状态逻辑抽离为独立函数（Composable），函数返回reactive对象时，可通过toRefs拆分后返回，便于组件内解构使用，同时保留响应式。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// composables/useUser.js（抽离用户状态逻辑）</span>
<span class="hljs-keyword">import</span> { reactive, toRefs } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">useUser</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> user = <span class="hljs-title function_">reactive</span>({
    <span class="hljs-attr">name</span>: <span class="hljs-string">'张三'</span>,
    <span class="hljs-attr">age</span>: <span class="hljs-number">20</span>,
    <span class="hljs-attr">updateName</span>: <span class="hljs-function">(<span class="hljs-params">newName</span>) =&gt;</span> {
      user.<span class="hljs-property">name</span> = newName;
    }
  });

  <span class="hljs-comment">// 拆分后返回，组件可解构使用</span>
  <span class="hljs-keyword">return</span> { ...<span class="hljs-title function_">toRefs</span>(user), <span class="hljs-attr">updateName</span>: user.<span class="hljs-property">updateName</span> };
}

<span class="hljs-comment">// 组件中使用</span>
&lt;script setup&gt;
<span class="hljs-keyword">import</span> { useUser } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/composables/useUser'</span>;

<span class="hljs-comment">// 解构后仍保持响应式</span>
<span class="hljs-keyword">const</span> { name, age, updateName } = <span class="hljs-title function_">useUser</span>();
<span class="hljs-title function_">updateName</span>(<span class="hljs-string">'李四'</span>); <span class="hljs-comment">// name.value同步更新为'李四'</span>
&lt;/script&gt;
</code></pre>
<h2 data-id="heading-10">三、避坑要点：这些细节千万别忽略</h2>
<ul>
<li><strong>仅适用于reactive对象</strong>：toRef/toRefs的核心作用是处理reactive对象的属性拆分，若用于普通对象或ref对象，虽不会报错，但无法实现响应式关联（普通对象无Proxy拦截，ref对象本身已可通过.value操作）。</li>
<li><strong>不触发新的响应式依赖</strong>：toRef/toRefs创建的Ref对象与原reactive对象共享同一响应式依赖，修改时不会新增依赖，仅触发原有依赖更新，性能更优。</li>
<li><strong>嵌套属性的处理</strong>：若reactive对象包含嵌套对象，toRef/toRefs仅对顶层属性创建Ref对象，嵌套属性仍为普通对象（需通过.value访问后再操作）。若需嵌套属性也转为Ref，可结合toRef递归处理，或直接使用ref嵌套。</li>
<li><strong>与ref的区别</strong>：ref是“创建新的响应式数据”，而toRef是“关联已有reactive对象的属性”，两者本质不同——ref的数据独立，toRef的数据与原对象联动。</li>
</ul>
<h2 data-id="heading-11">四、总结</h2>
<p>toRef与toRefs作为Vue3组合式API的“响应式辅助工具”，核心价值在于<strong>拆分reactive对象时保留响应式关联</strong>，解决了直接解构导致的响应式失效问题。其中，toRef适用于精准拆分单个属性，toRefs适用于批量拆分全部属性，两者在父子组件通信、状态逻辑抽离等场景中不可或缺。</p>
<p>尤其在父子组件传递reactive数据时，toRef/toRefs能保障数据链路的完整性，既满足子组件对数据的使用需求，又遵循Vue的单向数据流原则，是实现组件间状态协同的高效方案。掌握两者的用法与区别，能让你的响应式开发更灵活、更健壮。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[深入浅出：JavaScript 异步编程实战 —— 使用 OpenAI DALL·E 3 生成图片详解]]></title>    <link>https://juejin.cn/post/7596276978808963115</link>    <guid>https://juejin.cn/post/7596276978808963115</guid>    <pubDate>2026-01-18T13:38:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7596276978808963115" data-draft-id="7596276978808930347" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="深入浅出：JavaScript 异步编程实战 —— 使用 OpenAI DALL·E 3 生成图片详解"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-18T13:38:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="用户80110532256"/> <meta itemprop="url" content="https://juejin.cn/user/1927884034804425"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            深入浅出：JavaScript 异步编程实战 —— 使用 OpenAI DALL·E 3 生成图片详解
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1927884034804425/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    用户80110532256
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-18T13:38:23.000Z" title="Sun Jan 18 2026 13:38:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p><strong>摘要</strong>：本文将带你从零开始理解 JavaScript 异步编程的核心概念，并通过一个完整的 OpenAI DALL·E 3 图片生成项目示例，深入剖析 <code>async/await</code>、<code>Promise</code>、API 调用等关键技术点。即使是初学者，也能轻松掌握如何在现代 Web 开发中处理异步任务。</p>
</blockquote>
<h2 data-id="heading-0">引言</h2>
<p>在现代前端和 Node.js 开发中，异步编程是绕不开的话题。无论是发送网络请求、读写文件还是处理用户交互，异步机制都扮演着至关重要的角色。本文将以一个使用 OpenAI DALL·E 3 模型生成图片的简单例子为切入点，带你彻底搞懂 <code>async/await</code> 的工作原理。</p>
<h2 data-id="heading-1">一、项目背景：用代码画出想象力</h2>
<p>我们的目标是编写一个 JavaScript 函数，它能够：</p>
<ol>
<li>向 OpenAI 的 DALL·E 3 模型发送一个文本描述（Prompt）。</li>
<li>等待模型生成图片。</li>
<li>获取并打印生成的图片 URL。</li>
</ol>
<p>最终的代码如下：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 1. 定义一个异步函数</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">main</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-comment">// 2. 调用 OpenAI SDK 的图片生成接口，并等待结果</span>
  <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> client.<span class="hljs-property">images</span>.<span class="hljs-title function_">generate</span>({
    <span class="hljs-attr">model</span>: <span class="hljs-string">'dall-e-3'</span>, <span class="hljs-comment">// 指定模型</span>
    <span class="hljs-attr">prompt</span>: <span class="hljs-string">'a woman | is very beautiful'</span>, <span class="hljs-comment">// 生成图片的提示词</span>
    <span class="hljs-attr">n</span>: <span class="hljs-number">1</span>, <span class="hljs-comment">// 生成图片的数量</span>
    <span class="hljs-attr">size</span>: <span class="hljs-string">'1024x1024'</span> <span class="hljs-comment">// 图片尺寸</span>
  });

  <span class="hljs-comment">// 3. 打印返回的响应数据</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(response);
}

<span class="hljs-comment">// 4. 调用函数，启动整个流程</span>
<span class="hljs-title function_">main</span>();
</code></pre>
<p>接下来，我们将逐行拆解这段代码，理解其背后的工作机制。</p>
<hr/>
<h2 data-id="heading-2">二、核心概念解析</h2>
<h3 data-id="heading-3">1. <code>async</code> 函数：异步世界的入口</h3>
<p><code>async</code> 是一个关键字，用于声明一个函数是异步的。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">main</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; { ... }
</code></pre>
<ul>
<li><strong>作用</strong>：它告诉 JavaScript 引擎，这个函数内部可能会包含需要等待的异步操作（如网络请求、定时器等）。</li>
<li><strong>返回值</strong>：无论函数内部写了什么，<code>async</code> 函数总是会<strong>隐式地返回一个 <code>Promise</code></strong>。这使得调用 <code>async</code> 函数的代码可以使用 <code>.then()</code> 或 <code>await</code> 来处理其返回结果。</li>
</ul>
<p><strong>类比</strong>：想象 <code>async</code> 就像一个特殊的“魔法厨房”。当你把食材（代码）放进去，厨房（函数体）会自己处理，而你拿到的不是一个做好的菜，而是一个“承诺”（Promise）：“等菜做好了，我会通知你”。</p>
<h3 data-id="heading-4">2. <code>await</code> 关键字：耐心等待的信使</h3>
<p><code>await</code> 只能在 <code>async</code> 函数内部使用。它是 <code>async/await</code> 语法糖的核心。</p>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">response</span> = await client.images.generate({...})<span class="hljs-comment">;</span>
</code></pre>
<ul>
<li><strong>作用</strong>：<code>await</code> 会暂停当前 <code>async</code> 函数内部的代码执行，直到它等待的那个 <code>Promise</code> 对象被“解决”（resolve）或“拒绝”（reject）。</li>
<li><strong>返回值</strong>：如果 <code>Promise</code> 成功（fulfilled），<code>await</code> 表达式的值就是 <code>Promise</code> 成功时传递的值。如果 <code>Promise</code> 失败（rejected），它会抛出一个异常（可以用 <code>try...catch</code> 捕获）。</li>
</ul>
<p><strong>类比</strong>：<code>await</code> 就像你派去“魔法厨房”的信使。信使会拿着“承诺”（Promise）去等待，直到厨房把做好的菜（结果）交给他，他才会回来把菜（结果）交给你（赋值给 <code>response</code> 变量）。在此期间，信使不会打扰你做其他事（<code>async</code> 函数外部的代码可以继续执行）。</p>
<h3 data-id="heading-5">3. <code>Promise</code>：未来的承诺</h3>
<p><code>Promise</code> 是 JavaScript 中用于处理异步操作的核心对象。它代表一个在未来某个时刻可能成功或失败的操作结果。</p>
<ul>
<li>
<p><strong>三种状态</strong>：</p>
<ul>
<li><code>pending</code>（进行中）</li>
<li><code>fulfilled</code>（已成功）</li>
<li><code>rejected</code>（已失败）</li>
</ul>
</li>
</ul>
<p><code>client.images.generate({...})</code> 这个方法会立即返回一个 <code>Promise</code>。这个 <code>Promise</code> 就是那个“承诺”，承诺稍后会给你图片生成的结果。</p>
<hr/>
<h2 data-id="heading-6">三、代码流程详解</h2>
<p>让我们回到示例代码，一步步追踪它的执行过程。</p>
<h3 data-id="heading-7">第一步：定义 <code>main</code> 函数</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">main</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-comment">// ...</span>
}
</code></pre>
<ul>
<li><strong>执行</strong>：<strong>此时代码并未运行</strong>。这行代码只是在内存中创建了一个名为 <code>main</code> 的函数，告诉 JavaScript 引擎：“如果有人调用我，我就按下面的步骤执行”。</li>
</ul>
<h3 data-id="heading-8">第二步：调用 <code>main()</code> 函数</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-tag">main</span>();
</code></pre>
<ul>
<li><strong>执行</strong>：现在，我们调用了 <code>main</code> 函数。JavaScript 引擎开始执行 <code>main</code> 函数内部的代码。</li>
</ul>
<h3 data-id="heading-9">第三步：执行 <code>await</code> 表达式</h3>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">response</span> = await client.images.generate({...})<span class="hljs-comment">;</span>
</code></pre>
<ol>
<li><strong>发送请求</strong>：<code>client.images.generate(...)</code> 被执行，它向 OpenAI 服务器发送一个 HTTP 请求，要求根据 <code>prompt</code> 生成图片。</li>
<li><strong>返回 <code>Promise</code></strong>：该方法立即返回一个 <code>Promise</code> 对象。</li>
<li><strong>暂停执行</strong>：<code>await</code> 关键字让 <code>main</code> 函数内部的执行流程暂停在这一行。注意，是 <code>main</code> 函数内部暂停，<strong>整个程序（如浏览器主线程）不会被卡死</strong>，它可以去处理其他任务（比如响应用户点击）。</li>
<li><strong>等待结果</strong>：<code>main</code> 函数进入等待状态，直到 <code>Promise</code> 的状态变为 <code>fulfilled</code> 或 <code>rejected</code>。</li>
</ol>
<h3 data-id="heading-10">第四步：<code>Promise</code> 完成，继续执行</h3>
<ul>
<li><strong>成功</strong>：当 OpenAI 服务器成功生成图片并将结果通过网络返回时，<code>Promise</code> 的状态变为 <code>fulfilled</code>，并携带生成的图片信息。</li>
<li><strong>恢复执行</strong>：JavaScript 的事件循环（Event Loop）检测到 <code>Promise</code> 已完成，便唤醒 <code>main</code> 函数，继续从 <code>await</code> 的下一行开始执行。</li>
<li><strong>赋值</strong>：<code>response</code> 变量被赋予 <code>Promise</code> 成功时传递过来的值（即包含图片 URL 的对象）。</li>
</ul>
<h3 data-id="heading-11">第五步：打印结果</h3>
<pre><code class="hljs language-vbscript" lang="vbscript">console.<span class="hljs-built_in">log</span>(<span class="hljs-built_in">response</span>);
</code></pre>
<ul>
<li><strong>执行</strong>：<code>main</code> 函数继续执行，将 <code>response</code> 对象打印到控制台。</li>
</ul>
<h3 data-id="heading-12">第六步：函数执行完毕</h3>
<p><code>main</code> 函数内部的所有代码都已执行完毕，函数结束。</p>
<hr/>
<h2 data-id="heading-13">四、为什么 <code>main()</code> 能启动整个流程？</h2>
<p>这是许多初学者容易困惑的地方。<code>main()</code> 本身并不是启动器，而是<strong>执行器</strong>。</p>
<ul>
<li><strong>定义阶段</strong>：<code>const main = async () =&gt; { ... }</code> 定义了“如何生成图片”这一套逻辑，但并未执行。</li>
<li><strong>调用阶段</strong>：<code>main()</code> 这一行才是<strong>触发</strong>这套逻辑开始运行的“开关”。它告诉 JavaScript 引擎：“现在，请开始执行 <code>main</code> 函数里的所有步骤”。</li>
</ul>
<p><strong>总结类比</strong>：你编写了一份“开车去超市”的清单（定义函数），这份清单本身不会移动。只有当你决定“现在就出发”（调用函数）时，你才会真正开始执行清单上的每一个步骤（启动异步流程）。</p>
<hr/>
<h2 data-id="heading-14">五、总结与延伸</h2>
<p>通过这个简单的例子，我们学习了：</p>
<ol>
<li><strong><code>async</code> 函数</strong>：声明一个包含异步操作的函数。</li>
<li><strong><code>await</code> 关键字</strong>：在 <code>async</code> 函数内部等待一个 <code>Promise</code> 的结果。</li>
<li><strong><code>Promise</code> 对象</strong>：代表异步操作的未来结果。</li>
<li><strong>异步流程</strong>：如何发起请求、等待结果并处理响应。</li>
</ol>
<p>掌握了这些基础，你就可以更自信地处理各种复杂的异步场景了。在实际项目中，记得使用 <code>try...catch</code> 来优雅地处理可能出现的错误。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">main</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> client.<span class="hljs-property">images</span>.<span class="hljs-title function_">generate</span>({...});
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(response);
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'生成图片时出错:'</span>, error);
  }
}
</code></pre>
<p>希望这篇文章能帮助你更好地理解 JavaScript 的异步编程世界！如果觉得有用，别忘了点赞收藏哦！</p>
<hr/>
<p><strong>作者简介</strong>：一名热爱分享的前端开发者，专注于探索现代 Web 技术的奥秘。欢迎关注，一起学习成长！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[深入理解 patch-package：优雅地修改第三方依赖的艺术]]></title>    <link>https://juejin.cn/post/7596171325532717097</link>    <guid>https://juejin.cn/post/7596171325532717097</guid>    <pubDate>2026-01-18T14:29:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7596171325532717097" data-draft-id="7596307289725075498" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="深入理解 patch-package：优雅地修改第三方依赖的艺术"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-18T14:29:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="一只叁木Meow"/> <meta itemprop="url" content="https://juejin.cn/user/231371762837604"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            深入理解 patch-package：优雅地修改第三方依赖的艺术
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/231371762837604/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    一只叁木Meow
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-18T14:29:37.000Z" title="Sun Jan 18 2026 14:29:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>💡 更多技术分享，欢迎访问我的博客：<a href="https://link.juejin.cn?target=https%3A%2F%2Fsanmu7.com%2F" target="_blank" title="https://sanmu7.com/" ref="nofollow noopener noreferrer">叁木の小屋</a></p>
</blockquote>
<blockquote>
<p>在现代前端开发中，我们经常遇到需要修改第三方包的场景。patch-package 提供了一种优雅的解决方案，让我们能够在不破坏依赖管理的前提下，定制第三方包的行为。</p>
</blockquote>
<h2 data-id="heading-0">问题的起源：为什么需要修改第三方依赖？</h2>
<h3 data-id="heading-1">开发中的常见困境</h3>
<p>作为一个前端开发者，你可能遇到过这样的场景：</p>
<p><strong>场景一：发现了一个 bug</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { format } <span class="hljs-keyword">from</span> <span class="hljs-string">'date-fns'</span>

<span class="hljs-comment">// 假设我们发现 format 函数在处理某些时区时有 bug</span>
<span class="hljs-keyword">const</span> result = <span class="hljs-title function_">format</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-string">'2024-01-01'</span>), <span class="hljs-string">'yyyy-MM-dd'</span>)
<span class="hljs-comment">// 结果不正确，需要修复</span>
</code></pre>
<p><strong>场景二：需要增强功能</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> axios <span class="hljs-keyword">from</span> <span class="hljs-string">'axios'</span>

<span class="hljs-comment">// 希望为所有请求添加自定义的拦截器逻辑</span>
<span class="hljs-comment">// 但原包没有提供这个能力</span>
</code></pre>
<p><strong>场景三：性能优化</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { debounce } <span class="hljs-keyword">from</span> <span class="hljs-string">'lodash'</span>

<span class="hljs-comment">// 需要针对特定场景优化 debounce 的实现</span>
<span class="hljs-comment">// 减少不必要的计算开销</span>
</code></pre>
<h3 data-id="heading-2">传统解决方案的痛点</h3>
<h4 data-id="heading-3">1. Fork 包的方案</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 传统方法：fork + 修改</span>
git <span class="hljs-built_in">clone</span> https://github.com/lodash/lodash.git
<span class="hljs-comment"># 修改代码...</span>
<span class="hljs-comment"># 发布到 private registry...</span>
<span class="hljs-comment"># 在 package.json 中使用: "lodash": "git+https://github.com/your-fork/lodash.git"</span>
</code></pre>
<p><strong>缺点：</strong></p>
<ul>
<li>维护成本高：需要手动同步上游更新</li>
<li>版本混乱：失去了语义化版本的优势</li>
<li>部署复杂：需要配置私有 npm registry</li>
</ul>
<h4 data-id="heading-4">2. 直接修改 node_modules</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 危险的方法：直接修改 node_modules</span>
vim node_modules/lodash/isObject.js
<span class="hljs-comment"># 修改代码...</span>
<span class="hljs-comment"># 但重新安装后修改会丢失！</span>
</code></pre>
<p><strong>缺点：</strong></p>
<ul>
<li>修改丢失：每次 <code>npm install</code> 都会重置</li>
<li>团队协作困难：其他开发者无法获得你的修改</li>
<li>CI/CD 问题：构建环境无法获得修改</li>
</ul>
<h2 data-id="heading-5">patch-package 的革命性解决方案</h2>
<h3 data-id="heading-6">核心设计理念</h3>
<p>patch-package 的设计哲学很简单：</p>
<blockquote>
<p><strong>让修改变得可追踪、可重复、可分享</strong></p>
</blockquote>
<p>它巧妙地利用了 npm 生态系统中的两个核心机制：</p>
<ol>
<li><strong>Git diff 格式</strong>：标准化的文件差异表示</li>
<li><strong>npm 生命周期钩子</strong>：自动化的构建时执行</li>
</ol>
<h3 data-id="heading-7">工作原理全景图</h3>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    A[安装依赖] --&gt; B[发现需要修改的包]
    B --&gt; C[修改 node_modules 代码]
    C --&gt; D[运行 npx patch-package]
    D --&gt; E[生成 .patch 补丁文件]
    E --&gt; F[提交补丁到版本控制]
    F --&gt; G[其他开发者 npm install]
    G --&gt; H[自动应用补丁]
    H --&gt; I[获得相同修改]
</code></pre>
<h2 data-id="heading-8">实战演练：一步一步学习 patch-package</h2>
<p>让我们以修改 <strong>moment.js</strong> 为例，展示完整的工作流程。</p>
<h3 data-id="heading-9">步骤 1：项目初始化</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">mkdir</span> moment-patch-example
<span class="hljs-built_in">cd</span> moment-patch-example
npm init -y
npm install moment patch-package
</code></pre>
<h3 data-id="heading-10">步骤 2：配置 postinstall 钩子</h3>
<p>编辑 <code>package.json</code>：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"moment-patch-example"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1.0.0"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"scripts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"postinstall"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"patch-package"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"test"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"node test.js"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"devDependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"patch-package"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^8.0.1"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"dependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"moment"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^2.29.4"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>关键点：</strong> <code>postinstall</code> 脚本会在每次 <code>npm install</code> 完成后自动执行。</p>
<h3 data-id="heading-11">步骤 3：创建测试用例</h3>
<p>创建 <code>test.js</code> 文件：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> moment = <span class="hljs-built_in">require</span>(<span class="hljs-string">'moment'</span>)

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'=== 原始功能测试 ==='</span>)
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'当前时间:'</span>, <span class="hljs-title function_">moment</span>().<span class="hljs-title function_">format</span>(<span class="hljs-string">'YYYY-MM-DD HH:mm:ss'</span>))

<span class="hljs-comment">// 假设我们要修复的问题：moment 对 null 值的处理不够友好</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'\n=== 问题复现 ==='</span>)
<span class="hljs-keyword">try</span> {
  <span class="hljs-keyword">const</span> result = <span class="hljs-title function_">moment</span>(<span class="hljs-literal">null</span>).<span class="hljs-title function_">format</span>(<span class="hljs-string">'YYYY-MM-DD'</span>)
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'moment(null) 结果:'</span>, result)
} <span class="hljs-keyword">catch</span> (error) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'moment(null) 出错:'</span>, error.<span class="hljs-property">message</span>)
}
</code></pre>
<h3 data-id="heading-12">步骤 4：定位并修改问题</h3>
<p>我们需要修改 moment.js 源码，让它对 <code>null</code> 值有更好的处理。找到 <code>node_modules/moment/src/lib/moment/moment.js</code> 文件。</p>
<p><strong>原始代码片段：</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Moment</span>(<span class="hljs-params">config</span>) {
    <span class="hljs-title function_">copyConfig</span>(<span class="hljs-variable language_">this</span>, config);
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_d</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(config.<span class="hljs-property">_d</span> != <span class="hljs-literal">null</span> ? config.<span class="hljs-property">_d</span>.<span class="hljs-title function_">getTime</span>() : <span class="hljs-title class_">NaN</span>);
    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">isValid</span>()) {
        config.<span class="hljs-property">_d</span> = <span class="hljs-literal">null</span>;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">_d</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-title class_">NaN</span>);
    }
}
</code></pre>
<p><strong>修改后的代码：</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Moment</span>(<span class="hljs-params">config</span>) {
    <span class="hljs-comment">// 添加 null 检查，提供更好的错误提示</span>
    <span class="hljs-keyword">if</span> (config === <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'moment() 不接受 null 参数，请使用 moment(undefined) 或提供有效的配置对象'</span>);
    }

    <span class="hljs-title function_">copyConfig</span>(<span class="hljs-variable language_">this</span>, config);
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_d</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(config.<span class="hljs-property">_d</span> != <span class="hljs-literal">null</span> ? config.<span class="hljs-property">_d</span>.<span class="hljs-title function_">getTime</span>() : <span class="hljs-title class_">NaN</span>);
    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">isValid</span>()) {
        config.<span class="hljs-property">_d</span> = <span class="hljs-literal">null</span>;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">_d</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-title class_">NaN</span>);
    }
}
</code></pre>
<h3 data-id="heading-13">步骤 5：生成补丁文件</h3>
<p>运行补丁生成命令：</p>
<pre><code class="hljs language-bash" lang="bash">npx patch-package moment
</code></pre>
<p><strong>输出结果：</strong></p>
<pre><code class="hljs language-sql" lang="sql">patch<span class="hljs-operator">-</span>package <span class="hljs-number">8.0</span><span class="hljs-number">.1</span>
• Creating temporary folder
• Installing moment<span class="hljs-variable">@2</span><span class="hljs-number">.29</span><span class="hljs-number">.4</span> <span class="hljs-keyword">with</span> npm
• Diffing your files <span class="hljs-keyword">with</span> clean files
✔ Created file patches<span class="hljs-operator">/</span>moment<span class="hljs-operator">+</span><span class="hljs-number">2.29</span><span class="hljs-number">.4</span>.patch
</code></pre>
<h3 data-id="heading-14">步骤 6：查看生成的补丁文件</h3>
<p><code>patches/moment+2.29.4.patch</code> 内容：</p>
<pre><code class="hljs language-diff" lang="diff"><span class="hljs-comment">diff --git a/node_modules/moment/src/lib/moment/moment.js b/node_modules/moment/src/lib/moment/moment.js</span>
<span class="hljs-comment">index abc1234..def5678 100644</span>
<span class="hljs-comment">--- a/node_modules/moment/src/lib/moment/moment.js</span>
<span class="hljs-comment">+++ b/node_modules/moment/src/lib/moment/moment.js</span>
<span class="hljs-meta">@@ -1,6 +1,10 @@</span>
 import { copyConfig } from '../utils/copy-config';

 export function Moment(config) {
<span class="hljs-addition">+    // 添加 null 检查，提供更好的错误提示</span>
<span class="hljs-addition">+    if (config === null) {</span>
<span class="hljs-addition">+        throw new Error('moment() 不接受 null 参数，请使用 moment(undefined) 或提供有效的配置对象');</span>
<span class="hljs-addition">+    }</span>
     copyConfig(this, config);
     this._d = new Date(config._d != null ? config._d.getTime() : NaN);
     if (!this.isValid()) {
</code></pre>
<h2 data-id="heading-15">补丁文件深度解析</h2>
<h3 data-id="heading-16">Diff 格式的组成部分</h3>
<p>一个标准的补丁文件包含以下几个关键部分：</p>
<h4 data-id="heading-17">1. 文件头信息</h4>
<pre><code class="hljs language-diff" lang="diff"><span class="hljs-comment">diff --git a/node_modules/moment/src/lib/moment/moment.js b/node_modules/moment/src/lib/moment/moment.js</span>
<span class="hljs-comment">index abc1234..def5678 100644</span>
<span class="hljs-comment">--- a/node_modules/moment/src/lib/moment/moment.js</span>
<span class="hljs-comment">+++ b/node_modules/moment/src/lib/moment/moment.js</span>
</code></pre>
<ul>
<li><code>diff --git</code>：声明被修改的文件路径</li>
<li><code>index</code>：文件的哈希值变化</li>
<li><code>---</code>：原始文件路径</li>
<li><code>+++</code>：修改后文件路径</li>
</ul>
<h4 data-id="heading-18">2. 变化上下文</h4>
<pre><code class="hljs language-diff" lang="diff"><span class="hljs-meta">@@ -1,6 +1,10 @@</span>
</code></pre>
<ul>
<li><code>@@</code>：表示变化的位置和范围</li>
<li><code>-1,6</code>：原始文件从第 1 行开始，共 6 行</li>
<li><code>+1,10</code>：修改后文件从第 1 行开始，共 10 行</li>
</ul>
<h4 data-id="heading-19">3. 具体修改内容</h4>
<pre><code class="hljs language-diff" lang="diff"> export function Moment(config) {
<span class="hljs-addition">+    // 添加 null 检查，提供更好的错误提示</span>
<span class="hljs-addition">+    if (config === null) {</span>
<span class="hljs-addition">+        throw new Error('moment() 不接受 null 参数，请使用 moment(undefined) 或提供有效的配置对象');</span>
<span class="hljs-addition">+    }</span>
     copyConfig(this, config);
     this._d = new Date(config._d != null ? config._d.getTime() : NaN);
</code></pre>
<ul>
<li><code>-</code>：删除的行（如果有的话）</li>
<li><code>+</code>：新增的行</li>
<li>上下文：未变化的行，用于定位修改位置</li>
</ul>
<h2 data-id="heading-20">验证补丁效果</h2>
<h3 data-id="heading-21">步骤 7：清理并重新安装</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 删除 node_modules 和补丁目标</span>
<span class="hljs-built_in">rm</span> -rf node_modules/moment
<span class="hljs-built_in">rm</span> -rf node_modules/.cache

<span class="hljs-comment"># 重新安装依赖</span>
npm install
</code></pre>
<p><strong>安装过程中的关键信息：</strong></p>
<pre><code class="hljs language-kotlin" lang="kotlin">npm install

&gt; moment-patch-<span class="hljs-symbol">example@</span><span class="hljs-number">1.0</span><span class="hljs-number">.0</span> postinstall
&gt; patch-<span class="hljs-keyword">package</span>

patch-<span class="hljs-keyword">package</span> <span class="hljs-number">8.0</span><span class="hljs-number">.1</span>
Applying patches...
<span class="hljs-symbol">moment@</span><span class="hljs-number">2.29</span><span class="hljs-number">.4</span> ✔
</code></pre>
<p><strong>重要观察点：</strong></p>
<ul>
<li><code>postinstall</code> 钩子自动执行</li>
<li>补丁成功应用：<code>moment@2.29.4 ✔</code></li>
</ul>
<h3 data-id="heading-22">步骤 8：验证修改效果</h3>
<pre><code class="hljs language-bash" lang="bash">npm run <span class="hljs-built_in">test</span>
</code></pre>
<p><strong>预期输出：</strong></p>
<pre><code class="hljs language-css" lang="css">=== 原始功能测试 ===
当前时间: <span class="hljs-number">2024</span>-<span class="hljs-number">01</span>-<span class="hljs-number">15</span> <span class="hljs-number">14</span>:<span class="hljs-number">30</span>:<span class="hljs-number">25</span>

=== 问题复现 ===
<span class="hljs-built_in">moment</span>(null) 出错: <span class="hljs-built_in">moment</span>() 不接受 null 参数，请使用 <span class="hljs-built_in">moment</span>(undefined) 或提供有效的配置对象
</code></pre>
<h2 data-id="heading-23">团队协作与版本控制</h2>
<h3 data-id="heading-24">Git 工作流集成</h3>
<h4 data-id="heading-25">1. 提交补丁文件</h4>
<pre><code class="hljs language-bash" lang="bash">git add patches/
git commit -m <span class="hljs-string">"feat: 为 moment.js 添加 null 参数检查补丁

- 修改 moment() 函数，对 null 参数提供明确的错误提示
- 生成补丁文件: patches/moment+2.29.4.patch
- 改善开发者体验，避免神秘的错误信息"</span>
</code></pre>
<h4 data-id="heading-26">2. .gitignore 配置</h4>
<pre><code class="hljs language-gitignore" lang="gitignore"># 不要忽略 patches 目录！
# patches/  应该被版本控制

# 但忽略临时文件
node_modules/
*.log
</code></pre>
<h4 data-id="heading-27">3. 团队成员的工作流程</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 新团队成员加入项目</span>
git <span class="hljs-built_in">clone</span> &lt;repository&gt;
<span class="hljs-built_in">cd</span> moment-patch-example
npm install  <span class="hljs-comment"># 自动应用补丁！</span>

<span class="hljs-comment"># 开发过程中修改补丁</span>
<span class="hljs-comment"># 1. 修改 node_modules 中的代码</span>
<span class="hljs-comment"># 2. 重新生成补丁: npx patch-package moment</span>
<span class="hljs-comment"># 3. 提交新的补丁文件</span>
</code></pre>
<h3 data-id="heading-28">CI/CD 集成示例</h3>
<p><strong>GitHub Actions 配置：</strong></p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">name:</span> <span class="hljs-string">Test</span> <span class="hljs-string">Application</span>

<span class="hljs-attr">on:</span> [<span class="hljs-string">push</span>, <span class="hljs-string">pull_request</span>]

<span class="hljs-attr">jobs:</span>
  <span class="hljs-attr">test:</span>
    <span class="hljs-attr">runs-on:</span> <span class="hljs-string">ubuntu-latest</span>

    <span class="hljs-attr">steps:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/checkout@v2</span>

    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Setup</span> <span class="hljs-string">Node.js</span>
      <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/setup-node@v2</span>
      <span class="hljs-attr">with:</span>
        <span class="hljs-attr">node-version:</span> <span class="hljs-string">'16'</span>

    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Cache</span> <span class="hljs-string">node_modules</span>
      <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/cache@v2</span>
      <span class="hljs-attr">with:</span>
        <span class="hljs-attr">path:</span> <span class="hljs-string">~/.npm</span>
        <span class="hljs-attr">key:</span> <span class="hljs-string">${{</span> <span class="hljs-string">runner.os</span> <span class="hljs-string">}}-node-${{</span> <span class="hljs-string">hashFiles('**/package-lock.json')</span> <span class="hljs-string">}}</span>

    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Install</span> <span class="hljs-string">dependencies</span>
      <span class="hljs-attr">run:</span> <span class="hljs-string">npm</span> <span class="hljs-string">ci</span>

    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Run</span> <span class="hljs-string">tests</span>
      <span class="hljs-attr">run:</span> <span class="hljs-string">npm</span> <span class="hljs-string">test</span>

    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Verify</span> <span class="hljs-string">patches</span> <span class="hljs-string">applied</span>
      <span class="hljs-attr">run:</span> <span class="hljs-string">|
        # 检查补丁是否正确应用
        npm ls moment
        node -e "console.log('Patches applied successfully!')"
</span></code></pre>
<h2 data-id="heading-29">高级用法与最佳实践</h2>
<h3 data-id="heading-30">1. 多包补丁管理</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 为多个包同时生成补丁</span>
npx patch-package moment lodash axios

<span class="hljs-comment"># 或使用配置文件</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"moment"</span> &gt; packages.txt
<span class="hljs-built_in">echo</span> <span class="hljs-string">"lodash"</span> &gt;&gt; packages.txt
<span class="hljs-built_in">echo</span> <span class="hljs-string">"axios"</span> &gt;&gt; packages.txt
npx patch-package $(<span class="hljs-built_in">cat</span> packages.txt | <span class="hljs-built_in">tr</span> <span class="hljs-string">'\n'</span> <span class="hljs-string">' '</span>)
</code></pre>
<h3 data-id="heading-31">2. 补丁版本管理</h3>
<p>当依赖包升级时，需要重新生成补丁：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 更新依赖版本</span>
npm update moment

<span class="hljs-comment"># 检查现有补丁是否兼容</span>
npx patch-package moment --dry-run

<span class="hljs-comment"># 如果不兼容，重新生成补丁</span>
npx patch-package moment
</code></pre>
<h3 data-id="heading-32">3. 补丁文件的版本化命名</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 手动重命名补丁文件，标识功能</span>
<span class="hljs-built_in">mv</span> patches/moment+2.29.4.patch patches/moment+2.29.4+null-check.patch
</code></pre>
<h3 data-id="heading-33">4. 自定义补丁目录</h3>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"scripts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"postinstall"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"patch-package --patch-dir ./custom-patches"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"patch:moment"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"patch-package moment --patch-dir ./custom-patches"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-34">5. 补丁回滚与回退</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 回滚特定包的补丁</span>
npx patch-package moment --reverse

<span class="hljs-comment"># 或手动删除补丁文件</span>
<span class="hljs-built_in">rm</span> patches/moment+2.29.4.patch
npm install  <span class="hljs-comment"># 重新安装原始包</span>
</code></pre>
<h2 data-id="heading-35">性能优化与监控</h2>
<h3 data-id="heading-36">1. 补丁文件大小优化</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 查看补丁文件大小</span>
<span class="hljs-built_in">ls</span> -lah patches/

<span class="hljs-comment"># 使用 bzip2 压缩大型补丁（不推荐，会失去可读性）</span>
bzip2 -c patches/large-patch.patch &gt; patches/large-patch.patch.bz2
</code></pre>
<h3 data-id="heading-37">2. 安装性能监控</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 添加安装时间监控</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">'"postinstall": "time patch-package"'</span> &gt;&gt; package.json

<span class="hljs-comment"># 或使用更详细的监控</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">'"postinstall": "echo \"开始应用补丁...\" &amp;&amp; time patch-package &amp;&amp; echo \"补丁应用完成\""'</span> &gt;&gt; package.json
</code></pre>
<h3 data-id="heading-38">3. 补丁应用验证</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// scripts/verify-patches.js</span>
<span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>)
<span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>)

<span class="hljs-keyword">function</span> <span class="hljs-title function_">verifyPatches</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> patchesDir = path.<span class="hljs-title function_">join</span>(__dirname, <span class="hljs-string">'../patches'</span>)
  <span class="hljs-keyword">const</span> patchFiles = fs.<span class="hljs-title function_">readdirSync</span>(patchesDir).<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">f</span> =&gt;</span> f.<span class="hljs-title function_">endsWith</span>(<span class="hljs-string">'.patch'</span>))

  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`发现 <span class="hljs-subst">${patchFiles.length}</span> 个补丁文件:`</span>)
  patchFiles.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">file</span> =&gt;</span> {
    <span class="hljs-keyword">const</span> packageName = file.<span class="hljs-title function_">split</span>(<span class="hljs-string">'+'</span>)[<span class="hljs-number">0</span>].<span class="hljs-title function_">substring</span>(<span class="hljs-number">1</span>) <span class="hljs-comment">// 移除 @</span>
    <span class="hljs-keyword">try</span> {
      <span class="hljs-built_in">require</span>.<span class="hljs-title function_">resolve</span>(packageName)
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`✓ <span class="hljs-subst">${packageName}</span>: 包已安装`</span>)
    } <span class="hljs-keyword">catch</span> (e) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`✗ <span class="hljs-subst">${packageName}</span>: 包未安装`</span>)
    }
  })
}

<span class="hljs-title function_">verifyPatches</span>()
</code></pre>
<h2 data-id="heading-39">故障排除指南</h2>
<h3 data-id="heading-40">常见问题与解决方案</h3>
<h4 data-id="heading-41">1. 补丁应用失败</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 错误信息</span>
Error: Patch failed <span class="hljs-keyword">for</span> package moment@2.29.4
</code></pre>
<p><strong>解决方案：</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 检查版本是否匹配</span>
npm <span class="hljs-built_in">ls</span> moment

<span class="hljs-comment"># 清理并重新安装</span>
<span class="hljs-built_in">rm</span> -rf node_modules/moment
npm install moment

<span class="hljs-comment"># 重新生成补丁</span>
npx patch-package moment
</code></pre>
<h4 data-id="heading-42">2. 补丁文件冲突</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 错误信息</span>
patch: **** malformed patch at line xx
</code></pre>
<p><strong>解决方案：</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 检查补丁文件格式</span>
<span class="hljs-built_in">cat</span> patches/moment+2.29.4.patch | <span class="hljs-built_in">head</span> -20

<span class="hljs-comment"># 恢复到备份版本</span>
git checkout HEAD -- patches/moment+2.29.4.patch

<span class="hljs-comment"># 重新生成补丁</span>
<span class="hljs-built_in">rm</span> patches/moment+2.29.4.patch
npx patch-package moment
</code></pre>
<h4 data-id="heading-43">3. Windows 系统路径问题</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># Windows 可能遇到路径分隔符问题</span>
<span class="hljs-comment"># 使用 Git Bash 或 WSL 环境执行补丁操作</span>
</code></pre>
<h2 data-id="heading-44">与其他方案的对比分析</h2>













































<table><thead><tr><th>方案</th><th>维护成本</th><th>版本控制</th><th>团队协作</th><th>性能影响</th><th>推荐场景</th></tr></thead><tbody><tr><td><strong>patch-package</strong></td><td>低</td><td>✅ 优秀</td><td>✅ 优秀</td><td>轻微</td><td>临时修复、小改动</td></tr><tr><td><strong>Fork 包</strong></td><td>高</td><td>✅ 可控</td><td>✅ 良好</td><td>无</td><td>重大功能扩展、长期维护</td></tr><tr><td><strong>Monkey Patching</strong></td><td>中</td><td>❌ 无</td><td>❌ 困难</td><td>无</td><td>快速原型、实验性功能</td></tr><tr><td><strong>Wrapper 包</strong></td><td>中</td><td>✅ 良好</td><td>✅ 良好</td><td>轻微</td><td>API 适配、兼容性处理</td></tr></tbody></table>
<h2 data-id="heading-45">总结与展望</h2>
<h3 data-id="heading-46">patch-package 的核心价值</h3>
<ol>
<li><strong>开发效率提升</strong>：无需等待上游修复，快速解决问题</li>
<li><strong>团队协作友好</strong>：补丁文件可共享，环境一致性高</li>
<li><strong>维护成本低</strong>：自动化应用，减少手动操作</li>
<li><strong>风险可控</strong>：补丁内容透明，可审查可回滚</li>
</ol>
<h3 data-id="heading-47">使用建议</h3>
<p><strong>适合使用 patch-package 的场景：</strong></p>
<ul>
<li>🐛 临时 bug 修复</li>
<li>🔧 小功能增强</li>
<li>⚡ 性能优化</li>
<li>🔒 安全补丁</li>
<li>🧪 实验性功能</li>
</ul>
<p><strong>不适合使用 patch-package 的场景：</strong></p>
<ul>
<li>🏗️ 重大架构重构</li>
<li>📦 大功能模块开发</li>
<li>🔄 需要频繁更新的包</li>
<li>🎯 核心业务逻辑</li>
</ul>
<h3 data-id="heading-48">未来发展趋势</h3>
<p>随着包管理生态的发展，我们可能会看到：</p>
<ul>
<li><strong>更智能的补丁合并</strong>：自动处理版本升级</li>
<li><strong>补丁市场</strong>：社区共享的补丁库</li>
<li><strong>IDE 集成</strong>：可视化补丁编辑</li>
<li><strong>自动测试</strong>：补丁应用的自动化验证</li>
</ul>
<p>patch-package 已经成为现代前端开发工具链中不可或缺的一部分。掌握它的使用，不仅能解决当前的开发问题，更能培养我们对整个包管理生态的深度理解。</p>
<blockquote>
<p><strong>记住</strong>：最好的方案总是那个最适合当前项目需求的方案。patch-package 是一个强大的工具，但也要理性使用，避免过度依赖。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[从送外卖看Android Clean架构：为什么老板不需要知道外卖员开什么车？]]></title>    <link>https://juejin.cn/post/7596187471774138377</link>    <guid>https://juejin.cn/post/7596187471774138377</guid>    <pubDate>2026-01-19T00:04:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7596187471774138377" data-draft-id="7582922476222660623" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" 从送外卖看Android Clean架构：为什么老板不需要知道外卖员开什么车？"/> <meta itemprop="keywords" content="Android"/> <meta itemprop="datePublished" content="2026-01-19T00:04:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="潜龙勿用之化骨龙"/> <meta itemprop="url" content="https://juejin.cn/user/2313028195058471"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             从送外卖看Android Clean架构：为什么老板不需要知道外卖员开什么车？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2313028195058471/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    潜龙勿用之化骨龙
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-19T00:04:05.000Z" title="Mon Jan 19 2026 00:04:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-19
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>想象你经营一家外卖公司，公司里有三种角色：</p>
<ol>
<li><strong>老板</strong>（你）：制定送餐规则，关心利润</li>
<li><strong>餐厅经理</strong>：准备食物，保证质量</li>
<li><strong>外卖员</strong>：把食物送到客户手中</li>
</ol>
<p>现在，如果你是老板，你需要知道每个外卖员是<strong>骑电动车、自行车还是开车</strong>吗？需要知道他们用什么导航<strong>高德还是百度</strong>吗？</p>
<p><strong>不需要！</strong> 你只关心：</p>
<ul>
<li>食物准时送到（30分钟内）</li>
<li>客户满意（不洒不漏）</li>
<li>公司赚钱（成本控制）</li>
</ul>
<p>这就是Clean架构的核心思想！让我们用这个外卖公司的例子，彻底理解Android开发中的关注点分离和依赖规则。</p>
<h2 data-id="heading-0">一、外卖公司的混乱：没有Clean架构</h2>
<h3 data-id="heading-1">❌ 混乱的外卖公司（糟糕的代码结构）</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f3640e327ed44fed960f91a2705142d0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5r2c6b6Z5Yu_55So5LmL5YyW6aqo6b6Z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769385845&amp;x-signature=XWC6lCCu09IOS3f27q6LD4wGC7Q%3D" alt="image.png" loading="lazy"/>
<strong>问题分析</strong>：这个外卖员干了厨师、打包员、导航员、司机、收银员、文员的所有工作！</p>
<h3 data-id="heading-2">❌ 如果公司要扩张...</h3>
<ul>
<li>想换导航软件？要重新培训所有外卖员</li>
<li>想增加新菜品？外卖员要学新菜</li>
<li>想换支付方式？外卖员要重新学习</li>
<li>外卖员离职了？所有知识都带走了</li>
</ul>
<h2 data-id="heading-3">二、专业的外卖公司：Clean架构实现</h2>
<h3 data-id="heading-4">✅ 清晰的分工（关注点分离）</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7110ae5c5d95479cbe67a8cd32360f4c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5r2c6b6Z5Yu_55So5LmL5YyW6aqo6b6Z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769385845&amp;x-signature=3e1bfdOFs3LlPzK1MVR1MMyYkZE%3D" alt="mermaid_20251215_7b952f.png" loading="lazy"/></p>
<h3 data-id="heading-5">2.1 领域层：老板制定规则（不关心具体实现）</h3>
<p>domain/model/Delivery.kt - 核心业务模型</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/80705802052942149ff9f3120b4d4a55~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5r2c6b6Z5Yu_55So5LmL5YyW6aqo6b6Z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769385845&amp;x-signature=GnDygqEu15Oj167xg%2B9erIjNMEU%3D" alt="image.png" loading="lazy"/></p>
<p>domain/repository/DeliveryRepository.kt - 老板定义的接口</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/97429bb3b6d14707b3eacec507335a1d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5r2c6b6Z5Yu_55So5LmL5YyW6aqo6b6Z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769385845&amp;x-signature=BTB4S2B3OAfvwRx3uK6wi5WHdmE%3D" alt="image.png" loading="lazy"/></p>
<p>domain/usecase/AssignDeliveryUseCase.kt - 老板的业务逻辑</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/46c3a094897546d09cf3026480a79dc2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5r2c6b6Z5Yu_55So5LmL5YyW6aqo6b6Z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769385845&amp;x-signature=OgR9xnkE52qQgDmQx6w3o0Cws%2FI%3D" alt="image.png" loading="lazy"/>
}</p>
<p><strong>老板（领域层）的特点</strong>：</p>
<ul>
<li>不知道外卖员开什么车（不关心具体实现）</li>
<li>不知道餐厅用什么灶具（不关心数据源）</li>
<li>只关心业务规则和利润</li>
</ul>
<h3 data-id="heading-6">2.2 数据层：餐厅准备食物（具体实现）</h3>
<p>data/repository/DeliveryRepositoryImpl.kt - 餐厅经理的实现</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2c8001fcb8e841d9b88a7a80eebc0c42~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5r2c6b6Z5Yu_55So5LmL5YyW6aqo6b6Z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769385845&amp;x-signature=L6hBu9c%2BuTmjY8Rr14F09gQ%2Bvc8%3D" alt="image.png" loading="lazy"/></p>
<p><strong>餐厅（数据层）的特点</strong>：</p>
<ul>
<li>实现老板要求的菜品标准</li>
<li>可以使用各种厨房设备（Retrofit）</li>
<li>负责把原材料（网络数据）加工成标准菜品（领域实体）</li>
</ul>
<h3 data-id="heading-7">2.3 表示层：外卖员送餐（UI展示）</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eee320a355184cc499853de3803a4ce8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5r2c6b6Z5Yu_55So5LmL5YyW6aqo6b6Z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769385845&amp;x-signature=QYHLY7jcdZKLVgj2yyY41118xCw%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c787c61188ec4c5f9fbdcce2b38e73f0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5r2c6b6Z5Yu_55So5LmL5YyW6aqo6b6Z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769385845&amp;x-signature=dxjp5gRWa9D0LTISnWQgpFH%2FFYw%3D" alt="image.png" loading="lazy"/></p>
<p><strong>外卖员（表示层）的特点</strong>：</p>
<ul>
<li>可以是电动车、自行车、汽车（不同UI实现）</li>
<li>可以使用不同导航软件（不同地图SDK）</li>
<li>负责把食物（数据）展示给客户（用户）</li>
<li>与客户交互（用户输入）</li>
</ul>
<h2 data-id="heading-8">三、依赖规则：为什么老板不需要知道外卖员开什么车？</h2>
<h3 data-id="heading-9">3.1 依赖关系图</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ef0dc9c691614101b33c686414772686~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5r2c6b6Z5Yu_55So5LmL5YyW6aqo6b6Z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769385845&amp;x-signature=y7D%2B3huF0hpPm2XbbTd13KnAzZQ%3D" alt="mermaid_20251215_682d14.png" loading="lazy"/></p>
<h3 data-id="heading-10">3.2 关键规则：依赖只能指向老板（领域层）</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/59491e0523884905a32d77b399151698~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5r2c6b6Z5Yu_55So5LmL5YyW6aqo6b6Z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769385845&amp;x-signature=A9ZZGMiF8HoTVN3zmSU56hsrgjY%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6ff08593ff57486f9aab2f5de82c08e3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5r2c6b6Z5Yu_55So5LmL5YyW6aqo6b6Z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769385845&amp;x-signature=39j4hNRuq6ouUzgrlAsyFzQ6QDI%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/69ccd9562ebe4988b631c4dd77e890eb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5r2c6b6Z5Yu_55So5LmL5YyW6aqo6b6Z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769385845&amp;x-signature=E%2FI1aZSza7xq77kQbg4GPHGFLUI%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-11">3.3 依赖注入：公司的HR部门</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3f17159a7bd34758ab95994e9141f8c5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5r2c6b6Z5Yu_55So5LmL5YyW6aqo6b6Z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769385845&amp;x-signature=7sIfBDFF04%2BL%2BMHwJRoIS5ewSEI%3D" alt="image.png" loading="lazy"/></p>
<p>老板只需要告诉HR需要什么人，HR负责招聘</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cc3e05bfc8884710bda4ebaf39dac736~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5r2c6b6Z5Yu_55So5LmL5YyW6aqo6b6Z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769385845&amp;x-signature=4PRcOZaZqL0TNByTpaxhJcZoaN4%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-12">4.1 如何开始重构现有项目？</h3>
<p><strong>第一步：识别"超级外卖员"类</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4ba03852fdbb40ffbb54652821073f7d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5r2c6b6Z5Yu_55So5LmL5YyW6aqo6b6Z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769385845&amp;x-signature=GngjP8IuFcYrz%2FC1kR2t4hgquxw%3D" alt="image.png" loading="lazy"/></p>
<p><strong>第二步：提取"老板规则"（领域层）</strong> 当然我不建议usecase 抛出异常,应该包装起来。这里只是举例。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b5fe9ae247be447da0634ea4322e0351~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5r2c6b6Z5Yu_55So5LmL5YyW6aqo6b6Z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769385845&amp;x-signature=fAHCowM%2Bd%2Bkp7a7BUgQCjqBQb8Y%3D" alt="image.png" loading="lazy"/></p>
<p><strong>第三步：创建"餐厅厨房"（数据层</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bf82fcce0fdf4695b7c93658eaae2ce8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5r2c6b6Z5Yu_55So5LmL5YyW6aqo6b6Z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769385845&amp;x-signature=juqfOqdpirPzCt1YNl8XOFWScaE%3D" alt="image.png" loading="lazy"/></p>
<p><strong>第四步：改造"外卖员"（表示层）</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aceed0ee3e944f998b0607393f305bd4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5r2c6b6Z5Yu_55So5LmL5YyW6aqo6b6Z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769385845&amp;x-signature=88sCn8gGBGhtzP8zE9RORkw8P5Y%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-13">5.2 常见问题解答</h3>
<p><strong>Q：小型项目也需要这样分层吗？</strong>
A：就像小外卖店开始可能只有一个人（老板兼厨师兼外卖员），但当业务增长时，一定要提前规划分工。可以从简单三层开始。</p>
<p><strong>Q：UseCase会不会太多？</strong>
A：就像老板的规则文档，重要的规则才需要写成UseCase。简单的CRUD操作可以直接在Repository处理。</p>
<p><strong>Q：测试真的变容易了吗？</strong>
A：你可以单独测试：</p>
<ul>
<li>老板的规则（UseCase测试）→ 验证业务逻辑</li>
<li>餐厅的菜品（Repository测试）→ 验证数据处理</li>
<li>外卖员的服务（UI测试）→ 验证用户交互</li>
</ul>
<p><strong>Q：学习成本高吗？</strong>
A：就像培训外卖员需要时间，但一旦掌握，效率倍增。从一个小功能开始尝试。</p>
<h3 data-id="heading-14">5.3 外卖架构的终极好处</h3>
<ol>
<li><strong>可维护性</strong>：老板换规则，不用重新培训外卖员</li>
<li><strong>可测试性</strong>：可以单独测试老板的决策逻辑</li>
<li><strong>可扩展性</strong>：增加新城市、新交通工具都很容易</li>
<li><strong>团队协作</strong>：可以并行开发（有人设计规则，有人开发UI，有人对接API）</li>
<li><strong>技术升级</strong>：换导航、换地图、换支付，都不影响核心业务</li>
</ol>
<h2 data-id="heading-15">六、总结：像经营外卖公司一样写Android代码</h2>
<p>记住这个简单的原则：</p>
<p><strong>你的代码应该像一个专业的外卖公司：</strong></p>
<ul>
<li>
<p><strong>老板（领域层）</strong>：制定规则，关心业务，不关心具体实现</p>
</li>
<li>
<p><strong>餐厅（数据层）</strong>：准备标准菜品，可以用各种厨具</p>
</li>
<li>
<p><strong>外卖员（表示层）</strong>：专业配送，良好服务，灵活应变</p>
</li>
</ul>
<p><strong>依赖规则就是</strong>：外卖员听老板的，餐厅按老板的标准做菜，但老板不需要知道外卖员开什么车，也不需要知道餐厅用什么牌子的灶具。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[像 ChatGPT 一样丝滑：Spring Boot 如何实现大模型流式（Streaming）响应？]]></title>    <link>https://juejin.cn/post/7596488155302314003</link>    <guid>https://juejin.cn/post/7596488155302314003</guid>    <pubDate>2026-01-18T23:56:54.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7596488155302314003" data-draft-id="7596221097865248774" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="像 ChatGPT 一样丝滑：Spring Boot 如何实现大模型流式（Streaming）响应？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-18T23:56:54.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="风象南"/> <meta itemprop="url" content="https://juejin.cn/user/2524134428655159"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            像 ChatGPT 一样丝滑：Spring Boot 如何实现大模型流式（Streaming）响应？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2524134428655159/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    风象南
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-18T23:56:54.000Z" title="Sun Jan 18 2026 23:56:54 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、为什么需要流式响应？</h2>
<p>同样的 HTTP 请求，为什么像 ChatGPT 这类模型的回答能像打字机一样逐字输出，而我们平时写的接口却要等全部处理完才返回？</p>
<p>问题的核心在于 <strong>响应模式</strong>：</p>





















<table><thead><tr><th>传统模式</th><th>流式模式</th></tr></thead><tbody><tr><td>服务器处理完成 → 一次性返回</td><td>生成一部分 → 立即推送</td></tr><tr><td>客户端等待总时长 = 服务器处理时间</td><td>客户端首字等待时间通常很短</td></tr><tr><td>适合快速查询</td><td>适合耗时生成</td></tr></tbody></table>
<p>对于大模型这种 <strong>生成式 AI</strong>，一个响应可能需要几秒甚至几十秒。如果用传统模式，用户体验就是：</p>
<pre><code class="hljs language-scss" lang="scss">提问 → (<span class="hljs-number">10</span>秒空白) → 答案全部出现
</code></pre>
<p>而流式响应的体验是：</p>
<pre><code class="hljs language-arduino" lang="arduino">提问 → <span class="hljs-number">0.1</span>秒后 → <span class="hljs-string">"我"</span> → <span class="hljs-string">"认"</span> → <span class="hljs-string">"为"</span> → ... → 逐字呈现
</code></pre>
<p>实现这种效果有多种技术方案，本文将介绍基于 Spring Boot WebFlux + SSE 的实现方式。</p>
<h2 data-id="heading-1">二、核心技术选型</h2>
<p>实现流式响应主要有以下几种方案：</p>





























<table><thead><tr><th>方案</th><th>优点</th><th>缺点</th><th>适用场景</th></tr></thead><tbody><tr><td><strong>SSE</strong></td><td>单向推送、HTTP协议、实现简单</td><td>不支持双向通信</td><td>服务端主动推送</td></tr><tr><td><strong>WebSocket</strong></td><td>双向通信、实时性强</td><td>实现复杂、需要额外协议</td><td>聊天、游戏</td></tr><tr><td><strong>长轮询</strong></td><td>兼容性好</td><td>资源消耗大</td><td>低频数据更新</td></tr></tbody></table>
<p><strong>本文选择 SSE 方案</strong>，原因如下：</p>
<ul>
<li>Spring Boot 原生支持 <code>ResponseEntity&lt;Flux&lt;String&gt;&gt;</code></li>
<li>基于标准 HTTP，无需额外协议协商</li>
<li>代码简洁，易于理解和维护</li>
</ul>
<h2 data-id="heading-2">三、项目依赖配置</h2>
<h4 data-id="heading-3">3.1 Maven 依赖</h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"UTF-8"</span>?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">project</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://maven.apache.org/POM/4.0.0"</span>
         <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span>
         <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://maven.apache.org/POM/4.0.0
         https://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">modelVersion</span>&gt;</span>4.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">modelVersion</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.2.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">relativePath</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.example<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>springboot-chat-stream<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">java.version</span>&gt;</span>17<span class="hljs-tag">&lt;/<span class="hljs-name">java.version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- Spring Boot WebFlux：响应式编程支持 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-webflux<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- Lombok：简化代码 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.projectlombok<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>lombok<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">optional</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">optional</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span>
</code></pre>
<h4 data-id="heading-4">3.2 关键依赖说明</h4>
<p><strong>spring-boot-starter-webflux</strong>：提供响应式 Web 支持，核心是 Reactor 的 <code>Flux</code> 类型</p>
<p><strong>Reactor</strong>：响应式编程库，<code>Flux&lt;T&gt;</code> 表示 0-N 个元素的异步序列</p>
<h2 data-id="heading-5">四、核心代码实现</h2>
<h4 data-id="heading-6">4.1 Controller 层：流式响应入口</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.chat.controller;

<span class="hljs-keyword">import</span> com.example.chat.service.StreamChatService;
<span class="hljs-keyword">import</span> lombok.RequiredArgsConstructor;
<span class="hljs-keyword">import</span> org.springframework.http.MediaType;
<span class="hljs-keyword">import</span> org.springframework.http.ResponseEntity;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.*;
<span class="hljs-keyword">import</span> reactor.core.publisher.Flux;

<span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequestMapping("/api/chat")</span>
<span class="hljs-meta">@RequiredArgsConstructor</span>
<span class="hljs-meta">@CrossOrigin(origins = "*")</span> <span class="hljs-comment">// 开发环境允许跨域</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StreamChatController</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> StreamChatService chatService;

    <span class="hljs-comment">/**
     * 流式聊天接口
     * <span class="hljs-doctag">@param</span> prompt 用户输入的问题
     * <span class="hljs-doctag">@return</span> 流式响应，text/event-stream 格式
     */</span>
    <span class="hljs-meta">@GetMapping(value = "/stream", produces = MediaType.TEXT_EVENT_STREAM_VALUE)</span>
    <span class="hljs-keyword">public</span> ResponseEntity&lt;Flux&lt;String&gt;&gt; <span class="hljs-title function_">streamChat</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam</span> String prompt)</span> {
        <span class="hljs-keyword">return</span> ResponseEntity.ok()
                .header(<span class="hljs-string">"Cache-Control"</span>, <span class="hljs-string">"no-cache"</span>)
                .header(<span class="hljs-string">"Connection"</span>, <span class="hljs-string">"keep-alive"</span>)
                .body(chatService.streamResponse(prompt));
    }
}
</code></pre>
<p><strong>关键点解析：</strong></p>
<ol>
<li><code>produces = MediaType.TEXT_EVENT_STREAM_VALUE</code>：声明返回 SSE 格式</li>
<li><code>Flux&lt;String&gt;</code>：响应式流，可以发送多个数据块</li>
<li><code>Cache-Control: no-cache</code>：禁用缓存，确保实时推送</li>
</ol>
<h4 data-id="heading-7">4.2 Service 层：模拟大模型流式生成</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.chat.service;

<span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Service;
<span class="hljs-keyword">import</span> reactor.core.publisher.Flux;

<span class="hljs-keyword">import</span> java.time.Duration;

<span class="hljs-meta">@Slf4j</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StreamChatService</span> {

    <span class="hljs-comment">/**
     * 模拟大模型流式生成响应
     * <span class="hljs-doctag">@param</span> prompt 用户问题
     * <span class="hljs-doctag">@return</span> 按字符/词汇流式输出的响应
     */</span>
    <span class="hljs-keyword">public</span> Flux&lt;String&gt; <span class="hljs-title function_">streamResponse</span><span class="hljs-params">(String prompt)</span> {
        log.info(<span class="hljs-string">"收到用户提问: {}"</span>, prompt);

        <span class="hljs-comment">// 模拟大模型生成的回复内容</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">response</span> <span class="hljs-operator">=</span> mockLLMResponse(prompt);

        <span class="hljs-comment">// 将响应拆分为字符流，每 50ms 发送一个字符</span>
        <span class="hljs-keyword">return</span> Flux.fromArray(response.split(<span class="hljs-string">""</span>))
                .delayElements(Duration.ofMillis(<span class="hljs-number">50</span>))
                .doOnNext(chunk -&gt; log.debug(<span class="hljs-string">"发送数据块: {}"</span>, chunk))
                .doOnComplete(() -&gt; log.info(<span class="hljs-string">"流式响应完成"</span>))
                .doOnError(e -&gt; log.error(<span class="hljs-string">"流式响应异常"</span>, e));
    }

    <span class="hljs-comment">/**
     * 模拟大模型生成内容（实际项目可接入 OpenAI/通义千问等）
     */</span>
    <span class="hljs-keyword">private</span> String <span class="hljs-title function_">mockLLMResponse</span><span class="hljs-params">(String prompt)</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"""
                【Spring Boot 流式响应】
                您的问题是：%s

                这是一个模拟大模型流式输出的示例。
                在实际应用中，你可以：
                1. 接入 OpenAI API 使用 GPT-4
                2. 接入阿里云通义千问 API
                3. 接入本地部署的大模型

                流式响应的核心是：
                - 使用 Spring WebFlux 的 Flux
                - 返回 text/event-stream 格式
                - 前端使用 EventSource 或 fetch 接收

                这样就能实现像 ChatGPT 一样的丝滑体验！
                """</span>.formatted(prompt);
    }
}
</code></pre>
<p><strong>核心逻辑：</strong></p>
<ol>
<li><code>Flux.fromArray(response.split(""))</code>：将字符串拆分为字符数组转为流</li>
<li><code>.delayElements(Duration.ofMillis(50))</code>：每个字符延迟 50ms 发送</li>
<li><code>.doOnNext()/.doOnComplete()/.doOnError()</code>：生命周期钩子，用于日志记录</li>
</ol>
<h4 data-id="heading-8">4.3 接入真实大模型 API（扩展）</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 接入 OpenAI Streaming API 的示例（伪代码）</span>
<span class="hljs-keyword">public</span> Flux&lt;String&gt; <span class="hljs-title function_">streamOpenAI</span><span class="hljs-params">(String prompt)</span> {
    <span class="hljs-type">WebClient</span> <span class="hljs-variable">webClient</span> <span class="hljs-operator">=</span> WebClient.builder()
            .baseUrl(<span class="hljs-string">"https://api.openai.com/v1"</span>)
            .defaultHeader(HttpHeaders.AUTHORIZATION, <span class="hljs-string">"Bearer YOUR_API_KEY"</span>)
            .build();

    <span class="hljs-keyword">return</span> webClient.post()
            .uri(<span class="hljs-string">"/chat/completions"</span>)
            .bodyValue(Map.of(
                <span class="hljs-string">"model"</span>, <span class="hljs-string">"gpt-4"</span>,
                <span class="hljs-string">"messages"</span>, List.of(Map.of(<span class="hljs-string">"role"</span>, <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>, prompt)),
                <span class="hljs-string">"stream"</span>, <span class="hljs-literal">true</span>
            ))
            .retrieve()
            .bodyToFlux(String.class)
            .map(<span class="hljs-built_in">this</span>::extractContentFromSSE); <span class="hljs-comment">// 解析 SSE 格式提取 content</span>
}
</code></pre>
<h4 data-id="heading-9">4.4 启动类</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.chat;

<span class="hljs-keyword">import</span> org.springframework.boot.SpringApplication;
<span class="hljs-keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;

<span class="hljs-meta">@SpringBootApplication</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ChatStreamApplication</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        SpringApplication.run(ChatStreamApplication.class, args);
    }
}
</code></pre>
<h4 data-id="heading-10">4.5 配置文件</h4>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">server:</span>
  <span class="hljs-attr">port:</span> <span class="hljs-number">8080</span>

<span class="hljs-attr">spring:</span>
  <span class="hljs-attr">application:</span>
    <span class="hljs-attr">name:</span> <span class="hljs-string">chat-stream-demo</span>

<span class="hljs-comment"># 日志配置</span>
<span class="hljs-attr">logging:</span>
  <span class="hljs-attr">level:</span>
    <span class="hljs-attr">com.example.chat:</span> <span class="hljs-string">DEBUG</span>
</code></pre>
<hr/>
<h2 data-id="heading-11">五、前端对接示例</h2>
<h4 data-id="heading-12">5.1 使用 EventSource 接收流</h4>
<pre><code class="hljs language-html" lang="html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Spring Boot 流式响应示例<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
        <span class="hljs-selector-tag">body</span> { <span class="hljs-attribute">font-family</span>: Arial; <span class="hljs-attribute">max-width</span>: <span class="hljs-number">800px</span>; <span class="hljs-attribute">margin</span>: <span class="hljs-number">50px</span> auto; <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>; }
        <span class="hljs-selector-id">#output</span> { <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#ddd</span>; <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>; <span class="hljs-attribute">min-height</span>: <span class="hljs-number">100px</span>; <span class="hljs-attribute">background</span>: <span class="hljs-number">#f9f9f9</span>; }
        <span class="hljs-selector-tag">input</span> { <span class="hljs-attribute">width</span>: <span class="hljs-number">70%</span>; <span class="hljs-attribute">padding</span>: <span class="hljs-number">10px</span>; }
        <span class="hljs-selector-tag">button</span> { <span class="hljs-attribute">padding</span>: <span class="hljs-number">10px</span> <span class="hljs-number">20px</span>; <span class="hljs-attribute">cursor</span>: pointer; }
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Spring Boot 流式聊天<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"prompt"</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"输入问题..."</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"sendQuestion()"</span>&gt;</span>发送<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"output"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
        <span class="hljs-keyword">function</span> <span class="hljs-title function_">sendQuestion</span>(<span class="hljs-params"/>) {
            <span class="hljs-keyword">const</span> prompt = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'prompt'</span>).<span class="hljs-property">value</span>;
            <span class="hljs-keyword">const</span> output = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'output'</span>);
            output.<span class="hljs-property">innerHTML</span> = <span class="hljs-string">'等待响应...'</span>;

            <span class="hljs-comment">// 使用 EventSource 接收 SSE 流</span>
            <span class="hljs-keyword">const</span> eventSource = <span class="hljs-keyword">new</span> <span class="hljs-title class_">EventSource</span>(
                <span class="hljs-string">`/api/chat/stream?prompt=<span class="hljs-subst">${<span class="hljs-built_in">encodeURIComponent</span>(prompt)}</span>`</span>
            );

            eventSource.<span class="hljs-property">onmessage</span> = <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
                output.<span class="hljs-property">innerHTML</span> += event.<span class="hljs-property">data</span>;
            };

            eventSource.<span class="hljs-property">onerror</span> = <span class="hljs-function">() =&gt;</span> {
                eventSource.<span class="hljs-title function_">close</span>();
                output.<span class="hljs-property">innerHTML</span> += <span class="hljs-string">'&lt;br&gt;&lt;br&gt;[连接关闭]'</span>;
            };

            <span class="hljs-comment">// 30秒后自动关闭（演示用）</span>
            <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> eventSource.<span class="hljs-title function_">close</span>(), <span class="hljs-number">30000</span>);
        }
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<h4 data-id="heading-13">5.2 使用 Fetch API（推荐）</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">streamChat</span>(<span class="hljs-params">prompt</span>) {
    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`/api/chat/stream?prompt=<span class="hljs-subst">${<span class="hljs-built_in">encodeURIComponent</span>(prompt)}</span>`</span>);
    <span class="hljs-keyword">const</span> reader = response.<span class="hljs-property">body</span>.<span class="hljs-title function_">getReader</span>();
    <span class="hljs-keyword">const</span> decoder = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TextDecoder</span>();

    <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
        <span class="hljs-keyword">const</span> { done, value } = <span class="hljs-keyword">await</span> reader.<span class="hljs-title function_">read</span>();
        <span class="hljs-keyword">if</span> (done) <span class="hljs-keyword">break</span>;

        <span class="hljs-keyword">const</span> chunk = decoder.<span class="hljs-title function_">decode</span>(value);
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'收到数据:'</span>, chunk);
        <span class="hljs-comment">// 更新 UI</span>
    }
}
</code></pre>
<hr/>
<h2 data-id="heading-14">六、运行效果</h2>
<p>启动项目后，访问 <code>http://localhost:8080</code>（需添加静态页面支持），输入问题，你会看到：</p>
<pre><code class="hljs language-erlang" lang="erlang">【Spring Boot 流式响应】
您的问题是：如何学习 Spring Boot？

这是一个模拟大模型流式输出的示例。
...
</code></pre>
<p>文字像打字机一样逐字出现，体验丝滑！</p>
<h2 data-id="heading-15">七、总结</h2>
<p>本文介绍了如何使用 Spring Boot WebFlux 实现 SSE 流式响应。核心是通过 <code>Flux&lt;String&gt;</code> + <code>TEXT_EVENT_STREAM_VALUE</code> 将数据分块推送，配合前端 <code>EventSource</code> 实现逐字显示效果。相比传统一次性返回，流式响应能显著降低用户等待感知，特别适合大模型对话等耗时生成场景。</p>
<pre><code class="hljs language-ruby" lang="ruby"><span class="hljs-symbol">https:</span>/<span class="hljs-regexp">/github.com/yuboon</span><span class="hljs-regexp">/java-examples/tree</span><span class="hljs-regexp">/master/springboot</span>-chat-stream
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[浅析-AI时代对前端工程师的影响]]></title>    <link>https://juejin.cn/post/7596166721628913710</link>    <guid>https://juejin.cn/post/7596166721628913710</guid>    <pubDate>2026-01-19T00:09:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7596166721628913710" data-draft-id="7593311807587696646" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="浅析-AI时代对前端工程师的影响"/> <meta itemprop="keywords" content="AI编程,前端"/> <meta itemprop="datePublished" content="2026-01-19T00:09:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="EB_Coder"/> <meta itemprop="url" content="https://juejin.cn/user/3228641967213214"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            浅析-AI时代对前端工程师的影响
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3228641967213214/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    EB_Coder
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-19T00:09:53.000Z" title="Mon Jan 19 2026 00:09:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-19
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>随着<code>AI</code>时代的来临，身边的前端圈子里，“<code>AI</code>”成了茶余饭后的高频词。有人兴奋地展示用最新<code>AI</code>工具生成的精美界面，也有人开始担忧——这些能写代码、能画图的工具，会不会有一天把我们给替代了？</p>
<p>我最初也有类似的困惑，但在慢慢接触了一段时间后，我想分享一些不同的观察。这并不是那种充斥着“神经网络”、“深度学习”术语的技术文章，而是一个普通前端开发者对AI最朴素、浅层的的理解。（如果你是一名<code>AI</code>的资深大佬，那么你大可不必浪费时间在这篇文章上）</p>
</blockquote>
<h2 data-id="heading-0">一、不要把AI想得有多么的“高大上”</h2>
<p>首先，我们可以先忘掉那些复杂的定义。在我看来，<code>AI</code>更像是<strong>一个非常擅长找规律的学生</strong>。</p>
<p>举个例子，你给一个小孩看了一千张老虎的图片，每次都告诉他“这是老虎”。下次你再给他看一张他从未见过的老虎图片，他也<strong>大概率</strong>能认出来。其实<code>AI</code>做的事情本质上和这个很类似——通过分析海量的现有代码、设计稿、用户行为数据，它逐渐学会了前端开发中常见的“套路”。</p>
<p>即使它没见过真正的逻辑，但它记住了那些频繁出现的模式：比如一个登录页面通常有用户名输入框、密码输入框和提交按钮；一个电商商品卡片通常包含图片、标题、价格和购买按钮。当你让它“生成一个登录页面”时，它不过是在回忆并组合这些它之前见过的模式片段。</p>
<p>所以，<code>AI</code>既不是魔法，更不是万能的神。它的“智能”建立在它见过的数据之上，它擅长处理常规的、模式化的任务，但对于全新的、需要深度逻辑推理或创造性突破的工作，它仍然力不从心。</p>
<h2 data-id="heading-1">二、AI正在如何改变前端</h2>
<p>这种“善于找规律”的特性，已经开始渗透到前端开发的各个环节。这些变化不是翻天覆地的革命，更像是润物无声的升级：</p>
<h3 data-id="heading-2">1. 从“重复建造”到“定制调整”</h3>
<p>以前，我们从零开始搭建一个基础的管理后台表格，需要手动处理表格框架、分页逻辑、筛选排序等功能，是相当耗时的。现在，你可以直接对<code>AI</code>说：“生成一个带分页、搜索和批量操作的用户数据表格，用<code>React</code>和<code>Ant Design</code>。”它能在几秒内给你一份可工作的基础代码。你的角色，从重复的“搬砖仔”，变成了更具主导性的“建筑师”或“装修师”，以前重复的“搬砖”时间可以用在专注于根据具体业务需求进行深度定制、优化性能和用户体验方面。</p>
<h3 data-id="heading-3">2. 设计到代码的“翻译”过程正在加速</h3>
<p>“设计稿切图”这个经典环节正在被重塑。通过一些AI工具，你可以上传UI设计稿（<code>Figma、Sketch</code>等），它能自动识别组件、布局和样式，生成结构清晰、语义化的<code>HTML/CSS</code>代码骨架。虽然目前还无法做到100%完美（尤其对于复杂或高度自定义的交互），但它极大地压缩了视觉稿到初始代码之间的机械转换时间，让我们能更早地进入真正的逻辑开发和交互实现阶段。</p>
<h3 data-id="heading-4">3. 开发副驾驶已就位</h3>
<p>最直接的体验，可能就是代码补全和智能提示的进化。比如像<code>GitHub Copilot</code>这样的工具，已经能根据你的代码上下文，预测并建议一整行甚至一个完整的函数。当你写一个日期格式化函数时，它可能会自动补全出整个逻辑。这就像一个时刻在线的、熟悉你项目习惯的助手，帮你处理那些琐碎的语法和常见代码片段，让你更专注于业务逻辑本身。</p>
<h3 data-id="heading-5">4. 个人效率工具的普及</h3>
<p>除了写代码，<code>AI</code>还能成为我们工作流中的多方面的助手：用自然语言让它帮你编写测试用例的描述、生成模拟数据（“给我20条包含姓名、城市和订单金额的用户数据”）、优化代码注释、甚至解释一段复杂的遗留代码。这些工具正在将我们从大量辅助性、文档性工作中解放出来，从而我们有更多的时间去关注业务本身。</p>
<h2 data-id="heading-6">三、前端开发者，可以这样开始</h2>
<p>面对这些变化，焦虑是没有用的，关上大门更不明智。主动了解和学习，把它变成我们的“副驾驶”，才是更务实的态度。你可以尝试从以下几个非常具体的步骤开始：</p>
<h3 data-id="heading-7">第一步：先感受，再深究</h3>
<p>你完全不必一开始就去啃机器学习教科书。最好的入门方式就是<strong>直接用起来</strong>。</p>
<ul>
<li><strong>玩玩ChatGPT（或类似产品）</strong>：不要只把它当聊天机器人。试着向它提问前端相关的问题：
<ul>
<li>
<p>“用<code>JavaScript</code>写一个深度拷贝函数，并解释原理。”</p>
</li>
<li>
<p>“<code>Vue 3</code>的<code>Composition API</code>和<code>Options API</code>主要区别是什么？”</p>
</li>
<li>
<p>“帮我优化这段<code>CSS</code>，让它更高效。”</p>
</li>
</ul>
</li>
<li><strong>在编辑器中尝试Copilot</strong>：如果你使用<code>VSCode</code>，可以安装<code>GitHub Copilot</code>的扩展。在写代码时，观察它的建议，接受有用的代码，思考它为什么这么建议。这是最直接的、沉浸式的体验。</li>
</ul>
<h3 data-id="heading-8">第二步：建立“AI思维”</h3>
<p>在使用过程中，刻意培养一种新的工作思路：</p>
<ul>
<li>
<p><strong>学会提问</strong>：<code>AI</code>的输出质量，很大程度上取决于你的输入。练习如何清晰、具体地描述你的需求。比如，从“写个表格”升级到“用React函数式组件写一个可排序、可分页的用户数据表格，使用<code>Tailwind CSS</code>样式”。</p>
</li>
<li>
<p><strong>成为审批者，而非搬运工</strong>：永远不要无脑的复制<code>AI</code>生成的代码。把它看作一个才华横溢但有时会犯错的实习生。你的核心职责是<strong>审查、测试和整合</strong>。仔细检查它的逻辑是否正确，是否存在安全漏洞（如<code>XSS</code>风险），代码风格是否符合项目规范，性能是否最优。</p>
</li>
</ul>
<h3 data-id="heading-9">第三步：深化你的核心护城河</h3>
<p>恰恰因为<code>AI</code>擅长处理模式化的任务，我们更应该强化那些它不擅长的能力（至少目前是这样），这些是我们的核心竞争力：</p>
<ul>
<li>
<p><strong>更深的业务理解</strong>：只有你深入理解产品的业务逻辑、用户的实际痛点，才能判断<code>AI</code>生成的方案是否真的能解决问题，并指导<code>AI</code>朝正确的方向改进。</p>
</li>
<li>
<p><strong>更优的架构设计</strong>：如何设计可维护、可扩展、高性能的前端架构，如何做技术选型，这些全局性的、高层次的思考，至少目前来说<code>AI</code>是难以替代的。</p>
</li>
<li>
<p><strong>极致的用户体验</strong>：对交互动效的细腻把控程度，对无障碍访问（<code>A11y</code>）的深入实践，对用户心理和行为的洞察，这些创造性和同理心驱动的领域，依然是人类开发者的舞台。</p>
</li>
<li>
<p><strong>复杂的交互与逻辑</strong>：处理非常规的、状态复杂的交互流程（如一个多步骤的、有大量条件分支的表单向导），编写高度定制化的动画和视觉效果，这些依然是我们的强项。</p>
</li>
</ul>
<h2 data-id="heading-10">写在最后</h2>
<p><code>AI</code>不是来取代前端开发者的，它更像是一个强大的、不知疲倦的杠杆。它把我们从大量重复劳动中托举出来，让我们有机会站在更高的地方，去解决更复杂、更有价值的问题。</p>
<p>这场变化的关键，不在于我们会不会被淘汰，而在于我们选择如何与这个新工具“共舞”。是把它关在门外，守着旧工具渐渐落伍；还是走上前，握住它，让自己原本需要一天完成的枯燥工作，压缩到一小时，然后用省下的时间，去钻研动画原理、去优化渲染性能、去理解业务本质，成为一个更不可替代的专家？</p>
<p>仁者见仁，智者见智，答案在我们自己手中。从此刻起，尝试着向AI提出你的第一个问题吧！这或许是你能为未来的自己，做的最有价值的投资之一。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[AI 替代不了你什么？]]></title>    <link>https://juejin.cn/post/7596241980869558306</link>    <guid>https://juejin.cn/post/7596241980869558306</guid>    <pubDate>2026-01-19T00:10:30.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7596241980869558306" data-draft-id="7585097023748243471" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AI 替代不了你什么？"/> <meta itemprop="keywords" content="AI编程,Android"/> <meta itemprop="datePublished" content="2026-01-19T00:10:30.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="RockByte"/> <meta itemprop="url" content="https://juejin.cn/user/1046390797768519"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AI 替代不了你什么？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1046390797768519/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    RockByte
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-19T00:10:30.000Z" title="Mon Jan 19 2026 00:10:30 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-19
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{position:relative;word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;color:#282d36}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:30px;margin-bottom:5px;color:#2f845e}.markdown-body h2{font-size:22px;display:inline-block;font-weight:700;background:#2f845e;color:#fff;padding:6px 8px 0 0;border-top-right-radius:6px;margin-right:2px;box-shadow:6px 3px 0 0 rgba(47,132,194,.2)}.markdown-body h2:before{content:" ";display:inline-block;width:8px}.markdown-body h2:after{content:" ";position:absolute;display:block;width:calc(100% - 32px);border-bottom:3px solid #2f845e}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%;box-shadow:6px 6px 6px #888}.markdown-body hr{border:none;border-top:1px solid rgba(66,185,131,.15);margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#f6ffed;color:#52c41a;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:16px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#262626;border:1px solid #2f845e;border-top:8px solid #2f845e;background:linear-gradient(180deg,rgba(66,185,131,.1),transparent)!important}.markdown-body pre&gt;code.hljs[lang]:before{top:8px!important;color:#2f845e!important}.markdown-body pre&gt;code.language-awesome_error{border:1px solid #ff4d4f!important;border-left-width:8px;font-size:14px;font-weight:700;padding:15px 12px 15px 16px;margin:0;word-break:normal;white-space:break-spaces;display:block;overflow-x:auto;color:#ff4d4f!important;background:#fff2f0!important}.markdown-body pre&gt;code.language-awesome_error:before{content:"!"!important;position:absolute!important;top:50%!important;left:-9px!important;transform:translateY(-14px)!important;background:#ff4d4f!important;color:#fff!important;border:2px solid #fff!important;display:flex;align-items:center;justify-content:center;width:22px;height:22px;border-radius:100%;font-weight:700;font-family:Dosis,Source Sans Pro,Helvetica Neue,Arial,sans-serif;font-size:16px}.markdown-body pre&gt;code.language-awesome_warn{border:1px solid #ffc46f!important;border-left-width:8px;font-size:14px;font-weight:700;padding:15px 12px 15px 16px;margin:0;word-break:normal;white-space:break-spaces;display:block;overflow-x:auto;color:#ffc46f!important;background:#fffbe6!important}.markdown-body pre&gt;code.language-awesome_warn:before{content:"☂"!important;position:absolute;top:50%!important;left:-9px!important;transform:translateY(-14px)!important;background:#ffc46f!important;color:#fff!important;border:2px solid #fff!important;display:flex;align-items:center;justify-content:center;width:22px;height:22px;border-radius:100%;font-weight:700;font-family:Dosis,Source Sans Pro,Helvetica Neue,Arial,sans-serif;font-size:16px}.markdown-body pre&gt;code.language-awesome_success{border:1px solid #52c41a!important;border-left-width:8px;font-size:14px;font-weight:700;padding:15px 12px 15px 16px;margin:0;word-break:normal;white-space:break-spaces;display:block;overflow-x:auto;color:#52c41a!important;background:#f6ffed!important}.markdown-body pre&gt;code.language-awesome_success:before{content:"✓"!important;position:absolute!important;top:50%!important;left:-9px!important;transform:translateY(-14px)!important;background:#52c41a!important;color:#fff!important;border:2px solid #fff!important;display:flex;align-items:center;justify-content:center;width:22px;height:22px;border-radius:100%;font-weight:700;font-family:Dosis,Source Sans Pro,Helvetica Neue,Arial,sans-serif;font-size:16px}.markdown-body pre&gt;code.language-awesome_info{border:1px solid #1890ff!important;border-left-width:8px;font-size:14px;font-weight:700;padding:15px 12px 15px 16px;margin:0;word-break:normal;white-space:break-spaces;display:block;overflow-x:auto;color:#1890ff!important;background:#e6f7ff!important}.markdown-body pre&gt;code.language-awesome_info:before{content:"i"!important;position:absolute!important;top:50%!important;left:-9px!important;transform:translateY(-14px)!important;background:#1890ff!important;color:#fff!important;border:2px solid #fff!important;display:flex;align-items:center;justify-content:center;width:22px;height:22px;border-radius:100%;font-weight:700;font-family:Dosis,Source Sans Pro,Helvetica Neue,Arial,sans-serif;font-size:16px}.markdown-body strong{background-color:inherit;color:#2f845e}.markdown-body em{background-color:inherit;color:#949415}.markdown-body a{text-decoration:none;color:#2f8e54;border-bottom:1px solid #3f9e64}.markdown-body a:active,.markdown-body a:hover{color:#3f9e64}.markdown-body a[class^=footnote]{margin-left:4px}.markdown-body a:before{content:"➤ "}.markdown-body table{font-size:12px;width:100%;max-width:100%;overflow:auto;border:2px solid #2f8e54}.markdown-body thead{background:#2f8e54;color:#fff;text-align:left;font-weight:700}.markdown-body tr:nth-child(2n){background-color:rgba(153,255,188,.1)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:22px}.markdown-body td{min-width:120px}.markdown-body blockquote{padding:1px 22px;margin:22px 0;border-left:6px solid #2f845e;background-color:rgba(66,185,131,.1);border-radius:2px}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#2f845e}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px;color:#282d36}.markdown-body del{color:#2f845e}.markdown-body input[type=checkbox]:checked:before{content:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAA/klEQVQ4T72TMU7DQBBF318XdFR06egQEnAXRINEGlqgowoIR8AF4AZOZ4JEGq5AC5EixBU4A55BNrEVHAcSBTHlaubt37/zxZKlcn7n6mDPXJvz8IJ89HzWu8t7C8D2dfsY52ae4apHnLx0ktsCsHXZjiUuFgG40x2eJ/H/AhztB+zDUTpLwWj8jGkzxSHiHaMPrDQC8sMoilKzLAUqiKQjmb+ZuAdW80tmelCHODoNgSfP7AFprTTaRTzsJN1GEyuIZ7uW6TEEHwCtyV/6EVBKJHhfzgC0Xv/iXwEFBF4FG0378bd7sPQq5xK/hSnk6sdlX3mZrKkwLZKBeu8n9XuWEUE7X+YAAAAASUVORK5CYII=);position:relative;top:-1px;left:-1px}.markdown-body .math .katex{font-family:Menlo,Monaco,Consolas,Courier New,monospace;word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#f6ffed;color:#52c41a;font-size:.87em;padding:.065em .4em}@media (max-width:720px){.markdown-body h1{font-size:22px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="xcode">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#fff;color:#000}.xml .hljs-meta{color:silver}.hljs-comment,.hljs-quote{color:#007400}.hljs-attribute,.hljs-keyword,.hljs-literal,.hljs-name,.hljs-selector-tag,.hljs-tag{color:#aa0d91}.hljs-template-variable,.hljs-variable{color:#3f6e74}.hljs-code,.hljs-meta-string,.hljs-string{color:#c41a16}.hljs-link,.hljs-regexp{color:#0e0eff}.hljs-bullet,.hljs-number,.hljs-symbol,.hljs-title{color:#1c00cf}.hljs-meta,.hljs-section{color:#643820}.hljs-built_in,.hljs-builtin-name,.hljs-class .hljs-title,.hljs-params,.hljs-type{color:#5c2699}.hljs-attr{color:#836c28}.hljs-subst{color:#000}.hljs-formula{background-color:#eee;font-style:italic}.hljs-addition{background-color:#baeeba}.hljs-deletion{background-color:#ffc8bd}.hljs-selector-class,.hljs-selector-id{color:#9b703f}.hljs-doctag,.hljs-strong{font-weight:700}.hljs-emphasis{font-style:italic}</style><p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2f9436b1b0fe4a469f0045a5244be9f0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUm9ja0J5dGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769386229&amp;x-signature=dSXXcnd1C2VkcYkr%2FRp%2BDZed9Yw%3D" alt="000.jpg" loading="lazy"/></p>
<p>“这个问题 AI 三秒就能解决。”</p>
<p>如果你也这样想过，那不妨听听我最近的真实故事。</p>
<h2 data-id="heading-0">胸有成竹</h2>
<p>这！</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3c1042d933c1430ca86feb7cdd714e45~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUm9ja0J5dGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769386229&amp;x-signature=l3CR4qSU62mvMkOwSTJkyBiLrzs%3D" alt="20251219-141313.jpg" loading="lazy"/></p>
<p>是一块 <strong>RockChip 3528</strong> 的开发版，它能完美的运行 Android 13 系统，从图中也可以看到，这块板子的接口相当齐全。</p>
<p><em>我外接了一个显示器，一个 USB 调试线，以及一块鼠标（是的，它可以用鼠标，因为它的 Andorid 系统是基于 <strong>TV</strong> 版本的）</em></p>
<p>而我的任务，就是在这块板子上集成一系列的 App，并针对这块板子修改 Android 系统以满足商业需求。</p>
<p>实际上大概在 7 年前，我做过类似的开发，当时的项目目标是：让一块 <strong>Firefly</strong> 的板子连接车辆上一系列传感器，并开发出一系列的 App，做一个类似智能驾舱的系统，去广州的车展做推广，以期待车厂能够跟我们合作。</p>
<p>我的开发任务大概有 <strong>200</strong> 多条，为了起个好头，我选了个“看起来”最简单的任务——“修改系统的 <code>dpi</code> 为 <code>220</code>”。</p>
<p>当我拿到这块板子的时候，有一系列的配套文档以及系统的源码，所以我在文档的帮助下，花了半天时间配置好了系统环境，并尝试第一次编译。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/973dabf1feaa44fc83893a95fdcd15f3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUm9ja0J5dGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769386229&amp;x-signature=OCAruKuK%2BCuFcFss7K7UYb2xSBY%3D" alt="1.png" loading="lazy"/></p>
<p>虽然我的电脑配置不低（拥有 20 核心 CPU 的笔记本），但是第一次编译还是花去了 3 小时。</p>
<p>成功刷机之后，系统启动起来，还是有点小激动的。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a6a9bf4c0c994ce3b1864a151c478411~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUm9ja0J5dGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769386229&amp;x-signature=awVWyJSjUz53G%2B01kwQr2Z97%2FXU%3D" alt="2.png" loading="lazy"/></p>
<p>此时，还有 2 小时我就下班了，我心想，赶紧改好，早点回家。</p>
<p>于是我问了一下我的 AI 助手，AOSP 源码怎么修改系统的分辨率。</p>
<p>AI 给的回复大致是：在当前中源码的 <code>device.mk</code> 中更改 <code>ro.sf.lcd_density</code> 属性即可。</p>
<p>于是乎，我全局检索了一下 <code>mk</code> 文件，祈求找到 <code>ro.sf.lcd_density</code>。</p>
<p>这里，我用到了第一个很有用的命令行：</p>
<p><code>grep -rn "ro.sf.lcd_density" --include "*.mk"</code></p>
<p>该命令行会对当前递归目录下的所有 <code>mk</code> 文件进行查找，如果匹配，就会打印行号：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/289b434358054c28970aba67126a2d16~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUm9ja0J5dGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769386229&amp;x-signature=r36z90qAC%2BJ4G8KXD9kjdv6%2BzPM%3D" alt="3.jpg" loading="lazy"/></p>
<p>经过我的甄别，我觉得应该就是 <code>device/rockchip/rk3528/device.mk</code> 文件了，为了方便，我把所有 <code>ro.sf.lcd_density</code> 出现的地方都改成了 <code>220</code>。</p>
<p>保存，编译。</p>
<p>10 分钟后，刷机，等待，启动。</p>
<p><code>adb</code> 输入 <code>adb -d shell wm density</code>，输出如下：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">Physical density:</span> <span class="hljs-number">320</span>
<span class="hljs-attr">Override density:</span> <span class="hljs-number">240</span>
</code></pre>
<p>嘶~~~~~~~~~~~</p>
<p>一定是我编译的问题，我把源码中的 <code>out</code> 目录删了，重新编译。</p>
<p><em>删除 <code>out</code> 目录等于重新编译。类似 <code>clean</code> 之后 <code>build</code>。</em></p>
<p>3 小时过去了，离我下班时间过去了一个小时。</p>
<p>刷机，等待，启动。</p>
<p><code>adb</code> 检查：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">Physical density:</span> <span class="hljs-number">320</span>
<span class="hljs-attr">Override density:</span> <span class="hljs-number">240</span>
</code></pre>
<p>嘶~~~~~~~~~~~嘶~~~~~~~~~~~</p>
<p>下班回家！</p>
<p>当天我想了一晚上，为什么会不起作用呢？</p>
<p>我在 <strong>Google</strong> 和 AI 上面疯狂寻找答案，我整理了一下大致有几种解决方案：</p>
<ol>
<li>看看是不是其他构建文件（<code>mk</code>，<code>bp</code>）更改了 <code>ro.sf.lcd_density</code>。</li>
<li><strong>TV</strong> 版本的系统比较特殊，会自动映射 <code>dpi</code>，也就是说，<code>220</code> 不是一个标准的 <code>dpi</code>，会自动映射到临近的 <code>240</code>。</li>
<li><code>ro.sf.lcd_density</code> 如果不起作用的话，说明系统给了一个默认值，可以搜索类似 <code>default_density</code> 的参数看看。</li>
</ol>
<p>此时的我，已经成竹在胸，我不信三管齐下改不好？</p>
<p>明天再说！</p>
<h2 data-id="heading-1">步入泥沼</h2>
<p>第二天开完早会后，我着手实施上面三个措施。</p>
<p>我先把我的源码丢给了 <strong>cursor</strong>，让其分析哪些地方可以更改 <code>dpi</code>。</p>
<p><em><strong>cursor</strong> 是借的同事的，这样做其实很不道德，分析整个工程需要消耗 token，不过公司报销，所以我就不心疼了。</em></p>
<p>同时另一边，我着手开始实施第一第二策略。</p>
<p>我先在所有的构建文件中查找 <code>ro.sf.lcd_density</code>，发现并没有修改的地方，而 Java 文件中，都是读取这个属性，也没有修改的地方。</p>
<p>例如这里，<code>frameworks\base\core\java\android\util\DisplayMetrics.java</code>：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/73c5e0696f014524a4774f6dea0116a9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUm9ja0J5dGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769386229&amp;x-signature=ANyOjm4GmqpBp0Yw90pyoumgwW8%3D" alt="3.png" loading="lazy"/></p>
<p>于是乎，我看向了第二个策略，检查是否会自动映射。</p>
<p>其实这个很难，我的同事在另一套开发板源码上找到了做 <code>dpi</code> 映射的代码：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f36d8e809eb5455b9e5169fc03d2fbcb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUm9ja0J5dGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769386229&amp;x-signature=lMH%2FQweDhtzUizGXbT40ZGEjrfw%3D" alt="4.png" loading="lazy"/></p>
<p>很不幸的是，我这儿没有类似的代码。</p>
<p>于是我转向搜索上面源码中 <code>DisplayMetrics.getDeviceDensity()</code> 的使用，经过我大部分的筛查，也没有什么实际作用。</p>
<p>现在，我只能等待 <strong>cursor</strong> 的结果了。</p>
<p>等待 <strong>cursor</strong> 分析完毕之后，它告诉我两个地方可以更改：</p>
<ul>
<li>一个是上面提到的 <code>ro.sf.lcd_density</code>。</li>
<li>另一个就是在一个神奇的文件 <code>device/rockchip/common/tv/overlay/frameworks/base/packages/SettingsProvider/res/values/defaults.xm</code> 中，修改 <code>def_display_density</code> 声明。</li>
</ul>
<p>好的，第一个方案已经尝试过了，现在直接看第二个，涉及到的文件是这样的：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/20388c0aa4274e0783e843d22b1f270a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUm9ja0J5dGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769386229&amp;x-signature=twFZwj8SUrLFF9wrCt6%2BLyh5zyQ%3D" alt="5.png" loading="lazy"/></p>
<p>这个和普通的Android资源文件是类似的，这里清晰的显示了，<code>def_display_density</code> 为 <code>240</code>。</p>
<p>不管那么多了，改了再说！</p>
<p>保存，编译~~~，刷机，等待，启动。</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">Physical density:</span> <span class="hljs-number">320</span>
<span class="hljs-attr">Override density:</span> <span class="hljs-number">240</span>
</code></pre>
<p>嘶~~~~~~~~~~~嘶~~~~~~~~~~~嘶~~~~~~~~~~~</p>
<p>明天再说！</p>
<h2 data-id="heading-2">迎来曙光</h2>
<p>“修改系统的 <code>dpi</code> 为 <code>220</code>”这条需求我已经干到第三天了，我还没有放弃，我继续跟踪 <code>def_display_density</code> 的使用，发现在文件 <code>frameworks/base/packages/SettingsProvider/src/com/android/providers/settings/DatabaseHelper.java</code> 有所使用，相关代码是这样的：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">if</span> (<span class="hljs-string">"box"</span>.equals(SystemProperties.get(<span class="hljs-string">"ro.target.product"</span>)))
                 loadStringSetting(stmt, Settings.Secure.DISPLAY_DENSITY_FORCED,R.string.def_display_density);
</code></pre>
<p>这段代码引起了我的警觉，因为我的编译命令中，有一条是这样写的：</p>
<pre><code class="hljs language-sh" lang="sh">lunch rk3528_box-userdebug
</code></pre>
<p><code>rk3528_box</code>，嗯，我这个可能确实是个 <code>box</code>。于是我通过 <code>adb</code> 命令检查一下：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b9c58f93e03c4f71a47197c9dc12bdea~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUm9ja0J5dGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769386229&amp;x-signature=8opu5gXXPQraPAHwVZJQ4PEyQCQ%3D" alt="6.png" loading="lazy"/></p>
<p>这下证明，上面那段代码起作用了，于是我继续跟踪 <code>Settings.Secure.DISPLAY_DENSITY_FORCED</code> 的引用。</p>
<p>首先，在 <code>frameworks/base/services/core/java/com/android/server/wm/WindowManagerService.java</code> 中发现如下代码：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * <span class="hljs-doctag">@param</span> userId the ID of the user
 * <span class="hljs-doctag">@return</span> the forced display density for the specified user, if set, or
 *         {<span class="hljs-doctag">@code</span> 0} if not set
 */</span>
<span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getForcedDisplayDensityForUserLocked</span><span class="hljs-params">(<span class="hljs-type">int</span> userId)</span> {
    <span class="hljs-type">String</span> <span class="hljs-variable">densityStr</span> <span class="hljs-operator">=</span> Settings.Secure.getStringForUser(mContext.getContentResolver(),
            Settings.Secure.DISPLAY_DENSITY_FORCED, userId);
    <span class="hljs-keyword">if</span> (densityStr == <span class="hljs-literal">null</span> || densityStr.length() == <span class="hljs-number">0</span>) {
        densityStr = SystemProperties.get(DENSITY_OVERRIDE, <span class="hljs-literal">null</span>);
    }
    <span class="hljs-keyword">if</span> (densityStr != <span class="hljs-literal">null</span> &amp;&amp; densityStr.length() &gt; <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">return</span> Integer.parseInt(densityStr);
        } <span class="hljs-keyword">catch</span> (NumberFormatException ex) {
        }
    }
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<p>这段代码简单来说就是如果 <code>Settings.Secure.DISPLAY_DENSITY_FORCED</code> 有值，就会直接使用它的结果。</p>
<p><em>这里其实就很奇怪了，在 <code>DatabaseHelper</code> 中，已经设置了它的值为默认值 <code>def_display_density</code> 了。</em></p>
<p>我们继续看，在 <code>frameworks/base/services/core/java/com/android/server/wm/DisplayWindowSettings.java</code> 有这样的代码：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">void</span> <span class="hljs-title function_">setForcedDensity</span><span class="hljs-params">(DisplayInfo info, <span class="hljs-type">int</span> density, <span class="hljs-type">int</span> userId)</span> {
    <span class="hljs-keyword">if</span> (info.displayId == Display.DEFAULT_DISPLAY) {
        <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">densityString</span> <span class="hljs-operator">=</span> density == <span class="hljs-number">0</span> ? <span class="hljs-string">""</span> : Integer.toString(density);
        Settings.Secure.putStringForUser(mService.mContext.getContentResolver(),
                Settings.Secure.DISPLAY_DENSITY_FORCED, densityString, userId);
    }
    ...
</code></pre>
<p>意思是说可以通过 <code>DisplayWindowSettings.setForcedDensity</code> 去更改 <code>Settings.Secure.DISPLAY_DENSITY_FORCED</code> 对应的值。</p>
<p>我隐约看见了曙光！继续跟踪，发现了下面这样一个调用链条：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/622c76a78d564052a4849e5122f33c6f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUm9ja0J5dGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769386229&amp;x-signature=MeVDWiRokFgc6FT2lxxgJaARilc%3D" alt="6.jpg" loading="lazy"/></p>
<p><em><code>onCommand</code> 内部调用了 <code>runDisplayDensity</code>，以此类推。我本来想表达被谁调用的意思，所以箭头朝上了.</em></p>
<p><code>onCommand</code> 函数，是专门处理 <code>adb wm</code> 命令的，</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">onCommand</span><span class="hljs-params">(String cmd)</span> {
    <span class="hljs-keyword">if</span> (cmd == <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">return</span> handleDefaultCommands(cmd);
    }
    <span class="hljs-keyword">final</span> <span class="hljs-type">PrintWriter</span> <span class="hljs-variable">pw</span> <span class="hljs-operator">=</span> getOutPrintWriter();
    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">switch</span> (cmd) {
            <span class="hljs-keyword">case</span> <span class="hljs-string">"size"</span>:
                <span class="hljs-keyword">return</span> runDisplaySize(pw);
            <span class="hljs-keyword">case</span> <span class="hljs-string">"density"</span>:
                <span class="hljs-keyword">return</span> runDisplayDensity(pw);
...
</code></pre>
<p>也就是说，这个系统启动起来之后，有个地方调用了 <code>wm density</code> 去修改了系统的 <code>dpi</code>。</p>
<p>那就继续跟踪 <code>wm density</code>。</p>
<p>果然，在 <code>/home/xpg/workspace/rk3528_dev/rk3528/frameworks/base/services/core/java/com/android/server/policy/PhoneWindowManager.java</code> 中：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setDensity</span><span class="hljs-params">(String density)</span>{
    <span class="hljs-type">String</span> <span class="hljs-variable">cmd</span> <span class="hljs-operator">=</span> <span class="hljs-string">"wm density "</span> +density;
    <span class="hljs-keyword">try</span> {
            Log.d(TAG, <span class="hljs-string">"zxLog "</span>+cmd);
            Runtime.getRuntime().exec(cmd);
    } <span class="hljs-keyword">catch</span> (Exception e) {
            e.printStackTrace();
    }
}
</code></pre>
<p>现在，我看看到底是谁调用了这个 <code>setDensity</code>。</p>
<p>我觉得我已经临门一脚了。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">BroadcastReceiver</span> <span class="hljs-variable">mDreamReceiver</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BroadcastReceiver</span>() {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onReceive</span><span class="hljs-params">(Context context, Intent intent)</span> {
                    <span class="hljs-type">String</span> <span class="hljs-variable">top_app</span> <span class="hljs-operator">=</span> SystemProperties.get(<span class="hljs-string">"sys.lmk_top_app"</span>, <span class="hljs-string">""</span>);
                    <span class="hljs-keyword">if</span>(<span class="hljs-string">"com.open.disney"</span>.equals(intent.getAction()) &amp;&amp; top_app.equals(<span class="hljs-string">"com.disney.disneyplus"</span>)){
                            <span class="hljs-keyword">if</span>(setDensityOnce == <span class="hljs-number">1</span>){
                                    setDensityOnce = <span class="hljs-number">0</span>;
                                    setDensity(<span class="hljs-string">"320"</span>);
                            }
                            <span class="hljs-keyword">return</span>;
                    }<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-string">"com.open.disney.back"</span>.equals(intent.getAction()) &amp;&amp; !top_app.equals(<span class="hljs-string">"com.disney.disneyplus"</span>)){
                            <span class="hljs-keyword">if</span>(setDensityOnce == <span class="hljs-number">0</span>){
                                    setDensityOnce = <span class="hljs-number">1</span>;
                                    setDensity(<span class="hljs-string">"240"</span>); <span class="hljs-comment">// 在这里起作用的！</span>
                            }
                            <span class="hljs-keyword">return</span>;
                    }
                    ...
</code></pre>
<p>广播？？？</p>
<p>好吧，我看看是谁发送的这个广播，这个广播的 <code>action</code> 是 <code>com.open.disney.back</code>，很简单。</p>
<p><code>/home/xpg/workspace/rk3528_dev/rk3528/frameworks/base/core/java/android/app/Activity.java</code> 中：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">checkWmDensity_back</span><span class="hljs-params">(<span class="hljs-keyword">final</span> View view)</span> {
    view.postDelayed(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Runnable</span>() {
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> {
            <span class="hljs-keyword">if</span> (!isFinishing() &amp;&amp; view != <span class="hljs-literal">null</span>) {
                <span class="hljs-keyword">try</span> {
                    sendBroadcast(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Intent</span>(<span class="hljs-string">"com.open.disney.back"</span>));
                } <span class="hljs-keyword">catch</span> (Exception e) {
                    e.printStackTrace();
                }
            }
        }
    }, <span class="hljs-number">2000</span>);
}

<span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onResume</span><span class="hljs-params">()</span> {
    ...
    checkWmDensity_back(findViewById(android.R.id.content));
    ...
}
</code></pre>
<p>好的，我们成功定位到源头了，在 <code>Activity</code> <code>onResume</code> 的时候，会调用 <code>checkWmDensity_back</code> 发送这个广播。</p>
<p>改法也就简单了，我把 <code>PhoneWindowManager</code> 中起作用的 <code>setDensity("240")</code> 改成了 <code>setDensity("220")</code>。</p>
<p>保存，编译~~~，刷机，等待，启动。</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">Physical density:</span> <span class="hljs-number">320</span>
<span class="hljs-attr">Override density:</span> <span class="hljs-number">220</span>
</code></pre>
<p>终于成功了。</p>
<h2 data-id="heading-3">总结</h2>
<p>非常感谢你坚持读到这里，这个看似简单的需求——“修改系统的 <code>dpi</code> 为 <code>220</code>”，让我花费了三天时间。</p>
<p>这期间其实我一直在用 AI 解决很多问题，例如：</p>
<ul>
<li>我告诉它我想要的效果，让它帮我生成一段 <code>shell</code> 命令；</li>
<li>我请教它 AOSP 源码中很多类的作用；</li>
<li>我问它 AOSP 镜像是如何构建出来；</li>
<li>我请教他为什么构建工具既有 <code>mk</code>，也有 <code>bp</code> 文件；</li>
<li>很多很多，但凡我不懂的，我都是先问 AI。</li>
</ul>
<p>我似乎明白了，为什么现在不需要 <strong>stackoverflow</strong> 了。</p>
<p>但我依然花了 3 天时间来完成这个需求，为什么这么久？</p>
<p>因为真正的工程，从来不是“查文档 + 改参数”这么线性。它交织着历史遗留、厂商定制、产品逻辑，甚至是一段为特定 App 临时加上的代码。这些，目前的 AI 无法预知，也无法推理。</p>
<p>AI 代替不了你对系统的直觉，代替不了你在无数个深夜 debug 后形成的“肌肉记忆”，更代替不了你站在业务目标前，判断“该往哪里用力”的决策力。</p>
<p>当然，我们不必恐惧 AI 取代程序员，真正该警惕的，是把思考外包给 AI 的惰性。</p>
<p>所以:</p>
<p>AI 能写代码，但写不出你的洞察；<br/>
它能加速执行，但决定不了方向。</p>
<p>而那个方向，永远只属于——<strong>你</strong>。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[不再费脑, 了解 AI 训练的 8 个基础数学概念]]></title>    <link>https://juejin.cn/post/7595960824486887458</link>    <guid>https://juejin.cn/post/7595960824486887458</guid>    <pubDate>2026-01-19T00:23:27.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595960824486887458" data-draft-id="7596241980869541922" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="不再费脑, 了解 AI 训练的 8 个基础数学概念"/> <meta itemprop="keywords" content="人工智能,LLM,数学"/> <meta itemprop="datePublished" content="2026-01-19T00:23:27.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="印刻君"/> <meta itemprop="url" content="https://juejin.cn/user/572216818014568"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            不再费脑, 了解 AI 训练的 8 个基础数学概念
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/572216818014568/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    印刻君
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-19T00:23:27.000Z" title="Mon Jan 19 2026 00:23:27 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-19
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>大家好, 我是印刻君. 我们都知道, AI 模型需要通过训练才能具备预测能力. 但你是否好奇, 这个训练的底层逻辑是什么呢? 要想理解训练过程, 关键在于要理解其背后的数学语言.</p>
<p>今天我将为你介绍 AI 训练中的 8 个数学概念, 帮助你更好地理解 AI 训练.</p>
<h2 data-id="heading-0">1 残差</h2>
<p>我们知道, AI 生成答案的原理其实是在预测答案, 要知道预测得准不准, 需要一个量化指标, 这个指标就是<strong>残差.</strong></p>
<p>残差的数学公式是:</p>
<p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ε</mi><mo>=</mo><mi>y</mi><mo>−</mo><mover accent="true"><mi>y</mi><mo>^</mo></mover></mrow><annotation encoding="application/x-tex">\varepsilon = y - \hat{y}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">ε</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.1944em;"/><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"/><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6944em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="accent-body" style="left:-0.1944em;"><span class="mord">^</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1944em;"><span/></span></span></span></span></span></span></span></span></p>
<p>其中，<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"/><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span></span> 代表实际值, <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>y</mi><mo>^</mo></mover></mrow><annotation encoding="application/x-tex">\hat{y}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"/><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6944em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="accent-body" style="left:-0.1944em;"><span class="mord">^</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1944em;"><span/></span></span></span></span></span></span></span></span> 代表预测值. 残差是实际值与预测值的差值.</p>
<p>举个生活例子, 一斤苹果 5 块钱:</p>
<ol>
<li>如果你猜一斤苹果 8 块钱, 残差就是 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>5</mn><mo>−</mo><mn>8</mn><mo>=</mo><mo>−</mo><mn>3</mn></mrow><annotation encoding="application/x-tex">5 - 8 = -3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"/><span class="mord">5</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">8</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"/><span class="mord">−</span><span class="mord">3</span></span></span></span></span></li>
<li>如果你猜一斤苹果 3 块钱, 残差就是 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>5</mn><mo>−</mo><mn>3</mn><mo>=</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">5 - 3 = 2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"/><span class="mord">5</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">3</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">2</span></span></span></span></span></li>
</ol>
<h2 data-id="heading-1">2 损失</h2>
<p>我们发现, 残差可以为正数, 也可能为负数, 但其实都是预测不准. 我们需要一个全部是正数的指标, 衡量预测准不准, 这个指标就是<strong>损失</strong>.</p>
<p>AI 训练中常见的损失函数, 是均方误差 (MSE). 思路是: 先把每一个残差平方 (平方后没有负数), 再计算这些平方的平均值.</p>
<p>公式如下:</p>
<p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>M</mi><mi>S</mi><mi>E</mi></mrow><annotation encoding="application/x-tex">MSE</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.05764em;">MSE</span></span></span></span></span></p>
<p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>=</mo><mfrac><mrow><msup><msub><mi>ε</mi><mn>1</mn></msub><mn>2</mn></msup><mo>+</mo><msup><msub><mi>ε</mi><mn>2</mn></msub><mn>2</mn></msup><mo>+</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo>+</mo><msup><msub><mi>ε</mi><mi>n</mi></msub><mn>2</mn></msup></mrow><mi>n</mi></mfrac></mrow><annotation encoding="application/x-tex">= \frac{{\varepsilon_1}^2 + {\varepsilon_2}^2 + ... + {\varepsilon_n}^2}{n}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.3669em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.379em;vertical-align:-0.345em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.034em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.4101em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">ε</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3173em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span/></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913em;"><span style="top:-2.931em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mbin mtight">+</span><span class="mord mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">ε</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3173em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span/></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913em;"><span style="top:-2.931em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mbin mtight">+</span><span class="mord mtight">...</span><span class="mbin mtight">+</span><span class="mord mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">ε</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1645em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span/></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913em;"><span style="top:-2.931em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span></span></span></span></span></p>
<p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>=</mo><mfrac><mrow><mo stretchy="false">(</mo><msup><mrow><msub><mi>y</mi><mn>1</mn></msub><mo>−</mo><mover accent="true"><msub><mi>y</mi><mn>1</mn></msub><mo>^</mo></mover></mrow><mn>2</mn></msup><mo stretchy="false">)</mo><mo>+</mo><mo stretchy="false">(</mo><msup><mrow><msub><mi>y</mi><mn>2</mn></msub><mo>−</mo><mover accent="true"><msub><mi>y</mi><mn>2</mn></msub><mo>^</mo></mover></mrow><mn>2</mn></msup><mo stretchy="false">)</mo><mo>+</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo>+</mo><mo stretchy="false">(</mo><mrow><msub><mi>y</mi><mi>n</mi></msub><mo>−</mo><mover accent="true"><msub><mi>y</mi><mi>n</mi></msub><mo>^</mo></mover></mrow><msup><mo stretchy="false">)</mo><mn>2</mn></msup></mrow><mi>n</mi></mfrac></mrow><annotation encoding="application/x-tex">= \frac{({y_1 - \hat{y_1}}^2) + ({y_2 - \hat{y_2}}^2) + ... + ({y_n - \hat{y_n}})^2}{n}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.3669em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.4539em;vertical-align:-0.345em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.1089em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.485em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3173em;"><span style="top:-2.357em;margin-left:-0.0359em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span/></span></span></span></span></span><span class="mbin mtight">−</span><span class="mord accent mtight"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6944em;"><span style="top:-2.7em;"><span class="pstrut" style="height:2.7em;"/><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3173em;"><span style="top:-2.357em;margin-left:-0.0359em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span/></span></span></span></span></span></span><span style="top:-2.7em;"><span class="pstrut" style="height:2.7em;"/><span class="accent-body" style="left:-0.25em;"><span class="mord mtight">^</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1944em;"><span/></span></span></span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913em;"><span style="top:-2.931em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose mtight">)</span><span class="mbin mtight">+</span><span class="mopen mtight">(</span><span class="mord mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3173em;"><span style="top:-2.357em;margin-left:-0.0359em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span/></span></span></span></span></span><span class="mbin mtight">−</span><span class="mord accent mtight"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6944em;"><span style="top:-2.7em;"><span class="pstrut" style="height:2.7em;"/><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3173em;"><span style="top:-2.357em;margin-left:-0.0359em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span/></span></span></span></span></span></span><span style="top:-2.7em;"><span class="pstrut" style="height:2.7em;"/><span class="accent-body" style="left:-0.25em;"><span class="mord mtight">^</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1944em;"><span/></span></span></span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913em;"><span style="top:-2.931em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose mtight">)</span><span class="mbin mtight">+</span><span class="mord mtight">...</span><span class="mbin mtight">+</span><span class="mopen mtight">(</span><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1645em;"><span style="top:-2.357em;margin-left:-0.0359em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span/></span></span></span></span></span><span class="mbin mtight">−</span><span class="mord accent mtight"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6944em;"><span style="top:-2.7em;"><span class="pstrut" style="height:2.7em;"/><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1645em;"><span style="top:-2.357em;margin-left:-0.0359em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span/></span></span></span></span></span></span><span style="top:-2.7em;"><span class="pstrut" style="height:2.7em;"/><span class="accent-body" style="left:-0.25em;"><span class="mord mtight">^</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1944em;"><span/></span></span></span></span></span><span class="mclose mtight"><span class="mclose mtight">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913em;"><span style="top:-2.931em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span></span></span></span></span></p>
<p>还是用苹果的例子, 8 块钱和 3 块钱的预测值的均方误差为:</p>
<p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>M</mi><mi>S</mi><msub><mi>E</mi><mtext>苹果价格</mtext></msub></mrow><annotation encoding="application/x-tex">MSE_{苹果价格}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"/><span class="mord mathnormal" style="margin-right:0.05764em;">MS</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord cjk_fallback mtight">苹果价格</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span></p>
<p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>=</mo><mo stretchy="false">(</mo><mn>9</mn><mo>+</mo><mn>4</mn><mo stretchy="false">)</mo><mi mathvariant="normal">/</mi><mn>2</mn></mrow><annotation encoding="application/x-tex">= (9 + 4) / 2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.3669em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">(</span><span class="mord">9</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord">4</span><span class="mclose">)</span><span class="mord">/2</span></span></span></span></span></p>
<p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>=</mo><mn>13</mn><mi mathvariant="normal">/</mi><mn>2</mn></mrow><annotation encoding="application/x-tex">= 13 / 2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.3669em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord">13/2</span></span></span></span></span></p>
<p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>=</mo><mn>6.5</mn></mrow><annotation encoding="application/x-tex">= 6.5</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.3669em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">6.5</span></span></span></span></span></p>
<h2 data-id="heading-2">3 导数</h2>
<p>知道损失值之后, 我们的下一步目标是把损失变小, 让预测变得越来越准. 这时候就需要用到<strong>导数</strong>.</p>
<h3 data-id="heading-3">3.1 导数: 单参数的变化率</h3>
<p>我们先简化场景, 只有一个要猜的参数 (比如苹果单价), 此时均方误差可以写为:</p>
<p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>l</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><mo stretchy="false">(</mo><mn>5</mn><mo>−</mo><mi>x</mi><msup><mo stretchy="false">)</mo><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">l(x) = (5 - x)^2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">(</span><span class="mord">5</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1.0641em;vertical-align:-0.25em;"/><span class="mord mathnormal">x</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span>, 其中 5 是实际值, <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">x</span></span></span></span></span> 是预测值</p>
<p>把 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>l</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">l(x)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span></span></span> 画成图像, 是一条开口向上的抛物线.</p>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/df1978b2e1e64bc9b6d9492eea26c220~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2w5Yi75ZCb:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769387038&amp;x-signature=3maraF%2FHv69aaeBS9MGUZ91hF9k%3D" width="400" loading="lazy"/>
<p>我们想让损失最小, 其实就是让 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>l</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">l(x)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span></span></span> 的值最小, 抛物线的最低点就是损失最小的位置.</p>
<p><strong>导数</strong>是这个抛物线上的斜率, 在最低点左侧, 斜率为负, 意味着增大 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">x</span></span></span></span></span> 可以使损失下降; 在最低点右侧, 斜率为正, 意味着可以减小 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">x</span></span></span></span></span> 的值使损失下降. 最低点斜率为 0, 损失最小.</p>
<h3 data-id="heading-4">3.2 反向传播</h3>
<p>刚才我们是通过看图看出来 x 为 5 时损失最小, 但是计算机不会看图, 它需要一个方法来找到什么时候损失函数最小, 这个方法就是<strong>反向传播</strong>.</p>
<blockquote>
<p>严格来说, 反向传播是在多参数场景下的概念, 这里是它的简化形式.</p>
</blockquote>
<p>反向传播的核心口诀是<strong>正向算损失, 反向算导数, 迭代更新参数.</strong> 口诀说的步骤如下:</p>
<ol>
<li>
<p>正向算损失, 先猜一个 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">x</span></span></span></span></span>, 比如 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo>=</mo><mn>8</mn></mrow><annotation encoding="application/x-tex">x = 8</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">8</span></span></span></span></span>, 带入 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>l</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">l(x)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span></span></span> 后计算损失为</p>
<p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>l</mi><mo stretchy="false">(</mo><mn>8</mn><mo stretchy="false">)</mo><mo>=</mo><mo stretchy="false">(</mo><mn>5</mn><mo>−</mo><mn>8</mn><msup><mo stretchy="false">)</mo><mn>2</mn></msup><mo>=</mo><mo stretchy="false">(</mo><mo>−</mo><mn>3</mn><msup><mo stretchy="false">)</mo><mn>2</mn></msup><mo>=</mo><mn>9</mn></mrow><annotation encoding="application/x-tex">l(8) = (5 - 8)^2 = (-3)^2 = 9</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mopen">(</span><span class="mord">8</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">(</span><span class="mord">5</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1.0641em;vertical-align:-0.25em;"/><span class="mord">8</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.0641em;vertical-align:-0.25em;"/><span class="mopen">(</span><span class="mord">−</span><span class="mord">3</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">9</span></span></span></span></span></p>
</li>
<li>
<p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>反向算导数</mtext><mo separator="true">,</mo><mtext>对</mtext></mrow><annotation encoding="application/x-tex">反向算导数, 对 </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"/><span class="mord cjk_fallback">反向算导数</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord cjk_fallback">对</span></span></span></span></span>l(x)<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>求</mtext></mrow><annotation encoding="application/x-tex">求</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord cjk_fallback">求</span></span></span></span></span>x$ 的导数</p>
<p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mrow><mi>d</mi><mi>l</mi></mrow><mrow><mi>d</mi><mi>x</mi></mrow></mfrac><mo>=</mo><mn>2</mn><mo stretchy="false">(</mo><mn>5</mn><mo>−</mo><mi>x</mi><mo stretchy="false">)</mo><mo>×</mo><mo stretchy="false">(</mo><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo><mo>=</mo><mn>2</mn><mi>x</mi><mo>−</mo><mn>10</mn></mrow><annotation encoding="application/x-tex">\frac{dl}{dx}=2(5-x)×(-1)=2x-10</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2251em;vertical-align:-0.345em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8801em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">d</span><span class="mord mathnormal mtight">x</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">d</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord">2</span><span class="mopen">(</span><span class="mord">5</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">(</span><span class="mord">−</span><span class="mord">1</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"/><span class="mord">2</span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">10</span></span></span></span></span></p>
<p>代入 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo>=</mo><mn>8</mn></mrow><annotation encoding="application/x-tex">x = 8</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">8</span></span></span></span></span> 之后得到导数为 6</p>
</li>
<li>
<p>迭代更新参数, 导数为 6 是正数, 我们调整参数的方向要和导数相反, 所以新的 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">x</span></span></span></span></span> 需要变小, 新的 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">x</span></span></span></span></span> 计算公式为:</p>
<p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mtext>新</mtext></msub><mo>=</mo><msub><mi>x</mi><mtext>旧</mtext></msub><mo>−</mo><mtext>学习率</mtext><mo>×</mo><mtext>导数</mtext></mrow><annotation encoding="application/x-tex">x_新 = x_旧 - 学习率 \times 导数</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord cjk_fallback mtight">新</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.7333em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord cjk_fallback mtight">旧</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"/><span class="mord cjk_fallback">学习率</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord cjk_fallback">导数</span></span></span></span></span></p>
<p>这里 "学习率" 是用来调整参数幅度, 我们先假设为 0.1, <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">x</span></span></span></span></span> 就被更新为</p>
<p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>8</mn><mo>−</mo><mn>0.1</mn><mo>×</mo><mn>6</mn><mo>=</mo><mn>7.4</mn></mrow><annotation encoding="application/x-tex">8 - 0.1 \times 6 = 7.4</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"/><span class="mord">8</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"/><span class="mord">0.1</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">6</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">7.4</span></span></span></span></span></p>
</li>
<li>
<p>现在我们循环回到第 1 步, 重新计算</p>
<p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>l</mi><mo stretchy="false">(</mo><mn>7.4</mn><mo stretchy="false">)</mo><mo>=</mo><mo stretchy="false">(</mo><mn>5</mn><mo>−</mo><mn>7.4</mn><msup><mo stretchy="false">)</mo><mn>2</mn></msup><mo>=</mo><mn>5.76</mn></mrow><annotation encoding="application/x-tex">l(7.4) = (5 - 7.4)^2 = 5.76</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mopen">(</span><span class="mord">7.4</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">(</span><span class="mord">5</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1.0641em;vertical-align:-0.25em;"/><span class="mord">7.4</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">5.76</span></span></span></span></span></p>
<p>可以看到损失显著减少.</p>
</li>
</ol>
<p>如果我们一直重复 "正向 -&gt; 反向 -&gt; 更新" 的流程, 当 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">x</span></span></span></span></span> 趋近于 5 的时候, 损失就趋近于 0.</p>
<p>这样通过反向传播, <strong>用导数指导参数调整</strong>, 就能够让损失趋近于 0.</p>
<h2 data-id="heading-5">4 偏导</h2>
<p>猜苹果单价是单参数的情况, 实际 AI 训练要处理多参数问题, 比如打车费预测.</p>
<p>打车总费用一般由两部分组成, 一部分是起步费, 一部分是每公里的单价.</p>
<p>假设我打了 3 公里的车, 总计花了 15 元, 你需要猜打车的起步费和单价, 问题就复杂了.</p>
<p>打车的预测价格为 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>y</mi><mo>^</mo></mover><mo>=</mo><mn>3</mn><mi>w</mi><mo>+</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">\hat{y} = 3w + b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"/><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6944em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="accent-body" style="left:-0.1944em;"><span class="mord">^</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1944em;"><span/></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"/><span class="mord">3</span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal">b</span></span></span></span></span>, 于是损失函数可以写为:</p>
<p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>l</mi><mo stretchy="false">(</mo><mi>w</mi><mo separator="true">,</mo><mi>b</mi><mo stretchy="false">)</mo><mo>=</mo><mo stretchy="false">(</mo><mn>15</mn><mo>−</mo><mo stretchy="false">(</mo><mn>3</mn><mi>w</mi><mo>+</mo><mi>b</mi><mo stretchy="false">)</mo><msup><mo stretchy="false">)</mo><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">l(w, b) = (15 - (3w +b))^2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord mathnormal">b</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">(</span><span class="mord">15</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">(</span><span class="mord">3</span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1.0641em;vertical-align:-0.25em;"/><span class="mord mathnormal">b</span><span class="mclose">)</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span></p>
<p>现在我们需要让损失函数变得最小, 但是有 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>w</mi></mrow><annotation encoding="application/x-tex">w</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal" style="margin-right:0.02691em;">w</span></span></span></span></span> 和 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi></mrow><annotation encoding="application/x-tex">b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal">b</span></span></span></span></span> 两个要猜的参数, 怎么样才能猜得更快更准呢?</p>
<p>这时候就需要用到控制变量法, 先假设只有一个变量在变化, 其他变量不变, 这就是求<strong>偏导</strong>.</p>
<p>在 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>l</mi><mo stretchy="false">(</mo><mi>w</mi><mo separator="true">,</mo><mi>b</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">l(w, b)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord mathnormal">b</span><span class="mclose">)</span></span></span></span></span> 的例子里就是:</p>
<ul>
<li>假设 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>w</mi></mrow><annotation encoding="application/x-tex">w</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal" style="margin-right:0.02691em;">w</span></span></span></span></span> 不变, 只有 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi></mrow><annotation encoding="application/x-tex">b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal">b</span></span></span></span></span> 在变, 偏导表示为 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mrow><mi mathvariant="normal">∂</mi><mi>l</mi></mrow><mrow><mi mathvariant="normal">∂</mi><mi>b</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">\frac{\partial l}{\partial b}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2251em;vertical-align:-0.345em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8801em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal mtight">b</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span></span></span></span></span></li>
<li>假设 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi></mrow><annotation encoding="application/x-tex">b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal">b</span></span></span></span></span> 不变, 只有 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>w</mi></mrow><annotation encoding="application/x-tex">w</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal" style="margin-right:0.02691em;">w</span></span></span></span></span> 在变, 偏导表示为 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mrow><mi mathvariant="normal">∂</mi><mi>l</mi></mrow><mrow><mi mathvariant="normal">∂</mi><mi>w</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">\frac{\partial l}{\partial w}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2251em;vertical-align:-0.345em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8801em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal mtight" style="margin-right:0.02691em;">w</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span></span></span></span></span></li>
</ul>
<p>通过偏导, AI 能分别确定每个参数的调整方向, 避免多参数相互干扰.</p>
<h2 data-id="heading-6">5 梯度</h2>
<p>前面说的梯度消失/梯度爆炸里的 "梯度", 就是这里要讲的核心概念. 当有多个参数时, 我们把所有参数的偏导数组合起来, 形成一个向量, 这就是<strong>梯度</strong>.</p>
<p>以二元函数 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>z</mi><mo>=</mo><mi>f</mi><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">z = f(x, y)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose">)</span></span></span></span></span> 为例:</p>
<ul>
<li>它对 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">x</span></span></span></span></span> 的偏导数是 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mrow><mi mathvariant="normal">∂</mi><mi>f</mi></mrow><mrow><mi mathvariant="normal">∂</mi><mi>x</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">\frac{\partial f}{\partial x}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2772em;vertical-align:-0.345em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9322em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal mtight">x</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.4461em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span></span></span></span></span>​, 意思是固定 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"/><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span></span> 不变, 函数沿 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">x</span></span></span></span></span> 轴方向的变化率;</li>
<li>它对 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"/><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span></span> 的偏导数是 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mrow><mi mathvariant="normal">∂</mi><mi>f</mi></mrow><mrow><mi mathvariant="normal">∂</mi><mi>y</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">\frac{\partial f}{\partial y}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.4133em;vertical-align:-0.4811em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9322em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.4461em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4811em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span></span></span></span></span>，意思是固定 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">x</span></span></span></span></span> 不变, 函数沿 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"/><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span></span> 轴方向的变化率.</li>
</ul>
<p>把所有偏导数组合在一起, 就形成了**梯度. **</p>
<p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">∇</mi><mi>f</mi><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo stretchy="false">)</mo><mo>=</mo><mrow><mo fence="true">(</mo><mfrac><mrow><mi mathvariant="normal">∂</mi><mi>f</mi></mrow><mrow><mi mathvariant="normal">∂</mi><mi>x</mi></mrow></mfrac><mo separator="true">,</mo><mfrac><mrow><mi mathvariant="normal">∂</mi><mi>f</mi></mrow><mrow><mi mathvariant="normal">∂</mi><mi>y</mi></mrow></mfrac><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">\nabla f(x,y) = \left( \frac{\partial f}{\partial x},\frac{\partial f}{\partial y} \right)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord">∇</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.8em;vertical-align:-0.65em;"/><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size2">(</span></span><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9322em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal mtight">x</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.4461em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9322em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.4461em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4811em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size2">)</span></span></span></span></span></span></span></p>
<p>梯度是一个向量, 它的方向, 指向函数值在该点增长最快的方向.</p>
<p>用一个形象的比喻, 多元函数的损失曲面可以比作一座山峰, 梯度的方向就是上山最快的方向, 负梯度的方向就是下山最快的方向.</p>
<p>我们要找损失最小值, 相当于要走到山底, 所以需要沿着 "负梯度方向" 走. 这就是 AI 训练中 "梯度下降法" 的核心逻辑.</p>
<h2 data-id="heading-7">6 残差矩阵</h2>
<p>前面 1~5 节, 我们都是只猜单样本, 少参数的情况.  实际 AI 训练是需要批量处理数据的, 于是就需要用到矩阵来简化计算.</p>
<p>我们先看残差是如何用矩阵来处理的, 比如我们要预测三种水果的单价:</p>
<p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Y</mi><mo>=</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>5</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>3</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>4</mn></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">Y = \begin{bmatrix}
5 &amp; 3 &amp; 4
\end{bmatrix}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.2em;vertical-align:-0.35em;"/><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.85em;"><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">5</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.35em;"><span/></span></span></span></span><span class="arraycolsep" style="width:0.5em;"/><span class="arraycolsep" style="width:0.5em;"/><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.85em;"><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.35em;"><span/></span></span></span></span><span class="arraycolsep" style="width:0.5em;"/><span class="arraycolsep" style="width:0.5em;"/><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.85em;"><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">4</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.35em;"><span/></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">]</span></span></span></span></span></span></span> 是实际值矩阵, 行代表苹果, 香蕉, 橙子的实际单价, 分别为 5 元, 3 元和 4 元;</p>
<p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>Y</mi><mo>^</mo></mover><mo>=</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>8</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>2</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>5</mn></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">\hat{Y} = \begin{bmatrix}
8 &amp; 2 &amp; 5
\end{bmatrix}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9468em;"/><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9468em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span></span><span style="top:-3.2523em;"><span class="pstrut" style="height:3em;"/><span class="accent-body" style="left:-0.25em;"><span class="mord">^</span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.2em;vertical-align:-0.35em;"/><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.85em;"><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">8</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.35em;"><span/></span></span></span></span><span class="arraycolsep" style="width:0.5em;"/><span class="arraycolsep" style="width:0.5em;"/><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.85em;"><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.35em;"><span/></span></span></span></span><span class="arraycolsep" style="width:0.5em;"/><span class="arraycolsep" style="width:0.5em;"/><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.85em;"><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">5</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.35em;"><span/></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">]</span></span></span></span></span></span></span> 是预测值矩阵, 行代表苹果, 香蕉, 橙子的预测单价, 分别为 8 元, 2 元和 5 元;</p>
<p>残差矩阵公式为 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><mo>=</mo><mi>Y</mi><mo>−</mo><mover accent="true"><mi>Y</mi><mo>^</mo></mover></mrow><annotation encoding="application/x-tex">E = Y - \hat{Y}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"/><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.9468em;"/><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9468em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span></span><span style="top:-3.2523em;"><span class="pstrut" style="height:3em;"/><span class="accent-body" style="left:-0.25em;"><span class="mord">^</span></span></span></span></span></span></span></span></span></span></span>, 于是:</p>
<p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><mo>=</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mn>3</mn></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mn>1</mn></mrow></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">E = \begin{bmatrix} -3 &amp; 1 &amp; -1
\end{bmatrix}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.2em;vertical-align:-0.35em;"/><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.85em;"><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">−</span><span class="mord">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.35em;"><span/></span></span></span></span><span class="arraycolsep" style="width:0.5em;"/><span class="arraycolsep" style="width:0.5em;"/><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.85em;"><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.35em;"><span/></span></span></span></span><span class="arraycolsep" style="width:0.5em;"/><span class="arraycolsep" style="width:0.5em;"/><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.85em;"><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">−</span><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.35em;"><span/></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">]</span></span></span></span></span></span></span>, 代表苹果, 香蕉, 橙子的单价残差, 分别为 -3 元, 1 元和 -1 元.</p>
<h2 data-id="heading-8">7 损失矩阵</h2>
<p>和之前说到<strong>损失</strong>一样, 残差矩阵我们也需要一种方法, 让残差矩阵里面只有正数.于是我们会用到矩阵的哈达玛积, 它的运算就是对应元素相乘:</p>
<p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi><mo>=</mo><mi>E</mi><mo>⊙</mo><mi>E</mi></mrow><annotation encoding="application/x-tex">L = E \odot E</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal">L</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"/><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">⊙</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.05764em;">E</span></span></span></span></span></p>
<p>把残差矩阵带入后</p>
<p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi></mrow><annotation encoding="application/x-tex">L</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal">L</span></span></span></span></span></p>
<p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>=</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mn>3</mn><mo>×</mo><mo>−</mo><mn>3</mn></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mn>1</mn><mo>×</mo><mn>1</mn></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mn>1</mn><mo>×</mo><mo>−</mo><mn>1</mn></mrow></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">= \begin{bmatrix} -3 \times -3 &amp; 1 \times 1 &amp; -1 \times -1
\end{bmatrix}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.3669em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.2em;vertical-align:-0.35em;"/><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.85em;"><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">−</span><span class="mord">3</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord">−</span><span class="mord">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.35em;"><span/></span></span></span></span><span class="arraycolsep" style="width:0.5em;"/><span class="arraycolsep" style="width:0.5em;"/><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.85em;"><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.35em;"><span/></span></span></span></span><span class="arraycolsep" style="width:0.5em;"/><span class="arraycolsep" style="width:0.5em;"/><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.85em;"><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">−</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord">−</span><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.35em;"><span/></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">]</span></span></span></span></span></span></span></p>
<p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>=</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>9</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">= \begin{bmatrix}
9 &amp; 1 &amp; 1
\end{bmatrix}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.3669em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.2em;vertical-align:-0.35em;"/><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.85em;"><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">9</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.35em;"><span/></span></span></span></span><span class="arraycolsep" style="width:0.5em;"/><span class="arraycolsep" style="width:0.5em;"/><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.85em;"><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.35em;"><span/></span></span></span></span><span class="arraycolsep" style="width:0.5em;"/><span class="arraycolsep" style="width:0.5em;"/><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.85em;"><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.35em;"><span/></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">]</span></span></span></span></span></span></span></p>
<p>后续计算批量损失时, 只需对这个矩阵取平均值, 就能得到整体损失值.</p>
<h2 data-id="heading-9">8 偏导矩阵</h2>
<p>在输入/输出均为矩阵的情况下, 我们需要<strong>矩阵求导</strong>. 核心逻辑与之前一致, 只是把 "单参数的变化率" 推广为 "矩阵元素整体的变化率".</p>
<p>以损失矩阵对参数矩阵求偏导为例:</p>
<p>假设输入矩阵 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi></mrow><annotation encoding="application/x-tex">X</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.07847em;">X</span></span></span></span></span> 是 3 个样本的特征</p>
<p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi><mo>=</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>2</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>3</mn></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">X = \begin{bmatrix}
1 \\
2 \\
3
\end{bmatrix}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:3.6em;vertical-align:-1.55em;"/><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:5.6em;"/><span style="width:0.667em;height:3.600em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.667em" height="3.600em" viewbox="0 0 667 3600"><path d="M403 1759 V84 H666 V0 H319 V1759 v0 v1759 h347 v-84&#10;H403z M403 1759 V0 H319 V1759 v0 v1759 h84z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span/></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">1</span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">2</span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span/></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:5.6em;"/><span style="width:0.667em;height:3.600em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.667em" height="3.600em" viewbox="0 0 667 3600"><path d="M347 1759 V0 H0 V84 H263 V1759 v0 v1759 H0 v84 H347z&#10;M347 1759 V0 H263 V1759 v0 v1759 h84z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span/></span></span></span></span></span></span></span></span></span></span></p>
<p>权重矩阵 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>W</mi><mo>=</mo><mo stretchy="false">[</mo><mi>w</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">W = [w]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">[</span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mclose">]</span></span></span></span></span>, <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi><mo>=</mo><mo stretchy="false">[</mo><mi>b</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">B = [b]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">[</span><span class="mord mathnormal">b</span><span class="mclose">]</span></span></span></span></span>, 预测矩阵为:</p>
<p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>Y</mi><mo>^</mo></mover><mo>=</mo><mi>W</mi><mo>⋅</mo><mi>X</mi><mo>+</mo><mi>B</mi><mo>=</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>w</mi><mo>+</mo><mi>b</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mn>2</mn><mi>w</mi><mo>+</mo><mi>b</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mn>3</mn><mi>w</mi><mo>+</mo><mi>b</mi></mrow></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">\hat{Y} = W \cdot X + B = \begin{bmatrix}
w + b \\
2w + b \\
3w + b
\end{bmatrix}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9468em;"/><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9468em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span></span><span style="top:-3.2523em;"><span class="pstrut" style="height:3em;"/><span class="accent-body" style="left:-0.25em;"><span class="mord">^</span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"/><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:3.6em;vertical-align:-1.55em;"/><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:5.6em;"/><span style="width:0.667em;height:3.600em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.667em" height="3.600em" viewbox="0 0 667 3600"><path d="M403 1759 V84 H666 V0 H319 V1759 v0 v1759 h347 v-84&#10;H403z M403 1759 V0 H319 V1759 v0 v1759 h84z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span/></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord mathnormal">b</span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">2</span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord mathnormal">b</span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">3</span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord mathnormal">b</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span/></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:5.6em;"/><span style="width:0.667em;height:3.600em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.667em" height="3.600em" viewbox="0 0 667 3600"><path d="M347 1759 V0 H0 V84 H263 V1759 v0 v1759 H0 v84 H347z&#10;M347 1759 V0 H263 V1759 v0 v1759 h84z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span/></span></span></span></span></span></span></span></span></span></span></p>
<p>实际矩阵为:</p>
<p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Y</mi><mo>=</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>5</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>3</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>4</mn></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">Y = \begin{bmatrix}
5 \\
3 \\
4
\end{bmatrix}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:3.6em;vertical-align:-1.55em;"/><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:5.6em;"/><span style="width:0.667em;height:3.600em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.667em" height="3.600em" viewbox="0 0 667 3600"><path d="M403 1759 V84 H666 V0 H319 V1759 v0 v1759 h347 v-84&#10;H403z M403 1759 V0 H319 V1759 v0 v1759 h84z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span/></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">5</span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">3</span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">4</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span/></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:5.6em;"/><span style="width:0.667em;height:3.600em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.667em" height="3.600em" viewbox="0 0 667 3600"><path d="M347 1759 V0 H0 V84 H263 V1759 v0 v1759 H0 v84 H347z&#10;M347 1759 V0 H263 V1759 v0 v1759 h84z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span/></span></span></span></span></span></span></span></span></span></span></p>
<p>于是残差矩阵变为</p>
<p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><mo>=</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mn>5</mn><mo>−</mo><mo stretchy="false">(</mo><mi>w</mi><mo>+</mo><mi>b</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mn>3</mn><mo>−</mo><mo stretchy="false">(</mo><mn>2</mn><mi>w</mi><mo>+</mo><mi>b</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mn>4</mn><mo>−</mo><mo stretchy="false">(</mo><mn>3</mn><mi>w</mi><mo>+</mo><mi>b</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">E = \begin{bmatrix}
5 - (w + b) \\
3 - (2w + b) \\
4 - (3w + b)
\end{bmatrix}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:3.6em;vertical-align:-1.55em;"/><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:5.6em;"/><span style="width:0.667em;height:3.600em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.667em" height="3.600em" viewbox="0 0 667 3600"><path d="M403 1759 V84 H666 V0 H319 V1759 v0 v1759 h347 v-84&#10;H403z M403 1759 V0 H319 V1759 v0 v1759 h84z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span/></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">5</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord mathnormal">b</span><span class="mclose">)</span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">3</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mopen">(</span><span class="mord">2</span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord mathnormal">b</span><span class="mclose">)</span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">4</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mopen">(</span><span class="mord">3</span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord mathnormal">b</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span/></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:5.6em;"/><span style="width:0.667em;height:3.600em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.667em" height="3.600em" viewbox="0 0 667 3600"><path d="M347 1759 V0 H0 V84 H263 V1759 v0 v1759 H0 v84 H347z&#10;M347 1759 V0 H263 V1759 v0 v1759 h84z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span/></span></span></span></span></span></span></span></span></span></span></p>
<p>损失矩阵变为</p>
<p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi><mo>=</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo stretchy="false">(</mo><mn>5</mn><mo>−</mo><mo stretchy="false">(</mo><mi>w</mi><mo>+</mo><mi>b</mi><mo stretchy="false">)</mo><msup><mo stretchy="false">)</mo><mn>2</mn></msup></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo stretchy="false">(</mo><mn>3</mn><mo>−</mo><mo stretchy="false">(</mo><mn>2</mn><mi>w</mi><mo>+</mo><mi>b</mi><mo stretchy="false">)</mo><msup><mo stretchy="false">)</mo><mn>2</mn></msup></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo stretchy="false">(</mo><mn>4</mn><mo>−</mo><mo stretchy="false">(</mo><mn>3</mn><mi>w</mi><mo>+</mo><mi>b</mi><mo stretchy="false">)</mo><msup><mo stretchy="false">)</mo><mn>2</mn></msup></mrow></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">L = \begin{bmatrix}
(5 - (w + b))^2 \\
(3 - (2w + b))^2 \\
(4 - (3w + b))^2
\end{bmatrix}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal">L</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:3.6em;vertical-align:-1.55em;"/><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:5.6em;"/><span style="width:0.667em;height:3.600em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.667em" height="3.600em" viewbox="0 0 667 3600"><path d="M403 1759 V84 H666 V0 H319 V1759 v0 v1759 h347 v-84&#10;H403z M403 1759 V0 H319 V1759 v0 v1759 h84z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span/></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mopen">(</span><span class="mord">5</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord mathnormal">b</span><span class="mclose">)</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mopen">(</span><span class="mord">3</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mopen">(</span><span class="mord">2</span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord mathnormal">b</span><span class="mclose">)</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mopen">(</span><span class="mord">4</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mopen">(</span><span class="mord">3</span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord mathnormal">b</span><span class="mclose">)</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span/></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:5.6em;"/><span style="width:0.667em;height:3.600em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.667em" height="3.600em" viewbox="0 0 667 3600"><path d="M347 1759 V0 H0 V84 H263 V1759 v0 v1759 H0 v84 H347z&#10;M347 1759 V0 H263 V1759 v0 v1759 h84z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span/></span></span></span></span></span></span></span></span></span></span></p>
<p>总损失（均方误差）为所有样本损失的平均值:</p>
<p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>L</mi><mrow><mi>t</mi><mi>o</mi><mi>t</mi><mi>a</mi><mi>l</mi></mrow></msub><mtext>​</mtext><mo>=</mo><mfrac><mn>1</mn><mn>3</mn></mfrac><mtext>​</mtext><msubsup><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mn>3</mn></msubsup><mo stretchy="false">(</mo><msub><mi>y</mi><mi>i</mi></msub><mo>−</mo><mover accent="true"><msub><mi>y</mi><mi>i</mi></msub><mo>^</mo></mover><msup><mo stretchy="false">)</mo><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">L_{total} ​= \frac{1}{3}​\sum_{i=1}^3(y_i - \hat{y_i})^2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">o</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mord">​</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.299em;vertical-align:-0.345em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8451em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mord">​</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.954em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2997em;"><span/></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1.0641em;vertical-align:-0.25em;"/><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6944em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="accent-body" style="left:-0.25em;"><span class="mord">^</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1944em;"><span/></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span></p>
<p>现在, 我们需要计算总损失对两个参数 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>w</mi></mrow><annotation encoding="application/x-tex">w</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal" style="margin-right:0.02691em;">w</span></span></span></span></span> 和 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi></mrow><annotation encoding="application/x-tex">b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal">b</span></span></span></span></span> 的偏导数:</p>
<p>对于 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>w</mi></mrow><annotation encoding="application/x-tex">w</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal" style="margin-right:0.02691em;">w</span></span></span></span></span> 的偏导数 (每个样本):</p>
<p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mrow><mi mathvariant="normal">∂</mi><mi>L</mi></mrow><mrow><mi mathvariant="normal">∂</mi><mi>w</mi></mrow></mfrac><mo>=</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mn>2</mn><mo stretchy="false">(</mo><mn>5</mn><mo>−</mo><mi>w</mi><mo>−</mo><mi>b</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mn>4</mn><mo stretchy="false">(</mo><mn>3</mn><mo>−</mo><mn>2</mn><mi>w</mi><mo>−</mo><mi>b</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mn>6</mn><mo stretchy="false">(</mo><mn>4</mn><mo>−</mo><mn>3</mn><mi>w</mi><mo>−</mo><mi>b</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">\frac{\partial L}{\partial w} = \begin{bmatrix} -2(5-w-b) \\ -4(3-2w-b) \\ -6(4-3w-b)
\end{bmatrix}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2251em;vertical-align:-0.345em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8801em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal mtight" style="margin-right:0.02691em;">w</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal mtight">L</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:3.6em;vertical-align:-1.55em;"/><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:5.6em;"/><span style="width:0.667em;height:3.600em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.667em" height="3.600em" viewbox="0 0 667 3600"><path d="M403 1759 V84 H666 V0 H319 V1759 v0 v1759 h347 v-84&#10;H403z M403 1759 V0 H319 V1759 v0 v1759 h84z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span/></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">−</span><span class="mord">2</span><span class="mopen">(</span><span class="mord">5</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord mathnormal">b</span><span class="mclose">)</span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">−</span><span class="mord">4</span><span class="mopen">(</span><span class="mord">3</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord">2</span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord mathnormal">b</span><span class="mclose">)</span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">−</span><span class="mord">6</span><span class="mopen">(</span><span class="mord">4</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord">3</span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord mathnormal">b</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span/></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:5.6em;"/><span style="width:0.667em;height:3.600em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.667em" height="3.600em" viewbox="0 0 667 3600"><path d="M347 1759 V0 H0 V84 H263 V1759 v0 v1759 H0 v84 H347z&#10;M347 1759 V0 H263 V1759 v0 v1759 h84z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span/></span></span></span></span></span></span></span></span></span></span></p>
<p>对于 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi></mrow><annotation encoding="application/x-tex">b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal">b</span></span></span></span></span> 的偏导数 (每个样本):</p>
<p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mrow><mi mathvariant="normal">∂</mi><mi>L</mi></mrow><mrow><mi mathvariant="normal">∂</mi><mi>b</mi></mrow></mfrac><mo>=</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mn>2</mn><mo stretchy="false">(</mo><mn>5</mn><mo>−</mo><mi>w</mi><mo>−</mo><mi>b</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mn>2</mn><mo stretchy="false">(</mo><mn>3</mn><mo>−</mo><mn>2</mn><mi>w</mi><mo>−</mo><mi>b</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mn>2</mn><mo stretchy="false">(</mo><mn>4</mn><mo>−</mo><mn>3</mn><mi>w</mi><mo>−</mo><mi>b</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">\frac{\partial L}{\partial b} = \begin{bmatrix} -2(5-w-b) \\ -2(3-2w-b) \\ -2(4-3w-b)
\end{bmatrix}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2251em;vertical-align:-0.345em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8801em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal mtight">b</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal mtight">L</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:3.6em;vertical-align:-1.55em;"/><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:5.6em;"/><span style="width:0.667em;height:3.600em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.667em" height="3.600em" viewbox="0 0 667 3600"><path d="M403 1759 V84 H666 V0 H319 V1759 v0 v1759 h347 v-84&#10;H403z M403 1759 V0 H319 V1759 v0 v1759 h84z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span/></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">−</span><span class="mord">2</span><span class="mopen">(</span><span class="mord">5</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord mathnormal">b</span><span class="mclose">)</span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">−</span><span class="mord">2</span><span class="mopen">(</span><span class="mord">3</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord">2</span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord mathnormal">b</span><span class="mclose">)</span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">−</span><span class="mord">2</span><span class="mopen">(</span><span class="mord">4</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord">3</span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord mathnormal">b</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span/></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:5.6em;"/><span style="width:0.667em;height:3.600em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.667em" height="3.600em" viewbox="0 0 667 3600"><path d="M347 1759 V0 H0 V84 H263 V1759 v0 v1759 H0 v84 H347z&#10;M347 1759 V0 H263 V1759 v0 v1759 h84z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span/></span></span></span></span></span></span></span></span></span></span></p>
<p><strong>注意</strong>: 这里每个矩阵表示的是每个样本的损失对参数的偏导数, 而不是总损失的偏导数. 为了得到总损失的偏导数, 我们需要对这些矩阵按列求平均 (因为总损失是每个样本损失的平均值)</p>
<p>总损失对 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>w</mi></mrow><annotation encoding="application/x-tex">w</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal" style="margin-right:0.02691em;">w</span></span></span></span></span> 的偏导数为:</p>
<p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mrow><mi mathvariant="normal">∂</mi><msub><mi>L</mi><mrow><mi>t</mi><mi>o</mi><mi>t</mi><mi>a</mi><mi>l</mi></mrow></msub></mrow><mrow><mi mathvariant="normal">∂</mi><mi>w</mi></mrow></mfrac><mo>=</mo><mfrac><mn>1</mn><mn>3</mn></mfrac><msubsup><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mn>3</mn></msubsup><mfrac><mrow><mi mathvariant="normal">∂</mi><mi>L</mi></mrow><mrow><mi mathvariant="normal">∂</mi><mi>w</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">\frac{\partial L_{total}}{\partial w} = \frac{1}{3}\sum_{i=1}^3 \frac{\partial L}{\partial w}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.247em;vertical-align:-0.345em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.902em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal mtight" style="margin-right:0.02691em;">w</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.4159em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right:0.05556em;">∂</span><span class="mord mtight"><span class="mord mathnormal mtight">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3488em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">o</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1512em;"><span/></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.299em;vertical-align:-0.345em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8451em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mspace" style="margin-right:0.1667em;"/><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.954em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2997em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8801em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal mtight" style="margin-right:0.02691em;">w</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal mtight">L</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span></span></span></span></span></p>
<p>总损失对 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi></mrow><annotation encoding="application/x-tex">b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal">b</span></span></span></span></span> 的偏导数为:</p>
<p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mrow><mi mathvariant="normal">∂</mi><msub><mi>L</mi><mrow><mi>t</mi><mi>o</mi><mi>t</mi><mi>a</mi><mi>l</mi></mrow></msub></mrow><mrow><mi mathvariant="normal">∂</mi><mi>b</mi></mrow></mfrac><mo>=</mo><mfrac><mn>1</mn><mn>3</mn></mfrac><msubsup><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mn>3</mn></msubsup><mfrac><mrow><mi mathvariant="normal">∂</mi><mi>L</mi></mrow><mrow><mi mathvariant="normal">∂</mi><mi>b</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">\frac{\partial L_{total}}{\partial b} = \frac{1}{3}\sum_{i=1}^3 \frac{\partial L}{\partial b}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.247em;vertical-align:-0.345em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.902em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal mtight">b</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.4159em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right:0.05556em;">∂</span><span class="mord mtight"><span class="mord mathnormal mtight">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3488em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">o</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1512em;"><span/></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.299em;vertical-align:-0.345em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8451em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mspace" style="margin-right:0.1667em;"/><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.954em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2997em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8801em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal mtight">b</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal mtight">L</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span></span></span></span></span></p>
<p>于是我们就得到了正确的梯度向量:</p>
<p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">∇</mi><msub><mi>L</mi><mrow><mi>t</mi><mi>o</mi><mi>t</mi><mi>a</mi><mi>l</mi></mrow></msub><mo>=</mo><msup><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mfrac><mrow><mi mathvariant="normal">∂</mi><msub><mi>L</mi><mrow><mi>t</mi><mi>o</mi><mi>t</mi><mi>a</mi><mi>l</mi></mrow></msub></mrow><mrow><mi mathvariant="normal">∂</mi><mi>w</mi></mrow></mfrac><mo separator="true">,</mo><mfrac><mrow><mi mathvariant="normal">∂</mi><msub><mi>L</mi><mrow><mi>t</mi><mi>o</mi><mi>t</mi><mi>a</mi><mi>l</mi></mrow></msub></mrow><mrow><mi mathvariant="normal">∂</mi><mi>b</mi></mrow></mfrac></mrow></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mi>T</mi></msup></mrow><annotation encoding="application/x-tex">\nabla L_{total} = \begin{bmatrix}
\frac{\partial L_{total}}{\partial w},
\frac{\partial L_{total}}{\partial b}
\end{bmatrix}^T</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"/><span class="mord">∇</span><span class="mord"><span class="mord mathnormal">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">o</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.4932em;vertical-align:-0.381em;"/><span class="minner"><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.881em;"><span style="top:-2.979em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.902em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal mtight" style="margin-right:0.02691em;">w</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.4159em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right:0.05556em;">∂</span><span class="mord mtight"><span class="mord mathnormal mtight">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3488em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">o</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1512em;"><span/></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.902em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal mtight">b</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.4159em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right:0.05556em;">∂</span><span class="mord mtight"><span class="mord mathnormal mtight">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3488em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">o</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1512em;"><span/></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.381em;"><span/></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">]</span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:1.1122em;"><span style="top:-3.3339em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span></span></span></span></span></p>
<p>模式更新参数时, 就可以按照这个梯度向量进行梯度下降:</p>
<ul>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>w</mi><mtext>new</mtext></msub><mo>=</mo><msub><mi>w</mi><mtext>old</mtext></msub><mo>−</mo><mi>η</mi><mo>⋅</mo><mfrac><mrow><mi mathvariant="normal">∂</mi><msub><mi>L</mi><mtext>total</mtext></msub></mrow><mrow><mi mathvariant="normal">∂</mi><mi>w</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">w_{\text{new}} = w_{\text{old}} - \eta \cdot \frac{\partial L_{\text{total}}}{\partial w}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">new</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.7333em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">old</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6389em;vertical-align:-0.1944em;"/><span class="mord mathnormal" style="margin-right:0.03588em;">η</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1.247em;vertical-align:-0.345em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.902em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal mtight" style="margin-right:0.02691em;">w</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.4159em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right:0.05556em;">∂</span><span class="mord mtight"><span class="mord mathnormal mtight">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3488em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">total</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1512em;"><span/></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span></span></span></span></span></li>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>b</mi><mtext>new</mtext></msub><mo>=</mo><msub><mi>b</mi><mtext>old</mtext></msub><mo>−</mo><mi>η</mi><mo>⋅</mo><mfrac><mrow><mi mathvariant="normal">∂</mi><msub><mi>L</mi><mtext>total</mtext></msub></mrow><mrow><mi mathvariant="normal">∂</mi><mi>b</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">b_{\text{new}} = b_{\text{old}} - \eta \cdot \frac{\partial L_{\text{total}}}{\partial b}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">new</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">old</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6389em;vertical-align:-0.1944em;"/><span class="mord mathnormal" style="margin-right:0.03588em;">η</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1.247em;vertical-align:-0.345em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.902em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal mtight">b</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.4159em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right:0.05556em;">∂</span><span class="mord mtight"><span class="mord mathnormal mtight">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3488em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">total</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1512em;"><span/></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span></span></span></span></span></li>
</ul>
<p>其中 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>η</mi></mrow><annotation encoding="application/x-tex">\eta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"/><span class="mord mathnormal" style="margin-right:0.03588em;">η</span></span></span></span></span> 是学习率. 通过这种方式, 模型能够同时利用所有样本的信息来调整参数, 使总损失最小化.</p>
<h2 data-id="heading-10">总结</h2>
<p>本文我们介绍了残差, 损失, 导数, 偏导, 梯度, 残差矩阵, 损失矩阵和偏导矩阵 8 个数学概念.</p>
<p>8 个概念作用可以归纳为:</p>
<ol>
<li><strong>感知误差</strong>, 让 AI 知道自己预测得有没有错误, 相关概念有残差, 损失, 残差矩阵和损失矩阵;</li>
<li><strong>减少误差</strong>, 让 AI 知道自己怎么调整才可以减少误差, 相关概念有导数, 偏导, 梯度和偏导矩阵</li>
</ol>
<p>下次你再看到 "AI 训练", "模型优化" 这类术语时, 你就不再是看热闹的外行人, 而是能看懂底层逻辑的懂行人啦.</p>
<p>我是印刻君，一位探索 AI 的前端程序员，关注我，让 AI 知识有温度，技术落地有深度.</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[WhoDB：轻量级数据库管理的革命，用自然语言对话你的数]]></title>    <link>https://juejin.cn/post/7595960824486920226</link>    <guid>https://juejin.cn/post/7595960824486920226</guid>    <pubDate>2026-01-19T00:28:47.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595960824486920226" data-draft-id="7538085784290033699" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="WhoDB：轻量级数据库管理的革命，用自然语言对话你的数"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-19T00:28:47.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="YL_jia"/> <meta itemprop="url" content="https://juejin.cn/user/1467226241383211"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            WhoDB：轻量级数据库管理的革命，用自然语言对话你的数
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1467226241383211/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    YL_jia
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-19T00:28:47.000Z" title="Mon Jan 19 2026 00:28:47 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-19
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">WhoDB：轻量级数据库管理的革命，用自然语言对话你的数据</h2>
<blockquote>
<p><strong>“在AI重构一切的时代，连数据库管理都开始说人话了”</strong>——一位从Navicat转投WhoDB的CTO如此感慨</p>
</blockquote>
<p>在数据驱动的现代应用中，数据库管理员和开发者们长期面临着一个两难困境：<strong>专业工具功能强大但学习曲线陡峭</strong>，而轻量级工具又常<strong>牺牲关键功能</strong>。当团队在phpMyAdmin的简陋界面与DBeaver的复杂配置间反复横跳时，一款仅20MB的工具——WhoDB正以<strong>自然语言交互</strong>和<strong>零配置可视化</strong>能力重塑数据库管理体验。本文将带你深入探索这一颠覆性工具的技术内核与落地实践。</p>
<hr/>
<h3 data-id="heading-1">一、核心价值解析：为什么WhoDB让传统工具黯然失色？</h3>
<h4 data-id="heading-2">1. 自然语言交互：告别SQL的认知负荷</h4>
<p>WhoDB的革命性在于其<strong>内置AI代理引擎</strong>，支持与Ollama、ChatGPT、Anthropic等模型集成。用户只需输入：</p>
<blockquote>
<p>“显示最近7天订单量超过100的用户名单，按消费总额降序排列”
系统自动转换为精准SQL并执行，结果以表格和图表双模式呈现。这种<strong>对话式数据探索</strong>使非技术成员也能深度参与数据分析，将团队协作效率提升300%。</p>
</blockquote>
<h4 data-id="heading-3">2. 轻量架构背后的高性能引擎</h4>
<p>采用GoLang构建的WhoDB，在资源占用与执行效率上实现惊人平衡：</p>
<ul>
<li><strong>内存占用</strong>：常驻内存&lt;50MB，仅为DBeaver的1/10</li>
<li><strong>响应速度</strong>：千万级数据表打开速度&lt;3秒，依赖<strong>前端虚拟化技术</strong>动态加载</li>
<li><strong>冷启动时间</strong>：Docker容器启动仅需0.8秒，秒级响应用户操作</li>
</ul>
<h4 data-id="heading-4">3. 多模态数据操作界面</h4>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    A[WhoDB主界面] --&gt; B[表格视图]
    A --&gt; C[SQL笔记本]
    A --&gt; D[模式关系图]
    A --&gt; E[自然语言控制台]
</code></pre>
<ul>
<li><strong>表格视图</strong>：支持Excel式内联编辑，实时提交变更</li>
<li><strong>SQL笔记本</strong>：类Jupyter的交互环境，可保存查询历史与结果快照</li>
<li><strong>模式关系图</strong>：自动生成ER图，拖拽即可调整表关联</li>
</ul>
<hr/>
<h3 data-id="heading-5">二、安装部署实战：5分钟打造企业级数据控制台</h3>
<h4 data-id="heading-6">1. 最小化Docker部署（推荐方案）</h4>
<p><strong>适用场景</strong>：快速验证/中小团队生产环境</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 创建数据持久化目录</span>
<span class="hljs-built_in">mkdir</span> -p /data/whodb &amp;&amp; <span class="hljs-built_in">cd</span> /data/whodb

<span class="hljs-comment"># 编写docker-compose.yml</span>
<span class="hljs-built_in">cat</span> &gt; docker-compose.yml &lt;&lt;<span class="hljs-string">EOF
version: "3.8"
services:
  whodb:
    image: clidey/whodb:0.53.0
    ports:
      - "8080:8080"
    volumes:
      - ./mysql_data:/var/lib/mysql  # MySQL数据持久化
    environment:
      WHODB_DEFAULT_DB: "mysql://root:pass@localhost:3306" # 预配置连接
EOF</span>

<span class="hljs-comment"># 启动服务</span>
docker compose up -d
</code></pre>
<p>访问 <code>http://&lt;服务器IP&gt;:8080</code> 即可进入控制台</p>
<h4 data-id="heading-7">2. 企业高可用方案</h4>
<p><strong>架构拓扑</strong>：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph LR
    A[HAProxy] --&gt; B[WhoDB实例1]
    A --&gt; C[WhoDB实例2]
    A --&gt; D[WhoDB实例3]
    B --&gt; E[MySQL集群]
    C --&gt; E
    D --&gt; E
</code></pre>
<p><strong>关键配置</strong>：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># 企业级docker-compose.yml片段</span>
<span class="hljs-attr">environment:</span>
  <span class="hljs-attr">WHODB_SESSION_STORE:</span> <span class="hljs-string">"redis://redis:6379"</span> <span class="hljs-comment"># 会话共享</span>
  <span class="hljs-attr">WHODB_OLLAMA_HOST:</span> <span class="hljs-string">"ollama-cluster"</span>        <span class="hljs-comment"># AI服务集群</span>
<span class="hljs-attr">volumes:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">/mnt/ssd/config:/app/config</span>             <span class="hljs-comment"># 配置热更新</span>
</code></pre>
<h4 data-id="heading-8">3. 深度集成Ollama实现智能分析</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 创建共享网络</span>
docker network create ai-net

<span class="hljs-comment"># 启动Ollama容器</span>
docker run -d --name ollama --network ai-net ollama/ollama

<span class="hljs-comment"># 启动WhoDB并连接AI</span>
docker run -d --name whodb --network ai-net \
  -e WHODB_OLLAMA_HOST=ollama \
  -e WHODB_OLLAMA_PORT=11434 \
  -p 8080:8080 \
  whodb/whodb
</code></pre>
<p><strong>验证连接</strong>：在WhoDB界面输入“解释当前销售趋势”，获得图文分析报告</p>
<hr/>
<h3 data-id="heading-9">三、企业实战案例：从数据仓库到决策大脑的进化</h3>
<h4 data-id="heading-10">案例1：互联网金融实时风控看板</h4>
<p><strong>挑战</strong>：某网贷平台需在5分钟内响应可疑交易，但SQL编写耗时占分析流程70%。</p>
<p><strong>WhoDB方案</strong>：</p>
<ol>
<li><strong>自然语言警报</strong>：
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 风控规则逻辑</span>
when detect_risk_transaction():
   send_alert(<span class="hljs-string">"最近1小时同一IP发起超20次借款申请的用户列表"</span>)
</code></pre>
</li>
<li><strong>实时看板构建</strong>：
<ul>
<li>集成Prometheus指标与MySQL交易数据</li>
<li>创建动态仪表盘：“显示今日各省份欺诈率TOP5”<br/>
<strong>成效</strong>：威胁响应速度从15分钟→<strong>45秒</strong>，误报率下降60%</li>
</ul>
</li>
</ol>
<h4 data-id="heading-11">案例2：制造业全球供应链可视化</h4>
<p><strong>挑战</strong>：某汽车零件商需整合全球8个工厂的库存数据，传统工具无法跨时区协作。</p>
<p><strong>WhoDB实施</strong>：</p>
<ol>
<li><strong>多源联邦查询</strong>：
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- WhoDB自动生成的跨库查询</span>
<span class="hljs-keyword">SELECT</span> cn.warehouse, eu.stock_qty 
<span class="hljs-keyword">FROM</span> china_inventory <span class="hljs-keyword">AS</span> cn
<span class="hljs-keyword">JOIN</span> europe_inventory <span class="hljs-keyword">AS</span> eu <span class="hljs-keyword">ON</span> cn.part_id <span class="hljs-operator">=</span> eu.component_id
<span class="hljs-keyword">WHERE</span> cn.last_update <span class="hljs-operator">&gt;</span> NOW() <span class="hljs-operator">-</span> <span class="hljs-type">INTERVAL</span> <span class="hljs-number">2</span> <span class="hljs-keyword">HOUR</span>
</code></pre>
</li>
<li><strong>多语言支持</strong>：<br/>
德国工程师输入德语：“Zeige Lagerbestand der Bremssättel”，<br/>
自动转换为英语查询并返回结果<br/>
<strong>成效</strong>：跨工厂库存盘点时间从3天→<strong>2小时</strong>，呆滞库存减少¥230万/年</li>
</ol>
<hr/>
<h3 data-id="heading-12">四、高阶技巧：解锁专业用户的效能密码</h3>
<h4 data-id="heading-13">1. 智能索引优化</h4>
<p>输入：“为什么订单查询变慢？”<br/>
WhoDB执行：</p>
<ol>
<li>自动解析慢查询日志</li>
<li>可视化扫描缺失索引</li>
<li>生成优化建议：
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> INDEX idx_order_user <span class="hljs-keyword">ON</span> orders(user_id, status);
<span class="hljs-comment">-- 预计提升87%查询速度</span>
</code></pre>
</li>
</ol>
<h4 data-id="heading-14">2. 数据血缘追踪</h4>
<p>在SQL笔记本中执行：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- [[依赖追踪标记]]</span>
<span class="hljs-keyword">WITH</span> user_orders <span class="hljs-keyword">AS</span> (
  <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> orders <span class="hljs-keyword">WHERE</span> user_id <span class="hljs-keyword">IN</span> (
    <span class="hljs-keyword">SELECT</span> id <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> reg_date <span class="hljs-operator">&gt;</span> <span class="hljs-string">'2025-01-01'</span>
  )
)
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> user_orders
</code></pre>
<p>点击“血缘图谱”按钮，自动生成字段级溯源视图</p>
<h4 data-id="heading-15">3. 安全合规双保险</h4>
<p><strong>策略</strong>：</p>
<ul>
<li><strong>动态脱敏</strong>：设置规则“手机号仅显示后4位”</li>
<li><strong>审计追踪</strong>：所有自然语言查询自动转换为SQL归档<br/>
<strong>配置YAML</strong>：</li>
</ul>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">security:</span>
  <span class="hljs-attr">data_masking:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">table:</span> <span class="hljs-string">users</span>
      <span class="hljs-attr">column:</span> <span class="hljs-string">phone</span>
      <span class="hljs-attr">mask:</span> <span class="hljs-string">"regex_replace: /(\\d{3})\\d{4}(\\d{4})/ $1****$2"</span>
  <span class="hljs-attr">audit_log:</span>
    <span class="hljs-attr">path:</span> <span class="hljs-string">/var/log/whodb_audit.log</span>
    <span class="hljs-attr">retention_days:</span> <span class="hljs-number">365</span>
</code></pre>
<hr/>
<h3 data-id="heading-16">五、与传统工具的终极对决</h3>















































<table><thead><tr><th><strong>能力维度</strong></th><th><strong>WhoDB</strong></th><th><strong>Adminer</strong></th><th><strong>DBeaver</strong></th></tr></thead><tbody><tr><td>自然语言查询</td><td>✅ 原生集成</td><td>❌ 不支持</td><td>❌ 需插件</td></tr><tr><td>学习曲线</td><td>⭐（非技术人员可上手）</td><td>⭐⭐⭐（需SQL基础）</td><td>⭐⭐⭐⭐（专业级）</td></tr><tr><td>数据可视化</td><td>内置图表+ER图</td><td>仅表格</td><td>需安装扩展</td></tr><tr><td>部署复杂度</td><td>单文件Docker即运行</td><td>PHP环境依赖</td><td>JVM依赖+配置复杂</td></tr><tr><td>多数据库支持</td><td>7种主流DB</td><td>6种</td><td>支持80+种</td></tr><tr><td>企业级高可用</td><td>✅ 会话共享+负载均衡</td><td>❌</td><td>✅</td></tr></tbody></table>
<blockquote>
<p><strong>结论</strong>：WhoDB在<strong>敏捷性</strong>和<strong>智能化</strong>上完胜，传统工具在<strong>超异构环境</strong>支持上仍有优势</p>
</blockquote>
<hr/>
<h3 data-id="heading-17">六、未来演进：WhoDB的技术路线图</h3>
<p>根据核心开发者访谈，2025-2026关键方向：</p>
<ol>
<li><strong>AI代理协作框架</strong>：
<pre><code class="hljs language-rust" lang="rust">sequenceDiagram
   用户<span class="hljs-punctuation">-&gt;</span>&gt;+SQL代理： “预测下季度销售额”
   SQL代理<span class="hljs-punctuation">-&gt;</span>&gt;+Python代理： 调用Prophet模型
   Python代理<span class="hljs-punctuation">-&gt;</span>&gt;+数据代理： 获取近<span class="hljs-number">5</span>年销售数据
   数据代理-<span class="hljs-punctuation">-&gt;</span>&gt;-用户： 返回预测图表
</code></pre>
</li>
<li><strong>向量数据库集成</strong>：支持Milvus/Pinecone，实现自然语言+向量联合查询</li>
<li><strong>区块链审计</strong>：所有数据变更上链存证，满足金融级合规需求</li>
</ol>
<hr/>
<h3 data-id="heading-18">结语：工具的本质是延伸人类能力</h3>
<p>WhoDB的成功不在于取代SQL，而在于<strong>拆除技术与非技术成员间的认知高墙</strong>。当产品经理能直接查询转化率，当运维人员用自然语言诊断慢查询，数据才能真正成为组织的血脉。</p>
<blockquote>
<p><strong>实践箴言</strong>：</p>
<ol>
<li><strong>从小场景切入</strong>：从“销售日报自动生成”开始培养团队习惯</li>
<li><strong>安全左移</strong>：初始阶段即配置审计与脱敏规则</li>
<li><strong>拥抱混合管理</strong>：复杂ETL仍用SQL，即席查询交给自然语言</li>
</ol>
</blockquote>
<p>正如某电商数据总监所言：<em>“WhoDB最震撼的不是技术，而是终于让业务方停止了‘帮我跑个数’的轰炸”</em>。</p>
<p><strong>项目地址</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fclidey%2Fwhodb" target="_blank" title="https://github.com/clidey/whodb" ref="nofollow noopener noreferrer">github.com/clidey/whod…</a><br/>
<strong>中文文档</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwhodb.com%2Fdocs-zh" target="_blank" title="https://whodb.com/docs-zh" ref="nofollow noopener noreferrer">whodb.com/docs-zh</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[React从入门到出门第十章 Fiber 架构升级与调度系统优化]]></title>    <link>https://juejin.cn/post/7596186565270929423</link>    <guid>https://juejin.cn/post/7596186565270929423</guid>    <pubDate>2026-01-19T00:43:19.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7596186565270929423" data-draft-id="7590309337861455913" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="React从入门到出门第十章 Fiber 架构升级与调度系统优化"/> <meta itemprop="keywords" content="JavaScript,React.js,前端框架"/> <meta itemprop="datePublished" content="2026-01-19T00:43:19.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="怕浪猫"/> <meta itemprop="url" content="https://juejin.cn/user/2832784963939438"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            React从入门到出门第十章 Fiber 架构升级与调度系统优化
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2832784963939438/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    怕浪猫
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-19T00:43:19.000Z" title="Mon Jan 19 2026 00:43:19 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-19
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读16分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/67fdd67e844b44bd9cbb5e7c84337d1d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oCV5rWq54yr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769388199&amp;x-signature=yOoJMsBT4pifGm%2FnPIwx9gihrgI%3D" alt="image.jpg" loading="lazy"/>
大家好～ 相信很多 React 开发者都有过这样的困惑：为什么我的组件明明只改了一个状态，却感觉页面卡顿？为什么有时候异步更新的顺序和预期不一样？其实这些问题的根源，都和 React 的底层架构——Fiber，以及它的调度系统密切相关。</p>
<p>从 React 16 引入 Fiber 架构至今，它经历了多次迭代优化，而 React 19 更是在 Fiber 架构和调度系统上做了不少关键升级，进一步提升了应用的流畅度和性能。今天这篇文章，我们就用“浅显易懂的语言+丰富的案例+直观的图例”，把 React 19 的 Fiber 架构和调度系统讲透：从 Fiber 解决的核心问题，到它的升级点，再到调度系统如何智能分配任务，让你不仅知其然，更知其所以然～</p>
<h2 data-id="heading-0">一、先搞懂：为什么需要 Fiber 架构？</h2>
<p>在聊 React 19 的升级之前，我们得先明白：Fiber 架构是为了解决什么问题而诞生的？这就要从 React 15 及之前的 Stack Reconciliation（栈协调）说起。</p>
<h3 data-id="heading-1">1. 旧架构的痛点：不可中断的“长任务”</h3>
<p>React 15 的栈协调机制，本质上是一个“递归递归过程”。当组件树需要更新时（比如状态变化、props 改变），React 会从根组件开始，递归遍历整个组件树，进行“虚拟 DOM 对比”（Reconciliation）和“DOM 操作”。这个过程有个致命问题：<strong>一旦开始，就无法中断</strong>。</p>
<p>浏览器的主线程是“单线程”，既要处理 JS 执行，也要处理 UI 渲染（重排、重绘）、用户交互（点击、输入）等任务。如果递归遍历的组件树很深、任务很重，这个“长任务”会占据主线程很长时间（比如几百毫秒），导致浏览器无法及时响应用户操作，出现页面卡顿、输入延迟等问题。</p>
<h3 data-id="heading-2">2. 案例：栈协调的卡顿问题</h3>
<p>假设我们有一个嵌套很深的组件树：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 嵌套很深的组件树</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> [count, setCount] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> setCount(count + 1)}&gt;
      <span class="hljs-tag">&lt;<span class="hljs-name">Level1</span> /&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Level2</span> /&gt;</span>
      {/* ... 嵌套 100 层 Level 组件 ... */}
      <span class="hljs-tag">&lt;<span class="hljs-name">Level100</span> /&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>计数：{count}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}
</code></pre>
<p>当我们点击页面修改 count 时，React 15 会递归遍历这 100 层组件，进行虚拟 DOM 对比。这个过程会占据主线程几十甚至几百毫秒，期间用户如果再点击、输入，浏览器完全无法响应，出现明显卡顿。</p>
<h3 data-id="heading-3">3. Fiber 的核心目标：让任务“可中断、可恢复”</h3>
<p>为了解决这个问题，React 16 引入了 Fiber 架构，核心目标是：<strong>将不可中断的递归遍历，拆分成可中断、可恢复的小任务</strong>。通过这种方式，React 可以在执行这些小任务的间隙，“还给”浏览器主线程时间，让浏览器有机会处理用户交互、UI 渲染等紧急任务，从而避免卡顿。</p>
<p>这就像我们平时工作：旧架构是“一口气做完一整套复杂工作，中间不休息”，容易累倒且无法响应突发情况；Fiber 架构是“把复杂工作拆成一个个小任务，做一个小任务就看看有没有紧急事，有就先处理紧急事，处理完再继续做剩下的小任务”，效率更高、更灵活。</p>
<h2 data-id="heading-4">二、React 19 Fiber 架构：核心升级点拆解</h2>
<p>Fiber 架构的核心是“Fiber 节点”和“双缓存机制”。React 19 在继承这一核心的基础上，做了三个关键升级：<strong>优化 Fiber 节点结构</strong>、<strong>增强任务优先级区分</strong>、<strong>优化双缓存切换效率</strong>。我们先从最基础的 Fiber 节点开始讲起。</p>
<h3 data-id="heading-5">1. 基础：Fiber 节点是什么？</h3>
<p>在 Fiber 架构中，每个组件都会对应一个“Fiber 节点”。Fiber 节点不仅存储了组件的类型、属性（props）、状态（state）等信息，更重要的是，它还存储了“任务调度相关的信息”，比如：</p>
<ul>
<li>当前任务的优先级；</li>
<li>下一个要处理的 Fiber 节点（用于链表遍历，替代递归）；</li>
<li>任务是否已完成、是否需要中断；</li>
<li>对应的 DOM 元素。</li>
</ul>
<p>可以把 Fiber 节点理解为“组件的任务说明书”，它让 React 不仅知道“这个组件是什么”，还知道“该怎么处理这个组件的更新任务”。</p>
<h3 data-id="heading-6">2. React 19 Fiber 节点结构优化（简化代码模拟）</h3>
<p>我们用简化的 JS 代码，模拟 React 19 中 Fiber 节点的核心结构（真实结构更复杂，这里只保留关键字段）：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// React 19 Fiber 节点结构（简化版）</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">FiberNode</span> {
  <span class="hljs-keyword">constructor</span>(type, props) {
    <span class="hljs-keyword">this</span>.type = type; <span class="hljs-comment">// 组件类型（如 'div'、FunctionComponent）</span>
    <span class="hljs-keyword">this</span>.props = props; <span class="hljs-comment">// 组件属性</span>
    <span class="hljs-keyword">this</span>.state = <span class="hljs-literal">null</span>; <span class="hljs-comment">// 组件状态</span>
    <span class="hljs-keyword">this</span>.dom = <span class="hljs-literal">null</span>; <span class="hljs-comment">// 对应的真实 DOM 元素</span>

    <span class="hljs-comment">// 调度相关字段（React 19 优化点）</span>
    <span class="hljs-keyword">this</span>.priority = <span class="hljs-number">0</span>; <span class="hljs-comment">// 任务优先级（1-5，数字越大优先级越高）</span>
    <span class="hljs-keyword">this</span>.deferredExpirationTime = <span class="hljs-literal">null</span>; <span class="hljs-comment">// 延迟过期时间（用于低优先级任务）</span>

    <span class="hljs-comment">// 链表结构相关字段（替代递归，实现可中断遍历）</span>
    <span class="hljs-keyword">this</span>.child = <span class="hljs-literal">null</span>; <span class="hljs-comment">// 第一个子 Fiber 节点</span>
    <span class="hljs-keyword">this</span>.sibling = <span class="hljs-literal">null</span>; <span class="hljs-comment">// 下一个兄弟 Fiber 节点</span>
    <span class="hljs-keyword">this</span>.<span class="hljs-keyword">return</span> = <span class="hljs-literal">null</span>; <span class="hljs-comment">// 父 Fiber 节点</span>

    <span class="hljs-comment">// 双缓存相关字段</span>
    <span class="hljs-keyword">this</span>.alternate = <span class="hljs-literal">null</span>; <span class="hljs-comment">// 对应的另一个 Fiber 树节点</span>
    <span class="hljs-keyword">this</span>.effectTag = <span class="hljs-literal">null</span>; <span class="hljs-comment">// 需要执行的 DOM 操作（如插入、更新、删除）</span>
  }
}
</code></pre>
<p>React 19 的核心优化点之一，就是<strong>精简了 Fiber 节点的冗余字段</strong>，同时<strong>增强了优先级相关字段的精度</strong>。比如新增的 <code>deferredExpirationTime</code> 字段，可以更精准地控制低优先级任务的执行时机，避免低优先级任务“饿死”（一直得不到执行）。</p>
<h3 data-id="heading-7">3. 核心：链表遍历替代递归（可中断的关键）</h3>
<p>React 15 用递归遍历组件树，而 React 19 基于 Fiber 节点的链表结构，用“循环遍历”替代了递归。这种遍历方式的核心是“从根节点开始，依次处理每个 Fiber 节点，处理完一个节点后，记录下一个要处理的节点，随时可以中断”。</p>
<p>我们用简化代码模拟这个遍历过程：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 模拟 React 19 Fiber 树遍历（循环遍历，可中断）</span>
function traverseFiberTree(rootFiber) {
  let currentFiber = rootFiber;

  <span class="hljs-comment">// 循环遍历，替代递归</span>
  <span class="hljs-keyword">while</span> (currentFiber !== <span class="hljs-literal">null</span>) {
    <span class="hljs-comment">// 1. 处理当前 Fiber 节点（比如虚拟 DOM 对比、计算需要的 DOM 操作）</span>
    processFiber(currentFiber);

    <span class="hljs-comment">// 2. 检查是否需要中断（比如有更高优先级任务进来）</span>
    <span class="hljs-keyword">if</span> (shouldYield()) {
      <span class="hljs-comment">// 记录当前进度，下次从这里继续</span>
      nextUnitOfWork = currentFiber;
      <span class="hljs-keyword">return</span>; <span class="hljs-comment">// 中断遍历</span>
    }

    <span class="hljs-comment">// 3. 确定下一个要处理的节点（链表遍历逻辑）</span>
    <span class="hljs-keyword">if</span> (currentFiber.child) {
      <span class="hljs-comment">// 有子节点，先处理子节点</span>
      currentFiber = currentFiber.child;
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (currentFiber.sibling) {
      <span class="hljs-comment">// 没有子节点，处理兄弟节点</span>
      currentFiber = currentFiber.sibling;
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-comment">// 既没有子节点也没有兄弟节点，回溯到父节点的兄弟节点</span>
      <span class="hljs-keyword">while</span> (currentFiber.<span class="hljs-keyword">return</span> &amp;&amp; !currentFiber.<span class="hljs-keyword">return</span>.sibling) {
        currentFiber = currentFiber.<span class="hljs-keyword">return</span>;
      }
      currentFiber = currentFiber.<span class="hljs-keyword">return</span> ? currentFiber.<span class="hljs-keyword">return</span>.sibling : <span class="hljs-literal">null</span>;
    }
  }

  <span class="hljs-comment">// 所有节点处理完毕，进入提交阶段（执行 DOM 操作）</span>
  commitRoot();
}
</code></pre>
<p>关键逻辑说明：</p>
<ul>
<li><code>processFiber</code>：处理当前节点的核心逻辑（虚拟 DOM 对比、标记 DOM 操作）；</li>
<li><code>shouldYield</code>：检查是否需要中断——React 会通过浏览器的 <code>requestIdleCallback</code> 或 <code>MessageChannel</code> API，判断主线程是否有空闲时间，或者是否有更高优先级任务进来；</li>
<li>链表遍历顺序：<strong>父 → 子 → 兄弟 → 回溯父节点的兄弟</strong>，确保遍历覆盖所有节点。</li>
</ul>
<h3 data-id="heading-8">4. 双缓存机制：提升渲染效率（React 19 优化点）</h3>
<p>Fiber 架构的另一个核心是“双缓存机制”，简单说就是：React 维护了两棵 Fiber 树——<strong>当前树（Current Tree）</strong> 和 <strong>工作树（WorkInProgress Tree）</strong> 。</p>
<ul>
<li><strong>当前树</strong>：对应当前页面渲染的 DOM 结构，存储着当前的组件状态和 DOM 信息；</li>
<li><strong>工作树</strong>：是 React 在后台构建的“备用树”，所有的更新任务（虚拟 DOM 对比、计算 DOM 操作）都在工作树上进行，不会影响当前页面的渲染。</li>
</ul>
<p>当工作树上的所有任务都处理完毕后，React 会快速“切换”两棵树的角色——让工作树变成新的当前树，当前树变成下一次更新的工作树。这个切换过程非常快，因为它只需要修改一个“根节点指针”，不需要重新创建整个 DOM 树。</p>
<h4 data-id="heading-9">React 19 对双缓存的优化点</h4>
<p>React 19 主要优化了“工作树构建效率”和“切换时机”：</p>
<ul>
<li>复用 Fiber 节点：对于没有变化的组件，React 19 会直接复用当前树的 Fiber 节点到工作树，避免重复创建节点，减少内存开销；</li>
<li>延迟切换：如果工作树构建过程中遇到高优先级任务，React 19 会延迟切换树的时机，先处理高优先级任务，确保用户交互更流畅。</li>
</ul>
<h4 data-id="heading-10">双缓存机制流程图</h4>
<h2 data-id="heading-11">三、React 19 调度系统：智能分配任务，避免卡顿</h2>
<p>有了可中断的 Fiber 架构，还需要一个“智能调度系统”来决定：<strong>哪个任务先执行？什么时候执行？什么时候中断当前任务？</strong> React 19 的调度系统基于“优先级队列”和“浏览器主线程空闲检测”，实现了高效的任务分配。</p>
<h3 data-id="heading-12">1. 核心：任务优先级分级（React 19 增强版）</h3>
<p>React 19 对任务优先级进行了更精细的分级，确保“紧急任务先执行，非紧急任务延后执行”。核心优先级分为 5 级（从高到低）：</p>
<ol>
<li><strong>Immediate（立即优先级）</strong> ：最紧急的任务，必须立即执行，不能中断（比如用户输入、点击事件的同步响应）；</li>
<li><strong>UserBlocking（用户阻塞优先级）</strong> ：影响用户交互的任务，需要尽快执行（比如表单输入后的状态更新、按钮点击后的页面反馈）；</li>
<li><strong>Normal（正常优先级）</strong> ：普通任务，可延迟执行，但不能太久（比如普通的状态更新）；</li>
<li><strong>Low（低优先级）</strong> ：低优先级任务，可长时间延迟（比如列表滚动时的非关键更新）；</li>
<li><strong>Idle（空闲优先级）</strong> ：最不重要的任务，只有当主线程完全空闲时才执行（比如日志上报、非关键数据统计）。</li>
</ol>
<h3 data-id="heading-13">2. 案例：优先级调度的实际效果</h3>
<p>假设我们有两个任务同时触发：</p>
<ul>
<li>任务 A：用户输入框输入文字（UserBlocking 优先级）；</li>
<li>任务 B：页面底部列表的非关键数据更新（Low 优先级）。</li>
</ul>
<p>如果没有调度系统，两个任务可能会并行执行，导致输入延迟。而 React 19 的调度系统会：</p>
<ol>
<li>优先执行任务 A（UserBlocking 优先级），确保用户输入流畅；</li>
<li>任务 A 执行完成后，检查主线程是否有空闲时间；</li>
<li>如果有空闲时间，再执行任务 B（Low 优先级）；如果期间又有紧急任务进来，暂停任务 B，先处理紧急任务。</li>
</ol>
<h3 data-id="heading-14">3. 底层实现：如何检测主线程空闲？</h3>
<p>React 19 调度系统的核心，是准确判断“主线程是否有空闲时间”，从而决定是否执行低优先级任务、是否中断当前任务。它主要依赖两个浏览器 API：</p>
<ul>
<li><strong>MessageChannel</strong>：用于实现“微任务级别的延迟执行”，替代了早期的 <code>requestIdleCallback</code>（<code>requestIdleCallback</code> 有兼容性问题，且延迟时间不精准）；</li>
<li><strong>performance.now()</strong> ：用于精确计算任务执行时间，判断当前任务是否执行过久，是否需要中断。</li>
</ul>
<p>简化代码模拟调度系统的空闲检测逻辑：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 模拟 React 19 调度系统的空闲检测</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Scheduler</span> {
  <span class="hljs-keyword">constructor</span>() {
    <span class="hljs-keyword">this</span>.priorityQueue = []; <span class="hljs-comment">// 优先级队列</span>
    <span class="hljs-keyword">this</span>.isRunning = <span class="hljs-literal">false</span>; <span class="hljs-comment">// 是否正在执行任务</span>

    <span class="hljs-comment">// 使用 MessageChannel 实现精准延迟</span>
    <span class="hljs-keyword">const</span> channel = new MessageChannel();
    <span class="hljs-keyword">this</span>.port1 = channel.port1;
    <span class="hljs-keyword">this</span>.port2 = channel.port2;
    <span class="hljs-keyword">this</span>.port1.onmessage = <span class="hljs-keyword">this</span>.executeTask.bind(<span class="hljs-keyword">this</span>);
  }

  <span class="hljs-comment">// 添加任务到优先级队列</span>
  scheduleTask(task, priority) {
    <span class="hljs-keyword">this</span>.priorityQueue.push({ task, priority });
    <span class="hljs-comment">// 按优先级排序（从高到低）</span>
    <span class="hljs-keyword">this</span>.priorityQueue.sort((a, b) =&gt; b.priority - a.priority);
    <span class="hljs-comment">// 如果没有正在执行的任务，触发任务执行</span>
    <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.isRunning) {
      <span class="hljs-keyword">this</span>.port2.postMessage(<span class="hljs-string">'execute'</span>);
    }
  }

  <span class="hljs-comment">// 执行任务</span>
  executeTask() {
    <span class="hljs-keyword">this</span>.isRunning = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">const</span> currentTask = <span class="hljs-keyword">this</span>.priorityQueue.shift();
    <span class="hljs-keyword">if</span> (!currentTask) {
      <span class="hljs-keyword">this</span>.isRunning = <span class="hljs-literal">false</span>;
      <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-comment">// 记录任务开始时间</span>
    <span class="hljs-keyword">const</span> startTime = performance.now();
    <span class="hljs-keyword">try</span> {
      <span class="hljs-comment">// 执行任务（这里的 task 就是 Fiber 树的遍历任务）</span>
      currentTask.task();
    } <span class="hljs-keyword">catch</span> (error) {
      console.error(<span class="hljs-string">'任务执行失败：'</span>, error);
    }

    <span class="hljs-comment">// 检查任务执行时间是否过长（超过 5ms 认为是长任务，需要中断）</span>
    <span class="hljs-keyword">const</span> executionTime = performance.now() - startTime;
    <span class="hljs-keyword">if</span> (executionTime &gt; <span class="hljs-number">5</span>) {
      <span class="hljs-comment">// 有未完成的任务，下次继续执行</span>
      <span class="hljs-keyword">this</span>.port2.postMessage(<span class="hljs-string">'execute'</span>);
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-comment">// 任务执行完成，继续执行下一个任务</span>
      <span class="hljs-keyword">this</span>.executeTask();
    }
  }

  <span class="hljs-comment">// 检查是否需要中断当前任务（供 Fiber 遍历调用）</span>
  shouldYield() {
    <span class="hljs-comment">// 计算当前主线程是否有空闲时间（简化逻辑）</span>
    <span class="hljs-keyword">const</span> currentTime = performance.now();
    <span class="hljs-comment">// 假设 16ms 是一帧的时间（浏览器每秒约 60 帧），超过 12ms 认为没有空闲时间</span>
    <span class="hljs-keyword">return</span> currentTime - <span class="hljs-keyword">this</span>.startTime &gt; <span class="hljs-number">12</span>;
  }
}
</code></pre>
<p>关键逻辑说明：</p>
<ul>
<li>任务添加后，会按优先级排序，确保高优先级任务先执行；</li>
<li>用 <code>MessageChannel</code> 触发任务执行，避免阻塞主线程；</li>
<li>通过 <code>performance.now()</code> 计算任务执行时间，超过阈值（比如 5ms）就中断，下次再继续，避免长时间占据主线程。</li>
</ul>
<h3 data-id="heading-15">4. React 19 调度系统的优化点</h3>
<p>React 19 在调度系统上的核心优化的点：</p>
<ul>
<li><strong>优先级预测</strong>：根据历史任务执行情况，预测下一个可能的高优先级任务，提前预留主线程时间；</li>
<li><strong>任务合并</strong>：将短时间内触发的多个相同优先级的任务合并为一个，减少重复计算；</li>
<li><strong>低优先级任务防饿死</strong>：为低优先级任务设置“过期时间”，如果超过过期时间还没执行，自动提升优先级，确保任务最终能执行。</li>
</ul>
<h2 data-id="heading-16">四、React 19 完整更新流程：Fiber + 调度协同工作</h2>
<p>了解了 Fiber 架构和调度系统的核心后，我们把它们结合起来，看看 React 19 处理一次状态更新的完整流程。用流程图和步骤说明，让整个逻辑更清晰。</p>
<h3 data-id="heading-17">完整流程流程图</h3>
<h3 data-id="heading-18">案例：React 19 处理一次点击更新的完整过程</h3>
<p>我们以“点击按钮修改 count 状态”为例，拆解整个流程：</p>
<pre><code class="hljs language-scss" lang="scss">function <span class="hljs-built_in">Counter</span>() {
  const <span class="hljs-selector-attr">[count, setCount]</span> = <span class="hljs-built_in">useState</span>(<span class="hljs-number">0</span>);
  return (
    &lt;button onClick={() =&gt; <span class="hljs-built_in">setCount</span>(count + <span class="hljs-number">1</span>)}&gt;
      点击计数：{count}
    &lt;/<span class="hljs-selector-tag">button</span>&gt;
  );
}
</code></pre>
<ol>
<li>用户点击按钮，触发 onClick 事件，调用 setCount(1)；</li>
<li>调度系统创建更新任务，判断该任务是“用户阻塞优先级”（UserBlocking），加入优先级队列；</li>
<li>调度系统发现当前没有正在执行的任务，触发任务执行；</li>
<li>Fiber 架构基于当前 Fiber 树（count=0）创建工作树，遍历 Counter 组件对应的 Fiber 节点；</li>
<li>处理 Counter 节点：对比虚拟 DOM（发现 count 从 0 变为 1），标记“更新文本内容”的 DOM 操作；</li>
<li>检查中断：任务执行时间很短（不足 1ms），不需要中断；</li>
<li>工作树构建完成，切换当前树和工作树的角色；</li>
<li>提交阶段：执行 DOM 操作，将按钮文本从“点击计数：0”更新为“点击计数：1”；</li>
<li>任务完成，调度系统检查优先级队列，没有其他任务，结束流程。</li>
</ol>
<h2 data-id="heading-19">五、实战避坑：基于 Fiber 架构的性能优化建议</h2>
<p>了解了 React 19 的底层原理后，我们可以针对性地做一些性能优化，避免踩坑。核心优化思路是“减少不必要的任务、降低任务优先级、避免长时间占用主线程”。</p>
<h3 data-id="heading-20">1. 避免不必要的渲染（减少 Fiber 树遍历范围）</h3>
<p>Fiber 树遍历的节点越多，任务耗时越长。我们可以通过以下方式减少不必要的渲染：</p>
<ul>
<li>使用 <code>React.memo</code> 缓存组件：对于 props 没有变化的组件，避免重新渲染；</li>
<li>使用 <code>useMemo</code> 缓存计算结果：避免每次渲染都执行复杂计算；</li>
<li>使用 <code>useCallback</code> 缓存函数：避免因函数重新创建导致子组件 props 变化。</li>
</ul>

<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 示例：使用 React.memo 缓存组件</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">Child</span> = <span class="hljs-title class_">React</span>.<span class="hljs-title function_">memo</span>(<span class="hljs-function">(<span class="hljs-params">{ name }</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Child 渲染'</span>);
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>{name}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span>;
});

<span class="hljs-keyword">function</span> <span class="hljs-title function_">Parent</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> [count, setCount] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);
  <span class="hljs-comment">// 使用 useCallback 缓存函数</span>
  <span class="hljs-keyword">const</span> handleClick = <span class="hljs-title function_">useCallback</span>(<span class="hljs-function">() =&gt;</span> {}, []);

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> setCount(count + 1)}&gt;计数：{count}<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Child</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"小明"</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{handleClick}</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}
</code></pre>
<p>优化后，点击按钮修改 count 时，Child 组件不会重新渲染，减少了 Fiber 树的遍历范围。</p>
<h3 data-id="heading-21">2. 拆分长任务（避免长时间占用主线程）</h3>
<p>如果有复杂的计算任务（比如处理大量数据），不要在组件渲染或 useEffect 中同步执行，否则会占据主线程，导致卡顿。可以用 <code>setTimeout</code> 或 React 18+ 的 <code>useDeferredValue</code> 将任务拆分成小任务，降低优先级。</p>
<pre><code class="hljs language-ini" lang="ini">// 示例：使用 useDeferredValue 降低任务优先级
function DataList() {
  const <span class="hljs-section">[data, setData]</span> = useState(<span class="hljs-section">[]</span>)<span class="hljs-comment">;</span>
  // 延迟处理数据，降低优先级
  const <span class="hljs-attr">deferredData</span> = useDeferredValue(data)<span class="hljs-comment">;</span>

  // 处理大量数据（复杂任务）
  useEffect(() =&gt; {
    const <span class="hljs-attr">fetchData</span> = async () =&gt; {
      const <span class="hljs-attr">res</span> = await fetch(<span class="hljs-string">'/api/large-data'</span>)<span class="hljs-comment">;</span>
      const <span class="hljs-attr">largeData</span> = await res.json()<span class="hljs-comment">;</span>
      setData(largeData)<span class="hljs-comment">;</span>
    }<span class="hljs-comment">;</span>
    fetchData()<span class="hljs-comment">;</span>
  }, <span class="hljs-section">[]</span>)<span class="hljs-comment">;</span>

  // 渲染延迟处理后的数据
  return (
    &lt;ul&gt;
      {deferredData.map(<span class="hljs-attr">item</span> =&gt; (
        &lt;li <span class="hljs-attr">key</span>={item.id}&gt;{item.name}&lt;/li&gt;
      ))}
    &lt;/ul&gt;
  )<span class="hljs-comment">;</span>
}
</code></pre>
<p>使用 <code>useDeferredValue</code> 后，数据处理任务会被标记为低优先级，不会影响用户交互等紧急任务。</p>
<h3 data-id="heading-22">3. 避免在渲染阶段执行副作用</h3>
<p>组件渲染阶段（函数组件执行过程）是 Fiber 树遍历的核心阶段，这个阶段的任务必须是“纯函数”（没有副作用）。如果在渲染阶段执行副作用（比如修改 DOM、发送请求、修改全局变量），会导致 Fiber 树构建混乱，且可能延长任务执行时间。</p>
<p>错误示例（渲染阶段执行副作用）：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 错误：渲染阶段修改 DOM</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">BadComponent</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> divRef = <span class="hljs-title function_">useRef</span>(<span class="hljs-literal">null</span>);
  <span class="hljs-comment">// 渲染阶段执行副作用（修改 DOM 文本）</span>
  <span class="hljs-keyword">if</span> (divRef.<span class="hljs-property">current</span>) {
    divRef.<span class="hljs-property">current</span>.<span class="hljs-property">textContent</span> = <span class="hljs-string">'渲染中...'</span>;
  }
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">{divRef}</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;
}
</code></pre>
<p>正确做法：将副作用放在 <code>useEffect</code> 中：</p>
<pre><code class="hljs language-ini" lang="ini">// 正确：useEffect 中执行副作用
function GoodComponent() {
  const <span class="hljs-attr">divRef</span> = useRef(null)<span class="hljs-comment">;</span>
  useEffect(() =&gt; {
    // 副作用放在 useEffect 中，在渲染完成后执行
    if (divRef.current) {
      <span class="hljs-attr">divRef.current.textContent</span> = <span class="hljs-string">'渲染完成'</span><span class="hljs-comment">;</span>
    }
  }, <span class="hljs-section">[]</span>)<span class="hljs-comment">;</span>
  return &lt;div <span class="hljs-attr">ref</span>={divRef}&gt;&lt;/div&gt;<span class="hljs-comment">;</span>
}
</code></pre>
<h2 data-id="heading-23">六、核心总结</h2>
<p>今天我们从底层原理到实战优化，完整拆解了 React 19 的 Fiber 架构和调度系统。核心要点总结如下：</p>
<ol>
<li><strong>Fiber 架构的核心价值</strong>：将不可中断的递归遍历拆分为可中断、可恢复的链表遍历，避免长任务占据主线程导致卡顿；</li>
<li><strong>React 19 Fiber 升级点</strong>：精简 Fiber 节点结构、增强优先级字段精度、优化双缓存切换效率、复用无变化节点；</li>
<li><strong>调度系统的核心逻辑</strong>：基于优先级队列分配任务，通过 MessageChannel 和 performance.now() 检测主线程空闲时间，确保紧急任务先执行；</li>
<li><strong>协同工作流程</strong>：触发更新 → 调度任务 → 构建 Fiber 工作树（可中断） → 切换双缓存树 → 提交 DOM 操作；</li>
<li><strong>实战优化建议</strong>：减少不必要渲染、拆分长任务、避免渲染阶段执行副作用。</li>
</ol>
<h2 data-id="heading-24">七、进阶学习方向</h2>
<p>如果想进一步深入 React 19 底层原理，可以重点学习以下内容：</p>
<ul>
<li>Fiber 架构的“提交阶段”细节：如何批量执行 DOM 操作、如何处理副作用；</li>
<li>React 19 的“自动批处理”（Automatic Batching）：如何合并多个更新任务，减少 Fiber 树构建次数；</li>
<li>并发渲染（Concurrent Rendering）：如何基于 Fiber 架构实现“并发更新”，让多个更新任务并行处理；</li>
<li>React 源码阅读：重点看 <code>react-reconciler</code> 包（Fiber 架构核心）和 <code>scheduler</code> 包（调度系统核心）。</li>
</ul>
<p>如果这篇文章对你有帮助，欢迎点赞、收藏、转发～ 有任何问题也可以在评论区留言交流～ 我们下期再见！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[栗子前端技术周刊第 113 期 - Angular 21.1、pnpm 10.28、Bun v1.3.6...]]></title>    <link>https://juejin.cn/post/7596790037096497215</link>    <guid>https://juejin.cn/post/7596790037096497215</guid>    <pubDate>2026-01-19T00:46:12.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7596790037096497215" data-draft-id="7596148446383341574" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="栗子前端技术周刊第 113 期 - Angular 21.1、pnpm 10.28、Bun v1.3.6..."/> <meta itemprop="keywords" content="前端,JavaScript,Angular.js"/> <meta itemprop="datePublished" content="2026-01-19T00:46:12.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="晓得迷路了"/> <meta itemprop="url" content="https://juejin.cn/user/2172290706715565"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            栗子前端技术周刊第 113 期 - Angular 21.1、pnpm 10.28、Bun v1.3.6...
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2172290706715565/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    晓得迷路了
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-19T00:46:12.000Z" title="Mon Jan 19 2026 00:46:12 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-19
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>🌰<strong>栗子前端技术周刊第 113 期 (2026.01.12 - 2026.01.18)</strong>：浏览前端一周最新消息，学习国内外优秀文章，让我们保持对前端的好奇心。</p>
<h2 data-id="heading-0">📰 技术资讯</h2>
<ol>
<li>
<p><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fangular.love%2Fangular-21-1-key-features-and-improvements" target="_blank" title="https://angular.love/angular-21-1-key-features-and-improvements" ref="nofollow noopener noreferrer">Angular 21.1</a></strong>：Angular 21.1 已发布，更新内容包括：为 Cloudflare 和 Cloudinary 图像加载器添加自定义转换、支持 ImageKit 和 Imgix 加载器中的自定义转换、添加路由清理控制等等。</p>
</li>
<li>
<p><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fpnpm.io%2Fblog%2Freleases%2F10.28" target="_blank" title="https://pnpm.io/blog/releases/10.28" ref="nofollow noopener noreferrer">pnpm 10.28</a></strong>：这款高效的包管理器新增了 <code>beforePacking</code> 钩子，可在发布时自定义 package.json 的内容。</p>
</li>
<li>
<p><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fbun.com%2Fblog%2Fbun-v1.3.6" target="_blank" title="https://bun.com/blog/bun-v1.3.6" ref="nofollow noopener noreferrer">Bun v1.3.6</a></strong>：<code>Bun.Archive</code> 现在可以处理 tar 归档文件，<code>Bun.JSONC</code> 支持解析带注释的 JSON，此外还包含许多性能优化和调整。</p>
</li>
<li>
<p><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fjquery.com%2F" target="_blank" title="https://jquery.com/" ref="nofollow noopener noreferrer">jQuery 二十周年</a></strong>：本周是 jQuery 发布的二十周年。</p>
</li>
</ol>
<h2 data-id="heading-1">📒 技术文章</h2>
<ol>
<li>
<p><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fhowbrowserswork.com%2F" target="_blank" title="https://howbrowserswork.com/" ref="nofollow noopener noreferrer">How Browsers Work</a></strong>：浏览器是如何工作的 - 一份关于浏览器工作原理的交互式指南。</p>
</li>
<li>
<p><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fpiccalil.li%2Fblog%2Fdate-is-out-and-temporal-is-in%2F" target="_blank" title="https://piccalil.li/blog/date-is-out-and-temporal-is-in/" ref="nofollow noopener noreferrer">Date is Out, Temporal is In</a></strong>：Date 已过时，Temporal 正当时 - 多年来，Temporal API 一直被视为解决 JavaScript Date 对象缺陷的未来方案，但这一 “未来” 终于到来了。Mat 通过大量示例展示了 Date 的不足之处，并以此凸显了 Temporal 的优势。</p>
</li>
<li>
<p><strong><a href="https://juejin.cn/post/7593550315254218758" target="_blank" title="https://juejin.cn/post/7593550315254218758">视频播放弱网提示实现</a></strong>：文章围绕视频播放弱网提示实现展开，文中提到了 NetworkInformation 和监听 Video 元素事件两种方法。</p>
</li>
</ol>
<h2 data-id="heading-2">🔧 开发工具</h2>
<ol>
<li><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Ffacebook.github.io%2Fmemlab%2F" target="_blank" title="https://facebook.github.io/memlab/" ref="nofollow noopener noreferrer">memlab 2.0</a></strong>：一个用于发现 JavaScript 内存泄漏的框架。这是一个用于识别内存泄漏和优化方法的测试与分析框架，源自 Meta 优化其主应用的内部方案。编写测试场景后，memlab 会对比堆快照、过滤内存泄漏并汇总结果。</li>
</ol>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1845ca60f097402bb96d4cbea5d10d1a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pmT5b6X6L-36Lev5LqG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769388372&amp;x-signature=vWousRJ3czr%2FtpLrAFzL%2FIcZwFU%3D" width="100%" alt="image-20260118085436938" loading="lazy"/>
<ol start="2">
<li><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FDoneDeal0%2Fsuperdiff" target="_blank" title="https://github.com/DoneDeal0/superdiff" ref="nofollow noopener noreferrer">Superdiff 3.2</a></strong>：比较两个数组或对象并返回差异，Superdiff 的近期更新提升了性能，增加了对流式输入的支持，并可以使用 Web Worker 在独立线程中进行更高效的差异比对。</li>
</ol>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9f8e6b91ae1c4583b344fb316c1d81b1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pmT5b6X6L-36Lev5LqG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769388372&amp;x-signature=6lAHGAK4Q%2Bbal3hJJUbYT9dgP3g%3D" width="100%" alt="image-20260118085226505" loading="lazy"/>
<ol start="3">
<li><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Ffabricjs.com%2F" target="_blank" title="https://fabricjs.com/" ref="nofollow noopener noreferrer">Fabric.js 7</a></strong>：一款基于 JavaScript 的 HTML5 Canvas 库。它在 canvas 元素之上提供了一套对象模型，同时支持 SVG 转 canvas、canvas 转 SVG 的双向格式转换功能。此外，该库还配备了大量附带完整代码的示例供开发者参考使用。</li>
</ol>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5d8869df9e5e46d48864499e75d3ca34~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pmT5b6X6L-36Lev5LqG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769388372&amp;x-signature=m86lAnqnUIWxyOMK7xqei41yADQ%3D" width="100%" alt="image-20260118085320730" loading="lazy"/>
<p>🚀🚀🚀 <em>以上资讯文章选自常见周刊，如 JavaScript Weekly 等，周刊内容也会不断优化改进，希望你们能够喜欢。</em></p>
<p>💖 <strong>欢迎关注微信公众号：栗子前端</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Android Studio Otter 3 正式发布：自带模型、Agent 增强、MCP 服务器全面升级]]></title>    <link>https://juejin.cn/post/7596181746083233842</link>    <guid>https://juejin.cn/post/7596181746083233842</guid>    <pubDate>2026-01-19T00:43:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7596181746083233842" data-draft-id="7596187471774187529" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Android Studio Otter 3 正式发布：自带模型、Agent 增强、MCP 服务器全面升级"/> <meta itemprop="keywords" content="Android Studio,Android"/> <meta itemprop="datePublished" content="2026-01-19T00:43:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="黄林晴"/> <meta itemprop="url" content="https://juejin.cn/user/3985057546510423"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Android Studio Otter 3 正式发布：自带模型、Agent 增强、MCP 服务器全面升级
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3985057546510423/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    黄林晴
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-19T00:43:39.000Z" title="Mon Jan 19 2026 00:43:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-19
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>Android Studio Otter 3 Feature Drop 已于 2026 年 1 月 15 日正式发布，这是迄今为止 LLM 灵活性和 Agent Mode 最强大的一个版本。</p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/af41f6a9b67c4078bcc208a61e3caf13~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6buE5p6X5pm0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769388240&amp;x-signature=ihI6hRwG4dsX2eSvFCk%2FgGbHzls%3D" alt="image.png" loading="lazy"/></p>
<p>就在昨天，Google 正式发布了 Android Studio Otter 3 Feature Drop 稳定版。这次更新的核心主题是 <strong>LLM 灵活性</strong> 和 <strong>Agent Mode 增强</strong>——你终于可以在 Android Studio 中使用 GPT、Claude 或本地模型了！</p>
<p>下面，让我们一起看看这次更新带来了哪些重磅功能。</p>
<hr/>
<h2 data-id="heading-0">一、Bring Your Own Model（BYOM）</h2>
<p>这是本次更新最大的亮点——<strong>你可以自由选择 LLM 了</strong>！</p>
<h3 data-id="heading-1">支持的模型类型</h3>
<p><strong>1. 远程模型</strong></p>
<p>现在可以在 Android Studio 中接入第三方 LLM 提供商：</p>
<ul>
<li>• <strong>OpenAI GPT</strong> 系列</li>
<li>• <strong>Anthropic Claude</strong> 系列</li>
<li>• 其他兼容 API 的模型</li>
</ul>
<p>配置方式：在设置中填入 API 端点和 API Key 即可。</p>
<p><strong>2. 本地模型</strong></p>
<p>如果你有网络限制或隐私合规要求，可以使用本地运行的模型：</p>
<ul>
<li>• <strong>LM Studio</strong></li>
<li>• <strong>Ollama</strong></li>
</ul>
<p>完全离线运行，数据不出本地。</p>
<p><strong>3. Gemini API Key</strong></p>
<p>使用自己的 Gemini API Key 可以解锁：</p>
<ul>
<li>• <strong>Gemini 3 Pro</strong> 和 <strong>Flash</strong> 模型</li>
<li>• 扩展的上下文窗口</li>
<li>• 更高的使用配额</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1342e382c3b14565b57d70aab4f43131~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6buE5p6X5pm0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769388240&amp;x-signature=O3%2BHYiBh%2FbL%2BXi60spd1dSdJtpM%3D" alt="image.png" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-2">二、Agent Mode 全面增强</h2>
<p>Agent Mode 从"聊天助手"进化为真正的 <strong>半自主开发代理</strong>。</p>
<h3 data-id="heading-3">设备交互能力</h3>
<p>AI Agent 现在可以直接操作你的设备：</p>





























<table><thead><tr><th>能力</th><th>说明</th></tr></thead><tbody><tr><td>部署应用</td><td>自动构建并安装到连接的设备</td></tr><tr><td>截取屏幕</td><td>获取当前 UI 截图进行分析</td></tr><tr><td>检查屏幕</td><td>分析 UI 元素和布局结构</td></tr><tr><td>查看 Logcat</td><td>自动检测错误日志并定位问题</td></tr><tr><td>设备交互</td><td>通过 <code>adb shell input</code> 模拟用户操作</td></tr></tbody></table>
<p>这意味着你可以让 AI 帮你完成完整的"修改代码 → 部署 → 验证"循环。</p>
<h3 data-id="heading-4">Changes Drawer</h3>
<p>AI 修改的所有代码都会出现在 <strong>Changes Drawer</strong> 面板中：</p>
<ul>
<li>• 查看每个文件的 Diff 对比</li>
<li>• 逐个接受或拒绝改动</li>
<li>• 在编辑器中进一步调整</li>
</ul>
<p>再也不用担心 AI 偷偷改了什么代码。</p>
<h3 data-id="heading-5">多线程对话</h3>
<p>对话管理也升级了：</p>
<ul>
<li>• 点击 <strong>New Chat</strong> 开启新的独立会话</li>
<li>• 点击 <strong>Recent Chats</strong> 查看历史记录</li>
<li>• 会话历史保存到账户，跨设备同步</li>
</ul>
<p>每个对话线程有独立的上下文，避免信息混乱，提升响应质量。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e5fab43e0fc24ac48a0cada23b4ff247~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6buE5p6X5pm0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769388240&amp;x-signature=fnB2G%2FlkMQ6BCABCaEkHvEVThh8%3D" alt="image.png" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-6">三、UI 开发的 AI 革新</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6f8d2ca2cd9d44d987b57c51ae2281f2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6buE5p6X5pm0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769388240&amp;x-signature=wxYpuy8RgssJq38EGd2v2FkpGYk%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-7">从设计稿生成代码</h3>
<p>上传设计稿截图，AI 直接生成 Compose 实现代码。虽然可能需要微调，但作为起点已经很棒了。</p>
<h3 data-id="heading-8">匹配目标设计</h3>
<p>有了参考图后，可以让 AI 持续调整代码，直到 UI 完美匹配设计稿——实现 <strong>像素级还原</strong>。</p>
<h3 data-id="heading-9">自然语言迭代</h3>
<p>用自然语言描述你想要的改动：</p>
<ul>
<li>• "把按钮颜色改成蓝色"</li>
<li>• "给这个卡片加圆角"</li>
<li>• "让列表支持横向滚动"</li>
</ul>
<p>AI 理解你的意图，直接修改代码。</p>
<h3 data-id="heading-10">自动 UI 质量审计</h3>
<p>AI 会自动检测无障碍问题（对比度、触摸目标大小等），并一键修复。</p>
<hr/>
<h2 data-id="heading-11">四、Journeys for Android Studio</h2>
<p><strong>用自然语言编写端到端 UI 测试</strong>！</p>
<p>以前写 E2E 测试需要熟悉 Espresso 或 UI Automator 的 API，现在只需要用自然语言描述测试场景：</p>
<blockquote>
<p>"打开应用，登录测试账号，进入设置页面，切换深色模式，验证主题已更改"</p>
</blockquote>
<p>AI 会自动生成对应的测试代码。这对于快速验证用户流程非常实用。</p>
<hr/>
<h2 data-id="heading-12">五、Remote MCP Servers</h2>
<p>MCP（Model Context Protocol）让 AI 可以连接外部工具。Otter 3 支持 <strong>远程 MCP 服务器</strong>：</p>





















<table><thead><tr><th>工具</th><th>用途</th></tr></thead><tbody><tr><td><strong>Figma</strong></td><td>直接在 IDE 中访问设计稿</td></tr><tr><td><strong>Notion</strong></td><td>读取产品文档和需求</td></tr><tr><td><strong>Linear</strong></td><td>获取任务和 Issue 信息</td></tr></tbody></table>
<p>无需安装桌面应用，减少上下文切换，一切都在 IDE 中完成。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/928ed35f0b2a40209d5228cfe014518a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6buE5p6X5pm0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769388240&amp;x-signature=lC4RDL7NWUO0RLLv5wzlA4Q4%2FUo%3D" alt="image.png" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-13">六、Automatic Logcat Retrace</h2>
<p>调试混淆后的崩溃日志一直是个痛点。现在，<strong>Logcat 会自动反混淆 R8 堆栈信息</strong>！</p>
<p><strong>要求</strong>：</p>
<ul>
<li>• Android Studio Otter 3</li>
<li>• AGP 8.12+</li>
<li>• 开启 R8（<code>minifyEnabled = true</code>）</li>
</ul>
<p>然后，Logcat 就会自动显示原始的类名、方法名和行号。再也不需要手动运行 <code>retrace</code> 命令了。</p>
<hr/>
<h2 data-id="heading-14">七、Fused Library Plugin</h2>
<p>如果你维护多个库模块，现在可以使用 <strong>Fused Library Plugin</strong> 将它们打包成 <strong>单个 AAR</strong> 发布：</p>
<ul>
<li>• 简化依赖管理</li>
<li>• 减少库消费者的配置负担</li>
<li>• 保持内部模块化架构</li>
</ul>
<hr/>
<h2 data-id="heading-15">如何更新</h2>
<p>已安装用户：</p>
<ul>
<li>• macOS: <code>Android Studio &gt; Check for Updates</code></li>
<li>• Windows/Linux: <code>Help &gt; Check for Updates</code></li>
</ul>
<p>新用户：直接下载最新版本</p>
<hr/>
<h2 data-id="heading-16">写在最后</h2>
<p>Android Studio Otter 3 的发布，标志着 IDE 正式进入 <strong>"AI 原生"时代</strong>。</p>
<p>最让我兴奋的是 <strong>Bring Your Own Model</strong> 功能——这意味着你可以根据自己的需求选择最合适的 LLM，而不是被锁定在单一模型上。对于有合规要求的企业开发者来说，本地模型支持更是一个重大利好。</p>
<p>Agent Mode 的设备交互能力也让人印象深刻。想象一下：你描述一个 bug，AI 自动修复代码、部署到设备、截图验证结果——这种工作流正在成为现实。</p>
<p>如果你对这些新功能有什么看法，欢迎在评论区交流。别忘了点赞收藏，我们下期见！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[flutter-实现瀑布流布局及下拉刷新上拉加载更多]]></title>    <link>https://juejin.cn/post/7596478936386764842</link>    <guid>https://juejin.cn/post/7596478936386764842</guid>    <pubDate>2026-01-19T00:47:51.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7596478936386764842" data-draft-id="7596166721627783214" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="flutter-实现瀑布流布局及下拉刷新上拉加载更多"/> <meta itemprop="keywords" content="前端,Flutter,Android"/> <meta itemprop="datePublished" content="2026-01-19T00:47:51.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="鹏多多"/> <meta itemprop="url" content="https://juejin.cn/user/747323639737191"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            flutter-实现瀑布流布局及下拉刷新上拉加载更多
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/747323639737191/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    鹏多多
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-19T00:47:51.000Z" title="Mon Jan 19 2026 00:47:51 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-19
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:2;font-weight:400;font-size:15px;overflow-x:hidden;color:#333;letter-spacing:1.2px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1:first-child,.markdown-body h2:first-child,.markdown-body h3:first-child,.markdown-body h4:first-child,.markdown-body h5:first-child,.markdown-body h6:first-child{margin-top:-1.5rem;margin-bottom:1rem}.markdown-body h1:before,.markdown-body h2:before,.markdown-body h3:before,.markdown-body h4:before,.markdown-body h5:before,.markdown-body h6:before{content:"#";display:inline-block;color:#3eaf7c;padding-right:.23em}.markdown-body h1{position:relative;font-size:2.5rem;margin-bottom:5px}.markdown-body h1:before{font-size:2.5rem}.markdown-body h2{padding-bottom:.5rem;font-size:2.2rem;border-bottom:1px solid #ececec}.markdown-body h3{font-size:1.5rem;padding-bottom:0}.markdown-body h4{font-size:1.25rem}.markdown-body h5{font-size:1rem}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body strong{color:#3eaf7c}.markdown-body img{max-width:100%;border-radius:2px;display:block;margin:auto}.markdown-body hr{border:none;border-top:1px solid #3eaf7c;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;overflow-x:auto;padding:.2rem .5rem;margin:0;color:#3eaf7c;font-size:.85em;background-color:rgba(27,31,35,.05);border-radius:3px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;border:.5rem solid #3eaf7c}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{font-weight:500;text-decoration:none;color:#3eaf7c;margin:0 5px}.markdown-body a:active,.markdown-body a:hover{text-decoration:none;border-bottom:1.5px solid #3eaf7c}.markdown-body a[href^=http]:after{content:url("data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTQiIGhlaWdodD0iMTQiPjxkZWZzPjxzdHlsZS8+PC9kZWZzPjxwYXRoIGQ9Ik04MzIgMTI4SDY0MHY2NGgxNDYuNzUyTDUyMS4zNzYgNDU3LjM3Nmw0NS4yNDggNDUuMjQ4TDgzMiAyMzcuMjQ4VjM4NGg2NFYxMjh6IiBmaWxsPSIjM2VhZjdjIi8+PHBhdGggZD0iTTc2OCA4MzJIMTkyVjI1NmgzNTJ2LTY0SDE2MGEzMiAzMiAwIDAwLTMyIDMydjY0MGEzMiAzMiAwIDAwMzIgMzJoNjQwYTMyIDMyIDAgMDAzMi0zMlY0ODBoLTY0djM1MnoiIGZpbGw9IiMzZWFmN2MiLz48L3N2Zz4=");margin-left:2px}.markdown-body a[href^="#"]:before{content:"#"}.markdown-body table{display:inline-block!important;font-size:13px;width:auto;max-width:100%;overflow:auto;border:1px solid #3eaf7c;border-collapse:collapse}.markdown-body thead{background:#3eaf7c;color:#fff;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(153,255,188,.1)}.markdown-body td,.markdown-body th{padding:4px 8px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#7b7878;padding:1px 23px;border-left:.5rem solid;border-color:#42b983;background-color:rgba(66,184,131,.1);position:relative;margin:14px 8px 0}.markdown-body blockquote:before{display:inline-block;position:absolute;content:url("data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjUiIGhlaWdodD0iMjUiIHZpZXdCb3g9IjAgMCAyNyAyNyIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxLjg2MiAxLjg2MikiIGZpbGwtcnVsZT0ibm9uemVybyIgZmlsbD0ibm9uZSI+PGNpcmNsZSBzdHJva2U9IiNGRkYiIHN0cm9rZS13aWR0aD0iMS43MjQiIGZpbGw9IiM0MkI5ODMiIGN4PSIxMS42MzgiIGN5PSIxMS42MzgiIHI9IjExLjYzOCIvPjxwYXRoIGQ9Ik0xNC45NzggNi4yN0E1LjAwNiA1LjAwNiAwIDAwNi42NyA5LjQ2OGE0LjkwMSA0LjkwMSAwIDAwMS43NzMgNC4zNjJjLjMyMy4yNTguNTE0LjY0Ny41MjIgMS4wNnYxLjA2YTIuNjg1IDIuNjg1IDAgMDA1LjM3IDB2LTEuMDA4Yy4wMDItLjM5OC4xNzMtLjc3Ny40Ny0xLjA0MmE1LjAyMyA1LjAyMyAwIDAwLjE3My03LjYzem0tMy4zMzcgMTAuOTY3YTEuMzA0IDEuMzA0IDAgMDEtMS4yODYtMS4yODd2LS4yNzhoMi41NzJ2LjI2MWMwIC43MTMtLjU3MyAxLjI5NC0xLjI4NiAxLjMwNHptMi4yNi00LjQxNWMtLjQ0LjM4My0uNzUuODkzLS44ODcgMS40NmgtMi43NDZhMi44NjggMi44NjggMCAwMC0uOTM4LTEuNTNoLS4wMThhMy40NzYgMy40NzYgMCAwMS0xLjI2OS0zLjE0NSAzLjYxNSAzLjYxNSAwIDAxNy4xOTYuNCAzLjY1IDMuNjUgMCAwMS0xLjMzOCAyLjgxNXoiIGZpbGw9IiNGRkYiLz48L2c+PC9zdmc+");width:25px;height:25px;left:-16px;top:12px}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body details{outline:none;border:none;border-left:4px solid #3eaf7c;padding-left:10px;margin-left:4px}.markdown-body details summary{cursor:pointer;border:none;outline:none;background:#fff;margin:0 -17px}.markdown-body details summary::-webkit-details-marker{color:#3eaf7c}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body ol li::marker{color:#3eaf7c}.markdown-body ul li{list-style:none;padding-left:10px}.markdown-body ul li::marker{content:"•";color:#3eaf7c}.markdown-body ul li.task-list-item:before{content:"";margin-right:0}.markdown-body input[type=checkbox]{vertical-align:text-bottom;box-shadow:inset 0 0 0 10px #fff}.markdown-body input[type=checkbox]:before{content:url("data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiPjxkZWZzPjxzdHlsZS8+PC9kZWZzPjxwYXRoIGQ9Ik04NzcuMDU2IDE0Ni45NDR2NzMwLjExMkgxNDYuOTQ0VjE0Ni45NDRoNzMwLjExMnptMC0xMDQuMjc3SDE0Ni45NDRjLTU3LjYyOCAwLTEwNC4yNzcgNDYuNjQ5LTEwNC4yNzcgMTA0LjI3N3Y3MzAuMTEyYzAgNTcuNjI4IDQ2LjY0OSAxMDQuMjc3IDEwNC4yNzcgMTA0LjI3N2g3MzAuMTEyYzU3LjYyOCAwIDEwNC4yNzctNDYuNjQ5IDEwNC4yNzctMTA0LjI3N1YxNDYuOTQ0YzAtNTcuNjI4LTQ2LjY0OS0xMDQuMjc3LTEwNC4yNzctMTA0LjI3N3oiIGZpbGw9IiMzZWFmN2MiLz48L3N2Zz4=");position:relative;top:-2px;right:2px}.markdown-body input[type=checkbox]:checked:before{content:url("data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTUiIGhlaWdodD0iMTUiPjxkZWZzPjxzdHlsZS8+PC9kZWZzPjxwYXRoIGQ9Ik05MTAuMjA4IDBIMTEzLjc2QTExNC4xMTIgMTE0LjExMiAwIDAwLS4wMzIgMTEzLjc5MlY5MTAuMjRjMCA2Mi41OTIgNTEuMiAxMTMuNzkyIDExMy43OTIgMTEzLjc5Mmg3OTYuNDQ4YzYyLjU5MiAwIDExMy43OTItNTEuMiAxMTMuNzkyLTExMy43OTJWMTEzLjc5MkMxMDI0IDUxLjIgOTcyLjggMCA5MTAuMjA4IDB6bS01MTIgNzk2LjQ0OEwxMTMuNzYgNTEybDc5LjY0OC03OS42NDggMjA0LjggMjA0LjhMODMwLjU2IDIwNC44bDc5LjY0OCA3OS42NDgtNTEyIDUxMnoiIGZpbGw9IiMzZWFmN2MiLz48L3N2Zz4=");position:relative;top:-2px;right:2px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="agate">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#333;color:#fff}.hljs-name,.hljs-strong{font-weight:700}.hljs-code,.hljs-emphasis{font-style:italic}.hljs-tag{color:#62c8f3}.hljs-selector-class,.hljs-selector-id,.hljs-template-variable,.hljs-variable{color:#ade5fc}.hljs-bullet,.hljs-string{color:#a2fca2}.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-quote,.hljs-section,.hljs-title,.hljs-type{color:#ffa}.hljs-bullet,.hljs-number,.hljs-symbol{color:#d36363}.hljs-keyword,.hljs-literal,.hljs-selector-tag{color:#fcc28c}.hljs-code,.hljs-comment,.hljs-deletion{color:#888}.hljs-link,.hljs-regexp{color:#c6b4f0}.hljs-meta{color:#fc9b9b}.hljs-deletion{background-color:#fc9b9b;color:#333}.hljs-addition{background-color:#a2fca2;color:#333}.hljs a{color:inherit}.hljs a:focus,.hljs a:hover{color:inherit;text-decoration:underline}</style><p>在 Flutter 应用开发中，瀑布流布局常用于展示图片、商品列表等需要以不规则但整齐排列的内容。同时，下拉刷新和上拉加载更多功能，能够极大提升用户体验，让用户方便地获取最新和更多的数据。</p>
<h2 data-id="heading-0">1. 前置条件</h2>
<ol>
<li>
<p>Flutter 环境已搭建（要求 Flutter 3.0+、Dart 2.17+）</p>
</li>
<li>
<p>本地图片资源已放入 <code>assets/images</code> 目录，并在 <code>pubspec.yaml</code> 中配置</p>
</li>
<li>
<p>已安装依赖插件并执行 <code>flutter pub get</code></p>
</li>
</ol>
<h2 data-id="heading-1">2. 结构分析</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b3fb3fa88858454c847241e8398618d7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6bmP5aSa5aSa:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769388471&amp;x-signature=1b%2BajzGhngXmLLWlGGPXnQnboT8%3D" alt="6210b7bafa9244369d7ce1aa5ca874be.gif" loading="lazy"/></p>
<h3 data-id="heading-2">2.1 安装依赖插件</h3>
<p>在项目的 <code>pubspec.yaml</code> 文件中添加以下依赖：</p>
<pre><code class="hljs language-YAML" lang="YAML">
<span class="hljs-comment"># 瀑布流布局：https://pub.dev/packages/waterfall_flow</span>
<span class="hljs-attr">waterfall_flow:</span> <span class="hljs-string">^3.0.3</span>
<span class="hljs-comment"># 上拉加载更多+下拉刷新：https://pub.dev/packages/pull_to_refresh</span>
<span class="hljs-attr">pull_to_refresh:</span> <span class="hljs-string">^2.0.0</span>
</code></pre>
<p>注意：<code>waterfall_flow: ^3.0.3</code> 需适配 Flutter 3.0+，<code>pull_to_refresh: ^2.0.0</code> 需 Dart 2.17+</p>
<p>添加依赖后执行命令安装：</p>
<pre><code class="hljs language-Bash" lang="Bash">
flutter pub get
</code></pre>
<h3 data-id="heading-3">2.2 配置本地图片资源</h3>
<p>在 <code>pubspec.yaml</code> 中配置图片资源路径，确保 Flutter 能识别本地图片：</p>
<pre><code class="hljs language-YAML" lang="YAML">
<span class="hljs-attr">flutter:</span>
  <span class="hljs-attr">uses-material-design:</span> <span class="hljs-literal">true</span>
  <span class="hljs-comment"># 配置图片资源目录</span>
  <span class="hljs-attr">assets:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">assets/images/</span>
</code></pre>
<h3 data-id="heading-4">2.3 引入必要的库</h3>
<pre><code class="hljs language-Dart" lang="Dart">
<span class="hljs-keyword">import</span> <span class="hljs-string">'dart:async'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">'package:flutter/material.dart'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">'package:pull_to_refresh/pull_to_refresh.dart'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">'package:waterfall_flow/waterfall_flow.dart'</span>;
</code></pre>
<ul>
<li>
<p><code>dart:async</code>：提供异步操作能力，用于处理刷新和加载更多的延迟模拟。</p>
</li>
<li>
<p><code>package:flutter/material.dart</code>：Flutter 核心 UI 库，提供 Scaffold、Container 等基础组件。</p>
</li>
<li>
<p><code>package:pull_to_refresh/pull_to_refresh.dart</code>：实现下拉刷新和上拉加载更多的核心库。</p>
</li>
<li>
<p><code>package:waterfall_flow/waterfall_flow.dart</code>：用于快速构建瀑布流布局的第三方库。</p>
</li>
</ul>
<h3 data-id="heading-5">2.4 定义图片枚举及扩展</h3>
<p>为了规范图片资源管理，我们定义图片枚举，并通过扩展方法获取图片路径：</p>
<pre><code class="hljs language-Dart" lang="Dart">
<span class="hljs-comment">/// <span class="markdown">本地图片枚举</span></span>
<span class="hljs-keyword">enum</span> ImageEnum {
  banner1,
  banner2,
  banner3,
  model1,
  model2,
  model3,
  model4,
}

<span class="hljs-comment">/// <span class="markdown">为枚举扩展获取图片路径的方法</span></span>
<span class="hljs-keyword">extension</span> ImageEnumExtension <span class="hljs-keyword">on</span> ImageEnum {
  <span class="hljs-built_in">String</span> <span class="hljs-keyword">get</span> path {
    <span class="hljs-keyword">switch</span> (<span class="hljs-keyword">this</span>) {
      <span class="hljs-keyword">case</span> ImageEnum.banner1:
        <span class="hljs-keyword">return</span> <span class="hljs-string">'assets/images/banner1.png'</span>;
      <span class="hljs-keyword">case</span> ImageEnum.banner2:
        <span class="hljs-keyword">return</span> <span class="hljs-string">'assets/images/banner2.png'</span>;
      <span class="hljs-keyword">case</span> ImageEnum.banner3:
        <span class="hljs-keyword">return</span> <span class="hljs-string">'assets/images/banner3.png'</span>;
      <span class="hljs-keyword">case</span> ImageEnum.model1:
        <span class="hljs-keyword">return</span> <span class="hljs-string">'assets/images/model1.png'</span>;
      <span class="hljs-keyword">case</span> ImageEnum.model2:
        <span class="hljs-keyword">return</span> <span class="hljs-string">'assets/images/model2.png'</span>;
      <span class="hljs-keyword">case</span> ImageEnum.model3:
        <span class="hljs-keyword">return</span> <span class="hljs-string">'assets/images/model3.png'</span>;
      <span class="hljs-keyword">case</span> ImageEnum.model4:
        <span class="hljs-keyword">return</span> <span class="hljs-string">'assets/images/model4.png'</span>;
    }
  }
}
</code></pre>
<h3 data-id="heading-6">2.5 定义 ImageWaterfallFlow 组件</h3>
<p>定义有状态组件，用于管理瀑布流布局的状态和 UI 渲染：</p>
<pre><code class="hljs language-Dart" lang="Dart">
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ImageWaterfallFlow</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatefulWidget</span> </span>{
  <span class="hljs-keyword">const</span> ImageWaterfallFlow({<span class="hljs-keyword">super</span>.key});

  <span class="hljs-meta">@override</span>
  State&lt;ImageWaterfallFlow&gt; createState() =&gt; ImageWaterfallFlowState();
}
</code></pre>
<p>有状态组件可以根据用户操作或数据变化动态更新 UI，<code>createState</code> 方法返回状态管理类 <code>ImageWaterfallFlowState</code>。</p>
<h3 data-id="heading-7">2.6 ImageWaterfallFlowState 类的详细解析</h3>
<p>该类是组件的核心，负责管理数据、控制器和业务逻辑：</p>
<pre><code class="hljs language-Dart" lang="Dart">
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ImageWaterfallFlowState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">State</span>&lt;<span class="hljs-title">ImageWaterfallFlow</span>&gt; </span>{
  <span class="hljs-comment">/// <span class="markdown">字体样式</span></span>
  <span class="hljs-keyword">final</span> TextStyle myTxtStyle = <span class="hljs-keyword">const</span> TextStyle(
      color: Colors.white, fontSize: <span class="hljs-number">24</span>, fontWeight: FontWeight.w800);

  <span class="hljs-comment">/// <span class="markdown">模拟数据（初始数据）- 增加泛型提升类型安全</span></span>
  <span class="hljs-built_in">List</span>&lt;ImageEnum&gt; imageList = [
    ImageEnum.banner1,
    ImageEnum.banner2,
    ImageEnum.banner3,
    ImageEnum.model1,
    ImageEnum.model2,
    ImageEnum.model3,
    ImageEnum.model4,
    ImageEnum.banner1,
    ImageEnum.banner2,
    ImageEnum.banner3,
    ImageEnum.model1,
    ImageEnum.model2,
    ImageEnum.model3,
    ImageEnum.model4
  ];

  <span class="hljs-comment">/// <span class="markdown">模拟数据（加载更多使用）</span></span>
  <span class="hljs-built_in">List</span>&lt;ImageEnum&gt; moreList = [ImageEnum.banner1, ImageEnum.banner2, ImageEnum.banner3];

  <span class="hljs-comment">/// <span class="markdown">上拉下拉控制器</span></span>
  <span class="hljs-keyword">final</span> RefreshController myRefreshController = RefreshController();
</code></pre>
<ul>
<li>
<p><code>myTxtStyle</code>：定义图片上显示序号的字体样式。</p>
</li>
<li>
<p><code>imageList</code>：存储瀑布流初始展示的图片数据，使用泛型 <code>List&lt;ImageEnum&gt;</code> 保证类型安全。</p>
</li>
<li>
<p><code>moreList</code>：存储加载更多时需要追加的数据。</p>
</li>
<li>
<p><code>myRefreshController</code>：来自 <code>pull_to_refresh</code> 库，用于控制刷新和加载的状态。</p>
</li>
</ul>
<h3 data-id="heading-8">2.7 刷新和加载更多的方法</h3>
<p>实现下拉刷新和上拉加载更多的业务逻辑，补充边界条件处理：</p>
<pre><code class="hljs language-Dart" lang="Dart">
<span class="hljs-comment">/// <span class="markdown">刷新</span></span>
<span class="hljs-keyword">void</span> onRefresh() <span class="hljs-keyword">async</span> {
  <span class="hljs-keyword">await</span> Future.delayed(<span class="hljs-keyword">const</span> <span class="hljs-built_in">Duration</span>(milliseconds: <span class="hljs-number">1000</span>));
  <span class="hljs-comment">// 模拟刷新：恢复初始数据</span>
  setState(() {
    imageList = [
      ImageEnum.banner1,
      ImageEnum.banner2,
      ImageEnum.banner3,
      ImageEnum.model1,
      ImageEnum.model2,
      ImageEnum.model3,
      ImageEnum.model4,
      ImageEnum.banner1,
      ImageEnum.banner2,
      ImageEnum.banner3,
      ImageEnum.model1,
      ImageEnum.model2,
      ImageEnum.model3,
      ImageEnum.model4
    ];
  });
  myRefreshController.refreshCompleted();
  myRefreshController.resetNoData(); <span class="hljs-comment">// 重置无更多数据状态</span>
}

<span class="hljs-comment">/// <span class="markdown">加载更多</span></span>
<span class="hljs-keyword">void</span> onLoadMore() <span class="hljs-keyword">async</span> {
  <span class="hljs-keyword">await</span> Future.delayed(<span class="hljs-keyword">const</span> <span class="hljs-built_in">Duration</span>(milliseconds: <span class="hljs-number">1000</span>));
  <span class="hljs-comment">// 模拟：数据超过30条时标记无更多数据</span>
  <span class="hljs-keyword">if</span> (imageList.length &gt;= <span class="hljs-number">30</span>) {
    myRefreshController.loadNoData();
  } <span class="hljs-keyword">else</span> {
    imageList.addAll(moreList);
    <span class="hljs-keyword">if</span> (mounted) {
      setState(() {});
    }
    myRefreshController.loadComplete();
  }
}
</code></pre>
<ul>
<li>
<p><code>onRefresh</code>：下拉刷新时触发，模拟 1 秒延迟后恢复初始数据，并重置加载状态。</p>
</li>
<li>
<p><code>onLoadMore</code>：上拉加载时触发，模拟 1 秒延迟后追加数据；当数据量超过 30 条时，标记为“无更多数据”。</p>
</li>
<li>
<p><code>mounted</code> 判断：防止组件销毁后调用 <code>setState</code> 导致异常。</p>
</li>
</ul>
<h3 data-id="heading-9">2.8 资源释放</h3>
<p>重写 <code>dispose</code> 方法，释放控制器资源，避免内存泄漏：</p>
<pre><code class="hljs language-Dart" lang="Dart">
<span class="hljs-meta">@override</span>
<span class="hljs-keyword">void</span> dispose() {
  myRefreshController.dispose(); <span class="hljs-comment">// 释放刷新控制器</span>
  <span class="hljs-keyword">super</span>.dispose();
}
</code></pre>
<h3 data-id="heading-10">2.9 构建 UI 的方法</h3>
<p>构建组件的基础布局结构：</p>
<pre><code class="hljs language-Dart" lang="Dart">
<span class="hljs-comment">/// <span class="markdown">布局</span></span>
<span class="hljs-meta">@override</span>
Widget build(BuildContext context) {
  <span class="hljs-keyword">return</span> Scaffold(
      backgroundColor: Colors.black,
      body: SafeArea(
          child: SizedBox(
              width: MediaQuery.of(context).size.width,
              height: MediaQuery.of(context).size.height,
              child: listWidget())));
}
</code></pre>
<ul>
<li>
<p><code>Scaffold</code>：作为页面的根布局，设置背景色为黑色。</p>
</li>
<li>
<p><code>SafeArea</code>：避免内容被刘海屏、状态栏等遮挡。</p>
</li>
<li>
<p><code>SizedBox</code>：设置与屏幕同宽同高的容器，承载瀑布流列表。</p>
</li>
</ul>
<h3 data-id="heading-11">2.10 构建瀑布流列表的方法</h3>
<p>整合刷新组件和瀑布流布局，实现核心 UI 效果：</p>
<pre><code class="hljs language-Dart" lang="Dart">
<span class="hljs-comment">/// <span class="markdown">列表</span></span>
Widget listWidget() {
  <span class="hljs-keyword">return</span> SmartRefresher(
    enablePullDown: <span class="hljs-keyword">true</span>,
    enablePullUp: <span class="hljs-keyword">true</span>,
    header: <span class="hljs-keyword">const</span> ClassicHeader(),
    footer: <span class="hljs-keyword">const</span> ClassicFooter(),
    controller: myRefreshController,
    onRefresh: onRefresh,
    onLoading: onLoadMore,
    child: WaterfallFlow.builder(
      padding: <span class="hljs-keyword">const</span> EdgeInsets.all(<span class="hljs-number">10</span>), <span class="hljs-comment">// 增加内边距，避免内容贴边</span>
      physics: <span class="hljs-keyword">const</span> BouncingScrollPhysics(),
      gridDelegate: SliverWaterfallFlowDelegateWithFixedCrossAxisCount(
        crossAxisCount: <span class="hljs-number">2</span>,
        crossAxisSpacing: <span class="hljs-number">20</span>,
        mainAxisSpacing: <span class="hljs-number">20</span>,
        viewportBuilder: (<span class="hljs-built_in">int</span> index1, <span class="hljs-built_in">int</span> index2) {
          <span class="hljs-built_in">print</span>(<span class="hljs-string">'变化：<span class="hljs-subst">$index1</span>-<span class="hljs-subst">$index2</span>'</span>);
        },
        <span class="hljs-comment">// 修正最后一个子项的判断逻辑（索引从0开始）</span>
        lastChildLayoutTypeBuilder: (index) =&gt; index == imageList.length - <span class="hljs-number">1</span>
            ? LastChildLayoutType.fullCrossAxisExtent
            : LastChildLayoutType.none,
      ),
      itemCount: imageList.length,
      itemBuilder: (BuildContext context, <span class="hljs-built_in">int</span> index) {
        <span class="hljs-keyword">return</span> Container(
          color: Colors.white,
          height: (index + <span class="hljs-number">1</span>) % <span class="hljs-number">2</span> == <span class="hljs-number">0</span> ? <span class="hljs-number">100</span> : <span class="hljs-number">200</span>,
          child: Container(
              alignment: Alignment.center,
              decoration: BoxDecoration(
                  color: Colors.blue.shade300,
                  image: DecorationImage(
                    image: AssetImage(imageList[index].path), <span class="hljs-comment">// 调用扩展方法获取图片路径</span>
                    fit: BoxFit.cover,
                  )),
              child: Text(<span class="hljs-string">'第<span class="hljs-subst">${index + <span class="hljs-number">1</span>}</span>张'</span>, style: myTxtStyle)),
        );
      },
    ),
  );
}
</code></pre>
<ul>
<li>
<p><code>SmartRefresher</code>：<code>pull_to_refresh</code> 库的核心组件，配置上下拉开关、头部底部样式和回调方法。</p>
</li>
<li>
<p><code>WaterfallFlow.builder</code>：瀑布流布局的构建器，通过懒加载方式渲染子项：</p>
<ul>
<li>
<p><code>padding</code>：增加内边距，优化视觉效果。</p>
</li>
<li>
<p><code>crossAxisCount: 2</code>：设置瀑布流为 2 列布局。</p>
</li>
<li>
<p><code>crossAxisSpacing</code>/<code>mainAxisSpacing</code>：设置子项之间的水平和垂直间距。</p>
</li>
<li>
<p><code>lastChildLayoutTypeBuilder</code>：修正索引判断逻辑，让最后一个子项占满整行宽度。</p>
</li>
<li>
<p><code>itemBuilder</code>：构建每个瀑布流子项，通过 <code>AssetImage(imageList[index].path)</code> 获取图片路径，设置不同高度实现瀑布流效果。</p>
</li>
</ul>
</li>
</ul>
<h2 data-id="heading-12">3. 核心库 API &amp; 属性说明</h2>
<h3 data-id="heading-13">3.1 waterfall_flow 核心 API/属性</h3>
<h4 data-id="heading-14">3.1.1 WaterfallFlow 核心组件</h4>





















































<table><thead><tr><th>属性名</th><th>类型</th><th>说明</th><th>默认值</th></tr></thead><tbody><tr><td><code>padding</code></td><td><code>EdgeInsetsGeometry</code></td><td>瀑布流整体内边距</td><td><code>EdgeInsets.zero</code></td></tr><tr><td><code>physics</code></td><td><code>ScrollPhysics</code></td><td>滚动物理效果</td><td><code>AlwaysScrollableScrollPhysics()</code></td></tr><tr><td><code>shrinkWrap</code></td><td><code>bool</code></td><td>是否根据子项高度自适应</td><td><code>false</code></td></tr><tr><td><code>gridDelegate</code></td><td><code>SliverWaterfallFlowDelegate</code></td><td>瀑布流布局代理（核心）</td><td>无（必传）</td></tr><tr><td><code>children</code></td><td><code>List&lt;Widget&gt;</code></td><td>子组件列表（非懒加载）</td><td><code>[]</code></td></tr><tr><td><code>itemCount</code></td><td><code>int</code></td><td>子项数量（builder 模式）</td><td>无（builder 模式必传）</td></tr><tr><td><code>itemBuilder</code></td><td><code>IndexedWidgetBuilder</code></td><td>子项构建器（懒加载）</td><td>无（builder 模式必传）</td></tr></tbody></table>
<h4 data-id="heading-15">3.1.2 SliverWaterfallFlowDelegateWithFixedCrossAxisCount（常用布局代理）</h4>















































<table><thead><tr><th>属性名</th><th>类型</th><th>说明</th><th>默认值</th></tr></thead><tbody><tr><td><code>crossAxisCount</code></td><td><code>int</code></td><td>列数（核心）</td><td>无（必传）</td></tr><tr><td><code>crossAxisSpacing</code></td><td><code>double</code></td><td>列之间的间距</td><td><code>0.0</code></td></tr><tr><td><code>mainAxisSpacing</code></td><td><code>double</code></td><td>行之间的间距</td><td><code>0.0</code></td></tr><tr><td><code>lastChildLayoutTypeBuilder</code></td><td><code>LastChildLayoutTypeBuilder</code></td><td>最后一个子项布局类型</td><td><code>null</code></td></tr><tr><td><code>viewportBuilder</code></td><td><code>ViewportBuilder</code></td><td>视口内子项变化回调</td><td><code>null</code></td></tr><tr><td><code>collectGarbage</code></td><td><code>CollectGarbage</code></td><td>回收不可见子项时的回调</td><td><code>null</code></td></tr></tbody></table>
<h4 data-id="heading-16">3.1.3 LastChildLayoutType（最后一个子项布局类型）</h4>





















<table><thead><tr><th>枚举值</th><th>说明</th></tr></thead><tbody><tr><td><code>LastChildLayoutType.none</code></td><td>无特殊布局（默认）</td></tr><tr><td><code>LastChildLayoutType.fullCrossAxisExtent</code></td><td>占满整行宽度</td></tr><tr><td><code>LastChildLayoutType.footnote</code></td><td>脚注样式（小尺寸）</td></tr></tbody></table>
<h3 data-id="heading-17">3.2 pull_to_refresh 核心 API/属性</h3>
<h4 data-id="heading-18">3.2.1 SmartRefresher（核心组件）</h4>













































































<table><thead><tr><th>属性名</th><th>类型</th><th>说明</th><th>默认值</th></tr></thead><tbody><tr><td><code>enablePullDown</code></td><td><code>bool</code></td><td>是否启用下拉刷新</td><td><code>true</code></td></tr><tr><td><code>enablePullUp</code></td><td><code>bool</code></td><td>是否启用上拉加载</td><td><code>false</code></td></tr><tr><td><code>header</code></td><td><code>RefreshHeader</code></td><td>下拉刷新头部样式</td><td><code>ClassicHeader()</code></td></tr><tr><td><code>footer</code></td><td><code>LoadFooter</code></td><td>上拉加载底部样式</td><td><code>ClassicFooter()</code></td></tr><tr><td><code>controller</code></td><td><code>RefreshController</code></td><td>刷新/加载控制器（核心）</td><td>无（必传）</td></tr><tr><td><code>onRefresh</code></td><td><code>VoidCallback?</code></td><td>下拉刷新回调</td><td><code>null</code></td></tr><tr><td><code>onLoading</code></td><td><code>VoidCallback?</code></td><td>上拉加载回调</td><td><code>null</code></td></tr><tr><td><code>child</code></td><td><code>Widget</code></td><td>包裹的子组件（如列表/瀑布流）</td><td>无（必传）</td></tr><tr><td><code>scrollDirection</code></td><td><code>Axis</code></td><td>滚动方向</td><td><code>Axis.vertical</code></td></tr><tr><td><code>physics</code></td><td><code>ScrollPhysics</code></td><td>滚动物理效果</td><td><code>ClampingScrollPhysics()</code></td></tr><tr><td><code>enableTwoLevel</code></td><td><code>bool</code></td><td>是否启用二级刷新（如下拉展开更多）</td><td><code>false</code></td></tr></tbody></table>
<h4 data-id="heading-19">3.2.2 RefreshController（核心控制器）</h4>









































<table><thead><tr><th>方法名</th><th>说明</th></tr></thead><tbody><tr><td><code>refreshCompleted()</code></td><td>标记下拉刷新完成</td></tr><tr><td><code>refreshFailed()</code></td><td>标记下拉刷新失败</td></tr><tr><td><code>loadComplete()</code></td><td>标记上拉加载完成</td></tr><tr><td><code>loadNoData()</code></td><td>标记无更多数据</td></tr><tr><td><code>resetNoData()</code></td><td>重置无更多数据状态</td></tr><tr><td><code>dispose()</code></td><td>释放控制器资源（必写，避免内存泄漏）</td></tr><tr><td><code>requestRefresh()</code></td><td>主动触发下拉刷新</td></tr><tr><td><code>requestLoading()</code></td><td>主动触发上拉加载</td></tr></tbody></table>
<h4 data-id="heading-20">3.2.3 ClassicHeader/ClassicFooter（经典样式）</h4>



























































<table><thead><tr><th>属性名</th><th>类型</th><th>说明</th><th>默认值</th></tr></thead><tbody><tr><td><code>height</code></td><td><code>double</code></td><td>头部/底部高度</td><td><code>60.0</code></td></tr><tr><td><code>idleText</code></td><td><code>String</code></td><td>闲置状态文本</td><td>下拉刷新/上拉加载</td></tr><tr><td><code>refreshingText</code></td><td><code>String</code></td><td>刷新中/加载中文本</td><td>刷新中/加载中</td></tr><tr><td><code>completeText</code></td><td><code>String</code></td><td>完成状态文本</td><td>刷新完成/加载完成</td></tr><tr><td><code>failedText</code></td><td><code>String</code></td><td>失败状态文本</td><td>刷新失败/加载失败</td></tr><tr><td><code>noDataText</code></td><td><code>String</code></td><td>无更多数据文本</td><td>暂无更多数据</td></tr><tr><td><code>textStyle</code></td><td><code>TextStyle</code></td><td>文本样式</td><td>灰色 14 号字</td></tr><tr><td><code>iconSize</code></td><td><code>double</code></td><td>图标大小</td><td><code>20.0</code></td></tr></tbody></table>
<h2 data-id="heading-21">4. 完整代码</h2>
<pre><code class="hljs language-Dart" lang="Dart">
<span class="hljs-keyword">import</span> <span class="hljs-string">'dart:async'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">'package:flutter/material.dart'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">'package:pull_to_refresh/pull_to_refresh.dart'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">'package:waterfall_flow/waterfall_flow.dart'</span>;

<span class="hljs-comment">/// <span class="markdown">本地图片枚举</span></span>
<span class="hljs-keyword">enum</span> ImageEnum {
  banner1,
  banner2,
  banner3,
  model1,
  model2,
  model3,
  model4,
}

<span class="hljs-comment">/// <span class="markdown">为枚举扩展获取图片路径的方法</span></span>
<span class="hljs-keyword">extension</span> ImageEnumExtension <span class="hljs-keyword">on</span> ImageEnum {
  <span class="hljs-built_in">String</span> <span class="hljs-keyword">get</span> path {
    <span class="hljs-keyword">switch</span> (<span class="hljs-keyword">this</span>) {
      <span class="hljs-keyword">case</span> ImageEnum.banner1:
        <span class="hljs-keyword">return</span> <span class="hljs-string">'assets/images/banner1.png'</span>;
      <span class="hljs-keyword">case</span> ImageEnum.banner2:
        <span class="hljs-keyword">return</span> <span class="hljs-string">'assets/images/banner2.png'</span>;
      <span class="hljs-keyword">case</span> ImageEnum.banner3:
        <span class="hljs-keyword">return</span> <span class="hljs-string">'assets/images/banner3.png'</span>;
      <span class="hljs-keyword">case</span> ImageEnum.model1:
        <span class="hljs-keyword">return</span> <span class="hljs-string">'assets/images/model1.png'</span>;
      <span class="hljs-keyword">case</span> ImageEnum.model2:
        <span class="hljs-keyword">return</span> <span class="hljs-string">'assets/images/model2.png'</span>;
      <span class="hljs-keyword">case</span> ImageEnum.model3:
        <span class="hljs-keyword">return</span> <span class="hljs-string">'assets/images/model3.png'</span>;
      <span class="hljs-keyword">case</span> ImageEnum.model4:
        <span class="hljs-keyword">return</span> <span class="hljs-string">'assets/images/model4.png'</span>;
    }
  }
}

<span class="hljs-comment">/// <span class="markdown">瀑布流组件</span></span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ImageWaterfallFlow</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatefulWidget</span> </span>{
  <span class="hljs-keyword">const</span> ImageWaterfallFlow({<span class="hljs-keyword">super</span>.key});

  <span class="hljs-meta">@override</span>
  State&lt;ImageWaterfallFlow&gt; createState() =&gt; ImageWaterfallFlowState();
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ImageWaterfallFlowState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">State</span>&lt;<span class="hljs-title">ImageWaterfallFlow</span>&gt; </span>{
  <span class="hljs-comment">/// <span class="markdown">字体样式</span></span>
  <span class="hljs-keyword">final</span> TextStyle myTxtStyle = <span class="hljs-keyword">const</span> TextStyle(
      color: Colors.white, fontSize: <span class="hljs-number">24</span>, fontWeight: FontWeight.w800);

  <span class="hljs-comment">/// <span class="markdown">模拟数据（初始数据）- 增加泛型提升类型安全</span></span>
  <span class="hljs-built_in">List</span>&lt;ImageEnum&gt; imageList = [
    ImageEnum.banner1,
    ImageEnum.banner2,
    ImageEnum.banner3,
    ImageEnum.model1,
    ImageEnum.model2,
    ImageEnum.model3,
    ImageEnum.model4,
    ImageEnum.banner1,
    ImageEnum.banner2,
    ImageEnum.banner3,
    ImageEnum.model1,
    ImageEnum.model2,
    ImageEnum.model3,
    ImageEnum.model4
  ];

  <span class="hljs-comment">/// <span class="markdown">模拟数据（加载更多使用）</span></span>
  <span class="hljs-built_in">List</span>&lt;ImageEnum&gt; moreList = [ImageEnum.banner1, ImageEnum.banner2, ImageEnum.banner3];

  <span class="hljs-comment">/// <span class="markdown">上拉下拉控制器</span></span>
  <span class="hljs-keyword">final</span> RefreshController myRefreshController = RefreshController();

  <span class="hljs-comment">/// <span class="markdown">刷新</span></span>
  <span class="hljs-keyword">void</span> onRefresh() <span class="hljs-keyword">async</span> {
    <span class="hljs-keyword">await</span> Future.delayed(<span class="hljs-keyword">const</span> <span class="hljs-built_in">Duration</span>(milliseconds: <span class="hljs-number">1000</span>));
    <span class="hljs-comment">// 模拟刷新：恢复初始数据</span>
    setState(() {
      imageList = [
        ImageEnum.banner1,
        ImageEnum.banner2,
        ImageEnum.banner3,
        ImageEnum.model1,
        ImageEnum.model2,
        ImageEnum.model3,
        ImageEnum.model4,
        ImageEnum.banner1,
        ImageEnum.banner2,
        ImageEnum.banner3,
        ImageEnum.model1,
        ImageEnum.model2,
        ImageEnum.model3,
        ImageEnum.model4
      ];
    });
    myRefreshController.refreshCompleted();
    myRefreshController.resetNoData(); <span class="hljs-comment">// 重置无更多数据状态</span>
  }

  <span class="hljs-comment">/// <span class="markdown">加载更多</span></span>
  <span class="hljs-keyword">void</span> onLoadMore() <span class="hljs-keyword">async</span> {
    <span class="hljs-keyword">await</span> Future.delayed(<span class="hljs-keyword">const</span> <span class="hljs-built_in">Duration</span>(milliseconds: <span class="hljs-number">1000</span>));
    <span class="hljs-comment">// 模拟：数据超过30条时标记无更多数据</span>
    <span class="hljs-keyword">if</span> (imageList.length &gt;= <span class="hljs-number">30</span>) {
      myRefreshController.loadNoData();
    } <span class="hljs-keyword">else</span> {
      imageList.addAll(moreList);
      <span class="hljs-keyword">if</span> (mounted) {
        setState(() {});
      }
      myRefreshController.loadComplete();
    }
  }

  <span class="hljs-meta">@override</span>
  <span class="hljs-keyword">void</span> dispose() {
    myRefreshController.dispose(); <span class="hljs-comment">// 释放控制器资源</span>
    <span class="hljs-keyword">super</span>.dispose();
  }

  <span class="hljs-comment">/// <span class="markdown">布局</span></span>
  <span class="hljs-meta">@override</span>
  Widget build(BuildContext context) {
    <span class="hljs-keyword">return</span> Scaffold(
        backgroundColor: Colors.black,
        body: SafeArea(
            child: SizedBox(
                width: MediaQuery.of(context).size.width,
                height: MediaQuery.of(context).size.height,
                child: listWidget())));
  }

  <span class="hljs-comment">/// <span class="markdown">列表</span></span>
  Widget listWidget() {
    <span class="hljs-keyword">return</span> SmartRefresher(
      enablePullDown: <span class="hljs-keyword">true</span>,
      enablePullUp: <span class="hljs-keyword">true</span>,
      header: <span class="hljs-keyword">const</span> ClassicHeader(),
      footer: <span class="hljs-keyword">const</span> ClassicFooter(),
      controller: myRefreshController,
      onRefresh: onRefresh,
      onLoading: onLoadMore,
      child: WaterfallFlow.builder(
        padding: <span class="hljs-keyword">const</span> EdgeInsets.all(<span class="hljs-number">10</span>),
        physics: <span class="hljs-keyword">const</span> BouncingScrollPhysics(),
        gridDelegate: SliverWaterfallFlowDelegateWithFixedCrossAxisCount(
          crossAxisCount: <span class="hljs-number">2</span>,
          crossAxisSpacing: <span class="hljs-number">20</span>,
          mainAxisSpacing: <span class="hljs-number">20</span>,
          viewportBuilder: (<span class="hljs-built_in">int</span> index1, <span class="hljs-built_in">int</span> index2) {
            <span class="hljs-built_in">print</span>(<span class="hljs-string">'变化：<span class="hljs-subst">$index1</span>-<span class="hljs-subst">$index2</span>'</span>);
          },
          <span class="hljs-comment">// 修正最后一个子项的判断逻辑</span>
          lastChildLayoutTypeBuilder: (index) =&gt; index == imageList.length - <span class="hljs-number">1</span>
              ? LastChildLayoutType.fullCrossAxisExtent
              : LastChildLayoutType.none,
        ),
        itemCount: imageList.length,
        itemBuilder: (BuildContext context, <span class="hljs-built_in">int</span> index) {
          <span class="hljs-keyword">return</span> Container(
            color: Colors.white,
            height: (index + <span class="hljs-number">1</span>) % <span class="hljs-number">2</span> == <span class="hljs-number">0</span> ? <span class="hljs-number">100</span> : <span class="hljs-number">200</span>,
            child: Container(
                alignment: Alignment.center,
                decoration: BoxDecoration(
                    color: Colors.blue.shade300,
                    image: DecorationImage(
                      image: AssetImage(imageList[index].path),
                      fit: BoxFit.cover,
                    )),
                child: Text(<span class="hljs-string">'第<span class="hljs-subst">${index + <span class="hljs-number">1</span>}</span>张'</span>, style: myTxtStyle)),
          );
        },
      ),
    );
  }
}
</code></pre>
<h2 data-id="heading-22">5. 常见问题 &amp; 解决方案</h2>
<ol>
<li>
<p><strong>图片不显示</strong></p>
<ul>
<li>
<p>检查 <code>pubspec.yaml</code> 中 <code>assets</code> 配置路径是否与实际图片存放路径一致。</p>
</li>
<li>
<p>执行 <code>flutter clean</code> 清理缓存后，重新运行项目。</p>
</li>
<li>
<p>确认枚举扩展方法 <code>path</code> 返回的路径正确。</p>
</li>
</ul>
</li>
<li>
<p><strong>加载更多无响应</strong></p>
<ul>
<li>
<p>确认 <code>SmartRefresher</code> 的 <code>enablePullUp</code> 属性设置为 <code>true</code>。</p>
</li>
<li>
<p>检查 <code>RefreshController</code> 是否正确关联到 <code>SmartRefresher</code>。</p>
</li>
<li>
<p>确保 <code>onLoading</code> 回调方法已正确绑定。</p>
</li>
</ul>
</li>
<li>
<p><strong>瀑布流布局错乱</strong></p>
<ul>
<li>
<p>避免子项高度差异过大，可根据实际需求调整高度规则。</p>
</li>
<li>
<p>检查 <code>crossAxisCount</code>、<code>crossAxisSpacing</code> 等参数配置是否冲突。</p>
</li>
<li>
<p>确认 <code>lastChildLayoutTypeBuilder</code> 的索引判断逻辑正确。</p>
</li>
</ul>
</li>
<li>
<p><strong>内存泄漏</strong></p>
<ul>
<li>
<p>务必在 <code>dispose</code> 方法中调用 <code>myRefreshController.dispose()</code> 释放控制器。</p>
</li>
<li>
<p>避免在异步操作中未判断 <code>mounted</code> 就调用 <code>setState</code>。</p>
</li>
</ul>
</li>
</ol>
<h2 data-id="heading-23">6. 总结</h2>
<p>通过 <code>waterfall_flow</code> 和 <code>pull_to_refresh</code> 两个第三方库，我们快速实现了 Flutter 瀑布流布局，并集成了下拉刷新和上拉加载更多功能。</p>
<p>该方案可直接应用于图片列表、商品展示等常见业务场景，也可根据实际需求扩展子项点击、图片懒加载、自定义刷新样式等功能。</p>
<p>希望这篇文章能帮助你理解并在自己的 Flutter 项目中运用类似的功能。</p>
<hr/>
<blockquote>
<p>本次分享就到这儿啦，我是鹏多多，深耕前端的技术创作者，如果您看了觉得有帮助，欢迎评论，关注，点赞，转发，我们下次见~</p>
</blockquote>
<p>PS：在本页按F12，在console中输入document.getElementsByClassName('panel-btn')[0].click();有惊喜哦~</p>
<p><code>往期文章</code></p>
<ul>
<li><a href="https://juejin.cn/post/7583910637958807571" target="_blank" title="https://juejin.cn/post/7583910637958807571">flutter使用package_info_plus库获取应用信息的教程</a></li>
<li><a href="https://juejin.cn/post/7588680081327259690" target="_blank" title="https://juejin.cn/post/7588680081327259690">Flutter下拉刷新上拉加载侧拉刷新插件：easy_refresh全面使用指南</a></li>
<li><a href="https://juejin.cn/post/7583226204036513833" target="_blank" title="https://juejin.cn/post/7583226204036513833">flutter-使用EventBus实现组件间数据通信</a></li>
<li><a href="https://juejin.cn/post/7582808491582619684" target="_blank" title="https://juejin.cn/post/7582808491582619684">Flutter输入框TextField的属性与实战用法全面解析+示例</a></li>
<li><a href="https://juejin.cn/post/7581693431740448831" target="_blank" title="https://juejin.cn/post/7581693431740448831">Flutter自定义日历table_calendar完全指南+案例</a></li>
<li><a href="https://juejin.cn/post/7580389111921786943" target="_blank" title="https://juejin.cn/post/7580389111921786943">flutter-屏幕自适应插件flutter_screenutil教程全指南</a></li>
<li><a href="https://juejin.cn/post/7579101504289882166" target="_blank" title="https://juejin.cn/post/7579101504289882166">flutter-使用url_launcher打开链接/应用/短信/邮件和评分跳转等</a></li>
<li><a href="https://juejin.cn/post/7570923924365230143" target="_blank" title="https://juejin.cn/post/7570923924365230143">flutter图片选择库multi_image_picker_plus和image_picker的对比和使用解析</a></li>
<li><a href="https://juejin.cn/post/7568136081302978623" target="_blank" title="https://juejin.cn/post/7568136081302978623">解锁flutter弹窗新姿势：dialog-flutter_smart_dialog插件解读+案例</a></li>
<li><a href="https://juejin.cn/post/7559089440901545999" target="_blank" title="https://juejin.cn/post/7559089440901545999">flutter-切换状态显示不同组件10种实现方案全解析</a></li>
<li><a href="https://juejin.cn/post/7555079970491318308" target="_blank" title="https://juejin.cn/post/7555079970491318308">flutter-详解控制组件显示的两种方式Offstage与Visibility</a></li>
<li><a href="https://juejin.cn/post/7535358416182788122" target="_blank" title="https://juejin.cn/post/7535358416182788122">flutter-使用AnimatedDefaultTextStyle实现文本动画</a></li>
<li><a href="https://juejin.cn/post/7537339432291434496" target="_blank" title="https://juejin.cn/post/7537339432291434496">flutter-使用SafeArea组件处理各机型的安全距离</a></li>
<li><a href="https://juejin.cn/spost/7537593417099149321" target="_blank" title="https://juejin.cn/spost/7537593417099149321">flutter-实现渐变色边框背景以及渐变色文字</a></li>
<li><a href="https://juejin.cn/post/7543474419240370185" target="_blank" title="https://juejin.cn/post/7543474419240370185">flutter-使用confetti制作炫酷纸屑爆炸粒子动画</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[TINYINT(1) 类型的字段，明明数据存的是 2，为什么查出来是 true]]></title>    <link>https://juejin.cn/post/7596187471774220297</link>    <guid>https://juejin.cn/post/7596187471774220297</guid>    <pubDate>2026-01-19T00:52:58.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7596187471774220297" data-draft-id="7596092713080160292" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="TINYINT(1) 类型的字段，明明数据存的是 2，为什么查出来是 true"/> <meta itemprop="keywords" content="Java,后端"/> <meta itemprop="datePublished" content="2026-01-19T00:52:58.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="青石路"/> <meta itemprop="url" content="https://juejin.cn/user/1999357021005580"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            TINYINT(1) 类型的字段，明明数据存的是 2，为什么查出来是 true
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1999357021005580/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    青石路
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-19T00:52:58.000Z" title="Mon Jan 19 2026 00:52:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-19
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读12分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">开心一刻</h2>
<p>大学期间，跟初恋谈了一段刻骨铭心的恋情，因为某些原因，大学毕业后分手了。<br/>
如今大学毕业已经10年，听说她很早就出国了，而我，很早就成的哥了。<br/>
昨天，初恋坐上了我的的车，我一眼就认出了她，她亦如当初模样，而我却满脸沧桑。<br/>
我不敢打招呼，默默的听着她打电话，讲述着国外的种种。<br/>
快到目的地的时候，她放下了电话说：我已经把我这10年的经历都说给你听了，你连句你好都不说吗<br/>
我知道电话那头没有任何人，她是故意说给我听的，我哽咽着颤抖的说到：你好<br/>
她深情的看着我，问道：我们还回得去吗<br/>
我疑惑的望向她，说到：回去？回去可以啊，但得加钱......</p>
<div align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8b623cc4f4d84f06a933e9f6a4b78e51~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2S55-z6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769388778&amp;x-signature=UCgo57KvQp6PjvWI9mM4Z4Dg1Z8%3D" loading="lazy"/></div>
<h2 data-id="heading-1">TINYINT</h2>
<p>关于 <code>TINYINT</code>，我相信大家都知道它，是数据库的一种数据类型，说的详细点，它是数据库的一种数字类型，再详细点，它是数据库的一种整数类型；需要注意的是，它并非 SQL 标准整数类型</p>
<blockquote>
<p>SQL标准整数类型：INTEGER<code>(or</code>INT<code>) and </code>SMALLINT</p>
</blockquote>
<p>而是某些数据库的拓展整数类型，所以并非所有的关系型数据库都支持 TINYINT，支持的数据库类型包括 <code>MySQL</code>、<code>MariaDB</code>、<code>SQL Server</code>；我们基于 <code>MySQL</code> 来看看 TINYINT</p>
<p>MySQL 官方对<a href="https://link.juejin.cn?target=https%3A%2F%2Fdev.mysql.com%2Fdoc%2Frefman%2F8.0%2Fen%2Finteger-types.html" target="_blank" title="https://dev.mysql.com/doc/refman/8.0/en/integer-types.html" ref="nofollow noopener noreferrer">整数类型</a>有如下介绍</p>
<div align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7954ef6c82c34d06ae98f0a59164fe8a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2S55-z6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769388778&amp;x-signature=lf%2BW6Ku%2FSWWlhjGWazMOVeNjQRM%3D" alt="整数类型" loading="lazy"/></div>
<p>除了 <code>TINYINT</code>，MySQL 还拓展出了 <code>MEDIUMINT</code> 和 <code>BIGINT</code>，这些都不是 SQL 标准整数类型，在做不同库数据迁移的时候需要考虑这些点</p>
<blockquote>
<p>标准 SQL，便于迁移；做表设计的时候，尽量用 SQL 标准数据类型</p>
</blockquote>
<p>TINYINT 存储空间占 <strong>1</strong> 字节，有符号的值范围是 -128 到 127，无符号的值范围是 0 到 255</p>
<p>TINYINT 的基本介绍已经完成，下面开始实操环节，开始之前我先问你们一个问题</p>
<blockquote>
<p>在实际项目中，你们一般用 TINYINT 存什么 ？</p>
</blockquote>
<p>是不是用来存枚举值？例如这样</p>
<pre><code class="hljs language-sql" lang="sql">`exec_status` TINYINT <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span> COMMENT <span class="hljs-string">'执行-状态，0：等待中，1：执行中，2：成功，3：失败，4：终止'</span>
</code></pre>
<p>甚至在枚举值少的时候，会使用 <code>TINYINT(1)</code>，对不对？重点来了</p>
<div align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9e5348d482b9469ba64914a1c843bfe6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2S55-z6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769388778&amp;x-signature=CzmiCYWD9m%2Bwj6dtc1inH6d4la4%3D" alt="640 (8)" loading="lazy"/></div>
<p>TINYINT(1) 中的 <code>1</code> 表示什么？很多小伙伴会理所当然的回答道：<strong>数值范围</strong>，TINYINT(1) 表示的是数值范围是 -9 到 9，或者 0 ~ 9</p>
<p>对不对呢？我们验证下就知道了。基于 MySQL 8.0.31，我们创建表</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `tbl_qsl_job` (
  `id` <span class="hljs-type">int</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'主键'</span>,
  `exec_status` tinyint(<span class="hljs-number">1</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span> COMMENT <span class="hljs-string">'执行-状态，0：等待中，1：执行中，2：成功，3：失败，4：终止'</span>,
  <span class="hljs-keyword">PRIMARY</span> KEY (`id`)
) ENGINE<span class="hljs-operator">=</span>InnoDB;
</code></pre>
<p>插入一条记录</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> tbl_qsl_job(id, exec_status) <span class="hljs-keyword">VALUES</span>(<span class="hljs-number">1</span>, <span class="hljs-number">12</span>);
</code></pre>
<p>结果会怎么样，超出范围报错？</p>
<p>实际是插入成功</p>
<div align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d652228759de4797a72222631883d3f5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2S55-z6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769388778&amp;x-signature=1oB02PdZn2uYzOYm%2FX6Ka3p8%2FHw%3D" alt="tinyint1_插入12成功" loading="lazy"/></div>
<p>道心是不是碎了一地？</p>
<div align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/026b9f61ec744a0e91584559c5464fb1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2S55-z6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769388778&amp;x-signature=qFrgQYtgDkZbAvrYBsl2U%2B8rMcs%3D" alt="掀桌子" loading="lazy"/></div>
<p>给你们 10 秒钟，收拾下破碎的道心；收拾好了之后我们一起看看官方说明：<a href="https://link.juejin.cn?target=https%3A%2F%2Fdev.mysql.com%2Fdoc%2Frefman%2F5.7%2Fen%2Fnumeric-type-attributes.html" target="_blank" title="https://dev.mysql.com/doc/refman/5.7/en/numeric-type-attributes.html" ref="nofollow noopener noreferrer">Numeric Type Attributes</a></p>
<blockquote>
<p>MySQL supports an extension for optionally specifying the display width of integer data types in parentheses following the base keyword for the type. For example, <a href="https://link.juejin.cn?target=https%3A%2F%2Fdev.mysql.com%2Fdoc%2Frefman%2F5.7%2Fen%2Finteger-types.html" target="_blank" title="https://dev.mysql.com/doc/refman/5.7/en/integer-types.html" ref="nofollow noopener noreferrer"><code>INT(4)</code></a> specifies an <a href="https://link.juejin.cn?target=https%3A%2F%2Fdev.mysql.com%2Fdoc%2Frefman%2F5.7%2Fen%2Finteger-types.html" target="_blank" title="https://dev.mysql.com/doc/refman/5.7/en/integer-types.html" ref="nofollow noopener noreferrer"><code>INT</code></a> with a display width of four digits. This optional display width may be used by applications to display integer values having a width less than the width specified for the column by left-padding them with spaces. (That is, this width is present in the metadata returned with result sets. Whether it is used is up to the application.)</p>
<p>The display width does <em>not</em> constrain the range of values that can be stored in the column. Nor does it prevent values wider than the column display width from being displayed correctly. For example, a column specified as <a href="https://link.juejin.cn?target=https%3A%2F%2Fdev.mysql.com%2Fdoc%2Frefman%2F5.7%2Fen%2Finteger-types.html" target="_blank" title="https://dev.mysql.com/doc/refman/5.7/en/integer-types.html" ref="nofollow noopener noreferrer"><code>SMALLINT(3)</code></a> has the usual <a href="https://link.juejin.cn?target=https%3A%2F%2Fdev.mysql.com%2Fdoc%2Frefman%2F5.7%2Fen%2Finteger-types.html" target="_blank" title="https://dev.mysql.com/doc/refman/5.7/en/integer-types.html" ref="nofollow noopener noreferrer"><code>SMALLINT</code></a> range of <code>-32768</code> to <code>32767</code>, and values outside the range permitted by three digits are displayed in full using more than three digits.</p>
</blockquote>
<p>相信你们都能看懂，INT(n) 中的 n 表示的是显示宽度，INT(4) 表示的是显示宽度为四位数的 INT。应用程序可以采用左填充空格的方式来填充宽度不够列指定宽度的整数值（也就是说，此宽度会作为结果集的元数据返回，是否使用取决于应用程序）</p>
<p>显示宽度不会限制列存储的数值范围，也不会截断比列显示宽度更宽的值。例如，SMALLINT(3) 类型的列的存数范围与 SMALLINT 一样，也是 32768 到 32767，超出三位数的值会完整显示</p>
<p>关于整数类型显示宽度，我们可以进行如下总结</p>
<blockquote>
<p>类型后面的 n，是显示宽度，表示显示时最少占 n 个字符宽度，既不会限制列存储的数值范围，也不会截断比列显示宽度更宽的值，</p>
<p>显示宽度会作为结果集的元数据返回，是否使用取决于应用程序（这个伏笔，后面会呼应，值得我们留意）</p>
</blockquote>
<h2 data-id="heading-2">2 变 true</h2>
<p>我们把 tbl_qsl_job 中 id = 1 的记录的状态改成 2（因为没有枚举值 12）</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">UPDATE</span> tbl_qsl_job <span class="hljs-keyword">SET</span> exec_status <span class="hljs-operator">=</span> <span class="hljs-number">2</span> <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;
</code></pre>
<p>基于 <code>SpringBoot 2.7.18</code>、<code>spring-jdbc 5.3.31 </code>、<code>HikariCP 4.0.3</code>、<code>mysql-connector-java 8.0.25 </code> 构建查询</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.qsl;

<span class="hljs-keyword">import</span> org.junit.jupiter.api.Test;
<span class="hljs-keyword">import</span> org.springframework.boot.test.context.SpringBootTest;
<span class="hljs-keyword">import</span> org.springframework.jdbc.core.JdbcTemplate;
<span class="hljs-keyword">import</span> org.springframework.jdbc.support.rowset.SqlRowSet;
<span class="hljs-keyword">import</span> org.springframework.jdbc.support.rowset.SqlRowSetMetaData;

<span class="hljs-keyword">import</span> javax.annotation.Resource;

<span class="hljs-comment">/**
 * <span class="hljs-doctag">@author</span> youzb
 */</span>
<span class="hljs-meta">@SpringBootTest(classes = Application.class)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">QslJobTest</span> {

    <span class="hljs-meta">@Resource</span>
    <span class="hljs-keyword">private</span> JdbcTemplate jdbcTemplate;

    <span class="hljs-meta">@Test</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">getByJdbcTemplate</span><span class="hljs-params">()</span> {
        <span class="hljs-type">SqlRowSet</span> <span class="hljs-variable">sqlRowSet</span> <span class="hljs-operator">=</span> jdbcTemplate.queryForRowSet(<span class="hljs-string">"SELECT * FROM tbl_qsl_job WHERE id = 1"</span>);
        <span class="hljs-type">SqlRowSetMetaData</span> <span class="hljs-variable">metaData</span> <span class="hljs-operator">=</span> sqlRowSet.getMetaData();
        <span class="hljs-keyword">while</span> (sqlRowSet.next()) {
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; i &lt;= metaData.getColumnCount(); i++) {
                System.out.print(sqlRowSet.getObject(i) + <span class="hljs-string">" "</span>);
            }
            System.out.println();
        }
    }
}
</code></pre>
<p>你们觉得执行结果是怎样的，是不是 <code>1 2</code> 呢</p>
<div align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/946a8759e5fc4be6a56131afd931d3f7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2S55-z6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769388778&amp;x-signature=u34nfFES62%2Brsrs%2Fbw0NflHfdbk%3D" alt="2变true" loading="lazy"/></div>
<p>可以看到，结果并不是 <code>1 2</code>，而是 <code>1 true</code>，是不是有点懵？</p>
<blockquote>
<p>明明数据存的是 2，为什么查出来结果是 true？</p>
</blockquote>
<div align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/70cd22fda54948c89c700fe93addacbb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2S55-z6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769388778&amp;x-signature=0F7r7ZHoz3tvnvqiAk4xUeBcWoY%3D" alt="懵" width="200px" loading="lazy"/></div>
<p>首先我们可以确定的是，数据库存储的值是没问题的，因为通过 <code>navicat</code> 查到的结果是 2（也说明 navicat 没有对这个值做特殊转换）</p>
<div align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b373c48e9e5d477993a6a98078bfd186~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2S55-z6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769388778&amp;x-signature=tAIBubDy711e9jXXYbCoLJlP40M%3D" alt="数据库中值是2" loading="lazy"/></div>
<p>回到我们的程序，数据库中的 2 到程序控制台的 true，经过了那些环节，我们是不是能整理出来？</p>
<div align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5f92629d4a794f4b8f328c7d40019476~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2S55-z6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769388778&amp;x-signature=FrVqoS8kIZ0yh5B33ZhVrCf9%2BkE%3D" alt="数据流转" loading="lazy"/></div>
<p>数据库我们已经确定没问题了，至于是 <code>mysql-connector-java 8.0.25</code>、<code>HikariCP 4.0.3</code>、<code>spring-jdbc 5.3.31</code> 谁做了特殊处理，需要我们进一步排查了；最直接的方式就是 <code>Debug</code> 嘛，断点我已经替你们打好</p>
<div align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a86e8c1ae47d487bb0281e08ee6dcbb8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2S55-z6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769388778&amp;x-signature=MNd9nHp7msD4dBJYDT3n4%2B2VZg0%3D" alt="断点debug" loading="lazy"/></div>
<p>此时到了 MySQL JDBC 驱动里面，我们来看一下 <code>this.results</code> 的信息，有几个点值得我们重点关注下</p>
<ol>
<li>
<p>连接元信息</p>
<div align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/42179fa302f141a68d4b2483ea0ac2f9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2S55-z6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769388778&amp;x-signature=JJxWdWvwbnCQAy8XcxI%2FJEQmp5o%3D" alt="连接元信息" loading="lazy"/></div>
<p>我们配置的连接 url 是</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">spring:</span>
  <span class="hljs-attr">datasource:</span>
    <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://localhost:3306/fnj_test?useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=false&amp;serverTimezone=UTC</span>
</code></pre>
<p>并未设置 <code>tinyint1isBit</code> 值，所以其值 true 是 <code>mysql-connector-java 8.0.25</code> 给的默认值</p>
</li>
<li>
<p>列元信息</p>
<div align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/78e230e1eedc4820b837b2f42f976798~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2S55-z6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769388778&amp;x-signature=%2Fb2sb8n3XUKJZB%2BOscwO44jIA9I%3D" alt="列元信息" loading="lazy"/></div>
<p>可以看到，字段 exec_status 的 length = 1，这个 length 表示什么呢，因为列 exec_status 的类型是整数类型，所以这个 length 是不是就是 <code>显示宽度</code> ？不然还能代表什么？</p>
<p>最重要的来了，<code>mysqlType</code> 的 <code>name</code> 是 <code>BIT</code></p>
<div align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f47f3d55e3cb49db976b36f255c884ba~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2S55-z6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769388778&amp;x-signature=fiCGY7jaOA240Ax1xqOyeo7V6t8%3D" alt="mysqltype_bit" loading="lazy"/></div>
<p>也就是说，mysql-connector-java 8.0.25 把 TINYINT(1) 解析成了 MysqlType.BIT，对应的 JAVA 类型就是 <code>Boolean</code></p>
</li>
</ol>
<p>既然 exec_status 的 JAVA 类型被解析成了 Boolean，其值 2 也就被解析成 true 了，所以标题的答案是不是就清楚了</p>
<blockquote>
<p>mysql-connector-java 8.0.25 默认情况下，把 TINYINT(1) 解析成 JAVA 的 Boolean</p>
</blockquote>
<p>问题又来了，mysql-connector-java 8.0.25 对 TINYINT 的解析逻辑是怎样的呢？我们跟下源码就知道了</p>
<div align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fe5505a036f14cb5b0dd03e4b41e26e3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2S55-z6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769388778&amp;x-signature=2hyjtI76r4oGTaree297H9pvGmg%3D" alt="mysqlType赋值逻辑" loading="lazy"/></div>
<p>我们先定位到 <code>com.mysql.cj.protocol.a.ColumnDefinitionReader</code> 的 180 行，然后往上找到 <code>mysqlType</code> 赋值的地方（ColumnDefinitionReade 134 行）</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">MysqlType</span> <span class="hljs-variable">mysqlType</span> <span class="hljs-operator">=</span> NativeProtocol.findMysqlType(<span class="hljs-built_in">this</span>.protocol.getPropertySet(), colType, colFlag, colLength, tableName, originalTableName,
                collationIndex, encoding);
</code></pre>
<p>跟进 NativeProtocol.findMysqlType，我们能看到这样一段代码</p>
<div align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1cb7a5a55af446ed838c0ca17642f3ad~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2S55-z6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769388778&amp;x-signature=s9zFKBuObdYZytiLNTAd8LSgfro%3D" alt="tinyint赋值逻辑" loading="lazy"/></div>
<p>第一个 if，我们分几部分解析下</p>
<ol>
<li>
<p>isUnsigned</p>
<p>表示是否无符号，建表的时候，exec_status 并未明确指定 <code>UNSIGNED</code>，所以是有符号的，那么 isUnsigned 值是 false，取反则是 true</p>
</li>
<li>
<p>length</p>
<p>表字段的显示宽度，也就是 TINYINT(1) 中的 1，所以 length == 1 的结果是 true</p>
</li>
<li>
<p>tinyInt1isBit</p>
<p>mysql-connector-java 8.0.25 的 <code>PropertyDefinitions</code> 会静态初始化很多属性默认值，其中就包括 tinyInt1isBit</p>
<div align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/706dc20a707e48a3ad5cf1bd835f2dc1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2S55-z6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769388778&amp;x-signature=L3UKnG1Y3Mv2D9v7ziZR6l28QKY%3D" alt="tinyInt1isBit默认值" loading="lazy"/></div>
<p>tinyInt1isBit 的默认值是 true</p>
<p>如果我们在数据库连接 url 中增加 <code>tinyInt1isBit=false</code></p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">spring:</span>
  <span class="hljs-attr">datasource:</span>
    <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://localhost:3306/fnj_test?useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=false&amp;serverTimezone=UTC&amp;tinyInt1isBit=false</span>
</code></pre>
<p>那么配置值会覆盖默认值</p>
<div align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7a6fa1f5a3ca43f6ad822597a48f5987~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2S55-z6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769388778&amp;x-signature=N9dH77n9qd9Gx6cYfZ1hX3khQBw%3D" alt="tinyInt1isBit值覆盖" loading="lazy"/></div>
<pre><code class="hljs language-java" lang="java">setValueInternal(extractedValue, exceptionInterceptor);
<span class="hljs-built_in">this</span>.initialValue = <span class="hljs-built_in">this</span>.value;
</code></pre>
<p>这两行会分别将 <code>value</code> 和 <code>initialValue</code> 设置成 <code>false</code></p>
<p>回到 url 未配置 tinyInt1isBit 的情况，tinyInt1isBit 的值是默认值 true</p>
</li>
<li>
<p>内嵌 if 的 transformedBitIsBoolean</p>
<p>在分析 tinyInt1isBit 默认值的时候，也红框框住过 transformedBitIsBoolean 的默认值，是 false；没注意的小伙伴，可以往上翻一翻</p>
</li>
</ol>
<p>所以 NativeProtocol.findMysqlType 的返回值是 <code>MysqlType.BIT</code>。如果 length &gt; 1，那么返回的则是 <code>MysqlType.TINYINT_UNSIGNED</code> 或 <code>MysqlType.TINYINT</code></p>
<p>自此，来龙去脉是不是清楚呢？</p>
<h2 data-id="heading-3">问题处理</h2>
<p>既然已经找到问题原因，那么处理方式也就清晰了，有如下几种</p>
<ol>
<li>
<p>url 中配置 tinyInt1isBit=false</p>
<p>这个会全局生效，有些需要将 TINYINT(1) 映射成 Boolean 的情况，会出问题</p>
<p>老项目不推荐增加该配置，除非确定整个项目中没有 TINYINT(1) 映射成 Boolean 的情况</p>
<p>新项目的话，可以增加该配置</p>
</li>
<li>
<p>字段类型调整成无符号</p>
<p>增加 <code>UNSIGNED</code> 修饰，例如</p>
<pre><code class="hljs language-sql" lang="sql">`exec_status` tinyint(<span class="hljs-number">1</span>) unsigned <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span> COMMENT <span class="hljs-string">'执行-状态，0：等待中，1：执行中，2：成功，3：失败，4：终止'</span>,
</code></pre>
<p>但有个前提，枚举值不能出现负数</p>
</li>
<li>
<p>调大字段类型显示宽度</p>
<p>直接使用 TINYINT(4) 或 TINYINT</p>
</li>
</ol>
<h2 data-id="heading-4">举一反三</h2>
<p>既然是 mysql-connector-java 8.0.25 做了默认值的处理，那么 MyBatis-Plus 查的结果是不是也是将 2 处理成 true 呢？我们试一下就知道了，引入 MyBatis-Plus 3.5.7，测试代码很简单</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@TableName("tbl_qsl_job")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">QslJob</span> {

    <span class="hljs-keyword">private</span> Integer id;
    <span class="hljs-keyword">private</span> Integer execStatus;

    <span class="hljs-keyword">public</span> Integer <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> id;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setId</span><span class="hljs-params">(Integer id)</span> {
        <span class="hljs-built_in">this</span>.id = id;
    }

    <span class="hljs-keyword">public</span> Integer <span class="hljs-title function_">getExecStatus</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> execStatus;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setExecStatus</span><span class="hljs-params">(Integer execStatus)</span> {
        <span class="hljs-built_in">this</span>.execStatus = execStatus;
    }
}

	<span class="hljs-meta">@Resource</span>
    <span class="hljs-keyword">private</span> QslJobDao qslJobDao;
    
    <span class="hljs-meta">@Test</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testMybatisPlus</span><span class="hljs-params">()</span> {
        <span class="hljs-type">QslJob</span> <span class="hljs-variable">qslJob</span> <span class="hljs-operator">=</span> qslJobDao.selectById(<span class="hljs-number">1</span>);
        System.out.println(qslJob.getId() + <span class="hljs-string">" "</span> + qslJob.getExecStatus());
    }
</code></pre>
<p>你们觉得执行结果是怎样的，报错？输出 1 true？还是输出 1 2？执行下就知道了</p>
<div align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2af4871715734a13a836d862c57ce248~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2S55-z6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769388778&amp;x-signature=0Bc7jiQqyWLeX0W4i6jXPbaDUJ8%3D" alt="tinyint(1)_mybatis-plus" loading="lazy"/></div>
<p>查询结果正常！</p>
<p>按前面的分析，mysql-connector-java 8.0.25 返回 exec_status 的值是 true，Boolean 强转 Integer 会报错，即使不报错，结果也应该是 1（0 = false，1 = true）嘛，怎么会是 2 呢？</p>
<div align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/729d178a304744fea5fadfc5a276d02b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2S55-z6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769388778&amp;x-signature=gZjw0177nx68wA6xAX5Sunz%2F8TA%3D" alt="好难 不该学编程的" loading="lazy"/></div>
<p>Debug 下你们就明白了</p>
<div align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6629435ca50b43d5836c5c62eb2e42a3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2S55-z6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769388778&amp;x-signature=tJLcyQBGHlMzD%2BXq5s1MTgPSBYA%3D" alt="mybatis_getInt" loading="lazy"/></div>
<p>Mybatis 需要将 mysql-connector-java 8.0.25 查到的 ResultSet 映射成 QslJob，就需要用到类型处理器；QslJob 实体的 execStatus 是 Integer 类型的，那肯定用 IntegerTypeHandler 进行处理嘛，自然而然就用到 <code>rs.getInt</code> ，查到的结果自然就是 2 了。</p>
<p>我们再回过头去看 <code>SqlRowSet</code>，如果我们用 sqlRowSet.getInt 替换 sqlRowSet.getObject，是不是就行了？</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Test</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">getByJdbcTemplate</span><span class="hljs-params">()</span> {
    <span class="hljs-type">SqlRowSet</span> <span class="hljs-variable">sqlRowSet</span> <span class="hljs-operator">=</span> jdbcTemplate.queryForRowSet(<span class="hljs-string">"SELECT * FROM tbl_qsl_job WHERE id = 1"</span>);
    <span class="hljs-type">SqlRowSetMetaData</span> <span class="hljs-variable">metaData</span> <span class="hljs-operator">=</span> sqlRowSet.getMetaData();
    <span class="hljs-keyword">while</span> (sqlRowSet.next()) {
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; i &lt;= metaData.getColumnCount(); i++) {
            System.out.print(sqlRowSet.getInt(i) + <span class="hljs-string">" "</span>);
        }
        System.out.println();
    }
}
</code></pre>
<p>运行下，我们会发现报错了</p>
<div align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9a9d4eaad5a6416ea89ae9355bc0084b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2S55-z6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769388778&amp;x-signature=tn50XPEpb0kAOvxtsXJVCPrqMKo%3D" alt="getInt报" loading="lazy"/></div>
<p>这又是为什么？</p>
<p>原因在 JdbcTemplate 的数据提取</p>
<div align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4fb16964702240f2897f01f5cd114d50~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2S55-z6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769388778&amp;x-signature=ZIgN2j45ALRnQ2F8NhGId2gn1P8%3D" alt="extractData" loading="lazy"/></div>
<p>我们对 rs 进行一下 Evaluate，结果如下</p>
<div align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e558d0b785cd43289f037d0761f0f85e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2S55-z6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769388778&amp;x-signature=jlyv96BSAUY8bddOrGyqcZGtXLk%3D" alt="rs_evaluate" loading="lazy"/></div>
<p>此时 rs.getInt 能正常获取到 2，这说明什么？</p>
<blockquote>
<p>mysql-connector-java 8.0.25 虽然把 TINYINT(1) 映射成了 JAVA 的 Boolean，但其查到的 ResultSet 中的数据仍是与数据库中数据一致的原始数据</p>
<p>HikariCP 4.0.3 也并未对原始数据做转换处理</p>
</blockquote>
<p>我们继续跟进 rse.extractData(rs)，跟进两层会来到关键点</p>
<div align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d32fbbb5cec040128fac0d0839d4eeb0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2S55-z6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769388778&amp;x-signature=gYKAZ2eLh6%2BOd%2BX42Xg7XUA2j70%3D" alt="cachedRowSet" loading="lazy"/></div>
<p>rowSet.populate(rs) 会把 ResultSet rs 中的数据填充到 CachedRowSetImpl 的 <code>rvh</code> 中</p>
<div align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/abe57a4fd36e41b9b0a9f1aef44420e1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2S55-z6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769388778&amp;x-signature=ZolVpdDbBzede%2BiR0bUEYuvP9Do%3D" alt="rhv" loading="lazy"/></div>
<p>我们接着跟进 sqlRowSet.getInt(i)，答案即将揭晓</p>
<div align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d9ebac53972743d488dffac760c88a7a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2S55-z6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769388778&amp;x-signature=b8b6x67MXAYDmE2VRZUSUTJNGcE%3D" alt="getInt_error" loading="lazy"/></div>
<p>红框框住是不是就会抛异常了？我们继续跟进 this.getCurrentRow，会看到我们刚刚讲到的 <code>rvh</code></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">protected</span> BaseRow <span class="hljs-title function_">getCurrentRow</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">return</span> (BaseRow)(<span class="hljs-built_in">this</span>.onInsertRow ? <span class="hljs-built_in">this</span>.insertRow : (BaseRow)((BaseRow)<span class="hljs-built_in">this</span>.rvh.get(<span class="hljs-built_in">this</span>.cursorPos - <span class="hljs-number">1</span>)));
}
</code></pre>
<p>是不是就呼应上了？这里有两个呼应</p>
<ol>
<li>
<p>显示宽度</p>
<p>前面已经讲到，显示宽度会作为结果集的元数据返回，是否使用取决于应用程序</p>
<p>spring-jdbc 的 SqlRowSetResultSetExtractor#createSqlRowSet 方法用到了 CachedRowSetImpl#populate，在进行数据填充的过程中，会调用</p>
 <div align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b5e48ef4c7e6428691ca4490e2c2cc2c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2S55-z6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769388778&amp;x-signature=I6vk12k7ei8ijB2wW20eUMzyNgE%3D" alt="调用myql驱动的getObject" loading="lazy"/></div>
<p>mysql-connector-java 8.0.25 的 ResultSetImpl#getObject(int) 方法</p>
 <div align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ed750438659f419cb72eaa354ce67b1c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2S55-z6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769388778&amp;x-signature=MBwK2Fi1HCrBByjo5Kw2Fan665I%3D" alt="BIT处理" loading="lazy"/></div>
<p>是不是相当于用到了显示宽度？</p>
</li>
<li>
<p>rvh</p>
<p>CachedRowSetImpl#populate 方法，将数据填充到了 Vector rvh 中</p><p/>
<p>而我们写的代码 sqlRowSet.getInt(i) 是从这个 rvh 中获取的</p>


<p>所以，归根结底是 <strong>spring-jdbc 将 ResultSet 处理成 CachedRowSetImpl 的机制，我们没有遵循，才会出现 2 变 true 这种意料之外的结果</strong></p>
<p>SQL Server 的 tinyint 会不会有类似问题呢？我可以肯定的告诉你们，目前不会有，因为 SQL Server 的 tinyint 没有显示宽度一说，就是固定的 <code>tinyint</code>，不支持 <code>tinyint(n)</code>，至于未来是否支持，未来再说嘛</p>
<h2 data-id="heading-5">总结</h2>
<ol>
<li>
<p>MySQL 整数类型后面的 n 是显示宽度，表示显示时最少占 n 个字符宽度，既不会限制列存储的数值范围，也不会截断比列显示宽度更宽的值</p>
</li>
<li>
<p>MySQL 会把显示宽度作为结果集的元数据返回，所以 mysql-connector-java 8.0.25 能获取到</p>
</li>
<li>
<p>mysql-connector-java 8.0.25 虽然有显示宽度，也提供了间接用到显示宽度的getObject方法，但其 ResultSet 中的数据与数据库中的数据是一致的</p>
<p>至于上层应用如何使用 mysql-connector-java 8.0.25 中的元数据，由上层应用决定；spring-jdbc 就是上层应用之一、MyBatis 也是</p>
</li>
<li>
<p>spring-jdbc 的 JdbcTemplate.queryForRowSet 会间接使用显示宽度，而 Mybatis 不会，MyBatis 有类型处理器</p>
</li>
<li>
<p>如何避免标题中的问题，文中的 <strong>问题处理</strong> 章节已经说明，推荐第三种方式</p>
<blockquote>
<p>不使用 TINYINT(1)，直接使用 TINYINT(4) 或 TINYINT</p>
</blockquote>
</li>
</ol></li></ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[InheritableThreadLocal，从入门到放弃]]></title>    <link>https://juejin.cn/post/7595895132262105139</link>    <guid>https://juejin.cn/post/7595895132262105139</guid>    <pubDate>2026-01-19T00:53:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595895132262105139" data-draft-id="7595043061729198114" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="InheritableThreadLocal，从入门到放弃"/> <meta itemprop="keywords" content="Java"/> <meta itemprop="datePublished" content="2026-01-19T00:53:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="SevenCoding"/> <meta itemprop="url" content="https://juejin.cn/user/3261615728242467"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            InheritableThreadLocal，从入门到放弃
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3261615728242467/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    SevenCoding
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-19T00:53:56.000Z" title="Mon Jan 19 2026 00:53:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-19
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>InheritableThreadLocal相比ThreadLocal多一个能力：在创建子线程Thread时，子线程Thread会自动继承父线程的InheritableThreadLocal信息到子线程中，进而实现在在子线程获取父线程的InheritableThreadLocal值的目的。</p>
<p>关于ThreadLocal详细内容，可以看这篇文章：<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzkwNjc0MzU1Mg%3D%3D%26mid%3D2247484942%26idx%3D1%26sn%3D7e414e401be057e6bf8dde163d9387d9%26chksm%3Dc0e29c61f7951577a7f1f037fa5ee68c445116b6e0de82ca4321fe18d66de6fea8d33cbdc232%26token%3D1187469911%26lang%3Dzh_CN%23rd" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzkwNjc0MzU1Mg==&amp;mid=2247484942&amp;idx=1&amp;sn=7e414e401be057e6bf8dde163d9387d9&amp;chksm=c0e29c61f7951577a7f1f037fa5ee68c445116b6e0de82ca4321fe18d66de6fea8d33cbdc232&amp;token=1187469911&amp;lang=zh_CN#rd" ref="nofollow noopener noreferrer">史上最全ThreadLocal 详解</a></p>
<h2 data-id="heading-0">和 ThreadLocal 的区别</h2>
<p>举个简单的栗子对比下InheritableThreadLocal和ThreadLocal：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">InheritableThreadLocalTest</span> {    
	<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> ThreadLocal&lt;String&gt; threadLocal = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadLocal</span>&lt;&gt;();    
	<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> InheritableThreadLocal&lt;String&gt; inheritableThreadLocal = <span class="hljs-keyword">new</span> <span class="hljs-title class_">InheritableThreadLocal</span>&lt;&gt;();    

	<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {        
		testThreadLocal();        
		testInheritableThreadLocal();    
	}    

	<span class="hljs-comment">/**     * threadLocal测试     */</span>    
	<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testThreadLocal</span><span class="hljs-params">()</span> {       
		 <span class="hljs-comment">// 在主线程中设置值到threadLocal        </span>
		 threadLocal.set(<span class="hljs-string">"我是父线程threadLocal的值"</span>);        
		 <span class="hljs-comment">// 创建一个新线程并启动        </span>
		 <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {            
				 <span class="hljs-comment">// 在子线程里面无法获取到父线程设置的threadLocal，结果为null            </span>
				 System.out.println(<span class="hljs-string">"从子线程获取到threadLocal的值: "</span> + threadLocal.get());           }
		 ).start();    
	 }    
 
	 <span class="hljs-comment">/**     * inheritableThreadLocal测试     */</span>  
	<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testInheritableThreadLocal</span><span class="hljs-params">()</span> {        
		<span class="hljs-comment">// 在主线程中设置一个值到inheritableThreadLocal        </span>
		inheritableThreadLocal.set(<span class="hljs-string">"我是父线程inheritableThreadLocal的值"</span>);        
		<span class="hljs-comment">// 创建一个新线程并启动        </span>
		<span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {            
				<span class="hljs-comment">// 在子线程里面可以自动获取到父线程设置的inheritableThreadLocal    </span>
				System.out.println(<span class="hljs-string">"从子线程获取到inheritableThreadLocal的值: "</span> + inheritableThreadLocal.get());        
			}).start();    
		}
	}
</code></pre>
<p>执行结果：</p>
<pre><code class="hljs language-text" lang="text">从子线程获取到threadLocal的值:null
从子线程获取到inheritableThreadLocal的值:我是父线程inheritableThreadLocal的值
</code></pre>
<p>可以看到子线程中可以获取到父线程设置的inheritableThreadLocal值，但不能获取到父线程设置的threadLocal值</p>
<h2 data-id="heading-1">实现原理</h2>
<p>InheritableThreadLocal 的实现原理相当精妙，它通过在创建子线程的瞬间，“复制”父线程的线程局部变量，从而实现了数据从父线程到子线程的<strong>一次性、创建时</strong>的传递 。</p>
<p>其核心工作原理可以清晰地通过以下序列图展示，它描绘了当父线程创建一个子线程时，数据是如何被传递的：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant Parent as 父线程
    participant Thread as Thread构造方法
    participant ITL as InheritableThreadLocal
    participant ThMap as ThreadLocalMap
    participant Child as 子线程

    Parent-&gt;&gt;Thread: 创建 new Thread()
    Note over Parent,Thread: 关键步骤：初始化
    Thread-&gt;&gt;Thread: 调用 init() 方法
    Note over Thread,ITL: 检查父线程的 inheritableThreadLocals
    Thread-&gt;&gt;+ThMap: createInheritedMap(&lt;br/&gt;parent.inheritableThreadLocals)
    ThMap-&gt;&gt;ThMap: 新建一个ThreadLocalMap
    loop 遍历父线程Map中的每个Entry
        ThMap-&gt;&gt;+ITL: 调用 key.childValue(parentValue)
        ITL--&gt;&gt;-ThMap: 返回子线程初始值&lt;br/&gt;(默认返回父值，可重写)
        ThMap-&gt;&gt;ThMap: 将 (key, value) 放入新Map
    end
    ThMap--&gt;&gt;-Thread: 返回新的ThreadLocalMap对象
    Thread-&gt;&gt;Child: 将新Map赋给子线程的&lt;br/&gt;inheritableThreadLocals属性
    Note over Child: 子线程拥有父线程变量的副本
</code></pre>
<p>下面我们来详细拆解图中的关键环节。</p>
<h3 data-id="heading-2">核心实现机制</h3>
<ol>
<li>**数据结构基础：<code>Thread</code>类内部维护了两个 <code>ThreadLocalMap</code>类型的变量 ：
<ul>
<li><code>threadLocals</code>：用于存储普通 <code>ThreadLocal</code>设置的变量副本。</li>
<li><code>inheritableThreadLocals</code>：专门用于存储 <code>InheritableThreadLocal</code>设置的变量副本 。<code>InheritableThreadLocal</code>通过重写 <code>getMap</code>和 <code>createMap</code>方法，使其所有操作都针对 <code>inheritableThreadLocals</code>字段，从而与普通 <code>ThreadLocal</code>分离开 。</li>
</ul>
</li>
<li><strong>继承触发时刻：子线程的创建</strong>。继承行为发生在子线程被创建（即执行 <code>new Thread()</code>）时。在 <code>Thread</code>类的 <code>init</code>方法中，如果判断需要继承（<code>inheritThreadLocals</code>参数为 <code>true</code>）<strong>且</strong>父线程（当前线程）的 <code>inheritableThreadLocals</code>不为 <code>null</code>，则会执行复制逻辑 。</li>
<li><strong>复制过程的核心：<code>createInheritedMap</code></strong>。这是实现复制的核心方法 。它会创建一个新的 <code>ThreadLocalMap</code>，并将父线程 <code>inheritableThreadLocals</code>中的所有条目遍历拷贝到新 Map 中。
<ul>
<li><strong>Key的复制</strong>：Key（即 <code>InheritableThreadLocal</code>对象本身）是直接复制的引用。</li>
<li><strong>Value的生成</strong>：Value 并非直接复制引用，而是通过调用 <code>InheritableThreadLocal</code>的 <code>childValue(T parentValue)</code>方法来生成子线程中的初始值。<strong>默认实现是直接返回父值</strong>（<code>return parentValue;</code>），这意味着对于对象类型，父子线程将共享同一个对象引用 。</li>
</ul>
</li>
</ol>
<h3 data-id="heading-3">关键特性与注意事项</h3>
<ol>
<li><strong>创建时复制，后续独立</strong>：继承只发生一次，即在子线程对象创建的瞬间。此后，父线程和子线程对各自 <code>InheritableThreadLocal</code>变量的修改互不影响 。</li>
<li><strong>在线程池中的局限性</strong>：这是 <code>InheritableThreadLocal</code>最需要警惕的问题。线程池中的线程是复用的，这些线程在首次创建时可能已经从某个父线程继承了值。但当它们被用于执行新的任务时，新的任务提交线程（逻辑上的“父线程”）与工作线程已无直接的创建关系，因此之前继承的值不会更新，这会导致<strong>数据错乱</strong>（如用户A的任务拿到了用户B的信息）或<strong>内存泄漏</strong>​ 。对于线程池场景，应考虑使用阿里开源的 **TransmittableThreadLocal (TTL)**​ 。</li>
<li><strong>浅拷贝与对象共享</strong>：由于 <code>childValue</code>方法默认是浅拷贝，如果存入的是可变对象（如 <code>Map</code>、<code>List</code>），父子线程实际持有的是同一个对象的引用。在一个线程中修改该对象的内部状态，会直接影响另一个线程 。若需隔离，可以重写 <code>childValue</code>方法实现深拷贝 。</li>
<li><strong>内存泄漏风险</strong>：与 <code>ThreadLocal</code>类似，如果线程长时间运行（如线程池中的核心线程），并且未及时调用 <code>remove</code>方法清理，那么该线程的 <code>inheritableThreadLocals</code>会一直持有值的强引用，导致无法被GC回收。良好的实践是在任务执行完毕后主动调用 <code>remove()</code></li>
</ol>
<h3 data-id="heading-4">线程池中局限性</h3>
<p>一般来说，在真实的业务场景下，没人会直接 new Thread，而都是使用线程池的，因此<code>InheritableThreadLocal</code>在线程池中的使用局限性要额外注意</p>
<p>首先，我们先理解 <code>InheritableThreadLocal</code>的继承前提</p>
<ul>
<li><code>InheritableThreadLocal</code>的继承只发生在 <strong>新线程被创建时</strong>（即 <code>new Thread()</code>并启动时）。在创建过程中，子线程会复制父线程的 <code>InheritableThreadLocal</code>值。</li>
<li>在线程池中，线程是预先创建或按需创建的，并且会被复用。因此，继承只会在线程池<strong>创建新线程</strong>时发生，而不会在复用现有线程时发生。</li>
</ul>
<p>再看线程池创建新线程的条件，对于标准的 <code>ThreadPoolExecutor</code>，新线程的创建遵循以下规则：</p>
<ol>
<li><strong>当前线程数 &lt; 核心线程数</strong>：当提交新任务时，如果当前运行的线程数小于核心线程数，即使有空闲线程，线程池也会创建新线程来处理任务。此时，新线程会继承父线程（提交任务的线程）的 <code>InheritableThreadLocal</code>。</li>
<li><strong>当前线程数 &gt;= 核心线程数 &amp;&amp; 队列已满 &amp;&amp; 线程数 &lt; 最大线程数</strong>：当任务队列已满，且当前线程数小于最大线程数时，线程池会创建新线程来处理任务。同样，新线程会继承父线程的 <code>InheritableThreadLocal</code>。</li>
</ol>
<p>不会继承的场景</p>
<ul>
<li><strong>线程复用</strong>：当线程池中有空闲线程时（例如，当前线程数 &gt;= 核心线程数，但队列未满），任务会被分配给现有线程执行。此时，没有新线程创建，因此不会发生继承。现有线程的 <code>InheritableThreadLocal</code>值保持不变（可能是之前任务设置的值），这可能导致数据错乱（如用户A的任务看到用户B的数据）。</li>
<li><strong>线程数已达最大值</strong>：如果线程数已达最大线程数，且队列已满，新任务会被拒绝（根据拒绝策略），也不会创建新线程，因此不会继承。</li>
</ul>
<p>不只是线程池污染，线程池使用 <code>InheritableThreadLocal</code> 还可能存在获取不到值的情况。例如，在执行异步任务的时候，复用了某个已有的线程A，并且当时创建该线程A的时候，没有继承InheritableThreadLocal，进而导致后面复用该线程的时候，从InheritableThreadLocal获取到的值为null：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">InheritableThreadLocalWithThreadPoolTest</span> {    
	<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> InheritableThreadLocal&lt;String&gt; inheritableThreadLocal = <span class="hljs-keyword">new</span> <span class="hljs-title class_">InheritableThreadLocal</span>&lt;&gt;();    
	<span class="hljs-comment">// 这里线程池core/max数量都只有2    </span>
	<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">ThreadPoolExecutor</span> <span class="hljs-variable">threadPoolExecutor</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadPoolExecutor</span>(            
		<span class="hljs-number">2</span>,            
		<span class="hljs-number">2</span>,            
		<span class="hljs-number">0L</span>,            
		TimeUnit.MILLISECONDS,            
		<span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedBlockingQueue</span>&lt;Runnable&gt;(<span class="hljs-number">3000</span>),            
		<span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadPoolExecutor</span>.CallerRunsPolicy()    
	);    
	
	<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {        
	<span class="hljs-comment">// 先执行了不涉及InheritableThreadLocal的子任务初始化线程池线程 </span>
	       testAnotherFunction();        
	       testAnotherFunction();        
	       <span class="hljs-comment">// 后执行了涉及InheritableThreadLocal</span>
	       testInheritableThreadLocalWithThreadPool(<span class="hljs-string">"张三"</span>);        
	       testInheritableThreadLocalWithThreadPool(<span class="hljs-string">"李四"</span>);        
	       threadPoolExecutor.shutdown();    
	 }    
	 
	 <span class="hljs-comment">/**     * inheritableThreadLocal+线程池测试     */</span>    
	    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testInheritableThreadLocalWithThreadPool</span><span class="hljs-params">(String param)</span> {        
		    <span class="hljs-comment">// 1. 在主线程中设置一个值到inheritableThreadLocal        </span>
	         inheritableThreadLocal.set(param);        
	        <span class="hljs-comment">// 2. 提交异步任务到线程池        </span>
	        threadPoolExecutor.execute(() -&gt; {            
	        <span class="hljs-comment">// 3. 在线程池-子线程里面可以获取到父线程设置的inheritableThreadLocal吗？            </span>
		        System.out.println(<span class="hljs-string">"线程名: "</span> + Thread.currentThread().getName() + <span class="hljs-string">", 父线程设置的inheritableThreadLocal值: "</span> + param + <span class="hljs-string">", 子线程获取到inheritableThreadLocal的值: "</span> + inheritableThreadLocal.get());        
	        });        
	        <span class="hljs-comment">// 4. 清除inheritableThreadLocal        </span>
	        inheritableThreadLocal.remove();    
	   }    
	               
	   <span class="hljs-comment">/**     * 模拟另一个独立的功能     */</span>   
	   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testAnotherFunction</span><span class="hljs-params">()</span> {        
		   <span class="hljs-comment">// 提交异步任务到线程池        </span>
	       threadPoolExecutor.execute(() -&gt; {            
	       <span class="hljs-comment">// 在线程池-子线程里面可以获取到父线程设置的inheritableThreadLocal吗？            </span>
		       System.out.println(<span class="hljs-string">"线程名: "</span> + Thread.currentThread().getName() + <span class="hljs-string">", 线程池-子线程摸个鱼"</span>);        
	       });    
	   }
}
</code></pre>
<p>执行结果：</p>
<pre><code class="hljs language-text" lang="text">线程名:pool-1-thread-2,线程池-子线程摸个鱼
线程名:pool-1-thread-1,线程池-子线程摸个鱼
线程名:pool-1-thread-1,父线程设置的inheritableThreadLocal值:李四，子线程获取到inheritableThreadLocal的值:null
线程名:pool-1-thread-2,父线程设置的inheritableThreadLocal值:张三，子线程获取到inheritableThreadLocal的值:null
</code></pre>
<p>当然了，解决这个问题可以考虑使用阿里开源的 <strong>TransmittableThreadLocal (TTL)</strong>，​或者在提交异步任务前，先获取线程数据，再传入。例如：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 1. 在主线程中先获取inheritableThreadLocal的值</span>
<span class="hljs-type">String</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> inheritableThreadLocal.get();    
    
<span class="hljs-comment">// 2. 提交异步任务到线程池        </span>
threadPoolExecutor.execute(() -&gt; {            
<span class="hljs-comment">// 3. 在线程池-子线程里面直接传入数据  </span>
System.out.println(<span class="hljs-string">"线程名: "</span> + Thread.currentThread().getName() + <span class="hljs-string">", 父线程设置的inheritableThreadLocal值: "</span> + param + <span class="hljs-string">", 子线程获取到inheritableThreadLocal的值: "</span> + name);        
	        });        
</code></pre>
<h2 data-id="heading-5">与 ThreadLocal 的对比</h2>






























<table><thead><tr><th>特性</th><th>ThreadLocal</th><th>InheritableThreadLocal</th></tr></thead><tbody><tr><td><strong>数据隔离</strong>​</td><td>线程绝对隔离</td><td>线程绝对隔离</td></tr><tr><td><strong>子线程继承</strong>​</td><td><strong>不支持</strong>​</td><td><strong>支持</strong>（创建时）</td></tr><tr><td><strong>底层存储字段</strong>​</td><td><code>Thread.threadLocals</code></td><td><code>Thread.inheritableThreadLocals</code></td></tr><tr><td><strong>适用场景</strong>​</td><td>线程内全局变量，避免传参</td><td><strong>父子线程间</strong>需要传递上下文数据</td></tr></tbody></table></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[我发现凡是给offer的公司，面试时基本不问技术细节，那些问得又多又细的公司，后面基本就没下文了]]></title>    <link>https://juejin.cn/post/7596583214597636115</link>    <guid>https://juejin.cn/post/7596583214597636115</guid>    <pubDate>2026-01-19T00:59:06.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7596583214597636115" data-draft-id="7596478936386879530" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="我发现凡是给offer的公司，面试时基本不问技术细节，那些问得又多又细的公司，后面基本就没下文了"/> <meta itemprop="keywords" content="前端,后端,程序员"/> <meta itemprop="datePublished" content="2026-01-19T00:59:06.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="CodeSheep"/> <meta itemprop="url" content="https://juejin.cn/user/4371313961738616"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            我发现凡是给offer的公司，面试时基本不问技术细节，那些问得又多又细的公司，后面基本就没下文了
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4371313961738616/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    CodeSheep
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-19T00:59:06.000Z" title="Mon Jan 19 2026 00:59:06 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-19
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>最近看到一个职场社区帖子，吐槽了一个关于面试和 offer 的相关话题，参与讨论的同学非常多。</p>
<p>问题描述差不多是这样：</p>
<blockquote>
<p>“我发现凡是给 offer 的公司，面试时基本不问技术细节，那些问得又多又细的公司，后面基本就没下文了……”</p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8bfb58f596f64d62b39bc536bdfe91f4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29kZVNoZWVw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769389146&amp;x-signature=PPWyDDc1ggmGnzggt3AljYP0Frc%3D" alt="" loading="lazy"/></p>
<p>那关于这个问题，不知道大家有没有类似的体验或者经历？</p>
<p>你信心满满地去一家公司，面试官是个看起来技术大拿模样的人，一上来就给你整了个高并发场景下的分布式锁实现，问你 JVM 调优的十八般武艺，甚至还要跟你探讨一下 Linux 内核的源码细节。</p>
<p>你虽然答得满头大汗，但自我感觉还不错，仿佛自己把毕生所学都展示出来了。</p>
<p>但是最后结果呢？客气地送你一句等通知，然后便石沉大海。或者回去等了个三五天、一个星期，最后等来的是一句冰冷的不合适。</p>
<p>而反观另外一些面试经历，你可能就是抱着去溜达一圈的心态去转转的，面试让你感觉像在聊天，聊聊项目，聊聊过往经历，聊聊技术。</p>
<p>你心里还在犯嘀咕，没了？就这？</p>
<p>结果第二天，HR 就打电话过来找你谈薪，然后询问入职时间，速度快得让你怀疑人生。</p>
<p>看到这里，你是不是也挺疑惑，这到底是为什么？</p>
<p>难道某些公司就爱玩反向筛选？还是说问技术细节本身就是一种送客的委婉方式？这背后到底有没有什么可以遵循的逻辑原理可以分析分析。</p>
<p>所以今天咱们也用一篇文章的篇幅来聊一聊这个话题，也欢迎大家分享交流自己的观点和看法。</p>
<p>对于那些问得又细又深，最后却没给 offer 的，往往有这么几种情况。</p>
<p>第一种，也是最现实、最常见的<strong>大环境筛选</strong>。</p>
<p>什么意思呢？</p>
<p>现在的求职大环境大家也知道，岗位有限，候选人太多。HR 和面试官手里攥着一堆 985、211 甚至大厂背景的简历。</p>
<p>简单点说，他们不缺候选人，所以他们有资格挑。</p>
<p>对于中间段位的候选人，也就是我们大多数普通人，他们不需要看你有多优秀，只需要找出你简历里的一个瑕疵，一个技术细节没答上来，或许就有可能会把你刷掉。毕竟对于他们来说，能选择的太多。</p>
<p>其次，还有一个比较现实的问题是，对于<strong>那些问得细的公司，不代表真的招人</strong>。</p>
<p>当一个团队实际并不缺人，或者只是抱着宁缺毋滥的心态在招人时，他们就有资本去挑刺。</p>
<p>这时候面试官常常带着一种找漏洞的心态。他们的问题像一张细密的筛网，目的似乎不是看你有多合适，而是为了证明你哪里不合适。</p>
<p>说实话，这种还是挺恶心的。</p>
<p>第三种，也是最最扎心的一种情况：<strong>你只是他们的「免费咨询顾问」</strong>。</p>
<p>更直白一点说就是在套方案。</p>
<p>现在的行情下，很多公司业务停滞，不怎么招人，但又面临一些棘手的技术难题。</p>
<p>他们打着招聘的旗号，实际上是把市场上优秀的工程师请过来，所谓的面试其实也就是一场免费的头脑风暴。他们会故意引导你去讲你上一家公司的架构设计、服务拆分方案、甚至是具体的排错思路。</p>
<p>整个面试过程你自认为胸有成竹，方案和思路也讲得滔滔不绝，殊不知，人家还另有企图呢。</p>
<p>有一说一，这种是最最恶心的一种情况。</p>
<p>而对于那些问得不多、但 offer 倒是给的挺痛快的公司，通常又是怎么回事呢？</p>
<p>首先，这往往意味着这个公司是**「真·缺人」**呐。</p>
<p>这种公司通常处于一种“生死存亡”或者业务极速扩张的阶段。老板或者团队负责人可能已经被缺人折磨得寝食难安了。</p>
<p>他们的核心诉求非常明确：找个能立刻干活、能立刻上手的人。</p>
<p>这时候，他们不会跟你去扯什么虚头巴脑的设计模式，更不会去考你那些冷门的技术知识。</p>
<p>他们关心的是：你能不能明天就来上班，你能不能把这个烂摊子代码接过去维护，你能不能抗住连续一个月的强度。</p>
<p>在这种极度的需求面前，所谓的技术细节反倒成了次要的。</p>
<p>但是说实话，这种 offer 虽然来得容易，但兄弟记住，<strong>这往往也是把双刃剑</strong>。</p>
<p>因为“真·缺人”的背后，往往意味着技术债巨多、管理混乱，或者是一个谁都不愿意接的坑。</p>
<p>拿到这种 offer，你既可能是一飞冲天的救世主，也有可能是一头扎进泥潭的接盘侠。</p>
<p>当然，还有一种情况，虽然不那么好听，但也必须提一嘴。</p>
<p>那就是，有些公司其实是在广撒网。他们可能并没有确切的 HC，或者他们需要的只是一个廉价的劳动力。</p>
<p>对于这种公司，问太多技术细节反而会吓跑你，他们更希望用更轻松的面试体验和更高薪的承诺来把你招进去，至于技术匹配度嘛，额……那是入职以后的事情了。</p>
<p>文章的最后我想说的是，面试是一个双向选择的过程，也是一个互相试探的过程。</p>
<p>当你遇到那个问得特别细的面试官时，别急着心里骂娘，也别急着觉得自己没戏了。你可以试着把这场技术拷问变成一场技术交流。</p>
<p>如果对方是在套方案，你可以适当保留，点到为止；如果对方是真的在考察技术深度，那正好展示你的技术功底。</p>
<p>而当你遇到那个聊两句就给 offer 的公司时，也别急着狂喜。</p>
<p>可以<strong>多问问团队现状，问问业务体量，问问技术栈，这时候，一定要记住，你该反问的要反问，该考察的要考察</strong>。</p>
<p>因为虽说大环境寒冷，但是我觉得<strong>找到一个不坑的公司有时候比拿到一个所谓的 offer 更加重要</strong>，大家觉得呢？</p>
<p>好了，今天就先聊这么多吧，希望能对大家有所启发，我们下篇见。</p>
<blockquote>
<p>注：本文在GitHub开源仓库「编程之路」 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Frd2coding%2FRoad2Coding" target="_blank" title="https://github.com/rd2coding/Road2Coding" ref="nofollow noopener noreferrer">github.com/rd2coding/R…</a> 中已经收录，里面有我整理的6大编程方向(岗位)的自学路线+知识点大梳理、面试考点、我的简历、几本硬核pdf笔记，以及程序员生活和感悟，欢迎star。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Redis与Spring Cache整合：企业级应用实战指南]]></title>    <link>https://juejin.cn/post/7595895132262137907</link>    <guid>https://juejin.cn/post/7595895132262137907</guid>    <pubDate>2026-01-19T01:01:31.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595895132262137907" data-draft-id="7490854985820471296" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Redis与Spring Cache整合：企业级应用实战指南"/> <meta itemprop="keywords" content="Redis,数据库,性能优化"/> <meta itemprop="datePublished" content="2026-01-19T01:01:31.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Go高并发架构_王工"/> <meta itemprop="url" content="https://juejin.cn/user/446863555701561"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Redis与Spring Cache整合：企业级应用实战指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/446863555701561/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Go高并发架构_王工
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-19T01:01:31.000Z" title="Mon Jan 19 2026 01:01:31 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-19
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读21分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h4 data-id="heading-0">一、前言</h4>
<p>在现代企业级应用中，性能优化和开发效率如同赛跑中的“风火轮”，而缓存技术则是驱动这一切的核心引擎。Redis凭借其内存存储和高性能特性，已成为分布式系统中的“香饽饽”；Spring Cache则通过优雅的抽象，让开发者能以最小的代码量实现缓存逻辑。当这两者结合时，就像给应用装上了“涡轮增压器”，不仅能显著提升响应速度，还能简化开发流程，满足高并发场景下的苛刻需求。</p>
<p>为什么需要整合Redis与Spring Cache呢？答案藏在企业级开发的痛点中：<strong>性能瓶颈</strong>、<strong>分布式缓存管理</strong>和<strong>代码复杂度</strong>。Redis提供毫秒级的读写速度和丰富的数据结构支持，而Spring Cache通过注解驱动的方式，让开发者无需手动操作底层缓存逻辑，就能实现高效缓存管理。这种整合不仅能提升系统吞吐量，还能让团队专注于业务开发，而非纠结于缓存细节。</p>
<p>本文的目标是为有1-2年Redis使用经验的开发者提供一份实操性强的指南。无论你是想快速上手整合，还是希望在企业级项目中游刃有余地应对缓存挑战，这里都有你需要的干货。本文适用于熟悉Redis基本操作、了解Spring框架，并渴望将缓存能力提升到新高度的开发者。</p>
<p>接下来，我们将从技术背景入手，逐步剖析Redis与Spring Cache整合的优势、实战配置步骤、典型应用场景，最后结合最佳实践和踩坑经验，帮你在实际项目中少走弯路。准备好了吗？让我们一起开启这场缓存实战之旅！</p>
<h4 data-id="heading-1">二、Redis与Spring Cache整合的技术背景</h4>
<p>在深入整合之前，我们先来聊聊Redis和Spring Cache的“出身”，以及它们为何能成为企业级应用的黄金搭档。</p>
<h5 data-id="heading-2">1. Redis简介</h5>
<p>Redis（Remote Dictionary Server）就像一个“内存中的瑞士军刀”，以其高性能和多功能性闻名。它不仅是一个键值存储，还支持列表、集合、哈希等多种数据结构，能轻松应对复杂业务需求。Redis的核心特性包括：</p>
<ul>
<li><strong>高性能</strong>：内存操作，读写速度可达10万QPS。</li>
<li><strong>数据结构支持</strong>：从简单的字符串到有序集合，满足多样化场景。</li>
<li><strong>持久化</strong>：支持RDB快照和AOF日志，确保数据安全性。</li>
</ul>
<p>在缓存场景中，Redis常用于存储热点数据、会话信息或分布式锁。比如在电商系统中，商品详情页的高频访问数据通常会放入Redis，减少数据库压力。</p>
<h5 data-id="heading-3">2. Spring Cache简介</h5>
<p>如果说Redis是缓存的“发动机”，Spring Cache就是“方向盘”，负责让开发者轻松驾驭缓存逻辑。Spring Cache是Spring框架提供的缓存抽象层，通过注解简化操作，主要包括：</p>
<ul>
<li><strong><code>@Cacheable</code></strong>：方法结果缓存，命中时直接返回。</li>
<li><strong><code>@CachePut</code></strong>：强制更新缓存，常用于数据变更。</li>
<li><strong><code>@CacheEvict</code></strong>：清理缓存，移除过期或无用数据。</li>
</ul>
<p>默认情况下，Spring Cache使用<code>ConcurrentMapCache</code>作为内存缓存实现，虽然简单易用，但在分布式场景下却显得力不从心——数据无法跨节点共享，且容量受限于单机内存。</p>
<h5 data-id="heading-4">3. 为什么选择Redis + Spring Cache？</h5>
<p>市面上缓存方案不少，比如Ehcache适合单机场景，Caffeine以高性能著称，但Redis与Spring Cache的组合为何脱颖而出？让我们用一张表格直观对比：</p>

































<table><thead><tr><th><strong>方案</strong></th><th><strong>单机性能</strong></th><th><strong>分布式支持</strong></th><th><strong>开发便捷性</strong></th><th><strong>扩展性</strong></th></tr></thead><tbody><tr><td><strong>Ehcache</strong></td><td>高</td><td>无</td><td>中</td><td>低</td></tr><tr><td><strong>Caffeine</strong></td><td>极高</td><td>无</td><td>中</td><td>中</td></tr><tr><td><strong>Redis + Spring Cache</strong></td><td>高</td><td>有</td><td>高</td><td>高</td></tr></tbody></table>
<p><strong>核心优势</strong>在于：</p>
<ul>
<li><strong>分布式支持</strong>：Redis天然适合微服务架构，多节点间缓存共享无压力。</li>
<li><strong>灵活性</strong>：支持TTL、复杂数据结构，适应性强。</li>
<li><strong>可扩展性</strong>：结合Redis Cluster或Sentinel，轻松应对流量增长。</li>
</ul>
<p>从我的项目经验来看，一个千万级用户的社交平台，最初使用Ehcache缓存用户资料，但随着服务拆分为微服务，跨节点同步成了难题。切换到Redis后，不仅解决了数据一致性问题，还通过Spring Cache的注解大幅减少了代码维护成本。</p>
<h5 data-id="heading-5">过渡小结</h5>
<p>了解了Redis和Spring Cache的背景，我们不难发现它们在性能与便捷性上的互补性。接下来，我们将深入探讨整合后的核心优势和特色功能，看看它们如何在企业级场景中大显身手。</p>
<h4 data-id="heading-6">三、整合Redis与Spring Cache的核心优势与特色功能</h4>
<p>将Redis与Spring Cache整合，就像给一辆跑车装上了智能导航系统：不仅速度快，还能精准找到目标。在企业级应用中，这种组合带来的收益远超简单相加。接下来，我们将从核心优势、特色功能和实际价值三个维度，深入剖析它们的“化学反应”。</p>
<h5 data-id="heading-7">1. 核心优势</h5>
<ul>
<li>
<p><strong>高性能</strong><br/>
Redis的内存存储如同“闪电侠”，读写速度快到飞起，而Spring Cache则像一位贴心的“管家”，通过注解无缝衔接Redis，让开发者无需手动调用<code>get</code>或<code>set</code>。在高并发场景下，这种组合能将响应时间从几十毫秒压缩到个位数。我曾在某电商项目中，将商品库存查询从数据库迁移到Redis缓存，QPS从5000提升到3万，效果立竿见影。</p>
</li>
<li>
<p><strong>分布式能力</strong><br/>
在微服务架构中，单机缓存就像“孤岛”，无法满足跨服务的数据共享需求。Redis作为分布式缓存的“桥梁”，通过整合Spring Cache，让多节点轻松访问同一份缓存数据。比如，用户登录状态可以在多个服务间实时同步，避免重复查询数据库。</p>
</li>
<li>
<p><strong>开发效率</strong><br/>
Spring Cache的注解驱动开发就像“魔法咒语”，一句<code>@Cacheable</code>就能搞定缓存逻辑，省去了手写Redis操作的繁琐。相比传统方式，代码量减少约30%，维护成本也大幅降低。</p>
</li>
</ul>
<h5 data-id="heading-8">2. 特色功能</h5>
<p>Redis与Spring Cache的整合带来了一些“锦上添花”的功能，让缓存管理更灵活。以下是几个亮点：</p>
<ul>
<li>
<p><strong>缓存过期与TTL配置</strong><br/>
Redis支持为每个键设置TTL（Time To Live），就像给缓存贴上“保质期标签”。通过Spring Cache的<code>RedisCacheManager</code>，可以轻松配置过期时间，避免数据“过期不自知”。</p>
</li>
<li>
<p><strong>动态缓存名称与条件缓存</strong><br/>
Spring Cache支持动态生成缓存名称（通过<code>cacheNames</code>和SpEL表达式），还能根据条件决定是否缓存（<code>condition</code>属性）。这就像给缓存加了个“智能开关”，只在需要时生效。</p>
</li>
<li>
<p><strong>序列化与反序列化支持</strong><br/>
默认的JDK序列化会让缓存数据变成“乱码”，难以调试。整合后，可以使用<code>Jackson2JsonRedisSerializer</code>将对象转为JSON存储，既可读性强，又方便跨语言共享。</p>
</li>
<li>
<p><strong>批量操作与事务支持</strong><br/>
Redis的<code>pipeline</code>和事务特性，结合Spring的<code>RedisTemplate</code>，支持批量操作和原子性更新。比如批量缓存用户数据时，性能提升近50%。</p>
</li>
</ul>
<p>以下是一个简单的功能对比表：</p>






























<table><thead><tr><th><strong>功能</strong></th><th><strong>Spring Cache单独使用</strong></th><th><strong>Redis + Spring Cache</strong></th></tr></thead><tbody><tr><td>过期时间</td><td>不支持</td><td>支持（TTL）</td></tr><tr><td>分布式共享</td><td>无</td><td>有</td></tr><tr><td>数据序列化</td><td>JDK默认</td><td>可自定义（如JSON）</td></tr><tr><td>事务支持</td><td>无</td><td>有</td></tr></tbody></table>
<h5 data-id="heading-9">3. 企业级应用中的价值</h5>
<p>在实际项目中，这种整合的价值体现在以下几个方面：</p>
<ul>
<li>
<p><strong>高并发场景下的缓存命中率优化</strong><br/>
通过合理的键设计和TTL策略，缓存命中率可提升至90%以上。我曾在社交平台项目中优化用户动态缓存，命中率从60%提升到95%，数据库压力骤减。</p>
</li>
<li>
<p><strong>数据一致性保障</strong><br/>
借助<code>@CachePut</code>和<code>@CacheEvict</code>，可以确保缓存与数据库同步更新，避免“脏数据”问题。比如，用户修改资料后，缓存会立即刷新，杜绝延迟。</p>
</li>
<li>
<p><strong>可视化管理</strong><br/>
Redis支持Sentinel和Cluster模式，结合Spring Boot Actuator，可以实时监控缓存状态。运维人员能通过Redis的<code>INFO</code>命令查看命中率、内存使用率等指标，及时调整策略。</p>
</li>
</ul>
<h5 data-id="heading-10">项目经验小插曲</h5>
<p>在一次金融项目中，我们需要缓存实时汇率数据。由于数据更新频繁，最初使用Spring Cache默认实现，导致内存占用过高。切换到Redis后，不仅支持了分布式部署，还通过TTL精确控制缓存时效，最终将系统响应时间从200ms降到20ms，用户体验显著提升。</p>
<h5 data-id="heading-11">过渡小结</h5>
<p>从高性能到分布式能力，再到开发效率的提升，Redis与Spring Cache的整合为企业级应用提供了强大的技术支撑。特色功能的加持，则让它在复杂场景中游刃有余。接下来，我们将进入实战环节，手把手带你从零搭建整合环境，看看这些优势如何落地。</p>
<h4 data-id="heading-12">四、实战配置：从零搭建Redis与Spring Cache</h4>
<p>理论讲得再多，不如动手实践来得痛快。这一章，我们将从零开始，搭建一个完整的Redis与Spring Cache整合环境。无论你是单机调试还是集群部署，这里的配置都能让你快速上手。准备好你的代码编辑器，我们开始吧！</p>
<h5 data-id="heading-13">1. 环境准备</h5>
<p>在动手之前，先确保你的“工具箱”齐全：</p>
<ul>
<li><strong>依赖引入</strong><br/>
我们基于Spring Boot快速搭建项目，在<code>pom.xml</code>中添加以下依赖：</li>
</ul>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- Spring Boot Starter，包括核心功能 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- Redis与Spring Cache整合 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- Jackson用于JSON序列化 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jackson-databind<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 测试依赖 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>
</code></pre>
<ul>
<li><strong>Redis服务搭建</strong><br/>
单机模式下，下载Redis（推荐6.x版本），启动默认端口6379即可。集群模式可参考Redis Cluster官方文档，这里以单机为例：
<pre><code class="hljs language-bash" lang="bash">redis-server --port 6379
</code></pre>
</li>
</ul>
<h5 data-id="heading-14">2. 基本配置</h5>
<p>配置是整合的“地基”，我们需要连接Redis并定制Spring Cache的行为。</p>
<ul>
<li><strong>Redis连接配置</strong><br/>
在<code>application.yml</code>中配置Redis连接信息：</li>
</ul>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">spring:</span>
  <span class="hljs-attr">redis:</span>
    <span class="hljs-attr">host:</span> <span class="hljs-string">localhost</span>
    <span class="hljs-attr">port:</span> <span class="hljs-number">6379</span>
    <span class="hljs-attr">password:</span> <span class="hljs-comment"># 可选，若有密码则填写</span>
    <span class="hljs-attr">database:</span> <span class="hljs-number">0</span> <span class="hljs-comment"># 默认使用db0</span>
    <span class="hljs-attr">timeout:</span> <span class="hljs-string">5000ms</span> <span class="hljs-comment"># 连接超时</span>
    <span class="hljs-attr">jedis:</span>
      <span class="hljs-attr">pool:</span>
        <span class="hljs-attr">max-active:</span> <span class="hljs-number">8</span> <span class="hljs-comment"># 连接池最大连接数</span>
        <span class="hljs-attr">max-idle:</span> <span class="hljs-number">8</span>   <span class="hljs-comment"># 最大空闲连接</span>
        <span class="hljs-attr">min-idle:</span> <span class="hljs-number">0</span>   <span class="hljs-comment"># 最小空闲连接</span>
</code></pre>
<ul>
<li><strong>Spring Cache Manager配置</strong><br/>
默认的<code>RedisCacheManager</code>已经够用，但我们自定义一下，加入JSON序列化支持。创建一个配置类：</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> com.fasterxml.jackson.annotation.JsonAutoDetect;
<span class="hljs-keyword">import</span> com.fasterxml.jackson.annotation.PropertyAccessor;
<span class="hljs-keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;
<span class="hljs-keyword">import</span> org.springframework.cache.annotation.EnableCaching;
<span class="hljs-keyword">import</span> org.springframework.context.annotation.Bean;
<span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;
<span class="hljs-keyword">import</span> org.springframework.data.redis.cache.RedisCacheConfiguration;
<span class="hljs-keyword">import</span> org.springframework.data.redis.cache.RedisCacheManager;
<span class="hljs-keyword">import</span> org.springframework.data.redis.connection.RedisConnectionFactory;
<span class="hljs-keyword">import</span> org.springframework.data.redis.serializer.Jackson2JsonRedisSerializer;
<span class="hljs-keyword">import</span> org.springframework.data.redis.serializer.RedisSerializationContext;

<span class="hljs-keyword">import</span> java.time.Duration;

<span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@EnableCaching</span> <span class="hljs-comment">// 启用Spring Cache</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisCacheConfig</span> {

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> RedisCacheManager <span class="hljs-title function_">cacheManager</span><span class="hljs-params">(RedisConnectionFactory connectionFactory)</span> {
        <span class="hljs-comment">// 配置JSON序列化</span>
        Jackson2JsonRedisSerializer&lt;Object&gt; serializer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Jackson2JsonRedisSerializer</span>&lt;&gt;(Object.class);
        <span class="hljs-type">ObjectMapper</span> <span class="hljs-variable">mapper</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectMapper</span>();
        mapper.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY);
        serializer.setObjectMapper(mapper);

        <span class="hljs-comment">// 默认缓存配置：TTL为1小时，禁用空值缓存</span>
        <span class="hljs-type">RedisCacheConfiguration</span> <span class="hljs-variable">config</span> <span class="hljs-operator">=</span> RedisCacheConfiguration.defaultCacheConfig()
                .entryTtl(Duration.ofHours(<span class="hljs-number">1</span>)) <span class="hljs-comment">// 设置全局TTL</span>
                .serializeValuesWith(RedisSerializationContext.SerializationPair.fromSerializer(serializer))
                .disableCachingNullValues(); <span class="hljs-comment">// 避免缓存空值</span>

        <span class="hljs-keyword">return</span> RedisCacheManager.builder(connectionFactory)
                .cacheDefaults(config)
                .build();
    }
}
</code></pre>
<p><strong>重点提示</strong>：</p>
<ul>
<li><strong><code>entryTtl</code></strong>：全局缓存过期时间，可按需调整。</li>
<li><strong><code>disableCachingNullValues</code></strong>：防止缓存穿透，空值不存入Redis。</li>
</ul>
<h5 data-id="heading-15">3. 注解使用示例</h5>
<p>配置完成后，我们用代码验证效果。假设有一个用户服务，来看看三种常用注解的实战应用。</p>
<ul>
<li><strong>@Cacheable：查询缓存</strong><br/>
查询用户信息，若缓存命中则直接返回：</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.springframework.cache.annotation.Cacheable;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Service;

<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> {

    <span class="hljs-meta">@Cacheable(cacheNames = "userCache", key = "'user:' + #userId")</span>
    <span class="hljs-keyword">public</span> User <span class="hljs-title function_">getUserById</span><span class="hljs-params">(Long userId)</span> {
        <span class="hljs-comment">// 模拟数据库查询</span>
        System.out.println(<span class="hljs-string">"查询数据库：userId="</span> + userId);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(userId, <span class="hljs-string">"User-"</span> + userId);
    }
}

<span class="hljs-comment">// 用户实体类</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> {
    <span class="hljs-keyword">private</span> Long id;
    <span class="hljs-keyword">private</span> String name;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">User</span><span class="hljs-params">(Long id, String name)</span> {
        <span class="hljs-built_in">this</span>.id = id;
        <span class="hljs-built_in">this</span>.name = name;
    }
    <span class="hljs-comment">// Getter/Setter省略</span>
}
</code></pre>
<ul>
<li><strong>@CachePut：更新缓存</strong><br/>
更新用户状态并同步缓存：</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@CachePut(cacheNames = "userCache", key = "'user:' + #user.id")</span>
<span class="hljs-keyword">public</span> User <span class="hljs-title function_">updateUser</span><span class="hljs-params">(User user)</span> {
    <span class="hljs-comment">// 模拟更新数据库</span>
    System.out.println(<span class="hljs-string">"更新数据库：userId="</span> + user.getId());
    <span class="hljs-keyword">return</span> user; <span class="hljs-comment">// 返回更新后的对象，自动存入缓存</span>
}
</code></pre>
<ul>
<li><strong>@CacheEvict：删除缓存</strong><br/>
用户注销时清理缓存：</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@CacheEvict(cacheNames = "userCache", key = "'user:' + #userId")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">deleteUser</span><span class="hljs-params">(Long userId)</span> {
    <span class="hljs-comment">// 模拟删除数据库记录</span>
    System.out.println(<span class="hljs-string">"删除数据库：userId="</span> + userId);
}
</code></pre>
<p><strong>运行效果</strong>：<br/>
首次调用<code>getUserById(1)</code>会查询数据库并缓存结果，后续调用直接从Redis读取，控制台不再输出查询日志。</p>
<h5 data-id="heading-16">4. 测试验证</h5>
<p>配置和代码写好后，怎么确认整合成功？我们写一个单元测试：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.junit.jupiter.api.Test;
<span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span class="hljs-keyword">import</span> org.springframework.boot.test.context.SpringBootTest;

<span class="hljs-meta">@SpringBootTest</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CacheTest</span> {

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> UserService userService;

    <span class="hljs-meta">@Test</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testCache</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// 第一次查询，触发数据库访问</span>
        <span class="hljs-type">User</span> <span class="hljs-variable">user1</span> <span class="hljs-operator">=</span> userService.getUserById(<span class="hljs-number">1L</span>);
        System.out.println(<span class="hljs-string">"第一次结果："</span> + user1.getName());

        <span class="hljs-comment">// 第二次查询，应从缓存读取</span>
        <span class="hljs-type">User</span> <span class="hljs-variable">user2</span> <span class="hljs-operator">=</span> userService.getUserById(<span class="hljs-number">1L</span>);
        System.out.println(<span class="hljs-string">"第二次结果："</span> + user2.getName());

        <span class="hljs-comment">// 更新缓存</span>
        userService.updateUser(<span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-number">1L</span>, <span class="hljs-string">"Updated-User"</span>));
        <span class="hljs-type">User</span> <span class="hljs-variable">user3</span> <span class="hljs-operator">=</span> userService.getUserById(<span class="hljs-number">1L</span>);
        System.out.println(<span class="hljs-string">"更新后结果："</span> + user3.getName());
    }
}
</code></pre>
<p><strong>预期输出</strong>：</p>
<pre><code class="hljs language-ini" lang="ini">查询数据库：<span class="hljs-attr">userId</span>=<span class="hljs-number">1</span>
第一次结果：User-1
第二次结果：User-1
更新数据库：<span class="hljs-attr">userId</span>=<span class="hljs-number">1</span>
更新后结果：Updated-User
</code></pre>
<h5 data-id="heading-17">配置示意图</h5>
<p>以下是整合流程的简要示意图：</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-attr">[Spring Cache注解]</span> <span class="hljs-selector-tag">--</span>&gt; <span class="hljs-selector-attr">[RedisCacheManager]</span> <span class="hljs-selector-tag">--</span>&gt; <span class="hljs-selector-attr">[RedisConnectionFactory]</span> <span class="hljs-selector-tag">--</span>&gt; <span class="hljs-selector-attr">[Redis服务]</span>
   (<span class="hljs-variable">@Cacheable</span>等)         (缓存管理与序列化)      (连接池管理)           (存储数据)
</code></pre>
<h5 data-id="heading-18">过渡小结</h5>
<p>通过以上步骤，我们完成了Redis与Spring Cache的基本整合。从依赖引入到注解应用，整个过程就像搭积木，简单又高效。接下来，我们将走进实际应用场景，看看这些配置如何在真实业务中发光发热。</p>
<h4 data-id="heading-19">五、实际应用场景解析</h4>
<p>配置完成后，真正的考验在于如何将Redis与Spring Cache应用到业务中。这一章，我们将走进三个常见的企业级场景：用户会话缓存、热点数据缓存和分布式锁与缓存更新。每个场景都基于我在实际项目中的经验提炼，带你看看它们如何解决痛点、提升性能。</p>
<h5 data-id="heading-20">1. 场景1：用户会话缓存</h5>
<ul>
<li>
<p><strong>需求</strong><br/>
在一个高并发的Web应用中，用户登录后需要快速读取会话信息（如用户ID、权限）。传统数据库查询在高峰期会成为瓶颈，我们希望通过缓存提升响应速度。</p>
</li>
<li>
<p><strong>实现</strong><br/>
使用<code>@Cacheable</code>结合Redis的TTL特性，缓存会话数据，过期时间设为30分钟：</p>
</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.springframework.cache.annotation.Cacheable;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Service;

<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SessionService</span> {

    <span class="hljs-meta">@Cacheable(cacheNames = "sessionCache", key = "'session:' + #token", unless = "#result == null")</span>
    <span class="hljs-keyword">public</span> Session <span class="hljs-title function_">getSession</span><span class="hljs-params">(String token)</span> {
        <span class="hljs-comment">// 模拟数据库查询</span>
        System.out.println(<span class="hljs-string">"查询数据库：token="</span> + token);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Session</span>(token, <span class="hljs-number">123L</span>, <span class="hljs-string">"ROLE_USER"</span>);
    }
}

<span class="hljs-comment">// 会话实体类</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Session</span> {
    <span class="hljs-keyword">private</span> String token;
    <span class="hljs-keyword">private</span> Long userId;
    <span class="hljs-keyword">private</span> String role;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Session</span><span class="hljs-params">(String token, Long userId, String role)</span> {
        <span class="hljs-built_in">this</span>.token = token;
        <span class="hljs-built_in">this</span>.userId = userId;
        <span class="hljs-built_in">this</span>.role = role;
    }
    <span class="hljs-comment">// Getter/Setter省略</span>
}
</code></pre>
<p><strong>配置TTL</strong>：在<code>RedisCacheConfig</code>中为<code>sessionCache</code>单独设置30分钟过期：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Bean</span>
<span class="hljs-keyword">public</span> RedisCacheManager <span class="hljs-title function_">cacheManager</span><span class="hljs-params">(RedisConnectionFactory connectionFactory)</span> {
    Jackson2JsonRedisSerializer&lt;Object&gt; serializer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Jackson2JsonRedisSerializer</span>&lt;&gt;(Object.class);
    <span class="hljs-type">ObjectMapper</span> <span class="hljs-variable">mapper</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectMapper</span>();
    mapper.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY);
    serializer.setObjectMapper(mapper);

    <span class="hljs-comment">// 特定缓存配置</span>
    Map&lt;String, RedisCacheConfiguration&gt; cacheConfigs = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
    cacheConfigs.put(<span class="hljs-string">"sessionCache"</span>, RedisCacheConfiguration.defaultCacheConfig()
            .entryTtl(Duration.ofMinutes(<span class="hljs-number">30</span>)) <span class="hljs-comment">// 会话缓存30分钟</span>
            .serializeValuesWith(RedisSerializationContext.SerializationPair.fromSerializer(serializer)));

    <span class="hljs-keyword">return</span> RedisCacheManager.builder(connectionFactory)
            .withInitialCacheConfigurations(cacheConfigs)
            .build();
}
</code></pre>
<ul>
<li><strong>效果</strong><br/>
在一个日活10万的系统中，会话查询从数据库的50ms降到Redis的2ms，数据库压力减少约80%。TTL确保过期会话自动清理，避免内存浪费。</li>
</ul>
<p><strong>示意图</strong>：</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-selector-attr">[用户请求]</span> --&gt; <span class="hljs-selector-attr">[@Cacheable]</span> --&gt; <span class="hljs-selector-attr">[Redis: session:token]</span> --&gt; <span class="hljs-selector-attr">[返回Session]</span>
   (带token)      (查缓存)          (命中/未命中)         (快速响应)
</code></pre>
<h5 data-id="heading-21">2. 场景2：热点数据缓存</h5>
<ul>
<li>
<p><strong>需求</strong><br/>
电商系统中，商品详情页的高频访问（如价格、库存）会导致数据库不堪重负。我们需要缓存热点商品数据，并动态调整缓存策略。</p>
</li>
<li>
<p><strong>实现</strong><br/>
使用动态缓存名称和条件缓存，只缓存访问量高的商品：</p>
</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.springframework.cache.annotation.Cacheable;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Service;

<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ProductService</span> {

    <span class="hljs-meta">@Cacheable(cacheNames = "productCache:#{#productId}", 
               key = "'product:' + #productId", 
               condition = "#visitCount &gt; 1000")</span> <span class="hljs-comment">// 访问超1000次才缓存</span>
    <span class="hljs-keyword">public</span> Product <span class="hljs-title function_">getProduct</span><span class="hljs-params">(Long productId, <span class="hljs-type">int</span> visitCount)</span> {
        <span class="hljs-comment">// 模拟数据库查询</span>
        System.out.println(<span class="hljs-string">"查询数据库：productId="</span> + productId);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Product</span>(productId, <span class="hljs-string">"商品-"</span> + productId, <span class="hljs-number">100</span>);
    }
}

<span class="hljs-comment">// 商品实体类</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Product</span> {
    <span class="hljs-keyword">private</span> Long id;
    <span class="hljs-keyword">private</span> String name;
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> stock;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Product</span><span class="hljs-params">(Long id, String name, <span class="hljs-type">int</span> stock)</span> {
        <span class="hljs-built_in">this</span>.id = id;
        <span class="hljs-built_in">this</span>.name = name;
        <span class="hljs-built_in">this</span>.stock = stock;
    }
    <span class="hljs-comment">// Getter/Setter省略</span>
}
</code></pre>
<ul>
<li><strong>效果</strong><br/>
在某双11活动中，热点商品的缓存命中率从50%提升到85%，数据库QPS从2万降到5000，页面加载时间缩短至100ms以内。动态缓存名称（<code>productCache:123</code>）让不同商品独立管理，避免冲突。</li>
</ul>
<p><strong>示意图</strong>：</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-selector-attr">[商品请求]</span> --&gt; <span class="hljs-selector-attr">[visitCount &gt; 1000?]</span> --&gt; <span class="hljs-selector-attr">[@Cacheable]</span> --&gt; <span class="hljs-selector-attr">[Redis: product:123]</span> --&gt; <span class="hljs-selector-attr">[返回Product]</span>
   (带ID+访问量)      (条件判断)          (动态缓存)         (命中返回)
</code></pre>
<h5 data-id="heading-22">3. 场景3：分布式锁与缓存更新</h5>
<ul>
<li>
<p><strong>需求</strong><br/>
在高并发下，缓存击穿和数据不一致是隐患。我们需要用分布式锁保护缓存更新，确保数据一致性。</p>
</li>
<li>
<p><strong>实现</strong><br/>
结合Redis分布式锁和<code>@CachePut</code>，实现安全的缓存刷新：</p>
</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span class="hljs-keyword">import</span> org.springframework.cache.annotation.CachePut;
<span class="hljs-keyword">import</span> org.springframework.data.redis.core.RedisTemplate;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Service;

<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderService</span> {

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> RedisTemplate&lt;String, Object&gt; redisTemplate;

    <span class="hljs-meta">@CachePut(cacheNames = "orderCache", key = "'order:' + #orderId")</span>
    <span class="hljs-keyword">public</span> Order <span class="hljs-title function_">updateOrder</span><span class="hljs-params">(Long orderId)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">lockKey</span> <span class="hljs-operator">=</span> <span class="hljs-string">"lock:order:"</span> + orderId;
        <span class="hljs-type">Boolean</span> <span class="hljs-variable">locked</span> <span class="hljs-operator">=</span> redisTemplate.opsForValue().setIfAbsent(lockKey, <span class="hljs-string">"1"</span>, <span class="hljs-number">10</span>, TimeUnit.SECONDS);
        
        <span class="hljs-keyword">if</span> (Boolean.TRUE.equals(locked)) {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-comment">// 模拟数据库更新</span>
                System.out.println(<span class="hljs-string">"更新数据库：orderId="</span> + orderId);
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Order</span>(orderId, <span class="hljs-string">"已支付"</span>);
            } <span class="hljs-keyword">finally</span> {
                redisTemplate.delete(lockKey); <span class="hljs-comment">// 释放锁</span>
            }
        }
        <span class="hljs-comment">// 未获取锁，返回旧数据或抛异常</span>
        <span class="hljs-keyword">return</span> getOrderFromCache(orderId);
    }

    <span class="hljs-keyword">private</span> Order <span class="hljs-title function_">getOrderFromCache</span><span class="hljs-params">(Long orderId)</span> {
        <span class="hljs-keyword">return</span> (Order) redisTemplate.opsForValue().get(<span class="hljs-string">"order:"</span> + orderId);
    }
}

<span class="hljs-comment">// 订单实体类</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Order</span> {
    <span class="hljs-keyword">private</span> Long id;
    <span class="hljs-keyword">private</span> String status;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Order</span><span class="hljs-params">(Long id, String status)</span> {
        <span class="hljs-built_in">this</span>.id = id;
        <span class="hljs-built_in">this</span>.status = status;
    }
    <span class="hljs-comment">// Getter/Setter省略</span>
}
</code></pre>
<ul>
<li><strong>效果</strong><br/>
在一个秒杀场景中，分布式锁避免了缓存击穿，更新操作从“群龙无首”变成有序排队，数据一致性提升至100%。响应时间虽略有增加（约5ms），但稳定性和可靠性更有保障。</li>
</ul>
<p><strong>示意图</strong>：</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-selector-attr">[并发请求]</span> --&gt; <span class="hljs-selector-attr">[Redis Lock]</span> --&gt; <span class="hljs-selector-attr">[获取锁?]</span> --&gt; <span class="hljs-selector-attr">[@CachePut]</span> --&gt; <span class="hljs-selector-attr">[Redis: order:123]</span> --&gt; <span class="hljs-selector-attr">[返回Order]</span>
   (更新订单)     (setIfAbsent)    (是/否)       (更新缓存)        (同步数据)
</code></pre>
<h5 data-id="heading-23">过渡小结</h5>
<p>从用户会话到热点数据，再到分布式锁，这三个场景展示了Redis与Spring Cache在不同业务中的灵活性。它们不仅提升了性能，还解决了高并发下的常见难题。接下来，我们将总结最佳实践和踩坑经验，帮你在实战中少走弯路。</p>
<h4 data-id="heading-24">六、最佳实践与踩坑经验</h4>
<p>技术整合就像烹饪一道大餐，配料齐全还不够，火候和调味也得恰到好处。在Redis与Spring Cache的实战中，我踩过不少坑，也积累了一些心得。这一章，我们将聊聊如何优化缓存设计、规避隐患，让你的应用既高效又稳定。</p>
<h5 data-id="heading-25">1. 最佳实践</h5>
<p>以下是几条经过项目验证的“黄金法则”：</p>
<ul>
<li>
<p><strong>缓存键设计：规范化命名，避免冲突</strong><br/>
缓存键是Redis的“身份证”，设计得不好会导致覆盖或混乱。推荐使用分层命名法，例如<code>模块:功能:参数</code>。<br/>
<strong>示例</strong>：</p>
<ul>
<li>用户资料：<code>user:profile:{userId}</code></li>
<li>商品库存：<code>product:stock:{productId}</code><br/>
这不仅清晰，还方便通过Redis客户端查看和管理。</li>
</ul>
</li>
<li>
<p><strong>缓存粒度控制：权衡存储与查询效率</strong><br/>
缓存太大浪费空间，太小则增加查询开销。在一个社交项目中，我最初将整个用户对象（含动态列表）缓存，占用了大量内存。后来调整为只缓存核心信息（如ID、昵称），动态列表按需查询，内存占用减少60%，性能依然优秀。</p>
</li>
<li>
<p><strong>缓存预热策略：启动时加载热点数据</strong><br/>
系统冷启动时，缓存为空会导致数据库压力激增。建议在应用启动时预加载热点数据。<br/>
<strong>代码示例</strong>：</p>
</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CacheWarmer</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ApplicationRunner</span> {
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> UserService userService;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">(ApplicationArguments args)</span> {
        <span class="hljs-comment">// 预热前100个活跃用户</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-type">long</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; i &lt;= <span class="hljs-number">100</span>; i++) {
            userService.getUserById(i);
        }
        System.out.println(<span class="hljs-string">"缓存预热完成"</span>);
    }
}
</code></pre>
<ul>
<li><strong>监控与运维：结合Redis INFO与Spring Actuator</strong><br/>
通过Redis的<code>INFO</code>命令查看命中率（<code>keyspace_hits</code>/<code>keyspace_misses</code>）和内存使用率，结合Spring Actuator的<code>/actuator/redis</code>端点，实时掌握缓存健康状态。<br/>
<strong>示例输出</strong>：
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">used_memory_human:</span> <span class="hljs-string">50M</span>
<span class="hljs-attr">keyspace_hits:</span> <span class="hljs-number">9500</span>
<span class="hljs-attr">keyspace_misses:</span> <span class="hljs-number">500</span>
</code></pre>
</li>
</ul>
<h5 data-id="heading-26">2. 踩坑经验</h5>
<p>实战中，问题往往藏在细节里。以下是我遇到的四大“坑”，以及对应的解决方案：</p>
<ul>
<li>
<p><strong>序列化问题：默认JDK序列化导致数据不可读</strong><br/>
<strong>现象</strong>：使用默认配置时，Redis中存储的是二进制乱码，调试困难。<br/>
<strong>解决</strong>：切换到JSON序列化（如前文配置的<code>Jackson2JsonRedisSerializer</code>），数据可读且跨语言兼容。<br/>
<strong>前后对比</strong>：</p>























<table><thead><tr><th><strong>方式</strong></th><th><strong>存储格式</strong></th><th><strong>可读性</strong></th><th><strong>性能</strong></th></tr></thead><tbody><tr><td>JDK序列化</td><td>二进制</td><td>差</td><td>高</td></tr><tr><td>JSON序列化</td><td>可读JSON字符串</td><td>好</td><td>中高</td></tr></tbody></table>
</li>
<li>
<p><strong>缓存穿透：高并发下空值缓存的处理</strong><br/>
<strong>现象</strong>：查询不存在的数据（如无效用户ID），每次都穿透到数据库。<br/>
<strong>解决</strong>：缓存空对象或使用Bloom过滤器。<br/>
<strong>代码示例</strong>：</p>
</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Cacheable(cacheNames = "userCache", key = "'user:' + #userId")</span>
<span class="hljs-keyword">public</span> User <span class="hljs-title function_">getUserById</span><span class="hljs-params">(Long userId)</span> {
    <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> queryFromDb(userId);
    <span class="hljs-keyword">return</span> user != <span class="hljs-literal">null</span> ? user : <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(-<span class="hljs-number">1L</span>, <span class="hljs-string">"N/A"</span>); <span class="hljs-comment">// 缓存空对象</span>
}
</code></pre>
<ul>
<li><strong>缓存雪崩：批量过期导致压力激增</strong><br/>
<strong>现象</strong>：大量缓存同时过期，高峰期数据库被打垮。<br/>
<strong>解决</strong>：为TTL添加随机偏移，或将热点数据隔离到单独缓存。<br/>
<strong>代码示例</strong>：</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">RedisCacheConfiguration</span> <span class="hljs-variable">config</span> <span class="hljs-operator">=</span> RedisCacheConfiguration.defaultCacheConfig()
    .entryTtl(Duration.ofSeconds(<span class="hljs-number">3600</span> + <span class="hljs-keyword">new</span> <span class="hljs-title class_">Random</span>().nextInt(<span class="hljs-number">600</span>))); <span class="hljs-comment">// 随机偏移10分钟</span>
</code></pre>
<ul>
<li><strong>连接池配置不当：超时与资源耗尽</strong><br/>
<strong>现象</strong>：高并发下出现<code>JedisConnectionException</code>，响应变慢。<br/>
<strong>解决</strong>：调整连接池参数，增加<code>max-active</code>和超时时间。<br/>
<strong>优化配置</strong>：</li>
</ul>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">spring:</span>
  <span class="hljs-attr">redis:</span>
    <span class="hljs-attr">jedis:</span>
      <span class="hljs-attr">pool:</span>
        <span class="hljs-attr">max-active:</span> <span class="hljs-number">50</span>   <span class="hljs-comment"># 增大连接池</span>
        <span class="hljs-attr">max-wait:</span> <span class="hljs-string">3000ms</span> <span class="hljs-comment"># 等待时间</span>
</code></pre>
<h5 data-id="heading-27">项目经验小故事</h5>
<p>在一次直播项目中，我们用Redis缓存房间人数，默认TTL设为1小时。但某次活动结束后，大量缓存同时过期，导致数据库瞬间QPS飙升到10万，服务差点宕机。后来改为随机TTL（1小时±10分钟），并在高峰前预热热点房间，问题迎刃而解，系统稳定运行至今。</p>
<h5 data-id="heading-28">实践效果对比表</h5>






























<table><thead><tr><th><strong>优化点</strong></th><th><strong>优化前</strong></th><th><strong>优化后</strong></th></tr></thead><tbody><tr><td>缓存命中率</td><td>60%</td><td>90%+</td></tr><tr><td>数据库QPS</td><td>2万</td><td>5000以下</td></tr><tr><td>响应时间</td><td>50ms</td><td>5ms以内</td></tr><tr><td>内存占用</td><td>200MB</td><td>80MB</td></tr></tbody></table>
<h5 data-id="heading-29">过渡小结</h5>
<p>通过规范设计和问题规避，Redis与Spring Cache的整合能发挥最大潜力。无论是缓存键的命名艺术，还是连接池的调优细节，这些经验都能帮你在项目中少走弯路。接下来，我们将总结全文，并展望未来的技术趋势。</p>
<h4 data-id="heading-30">七、总结与展望</h4>
<p>经过前文的探索，我们从技术背景到实战配置，再到应用场景和最佳实践，完整走了一遍Redis与Spring Cache整合的旅程。现在，让我们停下来，回顾收获，并展望这条技术路线的未来。</p>
<h5 data-id="heading-31">1. 总结</h5>
<p>Redis与Spring Cache的整合，就像给企业级应用装上了“双引擎”：Redis提供高性能和分布式能力，Spring Cache则带来开发效率和灵活性。从配置一个简单的<code>RedisCacheManager</code>，到用<code>@Cacheable</code>注解优化查询，再到通过分布式锁解决并发难题，我们看到它在高并发、数据一致性和系统扩展性上的巨大价值。</p>
<p>在实际项目中，这种组合能显著提升性能——我曾在电商项目中见证响应时间从50ms降到5ms，数据库压力减少80%；也能简化开发——注解驱动让代码更优雅，维护成本大幅降低。无论你是处理用户会话、热点数据，还是复杂的缓存更新场景，这套方案都能游刃有余。</p>
<h5 data-id="heading-32">2. 展望</h5>
<p>未来，Redis与Spring Cache的整合还有更多潜力可挖：</p>
<ul>
<li>
<p><strong>Redis 7.0新特性适配</strong><br/>
Redis 7.0引入了多线程I/O和新的命令（如<code>SHARD PUBSUB</code>），性能进一步提升。Spring Cache若能适配这些特性，将在高吞吐场景中表现更出色。</p>
</li>
<li>
<p><strong>微服务架构下的优化</strong><br/>
随着微服务深入发展，缓存的分布式管理和一致性要求更高。结合Spring Cloud和Redis Cluster，可以实现更智能的缓存分片和动态扩容。</p>
</li>
<li>
<p><strong>个人心得与趋势判断</strong><br/>
从我的使用经验来看，Redis与Spring Cache的简洁性和扩展性是其最大魅力。未来，AI驱动的缓存策略（比如自动识别热点数据）可能会成为新方向，值得关注。</p>
</li>
</ul>
<h5 data-id="heading-33">3. 鼓励互动</h5>
<p>技术是实践出来的，纸上谈兵不如动手一试。希望这篇文章能为你的项目提供灵感。如果你有自己的实战经验，或者在整合过程中遇到难题，欢迎在评论区留言分享。我们一起探讨，共同进步！</p>
<h5 data-id="heading-34">总结建议</h5>
<p>最后，送上几条实践锦囊：</p>
<ul>
<li><strong>从小处入手</strong>：先用单机Redis验证效果，再扩展到集群。</li>
<li><strong>关注监控</strong>：用Redis INFO和Actuator掌握缓存状态。</li>
<li><strong>持续优化</strong>：根据业务特点调整TTL和键设计。</li>
</ul>
<p>Redis与Spring Cache的旅程才刚刚开始，愿你在企业级应用的缓存之路上，越走越顺！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Laravel12 + Vue3 的免费可商用 PHP 管理后台 CatchAdmin V5.1.0 发布 新增 AI AGENTS 配置]]></title>    <link>https://juejin.cn/post/7596698363933130802</link>    <guid>https://juejin.cn/post/7596698363933130802</guid>    <pubDate>2026-01-18T23:19:51.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7596698363933130802" data-draft-id="7596245612558303241" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Laravel12 + Vue3 的免费可商用 PHP 管理后台 CatchAdmin V5.1.0 发布 新增 AI AGENTS 配置"/> <meta itemprop="keywords" content="后端,PHP,Laravel"/> <meta itemprop="datePublished" content="2026-01-18T23:19:51.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="BingoGo"/> <meta itemprop="url" content="https://juejin.cn/user/993614242266077"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Laravel12 + Vue3 的免费可商用 PHP 管理后台 CatchAdmin V5.1.0 发布 新增 AI AGENTS 配置
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/993614242266077/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    BingoGo
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-18T23:19:51.000Z" title="Sun Jan 18 2026 23:19:51 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Laravel12 + Vue3 的免费可商用 PHP 管理后台 CatchAdmin V5.1.0 发布 新增 AI AGENTS 配置</h2>
<h3 data-id="heading-1">介绍</h3>
<p><code>CatchAdmin</code> 是一款基于 <a href="https://link.juejin.cn?target=https%3A%2F%2Flaravel.com" target="_blank" title="https://laravel.com" ref="nofollow noopener noreferrer">Laravel 12.x</a> 与 <a href="https://link.juejin.cn?target=https%3A%2F%2Fvuejs.org%2F" target="_blank" title="https://vuejs.org/" ref="nofollow noopener noreferrer">Vue3</a> 二次开发的 PHP 开源后台管理系统，采用前后端分离架构，面向企业级后台场景提供开箱即用的基础能力与可扩展的模块化框架。系统内置 Token 鉴权、权限管理（菜单/按钮/数据权限）、动态路由、动态表格、分页封装、资源权限控制、上传/下载、代码生成器（支持一键导入/导出）、数据回收站、附件管理等功能，覆盖后台系统从安全、权限到效率开发的常见需求。</p>
<p>在架构设计上，<code>Laravel</code> 仅作为 <code>API</code> 服务层对外输出，尽可能弱化业务模块之间的耦合关系。每个模块均具备独立的控制器、路由、模型与数据表结构，支持按模块拆分、按需加载与独立演进，从而降低开发复杂度，提高可维护性与迭代效率。同时，项目封装了大量通用能力与开发工具（如统一响应、异常处理、分页与资源封装等），让业务开发更聚焦、更高效。</p>
<p>基于 <code>CatchAdmin</code>，你可以快速搭建 <code>CMS</code>、<code>CRM</code>、<code>OA</code> 等各类管理系统，并在稳定的基础设施之上持续扩展业务模块，满足不同规模团队的开发与交付需求。</p>
<h3 data-id="heading-2">V5.1.0 版本亮点</h3>
<ul>
<li>新增 <code>AGENTS</code> 配置，能更好的配合 <code>AI</code> 相关工具</li>
<li>新增系统配置缓存命令</li>
<li>优化后台首屏加载速度，现在体感在 2~3s 之间，非常流畅</li>
<li>优化多语言，支持动态（后端获取）/静态（纯前端语言）模式切换，通过  <code>VITE_I18N_MODE</code>  配置</li>
<li>优化后台打包分包，减少打包分块体积，提高加载速度</li>
<li>优化后台面包屑导航栏</li>
<li>优化后台顶部左侧样式
等等更多...</li>
</ul>
<h3 data-id="heading-3">快速开始</h3>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">创建项目</span>
composer create  catchadmin/catchadmin
<span class="hljs-meta prompt_">
# </span><span class="bash">安装项目</span>
cd catchadmin &amp;&amp; php artisan catch:install
<span class="hljs-meta prompt_">
# </span><span class="bash">启动项目</span>
composer run dev
</code></pre>
<h3 data-id="heading-4">功能清单</h3>
<ul>
<li>☑️ <strong>用户管理</strong>：用户添加、修改、删除，支持不同用户登录后台看到不同首页</li>
<li>☑️ <strong>部门管理</strong>：部门组织机构（公司、部门、小组），树结构展现</li>
<li>☑️ <strong>岗位管理</strong>：给用户配置所担任职务</li>
<li>☑️ <strong>角色管理</strong>：树结构设计，支持角色菜单和按钮权限分配、角色数据权限分配</li>
<li>☑️ <strong>菜单管理</strong>：配置系统菜单和按钮</li>
<li>☑️ <strong>字典管理</strong>：对系统中经常使用的固定数据进行维护和复用</li>
<li>☑️ <strong>系统配置</strong>：系统常用设置管理</li>
<li>☑️ <strong>操作日志</strong>：用户正常操作的查询</li>
<li>☑️ <strong>登录日志</strong>：用户登录记录查询</li>
<li>☑️ <strong>文件上传</strong>：支持本地、七牛云、阿里云、腾讯云</li>
<li>☑️ <strong>附件管理</strong>：管理系统上传的文件及图片</li>
<li>☑️ <strong>数据表维护</strong>：数据表碎片清理和优化，管理数据回收和销毁</li>
<li>☑️ <strong>代码生成</strong>：前后端代码生成（PHP、Vue、数据库迁移），支持一键生成到模块</li>
<li>☑️ <strong>Vue 即时渲染</strong>：前端 Vue 即时渲染，无需编译</li>
<li>☑️ <strong>插件系统</strong>：CatchAdmin 插件即 Composer 包，完全绑定 Composer 生态</li>
</ul>
<h3 data-id="heading-5">在线体验</h3>
<p>演示地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fv5.catchadmin.com" target="_blank" title="https://v5.catchadmin.com" ref="nofollow noopener noreferrer">v5.catchadmin.com</a></p>
<p><strong>超管账户</strong></p>
<ul>
<li>账户：<code>catch@admin.com</code></li>
<li>密码：<code>catchadmin</code></li>
</ul>
<p><strong>测试账户</strong></p>
<ul>
<li>账户：<code>test@admin.com</code></li>
<li>密码：<code>Testadmin1</code></li>
</ul>
<h3 data-id="heading-6">项目地址</h3>
<ul>
<li>GitHub：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FJaguarJack%2Fcatch-admin" target="_blank" title="https://github.com/JaguarJack/catch-admin" ref="nofollow noopener noreferrer">github.com/JaguarJack/…</a></li>
<li>Gitee：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fcatchadmin%2Fcatchadmin" target="_blank" title="https://gitee.com/catchadmin/catchadmin" ref="nofollow noopener noreferrer">gitee.com/catchadmin/…</a></li>
</ul>
<h3 data-id="heading-7">项目预览</h3>

























<table><thead><tr><th/><th/></tr></thead><tbody><tr><td><img src="https://image.catchadmin.com/202512151142046.png" alt="登录" loading="lazy"/></td><td><img src="https://image.catchadmin.com/202512150841525.png" alt="控制台" loading="lazy"/></td></tr><tr><td><img src="https://image.catchadmin.com/202512151143109.png" alt="权限" loading="lazy"/></td><td><img src="https://image.catchadmin.com/202512151144233.png" alt="布局" loading="lazy"/></td></tr><tr><td><img src="https://image.catchadmin.com/202601101535082.png" alt="上传" loading="lazy"/></td><td><img src="https://image.catchadmin.com/202601101536072.png" alt="代码生成" loading="lazy"/></td></tr><tr><td><img src="https://image.catchadmin.com/202601101537583.png" alt="菜单" loading="lazy"/></td><td><img src="https://image.catchadmin.com/202601101538807.png" alt="模板" loading="lazy"/></td></tr></tbody></table>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fcatchadmin.com%2Fpost%2F2026-01%2Fcatchadmin-v510-update" target="_blank" title="https://catchadmin.com/post/2026-01/catchadmin-v510-update" ref="nofollow noopener noreferrer">原文 Laravel12 + Vue3 的免费可商用 PHP 管理后台 CatchAdmin V5.1.0 发布 新增 AI AGENTS 配置
</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Flutter 又迎大坑修改？iOS 26 键盘变化可能带来大量底层改动]]></title>    <link>https://juejin.cn/post/7596245612558319625</link>    <guid>https://juejin.cn/post/7596245612558319625</guid>    <pubDate>2026-01-18T23:21:16.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7596245612558319625" data-draft-id="7596181746083217458" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Flutter 又迎大坑修改？iOS 26 键盘变化可能带来大量底层改动"/> <meta itemprop="keywords" content="Flutter,Android,前端"/> <meta itemprop="datePublished" content="2026-01-18T23:21:16.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="恋猫de小郭"/> <meta itemprop="url" content="https://juejin.cn/user/817692379985752"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Flutter 又迎大坑修改？iOS 26 键盘变化可能带来大量底层改动
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/817692379985752/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    恋猫de小郭
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-18T23:21:16.000Z" title="Sun Jan 18 2026 23:21:16 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>又是一个小问题可能带来的大改动，感觉官方在评估的时候，有点过分细节了。</p>
<p>这个问题来自去年底的 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fflutter%2Fflutter%2Fissues%2F179482" target="_blank" title="https://github.com/flutter/flutter/issues/179482" ref="nofollow noopener noreferrer">#179482</a> issue ，Flutter 在 iOS 26 上，某些场景会因为出现半透明键盘，而页面底下本来应该被键盘遮挡的 Widget，由于默认没有被绘制，从而出现键盘背景颜色 UI 异常：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/960cf9e2a42f407dac6a4eb5aafe6af4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769383275&amp;x-signature=tRkOay%2Fo%2BALX8RVRE3sgp2I%2F%2FXM%3D" alt="" loading="lazy"/></p>
<p>虽然问题看起来是一个圆角问题，但是实际上这是 <strong>iOS 26 系统键盘增加了“半透明”后带来的问题，Flutter 在键盘后面那一层在某些场景下没有正确渲染内容</strong>，导致键盘半透明区域透出来的不是底下 BottomSheet 的真实内容，而是一整块黑色区域。</p>
<blockquote>
<p>issue 提到问题，问题最明显的场景主要出现在 iOS 26 的 <code>showModalBottomSheet()</code> 下。</p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/69a144886c414be3b6e47305a8eb2acd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769383275&amp;x-signature=D13kmUfKTbIaHLDDcKlqxIe5nXY%3D" alt="" loading="lazy"/></p>
<p>为什么会这样？首先就是你的 App 目前是否使用了最新 Xcode 26 ，以及在 <code>Info.plist</code> 里有没有使用 <code>UIDesignRequiresCompatibility = YES</code> 让 App <strong>继续使用旧的系统设计风格</strong> ：</p>









<table><thead><tr><th><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d228c8699cf84bb7a40ff83d84e7d548~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769383275&amp;x-signature=qA5pgOEtDcAkTEiihO8DTVksfMs%3D" alt="8b13916c1c0c6339201a1a9f3e797b2e" loading="lazy"/></th><th><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/77ea0a6de3c74a58a4eebc509e328332~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769383275&amp;x-signature=BLnidBWTHY2VKPJ3kDfQnTPmRJ4%3D" alt="" loading="lazy"/></th><th><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/55ea18421a364e35b2dfb93338160e34~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769383275&amp;x-signature=rrzTcCREi89B%2F%2FLdsGeVaGADK90%3D" alt="" loading="lazy"/></th><th><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/56450582bb204f08887af218bc556a2e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769383275&amp;x-signature=dZkfJVjFgJuQ8cPCDJ9lDt9rnAU%3D" alt="" loading="lazy"/></th></tr></thead></table>
<p>通过上面前两张图我们可以看到，iOS 26 正常情况下，系统键盘其实是会出现半透明效果并且具备圆角，虽然透明效果不是特别明显，但是对比后两张图里，可以看到微信和淘宝还是保留着原本的 iOS 18 的直角效果。</p>
<blockquote>
<p>如果还是保留原本风格，其实并不会遇到这个问题。</p>
</blockquote>
<p><strong>所以这个 issue 首先是需要在 Xcode 26 下，并且没有关闭 Liquid Glass 适配的情况下才会遇到</strong>，当然，就算是 iOS 26 场景，一般情况下也不会有什么大问题，比如下图直接在界面内使用一个 <code>TextField</code> ，其实并不会有明显问题：</p>







<table><thead><tr><th><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7dc21612af4240d792024f59e73534fa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769383275&amp;x-signature=ZczUpzI2%2F4yzJxo7DkHRXWaRdLw%3D" alt="" loading="lazy"/></th><th><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8ebc5e2b57044e39b7a5c0358a303dbd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769383275&amp;x-signature=aT7%2Fhqerqj%2FB%2BOCOg%2BfZbNhCiWM%3D" alt="" loading="lazy"/></th></tr></thead></table>
<p>问题还是主要出现在类似 <code>showModalBottomSheet</code> 的场景，特别是在背景色透明的时候，虽然我们设置了 <code>backgroundColor: Colors.transparent</code> ，<strong>但是在 Flutter 里，某些时候 UI 并不会“在键盘背后继续画”</strong> ，因为在 iOS 26 之前，Flutter（以及很多跨平台框架）都默认：</p>
<blockquote>
<p><strong>系统键盘 = 完全不透明的遮挡物</strong>，所以 Flutter 的 pipeline 会认为键盘区域背后不需要特殊关注。</p>
</blockquote>







<table><thead><tr><th><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/18616ed0571f43e7bbc53eac69fde608~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769383275&amp;x-signature=RSAJeipogB69tt4c2w2XPajWu8c%3D" alt="" loading="lazy"/></th><th><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a0cf32020255458f9b4da867f2d3ea05~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769383275&amp;x-signature=P1LvlwLkchu2HRQk3wpGKNPbTA0%3D" alt="" loading="lazy"/></th></tr></thead></table>
<p>实际上类似同样的问题，在 RN 里也是存在，甚至对于 CMP 来说也是存在不一样的问题，所以对于 CMP 来说，才会有 <a href="https://juejin.cn/post/7594863660280496147" target="_blank" title="https://juejin.cn/post/7594863660280496147">1.10 Interop views 新特性 Overlay </a>，用于支持 UIKit 的半透明/blur 可以采样到 Skia 的内容的实验性 API ：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/be381af627b044068bca9e81d400132d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769383275&amp;x-signature=YwDwvtgqLyR2YtSryfsbcVnjHS8%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9faa62b4480d4184bf03025906f70b1e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769383275&amp;x-signature=w7sBOdkCPbhguDnuslJt8UcB72A%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3131730714474d318e3b6c550948efac~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769383275&amp;x-signature=dKBLX9k4AepYwBhEf%2BPUrJam3MY%3D" alt="" loading="lazy"/></p>
<p><strong>所以这个问题实际上的本质不是圆角</strong>，比如我把 <code>showModalBottomSheet</code> 背景改成红色，此时你可以看到键盘是可以采集到背景色的，甚至我把 <code>Container</code> 也改成红色，你也看不出来异常：</p>







<table><thead><tr><th><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9e1f833111e2401cab0380dd3f811a70~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769383275&amp;x-signature=6wRGZG8BkYY%2FZZ%2BOF5ljf%2BLdBvg%3D" alt="" loading="lazy"/></th><th><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d460ae0c2bb841579d3917c03855cce4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769383275&amp;x-signature=bNYm2ONTVFM2Zait%2F5P2P14v2o4%3D" alt="" loading="lazy"/></th></tr></thead></table>
<p><strong>所以问题更多出现在透明色上</strong>，随着 <code>showModalBottomSheet</code> 弹出并带有透明色的时候，由于 Flutter 认为被键盘这挡住的下层 Widget 并不需要绘制，所以导致系统键盘采集不到对应的像素点，从而出现了一开始的黑色背景。</p>
<p>所以其实这个 Bug 如果想临时解决，只需要在 <code>Info.plist</code> 里配置 <code>UIDesignRequiresCompatibility = YES</code> 就可以了，只是此时 App UI 会是 iOS 18 的风格：</p>







<table><thead><tr><th><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4f4baaf1f0c4451da02bf7dbb4b5a8d6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769383275&amp;x-signature=YgKhzcxCFx8gvExY5AN9MhXse08%3D" alt="" loading="lazy"/></th><th><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7d23e4a28d914858ba80b485a8f84345~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769383275&amp;x-signature=2jBsVD1XGRDa5aMtDaeaxGKF2qM%3D" alt="" loading="lazy"/></th></tr></thead></table>
<p>如果再对比抖音和 Github App ，就可以看到 iOS 26 新键盘风格对于整体应用的风格影响还是挺大的，所以不少 App 目前会选择通过关闭适配拖延时间。</p>







<table><thead><tr><th><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8960ebb99a104882930870eb0fcf45a3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769383275&amp;x-signature=7AA5kH6iN%2FlkIojKaU4Zy5EpJAE%3D" alt="" loading="lazy"/></th><th><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/97a572ed7869455495d4bf665f42a773~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769383275&amp;x-signature=VzEuqPTXpH9eXu7qZH88fSR1zG8%3D" alt="" loading="lazy"/></th></tr></thead></table>
<p>那为什么会说，这个 Bug 会导致整个底层生态的重构？<strong>因为 iOS 26 改变了“系统键盘会完全遮挡 App 内容”这一长期不变的底层假设</strong>，而 Flutter 的渲染 / 布局 / Insets / 事件系统，几乎全都建立在旧假设之上，这套逻辑几乎渗透在：</p>
<ul>
<li><code>RenderObject</code> 的 <code>layout</code></li>
<li><code>Scaffold</code> / <code>BottomSheet</code> / <code>Navigator</code></li>
<li><code>MediaQuery</code></li>
<li><code>TextInputPlugin</code></li>
<li>Engine 中的 view hierarchy</li>
<li>···</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/62cbb41513d24b9dabf73ec4acd1f25f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769383275&amp;x-signature=K6pyjNg8LraIRnLVWOWzzrxIQyM%3D" alt="" loading="lazy"/></p>
<p>也就是如果想完全适配这个新场景（多层嵌套下还提供键盘场景的透明支持），一旦需要完全支持“键盘下内容需要绘制”，就要系统性重构多个核心层，例如</p>
<p>：</p>
<h4 data-id="heading-0">Framework 层（Dart）</h4>
<ul>
<li>
<p><code>MediaQuery.viewInsets</code></p>
<ul>
<li>现在代表“不可见区域”</li>
<li>未来要不要拆成多个：<code>coveredInsets</code> 、<code>obscuredInsets</code> 、<code>visualInsets</code></li>
</ul>
</li>
<li>
<p>Scaffold / BottomSheet</p>
<ul>
<li>是否仍然自动 resize？</li>
<li>还是只做布局、不做裁剪？</li>
</ul>
</li>
<li>
<p>Clip 行为</p>
<ul>
<li>现在大量 widget 默认不 clip</li>
</ul>
</li>
</ul>
<h4 data-id="heading-1">Engine 层（iOS embedder）</h4>
<ul>
<li>
<p>FlutterView / UIView hierarchy</p>
</li>
<li>
<p>CALayer 合成顺序</p>
</li>
<li>
<p>系统 keyboard window vs Flutter window</p>
</li>
<li>
<p>是否需要：</p>
<ul>
<li>在被遮挡区域继续 raster</li>
<li>或改变 backing store 策略</li>
</ul>
</li>
</ul>
<h4 data-id="heading-2">输入系统 &amp; Hit Test</h4>
<ul>
<li>
<p>键盘下的 widget：</p>
<ul>
<li>画出来了</li>
<li>但不能响应触摸</li>
</ul>
</li>
<li>
<p>Flutter 目前的 hit-test 假设：</p>
<ul>
<li>“看得见 = 可点”</li>
</ul>
</li>
</ul>
<h4 data-id="heading-3">插件 &amp; 三方生态</h4>
<ul>
<li>
<p>各种：</p>
<ul>
<li>bottom sheet 插件</li>
<li>keyboard avoiding 插件</li>
<li>聊天 UI</li>
</ul>
</li>
<li>
<p>各种涉及“手搓” viewInsets 的场景</p>
</li>
</ul>
<p><strong>所以这个“语义场景”如果发生比变化，那么涉及的将是大量底层改动，甚至一些性能指标都会需要调整，从长远来看，这还会是一个 iOS 平台特有的差异化适配场景，并且引入大量 bread change</strong>。</p>
<h2 data-id="heading-4">最后</h2>
<p>最后总结下，<strong>正常大家使用输入框输入文本内容不会有什么问题</strong>，甚至如果你用 Dialog 场景也不会有什么问题，甚至你看下方最后一张图片，在 dialog 下的键盘依然可以正常透视工作：</p>








<table><thead><tr><th><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4fef0d4e649f4c47b6f6468f3459bb65~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769383275&amp;x-signature=hosWMv7q%2Bh11e2iDmmU0s29C3Pw%3D" alt="" loading="lazy"/></th><th><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/84aa4bb724704c11a5d1ae4d0d3e756d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769383275&amp;x-signature=F8HbVJ2rHQcJ2szaECmfdca3qFk%3D" alt="" loading="lazy"/></th><th><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1541015615bd4d74a0422ce80d396b00~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769383275&amp;x-signature=tYfeB7HDMenshvpeLNRL6sd82f4%3D" alt="" loading="lazy"/></th></tr></thead></table>
<p>所以问题主要还是存在于 <code>BottomSheet</code> 这种场景，因为 <code>BottomSheet</code> 默认行为是认为底部对齐，高度有限，所以对于 <code>BottomSheet</code> 会认为底部高度区域在键盘下不渲染，所以导致最后采集不到像素出现黑色。</p>
<p><strong>针对问题其实可以选择配置 <code>UIDesignRequiresCompatibility = YES</code> 来解决，或者替换为 Dialog 来绕过场景</strong>，但是如果要等官方修复这个场景，可能会需要等待评估是否真的有必要大规模底层改动。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0500f298cdf24bb19b88afb7dc876a1f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769383275&amp;x-signature=tTi4RnJsW0Np0X5mNPeIlRXt5Y8%3D" alt="" loading="lazy"/></p>
<blockquote>
<p>从我的角度看，这完全没必要，毕竟真这么修改，带来的就是生态的大量 break change。</p>
</blockquote>
<h2 data-id="heading-5">参考链接</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fflutter%2Fflutter%2Fissues%2F179482" target="_blank" title="https://github.com/flutter/flutter/issues/179482" ref="nofollow noopener noreferrer">github.com/flutter/flu…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[万字长文：我的3年AI一人公司之路，OPC实践全纪录丨2023-2026]]></title>    <link>https://juejin.cn/post/7596245612558254089</link>    <guid>https://juejin.cn/post/7596245612558254089</guid>    <pubDate>2026-01-18T18:54:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7596245612558254089" data-draft-id="7596166721628831790" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="万字长文：我的3年AI一人公司之路，OPC实践全纪录丨2023-2026"/> <meta itemprop="keywords" content="人工智能,前端"/> <meta itemprop="datePublished" content="2026-01-18T18:54:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="阿星AI工作室"/> <meta itemprop="url" content="https://juejin.cn/user/2250051536050763"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            万字长文：我的3年AI一人公司之路，OPC实践全纪录丨2023-2026
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2250051536050763/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    阿星AI工作室
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-18T18:54:17.000Z" title="Sun Jan 18 2026 18:54:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读37分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2dca4dc519e14d12b0bf3e3592873aae~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_5pifQUnlt6XkvZzlrqQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769367257&amp;x-signature=Y71kzIHwM5HUF%2FIXvgZmDvUK1rY%3D" alt="图片" loading="lazy"/></p>
<p>哈喽 大家好，</p>
<p>我是阿星👋🏻</p>
<p>今天跟大家分享一下</p>
<p>我昨天在超越之路社区北京线下活动分享的OPC （一人公司）主题演讲。</p>
<p>因为现场讲了很多 PPT 上没有的内容，所以我会在每张 PPT 下面再详细展开，尽量还原现场讲的内容。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b8c9433eabeb451b9abe438d7ee4aad3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_5pifQUnlt6XkvZzlrqQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769367257&amp;x-signature=Cb8qssht9sfo48nEJONFleV3Qq8%3D" alt="图片" loading="lazy"/></p>
<p>首先，为什么用“从技术到影响力”这个标题？</p>
<p>因为从 AI 发展以来，我一直都是利用 AI 技术来做自媒体，然后通过接活来维持自己的营收状况，所以我觉得最根本的还是对技术的利用。</p>
<p>之所以说“双螺旋”，是因为 <strong>我们接下来会讲到，整个这条道路其实是以“影响力”和“产品”这两个主要因素为主导的。</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/adbb6c10a1d84c4ca2ec9062defe865e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_5pifQUnlt6XkvZzlrqQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769367257&amp;x-signature=A1f3vGmdf0r3mTCyhQkgoouYIVI%3D" alt="图片" loading="lazy"/></p>
<p>在开始之前，我先介绍一下我自己。</p>
<p>虽然很长时间都是一人公司，但我现在已经不是一个人了有了协作团队，经营着一家工作室，主轴全部是围绕 AI 展开的。此外，我们也涉及以下业务：</p>
<ol>
<li>
<ol>
<li>企业培训</li>
</ol>
</li>
<li>
<ol start="2">
<li>AI 课程研发</li>
</ol>
</li>
<li>
<ol start="3">
<li>定制化开发</li>
</ol>
</li>
</ol>
<p>在整个探索过程中，我慢慢接触到了独立开发，并与知名高校开展了一些深度合作。我经常奔波于各类活动进行分享，因此常出现在各大活动的嘉宾名单中。</p>
<p>在传播经验的同时，我也将思考沉淀为文字。目前，我已在“WaytoAGI”发表了100多篇实战教程类文章，供大家参考。</p>
<p>与此同时，我也经营着全平台同名的自媒体——“阿星AI工作室”。凭借这些内容的积累，我在小红书等平台上也收获了一批忠实粉丝。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8460cbbc3a0e4175b1ea7450ad220bca~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_5pifQUnlt6XkvZzlrqQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769367257&amp;x-signature=T7OUnJERW4Ksr0r4SPebcjzGWMc%3D" alt="图片" loading="lazy"/></p>
<p>通过这次分享，大家可以得到的其实是围绕 OPC 早期升级问题解决办法的一套方案。</p>
<p>我会结合自己的数据和案例， <strong>给大家一套触手可及的工具，让大家能够快速演练起来。</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b778ee8c31aa42ca8359e9f50506bb94~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_5pifQUnlt6XkvZzlrqQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769367257&amp;x-signature=G2bp%2B%2BS0Bq2XTAbOGXNcBS9KiUY%3D" alt="图片" loading="lazy"/></p>
<p>首先，OPC 的接驳期是一个必经之路。</p>
<p><strong>我觉得每个人都要做好挣扎 6 个月以上的准备，大概你需要折腾一年，甚至一年以上，才能够稳定下来。</strong></p>
<p><strong>不管你是否有积蓄</strong> ，这和你家庭背景如何、以往的赚钱能力如何，其实都没有什么关系。因为你在公司里的营收和你个人的赚钱能力，关系并不是很大。 <strong>即使你有积蓄，一旦离职，你的焦虑指数都会上升。如果你能坚持超过 6 个月且没有得抑郁症，其实你已经很厉害了</strong> 。</p>
<p>其实在我离职之前，就有一些非常成功的企业家告诉我：只要你手里有一年的“零花钱”能支撑你度过这段时间，你就可以尝试自己去折腾。当时我正好具备这个条件，所以选择了这条路。</p>
<p>整个过程走下来，我特别认可这些企业家给我的劝告：口中有余粮or有支持系统，再去行动。</p>
<ol>
<li>
<p>如果你手里没有资金，但有可以支配的资源（比如亲戚朋友的帮助或家庭的支持，能帮你减免经济负担），那么即便没有一年的积蓄可能也行。</p>
</li>
<li>
<p>但如果你 <strong>既没有资金，又缺乏社会系统的支持</strong> ，那么压力会非常巨大。在这种情况下，我不太建议你盲目行动。</p>
</li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2978cee9958b431cb6fc8ccbcaab0405~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_5pifQUnlt6XkvZzlrqQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769367257&amp;x-signature=I4Xq%2BUlv4Qn38xlTozVHO%2BLn3L8%3D" alt="图片" loading="lazy"/></p>
<p>所以一开始我的目标就是：别啥都没赚就行了。</p>
<p>就我个人的情况来看，在离职之前，我给自己的目标是赚够 4 万元。是因为希望每个月能多出 3000 多元的收入，一年下来正好是 4 万左右。所以，当时我对自己的预期并不高。</p>
<p>认识我的人都知道，当时我会经常在自己的小群里宣布今天又赚了多少钱，其实可能只是一个 9.9 元的插件收入。 <strong>我要给自己一个幻觉：我开始做事了，让自己的大脑接受我虽然人在公司但是已经在做事业的感觉。</strong></p>
<p>离职之后，我开始冲击 4 万到 10 万这个区间。如果你没有尝试用 AI 去建立一个更大的目标（比如 10 万），是很难突破的。因为我当时完全没有做过副业，我觉得 10 万算是一个比较有象征意义的数字，所以才这样规定。 <strong>主打一个不打击自己。</strong></p>
<p>当你达到 10 万以后，你会发现财富积累的速度比预想中要快得多。此时你的状态会稳定下来，心态也会好很多。</p>
<p>总的来看，从上班摸鱼开始过渡，到最终副业收入超过主业甚至翻倍  <strong>，整个过程你需要有一个心理预期：这可能甚至需要超过两年的时间。</strong></p>
<p>但我宁愿把这个数字说得稍微长一点， <strong>因为我算是比较幸运的，赶在了AI爆发的早期就做了很多动作。</strong>  现在的环境已经不算是AI爆发的早期了，所以我宁愿把这个预期时间说得长一点，以此来降低大家的预期。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ee6734f55c1948e0a79774e0a8a86242~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_5pifQUnlt6XkvZzlrqQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769367257&amp;x-signature=HuY0g9u7yBKg0rIxSb4ttQrLeW0%3D" alt="图片" loading="lazy"/></p>
<p>整个链路下来，其实用的是一 <strong>个“影响力和产品”</strong>  的双螺旋路径。</p>
<p>在画出这张图之前，我还没有看过黄叔的那篇文章，结果他的观点竟然和我的这种想法一模一样。所以我当时就觉得， <strong>原来所有的 KOL 都是吃这一套模型的！！！</strong></p>
<p>简单来说，“影响力和产品”就是一个超级个体的“前店后厂”模式。</p>
<ol>
<li>前店：我们的门店</li>
</ol>
<p>(a) 在前方搭建的自媒体</p>
<p>(b) 线下活动引流</p>
<p>这些充当的都是我们的门面。当流量进入私域之后，再进行转化。</p>
<ol start="2">
<li>后厂：我们的工厂</li>
</ol>
<p>(a) 虚拟资料</p>
<p>(b) 定制化开发</p>
<p>(c) 外包业务</p>
<p>……</p>
<p>这些都只是我们的商品。</p>
<p><strong>就像名创优品店铺里的商品，有的可能来自义乌，并不一定非要由你自己制作。你可以转包给别人，或者找合伙人共同开发、共同承接。</strong></p>
<p><strong>在这个模式中，“店”反而是非常重要的。因为后面的“厂”，我们的承接是可以借力打力的，但这两者缺一不可。</strong></p>
<p>最符合“前店后厂”模式的典型代表，就是现在非常流行的独立开发中的 Gemini 3 娱乐化开发。</p>
<p>在传统的独立开发中，我们通常是辛苦地开发一个 App 并上架，经过痛苦的多次迭代后才发帖宣传。 <strong>但 Gemini 3 的出现，让整体开发速度变得非常快。虽然它不属于正式开发，但它能方便地进行引流，为你的“店铺”吸引更多顾客。</strong></p>
<p>在宣发过程中，这种模式不仅宣传了产品，还通过以下三个方面激发了用户对产品的关注：</p>
<ol>
<li>
<ol>
<li>吸引注意力：虽然小的 Demo 可能没有实际用途，但它能迅速抓住受众眼球</li>
</ol>
</li>
<li>
<ol start="2">
<li>教学内容：你可以教别人如何制作，提供知识价值</li>
</ol>
</li>
<li>
<ol start="3">
<li>激励情绪：教完之后激励大家动手去做，配合娱乐内容提升参与感</li>
</ol>
</li>
</ol>
<p>一旦用户进入你的产品后端（例如添加了你并建立了信任），我们就可以在私域中推广真正的产品。这些产品包括你的付费课程以及 1V1 咨询以及任何形式的产品，从而实现产品的深度转化。</p>
<p>这些产品不仅能教会学员学习开发或 AI，你在教学过程中还能产生新的内容：</p>
<ul>
<li>• 痛点挖掘：在与学员交流中发现他们的痛点，针对痛点再创作内容并发布</li>
<li>• 循环迭代：当你开发出新工具后，又会形成第二次循环再吸引一批粉丝到私域</li>
<li>• 客户评价：学员夸了你你又截图发布，出去讲学也发朋友圈，不断正循环……</li>
</ul>
<p>所以说，独立开发是很适合“前店后厂”模式的运营模型。</p>
<p><strong>注意看，我这里说独立开发是一种运营。</strong></p>
<p>我们常常把开发当成开发，但 <strong>开发因为AI技术的演进，其实是一种很重要的运营工具了已经。</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cf56edf5f1024008b6b8beb19d8d5482~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_5pifQUnlt6XkvZzlrqQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769367257&amp;x-signature=iejUDqbWrK6OKJXSNEm%2B6Bm45j4%3D" alt="图片" loading="lazy"/></p>
<p>接着，就我个人而言，在我还没有离职的时候，主要是在做插件生意。</p>
<p>例如——</p>
<ul>
<li>• 你可以观察一些功能非常出色的 Chrome 插件，思考是否可以对其进行优化，然后开发出一个属于你自己的新版本。</li>
<li>• 或者针对 GitHub 上的一些无名小项目，将其原有的 Python 脚本进行可视化处理，做成一个简单易用的小工具。</li>
</ul>
<p>这样能够迎合更多用户，并将其转化为自己的产品进行盈利（当然，前提是必须符合相关的开源 License）。</p>
<p>另一方面，在上班的过程中卖这些插件，一个月能有 3000 多元的收入就已经很不错了，所以这个时候对自己的要求不要太高。</p>
<p><strong>独立开发最大的挑战在于没时间，因为上班时总会有各种工作需要响应。</strong></p>
<p><strong>很多学员问我这种情况该怎么办，我的建议只有两个字：硬干。</strong></p>
<p>因为在这个阶段没有人能帮你，你唯一能做的就是压缩休息时间：</p>
<ol>
<li>
<ol>
<li>缩短午餐时间：我当时上班时吃饭速度非常快，吃完后立马回到工位。</li>
</ol>
</li>
<li>
<ol start="2">
<li>利用午休时间以及所有周末：</li>
</ol>
</li>
<li/>
<li>
<p>我之前参加的那些智能体比赛（并赢得了几千元奖金）以及写的文章，全都是中午在工位上完成的。</p>
</li>
<li/>
<li>
<p>而且有一天电脑坏了我竟然跑到网吧坐到了12点，被一个喝了酒的男的一直盯着办公，感觉像是黑社会，但是我太忙了没时间换座位，我就忍者害怕一直干到12点。在网吧的电脑上搭了5个小时的工作流，给扣子投稿，参加比赛来增加自己的曝光。后来我一些商业机会就是因为当时在扣子积累了高质量粉丝获得的。</p>
</li>
<li/>
<li>
<p>我说这个是让大家明白，必须豁出去。</p>
</li>
<li/>
<li>
<ol start="3">
<li>保持高强度学习：我有整整两三年的时间，在上班午休期间从不睡觉，全部用来学习 AI 或参加各类比赛。</li>
</ol>
</li>
<li/>
<li>
<ol start="4">
<li>前期难免要吃很多苦。比如说 Coze 的比赛，它对模板的选拔非常严格，几千个模板里面只选几十个。所以别人投稿只投一个，我都会投 20 个，让评委无法忽视我。参加飞书的比赛也是一样，别人投一两个，我就投 10 个，以此增加自己被选上的概率。</li>
</ol>
</li>
<li/>
<li>
<ol start="5">
<li>因为我知道在 AI 发展的初期，我必须把自己的名字加入到 SEO 里面，我必须要占这个坑。所以我宁愿消耗自己来做这些事情，用大量的付出换来一点关注</li>
</ol>
</li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bf74e76caa5a41e891859f95cc045a7c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_5pifQUnlt6XkvZzlrqQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769367257&amp;x-signature=ksQgFFAkktRTB8SBjplJEw7U%2BUs%3D" alt="图片" loading="lazy"/></p>
<p>我也开发了一些比较“垃圾”的软件去亮亮相。</p>
<p>当然，这里的“垃圾”是带引号的。因为现在流行一句话：先做一个“垃圾”出来。这时候没关系的，能发“垃圾”就是成功。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ea68bc81758e4cabbc1fcb29e7bc79d6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_5pifQUnlt6XkvZzlrqQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769367257&amp;x-signature=cAkVanMisyCc2xc%2B5aoqhy%2FqJeI%3D" alt="图片" loading="lazy"/></p>
<p>但是在参加比赛的过程中，我就发现其实是可以“一鱼多吃”的。</p>
<p>因为我好不容易做了一个智能体（Agent），</p>
<p>我是否可以把它写下来，或者拍成一个制作智能体的视频？</p>
<p>通过这种方式，我可以拓展多方面的收入渠道：</p>
<ol>
<li>
<ol>
<li>赚取模板流量收入</li>
</ol>
</li>
<li>
<ol start="2">
<li>获得参赛奖金</li>
</ol>
</li>
<li>
<ol start="3">
<li>发布成 Agent 应用</li>
</ol>
</li>
<li>
<ol start="4">
<li>接一些定制化开发的单子</li>
</ol>
</li>
</ol>
<p>所以这个时候，我才有了多元化收入的意识，并在脑海中开启了正儿八经的商业化萌芽。</p>
<p>我知道，我要把我整个人的经历进行商业化， <strong>或许这就是我 OPC 一人公司的雏形。</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3dc0447d6d92472ea68728ad1ab382a2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_5pifQUnlt6XkvZzlrqQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769367257&amp;x-signature=Wa7IxECXu%2FBowVqprhUpbJi9T7A%3D" alt="图片" loading="lazy"/></p>
<p>其实当时做的那些东西，在今天看来，可能已经不适合在企业里用了。</p>
<p><strong>但在 AI 爆发的初期，你不用去考虑它是否真的是 To B 的，高级不高级。</strong></p>
<p><strong>因为从 OPC（一人公司）的维度来讲，你要做的就是尽量增加自己的影响力，去多做一些你能做的 Demo。</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d6809eb0d0894b72b9390d1859174d23~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_5pifQUnlt6XkvZzlrqQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769367257&amp;x-signature=1kinfCFkxcL5bNv%2BJP%2F3fVMvTNU%3D" alt="图片" loading="lazy"/></p>
<p>后来我和一些产品经理、非常优秀的研发朋友们交流时，发现大家都希望做一个完整的产品。</p>
<p>但在我们现在的阶段，其实是在 OPC（一人公司）谋生的阶段我们真的不用去考虑做一个很正经的产品出来， <strong>因为早期是为了谋生存，而不是谋求完美。</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f68f66b6df854cfa8ebed376ac82f9f6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_5pifQUnlt6XkvZzlrqQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769367257&amp;x-signature=qX80NIq6nPJMEk946hm%2FK3rzgzc%3D" alt="图片" loading="lazy"/></p>
<p>后来我就离职了，不想再“装”下去了。如果你一直按照公司那一套思维或者所谓的行业标准去做事，手上是没有进账的，这对我来说是不 OK 的。</p>
<p><strong>我对我自己的要求就是：如果我想盈利，我必须得看到进账。这是一个底线。</strong></p>
<p>很多时候大家会忘了这个底线。</p>
<p><strong>很多时候很多人觉得必须做一个优秀的产品出来，才算是一个优秀的人。但对我来说不是这样的，优秀的产品可以是我做出来的，也可以是别人做出来的，我对此没有执念。我是否优秀，不需要通过一个产品来证明。</strong></p>
<p>我只要能够在初期活下来就 OK 了。至于这个产品是否符合优秀产品经理或优秀研发的标准，我觉得无所谓， <strong>我都已经离职了，为什么还要让别人来评判我呢？</strong></p>
<p>我上班还没上够吗？我为什么要别人来决定我的行为呢？</p>
<p>他们会为我的早期生存买单吗？不会啊。</p>
<p>所以我灵机一动，开始随心所欲，比如转移注意力踅摸钱，比如盯上自媒体。但 <strong>我犯了一个巨大的错误：我只做图文。</strong></p>
<p>所以原因有3点：</p>
<p><strong>1. 我们需要服务于甲方,即使你的图文做得很完美，对甲方来说也是不行的。</strong></p>
<p>因为他们主要的展现方式就是视频。 <strong>我们产品这么牛逼，你只会图文怎么能展示出产品的核心竞争力呢？</strong></p>
<p><strong>2. 淳朴、朴实的视频本身也极具吸引力。</strong></p>
<p>如果能重来一次，我会选择只做视频，就像张咋拉那样，把一个很原始的想法不经修饰地以视频形式发表出来，这都要比做一个精美的图文要好。</p>
<p><strong>3.从最根本的角度上来讲，还是因为很多人还在上班，没有一个需要通过 AI 谋生的最根本诉求。</strong></p>
<p>他们没法对自己下狠手去做视频这种超级费人的活儿。一旦你有了真正的谋生诉求，你就不会给自己那么多时间去犹豫，肯定会一步到位选择视频，而不是先从图文去过渡。可能是因为没有压力，或者说你还没有下狠心要吃 AI 这碗饭。</p>
<p>所以，在小红书或任何平台上，坚持主力做图文注定是一个非常愚蠢的决定。最后我终于想通了，决定开始做视频。但到那个时候，已经过去了大概大半年，我现在非常后悔。</p>
<p><strong>我自己其实很有感触。在公众号流行的时候，我因为特别懒，没有去抓住那波红利。当时总觉得人生中任何时候都有机会，所以对自己是一个很懈怠的状态。</strong></p>
<p>现在我觉得时间仿佛在倒流，回到了当时奶茶妹妹出名、那个制造网红的时代。就像老天爷又给了我一次机会，所以我不愿意再懈怠了。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/24dfc0d65e44442493b8c7a51284a68d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_5pifQUnlt6XkvZzlrqQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769367257&amp;x-signature=GhPAlTttJdNa7cy0qZPkO%2F40Ie8%3D" alt="图片" loading="lazy"/></p>
<p>所以慢慢的改变，当时整个的业务范围就是轻量化内容驱动了：</p>
<ol>
<li>
<ol>
<li>做内容</li>
</ol>
</li>
<li>
<ol start="2">
<li>出去给别人培训</li>
</ol>
</li>
<li>
<ol start="3">
<li>转介绍（针对一些自己做不了的单子）</li>
</ol>
</li>
<li>
<ol start="4">
<li>找人合伙开发（针对能做得了的单子）</li>
</ol>
</li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c774df448b8d47c8b6071cada5810de9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_5pifQUnlt6XkvZzlrqQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769367257&amp;x-signature=vmTEj8w1DKvRbVRjnyjY0kjZmks%3D" alt="图片" loading="lazy"/></p>
<p>在做这些基本业务的时候，</p>
<p>我也非常刻意地去增强自己的社会影响力。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5b749984e50d4bd7a91bc372fb1d045e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_5pifQUnlt6XkvZzlrqQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769367257&amp;x-signature=xML0P9oaDqM62%2B7OhnVoXqq6dfo%3D" alt="图片" loading="lazy"/></p>
<p>这里想提醒大家：你一旦去做 OPC（个人职业化），并不代表一定要完全靠 AI 为生。你可以做一些和 AI 八竿子打不着的工作，只要先保证自己有进账即可。</p>
<p>当时在离职之后，我AI相关的工作没法没法达成我的收入目标，所以还是接了一些非 AI 的工作。</p>
<p>比如我会做一些短视频脚本撰写的工作，先让自己“饿不死”。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0033ac0901f847cbacf161105fdf4ebe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_5pifQUnlt6XkvZzlrqQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769367257&amp;x-signature=wLlF3tguhDUlkIoKol7y3Rq54NM%3D" alt="图片" loading="lazy"/></p>
<p>最后直接改变收入速度的，其实还是因为做出了一个爆款视频。</p>
<p><strong>你可能会觉得不可思议，但一个爆款视频有时能让你的自媒体突然之间就开始有源源不断的商单。</strong>  这对于一个以自媒体为其中一条主线的创业者来说，是非常关键的。</p>
<p><strong>你可能以为自己要开发出什么特别牛逼的 APP 才能实现收入保障，实际上，可能仅仅是因为一条短视频，才让你活得稍微体面一些。</strong></p>
<p>其他的收入节点主要是因为一些工程承包。像这样的话，属于个人资源范围了。我自己是一个资源和人脉还可以的人，所以这一方面就不需要再跟大家讲了，因为我讲了之后，大家也无法复刻。所以主要还是跟大家讲自媒体这方面。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/15f7ddca597c4373b36a154c96e3e150~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_5pifQUnlt6XkvZzlrqQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769367257&amp;x-signature=1p0mjIcW0NW0qQL1EBX%2Fr1PFJsw%3D" alt="图片" loading="lazy"/></p>
<p>另外，在刚离职的这个阶段，受生计的压迫，你会发现自己思维的优先级已经变了。你会开始考虑哪个活儿的入账速度更快：</p>
<ol>
<li>
<ol>
<li>定制化开发：收账速度很慢，有的甚至要半年。</li>
</ol>
</li>
<li>
<ol start="2">
<li>自媒体：虽然过程很烦，但从长期发展来看，它是必不可少的基石，是地基式的东西。</li>
</ol>
</li>
</ol>
<p><strong>这与我们通常认为“自媒体是无根浮萍”的观点完全相反，自媒体反而可能给你带来类似“社会低保收入”的保障。</strong></p>
<p>此外，你会开始思考自己的终极目标，思考到底走哪条线：是做自媒体、定制化开发，还是做产品？你会进入新一轮的深度思考。</p>
<p><strong>那时候我才发现，原来当你的 AI 收入突破 10 万以后，再去思考自己的定位一点都不晚。因为即使OPC收入突破 10 万，你的个人身份在这个社会上依然是一个 nobody。</strong>  你想一想，一个 nobody 需要什么定位吗？</p>
<p>所以你平常在网上看到的各种教你做自媒体定位的东西，主要是一些非常专业化的解读。但实际上，在你的个人实践没有达到一定程度时，那些解读对你来说可能太过于专业了。</p>
<p>你可以结合自己的实践去看网上的专业解读，但核心还是要以你自己的实践为主。 <strong>你会发现在早期，你可能和“定位”根本就不沾边。</strong>  你这个时候好像还没有追求个性化定位的资格，因为你得先光靠走量做短视频，让商单跑起来。</p>
<p>比如，一周能有 3 条 3000 元的短视频，你就已经很不错了。你脑子里（在早期）真的应该全是这些东西。 <strong>等你先把这个现实目标达成了，之后再看自己到底想定位成黄叔还是卡兹克，都是 OK 的。</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/50428fb92cbe4d7f845266eb88ab48c0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_5pifQUnlt6XkvZzlrqQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769367257&amp;x-signature=5%2FeZhJRt76mUG35Illq8QcqbpS4%3D" alt="图片" loading="lazy"/></p>
<p>所以我个人总结下来，我的OPC 五件套就是：</p>
<ol>
<li>
<ol>
<li>自媒体</li>
</ol>
</li>
<li>
<ol start="2">
<li>开发</li>
</ol>
</li>
<li>
<ol start="3">
<li>私域</li>
</ol>
</li>
<li>
<ol start="4">
<li>账本</li>
</ol>
</li>
<li>
<ol start="5">
<li>自我激励</li>
</ol>
</li>
</ol>
<p>其他的大家可能都理解，但我自己最重视的其实是最后两种（账本和自我激励）。在我所观察到的人里，会去关注这两项的其实非常少。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d0a8264ea4044d9aba1e1a2ef51fb817~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_5pifQUnlt6XkvZzlrqQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769367257&amp;x-signature=2VG1YWS1aKqBdpmJkeReE9RpqA4%3D" alt="图片" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8882046a0475461bb7602ab48df791bf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_5pifQUnlt6XkvZzlrqQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769367257&amp;x-signature=xpm3h%2Blptx51IQQkyLgTzRavRCs%3D" alt="图片" loading="lazy"/></p>
<p>首先从自媒体上来讲，自媒体本身就是一个很拥挤的赛道。在这个赛道里，大家好不容易发现AI是个热词，所以做了很多AI账号。</p>
<p>但这些账号大部分都是工具号，它们的内容逻辑通常是：</p>
<ol>
<li>
<ol>
<li>介绍某个产品：比如上来就说“哇，这个Nano Banana好牛逼啊！”</li>
</ol>
</li>
<li>
<ol start="2">
<li>展示功能：接着说“我用了Nano Banana，体验了各种各样的功能，效果很好。”</li>
</ol>
</li>
</ol>
<p>这类账号属于典型的“AI工具类账号”。——</p>
<p><strong>当你读完小明说Nano Banana很牛逼时，你会觉得产品确实厉害；</strong></p>
<p><strong>当你看到小明用Nano Banana做了一个很魔改的工具时，你会觉得小明这个人很厉害。</strong></p>
<p><strong>IP是后者不是前者。</strong></p>
<p>这也是为什么，我会推荐我的学员去做一些和独立开发相关的事情。而不是让自己仅仅成为一个单纯的工具，因为那样很容易被人忘记。大家只会记得你推荐的工具，而不是你。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d69bf3b27e614399a9bf8ea149ec28b1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_5pifQUnlt6XkvZzlrqQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769367257&amp;x-signature=vtUxLs8hFKYIBzXZxHxz%2FHIE2c0%3D" alt="图片" loading="lazy"/></p>
<p>认识到做IP的和重要性后我才发现，只要IP能站稳一些而不是做一个无根浮萍的工具号人设，多管道收入就会变得可能。</p>
<p>后来我就试着在纸上写下我知道的AI自媒体收入管道，然后我发现AI 圈子里的 KOL，其收入都是非常多元化的。就像这张图上展示的结构一样，那个时候我才发现，自己对自媒体的认知实在太浅薄了。我一直以为自媒体只是发个广告，一个广告也就两三千块钱，后来才意识到它其实是一个非常立体的多元化管道。</p>
<p><strong>我至今还清晰地记得那个瞬间：</strong></p>
<p>有一天，我通过小红书的一个帖子得到了一个机会。</p>
<p>我跑到经常交流的群里，特别兴奋地分享道：“哇塞，我还以为自媒体只能赚小钱，原来自媒体还能给我带来这么好的机会！”</p>
<p>这时，群里一位从未和我交谈过的老师突然说：“这不就是你的限制性信念吗？”</p>
<p><strong>那一瞬间，我整个人都惊呆了。我心想，为什么这个世界上会有人像神谕一样出现在我的世界里，对我宣告这样一句话？</strong></p>
<p>然后我就马上去搜索什么叫“限制性信念”。</p>
<p>随后我理解到：哦，原来这就是代表我对自媒体有一种特别限制的认知：我会觉得这个东西只能用来做广告。我用自己的大脑规定了它的用处，但实际上它的用处是非常宽广的。</p>
<p>这就是我的限制性信念。 <strong>所以在之后的道路里，我都会尽量去避免这种思维方式</strong> 。而且在这一路过来， <strong>我发现那些曾经和我一起学习这些东西的人，他们无法再前进的根本原因，也是因为无法摆脱这种限制性信念。</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a4a55a77d81b467b90f6c067376489b8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_5pifQUnlt6XkvZzlrqQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769367257&amp;x-signature=0h5wLcwBu98XoMPyHgIfNXxTA7g%3D" alt="图片" loading="lazy"/></p>
<p>所以我就放开思路，放手去做。</p>
<p>我发现原来只要放弃那些顽固的限制性信念，就能很轻松地发现自己的思维bug，之前之所以做不出成果，主要是因为两个思维bug：</p>
<ol>
<li>1. <strong>太想做爆款，导致动作变形</strong></li>
</ol>
<p>我总是模仿短视频教程里的那一套，一上来就要搞个“黄金三秒”，封面非要用那种极其浮夸、爆款味儿浓浓的AI封面。但其实那并没有决定性价值，仅仅是其中的一个因素。</p>
<p>因此，我开始让自己更加注重内容的信息密度。在一分钟之内呈现的信息密度越高，内容质量就越高，爆款的概率反而更大。</p>
<ol>
<li>3. <strong>更加重视“信息差”的呈现</strong></li>
</ol>
<p>我会更灵敏地发掘别人不知道的选题。比如“AI可以预防老年人跌倒”这类预测监控的新奇内容，我会注重把它当作灵感库，有需要就去发。我甚至会去挖掘一些“别人不知道自己不知道”的事情，比如：</p>
<p>(a) 豆包的快捷键在PC版可以魔改成Typeless的一个平替版，这种属于深度“冷知识”，我会快速发现并把它变成选题。</p>
<p>(b) 平常在群里和朋友讨论时汲取灵感，他们提到把Gemini 3的视觉前端工程师的Prompt设定做成“小红书卡片生成器”，我也会快速跟进。</p>
<p>在这个过程中，我发现自己对内容的理解不再是一种“表演”，这是非常重要的。</p>
<p><strong>顺便要提一句：如果你还没有做过300多条内容的话，其实没有资格说自己在很努力地做小红书。</strong></p>
<p>因为张咋啦自己做了300多条，连我也发了300多条才开始有起色。所以大家明白了吗？你做小红书如果还没达到300这个数量，那可能纯粹只是数量的问题。</p>
<p><strong>我在活动现场也有朋友问我：“老师，如果发了一条自己觉得很牛逼的内容，但是平台没有给赞怎么办？”</strong></p>
<p>我当时就告诉他：“那你就接着发，就完事了。”除了去分析这篇内容的好坏和死穴之外，大部分时候还是要接着发，接着发才是最重要的。什么时候你在小红书上打开 AI 这个标签，里边或多或少有一些你自己的帖子，这个时候你发的数量才是比较 OK 的，大家也能够有比较大的概率遇见你。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4a9f215546444e8a81f51e2181c000ae~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_5pifQUnlt6XkvZzlrqQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769367257&amp;x-signature=dMC7UOvbIVaUJQ7LrSd%2FVmvLGR0%3D" alt="图片" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/64c49332056740dbb43ba480d6b37a55~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_5pifQUnlt6XkvZzlrqQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769367257&amp;x-signature=iBQLE%2FteZ9lVkQ64pWmuZ3oZe3w%3D" alt="图片" loading="lazy"/></p>
<p>独立开发这块的话，我主要是开发一些“垃圾”，或者说一些没人用的 App。但我并不 care，因为既然我已经离职了，我就不需要接受别人的评判。</p>
<p>我只要老老实实做我自己的就可以了。我就可以老老实实、心安理得地开发“垃圾”。因为既然我开发了，我就是在发散自己的注意力和创造力，给这个社会带来更多灵感。所以即使我开发的是“垃圾”，我也是在做一件正向的事情。</p>
<p>我不会因为专业人士说“你这个东西在技术上并不完美”而困扰，这些对我来说并不重要。我只要能让更多小白看到，使用AI能够带来这么多乐趣，激发他们对于这个技术的探索，让他们多打开几次 DeepSeek，我觉得我做的事情就已经让我满意了。</p>
<p>至于它有没有意义，无所谓。我为什么一定要有意义呢？我不需要向任何人交代我的生活有没有意义。我想有意义就有意义，想没意义就没意义，无所谓。</p>
<p><strong>反而对我是一个机遇。</strong></p>
<p>在 Gemini 3之前，我主要通过发布 DeepSeek 的 Prompt（提示词）来吸引关注，因为 DeepSeek 本身就是“天选流量”。到了 Gemini3时代，它带来了“天选开发流量”，进一步增强了我们在 AI 编程展示上的可视化效果。</p>
<p>在这个阶段，我会开始通过刷短视频来寻找灵感：</p>
<ol>
<li>
<ol>
<li>比如刷一些 NASA 的短视频，观察它呈现的星空或物理现象。</li>
</ol>
</li>
<li>
<ol start="2">
<li>我会将这些物理现象重新制作成视频。</li>
</ol>
</li>
<li>
<ol start="3">
<li>这种做法其实是经过他人的数据检验后，再来做自己的视频和 Gemini3的相关开发。因为 Gemini3在看到任何视频样式后，基本上都能将其逻辑呈现出来而且数据上有了一定验证。</li>
</ol>
</li>
</ol>
<p><strong>所以在这个时候，我进一步意识到，Gemini 3 本身就是独立开发 IP 的天选工具。</strong>  因为独立开发 IP 本来就需要大量呈现 demo，之前我们做 demo 实在太费劲了，在本地 IDE 运行可能要报错好多次。但有了 Gemini 3，我们“足不出户”，在 Google AI Studio 里面就可以完成。</p>
<p><strong>因此我们有了更多的选择空间，也可以大幅提高产出的频率。这个时候就会又有人说了：那你这个不是把编程给游戏化了吗？</strong></p>
<p>那又怎么样呢？编程早晚会变得游戏化，早晚会变得像一种娱乐一样。包括你看到“风变编程”出的很多编程课，其实都已经开始娱乐化寓教于乐了。</p>
<p><strong>只有少部分人还在说，这个东西不够专业，说它不能 to B，不是企业级的，不能落地之类的。但是：</strong></p>
<ol>
<li>
<p>为什么一定要落地呢？</p>
</li>
<li>
<p>为什么一定要是企业级呢？</p>
</li>
<li>
<p>为什么一定要那么 professional 呢？</p>
</li>
</ol>
<p>难道我们需要向谁汇报吗？</p>
<p>我觉得编程反而变得更个人化（personal）了，而不是专业化（professional）。</p>
<p>它将来 to C 的趋势其实就是个人化。所以，如果别人拿你的个人编程去和企业级服务做对比，说你这个东西不能落地，那我觉得是他的逻辑有问题，没必要理会。因为 2B 服务和 2C 的东西本来就不是一回事。。</p>
<p>而且有人会说：“你怎么还在做 To C 啊？你指望 To C 给你钱吗？”</p>
<p>但其实 To C 确实不适合大部分人。因为 To C 需要“天选 IP”的人来做，需要你特别招人待见。你这张脸得有让人喜欢的感觉，起码不能让人讨厌——这指的不是颜值，而是一种天生的、像演员一样的观众缘。</p>
<p>另一方面，To C 还需要很多灵感。 <strong>它不像 To B 是基于现实的刚性需求，但灵感很多时候比刚需更需要天赋是很考验人的一个东西。</strong>  所以大部分人说 To C 不好做，也是因为一个事实。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/201f7f0bf9a64cd4a526ae98c7a6e338~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_5pifQUnlt6XkvZzlrqQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769367257&amp;x-signature=dB3qTXlUkNken7zt1yEB2d2bz9I%3D" alt="图片" loading="lazy"/></p>
<p>To C 虽然门槛更低、更好入门，但不容易脱颖而出也是真的。</p>
<p>所以在整个过程中，我都没有想过向任何人交代。 <strong>To C 不好做，不代表大部分人做不成，更不代表我就做不成。</strong>  我不会拿别人的标准来套我自己。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/db22ed6e7ca846988f985163ea8774d5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_5pifQUnlt6XkvZzlrqQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769367257&amp;x-signature=47Z5Ffn1ra%2BtWkf6hNGSSj1cZGo%3D" alt="图片" loading="lazy"/></p>
<p>所以这个时候你就会发现， <strong>Gemini 3是天选toC自媒体工具。</strong></p>
<p>虽然做的是“小杯开发”，因为它非常方便，但它的流量却是“大杯”的。这就为想做 To C 独立开发 IP 的人提供了一个便利。</p>
<p>这也是为什么我会选择继续在 To C 领域投入时间，因为这个工具实在太适合了。当然，这同时也基于我个人的性格、内容策划能力以及灵感丰富程度等个人条件。</p>
<p>我觉得如果你想做 To C 的独立开发 IP，就需要综合考虑这些因素，而不是说 Gemini 3 出现了，你就一定能驾驭。这其实未必，因为有的人在性格、思维方式、心态、说话方式、声音和语气上，天生就不适合做 IP，也不适合去做那种试图破圈的内容。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9bc3928e7fb9456eab3328dfabb4ff8c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_5pifQUnlt6XkvZzlrqQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769367257&amp;x-signature=xtBKE%2F4nbKEyhhozpVBDTNDHpII%3D" alt="图片" loading="lazy"/></p>
<p><strong>另外一个方面，Gemini 3 之所以适合大量被应用在视频制作上，也是因为它的可视化在单位时间内传递的信息量够大。</strong></p>
<p>你自己出镜之后，辨识度就拉满了。比如：</p>
<ol>
<li>
<ol>
<li>你用xxx做了一个魔改</li>
</ol>
</li>
<li>
<ol start="2">
<li>或者用 Python 写了一个脚本</li>
</ol>
</li>
</ol>
<p>这些都是基于你个人特质的。这样你就有了一个高度的信息差，你可以在视频开头说：“今天跟大家分享一下我做的 XXX 东西，我们先来看一下效果。”这时候你就抛出了一个“钩子”。在整个视频的过程中，你其实是在不断解谜，而这个过程可以让观众停留在你的视频上。 <strong>所以说，Gemini 3 的开发其实就是一个解谜游戏，这也为我们整个视频的制作和拍摄提供了一个根本逻辑。</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b10a80cfdcaf4ab8afd406787b52a04d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_5pifQUnlt6XkvZzlrqQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769367257&amp;x-signature=mgXgLfRQtYT483DDCutDqEJHygI%3D" alt="图片" loading="lazy"/></p>
<p>所以以 Gemini 3 作为引子的话，我们其实完成了一个从产品 Demo 到吸引到私域社群，再到转化的完整链路。</p>
<p>大家不要觉得这个东西很新，其实整个圈子里面的人都是这么做的。</p>
<p><strong>昨天活动结束后，我和一个技术管理专家讨论时，他感到很惊讶：没想到现在小红书上有这么多人都在用 Gemini 3 来体验科技的乐趣了。</strong></p>
<p>这就是信息差，很多人其实还不知道这回事。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/81d8f62129be48238d5008be03750fa0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_5pifQUnlt6XkvZzlrqQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769367257&amp;x-signature=OVWZUE5qepvc01FxGnS5L6oJXAA%3D" alt="图片" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2435548f0ecd4228a8813736ef62a189~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_5pifQUnlt6XkvZzlrqQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769367257&amp;x-signature=rZCmc8fkHN%2FSQcS8OAvt%2FysaBaQ%3D" alt="图片" loading="lazy"/></p>
<p>所以我进行了很多gemini3实践。它并不是直接关于 Gemini 3 的，而是衍生出来的支付、部署或者是 iOS 上架。其实这已经脱离了 Gemini 3 了。并且退一步说，即使没有 Gemini 3，这些案例我也是会做的，只不过我把它和 Gemini 3 结合起来了。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f4f41f33ec75481b98ece472b47a63a9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_5pifQUnlt6XkvZzlrqQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769367257&amp;x-signature=h7nlvysQal%2BLVTeyllHlfGeX3DU%3D" alt="图片" loading="lazy"/></p>
<p>比如把 MBTI 这个热词和 Gemini 3 结合起来</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/49911819e54d4c35a94c62637c94375f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_5pifQUnlt6XkvZzlrqQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769367257&amp;x-signature=GtRWIe8uZCaO2p7VwD%2BchvosasI%3D" alt="图片" loading="lazy"/></p>
<p>比如看到张咋拉做了一个背单词的 App，但我需要改进成自己的创意，于是就把背单词改成了点读机背单词app。</p>
<p>通过拍摄课本，直接把课本转化为一个 SVG 的点读。虽然换一张课本就不能再读了，但它却符合 Gemini 3 这个 Demo 开发的乐趣。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3a364159d5324e14a765ec78b06ba632~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_5pifQUnlt6XkvZzlrqQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769367257&amp;x-signature=4uWYSOn8QWNcBanE8V2d16qwD60%3D" alt="图片" loading="lazy"/></p>
<p>像这种复古拍立得更是很短的时间内就完成了</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b655ef1f291641b983750f9ecdeafe4a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_5pifQUnlt6XkvZzlrqQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769367257&amp;x-signature=KgUDx2hxMUFEjbRyXNUq0oBtUI0%3D" alt="图片" loading="lazy"/></p>
<p><strong>我在做完这些选题之后会进行一些分析。我发现很多选题虽然某些专业朋友不喜欢，但观众却非常青睐。</strong></p>
<p>比如这个“英语教材点读机”：</p>
<ol>
<li>
<ol>
<li>技术逻辑：它是 AI 在识别课本图片后进行定位，再围绕定位绘制 SVG 图案。</li>
</ol>
</li>
<li>
<ol start="2">
<li>局限性：由于这种特定的实现方式，在拍摄其他课本时，无法直接复现出动画 SVG 的点读功能。</li>
</ol>
</li>
<li>
<ol start="3">
<li>市场反馈：</li>
</ol>
</li>
<li>
<ol start="4">
<li>(a) 对于专业人士而言，这在技术上是有瑕疵的。</li>
</ol>
</li>
<li>
<ol start="5">
<li>(b) 但广大宝妈、英语老师和网友却非常喜欢这种神奇的体验。</li>
</ol>
</li>
</ol>
<p>正因为它的数据反馈非常好，所以之后在做选题时，我不会因为同行觉得技术上有瑕疵就放弃去做。相反，也有一些案例是同行很喜欢的，但在观众中反响一般。</p>
<p>比如我们经常接触 Web coding 的，都会喜欢做一些很经典的 Web 项目（如上面MBTI 网站）。因为国外有一个很火的 16 Personalities，所以coding朋友会喜欢这种项目，但观众可能不太买账，他们更喜欢在移动端去体验 MBTI 测试，而且MBTI这个群体没有学英语的范围更大，所以它不可能在流量上超越背单词APP。</p>
<p>这给我一个启发：还是得多做。多做了之后，在选题发出之前，我们其实就能预知自己内容的命运。也能锻炼自己对产品的一个体感。我甚至会跟我的技术朋友们开玩笑说：“你们有什么需求拿过来给我诊断，10块钱一次。”是不是好的需求，我马上就知道了。可能就是犯了太多错、踩了太多坑，能培养出一点体感了。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5b5c5e2e163c4b41be24e8c2c128fa26~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_5pifQUnlt6XkvZzlrqQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769367257&amp;x-signature=jeMAg6Ho5CGGPSw9dOXhSm0DzpY%3D" alt="图片" loading="lazy"/></p>
<p>重中之重，</p>
<p>账本其实是OPC的核心，</p>
<p>但是很多OPC是没有勇气去建立账本的。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/52a428a210294a738e40bd5c8548bc77~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_5pifQUnlt6XkvZzlrqQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769367257&amp;x-signature=u4BRNSB8y3TFiiJrKYezOBrmrw4%3D" alt="图片" loading="lazy"/></p>
<p>比如如果你现在正在冲击月入10万，你可以尝试把目标拆解成日入3000。这样一来，你的压力会小很多。</p>
<p>当你盯着日入3000这个数字时，你会自然而然地去寻找能每天带来3000收入的路径。你可能会发现，写个小红书帖子似乎能更快实现这个目标。这时，你就不再纠结“这是否会影响我独立开发者身份”之类的问题，而是首先盯准那3000，并尽量将手头的工作与这个目标结合起来。这就是一种重心的合理化。</p>
<p>比如说，你依然在做独立开发，但你可以顺便把开发过程录制下来，通过这种方式照样去挣那3000元。只要你的目标锚定在具体的数字上，你的整个行为就会变得科学一点。就我个人而言，情况确实如此，我也一直在这样实践。</p>
<p>此外，有了具体数字的另一个好处是，我们会更精密地计算自己的时间价值。例如：</p>
<ol>
<li>
<ol>
<li>直播通常是一次性的，而做自媒体视频是否具有时间复利？</li>
</ol>
</li>
<li>
<ol start="2">
<li>在初期阶段，我真的适合做直播吗？</li>
</ol>
</li>
<li>
<ol start="3">
<li>如果直播无法带来二次曝光，我是不是等到后期才更适合开启直播？</li>
</ol>
</li>
<li>
<ol start="4">
<li>我天天忙着做直播，是否会影响我日入3000的目标呢？</li>
</ol>
</li>
<li>
<ol start="5">
<li>那我的时间精力是否得重新盘一盘呢？</li>
</ol>
</li>
</ol>
<p>通过这种数字化的衡量，我们甚至可以改变自己的行动决策。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ae776c27a81a456ab1845fec8c5cd6e8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_5pifQUnlt6XkvZzlrqQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769367257&amp;x-signature=uHm3hDTrZPPxKaKR11Ywd%2Fhb7Fs%3D" alt="图片" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/81cd46c38e704a83987098e42ae6e25f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_5pifQUnlt6XkvZzlrqQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769367257&amp;x-signature=WaxdNd0WqY2kRFCZQm6DBUnqDHE%3D" alt="图片" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/13d9c33a0d9a4a3eb6100a6a70b7eaf0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_5pifQUnlt6XkvZzlrqQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769367257&amp;x-signature=128nyIu5%2Fd1RUa%2FIDMCLvUXt9tg%3D" alt="图片" loading="lazy"/></p>
<p>私域的话不用多说，做好一个星球的详情页，用我们最常见的一种“引流、转化、留存”的方式去做。能够坚持下来，就已经很不错了。</p>
<p>但需要强调的一点是：很多人会觉得自己需要 Title，觉得自已是个 nobody 就不能在私域里卖东西。</p>
<p>但其实不是这样的。如果你是 60 分的水平，去教 30 分的人就可以了。这对于 30 分的人来说，其实是公平的。因为他们能够学到很多高于自己认知的东西。只要他们能学到东西，认可你的服务，而且你没有糊弄他们，是认真教学的，那你就不是在“白嫖”他们。而不是说你非要把 60 分变成 90 分再去教别人。那个时候你作为个人品牌（OPC），可能早就没有粮草了。</p>
<p>再退一步说，你作为 60 分去教 30 分的人，在教学的过程中是需要不断学习的。过不了多久，你就会把自己变成 70 分、80 分，甚至 90 分。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/053e58799fa64d0baf418fd4debcd38d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_5pifQUnlt6XkvZzlrqQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769367257&amp;x-signature=TCA1ctjP4zTdjGWMp1nl3SiKwuU%3D" alt="图片" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2cee036c32274f54bb7728dba33b3056~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_5pifQUnlt6XkvZzlrqQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769367257&amp;x-signature=PpbsPCH6YGc650O9Gqs3fPffSmU%3D" alt="图片" loading="lazy"/></p>
<p>所以整个下来，对我自己来说，我的转折点主要有两个：</p>
<p>1、一个是参加各种活动。</p>
<p>你只要作为嘉宾参加第一个活动，然后你就可以拿着这个背书去参加第二个、第三个、第四个。</p>
<p>2、一个是接各种小额的广告。</p>
<p>这些小额广告又反过来促进了我通过参加活动获得更多曝光。这样说可能有点难以理解，我给大家举个例子：</p>
<p>我在去年接了一个 500 元的广告。虽然我当时粉丝量特别少，但我给那个广告做出了 1000 到 2000 元的价值。因为我的尽心尽力，那个品牌的运营就记住了我。</p>
<p>后来在 2050 大会时，王坚院士那边搞活动，这位运营邀请了很多 KOL，竟然也邀请了我这个无名之辈。当时我还没听过这种大阵仗，不知道那是啥活动，就抱着平常心去了。结果那次活动回来后，直接让我的影响力有了很大改观。</p>
<p>所以整个过程对我来说是超值的：</p>
<ol>
<li>
<ol>
<li>我只是把一份 500 元的工作做出了 2000 元的价值。</li>
</ol>
</li>
<li>
<ol start="2">
<li>这种投入让你有机会认识更多品牌的运营，从而获得更多曝光机会。</li>
</ol>
</li>
</ol>
<p>由此可见，你的广告业务和参加活动之间其实有着紧密的联系。认真做好每一个广告。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/abb729a4c58a4bb1b00daf83270e18d2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_5pifQUnlt6XkvZzlrqQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769367257&amp;x-signature=8%2BMiZ7cIvRiiHmkh3wZJ2NAZnWc%3D" alt="图片" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1cb752a361da4621b12522242aeb8e7a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_5pifQUnlt6XkvZzlrqQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769367257&amp;x-signature=VwBc0jwS5rbvg9lB3CsrQ0e%2Bupg%3D" alt="图片" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e2919e7f216446d78509aee723be98fa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_5pifQUnlt6XkvZzlrqQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769367257&amp;x-signature=gxQUTpYSBjxTthgEfRaTW6bRZvA%3D" alt="图片" loading="lazy"/></p>
<p>最后也是最重要的，其实是一种自我激励，你也可以把它理解成“洗脑”。</p>
<p>但我觉得它是所有行动的核心。因为在从一个普通上班族到OPC转型的过程中，我听过太多难听的话，太多负面的话，太多想要打倒我、甚至想要让我崩溃的话。</p>
<p>但我都是选择不听、不看、不搭理。</p>
<p>因为我觉得离开公司之后，我只用对自己负责就可以了。</p>
<p>至于你怎么说，那是你的想法。你的想法是你的事情，不是我的事情，我们要做好课题分离。</p>
<p>另外还有最重要的一点：我需要精力的提升。</p>
<p>为了实现这一点，我曾连续两个月没有休息，疯狂地去“卷”自己。卷到最后一天时，我真的趴在枕头上哭了，因为实在是太累了——那不是身体上的疲惫，而是精神快要崩溃的感觉。懂吧？身心崩溃。</p>
<p>但我选择接着卷下去。 <strong>在坚持了两个月之后，我整个人的精力实现了一个质的飞跃</strong> 。现在我每天可能工作18个小时，也不会觉得太累。在那种高度集中精力的状态下，我只会感到身体层面的劳累，而不再有精神上的疲惫和内耗。</p>
<p>所以说，精力并非精英的专属，普通人也可以通过大量的劳动，让身体逐渐适应高强度的节奏。这个方法比较狠，但我觉得非常有用。我跟很多人说过这个方法，但大部分人都没有对自己下过这种狠手。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bc1d5aee4bdd4187ae49eb883e83197f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_5pifQUnlt6XkvZzlrqQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769367257&amp;x-signature=Wsi3WPJdVb4ETHv3hX4lkUBlEd8%3D" alt="图片" loading="lazy"/></p>
<p>所以总的来说，我自己觉得在自己做 OPC 赚到 10 万块钱以前，不用动太多脑子，是没有必要的。</p>
<p>至于以后的话，更多的是靠一些资源，那些部分我们可能没法相互对齐。但我今天之所以讲这些，还是想把能够对齐的部分分享给大家。</p>
<p>最后我要跟大家分享一个故事：</p>
<p><strong>有一天，我在星巴克干活的时候，有一个读者竟然认出我来。</strong>  他看过我之前给“灵光APP”做的广告视频。那一瞬间，我感觉特别害怕，所以我装作买完咖啡离开了一会儿。</p>
<p>但是后来我在想，我是否真的准备好成为一个更加头部的 KOL，进一步成为一名企业家？</p>
<p>因为很多 KOL 可能没有想过要转型做企业，但对于我来说，这就是我下一步的目标。这种大胆的想法，在以前的我看来是没有的；但是通过这两年的实践，我发现即使有了这样的想法，好像也不再觉得夸张了。</p>
<p>所以我想，这就是那句话的力量：实践是检验真理的唯一标准。</p>
<p>OK，我是阿星。更多 AI 应用，我们下期再见！</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/03479be5a2b548388a26b2f8a0d660b4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_5pifQUnlt6XkvZzlrqQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769367257&amp;x-signature=55YwsbJEsUmGmUNcvtbTlYXG6Mw%3D" alt="图片" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Next.js第二十二章(国际化)]]></title>    <link>https://juejin.cn/post/7596170399881691188</link>    <guid>https://juejin.cn/post/7596170399881691188</guid>    <pubDate>2026-01-18T21:25:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7596170399881691188" data-draft-id="7596186565270568975" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Next.js第二十二章(国际化)"/> <meta itemprop="keywords" content="前端,Next.js"/> <meta itemprop="datePublished" content="2026-01-18T21:25:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="小满zs"/> <meta itemprop="url" content="https://juejin.cn/user/2463384809252397"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Next.js第二十二章(国际化)
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2463384809252397/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    小满zs
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-18T21:25:56.000Z" title="Sun Jan 18 2026 21:25:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">国际化(<code>i18n</code>)</h2>
<p>国际化(Internationalization)是<code>Next.js</code>提供的一种机制，用于支持多语言的网站，例如可以实现中英文切换，包括接口同步翻译，以及不同语言所展示的页面不一样等。</p>
<p>小知识：i18n(<code>internationalization</code>)的由来是取自开头i和结尾n的中间有18个字母，所以称为i18n，其他的也是类似的例如k8s(<code>kubernetes</code>)就是取自开头k和结尾s的中间有8个字母，所以称为k8s。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/12b6edc96f024515846518bfa7b9cbfb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5ruhenM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769376356&amp;x-signature=R9%2FjByIyl5iW6xfME%2FGQWgMiZQk%3D" alt="12.gif" loading="lazy"/></p>
<p>本章节比较复杂完整源码获取地址<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FXiaoManZS%2FNext.js-i18n" target="_blank" title="https://github.com/XiaoManZS/Next.js-i18n" ref="nofollow noopener noreferrer">github.com/XiaoManZS/N…</a>,建议下载配合观看</p>
<h4 data-id="heading-1">术语解释</h4>
<p>在学习之前我们需要了解一些术语：</p>
<p>language: 语言(排名不分先后)</p>
<ol>
<li>英语(English) 用<code>en</code>表示</li>
<li>中文(Chinese) 用<code>zh</code>表示(zh取自<code>Zhongwen</code>的拼音)</li>
<li>日本语(Japanese) 用<code>ja</code>表示</li>
<li>韩国语(Korean) 用<code>ko</code>表示</li>
</ol>
<p>语言速查表: <a href="https://link.juejin.cn?target=https%3A%2F%2Fzh.wikipedia.org%2Fwiki%2FISO_639-1" target="_blank" title="https://zh.wikipedia.org/wiki/ISO_639-1" ref="nofollow noopener noreferrer">zh.wikipedia.org/wiki/ISO_63…</a></p>
<p>territory：地区(排名不分先后)</p>
<ol>
<li>美国(United States) 用<code>US</code>表示</li>
<li>中国(China) 用<code>CN</code>表示</li>
<li>日本(Japan) 用<code>JP</code>表示</li>
<li>韩国(Korea) 用<code>KR</code>表示</li>
</ol>
<p>地区速查表: <a href="https://link.juejin.cn?target=https%3A%2F%2Fzh.wikipedia.org%2Fwiki%2FISO_3166-1" target="_blank" title="https://zh.wikipedia.org/wiki/ISO_3166-1" ref="nofollow noopener noreferrer">zh.wikipedia.org/wiki/ISO_31…</a></p>
<p>一般我们把语言和地区组合起来，称为<code>locale</code>，例如<code>en-US</code>表示英语(美国)，<code>zh-CN</code>表示中文(中国)。</p>
<h4 data-id="heading-2">实现原理</h4>
<p>Next.js建议我们使用http报文头来判断用户使用的语言<code>Accept-Language</code>，例如<code>Accept-Language: zh-CN,zh;q=0.9,en;q=0.8</code>表示用户使用中文(中国)，如果用户没有设置，则使用默认语言。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c3ff5070c4f5483a9be9b788eb6019b7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5ruhenM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769376356&amp;x-signature=or2Ihe9z6hdwfV3UeHOFRB2ldWI%3D" alt="image.png" loading="lazy"/></p>
<h5 data-id="heading-3">Accept-Language规则</h5>
<p><code>zh-CN,zh;q=0.9,en;q=0.8</code> 表示用户使用中文(中国)，权重为1(最大值1会被省略)，中文(中国)权重为0.9，英语(美国)权重为0.8。</p>
<h5 data-id="heading-4">安装第三方库</h5>
<pre><code class="hljs language-bash" lang="bash">npm i negotiator <span class="hljs-comment"># 用于解析Accept-Language</span>
npm i @formatjs/intl-localematcher <span class="hljs-comment"># 用于匹配语言</span>
</code></pre>
<p>src/proxy.ts 创建一个代理函数,关于<code>proxy</code>代理函数在之前的篇章已经讲过了。</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">NextRequest</span>, <span class="hljs-title class_">NextResponse</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'next/server'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Negotiator</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'negotiator'</span>
<span class="hljs-keyword">import</span> { match } <span class="hljs-keyword">from</span> <span class="hljs-string">'@formatjs/intl-localematcher'</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">proxy</span>(<span class="hljs-params">req: NextRequest, res: NextResponse</span>) {
    <span class="hljs-comment">// 获取请求头</span>
    <span class="hljs-keyword">const</span> headers = {
        <span class="hljs-string">'accept-language'</span>: req.<span class="hljs-property">headers</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">'accept-language'</span>) || <span class="hljs-string">''</span>
    }
    <span class="hljs-comment">// 解析请求头</span>
    <span class="hljs-keyword">const</span> negotiator = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Negotiator</span>({ headers })
    <span class="hljs-comment">// 获取语言</span>
    <span class="hljs-keyword">const</span> language = negotiator.<span class="hljs-title function_">languages</span>()
    <span class="hljs-comment">//['zh-CN', 'zh', 'en-US', 'en', 'ja']  // 按优先级从高到低排序</span>
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> config = {
    <span class="hljs-attr">matcher</span>:[
        <span class="hljs-string">'/((?!api|_next/static|_next/image|favicon.ico).*)'</span>, <span class="hljs-comment">//跳过内部匹配路径</span>
    ]
}
</code></pre>
<p>例如 <code>Accept-Language: zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7,ja;q=0.6</code></p>
<p>解析规则：</p>



































<table><thead><tr><th>语言</th><th>权重 (q值)</th><th>说明</th></tr></thead><tbody><tr><td>zh-CN</td><td>1.0 (默认)</td><td>最优先</td></tr><tr><td>zh</td><td>0.9</td><td>第二优先</td></tr><tr><td>en-US</td><td>0.8</td><td>第三优先</td></tr><tr><td>en</td><td>0.7</td><td>第四优先</td></tr><tr><td>ja</td><td>0.6</td><td>最低优先</td></tr></tbody></table>
<pre><code class="hljs language-ts" lang="ts">[<span class="hljs-string">'zh-CN'</span>, <span class="hljs-string">'zh'</span>, <span class="hljs-string">'en-US'</span>, <span class="hljs-string">'en'</span>, <span class="hljs-string">'ja'</span>]  <span class="hljs-comment">// 按优先级从高到低排序</span>
</code></pre>
<p>简单复刻了一下<code>Negotiator</code>的实现</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">const</span> languages = <span class="hljs-string">'zh-CN,zh;q=0.9,en;q=0.8'</span>.<span class="hljs-title function_">split</span>(<span class="hljs-string">','</span>)
<span class="hljs-keyword">const</span> languagesWithQ = languages.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">language</span>=&gt;</span>{
    <span class="hljs-keyword">const</span> [lang,q] = language.<span class="hljs-title function_">split</span>(<span class="hljs-string">';'</span>)
    <span class="hljs-keyword">return</span> {
        lang,
        <span class="hljs-attr">q</span>:<span class="hljs-built_in">parseFloat</span>(q?.<span class="hljs-title function_">split</span>(<span class="hljs-string">'='</span>)[<span class="hljs-number">1</span>] || <span class="hljs-string">'1'</span>)
    }
}).<span class="hljs-title function_">sort</span>(<span class="hljs-function">(<span class="hljs-params">a,b</span>)=&gt;</span>b.<span class="hljs-property">q</span>-a.<span class="hljs-property">q</span>).<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">item</span>=&gt;</span>item.<span class="hljs-property">lang</span>)
</code></pre>
<h5 data-id="heading-5">匹配语言</h5>
<p>src/dictionaries/index.ts定义项目支持的语言和默认语言。</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> locales = [<span class="hljs-string">'en'</span>, <span class="hljs-string">'zh'</span>,<span class="hljs-string">'ja'</span>,<span class="hljs-string">'ko'</span>] <span class="hljs-comment">// 配置项目支持的语言</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> defaultLocale = <span class="hljs-string">'zh'</span> <span class="hljs-comment">// 项目默认使用的语言</span>
</code></pre>
<p>tsconfig.json 配置别名</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"paths"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
       <span class="hljs-comment">//新增别名@dict</span>
      <span class="hljs-attr">"@dict/*"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-string">"./src/dictionaries/*"</span>
      <span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>src/proxy.ts继续完善代理函数(完整代码)</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">NextRequest</span>, <span class="hljs-title class_">NextResponse</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'next/server'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Negotiator</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'negotiator'</span>
<span class="hljs-keyword">import</span> { match } <span class="hljs-keyword">from</span> <span class="hljs-string">'@formatjs/intl-localematcher'</span>
<span class="hljs-keyword">import</span> { locales, defaultLocale } <span class="hljs-keyword">from</span> <span class="hljs-string">'@dict/index'</span> <span class="hljs-comment">// 导入项目支持的语言和默认语言</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">proxy</span>(<span class="hljs-params">req: NextRequest, res: NextResponse</span>) {
    <span class="hljs-comment">// 如果请求路径为根路径，则直接返回 首页不做任何处理</span>
    <span class="hljs-keyword">if</span>(req.<span class="hljs-property">nextUrl</span>.<span class="hljs-property">pathname</span> === <span class="hljs-string">'/'</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">NextResponse</span>.<span class="hljs-title function_">next</span>()
    }
    <span class="hljs-comment">//如果路径已经包含所支持的语言，则直接返回 例如 /zh/about /zs/home 等</span>
    <span class="hljs-keyword">if</span>(locales.<span class="hljs-title function_">some</span>(<span class="hljs-function"><span class="hljs-params">locale</span> =&gt;</span> req.<span class="hljs-property">nextUrl</span>.<span class="hljs-property">pathname</span>.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">`/<span class="hljs-subst">${locale}</span>`</span>))){
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">NextResponse</span>.<span class="hljs-title function_">next</span>()
    }
    <span class="hljs-comment">// 获取请求头</span>
    <span class="hljs-keyword">const</span> headers = {
        <span class="hljs-string">'accept-language'</span>: req.<span class="hljs-property">headers</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">'accept-language'</span>) || <span class="hljs-string">''</span>
    }
    <span class="hljs-comment">// 解析请求头</span>
    <span class="hljs-keyword">const</span> negotiator = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Negotiator</span>({ headers })
    <span class="hljs-comment">// 获取语言</span>
    <span class="hljs-keyword">const</span> language = negotiator.<span class="hljs-title function_">languages</span>()
    <span class="hljs-comment">//['zh-CN', 'zh', 'en-US', 'en', 'ja']  // 按优先级从高到低排序</span>
    <span class="hljs-keyword">const</span> lang = <span class="hljs-title function_">match</span>(language, locales, defaultLocale)
    <span class="hljs-comment">//language-浏览器支持的语言 locales-项目支持的语言 defaultLocale-项目默认语言</span>
    <span class="hljs-comment">// 匹配语言例如 zh-CN 则 lang 返回 zh en-US 则 lang 返回 en 如果没有匹配到则返回默认语言defaultLocale</span>
    <span class="hljs-keyword">const</span> pathname = req.<span class="hljs-property">nextUrl</span>.<span class="hljs-property">pathname</span>
    <span class="hljs-comment">// 拼接语言</span>
    req.<span class="hljs-property">nextUrl</span>.<span class="hljs-property">pathname</span> = <span class="hljs-string">`/<span class="hljs-subst">${lang}</span><span class="hljs-subst">${pathname}</span>`</span>
    <span class="hljs-comment">// 重定向 例如用户访问的是/home 我们则读取语言后重定向到/zh/home 给它增加语言前缀</span>
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">NextResponse</span>.<span class="hljs-title function_">redirect</span>(req.<span class="hljs-property">nextUrl</span>)
}
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> config = {
    <span class="hljs-attr">matcher</span>:[
        <span class="hljs-string">'/((?!api|_next/static|_next/image|favicon.ico).*)'</span>, <span class="hljs-comment">//跳过内部匹配路径</span>
    ]
}
</code></pre>
<h5 data-id="heading-6">新建测试用例</h5>
<p>src/dictionaries/zh.json</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"标题"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"描述"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"keywords"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"关键词"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>src/dictionaries/en.json</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"title"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"description"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"keywords"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"keywords"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>src/dictionaries/ja.json</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"タイトル"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"説明"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"keywords"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">" キーワード"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>src/dictionaries/ko.json</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"제목"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"설명"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"keywords"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"키워드"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>上面这四个文件会根据locale参数动态导入，例如locale为zh则导入src/dictionaries/zh.json，locale为en则导入src/dictionaries/en.json等等</p>
<p>src/dictionaries/index.ts 定义测试用例</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> <span class="hljs-title class_">Dictionary</span> = {
    <span class="hljs-attr">title</span>: <span class="hljs-built_in">string</span>
    <span class="hljs-attr">description</span>: <span class="hljs-built_in">string</span>
    <span class="hljs-attr">keywords</span>: <span class="hljs-built_in">string</span>
}
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> locales = [<span class="hljs-string">'en'</span>, <span class="hljs-string">'zh'</span>,<span class="hljs-string">'ja'</span>,<span class="hljs-string">'ko'</span>] <span class="hljs-comment">// 支持的语言</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> defaultLocale = <span class="hljs-string">'zh'</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getDictionary</span>(<span class="hljs-params">locale: <span class="hljs-built_in">string</span></span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">Dictionary</span>&gt; {
    <span class="hljs-comment">//例如locale为zh 则返回 src/dictionaries/zh.json</span>
    <span class="hljs-comment">//locale为en 则返回 src/dictionaries/en.json</span>
    <span class="hljs-comment">//locale为ja 则返回 src/dictionaries/ja.json</span>
    <span class="hljs-comment">//locale为ko 则返回 src/dictionaries/ko.json</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">`./<span class="hljs-subst">${locale}</span>.json`</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">module</span> =&gt;</span> <span class="hljs-variable language_">module</span>.<span class="hljs-property">default</span>)
}
</code></pre>
<p>src/[lang]/home/page.tsx 测试页面</p>
<p>这个页面的params参数是动态路由参数，例如访问/zh/home 则params参数为{ lang: 'zh' }，访问/en/home 则params参数为{ lang: 'en' }等</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">import</span> { getDictionary } <span class="hljs-keyword">from</span> <span class="hljs-string">'@dict/index'</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Home</span>(<span class="hljs-params">{ params }: { params: <span class="hljs-built_in">Promise</span>&lt;{ lang: <span class="hljs-built_in">string</span> }&gt; }</span>) {
  <span class="hljs-comment">//获取语言</span>
  <span class="hljs-keyword">const</span> { lang } = <span class="hljs-keyword">await</span> params
  <span class="hljs-comment">//获取字典 lang = zh/en/ja/ko等</span>
  <span class="hljs-keyword">const</span> dictionary = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getDictionary</span>(lang)
  <span class="hljs-comment">//返回页面</span>
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>{dictionary.title}<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>{dictionary.description}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>{dictionary.keywords}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
}
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0ea4994d919d4248971732a23deb5dc1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5ruhenM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769376356&amp;x-signature=ZmtNAc0u8eDNz2BJG4NFBNkYzdA%3D" alt="image.png" loading="lazy"/></p>
<h5 data-id="heading-7">封装语言切换组件</h5>
<p>src/app/[lang]/home/switchI18n.tsx</p>
<p>这个组件是语言切换组件，他会根据当前语言切换到对应语言的页面，例如当前语言为zh，则切换到/zh/home页面，当前语言为en，则切换到/en/home页面等</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-string">'use client'</span>
<span class="hljs-keyword">import</span> { locales } <span class="hljs-keyword">from</span> <span class="hljs-string">'@dict/index'</span>
<span class="hljs-keyword">import</span> { usePathname,useRouter } <span class="hljs-keyword">from</span> <span class="hljs-string">'next/navigation'</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">SwitchI18n</span>(<span class="hljs-params">{lang}: {lang: <span class="hljs-built_in">string</span>}</span>) {
    <span class="hljs-keyword">const</span> pathname = <span class="hljs-title function_">usePathname</span>() <span class="hljs-comment">// 获取当前路径</span>
    <span class="hljs-keyword">const</span> router = <span class="hljs-title function_">useRouter</span>() <span class="hljs-comment">// 获取路由实例  </span>
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleChange</span> = (<span class="hljs-params">e: React.ChangeEvent&lt;HTMLSelectElement&gt;</span>) =&gt; {
        <span class="hljs-keyword">const</span> newLang = e.<span class="hljs-property">target</span>.<span class="hljs-property">value</span> <span class="hljs-comment">// 获取新语言</span>
        <span class="hljs-keyword">const</span> newPath = pathname.<span class="hljs-title function_">replace</span>(<span class="hljs-string">`/<span class="hljs-subst">${lang}</span>`</span>, <span class="hljs-string">`/<span class="hljs-subst">${newLang}</span>`</span>) <span class="hljs-comment">// 替换语言</span>
        router.<span class="hljs-title function_">replace</span>(newPath) <span class="hljs-comment">// 跳转新路径</span>
    }
    <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">value</span>=<span class="hljs-string">{lang}</span> <span class="hljs-attr">onChange</span>=<span class="hljs-string">{handleChange}</span>&gt;</span>
            {locales.map(locale=&gt;<span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{locale}</span> <span class="hljs-attr">value</span>=<span class="hljs-string">{locale}</span>&gt;</span>{locale}<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span>)}
        <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
}
</code></pre>
<p>src/app/[lang]/home/page.tsx 使用语言切换组件</p>
<p>这个页面是首页，他会根据当前语言显示对应语言的标题，描述，关键词，就是刚才那四个json文件中的内容</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">import</span> { getDictionary } <span class="hljs-keyword">from</span> <span class="hljs-string">'@dict/index'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">SwitchI18</span>n <span class="hljs-keyword">from</span> <span class="hljs-string">'./switchI18n'</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Home</span>(<span class="hljs-params">{ params }: { params: <span class="hljs-built_in">Promise</span>&lt;{ lang: <span class="hljs-built_in">string</span> }&gt; }</span>) {
  <span class="hljs-keyword">const</span> { lang } = <span class="hljs-keyword">await</span> params
  <span class="hljs-keyword">const</span> dictionary = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getDictionary</span>(lang)
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">SwitchI18n</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">{lang}</span> /&gt;</span> {/* 语言切换组件并且传入当前语言 */}
    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>{dictionary.title}<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>{dictionary.description}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>{dictionary.keywords}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
}
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【我与2025】裁员、旅游、找工作、媳妇没跑]]></title>    <link>https://juejin.cn/post/7596221097865658374</link>    <guid>https://juejin.cn/post/7596221097865658374</guid>    <pubDate>2026-01-18T16:10:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7596221097865658374" data-draft-id="7596476124839264298" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【我与2025】裁员、旅游、找工作、媳妇没跑"/> <meta itemprop="keywords" content="年终总结"/> <meta itemprop="datePublished" content="2026-01-18T16:10:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="修己xj"/> <meta itemprop="url" content="https://juejin.cn/user/2641475936724142"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【我与2025】裁员、旅游、找工作、媳妇没跑
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2641475936724142/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    修己xj
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-18T16:10:56.000Z" title="Sun Jan 18 2026 16:10:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>现在是2026年1月下旬。以往的年终总结总被搁置，今年却有些不同——家里添了新成员，自己的心态也悄然变化。于是决定写下这些文字，既是回顾我的2025，也是一次认真的复盘。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5dcd75417d8c426b88d005727610cc52~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769357455&amp;x-signature=6Ul9MtGUTbRqNrF0EHY6kiVxH%2F0%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-0">裁员</h2>
<p>2021年6月，我加入上一家公司，一待就是四年。2025年收到的第一份“礼物”，竟是公司的裁员通知。我负责的是运营业务系统，因为常有线上问题需要处理，所以即便下班后、节假日也离不开电脑。几年来，我几乎没出省旅行过，每次回家都随身带着电脑，随时待命。</p>
<p>刚入职时，公司正处于扩张期，盈利状况很好。没过多久，就搬进了自购的整层办公楼，团队规模也从100人逐步扩大到近500人。那时每年都有十三薪，还有优秀员工奖励，整体氛围积极向上。</p>
<p>然而随着业务方向调整，公司渐渐显出疲态。到了2024年，十三薪取消了，公司也开始约谈员工，“优化”了一部分同事。工资偶尔延迟发放，有些同事主动选择了离开。我心里很矛盾：既想换工作，又希望拿到裁员补偿。于是边断断续续看面试题、做准备，边等待那份“裁员礼包”。</p>
<p>2024年底，公司终于找我谈裁员事宜。沟通结束后，我在12月底正式离职。离开公司那一刻，心情意外地轻松不少。我打算先出门走走，然后回家安心过年。至于工作，等过完年再慢慢找吧。</p>
<p>以下是我在公司上班的路上拍的一些照片。</p>
<ul>
<li>雾蒙蒙的早上</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1a784d00a1854960ada9380aa0e93045~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769357455&amp;x-signature=CtujtWPTRZBpOTWJJG2%2BObo7UW4%3D" alt="_20231211123946.jpg" loading="lazy"/></p>
<ul>
<li>秋风吹落的树叶</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e61898841ed5463fbc900fa43acc38b5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769357455&amp;x-signature=IgoDUVg4qiRpIKyZu4ibXJIAJvI%3D" alt="_20231211123938.jpg" loading="lazy"/></p>
<h2 data-id="heading-1">旅游</h2>
<p>离职之后，工作的烦恼一扫而空，整个人都轻松了不少。我跟媳妇提议“出去转转吧”，两人一拍即合，随即来了一场说走就走的云南之行。我们去滇池边喂了海鸥，还巧遇了热闹的马拉松比赛；在洱海边同样与海鸥嬉戏，又登苍山静览连绵山景。这一路，也真切感受到了云南那四季如春的美好。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2b572f2ab04e4312b77328dd5c623e9a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769357455&amp;x-signature=dIasITqOwCIIj5n2Zek3FfftjEU%3D" alt="2025-dh1.jpg" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/13d7f5f76baf4aeaab51320457d34fdc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769357455&amp;x-signature=Dza7ObSoObP5foChDXKxmd2koow%3D" alt="2025-dh2.jpg" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e5a7c2f20435489e8491529bad3673f8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769357455&amp;x-signature=iiVSKOFyYQtvZPnefRipTYJegzs%3D" alt="2025-dh3.jpg" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/801cada823224709a4d325e0d1da127b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769357455&amp;x-signature=fHUvzVKLlF8m5W%2FCtdPgv%2FL4o1I%3D" alt="2025-dh4.jpg" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7670e777dc164bada1d49e91ef5e7e14~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769357455&amp;x-signature=wphGQmyBlmuBBrpYHlN6bbnvZCU%3D" alt="2025-dh6.jpg" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cf96c920bbb9435a9f429e834d2ab9c3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769357455&amp;x-signature=kHqkZZBOAVaHO4A6tQO4DGfckEs%3D" alt="2025-dh7.jpg" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/78e15db814924a28b5b543ebaec924cf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769357455&amp;x-signature=Br50Gg1jdtnaiLE3SH3ejQyhZ5k%3D" alt="2025-dh8.jpg" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a5890fc131cf4fc4b9ebe2c5cd37b45c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769357455&amp;x-signature=UKsi%2BPdXQOuq3cy%2BIS4q8pR8gk8%3D" alt="2025-eh1.jpg" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/74204655c0b241438ab6d35429e60021~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769357455&amp;x-signature=opKUMkIMNxJFivZkiOSJRd0Mem8%3D" alt="2025-eh2.jpg" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/397604f002ef4db39f12f39909809ec4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769357455&amp;x-signature=Vb7P8rF4GFjsYnWm2a%2BrcTxYfLA%3D" alt="2025-cs1.jpg" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2eee522b97fa42c8a345c217aa687510~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769357455&amp;x-signature=cTCiGKFp1p96OiLnuarThFmIKuU%3D" alt="2025-cs2.jpg" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3a6965839798492083bd0b8f7e3da692~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769357455&amp;x-signature=USEiNzX9TF%2FeV6ezjUkFpwc61og%3D" alt="2025-cs3.jpg" loading="lazy"/></p>
<h2 data-id="heading-2">工作</h2>
<p>过完年后，我开始着手找工作，一边复习一边投简历。这段时间投了不少岗位，但大多数都“已读不回”，明显感觉今年找工作比往年要难不少。</p>
<p>接到过一些华为外包的岗位机会，需要先通过机试。为此我专门刷了大半个月算法题，结果却连机试都没过。其他给面试机会的公司里，有不少是短期项目，也有要求驻场开发的。还遇到一些在居民楼里办公的小公司，面试问的题目却堪比“造火箭”，难度高得有点不匹配。</p>
<p>最后，还是靠朋友内推，去了一家做TDM系统的公司上班。整个求职过程下来，我的感受是：现在的面试无论在深度还是强度上，都比以前提升了很多，尤其是各种开放场景题。所以也想提醒大家，平时不妨多刷点面试题，就算暂时不找工作，也能让自己保持状态。这样万一工作有变动，才能从从容容、游刃有余，而不至于手忙脚乱、连滚带爬。</p>
<h2 data-id="heading-3">学习</h2>
<p>今年因妻子怀孕，加之我个人有些懒散松懈，原定的学习、读书和考证计划基本都搁置了，博客也写得断断续续，只更新了44篇。新的一年即将开始，是时候重新规划，好好学习了！</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/15caf3f51436466084df1be4303ca785~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769357455&amp;x-signature=EbO7SrCO7YPYNscaKiu6S06Lowc%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-4">家庭</h2>
<p>我和妻子备孕许久，今年年初或许得益于我们每天一起打乒乓球、外出旅游、常去爬山，心情舒畅，妻子终于顺利怀孕。但怀孕后她孕吐比较厉害，每天都很难受。年底时，我们的“蛇宝宝”平安出生，全家人都特别开心。</p>
<p>住院那几天，我们请了护工帮忙。出院回家后，便开始了坐月子、带娃的生活。我和妻子都是第一次做父母，没什么经验，一开始总有点手忙脚乱。妻子月子里休息不好，人也显得很憔悴。女性生育，无论在身体还是心理上，消耗都非常大，真的特别辛苦。</p>
<p>这件事也让我开始反思：今后一定要更好地平衡时间，把更多精力留给家庭。我要更深入地参与孩子的成长，也给妻子更多的陪伴与关心。同时也想对每一位丈夫说，如果你的妻子正在怀孕或哺乳期，请一定多给予她照顾和体谅，有分歧时多让着一点。她们付出的，远比我们看到的要多。</p>
<p>最后，衷心祝愿每个宝宝都健康快乐地成长，每位妈妈都能开开心心，每位爸爸也都有足够的时间陪伴孩子长大。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a4530e8275164b32a56d1dc38d91be8c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769357455&amp;x-signature=A6Uk0Rdb%2B491IhH%2FguBqqZyjzFo%3D" alt="2025-gqlxc.png" loading="lazy"/></p>
<h2 data-id="heading-5">结语</h2>
<p>站在2026年初回望，2025年教会我最重要的一课是：人生的赛道远比想象中更宽，却也更加脆弱。这一年里，我经历了职场的动荡，也拥抱了家庭的温暖；品尝过失业的焦虑，也收获了新生的喜悦。而在这一切起伏之中，健康始终是那条不容动摇的基线。</p>
<p>我们这一代人，似乎总在奔跑。为了项目熬夜，为了绩效冲刺，在“内卷”与“优化”的浪潮中不敢停歇。可当疾病正悄然向年轻群体蔓延，当疲惫成为身体的常态，我们是否也该重新审视这场人生的马拉松？职场的上半场，我们或许在拼能力、拼耐力；但人生的下半场，最终拼的是健康——是还能清醒思考的早晨，是还能陪伴家人的周末，是肩能扛、心能安的从容。</p>
<p>新的一年，愿我们都能学会更好地平衡。工作重要，但别忘了给身体充电；追求成长，但别牺牲陪伴的时光。照顾好自己的身心，才有余力去爱人、去闯荡、去享受三餐四季的寻常美好。</p>
<p>毕竟，人生的精彩不在于始终冲刺，而在于走得稳、走得远。愿我们都能健康地奔赴下一程山海，温柔而坚定地，迎接每一个日出与黄昏。</p>
<p><strong>愿每一位前行的人，都能稳稳地、健康地，走好属于自己的下半场。</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0e20c56b55b2403bba16f9f5cb5e8fc1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769357455&amp;x-signature=xU6jgOC8cbiwxxaPd7FDqTYt2WU%3D" alt="" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[99.9%可用性！ACE Data Platform Google SERP API：3秒解锁全球搜索流量密码，SEO/跨境人必藏]]></title>    <link>https://juejin.cn/post/7595895132261826611</link>    <guid>https://juejin.cn/post/7595895132261826611</guid>    <pubDate>2026-01-18T15:02:57.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595895132261826611" data-draft-id="7595895132261810227" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="99.9%可用性！ACE Data Platform Google SERP API：3秒解锁全球搜索流量密码，SEO/跨境人必藏"/> <meta itemprop="keywords" content="Google,API"/> <meta itemprop="datePublished" content="2026-01-18T15:02:57.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="崔庆才丨静觅"/> <meta itemprop="url" content="https://juejin.cn/user/1521379821230269"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            99.9%可用性！ACE Data Platform Google SERP API：3秒解锁全球搜索流量密码，SEO/跨境人必藏
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1521379821230269/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    崔庆才丨静觅
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-18T15:02:57.000Z" title="Sun Jan 18 2026 15:02:57 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、核心痛点与 API 定位</h2>
<p>做 SEO 优化总踩坑？跨境选品没方向？竞品广告策略摸不透？在谷歌算法迭代频繁的今天（最新内部文档披露含 2596 个排名模块），精准实时的 SERP 数据直接决定营销成败。但传统数据获取方式痛点明显：</p>
<ul>
<li>手动抓取：1 条数据需 10 分钟，效率极低；</li>
<li>自建爬虫：频繁被封，数据格式混乱，无法直接使用。</li>
</ul>
<p>专为企业级需求打造的 <strong>ACE Data Platform Google SERP API</strong>，依托平台核心数据采集与解析能力（详见官方能力文档：<a href="https://link.juejin.cn?target=https%3A%2F%2Fplatform.acedata.cloud%2Fdocuments%2Fcc2ce913-df8f-4d22-a051-93fa33b2e51b" target="_blank" title="https://platform.acedata.cloud/documents/cc2ce913-df8f-4d22-a051-93fa33b2e51b" ref="nofollow noopener noreferrer">ACE Data Platform 官方能力文档</a>），将复杂的 SERP 数据获取简化为 1 行 API 调用。开发者、SEO 运营、市场分析师无需关注底层技术，即可快速拿到结构化全量数据，让数据驱动决策落地。</p>
<h2 data-id="heading-1">二、四大核心优势，重新定义 SERP 数据获取体验</h2>
<p>对比传统抓取和普通 API，ACE Data Platform 凭 4 大核心能力成为 2000+ 企业首选，优势突出：</p>
<h3 data-id="heading-2">1. 实时精准响应，3 秒直达全量数据</h3>
<ul>
<li>依托全球分布式节点集群与智能调度算法，3 秒内返回实时数据，零缓存延迟，匹配谷歌最新搜索反馈；</li>
<li>支持网页、图片、新闻、购物卡片、知识图谱、广告区块等全类型 SERP 元素抓取，覆盖排名位置、标题、描述、URL、关键词密度、广告出价区间、EEAT 相关因子等核心字段；</li>
<li>结构化 JSON 格式直接输出，无需二次解析，无缝对接业务系统、AI 模型或数据分析工具。</li>
</ul>
<h3 data-id="heading-3">2. 全域场景覆盖，灵活适配多元需求</h3>
<ul>
<li>支持 190+ 国家/地区、130+ 语种的地域化配置，适配本地化业务关键词监测与跨语种全球市场分析；</li>
<li>可模拟桌面端、移动端等多设备搜索场景，自定义搜索参数匹配信息型/交易型/导航型等特定用户画像的搜索意图；</li>
<li>完美覆盖本地化营销、跨境电商选品、全球竞品监测等多元需求。</li>
</ul>
<h3 data-id="heading-4">3. 极致稳定抗反爬，保障业务连续运行</h3>
<ul>
<li>通过动态 IP 池、智能验证码识别、浏览器指纹模拟等多重抗反爬策略，规避谷歌严格反爬限制，API 可用性高达 99.9%；</li>
<li>企业无需投入人力维护代理池和反爬逻辑，大幅降低运维成本，确保数据获取全程稳定不中断。</li>
</ul>
<h3 data-id="heading-5">4. 低门槛集成，按需付费更经济</h3>
<ul>
<li>提供超详细开发文档（含多语言示例代码），支持 Python、JavaScript、Java 等全主流编程语言，新手 10 分钟完成集成调试；</li>
<li>采用“按需付费”模式，无强制月度订阅；高并发场景支持弹性扩容，每秒可处理 300+ 查询请求，适配初创团队与大型集团需求。</li>
</ul>
<h2 data-id="heading-6">三、六大核心应用场景，解锁 SERP 数据商业价值</h2>
<p>灵活适配多场景，让 SERP 数据转化为商业价值，更可借助 AI agent 赋能内容创作，成为企业增长“隐形引擎”：</p>
<ol>
<li><strong>SEO 优化与排名监测</strong>：实时追踪核心关键词在不同地区、设备的自然排名变化，定位排名波动原因，分析竞品 SEO 策略与内容差距，针对性优化内容和链接布局，提升谷歌搜索曝光率与自然流量。</li>
<li><strong>竞品情报分析</strong>：抓取竞品谷歌广告文案、着陆页信息、关键词布局，洞察其市场定位与营销重点；监测竞品购物搜索中的价格、评分、销量数据，为自身定价、产品迭代和广告策略优化提供参考。</li>
<li>** AI 应用搭建**：为AI聊天机器人、智能问答系统、RAG 应用提供实时谷歌搜索数据支撑，提升 AI 模型回答准确性与时效性，打造更智能的产品体验。</li>
<li><strong>AI agent 驱动爆款文章创作</strong>：获取特定领域 Google SERP Top 排名爆款文章数据（标题结构、内容框架、关键词分布、用户互动数据等），由 AI agent 分析爆款规律，自动生成符合谷歌搜索偏好的文案或创作提纲，降低内容创作成本与试错成本。</li>
<li><strong>市场调研与趋势预测</strong>：分析特定行业关键词的 Google SERP 数据，洞察全球市场需求变化、消费者偏好趋势，为产品研发、市场扩张、营销策略制定提供数据依据。</li>
<li><strong>跨境电商选品</strong>：抓取 Google Shopping 搜索结果中的热门产品、价格区间、用户评价等数据，识别高需求、低竞争的潜力选品，降低跨境电商运营风险。</li>
</ol>
<h2 data-id="heading-7">四、3 步快速接入，即刻启用</h2>
<ol>
<li>注册 ACE Data Platform 账号，在控制台获取专属 API Key；</li>
<li>参考官方文档（<a href="https://link.juejin.cn?target=https%3A%2F%2Fplatform.acedata.cloud%2Fdocuments%2Fcc2ce913-df8f-4d22-a051-93fa33b2e51b" target="_blank" title="https://platform.acedata.cloud/documents/cc2ce913-df8f-4d22-a051-93fa33b2e51b" ref="nofollow noopener noreferrer">ACE Data Platform 官方能力文档</a>），配置关键词、地区、设备、语言等查询参数；</li>
<li>通过任意编程语言发送 HTTP 请求，获取结构化 Google SERP 数据，对接业务系统完成分析或应用开发。</li>
</ol>
<h2 data-id="heading-8">五、总结号召</h2>
<p>全球市场竞争已进入“数据竞速”时代，高效、精准掌握 Google SERP 数据是抢占先机的关键。ACE Data Platform Google SERP API 以“高效、精准、稳定、经济”的核心优势，跳过数据获取的所有坑，更能联动 AI agent 赋能内容创作，让爆款文章轻松量产。</p>
<p>立即注册 ACE Data Platform（<a href="https://link.juejin.cn?target=https%3A%2F%2Fplatform.acedata.cloud%2F" target="_blank" title="https://platform.acedata.cloud/" ref="nofollow noopener noreferrer">ACE Data Platform 官网</a>），领取免费额度，开启 Google SERP 数据驱动增长之路！</p>
<h3 data-id="heading-9">补充：ACE Data Cloud 平台实力背书</h3>
<ul>
<li>平台背景：由 Germey 创立，团队具备丰富行业经验，致力于提供全球顶级数字服务；</li>
<li>创始人资质：Germey 拥有 10+ 年软件开发经验，GitHub 全球粉丝排名 TOP 500，著有《Practical Python3 Web Scraping Development》（Python 创始人 Guido 推荐，全球销量超 15 万册），主导数百个开源项目，参与项目 Stars 超 4 万，开源镜像下载量超 100 万次；</li>
<li>服务保障：提供全球在线客户支持与全面集成文档，24x7 监控维护，确保服务稳定运行。</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[2026前端面试题及答案]]></title>    <link>https://juejin.cn/post/7596230910213259307</link>    <guid>https://juejin.cn/post/7596230910213259307</guid>    <pubDate>2026-01-18T15:12:55.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7596230910213259307" data-draft-id="7596230910213242923" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="2026前端面试题及答案"/> <meta itemprop="keywords" content="前端,面试"/> <meta itemprop="datePublished" content="2026-01-18T15:12:55.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="阿芯爱编程"/> <meta itemprop="url" content="https://juejin.cn/user/4125023355812269"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            2026前端面试题及答案
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4125023355812269/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    阿芯爱编程
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-18T15:12:55.000Z" title="Sun Jan 18 2026 15:12:55 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">2026前端面试题及答案</h2>
<h3 data-id="heading-1">HTML/CSS 部分</h3>
<h4 data-id="heading-2">1. 什么是盒模型？标准盒模型和IE盒模型的区别是什么？</h4>
<p><strong>答案：</strong>
盒模型是CSS中用于布局的基本概念，每个元素都被表示为一个矩形盒子，由内容(content)、内边距(padding)、边框(border)和外边距(margin)组成。</p>
<p>区别：</p>
<ul>
<li><strong>标准盒模型(W3C盒子模型)</strong>：<code>width</code>和<code>height</code>只包含内容(content)</li>
<li><strong>IE盒模型(怪异模式盒子模型)</strong>：<code>width</code>和<code>height</code>包含内容(content)、内边距(padding)和边框(border)</li>
</ul>
<p>可以通过<code>box-sizing</code>属性切换：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* 标准盒模型 */</span>
<span class="hljs-attribute">box-sizing</span>: content-box;

<span class="hljs-comment">/* IE盒模型 */</span>
<span class="hljs-attribute">box-sizing</span>: border-box;
</code></pre>
<h4 data-id="heading-3">2. CSS选择器优先级如何计算？</h4>
<p><strong>答案：</strong>
CSS选择器优先级从高到低：</p>
<ol>
<li><code>!important</code></li>
<li>内联样式(style="")</li>
<li>ID选择器(#id)</li>
<li>类选择器(.class)、属性选择器([type="text"])、伪类(:hover)</li>
<li>元素选择器(div)、伪元素(::before)</li>
<li>通配符(*)、关系选择器(&gt;, +, ~)</li>
</ol>
<p>计算规则：</p>
<ul>
<li>ID选择器：100</li>
<li>类/属性/伪类：10</li>
<li>元素/伪元素：1</li>
<li>相加比较，值大的优先级高</li>
</ul>
<h4 data-id="heading-4">3. BFC是什么？如何创建BFC？</h4>
<p><strong>答案：</strong>
BFC(Block Formatting Context)块级格式化上下文，是Web页面的可视化CSS渲染的一部分，是一个独立的渲染区域。</p>
<p>创建BFC的方法：</p>
<ul>
<li><code>float</code>不为none</li>
<li><code>position</code>为absolute或fixed</li>
<li><code>display</code>为inline-block、table-cell、table-caption、flex、inline-flex</li>
<li><code>overflow</code>不为visible</li>
</ul>
<p>BFC特性：</p>
<ol>
<li>内部盒子垂直排列</li>
<li>margin会重叠在同一个BFC中</li>
<li>BFC区域不会与float box重叠</li>
<li>BFC是独立容器，外部不影响内部</li>
</ol>
<h3 data-id="heading-5">JavaScript部分</h3>
<h4 data-id="heading-6">4. JavaScript中的事件循环机制是怎样的？</h4>
<p><strong>答案：</strong>
JavaScript是单线程语言，通过事件循环机制实现异步。事件循环由以下部分组成：</p>
<ol>
<li><strong>调用栈(Call Stack)</strong>：执行同步代码的地方</li>
<li><strong>任务队列(Task Queue)</strong>：
<ul>
<li><strong>宏任务(macrotask)</strong>：script整体代码、setTimeout、setInterval、I/O、UI渲染等</li>
<li><strong>微任务(microtask)</strong>：Promise.then/catch/finally、MutationObserver等</li>
</ul>
</li>
</ol>
<p>执行顺序：</p>
<ol>
<li>执行同步代码（宏任务）</li>
<li>执行过程中遇到异步任务：
<ul>
<li>微任务放入微任务队列</li>
<li>宏任务放入宏任务队列</li>
</ul>
</li>
<li>同步代码执行完毕，检查微任务队列并全部执行</li>
<li>UI渲染（如果需要）</li>
<li>取出一个宏任务执行，重复上述过程</li>
</ol>
<h4 data-id="heading-7">5. ES6中let/const与var的区别？</h4>
<p><strong>答案：</strong></p>















































<table><thead><tr><th/><th>var</th><th>let</th><th>const</th></tr></thead><tbody><tr><td>作用域</td><td>函数作用域</td><td>块级作用域</td><td>块级作用域</td></tr><tr><td>变量提升</td><td>有</td><td>暂时性死区</td><td>暂时性死区</td></tr><tr><td>重复声明</td><td>允许</td><td>不允许</td><td>不允许</td></tr><tr><td>全局属性</td><td>会成为</td><td>不会成为</td><td>不会成为</td></tr><tr><td>初始值</td><td>可不设</td><td>可不设</td><td>必须设置</td></tr><tr><td>修改值</td><td>可以</td><td>可以</td><td>不可以</td></tr></tbody></table>
<h4 data-id="heading-8">6. Promise的原理是什么？手写一个简单的Promise实现。</h4>
<p><strong>答案：</strong>
Promise是一种异步编程解决方案，主要解决回调地狱问题。它有三种状态：pending、fulfilled、rejected。</p>
<p>简单实现：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyPromise</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">executor</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span> = <span class="hljs-string">'pending'</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">value</span> = <span class="hljs-literal">undefined</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">reason</span> = <span class="hljs-literal">undefined</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">onFulfilledCallbacks</span> = [];
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">onRejectedCallbacks</span> = [];
    
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">resolve</span> = (<span class="hljs-params">value</span>) =&gt; {
      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span> === <span class="hljs-string">'pending'</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span> = <span class="hljs-string">'fulfilled'</span>;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">value</span> = value;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">onFulfilledCallbacks</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">fn</span> =&gt;</span> <span class="hljs-title function_">fn</span>());
      }
    };
    
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">reject</span> = (<span class="hljs-params">reason</span>) =&gt; {
      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span> === <span class="hljs-string">'pending'</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span> = <span class="hljs-string">'rejected'</span>;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">reason</span> = reason;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">onRejectedCallbacks</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">fn</span> =&gt;</span> <span class="hljs-title function_">fn</span>());
      }
    };
    
    <span class="hljs-keyword">try</span> {
      <span class="hljs-title function_">executor</span>(resolve, reject);
    } <span class="hljs-keyword">catch</span> (err) {
      <span class="hljs-title function_">reject</span>(err);
    }
  }
  
  <span class="hljs-title function_">then</span>(<span class="hljs-params">onFulfilled, onRejected</span>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span> === <span class="hljs-string">'fulfilled'</span>) {
      <span class="hljs-title function_">onFulfilled</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">value</span>);
    }
    
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span> === <span class="hljs-string">'rejected'</span>) {
      <span class="hljs-title function_">onRejected</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">reason</span>);
    }
    
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span> === <span class="hljs-string">'pending'</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">onFulfilledCallbacks</span>.<span class="hljs-title function_">push</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">onFulfilled</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">value</span>));
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">onRejectedCallbacks</span>.<span class="hljs-title function_">push</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">onRejected</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">reason</span>));
    }
  }
}
</code></pre>
<h3 data-id="heading-9">React/Vue框架部分</h3>
<h4 data-id="heading-10">7.React中setState是同步还是异步的？</h4>
<p><strong>答案：</strong>
在React中，setState的行为表现有时"异步"，有时"同步"：</p>
<p>1.<strong>大部分情况下表现为异步</strong>(批量更新优化):</p>
<ul>
<li>React合成事件处理函数中(setTimeout/setInterval/Promise回调等原生事件外)</li>
<li>React生命周期函数中</li>
</ul>
<p>在这些情况下React会将多个setState合并为一个更新以提高性能。</p>
<p>2.<strong>某些情况下表现为同步</strong>:</p>
<ul>
<li>setTimeout/setInterval回调中</li>
<li>DOM原生事件处理函数中</li>
<li>Promise.then等异步代码中</li>
</ul>
<p>React18后所有情况都默认批量处理(auto batching)，如需强制同步可使用flushSync。</p>
<p>原理原因:
React通过isBatchingUpdates标志控制是否批量更新,合成事件和生命周期会开启此标志。</p>
<p>###8.Vue的响应式原理是怎样的?</p>
<p><strong>答案:</strong>
Vue2.x使用Object.defineProperty,Vue3使用Proxy实现响应式:</p>
<p>Vue2实现原理:
1.<strong>数据劫持</strong>:通过Object.defineProperty对data对象每个属性添加getter/setter追踪变化。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(obj, key, { 
 <span class="hljs-title function_">get</span>(<span class="hljs-params"/>) { <span class="hljs-comment">//依赖收集 },</span>
 <span class="hljs-title function_">set</span>(<span class="hljs-params">newVal</span>) { <span class="hljs-comment">//触发更新 } </span>
})
</code></pre>
<p>2.<strong>依赖收集</strong>:在getter中将观察者Watcher实例添加到Dep订阅器中。
3.<strong>派发更新</strong>:setter被触发时通知Dep中的所有Watcher重新计算并更新视图。
缺点:无法检测对象属性的添加删除,数组变动需特殊处理。</p>
<p>Vue3使用Proxy改进:</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">new</span> <span class="hljs-title class_">Proxy</span>(data, { 
 <span class="hljs-title function_">get</span>(<span class="hljs-params">target, key</span>){},
 <span class="hljs-title function_">set</span>(<span class="hljs-params">target, key, value</span>){},
 <span class="hljs-title function_">deleteProperty</span>(<span class="hljs-params">target, key</span>){}
})
</code></pre>
<p>优势:可直接监听对象/数组的各种变化;无需递归遍历整个对象初始化。</p>
<p>##性能优化相关</p>
<p>###9.Webpack有哪些常见的性能优化手段?</p>
<p><strong>构建速度优化:</strong></p>
<p>1.<strong>缩小文件搜索范围</strong></p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-attr">resolve</span>:{ <span class="hljs-attr">modules</span>:[path.<span class="hljs-title function_">resolve</span>(__dirname,<span class="hljs-string">'node_modules'</span>)] },
<span class="hljs-attr">module</span>:{ <span class="hljs-attr">noParse</span>:<span class="hljs-regexp">/jquery|lodash/</span> } <span class="hljs-comment">//忽略未模块化库的解析  </span>
</code></pre>
<p>2.<strong>缓存loader结果</strong>(cache-loader/babel-loader?cacheDirectory=true)</p>
<p>3.<strong>多进程构建</strong>(thread-loader/happyPack)</p>
<p>4.<strong>DllPlugin预编译不变模块</strong></p>
<p>5.<strong>合理使用sourceMap</strong>(开发环境cheap-module-eval-source-map)</p>
<p><strong>打包体积优化:</strong></p>
<p>1.<strong>Tree Shaking</strong>(ES6模块+production模式+sideEffects配置)</p>
<p>2.Code Splitting:</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-attr">optimization</span>:{ <span class="hljs-attr">splitChunks</span>:{ <span class="hljs-attr">chunks</span>:<span class="hljs-string">'all'</span> } },
<span class="hljs-attr">entry</span>:{ <span class="hljs-attr">main</span>:<span class="hljs-string">'./src/main.js'</span>, <span class="hljs-attr">vendor</span>:[<span class="hljs-string">'lodash'</span>] }  
</code></pre>
<p>3.Scope Hoisting(<code>ModuleConcatenationPlugin</code>)
4.UglifyJsPlugin压缩混淆代码</p>
<p>5.Gzip压缩(<code>compression-webpack-plugin</code>)
6.CDN引入外部资源(<code>externals</code>)
7.PurgeCSS移除无用CSS</p>
<p>8.OptimizeCSSAssetsPlugin压缩CSS</p>
<p>9.ImageMinimizerPlugin压缩图片</p>
<p>10.babel按需加载polyfill</p>
<p>##算法与编程题</p>
<p>###10.[编程题]手写防抖和节流函数</p>
<p>防抖(debounce):高频触发时只在停止触发后执行一次</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">debounce</span>(<span class="hljs-params">fn, delay</span>){
 <span class="hljs-keyword">let</span> timer=<span class="hljs-literal">null</span>;
 <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span>(<span class="hljs-params">...args</span>){
   <span class="hljs-built_in">clearTimeout</span>(timer);  
   timer=<span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">()=&gt;</span>fn.<span class="hljs-title function_">apply</span>(<span class="hljs-variable language_">this</span>,args),delay);
 }
}
</code></pre>
<p>节流(throttle):高频触发时每隔一段时间执行一次</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">throttle</span>(<span class="hljs-params">fn, interval</span>){
 <span class="hljs-keyword">let</span> lastTime=<span class="hljs-number">0</span>;  
 <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span>(<span class="hljs-params">...args</span>){
   <span class="hljs-keyword">const</span> now=<span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();
   <span class="hljs-keyword">if</span>(now-lastTime&gt;=interval){
     fn.<span class="hljs-title function_">apply</span>(<span class="hljs-variable language_">this</span>,args);  
     lastTime=now;  
   }  
 } 
}

<span class="hljs-comment">//定时器版本节流:</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">throttle</span>(<span class="hljs-params">fn,delay</span>){  
 <span class="hljs-keyword">let</span> timer=<span class="hljs-literal">null</span>;   
 <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span>(<span class="hljs-params">...args</span>){   
   <span class="hljs-keyword">if</span>(!timer){     
     timer=<span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">()=&gt;</span>{      
       fn.<span class="hljs-title function_">apply</span>(<span class="hljs-variable language_">this</span>,args);       
       timer=<span class="hljs-literal">null</span>;      
     },delay);     
   }   
 };   
}   
</code></pre>
<p>##HTTP与浏览器相关</p>
<p>###11.HTTPS的工作原理是什么?</p>
<p>HTTPS=HTTP+TLS/SSL加密层工作流程:</p>
<p>1.Client发送支持的加密算法列表+随机数A给Server</p>
<p>2.Server选择加密算法+发送数字证书+随机数B给Client</p>
<p>3.Client验证证书有效性(颁发机构/过期时间/域名匹配),生成随机数C并用证书公钥加密发送给Server</p>
<p>4.Server用私钥解密获取随机数C</p>
<p>5.Client和Server都用ABC三个随机数生成对称加密密钥(session key)</p>
<p>6.HTTP通信开始使用该密钥加密数据</p>
<p>关键点:
-CA机构验证服务器身份防止中间人攻击<br/>
-非对称加密交换对称密钥提高安全性又保证性能<br/>
-TLS握手阶段采用非对称加密通信阶段采用对称加密</p>
<p>安全特性:
机密性(对称加密)+完整性(MAC校验)+身份认证(X509证书链)</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Mybatis插件原理及分页插件]]></title>    <link>https://juejin.cn/post/7596181746082955314</link>    <guid>https://juejin.cn/post/7596181746082955314</guid>    <pubDate>2026-01-18T14:11:33.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7596181746082955314" data-draft-id="7595895132261302323" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Mybatis插件原理及分页插件"/> <meta itemprop="keywords" content="Java,架构,源码阅读"/> <meta itemprop="datePublished" content="2026-01-18T14:11:33.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员侠客行"/> <meta itemprop="url" content="https://juejin.cn/user/556801719828361"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Mybatis插件原理及分页插件
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/556801719828361/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员侠客行
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-18T14:11:33.000Z" title="Sun Jan 18 2026 14:11:33 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Mybatis框架允许用户通过自定义拦截器来改变SQL的执行行为，例如在SQL执行追加分页语句、统计SQL执行耗时等。<strong>自定义拦截器也被称为Mybatis插件，插件是 MyBatis 扩展核心功能的常用方式。</strong></p>
<blockquote>
<p>注：本文中源码来自mybatis 3.4.x版本，地址<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmybatis%2Fmybatis-3.git" target="_blank" title="https://github.com/mybatis/mybatis-3.git" ref="nofollow noopener noreferrer">github.com/mybatis/myb…</a></p>
</blockquote>
<h2 data-id="heading-0">一 插件原理</h2>
<h3 data-id="heading-1">1.1 配置插件信息</h3>
<p>在Mybatis主配置文件中，通过标签来注册自定义插件。如</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span> <span class="hljs-attr">interceptor</span>=<span class="hljs-string">"com.example.MyCustomPlugin"</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- 可选：传递属性给插件
        &lt;property name="name" value="page"/&gt;
    &lt;/plugin&gt;
&lt;/plugins&gt;
</span></code></pre>
<p>在XMLConfigBuilder#parseConfiguration中，会解析plugins标签内容，创建Interceptor并注册到Configuration的InterceptorChain interceptorChain。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fc0fe777186e40f898155ff89fd9159e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5L6g5a6i6KGM:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769350292&amp;x-signature=vTq9vmmJ09YEOR9j%2FpowsblYq%2F4%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-2">1.2 声明拦截器</h3>
<p>MyBatis 插件本质是基于动态代理实现的，只能拦截四大核心对象的方法：</p>
<ul>
<li><code>Executor</code>：执行器（负责 SQL 执行、缓存管理）</li>
<li><code>StatementHandler</code>：SQL 语句处理器（负责 SQL 构建、参数设置）</li>
<li><code>ParameterHandler</code>：参数处理器（负责参数解析）</li>
<li><code>ResultSetHandler</code>：结果集处理器（负责结果集映射）</li>
</ul>
<p>为什么是这4大组件呢？Configuration作为这些组件的创建工厂，会应用拦截器并返回代理对象（以StatementHandler为例）</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f033b0d7303a46a3b81c3d38302a36d2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5L6g5a6i6KGM:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769350292&amp;x-signature=0aop%2FfoyKZCNf0Z2pAgzsYufMYI%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/94f45da419444992a080d5bab14b04cf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5L6g5a6i6KGM:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769350292&amp;x-signature=pgjv8%2FzTfhk65ARJVsS7i3iJYB4%3D" alt="" loading="lazy"/></p>
<p>自定义插件需要实现Interceptor接口</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/01aeed30ec1248ebb58e1f705fbff15c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5L6g5a6i6KGM:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769350292&amp;x-signature=TbbRGiHyKjtkj7xb239ktadsaPw%3D" alt="" loading="lazy"/></p>
<p>其中，Invocation封装了目标对象、方法及参数信息，通过它来获取上述4个组件对象的所有信息。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Invocation</span> {

  <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Object target;
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Method method;
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Object[] args;
  <span class="hljs-comment">// 回调原方法</span>
  <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">proceed</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InvocationTargetException, IllegalAccessException {
    <span class="hljs-keyword">return</span> method.invoke(target, args);
  }
}
</code></pre>
<h3 data-id="heading-3">1.3 创建代理对象</h3>
<p>为了方便创建<code>Executor</code>等的代理对象，Mybatis提供了一个Plugin工具类。关键代码如下：
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9147206faafa49c48af1620a1d464305~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5L6g5a6i6KGM:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769350292&amp;x-signature=0DnLWGEe3aTlclWbvOmODrtkZG8%3D" alt="" loading="lazy"/>Plugin类实现了InvocationHandler接口，即采用JDK动态代理来创建代理对象。当<code>Executor</code>执行某个方法时，如果方法被指定需要增强，就会先执行Interceptor#intercept方法。</p>
<p>Plugin#getSignatureMap方法，会解析Interceptor实现类的Intercepts注解信息，得到拦截范围。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// @Intercepts 注解：指定拦截的对象和方法（核心）</span>
<span class="hljs-meta">@Intercepts({
    // @Signature：单个拦截规则
    // type：拦截的核心对象（Executor/StatementHandler 等）
    // method：拦截的方法名（比如 Executor 的 query 方法）
    // args：拦截方法的参数类型（用于区分重载方法）
    @Signature(
        type = Executor.class,
        method = "query",
        args = {org.apache.ibatis.mapping.MappedStatement.class, Object.class, RowBounds.class, ResultHandler.class}
    )
})</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyCustomPlugin</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Interceptor</span> {
}
</code></pre>
<h3 data-id="heading-4">1.4 自定义插件示例</h3>
<p>我们只需要实现Interceptor接口，在intercept()中编写增强逻辑，通过plugin()返回一个代理对象，就能自定义一个Mybatis插件了。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Intercepts({
    @Signature(
        type = Executor.class,
        method = "query",
        args = {org.apache.ibatis.mapping.MappedStatement.class, Object.class, RowBounds.class, ResultHandler.class}
    )
})</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyCustomPlugin</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Interceptor</span> {
    <span class="hljs-keyword">private</span> String name;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">intercept</span><span class="hljs-params">(Invocation invocation)</span> <span class="hljs-keyword">throws</span> Throwable {
        Object[] args = invocation.getArgs();
        System.out.println(<span class="hljs-string">"SQL 执行参数："</span> + args[<span class="hljs-number">1</span>]);
        <span class="hljs-type">Object</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> invocation.proceed();
        System.out.println(<span class="hljs-string">"===== query 方法执行完成 ====="</span>);
        <span class="hljs-keyword">return</span> result;
    }

    <span class="hljs-comment">// 生成代理对象</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">plugin</span><span class="hljs-params">(Object target)</span> {
        <span class="hljs-keyword">return</span> Plugin.wrap(target, <span class="hljs-built_in">this</span>);
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setProperties</span><span class="hljs-params">(Properties properties)</span> {
        <span class="hljs-built_in">this</span>.name = properties.getProperty(<span class="hljs-string">"name"</span>);
    }
}
</code></pre>
<h2 data-id="heading-5">二 自定义分页插件</h2>
<h3 data-id="heading-6">2.1 Mybatis自带分页功能</h3>
<p>其实，Mybatis支持分页查询，只可惜是内存分页，仍然会查询全部数据，只是在内存中过滤。</p>
<p>使用RowBounds类，通过 offset（偏移量）和 limit（限制数量）控制所要处理的结果集范围，相当于执行了 resultList.subList(offset, offset + limit)。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// SqlSession中</span>
&lt;E&gt; List&lt;E&gt; <span class="hljs-title function_">selectList</span><span class="hljs-params">(String statement, Object parameter, RowBounds rowBounds)</span>;
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a5b5b7a1c734418d86e2bc1a872db0f8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5L6g5a6i6KGM:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769350292&amp;x-signature=4c38cFt%2Bo3C6E30faf6IKkMoSNA%3D" alt="" loading="lazy"/>
在处理ResultSet时，跳过offset条，限制最多处理limit条。
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a53eab57dad5473a84a65a34c828e106~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5L6g5a6i6KGM:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769350292&amp;x-signature=MCjjxiK0JMPVTxhvGEfagMSZi9w%3D" alt="" loading="lazy"/></p>
<p><strong>RowBounds只适合数据量不大的场景，生产环境通常使用物理分页插件替代。</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">SqlSession</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sqlSessionFactory.openSession();
<span class="hljs-type">UserMapper</span> <span class="hljs-variable">mapper</span> <span class="hljs-operator">=</span> session.getMapper(UserMapper.class);
<span class="hljs-comment">// 跳过前10条，返回最多20条记录</span>
<span class="hljs-type">RowBounds</span> <span class="hljs-variable">rowBounds</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RowBounds</span>(<span class="hljs-number">10</span>, <span class="hljs-number">20</span>);
List&lt;User&gt; user = mapper.selectByAge(<span class="hljs-number">20</span>, rowBounds);
</code></pre>
<h3 data-id="heading-7">2.2 自定义分页插件</h3>
<p>基于我们掌握的插件原理，完全可以自行定义一个分页插件。</p>
<p>首先，我们声明一个Page类来封装分页参数</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Page</span>&lt;T&gt; {
  <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">pageNo</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;      <span class="hljs-comment">// 当前页码</span>
  <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">pageSize</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span>;    <span class="hljs-comment">// 每页大小</span>
  <span class="hljs-keyword">private</span> <span class="hljs-type">long</span> total;           <span class="hljs-comment">// 总记录数</span>
  <span class="hljs-keyword">private</span> <span class="hljs-type">long</span> totalPage;   	<span class="hljs-comment">// 总页数</span>
  <span class="hljs-comment">// 省略getter/setter</span>
}
</code></pre>
<p>再创建拦截器，拦截 StatementHandler 的 prepare 方法，改写 SQL 添加分页语句，并额外查询一次总记录数。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.sql.Connection;
<span class="hljs-keyword">import</span> java.sql.PreparedStatement;
<span class="hljs-keyword">import</span> java.sql.ResultSet;
<span class="hljs-keyword">import</span> java.util.List;
<span class="hljs-keyword">import</span> java.util.Properties;
<span class="hljs-keyword">import</span> org.apache.ibatis.executor.statement.RoutingStatementHandler;
<span class="hljs-keyword">import</span> org.apache.ibatis.executor.statement.StatementHandler;
<span class="hljs-keyword">import</span> org.apache.ibatis.mapping.BoundSql;
<span class="hljs-keyword">import</span> org.apache.ibatis.mapping.MappedStatement;
<span class="hljs-keyword">import</span> org.apache.ibatis.mapping.ParameterMapping;
<span class="hljs-keyword">import</span> org.apache.ibatis.reflection.SystemMetaObject;
<span class="hljs-keyword">import</span> org.apache.ibatis.scripting.defaults.DefaultParameterHandler;

<span class="hljs-comment">/**
 * MySQL 分页插件
 * 拦截 StatementHandler 的 prepare 方法，改写 SQL 添加分页语句
 */</span>
<span class="hljs-meta">@Intercepts({
    @Signature(type = StatementHandler.class, method = "prepare", args = {Connection.class, Integer.class})
})</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PageInterceptor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Interceptor</span> {

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">intercept</span><span class="hljs-params">(Invocation invocation)</span> <span class="hljs-keyword">throws</span> Throwable {
        <span class="hljs-type">RoutingStatementHandler</span> <span class="hljs-variable">handler</span> <span class="hljs-operator">=</span> (RoutingStatementHandler) invocation.getTarget();
        <span class="hljs-type">StatementHandler</span> <span class="hljs-variable">delegate</span> <span class="hljs-operator">=</span> (StatementHandler) SystemMetaObject.forObject(handler).getValue(<span class="hljs-string">"delegate"</span>);
        <span class="hljs-type">MappedStatement</span> <span class="hljs-variable">mappedStatement</span> <span class="hljs-operator">=</span> (MappedStatement) SystemMetaObject.forObject(delegate).getValue(<span class="hljs-string">"mappedStatement"</span>);

        <span class="hljs-comment">// 获取 BoundSql</span>
        <span class="hljs-type">BoundSql</span> <span class="hljs-variable">boundSql</span> <span class="hljs-operator">=</span> delegate.getBoundSql();
        <span class="hljs-type">Object</span> <span class="hljs-variable">parameterObject</span> <span class="hljs-operator">=</span> boundSql.getParameterObject();

        <span class="hljs-comment">// 判断参数是否为 Page 对象</span>
        <span class="hljs-keyword">if</span> (parameterObject <span class="hljs-keyword">instanceof</span> Page) {
            Page&lt;?&gt; page = (Page&lt;?&gt;) parameterObject;
            <span class="hljs-type">String</span> <span class="hljs-variable">originalSql</span> <span class="hljs-operator">=</span> boundSql.getSql();

            <span class="hljs-comment">// 1. 查询总记录数</span>
            <span class="hljs-type">Connection</span> <span class="hljs-variable">connection</span> <span class="hljs-operator">=</span> (Connection) invocation.getArgs()[<span class="hljs-number">0</span>];
            <span class="hljs-type">long</span> <span class="hljs-variable">total</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.queryTotal(connection, page, mappedStatement);
            page.setTotal(total);
            page.setTotalPage(total % page.getPageSize() == <span class="hljs-number">0</span> ? total / page.getPageSize() : total / page.getPageSize() + <span class="hljs-number">1</span>);
            
            <span class="hljs-comment">// 2. 改写 SQL，添加 LIMIT 分页</span>
            <span class="hljs-type">String</span> <span class="hljs-variable">pageSql</span> <span class="hljs-operator">=</span> originalSql + <span class="hljs-string">" LIMIT "</span> + page.getOffset() + <span class="hljs-string">", "</span> + page.getPageSize();

            <span class="hljs-comment">// 通过反射修改 BoundSql 中的 SQL</span>
            SystemMetaObject.forObject(boundSql).setValue(<span class="hljs-string">"sql"</span>, pageSql);
        }
        <span class="hljs-keyword">return</span> invocation.proceed();
    }

    <span class="hljs-comment">/**
   * 查询总记录数
   */</span>
  <span class="hljs-keyword">private</span> <span class="hljs-type">long</span> <span class="hljs-title function_">queryTotal</span><span class="hljs-params">(Connection connection, Object parameterObject, MappedStatement mappedStatement)</span> <span class="hljs-keyword">throws</span> Exception {
    <span class="hljs-type">BoundSql</span> <span class="hljs-variable">boundSql</span> <span class="hljs-operator">=</span> mappedStatement.getBoundSql(parameterObject);
    <span class="hljs-type">String</span> <span class="hljs-variable">sql</span> <span class="hljs-operator">=</span> <span class="hljs-string">"SELECT COUNT(*) FROM ("</span> + boundSql.getSql() + <span class="hljs-string">") tmp_count"</span>;
    <span class="hljs-type">PreparedStatement</span> <span class="hljs-variable">ps</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;
    <span class="hljs-type">ResultSet</span> <span class="hljs-variable">rs</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">try</span> {
      ps = connection.prepareStatement(sql);
      <span class="hljs-comment">// 设置参数（如果有）</span>
      <span class="hljs-keyword">if</span> (boundSql.getParameterMappings() != <span class="hljs-literal">null</span> &amp;&amp; !boundSql.getParameterMappings().isEmpty()) {
        List&lt;ParameterMapping&gt; parameterMappings = boundSql.getParameterMappings();
        <span class="hljs-type">BoundSql</span> <span class="hljs-variable">countSql</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BoundSql</span>(mappedStatement.getConfiguration(), sql, parameterMappings, parameterObject);
        <span class="hljs-type">DefaultParameterHandler</span> <span class="hljs-variable">parameterHandler</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultParameterHandler</span>(mappedStatement, parameterObject, countSql);
        parameterHandler.setParameters(ps);
      }

      rs = ps.executeQuery();
      <span class="hljs-keyword">if</span> (rs.next()) {
        <span class="hljs-keyword">return</span> rs.getLong(<span class="hljs-number">1</span>);
      }
      <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
    } <span class="hljs-keyword">finally</span> {
      <span class="hljs-keyword">if</span> (rs != <span class="hljs-literal">null</span>) {
        rs.close();
      }
      <span class="hljs-keyword">if</span> (ps != <span class="hljs-literal">null</span>) {
        ps.close();
      }
    }
  }


  <span class="hljs-meta">@Override</span>
  <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">plugin</span><span class="hljs-params">(Object target)</span> {
    <span class="hljs-comment">// 只拦截 StatementHandler</span>
    <span class="hljs-keyword">if</span> (target <span class="hljs-keyword">instanceof</span> StatementHandler) {
      <span class="hljs-keyword">return</span> Plugin.wrap(target, <span class="hljs-built_in">this</span>);
    }
    <span class="hljs-keyword">return</span> target;
  }

  <span class="hljs-meta">@Override</span>
  <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setProperties</span><span class="hljs-params">(Properties properties)</span> {
  }
}
</code></pre>
<p>在Mybatis主配置中添加插件。</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span> <span class="hljs-attr">interceptor</span>=<span class="hljs-string">"com.example.PageInterceptor"</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span>
</code></pre>
<p>创建UserQuery类，封装查询条件。执行查询后，就能从UserQuery中获取total等。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserQuery</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Page</span>&lt;User&gt; {

  <span class="hljs-keyword">private</span> String name;          <span class="hljs-comment">// 姓名（模糊查询）</span>
  <span class="hljs-keyword">private</span> Integer minAge;       <span class="hljs-comment">// 最小年龄</span>
  <span class="hljs-keyword">private</span> Integer maxAge;       <span class="hljs-comment">// 最大年龄</span>
  <span class="hljs-keyword">private</span> String sex;
  <span class="hljs-comment">// 省略getter/setter</span>
}
</code></pre>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">UserQuery</span> <span class="hljs-variable">query</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserQuery</span>();
query.setPageNum(<span class="hljs-number">1</span>);
query.setPageSize(<span class="hljs-number">20</span>);
query.setName(<span class="hljs-string">"张三"</span>);
query.setMinAge(<span class="hljs-number">20</span>);
query.setMaxAge(<span class="hljs-number">40</span>);
List&lt;User&gt; users = userMapper.selectByPage(query);
<span class="hljs-type">long</span> <span class="hljs-variable">total</span> <span class="hljs-operator">=</span> query.getTotal();
<span class="hljs-type">long</span> <span class="hljs-variable">totalPage</span> <span class="hljs-operator">=</span> query.getTotalPage();
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Spring事务全解析]]></title>    <link>https://juejin.cn/post/7596230910213111851</link>    <guid>https://juejin.cn/post/7596230910213111851</guid>    <pubDate>2026-01-18T14:29:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7596230910213111851" data-draft-id="7596171325532684329" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Spring事务全解析"/> <meta itemprop="keywords" content="Spring,Java"/> <meta itemprop="datePublished" content="2026-01-18T14:29:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="雨中飘荡的记忆"/> <meta itemprop="url" content="https://juejin.cn/user/694547077666606"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Spring事务全解析
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/694547077666606/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    雨中飘荡的记忆
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-18T14:29:17.000Z" title="Sun Jan 18 2026 14:29:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读15分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b43c13d20ec148fa8116fced4d069154~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769351357&amp;x-signature=dMuz1kxQUzVc9Ocx8m2AYK%2BrmA8%3D" alt="" loading="lazy"/></p>
<p>Spring事务管理是Java企业级开发中最核心的功能之一。无论是保证数据一致性，还是处理复杂的业务逻辑，都离不开对事务的深入理解。本文将详细介绍Spring事务的传播行为、隔离级别、回滚规则和失效场景，帮助你彻底掌握Spring事务。</p>
<h2 data-id="heading-0">一、Spring事务核心概念</h2>
<p>Spring事务管理是基于AOP（面向切面编程）实现的，它通过代理模式拦截方法调用，在方法执行前后管理数据库连接的提交和回滚。核心组件包括：</p>
<ul>
<li><strong>@Transactional注解</strong>：声明式事务管理的标志</li>
<li><strong>TransactionManager</strong>：事务管理器，负责实际的事务操作</li>
<li><strong>AOP代理</strong>：Spring创建的代理对象，负责事务切面的织入</li>
</ul>
<p>当我们在方法上添加<code>@Transactional</code>注解时，Spring会为该方法创建一个代理对象。在方法执行前，代理对象会开启事务；方法执行成功后提交事务；如果方法抛出异常，则回滚事务。</p>
<p><strong>核心实现原理</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// Spring事务代理的本质（简化版）</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TransactionProxy</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">MethodInterceptor</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">invoke</span><span class="hljs-params">(MethodInvocation invocation)</span> <span class="hljs-keyword">throws</span> Throwable {
        <span class="hljs-type">Method</span> <span class="hljs-variable">method</span> <span class="hljs-operator">=</span> invocation.getMethod();
        <span class="hljs-type">TransactionDefinition</span> <span class="hljs-variable">txDef</span> <span class="hljs-operator">=</span> getTransactionDefinition(method);

        <span class="hljs-comment">// 1. 开启事务</span>
        <span class="hljs-type">TransactionStatus</span> <span class="hljs-variable">txStatus</span> <span class="hljs-operator">=</span> transactionManager.getTransaction(txDef);

        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 2. 执行目标方法</span>
            <span class="hljs-type">Object</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> invocation.proceed();
            <span class="hljs-comment">// 3. 提交事务</span>
            transactionManager.commit(txStatus);
            <span class="hljs-keyword">return</span> result;
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-comment">// 4. 回滚事务</span>
            transactionManager.rollback(txStatus);
            <span class="hljs-keyword">throw</span> e;
        }
    }
}
</code></pre>
<h2 data-id="heading-1">二、事务传播行为</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a251dd1bacbb481d830224b75ef3fc89~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769351357&amp;x-signature=R32bXjCGqVA4BqBAbLs38JTQaOQ%3D" alt="" loading="lazy"/></p>
<p>事务传播行为定义了<strong>多个事务方法相互调用时，事务如何传播</strong>。Spring提供了7种传播行为：</p>
<h3 data-id="heading-2">2.1 REQUIRED（默认）- 实际应用场景</h3>
<p><strong>场景描述</strong>：电商下单，需要同时操作订单表、库存表、账户表，这些操作必须在同一事务中完成。</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// ========== 实体类 ==========</span>
<span class="hljs-keyword">@Data</span>
<span class="hljs-keyword">@Entity</span>
<span class="hljs-keyword">@Table</span>(name = <span class="hljs-string">"t_order"</span>)
public class Order {
    private Long id;
    private String orderNo;
    private Long productId;
    private Integer quantity;
    private BigDecimal amount;
    private String status;
    private LocalDateTime createTime;
}

<span class="hljs-keyword">@Data</span>
<span class="hljs-keyword">@Entity</span>
<span class="hljs-keyword">@Table</span>(name = <span class="hljs-string">"t_product_stock"</span>)
public class ProductStock {
    private Long id;
    private Long productId;
    private Integer stock;
    private Integer version;  <span class="hljs-comment">// 乐观锁版本号</span>
}

<span class="hljs-keyword">@Data</span>
<span class="hljs-keyword">@Entity</span>
<span class="hljs-keyword">@Table</span>(name = <span class="hljs-string">"t_account"</span>)
public class Account {
    private Long id;
    private String accountNo;
    private BigDecimal balance;
    private LocalDateTime updateTime;
}

<span class="hljs-comment">// ========== 订单Service ==========</span>
<span class="hljs-keyword">@Service</span>
<span class="hljs-keyword">@Slf</span>4j
<span class="hljs-keyword">@RequiredArgsConstructor</span>
public class OrderService {

    private final OrderMapper orderMapper;
    private final StockService stockService;
    private final AccountService accountService;

    <span class="hljs-comment">/**
     * 下单主流程 - REQUIRED传播
     * 所有操作在同一事务中，任一失败全部回滚
     */</span>
    <span class="hljs-keyword">@Transactional</span>(propagation = Propagation.REQUIRED, rollbackFor = Exception.class)
    public void placeOrder(OrderRequest request) {
        log<span class="hljs-selector-class">.info</span>("开始下单，订单号: {}", request.getOrderNo());

        <span class="hljs-comment">// 1. 创建订单（加入当前事务）</span>
        <span class="hljs-attribute">Order</span> <span class="hljs-attribute">order</span> = <span class="hljs-built_in">createOrder</span>(request);

        <span class="hljs-comment">// 2. 扣减库存（加入当前事务）</span>
        stockService<span class="hljs-selector-class">.deductStock</span>(request.getProductId(), request<span class="hljs-selector-class">.getQuantity</span>());

        <span class="hljs-comment">// 3. 扣减账户余额（加入当前事务）</span>
        accountService<span class="hljs-selector-class">.deductBalance</span>(request.getAccountNo(), request<span class="hljs-selector-class">.getAmount</span>());

        <span class="hljs-comment">// 4. 更新订单状态</span>
        orderMapper<span class="hljs-selector-class">.updateStatus</span>(order.getId(), "COMPLETED");

        log<span class="hljs-selector-class">.info</span>("下单完成，订单号: {}", request.getOrderNo());
    }

    private <span class="hljs-attribute">Order</span> <span class="hljs-built_in">createOrder</span>(OrderRequest request) {
        <span class="hljs-attribute">Order</span> <span class="hljs-attribute">order</span> = new <span class="hljs-attribute">Order</span>();
        <span class="hljs-attribute">order</span><span class="hljs-selector-class">.setOrderNo</span>(request.getOrderNo());
        <span class="hljs-attribute">order</span><span class="hljs-selector-class">.setProductId</span>(request.getProductId());
        <span class="hljs-attribute">order</span><span class="hljs-selector-class">.setQuantity</span>(request.getQuantity());
        <span class="hljs-attribute">order</span><span class="hljs-selector-class">.setAmount</span>(request.getAmount());
        <span class="hljs-attribute">order</span><span class="hljs-selector-class">.setStatus</span>("PENDING");
        <span class="hljs-attribute">order</span><span class="hljs-selector-class">.setCreateTime</span>(LocalDateTime.now());
        orderMapper<span class="hljs-selector-class">.insert</span>(order);
        return <span class="hljs-attribute">order</span>;
    }
}

<span class="hljs-comment">// ========== 库存Service ==========</span>
<span class="hljs-keyword">@Service</span>
<span class="hljs-keyword">@Slf</span>4j
<span class="hljs-keyword">@RequiredArgsConstructor</span>
public class StockService {

    private final ProductStockMapper stockMapper;

    <span class="hljs-comment">/**
     * 扣减库存 - REQUIRED传播
     * 被OrderService调用时加入OrderService的事务
     */</span>
    <span class="hljs-keyword">@Transactional</span>(propagation = Propagation.REQUIRED)
    public void deductStock(Long productId, Integer quantity) {
        log<span class="hljs-selector-class">.info</span>("扣减库存，商品ID: {}, 数量: {}", productId, quantity);

        <span class="hljs-comment">// 查询库存</span>
        ProductStock stock = stockMapper<span class="hljs-selector-class">.selectByProductId</span>(productId);
        if (stock.getStock() &lt; quantity) {
            throw new <span class="hljs-built_in">BusinessException</span>("库存不足");
        }

        <span class="hljs-comment">// 扣减库存（使用乐观锁）</span>
        int rows = stockMapper<span class="hljs-selector-class">.deductStock</span>(productId, quantity, stock.getVersion());
        if (rows == <span class="hljs-number">0</span>) {
            throw new <span class="hljs-built_in">BusinessException</span>("库存扣减失败，请重试");
        }

        log<span class="hljs-selector-class">.info</span>("库存扣减成功");
    }
}

<span class="hljs-comment">// ========== 账户Service ==========</span>
<span class="hljs-keyword">@Service</span>
<span class="hljs-keyword">@Slf</span>4j
<span class="hljs-keyword">@RequiredArgsConstructor</span>
public class AccountService {

    private final AccountMapper accountMapper;

    <span class="hljs-comment">/**
     * 扣减余额 - REQUIRED传播
     * 被OrderService调用时加入OrderService的事务
     */</span>
    <span class="hljs-keyword">@Transactional</span>(propagation = Propagation.REQUIRED)
    public void deductBalance(String accountNo, BigDecimal amount) {
        log<span class="hljs-selector-class">.info</span>("扣减余额，账户: {}, 金额: {}", accountNo, amount);

        Account account = accountMapper<span class="hljs-selector-class">.selectByAccountNo</span>(accountNo);
        if (account.getBalance()<span class="hljs-selector-class">.compareTo</span>(amount) &lt; <span class="hljs-number">0</span>) {
            throw new <span class="hljs-built_in">BusinessException</span>("余额不足");
        }

        int rows = accountMapper<span class="hljs-selector-class">.deductBalance</span>(accountNo, amount);
        if (rows == <span class="hljs-number">0</span>) {
            throw new <span class="hljs-built_in">BusinessException</span>("余额扣减失败");
        }

        log<span class="hljs-selector-class">.info</span>("余额扣减成功");
    }
}
</code></pre>
<p><strong>REQUIRED传播特点</strong>：</p>
<ul>
<li>如果调用者没有事务，创建新事务</li>
<li>如果调用者已有事务，加入该事务</li>
<li><strong>整体提交或整体回滚</strong>，保证原子性</li>
</ul>
<h3 data-id="heading-3">2.2 REQUIRES_NEW - 实际应用场景</h3>
<p><strong>场景描述</strong>：下单成功后需要记录操作日志和发送通知，这些操作失败不应影响下单流程。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-meta">@RequiredArgsConstructor</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderService</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> OrderMapper orderMapper;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> OperationLogService logService;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> NotificationService notificationService;

    <span class="hljs-comment">/**
     * 下单主流程
     */</span>
    <span class="hljs-meta">@Transactional(propagation = Propagation.REQUIRED, rollbackFor = Exception.class)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">placeOrder</span><span class="hljs-params">(OrderRequest request)</span> {
        log.info(<span class="hljs-string">"===== 开始下单 ====="</span>);

        <span class="hljs-comment">// 1. 创建订单（在主事务中）</span>
        <span class="hljs-type">Order</span> <span class="hljs-variable">order</span> <span class="hljs-operator">=</span> createOrder(request);

        <span class="hljs-comment">// 2. 记录操作日志（在新事务中）</span>
        <span class="hljs-comment">// 即使日志记录失败，也不影响下单</span>
        <span class="hljs-keyword">try</span> {
            logService.saveLogWithNewTransaction(<span class="hljs-string">"ORDER_CREATE"</span>,
                <span class="hljs-string">"订单创建成功，订单号: "</span> + request.getOrderNo());
        } <span class="hljs-keyword">catch</span> (Exception e) {
            log.error(<span class="hljs-string">"日志记录失败，但不影响下单"</span>, e);
        }

        <span class="hljs-comment">// 3. 发送通知（在新事务中）</span>
        <span class="hljs-keyword">try</span> {
            notificationService.sendNotificationWithNewTransaction(
                <span class="hljs-string">"ORDER_CREATED"</span>,
                <span class="hljs-string">"订单创建成功"</span>
            );
        } <span class="hljs-keyword">catch</span> (Exception e) {
            log.error(<span class="hljs-string">"通知发送失败，但不影响下单"</span>, e);
        }

        log.info(<span class="hljs-string">"===== 下单完成 ====="</span>);
    }
}

<span class="hljs-comment">// ========== 操作日志Service ==========</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OperationLogService</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> OperationLogMapper operationLogMapper;

    <span class="hljs-comment">/**
     * 使用新事务记录日志
     * 关键点：REQUIRES_NEW传播行为
     */</span>
    <span class="hljs-meta">@Transactional(
        propagation = Propagation.REQUIRES_NEW,
        rollbackFor = Exception.class
    )</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">saveLogWithNewTransaction</span><span class="hljs-params">(String operationType, String description)</span> {
        log.info(<span class="hljs-string">"记录操作日志 - 新事务"</span>);

        <span class="hljs-type">OperationLog</span> <span class="hljs-variable">log</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OperationLog</span>();
        log.setOperationType(operationType);
        log.setDescription(description);
        log.setCreateTime(LocalDateTime.now());
        log.setStatus(<span class="hljs-string">"SUCCESS"</span>);

        operationLogMapper.insert(log);

        <span class="hljs-comment">// 模拟日志记录失败</span>
        <span class="hljs-keyword">if</span> (description.contains(<span class="hljs-string">"ERROR"</span>)) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"日志记录失败"</span>);
        }

        log.info(<span class="hljs-string">"日志记录完成"</span>);
    }
}

<span class="hljs-comment">// ========== 通知Service ==========</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NotificationService</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> NotificationMapper notificationMapper;

    <span class="hljs-comment">/**
     * 使用新事务发送通知
     * 通知发送失败不影响主业务
     */</span>
    <span class="hljs-meta">@Transactional(
        propagation = Propagation.REQUIRES_NEW,
        rollbackFor = Exception.class,
        timeout = 5  // 5秒超时
    )</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendNotificationWithNewTransaction</span><span class="hljs-params">(String type, String message)</span> {
        log.info(<span class="hljs-string">"发送通知 - 新事务"</span>);

        <span class="hljs-type">Notification</span> <span class="hljs-variable">notification</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Notification</span>();
        notification.setType(type);
        notification.setMessage(message);
        notification.setCreateTime(LocalDateTime.now());

        notificationMapper.insert(notification);

        log.info(<span class="hljs-string">"通知发送完成"</span>);
    }
}
</code></pre>
<p><strong>REQUIRES_NEW传播特点</strong>：</p>
<ul>
<li><strong>总是创建新事务</strong>，与调用者事务独立</li>
<li>新事务的提交/回滚不影响调用者事务</li>
<li>挂起调用者事务，等待新事务完成</li>
<li><strong>适用场景</strong>：日志记录、通知发送、独立计数等</li>
</ul>
<h3 data-id="heading-4">2.3 NESTED - 实际应用场景</h3>
<p><strong>场景描述</strong>：批量转账，其中一笔转账失败需要回滚，但不影响其他转账。</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@Service</span>
<span class="hljs-variable">@Slf4j</span>
<span class="hljs-variable">@RequiredArgsConstructor</span>
public class BatchTransferService {

    <span class="hljs-selector-tag">private</span> <span class="hljs-selector-tag">final</span> <span class="hljs-selector-tag">TransferService</span> <span class="hljs-selector-tag">transferService</span>;
    <span class="hljs-selector-tag">private</span> <span class="hljs-selector-tag">final</span> <span class="hljs-selector-tag">BatchTransferRecordMapper</span> <span class="hljs-selector-tag">recordMapper</span>;

    <span class="hljs-comment">/**
     * 批量转账 - 使用嵌套事务
     * 单笔转账失败只回滚该笔，不影响其他转账
     */</span>
    @<span class="hljs-selector-tag">Transactional</span>(propagation = Propagation.REQUIRED, rollbackFor = Exception.class)
    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">void</span> <span class="hljs-selector-tag">batchTransfer</span>(BatchTransferRequest request) {
        <span class="hljs-selector-tag">log</span><span class="hljs-selector-class">.info</span>(<span class="hljs-string">"===== 开始批量转账 ====="</span>);

        <span class="hljs-comment">// 创建批量转账记录</span>
        <span class="hljs-selector-tag">BatchTransferRecord</span> <span class="hljs-selector-tag">record</span> = <span class="hljs-selector-tag">createBatchRecord</span>(request);

        <span class="hljs-selector-tag">int</span> <span class="hljs-selector-tag">successCount</span> = <span class="hljs-number">0</span>;
        <span class="hljs-selector-tag">int</span> <span class="hljs-selector-tag">failCount</span> = <span class="hljs-number">0</span>;

        <span class="hljs-selector-tag">for</span> (TransferItem <span class="hljs-attribute">item </span>: request.<span class="hljs-built_in">getItems</span>()) {
            <span class="hljs-selector-tag">try</span> {
                <span class="hljs-comment">// 嵌套事务：单笔转账失败只回滚该笔</span>
                <span class="hljs-selector-tag">transferService</span><span class="hljs-selector-class">.transferWithNested</span>(item);
                <span class="hljs-selector-tag">successCount</span>++;

                    <span class="hljs-comment">// 记录成功</span>
                <span class="hljs-selector-tag">recordTransferItem</span>(record.<span class="hljs-built_in">getId</span>(), item, <span class="hljs-string">"SUCCESS"</span>);

            } <span class="hljs-selector-tag">catch</span> (Exception e) {
                <span class="hljs-selector-tag">failCount</span>++;
                <span class="hljs-selector-tag">log</span><span class="hljs-selector-class">.error</span>(<span class="hljs-string">"转账失败: {}"</span>, item.<span class="hljs-built_in">getAccountNo</span>(), e);

                <span class="hljs-comment">// 记录失败（嵌套事务已回滚，但记录成功）</span>
                <span class="hljs-selector-tag">recordTransferItem</span>(record.<span class="hljs-built_in">getId</span>(), item, <span class="hljs-string">"FAILED"</span>);
            }
        }

        <span class="hljs-comment">// 更新批量转账状态</span>
        <span class="hljs-selector-tag">recordMapper</span><span class="hljs-selector-class">.updateStatus</span>(record.<span class="hljs-built_in">getId</span>(),
            String.<span class="hljs-built_in">format</span>(<span class="hljs-string">"成功%d笔，失败%d笔"</span>, successCount, failCount));

        <span class="hljs-selector-tag">log</span><span class="hljs-selector-class">.info</span>(<span class="hljs-string">"===== 批量转账完成 ====="</span>);
    }
}

<span class="hljs-comment">// ========== 转账Service ==========</span>
@<span class="hljs-selector-tag">Service</span>
@<span class="hljs-selector-tag">Slf4j</span>
<span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">class</span> <span class="hljs-selector-tag">TransferService</span> {

    <span class="hljs-selector-tag">private</span> <span class="hljs-selector-tag">final</span> <span class="hljs-selector-tag">AccountMapper</span> <span class="hljs-selector-tag">accountMapper</span>;
    <span class="hljs-selector-tag">private</span> <span class="hljs-selector-tag">final</span> <span class="hljs-selector-tag">TransferLogMapper</span> <span class="hljs-selector-tag">transferLogMapper</span>;

    <span class="hljs-comment">/**
     * 使用嵌套事务进行单笔转账
     * 关键：NESTED传播行为
     */</span>
    @<span class="hljs-selector-tag">Transactional</span>(
        propagation = Propagation.NESTED,
        rollbackFor = Exception.class
    )
    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">void</span> <span class="hljs-selector-tag">transferWithNested</span>(TransferItem item) {
        <span class="hljs-selector-tag">log</span><span class="hljs-selector-class">.info</span>(<span class="hljs-string">"执行转账: {} -&gt; {}, 金额: {}"</span>,
            item.<span class="hljs-built_in">getFromAccount</span>(), item.<span class="hljs-built_in">getToAccount</span>(), item.<span class="hljs-built_in">getAmount</span>());

        <span class="hljs-comment">// 1. 转出</span>
        <span class="hljs-selector-tag">accountMapper</span><span class="hljs-selector-class">.subtractBalance</span>(item.<span class="hljs-built_in">getFromAccount</span>(), item.<span class="hljs-built_in">getAmount</span>());

        <span class="hljs-comment">// 2. 转入</span>
        <span class="hljs-selector-tag">accountMapper</span><span class="hljs-selector-class">.addBalance</span>(item.<span class="hljs-built_in">getToAccount</span>(), item.<span class="hljs-built_in">getAmount</span>());

        <span class="hljs-comment">// 3. 记录转账日志</span>
        <span class="hljs-selector-tag">TransferLog</span> <span class="hljs-selector-tag">log</span> = <span class="hljs-selector-tag">new</span> <span class="hljs-selector-tag">TransferLog</span>();
        <span class="hljs-selector-tag">log</span><span class="hljs-selector-class">.setFromAccount</span>(item.<span class="hljs-built_in">getFromAccount</span>());
        <span class="hljs-selector-tag">log</span><span class="hljs-selector-class">.setToAccount</span>(item.<span class="hljs-built_in">getToAccount</span>());
        <span class="hljs-selector-tag">log</span><span class="hljs-selector-class">.setAmount</span>(item.<span class="hljs-built_in">getAmount</span>());
        <span class="hljs-selector-tag">log</span><span class="hljs-selector-class">.setTransferTime</span>(LocalDateTime.<span class="hljs-built_in">now</span>());
        <span class="hljs-selector-tag">transferLogMapper</span><span class="hljs-selector-class">.insert</span>(log);

        <span class="hljs-comment">// 模拟转账失败（触发嵌套事务回滚）</span>
        <span class="hljs-selector-tag">if</span> (item.<span class="hljs-built_in">getAmount</span>().<span class="hljs-built_in">compareTo</span>(new <span class="hljs-built_in">BigDecimal</span>(<span class="hljs-string">"10000"</span>)) &gt; <span class="hljs-number">0</span>) {
            <span class="hljs-selector-tag">throw</span> <span class="hljs-selector-tag">new</span> <span class="hljs-selector-tag">BusinessException</span>(<span class="hljs-string">"单笔转账金额不能超过10000"</span>);
        }

        <span class="hljs-selector-tag">log</span><span class="hljs-selector-class">.info</span>(<span class="hljs-string">"转账完成"</span>);
    }
}
</code></pre>
<p><strong>NESTED传播特点</strong>：</p>
<ul>
<li>如果没有外层事务，创建新事务（行为同REQUIRED）</li>
<li>如果有外层事务，创建<strong>嵌套事务</strong>（保存点）</li>
<li>嵌套事务可以独立回滚（回滚到保存点）</li>
<li>嵌套事务失败不影响外层事务</li>
<li><strong>适用场景</strong>：批量操作、需要部分回滚的业务</li>
</ul>
<h2 data-id="heading-5">三、事务隔离级别</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/591aa4da11c54ca190c073cf9c475106~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769351357&amp;x-signature=VkzuY1QXmngE2q6IZCKv8GdVazk%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-6">3.1 完整示例：高并发场景下的隔离级别选择</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// ========== 银行转账Service ==========</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-meta">@RequiredArgsConstructor</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BankTransferService</span> {

    <span class="hljs-keyword">private</span> final <span class="hljs-title class_">AccountMapper</span> accountMapper;
    <span class="hljs-keyword">private</span> final <span class="hljs-title class_">TransferLogMapper</span> transferLogMapper;

    <span class="hljs-comment">/**
     * 大额转账 - 使用串行化隔离级别
     * 确保绝对的一致性，牺牲性能
     */</span>
    <span class="hljs-meta">@Transactional</span>(
        isolation = <span class="hljs-title class_">Isolation</span>.<span class="hljs-property">SERIALIZABLE</span>,
        timeout = <span class="hljs-number">30</span>,
        rollbackFor = <span class="hljs-title class_">Exception</span>.<span class="hljs-property">class</span>
    )
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">largeAmountTransfer</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> fromAccount, <span class="hljs-built_in">String</span> toAccount, BigDecimal amount</span>) {
        log.<span class="hljs-title function_">info</span>(<span class="hljs-string">"===== 大额转账开始（串行化隔离） ====="</span>);
        log.<span class="hljs-title function_">info</span>(<span class="hljs-string">"从: {} 到: {}, 金额: {}"</span>, fromAccount, toAccount, amount);

        <span class="hljs-comment">// 1. 验证账户状态</span>
        <span class="hljs-title class_">Account</span> <span class="hljs-keyword">from</span> = <span class="hljs-title function_">validateAccount</span>(fromAccount, amount);
        <span class="hljs-title class_">Account</span> to = <span class="hljs-title function_">getAccount</span>(toAccount);

        <span class="hljs-comment">// 2. 执行转账</span>
        <span class="hljs-keyword">from</span>.<span class="hljs-title function_">setBalance</span>(<span class="hljs-keyword">from</span>.<span class="hljs-title function_">getBalance</span>().<span class="hljs-title function_">subtract</span>(amount));
        to.<span class="hljs-title function_">setBalance</span>(to.<span class="hljs-title function_">getBalance</span>().<span class="hljs-title function_">add</span>(amount));

        accountMapper.<span class="hljs-title function_">updateById</span>(<span class="hljs-keyword">from</span>);
        accountMapper.<span class="hljs-title function_">updateById</span>(to);

        <span class="hljs-comment">// 3. 记录转账日志</span>
        <span class="hljs-title function_">saveTransferLog</span>(fromAccount, toAccount, amount, <span class="hljs-string">"SUCCESS"</span>);

        log.<span class="hljs-title function_">info</span>(<span class="hljs-string">"===== 大额转账完成 ====="</span>);
    }

    <span class="hljs-comment">/**
     * 普通转账 - 使用可重复读（MySQL默认）
     * 平衡性能与一致性
     */</span>
    <span class="hljs-meta">@Transactional</span>(
        isolation = <span class="hljs-title class_">Isolation</span>.<span class="hljs-property">REPEATABLE_READ</span>,
        timeout = <span class="hljs-number">10</span>,
        rollbackFor = <span class="hljs-title class_">Exception</span>.<span class="hljs-property">class</span>
    )
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">normalTransfer</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> fromAccount, <span class="hljs-built_in">String</span> toAccount, BigDecimal amount</span>) {
        log.<span class="hljs-title function_">info</span>(<span class="hljs-string">"===== 普通转账开始（可重复读） ====="</span>);

        <span class="hljs-comment">// 转账逻辑</span>
        <span class="hljs-title function_">doTransfer</span>(fromAccount, toAccount, amount);

        log.<span class="hljs-title function_">info</span>(<span class="hljs-string">"===== 普通转账完成 ====="</span>);
    }

    <span class="hljs-comment">/**
     * 查询余额 - 使用读已提交
     * 允许其他事务修改，提高并发性能
     */</span>
    <span class="hljs-meta">@Transactional</span>(
        isolation = <span class="hljs-title class_">Isolation</span>.<span class="hljs-property">READ_COMMITTED</span>,
        readOnly = <span class="hljs-literal">true</span>,
        timeout = <span class="hljs-number">5</span>
    )
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">BigDecimal</span> <span class="hljs-title function_">queryBalance</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> accountNo</span>) {
        log.<span class="hljs-title function_">info</span>(<span class="hljs-string">"查询账户余额: {}"</span>, accountNo);

        <span class="hljs-title class_">Account</span> account = accountMapper.<span class="hljs-title function_">selectByAccountNo</span>(accountNo);
        <span class="hljs-keyword">return</span> account.<span class="hljs-title function_">getBalance</span>();
    }

    <span class="hljs-comment">/**
     * 统计查询 - 使用读未提交
     * 允许脏读，最大化查询性能
     */</span>
    <span class="hljs-meta">@Transactional</span>(
        isolation = <span class="hljs-title class_">Isolation</span>.<span class="hljs-property">READ_UNCOMMITTED</span>,
        readOnly = <span class="hljs-literal">true</span>,
        timeout = <span class="hljs-number">30</span>
    )
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">Map</span>&lt;<span class="hljs-title class_">String</span>, <span class="hljs-title class_">Object</span>&gt; <span class="hljs-title function_">statistics</span>(<span class="hljs-params"/>) {
        log.<span class="hljs-title function_">info</span>(<span class="hljs-string">"统计查询（读未提交）"</span>);

        <span class="hljs-title class_">Long</span> totalAccounts = accountMapper.<span class="hljs-title function_">countAccounts</span>();
        <span class="hljs-title class_">BigDecimal</span> totalBalance = accountMapper.<span class="hljs-title function_">sumBalance</span>();

        <span class="hljs-title class_">Map</span>&lt;<span class="hljs-title class_">String</span>, <span class="hljs-title class_">Object</span>&gt; result = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
        result.<span class="hljs-title function_">put</span>(<span class="hljs-string">"totalAccounts"</span>, totalAccounts);
        result.<span class="hljs-title function_">put</span>(<span class="hljs-string">"totalBalance"</span>, totalBalance);

        <span class="hljs-keyword">return</span> result;
    }

    <span class="hljs-keyword">private</span> <span class="hljs-title class_">Account</span> <span class="hljs-title function_">validateAccount</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> accountNo, BigDecimal amount</span>) {
        <span class="hljs-title class_">Account</span> account = accountMapper.<span class="hljs-title function_">selectByAccountNo</span>(accountNo);
        <span class="hljs-keyword">if</span> (account == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BusinessException</span>(<span class="hljs-string">"账户不存在"</span>);
        }
        <span class="hljs-keyword">if</span> (account.<span class="hljs-title function_">getBalance</span>().<span class="hljs-title function_">compareTo</span>(amount) &lt; <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BusinessException</span>(<span class="hljs-string">"余额不足"</span>);
        }
        <span class="hljs-keyword">if</span> (account.<span class="hljs-title function_">isFrozen</span>()) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BusinessException</span>(<span class="hljs-string">"账户已冻结"</span>);
        }
        <span class="hljs-keyword">return</span> account;
    }

    <span class="hljs-keyword">private</span> <span class="hljs-title class_">Account</span> <span class="hljs-title function_">getAccount</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> accountNo</span>) {
        <span class="hljs-title class_">Account</span> account = accountMapper.<span class="hljs-title function_">selectByAccountNo</span>(accountNo);
        <span class="hljs-keyword">if</span> (account == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BusinessException</span>(<span class="hljs-string">"目标账户不存在"</span>);
        }
        <span class="hljs-keyword">return</span> account;
    }

    <span class="hljs-keyword">private</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">saveTransferLog</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> <span class="hljs-keyword">from</span>, <span class="hljs-built_in">String</span> to, BigDecimal amount, <span class="hljs-built_in">String</span> status</span>) {
        <span class="hljs-title class_">TransferLog</span> log = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TransferLog</span>();
        log.<span class="hljs-title function_">setFromAccount</span>(<span class="hljs-keyword">from</span>);
        log.<span class="hljs-title function_">setToAccount</span>(to);
        log.<span class="hljs-title function_">setAmount</span>(amount);
        log.<span class="hljs-title function_">setStatus</span>(status);
        log.<span class="hljs-title function_">setTransferTime</span>(<span class="hljs-title class_">LocalDateTime</span>.<span class="hljs-title function_">now</span>());
        transferLogMapper.<span class="hljs-title function_">insert</span>(log);
    }

    <span class="hljs-keyword">private</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">doTransfer</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> <span class="hljs-keyword">from</span>, <span class="hljs-built_in">String</span> to, BigDecimal amount</span>) {
        <span class="hljs-title class_">Account</span> fromAccount = accountMapper.<span class="hljs-title function_">selectByAccountNo</span>(<span class="hljs-keyword">from</span>);
        <span class="hljs-title class_">Account</span> toAccount = accountMapper.<span class="hljs-title function_">selectByAccountNo</span>(to);

        fromAccount.<span class="hljs-title function_">setBalance</span>(fromAccount.<span class="hljs-title function_">getBalance</span>().<span class="hljs-title function_">subtract</span>(amount));
        toAccount.<span class="hljs-title function_">setBalance</span>(toAccount.<span class="hljs-title function_">getBalance</span>().<span class="hljs-title function_">add</span>(amount));

        accountMapper.<span class="hljs-title function_">updateById</span>(fromAccount);
        accountMapper.<span class="hljs-title function_">updateById</span>(toAccount);

        <span class="hljs-title function_">saveTransferLog</span>(<span class="hljs-keyword">from</span>, to, amount, <span class="hljs-string">"SUCCESS"</span>);
    }
}

<span class="hljs-comment">// ========== Mapper接口 ==========</span>
<span class="hljs-meta">@Mapper</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">AccountMapper</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseMapper</span>&lt;<span class="hljs-title class_">Account</span>&gt; {

    <span class="hljs-meta">@Select</span>(<span class="hljs-string">"SELECT * FROM t_account WHERE account_no = #{accountNo} FOR UPDATE"</span>)
    <span class="hljs-title class_">Account</span> <span class="hljs-title function_">selectByAccountNoForUpdate</span>(<span class="hljs-title class_">String</span> accountNo);

    <span class="hljs-meta">@Select</span>(<span class="hljs-string">"SELECT COUNT(*) FROM t_account"</span>)
    <span class="hljs-title class_">Long</span> <span class="hljs-title function_">countAccounts</span>();

    <span class="hljs-meta">@Select</span>(<span class="hljs-string">"SELECT SUM(balance) FROM t_account"</span>)
    <span class="hljs-title class_">BigDecimal</span> <span class="hljs-title function_">sumBalance</span>();
}
</code></pre>
<h3 data-id="heading-7">3.2 隔离级别对比示例</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * 演示不同隔离级别的并发问题
 */</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">IsolationDemoService</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> AccountMapper accountMapper;

    <span class="hljs-comment">/**
     * 演示脏读现象
     * 线程A：查询余额（未提交）
     * 线程B：修改余额（未提交）
     * 线程A：读取到线程B未提交的数据
     */</span>
    <span class="hljs-meta">@Transactional(isolation = Isolation.READ_UNCOMMITTED)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">demonstrateDirtyRead</span><span class="hljs-params">(Long accountId)</span> <span class="hljs-keyword">throws</span> InterruptedException {
        log.info(<span class="hljs-string">"===== 脏读演示 ====="</span>);

        <span class="hljs-comment">// 第一次读取</span>
        <span class="hljs-type">Account</span> <span class="hljs-variable">account1</span> <span class="hljs-operator">=</span> accountMapper.selectById(accountId);
        <span class="hljs-type">BigDecimal</span> <span class="hljs-variable">balance1</span> <span class="hljs-operator">=</span> account1.getBalance();
        log.info(<span class="hljs-string">"第一次读取余额: {}"</span>, balance1);

        <span class="hljs-comment">// 模拟其他事务修改数据（未提交）</span>
        TimeUnit.SECONDS.sleep(<span class="hljs-number">2</span>);

        <span class="hljs-comment">// 第二次读取（可能读到未提交的数据）</span>
        <span class="hljs-type">Account</span> <span class="hljs-variable">account2</span> <span class="hljs-operator">=</span> accountMapper.selectById(accountId);
        <span class="hljs-type">BigDecimal</span> <span class="hljs-variable">balance2</span> <span class="hljs-operator">=</span> account2.getBalance();
        log.info(<span class="hljs-string">"第二次读取余额: {} (可能脏读)"</span>, balance2);
    }

    <span class="hljs-comment">/**
     * 演示不可重复读
     * 同一事务中两次读取结果不同
     */</span>
    <span class="hljs-meta">@Transactional(isolation = Isolation.READ_COMMITTED)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">demonstrateNonRepeatableRead</span><span class="hljs-params">(Long accountId)</span> <span class="hljs-keyword">throws</span> InterruptedException {
        log.info(<span class="hljs-string">"===== 不可重复读演示 ====="</span>);

        <span class="hljs-comment">// 第一次读取</span>
        <span class="hljs-type">Account</span> <span class="hljs-variable">account1</span> <span class="hljs-operator">=</span> accountMapper.selectById(accountId);
        <span class="hljs-type">BigDecimal</span> <span class="hljs-variable">balance1</span> <span class="hljs-operator">=</span> account1.getBalance();
        log.info(<span class="hljs-string">"第一次读取余额: {}"</span>, balance1);

        <span class="hljs-comment">// 模拟其他事务提交数据</span>
        TimeUnit.SECONDS.sleep(<span class="hljs-number">2</span>);

        <span class="hljs-comment">// 第二次读取（结果不同）</span>
        <span class="hljs-type">Account</span> <span class="hljs-variable">account2</span> <span class="hljs-operator">=</span> accountMapper.selectById(accountId);
        <span class="hljs-type">BigDecimal</span> <span class="hljs-variable">balance2</span> <span class="hljs-operator">=</span> account2.getBalance();
        log.info(<span class="hljs-string">"第二次读取余额: {}"</span>, balance2);

        <span class="hljs-keyword">if</span> (!balance1.equals(balance2)) {
            log.warn(<span class="hljs-string">"检测到不可重复读！"</span>);
        }
    }

    <span class="hljs-comment">/**
     * 演示可重复读
     * 同一事务中多次读取结果一致
     */</span>
    <span class="hljs-meta">@Transactional(isolation = Isolation.REPEATABLE_READ)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">demonstrateRepeatableRead</span><span class="hljs-params">(Long accountId)</span> <span class="hljs-keyword">throws</span> InterruptedException {
        log.info(<span class="hljs-string">"===== 可重复读演示 ====="</span>);

        <span class="hljs-comment">// 第一次读取</span>
        <span class="hljs-type">Account</span> <span class="hljs-variable">account1</span> <span class="hljs-operator">=</span> accountMapper.selectById(accountId);
        <span class="hljs-type">BigDecimal</span> <span class="hljs-variable">balance1</span> <span class="hljs-operator">=</span> account1.getBalance();
        log.info(<span class="hljs-string">"第一次读取余额: {}"</span>, balance1);

        <span class="hljs-comment">// 其他事务无法修改当前事务读取的数据</span>
        TimeUnit.SECONDS.sleep(<span class="hljs-number">2</span>);

        <span class="hljs-comment">// 第二次读取（结果相同）</span>
        <span class="hljs-type">Account</span> <span class="hljs-variable">account2</span> <span class="hljs-operator">=</span> accountMapper.selectById(accountId);
        <span class="hljs-type">BigDecimal</span> <span class="hljs-variable">balance2</span> <span class="hljs-operator">=</span> account2.getBalance();
        log.info(<span class="hljs-string">"第二次读取余额: {}"</span>, balance2);

        log.info(<span class="hljs-string">"可重复读保证：两次读取结果一致"</span>);
    }
}
</code></pre>
<h2 data-id="heading-8">四、事务回滚规则完整示例</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d79c72512cc344f9b8ec337beff742b7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769351357&amp;x-signature=EJ4W24KXsBU2vYi3o15Q8LI9MWU%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-9">4.1 默认回滚行为</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DefaultRollbackService</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> AccountMapper accountMapper;

    <span class="hljs-comment">/**
     * 默认只回滚 RuntimeException 和 Error
     * 运行时异常触发回滚
     */</span>
    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">runtimeExceptionRollback</span><span class="hljs-params">()</span> {
        log.info(<span class="hljs-string">"===== RuntimeException回滚演示 ====="</span>);

        <span class="hljs-type">Account</span> <span class="hljs-variable">account</span> <span class="hljs-operator">=</span> accountMapper.selectById(<span class="hljs-number">1L</span>);
        account.setBalance(account.getBalance().add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-string">"100"</span>)));
        accountMapper.updateById(account);

        log.info(<span class="hljs-string">"余额增加100"</span>);

        <span class="hljs-comment">// RuntimeException触发回滚</span>
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"运行时异常，触发回滚"</span>);
    }

    <span class="hljs-comment">/**
     * 检查型异常默认不回滚
     * IOException不会触发回滚，事务提交
     */</span>
    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">checkedExceptionNoRollback</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException {
        log.info(<span class="hljs-string">"===== Checked Exception不回滚演示 ====="</span>);

        <span class="hljs-type">Account</span> <span class="hljs-variable">account</span> <span class="hljs-operator">=</span> accountMapper.selectById(<span class="hljs-number">1L</span>);
        account.setBalance(account.getBalance().add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-string">"100"</span>)));
        accountMapper.updateById(account);

        log.info(<span class="hljs-string">"余额增加100"</span>);

        <span class="hljs-comment">// IOException不会触发回滚</span>
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IOException</span>(<span class="hljs-string">"检查型异常，不回滚"</span>);
    }

    <span class="hljs-comment">/**
     * Error会触发回滚
     */</span>
    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">errorRollback</span><span class="hljs-params">()</span> {
        log.info(<span class="hljs-string">"===== Error回滚演示 ====="</span>);

        accountMapper.addBalance(<span class="hljs-number">1L</span>, <span class="hljs-number">100L</span>);

        <span class="hljs-comment">// Error触发回滚</span>
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OutOfMemoryError</span>(<span class="hljs-string">"内存溢出，触发回滚"</span>);
    }
}
</code></pre>
<h3 data-id="heading-10">4.2 自定义回滚规则</h3>
<pre><code class="hljs language-arduino" lang="arduino">@Service
@Slf4j
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CustomRollbackService</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> AccountMapper accountMapper;

    <span class="hljs-comment">/**
     * 指定所有异常都回滚
     */</span>
    @<span class="hljs-built_in">Transactional</span>(
        rollbackFor = Exception.<span class="hljs-keyword">class</span>,  <span class="hljs-comment">// 所有Exception及其子类</span>
        noRollbackFor = BusinessException.<span class="hljs-keyword">class</span>  <span class="hljs-comment">// 除了BusinessException</span>
    )
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">void</span> <span class="hljs-title">customRollback</span><span class="hljs-params">()</span> throws Exception </span>{
        log.<span class="hljs-built_in">info</span>(<span class="hljs-string">"===== 自定义回滚规则演示 ====="</span>);

        accountMapper.<span class="hljs-built_in">addBalance</span>(<span class="hljs-number">1L</span>, <span class="hljs-number">100L</span>);

        <span class="hljs-comment">// IOException现在也会回滚</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-literal">true</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">IOException</span>(<span class="hljs-string">"指定回滚后，IOException也会回滚"</span>);
        }
    }

    <span class="hljs-comment">/**
     * 精确控制回滚异常类型
     */</span>
    @<span class="hljs-built_in">Transactional</span>(
        rollbackFor = {
            RuntimeException.<span class="hljs-keyword">class</span>,
            IOException.<span class="hljs-keyword">class</span>,
            SQLException.<span class="hljs-keyword">class</span>
        },
        noRollbackFor = {
            BusinessException.<span class="hljs-keyword">class</span>,
            ValidationException.<span class="hljs-keyword">class</span>
        }
    )
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">void</span> <span class="hljs-title">preciseRollback</span><span class="hljs-params">()</span> throws Exception </span>{
        log.<span class="hljs-built_in">info</span>(<span class="hljs-string">"===== 精确回滚控制演示 ====="</span>);

        accountMapper.<span class="hljs-built_in">addBalance</span>(<span class="hljs-number">1L</span>, <span class="hljs-number">100L</span>);

        <span class="hljs-comment">// ValidationException不会回滚</span>
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">ValidationException</span>(<span class="hljs-string">"验证异常，不回滚"</span>);
    }
}
</code></pre>
<h3 data-id="heading-11">4.3 异常处理最佳实践</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RollbackBestPracticeService</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> AccountMapper accountMapper;

    <span class="hljs-comment">/**
     * 推荐：明确指定回滚规则
     */</span>
    <span class="hljs-meta">@Transactional(
        rollbackFor = Exception.class,
        timeout = 30
    )</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">recommended</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception {
        log.info(<span class="hljs-string">"===== 推荐的事务配置 ====="</span>);

        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 业务操作</span>
            accountMapper.addBalance(<span class="hljs-number">1L</span>, <span class="hljs-number">100L</span>);

            <span class="hljs-comment">// 可能抛出检查型异常的操作</span>
            callExternalAPI();

        } <span class="hljs-keyword">catch</span> (BusinessException e) {
            <span class="hljs-comment">// 业务异常不需要回滚，已经在配置中排除</span>
            log.error(<span class="hljs-string">"业务异常: {}"</span>, e.getMessage());
            <span class="hljs-keyword">throw</span> e;
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-comment">// 其他异常需要回滚</span>
            log.error(<span class="hljs-string">"系统异常: {}"</span>, e.getMessage());
            <span class="hljs-keyword">throw</span> e;
        }
    }

    <span class="hljs-comment">/**
     * 只读事务
     */</span>
    <span class="hljs-meta">@Transactional(
        readOnly = true,
        isolation = Isolation.READ_COMMITTED
    )</span>
    <span class="hljs-keyword">public</span> Account <span class="hljs-title function_">queryAccount</span><span class="hljs-params">(Long id)</span> {
        log.info(<span class="hljs-string">"查询账户（只读事务）"</span>);
        <span class="hljs-keyword">return</span> accountMapper.selectById(id);
    }

    <span class="hljs-comment">/**
     * 超时设置
     */</span>
    <span class="hljs-meta">@Transactional(
        timeout = 5  // 5秒超时
    )</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">timeoutExample</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException {
        log.info(<span class="hljs-string">"超时示例"</span>);
        accountMapper.addBalance(<span class="hljs-number">1L</span>, <span class="hljs-number">100L</span>);

        <span class="hljs-comment">// 模拟长时间操作</span>
        TimeUnit.SECONDS.sleep(<span class="hljs-number">10</span>);
        <span class="hljs-comment">// 超时后自动回滚</span>
    }
}
</code></pre>
<h2 data-id="heading-12">五、事务失效场景与解决方案</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/42564fdc03754686be1cce1ca3e9defa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769351357&amp;x-signature=q27wMX3JnpSrRuETWBZYFhAu1dw%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-13">5.1 同类方法调用 - 最常见失效场景</h3>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">/**
 * ❌ 错误示例：同类方法调用导致事务失效
 */</span>
<span class="hljs-keyword">@Service</span>
<span class="hljs-keyword">@Slf</span>4j
public class WrongSameClassCallService {

    private final OrderMapper orderMapper;
    private final PaymentMapper paymentMapper;

    <span class="hljs-comment">/**
     * 创建订单（有事务）
     */</span>
    <span class="hljs-keyword">@Transactional</span>
    public void createOrder(OrderRequest request) {
        log<span class="hljs-selector-class">.info</span>("创建订单");

        <span class="hljs-comment">// 创建订单</span>
        <span class="hljs-attribute">Order</span> <span class="hljs-attribute">order</span> = new <span class="hljs-attribute">Order</span>();
        <span class="hljs-attribute">order</span><span class="hljs-selector-class">.setOrderNo</span>(request.getOrderNo());
        <span class="hljs-attribute">order</span><span class="hljs-selector-class">.setAmount</span>(request.getAmount());
        orderMapper<span class="hljs-selector-class">.insert</span>(order);

        <span class="hljs-comment">// ❌ 直接调用同类方法，事务失效</span>
        this<span class="hljs-selector-class">.processPayment</span>(request);
    }

    <span class="hljs-comment">/**
     * 处理支付（有事务，但会失效）
     */</span>
    <span class="hljs-keyword">@Transactional</span>
    public void processPayment(OrderRequest request) {
        log<span class="hljs-selector-class">.info</span>("处理支付");

        Payment payment = new <span class="hljs-built_in">Payment</span>();
        payment<span class="hljs-selector-class">.setOrderNo</span>(request.getOrderNo());
        payment<span class="hljs-selector-class">.setAmount</span>(request.getAmount());
        paymentMapper<span class="hljs-selector-class">.insert</span>(payment);

        <span class="hljs-comment">// 模拟异常，验证事务是否生效</span>
        throw new <span class="hljs-built_in">RuntimeException</span>("支付处理失败");
    }
}

<span class="hljs-comment">/**
 * ✅ 正确示例：使用自注入解决
 */</span>
<span class="hljs-keyword">@Service</span>
<span class="hljs-keyword">@Slf</span>4j
<span class="hljs-keyword">@RequiredArgsConstructor</span>
public class CorrectSameClassCallService {

    private final OrderMapper orderMapper;
    private final PaymentMapper paymentMapper;

    <span class="hljs-comment">// 注入自己（获取代理对象）</span>
    <span class="hljs-keyword">@Autowired</span>
    private CorrectSameClassCallService self;

    <span class="hljs-comment">/**
     * 创建订单
     */</span>
    <span class="hljs-keyword">@Transactional</span>
    public void createOrder(OrderRequest request) {
        log<span class="hljs-selector-class">.info</span>("创建订单");

        <span class="hljs-attribute">Order</span> <span class="hljs-attribute">order</span> = new <span class="hljs-attribute">Order</span>();
        <span class="hljs-attribute">order</span><span class="hljs-selector-class">.setOrderNo</span>(request.getOrderNo());
        <span class="hljs-attribute">order</span><span class="hljs-selector-class">.setAmount</span>(request.getAmount());
        orderMapper<span class="hljs-selector-class">.insert</span>(order);

        <span class="hljs-comment">// ✅ 通过代理调用，事务生效</span>
        self<span class="hljs-selector-class">.processPayment</span>(request);
    }

    <span class="hljs-comment">/**
     * 处理支付
     */</span>
    <span class="hljs-keyword">@Transactional</span>
    public void processPayment(OrderRequest request) {
        log<span class="hljs-selector-class">.info</span>("处理支付");

        Payment payment = new <span class="hljs-built_in">Payment</span>();
        payment<span class="hljs-selector-class">.setOrderNo</span>(request.getOrderNo());
        payment<span class="hljs-selector-class">.setAmount</span>(request.getAmount());
        paymentMapper<span class="hljs-selector-class">.insert</span>(payment);

        <span class="hljs-comment">// 这个异常会触发回滚</span>
        throw new <span class="hljs-built_in">RuntimeException</span>("支付处理失败");
    }
}

<span class="hljs-comment">/**
 * ✅ 正确示例：拆分到不同Service
 */</span>
<span class="hljs-keyword">@Service</span>
<span class="hljs-keyword">@Slf</span>4j
<span class="hljs-keyword">@RequiredArgsConstructor</span>
public class SplitServiceSolution {

    private final OrderMapper orderMapper;
    private final PaymentService paymentService;

    <span class="hljs-comment">/**
     * 创建订单
     */</span>
    <span class="hljs-keyword">@Transactional</span>
    public void createOrder(OrderRequest request) {
        log<span class="hljs-selector-class">.info</span>("创建订单");

        <span class="hljs-attribute">Order</span> <span class="hljs-attribute">order</span> = new <span class="hljs-attribute">Order</span>();
        <span class="hljs-attribute">order</span><span class="hljs-selector-class">.setOrderNo</span>(request.getOrderNo());
        <span class="hljs-attribute">order</span><span class="hljs-selector-class">.setAmount</span>(request.getAmount());
        orderMapper<span class="hljs-selector-class">.insert</span>(order);

        <span class="hljs-comment">// ✅ 调用不同Service，事务生效</span>
        paymentService<span class="hljs-selector-class">.processPayment</span>(request);
    }
}

<span class="hljs-keyword">@Service</span>
<span class="hljs-keyword">@Slf</span>4j
public class PaymentService {

    private final PaymentMapper paymentMapper;

    <span class="hljs-comment">/**
     * 处理支付
     */</span>
    <span class="hljs-keyword">@Transactional</span>
    public void processPayment(OrderRequest request) {
        log<span class="hljs-selector-class">.info</span>("处理支付");

        Payment payment = new <span class="hljs-built_in">Payment</span>();
        payment<span class="hljs-selector-class">.setOrderNo</span>(request.getOrderNo());
        payment<span class="hljs-selector-class">.setAmount</span>(request.getAmount());
        paymentMapper<span class="hljs-selector-class">.insert</span>(payment);
    }
}
</code></pre>
<h3 data-id="heading-14">5.2 多线程调用失效</h3>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">/**
 * ❌ 错误示例：多线程调用导致事务失效
 */</span>
<span class="hljs-keyword">@Service</span>
<span class="hljs-keyword">@Slf</span>4j
public class WrongMultiThreadService {

    private final AccountMapper accountMapper;

    <span class="hljs-comment">/**
     * 批量转账
     */</span>
    <span class="hljs-keyword">@Transactional</span>
    public void batchTransfer(List&lt;TransferRequest&gt; requests) {
        log<span class="hljs-selector-class">.info</span>("===== 批量转账 =====");

        CountDownLatch latch = new <span class="hljs-built_in">CountDownLatch</span>(requests.size());

        for (TransferRequest request : requests) {
            <span class="hljs-comment">// ❌ 新线程无法获取事务上下文</span>
            new <span class="hljs-built_in">Thread</span>(() -&gt; {
                try {
                    <span class="hljs-built_in">doTransfer</span>(request);
                } finally {
                    latch<span class="hljs-selector-class">.countDown</span>();
                }
            })<span class="hljs-selector-class">.start</span>();
        }

        try {
            latch<span class="hljs-selector-class">.await</span>();
        } catch (InterruptedException e) {
            Thread<span class="hljs-selector-class">.currentThread</span>()<span class="hljs-selector-class">.interrupt</span>();
        }
    }

    private void <span class="hljs-built_in">doTransfer</span>(TransferRequest request) {
        <span class="hljs-comment">// 这个操作不在主事务中</span>
        accountMapper<span class="hljs-selector-class">.subtractBalance</span>(request.getFrom(), request<span class="hljs-selector-class">.getAmount</span>());
        accountMapper<span class="hljs-selector-class">.addBalance</span>(request.getTo(), request<span class="hljs-selector-class">.getAmount</span>());
    }
}

<span class="hljs-comment">/**
 * ✅ 正确示例：使用编程式事务控制
 */</span>
<span class="hljs-keyword">@Service</span>
<span class="hljs-keyword">@Slf</span>4j
<span class="hljs-keyword">@RequiredArgsConstructor</span>
public class CorrectMultiThreadService {

    private final AccountMapper accountMapper;
    private final PlatformTransactionManager transactionManager;

    <span class="hljs-comment">/**
     * 批量转账（在主事务中执行）
     */</span>
    <span class="hljs-keyword">@Transactional</span>
    public void batchTransfer(List&lt;TransferRequest&gt; requests) {
        log<span class="hljs-selector-class">.info</span>("===== 批量转账（正确方式） =====");

        for (TransferRequest request : requests) {
            <span class="hljs-comment">// 在主线程中执行，事务生效</span>
            <span class="hljs-built_in">doTransfer</span>(request);
        }
    }

    <span class="hljs-comment">/**
     * 如果需要并发执行，使用编程式事务
     */</span>
    public void <span class="hljs-built_in">parallelTransferWithTransaction</span>(List&lt;TransferRequest&gt; requests) {
        log<span class="hljs-selector-class">.info</span>("===== 并发转账（编程式事务） =====");

        <span class="hljs-comment">// 定义事务属性</span>
        DefaultTransactionDefinition def = new <span class="hljs-built_in">DefaultTransactionDefinition</span>();
        def<span class="hljs-selector-class">.setName</span>("transfer-transaction");
        def<span class="hljs-selector-class">.setPropagationBehavior</span>(TransactionDefinition.PROPAGATION_REQUIRED);

        requests<span class="hljs-selector-class">.parallelStream</span>()<span class="hljs-selector-class">.forEach</span>(request -&gt; {
            // 每个线程独立事务
            TransactionStatus status = transactionManager.getTransaction(def);
            try {
                <span class="hljs-built_in">doTransfer</span>(request);
                transactionManager<span class="hljs-selector-class">.commit</span>(status);
            } catch (Exception e) {
                transactionManager<span class="hljs-selector-class">.rollback</span>(status);
                log<span class="hljs-selector-class">.error</span>("转账失败: {}", request.getFrom(), e);
            }
        });
    }
}
</code></pre>
<h3 data-id="heading-15">5.3 异常被吞掉</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">/**
 * ❌ 错误示例：异常被捕获不抛出
 */</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WrongExceptionHandleService</span> {

    <span class="hljs-keyword">private</span> final <span class="hljs-title class_">AccountMapper</span> accountMapper;

    <span class="hljs-comment">/**
     * 转账（异常被吞掉，事务提交）
     */</span>
    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">transfer</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> <span class="hljs-keyword">from</span>, <span class="hljs-built_in">String</span> to, Long amount</span>) {
        log.<span class="hljs-title function_">info</span>(<span class="hljs-string">"===== 转账开始 ====="</span>);

        <span class="hljs-keyword">try</span> {
            accountMapper.<span class="hljs-title function_">subtractBalance</span>(<span class="hljs-keyword">from</span>, amount);
            accountMapper.<span class="hljs-title function_">addBalance</span>(to, amount);

            <span class="hljs-comment">// 模拟异常</span>
            <span class="hljs-keyword">if</span> (amount &gt; <span class="hljs-number">10000</span>) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"金额超限"</span>);
            }

            log.<span class="hljs-title function_">info</span>(<span class="hljs-string">"转账成功"</span>);

        } <span class="hljs-keyword">catch</span> (<span class="hljs-title class_">RuntimeException</span> e) {
            log.<span class="hljs-title function_">error</span>(<span class="hljs-string">"捕获异常: {}"</span>, e.<span class="hljs-title function_">getMessage</span>());
            <span class="hljs-comment">// ❌ 不抛出异常，事务提交</span>
        }

        log.<span class="hljs-title function_">info</span>(<span class="hljs-string">"===== 转束结束（事务已提交） ====="</span>);
    }
}

<span class="hljs-comment">/**
 * ✅ 正确示例：异常需要重新抛出
 */</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CorrectExceptionHandleService</span> {

    <span class="hljs-keyword">private</span> final <span class="hljs-title class_">AccountMapper</span> accountMapper;

    <span class="hljs-comment">/**
     * 转账（异常正确处理）
     */</span>
    <span class="hljs-meta">@Transactional</span>(rollbackFor = <span class="hljs-title class_">Exception</span>.<span class="hljs-property">class</span>)
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">transfer</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> <span class="hljs-keyword">from</span>, <span class="hljs-built_in">String</span> to, Long amount</span>) {
        log.<span class="hljs-title function_">info</span>(<span class="hljs-string">"===== 转账开始 ====="</span>);

        <span class="hljs-keyword">try</span> {
            accountMapper.<span class="hljs-title function_">subtractBalance</span>(<span class="hljs-keyword">from</span>, amount);
            accountMapper.<span class="hljs-title function_">addBalance</span>(to, amount);

            <span class="hljs-comment">// 业务校验</span>
            <span class="hljs-keyword">if</span> (amount &gt; <span class="hljs-number">10000</span>) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BusinessException</span>(<span class="hljs-string">"单笔转账金额不能超过10000"</span>);
            }

            log.<span class="hljs-title function_">info</span>(<span class="hljs-string">"转账成功"</span>);

        } <span class="hljs-keyword">catch</span> (<span class="hljs-title class_">BusinessException</span> e) {
            <span class="hljs-comment">// 业务异常需要记录但可能不回滚（根据配置）</span>
            log.<span class="hljs-title function_">error</span>(<span class="hljs-string">"业务异常: {}"</span>, e.<span class="hljs-title function_">getMessage</span>());
            <span class="hljs-keyword">throw</span> e;  <span class="hljs-comment">// ✅ 重新抛出</span>

        } <span class="hljs-keyword">catch</span> (<span class="hljs-title class_">Exception</span> e) {
            <span class="hljs-comment">// 系统异常需要回滚</span>
            log.<span class="hljs-title function_">error</span>(<span class="hljs-string">"系统异常: {}"</span>, e.<span class="hljs-title function_">getMessage</span>());
            <span class="hljs-keyword">throw</span> e;  <span class="hljs-comment">// ✅ 重新抛出</span>
        }
    }
}
</code></pre>
<h2 data-id="heading-16">六、最佳实践总结</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/47af5adc56114ed4a3d5d8250cc8d478~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769351357&amp;x-signature=jJkKaEnW2a7UwMAjyAI5KVYC1kY%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-17">6.1 完整的转账Service（最佳实践）</h3>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">/**
 * 转账Service - 最佳实践示例
 *
 * 特点：
 * 1. 明确指定回滚规则
 * 2. 合理使用传播行为
 * 3. 事务尽可能短
 * 4. 完善的异常处理
 * 5. 详细的日志记录
 */</span>
<span class="hljs-keyword">@Service</span>
<span class="hljs-keyword">@Slf</span>4j
<span class="hljs-keyword">@RequiredArgsConstructor</span>
public class TransferServiceBestPractice {

    private final AccountMapper accountMapper;
    private final TransferLogMapper transferLogMapper;
    private final NotificationService notificationService;

    <span class="hljs-comment">/**
     * 转账方法 - 主业务流程
     *
     * 事务配置：
     * - propagation: REQUIRED（默认，加入现有事务）
     * - isolation: REPEATABLE_READ（MySQL默认，防止不可重复读）
     * - timeout: 30（30秒超时）
     * - rollbackFor: Exception.class（明确回滚规则）
     * - readOnly: false（写操作）
     */</span>
    <span class="hljs-keyword">@Transactional</span>(
        propagation = Propagation.REQUIRED,
        isolation = Isolation.REPEATABLE_READ,
        timeout = <span class="hljs-number">30</span>,
        rollbackFor = Exception.class
    )
    public TransferResult transfer(TransferRequest request) {
        log<span class="hljs-selector-class">.info</span>("===== 转账开始 =====");
        log<span class="hljs-selector-class">.info</span>("转出账户: {}, 转入账户: {}, 金额: {}",
            request.getFromAccount(), request<span class="hljs-selector-class">.getToAccount</span>(), request<span class="hljs-selector-class">.getAmount</span>());

        <span class="hljs-comment">// 1. 参数校验（事务外）</span>
        <span class="hljs-built_in">validateTransferRequest</span>(request);

        <span class="hljs-comment">// 2. 查询并锁定账户（FOR UPDATE）</span>
        Account fromAccount = <span class="hljs-built_in">lockAccount</span>(request.getFromAccount());
        Account toAccount = <span class="hljs-built_in">lockAccount</span>(request.getToAccount());

        <span class="hljs-comment">// 3. 校验余额</span>
        if (fromAccount.getBalance()<span class="hljs-selector-class">.compareTo</span>(request.getAmount()) &lt; <span class="hljs-number">0</span>) {
            throw new <span class="hljs-built_in">BusinessException</span>("余额不足");
        }

        <span class="hljs-comment">// 4. 执行转账</span>
        <span class="hljs-built_in">doTransfer</span>(fromAccount, toAccount, request.getAmount());

        <span class="hljs-comment">// 5. 记录转账日志</span>
        TransferLog log = <span class="hljs-built_in">buildTransferLog</span>(request, "SUCCESS");
        transferLogMapper<span class="hljs-selector-class">.insert</span>(log);

        <span class="hljs-comment">// 6. 发送通知（独立事务，失败不影响转账）</span>
        try {
            notificationService<span class="hljs-selector-class">.sendNotificationAsync</span>(
                "TRANSFER_SUCCESS",
                String.format("转账成功: %s -&gt; %s, 金额: %s",
                    request.getFromAccount(),
                    request<span class="hljs-selector-class">.getToAccount</span>(),
                    request<span class="hljs-selector-class">.getAmount</span>())
            );
        } catch (Exception e) {
            log<span class="hljs-selector-class">.error</span>("通知发送失败，但不影响转账", e);
        }

        log<span class="hljs-selector-class">.info</span>("===== 转账成功 =====");

        return TransferResult<span class="hljs-selector-class">.success</span>(log.getId());
    }

    <span class="hljs-comment">/**
     * 参数校验（事务外执行）
     */</span>
    private void <span class="hljs-built_in">validateTransferRequest</span>(TransferRequest request) {
        if (StringUtils.isEmpty(request.getFromAccount())) {
            throw new <span class="hljs-built_in">IllegalArgumentException</span>("转出账户不能为空");
        }
        if (StringUtils.isEmpty(request.getToAccount())) {
            throw new <span class="hljs-built_in">IllegalArgumentException</span>("转入账户不能为空");
        }
        if (request.getAmount() == null || request<span class="hljs-selector-class">.getAmount</span>()<span class="hljs-selector-class">.compareTo</span>(BigDecimal.ZERO) &lt;= <span class="hljs-number">0</span>) {
            throw new <span class="hljs-built_in">IllegalArgumentException</span>("转账金额必须大于<span class="hljs-number">0</span>");
        }
        if (request.getFromAccount()<span class="hljs-selector-class">.equals</span>(request.getToAccount())) {
            throw new <span class="hljs-built_in">IllegalArgumentException</span>("转入转出账户不能相同");
        }
    }

    <span class="hljs-comment">/**
     * 查询并锁定账户
     * 使用悲观锁确保并发安全
     */</span>
    private Account <span class="hljs-built_in">lockAccount</span>(String accountNo) {
        Account account = accountMapper<span class="hljs-selector-class">.selectByAccountNoForUpdate</span>(accountNo);
        if (account == null) {
            throw new <span class="hljs-built_in">BusinessException</span>("账户不存在: " + accountNo);
        }
        if (account.isFrozen()) {
            throw new <span class="hljs-built_in">BusinessException</span>("账户已冻结: " + accountNo);
        }
        return account;
    }

    <span class="hljs-comment">/**
     * 执行转账
     */</span>
    private void <span class="hljs-built_in">doTransfer</span>(Account from, Account to, BigDecimal amount) {
        from<span class="hljs-selector-class">.setBalance</span>(from.getBalance()<span class="hljs-selector-class">.subtract</span>(amount));
        to<span class="hljs-selector-class">.setBalance</span>(to.getBalance()<span class="hljs-selector-class">.add</span>(amount));

        int rows1 = accountMapper<span class="hljs-selector-class">.updateById</span>(from);
        int rows2 = accountMapper<span class="hljs-selector-class">.updateById</span>(to);

        if (rows1 == <span class="hljs-number">0</span> || rows2 == <span class="hljs-number">0</span>) {
            throw new <span class="hljs-built_in">BusinessException</span>("账户更新失败");
        }
    }

    <span class="hljs-comment">/**
     * 构建转账日志
     */</span>
    private TransferLog <span class="hljs-built_in">buildTransferLog</span>(TransferRequest request, String status) {
        TransferLog log = new <span class="hljs-built_in">TransferLog</span>();
        log<span class="hljs-selector-class">.setFromAccount</span>(request.getFromAccount());
        log<span class="hljs-selector-class">.setToAccount</span>(request.getToAccount());
        log<span class="hljs-selector-class">.setAmount</span>(request.getAmount());
        log<span class="hljs-selector-class">.setStatus</span>(status);
        log<span class="hljs-selector-class">.setTransferTime</span>(LocalDateTime.now());
        log<span class="hljs-selector-class">.setRequestIp</span>(RequestContextHolder.getRequestAttributes()
            <span class="hljs-selector-class">.getRemoteAddr</span>());
        return log;
    }
}

<span class="hljs-comment">/**
 * 通知Service - 使用REQUIRES_NEW
 */</span>
<span class="hljs-keyword">@Service</span>
<span class="hljs-keyword">@Slf</span>4j
<span class="hljs-keyword">@RequiredArgsConstructor</span>
public class NotificationService {

    private final NotificationMapper notificationMapper;
    private final EmailService emailService;

    <span class="hljs-comment">/**
     * 异步发送通知（新事务）
     */</span>
    <span class="hljs-keyword">@Transactional</span>(
        propagation = Propagation.REQUIRES_NEW,
        rollbackFor = Exception.class,
        timeout = <span class="hljs-number">5</span>
    )
    public void sendNotificationAsync(String type, String message) {
        log<span class="hljs-selector-class">.info</span>("发送通知: {} - {}", type, message);

        <span class="hljs-comment">// 保存通知记录</span>
        Notification notification = new <span class="hljs-built_in">Notification</span>();
        notification<span class="hljs-selector-class">.setType</span>(type);
        notification<span class="hljs-selector-class">.setMessage</span>(message);
        notification<span class="hljs-selector-class">.setStatus</span>("PENDING");
        notification<span class="hljs-selector-class">.setCreateTime</span>(LocalDateTime.now());
        notificationMapper<span class="hljs-selector-class">.insert</span>(notification);

        <span class="hljs-comment">// 发送邮件（可能失败）</span>
        try {
            emailService<span class="hljs-selector-class">.sendEmail</span>(message);
            notification<span class="hljs-selector-class">.setStatus</span>("SENT");
            notificationMapper<span class="hljs-selector-class">.updateById</span>(notification);
        } catch (Exception e) {
            log<span class="hljs-selector-class">.error</span>("邮件发送失败", e);
            notification<span class="hljs-selector-class">.setStatus</span>("FAILED");
            notificationMapper<span class="hljs-selector-class">.updateById</span>(notification);
            <span class="hljs-comment">// 不抛出异常，记录失败即可</span>
        }
    }
}
</code></pre>
<h3 data-id="heading-18">6.2 只读事务优化</h3>
<pre><code class="hljs language-ini" lang="ini">@Service
@Slf4j
public class AccountQueryService {

    private final AccountMapper accountMapper<span class="hljs-comment">;</span>
    private final AccountReportMapper accountReportMapper<span class="hljs-comment">;</span>

    /**
     * 查询账户详情 - 只读事务
     *
     * 只读事务优化：
     * 1. 不检查修改状态
     * 2. 不获取写锁
     * 3. 可以使用只读副本
     */
    @Transactional(
        <span class="hljs-attr">readOnly</span> = <span class="hljs-literal">true</span>,
        <span class="hljs-attr">isolation</span> = Isolation.READ_COMMITTED,
        <span class="hljs-attr">timeout</span> = <span class="hljs-number">10</span>
    )
    public AccountVO getAccountDetail(Long accountId) {
        log.info("查询账户详情: {}", accountId)<span class="hljs-comment">;</span>

        Account <span class="hljs-attr">account</span> = accountMapper.selectById(accountId)<span class="hljs-comment">;</span>
        if (<span class="hljs-attr">account</span> == null) {
            throw new BusinessException("账户不存在")<span class="hljs-comment">;</span>
        }

        // 转换为VO
        return AccountVO.fromEntity(account)<span class="hljs-comment">;</span>
    }

    /**
     * 批量查询 - 只读事务
     */
    @Transactional(
        <span class="hljs-attr">readOnly</span> = <span class="hljs-literal">true</span>,
        <span class="hljs-attr">isolation</span> = Isolation.READ_COMMITTED
    )
    public List&lt;AccountVO&gt; listAccounts(AccountQuery query) {
        log.info("批量查询账户")<span class="hljs-comment">;</span>

        LambdaQueryWrapper&lt;Account&gt; <span class="hljs-attr">wrapper</span> = new LambdaQueryWrapper&lt;&gt;()<span class="hljs-comment">;</span>
        if (StringUtils.hasText(query.getKeyword())) {
            wrapper.like(Account::getAccountNo, query.getKeyword())<span class="hljs-comment">;</span>
        }
        if (query.getMinBalance() != null) {
            wrapper.ge(Account::getBalance, query.getMinBalance())<span class="hljs-comment">;</span>
        }

        List&lt;Account&gt; <span class="hljs-attr">accounts</span> = accountMapper.selectList(wrapper)<span class="hljs-comment">;</span>
        return accounts.stream()
            .map(AccountVO::fromEntity)
            .collect(Collectors.toList())<span class="hljs-comment">;</span>
    }

  
</code></pre>
<h2 data-id="heading-19">七、总结</h2>
<p>Spring事务管理是一个强大但也容易出错的特性。</p>
<p><strong>记住</strong>：正确使用事务是保证数据一致性的关键，但也要注意性能影响。在实际开发中，要根据业务场景选择合适的事务配置。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[《实时渲染》第1章-绪论-1.1内容概览]]></title>    <link>https://juejin.cn/post/7596187471773433865</link>    <guid>https://juejin.cn/post/7596187471773433865</guid>    <pubDate>2026-01-18T13:09:40.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7596187471773433865" data-draft-id="7596166721628373038" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="《实时渲染》第1章-绪论-1.1内容概览"/> <meta itemprop="keywords" content="计算机图形学,图形学"/> <meta itemprop="datePublished" content="2026-01-18T13:09:40.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="charlee44"/> <meta itemprop="url" content="https://juejin.cn/user/1117549770846872"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            《实时渲染》第1章-绪论-1.1内容概览
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1117549770846872/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    charlee44
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-18T13:09:40.000Z" title="Sun Jan 18 2026 13:09:40 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">实时渲染</h2>
<h3 data-id="heading-1">1. 概述</h3>
<p>实时渲染是指在计算机上快速渲染图像。它是计算机图形中交互性最高的领域。图像出现在屏幕上，观看者做出动作或反应，这种反馈会影响接下来生成的内容。这种反应和渲染的循环以足够快的速度发生，以至于观看者不会看到单个图像，而是沉浸在一个动态的过程中。</p>
<p>图像的显示速率以每秒帧数 (FPS) 或赫兹 (Hz) 为单位。FPS为1时，几乎没有交互感；用户痛苦地意识到每个新图像的到来。在大约6FPS 时，交互感开始增强。视频游戏的目标是30、60、72或更高的FPS；只有到达如上的速度，用户才好专注于行动和反应。</p>
<p>电影放映机以24FPS的速度显示帧，但使用快门系统将每帧显示两到四次以避免闪烁。此刷新率与显示率分开，以赫兹 (Hz)表示。照亮框架三次的快门具有72Hz的刷新率。LCD显示器也会将刷新率与显示率分开。</p>
<p>以24FPS的速度观看屏幕上显示的图像可能是可以接受的，但更高的速率对于最大限度地缩短响应时间很重要。仅15毫秒的时间延迟就会减慢并干扰交互[1849]。例如，用于虚拟现实的头戴式显示器通常需要90FPS以最大限度地减少延迟。</p>
<p>实时渲染不仅仅是交互性。如果速度是唯一的标准，那么任何快速响应用户命令并在屏幕上绘制任何内容的应用程序都符合条件。实时渲染通常意味着生成3D图像。</p>
<p>交互性和对三维空间的某种连接感是实时渲染的充分条件，但第三个元素已成为其定义的一部分：图形加速硬件。许多人认为1996年推出的3Dfx Voodoo 1卡是消费级3D图形的真正开始 [408]。随着这个市场的飞速发展，现在每台计算机、平板电脑和手机都内置了图形处理器。图 1.1 和 1.2 显示了一些通过硬件加速实现实时渲染结果的优秀示例。</p>
<p><img src="https://p0-xtjj-private.juejin.cn/tos-cn-i-73owjymdk6/629ca783f6964acda8144517c19ced47~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY2hhcmxlZTQ0:q75.awebp?policy=eyJ2bSI6MywidWlkIjoiMTExNzU0OTc3MDg0Njg3MiJ9&amp;rk3s=e9ecf3d6&amp;x-orig-authkey=f32326d3454f2ac7e96d3d06cdbb035152127018&amp;x-orig-expires=1768828066&amp;x-orig-sign=%2FPOtLrFhboYwqOQIwat%2BplUjn0s%3D" alt="图1.1 Forza Motorsport 7 的镜头（图片由 Turn 10 Studios 提供，Microsoft）" loading="lazy"/></p>
<p><img src="https://p0-xtjj-private.juejin.cn/tos-cn-i-73owjymdk6/8e4c4a82fb2a4b1a8b66dd2fc55771fe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY2hhcmxlZTQ0:q75.awebp?policy=eyJ2bSI6MywidWlkIjoiMTExNzU0OTc3MDg0Njg3MiJ9&amp;rk3s=e9ecf3d6&amp;x-orig-authkey=f32326d3454f2ac7e96d3d06cdbb035152127018&amp;x-orig-expires=1768828067&amp;x-orig-sign=8vTPsBKQKak1R90K6yENyJXJ45s%3D" alt="图1.2 巫师3中呈现的Beauclair城市" loading="lazy"/></p>
<p>图形硬件的进步推动了交互式计算机图形领域研究的爆炸式增长。我们将专注于提供提高速度和改善图像质量的方法，同时描述加速算法和图形API的特性和局限性。我们无法深入涵盖每个主题，因此我们的目标是展示关键概念和术语，解释该领域最强大和实用的算法，并提供指向获取更多信息的最佳位置的地址。我们希望我们为您提供理解该领域的工具的尝试被证明是值得您在本书上花费的时间和精力。</p>
<h3 data-id="heading-2">1.1 内容概览</h3>
<p>以下是对本书章节的简要概述。</p>
<p>第2章，图形渲染管线。实时渲染的核心是获取场景的描述，并将其转换为我们可以看到的内容的一系列步骤。</p>
<p>第3章，图形处理单元。现代GPU使用固定功能和可编程单元的组合来实现渲染管线的各个阶段。</p>
<p>第4章，图形变换。图形变换是操纵对象的位置、方向、大小和形状以及相机的位置和视图的基本工具。</p>
<p>第5章，着色基础。首先讨论了材质和灯光的定义，及其在表面外观（无论是逼真的还是风格化的）的实现中的使用。介绍了其他与外观相关的主题，例如通过使用抗锯齿、透明度和伽马校正提供更高的图像质量。</p>
<p>第6章，纹理。实时渲染最强大的工具之一是能够在表面上快速访问和显示图像。此过程称为纹理化，并且有多种应用方法。</p>
<p>第7章，阴影。为场景添加阴影可以增加真实感和理解力。介绍了用于快速计算阴影的更流行的算法。</p>
<p>第8章，光照与颜色。在我们执行基于物理的渲染之前，我们首先需要了解如何量化光线和颜色。在我们的物理渲染过程完成后，我们需要将结果数量转换为显示值，考虑屏幕和观看环境的属性。本章涵盖了这两个主题。</p>
<p>第9章，基于物理的着色。我们从头开始了解基于物理的着色模型。本章从潜在的物理现象开始，涵盖各种渲染材质的模型，并以将材质混合在一起并对其进行过滤以避免混叠和保持表面外观的方法结束。</p>
<p>第10章，局部照明。探索了描绘更精细光源的算法。表面着色考虑到光是由具有特征形状的物理对象发出的。</p>
<p>第11章，全局光照。模拟光与场景之间多次交互的算法进一步增加了图像的真实感。我们讨论了环境和方向遮挡以及在漫反射和镜面反射表面上渲染全局照明效果的方法，以及一些有希望的统一方法。</p>
<p>第12章，图像空间效果。图形硬件擅长以快速的速度执行图像处理。首先讨论图像滤波和重投影技术，然后我们调查了几种流行的后期处理效果：镜头光晕、运动模糊和景深。</p>
<p>第13章，超越多边形。三角形并不总是描述物体的最快或最现实的方式。基于使用图像、点云、体素和其他样本集的替代表示各有其优点。</p>
<p>第14章，体积和半透明渲染。这里的重点是体积材料表示及其与光源的相互作用的理论和实践。大到大气效应，小到头发纤维内的光散射，都是该仿真的现象范围。</p>
<p>第15章，非真实感渲染。尝试使场景看起来逼真只是渲染场景的一种方式。其他风格，例如卡通阴影和水彩效果，也是值得被讨论的。还讨论了行和文本生成技术。</p>
<p>第16章，多边形技术。几何数据来自广泛的来源，有时需要修改才能快速良好地呈现。介绍了多边形数据表示和压缩的许多方面。</p>
<p>第17章，曲线和曲面。更复杂的表面表示提供了一些优势，例如能够在质量和渲染速度之间进行权衡、更紧凑的表示和平滑的表面生成。</p>
<p>第18章，管线优化。一旦应用程序运行并使用高效算法，就可以使用各种优化技术使其更快。找到瓶颈并决定如何解决它是这里的主题。还讨论了多进程处理。</p>
<p>第19章，加速算法。更快的让渲染完成。涵盖了各种形式的剔除和细节渲染级别。</p>
<p>第20章，高效着色。场景中的大量灯光会显着降低性能。在知道表面片元可见之前，进行完全着色，是浪费性能的另一个来源。我们探索了多种方法来解决这些和其他形式的着色效率低下问题。</p>
<p>第21章，虚拟现实和增强现实。这些领域具有以快速和一致的速度有效地生成逼真图像的特殊挑战和技术。</p>
<p>第22章，交叉测试方法。相交测试对于渲染、用户交互和碰撞检测很重要。此处提供了针对常见几何相交测试的各种最有效算法的深入介绍。</p>
<p>第23章，图形硬件。这里的重点是颜色深度、帧缓冲区和基本架构类型等组件。提供了代表性GPU的案例研究。</p>
<p>第24章，展望未来的一些图形技术。</p>
<p>由于篇幅限制，我们在realtimerendering.com上制作了一个关于碰撞检测的免费章节，以及关于线性代数和三角学的附录。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[每周AI论文速递（260112-260116）]]></title>    <link>https://juejin.cn/post/7596166721628422190</link>    <guid>https://juejin.cn/post/7596166721628422190</guid>    <pubDate>2026-01-18T13:30:07.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7596166721628422190" data-draft-id="7595895132261630003" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="每周AI论文速递（260112-260116）"/> <meta itemprop="keywords" content="人工智能"/> <meta itemprop="datePublished" content="2026-01-18T13:30:07.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="叶子的技术碎碎念"/> <meta itemprop="url" content="https://juejin.cn/user/2831954919569245"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            每周AI论文速递（260112-260116）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2831954919569245/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    叶子的技术碎碎念
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-18T13:30:07.000Z" title="Sun Jan 18 2026 13:30:07 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读31分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Watching, Reasoning, and Searching: A Video Deep Research Benchmark on Open Web for Agentic Video Reasoning</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2601.06943" target="_blank" title="https://arxiv.org/abs/2601.06943" ref="nofollow noopener noreferrer">观看、推理与搜索：面向智能体视频推理的开放网络视频深度研究基准</a></p>
<p>在现实世界的视频问答场景中，视频本身通常仅提供局部视觉线索，而可验证的答案广泛分布于开放网络。因此，模型需要协同完成跨帧线索提取、迭代式检索以及基于多跳推理的验证。为弥补这一差距，我们构建了首个视频深度研究基准 VideoDR。VideoDR 的核心是视频条件化的开放域视频问答，要求模型执行跨帧视觉锚点提取、交互式网络检索，并对视频与网络联合证据进行多跳推理。通过严格的人工标注与质量控制，我们构建了涵盖六个语义领域的高质量视频深度研究样本集。我们评估了在流程式 (Workflow) 与智能体式 (Agentic) 两种范式下的多个闭源及开源多模态大语言模型。结果表明，智能体式 (Agentic) 范式并非总是优于流程式 (Workflow) 范式：其性能提升取决于模型在长链检索过程中维持初始视频锚点的能力。进一步分析指出，目标漂移 (goal drift) 和长程一致性 (long-horizon consistency) 是核心瓶颈。总之，VideoDR 为研究开放网络环境下的视频智能体提供了一个系统性基准，并揭示了下一代视频深度研究智能体所面临的关键挑战。</p>
<h2 data-id="heading-1">BabyVision: Visual Reasoning Beyond Language</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2601.06521" target="_blank" title="https://arxiv.org/abs/2601.06521" ref="nofollow noopener noreferrer">BabyVision: 超越语言的视觉推理</a></p>
<p>人类在掌握语言能力之前很久便已发展出核心视觉技能，然而，当代的多模态大语言模型 (Multimodal LLMs, MLLMs) 仍严重依赖语言先验来弥补其薄弱的视觉理解能力。我们发现了一个关键事实：最先进的多模态大语言模型在人类（即使是3岁儿童）都能轻松解决的基本视觉任务上持续表现不佳。为了系统地探究这一差距，我们提出了 BabyVision 基准，旨在评估多模态大语言模型独立于语言知识的核心视觉能力。BabyVision 涵盖广泛的任务，包含388个测试项，划分为四个关键类别下的22个子类。实证结果与人工评估表明，领先的多模态大语言模型性能显著低于人类基线。Gemini3-Pro-Preview 的得分为49.7，落后于6岁儿童的表现，且远低于成人平均分94.1。这些结果表明，尽管当前的多模态大语言模型在知识密集型评估中表现出色，但它们仍然缺乏基本的视觉原语。BabyVision 的进展是迈向人类水平视觉感知与推理能力的一步。我们还通过提出 BabyVision-Gen 和自动评估工具包，探索了利用生成模型解决视觉推理问题。我们的代码和基准数据已在 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FUniPat-AI%2FBabyVision" target="_blank" title="https://github.com/UniPat-AI/BabyVision" ref="nofollow noopener noreferrer">github.com/UniPat-AI/B…</a> 发布，以供复现。</p>
<h2 data-id="heading-2">Thinking with Map: Reinforced Parallel Map-Augmented Agent for Geolocalization</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2601.05432" target="_blank" title="https://arxiv.org/abs/2601.05432" ref="nofollow noopener noreferrer">基于地图思考：用于地理定位的强化并行地图增强智能体</a></p>
<p>图像地理定位任务旨在利用视觉线索，预测图像在地球上的拍摄位置。现有的大型视觉语言模型 (LVLM) 方法利用了世界知识、思维链 (Chain-of-Thought) 推理和智能体 (Agent) 能力，但忽略了人类常用的一种策略——使用地图。在本工作中，我们首先赋予模型 <em>基于地图思考</em> 的能力，并将其形式化为一个地图中的智能体循环。我们为此开发了一个两阶段优化方案：首先是智能体强化学习 (RL)，随后是并行测试时缩放 (TTS)。RL 阶段旨在增强模型的智能体能力，以提高其采样效率；而并行 TTS 阶段则允许模型在做出最终预测前并行探索多条候选路径，这对地理定位任务至关重要。为了在最新且真实（非合成）的图像上评估我们的方法，我们进一步提出了 MAPBench，这是一个完全基于真实世界图像的综合性地理定位训练与评估基准。实验结果表明，我们的方法在大多数指标上优于现有的开源和闭源模型。具体而言，与启用 Google 搜索/地图定位模式的 <em>Gemini-3-Pro</em> 相比，我们的方法将 Acc@500m 指标从 8.0% 显著提升至 22.1%。</p>
<h2 data-id="heading-3">STEP3-VL-10B Technical Report</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2601.09668" target="_blank" title="https://arxiv.org/abs/2601.09668" ref="nofollow noopener noreferrer">STEP3-VL-10B 技术报告</a></p>
<p>我们推出 STEP3-VL-10B，这是一个轻量级开源基础模型，旨在重新权衡紧凑效率与前沿多模态智能能力。STEP3-VL-10B 通过两项战略转变实现：首先，在 1.2T 多模态 Token 上采用统一且全部参数可训练的预训练策略，将语言对齐的感知编码器与 Qwen3-8B 解码器集成，以建立内在的视觉-语言协同；其次，采用一个大规模后训练流程，包含超过 1000 次强化学习迭代。关键在于，我们实施了并行协调推理 (PaCoRe) 来扩展测试时的计算规模，将资源分配给可扩展的感知推理，以探索并整合多样化的视觉假设。因此，尽管其模型规模紧凑，仅为 10B 参数，STEP3-VL-10B 的性能却媲美甚至超越了规模大 10 到 20 倍的模型（例如 GLM-4.6V-106B、Qwen3-VL-235B）以及顶级的闭源旗舰模型，如 Gemini 2.5 Pro 和 Seed-1.5-VL。它实现了同类最佳的绩效，在 MMBench 上取得 92.2% 的得分，在 MMMU 上取得 80.11% 的得分；同时在复杂推理任务中表现卓越，在 AIME2025 上达到 94.43%，在 MathVision 上达到 75.95%。我们发布了完整的模型套件，旨在为社区提供一个强大、高效且可复现的基准。</p>
<h2 data-id="heading-4">Urban Socio-Semantic Segmentation with Vision-Language Reasoning</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2601.10477" target="_blank" title="https://arxiv.org/abs/2601.10477" ref="nofollow noopener noreferrer">基于视觉语言推理的城市社会语义分割</a></p>
<p>城市作为人类活动的中心，其区域包含丰富的语义实体。从卫星影像中分割这些多样的实体，对众多下游应用至关重要。当前先进的分割模型能够可靠地分割由物理属性定义的实体 (例如，建筑物、水体) ，但在处理社会语义类别 (例如，学校、公园) 时仍面临挑战。本研究通过视觉语言模型 (Vision-Language Model) 的推理能力，实现了社会语义分割。为此，我们提出了一个名为 SocioSeg 的城市社会语义分割数据集，该新资源包含卫星影像、数字地图以及按层级结构组织的社会语义实体的像素级标注。此外，我们提出了一种名为 SocioReasoner 的新型视觉语言推理框架，它通过跨模态识别与多阶段推理，模拟人类识别与标注社会语义实体的过程。我们采用强化学习来优化这一不可微的流程，从而有效激发视觉语言模型固有的推理能力。实验结果表明，我们的方法相较于现有最优模型取得了性能提升，并展现出强大的零样本泛化能力。我们的数据集与代码已公开于 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FAMAP-ML%2FSocioReasoner%25E3%2580%2582" target="_blank" title="https://github.com/AMAP-ML/SocioReasoner%E3%80%82" ref="nofollow noopener noreferrer">github.com/AMAP-ML/Soc…</a></p>
<h2 data-id="heading-5">Rewarding the Rare: Uniqueness-Aware RL for Creative Problem Solving in LLMs</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2601.08763" target="_blank" title="https://arxiv.org/abs/2601.08763" ref="nofollow noopener noreferrer">奖励稀缺性：面向大语言模型创造性问题解决的独特性感知强化学习</a></p>
<p>强化学习已成为大语言模型后训练，尤其是针对复杂推理任务的核心范式。然而，该方法常面临探索崩溃问题：模型策略过早地收敛于少数几种主导的推理模式。这虽然能提升 pass@1 指标，却限制了推理路径层面的多样性，从而抑制了 pass@k 指标的进一步增益。我们认为，问题的根源在于现有方法侧重于对局部 Token 行为进行正则化，而非鼓励解决方案集合的多样性。为此，我们提出了独特性感知强化学习。该方法定义了一个推理路径层面的优化目标，明确奖励那些采用罕见高级策略的正确解决方案。具体而言，我们利用一个基于大语言模型的评判器，将针对同一问题生成的不同推理路径按其高级解决策略（忽略表面差异）进行聚类，并依据聚类规模反比地重新调整策略优势值。如此一来，正确且新颖的策略将获得比冗余策略更高的奖励。在数学、物理和医学推理等多个基准测试上的实验表明，我们的方法能够在大规模采样预算下持续提升 pass@<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span></span> 指标，并增大 pass@<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span></span> 曲线下面积，同时不损害 pass@1 性能。该方法有效维持了探索过程，并能在更大规模上发掘出更多样化的解决方案策略。</p>
<h2 data-id="heading-6">DeepResearchEval: An Automated Framework for Deep Research Task Construction and Agentic Evaluation</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2601.09688" target="_blank" title="https://arxiv.org/abs/2601.09688" ref="nofollow noopener noreferrer">DeepResearchEval：一个用于深度研究任务构建与智能体评估的自动化框架</a></p>
<p>深度研究系统已广泛应用于多步骤网络研究、分析与多源信息综合，但其评估仍面临挑战。现有基准测试往往需要大量标注来构建任务，依赖静态的评估维度，或在引文缺失时无法可靠地验证事实。为填补这些空白，我们提出了 DeepResearchEval，一个用于深度研究任务构建与智能体 (Agentic) 评估的自动化框架。在任务构建方面，我们设计了一个角色 (Persona) 驱动的流程，能够基于多样化的用户画像生成真实、复杂的研究任务，并应用一个两阶段过滤器（任务资格 (Task Qualification) 与搜索必要性 (Search Necessity)）来筛选出仅那些需要整合多源证据并进行外部检索的任务。在评估方面，我们提出了一个智能体流程，包含两个组件：一是自适应点式质量评估 (Adaptive Point-wise Quality Evaluation)，它能根据每个生成的任务动态推导出任务特定的评估维度、标准及权重；二是主动事实核查 (Active Fact-Checking)，它能通过网页搜索自主提取并验证报告中的陈述，即便在引文缺失的情况下也能进行。</p>
<h2 data-id="heading-7">Controlled Self-Evolution for Algorithmic Code Optimization</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2601.07348" target="_blank" title="https://arxiv.org/abs/2601.07348" ref="nofollow noopener noreferrer">面向算法代码优化的受控自进化</a></p>
<p>自进化方法通过迭代式的“生成-验证-精炼”循环来提升代码生成质量。然而，现有方法探索效率低下，难以在有限预算内发现复杂度更优的解决方案。这种低效源于几个瓶颈：初始化偏差会将进化过程限制在较差的解空间区域；随机操作缺乏反馈引导，不可控；且跨任务的经验未能得到充分利用。为应对这些挑战，我们提出了受控自进化 (Controlled Self-Evolution, CSE)，其包含三个核心组件。多样化规划初始化通过生成结构各异的算法策略，以实现对解空间的广泛覆盖。遗传进化则采用反馈引导机制替代随机操作，从而支持有针对性的变异与组合式交叉。分层进化记忆能够在任务间与任务内两个层面，同时捕获成功与失败的经验。在EffiBench-X基准上的实验表明，CSE在使用不同大语言模型 (LLM) 骨干时，均稳定优于所有基线方法。此外，CSE在进化早期即展现出更高的效率，并能在此后的整个进化过程中持续改进。我们的代码已公开于 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FQuantaAlpha%2FEvoControl%25E3%2580%2582" target="_blank" title="https://github.com/QuantaAlpha/EvoControl%E3%80%82" ref="nofollow noopener noreferrer">github.com/QuantaAlpha…</a></p>
<h2 data-id="heading-8">MMFormalizer: Multimodal Autoformalization in the Wild</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2601.03017" target="_blank" title="https://arxiv.org/abs/2601.03017" ref="nofollow noopener noreferrer">MMFormalizer: 真实场景下的多模态自动形式化</a></p>
<p>自动形式化 (Autoformalization) 旨在将自然语言描述的数学内容转化为形式化语句，以实现机器推理。然而，在真实物理世界的开放场景下，由于其多模态特性，自动形式化面临着根本性挑战：物理学问题常常需要从视觉元素中推断出隐藏的约束条件 (例如质量或能量)。为此，我们提出了 MMFormalizer，它通过整合来自真实世界数学和物理领域的实体进行自适应基础 (adaptive grounding)，从而将自动形式化的范畴从纯文本扩展到了多模态。MMFormalizer 通过递归基础 (recursive grounding) 和公理组合 (axiom composition)，从感知基础 (perceptually grounded) 的基元出发，递归地构建形式化命题。其自适应的递归终止机制确保每一个抽象概念都有视觉证据支撑，并基于维度或公理基础 (dimensional or axiomatic grounding)。我们在一个新构建的基准测试 PhyX-AF 上评估了 MMFormalizer。该基准包含从 MathVerse、PhyX、综合几何 (Synthetic Geometry) 和解析几何 (Analytic Geometry) 中精心挑选的 115 个样本，涵盖了多样化的多模态自动形式化任务。结果表明，GPT-5 和 Gemini-3-Pro 等前沿模型在形式化编译和语义准确性方面取得了最高分，其中 GPT-5 在物理推理任务上表现尤为出色，而几何领域仍然是挑战最大的方向。总体而言，MMFormalizer 为统一的多模态自动形式化提供了一个可扩展的框架，有效连接了感知与形式推理。据我们所知，这是首个能够处理经典力学 (基于哈密顿量推导)、相对论、量子力学和热力学的多模态自动形式化方法。更多详细信息请访问我们的项目页面：<a href="https://link.juejin.cn?target=https%3A%2F%2FMMFormalizer.github.io" target="_blank" title="https://MMFormalizer.github.io" ref="nofollow noopener noreferrer">MMFormalizer.github.io</a>。</p>
<h2 data-id="heading-9">MAXS: Meta-Adaptive Exploration with LLM Agents</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2601.09259" target="_blank" title="https://arxiv.org/abs/2601.09259" ref="nofollow noopener noreferrer">MAXS: 基于大语言模型智能体的元自适应探索</a></p>
<p>大语言模型 (LLM) 智能体通过多工具协作，具备内在的推理能力。然而，在智能体推理过程中，现有方法通常存在两个问题：(i) 由于缺乏前瞻性，导致局部短视的生成；(ii) 轨迹不稳定，即早期的微小错误可能演变为发散的推理路径。这些问题使得难以在全局有效性与计算效率之间取得平衡。为解决这两个问题，我们提出了 MAXS (Meta-Adaptive Exploration with LLM Agents，项目地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fexoskeletonzj%2FMAXS" target="_blank" title="https://github.com/exoskeletonzj/MAXS" ref="nofollow noopener noreferrer">github.com/exoskeleton…</a>) ，这是一个基于 LLM 智能体的元自适应推理框架，能够灵活集成工具执行与推理规划。MAXS 采用前瞻策略，将推理路径向前推演若干步，以估计工具使用的优势值，并结合步骤一致性方差与步骤间趋势斜率，共同筛选出稳定、一致且高价值的推理步骤。此外，我们引入了轨迹收敛机制，一旦路径一致性达成，便停止进一步推演，从而控制计算成本，实现在多工具推理中平衡资源效率与全局有效性。我们在三个基础模型 (MiMo-VL-7B、Qwen2.5-VL-7B、Qwen2.5-VL-32B) 和五个数据集上进行了大量实验，结果表明 MAXS 在性能与推理效率上均持续优于现有方法。进一步的分析证实了我们前瞻策略与工具使用机制的有效性。</p>
<h2 data-id="heading-10">A^3-Bench: Benchmarking Memory-Driven Scientific Reasoning via Anchor and Attractor Activation</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2601.09274" target="_blank" title="https://arxiv.org/abs/2601.09274" ref="nofollow noopener noreferrer">A^3-Bench：基于锚点与吸引子激活的记忆驱动科学推理基准</a></p>
<p>科学推理不仅依赖于逻辑推断，也需要激活先验知识与经验结构。记忆能够有效复用知识，提升推理的一致性与稳定性。然而，现有基准主要评估最终答案或逐步推理的连贯性，忽略了人类推理所依赖的 <em>记忆驱动</em> 机制，该机制通过激活锚点 (Anchor) 和吸引子 (Attractor)，并将其整合到多步推理中来实现。为填补这一空白，我们提出了 A³-Bench (<a href="https://link.juejin.cn?target=https%3A%2F%2Fa3-bench.github.io)%25EF%25BC%258C%25E8%25BF%2599%25E6%2598%25AF%25E4%25B8%2580%25E4%25B8%25AA%25E5%259F%25BA%25E4%25BA%258E%25E9%2594%259A%25E7%2582%25B9%25E4%25B8%258E%25E5%2590%25B8%25E5%25BC%2595%25E5%25AD%2590%25E6%25BF%2580%25E6%25B4%25BB" target="_blank" title="https://a3-bench.github.io)%EF%BC%8C%E8%BF%99%E6%98%AF%E4%B8%80%E4%B8%AA%E5%9F%BA%E4%BA%8E%E9%94%9A%E7%82%B9%E4%B8%8E%E5%90%B8%E5%BC%95%E5%AD%90%E6%BF%80%E6%B4%BB" ref="nofollow noopener noreferrer">a3-bench.github.io)，这是一个基于锚点与吸引子激活</a> (Anchor and Attractor Activation) 理论、旨在通过双尺度记忆驱动激活来评估科学推理的基准。</p>
<p>首先，我们采用 SAPM 流程 (即主题、锚点与吸引子、问题及记忆形成) 对跨领域的 2,198 个科学推理问题进行了标注。其次，我们引入了一个利用锚点和吸引子的双尺度记忆评估框架，并提出了 AAUI (锚点-吸引子利用指数) 指标以量化记忆激活率。最后，通过对多种基础模型及推理范式的实验，我们验证了 A³-Bench 的有效性，分析了记忆激活如何影响推理性能，从而深入理解了记忆驱动的科学推理机制。</p>
<h2 data-id="heading-11">PaCoRe: Learning to Scale Test-Time Compute with Parallel Coordinated Reasoning</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2601.05593" target="_blank" title="https://arxiv.org/abs/2601.05593" ref="nofollow noopener noreferrer">PaCoRe: 学习通过并行协调推理扩展测试时计算量</a></p>
<p>我们提出了并行协调推理 (PaCoRe)，这是一个旨在克服当代语言模型核心局限性的训练与推理框架：即模型无法在固定上下文窗口下，将测试时计算量 (Test-Time Compute, TTC) 扩展到远超顺序推理的程度。PaCoRe 摒弃了传统的顺序范式，转而通过多轮消息传递架构协调的大规模并行探索来驱动 TTC。在每一轮中，系统启动多个并行推理轨迹，将其发现压缩成受上下文长度限制的消息，然后综合这些消息来指导下一轮推理，并最终生成答案。通过大规模、基于结果的强化学习进行端到端训练，模型掌握了 PaCoRe 所需的信息综合能力，能够将有效 TTC 扩展到数百万 token 的规模，同时不突破上下文长度限制。该方法在多个不同领域都带来了显著提升，尤其在数学推理方面超越了前沿系统：一个 80 亿参数的模型在 HMMT 2025 数据集上达到了 94.5% 的准确率，通过将有效 TTC 扩展至约两百万 token，超越了 GPT-5 的 93.2%。我们开源了模型检查点、训练数据以及完整的推理流水线，以促进后续研究。</p>
<h2 data-id="heading-12">MemGovern: Enhancing Code Agents through Learning from Governed Human Experiences</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2601.06789" target="_blank" title="https://arxiv.org/abs/2601.06789" ref="nofollow noopener noreferrer">MemGovern: 通过从经过治理的人类经验中学习增强代码智能体</a></p>
<p>尽管自主软件工程 (SWE) 智能体正在重塑编程范式，但它们目前存在一个“封闭世界”的局限：它们试图从零开始或仅依赖本地上下文来修复缺陷，而忽略了 GitHub 等平台上可用的海量历史人类经验。然而，现实世界中的问题跟踪数据往往是非结构化和碎片化的，这阻碍了智能体有效利用这些开放世界的经验。本文提出了 MemGovern 框架，旨在治理原始 GitHub 数据，并将其转化为智能体可操作的体验记忆。MemGovern 通过经验治理流程，将人类经验转换为便于智能体使用的经验卡片，并引入了一种智能体驱动的经验搜索策略，从而实现基于逻辑的人类专业知识检索。通过生成 13.5 万个经过治理的经验卡片，MemGovern 带来了显著的性能提升，在 SWE-bench Verified 基准测试中将问题解决率提高了 4.65%。作为一种插件式方案，MemGovern 为构建适配智能体的记忆基础设施提供了一种解决方案。</p>
<h2 data-id="heading-13">Collaborative Multi-Agent Test-Time Reinforcement Learning for Reasoning</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2601.09667" target="_blank" title="https://arxiv.org/abs/2601.09667" ref="nofollow noopener noreferrer">面向推理的协作式多智能体测试时强化学习</a></p>
<p>多智能体系统已发展成为许多实际应用中由大语言模型驱动的实用协作者，其鲁棒性得益于多样性和交叉验证。然而，多智能体强化学习 (MARL) 训练资源密集且不稳定：智能体间的协同适应会导致环境非平稳性，且奖励信号通常稀疏且方差高。为此，我们提出了 <strong>多智能体测试时强化学习 (MATTRL)</strong> 框架，该框架在推理阶段将结构化的文本经验注入多智能体的决策审议中。MATTRL 组建一个多专家团队进行多轮讨论，检索并整合测试时经验，最终达成共识以做出决策。我们还研究了信用分配机制，用于构建轮级经验池并将其重新注入对话流程。在医学、数学和教育等领域的多个挑战性基准测试上，MATTRL 的平均准确率相较于多智能体基线提升了 3.67%，相较于相应的单智能体基线提升了 8.67%。消融研究分析了不同的信用分配方案，并详细比较了它们对训练结果的影响。MATTRL 为无需额外调优、且能有效应对分布偏移的多智能体推理，提供了一条稳定、高效且有效的路径。</p>
<h2 data-id="heading-14">Motion Attribution for Video Generation</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2601.08828" target="_blank" title="https://arxiv.org/abs/2601.08828" ref="nofollow noopener noreferrer">视频生成中的运动归因</a></p>
<p>尽管视频生成模型发展迅速，但数据如何影响运动仍不明确。我们提出了 Motive (MOTIon attribution for Video gEneration)，这是一个运动中心、基于梯度的数据归因框架，能够适应现代大规模高质量视频数据集和模型。我们利用该框架研究哪些微调片段会改善或损害时序动态。Motive 通过运动加权损失掩码将时序动态与静态外观分离，实现了高效且可扩展的运动特定影响力计算。在文本到视频模型上，Motive 能够识别出对运动有强烈影响的片段，并以此指导数据筛选工作，从而提升时间一致性与物理合理性。使用 Motive 精选出的高影响力数据进行微调，我们的方法在 VBench 基准上同时提升了运动平滑度与动态程度，相较于预训练基础模型，获得了 74.1% 的人类偏好胜率。据我们所知，这是首个在视频生成模型中归因于运动而非视觉外观的框架，并利用该归因结果来构建微调数据集。</p>
<h2 data-id="heading-15">Solar Open Technical Report</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2601.07022" target="_blank" title="https://arxiv.org/abs/2601.07022" ref="nofollow noopener noreferrer">Solar Open 技术报告</a></p>
<p>我们介绍了 Solar Open，这是一个拥有 1020 亿参数、面向低资源语言的双语专家混合 (Mixture-of-Experts， MoE) 大语言模型。Solar Open 展示了一种通过解决三个相互关联的挑战来构建具有竞争力大语言模型的系统性方法。首先，为了应对低资源语言数据稀缺的问题以实现有效训练，我们合成了 4.5 万亿个高质量、领域特定且面向强化学习 (RL) 的 Token。其次，我们通过课程学习 (Curriculum Learning) 来协调这些数据，在总计 20 万亿 Token 的数据上，联合优化其构成、质量阈值和领域覆盖范围。第三，为了通过可扩展的强化学习来获得推理能力，我们应用了我们提出的 SnapPO 框架进行高效优化。在英语和韩语的各项基准测试中，Solar Open 都取得了具有竞争力的性能，这证明了该方法对于推动低资源语言 AI 发展的有效性。</p>
<h2 data-id="heading-16">VIBE: Visual Instruction Based Editor</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2601.02242" target="_blank" title="https://arxiv.org/abs/2601.02242" ref="nofollow noopener noreferrer">VIBE: 基于视觉指令的编辑器</a></p>
<p>基于指令的图像编辑是生成式 AI (Generative AI) 中发展最迅速的领域之一。过去一年，该领域迈上了新台阶，涌现出数十个开源模型以及能力强大的商业系统。然而，目前仅有少数开源方法能达到实用级质量。此外，作为这些管线主流选择的扩散主干网络，通常体积庞大且计算成本高昂，难以适配许多部署和研究场景；其广泛使用的版本通常包含 60 亿至 200 亿参数。本文提出了一种紧凑、高吞吐的基于指令的图像编辑管线，它采用一个现代的 20 亿参数 Qwen3-VL 模型来指导编辑过程，并使用一个 16 亿参数的扩散模型 Sana1.5 进行图像生成。我们在架构、数据处理、训练配置和评估等方面的设计决策，均以低成本推理和严格的源一致性为目标，同时确保在此规模可行的主要编辑类别上保持高质量。在 ImgEdit 和 GEdit 基准测试上的评估表明，所提方法的性能匹配甚至超越了参数量大数倍、推理成本显著更高的基线模型，并且在需要保留输入图像的编辑任务上表现尤为突出，例如属性调整、对象移除、背景编辑和针对性替换。该模型可适配 24 GB 的 GPU 显存，在 NVIDIA H100 上以 BF16 精度生成高达 2K 分辨率的编辑图像仅需约 4 秒，且无需任何额外的推理优化或模型蒸馏。</p>
<h2 data-id="heading-17">Distribution-Aligned Sequence Distillation for Superior Long-CoT Reasoning</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2601.09088" target="_blank" title="https://arxiv.org/abs/2601.09088" ref="nofollow noopener noreferrer">面向卓越长链思维推理的分布对齐序列蒸馏</a></p>
<p>在本报告中，我们介绍了 DASD-4B-Thinking，这是一个轻量级但能力强大、完全开源的推理模型。在数学、科学推理和代码生成等具有挑战性的基准测试中，它在同等规模的开源模型中实现了 SOTA 性能，甚至优于一些更大的模型。我们首先批判性地重新审视了社区中广泛采用的一种蒸馏范式：基于教师模型生成回答进行监督微调 (SFT)，也称为序列级蒸馏 (Sequence-Level Distillation)。尽管近期一系列遵循此方案的工作展现了显著的效率和强大的实证性能，但它们主要立足于 SFT 的视角。因此，这些方法将重点放在了设计 SFT 数据过滤的启发式规则上，而在很大程度上忽略了蒸馏本身的核心原则——即让学生模型学习教师模型的完整输出分布，从而继承其泛化能力。具体而言，我们指出了当前实践中的三个关键局限：i) 对教师模型序列级分布的表征不足；ii) 教师模型的输出分布与学生模型的学习能力之间存在错配；iii) 教师强制训练 (Teacher-Forced Training) 与自回归推理 (Autoregressive Inference) 之间的差异导致的暴露偏差。总而言之，这些不足反映了在整个蒸馏过程中系统性缺乏明确的师生交互，使得蒸馏的精髓未能得到充分利用。为了解决这些问题，我们提出了几项方法学创新，它们共同构成了一个增强的序列级蒸馏训练流程。值得注意的是，DASD-4B-Thinking 仅使用 44.8 万训练样本就取得了有竞争力的结果——这比大多数现有开源工作所使用的样本量少了一个数量级。为了支持社区研究，我们公开发布了模型和训练数据集。</p>
<h2 data-id="heading-18">KnowMe-Bench: Benchmarking Person Understanding for Lifelong Digital Companions</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2601.04745" target="_blank" title="https://arxiv.org/abs/2601.04745" ref="nofollow noopener noreferrer">KnowMe-Bench: 用于终身数字伴侣的人物理解基准测试</a></p>
<p>现有的长期记忆基准测试大多使用多轮对话或合成的用户历史，这使得检索性能并不能完美地代表模型的人物理解能力。我们提出了 \BenchName，这是一个基于长篇自传叙事构建的可公开发布的基准测试。在这些叙事中，人物的行动、背景和内心思想为推断其稳定的动机和决策原则提供了丰富的证据。\BenchName~将每个叙事重构为一个具有闪回感知和时间锚定的序列，并通过一系列与证据关联的问题来评估模型，这些问题涵盖事实回忆、主观状态归因和原则级推理。在不同来源的叙事上，检索增强系统主要提升了事实准确性，但在需要时间定位的解释和更高层次的推理方面，错误仍然存在，这凸显了对超越检索的记忆机制的需求。我们的数据发布于 \href{KnowMeBench}{<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FQuantaAlpha%2FKnowMeBench%257D%25E3%2580%2582" target="_blank" title="https://github.com/QuantaAlpha/KnowMeBench%7D%E3%80%82" ref="nofollow noopener noreferrer">github.com/QuantaAlpha…</a></p>
<h2 data-id="heading-19">CaricatureGS: Exaggerating 3D Gaussian Splatting Faces With Gaussian Curvature</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2601.03319" target="_blank" title="https://arxiv.org/abs/2601.03319" ref="nofollow noopener noreferrer">CaricatureGS: 基于高斯曲率夸张化3D高斯泼溅人脸</a></p>
<p>本文提出了一种用于人脸的照片级真实感、可控3D漫画化框架。我们首先采用一种基于内在高斯曲率的表面夸张技术，但当其与纹理结合时，渲染结果往往过于平滑。为解决此问题，我们求助于3D高斯泼溅 (3D Gaussian Splatting, 3DGS)，该技术近期已被证明能生成逼真的自由视点化身。给定一个多视角图像序列，我们提取FLAME网格，求解曲率加权的泊松方程，从而得到其夸张形式。然而，直接对3DGS中的高斯泼溅进行变形效果不佳，因此需要通过局部仿射变换将每一帧图像扭曲为其对应的夸张2D表示，以合成伪真值漫画图像。随后，我们设计了一种交替使用真实图像和合成图像进行监督的训练方案，使得单个高斯泼溅集合能够同时表征自然状态和夸张状态的化身。该方案提升了保真度，支持局部编辑，并允许对漫画夸张程度进行连续控制。为实现实时变形，我们引入了原始表面与夸张表面之间的高效插值方法，并进一步分析表明，该方法与闭式解之间的偏差是有界的。在定量与定性评估中，我们的方法均优于现有工作，能够生成几何可控、具有照片级真实感的漫画化身。</p>
<h2 data-id="heading-20">ArenaRL: Scaling RL for Open-Ended Agents via Tournament-based Relative Ranking</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2601.06487" target="_blank" title="https://arxiv.org/abs/2601.06487" ref="nofollow noopener noreferrer">ArenaRL: 通过基于锦标赛的相对排名实现开放式智能体的强化学习规模化</a></p>
<p>强化学习已显著提升了大语言模型智能体在结果可验证任务上的性能，但在解空间广阔的开放式智能体任务（例如复杂旅行规划）上仍举步维艰。由于此类任务缺乏客观的真值，当前的强化学习算法主要依赖于为单个响应分配标量分数的奖励模型。我们认为，这种逐点评分法存在固有的区分度崩溃问题：奖励模型难以辨别不同轨迹间的细微优势，导致组内分数被压缩至一个狭窄区间。因此，有效的奖励信号被奖励模型本身的噪声所主导，进而引发优化停滞。为解决此问题，我们提出了 ArenaRL，这是一种将评估方式从逐点标量评分转变为组内相对排名的强化学习范式。ArenaRL 引入了一种感知任务过程的成对评估机制，采用多级评分标准为轨迹分配细粒度的相对分数。此外，我们构建了一个组内对抗竞技场，并设计了一套基于锦标赛的排名方案，以获取稳定的优势信号。实证结果表明，所构建的采用种子排位的单败淘汰制，在仅需 O(N) 复杂度的情况下，其优势估计精度与需要 O(N^2) 复杂度的完全成对比较几乎相当，从而在效率与精度之间达到了最优平衡。再者，为弥补开放式智能体缺乏全流程评测基准的不足，我们构建了 Open-Travel 和 Open-DeepResearch 两个高质量基准，它们具备覆盖监督微调、强化训练及多维评估的完整流程。大量实验表明，ArenaRL 显著优于标准强化学习基线，能够使大语言模型智能体为复杂的现实世界任务生成更为稳健的解决方案。</p>
<h2 data-id="heading-21">The Molecular Structure of Thought: Mapping the Topology of Long Chain-of-Thought Reasoning</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2601.06002" target="_blank" title="https://arxiv.org/abs/2601.06002" ref="nofollow noopener noreferrer">思想的分子结构：映射长链思维推理的拓扑结构</a></p>
<p>大语言模型 (LLMs) 常常难以通过模仿人类或非长链思维 (Long CoT) 大语言模型来学习有效的长链思维 (Long CoT) 推理。为探究其原因，我们提出，在统一视角下，有效且可学习的长链思维轨迹具有类似分子的稳定结构，这些结构由三种相互作用构成：深度推理 (类共价键) 、自我反思 (类氢键) 和自我探索 (类范德华力) 。对蒸馏轨迹的分析表明，这些结构源自长链思维微调过程，而非对关键词的简单模仿。我们引入了有效语义异构体的概念，并证明只有那些能促进快速熵收敛的化学键才能支持稳定的长链思维学习，而不同结构之间的竞争则会损害训练效果。基于这些发现，我们提出了 Mole-Syn，一种基于分布转移图的方法，用于指导合成有效的长链思维结构，从而在多个基准测试中提升模型性能并增强强化学习的稳定性。</p>
<h2 data-id="heading-22">User-Oriented Multi-Turn Dialogue Generation with Tool Use at scale</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2601.08225" target="_blank" title="https://arxiv.org/abs/2601.08225" ref="nofollow noopener noreferrer">面向用户的大规模多轮对话生成与工具使用</a></p>
<p>近期，将大型推理模型 (Large Reasoning Models, LRMs) 作为自主智能体的范式转变，极大地提升了对复杂多轮工具使用能力的需求。然而，现有数据集与数据生成方法受限于静态、预定义的工具集，难以应对开放式人机协作场景的复杂性。为此，我们首先构建了一个框架，用于大规模自动化生成面向任务的多轮对话。该框架利用基于 LRM 的模拟器动态生成高价值、领域特定的工具，以解决指定任务。但我们发现，纯粹面向任务的设计往往导致"仅限任务解决"的轨迹，即智能体以最少的交互完成目标，无法生成现实场景中常见的多轮次对话。为弥补这一不足，我们转向了面向用户的模拟范式。通过将任务生成与一个专用的用户模拟器解耦——该模拟器模仿人类行为规则，如增量式提出请求和逐轮提供反馈——我们能够促成更真实、更扩展的多轮对话，从而反映现实世界问题解决的迭代特性。我们的生成流水线作为一个多功能、即插即用的模块运行，可从任意状态启动生成，确保了在产出扩展工具使用数据时的高可扩展性。此外，通过支持在单条轨迹内完成多个任务，该流程能够生成高密度数据集，以反映现实世界人机交互的多方面需求。</p>
<h2 data-id="heading-23">Fast-ThinkAct: Efficient Vision-Language-Action Reasoning via Verbalizable Latent Planning</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2601.09708" target="_blank" title="https://arxiv.org/abs/2601.09708" ref="nofollow noopener noreferrer">Fast-ThinkAct: 基于可语言化潜在规划的高效视觉-语言-动作推理</a></p>
<p>视觉-语言-动作 (Vision-Language-Action, VLA) 任务要求对复杂视觉场景进行推理，并在动态环境中执行自适应的动作。尽管近期关于推理型 VLA 的研究表明，显式的思维链 (Chain-of-Thought, CoT) 能够提升泛化能力，但其冗长的推理轨迹导致了较高的推理延迟。我们提出了 Fast-ThinkAct，一个高效的推理框架，它通过可语言化的潜在推理，实现了紧凑且高性能的规划。Fast-ThinkAct 通过从教师模型进行知识蒸馏，学习利用潜在 CoT 进行高效推理。该方法由一个偏好引导的目标驱动，旨在对齐操作轨迹，从而迁移用于具身控制的语言和视觉规划能力。这实现了推理增强的策略学习，能够有效地将紧凑的推理与动作执行相衔接。在多种具身操作与推理基准上进行的大量实验表明，Fast-ThinkAct 取得了优异的性能，与最先进的推理型 VLA 相比，推理延迟最高可降低 89.3%，同时仍能有效进行长时程规划、少样本适应和故障恢复。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[解决各种 Antigravity 无法登录问题]]></title>    <link>https://juejin.cn/post/7595960824486166562</link>    <guid>https://juejin.cn/post/7595960824486166562</guid>    <pubDate>2026-01-18T08:47:08.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595960824486166562" data-draft-id="7595974133097889826" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="解决各种 Antigravity 无法登录问题"/> <meta itemprop="keywords" content="AI编程"/> <meta itemprop="datePublished" content="2026-01-18T08:47:08.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="小兵张健"/> <meta itemprop="url" content="https://juejin.cn/user/1257497032405229"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            解决各种 Antigravity 无法登录问题
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1257497032405229/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    小兵张健
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-18T08:47:08.000Z" title="Sun Jan 18 2026 08:47:08 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">关于 IDE 外部模型加载服务的配置折腾记录</h2>
<p>由于 Kiro (Cursor) Free 版在部分模型（如 Claude-3.5-Opus 等）的调用上存在限制，为了在本地流畅使用特定的 AI 模型服务，寻找了一圈解决方案，最终发现通过 AntiGravity 配合管理工具可以实现比较稳定的服务接入。</p>
<p>折腾了一番终于配置好了，简单记录一下配置流程，以备后续查阅。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ad5bc4abb9674056a11fb864c4f113f9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5YW15byg5YGl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769347907&amp;x-signature=oprKIToXtk5gX2r8UC2lWyQ5IrY%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-1">1. 准备工作与工具获取</h4>
<p>首先需要准备好具备相应服务权限的谷歌账号。</p>
<p>然后使用了开源的账号管理工具 <strong>Antigravity-Manager</strong>。这是一个基于 Tauri v2 + React 构建的辅助工具，主要用于解决多账号的无缝切换问题，提升开发效率。</p>
<p>在此 App 中通过授权添加账号即可。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1ba7f841d9034f968562229e67567f87~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5YW15byg5YGl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769347907&amp;x-signature=lpX3mX8apInv8%2FrO5G2FMrBJ378%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-2">2. 账号切换与服务联通</h4>
<p>在管理器的「账号管理」界面，点击切换当前活跃账号。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c2b8b19e032a47ff991b6587922a75cd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5YW15byg5YGl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769347907&amp;x-signature=1sE8lgT0aKL6DLTJyByeZXv0oaw%3D" alt="image.png" loading="lazy"/></p>
<p>切换成功后，即可在主程序中识别并连接服务。</p>
<p><strong>注意：</strong> 如果遇到提示账号 "not eligible" (不符合资格)，通常是账号本身的配置属性问题。请确保你的账号所属区域符合服务商的开放清单（如美、日、新等区域通常支持较好），保持环境一致性非常重要。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c5952e1ef3a0493b8953017bcc6f345f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5YW15byg5YGl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769347907&amp;x-signature=6q2kTdjkYYiFsLe0zL3pE37cT%2FY%3D" alt="image.png" loading="lazy"/></p>
<p>之前因为配置信息未同步导致连接失败，修正了账号属性后即可正常访问。</p>
<h4 data-id="heading-3">3. 开启服务增强模式</h4>
<p>为了确保连接的稳定性，建议开启服务以及系统接管模式（TUN）。</p>
<p>这一步主要是为了让管理工具能够正确引导流量，实测通过 GitHub 的配套工具登录后，体验非常丝滑。</p>
<p>希望对同样遇到模型限制的朋友有帮助。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[FlutterEye - 发现你手机里的 Flutter 应用]]></title>    <link>https://juejin.cn/post/7595960824486576162</link>    <guid>https://juejin.cn/post/7595960824486576162</guid>    <pubDate>2026-01-18T13:45:13.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595960824486576162" data-draft-id="7596170399881232436" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="FlutterEye - 发现你手机里的 Flutter 应用"/> <meta itemprop="keywords" content="Flutter,前端,APP"/> <meta itemprop="datePublished" content="2026-01-18T13:45:13.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="LinXunFeng"/> <meta itemprop="url" content="https://juejin.cn/user/1820446984512392"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            FlutterEye - 发现你手机里的 Flutter 应用
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1820446984512392/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    LinXunFeng
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-18T13:45:13.000Z" title="Sun Jan 18 2026 13:45:13 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>欢迎关注微信公众号：<a href="https://link.juejin.cn?target=https%3A%2F%2Fp3-juejin.byteimg.com%2Ftos-cn-i-k3u1fbpfcp%2F31960a996f1f4b0da35d69ab7480f7d6~tplv-k3u1fbpfcp-zoom-1.image" target="_blank" title="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/31960a996f1f4b0da35d69ab7480f7d6~tplv-k3u1fbpfcp-zoom-1.image" ref="nofollow noopener noreferrer">FSA全栈行动</a> 👋</p>
</blockquote>
<h2 data-id="heading-0">一、简介</h2>
<p>大家好，今天这篇文章来介绍一下，由我们自主研发的，一款免费的 <code>Flutter</code> 应用检测工具，名为 <code>FlutterEye</code>。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c26ccbdf58034ea78bf40e81f8443bd7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTGluWHVuRmVuZw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769348713&amp;x-signature=SuOhu3y%2F%2B%2FmNWkn52Wgk4B5Qjq4%3D" alt="" loading="lazy"/></p>
<blockquote>
<p>它能够帮你快速找出所有基于 <code>Flutter</code> 开发的 <code>App</code>，并展示它们的详细信息。</p>
</blockquote>
<p>你可能会问，既然已经有 <code>FlutterShark</code> 这款老牌 <code>App</code>，那么我们为什么还要开发一款类似的 <code>App</code> 呢？</p>
<p>在 <code>GooglePlay</code> 上，可以看到 <code>FlutterShark</code> 有一段时间没有更新了，最近的一次更新是在 <code>2025 年 7 月 13 日</code>。</p>
<p>很多使用新版 <code>Flutter</code> 编译出来的 <code>App</code>，它是检测不出来版本号的。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/95d7a7ba8d9045f2842b1b365e245b38~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTGluWHVuRmVuZw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769348713&amp;x-signature=Ece8jqpbI0XIwligLfccEgOpFwA%3D" alt="" loading="lazy"/></p>
<p>并且 <code>GooglePlay</code> 上，类似功能的 <code>App</code> 寥寥无几，恰好，我们在 <code>Flutter</code> 方面略有研究，不如，我们尝试开发一款？</p>
<p>于是，我们开发了 <code>FlutterEye</code>，并且于 <code>2026 年 1 月</code> 正式上架至 <a href="https://link.juejin.cn?target=https%3A%2F%2Fplay.google.com%2Fstore%2Fapps%2Fdetails%3Fid%3Dcom.ailin.flutter_eye" target="_blank" title="https://play.google.com/store/apps/details?id=com.ailin.flutter_eye" ref="nofollow noopener noreferrer">谷歌商店</a>。</p>
<p>下面来介绍下 <code>FlutterEye</code> 的特点和主要功能。</p>
<h2 data-id="heading-1">二、核心功能</h2>
<p><code>FlutterEye</code> 启动后，会自动扫描你设备上的所有 App，精准识别出哪些是使用 Flutter 框架构建的。</p>
<h3 data-id="heading-2">应用列表</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c853a28df021441b8ee635596d92a16e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTGluWHVuRmVuZw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769348713&amp;x-signature=Bv7VggxIIr%2Fz5KpizWVV0UNpoGw%3D" alt="" loading="lazy"/></p>
<p>所有检测到的 <code>Flutter App</code> 都会在主页集中展示，你可以：</p>
<ul>
<li>浏览完整的 <code>Flutter App</code> 列表</li>
<li>按名称或 <code>Flutter</code> 版本排序，快速查找 <code>App</code></li>
<li>查看每个 <code>App</code> 的基本信息（名称、图标、版本）</li>
</ul>
<h3 data-id="heading-3">详细信息</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a6eeaff02424491ba7a73e885cb83ed9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTGluWHVuRmVuZw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769348713&amp;x-signature=uG0gfWZruQ3krH8h%2FSr8iMqVHN8%3D" alt="" loading="lazy"/></p>
<p>点击任意 <code>App</code>，可以查看完整的详情信息，如：</p>
<ul>
<li><strong>App 信息</strong>（<code>App</code> 名称和图标、版本号、包名）</li>
<li><strong>Flutter 信息</strong> （<code>Flutter</code> 版本号、<code>Dart</code> 版本号）</li>
</ul>
<p>除此之外，还会列出该 <code>App</code> 使用的所有 <code>Flutter</code> 第三方依赖包，了解项目的依赖情况。</p>
<h3 data-id="heading-4">依赖包信息</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c3919856d03248fcae4010993be3868f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTGluWHVuRmVuZw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769348713&amp;x-signature=M465jsT3piWaEcdKcdaJiu3eKjo%3D" alt="" loading="lazy"/></p>
<p>在详情页中点击依赖包，可查看如下信息：</p>
<ul>
<li><strong>包名</strong>：依赖包的名称（如 <code>archive</code>、<code>dio</code>、<code>shared_preferences</code> 等）</li>
<li><strong>描述</strong>：依赖包的简要功能描述</li>
<li><strong>官方链接</strong>：点击可跳转到 <code>pub.dev</code> 查看包的详细信息、文档和版本历史</li>
</ul>
<p>依赖包信息能帮你做什么？</p>
<ul>
<li><strong>发现优质库</strong>：浏览成熟 <code>App</code> 使用的依赖包，找到经过实践验证的优质第三方库</li>
<li><strong>技术分析</strong>：通过依赖组合推测 <code>App</code> 的技术架构和设计思路</li>
<li><strong>学习实践</strong>：查看大型 <code>App</code> 的依赖选择，学习最佳实践</li>
</ul>
<p>例如，如果你看到多个成功的 <code>App</code> 都使用了某个网络请求库或状态管理库，这通常意味着这个库经过了大量实践的检验，值得在你的项目中考虑使用。</p>
<h3 data-id="heading-5">总结</h3>
<p><code>FlutterEye</code> 是一款简单易用的工具，帮你发现设备上的 <code>Flutter App</code> 生态。无论你是开发者还是技术爱好者，都能从中获得有价值的信息。</p>
<p>现在就打开 <code>FlutterEye</code>，探索你手机里的 <code>Flutter</code> 世界吧！</p>
<h2 data-id="heading-6">三、最后</h2>
<p>因为 <code>FlutterEye</code> 研发上线不久，所以可能会存在一些 <code>Bug</code>，如果你遇到了，请反馈给我们，我们会尽快修复。</p>
<p>如果大家有什么建议，欢迎在评论区告诉我们，我们会考虑在后续版本进行更新。</p>
<p>最后，如果该工具有帮助到你，请不吝在商店给个 <code>5 星好评</code> 吧，感谢！</p>
<blockquote>
<p>如果文章对您有所帮助, 请不吝点击关注一下我的微信公众号：<a href="https://link.juejin.cn/?target=https%3A%2F%2Fp3-juejin.byteimg.com%2Ftos-cn-i-k3u1fbpfcp%2F31960a996f1f4b0da35d69ab7480f7d6~tplv-k3u1fbpfcp-zoom-1.image" title="https://link.juejin.cn/?target=https%3A%2F%2Fp3-juejin.byteimg.com%2Ftos-cn-i-k3u1fbpfcp%2F31960a996f1f4b0da35d69ab7480f7d6~tplv-k3u1fbpfcp-zoom-1.image" target="_blank">FSA全栈行动</a>, 这将是对我最大的激励. 公众号不仅有 <code>iOS</code> 技术，还有 <code>Android</code>，<code>Flutter</code>，<code>Python</code> 等文章, 可能有你想要了解的技能知识点哦~</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[目前最省最强用 Claude ops 4.5 + Gemini 3 Pro 的方案，30 块钱一年]]></title>    <link>https://juejin.cn/post/7596241980869197858</link>    <guid>https://juejin.cn/post/7596241980869197858</guid>    <pubDate>2026-01-18T13:51:24.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7596241980869197858" data-draft-id="7596153767872987170" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="目前最省最强用 Claude ops 4.5 + Gemini 3 Pro 的方案，30 块钱一年"/> <meta itemprop="keywords" content="AI编程"/> <meta itemprop="datePublished" content="2026-01-18T13:51:24.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="小兵张健"/> <meta itemprop="url" content="https://juejin.cn/user/1257497032405229"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            目前最省最强用 Claude ops 4.5 + Gemini 3 Pro 的方案，30 块钱一年
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1257497032405229/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    小兵张健
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-18T13:51:24.000Z" title="Sun Jan 18 2026 13:51:24 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong>核心思路：</strong></p>
<ol>
<li><strong>利用机制</strong>：Google AI Premium (2TB) 订阅支持家庭共享。</li>
<li><strong>裂变增值</strong>：1 个主号 + 5 个家庭成员号 = 6 个 Pro 账号。</li>
<li><strong>技术聚合</strong>：使用 <strong>Antigravity-Manager</strong> 工具将这 6 个账号聚合成一个池子。</li>
<li><strong>无感切换</strong>：使用 Antigravity 轮流用 6 个号。</li>
</ol>
<hr/>
<h2 data-id="heading-0">第一步：准备“原材料” (Google AI Pro 家庭组)</h2>
<p>直接闲鱼买，几十块钱一个。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/50847b4669a9465891a6fde3cdeee450~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5YW15byg5YGl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769349163&amp;x-signature=H2fM6g8p8xBqRg5H3RPBlrY8l5k%3D" alt="58e99dc2309c02fda766daf58fd3cc9b.jpg" loading="lazy"/></p>
<p>剩余 5 个小号自己想办法，重新注册，拉别人的，在闲鱼上搞都可以。</p>
<hr/>
<h2 data-id="heading-1">第二步：配置聚合神器 Antigravity</h2>
<p>既然我们手握 6 个 Pro 账号，总不能写代码的时候手动去网页版来回切换账号吧？我们需要一个中间件，把这些账号的算力“池化”。</p>
<p>这里我们要用到工具：<strong>Antigravity-Manager</strong>。github 地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Flbjlaq%2FAntigravity-Manager" target="_blank" title="https://github.com/lbjlaq/Antigravity-Manager" ref="nofollow noopener noreferrer">GitHub - lbjlaq/Antigravity-Manager: Professional Antigravity Account Manager &amp; Switcher. One-click seamless account switching for Antigravity Tools. Built with Tauri v2 + React (Rust).专业的 Antigravity 账号管理与切换工具。为 Antigravity 提供一键无缝账号切换功能。</a></p>
<p>把 6 个号都配进去。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/33db2505f3e048fe849a4d13f01a6ca9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5YW15byg5YGl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769349163&amp;x-signature=qWTb7Rqwvqn6p0gbLPV5hkZXn64%3D" alt="image.png" loading="lazy"/></p>
<p>账号登不上去，或者有问题，参考上一篇帖子，里面有具体解决方案。</p>
<h2 data-id="heading-2">第三步：Antigravity 实战配置</h2>
<p>下载 Antigravity，在 Antigravity-Manager 直接登录，进去就是你选的账号。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ad2b9dcfed704af396b6771c704d4908~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5YW15byg5YGl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769349163&amp;x-signature=6%2FM%2Fn55L72birqZVC0WB8aAY1oE%3D" alt="image.png" loading="lazy"/></p>
<p>一个号不够用了换另一个号，6 个 Pro 账号轮询来，Gemini 3 Pro 和 Claude 4.5 ops 的额度，一天是怎么都不可能用完的。这都用完了说明你工作量太大了，找老板加工资吧。</p>
<p>也可以用 Antigravity-Manager 的反代，给其他 IDE 用，像 Claude、cursor、kiro 等，但我嫌麻烦，而且各家 IDE 都差不多，懒得折腾了。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[谷歌不装了：TranslateGemma发布，12B参数竟倒反天罡吊打前辈]]></title>    <link>https://juejin.cn/post/7596245612557484041</link>    <guid>https://juejin.cn/post/7596245612557484041</guid>    <pubDate>2026-01-18T12:33:07.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7596245612557484041" data-draft-id="7596245612557467657" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="谷歌不装了：TranslateGemma发布，12B参数竟倒反天罡吊打前辈"/> <meta itemprop="keywords" content="AIGC"/> <meta itemprop="datePublished" content="2026-01-18T12:33:07.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="墨风如雪"/> <meta itemprop="url" content="https://juejin.cn/user/4064249017803927"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            谷歌不装了：TranslateGemma发布，12B参数竟倒反天罡吊打前辈
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4064249017803927/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    墨风如雪
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-18T12:33:07.000Z" title="Sun Jan 18 2026 12:33:07 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>大家好，我是平时爱折腾模型的某某。</p>
<p>翻译模型这个赛道，这几年其实挺卷的。但大多数时候，我们的认知还停留在“大力出奇迹”的阶段——想要在WMT24++基准测试中，<strong>TranslateGemma 12B的翻译质量竟然直接干翻译得信达雅，模型参数就得往死里堆。显卡在燃烧，电表在倒掉了Gemma 3自家的27B基线模型。</strong></p>
<p>这意味着什么？意味着过去你需要一台昂转，最后出来的结果可能也就比谷歌翻译好那么一点点。</p>
<p>但谷歌最近放出的这个TranslateGemma，贵的服务器才能跑出来的翻译质量，现在在一台配置不错的消费级笔记本（比如搭载M3 Max芯片的MacBook或RTX 4090的PC）上就能本地运行，而且效果更好、速度更快确实让我眼前一亮。这次他们没按套路出牌，与其说是在秀肌肉，不如说是在秀“。这种“参数倒挂”现象，实实在在地降低了高质量翻译技术的门槛。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2026%2F01%2Fesdsdfsdf.webp" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2026/01/esdsdfsdf.webp" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4ee4c96799454526ae456d514e7f94cf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769344386&amp;x-signature=EDEh749TLWP3gpZopYsHcUdCJ%2FY%3D" alt="esdsdfsdf" loading="lazy"/></a></p>
<h3 data-id="heading-0">手机端的微操”。</h3>
<p>简单说，这是一款基于Gemma 3架构的开源翻译模型全家桶。最大的看点不是它有多大，而是它有多“精”。</p>
<p>**参数游戏：当12B开始“越“离线黑科技”</p>
<p>对于普通用户，尤其是经常出国的旅行者来说，那个最小的4B版本可能才是真正的杀手锏。</p>
<p>以往的手机端离线翻译，要么词不达意，要么生硬得像级挑战”**</p>
<p>先说最让我觉得不可思议的数据。</p>
<p>按照常理，大模型的智商和参数量是成正比的。270亿参数（27B）的模型通常都要比120亿机器人。而TranslateGemma 4B虽然身躯小巧，性能却足以媲美旧款的12B模型。谷歌通过极致的优化，让这个模型可以在手机、平板等边缘设备上流畅运行。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2026%2F01%2Ffdafsd-1024x428.webp" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2026/01/fdafsd-1024x428.webp" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6107151d4d2c4e06a11e9b279a03f573~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769344386&amp;x-signature=BlOrk0aRuIHOA05wscVQl3aH2Jw%3D" alt="fdafsd" loading="lazy"/></a></p>
<p>想象一下，参数（12B）的聪明。但在TranslateGemma这里，这个定律失效了。</p>
<p>根据官方技术报告，在没有网络的异国街头，你掏出手机，依旧能获得云端级别的流畅翻译体验，这才是技术那个身形中等的<strong>12B版本</strong>，在WMT24++这种硬核基准测试里，翻译质量居然干掉了自家上一代Gemma 3的<strong>27B基线模型</strong>。</p>
<p>这就好比一个落地的真实意义。</p>
<h3 data-id="heading-1">它是怎么做到的？</h3>
<p>谷歌并没有使用魔法，而是用了一套相当轻量级拳击手，凭借着极其精湛的技术，在擂台上KO了一个重量级选手。这对于严苛的“特训”流程。</p>
<p>TranslateGemma的强悍源于一种创新的“两阶段训练”机制。首先是<strong>监督微调（SFT）</strong>，谷歌利用Gemini大模型生成了海量高质量的合成我们这些没有H100显卡、只能用消费级笔记本（比如4090或者M3 Max数据，配合人类翻译语料，先给模型打好底子。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2026%2F01%2Ffweergrfe-1024x595.webp" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2026/01/fweergrfe-1024x595.webp" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b28bc00361554fd3957ccf57bae02d4d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769344386&amp;x-signature=IadftwZWESKTV%2BOpktChKmu9lJU%3D" alt="fweergrfe" loading="lazy"/></a></p>
<p>接下来的**强化学习（RL芯片）跑本地模型的开发者来说，简直是福音。意味着你不需要租昂贵的云服务器，在本地就能跑出）**阶段才是关键。研究团队引入了一个“奖励模型评审团”，包括MetricX-QE和AutoMQM原本需要庞大算力才能达到的翻译效果。</p>
<p><strong>它是怎么做到的？</strong></p>
<p>谷歌这次在等工具。这就好比模型每翻译一句，就有好几个严厉的老师从准确度、流畅度训练方法上确实有点东西。他们没有无脑喂数据，而是采用了“两阶段训练法”。</p>
<p>第一阶段、自然度等多个维度打分。通过这种高强度的反馈循环，模型学会了如何用更少的计算资源，输出更符合人类阅读习惯的译文。</p>
<h3 data-id="heading-2">不止于文本的“全能眼是常规的监督微调（SFT），用了大量高质量的人类翻译数据，还有Gemini生成的高置信度”</h3>
<p>既然继承了Gemma 3的血统，TranslateGemma自然也点亮了多模态的天赋树合成数据。这一步相当于打地基。</p>
<p>真正的魔法在第二阶段：强化学习（RL）。谷歌弄。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2026%2F01%2Fdgfseger-1024x638.webp" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2026/01/dgfseger-1024x638.webp" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ae479e3407024a1ebaf039074a240c16~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769344386&amp;x-signature=0%2BMw4%2FUCAQb%2BCQxOpxqeoZCznmE%3D" alt="dgfseger" loading="lazy"/></a></p>
<p>它不需要专门针对图像训练，就能直接“看懂”图片里的文字。在Vistra基准了一套“奖励模型全家桶”，里面包括负责质量评估的MetricX-QE，还有负责看语测试中，它展示了直接从图像提取并翻译文本的能力。这意味着当你把镜头对准国外的菜单或路牌序自不自然的各种指标。模型每翻译一句，这些“严师”就会打分，翻译得好给时，模型不是先OCR识别成文字再翻译，而是直接理解图像内容进行转换，效率和准确率糖吃，翻译得不好扣分。</p>
<p>这种高强度的“特训”，让模型学会了如何在有限的参数空间都上了一个台阶。</p>
<h3 data-id="heading-3">结语</h3>
<p>TranslateGemma的发布，给开源社区发出了一个里，把翻译这件事做到极致。</p>
<p><strong>手机党的胜利与“看图说话”</strong></p>
<p>除了那个能清晰的信号：<strong>大模型的下半场，拼的不再单纯是参数规模，而是训练的效率和数据的质量打的12B，还有一个</strong>4B版本**也非常值得关注。</p>
<p>40亿参数，放在以前。**</p>
<p>目前，这一系列模型已经登陆Hugging Face和Kaggle。无论你是想在服务器上追求极致的翻译保真度（选择27B），还是想在笔记本上搭建本地翻译助手（选择12可能就是个玩具，但这回谷歌把它调教到了能和传统12B模型掰手腕的水平B），甚至是在移动端应用中集成离线翻译（选择4B），TranslateGemma都提供了一个现。这意味着什么？意味着你的手机、平板，甚至是一些边缘计算设备，可以在完全离线的情况下，流畅运行高质量的翻译成且强大的解决方案。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2026%2F01%2Fasfddfsdf-1024x780.webp" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2026/01/asfddfsdf-1024x780.webp" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/506e1778cea340c0897096f92fc2c5a5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769344386&amp;x-signature=DVrmeq81OrkfJAPvxK%2BdJC66ruc%3D" alt="asfddfsdf" loading="lazy"/></a></p>
<p>对于开发者而言，这是一个极好的底座；对于用户而言，这意味着语言的巴别塔，又被推倒了一层。模型。以后出国旅游，哪怕在没有信号的地下室，掏出手机也能实时翻译。</p>
<p>而且，TranslateGemma继承了Gemma 3的多模态基因。它不光能看懂字，还能看懂图。</p>
<p>你直接把一张拍歪了的菜单或者是路牌扔给它，它不需要先用OCR转成文字，</p>
<p><strong>如果你也对最新的AI信息感兴趣或者有疑问 都可以加入我的大家庭 第一时间分享最新AI资讯、工具、教程、文档 欢迎你的加入！！！😉😉😉</strong></p>
<p>公众号：墨风如雪小站</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>