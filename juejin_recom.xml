<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>æ˜é‡‘æ–‡ç« æ¨è</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>ä¸€ä¸ªå¸®åŠ©å¼€å‘è€…æˆé•¿çš„ç¤¾åŒº</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[TDesign E2E â€”â€” ä¸€å¥—é…ç½®é©±åŠ¨ã€å¯æ‰©å±•çš„ç«¯åˆ°ç«¯æµ‹è¯•æ¡†æ¶]]></title>    <link>https://juejin.cn/post/7604701848150802432</link>    <guid>https://juejin.cn/post/7604701848150802432</guid>    <pubDate>2026-02-10T04:03:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604701848150802432" data-draft-id="7604779604125106176" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="TDesign E2E â€”â€” ä¸€å¥—é…ç½®é©±åŠ¨ã€å¯æ‰©å±•çš„ç«¯åˆ°ç«¯æµ‹è¯•æ¡†æ¶"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2026-02-10T04:03:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Novlan1"/> <meta itemprop="url" content="https://juejin.cn/user/1987523605435432"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            TDesign E2E â€”â€” ä¸€å¥—é…ç½®é©±åŠ¨ã€å¯æ‰©å±•çš„ç«¯åˆ°ç«¯æµ‹è¯•æ¡†æ¶
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1987523605435432/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Novlan1
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T04:03:17.000Z" title="Tue Feb 10 2026 04:03:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    19
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style>
<h2 data-id="heading-0">ä¸€ã€é¡¹ç›®èƒŒæ™¯</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Ftdesign.tencent.com%2F" target="_blank" title="https://tdesign.tencent.com/" ref="nofollow noopener noreferrer">TDesign</a> æ˜¯è…¾è®¯å¼€æºçš„ä¼ä¸šçº§è®¾è®¡ä½“ç³»ï¼Œè¦†ç›–äº† Vue Nextã€UniAppã€å°ç¨‹åºã€Mobile Vue ç­‰å¤šä¸ªæŠ€æœ¯æ ˆï¼Œå…¶å®˜ç½‘æ‰¿è½½ç€å¤§é‡ç»„ä»¶æ–‡æ¡£é¡µé¢ã€‚éšç€ç«™ç‚¹è§„æ¨¡å¢é•¿ï¼Œä¸€ä¸ªæ ¸å¿ƒé£é™©å§‹ç»ˆå­˜åœ¨â€”â€”<strong>é¡µé¢å‘å¸ƒåç™½å±</strong>æˆ–<strong>å…³é”®å…ƒç´ ä¸¢å¤±</strong>ã€‚æ‰‹å·¥å·¡æ£€ä¸ç°å®ï¼Œä¼ ç»Ÿçš„å•å…ƒæµ‹è¯•åˆè¦†ç›–ä¸åˆ°çœŸå®æµè§ˆå™¨çš„æ¸²æŸ“é“¾è·¯ã€‚</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FTDesignOteam%2Ftdesign-e2e-test" target="_blank" title="https://github.com/TDesignOteam/tdesign-e2e-test" ref="nofollow noopener noreferrer">tdesign-e2e-test</a> æ­£æ˜¯ä¸ºè§£å†³è¿™ä¸€é—®é¢˜è€Œè®¾è®¡çš„ï¼šåŸºäº <strong>Puppeteer + Jest</strong>ï¼Œé€šè¿‡ <strong>çº¯é…ç½®é©±åŠ¨</strong> çš„æ–¹å¼ï¼Œè®©å¼€å‘è€…åªéœ€ç¼–å†™ JSON é£æ ¼çš„é…ç½®å¯¹è±¡ï¼Œå³å¯è‡ªåŠ¨ç”Ÿæˆå®Œæ•´çš„ E2E æµ‹è¯•ç”¨ä¾‹ï¼Œ<strong>é›¶æµ‹è¯•ä»£ç ç¼–å†™</strong>ã€‚</p>
<hr/>
<h2 data-id="heading-1">äºŒã€æ•´ä½“æ¶æ„</h2>
<p>é¡¹ç›®é‡‡ç”¨ <strong>"é…ç½®å±‚ â†’ å¼•æ“å±‚ â†’ å·¥å…·å±‚"</strong> ä¸‰å±‚æ¶æ„ï¼Œå„å±‚èŒè´£æ¸…æ™°ã€äº’ä¸è€¦åˆï¼š</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB
    subgraph é…ç½®å±‚["ğŸ“‚ é…ç½®å±‚ (tests/config/)"]
        types["types.ts&lt;br/&gt;ç±»å‹å®šä¹‰"]
        modules["modules/&lt;br/&gt;æ¨¡å—åŒ–é…ç½®"]
        entry["pages.config.ts&lt;br/&gt;é…ç½®æ±‡æ€»å…¥å£"]
        modules --&gt; entry
        types -.-&gt; modules
    end

    subgraph å¼•æ“å±‚["âš™ï¸ å¼•æ“å±‚ (tests/)"]
        spec["tdesign.spec.ts&lt;br/&gt;æµ‹è¯•å¼•æ“&lt;br/&gt;è‡ªåŠ¨éå†é…ç½® â†’ ç”Ÿæˆç”¨ä¾‹"]
    end

    subgraph å·¥å…·å±‚["ğŸ”§ å·¥å…·å±‚ (tests/utils/)"]
        helpers["helpers.ts&lt;br/&gt;ç™½å±æ£€æµ‹ / å…ƒç´ æ£€æµ‹&lt;br/&gt;Shadow DOM ç©¿é€&lt;br/&gt;æ“ä½œæ‰§è¡Œå™¨"]
    end

    subgraph CI["ğŸš€ CI/CD"]
        workflow["GitHub Actions&lt;br/&gt;å®šæ—¶ + Push è§¦å‘"]
        notify["scripts/notify.ts&lt;br/&gt;ä¼ä¸šå¾®ä¿¡æœºå™¨äººé€šçŸ¥"]
        workflow --&gt; notify
    end

    entry --&gt; spec
    spec --&gt; helpers
    spec --&gt; CI
</code></pre>
<h3 data-id="heading-2">2.1 é…ç½®å±‚ï¼šå£°æ˜å¼æè¿°"æµ‹ä»€ä¹ˆ"</h3>
<p>é…ç½®å±‚æ˜¯ç”¨æˆ·å”¯ä¸€éœ€è¦å…³æ³¨çš„éƒ¨åˆ†ã€‚æ ¸å¿ƒç±»å‹ <code>PageConfig</code> å®šä¹‰äº†ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹çš„å®Œæ•´æè¿°ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">PageConfig</span> {
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;                <span class="hljs-comment">// ç”¨ä¾‹åç§°</span>
  <span class="hljs-attr">url</span>: <span class="hljs-built_in">string</span>;                 <span class="hljs-comment">// ç›®æ ‡é¡µé¢</span>
  whiteScreenCheck?: <span class="hljs-built_in">boolean</span>;  <span class="hljs-comment">// æ˜¯å¦ç™½å±æ£€æµ‹</span>
  expectedSelectors?: <span class="hljs-built_in">string</span>[];<span class="hljs-comment">// æœŸæœ›å­˜åœ¨çš„å…ƒç´ </span>
  actions?: <span class="hljs-title class_">PageAction</span>[];      <span class="hljs-comment">// æ“ä½œåºåˆ—ï¼ˆç‚¹å‡»/æ‚¬æµ®/å¯¼èˆª/æ»šåŠ¨/è¾“å…¥ï¼‰</span>
  afterActionCheck?: <span class="hljs-title class_">AfterActionCheck</span>; <span class="hljs-comment">// æ“ä½œåæ ¡éªŒ</span>
  viewport?: { width; height };<span class="hljs-comment">// è‡ªå®šä¹‰è§†å£</span>
  skip?: <span class="hljs-built_in">boolean</span>;              <span class="hljs-comment">// è·³è¿‡æ ‡è®°</span>
}
</code></pre>
<p>ä½¿ç”¨è€…åªéœ€å¡«å†™é…ç½®å¯¹è±¡ï¼Œ<strong>ä¸éœ€è¦ç¼–å†™ä»»ä½• <code>test()</code>ã€<code>expect()</code> ä»£ç </strong>ã€‚æ¡†æ¶ä¼šè‡ªåŠ¨å°†æ¯æ¡é…ç½®æ˜ å°„ä¸ºä¸€ä¸ªç‹¬ç«‹çš„ Jest æµ‹è¯•ç”¨ä¾‹ã€‚</p>
<h3 data-id="heading-3">2.2 å¼•æ“å±‚ï¼šè‡ªåŠ¨åŒ–éå† + ç”¨ä¾‹ç”Ÿæˆ</h3>
<p><code>tdesign.spec.ts</code> æ˜¯æ•´ä¸ªæ¡†æ¶çš„"å¿ƒè„"ï¼Œæ ¸å¿ƒé€»è¾‘ä»…çº¦ 120 è¡Œï¼Œä½†å®Œæˆäº†ä»¥ä¸‹å·¥ä½œï¼š</p>
<ol>
<li><strong>å¯åŠ¨æµè§ˆå™¨</strong>ï¼š<code>beforeAll</code> ä¸­åˆå§‹åŒ– Puppeteerï¼ŒCI ç¯å¢ƒè‡ªåŠ¨åˆ‡æ¢ headless æ¨¡å¼</li>
<li><strong>éå†é…ç½®ã€ç”Ÿæˆç”¨ä¾‹</strong>ï¼š<code>for (const pageConfig of pagesConfig)</code> å¾ªç¯ï¼Œä¸ºæ¯æ¡é…ç½®åŠ¨æ€ç”Ÿæˆ <code>test()</code></li>
<li><strong>æ ‡å‡†åŒ–æµ‹è¯•æµç¨‹</strong>ï¼šæ¯ä¸ªç”¨ä¾‹æŒ‰ç»Ÿä¸€ç®¡çº¿æ‰§è¡Œâ€”â€”è®¾ç½®è§†å£ â†’ æ³¨å†Œé”™è¯¯æ”¶é›† â†’ è®¿é—®é¡µé¢ â†’ ç­‰å¾…ç½‘ç»œç©ºé—² â†’ ç™½å±æ£€æµ‹ â†’ å…ƒç´ æ£€æµ‹ â†’ æ‰§è¡Œæ“ä½œ â†’ æ“ä½œåæ ¡éªŒ</li>
<li><strong>èµ„æºç®¡ç†</strong>ï¼šæ¯ä¸ªç”¨ä¾‹ç‹¬ç«‹å¼€å¯/å…³é—­ Pageï¼Œ<code>afterAll</code> ä¸­å…³é—­æµè§ˆå™¨ï¼Œæœç»å†…å­˜æ³„æ¼</li>
</ol>
<p>è¿™ç§è®¾è®¡è®©å¼•æ“å±‚æˆä¸º"ä¸å¯å˜çš„éª¨æ¶"â€”â€”<strong>æ–°å¢æµ‹è¯•ç”¨ä¾‹æ°¸è¿œä¸éœ€è¦ä¿®æ”¹å¼•æ“ä»£ç </strong>ã€‚</p>
<h3 data-id="heading-4">2.3 å·¥å…·å±‚ï¼šå¯¹æŠ— Web Components çš„æ·±åº¦ç©¿é€</h3>
<p>TDesign å®˜ç½‘å¤§é‡ä½¿ç”¨äº† Web Components + Shadow DOMï¼ˆå¦‚ <code>&lt;td-header&gt;</code>ã€<code>&lt;td-doc-layout&gt;</code>ï¼‰ï¼Œä¼ ç»Ÿçš„ <code>document.querySelector</code> æ— æ³•ç©¿é€ Shadow DOM è¾¹ç•Œã€‚</p>
<p><code>helpers.ts</code> ä¸­å®ç°äº†ä¸€å¥— <strong>é€’å½’ç©¿é€ Shadow DOM çš„é€‰æ‹©å™¨å¼•æ“</strong>ï¼Œè¿™æ˜¯æ•´ä¸ªé¡¹ç›®æœ€æœ‰æŠ€æœ¯å«é‡çš„éƒ¨åˆ†ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-built_in">deepQuerySelector</span>(page, selector)
â”‚
â”œâ”€â”€ æ™®é€šé€‰æ‹©å™¨ <span class="hljs-string">".TDesign-header"</span>
â”‚   â””â”€â”€ é€’å½’éå†æ‰€æœ‰ ShadowRoot + Slot åˆ†å‘å†…å®¹
â”‚
â””â”€â”€ ç©¿é€ç»„åˆé€‰æ‹©å™¨ <span class="hljs-string">"td-header &gt;&gt;&gt; .TDesign-header-nav"</span>
    â””â”€â”€ æŒ‰ <span class="hljs-string">"&gt;&gt;&gt;"</span> åˆ†æ®µï¼Œé€å±‚è¿›å…¥ Shadow DOM
</code></pre>
<p>æ­¤å¤–ï¼Œ<code>waitForVisible()</code> å®ç°äº†è½®è¯¢ç­‰å¾…æœºåˆ¶ï¼Œä¸ä»…æ£€æŸ¥å…ƒç´ å­˜åœ¨ï¼Œè¿˜éªŒè¯å…¶çœŸå®å¯è§æ€§ï¼ˆ<code>getBoundingClientRect</code> + <code>getComputedStyle</code>ï¼‰ï¼Œé¿å… <code>display:none</code> æˆ–é›¶å°ºå¯¸å…ƒç´ çš„è¯¯åˆ¤ã€‚</p>
<p><strong>ç™½å±æ£€æµ‹</strong> é‡‡ç”¨ 4 å±‚é€’è¿›ç­–ç•¥ï¼š</p>






























<table><thead><tr><th>å±‚çº§</th><th>æ£€æµ‹é¡¹</th><th>ç›®çš„</th></tr></thead><tbody><tr><td>1</td><td><code>body.children.length &gt; 0</code></td><td>æ’é™¤å®Œå…¨ç©ºç™½é¡µ</td></tr><tr><td>2</td><td><code>body.innerHTML.length &gt; 50</code></td><td>æ’é™¤ä»…æœ‰ç©ºæ ‡ç­¾å£³</td></tr><tr><td>3</td><td>é€’å½’ç©¿é€ Shadow DOM æ‰¾å¯è§å†…å®¹</td><td>æ’é™¤ Web Components å†…éƒ¨ç™½å±</td></tr><tr><td>4</td><td>æ£€æŸ¥ SPA æ ¹æŒ‚è½½ç‚¹ + è‡ªå®šä¹‰å…ƒç´ </td><td>æ’é™¤æ¡†æ¶æœªæŒ‚è½½</td></tr></tbody></table>
<p>å››å±‚ç­–ç•¥ç›¸äº’è¡¥å……ï¼Œæ—¢èƒ½æ£€æµ‹ä¼ ç»Ÿ SPA ç™½å±ï¼Œä¹Ÿèƒ½è¦†ç›– Web Components åœºæ™¯ã€‚</p>
<hr/>
<h2 data-id="heading-5">ä¸‰ã€çµæ´»çš„é…ç½®æ–¹å¼</h2>
<h3 data-id="heading-6">3.1 äº”ç§æ“ä½œç±»å‹è¦†ç›–ä¸»æµäº¤äº’</h3>
<p>æ¡†æ¶å†…ç½®äº† 5 ç§æ“ä½œç±»å‹ï¼Œé€šè¿‡ç»„åˆä½¿ç”¨å¯ä»¥æ¨¡æ‹Ÿå‡ ä¹æ‰€æœ‰ç”¨æˆ·äº¤äº’åœºæ™¯ï¼š</p>



































<table><thead><tr><th>ç±»å‹</th><th>ç”¨é€”</th><th>å…³é”®å‚æ•°</th></tr></thead><tbody><tr><td><code>click</code></td><td>ç‚¹å‡»å…ƒç´ ï¼Œæ”¯æŒè‡ªåŠ¨ç­‰å¾…å¯¼èˆª</td><td><code>selector</code></td></tr><tr><td><code>hover</code></td><td>é¼ æ ‡æ‚¬æµ®ï¼ŒéªŒè¯æµ®å±‚/ä¸‹æ‹‰èœå•</td><td><code>selector</code></td></tr><tr><td><code>navigate</code></td><td>SPA è·¯ç”±è·³è½¬</td><td><code>targetUrl</code></td></tr><tr><td><code>scroll</code></td><td>é¡µé¢æ»šåŠ¨ï¼Œæµ‹è¯•æ‡’åŠ è½½</td><td><code>scrollY</code></td></tr><tr><td><code>input</code></td><td>æ–‡æœ¬è¾“å…¥ï¼Œæµ‹è¯•æœç´¢/è¡¨å•</td><td><code>selector</code> + <code>inputValue</code></td></tr></tbody></table>
<p>æ“ä½œæ”¯æŒ <code>waitBefore</code> / <code>waitAfter</code> ç²¾ç»†æ§åˆ¶æ—¶åºï¼Œä¹Ÿæ”¯æŒé“¾å¼ç»„åˆâ€”â€”å…ˆæ»šåŠ¨ã€å†ç‚¹å‡»ã€å†è¾“å…¥ï¼Œä¸€æ°”å‘µæˆã€‚</p>
<h3 data-id="heading-7">3.2 Shadow DOM ç©¿é€é€‰æ‹©å™¨</h3>
<p>é’ˆå¯¹ Web Componentsï¼Œæ¡†æ¶è®¾è®¡äº†ç›´è§‚çš„ <code>&gt;&gt;&gt;</code> ç©¿é€è¯­æ³•ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// å…ˆæ‰¾åˆ° &lt;td-header&gt;ï¼Œè¿›å…¥å…¶ Shadow DOMï¼Œå†æ‰¾ .TDesign-header-nav</span>
<span class="hljs-attr">selector</span>: <span class="hljs-string">'td-header &gt;&gt;&gt; .TDesign-header-nav'</span>
</code></pre>
<p>æ™®é€šé€‰æ‹©å™¨åˆ™è‡ªåŠ¨é€’å½’ç©¿é€æ‰€æœ‰å±‚çº§çš„ Shadow DOMï¼Œå¼€å‘è€…æ— éœ€å…³å¿ƒå…ƒç´ åœ¨å“ªä¸€å±‚ã€‚</p>
<h3 data-id="heading-8">3.3 æ“ä½œåæ ¡éªŒ</h3>
<p>æ¯æ¡é…ç½®å¯ä»¥é™„å¸¦ <code>afterActionCheck</code>ï¼Œåœ¨æ“ä½œæ‰§è¡Œåè‡ªåŠ¨éªŒè¯ï¼š</p>
<ul>
<li><strong>ç™½å±æ£€æµ‹</strong>ï¼šæ“ä½œåé¡µé¢æ˜¯å¦æ­£å¸¸æ¸²æŸ“</li>
<li><strong>å…ƒç´ æ£€æµ‹</strong>ï¼šæ“ä½œåç›®æ ‡å…ƒç´ æ˜¯å¦å‡ºç°</li>
<li><strong>URL æ ¡éªŒ</strong>ï¼šé€šè¿‡æ­£åˆ™åŒ¹é…éªŒè¯è·³è½¬æ˜¯å¦æ­£ç¡®</li>
</ul>
<hr/>
<h2 data-id="heading-9">å››ã€å¯æ‰©å±•æ€§è®¾è®¡</h2>
<h3 data-id="heading-10">4.1 æ¨¡å—åŒ–æ‹†åˆ†</h3>
<p>é…ç½®æŒ‰ TDesign å­ç«™æ‹†åˆ†ä¸ºç‹¬ç«‹æ¨¡å—ï¼Œå­˜æ”¾åœ¨ <code>tests/config/modules/</code> ç›®å½•ä¸‹ï¼š</p>
<pre><code class="hljs language-java" lang="java">modules/
â”œâ”€â”€ index.ts           â† ç»Ÿä¸€å¯¼å‡º
â”œâ”€â”€ home.ts            â† å®˜ç½‘é¦–é¡µ
â”œâ”€â”€ uniapp.ts          â† UniApp
â”œâ”€â”€ miniprogram.ts     â† å°ç¨‹åº
â”œâ”€â”€ vue-next.ts        â† Vue <span class="hljs-title function_">Next</span> <span class="hljs-params">(æ¡Œé¢ç«¯)</span>
â””â”€â”€ mobile-vue.ts      â† Mobile <span class="hljs-title function_">Vue</span> <span class="hljs-params">(ç§»åŠ¨ç«¯)</span>
</code></pre>
<p><code>pages.config.ts</code> ä½œä¸ºæ±‡æ€»å…¥å£ï¼Œé€šè¿‡å±•å¼€è¿ç®—ç¬¦åˆå¹¶æ‰€æœ‰æ¨¡å—ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> <span class="hljs-attr">config</span>: <span class="hljs-title class_">PageConfig</span>[] = [
  ...homePages,
  ...uniappPages,
  ...miniprogramPages,
  ...vueNextPages,
  ...mobileVuePages,
];
</code></pre>
<h3 data-id="heading-11">4.2 æ–°å¢æ¨¡å—åªéœ€ 3 æ­¥</h3>
<p>ä»¥æ–°å¢ React æ¨¡å—ä¸ºä¾‹ï¼š</p>
<ol>
<li><strong>åˆ›å»º</strong> <code>modules/react.ts</code>ï¼Œå¯¼å‡º <code>PageConfig[]</code> æ•°ç»„</li>
<li><strong>æ³¨å†Œ</strong> åœ¨ <code>modules/index.ts</code> ä¸­æ·»åŠ ä¸€è¡Œ <code>export</code></li>
<li><strong>åˆå¹¶</strong> åœ¨ <code>pages.config.ts</code> ä¸­å±•å¼€ <code>...reactPages</code></li>
</ol>
<p>æ•´ä¸ªè¿‡ç¨‹ä¸éœ€è¦ä¿®æ”¹å¼•æ“ä»£ç ã€ä¸éœ€è¦æ–°å»ºæµ‹è¯•æ–‡ä»¶ã€ä¸éœ€è¦æ”¹åŠ¨ CI é…ç½®ã€‚</p>
<h3 data-id="heading-12">4.3 æ–°å¢æ“ä½œç±»å‹</h3>
<p>å¦‚æœæœªæ¥éœ€è¦æ”¯æŒæ–°çš„äº¤äº’ï¼ˆå¦‚æ‹–æ‹½ã€é•¿æŒ‰ï¼‰ï¼Œåªéœ€ï¼š</p>
<ol>
<li>åœ¨ <code>PageAction.type</code> è”åˆç±»å‹ä¸­æ–°å¢æšä¸¾å€¼</li>
<li>åœ¨ <code>helpers.ts</code> çš„ <code>executeActions</code> ä¸­æ–°å¢ <code>case</code> åˆ†æ”¯</li>
</ol>
<p>å¼•æ“å±‚å’Œé…ç½®å±‚å®Œå…¨ä¸å—å½±å“ï¼Œä½“ç°äº† <strong>å¼€é—­åŸåˆ™ï¼ˆOCPï¼‰</strong>ã€‚</p>
<hr/>
<h2 data-id="heading-13">äº”ã€æ˜“ç»´æŠ¤æ€§</h2>
<h3 data-id="heading-14">5.1 TypeScript å…¨é“¾è·¯ç±»å‹å®‰å…¨</h3>
<p>ä»é…ç½®å®šä¹‰åˆ°å¼•æ“æ¶ˆè´¹ï¼Œå…¨ç¨‹ TypeScript å¼ºç±»å‹ã€‚<code>PageConfig</code> æ¥å£ç¡®ä¿ï¼š</p>
<ul>
<li>æ‹¼é”™å­—æ®µå â†’ ç¼–è¯‘æŠ¥é”™</li>
<li>é—æ¼å¿…å¡«å­—æ®µ â†’ ç¼–è¯‘æŠ¥é”™</li>
<li><code>action.type</code> ä¼ å…¥æœªçŸ¥å€¼ â†’ ç¼–è¯‘æŠ¥é”™</li>
</ul>
<p>ç±»å‹ç³»ç»Ÿå……å½“äº†"æ´»æ–‡æ¡£"ï¼Œå¼€å‘è€…é˜…è¯»æ¥å£å®šä¹‰å³å¯ç†è§£æ‰€æœ‰é…ç½®é¡¹ã€‚</p>
<h3 data-id="heading-15">5.2 é…ç½®ä¸ä»£ç å®Œå…¨è§£è€¦</h3>
<p>è¿™æ˜¯é¡¹ç›®æœ€æ ¸å¿ƒçš„è®¾è®¡ç†å¿µï¼š<strong>æµ‹è¯•é€»è¾‘æ˜¯ç¨³å®šçš„æ¡†æ¶ä»£ç ï¼Œæµ‹è¯•å†…å®¹æ˜¯å¯å˜çš„é…ç½®æ•°æ®</strong>ã€‚</p>
<ul>
<li>æ–°å¢é¡µé¢ï¼Ÿâ†’ åªæ”¹é…ç½®</li>
<li>é¡µé¢æ”¹ç‰ˆï¼Ÿâ†’ åªæ”¹é€‰æ‹©å™¨</li>
<li>æ–°å¢æ£€æµ‹ç»´åº¦ï¼Ÿâ†’ åªæ”¹å·¥å…·å‡½æ•°</li>
</ul>
<p>ä¸‰ä¸ªå˜æ›´æ–¹å‘äº’ä¸å¹²æ‰°ï¼Œå›¢é˜Ÿä¸­ä¸åŒè§’è‰²å¯ä»¥å¹¶è¡Œå·¥ä½œã€‚</p>
<h3 data-id="heading-16">5.3 è‡ªåŠ¨åŒ– CI/CD + å‘Šè­¦é—­ç¯</h3>
<p>é¡¹ç›®é›†æˆäº† <a href="/Users/guowangyang/Documents/github/tdesign-e2e/.github/workflows/e2e-test.yml" target="_blank" title="/Users/guowangyang/Documents/github/tdesign-e2e/.github/workflows/e2e-test.yml">GitHub Actions å·¥ä½œæµ</a>ï¼Œå®ç°äº†å®Œæ•´çš„è‡ªåŠ¨åŒ–é—­ç¯ï¼š</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph LR
    A["â° å®šæ—¶è§¦å‘&lt;br/&gt;æ¯ 10 åˆ†é’Ÿ"] --&gt; B["ğŸ§ª æ‰§è¡Œ E2E æµ‹è¯•"]
    C["ğŸ“¦ master Push"] --&gt; B
    D["ğŸ–±ï¸ æ‰‹åŠ¨è§¦å‘"] --&gt; B
    B --&gt;|é€šè¿‡| E["âœ… ä¸Šä¼ æµ‹è¯•æŠ¥å‘Š"]
    B --&gt;|å¤±è´¥| F["ğŸ“¤ ä¼ä¸šå¾®ä¿¡é€šçŸ¥&lt;br/&gt;å¤±è´¥ç”¨ä¾‹ + Actions é“¾æ¥"]
    F --&gt; E
</code></pre>
<p><code>notify.ts</code> é€šçŸ¥è„šæœ¬ä¼šè‡ªåŠ¨è§£æ Jest JSON è¾“å‡ºï¼Œæå–å¤±è´¥ç”¨ä¾‹çš„åç§°å’Œé”™è¯¯ä¿¡æ¯ï¼Œæ ¼å¼åŒ–ä¸º Markdown æ¶ˆæ¯æ¨é€åˆ°ä¼ä¸šå¾®ä¿¡ï¼ŒåŒ…å«ç›´è¾¾ Actions æ—¥å¿—çš„é“¾æ¥ã€‚</p>
<h3 data-id="heading-17">5.4 å®¹é”™è®¾è®¡</h3>
<p>æ¡†æ¶åœ¨å¤šå¤„åšäº†å®¹é”™å¤„ç†ï¼Œä¿è¯å•ä¸ªç”¨ä¾‹å¤±è´¥ä¸ä¼šæ‹–å®æ•´ä¸ªæµ‹è¯•ï¼š</p>
<ul>
<li><code>networkIdle</code> è¶…æ—¶ä¸é˜»å¡æµ‹è¯•ï¼ˆ<code>.catch(() =&gt; {})</code>ï¼‰</li>
<li>å¯¼èˆªè¶…æ—¶é™é»˜å¤„ç†ï¼ˆé€‚åº” SPA æ— å¯¼èˆªåœºæ™¯ï¼‰</li>
<li>æ¯ä¸ªç”¨ä¾‹ç‹¬ç«‹å¼€å¯/å…³é—­ Pageï¼Œ<code>finally</code> å—ç¡®ä¿èµ„æºé‡Šæ”¾</li>
<li>æ§åˆ¶å°é”™è¯¯ä»…è®°å½•å‘Šè­¦ï¼Œä¸ç›´æ¥åˆ¤å®šå¤±è´¥</li>
<li><code>skip</code> æ ‡è®°æ”¯æŒä¸´æ—¶è·³è¿‡ä¸ç¨³å®šç”¨ä¾‹</li>
</ul>
<hr/>
<h2 data-id="heading-18">å…­ã€æŠ€æœ¯äº®ç‚¹æ€»ç»“</h2>





































<table><thead><tr><th>äº®ç‚¹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>é…ç½®é©±åŠ¨ï¼Œé›¶ä»£ç æµ‹è¯•</strong></td><td>ä½¿ç”¨è€…åªå†™é…ç½®å¯¹è±¡ï¼Œæ¡†æ¶è‡ªåŠ¨ç”Ÿæˆæµ‹è¯•ç”¨ä¾‹</td></tr><tr><td><strong>Shadow DOM æ·±åº¦ç©¿é€</strong></td><td>é€’å½’éå† + <code>&gt;&gt;&gt;</code> ç©¿é€è¯­æ³•ï¼Œå®Œç¾é€‚é… Web Components</td></tr><tr><td><strong>4 å±‚ç™½å±æ£€æµ‹ç­–ç•¥</strong></td><td>DOM ç»“æ„ + å†…å®¹é•¿åº¦ + å¯è§æ€§ + SPA æŒ‚è½½ç‚¹ï¼Œå¤šç»´åº¦äº¤å‰éªŒè¯</td></tr><tr><td><strong>æ¨¡å—åŒ–é…ç½®æ¶æ„</strong></td><td>æŒ‰å­ç«™æ‹†åˆ†ï¼Œæ–°å¢æ¨¡å— 3 æ­¥å®Œæˆï¼Œé›¶è€¦åˆ</td></tr><tr><td><strong>å…¨é“¾è·¯ TypeScript</strong></td><td>é…ç½®åˆ°æ‰§è¡Œå…¨ç¨‹ç±»å‹å®‰å…¨ï¼Œæ‹¼é”™å³æŠ¥é”™</td></tr><tr><td><strong>è‡ªåŠ¨åŒ–å‘Šè­¦é—­ç¯</strong></td><td>å®šæ—¶å·¡æ£€ â†’ å¤±è´¥æ£€æµ‹ â†’ ä¼ä¸šå¾®ä¿¡æ¨é€ â†’ Actions æ—¥å¿—æº¯æº</td></tr><tr><td><strong>å®¹é”™éš”ç¦»è®¾è®¡</strong></td><td>å•ç”¨ä¾‹å¤±è´¥ä¸æ‰©æ•£ï¼Œèµ„æºè‡ªåŠ¨å›æ”¶ï¼Œè¶…æ—¶é™é»˜é™çº§</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-19">ä¸ƒã€é€‚ç”¨åœºæ™¯</h2>
<ul>
<li><strong>ç»„ä»¶åº“å®˜ç½‘å·¡æ£€</strong>ï¼šé˜²æ­¢å‘å¸ƒåç™½å±ã€å…³é”®æ–‡æ¡£å…ƒç´ ä¸¢å¤±</li>
<li><strong>å¤šæ¡†æ¶ç«™ç‚¹ç›‘æ§</strong>ï¼šä¸€å¥—æ¡†æ¶è¦†ç›– Vue / UniApp / å°ç¨‹åº / ç§»åŠ¨ç«¯ç­‰æ‰€æœ‰å­ç«™</li>
<li><strong>Web Components åœºæ™¯</strong>ï¼šå†…ç½® Shadow DOM ç©¿é€ï¼Œå¼€ç®±å³ç”¨</li>
<li><strong>å›¢é˜Ÿåä½œ</strong>ï¼šé…ç½®ä¸ä»£ç åˆ†ç¦»ï¼Œäº§å“/QA ä¹Ÿèƒ½ç¼–å†™æµ‹è¯•é…ç½®</li>
</ul>
<p>è¿™å¥—æ¡†æ¶çš„è®¾è®¡å“²å­¦æ˜¯ï¼š<strong>æŠŠæµ‹è¯•çš„å¤æ‚æ€§å°è£…è¿›æ¡†æ¶ï¼ŒæŠŠæµ‹è¯•çš„ç®€å•æ€§äº¤è¿˜ç»™ç”¨æˆ·</strong>ã€‚å¼€å‘è€…åªéœ€è¦å›ç­”"æµ‹å“ªä¸ªé¡µé¢ã€æ£€æŸ¥ä»€ä¹ˆå…ƒç´ ã€æ‰§è¡Œä»€ä¹ˆæ“ä½œ"ï¼Œå‰©ä¸‹çš„ä¸€åˆ‡â€”â€”æµè§ˆå™¨ç®¡ç†ã€Shadow DOM ç©¿é€ã€ç™½å±åˆ¤å®šã€CI è°ƒåº¦ã€å¤±è´¥å‘Šè­¦â€”â€”å…¨éƒ¨ç”±æ¡†æ¶æ¥ç®¡ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å‰ç«¯ä¹Ÿèƒ½ææ¨¡å‹ï¼Ÿåœ¨æµè§ˆå™¨é‡Œè·‘ Qwen2.5ï¼Œæˆ‘ç»™å…¬å¸çœäº† 5 ä¸‡ API è´¹ç”¨]]></title>    <link>https://juejin.cn/post/7604741630448893986</link>    <guid>https://juejin.cn/post/7604741630448893986</guid>    <pubDate>2026-02-10T04:17:43.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604741630448893986" data-draft-id="7604671453454090255" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å‰ç«¯ä¹Ÿèƒ½ææ¨¡å‹ï¼Ÿåœ¨æµè§ˆå™¨é‡Œè·‘ Qwen2.5ï¼Œæˆ‘ç»™å…¬å¸çœäº† 5 ä¸‡ API è´¹ç”¨"/> <meta itemprop="keywords" content="å‰ç«¯,JavaScript,AIç¼–ç¨‹"/> <meta itemprop="datePublished" content="2026-02-10T04:17:43.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ErpanOmer"/> <meta itemprop="url" content="https://juejin.cn/user/3878732754331096"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å‰ç«¯ä¹Ÿèƒ½ææ¨¡å‹ï¼Ÿåœ¨æµè§ˆå™¨é‡Œè·‘ Qwen2.5ï¼Œæˆ‘ç»™å…¬å¸çœäº† 5 ä¸‡ API è´¹ç”¨
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3878732754331096/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ErpanOmer
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T04:17:43.000Z" title="Tue Feb 10 2026 04:17:43 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/34fe2125c5044ab7af251979e55cb917~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRXJwYW5PbWVy:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771301869&amp;x-signature=cpeVAVvHSWB4MpoWcEcLhRAdhYM%3D" alt="run-qwen-locally.webp" loading="lazy"/></p>
<p>æœˆåˆï¼Œè´¢åŠ¡æŠŠä¸Šä¸ªæœˆçš„ OpenAI è´¦å•ç”©åœ¨äº† å’±ä»¬ CTO çš„æ¡Œå­ä¸Šã€‚</p>
<p>æ•°å­—å¾ˆæƒŠäººï¼š<strong>9000 åˆ€</strong>ã€‚</p>
<p>æˆ‘ä»¬é‚£ä¸ªæ‰€è°“<strong>AI èµ‹èƒ½</strong> çš„å†…éƒ¨çŸ¥è¯†åº“åŠ©æ‰‹ï¼Œæ¯ä¸ªæœˆå…‰ Token è´¹å°±è¦çƒ§æ‰ä¸€è¾†æ¯”äºšè¿ªç§¦PLUSğŸ˜ƒã€‚</p>
<p>è€æ¿åœ¨ä¼šä¸Šæ‹æ¡Œå­ï¼šä¸å°±æ˜¯ä¸ªæŸ¥æ–‡æ¡£çš„æœºå™¨äººå—ï¼Ÿä¸ºä»€ä¹ˆè¦ç”¨ GPT-5ï¼Ÿèƒ½ä¸èƒ½æ¢ä¾¿å®œçš„ï¼Ÿèƒ½ä¸èƒ½é™æµï¼ŸGPT-4o æˆ–è€… GPT-4o mini å°±è¡Œ?</p>
<p>åç«¯æ¶æ„å¸ˆé¢éœ²éš¾è‰²ï¼šç²¾åº¦è¦æ±‚é«˜å•Šï¼Œæ¢ GPT-4o å°±å˜æ™ºéšœã€‚è‡ªéƒ¨ç½²ï¼Ÿé‚£å¾—ä¹° H100 æ˜¾å¡ï¼Œæ›´è´µã€‚ğŸ˜–</p>
<p>ä¼šè®®å®¤é‡Œå……æ»¡äº†<strong>è´«ç©·ä¸”ç„¦è™‘</strong>çš„ç©ºæ°”ã€‚</p>
<p>è¿™æ—¶å€™ï¼Œæˆ‘é»˜é»˜åˆä¸Šäº†ç¬”è®°æœ¬ï¼Œè¯´äº†ä¸€å¥ï¼š<strong>è¦ä¸ï¼ŒæŠŠæ¨¡å‹è·‘åœ¨å‰ç«¯å§ï¼Ÿè®©ç”¨æˆ·çš„æ˜¾å¡å¸®æˆ‘ä»¬ç®—ã€‚</strong></p>
<p>å…¨åœºå®‰é™äº†ä¸‰ç§’ã€‚</p>
<p>åç«¯ç»„é•¿æ²¡å¿ä½ç¬‘äº†ï¼šæµè§ˆå™¨è·‘å¤§æ¨¡å‹ï¼Ÿä½ å½“ Chrome æ˜¯ 4090 å‘¢ï¼Ÿè·‘ä¸ª Three.js éƒ½èƒ½å¡ï¼Œè¿˜è¦è·‘ Llama 3ï¼ŸğŸ˜¥</p>
<p>æˆ‘ä¸å“ã€‚</p>
<p>å¦‚æœä½ ä¸çŸ¥é“ <a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FAPI%2FWebGPU_API" target="_blank" title="https://developer.mozilla.org/en-US/docs/Web/API/WebGPU_API" ref="nofollow noopener noreferrer"><strong>WebGPU</strong></a>ï¼Œé‚£æˆ‘ä»¬ç¡®å®æ²¡æ³•èŠã€‚</p>
<hr/>
<h3 data-id="heading-0">ä½ çš„æµè§ˆå™¨å°±æ˜¯æ˜¾å¡</h3>
<p>å…„å¼Ÿï¼Œæ—¶ä»£å˜äº†ğŸ¤·â€â™‚ï¸ã€‚</p>
<p>åœ¨å¤§å¤šæ•°äººçš„è®¤çŸ¥é‡Œï¼Œå‰ç«¯å°±æ˜¯åˆ‡å›¾ã€è°ƒ APIã€å†™ React ç»„ä»¶ã€‚</p>
<p>è®¡ç®—ï¼Ÿé‚£æ˜¯æœåŠ¡å™¨çš„äº‹ã€‚</p>
<p>ä½†ä½ æœ‰æ²¡æœ‰æƒ³è¿‡ï¼Œç°åœ¨çš„ç”¨æˆ·æ‰‹é‡Œæ‹¿çš„æ˜¯ä»€ä¹ˆè®¾å¤‡ï¼Ÿ</p>
<p><strong>M3 èŠ¯ç‰‡çš„ MacBookï¼ŒRTX 4060 çš„æ¸¸æˆæœ¬ï¼Œç”šè‡³ iPhone 15 Proã€‚</strong></p>
<p>è¿™äº›è®¾å¤‡çš„ç®—åŠ›ï¼Œå¦‚æœä¸åˆ©ç”¨èµ·æ¥ï¼Œç®€ç›´å°±æ˜¯<strong>æš´æ®„å¤©ç‰©</strong>ã€‚</p>
<p>æˆ‘ä»¬ç°åœ¨åšçš„ï¼Œå« <strong>Edge AIï¼ˆè¾¹ç¼˜ AIï¼‰</strong> ã€‚</p>
<p>æ ¸å¿ƒæŠ€æœ¯å°±ä¸‰ä¸ªè¯ï¼š<strong>WebGPU + WebAssembly + é‡åŒ–æ¨¡å‹</strong>ã€‚</p>
<p>ä»¥å‰æµè§ˆå™¨åªèƒ½ç”¨ CPU è·‘ JSï¼Œæ…¢å¾—åƒèœ—ç‰›ã€‚</p>
<p>ç°åœ¨æœ‰äº† WebGPUï¼ŒJavaScript å¯ä»¥ç›´æ¥è°ƒç”¨åº•å±‚çš„æ˜¾å¡ç®—åŠ›ã€‚</p>
<p>å†åŠ ä¸Š <a href="https://link.juejin.cn?target=https%3A%2F%2Fwebllm.mlc.ai%2F" target="_blank" title="https://webllm.mlc.ai/" ref="nofollow noopener noreferrer"><strong>WebLLM ğŸ¤–</strong></a> è¿™ç§å¤§æ€å™¨ï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥æŠŠ <strong>Llama-3-8B-Instruct</strong> è¿™ç§çº§åˆ«çš„æ¨¡å‹ï¼Œç»è¿‡ <strong>4bit é‡åŒ–</strong> åï¼Œå‹ç¼©åˆ° 3-4GBï¼Œç›´æ¥å¡è¿›æµè§ˆå™¨é‡Œã€‚</p>
<p><strong>è¿™æ„å‘³ç€ä»€ä¹ˆï¼Ÿ</strong></p>
<p>æ„å‘³ç€æ¯ä¸€æ¬¡å¯¹è¯ï¼Œä¸å†æ¶ˆè€—å…¬å¸çš„ Tokenï¼Œè€Œæ˜¯æ¶ˆè€—<strong>ç”¨æˆ·è‡ªå·±çš„ç”µè´¹</strong>ã€‚</p>
<p>å¬èµ·æ¥æ˜¯ä¸æ˜¯æœ‰ç‚¹èµ„æœ¬å®¶ï¼Ÿ</p>
<p>ä¸ï¼Œè¿™å«<strong>åˆ†å¸ƒå¼è®¡ç®—</strong>ï¼Œå“ˆå“ˆå“ˆå“ˆå“ˆã€‚ğŸ˜</p>
<hr/>
<h3 data-id="heading-1">å…ˆè®© Chrome è·‘èµ·æ¥</h3>
<p>è¯´å¹²å°±å¹²ã€‚</p>
<p>æˆ‘æ²¡ç”¨åç«¯çš„ä¸€è¡Œä»£ç ã€‚</p>
<p>ç›´æ¥ <code>npm install @mlc-ai/web-llm</code>ã€‚</p>
<p>æ ¸å¿ƒé€»è¾‘å°±è¿™ä¹ˆå‡ è¡Œï¼ˆä¼ªä»£ç ï¼‰ï¼Œå¤§å®¶å¯ä»¥è‡ªå·±å»è¯•ä¸€ä¸‹ï¼š</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">CreateMLCEngine</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@mlc-ai/web-llm"</span>;

<span class="hljs-comment">// é€‰æœ€å°ä¸”ç¨³å®šçš„Qwen2.5,å…ˆä¿è¯èƒ½è·‘èµ·æ¥</span>
<span class="hljs-keyword">const</span> modelId = <span class="hljs-string">"Qwen2.5-0.5B-Instruct-q4f32_1-MLC"</span>;

<span class="hljs-comment">// åˆå§‹åŒ–å¼•æ“ï¼ˆWebGPUï¼‰</span>
<span class="hljs-keyword">const</span> engine = <span class="hljs-keyword">await</span> <span class="hljs-title class_">CreateMLCEngine</span>(modelId, {
  <span class="hljs-attr">initProgressCallback</span>: <span class="hljs-function">(<span class="hljs-params">p</span>) =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"[MLC]"</span>, p.<span class="hljs-property">text</span>);
  },
});

<span class="hljs-comment">// æ§åˆ¶å°å¯¹è¯</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">ask</span>(<span class="hljs-params">text: string</span>) {
  <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> engine.<span class="hljs-property">chat</span>.<span class="hljs-property">completions</span>.<span class="hljs-title function_">create</span>({
    <span class="hljs-attr">messages</span>: [{ <span class="hljs-attr">role</span>: <span class="hljs-string">"user"</span>, <span class="hljs-attr">content</span>: text }],
  });
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"ğŸ¤–"</span>, res.<span class="hljs-property">choices</span>[<span class="hljs-number">0</span>].<span class="hljs-property">message</span>.<span class="hljs-property">content</span>);
}

<span class="hljs-comment">// æµ‹è¯•</span>
<span class="hljs-keyword">await</span> <span class="hljs-title function_">ask</span>(<span class="hljs-string">"å†™ä¸€ä¸ª React Button"</span>)
<span class="hljs-keyword">await</span> <span class="hljs-title function_">ask</span>(<span class="hljs-string">"ç”¨CSSå®ç°ä¸‰è§’å½¢"</span>)
<span class="hljs-keyword">await</span> <span class="hljs-title function_">ask</span>(<span class="hljs-string">"ç”¨Pythonå†™ä¸€ä¸ªå†’æ³¡æ’åº"</span>)

</code></pre>
<p>è¿è¡Œçš„é‚£ä¸€åˆ»ï¼Œæ¨¡å‹ä¼šè‡ªåŠ¨åŠ è½½ï¼ˆè®¾å¤‡é…ç½®ä½çš„åŒå­¦å°½é‡ç”¨å°æ¨¡å‹ğŸ™‚â€â†”ï¸ï¼‰
<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmlc-ai%2Fweb-llm%2Fblob%2Fmain%2Fsrc%2Fconfig.ts%23L313" target="_blank" title="https://github.com/mlc-ai/web-llm/blob/main/src/config.ts#L313" ref="nofollow noopener noreferrer">ğŸ‘‰ å¯ç”¨æ¨¡å‹</a></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ea96ea970286482ebf6359b5e77ede8b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRXJwYW5PbWVy:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771301869&amp;x-signature=9XHkhpQeC1HBWE%2FPbx%2BOpm8Ja9M%3D" alt="image.png" loading="lazy"/></p>
<blockquote>
<p>ASK: å†™ä¸€ä¸ª React Button</p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/58aa00282dfb4558a8ebaf3b0fe9ba82~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRXJwYW5PbWVy:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771301869&amp;x-signature=V01UYIzbY8joVVkIhlvK%2Bqad5ac%3D" alt="image.png" loading="lazy"/></p>
<blockquote>
<p>ASK: ç”¨CSSå®ç°ä¸‰è§’å½¢</p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b4184bfd3ef24b0d884154ca36e6c471~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRXJwYW5PbWVy:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771301869&amp;x-signature=HbFI%2BJIPT0lJ6IwRbH6OKFm1vIk%3D" alt="image.png" loading="lazy"/></p>
<blockquote>
<p>ASK: ç”¨Pythonå†™ä¸€ä¸ªå†’æ³¡æ’åº</p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ee8a472996b942bb88b529874d1130e5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRXJwYW5PbWVy:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771301869&amp;x-signature=sBBsPLUr%2BE8hM8ILX1X7ddcWDfI%3D" alt="image.png" loading="lazy"/></p>
<p>ä¸Šå‘¨ä¸€ï¼Œæˆ‘æŠŠ Demo å‘åˆ°äº†å…¬å¸ç¾¤é‡Œäº†ã€‚</p>
<p>é‚£ä¸ªå˜²ç¬‘æˆ‘çš„åç«¯ç»„é•¿ï¼Œæ‹¿ç€ä»–çš„ M1 MacBook Air ç‚¹å¼€äº†é“¾æ¥ã€‚</p>
<p>åˆæ¬¡åŠ è½½ç”¨äº† 40 ç§’ï¼ˆä¸‹è½½æ¨¡å‹æƒé‡ï¼‰ï¼Œç„¶å...</p>
<p><strong>Token ç”Ÿæˆé€Ÿåº¦ï¼š15 tokens/sã€‚</strong></p>
<p>ç”šè‡³æ¯” GPT-4 çš„ API å“åº”è¿˜è¦å¿«ï¼</p>
<p>å› ä¸ºè¿™æ˜¯<strong>æœ¬åœ°ç”Ÿæˆ</strong>ï¼Œæ²¡æœ‰ç½‘ç»œå»¶è¿Ÿã€‚</p>
<p>ä»–æŠ¬å¤´çœ‹æˆ‘ï¼šè¿™...çœŸçš„æ²¡è°ƒ APIï¼ŸğŸ˜–</p>
<p>æˆ‘æŒ‡äº†æŒ‡ Network é¢æ¿ï¼š<strong>0 è¯·æ±‚ï¼Œçº¯æœ¬åœ°ã€‚</strong></p>
<hr/>
<h3 data-id="heading-2">ç®—ä¸€ç¬”è´¦ï¼šè¿™ 5 ä¸‡å¤šæ˜¯æ€ä¹ˆçœå‡ºæ¥çš„</h3>
<p>æˆ‘ä»¬å†…éƒ¨æœ‰ 50 ä¸ªå‘˜å·¥ï¼Œæ¯ä¸ªäººæ¯å¤©å¹³å‡é—® 50 æ¬¡ã€‚</p>
<p>å¦‚æœæ˜¯ GPT-5ï¼Œä¸€å¹´å°±æ˜¯30å¤šä¸‡äº†ï¼ˆæ’é™¤å‡æœŸå’Œå‘¨æœ«ï¼‰ã€‚</p>
<p>ç°åœ¨å‘¢ï¼Ÿ</p>
<p><strong>æˆæœ¬ = CDN æµé‡è´¹ï¼ˆä¸‹è½½é‚£æ˜¯ 0.5GB æ¨¡å‹æ–‡ä»¶ï¼Œé»˜è®¤æœ€ä½æˆæœ¬å»ç®—ï¼‰ã€‚</strong></p>
<p>è€Œä¸”æ¨¡å‹æœ‰äº†ç¼“å­˜ï¼ˆCache Storageï¼‰åï¼Œç¬¬äºŒæ¬¡æ‰“å¼€å°±æ˜¯<strong>é›¶æˆæœ¬</strong>ã€‚</p>
<p>æ›´é‡è¦çš„æ˜¯<strong>æ•°æ®éšç§</strong>ã€‚</p>
<p>è´¢åŠ¡éƒ¨é‚£ä¸ªå§å§ä¹‹å‰æ­»æ´»ä¸æ•¢ç”¨ AI æœå‘ç¥¨æ”¿ç­–ï¼Œæ€•æ•°æ®ä¼ ç»™ OpenAI æ³„å¯†ã€‚</p>
<p>ç°åœ¨æˆ‘å‘Šè¯‰å¥¹ï¼šè¿™ä¸œè¥¿è·‘åœ¨ä½ è‡ªå·±çš„ç”µè„‘ä¸Šï¼Œæ–­ç½‘éƒ½èƒ½ç”¨ï¼Œæ•°æ®å‡ºä¸äº†è¿™ä¸ªæˆ¿é—´ã€‚</p>
<p>å¥¹çœ‹æˆ‘çš„çœ¼ç¥éƒ½å˜äº†ã€‚ğŸ¤©ğŸ˜ƒ</p>
<hr/>
<h3 data-id="heading-3">ä¹Ÿåˆ«ç¥è¯ï¼Œä¹Ÿæœ‰å‘çš„ï¼</h3>
<p>å½“ç„¶ï¼Œä¸ºäº†ä¿æŒæŠ€æœ¯äººçš„å®¢è§‚ï¼ˆè™½ç„¶æˆ‘å·²ç»åœ¨çˆ½æ–‡é‡Œäº†ï¼‰ï¼Œæˆ‘å¾—è¯´å®è¯ï¼Œè¿™æ–¹æ¡ˆä¸æ˜¯å®Œç¾çš„ã€‚</p>
<ol>
<li><strong>é¦–å±åŠ è½½æ˜¯å™©æ¢¦</strong>ï¼šå¦‚æœè®©ç”¨æˆ·ä¸‹è½½ 4GB çš„æ–‡ä»¶ï¼Œå¦‚æœæ˜¯ç§»åŠ¨ç«¯ 5Gï¼Œç”¨æˆ·ä¼šé¡ºç€ç½‘çº¿æ¥æ‰“ä½ ã€‚æ‰€ä»¥è¿™åªé€‚åˆ<strong>æ¡Œé¢ç«¯ Web</strong> æˆ–è€… <strong>Electron åº”ç”¨</strong>ï¼Œå°¤å…¶æ˜¯å¼€å‘æµ‹æˆ–è€…å†…éƒ¨ã€‚</li>
<li><strong>æ˜¾å¡é—¨æ§›</strong>ï¼šæ²¡æœ‰ç‹¬ç«‹æ˜¾å¡æˆ–è€… Apple Silicon çš„è€ç”µè„‘ï¼Œè·‘èµ·æ¥ä¼šå¡æˆ PPTã€‚</li>
<li><strong>å‘çƒ­</strong>ï¼šè·‘æ¨¡å‹æ—¶ï¼Œç”¨æˆ·çš„ç”µè„‘ç¡®å®ä¼šå˜æˆæš–æ‰‹å®ã€‚</li>
</ol>
<p>ä½†åœ¨æˆ‘ä»¬çš„åœºæ™¯â€”â€”<strong>ä¼ä¸šå†…éƒ¨å·¥å…·ã€æ–‡æ¡£åŠ©æ‰‹ã€ä»£ç ç”Ÿæˆå™¨</strong>â€”â€”è¿™äº›ç¼ºç‚¹å®Œå…¨å¯ä»¥æ¥å—ã€‚</p>
<p>æ¯•ç«Ÿï¼Œå…¬å¸çœä¸‹æ¥çš„é’±ï¼Œå“ªæ€•åˆ†æˆ‘ 1% å½“å¥–é‡‘ï¼Œä¹Ÿå¤Ÿæˆ‘æ¢ä¸ªæ–°é”®ç›˜äº†ğŸ˜‚ğŸ˜‚ğŸ˜‚ã€‚</p>
<hr/>
<p>å‰ç«¯çš„è¾¹ç•Œåœ¨å“ªé‡Œï¼Ÿ</p>
<p>2026 å¹´äº†ï¼Œåˆ«å†æŠŠè‡ªå·±å®šä¹‰ä¸ºç”»é¡µé¢çš„ã€‚</p>
<p><strong>WebGPU</strong> çš„å‡ºç°ï¼Œç»™äº†å‰ç«¯ç›´æ¥æŒ‘æˆ˜åŸç”Ÿæ€§èƒ½çš„å…¥åœºåˆ¸ã€‚</p>
<p>ä»ä»Šå¤©èµ·ï¼Œè¯•ç€æŠŠè®¡ç®—å‹åŠ›ä»äº‘ç«¯æ¬åˆ°åˆ°ç»ˆç«¯æ¥å§ã€‚</p>
<p>å½“åç«¯è¿˜åœ¨ä¸ºæ‰©å®¹å‘æ„æ—¶ï¼Œä½ å·²ç»åˆ©ç”¨ç”¨æˆ·é—²ç½®çš„ GPU ç®—åŠ›ï¼Œæ„å»ºäº†ä¸€ä¸ªåºå¤§çš„åˆ†å¸ƒå¼è®¡ç®—ç½‘ç»œã€‚</p>
<p>è¿™ï¼Œæ‰æ˜¯å±äºå‰ç«¯çš„<strong>é™æœ¬å¢æ•ˆ</strong>ã€‚ğŸš€</p>
<p>ä½ ä»¬è¯´æ˜¯ä¸æ˜¯å‘¢ï¼ŸğŸ˜ƒ</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/96999aa3a0ab4359bed0d5bfe148c73a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRXJwYW5PbWVy:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771301869&amp;x-signature=QnzWJu3YB%2Bn94Q1HqQKuXXTVcGI%3D" alt="Suggestion.gif" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ğŸš€99% å‰ç«¯éƒ½ç”¨é”™äº† flatMapï¼æŠŠ â€œæ˜ å°„æ‰å¹³â€ ç”¨æˆé«˜çº§ for å¾ªç¯ï¼Ÿ20 ä¸ªé«˜é˜¶ç”¨æ³•ä¸€æ¬¡æ€§è®²é€]]></title>    <link>https://juejin.cn/post/7604666872128356371</link>    <guid>https://juejin.cn/post/7604666872128356371</guid>    <pubDate>2026-02-10T04:58:16.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604666872128356371" data-draft-id="7604757482003923007" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ğŸš€99% å‰ç«¯éƒ½ç”¨é”™äº† flatMapï¼æŠŠ â€œæ˜ å°„æ‰å¹³â€ ç”¨æˆé«˜çº§ for å¾ªç¯ï¼Ÿ20 ä¸ªé«˜é˜¶ç”¨æ³•ä¸€æ¬¡æ€§è®²é€"/> <meta itemprop="keywords" content="å‰ç«¯,JavaScript,TypeScript"/> <meta itemprop="datePublished" content="2026-02-10T04:58:16.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="iDaoæŠ€æœ¯é­”æ–¹"/> <meta itemprop="url" content="https://juejin.cn/user/166781496080782"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ğŸš€99% å‰ç«¯éƒ½ç”¨é”™äº† flatMapï¼æŠŠ â€œæ˜ å°„æ‰å¹³â€ ç”¨æˆé«˜çº§ for å¾ªç¯ï¼Ÿ20 ä¸ªé«˜é˜¶ç”¨æ³•ä¸€æ¬¡æ€§è®²é€
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/166781496080782/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    iDaoæŠ€æœ¯é­”æ–¹
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T04:58:16.000Z" title="Tue Feb 10 2026 04:58:16 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>æˆ‘åœ¨ 3 ä¸ªé¡¹ç›®é‡Œç”¨ flatMap é‡æ„äº† 50+ å¤„ä»£ç ï¼Œæ€»ç»“äº†è¿™äº›ç»éªŒã€‚ä»Šå¤©å…¨éƒ¨æ•™ç»™ä½ ã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-0">å¼€ç¯‡ï¼šä¸ºä»€ä¹ˆè¦ä¸“é—¨å­¦ flatMapï¼Ÿ</h2>
<p>å»å¹´æˆ‘æ¥æ‰‹ä¸€ä¸ªç”µå•†åå°é¡¹ç›®ï¼Œä»£ç é‡Œåˆ°å¤„éƒ½æ˜¯è¿™æ ·çš„å†™æ³•ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// æ€§èƒ½æ€æ‰‹ï¼šä¸¤æ¬¡éå† + ä¸­é—´æ•°ç»„</span>
<span class="hljs-keyword">const</span> result = orders
  .<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">order</span> =&gt;</span> order.<span class="hljs-property">status</span> === <span class="hljs-string">'paid'</span>)
  .<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">order</span> =&gt;</span> order.<span class="hljs-property">items</span>)
  .<span class="hljs-title function_">flat</span>();
</code></pre>
<p>é‡æ„åç”¨ flatMapï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ä¸€æ¬¡éå†ï¼Œä»£ç æ›´ç®€æ´</span>
<span class="hljs-keyword">const</span> result = orders.<span class="hljs-title function_">flatMap</span>(<span class="hljs-function"><span class="hljs-params">order</span> =&gt;</span> 
  order.<span class="hljs-property">status</span> === <span class="hljs-string">'paid'</span> ? order.<span class="hljs-property">items</span> : []
);
</code></pre>
<p><strong>æ€§èƒ½æå‡ 40%ï¼Œä»£ç é‡å‡å°‘ 30%</strong>ã€‚è¿™å°±æ˜¯ flatMap çš„å¨åŠ›ã€‚</p>
<hr/>
<h2 data-id="heading-1">ç¬¬ä¸€éƒ¨åˆ†ï¼šåŸºç¡€æŠ€å·§ï¼ˆ1-5ï¼‰</h2>
<h3 data-id="heading-2">æŠ€å·§ 1ï¼šæ›¿ä»£ filter + map</h3>
<p><strong>åœºæ™¯</strong>ï¼šæå–æ‰€æœ‰å·²ä»˜æ¬¾è®¢å•çš„å•†å“</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> orders = [
  { <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">status</span>: <span class="hljs-string">'paid'</span>, <span class="hljs-attr">items</span>: [<span class="hljs-string">'iPhone'</span>, <span class="hljs-string">'AirPods'</span>] },
  { <span class="hljs-attr">id</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">status</span>: <span class="hljs-string">'pending'</span>, <span class="hljs-attr">items</span>: [<span class="hljs-string">'iPad'</span>] },
  { <span class="hljs-attr">id</span>: <span class="hljs-number">3</span>, <span class="hljs-attr">status</span>: <span class="hljs-string">'paid'</span>, <span class="hljs-attr">items</span>: [<span class="hljs-string">'MacBook'</span>] }
];

<span class="hljs-comment">// âŒ ä¼ ç»Ÿå†™æ³•ï¼šä¸¤æ¬¡éå†</span>
<span class="hljs-keyword">const</span> items1 = orders
  .<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">o</span> =&gt;</span> o.<span class="hljs-property">status</span> === <span class="hljs-string">'paid'</span>)
  .<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">o</span> =&gt;</span> o.<span class="hljs-property">items</span>)
  .<span class="hljs-title function_">flat</span>();

<span class="hljs-comment">// âœ… flatMapï¼šä¸€æ¬¡éå†</span>
<span class="hljs-keyword">const</span> items2 = orders.<span class="hljs-title function_">flatMap</span>(<span class="hljs-function"><span class="hljs-params">order</span> =&gt;</span>
  order.<span class="hljs-property">status</span> === <span class="hljs-string">'paid'</span> ? order.<span class="hljs-property">items</span> : []
);
<span class="hljs-comment">// ['iPhone', 'AirPods', 'MacBook']</span>
</code></pre>
<p><strong>ä¸ºä»€ä¹ˆæ›´å¥½</strong>ï¼šå‡å°‘ä¸€æ¬¡éå†ï¼Œå¤§æ•°æ®é‡æ—¶æ€§èƒ½ä¼˜åŠ¿æ˜æ˜¾ã€‚</p>
<hr/>
<h3 data-id="heading-3">æŠ€å·§ 2ï¼šå¤„ç†åµŒå¥—æ•°ç»„ï¼ˆæ ‘å½¢ç»“æ„æ‰å¹³åŒ–ï¼‰</h3>
<p><strong>åœºæ™¯</strong>ï¼šèœå•æ ‘è½¬å¹³çº§åˆ—è¡¨</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> menuTree = [
  {
    <span class="hljs-attr">name</span>: <span class="hljs-string">'ç³»ç»Ÿç®¡ç†'</span>,
    <span class="hljs-attr">children</span>: [
      { <span class="hljs-attr">name</span>: <span class="hljs-string">'ç”¨æˆ·ç®¡ç†'</span>, <span class="hljs-attr">path</span>: <span class="hljs-string">'/users'</span> },
      { <span class="hljs-attr">name</span>: <span class="hljs-string">'è§’è‰²ç®¡ç†'</span>, <span class="hljs-attr">path</span>: <span class="hljs-string">'/roles'</span> }
    ]
  },
  {
    <span class="hljs-attr">name</span>: <span class="hljs-string">'ä¸šåŠ¡ç®¡ç†'</span>,
    <span class="hljs-attr">children</span>: [
      { <span class="hljs-attr">name</span>: <span class="hljs-string">'è®¢å•ç®¡ç†'</span>, <span class="hljs-attr">path</span>: <span class="hljs-string">'/orders'</span> }
    ]
  }
];

<span class="hljs-comment">// æå–æ‰€æœ‰èœå•é¡¹ï¼Œä¿ç•™çˆ¶çº§ä¿¡æ¯</span>
<span class="hljs-keyword">const</span> flatMenu = menuTree.<span class="hljs-title function_">flatMap</span>(<span class="hljs-function"><span class="hljs-params">parent</span> =&gt;</span>
  parent.<span class="hljs-property">children</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">child</span> =&gt;</span> ({
    ...child,
    <span class="hljs-attr">parentName</span>: parent.<span class="hljs-property">name</span>
  }))
);

<span class="hljs-comment">/*
[
  { name: 'ç”¨æˆ·ç®¡ç†', path: '/users', parentName: 'ç³»ç»Ÿç®¡ç†' },
  { name: 'è§’è‰²ç®¡ç†', path: '/roles', parentName: 'ç³»ç»Ÿç®¡ç†' },
  { name: 'è®¢å•ç®¡ç†', path: '/orders', parentName: 'ä¸šåŠ¡ç®¡ç†' }
]
*/</span>
</code></pre>
<hr/>
<h3 data-id="heading-4">æŠ€å·§ 3ï¼šå­—ç¬¦ä¸²æ‹†åˆ†ä¸åˆå¹¶</h3>
<p><strong>åœºæ™¯</strong>ï¼šå¤„ç†å¤šè¡Œè¾“å…¥çš„å…³é”®è¯</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> userInput = [
  <span class="hljs-string">'apple, banana, orange'</span>,
  <span class="hljs-string">'react, vue, angular'</span>,
  <span class="hljs-string">'frontend, backend'</span>
];

<span class="hljs-comment">// æ‹†åˆ†æˆæ‰€æœ‰å…³é”®è¯å¹¶å»é‡</span>
<span class="hljs-keyword">const</span> keywords = [...<span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>(
  userInput.<span class="hljs-title function_">flatMap</span>(<span class="hljs-function"><span class="hljs-params">line</span> =&gt;</span> 
    line.<span class="hljs-title function_">split</span>(<span class="hljs-string">','</span>).<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">s</span> =&gt;</span> s.<span class="hljs-title function_">trim</span>())
  )
)];
<span class="hljs-comment">// ['apple', 'banana', 'orange', 'react', 'vue', 'angular', 'frontend', 'backend']</span>
</code></pre>
<hr/>
<h3 data-id="heading-5">æŠ€å·§ 4ï¼šæ ¹æ®æ•°é‡å±•å¼€å…ƒç´ </h3>
<p><strong>åœºæ™¯</strong>ï¼šè´­ç‰©è½¦æ ¹æ®å•†å“æ•°é‡ç”Ÿæˆæ˜ç»†</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> cart = [
  { <span class="hljs-attr">name</span>: <span class="hljs-string">'iPhone'</span>, <span class="hljs-attr">quantity</span>: <span class="hljs-number">2</span> },
  { <span class="hljs-attr">name</span>: <span class="hljs-string">'AirPods'</span>, <span class="hljs-attr">quantity</span>: <span class="hljs-number">1</span> }
];

<span class="hljs-comment">// å±•å¼€æˆç‹¬ç«‹é¡¹ï¼ˆç”¨äºåº“å­˜æ£€æŸ¥ï¼‰</span>
<span class="hljs-keyword">const</span> items = cart.<span class="hljs-title function_">flatMap</span>(<span class="hljs-function"><span class="hljs-params">product</span> =&gt;</span>
  <span class="hljs-title class_">Array</span>(product.<span class="hljs-property">quantity</span>).<span class="hljs-title function_">fill</span>(product.<span class="hljs-property">name</span>)
);
<span class="hljs-comment">// ['iPhone', 'iPhone', 'AirPods']</span>
</code></pre>
<hr/>
<h3 data-id="heading-6">æŠ€å·§ 5ï¼šè¿‡æ»¤ null/undefinedï¼ˆä½†è¦æ³¨æ„å‘ï¼‰</h3>
<p><strong>åœºæ™¯</strong>ï¼šæ¸…ç†æ¥å£è¿”å›çš„æ•°æ®</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> apiResponse = [<span class="hljs-number">1</span>, <span class="hljs-literal">null</span>, <span class="hljs-number">2</span>, <span class="hljs-literal">undefined</span>, <span class="hljs-number">3</span>, <span class="hljs-literal">null</span>, <span class="hljs-number">4</span>];

<span class="hljs-comment">// âœ… æ­£ç¡®å†™æ³•</span>
<span class="hljs-keyword">const</span> clean = apiResponse.<span class="hljs-title function_">flatMap</span>(<span class="hljs-function"><span class="hljs-params">x</span> =&gt;</span> 
  x != <span class="hljs-literal">null</span> ? [x] : []
);
<span class="hljs-comment">// [1, 2, 3, 4]</span>

<span class="hljs-comment">// âŒ é”™è¯¯å†™æ³•ï¼ˆä¼šè¯¯åˆ  0 å’Œç©ºå­—ç¬¦ä¸²ï¼‰</span>
<span class="hljs-comment">// const wrong = apiResponse.flatMap(x =&gt; x || []);</span>
<span class="hljs-comment">// const wrong2 = apiResponse.flatMap(x =&gt; x ?? []);</span>
</code></pre>
<p><strong>å‘ç‚¹è­¦ç¤º</strong>ï¼š<code>x || []</code> æˆ– <code>x ?? []</code> ä¼šæŠŠ <code>0</code>ã€<code>''</code>ã€<code>false</code> ä¹Ÿè¿‡æ»¤æ‰ï¼</p>
<hr/>
<h2 data-id="heading-7">ç¬¬äºŒéƒ¨åˆ†ï¼šè¿›é˜¶æŠ€å·§ï¼ˆ6-12ï¼‰</h2>
<h3 data-id="heading-8">æŠ€å·§ 6ï¼šé€’å½’æ‰å¹³åŒ–æ ‘ç»“æ„</h3>
<p><strong>åœºæ™¯</strong>ï¼šæ— é™æåˆ†ç±»è½¬å¹³çº§</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> categoryTree = [
  {
    <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>,
    <span class="hljs-attr">name</span>: <span class="hljs-string">'ç”µå­äº§å“'</span>,
    <span class="hljs-attr">children</span>: [
      {
        <span class="hljs-attr">id</span>: <span class="hljs-number">2</span>,
        <span class="hljs-attr">name</span>: <span class="hljs-string">'æ‰‹æœº'</span>,
        <span class="hljs-attr">children</span>: [
          { <span class="hljs-attr">id</span>: <span class="hljs-number">3</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'iPhone'</span>, <span class="hljs-attr">children</span>: [] }
        ]
      }
    ]
  }
];

<span class="hljs-keyword">function</span> <span class="hljs-title function_">flattenTree</span>(<span class="hljs-params">nodes, depth = <span class="hljs-number">0</span></span>) {
  <span class="hljs-keyword">return</span> nodes.<span class="hljs-title function_">flatMap</span>(<span class="hljs-function"><span class="hljs-params">node</span> =&gt;</span> [
    { ...node, depth, <span class="hljs-attr">children</span>: <span class="hljs-literal">undefined</span> },
    ...<span class="hljs-title function_">flattenTree</span>(node.<span class="hljs-property">children</span> || [], depth + <span class="hljs-number">1</span>)
  ]);
}

<span class="hljs-keyword">const</span> flatList = <span class="hljs-title function_">flattenTree</span>(categoryTree);
<span class="hljs-comment">/*
[
  { id: 1, name: 'ç”µå­äº§å“', depth: 0 },
  { id: 2, name: 'æ‰‹æœº', depth: 1 },
  { id: 3, name: 'iPhone', depth: 2 }
]
*/</span>
</code></pre>
<hr/>
<h3 data-id="heading-9">æŠ€å·§ 7ï¼šç¬›å¡å°”ç§¯ç”Ÿæˆï¼ˆSKU ç»„åˆï¼‰</h3>
<p><strong>åœºæ™¯</strong>ï¼šç”µå•† SKU ç”Ÿæˆ</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> colors = [<span class="hljs-string">'æ·±ç©ºç°'</span>, <span class="hljs-string">'é“¶è‰²'</span>];
<span class="hljs-keyword">const</span> sizes = [<span class="hljs-string">'128GB'</span>, <span class="hljs-string">'256GB'</span>];
<span class="hljs-keyword">const</span> editions = [<span class="hljs-string">'æ ‡å‡†ç‰ˆ'</span>, <span class="hljs-string">'Proç‰ˆ'</span>];

<span class="hljs-comment">// ç”Ÿæˆæ‰€æœ‰ SKU ç»„åˆ</span>
<span class="hljs-keyword">const</span> skus = colors.<span class="hljs-title function_">flatMap</span>(<span class="hljs-function"><span class="hljs-params">color</span> =&gt;</span>
  sizes.<span class="hljs-title function_">flatMap</span>(<span class="hljs-function"><span class="hljs-params">size</span> =&gt;</span>
    editions.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">edition</span> =&gt;</span> ({
      <span class="hljs-attr">sku</span>: <span class="hljs-string">`PHONE-<span class="hljs-subst">${color}</span>-<span class="hljs-subst">${size}</span>-<span class="hljs-subst">${edition}</span>`</span>,
      color,
      size,
      edition,
      <span class="hljs-attr">price</span>: <span class="hljs-title function_">calculatePrice</span>(color, size, edition)
    }))
  )
);

<span class="hljs-comment">// ç”Ÿæˆ 2Ã—2Ã—2=8 ä¸ª SKU</span>
</code></pre>
<hr/>
<h3 data-id="heading-10">æŠ€å·§ 8ï¼šåˆ†é¡µæ•°æ®åˆå¹¶</h3>
<p><strong>åœºæ™¯</strong>ï¼šåˆå¹¶å¤šä¸ªåˆ†é¡µæ¥å£è¿”å›çš„æ•°æ®</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> pages = [
  { <span class="hljs-attr">items</span>: [{ <span class="hljs-attr">id</span>: <span class="hljs-number">1</span> }, { <span class="hljs-attr">id</span>: <span class="hljs-number">2</span> }], <span class="hljs-attr">hasMore</span>: <span class="hljs-literal">true</span> },
  { <span class="hljs-attr">items</span>: [{ <span class="hljs-attr">id</span>: <span class="hljs-number">3</span> }], <span class="hljs-attr">hasMore</span>: <span class="hljs-literal">false</span> }
];

<span class="hljs-comment">// åˆå¹¶æ‰€æœ‰ itemsï¼Œå¹¶æ ‡è®°æ¥æºé¡µ</span>
<span class="hljs-keyword">const</span> allItems = pages.<span class="hljs-title function_">flatMap</span>(<span class="hljs-function">(<span class="hljs-params">page, pageIndex</span>) =&gt;</span>
  page.<span class="hljs-property">items</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> ({
    ...item,
    pageIndex,
    <span class="hljs-attr">isLastPage</span>: !page.<span class="hljs-property">hasMore</span>
  }))
);

<span class="hljs-comment">/*
[
  { id: 1, pageIndex: 0, isLastPage: false },
  { id: 2, pageIndex: 0, isLastPage: false },
  { id: 3, pageIndex: 1, isLastPage: true }
]
*/</span>
</code></pre>
<hr/>
<h3 data-id="heading-11">æŠ€å·§ 9ï¼šè¡¨å•éªŒè¯é”™è¯¯æ”¶é›†</h3>
<p><strong>åœºæ™¯</strong>ï¼šæ”¶é›†æ‰€æœ‰è¡¨å•å­—æ®µçš„éªŒè¯é”™è¯¯</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> fields = [
  { <span class="hljs-attr">name</span>: <span class="hljs-string">'email'</span>, <span class="hljs-attr">value</span>: <span class="hljs-string">'invalid'</span>, <span class="hljs-attr">validators</span>: [isEmail, isRequired] },
  { <span class="hljs-attr">name</span>: <span class="hljs-string">'age'</span>, <span class="hljs-attr">value</span>: <span class="hljs-number">15</span>, <span class="hljs-attr">validators</span>: [isAdult, isRequired] }
];

<span class="hljs-keyword">const</span> errors = fields.<span class="hljs-title function_">flatMap</span>(<span class="hljs-function"><span class="hljs-params">field</span> =&gt;</span> {
  <span class="hljs-keyword">const</span> fieldErrors = field.<span class="hljs-property">validators</span>
    .<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">v</span> =&gt;</span> <span class="hljs-title function_">v</span>(field.<span class="hljs-property">value</span>))
    .<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> error !== <span class="hljs-literal">null</span>);
  
  <span class="hljs-keyword">return</span> fieldErrors.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">msg</span> =&gt;</span> ({
    <span class="hljs-attr">field</span>: field.<span class="hljs-property">name</span>,
    <span class="hljs-attr">message</span>: msg
  }));
});

<span class="hljs-comment">/*
[
  { field: 'email', message: 'é‚®ç®±æ ¼å¼ä¸æ­£ç¡®' },
  { field: 'age', message: 'å¹´é¾„å¿…é¡»å¤§äº18å²' }
]
*/</span>
</code></pre>
<hr/>
<h3 data-id="heading-12">æŠ€å·§ 10ï¼šæ ‡ç­¾ç³»ç»Ÿå±•å¼€</h3>
<p><strong>åœºæ™¯</strong>ï¼šæ–‡ç« æ ‡ç­¾åå‘ç´¢å¼•</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> articles = [
  { <span class="hljs-attr">title</span>: <span class="hljs-string">'React Hooks'</span>, <span class="hljs-attr">tags</span>: [<span class="hljs-string">'react'</span>, <span class="hljs-string">'frontend'</span>] },
  { <span class="hljs-attr">title</span>: <span class="hljs-string">'Vue 3'</span>, <span class="hljs-attr">tags</span>: [<span class="hljs-string">'vue'</span>, <span class="hljs-string">'frontend'</span>] }
];

<span class="hljs-comment">// å±•å¼€æˆ "æ ‡ç­¾-æ–‡ç« " æ˜ å°„</span>
<span class="hljs-keyword">const</span> tagIndex = articles.<span class="hljs-title function_">flatMap</span>(<span class="hljs-function"><span class="hljs-params">article</span> =&gt;</span>
  article.<span class="hljs-property">tags</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">tag</span> =&gt;</span> ({ tag, <span class="hljs-attr">title</span>: article.<span class="hljs-property">title</span> }))
);

<span class="hljs-comment">// ç»Ÿè®¡æ¯ä¸ªæ ‡ç­¾çš„æ–‡ç« æ•°</span>
<span class="hljs-keyword">const</span> tagCount = tagIndex.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">acc, { tag }</span>) =&gt;</span> {
  acc[tag] = (acc[tag] || <span class="hljs-number">0</span>) + <span class="hljs-number">1</span>;
  <span class="hljs-keyword">return</span> acc;
}, {});
<span class="hljs-comment">// { react: 1, frontend: 2, vue: 1 }</span>
</code></pre>
<hr/>
<h3 data-id="heading-13">æŠ€å·§ 11ï¼šæƒé™èœå•è¿‡æ»¤</h3>
<p><strong>åœºæ™¯</strong>ï¼šæ ¹æ®æƒé™è¿‡æ»¤å¯è§èœå•</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> menuTree = [
  {
    <span class="hljs-attr">name</span>: <span class="hljs-string">'ç³»ç»Ÿç®¡ç†'</span>,
    <span class="hljs-attr">children</span>: [
      { <span class="hljs-attr">name</span>: <span class="hljs-string">'ç”¨æˆ·ç®¡ç†'</span>, <span class="hljs-attr">permission</span>: <span class="hljs-string">'user:view'</span>, <span class="hljs-attr">visible</span>: <span class="hljs-literal">true</span> },
      { <span class="hljs-attr">name</span>: <span class="hljs-string">'é…ç½®ç®¡ç†'</span>, <span class="hljs-attr">permission</span>: <span class="hljs-string">'config:view'</span>, <span class="hljs-attr">visible</span>: <span class="hljs-literal">false</span> }
    ]
  }
];

<span class="hljs-keyword">const</span> userPermissions = [<span class="hljs-string">'user:view'</span>, <span class="hljs-string">'order:view'</span>];

<span class="hljs-comment">// è¿‡æ»¤å‡ºç”¨æˆ·æœ‰æƒé™çš„èœå•</span>
<span class="hljs-keyword">const</span> visibleMenus = menuTree.<span class="hljs-title function_">flatMap</span>(<span class="hljs-function"><span class="hljs-params">menu</span> =&gt;</span>
  menu.<span class="hljs-property">children</span>.<span class="hljs-title function_">flatMap</span>(<span class="hljs-function"><span class="hljs-params">child</span> =&gt;</span>
    child.<span class="hljs-property">visible</span> &amp;&amp; userPermissions.<span class="hljs-title function_">includes</span>(child.<span class="hljs-property">permission</span>)
      ? [{ ...child, <span class="hljs-attr">parent</span>: menu.<span class="hljs-property">name</span> }]
      : []
  )
);
</code></pre>
<hr/>
<h3 data-id="heading-14">æŠ€å·§ 12ï¼šçŸ©é˜µè½¬ç½®</h3>
<p><strong>åœºæ™¯</strong>ï¼šè¡¨æ ¼è¡Œåˆ—è½¬æ¢</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> matrix = [
  [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>],
  [<span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>],
  [<span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>]
];

<span class="hljs-comment">// çŸ©é˜µè½¬ç½®</span>
<span class="hljs-keyword">const</span> transposed = matrix[<span class="hljs-number">0</span>].<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">_, colIndex</span>) =&gt;</span>
  matrix.<span class="hljs-title function_">flatMap</span>(<span class="hljs-function"><span class="hljs-params">row</span> =&gt;</span> row[colIndex] !== <span class="hljs-literal">undefined</span> ? [row[colIndex]] : [])
);

<span class="hljs-comment">/*
[
  [1, 4, 7],
  [2, 5, 8],
  [3, 6, 9]
]
*/</span>
</code></pre>
<hr/>
<h2 data-id="heading-15">ç¬¬ä¸‰éƒ¨åˆ†ï¼šé«˜é˜¶æŠ€å·§ï¼ˆ13-20ï¼‰</h2>
<h3 data-id="heading-16">æŠ€å·§ 13ï¼šåŠ¨æ€æ¡ä»¶å±•å¼€</h3>
<p><strong>åœºæ™¯</strong>ï¼šæ ¹æ®æ•°æ®ç±»å‹å†³å®šå±•å¼€ç­–ç•¥</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> data = [
  { <span class="hljs-attr">type</span>: <span class="hljs-string">'batch'</span>, <span class="hljs-attr">items</span>: [<span class="hljs-string">'a'</span>, <span class="hljs-string">'b'</span>, <span class="hljs-string">'c'</span>] },
  { <span class="hljs-attr">type</span>: <span class="hljs-string">'single'</span>, <span class="hljs-attr">value</span>: <span class="hljs-string">'d'</span> }
];

<span class="hljs-keyword">const</span> result = data.<span class="hljs-title function_">flatMap</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> {
  <span class="hljs-keyword">if</span> (item.<span class="hljs-property">type</span> === <span class="hljs-string">'batch'</span>) {
    <span class="hljs-keyword">return</span> item.<span class="hljs-property">items</span>; <span class="hljs-comment">// å±•å¼€æ•°ç»„</span>
  }
  <span class="hljs-keyword">return</span> [item.<span class="hljs-property">value</span>]; <span class="hljs-comment">// åŒ…è£…æˆæ•°ç»„</span>
});
<span class="hljs-comment">// ['a', 'b', 'c', 'd']</span>
</code></pre>
<hr/>
<h3 data-id="heading-17">æŠ€å·§ 14ï¼šæ·±åº¦è·¯å¾„æå–</h3>
<p><strong>åœºæ™¯</strong>ï¼šæå–åµŒå¥—å¯¹è±¡çš„æ‰€æœ‰å¶å­èŠ‚ç‚¹</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> nested = {
  <span class="hljs-attr">a</span>: { <span class="hljs-attr">b</span>: { <span class="hljs-attr">c</span>: <span class="hljs-number">1</span> } },
  <span class="hljs-attr">d</span>: { <span class="hljs-attr">e</span>: <span class="hljs-number">2</span> }
};

<span class="hljs-keyword">function</span> <span class="hljs-title function_">getPaths</span>(<span class="hljs-params">obj, prefix = <span class="hljs-string">''</span></span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">entries</span>(obj).<span class="hljs-title function_">flatMap</span>(<span class="hljs-function">(<span class="hljs-params">[key, value]</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> path = prefix ? <span class="hljs-string">`<span class="hljs-subst">${prefix}</span>.<span class="hljs-subst">${key}</span>`</span> : key;
    
    <span class="hljs-keyword">if</span> (value &amp;&amp; <span class="hljs-keyword">typeof</span> value === <span class="hljs-string">'object'</span> &amp;&amp; !<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(value)) {
      <span class="hljs-keyword">return</span> <span class="hljs-title function_">getPaths</span>(value, path);
    }
    
    <span class="hljs-keyword">return</span> [{ path, value }];
  });
}

<span class="hljs-title function_">getPaths</span>(nested);
<span class="hljs-comment">/*
[
  { path: 'a.b.c', value: 1 },
  { path: 'd.e', value: 2 }
]
*/</span>
</code></pre>
<hr/>
<h3 data-id="heading-18">æŠ€å·§ 15ï¼šåˆ†ç»„æŠ¥è¡¨ç”Ÿæˆ</h3>
<p><strong>åœºæ™¯</strong>ï¼šé”€å”®æ•°æ®é€è§†è¡¨é¢„å¤„ç†</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> sales = [
  { <span class="hljs-attr">month</span>: <span class="hljs-string">'1æœˆ'</span>, <span class="hljs-attr">region</span>: <span class="hljs-string">'ä¸œ'</span>, <span class="hljs-attr">amount</span>: <span class="hljs-number">100</span> },
  { <span class="hljs-attr">month</span>: <span class="hljs-string">'1æœˆ'</span>, <span class="hljs-attr">region</span>: <span class="hljs-string">'è¥¿'</span>, <span class="hljs-attr">amount</span>: <span class="hljs-number">200</span> },
  { <span class="hljs-attr">month</span>: <span class="hljs-string">'2æœˆ'</span>, <span class="hljs-attr">region</span>: <span class="hljs-string">'ä¸œ'</span>, <span class="hljs-attr">amount</span>: <span class="hljs-number">150</span> }
];

<span class="hljs-keyword">const</span> months = [...<span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>(sales.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">s</span> =&gt;</span> s.<span class="hljs-property">month</span>))];

<span class="hljs-keyword">const</span> report = months.<span class="hljs-title function_">flatMap</span>(<span class="hljs-function"><span class="hljs-params">month</span> =&gt;</span> {
  <span class="hljs-keyword">const</span> monthData = sales.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">s</span> =&gt;</span> s.<span class="hljs-property">month</span> === month);
  <span class="hljs-keyword">const</span> total = monthData.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">sum, s</span>) =&gt;</span> sum + s.<span class="hljs-property">amount</span>, <span class="hljs-number">0</span>);
  
  <span class="hljs-keyword">return</span> [{
    month,
    <span class="hljs-attr">details</span>: monthData,
    total,
    <span class="hljs-attr">average</span>: total / monthData.<span class="hljs-property">length</span>
  }];
});
</code></pre>
<hr/>
<h3 data-id="heading-19">æŠ€å·§ 16ï¼šå…¨é€‰åŠŸèƒ½å±•å¼€</h3>
<p><strong>åœºæ™¯</strong>ï¼šä¸‹æ‹‰æ¡†å…¨é€‰å±•å¼€æˆå­é¡¹</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> options = [
  { <span class="hljs-attr">label</span>: <span class="hljs-string">'æ°´æœ'</span>, <span class="hljs-attr">children</span>: [<span class="hljs-string">'è‹¹æœ'</span>, <span class="hljs-string">'é¦™è•‰'</span>] },
  { <span class="hljs-attr">label</span>: <span class="hljs-string">'è”¬èœ'</span>, <span class="hljs-attr">children</span>: [<span class="hljs-string">'ç™½èœ'</span>] },
  { <span class="hljs-attr">label</span>: <span class="hljs-string">'å…¨é€‰'</span>, <span class="hljs-attr">value</span>: <span class="hljs-string">'all'</span> }
];

<span class="hljs-keyword">const</span> flattened = options.<span class="hljs-title function_">flatMap</span>(<span class="hljs-function"><span class="hljs-params">opt</span> =&gt;</span> {
  <span class="hljs-keyword">if</span> (opt.<span class="hljs-property">value</span> === <span class="hljs-string">'all'</span>) {
    <span class="hljs-comment">// å…¨é€‰å±•å¼€æˆæ‰€æœ‰å­é¡¹</span>
    <span class="hljs-keyword">return</span> options
      .<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">o</span> =&gt;</span> o.<span class="hljs-property">children</span>)
      .<span class="hljs-title function_">flatMap</span>(<span class="hljs-function"><span class="hljs-params">o</span> =&gt;</span> o.<span class="hljs-property">children</span>);
  }
  
  <span class="hljs-keyword">return</span> opt.<span class="hljs-property">children</span>
    ? opt.<span class="hljs-property">children</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">child</span> =&gt;</span> ({ <span class="hljs-attr">label</span>: child, <span class="hljs-attr">group</span>: opt.<span class="hljs-property">label</span> }))
    : [opt];
});
</code></pre>
<hr/>
<h3 data-id="heading-20">æŠ€å·§ 17ï¼šè‡ªå®šä¹‰æ·±åº¦æ‰å¹³åŒ–</h3>
<p><strong>åœºæ™¯</strong>ï¼šæŒ‡å®šæ·±åº¦çš„æ•°ç»„æ‰å¹³åŒ–</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> deepArray = [<span class="hljs-number">1</span>, [<span class="hljs-number">2</span>, [<span class="hljs-number">3</span>, [<span class="hljs-number">4</span>]]], <span class="hljs-number">5</span>];

<span class="hljs-keyword">function</span> <span class="hljs-title function_">flatMapDeep</span>(<span class="hljs-params">arr, depth = <span class="hljs-number">1</span></span>) {
  <span class="hljs-keyword">if</span> (depth === <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> arr;
  
  <span class="hljs-keyword">return</span> arr.<span class="hljs-title function_">flatMap</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span>
    <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(item)
      ? <span class="hljs-title function_">flatMapDeep</span>(item, depth - <span class="hljs-number">1</span>)
      : [item]
  );
}

<span class="hljs-title function_">flatMapDeep</span>(deepArray, <span class="hljs-number">1</span>); <span class="hljs-comment">// [1, 2, [3, [4]], 5]</span>
<span class="hljs-title function_">flatMapDeep</span>(deepArray, <span class="hljs-number">2</span>); <span class="hljs-comment">// [1, 2, 3, [4], 5]</span>
<span class="hljs-title function_">flatMapDeep</span>(deepArray, <span class="hljs-number">3</span>); <span class="hljs-comment">// [1, 2, 3, 4, 5]</span>
</code></pre>
<hr/>
<h3 data-id="heading-21">æŠ€å·§ 18ï¼šæ•°æ®è½¬æ¢ç®¡é“</h3>
<p><strong>åœºæ™¯</strong>ï¼šå¤šé˜¶æ®µæ•°æ®å¤„ç†</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> rawData = [
  { <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">items</span>: [<span class="hljs-number">10</span>, <span class="hljs-number">20</span>], <span class="hljs-attr">active</span>: <span class="hljs-literal">true</span> },
  { <span class="hljs-attr">id</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">items</span>: [<span class="hljs-number">30</span>], <span class="hljs-attr">active</span>: <span class="hljs-literal">false</span> },
  { <span class="hljs-attr">id</span>: <span class="hljs-number">3</span>, <span class="hljs-attr">items</span>: [<span class="hljs-number">40</span>, <span class="hljs-number">50</span>], <span class="hljs-attr">active</span>: <span class="hljs-literal">true</span> }
];

<span class="hljs-comment">// ç®¡é“ï¼šè¿‡æ»¤ -&gt; å±•å¼€ -&gt; è½¬æ¢</span>
<span class="hljs-keyword">const</span> processed = rawData
  .<span class="hljs-title function_">flatMap</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item.<span class="hljs-property">active</span> ? [item] : [])           <span class="hljs-comment">// è¿‡æ»¤</span>
  .<span class="hljs-title function_">flatMap</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item.<span class="hljs-property">items</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">val</span> =&gt;</span> ({             <span class="hljs-comment">// å±•å¼€</span>
    <span class="hljs-attr">id</span>: item.<span class="hljs-property">id</span>, 
    <span class="hljs-attr">value</span>: val 
  })))
  .<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">{ id, value }</span>) =&gt;</span> ({                             <span class="hljs-comment">// è½¬æ¢</span>
    id,
    value,
    <span class="hljs-attr">doubled</span>: value * <span class="hljs-number">2</span>
  }));

<span class="hljs-comment">/*
[
  { id: 1, value: 10, doubled: 20 },
  { id: 1, value: 20, doubled: 40 },
  { id: 3, value: 40, doubled: 80 },
  { id: 3, value: 50, doubled: 100 }
]
*/</span>
</code></pre>
<hr/>
<h3 data-id="heading-22">æŠ€å·§ 19ï¼šå¤šé‡æ¡ä»¶è¿‡æ»¤ä¸å±•å¼€</h3>
<p><strong>åœºæ™¯</strong>ï¼šå¤æ‚æ¡ä»¶çš„æ•°æ®ç­›é€‰</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> products = [
  { <span class="hljs-attr">name</span>: <span class="hljs-string">'iPhone'</span>, <span class="hljs-attr">category</span>: <span class="hljs-string">'æ‰‹æœº'</span>, <span class="hljs-attr">variants</span>: [<span class="hljs-string">'128GB'</span>, <span class="hljs-string">'256GB'</span>] },
  { <span class="hljs-attr">name</span>: <span class="hljs-string">'Tæ¤'</span>, <span class="hljs-attr">category</span>: <span class="hljs-string">'æœè£…'</span>, <span class="hljs-attr">variants</span>: [<span class="hljs-string">'M'</span>, <span class="hljs-string">'L'</span>, <span class="hljs-string">'XL'</span>] }
];

<span class="hljs-comment">// åªå±•å¼€æŒ‡å®šç±»åˆ«çš„å•†å“å˜ä½“</span>
<span class="hljs-keyword">const</span> variants = products.<span class="hljs-title function_">flatMap</span>(<span class="hljs-function"><span class="hljs-params">product</span> =&gt;</span> {
  <span class="hljs-keyword">if</span> (product.<span class="hljs-property">category</span> !== <span class="hljs-string">'æ‰‹æœº'</span>) <span class="hljs-keyword">return</span> [];
  
  <span class="hljs-keyword">return</span> product.<span class="hljs-property">variants</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">variant</span> =&gt;</span> ({
    <span class="hljs-attr">name</span>: <span class="hljs-string">`<span class="hljs-subst">${product.name}</span> <span class="hljs-subst">${variant}</span>`</span>,
    <span class="hljs-attr">basePrice</span>: <span class="hljs-number">5999</span>,
    variant
  }));
});
</code></pre>
<hr/>
<h3 data-id="heading-23">æŠ€å·§ 20ï¼šå®æˆ˜ç»¼åˆæ¡ˆä¾‹ï¼ˆè´­ç‰©è½¦ç³»ç»Ÿï¼‰</h3>
<p><strong>åœºæ™¯</strong>ï¼šå®Œæ•´çš„è´­ç‰©è½¦æ•°æ®å¤„ç†æµç¨‹</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> cart = [
  {
    <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>,
    <span class="hljs-attr">type</span>: <span class="hljs-string">'bundle'</span>,
    <span class="hljs-attr">name</span>: <span class="hljs-string">'è‹¹æœå¥—è£…'</span>,
    <span class="hljs-attr">items</span>: [
      { <span class="hljs-attr">sku</span>: <span class="hljs-string">'IPHONE'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'iPhone'</span>, <span class="hljs-attr">price</span>: <span class="hljs-number">5999</span>, <span class="hljs-attr">stock</span>: <span class="hljs-number">10</span>, <span class="hljs-attr">category</span>: <span class="hljs-string">'æ‰‹æœº'</span> },
      { <span class="hljs-attr">sku</span>: <span class="hljs-string">'AIRPODS'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'AirPods'</span>, <span class="hljs-attr">price</span>: <span class="hljs-number">1999</span>, <span class="hljs-attr">stock</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">category</span>: <span class="hljs-string">'é…ä»¶'</span> }
    ]
  },
  {
    <span class="hljs-attr">id</span>: <span class="hljs-number">2</span>,
    <span class="hljs-attr">type</span>: <span class="hljs-string">'single'</span>,
    <span class="hljs-attr">name</span>: <span class="hljs-string">'MacBook'</span>,
    <span class="hljs-attr">sku</span>: <span class="hljs-string">'MACBOOK'</span>,
    <span class="hljs-attr">price</span>: <span class="hljs-number">14999</span>,
    <span class="hljs-attr">stock</span>: <span class="hljs-number">5</span>,
    <span class="hljs-attr">category</span>: <span class="hljs-string">'ç”µè„‘'</span>,
    <span class="hljs-attr">options</span>: { <span class="hljs-attr">colors</span>: [<span class="hljs-string">'æ·±ç©ºç°'</span>, <span class="hljs-string">'é“¶è‰²'</span>], <span class="hljs-attr">sizes</span>: [<span class="hljs-string">'14å¯¸'</span>, <span class="hljs-string">'16å¯¸'</span>] }
  },
  {
    <span class="hljs-attr">id</span>: <span class="hljs-number">3</span>,
    <span class="hljs-attr">type</span>: <span class="hljs-string">'single'</span>,
    <span class="hljs-attr">name</span>: <span class="hljs-string">'é¼ æ ‡'</span>,
    <span class="hljs-attr">sku</span>: <span class="hljs-string">'MOUSE'</span>,
    <span class="hljs-attr">price</span>: <span class="hljs-number">299</span>,
    <span class="hljs-attr">stock</span>: <span class="hljs-number">100</span>,
    <span class="hljs-attr">category</span>: <span class="hljs-string">'é…ä»¶'</span>
  }
];

<span class="hljs-comment">// æ­¥éª¤1ï¼šå±•å¼€æ‰€æœ‰å•†å“ï¼ˆåŒ…æ‹¬å¥—è£…ï¼‰</span>
<span class="hljs-keyword">const</span> expanded = cart.<span class="hljs-title function_">flatMap</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> {
  <span class="hljs-keyword">if</span> (item.<span class="hljs-property">type</span> === <span class="hljs-string">'bundle'</span>) {
    <span class="hljs-keyword">return</span> item.<span class="hljs-property">items</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">sub</span> =&gt;</span> ({ 
      ...sub, 
      <span class="hljs-attr">bundleId</span>: item.<span class="hljs-property">id</span>,
      <span class="hljs-attr">bundleName</span>: item.<span class="hljs-property">name</span> 
    }));
  }
  <span class="hljs-keyword">return</span> [item];
});

<span class="hljs-comment">// æ­¥éª¤2ï¼šè¿‡æ»¤åº“å­˜ä¸º0çš„å•†å“</span>
<span class="hljs-keyword">const</span> available = expanded.<span class="hljs-title function_">flatMap</span>(<span class="hljs-function"><span class="hljs-params">product</span> =&gt;</span>
  product.<span class="hljs-property">stock</span> &gt; <span class="hljs-number">0</span> ? [product] : []
);

<span class="hljs-comment">// æ­¥éª¤3ï¼šç”Ÿæˆ SKU ç»„åˆ</span>
<span class="hljs-keyword">const</span> withSkus = available.<span class="hljs-title function_">flatMap</span>(<span class="hljs-function"><span class="hljs-params">product</span> =&gt;</span> {
  <span class="hljs-keyword">if</span> (product.<span class="hljs-property">options</span>) {
    <span class="hljs-keyword">const</span> { colors, sizes } = product.<span class="hljs-property">options</span>;
    <span class="hljs-keyword">return</span> colors.<span class="hljs-title function_">flatMap</span>(<span class="hljs-function"><span class="hljs-params">color</span> =&gt;</span>
      sizes.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">size</span> =&gt;</span> ({
        ...product,
        <span class="hljs-attr">sku</span>: <span class="hljs-string">`<span class="hljs-subst">${product.sku}</span>-<span class="hljs-subst">${color}</span>-<span class="hljs-subst">${size}</span>`</span>,
        <span class="hljs-attr">variant</span>: <span class="hljs-string">`<span class="hljs-subst">${color}</span> <span class="hljs-subst">${size}</span>`</span>,
        <span class="hljs-attr">unitPrice</span>: product.<span class="hljs-property">price</span>
      }))
    );
  }
  <span class="hljs-keyword">return</span> [product];
});

<span class="hljs-comment">// æ­¥éª¤4ï¼šæŒ‰åˆ†ç±»åˆ†ç»„</span>
<span class="hljs-keyword">const</span> byCategory = withSkus.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">acc, item</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> cat = item.<span class="hljs-property">category</span>;
  <span class="hljs-keyword">if</span> (!acc[cat]) acc[cat] = [];
  acc[cat].<span class="hljs-title function_">push</span>(item);
  <span class="hljs-keyword">return</span> acc;
}, {});

<span class="hljs-comment">// æ­¥éª¤5ï¼šç”Ÿæˆè®¢å•æ‘˜è¦</span>
<span class="hljs-keyword">const</span> orderSummary = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">entries</span>(byCategory).<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">[category, items]</span>) =&gt;</span> ({
  category,
  <span class="hljs-attr">count</span>: items.<span class="hljs-property">length</span>,
  <span class="hljs-attr">items</span>: items.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">i</span> =&gt;</span> ({
    <span class="hljs-attr">name</span>: i.<span class="hljs-property">name</span>,
    <span class="hljs-attr">sku</span>: i.<span class="hljs-property">sku</span>,
    <span class="hljs-attr">price</span>: i.<span class="hljs-property">unitPrice</span> || i.<span class="hljs-property">price</span>
  })),
  <span class="hljs-attr">subtotal</span>: items.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">sum, i</span>) =&gt;</span> sum + (i.<span class="hljs-property">unitPrice</span> || i.<span class="hljs-property">price</span>), <span class="hljs-number">0</span>)
}));

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'è®¢å•æ‘˜è¦:'</span>, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(orderSummary, <span class="hljs-literal">null</span>, <span class="hljs-number">2</span>));
</code></pre>
<p><strong>è¾“å‡ºç»“æœ</strong>ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">[</span>
  <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"category"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"æ‰‹æœº"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"count"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"items"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span> <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"iPhone"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"sku"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"IPHONE"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"price"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">5999</span> <span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"subtotal"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">5999</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"category"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ç”µè„‘"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"count"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">4</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"items"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
      <span class="hljs-punctuation">{</span> <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"MacBook"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"sku"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"MACBOOK-æ·±ç©ºç°-14å¯¸"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"price"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">14999</span> <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-punctuation">{</span> <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"MacBook"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"sku"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"MACBOOK-æ·±ç©ºç°-16å¯¸"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"price"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">14999</span> <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-punctuation">{</span> <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"MacBook"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"sku"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"MACBOOK-é“¶è‰²-14å¯¸"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"price"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">14999</span> <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-punctuation">{</span> <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"MacBook"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"sku"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"MACBOOK-é“¶è‰²-16å¯¸"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"price"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">14999</span> <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"subtotal"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">59996</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"category"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"é…ä»¶"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"count"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"items"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span> <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"é¼ æ ‡"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"sku"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"MOUSE"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"price"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">299</span> <span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"subtotal"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">299</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">]</span>
</code></pre>
<hr/>
<h2 data-id="heading-24">ç¬¬å››éƒ¨åˆ†ï¼šæ€§èƒ½å¯¹æ¯”ä¸æœ€ä½³å®è·µ</h2>
<h3 data-id="heading-25">æ€§èƒ½æµ‹è¯•</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// æµ‹è¯•æ•°æ®ï¼š10000 æ¡è®¢å•</span>
<span class="hljs-keyword">const</span> orders = <span class="hljs-title class_">Array</span>(<span class="hljs-number">10000</span>).<span class="hljs-title function_">fill</span>(<span class="hljs-literal">null</span>).<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">_, i</span>) =&gt;</span> ({
  <span class="hljs-attr">status</span>: i % <span class="hljs-number">2</span> === <span class="hljs-number">0</span> ? <span class="hljs-string">'paid'</span> : <span class="hljs-string">'pending'</span>,
  <span class="hljs-attr">items</span>: [<span class="hljs-string">`item-<span class="hljs-subst">${i}</span>-a`</span>, <span class="hljs-string">`item-<span class="hljs-subst">${i}</span>-b`</span>]
}));

<span class="hljs-comment">// æ–¹æ³•1ï¼šfilter + map + flat</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">time</span>(<span class="hljs-string">'filter-map-flat'</span>);
<span class="hljs-keyword">const</span> r1 = orders
  .<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">o</span> =&gt;</span> o.<span class="hljs-property">status</span> === <span class="hljs-string">'paid'</span>)
  .<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">o</span> =&gt;</span> o.<span class="hljs-property">items</span>)
  .<span class="hljs-title function_">flat</span>();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">timeEnd</span>(<span class="hljs-string">'filter-map-flat'</span>); <span class="hljs-comment">// ~2.5ms</span>

<span class="hljs-comment">// æ–¹æ³•2ï¼šflatMap</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">time</span>(<span class="hljs-string">'flatMap'</span>);
<span class="hljs-keyword">const</span> r2 = orders.<span class="hljs-title function_">flatMap</span>(<span class="hljs-function"><span class="hljs-params">o</span> =&gt;</span>
  o.<span class="hljs-property">status</span> === <span class="hljs-string">'paid'</span> ? o.<span class="hljs-property">items</span> : []
);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">timeEnd</span>(<span class="hljs-string">'flatMap'</span>); <span class="hljs-comment">// ~1.2ms</span>

<span class="hljs-comment">// flatMap å¿« 2 å€ï¼</span>
</code></pre>
<h3 data-id="heading-26">ä½¿ç”¨å£è¯€</h3>
<ol>
<li><strong>èƒ½ä¸€æ¬¡éå†åšå®Œï¼Œç»ä¸ç”¨ä¸¤æ¬¡</strong>ï¼ˆfilter + map â†’ flatMapï¼‰</li>
<li><strong>éœ€è¦æ¡ä»¶è¿‡æ»¤ + è½¬æ¢ â†’ flatMap</strong></li>
<li><strong>éœ€è¦å±•å¼€åµŒå¥—æ•°ç»„ â†’ flatMap</strong></li>
<li><strong>flatMap åªæ‰å¹³ä¸€å±‚ï¼Œæ·±åº¦æ‰å¹³éœ€è¦é€’å½’</strong></li>
<li><strong>å¤§æ•°æ®é‡ä¼˜å…ˆç”¨ flatMap å‡å°‘ä¸­é—´æ•°ç»„åˆ›å»º</strong></li>
</ol>
<hr/>
<h2 data-id="heading-27">ç¬¬äº”éƒ¨åˆ†ï¼šå¸¸è§è¸©å‘è®°å½•</h2>
<h3 data-id="heading-28">å‘ 1ï¼šè¯¯ç”¨ ?? æˆ– || å¯¼è‡´æ•°æ®ä¸¢å¤±</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> data = [<span class="hljs-number">0</span>, <span class="hljs-string">''</span>, <span class="hljs-literal">false</span>, <span class="hljs-literal">null</span>, <span class="hljs-literal">undefined</span>];

<span class="hljs-comment">// âŒ é”™è¯¯ï¼šä¼šè¿‡æ»¤æ‰ 0ã€''ã€false</span>
<span class="hljs-keyword">const</span> wrong = data.<span class="hljs-title function_">flatMap</span>(<span class="hljs-function"><span class="hljs-params">x</span> =&gt;</span> x || []); <span class="hljs-comment">// []</span>
<span class="hljs-keyword">const</span> wrong2 = data.<span class="hljs-title function_">flatMap</span>(<span class="hljs-function"><span class="hljs-params">x</span> =&gt;</span> x ?? []); <span class="hljs-comment">// []</span>

<span class="hljs-comment">// âœ… æ­£ç¡®ï¼šåªè¿‡æ»¤ null/undefined</span>
<span class="hljs-keyword">const</span> right = data.<span class="hljs-title function_">flatMap</span>(<span class="hljs-function"><span class="hljs-params">x</span> =&gt;</span> x != <span class="hljs-literal">null</span> ? [x] : []); 
<span class="hljs-comment">// [0, '', false]</span>
</code></pre>
<h3 data-id="heading-29">å‘ 2ï¼šasync å‡½æ•°ä¸èƒ½ç›´æ¥ç”¨äº flatMap</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> ids = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>];

<span class="hljs-comment">// âŒ é”™è¯¯ï¼šflatMap ä¸ä¼šç­‰å¾… Promise</span>
<span class="hljs-keyword">const</span> wrong = ids.<span class="hljs-title function_">flatMap</span>(<span class="hljs-keyword">async</span> id =&gt; {
  <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`/api/<span class="hljs-subst">${id}</span>`</span>);
  <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">json</span>();
});
<span class="hljs-comment">// è¿”å›çš„æ˜¯ [Promise, Promise, Promise]</span>

<span class="hljs-comment">// âœ… æ­£ç¡®ï¼šå…ˆç”¨ Promise.allï¼Œå†ç”¨ flatMap</span>
<span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>(ids.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">id</span> =&gt;</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`/api/<span class="hljs-subst">${id}</span>`</span>)));
<span class="hljs-keyword">const</span> results = data.<span class="hljs-title function_">flatMap</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> res.<span class="hljs-property">items</span> || []);
</code></pre>
<h3 data-id="heading-30">å‘ 3ï¼šè¿”å›éæ•°ç»„ä¼šæŠ¥é”™</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> nums = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>];

<span class="hljs-comment">// âŒ é”™è¯¯ï¼šè¿”å›éæ•°ç»„</span>
<span class="hljs-comment">// const wrong = nums.flatMap(n =&gt; n * 2); // TypeError</span>

<span class="hljs-comment">// âœ… æ­£ç¡®ï¼šè¿”å›æ•°ç»„</span>
<span class="hljs-keyword">const</span> right = nums.<span class="hljs-title function_">flatMap</span>(<span class="hljs-function"><span class="hljs-params">n</span> =&gt;</span> [n * <span class="hljs-number">2</span>]); <span class="hljs-comment">// [2, 4, 6]</span>
</code></pre>
<hr/>
<h2 data-id="heading-31">æ€»ç»“</h2>
<p>ç»è¿‡ 3 ä¸ªé¡¹ç›®çš„å®æˆ˜æ£€éªŒï¼ŒflatMap æ˜¯æˆ‘ä½¿ç”¨é¢‘ç‡æœ€é«˜çš„æ•°ç»„æ–¹æ³•ä¹‹ä¸€ã€‚å®ƒçš„æ ¸å¿ƒä¼˜åŠ¿ï¼š</p>

























<table><thead><tr><th>ä¼˜åŠ¿</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>æ€§èƒ½</td><td>å‡å°‘éå†æ¬¡æ•°ï¼Œå¤§æ•°æ®é‡æ—¶ä¼˜åŠ¿æ˜æ˜¾</td></tr><tr><td>ç®€æ´</td><td>filter + map åˆå¹¶æˆä¸€è¡Œä»£ç </td></tr><tr><td>çµæ´»</td><td>æ”¯æŒæ¡ä»¶å±•å¼€ã€åŠ¨æ€è¿”å› 0/1/N ä¸ªå…ƒç´ </td></tr><tr><td>ç»„åˆ</td><td>å¯é“¾å¼è°ƒç”¨ï¼Œæ„å»ºæ•°æ®å¤„ç†ç®¡é“</td></tr></tbody></table>
<p><strong>è®°ä½æ ¸å¿ƒå¿ƒæ³•</strong>ï¼š</p>
<ul>
<li>éœ€è¦ã€Œæ¡ä»¶è¿‡æ»¤ + è½¬æ¢ã€â†’ flatMap</li>
<li>éœ€è¦ã€Œå±•å¼€åµŒå¥—ã€â†’ flatMap</li>
<li>èƒ½ä¸€æ¬¡éå† â†’ ç»ä¸ç”¨ä¸¤æ¬¡</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Java çº¿ç¨‹åŒæ­¥-02ï¼šä¸åŒé”çŠ¶æ€ä¸‹Javaå¯¹è±¡å¤´çš„è¡¨ç°]]></title>    <link>https://juejin.cn/post/7604697194795892746</link>    <guid>https://juejin.cn/post/7604697194795892746</guid>    <pubDate>2026-02-10T03:08:31.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604697194795892746" data-draft-id="7604672395627790363" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Java çº¿ç¨‹åŒæ­¥-02ï¼šä¸åŒé”çŠ¶æ€ä¸‹Javaå¯¹è±¡å¤´çš„è¡¨ç°"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2026-02-10T03:08:31.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç™½è¡£é¸½å­"/> <meta itemprop="url" content="https://juejin.cn/user/3072451409619223"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Java çº¿ç¨‹åŒæ­¥-02ï¼šä¸åŒé”çŠ¶æ€ä¸‹Javaå¯¹è±¡å¤´çš„è¡¨ç°
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3072451409619223/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç™½è¡£é¸½å­
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T03:08:31.000Z" title="Tue Feb 10 2026 03:08:31 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å‰è¨€</h2>
<p>æœ¬æ–‡ä¸»è¦åˆ†äº«ä¸åŒé”çŠ¶æ€ä¸‹ï¼ŒJavaå¯¹è±¡å¤´çš„å¸ƒå±€æ˜¯æ€ä¹ˆæ ·çš„ï¼Œé‡ç‚¹å…³æ³¨å…¶ä¸­çš„Mark Wordå­—æ®µã€‚æ–‡ç« æ„æˆå¦‚ä¸‹ï¼šMark Wrod å­—æ®µå¯¹ç…§è¡¨ã€é”çŠ¶æ€è¡¨ã€JOLæŸ¥çœ‹å¯¹è±¡å¤´å®æˆ˜ã€å…³äºåå‘é”çš„ç‰¹æ®Šè¯´æ˜ã€‚</p>
<h2 data-id="heading-1">Mark Wordå­—æ®µå¯¹ç…§è¡¨</h2>











































































<table><thead><tr><th>English è‹±æ–‡</th><th>Chinese ä¸­æ–‡</th><th>Description æè¿°</th></tr></thead><tbody><tr><td><strong>bits</strong></td><td>ä½</td><td>Basic unit of digital information æ•°å­—ä¿¡æ¯çš„åŸºæœ¬å•ä½</td></tr><tr><td><strong>unused</strong></td><td>æœªä½¿ç”¨</td><td>Reserved space, not currently used ä¿ç•™ç©ºé—´ï¼Œå½“å‰æœªä½¿ç”¨</td></tr><tr><td><strong>identity_hashcode</strong></td><td>å¯¹è±¡å“ˆå¸Œç </td><td>Unique hash code of the object å¯¹è±¡çš„å”¯ä¸€å“ˆå¸Œç </td></tr><tr><td><strong>age</strong></td><td>GCå¹´é¾„</td><td>Generation count in garbage collection åƒåœ¾å›æ”¶ä¸­çš„åˆ†ä»£è®¡æ•°</td></tr><tr><td><strong>thread</strong></td><td>çº¿ç¨‹ID</td><td>Identifier of the thread holding the lock æŒæœ‰é”çš„çº¿ç¨‹æ ‡è¯†ç¬¦</td></tr><tr><td><strong>epoch</strong></td><td>æ—¶é—´æˆ³/ç‰ˆæœ¬å·</td><td>Timestamp or version for biased locks åå‘é”çš„æ—¶é—´æˆ³æˆ–ç‰ˆæœ¬å·</td></tr><tr><td><strong>ptr_to_lock_record</strong></td><td>æŒ‡å‘æ ˆä¸­é”è®°å½•çš„æŒ‡é’ˆ</td><td>Pointer to lock record in thread stack æŒ‡å‘çº¿ç¨‹æ ˆä¸­é”è®°å½•çš„æŒ‡é’ˆ</td></tr><tr><td><strong>ptr_to_monitor</strong></td><td>æŒ‡å‘Monitorå¯¹è±¡çš„æŒ‡é’ˆ</td><td>Pointer to ObjectMonitor object æŒ‡å‘ObjectMonitorå¯¹è±¡çš„æŒ‡é’ˆ</td></tr><tr><td><strong>Normal (Unlocked)</strong></td><td>æ— é”çŠ¶æ€</td><td>No thread holds the lock æ— çº¿ç¨‹æŒæœ‰é”</td></tr><tr><td><strong>Biased Lock</strong></td><td>åå‘é”</td><td>Lock biased towards first acquiring thread åå‘äºç¬¬ä¸€ä¸ªè·å–é”çš„çº¿ç¨‹</td></tr><tr><td><strong>Thin Lock</strong></td><td>è½»é‡çº§é”</td><td>Lock using CAS and stack records ä½¿ç”¨CASå’Œæ ˆè®°å½•çš„é”</td></tr><tr><td><strong>Fat Lock</strong></td><td>é‡é‡çº§é”</td><td>Lock using OS-level monitor ä½¿ç”¨æ“ä½œç³»ç»Ÿçº§ç›‘è§†å™¨çš„é”</td></tr><tr><td><strong>GC Marked</strong></td><td>GCæ ‡è®°</td><td>Object marked during garbage collection åƒåœ¾å›æ”¶æœŸé—´æ ‡è®°çš„å¯¹è±¡</td></tr></tbody></table>
<h2 data-id="heading-2">çŠ¶æ€è¡¨</h2>















































<table><thead><tr><th>é”çŠ¶æ€</th><th>é”æ ‡å¿—ä½ (2 bits)</th><th>åå‘é”æ ‡å¿— (1 bit)</th><th>Mark Word 64ä½ç»“æ„ (é«˜ä½ â†’ ä½ä½)</th><th>å­˜å‚¨å†…å®¹è¯´æ˜</th></tr></thead><tbody><tr><td><strong>æ— é”çŠ¶æ€</strong></td><td><strong>01</strong></td><td><strong>0</strong></td><td><code>25 bits unused</code>Â |Â <code>31 bits identity_hashcode</code>Â |Â <code>1 bit unused</code>Â |Â <code>4 bits age</code>Â |Â <code>0</code>Â |Â <code>01</code></td><td>â€¢ 31ä½ï¼šå¯¹è±¡å“ˆå¸Œç ï¼ˆç¬¬ä¸€æ¬¡è°ƒç”¨hashCode()æ—¶ç”Ÿæˆï¼‰<br/>â€¢ 4ä½ï¼šGCåˆ†ä»£å¹´é¾„ï¼ˆ0-15ï¼‰<br/>â€¢ 25ä½ï¼šæœªä½¿ç”¨<br/>â€¢ 1ä½ï¼šæœªä½¿ç”¨</td></tr><tr><td><strong>åå‘é”çŠ¶æ€</strong></td><td><strong>01</strong></td><td><strong>1</strong></td><td><code>54 bits thread</code>Â |Â <code>2 bits epoch</code>Â |Â <code>1 bit unused</code>Â |Â <code>4 bits age</code>Â |Â <code>1</code>Â |Â <code>01</code></td><td>â€¢ 54ä½ï¼šæŒæœ‰åå‘é”çš„çº¿ç¨‹ID<br/>â€¢ 2ä½ï¼šepochï¼ˆåå‘é”æ—¶é—´æˆ³ï¼‰<br/>â€¢ 4ä½ï¼šGCåˆ†ä»£å¹´é¾„<br/>â€¢ 1ä½ï¼šæœªä½¿ç”¨</td></tr><tr><td><strong>è½»é‡çº§é”çŠ¶æ€</strong></td><td><strong>00</strong></td><td>-</td><td><code>62 bits ptr_to_lock_record</code>Â |Â <code>00</code></td><td>â€¢ 62ä½ï¼šæŒ‡å‘æ ˆä¸­é”è®°å½•çš„æŒ‡é’ˆ<br/>â€¢ æŒ‡é’ˆæœ€å2ä½å®é™…ä¸º00ï¼ˆå¯¹é½è¦æ±‚ï¼‰</td></tr><tr><td><strong>é‡é‡çº§é”çŠ¶æ€</strong></td><td><strong>10</strong></td><td>-</td><td><code>62 bits ptr_to_monitor</code>Â |Â <code>10</code></td><td>â€¢ 62ä½ï¼šæŒ‡å‘ObjectMonitorå¯¹è±¡çš„æŒ‡é’ˆ<br/>â€¢ æŒ‡é’ˆæŒ‡å‘å †ä¸­çš„Monitorå®ä¾‹</td></tr><tr><td><strong>GCæ ‡è®°çŠ¶æ€</strong></td><td><strong>11</strong></td><td>-</td><td><code>62 bits GC information</code>Â |Â <code>11</code></td><td>â€¢ 62ä½ï¼šåƒåœ¾æ”¶é›†ç›¸å…³ä¿¡æ¯<br/>â€¢ ä¸åŒGCç®—æ³•å†…å®¹ä¸åŒ</td></tr></tbody></table>
<h2 data-id="heading-3">JOLå·¥å…·æŸ¥çœ‹å¯¹è±¡å¤´</h2>
<p>JOLï¼ˆJava Object Layoutï¼‰æ˜¯OpenJDKæä¾›çš„å®˜æ–¹å·¥å…·ï¼Œä¸“é—¨ç”¨äºåˆ†æJavaå¯¹è±¡çš„å†…å­˜å¸ƒå±€ã€‚åœ¨é¡¹ç›®ä¸­å¼•å…¥ç›¸å…³ä»£ç ä¾èµ–å¯ä»¥å‚è€ƒå¦‚ä¸‹ï¼š</p>
<p><strong>Maven:</strong></p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.openjdk.jol<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jol-core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>0.17<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>provided<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<p><strong>Gradle:</strong></p>
<pre><code class="hljs language-gradle" lang="gradle">dependencies {
    compileOnly 'org.openjdk.jol:jol-core:0.17'
}
</code></pre>
<p>ä¸‹é¢ç»™å‡ºä¸€ä¸ªä¸åŒé”çŠ¶æ€ä¸‹æŸ¥çœ‹å¯¹è±¡å¤´å¸ƒå±€çš„ä»£ç ç¤ºä¾‹ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥æœ¬åœ°è¿è¡Œï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> concurrent;

<span class="hljs-keyword">import</span> org.openjdk.jol.info.ClassLayout;

<span class="hljs-comment">/**
 * ä½¿ç”¨ JOLï¼ˆJava Object Layoutï¼‰æŸ¥çœ‹ Java å¯¹è±¡å¤´åœ¨ä¸åŒé”çŠ¶æ€ä¸‹çš„å˜åŒ–ã€‚
 * é¡ºåºï¼šæ— é” â†’ æ— é”(å« hash) â†’ åå‘é” â†’ è½»é‡çº§é” â†’ é‡é‡çº§é”ã€‚
 *
 * è¦çœ‹åˆ°ã€Œåå‘é”ã€å¿…é¡»å¼€å¯ JVM åå‘é”å¹¶å»æ‰å¯åŠ¨å»¶è¿Ÿï¼Œæ¨èè¿è¡Œï¼š
 *   ./gradlew runObjectHeaderDemo
 * ï¼ˆè¯¥ä»»åŠ¡å·²è‡ªåŠ¨æ·»åŠ  -XX:+UseBiasedLocking -XX:BiasedLockingStartupDelay=0ï¼‰
 *
 * è‹¥ä»ç”¨ runMain ä¸”æœªåŠ ä¸Šè¿° VM å‚æ•°ï¼ŒJDK 15+ ä¸‹ç¬¬ 3 æ­¥ä¼šæ˜¾ç¤º thin lock è€Œé biased lockã€‚
 * JDK 18+ å·²ç§»é™¤åå‘é”ï¼Œåªèƒ½çœ‹åˆ°è½»é‡çº§/é‡é‡çº§ã€‚
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ObjectHeaderDemo</span> {

    <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SimpleObject</span> {
        <span class="hljs-type">int</span> <span class="hljs-variable">x</span> <span class="hljs-operator">=</span> <span class="hljs-number">42</span>;
        <span class="hljs-type">long</span> <span class="hljs-variable">y</span> <span class="hljs-operator">=</span> <span class="hljs-number">100L</span>;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException {
        <span class="hljs-comment">// ç”¨äºå±•ç¤ºï¼šæ— é” â†’ æ— é”+hash â†’ è½»é‡çº§ â†’ é‡é‡çº§ï¼ˆæ­¤å¯¹è±¡ä¼šå…ˆç®— hashï¼Œå› æ­¤ä¸ä¼šè¿›å…¥åå‘ï¼‰</span>
        <span class="hljs-type">SimpleObject</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleObject</span>();

        <span class="hljs-comment">// 1. æ— é”</span>
        System.out.println(<span class="hljs-string">"=== 1. åˆå§‹çŠ¶æ€ï¼ˆæ— é”ï¼‰ ==="</span>);
        System.out.println(ClassLayout.parseInstance(obj).toPrintable());

        <span class="hljs-comment">// 2. æ— é”ä½†å·²å†™å…¥ identity hashCodeï¼ˆä¸€æ—¦å†™å…¥ hashï¼Œè¯¥å¯¹è±¡æ°¸è¿œæ— æ³•è¿›å…¥åå‘é”ï¼‰</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">hc</span> <span class="hljs-operator">=</span> System.identityHashCode(obj);
        System.out.println(<span class="hljs-string">"identityHashCode = 0x"</span> + Integer.toHexString(hc));
        System.out.println(<span class="hljs-string">"\n=== 2. å†™å…¥ hashCode åï¼ˆæ— é”ï¼Œä¸”æ­¤å¯¹è±¡ä¹‹åæ— æ³•åå‘ï¼‰ ==="</span>);
        System.out.println(ClassLayout.parseInstance(obj).toPrintable());

        <span class="hljs-comment">// 3. åå‘é”ï¼šå¿…é¡»ç”¨ã€Œä»æœªç®—è¿‡ hashã€çš„å¯¹è±¡ï¼Œä¸”è¦ç­‰åå‘ç”Ÿæ•ˆï¼ˆé»˜è®¤çº¦ 4sï¼‰</span>
        <span class="hljs-type">SimpleObject</span> <span class="hljs-variable">biasedCandidate</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleObject</span>();
        System.out.println(<span class="hljs-string">"\n=== 3. åå‘é”ï¼ˆç­‰å¾… "</span> + <span class="hljs-number">5</span> + <span class="hljs-string">" ç§’è®© JVM å¼€å¯è¯¥ç±»åå‘ï¼Œä¸”æ­¤å¯¹è±¡ä»æœªè°ƒç”¨ identityHashCodeï¼‰ ==="</span>);
        Thread.sleep(<span class="hljs-number">5000</span>);
        <span class="hljs-keyword">synchronized</span> (biasedCandidate) {
            System.out.println(ClassLayout.parseInstance(biasedCandidate).toPrintable());
        }

        <span class="hljs-comment">// 4. è½»é‡çº§é”ï¼šå¯¹å·²å†™ hash çš„ obj åŠ é”ï¼Œåªèƒ½æ˜¯è½»é‡çº§</span>
        System.out.println(<span class="hljs-string">"\n=== 4. è½»é‡çº§é”ï¼ˆåŒä¸€çº¿ç¨‹å¯¹ obj åŠ é”ï¼‰ ==="</span>);
        <span class="hljs-keyword">synchronized</span> (obj) {
            System.out.println(ClassLayout.parseInstance(obj).toPrintable());
        }

        <span class="hljs-comment">// 5. å¤šçº¿ç¨‹ç«äº‰ â†’ é‡é‡çº§é”</span>
        System.out.println(<span class="hljs-string">"\n=== 5. å¤šçº¿ç¨‹ç«äº‰ä¸‹çš„å¯¹è±¡å¤´ï¼ˆå¯èƒ½è†¨èƒ€ä¸ºé‡é‡çº§é”ï¼‰ ==="</span>);
        showContendedLockStates(obj);
    }

    <span class="hljs-comment">/**
     * å±•ç¤ºåœ¨å¤šçº¿ç¨‹ç«äº‰åŒä¸€ä¸ªé”æ—¶ï¼Œå¯¹è±¡å¤´çš„å˜åŒ–ã€‚
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">showContendedLockStates</span><span class="hljs-params">(SimpleObject obj)</span> <span class="hljs-keyword">throws</span> InterruptedException {
        <span class="hljs-type">Thread</span> <span class="hljs-variable">t1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
            <span class="hljs-keyword">synchronized</span> (obj) {
                System.out.println(<span class="hljs-string">"T1 è·å–åˆ°é”æ—¶çš„å¯¹è±¡å¤´ï¼š"</span>);
                System.out.println(ClassLayout.parseInstance(obj).toPrintable());
                <span class="hljs-comment">// ä¿æŒä¸€æ®µæ—¶é—´ï¼Œè®© T2 æœ‰æœºä¼šç«äº‰è¿™æŠŠé”</span>
                sleepQuietly(<span class="hljs-number">500</span>);
            }
            System.out.println(<span class="hljs-string">"T1 é‡Šæ”¾é”åç»“æŸ"</span>);
        }, <span class="hljs-string">"T1-holder"</span>);

        <span class="hljs-type">Thread</span> <span class="hljs-variable">t2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
            <span class="hljs-comment">// å…ˆç¨å¾®ç­‰å¾…ï¼Œå°½é‡ä¿è¯åœ¨ T1 å·²ç»æŒé”çš„æƒ…å†µä¸‹æ¥ç«äº‰</span>
            sleepQuietly(<span class="hljs-number">50</span>);
            <span class="hljs-keyword">synchronized</span> (obj) {
                System.out.println(<span class="hljs-string">"T2 ç«äº‰å¹¶è·å–åˆ°é”æ—¶çš„å¯¹è±¡å¤´ï¼š"</span>);
                System.out.println(ClassLayout.parseInstance(obj).toPrintable());
            }
            System.out.println(<span class="hljs-string">"T2 é‡Šæ”¾é”åç»“æŸ"</span>);
        }, <span class="hljs-string">"T2-contender"</span>);

        System.out.println(<span class="hljs-string">"ä¸»çº¿ç¨‹ï¼šå¯åŠ¨ T1ã€T2 ä¹‹å‰çš„å¯¹è±¡å¤´ï¼š"</span>);
        System.out.println(ClassLayout.parseInstance(obj).toPrintable());

        t1.start();
        t2.start();

        t1.join();
        t2.join();

        System.out.println(<span class="hljs-string">"ä¸»çº¿ç¨‹ï¼šT1ã€T2 éƒ½ç»“æŸåçš„å¯¹è±¡å¤´ï¼š"</span>);
        System.out.println(ClassLayout.parseInstance(obj).toPrintable());
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sleepQuietly</span><span class="hljs-params">(<span class="hljs-type">long</span> ms)</span> {
        <span class="hljs-keyword">try</span> {
            Thread.sleep(ms);
        } <span class="hljs-keyword">catch</span> (InterruptedException e) {
            Thread.currentThread().interrupt();
        }
    }
}
</code></pre>
<p>ä»¥ä¸Šä»£ç åœ¨æˆ‘æœ¬åœ°è¿è¡Œçš„ç»“æœï¼Œå¯å‚è€ƒå¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-shell" lang="shell"> code git:(main) âœ— ./gradlew runObjectHeaderDemo
<span class="hljs-meta prompt_">
&gt; </span><span class="bash">Task :runObjectHeaderDemo</span>
OpenJDK 64-Bit Server VM warning: Option UseBiasedLocking was deprecated in version 15.0 and will likely be removed in a future release.
OpenJDK 64-Bit Server VM warning: Option BiasedLockingStartupDelay was deprecated in version 15.0 and will likely be removed in a future release.
=== 1. åˆå§‹çŠ¶æ€ï¼ˆæ— é”ï¼‰ ===
<span class="hljs-meta prompt_"># </span><span class="bash">WARNING: Unable to attach Serviceability Agent. You can try again with escalated privileges. Two options: a) use -Djol.tryWithSudo=<span class="hljs-literal">true</span> to try with sudo; b) <span class="hljs-built_in">echo</span> 0 | sudo <span class="hljs-built_in">tee</span> /proc/sys/kernel/yama/ptrace_scope</span>
concurrent.ObjectHeaderDemo$SimpleObject object internals:
OFF  SZ   TYPE DESCRIPTION               VALUE
  0   8        (object header: mark)     0x0000000000000005 (biasable; age: 0)
  8   4        (object header: class)    0x00000a30
 12   4    int SimpleObject.x            42
 16   8   long SimpleObject.y            100
Instance size: 24 bytes
Space losses: 0 bytes internal + 0 bytes external = 0 bytes total

identityHashCode = 0x15ff3e9e

=== 2. å†™å…¥ hashCode åï¼ˆæ— é”ï¼Œä¸”æ­¤å¯¹è±¡ä¹‹åæ— æ³•åå‘ï¼‰ ===
concurrent.ObjectHeaderDemo$SimpleObject object internals:
OFF  SZ   TYPE DESCRIPTION               VALUE
  0   8        (object header: mark)     0x00000015ff3e9e01 (hash: 0x15ff3e9e; age: 0)
  8   4        (object header: class)    0x00000a30
 12   4    int SimpleObject.x            42
 16   8   long SimpleObject.y            100
Instance size: 24 bytes
Space losses: 0 bytes internal + 0 bytes external = 0 bytes total


=== 3. åå‘é”ï¼ˆç­‰å¾… 5 ç§’è®© JVM å¼€å¯è¯¥ç±»åå‘ï¼Œä¸”æ­¤å¯¹è±¡ä»æœªè°ƒç”¨ identityHashCodeï¼‰ ===
concurrent.ObjectHeaderDemo$SimpleObject object internals:
OFF  SZ   TYPE DESCRIPTION               VALUE
  0   8        (object header: mark)     0x00007fb3c9008805 (biased: 0x0000001fecf24022; epoch: 0; age: 0)
  8   4        (object header: class)    0x00000a30
 12   4    int SimpleObject.x            42
 16   8   long SimpleObject.y            100
Instance size: 24 bytes
Space losses: 0 bytes internal + 0 bytes external = 0 bytes total


=== 4. è½»é‡çº§é”ï¼ˆåŒä¸€çº¿ç¨‹å¯¹ obj åŠ é”ï¼‰ ===
concurrent.ObjectHeaderDemo$SimpleObject object internals:
OFF  SZ   TYPE DESCRIPTION               VALUE
  0   8        (object header: mark)     0x000070000c139ab0 (thin lock: 0x000070000c139ab0)
  8   4        (object header: class)    0x00000a30
 12   4    int SimpleObject.x            42
 16   8   long SimpleObject.y            100
Instance size: 24 bytes
Space losses: 0 bytes internal + 0 bytes external = 0 bytes total


=== 5. å¤šçº¿ç¨‹ç«äº‰ä¸‹çš„å¯¹è±¡å¤´ï¼ˆå¯èƒ½è†¨èƒ€ä¸ºé‡é‡çº§é”ï¼‰ ===
ä¸»çº¿ç¨‹ï¼šå¯åŠ¨ T1ã€T2 ä¹‹å‰çš„å¯¹è±¡å¤´ï¼š
concurrent.ObjectHeaderDemo$SimpleObject object internals:
OFF  SZ   TYPE DESCRIPTION               VALUE
  0   8        (object header: mark)     0x00000015ff3e9e01 (hash: 0x15ff3e9e; age: 0)
  8   4        (object header: class)    0x00000a30
 12   4    int SimpleObject.x            42
 16   8   long SimpleObject.y            100
Instance size: 24 bytes
Space losses: 0 bytes internal + 0 bytes external = 0 bytes total

T1 è·å–åˆ°é”æ—¶çš„å¯¹è±¡å¤´ï¼š
concurrent.ObjectHeaderDemo$SimpleObject object internals:
OFF  SZ   TYPE DESCRIPTION               VALUE
  0   8        (object header: mark)     0x000070000d59fa10 (thin lock: 0x000070000d59fa10)
  8   4        (object header: class)    0x00000a30
 12   4    int SimpleObject.x            42
 16   8   long SimpleObject.y            100
Instance size: 24 bytes
Space losses: 0 bytes internal + 0 bytes external = 0 bytes total

T1 é‡Šæ”¾é”åç»“æŸ
T2 ç«äº‰å¹¶è·å–åˆ°é”æ—¶çš„å¯¹è±¡å¤´ï¼š
concurrent.ObjectHeaderDemo$SimpleObject object internals:
OFF  SZ   TYPE DESCRIPTION               VALUE
  0   8        (object header: mark)     0x00007fb3d0013712 (fat lock: 0x00007fb3d0013712)
  8   4        (object header: class)    0x00000a30
 12   4    int SimpleObject.x            42
 16   8   long SimpleObject.y            100
Instance size: 24 bytes
Space losses: 0 bytes internal + 0 bytes external = 0 bytes total

T2 é‡Šæ”¾é”åç»“æŸ
ä¸»çº¿ç¨‹ï¼šT1ã€T2 éƒ½ç»“æŸåçš„å¯¹è±¡å¤´ï¼š
concurrent.ObjectHeaderDemo$SimpleObject object internals:
OFF  SZ   TYPE DESCRIPTION               VALUE
  0   8        (object header: mark)     0x00007fb3d0013712 (fat lock: 0x00007fb3d0013712)
  8   4        (object header: class)    0x00000a30
 12   4    int SimpleObject.x            42
 16   8   long SimpleObject.y            100
Instance size: 24 bytes
Space losses: 0 bytes internal + 0 bytes external = 0 bytes total
</code></pre>
<h2 data-id="heading-4">å…³äºåå‘é”çš„ç‰¹æ®Šè¯´æ˜</h2>
<p>Javaé«˜ç‰ˆæœ¬é€æ¸ç§»é™¤åå‘é”ï¼Œç§»é™¤æ—¶é—´çº¿ï¼š</p>
<ul>
<li><strong>JDK 15</strong>: é»˜è®¤ç¦ç”¨åå‘é”ï¼ˆ<code>-XX:-UseBiasedLocking</code>ï¼‰</li>
<li><strong>JDK 18</strong>: å®Œå…¨ç§»é™¤åå‘é”ç›¸å…³ä»£ç </li>
<li><strong>å½“å‰çŠ¶æ€</strong>: æ‰€æœ‰ç°ä»£JVMç‰ˆæœ¬ï¼ˆJDK 18+ï¼‰éƒ½ä¸æ”¯æŒåå‘é”</li>
</ul>
<p>æ®æˆ‘æ‰€è§‚å¯Ÿï¼Œåå‘é”æœªå‡ºç°é€šå¸¸æœ‰ä¸‰ä¸ªå¯èƒ½åŸå› ï¼š</p>
<ol>
<li>å…ˆè°ƒç”¨äº†Â System.identityHashCode(obj)ï¼Œå¯¹è±¡å¤´é‡Œå†™å…¥äº† hashï¼Œå°±æ— æ³•å†è¿›å…¥åå‘é”ã€‚</li>
<li>åå‘æœ‰â€œå»¶è¿Ÿç”Ÿæ•ˆâ€ï¼ˆé»˜è®¤çº¦ 4 ç§’ï¼‰ï¼Œåˆš new å‡ºæ¥çš„å¯¹è±¡ä¸ä¼šç«‹åˆ»åå‘ã€‚</li>
<li>JDKç‰ˆæœ¬è¾ƒé«˜ï¼ŒJVMé»˜è®¤æœªå¼€å¯æˆ–è€…å·²ç»ç§»é™¤åå‘é”çš„ä½¿ç”¨ã€‚</li>
</ol>
<p>åœ¨æˆ‘æœ¬åœ°é¡¹ç›®è¿è¡Œè¿‡ç¨‹ä¸­ä½¿ç”¨çš„æ˜¯JDK17ï¼Œå¯ä»¥åœ¨è¿è¡Œæ—¶åŠ å…¥ä»¥ä¸‹JVMå‚æ•°ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// è¿è¡Œå¯¹è±¡å¤´ç¤ºä¾‹å¹¶å¼€å¯åå‘é”ï¼ˆä»… JDK 8~17 æœ‰æ•ˆï¼ŒJDK 18+ å·²ç§»é™¤åå‘é”ï¼‰</span>
tasks.register&lt;JavaExec&gt;(<span class="hljs-string">"runObjectHeaderDemo"</span>) {
    group = <span class="hljs-string">"application"</span>
    description = <span class="hljs-string">"Run ObjectHeaderDemo with -XX:+UseBiasedLocking to see biased lock state"</span>
    javaLauncher.set(javaToolchains.launcherFor {
        languageVersion.set(JavaLanguageVersion.of(<span class="hljs-number">17</span>))
    })
    mainClass.set(<span class="hljs-string">"concurrent.ObjectHeaderDemo"</span>)
    classpath = sourceSets[<span class="hljs-string">"main"</span>].runtimeClasspath
    <span class="hljs-title function_">jvmArgs</span><span class="hljs-params">(
        <span class="hljs-string">"-XX:+UseBiasedLocking"</span>,
        <span class="hljs-string">"-XX:BiasedLockingStartupDelay=0"</span>,
        <span class="hljs-string">"-Djdk.attach.allowAttachSelf=true"</span>  // è®© JOL èƒ½ attach å½“å‰è¿›ç¨‹ï¼Œé¿å… ClassLoader é‡å¤åŠ è½½å¯¼è‡´å¼‚å¸¸
    )</span>
}
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Flink ClickHouse Sinkï¼šç”Ÿäº§çº§é«˜å¯ç”¨å†™å…¥æ–¹æ¡ˆï½œå¾—ç‰©æŠ€æœ¯]]></title>    <link>https://juejin.cn/post/7604701848150556672</link>    <guid>https://juejin.cn/post/7604701848150556672</guid>    <pubDate>2026-02-10T03:11:38.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604701848150556672" data-draft-id="7604678037808644132" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Flink ClickHouse Sinkï¼šç”Ÿäº§çº§é«˜å¯ç”¨å†™å…¥æ–¹æ¡ˆï½œå¾—ç‰©æŠ€æœ¯"/> <meta itemprop="keywords" content="åç«¯,å¤§æ•°æ®"/> <meta itemprop="datePublished" content="2026-02-10T03:11:38.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å¾—ç‰©æŠ€æœ¯"/> <meta itemprop="url" content="https://juejin.cn/user/2392954206960247"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Flink ClickHouse Sinkï¼šç”Ÿäº§çº§é«˜å¯ç”¨å†™å…¥æ–¹æ¡ˆï½œå¾—ç‰©æŠ€æœ¯
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2392954206960247/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å¾—ç‰©æŠ€æœ¯
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T03:11:38.000Z" title="Tue Feb 10 2026 03:11:38 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»19åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä¸€ã€èƒŒæ™¯ä¸ç—›ç‚¹</h2>
<h3 data-id="heading-1">ä¸šåŠ¡åœºæ™¯</h3>
<p>åœ¨å®æ—¶å¤§æ•°æ®å¤„ç†åœºæ™¯ä¸­ï¼ŒFlink + ClickHouse çš„ç»„åˆè¢«å¹¿æ³›åº”ç”¨äºï¼š</p>
<ul>
<li><strong>æ—¥å¿—å¤„ç†ï¼š</strong> æµ·é‡åº”ç”¨æ—¥å¿—å®æ—¶å†™å…¥åˆ†æåº“ã€‚</li>
<li><strong>ç›‘æ§åˆ†æï¼š</strong> ä¸šåŠ¡æŒ‡æ ‡ã€APM æ•°æ®çš„å®æ—¶èšåˆã€‚</li>
</ul>
<p>è¿™äº›åœºæ™¯çš„å…±åŒç‰¹ç‚¹ï¼š</p>
<ul>
<li><strong>æ•°æ®é‡å¤§</strong>ï¼šç™¾ä¸‡çº§ TPSï¼Œå³°å€¼å¯è¾¾åƒä¸‡çº§ã€‚</li>
<li><strong>å†™å…¥å»¶è¿Ÿæ•æ„Ÿï¼š</strong> éœ€è¦ç§’çº§å¯è§ã€‚</li>
<li><strong>æ•°æ®å‡†ç¡®æ€§è¦æ±‚é«˜</strong>ï¼šä¸å…è®¸æ•°æ®ä¸¢å¤±ã€‚</li>
<li><strong>å¤šè¡¨å†™å…¥ï¼š</strong> ä¸åŒæ•°æ®æ ¹æ®åˆ†è¡¨ç­–ç•¥å†™å…¥ä¸åŒçš„è¡¨ã€‚</li>
</ul>
<h3 data-id="heading-2">å¼€æº Flink ClickHouse Sink çš„ç—›ç‚¹</h3>
<p>Flink å®˜æ–¹æä¾›çš„ ClickHouse Sinkï¼ˆflink-connector-jdbcï¼‰åœ¨ç”Ÿäº§ç¯å¢ƒä¸­å­˜åœ¨ä»¥ä¸‹ä¸¥é‡é—®é¢˜ï¼š</p>
<h4 data-id="heading-3">ç—›ç‚¹ä¸€ï¼šç¼ºä¹åŸºäºæ•°æ®é‡çš„æ”’æ‰¹æœºåˆ¶</h4>
<p><strong>é—®é¢˜è¡¨ç°ï¼š</strong></p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// Flink å®˜æ–¹ JDBC Sink çš„å®ç°</span>
<span class="hljs-keyword">public</span>Â <span class="hljs-keyword">class</span>Â <span class="hljs-title">JdbcSink</span>&lt;<span class="hljs-title">T</span>&gt;Â <span class="hljs-title">extends</span>Â <span class="hljs-title">RichSinkFunction</span>&lt;<span class="hljs-title">T</span>&gt; {
Â  Â Â <span class="hljs-keyword">private</span>Â finalÂ <span class="hljs-built_in">int</span>Â batchSize; Â <span class="hljs-comment">// å›ºå®šæ‰¹æ¬¡å¤§å°</span>
Â  Â  @Override
Â  Â Â <span class="hljs-function"><span class="hljs-keyword">public</span>Â <span class="hljs-keyword">void</span>Â <span class="hljs-title">invoke</span>(<span class="hljs-params">TÂ <span class="hljs-keyword">value</span>, Context context</span>)</span>Â {
Â  Â  Â  Â  bufferedValues.<span class="hljs-keyword">add</span>(<span class="hljs-keyword">value</span>);
Â  Â  Â  Â Â <span class="hljs-keyword">if</span>Â (bufferedValues.size() &gt;= batchSize) {
Â  Â  Â  Â  Â  Â Â <span class="hljs-comment">// åªèƒ½åŸºäºè®°å½•æ•°æ”’æ‰¹ï¼Œæ— æ³•åŸºäºæ•°æ®é‡</span>
Â  Â  Â  Â  Â  Â  flush();
Â  Â  Â  Â  }
Â  Â  }
</code></pre>
<p><strong>å¸¦æ¥çš„é—®é¢˜ï¼š</strong></p>
<ol>
<li><strong>å†…å­˜å ç”¨ä¸å¯æ§ï¼š</strong> 100 æ¡ 1KB çš„æ—¥å¿—å’Œ 100 æ¡ 10MB çš„æ—¥å¿—å ç”¨å†…å­˜å·®è· 100 å€ã€‚</li>
<li><strong>OOM é£é™©é«˜ï¼š</strong> å¤§æ—¥å¿—è®°å½•ï¼ˆå¦‚å †æ ˆè½¬å‚¨ï¼‰ä¼šè¿…é€Ÿæ’‘çˆ†å†…å­˜ã€‚</li>
<li><strong>å†™å…¥æ€§èƒ½å·®ï¼š</strong> æ— æ³•æ ¹æ®è®°å½•å¤§å°åŠ¨æ€è°ƒæ•´æ‰¹æ¬¡ï¼Œå¯¼è‡´å°è®°å½•æ‰¹æ¬¡è¿‡å¤§æµªè´¹ç½‘ç»œå¼€é”€ã€‚</li>
</ol>
<h4 data-id="heading-4">ç—›ç‚¹äºŒï¼šæ— æ³•æ”¯æŒåŠ¨æ€è¡¨ç»“æ„</h4>
<p><strong>é—®é¢˜è¡¨ç°ï¼š</strong></p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// Flink å®˜æ–¹ Sink åªèƒ½å†™å…¥å›ºå®šè¡¨</span>
<span class="hljs-keyword">public</span>Â <span class="hljs-keyword">class</span>Â <span class="hljs-title class_">JdbcSink</span>Â {
Â  Â Â <span class="hljs-keyword">private</span>Â <span class="hljs-keyword">final</span>Â <span class="hljs-type">String</span>Â sql; Â <span class="hljs-comment">// å›ºå®šçš„ INSERT SQL</span>
Â  Â Â <span class="hljs-function"><span class="hljs-keyword">public</span>Â <span class="hljs-title">JdbcSink</span><span class="hljs-params">(<span class="hljs-type">String</span>Â jdbcUrl,Â <span class="hljs-type">String</span>Â sql, ...)</span> </span>{
Â  Â  Â  Â Â <span class="hljs-keyword">this</span>.sqlÂ = sql; Â <span class="hljs-comment">// ç¡¬ç¼–ç çš„è¡¨ç»“æ„</span>
Â  Â  }
}
</code></pre>
<p><strong>å¸¦æ¥çš„é—®é¢˜ï¼š</strong></p>
<ol>
<li><strong>å¤šåº”ç”¨æ— æ³•éš”ç¦»ï¼š</strong> æ‰€æœ‰åº”ç”¨çš„æ•°æ®å†™å…¥åŒä¸€å¼ è¡¨ï¼Œé€šè¿‡ç‰¹å®šåˆ†è¡¨ç­–ç•¥åŒºåˆ†ã€‚</li>
<li><strong>æ‰©å±•æ€§å·®ï¼š</strong> æ–°å¢åº”ç”¨éœ€è¦æ‰‹åŠ¨å»ºè¡¨ï¼Œæ— æ³•åŠ¨æ€è·¯ç”±ã€‚</li>
<li><strong>æ€§èƒ½ç“¶é¢ˆï¼š</strong> å•è¡¨æ•°æ®é‡è¿‡å¤§ï¼ˆç™¾äº¿çº§ï¼‰ï¼ŒæŸ¥è¯¢å’Œå†™å…¥æ€§èƒ½æ€¥å‰§ä¸‹é™ã€‚</li>
</ol>
<h4 data-id="heading-5">ç—›ç‚¹ä¸‰ï¼šåˆ†å¸ƒå¼è¡¨å†™å…¥æ€§èƒ½é—®é¢˜</h4>
<p><strong>é—®é¢˜è¡¨ç°ï¼š</strong></p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-operator">/</span><span class="hljs-operator">/</span> å¤§å¤šæ•°ç”Ÿäº§å®ç°ç›´æ¥å†™å…¥åˆ†å¸ƒå¼è¡¨
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> distributed_table_allÂ <span class="hljs-keyword">VALUES</span>Â (...)
</code></pre>
<p><strong>ClickHouse åˆ†å¸ƒå¼è¡¨çš„å·¥ä½œåŸç†ï¼š</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/119927d3b86e4b89ad0df2f1d8ae0ca2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771297904&amp;x-signature=lMTfG4%2FdIpgbs5q5vY4%2BgK2837c%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p><strong>å¸¦æ¥çš„é—®é¢˜ï¼š</strong></p>
<ol>
<li><strong>ç½‘ç»œå¼€é”€å¤§ï¼š</strong> æ•°æ®éœ€è¦ç»è¿‡åˆ†å¸ƒå¼è¡¨å±‚è½¬å‘ï¼Œå»¶è¿Ÿå¢åŠ ã€‚</li>
<li><strong>å†™å…¥æ€§èƒ½å·®ï¼š</strong> åˆ†å¸ƒå¼è¡¨å¢åŠ äº†è·¯ç”±å’Œè½¬å‘é€»è¾‘ï¼Œååé‡é™ä½ã€‚</li>
<li><strong>çƒ­ç‚¹é—®é¢˜ï¼š</strong> æ‰€æœ‰æ•°æ®å…ˆåˆ°åˆ†å¸ƒå¼è¡¨èŠ‚ç‚¹ï¼Œå†è½¬å‘ï¼Œé€ æˆå•ç‚¹ç“¶é¢ˆã€‚</li>
</ol>
<h3 data-id="heading-6">ç”Ÿäº§çº§æ–¹æ¡ˆçš„æ ¸å¿ƒæ”¹è¿›</h3>
<p>é’ˆå¯¹ä»¥ä¸Šç—›ç‚¹ï¼Œæœ¬æ–¹æ¡ˆæä¾›äº†ä»¥ä¸‹æ ¸å¿ƒæ”¹è¿›ï¼š</p>
<h4 data-id="heading-7">æ”¹è¿›ä¸€ï¼šåŸºäºæ•°æ®é‡çš„æ”’æ‰¹æœºåˆ¶</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">public</span>Â <span class="hljs-keyword">class</span>Â <span class="hljs-title class_">ClickHouseSinkCounter</span>Â {
Â  Â Â <span class="hljs-keyword">private</span>Â <span class="hljs-title class_">Long</span>Â metaSize; Â <span class="hljs-comment">// ç´¯è®¡æ•°æ®é‡ï¼ˆå­—èŠ‚ï¼‰</span>
Â  Â Â <span class="hljs-keyword">public</span>Â <span class="hljs-built_in">void</span>Â <span class="hljs-title function_">add</span>(<span class="hljs-params">LogModelÂ value</span>) {
Â  Â  Â  Â Â <span class="hljs-variable language_">this</span>.<span class="hljs-property">values</span>.<span class="hljs-title function_">add</span>(value);
Â  Â  Â  Â Â <span class="hljs-variable language_">this</span>.<span class="hljs-property">metaSize</span>Â += value.<span class="hljs-title function_">getMetaSize</span>(); Â <span class="hljs-comment">// ç´¯åŠ æ•°æ®é‡</span>
Â  Â  }
}
<span class="hljs-comment">// è§¦å‘æ¡ä»¶</span>
<span class="hljs-keyword">private</span>Â <span class="hljs-built_in">boolean</span>Â <span class="hljs-title function_">flushCondition</span>(<span class="hljs-params"><span class="hljs-built_in">String</span>Â application</span>) {
Â  Â Â <span class="hljs-keyword">return</span>Â <span class="hljs-title function_">checkMetaSize</span>(application) Â <span class="hljs-comment">// metaSize &gt;= 10000 å­—èŠ‚</span>
Â  Â  Â  Â  ||Â <span class="hljs-title function_">checkTime</span>(application); Â  Â Â <span class="hljs-comment">// æˆ–è¶…æ—¶ 30 ç§’</span>
}
</code></pre>
<p><strong>ä¼˜åŠ¿ï¼š</strong></p>
<ul>
<li><strong>å†…å­˜å¯æ§ï¼š</strong> æ ¹æ®æ•°æ®é‡è€Œéè®°å½•æ•°æ”’æ‰¹ã€‚</li>
<li><strong>ç²¾ç¡®æ§åˆ¶ï¼š</strong> 1KB çš„è®°å½•æ”’ 10000 æ¡ = 10MBï¼Œ1MB çš„è®°å½•æ”’ 10 æ¡ = 10MBã€‚</li>
<li><strong>é¿å…OOMï¼š</strong> å¤§æ—¥å¿—è®°å½•ä¸ä¼šæ’‘çˆ†å†…å­˜ã€‚</li>
</ul>
<h4 data-id="heading-8">æ”¹è¿›äºŒï¼šåŠ¨æ€è¡¨ç»“æ„ä¸åˆ†ç‰‡ç­–ç•¥</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">public</span>Â <span class="hljs-keyword">abstract</span>Â <span class="hljs-keyword">class</span>Â <span class="hljs-title class_">ClickHouseShardStrategy</span>&lt;T&gt; {
Â  Â Â <span class="hljs-keyword">public</span>Â <span class="hljs-keyword">abstract</span>Â <span class="hljs-title class_">String</span>Â <span class="hljs-title function_">getTableName</span>(T data);
}
<span class="hljs-comment">//æ—¥å¿—ä¾§å®ç°ä¸ºåº”ç”¨çº§åˆ†è¡¨</span>
<span class="hljs-keyword">public</span>Â <span class="hljs-keyword">class</span>Â <span class="hljs-title class_">LogClickHouseShardStrategy</span>Â <span class="hljs-keyword">extends</span>Â <span class="hljs-title class_ inherited__">ClickHouseShardStrategy</span>&lt;<span class="hljs-title class_">String</span>&gt; {
Â  Â Â <span class="hljs-meta">@Override</span>
Â  Â Â <span class="hljs-keyword">public</span>Â <span class="hljs-title class_">String</span>Â <span class="hljs-title function_">getTableName</span>(<span class="hljs-params"><span class="hljs-built_in">String</span>Â application</span>) {
Â  Â  Â  Â Â <span class="hljs-comment">// åŠ¨æ€è·¯ç”±ï¼šorder-service â†’ tb_logs_order_service</span>
Â  Â  Â  Â Â <span class="hljs-keyword">return</span>Â <span class="hljs-title class_">String</span>.<span class="hljs-title function_">format</span>(<span class="hljs-string">"tb_logs_%s"</span>, application);
Â  Â  }
}
</code></pre>
<p><strong>ä¼˜åŠ¿ï¼š</strong></p>
<ul>
<li><strong>åº”ç”¨éš”ç¦»ï¼š</strong> æ—¥å¿—ä¾§å†…ç½®åº”ç”¨çº§åˆ†è¡¨ï¼Œæ¯ä¸ªåº”ç”¨ç‹¬ç«‹åˆ†è¡¨ã€‚</li>
<li><strong>åŠ¨æ€è·¯ç”±ï¼š</strong> æ ¹æ® application è‡ªåŠ¨è·¯ç”±åˆ°ç›®æ ‡è¡¨ã€‚</li>
<li><strong>æ‰©å±•æ€§å¼ºï¼š</strong> æ–°å¢åº”ç”¨æ— éœ€æ‰‹åŠ¨å»ºè¡¨ï¼ˆé…åˆ ClickHouse è‡ªåŠ¨å»ºè¡¨ï¼‰ã€‚</li>
</ul>
<h4 data-id="heading-9">æ”¹è¿›ä¸‰ï¼šæœ¬åœ°è¡¨å†™å…¥ + åŠ¨æ€èŠ‚ç‚¹å‘ç°</h4>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-keyword">public</span>Â <span class="hljs-keyword">class</span>Â <span class="hljs-title class_">ClickHouseLocalWriter</span>Â extendsÂ ClickHouseWriterÂ {
Â  Â Â <span class="hljs-comment">// ç›´æ¥å†™æœ¬åœ°è¡¨ï¼Œé¿å…åˆ†å¸ƒå¼è¡¨è½¬å‘</span>
Â  Â Â <span class="hljs-keyword">private</span>Â <span class="hljs-keyword">final</span>Â ConcurrentMap&lt;<span class="hljs-type">String</span>,Â HikariDataSource&gt; dataSourceMap;
Â  Â Â @<span class="hljs-function">Override
Â  Â Â <span class="hljs-keyword">public</span>Â HikariDataSourceÂ <span class="hljs-title">getNextDataSource</span><span class="hljs-params">(Set&lt;<span class="hljs-type">String</span>&gt; exceptionHosts)</span> </span>{
Â  Â  Â  Â Â <span class="hljs-comment">// 1. åŠ¨æ€è·å–é›†ç¾¤èŠ‚ç‚¹åˆ—è¡¨</span>
Â  Â  Â  Â Â List&lt;<span class="hljs-type">String</span>&gt; healthyHosts =Â <span class="hljs-built_in">getHealthyHosts</span>(exceptionHosts);
Â  Â  Â  Â Â <span class="hljs-comment">// 2. éšæœºé€‰æ‹©å¥åº·èŠ‚ç‚¹</span>
Â  Â  Â  Â Â <span class="hljs-keyword">return</span>Â dataSourceMap.<span class="hljs-built_in">get</span>(healthyHosts.<span class="hljs-built_in">get</span>(random.<span class="hljs-built_in">nextInt</span>(size)));
Â  Â  }
}
</code></pre>
<p><strong>ä¼˜åŠ¿ï¼š</strong></p>
<ul>
<li><strong>æ€§èƒ½æå‡ï¼š</strong> ç›´æ¥å†™æœ¬åœ°è¡¨ï¼Œé¿å…ç½‘ç»œè½¬å‘ã€‚</li>
<li><strong>é«˜å¯ç”¨ï¼š</strong> åŠ¨æ€èŠ‚ç‚¹å‘ç° + æ•…éšœèŠ‚ç‚¹å‰”é™¤ã€‚</li>
<li><strong>è´Ÿè½½å‡è¡¡ï¼š</strong> éšæœºé€‰æ‹© + Shuffle åˆå§‹åŒ–ã€‚</li>
</ul>
<h3 data-id="heading-10">æŠ€æœ¯æ–¹æ¡ˆæ¦‚è§ˆ</h3>
<p>åŸºäºä»¥ä¸Šæ”¹è¿›ï¼Œæœ¬æ–¹æ¡ˆæä¾›äº†ä»¥ä¸‹æ ¸å¿ƒèƒ½åŠ›ï¼š</p>
<ol>
<li><strong>æœ¬åœ°è¡¨/åˆ†å¸ƒå¼è¡¨å†™å…¥ï¼š</strong> æ€§èƒ½ä¼˜åŒ–ä¸é«˜å¯ç”¨å¹³è¡¡ã€‚</li>
<li><strong>åˆ†ç‰‡ç­–ç•¥ï¼š</strong> æŒ‰åº”ç”¨ç»´åº¦è·¯ç”±ä¸éš”ç¦»ã€‚</li>
<li><strong>æ”’æ‰¹ä¸å†…å­˜æ§åˆ¶ï¼š</strong> åŒè§¦å‘æœºåˆ¶ï¼ˆæ•°æ®é‡ + è¶…æ—¶ï¼‰ã€‚</li>
<li><strong>æµé‡æ§åˆ¶ä¸é™æµï¼š</strong> æœ‰ç•Œé˜Ÿåˆ— + è¿æ¥æ± ã€‚</li>
<li><strong>å¥å£®çš„é‡è¯•æœºåˆ¶ï¼š</strong> é€’å½’é‡è¯• + æ•…éšœèŠ‚ç‚¹å‰”é™¤ã€‚</li>
<li><strong>Checkpoint è¯­ä¹‰ä¿è¯ï¼š</strong> At-Least-Once æ•°æ®ä¸€è‡´æ€§ã€‚</li>
</ol>
<h2 data-id="heading-11">äºŒã€æ ¸å¿ƒæ¶æ„è®¾è®¡</h2>
<h3 data-id="heading-12">æ¶æ„å›¾</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a6230f98edcb4387a91be9777855e095~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771297904&amp;x-signature=0asR5n8cBcdMRovjP61HlgLzcJU%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<h3 data-id="heading-13">æ ¸å¿ƒç»„ä»¶</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3ae0e0cae190480a906ce9eedc850e55~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771297904&amp;x-signature=yfhgmUdoRLsLwyvcbV7UO%2FBC7wg%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<h3 data-id="heading-14">æ ¸å¿ƒæµç¨‹</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/994fb8f04a3f4a5e9037ed1d68ed4fd8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771297904&amp;x-signature=%2Bu1yXFOZ5fTWFhCbOH4FWVmZcZo%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<h2 data-id="heading-15">ä¸‰ã€æœ¬åœ°è¡¨ vs åˆ†å¸ƒå¼è¡¨å†™å…¥</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aefda04b30094fa7a7597653ebe525d0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771297904&amp;x-signature=nvVXa8CPurVbLZzR%2BPN58hXZQ7E%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<h3 data-id="heading-16">ClickHouse è¡¨ç»“æ„è¯´æ˜</h3>
<p>ClickHouse <strong>æ¨èç›´æ¥å†™æœ¬åœ°è¡¨</strong>ï¼ŒåŸå› ï¼š</p>
<ol>
<li><strong>å†™å…¥æ€§èƒ½ï¼š</strong> é¿å…åˆ†å¸ƒå¼è¡¨çš„ç½‘ç»œåˆ†å‘ã€‚</li>
<li><strong>æ•°æ®ä¸€è‡´æ€§ï¼š</strong> ç›´æ¥å†™å…¥ç›®æ ‡èŠ‚ç‚¹ï¼Œå‡å°‘ä¸­é—´ç¯èŠ‚æ•…éšœç‚¹ï¼Œæ¯”åˆ†å¸ƒå¼è¡¨å†™å…¥æ›´å®‰å…¨ï¼Œåˆ©äºå·¥ç¨‹åŒ–ã€‚</li>
<li><strong>è´Ÿè½½å‡è¡¡ï¼š</strong> å®¢æˆ·ç«¯è·¯ç”±å®ç°è´Ÿè½½åˆ†æ•£ã€‚</li>
</ol>

<pre><code class="hljs language-scss" lang="scss">-- æœ¬åœ°è¡¨ï¼ˆå®é™…å­˜å‚¨æ•°æ®ï¼‰
CREATE <span class="hljs-selector-tag">TABLE</span>Â tb_logs_localÂ ONÂ CLUSTERÂ 'default'Â (
Â  Â  application String,
Â  Â  environment String,
Â  Â  message String,
Â  Â  log_time DateTime
) ENGINEÂ =Â <span class="hljs-built_in">MergeTree</span>()
PARTITIONÂ BYÂ <span class="hljs-built_in">toYYYYMM</span>(log_time)
<span class="hljs-attribute">ORDER</span>Â BYÂ (application, log_time);
-- åˆ†å¸ƒå¼è¡¨ï¼ˆé€»è¾‘è§†å›¾ï¼Œä¸å­˜å‚¨æ•°æ®ï¼‰
CREATE <span class="hljs-selector-tag">TABLE</span>Â tb_logs_allÂ ONÂ CLUSTERÂ 'default'Â ASÂ tb_logs_local
ENGINEÂ =Â <span class="hljs-built_in">Distributed</span>('default', dw_log, tb_logs_local, cityHash64(application));
</code></pre>
<h3 data-id="heading-17">HikariCP è¿æ¥æ± é…ç½®</h3>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// HikariCP è¿æ¥æ± é…ç½®</span>
<span class="hljs-keyword">public</span>Â <span class="hljs-keyword">class</span>Â <span class="hljs-title class_">ClickHouseDataSourceUtils</span>Â {
Â  Â Â <span class="hljs-function"><span class="hljs-keyword">private</span>Â <span class="hljs-type">static</span>Â HikariConfigÂ <span class="hljs-title">getHikariConfig</span><span class="hljs-params">(DataSourceImpl dataSource)</span>Â </span>{
Â  Â  Â  Â  HikariConfig config =Â <span class="hljs-keyword">new</span>Â <span class="hljs-built_in">HikariConfig</span>();
Â  Â  Â  Â  config.<span class="hljs-built_in">setConnectionTimeout</span>(<span class="hljs-number">30000L</span>); Â  Â <span class="hljs-comment">// è¿æ¥è¶…æ—¶ 30s</span>
Â  Â  Â  Â  config.<span class="hljs-built_in">setMaximumPoolSize</span>(<span class="hljs-number">20</span>); Â  Â  Â  Â  Â <span class="hljs-comment">// æœ€å¤§è¿æ¥æ•° 20</span>
Â  Â  Â  Â  config.<span class="hljs-built_in">setMinimumIdle</span>(<span class="hljs-number">2</span>); Â  Â  Â  Â  Â  Â  Â Â <span class="hljs-comment">// æœ€å°ç©ºé—² 2</span>
Â  Â  Â  Â  config.<span class="hljs-built_in">setDataSource</span>(dataSource);
Â  Â  Â  Â Â <span class="hljs-keyword">return</span>Â config;
Â  Â  }
Â  Â Â <span class="hljs-function"><span class="hljs-keyword">private</span>Â <span class="hljs-type">static</span>Â PropertiesÂ <span class="hljs-title">getClickHouseProperties</span><span class="hljs-params">(ClickHouseSinkCommonParamsÂ params)</span>Â </span>{
Â  Â  Â  Â  Properties props =Â <span class="hljs-keyword">new</span>Â <span class="hljs-built_in">Properties</span>();
Â  Â  Â  Â  props.<span class="hljs-built_in">setProperty</span>(<span class="hljs-string">"user"</span>,Â params.<span class="hljs-built_in">getUser</span>());
Â  Â  Â  Â  props.<span class="hljs-built_in">setProperty</span>(<span class="hljs-string">"password"</span>,Â params.<span class="hljs-built_in">getPassword</span>());
Â  Â  Â  Â  props.<span class="hljs-built_in">setProperty</span>(<span class="hljs-string">"database"</span>,Â params.<span class="hljs-built_in">getDatabase</span>());
Â  Â  Â  Â  props.<span class="hljs-built_in">setProperty</span>(<span class="hljs-string">"socket_timeout"</span>,Â <span class="hljs-string">"180000"</span>); Â  Â  Â <span class="hljs-comment">// Socket è¶…æ—¶ 3 åˆ†é’Ÿ</span>
Â  Â  Â  Â  props.<span class="hljs-built_in">setProperty</span>(<span class="hljs-string">"socket_keepalive"</span>,Â <span class="hljs-string">"true"</span>); Â  Â  Â <span class="hljs-comment">// ä¿æŒè¿æ¥</span>
Â  Â  Â  Â  props.<span class="hljs-built_in">setProperty</span>(<span class="hljs-string">"http_connection_provider"</span>,Â <span class="hljs-string">"APACHE_HTTP_CLIENT"</span>);
Â  Â  Â  Â Â <span class="hljs-keyword">return</span>Â props;
Â  Â  }
}
</code></pre>
<p><strong>é…ç½®è¯´æ˜ï¼š</strong></p>
<ul>
<li>maxPoolSize=20ï¼šæ¯ä¸ª ClickHouse èŠ‚ç‚¹æœ€å¤š 20 ä¸ªè¿æ¥ã€‚</li>
<li>minIdle=2ï¼šä¿æŒ 2 ä¸ªç©ºé—²è¿æ¥ï¼Œé¿å…é¢‘ç¹åˆ›å»ºã€‚</li>
<li>socket_timeout=180sï¼šSocket è¶…æ—¶ 3 åˆ†é’Ÿï¼Œé˜²æ­¢é•¿æ—¶é—´æŸ¥è¯¢é˜»å¡ã€‚</li>
</ul>
<h3 data-id="heading-18">ClickHouseLocalWriterï¼šåŠ¨æ€èŠ‚ç‚¹å‘ç°</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">public</span>Â <span class="hljs-keyword">class</span>Â <span class="hljs-title class_">ClickHouseLocalWriter</span>Â <span class="hljs-keyword">extends</span>Â <span class="hljs-title class_ inherited__">ClickHouseWriter</span>Â {
Â  Â Â <span class="hljs-comment">// æœ¬åœ°èŠ‚ç‚¹ç¼“å­˜ï¼ŒæŒ‰ IP ç»´æŠ¤</span>
Â  Â Â <span class="hljs-keyword">private</span>Â finalÂ <span class="hljs-title class_">ConcurrentMap</span>&lt;<span class="hljs-title class_">String</span>,Â <span class="hljs-title class_">HikariDataSource</span>&gt; dataSourceMap;
Â  Â Â <span class="hljs-comment">// åŠ¨æ€è·å–é›†ç¾¤æœ¬åœ°è¡¨èŠ‚ç‚¹</span>
Â  Â Â <span class="hljs-keyword">private</span>Â finalÂ <span class="hljs-title class_">ClusterIpsUtils</span>Â clusterIpsUtils;
Â  Â Â <span class="hljs-comment">// IP å˜æ›´æ ‡å¿—ï¼ˆCAS é”ï¼Œé¿å…å¹¶å‘æ›´æ–°ï¼‰</span>
Â  Â Â <span class="hljs-keyword">private</span>Â <span class="hljs-keyword">static</span>Â finalÂ <span class="hljs-title class_">AtomicBoolean</span>Â <span class="hljs-variable constant_">IP_CHANGING</span>Â =Â <span class="hljs-keyword">new</span>Â <span class="hljs-title class_">AtomicBoolean</span>(<span class="hljs-literal">false</span>);
Â  Â Â <span class="hljs-meta">@Override</span>
Â  Â Â <span class="hljs-keyword">public</span>Â <span class="hljs-title class_">HikariDataSource</span>Â <span class="hljs-title function_">getNextDataSource</span>(<span class="hljs-params"><span class="hljs-built_in">Set</span>&lt;<span class="hljs-built_in">String</span>&gt; exceptionHosts</span>) {
Â  Â  Â  Â Â <span class="hljs-comment">// 1ï¸âƒ£ æ£€æµ‹é›†ç¾¤èŠ‚ç‚¹å˜åŒ–ï¼ˆé€šè¿‡ CAS é¿å…å¹¶å‘æ›´æ–°ï¼‰</span>
Â  Â  Â  Â Â <span class="hljs-keyword">if</span>Â (<span class="hljs-title function_">clusterIpsChanged</span>() &amp;&amp;Â <span class="hljs-variable constant_">IP_CHANGING</span>.<span class="hljs-title function_">compareAndSet</span>(<span class="hljs-literal">false</span>,Â <span class="hljs-literal">true</span>)) {
Â  Â  Â  Â  Â  Â Â <span class="hljs-keyword">try</span>Â {
Â  Â  Â  Â  Â  Â  Â  Â Â <span class="hljs-title function_">ipChanged</span>();Â <span class="hljs-comment">// åŠ¨æ€æ›´æ–° dataSourceMap</span>
Â  Â  Â  Â  Â  Â  }Â <span class="hljs-keyword">finally</span>Â {
Â  Â  Â  Â  Â  Â  Â  Â Â <span class="hljs-variable constant_">IP_CHANGING</span>.<span class="hljs-title function_">set</span>(<span class="hljs-literal">false</span>);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â Â <span class="hljs-comment">// 2ï¸âƒ£ è·å–å¼‚å¸¸èŠ‚ç‚¹åˆ—è¡¨ï¼ˆä» Redis + APM å®æ—¶æŸ¥è¯¢ï¼‰</span>
Â  Â  Â  Â Â <span class="hljs-title class_">Set</span>&lt;<span class="hljs-title class_">String</span>&gt; exceptIps = clusterIpsUtils.<span class="hljs-title function_">getExceptIps</span>();
Â  Â  Â  Â  exceptIps.<span class="hljs-title function_">addAll</span>(exceptionHosts);
Â  Â  Â  Â Â <span class="hljs-comment">// 3ï¸âƒ£ è¿‡æ»¤å¥åº·èŠ‚ç‚¹ï¼Œéšæœºé€‰æ‹©</span>
Â  Â  Â  Â Â <span class="hljs-title class_">List</span>&lt;<span class="hljs-title class_">String</span>&gt; healthyHosts = dataSourceMap.<span class="hljs-title function_">keySet</span>().<span class="hljs-title function_">stream</span>()
Â  Â  Â  Â  Â  Â  .<span class="hljs-title function_">filter</span>(host -&gt; !exceptIps.<span class="hljs-title function_">contains</span>(host))
Â  Â  Â  Â  Â  Â  .<span class="hljs-title function_">collect</span>(<span class="hljs-title class_">Collectors</span>.<span class="hljs-title function_">toList</span>());
Â  Â  Â  Â Â <span class="hljs-keyword">if</span>Â (<span class="hljs-title class_">CollectionUtils</span>.<span class="hljs-title function_">isEmpty</span>(healthyHosts)) {
Â  Â  Â  Â  Â  Â Â <span class="hljs-keyword">throw</span>Â <span class="hljs-keyword">new</span>Â <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"Can't get datasource from local cache"</span>);
Â  Â  Â  Â  }
Â  Â  Â  Â Â <span class="hljs-keyword">return</span>Â dataSourceMap.<span class="hljs-title function_">get</span>(healthyHosts.<span class="hljs-title function_">get</span>(random.<span class="hljs-title function_">nextInt</span>(healthyHosts.<span class="hljs-title function_">size</span>())));
Â  Â  }
Â  Â Â <span class="hljs-keyword">private</span>Â <span class="hljs-built_in">void</span>Â <span class="hljs-title function_">ipChanged</span>(<span class="hljs-params"/>) {
Â  Â  Â  Â Â <span class="hljs-title class_">List</span>&lt;<span class="hljs-title class_">String</span>&gt; clusterIps = clusterIpsUtils.<span class="hljs-title function_">getClusterIps</span>();
Â  Â  Â  Â Â <span class="hljs-comment">// æ–°å¢èŠ‚ç‚¹ï¼šè‡ªåŠ¨åˆ›å»ºè¿æ¥æ± </span>
Â  Â  Â  Â  clusterIps.<span class="hljs-title function_">forEach</span>(ip -&gt;
Â  Â  Â  Â  Â  Â  dataSourceMap.<span class="hljs-title function_">computeIfAbsent</span>(ip, v -&gt;
Â  Â  Â  Â  Â  Â  Â  Â Â <span class="hljs-title function_">createHikariDataSource</span>(ip, port)
Â  Â  Â  Â  Â  Â  )
Â  Â  Â  Â  );
Â  Â  Â  Â Â <span class="hljs-comment">// ç§»é™¤ä¸‹çº¿èŠ‚ç‚¹ï¼šå…³é—­è¿æ¥æ± </span>
Â  Â  Â  Â  dataSourceMap.<span class="hljs-title function_">forEach</span>((ip, ds) -&gt; {
Â  Â  Â  Â  Â  Â Â <span class="hljs-keyword">if</span>Â (!clusterIps.<span class="hljs-title function_">contains</span>(ip)) {
Â  Â  Â  Â  Â  Â  Â  Â  dataSourceMap.<span class="hljs-title function_">remove</span>(ip);
Â  Â  Â  Â  Â  Â  Â  Â  ds.<span class="hljs-title function_">close</span>();
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });
Â  Â  }
}
</code></pre>
<p><strong>æ ¸å¿ƒé€»è¾‘ï¼š</strong></p>
<ol>
<li><strong>åŠ¨æ€èŠ‚ç‚¹å‘ç°ï¼š</strong> ä» system.clusters æŸ¥è¯¢æ‰€æœ‰èŠ‚ç‚¹ã€‚</li>
<li><strong>è‡ªåŠ¨æ‰©ç¼©å®¹ï¼š</strong> èŠ‚ç‚¹ä¸Šçº¿è‡ªåŠ¨åŠ å…¥ï¼Œä¸‹çº¿è‡ªåŠ¨å‰”é™¤ã€‚</li>
<li><strong>æ•…éšœèŠ‚ç‚¹å‰”é™¤ï¼š</strong> é€šè¿‡ APM ç›‘æ§ï¼Œè‡ªåŠ¨å‰”é™¤å¼‚å¸¸èŠ‚ç‚¹ã€‚</li>
<li><strong>è´Ÿè½½å‡è¡¡ï¼š</strong> éšæœºé€‰æ‹©å¥åº·èŠ‚ç‚¹ï¼Œé¿å…çƒ­ç‚¹ã€‚</li>
</ol>
<h3 data-id="heading-19">é›†ç¾¤èŠ‚ç‚¹åŠ¨æ€å‘ç°ï¼ˆClusterIpsUtilsï¼‰</h3>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">public</span>Â <span class="hljs-selector-tag">class</span>Â <span class="hljs-selector-tag">ClusterIpsUtils</span>Â {
Â  Â Â <span class="hljs-comment">// ä» system.clusters æŸ¥è¯¢æ‰€æœ‰èŠ‚ç‚¹</span>
Â  Â Â <span class="hljs-selector-tag">private</span>Â <span class="hljs-selector-tag">static</span>Â <span class="hljs-selector-tag">final</span>Â <span class="hljs-selector-tag">String</span>Â <span class="hljs-selector-tag">QUERY_CLUSTER_IPS</span>Â =
Â  Â  Â  Â Â "<span class="hljs-selector-tag">select</span> <span class="hljs-selector-tag">host_address</span> <span class="hljs-selector-tag">from</span> <span class="hljs-selector-tag">system</span><span class="hljs-selector-class">.clusters</span> <span class="hljs-selector-tag">where</span> <span class="hljs-selector-tag">cluster</span> = '<span class="hljs-selector-tag">default</span>'";
Â  Â Â <span class="hljs-comment">// LoadingCacheï¼šå®šæ—¶åˆ·æ–°èŠ‚ç‚¹åˆ—è¡¨ï¼ˆ1 å°æ—¶ï¼‰</span>
Â  Â Â <span class="hljs-selector-tag">private</span>Â <span class="hljs-selector-tag">final</span>Â <span class="hljs-selector-tag">LoadingCache</span>&lt;<span class="hljs-selector-tag">String</span>,Â <span class="hljs-selector-tag">List</span>&lt;<span class="hljs-selector-tag">String</span>&gt;&gt; <span class="hljs-selector-tag">clusterIpsCache</span> =
Â  Â  Â  Â Â <span class="hljs-selector-tag">CacheBuilder</span><span class="hljs-selector-class">.newBuilder</span>()
Â  Â  Â  Â  Â  Â  <span class="hljs-selector-class">.expireAfterAccess</span>(<span class="hljs-number">10</span>,Â TimeUnit.HOURS)
Â  Â  Â  Â  Â  Â  <span class="hljs-selector-class">.refreshAfterWrite</span>(<span class="hljs-number">1</span>,Â TimeUnit.HOURS)
Â  Â  Â  Â  Â  Â  <span class="hljs-selector-class">.build</span>(CacheLoader.<span class="hljs-built_in">asyncReloading</span>(newÂ CacheLoader&lt;&gt;() {
Â  Â  Â  Â  Â  Â  Â  Â Â <span class="hljs-variable">@Override</span>
Â  Â  Â  Â  Â  Â  Â  Â Â publicÂ List&lt;String&gt;Â <span class="hljs-built_in">load</span>(StringÂ dbName) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â returnÂ <span class="hljs-built_in">queryClusterIps</span>(); Â <span class="hljs-comment">// å®šæ—¶åˆ·æ–°èŠ‚ç‚¹åˆ—è¡¨</span>
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }));
Â  Â Â <span class="hljs-comment">// å¼‚å¸¸èŠ‚ç‚¹ç¼“å­˜ï¼ˆ1 åˆ†é’Ÿåˆ·æ–°ï¼‰</span>
Â  Â Â <span class="hljs-selector-tag">private</span>Â <span class="hljs-selector-tag">final</span>Â <span class="hljs-selector-tag">LoadingCache</span>&lt;<span class="hljs-selector-tag">String</span>,Â <span class="hljs-selector-tag">FlinkExceptIpModel</span>&gt; <span class="hljs-selector-tag">exceptIpsCache</span> =
Â  Â  Â  Â Â <span class="hljs-selector-tag">CacheBuilder</span><span class="hljs-selector-class">.newBuilder</span>()
Â  Â  Â  Â  Â  Â  <span class="hljs-selector-class">.refreshAfterWrite</span>(<span class="hljs-number">1</span>,Â TimeUnit.MINUTES)
Â  Â  Â  Â  Â  Â  <span class="hljs-selector-class">.build</span>(CacheLoader.<span class="hljs-built_in">asyncReloading</span>(newÂ CacheLoader&lt;&gt;() {
Â  Â  Â  Â  Â  Â  Â  Â Â <span class="hljs-variable">@Override</span>
Â  Â  Â  Â  Â  Â  Â  Â Â publicÂ FlinkExceptIpModelÂ <span class="hljs-built_in">load</span>(StringÂ dbName) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â returnÂ <span class="hljs-built_in">queryExceptIp</span>(); Â <span class="hljs-comment">// ä» Redis + APM æŸ¥è¯¢å¼‚å¸¸èŠ‚ç‚¹</span>
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }));
}
</code></pre>
<p><strong>å¼‚å¸¸èŠ‚ç‚¹ç›‘æ§ç­–ç•¥ï¼š</strong></p>
<ul>
<li><strong>ç£ç›˜ä½¿ç”¨ç‡ &gt;= 90%ï¼š</strong> ä» APM æŸ¥è¯¢ Prometheus æŒ‡æ ‡ï¼Œè‡ªåŠ¨åŠ å…¥é»‘åå•ã€‚</li>
<li><strong>HTTP è¿æ¥æ•° &gt;= 50ï¼š</strong> è¿æ¥æ•°è¿‡å¤šè¯´æ˜èŠ‚ç‚¹å‹åŠ›å¤§ï¼Œè‡ªåŠ¨åŠ å…¥é»‘åå•ã€‚</li>
<li><strong>äººå·¥é…ç½®ï¼š</strong> é€šè¿‡ Redis é…ç½®æ‰‹åŠ¨å‰”é™¤èŠ‚ç‚¹</li>
</ul>
<p><strong>æ•°æ®æ¥æºï¼š</strong></p>
<ol>
<li><strong>ClickHouse system.clusters è¡¨ï¼š</strong> è·å–æ‰€æœ‰é›†ç¾¤èŠ‚ç‚¹ã€‚</li>
<li><strong>APM Prometheus æ¥å£ï¼š</strong> ç›‘æ§èŠ‚ç‚¹å¥åº·çŠ¶æ€ã€‚</li>
<li><strong>Redis ç¼“å­˜ï¼š</strong> äººå·¥é…ç½®çš„å¼‚å¸¸èŠ‚ç‚¹ã€‚</li>
</ol>
<h3 data-id="heading-20">è´Ÿè½½å‡è¡¡ä¼˜åŒ–</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">public</span>Â <span class="hljs-keyword">class</span>Â <span class="hljs-title class_">ClickHouseWriter</span>Â {
Â  Â Â <span class="hljs-keyword">public</span>Â &lt;T&gt; ClickHouseWriter(...) {
Â  Â  Â  Â Â <span class="hljs-comment">// Shuffleï¼šéšæœºæ‰“ä¹±æ•°æ®æºé¡ºåº</span>
Â  Â  Â  Â  Collections.shuffle(clickHouseDataSources);
Â  Â  Â  Â Â <span class="hljs-keyword">this</span>.clickHouseDataSources = clickHouseDataSources;
Â  Â  }
Â  Â Â <span class="hljs-keyword">public</span>Â HikariDataSource getNextDataSource(Set&lt;String&gt; exceptionHosts) {
Â  Â  Â  Â Â <span class="hljs-comment">// è½®è¯¢ + éšæœºé€‰æ‹©ï¼ˆå·² shuffleï¼Œé¿å…çƒ­ç‚¹ï¼‰</span>
Â  Â  Â  Â  int current =Â <span class="hljs-keyword">this</span>.currentRandom.getAndIncrement();
Â  Â  Â  Â Â <span class="hljs-keyword">if</span>Â (current &gt;= clickHouseDataSources.size()) {
Â  Â  Â  Â  Â  Â Â <span class="hljs-keyword">this</span>.currentRandom.<span class="hljs-keyword">set</span>(<span class="hljs-number">0</span>);
Â  Â  Â  Â  }
Â  Â  Â  Â Â <span class="hljs-keyword">return</span>Â clickHouseDataSources.<span class="hljs-keyword">get</span>(currentRandom.<span class="hljs-keyword">get</span>());
Â  Â  }
}
</code></pre>
<p><strong>ä¼˜åŠ¿ï¼š</strong></p>
<ul>
<li>åˆå§‹åŒ–æ—¶ shuffleï¼Œé¿å…æ‰€æœ‰ writer åŒæ—¶ä»ç¬¬ä¸€ä¸ªèŠ‚ç‚¹å¼€å§‹ã€‚</li>
<li>è½®è¯¢ + éšæœºé€‰æ‹©ï¼Œè´Ÿè½½åˆ†æ•£æ›´å‡åŒ€ã€‚</li>
<li>æ•…éšœèŠ‚ç‚¹è‡ªåŠ¨å‰”é™¤ã€‚</li>
</ul>
<h2 data-id="heading-21">å››ã€æ”¯æŒåˆ†è¡¨ç­–ç•¥</h2>
<h3 data-id="heading-22">åˆ†ç‰‡ç­–ç•¥æŠ½è±¡</h3>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span>Â <span class="hljs-keyword">abstract</span>Â <span class="hljs-keyword">class</span>Â <span class="hljs-title">ClickHouseShardStrategy</span>&lt;<span class="hljs-title">T</span>&gt; {
Â  Â Â <span class="hljs-keyword">private</span>Â String tableName; Â  Â  Â <span class="hljs-comment">// è¡¨åæ¨¡æ¿ï¼Œå¦‚ "tb_log_%s"</span>
Â  Â Â <span class="hljs-keyword">private</span>Â Integer tableCount; Â  Â <span class="hljs-comment">// åˆ†è¡¨æ•°é‡</span>
Â  Â Â <span class="hljs-comment">// æ ¹æ®æ•°æ®å†³å®šç›®æ ‡è¡¨å</span>
Â  Â Â <span class="hljs-function"><span class="hljs-keyword">public</span>Â <span class="hljs-keyword">abstract</span>Â StringÂ <span class="hljs-title">getTableName</span>(<span class="hljs-params">T data</span>)</span>;
}
</code></pre>
<h3 data-id="heading-23">æ—¥å¿—åˆ†ç‰‡å®ç°</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">public</span>Â <span class="hljs-keyword">class</span>Â <span class="hljs-title class_">LogClickHouseShardStrategy</span>Â <span class="hljs-keyword">extends</span>Â <span class="hljs-title class_ inherited__">ClickHouseShardStrategy</span>&lt;<span class="hljs-title class_">String</span>&gt; {
Â  Â Â <span class="hljs-meta">@Override</span>
Â  Â Â <span class="hljs-keyword">public</span>Â <span class="hljs-title class_">String</span>Â <span class="hljs-title function_">getTableName</span>(<span class="hljs-params"><span class="hljs-built_in">String</span>Â application</span>) {
Â  Â  Â  Â Â <span class="hljs-comment">// è¡¨åæ ¼å¼ï¼štb_log_{application}</span>
Â  Â  Â  Â Â <span class="hljs-comment">// ä¾‹å¦‚ï¼šapplication = "order-service" -&gt; table = "tb_log_order_service"</span>
Â  Â  Â  Â Â <span class="hljs-keyword">return</span>Â <span class="hljs-title class_">String</span>.<span class="hljs-title function_">format</span>(
Â  Â  Â  Â  Â  Â Â <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getTableName</span>(),
Â  Â  Â  Â  Â  Â  application.<span class="hljs-title function_">replace</span>(<span class="hljs-string">"-"</span>,Â <span class="hljs-string">"_"</span>).<span class="hljs-title function_">toLowerCase</span>()
Â  Â  Â  Â  );
Â  Â  }
}
</code></pre>
<h3 data-id="heading-24">æŒ‰è¡¨ï¼ˆåº”ç”¨ï¼‰ç»´åº¦çš„ç¼“å†²åŒº</h3>
<p>æ—¥å¿—ä¾§ç»´åº¦é™çº§ä¸ºåº”ç”¨åç§°ç»´åº¦ç¼“å†²åŒºï¼Œå®åˆ™å› ä¸ºæŒ‰ç…§åº”ç”¨åˆ†è¡¨ï¼Œ</p>
<p>ä¸šåŠ¡æ–¹å¯ä½¿ç”¨è‡ªèº«åˆ†è¡¨ç­–ç•¥æºå¸¦è¡¨åå…ƒæ•°æ®ï¼Œè¿›è¡Œè¡¨ç»´åº¦ç¼“å†²ã€‚</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">public</span>Â <span class="hljs-keyword">class</span>Â <span class="hljs-title class_">ClickHouseShardSinkBuffer</span>Â {
Â  Â Â <span class="hljs-comment">// æŒ‰ application åˆ†ç»„çš„ç¼“å†²åŒºï¼ˆConcurrentHashMap ä¿è¯å¹¶å‘å®‰å…¨ï¼‰</span>
Â  Â Â <span class="hljs-keyword">private</span>Â finalÂ <span class="hljs-title class_">ConcurrentHashMap</span>&lt;<span class="hljs-title class_">String</span>,Â <span class="hljs-title class_">ClickHouseSinkCounter</span>&gt; localValues;
Â  Â Â <span class="hljs-keyword">public</span>Â <span class="hljs-built_in">void</span>Â <span class="hljs-title function_">put</span>(<span class="hljs-params">LogModelÂ value</span>) {
Â  Â  Â  Â Â <span class="hljs-title class_">String</span>Â application = value.<span class="hljs-title function_">getApplication</span>();
Â  Â  Â  Â Â <span class="hljs-comment">// 1ï¸âƒ£ æ£€æŸ¥æ˜¯å¦éœ€è¦ flush</span>
Â  Â  Â  Â Â <span class="hljs-keyword">if</span>Â (<span class="hljs-title function_">flushCondition</span>(application)) {
Â  Â  Â  Â  Â  Â Â <span class="hljs-title function_">addToQueue</span>(application);Â <span class="hljs-comment">// è§¦å‘å†™å…¥</span>
Â  Â  Â  Â  }
Â  Â  Â  Â Â <span class="hljs-comment">// 2ï¸âƒ£ æ·»åŠ åˆ°ç¼“å†²åŒºï¼ˆçº¿ç¨‹å®‰å…¨çš„ compute æ“ä½œï¼‰</span>
Â  Â  Â  Â  localValues.<span class="hljs-title function_">compute</span>(application, (k, v) -&gt; {
Â  Â  Â  Â  Â  Â Â <span class="hljs-keyword">if</span>Â (v ==Â <span class="hljs-literal">null</span>) v =Â <span class="hljs-keyword">new</span>Â <span class="hljs-title class_">ClickHouseSinkCounter</span>();
Â  Â  Â  Â  Â  Â  v.<span class="hljs-title function_">add</span>(value);
Â  Â  Â  Â  Â  Â Â <span class="hljs-keyword">return</span>Â v;
Â  Â  Â  Â  });
Â  Â  }
Â  Â Â <span class="hljs-keyword">private</span>Â <span class="hljs-built_in">void</span>Â <span class="hljs-title function_">addToQueue</span>(<span class="hljs-params"><span class="hljs-built_in">String</span>Â application</span>) {
Â  Â  Â  Â  localValues.<span class="hljs-title function_">computeIfPresent</span>(application, (k, v) -&gt; {
Â  Â  Â  Â  Â  Â Â <span class="hljs-comment">// æ·±æ‹·è´å¹¶æ¸…ç©ºï¼ˆé¿å…å¹¶å‘ä¿®æ”¹å¼‚å¸¸ï¼‰</span>
Â  Â  Â  Â  Â  Â Â <span class="hljs-title class_">List</span>&lt;<span class="hljs-title class_">LogModel</span>&gt; deepCopy = v.<span class="hljs-title function_">copyValuesAndClear</span>();
Â  Â  Â  Â  Â  Â Â <span class="hljs-comment">// æ„é€ è¯·æ±‚ Blankï¼šapplication + targetTable + values</span>
Â  Â  Â  Â  Â  Â Â <span class="hljs-title class_">String</span>Â targetTable = shardStrategy.<span class="hljs-title function_">getTableName</span>(application);
Â  Â  Â  Â  Â  Â Â <span class="hljs-title class_">ClickHouseRequestBlank</span>Â blank =Â <span class="hljs-keyword">new</span>Â <span class="hljs-title class_">ClickHouseRequestBlank</span>(deepCopy, application, targetTable);
Â  Â  Â  Â  Â  Â Â <span class="hljs-comment">// æ”¾å…¥é˜Ÿåˆ—</span>
Â  Â  Â  Â  Â  Â  writer.<span class="hljs-title function_">put</span>(blank);
Â  Â  Â  Â  Â  Â Â <span class="hljs-keyword">return</span>Â v;
Â  Â  Â  Â  });
Â  Â  }
}
</code></pre>
<p><strong>æ ¸å¿ƒè®¾è®¡ï¼š</strong></p>
<ul>
<li><strong>åº”ç”¨éš”ç¦»ï¼š</strong> æ¯ä¸ªè¡¨ï¼ˆåº”ç”¨ï¼‰ç‹¬ç«‹çš„ bufferï¼Œäº’ä¸å½±å“ã€‚</li>
<li><strong>çº¿ç¨‹å®‰å…¨ï¼š</strong> ä½¿ç”¨ ConcurrentHashMap.compute()ä¿è¯å¹¶å‘å®‰å…¨ã€‚</li>
<li><strong>æ·±æ‹·è´ï¼š</strong> List.copyOf() åˆ›å»ºä¸å¯å˜å‰¯æœ¬ï¼Œé¿å…å¹¶å‘ä¿®æ”¹ã€‚</li>
<li><strong>æ‰¹é‡æ¸…ç©ºï¼š</strong> ä¸€æ¬¡æ€§å–å‡ºæ‰€æœ‰æ•°æ®ï¼Œæ¸…ç©ºè®¡æ•°å™¨ã€‚</li>
</ul>
<h2 data-id="heading-25">äº”ã€æ”’æ‰¹ä¸å†…å­˜æ§åˆ¶</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0fbe4dbd0e40420ebfe253fdd2c5209a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771297904&amp;x-signature=SS577U1jEN8%2BTZ3ptFL3TZKSQF4%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<h3 data-id="heading-26">åŒè§¦å‘æœºåˆ¶</h3>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-keyword">public</span>Â <span class="hljs-keyword">class</span>Â <span class="hljs-title class_">ClickHouseShardSinkBuffer</span>Â {
Â  Â Â <span class="hljs-keyword">private</span>Â <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> maxFlushBufferSize; Â <span class="hljs-comment">// æœ€å¤§æ‰¹æ¬¡å¤§å°ï¼ˆå¦‚ 10000ï¼‰</span>
Â  Â Â <span class="hljs-keyword">private</span>Â <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> timeoutMillis; Â  Â  Â <span class="hljs-comment">// è¶…æ—¶æ—¶é—´ï¼ˆå¦‚ 30sï¼‰</span>
Â  Â Â <span class="hljs-comment">// è§¦å‘æ¡ä»¶æ£€æŸ¥ï¼ˆæ»¡è¶³ä»»ä¸€å³è§¦å‘ï¼‰</span>
Â  Â Â <span class="hljs-function"><span class="hljs-keyword">private</span>Â <span class="hljs-type">boolean</span>Â <span class="hljs-title">flushCondition</span><span class="hljs-params">(<span class="hljs-type">String</span>Â application)</span> </span>{
Â  Â  Â  Â Â <span class="hljs-keyword">return</span>Â localValues.<span class="hljs-built_in">get</span>(application) !=Â null
Â  Â  Â  Â  Â  Â  &amp;&amp; (<span class="hljs-built_in">checkMetaSize</span>(application) ||Â <span class="hljs-built_in">checkTime</span>(application));
Â  Â  }
Â  Â Â <span class="hljs-comment">// æ¡ä»¶1ï¼šè¾¾åˆ°æ‰¹æ¬¡å¤§å°</span>
Â  Â Â <span class="hljs-function"><span class="hljs-keyword">private</span>Â <span class="hljs-type">boolean</span>Â <span class="hljs-title">checkMetaSize</span><span class="hljs-params">(<span class="hljs-type">String</span>Â application)</span> </span>{
Â  Â  Â  Â Â <span class="hljs-keyword">return</span>Â localValues.<span class="hljs-built_in">get</span>(application).<span class="hljs-built_in">getMetaSize</span>() &gt;= maxFlushBufferSize;
Â  Â  }
Â  Â Â <span class="hljs-comment">// æ¡ä»¶2ï¼šè¶…æ—¶</span>
Â  Â Â <span class="hljs-function"><span class="hljs-keyword">private</span>Â <span class="hljs-type">boolean</span>Â <span class="hljs-title">checkTime</span><span class="hljs-params">(<span class="hljs-type">String</span>Â application)</span> </span>{
Â  Â  Â  Â  <span class="hljs-type">long</span> current =Â System.<span class="hljs-built_in">currentTimeMillis</span>();
Â  Â  Â  Â Â <span class="hljs-keyword">return</span>Â current - localValues.<span class="hljs-built_in">get</span>(application).<span class="hljs-built_in">getInsertTime</span>() &gt; timeoutMillis;
Â  Â  }
}
</code></pre>
<h3 data-id="heading-27">æ‰¹æ¬¡å¤§å°è®¡ç®—</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">public</span>Â <span class="hljs-keyword">class</span>Â <span class="hljs-title class_">ClickHouseSinkCounter</span>Â {
Â  Â Â <span class="hljs-keyword">private</span>Â <span class="hljs-keyword">final</span>Â List&lt;LogModel&gt; values;
Â  Â Â <span class="hljs-keyword">private</span>Â <span class="hljs-built_in">Long</span>Â metaSize;Â <span class="hljs-comment">// ç´¯è®¡çš„ metaSizeï¼ˆå­—èŠ‚ï¼‰</span>
Â  Â Â <span class="hljs-keyword">public</span>Â void add(LogModel value) {
Â  Â  Â  Â Â <span class="hljs-keyword">this</span>.values.add(value);
Â  Â  Â  Â Â <span class="hljs-keyword">this</span>.metaSize += value.getMetaSize();Â <span class="hljs-comment">// ç´¯åŠ  metaSize</span>
Â  Â  }
Â  Â Â <span class="hljs-keyword">public</span>Â List&lt;LogModel&gt; copyValuesAndClear() {
Â  Â  Â  Â  List&lt;LogModel&gt; logModels = List.copyOf(<span class="hljs-keyword">this</span>.values);Â <span class="hljs-comment">// æ·±æ‹·è´ï¼ˆä¸å¯å˜ï¼‰</span>
Â  Â  Â  Â Â <span class="hljs-keyword">this</span>.values.clear();
Â  Â  Â  Â Â <span class="hljs-keyword">this</span>.metaSize =Â <span class="hljs-number">0L</span>;
Â  Â  Â  Â Â <span class="hljs-keyword">this</span>.insertTime = System.currentTimeMillis();
Â  Â  Â  Â Â <span class="hljs-keyword">return</span>Â logModels;
Â  Â  }
}
</code></pre>
<p><strong>å…³é”®ç‚¹ï¼š</strong></p>
<ul>
<li>ä½¿ç”¨ metaSizeï¼ˆå­—èŠ‚æ•°ï¼‰è€Œéè®°å½•æ•°æ§åˆ¶æ‰¹æ¬¡ï¼Œå†…å­˜æ§åˆ¶æ›´ç²¾ç¡®ã€‚</li>
<li>List.copyOf() åˆ›å»ºä¸å¯å˜å‰¯æœ¬ï¼Œé¿å…å¹¶å‘ä¿®æ”¹ã€‚</li>
<li>æ¸…ç©ºåé‡ç½® insertTimeï¼Œä¿è¯è¶…æ—¶è§¦å‘å‡†ç¡®æ€§ã€‚</li>
</ul>
<h3 data-id="heading-28">å¸¦éšæœºæŠ–åŠ¨çš„è¶…æ—¶</h3>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-keyword">private</span>Â <span class="hljs-keyword">final</span>Â <span class="hljs-type">long</span>Â timeoutMillis;
<span class="hljs-function"><span class="hljs-keyword">public</span>Â <span class="hljs-title">ClickHouseShardSinkBuffer</span><span class="hljs-params">(...,Â <span class="hljs-type">int</span>Â timeoutSec, ...)</span>Â </span>{
Â  Â Â <span class="hljs-comment">// åŸºç¡€è¶…æ—¶ + 10% éšæœºæŠ–åŠ¨ï¼ˆé¿å…æƒŠç¾¤æ•ˆåº”ï¼‰</span>
Â  Â Â <span class="hljs-keyword">this</span>.timeoutMillis = TimeUnit.SECONDS.<span class="hljs-built_in">toMillis</span>(timeoutSec)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  +Â <span class="hljs-keyword">new</span>Â <span class="hljs-built_in">SecureRandom</span>().<span class="hljs-built_in">nextInt</span>((<span class="hljs-type">int</span>) (timeoutSec *Â <span class="hljs-number">0.1</span>Â *Â <span class="hljs-number">1000</span>));
}
</code></pre>
<p><strong>ç›®çš„ï¼š</strong> é¿å…å¤šä¸ªTM åŒæ—¶è§¦å‘ flushï¼Œé€ æˆå†™å…¥æµé‡å³°å€¼ã€‚</p>
<h3 data-id="heading-29">é…ç½®ç¤ºä¾‹</h3>
<pre><code class="hljs language-scss" lang="scss">ClickHouseShardSinkBuffer<span class="hljs-selector-class">.Builder</span>
Â  Â  <span class="hljs-selector-class">.aClickHouseSinkBuffer</span>()
Â  Â  <span class="hljs-selector-class">.withTargetTable</span>("single_table") Â <span class="hljs-comment">//å•è¡¨æ—¶ï¼Œå¯ç›´æ¥ä½¿ç”¨æŒ‡å®šè¡¨å</span>
Â  Â  <span class="hljs-selector-class">.withMaxFlushBufferSize</span>(<span class="hljs-number">10000</span>) Â <span class="hljs-comment">// å¯¹åº”å­—èŠ‚æ•°</span>
Â  Â  <span class="hljs-selector-class">.withTimeoutSec</span>(<span class="hljs-number">30</span>) Â  Â  Â  Â  Â  Â  Â <span class="hljs-comment">// 30 ç§’è¶…æ—¶</span>
Â  Â  <span class="hljs-selector-class">.withClickHouseShardStrategy</span>(newÂ LogClickHouseShardStrategy("table_prefix_%s",Â <span class="hljs-number">8</span>)) Â <span class="hljs-comment">//åˆ†è¡¨ç­–ç•¥æ—¶ï¼Œä½¿ç”¨</span>
Â  Â Â <span class="hljs-comment">// åˆ†è¡¨ç­–ç•¥å¯æ ¹æ®ä¸šåŠ¡å®é™…æƒ…å†µè¿›è¡Œæ‰©å±•</span>
Â  Â  <span class="hljs-selector-class">.build</span>(clickHouseWriter);
</code></pre>
<h2 data-id="heading-30">å…­ã€å†™å…¥é™æµä¸æµé‡æ§åˆ¶</h2>
<h3 data-id="heading-31">æœ‰ç•Œé˜Ÿåˆ—è®¾è®¡</h3>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span>Â <span class="hljs-keyword">class</span>Â <span class="hljs-title">ClickHouseWriter</span>Â {
Â  Â Â <span class="hljs-comment">// æœ‰ç•Œé˜»å¡é˜Ÿåˆ—</span>
Â  Â Â <span class="hljs-keyword">private</span>Â final BlockingQueue&lt;ClickHouseRequestBlank&gt; commonQueue;
Â  Â Â <span class="hljs-function"><span class="hljs-keyword">public</span>Â <span class="hljs-title">ClickHouseWriter</span>(<span class="hljs-params">ClickHouseSinkCommonParams sinkParams, ...</span>)</span>Â {
Â  Â  Â  Â Â <span class="hljs-comment">// é˜Ÿåˆ—æœ€å¤§å®¹é‡é…ç½®ï¼ˆé»˜è®¤ 10ï¼‰</span>
Â  Â  Â  Â Â <span class="hljs-keyword">this</span>.commonQueue =Â <span class="hljs-keyword">new</span>Â LinkedBlockingQueue&lt;&gt;(sinkParams.getQueueMaxCapacity());
Â  Â  }
Â  Â Â <span class="hljs-function"><span class="hljs-keyword">public</span>Â <span class="hljs-keyword">void</span>Â <span class="hljs-title">put</span>(<span class="hljs-params">ClickHouseRequestBlankÂ <span class="hljs-keyword">params</span></span>)</span>Â {
Â  Â  Â  Â  unProcessedCounter.incrementAndGet();
Â  Â  Â  Â Â <span class="hljs-comment">// put() æ–¹æ³•åœ¨é˜Ÿåˆ—æ»¡æ—¶ä¼šé˜»å¡ï¼Œå®ç°èƒŒå‹</span>
Â  Â  Â  Â  commonQueue.put(<span class="hljs-keyword">params</span>);
Â  Â  }
}
</code></pre>
<p>èƒŒå‹ä¼ å¯¼ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dec8c6b583404a38a991008e87765dfe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771297904&amp;x-signature=opiqc2MK6x4y25odW74eMs9%2BN2U%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<h3 data-id="heading-32">çº¿ç¨‹æ± å¹¶å‘æ§åˆ¶</h3>
<pre><code class="hljs language-ini" lang="ini">publicÂ classÂ ClickHouseWriterÂ {
Â  Â Â privateÂ finalÂ intÂ numWriters<span class="hljs-comment">;Â // å†™å…¥çº¿ç¨‹æ•°</span>
Â  Â Â privateÂ ExecutorService service<span class="hljs-comment">;</span>
Â  Â Â privateÂ voidÂ buildComponents()Â {
Â  Â  Â  Â Â ThreadFactoryÂ <span class="hljs-attr">threadFactory</span>Â =Â ThreadUtil.threadFactory(<span class="hljs-string">"clickhouse-writer"</span>)<span class="hljs-comment">;</span>
Â  Â  Â  Â  <span class="hljs-attr">service</span> = Executors.newFixedThreadPool(numWriters, threadFactory)<span class="hljs-comment">;</span>
Â  Â  Â  Â Â // åˆ›å»ºå¤šä¸ª WriterTask å¹¶æäº¤
Â  Â  Â  Â Â forÂ (intÂ <span class="hljs-attr">i</span>Â =Â <span class="hljs-number">0</span><span class="hljs-comment">; i &lt; numWriters; i++) {</span>
Â  Â  Â  Â  Â  Â Â WriterTaskÂ <span class="hljs-attr">task</span>Â =Â newÂ WriterTask(i, commonQueue, sinkParams, futures, unProcessedCounter)<span class="hljs-comment">;</span>
Â  Â  Â  Â  Â  Â  service.submit(task)<span class="hljs-comment">;</span>
Â  Â  Â  Â  }
Â  Â  }
}
</code></pre>
<h3 data-id="heading-33">WriterTask æ¶ˆè´¹é€»è¾‘</h3>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-keyword">class</span>Â <span class="hljs-title class_">WriterTask</span>Â implements Runnable {
Â  Â  @<span class="hljs-function">Override
Â  Â Â <span class="hljs-keyword">public</span>Â <span class="hljs-type">void</span>Â <span class="hljs-title">run</span><span class="hljs-params">()</span>Â </span>{
Â  Â  Â  Â  isWorking =Â <span class="hljs-literal">true</span>;
Â  Â  Â  Â Â <span class="hljs-keyword">while</span>Â (isWorking || !queue.<span class="hljs-built_in">isEmpty</span>()) {
Â  Â  Â  Â  Â  Â Â <span class="hljs-comment">// poll() è¶…æ—¶è¿”å›ï¼ˆ100msï¼‰ï¼Œé¿å…æ— é™ç­‰å¾…</span>
Â  Â  Â  Â  Â  Â  ClickHouseRequestBlank blank = queue.<span class="hljs-built_in">poll</span>(<span class="hljs-number">100</span>, TimeUnit.MILLISECONDS);
Â  Â  Â  Â  Â  Â Â <span class="hljs-keyword">if</span>Â (blank != null) {
Â  Â  Â  Â  Â  Â  Â  Â Â <span class="hljs-comment">// åˆ›å»º Future å¹¶è®¾ç½®è¶…æ—¶ï¼ˆ3 åˆ†é’Ÿï¼‰</span>
Â  Â  Â  Â  Â  Â  Â  Â  CompletableFuture&lt;Boolean&gt; future =Â <span class="hljs-keyword">new</span>Â CompletableFuture&lt;&gt;();
Â  Â  Â  Â  Â  Â  Â  Â  future.<span class="hljs-built_in">orTimeout</span>(<span class="hljs-number">3</span>, TimeUnit.MINUTES);
Â  Â  Â  Â  Â  Â  Â  Â  futures.<span class="hljs-built_in">add</span>(future);
Â  Â  Â  Â  Â  Â  Â  Â Â <span class="hljs-keyword">try</span>Â {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â <span class="hljs-built_in">send</span>(blank, future,Â <span class="hljs-keyword">new</span>Â HashSet&lt;&gt;());
Â  Â  Â  Â  Â  Â  Â  Â  } finally {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â <span class="hljs-comment">// final è¿›è¡ŒæœªçŸ¥å¼‚å¸¸å…œåº•ï¼Œé˜²æ­¢ä¸ºæ•è·å¼‚å¸¸é€ æˆfutureçŠ¶æ€ä¸å®Œæˆï¼Œæ°¸ä¹…é˜»å¡</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â <span class="hljs-keyword">if</span>Â (!future.<span class="hljs-built_in">isDone</span>()) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  future.<span class="hljs-built_in">completeExceptionally</span>(<span class="hljs-keyword">new</span>Â <span class="hljs-built_in">RuntimeException</span>(<span class="hljs-string">"Unknown exception"</span>));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  queueCounter.<span class="hljs-built_in">decrementAndGet</span>();
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  }
}
</code></pre>
<h3 data-id="heading-34">é…ç½®å‚æ•°</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f9d99484e9774322948675bc946eb62f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771297904&amp;x-signature=%2F5ipurXD1JRrSwWbG4hz7k0OScU%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<h2 data-id="heading-35">ä¸ƒã€é‡è¯•æœºåˆ¶ä¸è¶…æ—¶æ§åˆ¶</h2>
<h3 data-id="heading-36">Future è¶…æ—¶æ§åˆ¶</h3>
<pre><code class="hljs language-ini" lang="ini">publicÂ classÂ ClickHouseWriterÂ {
Â  Â Â privateÂ finalÂ intÂ numWriters<span class="hljs-comment">;Â // å†™å…¥çº¿ç¨‹æ•°</span>
Â  Â Â privateÂ ExecutorService service<span class="hljs-comment">;</span>
Â  Â Â privateÂ voidÂ buildComponents()Â {
Â  Â  Â  Â Â ThreadFactoryÂ <span class="hljs-attr">threadFactory</span>Â =Â ThreadUtil.threadFactory(<span class="hljs-string">"clickhouse-writer"</span>)<span class="hljs-comment">;</span>
Â  Â  Â  Â  <span class="hljs-attr">service</span> = Executors.newFixedThreadPool(numWriters, threadFactory)<span class="hljs-comment">;</span>
Â  Â  Â  Â Â // åˆ›å»ºå¤šä¸ª WriterTask å¹¶æäº¤
Â  Â  Â  Â Â forÂ (intÂ <span class="hljs-attr">i</span>Â =Â <span class="hljs-number">0</span><span class="hljs-comment">; i &lt; numWriters; i++) {</span>
Â  Â  Â  Â  Â  Â Â WriterTaskÂ <span class="hljs-attr">task</span>Â =Â newÂ WriterTask(i, commonQueue, sinkParams, futures, unProcessedCounter)<span class="hljs-comment">;</span>
Â  Â  Â  Â  Â  Â  service.submit(task)<span class="hljs-comment">;</span>
Â  Â  Â  Â  }
Â  Â  }
}
</code></pre>
<p><strong>è¶…æ—¶ç­–ç•¥ï¼š</strong></p>
<ul>
<li><strong>Future è¶…æ—¶ï¼š</strong> 3 åˆ†é’Ÿï¼ˆorTimeoutï¼‰ã€‚</li>
<li><strong>Socket è¶…æ—¶ï¼š</strong> 3 åˆ†é’Ÿï¼ˆsocket_timeout=180000ï¼‰ã€‚</li>
<li><strong>è¿æ¥è¶…æ—¶ï¼š</strong> 30 ç§’ï¼ˆconnectionTimeout=30000ï¼‰ã€‚</li>
</ul>
<h3 data-id="heading-37">é‡è¯•é€»è¾‘</h3>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-keyword">class</span>Â <span class="hljs-title class_">WriterTask</span>Â implements Runnable {
Â  Â  @<span class="hljs-function">Override
Â  Â Â <span class="hljs-keyword">public</span>Â <span class="hljs-type">void</span>Â <span class="hljs-title">run</span><span class="hljs-params">()</span>Â </span>{
Â  Â  Â  Â  isWorking =Â <span class="hljs-literal">true</span>;
Â  Â  Â  Â Â <span class="hljs-keyword">while</span>Â (isWorking || !queue.<span class="hljs-built_in">isEmpty</span>()) {
Â  Â  Â  Â  Â  Â Â <span class="hljs-comment">// poll() è¶…æ—¶è¿”å›ï¼ˆ100msï¼‰ï¼Œé¿å…æ— é™ç­‰å¾…</span>
Â  Â  Â  Â  Â  Â  ClickHouseRequestBlank blank = queue.<span class="hljs-built_in">poll</span>(<span class="hljs-number">100</span>, TimeUnit.MILLISECONDS);
Â  Â  Â  Â  Â  Â Â <span class="hljs-keyword">if</span>Â (blank != null) {
Â  Â  Â  Â  Â  Â  Â  Â Â <span class="hljs-comment">// åˆ›å»º Future å¹¶è®¾ç½®è¶…æ—¶ï¼ˆ3 åˆ†é’Ÿï¼‰</span>
Â  Â  Â  Â  Â  Â  Â  Â  CompletableFuture&lt;Boolean&gt; future =Â <span class="hljs-keyword">new</span>Â CompletableFuture&lt;&gt;();
Â  Â  Â  Â  Â  Â  Â  Â  future.<span class="hljs-built_in">orTimeout</span>(<span class="hljs-number">3</span>, TimeUnit.MINUTES);
Â  Â  Â  Â  Â  Â  Â  Â  futures.<span class="hljs-built_in">add</span>(future);
Â  Â  Â  Â  Â  Â  Â  Â Â <span class="hljs-keyword">try</span>Â {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â <span class="hljs-built_in">send</span>(blank, future,Â <span class="hljs-keyword">new</span>Â HashSet&lt;&gt;());
Â  Â  Â  Â  Â  Â  Â  Â  } finally {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â <span class="hljs-comment">// final è¿›è¡ŒæœªçŸ¥å¼‚å¸¸å…œåº•ï¼Œé˜²æ­¢ä¸ºæ•è·å¼‚å¸¸é€ æˆfutureçŠ¶æ€ä¸å®Œæˆï¼Œæ°¸ä¹…é˜»å¡</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â <span class="hljs-keyword">if</span>Â (!future.<span class="hljs-built_in">isDone</span>()) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  future.<span class="hljs-built_in">completeExceptionally</span>(<span class="hljs-keyword">new</span>Â <span class="hljs-built_in">RuntimeException</span>(<span class="hljs-string">"Unknown exception"</span>));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  queueCounter.<span class="hljs-built_in">decrementAndGet</span>();
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  }
}
</code></pre>
<h3 data-id="heading-38">é‡è¯•æ§åˆ¶é€»è¾‘</h3>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-function"><span class="hljs-keyword">private</span>Â <span class="hljs-type">void</span>Â <span class="hljs-title">handleUnsuccessfulResponse</span><span class="hljs-params">(..., Set&lt;<span class="hljs-type">String</span>&gt; exceptHosts)</span>Â </span>{
Â  Â Â <span class="hljs-comment">// æ£€æŸ¥ Future æ˜¯å¦å·²å®Œæˆï¼ˆé¿å…é‡å¤å®Œæˆï¼‰</span>
Â  Â Â <span class="hljs-keyword">if</span>Â (future.<span class="hljs-built_in">isDone</span>()) {
Â  Â  Â  Â Â <span class="hljs-keyword">return</span>;
Â  Â  }
Â  Â Â <span class="hljs-keyword">if</span>Â (attemptCounter &gt;= maxRetries) {
Â  Â  Â  Â Â <span class="hljs-comment">// è¾¾åˆ°æœ€å¤§é‡è¯•æ¬¡æ•°ï¼Œæ ‡è®°å¤±è´¥</span>
Â  Â  Â  Â  future.<span class="hljs-built_in">completeExceptionally</span>(<span class="hljs-keyword">new</span>Â <span class="hljs-built_in">RuntimeException</span>(<span class="hljs-string">"Max retries exceeded"</span>));
Â  Â  }Â <span class="hljs-keyword">else</span>Â {
Â  Â  Â  Â Â <span class="hljs-comment">// é€’å½’é‡è¯•</span>
Â  Â  Â  Â  requestBlank.<span class="hljs-built_in">incrementCounter</span>();
Â  Â  Â  Â Â <span class="hljs-built_in">send</span>(requestBlank, future, exceptHosts);Â <span class="hljs-comment">// é€’å½’è°ƒç”¨ï¼Œæ’é™¤å¤±è´¥èŠ‚ç‚¹</span>
Â  Â  }
}
</code></pre>
<p><strong>é‡è¯•ç­–ç•¥ï¼š</strong></p>
<ul>
<li><strong>é€’å½’é‡è¯•ï¼š</strong> å¤±è´¥åé€’å½’è°ƒç”¨ï¼Œç›´åˆ°æˆåŠŸæˆ–è¾¾åˆ°æœ€å¤§æ¬¡æ•°ã€‚</li>
<li><strong>å¼‚å¸¸èŠ‚ç‚¹éš”ç¦»ï¼š</strong> æ¯æ¬¡é‡è¯•æ—¶æ’é™¤å¤±è´¥çš„èŠ‚ç‚¹ï¼ˆexceptHostsï¼‰ã€‚</li>
<li><strong>è¶…æ—¶æ§åˆ¶ï¼š</strong> Future è¶…æ—¶ï¼ˆ3 åˆ†é’Ÿï¼‰é˜²æ­¢æ°¸ä¹…é˜»å¡ã€‚</li>
</ul>
<p><strong>ä¸ºä»€ä¹ˆé€’å½’é‡è¯•æ˜¯æ›´å¥½çš„é€‰æ‹©</strong></p>
<p><strong>é€’å½’é‡è¯•ï¼ˆå½“å‰å®ç°ï¼‰</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cff580bff498427780a97a1280a54a21~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771297904&amp;x-signature=jW5LDcOYN7cZmZdYx9jVzsqyzfk%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p><strong>é˜Ÿåˆ—é‡è¯•ï¼ˆå‡è®¾æ–¹æ¡ˆï¼‰</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bfe6d6876377456b9fd028835aefc42c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771297904&amp;x-signature=R7dRjFjZaqR8ZPbcCRsfZi5jIlk%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<h4 data-id="heading-39">ä¿è¯ä¸€è‡´æ€§</h4>
<pre><code class="hljs language-kotlin" lang="kotlin">Â Â <span class="hljs-comment">// ClickHouseWriter.java:139-158</span>
Â Â <span class="hljs-keyword">while</span>Â (!futures.isEmpty() || unProcessedCounter.<span class="hljs-keyword">get</span>() &gt;Â <span class="hljs-number">0</span>) {
Â  Â  Â  CompletableFuture&lt;<span class="hljs-built_in">Void</span>&gt; future = FutureUtil.allOf(futures);
Â  Â  Â  future.<span class="hljs-keyword">get</span>(<span class="hljs-number">3</span>, TimeUnit.MINUTES); Â <span class="hljs-comment">// é˜»å¡ç›´åˆ°å…¨éƒ¨å®Œæˆ</span>
Â  }
</code></pre>
<ul>
<li>Checkpoint æ—¶æ‰€æœ‰æ•°æ®è¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ã€‚</li>
<li>é‡å¯åä¸ä¼šæœ‰éƒ¨åˆ†æ•°æ®é‡å¤çš„é—®é¢˜ã€‚</li>
</ul>
<h4 data-id="heading-40">ç®€å•å¯é </h4>
<ul>
<li>ä»£ç é€»è¾‘æ¸…æ™°ã€‚</li>
<li>å¯¹äºé˜Ÿåˆ—é‡è¯•ä¸”ä¸é‡å¤ï¼Œéœ€è¦å¤æ‚çš„äºŒé˜¶æ®µæäº¤ï¼ˆè¿™é‡Œæš‚ä¸å±•å¼€ï¼‰ï¼Œå¤§å¹…å¢åŠ ä»£ç å¤æ‚åº¦ã€‚</li>
</ul>
<h4 data-id="heading-41">æ€§èƒ½å¯æ¥å—</h4>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-keyword">class</span>Â <span class="hljs-title class_">WriterTask</span>Â implements Runnable {
Â  Â  @<span class="hljs-function">Override
Â  Â Â <span class="hljs-keyword">public</span>Â <span class="hljs-type">void</span>Â <span class="hljs-title">run</span><span class="hljs-params">()</span>Â </span>{
Â  Â  Â  Â Â <span class="hljs-keyword">while</span>Â (isWorking || !queue.<span class="hljs-built_in">isEmpty</span>()) {
Â  Â  Â  Â  Â  Â  ClickHouseRequestBlank blank = queue.<span class="hljs-built_in">poll</span>(<span class="hljs-number">100</span>, TimeUnit.MILLISECONDS);
Â  Â  Â  Â  Â  Â Â <span class="hljs-keyword">if</span>Â (blank != null) {
Â  Â  Â  Â  Â  Â  Â  Â Â <span class="hljs-comment">// åˆ›å»º Future å¹¶è®¾ç½® 3 åˆ†é’Ÿè¶…æ—¶</span>
Â  Â  Â  Â  Â  Â  Â  Â  CompletableFuture&lt;Boolean&gt; future =Â <span class="hljs-keyword">new</span>Â CompletableFuture&lt;&gt;();
Â  Â  Â  Â  Â  Â  Â  Â  future.<span class="hljs-built_in">orTimeout</span>(<span class="hljs-number">3</span>, TimeUnit.MINUTES);Â <span class="hljs-comment">// é˜²æ­¢æ°¸ä¹…é˜»å¡</span>
Â  Â  Â  Â  Â  Â  Â  Â  futures.<span class="hljs-built_in">add</span>(future);
Â  Â  Â  Â  Â  Â  Â  Â Â <span class="hljs-keyword">try</span>Â {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â <span class="hljs-built_in">send</span>(blank, future,Â <span class="hljs-keyword">new</span>Â HashSet&lt;&gt;());
Â  Â  Â  Â  Â  Â  Â  Â  } finally {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â <span class="hljs-keyword">if</span>Â (!future.<span class="hljs-built_in">isDone</span>()) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  future.<span class="hljs-built_in">completeExceptionally</span>(<span class="hljs-keyword">new</span>Â <span class="hljs-built_in">RuntimeException</span>(<span class="hljs-string">"Timeout"</span>));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  queueCounter.<span class="hljs-built_in">decrementAndGet</span>();
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  }
}
</code></pre>
<ul>
<li>è™½ç„¶é˜»å¡ï¼Œä½†æœ‰è¶…æ—¶ä¿æŠ¤ã€‚</li>
<li>ClickHouse å†™å…¥é€šå¸¸å¾ˆå¿«ï¼ˆç§’çº§ï¼‰ã€‚</li>
<li>ç½‘ç»œæ•…éšœæ—¶é‡è¯•ä¹Ÿåˆç†ã€‚</li>
</ul>
<h4 data-id="heading-42">é¿å¼€æ•…éšœèŠ‚ç‚¹</h4>
<pre><code class="hljs language-ini" lang="ini">Â  // ClickHouseWriter.java:259-260
Â  HikariDataSource <span class="hljs-attr">dataSource</span> =Â getNextDataSource(exceptHosts)<span class="hljs-comment">;</span>
</code></pre>
<ul>
<li>é€’å½’æ—¶å¯ä»¥ä¼ é€’ exceptHostsã€‚</li>
<li>è‡ªåŠ¨é¿å¼€å¤±è´¥çš„èŠ‚ç‚¹ã€‚</li>
<li>æé«˜æˆåŠŸç‡ã€‚</li>
</ul>
<h3 data-id="heading-43">å¼‚å¸¸èŠ‚ç‚¹å‰”é™¤</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// ç‰¹æ®Šé”™è¯¯ç åˆ—è¡¨ï¼ˆè‡ªåŠ¨åŠ å…¥é»‘åå•ï¼‰</span>
<span class="hljs-keyword">private</span>Â <span class="hljs-keyword">final</span>Â List&lt;Integer&gt; ignoreHostCodes = Arrays.asList(<span class="hljs-number">210</span>,Â <span class="hljs-number">1002</span>);
<span class="hljs-keyword">public</span>Â HikariDataSource getNextDataSource(Set&lt;String&gt; exceptionHosts) {
Â  Â Â <span class="hljs-keyword">if</span>Â (CollectionUtils.isNotEmpty(exceptionHosts)) {
Â  Â  Â  Â Â <span class="hljs-comment">// è¿‡æ»¤å¼‚å¸¸èŠ‚ç‚¹</span>
Â  Â  Â  Â  List&lt;HikariDataSource&gt; healthyHosts = clickHouseDataSources.stream()
Â  Â  Â  Â  Â  Â  .filter(ds -&gt; !exceptionHosts.contains(getHostFromUrl(ds)))
Â  Â  Â  Â  Â  Â  .collect(Collectors.toList());
Â  Â  Â  Â Â <span class="hljs-keyword">if</span>Â (CollectionUtils.isEmpty(healthyHosts)) {
Â  Â  Â  Â  Â  Â Â <span class="hljs-keyword">return</span>Â <span class="hljs-literal">null</span>;Â <span class="hljs-comment">// æ‰€æœ‰èŠ‚ç‚¹éƒ½å¼‚å¸¸</span>
Â  Â  Â  Â  }
Â  Â  Â  Â Â <span class="hljs-keyword">return</span>Â healthyHosts.<span class="hljs-keyword">get</span>(random.nextInt(healthyHosts.size()));
Â  Â  }
Â  Â Â <span class="hljs-comment">// æ­£å¸¸è½®è¯¢ï¼ˆå·² shuffleï¼Œé¿å…çƒ­ç‚¹ï¼‰</span>
Â  Â Â <span class="hljs-keyword">return</span>Â clickHouseDataSources.<span class="hljs-keyword">get</span>(currentRandom.getAndIncrement() % size);
}
</code></pre>
<p><strong>æ•…éšœèŠ‚ç‚¹å‰”é™¤ç­–ç•¥ï¼š</strong></p>
<ol>
<li><strong>é”™è¯¯ç  210ï¼ˆç½‘ç»œå¼‚å¸¸ï¼‰ï¼š</strong> è‡ªåŠ¨åŠ å…¥é»‘åå•ã€‚</li>
<li><strong>é”™è¯¯ç  1002ï¼ˆè¿æ¥æ± å¼‚å¸¸ï¼‰ï¼š</strong> è‡ªåŠ¨åŠ å…¥é»‘åå•ã€‚</li>
<li><strong>APM ç›‘æ§ï¼š</strong> ç£ç›˜ &gt;= 90%ã€HTTP è¿æ¥ &gt;= 50 çš„èŠ‚ç‚¹ã€‚</li>
<li><strong>æ‰‹åŠ¨é…ç½®ï¼š</strong> é€šè¿‡ Redis é…ç½®å‰”é™¤ã€‚</li>
</ol>
<p><strong>æ¢å¤æœºåˆ¶ï¼š</strong></p>
<ul>
<li>LoadingCache å®šæ—¶åˆ·æ–°ï¼ˆ1 åˆ†é’Ÿï¼‰ã€‚</li>
<li>èŠ‚ç‚¹æ¢å¤å¥åº·åè‡ªåŠ¨ä»é»‘åå•ç§»é™¤ã€‚</li>
</ul>
<h3 data-id="heading-44">é‡è¯•æµç¨‹å›¾</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0189dadaec2c4a59a03071e72b007243~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771297904&amp;x-signature=q3T5EN6w2kq4WuyZT2e%2F3pWOLvQ%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<h2 data-id="heading-45">å…«ã€å¼‚å¸¸å¤„ç†æ¨¡å¼</h2>
<h3 data-id="heading-46">ä¸¤ç§ Sink æ¨¡å¼</h3>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-function"><span class="hljs-keyword">public</span>Â SinkÂ <span class="hljs-title">buildSink</span><span class="hljs-params">(<span class="hljs-type">String</span>Â targetTable,Â <span class="hljs-type">String</span>Â targetCount, <span class="hljs-type">int</span> maxBufferSize)</span> </span>{
Â  Â Â IClickHouseSinkBufferÂ buffer =Â ClickHouseShardSinkBuffer.Builder
Â  Â  Â  Â  .<span class="hljs-built_in">aClickHouseSinkBuffer</span>()
Â  Â  Â  Â  .<span class="hljs-built_in">withTargetTable</span>(targetTable)
Â  Â  Â  Â  .<span class="hljs-built_in">withMaxFlushBufferSize</span>(maxBufferSize)
Â  Â  Â  Â  .<span class="hljs-built_in">withClickHouseShardStrategy</span>(<span class="hljs-keyword">new</span>Â <span class="hljs-built_in">LogClickHouseShardStrategy</span>(targetTable, count))
Â  Â  Â  Â  .<span class="hljs-built_in">build</span>(clickHouseWriter);
Â  Â Â <span class="hljs-comment">// æ ¹æ®é…ç½®é€‰æ‹©æ¨¡å¼</span>
Â  Â Â <span class="hljs-keyword">if</span>Â (ignoringClickHouseSendingExceptionEnabled) {
Â  Â  Â  Â Â <span class="hljs-keyword">return</span>Â <span class="hljs-keyword">new</span>Â <span class="hljs-built_in">UnexceptionableSink</span>(buffer); Â <span class="hljs-comment">// å¿½ç•¥å¼‚å¸¸</span>
Â  Â  }Â <span class="hljs-keyword">else</span>Â {
Â  Â  Â  Â Â <span class="hljs-keyword">return</span>Â <span class="hljs-keyword">new</span>Â <span class="hljs-built_in">ExceptionsThrowableSink</span>(buffer);Â <span class="hljs-comment">// æŠ›å‡ºå¼‚å¸¸</span>
Â  Â  }
}
</code></pre>
<h3 data-id="heading-47">UnexceptionableSinkï¼ˆå¿½ç•¥å¼‚å¸¸ - At-Most-Onceï¼‰</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">public</span>Â <span class="hljs-keyword">class</span>Â <span class="hljs-title class_">UnexceptionableSink</span>Â <span class="hljs-keyword">implements</span>Â <span class="hljs-title class_">Sink</span>&lt;<span class="hljs-title class_">LogModel</span>&gt; {
Â  Â Â <span class="hljs-keyword">private</span>Â finalÂ <span class="hljs-title class_">IClickHouseSinkBuffer</span>&lt;<span class="hljs-title class_">LogModel</span>&gt; buffer;
Â  Â Â <span class="hljs-meta">@Override</span>
Â  Â Â <span class="hljs-keyword">public</span>Â <span class="hljs-built_in">void</span>Â <span class="hljs-title function_">put</span>(<span class="hljs-params">LogModelÂ message</span>) {
Â  Â  Â  Â  buffer.<span class="hljs-title function_">put</span>(message); Â <span class="hljs-comment">// ä¸æ£€æŸ¥ Future çŠ¶æ€</span>
Â  Â  }
Â  Â Â <span class="hljs-meta">@Override</span>
Â  Â Â <span class="hljs-keyword">public</span>Â <span class="hljs-built_in">void</span>Â <span class="hljs-title function_">flush</span>(<span class="hljs-params"/>) {
Â  Â  Â  Â  buffer.<span class="hljs-title function_">flush</span>();
Â  Â  }
}
</code></pre>
<p><strong>é€‚ç”¨åœºæ™¯ï¼š</strong></p>
<ul>
<li>å…è®¸éƒ¨åˆ†æ•°æ®ä¸¢å¤±ã€‚</li>
<li>ä¸å¸Œæœ›å› å†™å…¥å¼‚å¸¸å¯¼è‡´ä»»åŠ¡å¤±è´¥ã€‚</li>
<li>å¯¹æ•°æ®å‡†ç¡®æ€§è¦æ±‚ä¸é«˜ï¼ˆå¦‚æ—¥å¿—ç»Ÿè®¡ï¼‰ã€‚</li>
</ul>
<p><strong>è¯­ä¹‰ä¿è¯ï¼šAt-Most-Onceï¼ˆæœ€å¤šä¸€æ¬¡ï¼‰</strong></p>
<h3 data-id="heading-48">ExceptionsThrowableSinkï¼ˆæŠ›å‡ºå¼‚å¸¸ - At-Least-Onceï¼‰</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span>Â <span class="hljs-keyword">class</span>Â <span class="hljs-title class_">ExceptionsThrowableSink</span>Â <span class="hljs-keyword">implements</span>Â <span class="hljs-title class_">Sink</span>&lt;LogModel&gt; {
Â  Â Â <span class="hljs-keyword">private</span>Â <span class="hljs-keyword">final</span>Â IClickHouseSinkBuffer&lt;LogModel&gt; buffer;
Â  Â Â <span class="hljs-meta">@Override</span>
Â  Â Â <span class="hljs-keyword">public</span>Â <span class="hljs-keyword">void</span>Â <span class="hljs-title function_">put</span><span class="hljs-params">(LogModel message)</span>Â <span class="hljs-keyword">throws</span>Â ExecutionException, InterruptedException {
Â  Â  Â  Â  buffer.put(message);
Â  Â  Â  Â Â <span class="hljs-comment">// æ¯æ¬¡å†™å…¥éƒ½æ£€æŸ¥ Future çŠ¶æ€</span>
Â  Â  Â  Â  buffer.assertFuturesNotFailedYet();
Â  Â  }
Â  Â Â <span class="hljs-meta">@Override</span>
Â  Â Â <span class="hljs-keyword">public</span>Â <span class="hljs-keyword">void</span>Â <span class="hljs-title function_">flush</span><span class="hljs-params">()</span>Â <span class="hljs-keyword">throws</span>Â ExecutionException, InterruptedException {
Â  Â  Â  Â  buffer.flush();
Â  Â  }
}
</code></pre>
<p><strong>Future çŠ¶æ€æ£€æŸ¥ï¼š</strong></p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-function"><span class="hljs-keyword">public</span>Â <span class="hljs-type">void</span>Â <span class="hljs-title">assertFuturesNotFailedYet</span><span class="hljs-params">()</span>Â throws ExecutionException, InterruptedExceptionÂ </span>{
Â  Â  CompletableFuture&lt;Void&gt; future = FutureUtil.<span class="hljs-built_in">allOf</span>(futures);
Â  Â Â <span class="hljs-comment">// éé˜»å¡æ£€æŸ¥</span>
Â  Â Â <span class="hljs-keyword">if</span>Â (future.<span class="hljs-built_in">isCompletedExceptionally</span>()) {
Â  Â  Â  Â  logger.<span class="hljs-built_in">error</span>(<span class="hljs-string">"There is something wrong with the future. exist sink now"</span>);
Â  Â  Â  Â  future.<span class="hljs-built_in">get</span>();Â <span class="hljs-comment">// æŠ›å‡ºå¼‚å¸¸ï¼Œå¯¼è‡´ Flink ä»»åŠ¡å¤±è´¥</span>
Â  Â  }
}
</code></pre>
<p><strong>é€‚ç”¨åœºæ™¯ï¼š</strong></p>
<ul>
<li>æ•°æ®å‡†ç¡®æ€§è¦æ±‚é«˜ã€‚</li>
<li>éœ€è¦ä¿è¯æ‰€æœ‰æ•°æ®å†™å…¥æˆåŠŸã€‚</li>
<li>å¼‚å¸¸æ—¶å¸Œæœ› Flink ä»»åŠ¡å¤±è´¥å¹¶é‡å¯ã€‚</li>
</ul>
<p><strong>è¯­ä¹‰ä¿è¯ï¼šAt-Least-Onceï¼ˆè‡³å°‘ä¸€æ¬¡ï¼‰</strong></p>
<h3 data-id="heading-49">Future æ¸…ç†ç­–ç•¥ä¸å¹¶å‘æ§åˆ¶</h3>
<h4 data-id="heading-50">å®šæ—¶æ£€æŸ¥å™¨</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span>Â <span class="hljs-keyword">class</span>Â <span class="hljs-title class_">ClickHouseSinkScheduledCheckerAndCleaner</span>Â {
Â  Â Â <span class="hljs-keyword">private</span>Â <span class="hljs-keyword">final</span>Â ScheduledExecutorService scheduledExecutorService;
Â  Â Â <span class="hljs-keyword">private</span>Â <span class="hljs-keyword">final</span>Â List&lt;CompletableFuture&lt;Boolean&gt;&gt; futures;
Â  Â Â <span class="hljs-comment">// âš ï¸ volatile ä¿è¯å¤šçº¿ç¨‹å¯è§æ€§ï¼ˆå…³é”®å¹¶å‘æ§åˆ¶ç‚¹ï¼‰</span>
Â  Â Â <span class="hljs-keyword">private</span>Â <span class="hljs-keyword">volatile</span>Â <span class="hljs-type">boolean</span>Â <span class="hljs-variable">isFlushing</span>Â <span class="hljs-operator">=</span>Â <span class="hljs-literal">false</span>;
Â  Â Â <span class="hljs-keyword">public</span>Â <span class="hljs-title function_">ClickHouseSinkScheduledCheckerAndCleaner</span><span class="hljs-params">(...)</span>Â {
Â  Â  Â  Â Â <span class="hljs-comment">// å•çº¿ç¨‹å®šæ—¶æ‰§è¡Œå™¨</span>
Â  Â  Â  Â  scheduledExecutorService = Executors.newSingleThreadScheduledExecutor(factory);
Â  Â  Â  Â Â <span class="hljs-comment">// å®šæ—¶æ‰§è¡Œæ¸…ç†ä»»åŠ¡ï¼ˆæ¯éš” checkTimeout ç§’ï¼Œé»˜è®¤ 30 ç§’ï¼‰</span>
Â  Â  Â  Â  scheduledExecutorService.scheduleWithFixedDelay(getTask(), ...);
Â  Â  }
Â  Â Â <span class="hljs-keyword">private</span>Â RunnableÂ <span class="hljs-title function_">getTask</span><span class="hljs-params">()</span>Â {
Â  Â  Â  Â Â <span class="hljs-keyword">return</span>Â () -&gt; {
Â  Â  Â  Â  Â  Â Â <span class="hljs-keyword">synchronized</span>Â (<span class="hljs-built_in">this</span>) {
Â  Â  Â  Â  Â  Â  Â  Â Â <span class="hljs-comment">//  å…³é”®ï¼šæ£€æŸ¥æ˜¯å¦æ­£åœ¨ flushï¼Œé¿å…å¹¶å‘å†²çª</span>
Â  Â  Â  Â  Â  Â  Â  Â Â <span class="hljs-keyword">if</span>Â (isFlushing) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â <span class="hljs-keyword">return</span>;Â <span class="hljs-comment">// Checkpoint æœŸé—´æš‚åœæ¸…ç†</span>
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â Â <span class="hljs-comment">// 1ï¸âƒ£ æ¸…ç†å·²å®Œæˆçš„ Future</span>
Â  Â  Â  Â  Â  Â  Â  Â  futures.removeIf(filter);
Â  Â  Â  Â  Â  Â  Â  Â Â <span class="hljs-comment">// 2ï¸âƒ£ è§¦å‘æ‰€æœ‰ Buffer çš„ flushï¼ˆæ£€æŸ¥æ˜¯å¦éœ€è¦å†™å…¥ï¼‰</span>
Â  Â  Â  Â  Â  Â  Â  Â  clickHouseSinkBuffers.forEach(IClickHouseSinkBuffer::tryAddToQueue);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  };
Â  Â  }
Â  Â Â <span class="hljs-comment">// Checkpoint flush å‰è°ƒç”¨ï¼ˆæš‚åœ cleanerï¼‰</span>
Â  Â Â <span class="hljs-keyword">public</span>Â <span class="hljs-keyword">synchronized</span>Â <span class="hljs-keyword">void</span>Â <span class="hljs-title function_">beforeFlush</span><span class="hljs-params">()</span>Â {
Â  Â  Â  Â  isFlushing =Â <span class="hljs-literal">true</span>;
Â  Â  }
Â  Â Â <span class="hljs-comment">// Checkpoint flush åè°ƒç”¨ï¼ˆæ¢å¤ cleanerï¼‰</span>
Â  Â Â <span class="hljs-keyword">public</span>Â <span class="hljs-keyword">synchronized</span>Â <span class="hljs-keyword">void</span>Â <span class="hljs-title function_">afterFlush</span><span class="hljs-params">()</span>Â {
Â  Â  Â  Â  isFlushing =Â <span class="hljs-literal">false</span>;
Â  Â  }
}
</code></pre>
<p><strong>æ ¸å¿ƒè®¾è®¡ï¼š</strong></p>
<ul>
<li><strong>volatile boolean isFlushingï¼š</strong> æ ‡å¿—ä½ï¼Œåè°ƒ cleaner ä¸ checkpoint çº¿ç¨‹ã€‚</li>
<li><strong>synchronized (this)ï¼š</strong> ä¿è¯åŸå­æ€§ï¼Œé¿å…å¹¶å‘å†²çªã€‚</li>
<li><strong>å•çº¿ç¨‹æ‰§è¡Œå™¨ï¼š</strong> é¿å… cleaner å†…éƒ¨å¹¶å‘é—®é¢˜ã€‚</li>
</ul>
<h4 data-id="heading-51">å¹¶å‘æ§åˆ¶æœºåˆ¶</h4>
<p><strong>é—®é¢˜åœºæ™¯ï¼š</strong></p>
<pre><code class="hljs language-css" lang="css">æ—¶é—´è½´å†²çªï¼š
T1: Cleaner çº¿ç¨‹æ­£åœ¨æ‰§è¡ŒÂ <span class="hljs-built_in">tryAddToQueue</span>()
T2: Checkpoint è§¦å‘ï¼Œè°ƒç”¨ sink.<span class="hljs-built_in">flush</span>()
T3: Cleaner åŒæ—¶ä¹Ÿåœ¨æ‰§è¡ŒÂ <span class="hljs-built_in">tryAddToQueue</span>()
Â  Â  â”œâ”€ å¯èƒ½å¯¼è‡´ï¼šæ•°æ®é‡å¤å†™å…¥
Â  Â  â”œâ”€ å¯èƒ½å¯¼è‡´ï¼šBuffer æ¸…ç©ºé¡ºåºæ··ä¹±
Â  Â  â””â”€ å¯èƒ½å¯¼è‡´ï¼šFuture çŠ¶æ€ä¸ä¸€è‡´
</code></pre>
<p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// ClickHouseSinkManager.flush()</span>
<span class="hljs-function"><span class="hljs-keyword">public</span>Â <span class="hljs-keyword">void</span>Â <span class="hljs-title">flush</span>()</span>Â {
Â  Â Â <span class="hljs-comment">// 1ï¸âƒ£ æš‚åœå®šæ—¶æ¸…ç†ä»»åŠ¡ï¼ˆè®¾ç½®æ ‡å¿—ï¼‰</span>
Â  Â  clickHouseSinkScheduledCheckerAndCleaner.beforeFlush();Â <span class="hljs-comment">// isFlushing = true</span>
Â  Â Â <span class="hljs-keyword">try</span>Â {
Â  Â  Â  Â Â <span class="hljs-comment">// 2ï¸âƒ£ æ‰§è¡Œ flushï¼ˆæ­¤æ—¶ cleaner çº¿ç¨‹ä¼šè·³è¿‡æ‰§è¡Œï¼‰</span>
Â  Â  Â  Â  clickHouseWriter.waitUntilAllFuturesDone(<span class="hljs-literal">false</span>,Â <span class="hljs-literal">false</span>);
Â  Â  }Â <span class="hljs-keyword">finally</span>Â {
Â  Â  Â  Â Â <span class="hljs-comment">// 3ï¸âƒ£ æ¢å¤å®šæ—¶æ¸…ç†ä»»åŠ¡</span>
Â  Â  Â  Â  clickHouseSinkScheduledCheckerAndCleaner.afterFlush();Â <span class="hljs-comment">// isFlushing = false</span>
Â  Â  }
}
</code></pre>
<p>å¹¶å‘æ§åˆ¶æµç¨‹ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/10f55374e4ee49abb914d3c9137c91f4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771297904&amp;x-signature=rWjqaPoBWG7mDze7UwWj9ENsauA%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p><strong>å…³é”®è®¾è®¡ç‚¹ï¼š</strong></p>
<ol>
<li><strong>volatile ä¿è¯å¯è§æ€§ï¼š</strong> isFlushing ä½¿ç”¨ volatileï¼Œç¡®ä¿å¤šçº¿ç¨‹é—´çš„å¯è§æ€§ã€‚</li>
<li><strong>synchronized ä¿è¯åŸå­æ€§ï¼š</strong> getTask() æ•´ä¸ªæ–¹æ³•ä½“ä½¿ç”¨ synchronized (this)ã€‚</li>
<li><strong>æ ‡å¿—ä½åè°ƒï¼š</strong> é€šè¿‡ isFlushing æ ‡å¿—å®ç°ä¸¤ä¸ªçº¿ç¨‹é—´çš„åè°ƒã€‚</li>
<li><strong>finally ç¡®ä¿æ¢å¤ï¼š</strong> å³ä½¿ waitUntilAllFuturesDone() å¼‚å¸¸ï¼Œä¹Ÿä¼šåœ¨ finally ä¸­æ¢å¤ cleanerã€‚</li>
</ol>
<p><strong>é¿å…çš„å¹¶å‘é—®é¢˜ï¼š</strong></p>
<ul>
<li><strong>æ•°æ®é‡å¤å†™å…¥ï¼š</strong> Cleaner å’Œ Checkpoint åŒæ—¶ flushã€‚</li>
<li><strong>Buffer çŠ¶æ€ä¸ä¸€è‡´ï¼š</strong> ä¸€è¾¹æ¸…ç©ºä¸€è¾¹å†™å…¥ã€‚</li>
<li><strong>Future æ¸…ç†å†²çªï¼š</strong> æ­£åœ¨ä½¿ç”¨çš„ Future è¢«æ¸…ç†ã€‚</li>
</ul>
<p><strong>æ€§èƒ½å½±å“ï¼š</strong></p>
<ul>
<li>Checkpoint flush æœŸé—´ï¼Œcleaner æš‚åœæ‰§è¡Œï¼ˆé€šå¸¸ 1-3 ç§’ï¼‰ã€‚</li>
<li>Cleaner è·³è¿‡çš„å‘¨æœŸä¼šåœ¨ä¸‹æ¬¡æ­£å¸¸æ‰§è¡Œæ—¶è¡¥å¿ã€‚</li>
<li>å¯¹æ•´ä½“ååå½±å“æå°ï¼ˆcleaner é—´éš”é€šå¸¸ 30 ç§’ï¼‰ã€‚</li>
</ul>
<h2 data-id="heading-52">ä¹ã€Checkpoint è¯­ä¹‰ä¿è¯</h2>
<h3 data-id="heading-53">ä¸ºä»€ä¹ˆ Checkpoint æ—¶å¿…é¡» Flushï¼Ÿ</h3>
<h4 data-id="heading-54">ä¸ Flush çš„åæœ</h4>
<p><strong>ä¸Flushå¯¼è‡´æ•°æ®æ°¸ä¹…ä¸¢å¤±</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3ef7013722b5400084a22dd0754d2a47~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771297904&amp;x-signature=MhVyQZQj1FGYwBPV%2Fud2blWmEn8%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<h4 data-id="heading-55">æ­£ç¡®åšæ³•</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span>Â <span class="hljs-keyword">void</span>Â <span class="hljs-title function_">snapshotState</span><span class="hljs-params">(FunctionSnapshotContext context)</span>Â <span class="hljs-keyword">throws</span>Â Exception {
Â  Â  logger.info(<span class="hljs-string">"start doing snapshot. flush sink to ck"</span>);
Â  Â Â <span class="hljs-comment">// 1. å…ˆ flush bufferï¼ˆå°†å†…å­˜æ•°æ®å†™å…¥ ClickHouseï¼‰</span>
Â  Â Â <span class="hljs-keyword">if</span>Â (sink !=Â <span class="hljs-literal">null</span>) {
Â  Â  Â  Â  sink.flush();
Â  Â  }
Â  Â Â <span class="hljs-comment">// 2. ç­‰å¾…æ‰€æœ‰å†™å…¥å®Œæˆ</span>
Â  Â Â <span class="hljs-keyword">if</span>Â (sinkManager !=Â <span class="hljs-literal">null</span>Â &amp;&amp; !sinkManager.isClosed()) {
Â  Â  Â  Â  sinkManager.flush();
Â  Â  }
Â  Â Â <span class="hljs-comment">// æ­¤æ—¶ Checkpoint æ‰èƒ½æ ‡è®°ä¸ºæˆåŠŸ</span>
Â  Â  logger.info(<span class="hljs-string">"doing snapshot. flush sink to ck"</span>);
}
</code></pre>
<h3 data-id="heading-56">Flush å®ç°ä¸å¹¶å‘åè°ƒ</h3>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span>Â <span class="hljs-keyword">class</span>Â <span class="hljs-title">ClickHouseSinkManager</span>Â {
Â  Â Â <span class="hljs-function"><span class="hljs-keyword">public</span>Â <span class="hljs-keyword">void</span>Â <span class="hljs-title">flush</span>()</span>Â {
Â  Â  Â  Â Â <span class="hljs-comment">//  æ­¥éª¤1ï¼šæš‚åœå®šæ—¶æ¸…ç†ä»»åŠ¡</span>
Â  Â  Â  Â  clickHouseSinkScheduledCheckerAndCleaner.beforeFlush();Â <span class="hljs-comment">// isFlushing = true</span>
Â  Â  Â  Â Â <span class="hljs-keyword">try</span>Â {
Â  Â  Â  Â  Â  Â Â <span class="hljs-comment">//  æ­¥éª¤2ï¼šæ‰§è¡Œ buffer flush + ç­‰å¾…æ‰€æœ‰å†™å…¥å®Œæˆ</span>
Â  Â  Â  Â  Â  Â  clickHouseWriter.waitUntilAllFuturesDone(<span class="hljs-literal">false</span>,Â <span class="hljs-literal">false</span>);
Â  Â  Â  Â  }Â <span class="hljs-keyword">finally</span>Â {
Â  Â  Â  Â  Â  Â Â <span class="hljs-comment">//  æ­¥éª¤3ï¼šæ¢å¤å®šæ—¶æ¸…ç†ä»»åŠ¡ï¼ˆfinally ç¡®ä¿æ‰§è¡Œï¼‰</span>
Â  Â  Â  Â  Â  Â  clickHouseSinkScheduledCheckerAndCleaner.afterFlush();Â <span class="hljs-comment">// isFlushing = false</span>
Â  Â  Â  Â  }
Â  Â  }
}
</code></pre>
<p><strong>å¹¶å‘åè°ƒè¯¦è§£ï¼š</strong></p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// cleaner çº¿ç¨‹æ‰§è¡Œæµç¨‹</span>
synchronized (<span class="hljs-keyword">this</span>) {
Â  Â Â <span class="hljs-keyword">if</span>Â (isFlushing) {
Â  Â  Â  Â Â <span class="hljs-keyword">return</span>;Â <span class="hljs-comment">// Checkpoint æœŸé—´è·³è¿‡æœ¬æ¬¡æ‰§è¡Œ</span>
Â  Â  }
Â  Â Â <span class="hljs-comment">// æ­£å¸¸æ‰§è¡Œï¼šæ¸…ç†å·²å®Œæˆçš„ Future + è§¦å‘ Buffer flush</span>
Â  Â  futures.removeIf(filter);
Â  Â  buffers.forEach(Buffer::tryAddToQueue);
}
</code></pre>
<p><strong>å…³é”®ç‚¹ï¼š</strong></p>
<ul>
<li><strong>volatile å¯è§æ€§ï¼š</strong> isFlushing ä½¿ç”¨ volatile ç¡®ä¿ cleaner çº¿ç¨‹ç«‹å³çœ‹åˆ°çŠ¶æ€å˜åŒ–ã€‚</li>
<li><strong>synchronizedäº’æ–¥ï¼š</strong> getTask()æ–¹æ³•ä½“ä½¿ç”¨ synchronized (this) ç¡®ä¿åŸå­æ€§ã€‚</li>
<li><strong>æ ‡å¿—ä½åè°ƒï¼š</strong> é€šè¿‡ beforeFlush() / afterFlush() ç®¡ç†æ ‡å¿—ä½ã€‚</li>
<li><strong>finally ä¿è¯æ¢å¤ï¼š</strong> å³ä½¿ flush å¼‚å¸¸ï¼Œä¹Ÿä¼šåœ¨ finally ä¸­æ¢å¤ cleanerã€‚</li>
</ul>
<h3 data-id="heading-57">ç­‰å¾…æ‰€æœ‰ Future å®Œæˆ</h3>
<pre><code class="hljs language-scss" lang="scss">publicÂ synchronizedÂ voidÂ <span class="hljs-built_in">waitUntilAllFuturesDone</span>(booleanÂ stopWriters,Â booleanÂ clearFutures) {
Â  Â Â tryÂ {
Â  Â  Â  Â Â <span class="hljs-comment">// å¾ªç¯ç­‰å¾…ï¼šç›´åˆ°æ‰€æœ‰ Future å®Œæˆ + é˜Ÿåˆ—æ¸…ç©º</span>
Â  Â  Â  Â Â whileÂ (!futures.isEmpty() || unProcessedCounter<span class="hljs-selector-class">.get</span>() &gt;Â <span class="hljs-number">0</span>) {
Â  Â  Â  Â  Â  Â Â CompletableFuture&lt;Void&gt; <span class="hljs-attribute">all</span> =Â FutureUtil<span class="hljs-selector-class">.allOf</span>(futures);
Â  Â  Â  Â  Â  Â Â <span class="hljs-comment">// æœ€å¤šç­‰å¾… 3 åˆ†é’Ÿï¼ˆä¸ Future è¶…æ—¶ä¸€è‡´ï¼‰</span>
Â  Â  Â  Â  Â  Â  <span class="hljs-attribute">all</span><span class="hljs-selector-class">.get</span>(<span class="hljs-number">3</span>,Â TimeUnit.MINUTES);
Â  Â  Â  Â  Â  Â Â <span class="hljs-comment">// ç§»é™¤å·²å®Œæˆçš„ Futureï¼ˆéå¼‚å¸¸ï¼‰</span>
Â  Â  Â  Â  Â  Â  futures<span class="hljs-selector-class">.removeIf</span>(f -&gt; f.isDone() &amp;&amp; !f<span class="hljs-selector-class">.isCompletedExceptionally</span>());
Â  Â  Â  Â  Â  Â Â <span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦æœ‰å¼‚å¸¸ Future</span>
Â  Â  Â  Â  Â  Â Â ifÂ (anyFutureFailed()) {
Â  Â  Â  Â  Â  Â  Â  Â Â break;Â <span class="hljs-comment">// æœ‰å¼‚å¸¸åˆ™é€€å‡º</span>
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  }Â finallyÂ {
Â  Â  Â  Â Â ifÂ (stopWriters)Â <span class="hljs-built_in">stopWriters</span>();
Â  Â  Â  Â Â ifÂ (clearFutures) futures<span class="hljs-selector-class">.clear</span>();
Â  Â  }
}
</code></pre>
<p><strong>å…³é”®é€»è¾‘ï¼š</strong></p>
<ul>
<li>å¾ªç¯ç­‰å¾…ç›´åˆ°æ‰€æœ‰ Future å®Œæˆ + é˜Ÿåˆ—æ¸…ç©ºã€‚</li>
<li>è¶…æ—¶ 3 åˆ†é’Ÿï¼ˆä¸ Future è¶…æ—¶ä¸€è‡´ï¼‰ã€‚</li>
<li>ç§»é™¤å·²å®Œæˆçš„éå¼‚å¸¸ Futureã€‚</li>
<li>æœ‰å¼‚å¸¸æ—¶é€€å‡ºå¾ªç¯ã€‚</li>
</ul>
<h3 data-id="heading-58">ä¸‰ç§ Flush è§¦å‘æ–¹å¼å¯¹æ¯”</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5ba3862ba4e84285b1be07308345fdb4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771297904&amp;x-signature=skgFor1D%2FYZHiYwHiGTxrQDZrKI%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<h3 data-id="heading-59">Checkpoint å‚æ•°é…ç½®</h3>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// Checkpoint é…ç½®å»ºè®®</span>
StreamExecutionEnvironmentÂ envÂ =Â StreamExecutionEnvironment<span class="hljs-selector-class">.getExecutionEnvironment</span>();
<span class="hljs-comment">// å¯ç”¨ Checkpointï¼ˆé—´éš” 1 åˆ†é’Ÿï¼‰</span>
env<span class="hljs-selector-class">.enableCheckpointing</span>(<span class="hljs-number">60000</span>);
<span class="hljs-comment">// Checkpoint è¶…æ—¶ï¼ˆå¿…é¡»å¤§äº Future è¶…æ—¶ + é‡è¯•æ—¶é—´ï¼‰</span>
<span class="hljs-comment">// å»ºè®®ï¼šCheckpointTimeout &gt; FutureTimeout * MaxRetries</span>
env<span class="hljs-selector-class">.getCheckpointConfig</span>()<span class="hljs-selector-class">.setCheckpointTimeout</span>(<span class="hljs-number">600000</span>);Â <span class="hljs-comment">// 10 åˆ†é’Ÿ</span>
<span class="hljs-comment">// ä¸€è‡´æ€§æ¨¡å¼</span>
env<span class="hljs-selector-class">.getCheckpointConfig</span>()<span class="hljs-selector-class">.setCheckpointingMode</span>(CheckpointingMode.EXACTLY_ONCE);
<span class="hljs-comment">// æœ€å°é—´éš”ï¼ˆé¿å…è¿‡äºé¢‘ç¹ï¼‰</span>
env<span class="hljs-selector-class">.getCheckpointConfig</span>()<span class="hljs-selector-class">.setMinPauseBetweenCheckpoints</span>(<span class="hljs-number">30000</span>);Â <span class="hljs-comment">// 30 ç§’</span>
<span class="hljs-comment">// æœ€å¤§å¹¶å‘ Checkpoint æ•°</span>
env<span class="hljs-selector-class">.getCheckpointConfig</span>()<span class="hljs-selector-class">.setMaxConcurrentCheckpoints</span>(<span class="hljs-number">1</span>);
</code></pre>
<h3 data-id="heading-60">è¯­ä¹‰ä¿è¯</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4c965ba43df64f469d2a77c7eccae8ce~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771297904&amp;x-signature=9o0Je3HH%2BS7502YiMr%2BRlt5wq%2Bc%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p><strong>æ¨èé…ç½®ï¼š</strong></p>
<p><strong>ç”Ÿäº§ç¯å¢ƒï¼š</strong> ä½¿ç”¨ ExceptionsThrowableSink + Checkpointã€‚</p>
<p><strong>å…è®¸éƒ¨åˆ†ä¸¢å¤±ï¼š</strong> ä½¿ç”¨ UnexceptionableSinkã€‚</p>
<h2 data-id="heading-61">åã€æœ€ä½³å®è·µä¸è°ƒä¼˜</h2>
<h3 data-id="heading-62">ç”Ÿäº§é…ç½®</h3>
<pre><code class="hljs language-ini" lang="ini">// ========== ClickHouse è¿æ¥å‚æ•° ==========
<span class="hljs-attr">clickhouse.sink.target-table</span> = tb_logs_local
<span class="hljs-attr">clickhouse.sink.max-buffer-size</span> =Â <span class="hljs-number">104857600</span>Â  Â  Â  Â Â // æ‰¹æ¬¡å¤§å°
<span class="hljs-attr">clickhouse.sink.table-count</span> =Â <span class="hljs-number">0</span>Â  Â  Â  Â  Â  Â  Â  Â Â // <span class="hljs-number">0</span> è¡¨ç¤ºä¸åˆ†è¡¨
// ========== å†™å…¥æ€§èƒ½å‚æ•° ==========
<span class="hljs-attr">clickhouse.sink.num-writers</span> =Â <span class="hljs-number">10</span>Â  Â  Â  Â  Â  Â  Â  Â // å†™å…¥çº¿ç¨‹æ•°
<span class="hljs-attr">clickhouse.sink.queue-max-capacity</span> =Â <span class="hljs-number">10</span>Â  Â  Â  Â Â // é˜Ÿåˆ—å®¹é‡
<span class="hljs-attr">clickhouse.sink.timeout-sec</span> =Â <span class="hljs-number">30</span>Â  Â  Â  Â  Â  Â  Â  Â // flush è¶…æ—¶
<span class="hljs-attr">clickhouse.sink.retries</span> =Â <span class="hljs-number">10</span>Â  Â  Â  Â  Â  Â  Â  Â  Â  Â // æœ€å¤§é‡è¯•æ¬¡æ•°
<span class="hljs-attr">clickhouse.sink.check.timeout-sec</span> =Â <span class="hljs-number">30</span>Â  Â  Â  Â  Â // å®šæ—¶æ£€æŸ¥é—´éš”
// ========== å¼‚å¸¸å¤„ç†å‚æ•° ==========
<span class="hljs-attr">clickhouse.sink.ignoring-clickhouse-sending-exception-enabled</span> =Â <span class="hljs-literal">false</span>
<span class="hljs-attr">clickhouse.sink.local-address-enabled</span> =Â <span class="hljs-literal">true</span>Â  Â // å¯ç”¨æœ¬åœ°è¡¨å†™å…¥
// ========== ClickHouse é›†ç¾¤é…ç½® ==========
<span class="hljs-attr">clickhouse.access.hosts</span> =Â <span class="hljs-number">192.168</span>.<span class="hljs-number">1.1</span>:<span class="hljs-number">8123</span>,<span class="hljs-number">192.168</span>.<span class="hljs-number">1.2</span>:<span class="hljs-number">8123</span>,<span class="hljs-number">192.168</span>.<span class="hljs-number">1.3</span>:<span class="hljs-number">8123</span>
<span class="hljs-attr">clickhouse.access.user</span> =Â default
<span class="hljs-attr">clickhouse.access.password</span> = ***
<span class="hljs-attr">clickhouse.access.database</span> = dw_xx_xx
<span class="hljs-attr">clickhouse.access.cluster</span> =Â default
// ========== HikariCP è¿æ¥æ± é…ç½® ==========
<span class="hljs-attr">connectionTimeout</span> =Â <span class="hljs-number">30000</span>Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â // è¿æ¥è¶…æ—¶ <span class="hljs-number">30</span>s
<span class="hljs-attr">maximumPoolSize</span> =Â <span class="hljs-number">20</span>Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â // æœ€å¤§è¿æ¥æ•° <span class="hljs-number">20</span>
<span class="hljs-attr">minimumIdle</span> =Â <span class="hljs-number">2</span>Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â // æœ€å°ç©ºé—² <span class="hljs-number">2</span>
<span class="hljs-attr">socket_timeout</span> =Â <span class="hljs-number">180000</span>Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â // Socket è¶…æ—¶ <span class="hljs-number">3</span>mi
</code></pre>
<h2 data-id="heading-63">æ€§èƒ½è°ƒä¼˜</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bbe85a601349453aa2541fe47b0e88e1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771297904&amp;x-signature=3XhrUD4mwBz1c%2FJeYb8fQ5x7Amg%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<h2 data-id="heading-64">æ•…éšœæ’æŸ¥</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e2a917bed37a46ccb9f2a8a196762b93~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771297904&amp;x-signature=WlnooX42uWG5kXf4ycZTBXk4VTY%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<h2 data-id="heading-65">åä¸€ã€æ€»ç»“</h2>
<p>æœ¬æ–‡æ·±å…¥åˆ†æäº† Flink ClickHouse Sink çš„å®ç°æ–¹æ¡ˆï¼Œæ ¸å¿ƒäº®ç‚¹åŒ…æ‹¬ï¼š</p>
<h3 data-id="heading-66">æŠ€æœ¯äº®ç‚¹</h3>
<ul>
<li><strong>è¿æ¥æ± é€‰å‹ï¼š</strong> ä½¿ç”¨ HikariCPï¼Œæ€§èƒ½ä¼˜å¼‚ï¼Œè¿æ¥ç®¡ç†å¯é ã€‚</li>
<li><strong>Future è¶…æ—¶æ§åˆ¶ï¼š</strong> orTimeout(3min) é˜²æ­¢æ°¸ä¹…é˜»å¡ã€‚</li>
<li><strong>æ˜¾å¼èµ„æºç®¡ç†ï¼š</strong> Connection å’Œ PreparedStatement æ˜¾å¼å…³é—­ï¼Œé˜²æ­¢è¿æ¥æ³„æ¼ã€‚</li>
<li><strong>è´Ÿè½½å‡è¡¡ä¼˜åŒ–ï¼š</strong> Shuffle åˆå§‹åŒ– + è½®è¯¢é€‰æ‹©ï¼Œé¿å…çƒ­ç‚¹ã€‚</li>
<li><strong>å¼‚å¸¸å¤„ç†å¢å¼ºï¼š</strong> future.isDone() æ£€æŸ¥ï¼Œé¿å…é‡å¤å®Œæˆã€‚</li>
<li><strong>æœ¬åœ°è¡¨å†™å…¥ï¼š</strong> åŠ¨æ€èŠ‚ç‚¹å‘ç° + æ•…éšœå‰”é™¤ï¼Œå†™å…¥æ€§èƒ½æå‡ã€‚</li>
<li><strong>åˆ†ç‰‡ç­–ç•¥ï¼š</strong> æŒ‰è¡¨ï¼ˆåº”ç”¨ï¼‰ç»´åº¦è·¯ç”±ï¼Œç‹¬ç«‹ç¼“å†²å’Œéš”ç¦»ã€‚</li>
<li><strong>æ”’æ‰¹ä¼˜åŒ–ï¼š</strong> åŒè§¦å‘æœºåˆ¶ï¼ˆå¤§å° + è¶…æ—¶ï¼‰+ éšæœºæŠ–åŠ¨ã€‚</li>
<li><strong>æµé‡æ§åˆ¶ï¼š</strong> æœ‰ç•Œé˜Ÿåˆ— + çº¿ç¨‹æ± ï¼Œå®ç°èƒŒå‹ã€‚</li>
<li><strong>å¥å£®é‡è¯•ï¼š</strong> é€’å½’é‡è¯• + å¼‚å¸¸èŠ‚ç‚¹å‰”é™¤ + æœ€å¤§é‡è¯•é™åˆ¶ã€‚</li>
</ul>
<h3 data-id="heading-67">Checkpoint è¯­ä¹‰</h3>
<ul>
<li><strong>At-Least-Onceï¼š</strong> ExceptionsThrowableSink + Checkpointã€‚</li>
<li><strong>At-Most-Onceï¼š</strong> UnexceptionableSinkã€‚</li>
<li><strong>Exactly-Onceï¼š</strong> éœ€è¦é…åˆ ClickHouse äº‹åŠ¡ï¼ˆæœªå®ç°ï¼‰ã€‚</li>
</ul>
<h3 data-id="heading-68">ç”Ÿäº§å»ºè®®</h3>
<ol>
<li><strong>å¿…é¡»ï¼š</strong> Checkpoint æ—¶ flushï¼Œå¦åˆ™ä¼šä¸¢æ•°æ®ã€‚</li>
<li><strong>æ¨èï¼š</strong> ä½¿ç”¨ HikariCP + æœ¬åœ°è¡¨å†™å…¥ã€‚</li>
<li><strong>æ¨èï¼š</strong> é…ç½®åˆç†çš„è¶…æ—¶ï¼ˆFuture &lt; Socket &lt; Checkpointï¼‰ã€‚</li>
<li><strong>æ¨èï¼š</strong> ç›‘æ§é˜Ÿåˆ—å¤§å°ã€Future å¤±è´¥ç‡ã€é‡è¯•æ¬¡æ•°ã€‚</li>
</ol>
<p>è¯¥æ–¹æ¡ˆå·²åœ¨ç”Ÿäº§ç¯å¢ƒå¤§è§„æ¨¡éªŒè¯ï¼Œèƒ½å¤Ÿç¨³å®šæ”¯æ’‘<strong>ç™¾ä¸‡çº§ TPS</strong> çš„æ—¥å¿—å†™å…¥åœºæ™¯ã€‚</p>
<h2 data-id="heading-69">å¾€æœŸå›é¡¾</h2>
<p>1.æœåŠ¡æ‹†åˆ†ä¹‹æ—…ï¼šæµ‹è¯•è¿‡ç¨‹å…¨æ­ç§˜ï½œå¾—ç‰©æŠ€æœ¯</p>
<p>2.å¤§æ¨¡å‹ç½‘å…³ï¼šå¤§æ¨¡å‹æ—¶ä»£çš„æ™ºèƒ½äº¤é€šæ¢çº½ï½œå¾—ç‰©æŠ€æœ¯</p>
<p>3.ä»â€œäººæ²»â€åˆ°â€œæœºæ²»â€ï¼šå¾—ç‰©ç¦»çº¿æ•°ä»“å‘å¸ƒæµæ°´çº¿è´¨é‡é—¨ç¦å®è·µ</p>
<p>4.AIç¼–ç¨‹å®è·µï¼šä»Claude Codeå®è·µåˆ°å›¢é˜Ÿåä½œçš„ä¼˜åŒ–æ€è€ƒï½œå¾—ç‰©æŠ€æœ¯</p>
<p>5.å…¥é€‰AAAI-PerFMï½œå¾—ç‰©ç¤¾åŒºæ¨èä¹‹åŸºäºå¤§è¯­è¨€æ¨¡å‹çš„æ–°é¢–æ€§æ¨èç®—æ³•</p>
<h2 data-id="heading-70">æ–‡ /è™šç™½</h2>
<p>å…³æ³¨å¾—ç‰©æŠ€æœ¯ï¼Œæ¯å‘¨æ›´æ–°æŠ€æœ¯å¹²è´§</p>
<p>è¦æ˜¯è§‰å¾—æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©çš„è¯ï¼Œæ¬¢è¿è¯„è®ºè½¬å‘ç‚¹èµï½</p>
<p>æœªç»å¾—ç‰©æŠ€æœ¯è®¸å¯ä¸¥ç¦è½¬è½½ï¼Œå¦åˆ™ä¾æ³•è¿½ç©¶æ³•å¾‹è´£ä»»ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å‰ç«¯è·¨åŸŸå…¨æ”»ç•¥ï¼šä» Vite ä»£ç†åˆ° Nginx ç”Ÿäº§ç¯å¢ƒé…ç½®å®æˆ˜]]></title>    <link>https://juejin.cn/post/7604761524976648201</link>    <guid>https://juejin.cn/post/7604761524976648201</guid>    <pubDate>2026-02-10T03:14:52.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604761524976648201" data-draft-id="7604665952321372211" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å‰ç«¯è·¨åŸŸå…¨æ”»ç•¥ï¼šä» Vite ä»£ç†åˆ° Nginx ç”Ÿäº§ç¯å¢ƒé…ç½®å®æˆ˜"/> <meta itemprop="keywords" content="å‰ç«¯,Nginx,é¢è¯•"/> <meta itemprop="datePublished" content="2026-02-10T03:14:52.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å‘ç°ä¸€åªå¤§å‘†ç“œ"/> <meta itemprop="url" content="https://juejin.cn/user/180747382561607"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å‰ç«¯è·¨åŸŸå…¨æ”»ç•¥ï¼šä» Vite ä»£ç†åˆ° Nginx ç”Ÿäº§ç¯å¢ƒé…ç½®å®æˆ˜
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/180747382561607/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å‘ç°ä¸€åªå¤§å‘†ç“œ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T03:14:52.000Z" title="Tue Feb 10 2026 03:14:52 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">å‰è¨€</h3>
<p>åœ¨å‰åç«¯åˆ†ç¦»çš„æ¶æ„ä¸­ï¼Œè·¨åŸŸï¼ˆCORSï¼‰æ˜¯æˆ‘ä»¬è”è°ƒæ¥å£æ—¶é‡åˆ°çš„ç¬¬ä¸€ä¸ªâ€œæ‹¦è·¯è™â€ã€‚æ— è®ºæ˜¯æœ¬åœ°å¼€å‘è¿˜æ˜¯çº¿ä¸Šéƒ¨ç½²ï¼ŒæŒæ¡è·¨åŸŸçš„è§£å†³æ‰‹æ®µæ˜¯å‰ç«¯å¼€å‘è€…çš„åŸºæœ¬åŠŸã€‚æœ¬æ–‡å°†ç»“åˆ Vite å’Œ Nginxï¼Œæ·±åº¦è§£æè·¨åŸŸé—®é¢˜çš„ç»ˆæè§£å†³æ–¹æ¡ˆã€‚</p>
<h2 data-id="heading-1">ä¸€ã€ ä»€ä¹ˆæ˜¯è·¨åŸŸï¼Ÿ</h2>
<p><strong>è·¨åŸŸ</strong>æ˜¯ç”±æµè§ˆå™¨çš„<strong>åŒæºç­–ç•¥ï¼ˆSame-origin policyï¼‰å¼•èµ·çš„ã€‚å½“ä¸€ä¸ªè¯·æ±‚çš„åè®®ã€åŸŸåã€ç«¯å£</strong>ä¸‰è€…ä¸­è‡³å°‘æœ‰ä¸€ä¸ªä¸åŒæ—¶ï¼Œæµè§ˆå™¨å°±ä¼šæ‹¦æˆªè¯¥è¯·æ±‚çš„å“åº”ã€‚</p>
<blockquote>
<p><strong>æ³¨æ„</strong>ï¼šè·¨åŸŸè¯·æ±‚å…¶å®å·²ç»å‘åˆ°äº†æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨ä¹Ÿæ­£å¸¸è¿”å›äº†æ•°æ®ï¼Œåªæ˜¯æµè§ˆå™¨åœ¨æ¥æ”¶å“åº”æ—¶ï¼Œå‘ç°æºä¸åŒ¹é…ï¼Œä¸ºäº†å®‰å…¨å°†å…¶æ‹¦æˆªäº†ã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-2">äºŒã€ å¼€å‘ç¯å¢ƒæ–¹æ¡ˆï¼šVite åå‘ä»£ç†</h2>
<p>åœ¨å¼€å‘é˜¶æ®µï¼Œæˆ‘ä»¬æ— æ³•è¦æ±‚åç«¯é¢‘ç¹æ”¹åŠ¨ CORS é…ç½®ã€‚æ­¤æ—¶ï¼Œåˆ©ç”¨ Vite è‡ªå¸¦çš„ <code>http-proxy</code> æ¨¡å—è¿›è¡Œè½¬å‘æ˜¯æœ€ä¼˜è§£ã€‚</p>
<h3 data-id="heading-3">1. Vite é…ç½®å®æˆ˜</h3>
<p>åœ¨ <code>vite.config.js</code> ä¸­é…ç½® <code>server</code> å¯¹è±¡ï¼Œé€šè¿‡ä»£ç†æœåŠ¡å™¨ç»•è¿‡æµè§ˆå™¨åŒæºç­–ç•¥ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-attr">server</span>: {
    <span class="hljs-attr">port</span>: <span class="hljs-number">3000</span>,
    <span class="hljs-attr">cors</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// å¯ç”¨å¹¶å…è®¸ä»»ä½•æºï¼ˆä¸»è¦ç”¨äºå¼€å‘æœåŠ¡å™¨çš„å“åº”å¤´ï¼‰</span>
    <span class="hljs-attr">open</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// å¯åŠ¨æ—¶è‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨</span>
    
    <span class="hljs-comment">// åå‘ä»£ç†é…ç½®</span>
    <span class="hljs-attr">proxy</span>: {
      <span class="hljs-comment">// åœºæ™¯ Aï¼šä¸ç§»é™¤è·¯å¾„å‰ç¼€</span>
      <span class="hljs-comment">// ä¾‹å¦‚è¯·æ±‚ /aPath/login ä¼šè½¬å‘åˆ° http://33.133.190.116:8100/aPath/login</span>
      <span class="hljs-string">"/aPath"</span>: {
        <span class="hljs-attr">target</span>: <span class="hljs-string">"http://33.133.190.116:8100"</span>, 
        <span class="hljs-attr">changeOrigin</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// å¿…é¡»è®¾ç½®ä¸º trueï¼Œå¦åˆ™åç«¯æ— æ³•è·å–æ­£ç¡®çš„ Host</span>
      },
      
      <span class="hljs-comment">// åœºæ™¯ Bï¼šé‡å†™è·¯å¾„ï¼ˆç§»é™¤å‰ç¼€ï¼‰</span>
      <span class="hljs-comment">// ä¾‹å¦‚è¯·æ±‚ /bPath/list ä¼šè½¬å‘åˆ° http://172.16.7.160:9022/list</span>
      <span class="hljs-string">"/bPath"</span>: {
        <span class="hljs-attr">target</span>: <span class="hljs-string">"http://172.16.7.160:9022"</span>,
        <span class="hljs-attr">changeOrigin</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">rewrite</span>: <span class="hljs-function">(<span class="hljs-params">path</span>) =&gt;</span> path.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/^/</span>bPath/, <span class="hljs-string">""</span>),
      },
    },
  },
})
</code></pre>
<hr/>
<h2 data-id="heading-4">ä¸‰ã€ ç”Ÿäº§ç¯å¢ƒæ–¹æ¡ˆï¼šNginx éƒ¨ç½²é…ç½®</h2>
<p>é¡¹ç›®ä¸Šçº¿åï¼ŒVite çš„ä»£ç†å°±ä¸èµ·ä½œç”¨äº†ã€‚æ­¤æ—¶æˆ‘ä»¬éœ€è¦åœ¨ Nginx ä¸­é…ç½®åå‘ä»£ç†ï¼Œè®©æ‰€æœ‰çš„è¯·æ±‚ç”± Nginx ç»Ÿä¸€åˆ†å‘ã€‚</p>
<h3 data-id="heading-5">1. Nginx æ ¸å¿ƒé…ç½®æ–‡ä»¶è§£æ (<code>nginx.conf</code>)</h3>
<pre><code class="hljs language-Nginx" lang="Nginx"># åŸºç¡€å…¨å±€é…ç½®
user nginx;
worker_processes auto; # è‡ªåŠ¨é€‚é… CPU æ ¸å¿ƒæ•°
error_log /var/log/nginx/error.log notice;
pid /run/nginx.pid;

events {
    worker_connections 1024;
    use epoll; # ä½¿ç”¨é«˜æ€§èƒ½äº‹ä»¶é©±åŠ¨æ¨¡å‹
}

http {
    include /etc/nginx/mime.types;
    default_type application/octet-stream;
    client_max_body_size 300m; # æ”¯æŒå¤§æ–‡ä»¶ä¸Šä¼ 

    # å¼€å¯ Gzip å‹ç¼©ï¼Œä¼˜åŒ–ä¼ è¾“æ€§èƒ½
    gzip on;
    gzip_comp_level 5;
    gzip_types text/plain text/css application/json application/javascript;

    server {
        listen 80 default_server;
        server_name _; 

        # é™æ€èµ„æºå¤„ç†
        location / {
            root /usr/share/nginx/html;
            index index.html index.htm;
            try_files $uri $uri/ /index.html; # é€‚é…å•é¡µé¢åº”ç”¨è·¯ç”±
        }

        # ä»£ç†æ–¹æ¡ˆ Aï¼šå¸¦å‰ç¼€è½¬å‘
        # è¯·æ±‚ï¼š/aPath/api -&gt; http://33.133.190.116:8100/aPath/api
        location ^~/aPath/ {
            proxy_pass http://33.133.190.116:8100/aPath/;
            proxy_set_header X-Forwarded-For $remote_addr;
            proxy_read_timeout 3600s;
            proxy_buffering off; # AI å¯¹è¯åœºæ™¯éœ€å…³é—­ç¼“å†²
            chunked_transfer_encoding on;
        }

        # ä»£ç†æ–¹æ¡ˆ Bï¼šæŠ¹é™¤å‰ç¼€è½¬å‘
        # è¯·æ±‚ï¼š/bPath/api -&gt; http://172.16.7.160:9022/api
        location ^~/bPath/ {
            proxy_pass http://172.16.7.160:9022/; 
            proxy_set_header X-Forwarded-For $remote_addr;
        }

        # ç¦æ­¢è®¿é—® .ht æ–‡ä»¶
        location ~ /.ht {
            deny all;
        }
    }
}
</code></pre>
<hr/>
<h2 data-id="heading-6">å››ã€ è¡¥å……</h2>
<h3 data-id="heading-7">1. åç«¯ CORS é…ç½®ï¼ˆç®€å•è¯·æ±‚ä¸é¢„æ£€è¯·æ±‚ï¼‰</h3>
<p>åç«¯é€šè¿‡åœ¨å“åº”å¤´ä¸­æ·»åŠ ç‰¹å®šå­—æ®µï¼Œå‘Šè¯‰æµè§ˆå™¨å…è®¸è¯¥æºçš„è®¿é—®ï¼š</p>
<ul>
<li><code>Access-Control-Allow-Origin: *</code></li>
<li><code>Access-Control-Allow-Methods: GET, POST, PUT, DELETE</code></li>
</ul>
<h3 data-id="heading-8">2. ä¸ºä»€ä¹ˆ Nginx ä»£ç†èƒ½è§£å†³è·¨åŸŸï¼Ÿ</h3>
<p>å› ä¸º <strong>â€œè·¨åŸŸâ€ä»…å­˜åœ¨äºæµè§ˆå™¨ç«¯</strong>ã€‚ å½“ä½ çš„å‰ç«¯ä»£ç è¯·æ±‚ Nginx æ—¶ï¼Œå®ƒä»¬åŒæºï¼›Nginx ä½œä¸ºä¸­è½¬ç«™å†å»è¯·æ±‚åç«¯æ¥å£ï¼Œè¿™æ˜¯ <strong>æœåŠ¡å™¨å¯¹æœåŠ¡å™¨çš„é€šä¿¡</strong>ï¼Œä¸å—åŒæºç­–ç•¥é™åˆ¶ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å¤§é“ä¸è¯¥å¦‚æ­¤ä¹‹å°ï¼šä»å¾®å†…æ ¸çš„è§’åº¦ä»‹ç»å‰ç«¯ç›‘æ§]]></title>    <link>https://juejin.cn/post/7604775190212018186</link>    <guid>https://juejin.cn/post/7604775190212018186</guid>    <pubDate>2026-02-10T03:33:54.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604775190212018186" data-draft-id="7604786493639163931" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å¤§é“ä¸è¯¥å¦‚æ­¤ä¹‹å°ï¼šä»å¾®å†…æ ¸çš„è§’åº¦ä»‹ç»å‰ç«¯ç›‘æ§"/> <meta itemprop="keywords" content="å‰ç«¯,æ¶æ„,NPM"/> <meta itemprop="datePublished" content="2026-02-10T03:33:54.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ•²ä»£ç çš„å½­äºæ™"/> <meta itemprop="url" content="https://juejin.cn/user/553809592465277"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å¤§é“ä¸è¯¥å¦‚æ­¤ä¹‹å°ï¼šä»å¾®å†…æ ¸çš„è§’åº¦ä»‹ç»å‰ç«¯ç›‘æ§
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/553809592465277/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ•²ä»£ç çš„å½­äºæ™
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T03:33:54.000Z" title="Tue Feb 10 2026 03:33:54 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    15
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å‰è¨€</h2>
<p>å‰ç«¯ç›‘æ§ä¸€ç›´æ˜¯ä¿éšœ Web åº”ç”¨ç¨³å®šæ€§å’Œç”¨æˆ·ä½“éªŒçš„é‡è¦åŸºç¡€è®¾æ–½ã€‚éšç€åº”ç”¨å¤æ‚åº¦çš„æå‡ï¼Œç›‘æ§ç³»ç»Ÿçš„éœ€æ±‚ä¹Ÿåœ¨ä¸æ–­è†¨èƒ€ï¼šæˆ‘ä»¬è¦æ•è· JavaScript é”™è¯¯ã€ç›‘æ§ HTTP è¯·æ±‚ã€è¿½è¸ªç”¨æˆ·è¡Œä¸ºã€ç”šè‡³è®°å½•æ€§èƒ½æŒ‡æ ‡ã€‚å¦‚æœæŠŠæ‰€æœ‰çš„ç›‘æ§é€»è¾‘éƒ½å†™åœ¨ä¸€ä¸ªåºå¤§çš„ SDK é‡Œï¼Œä¸ä»…ä»£ç éš¾ä»¥ç»´æŠ¤ï¼Œè¿˜ä¼šå› ä¸ºä½“ç§¯è¿‡å¤§å½±å“é¡µé¢æ€§èƒ½ã€‚</p>
<p>æœ¬æ–‡å°†ç»“åˆæˆ‘è‡ªå·±å†™çš„ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fcwjbjy%2Fcwj_monitoring" target="_blank" title="https://github.com/cwjbjy/cwj_monitoring" ref="nofollow noopener noreferrer">cwj_monitoring</a> è¿™ä¸ªå¼€æºé¡¹ç›®çš„æºç ï¼Œä»‹ç»å¦‚ä½•åˆ©ç”¨ <strong>å¾®å†…æ ¸æ¶æ„ï¼ˆMicro-kernel Architectureï¼‰</strong> æ¥è®¾è®¡ä¸€ä¸ªå¯æ‰©å±•ã€è½»é‡çº§çš„å‰ç«¯ç›‘æ§ SDKã€‚å‰ç«¯ç›‘æ§åŒ…çš„ä½¿ç”¨æ–¹å¼ï¼Œå‚è€ƒï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Fcwj_monitoring" target="_blank" title="https://www.npmjs.com/package/cwj_monitoring" ref="nofollow noopener noreferrer">www.npmjs.com/package/cwjâ€¦</a></p>
<h3 data-id="heading-1">ä¸€ã€å‰ç½®çŸ¥è¯†ï¼šå¾®å†…æ ¸æ¶æ„</h3>
<p>åœ¨æ·±å…¥ä»£ç ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥èŠèŠå¾®å†…æ ¸æ¶æ„ï¼ˆMicrokernel Architectureï¼‰ï¼Œåˆç§°ä¸ºâ€œæ’ä»¶æ¶æ„â€ã€‚</p>
<h4 data-id="heading-2">1. æ ¸å¿ƒæ¦‚å¿µ</h4>
<p>å¾®å†…æ ¸æ¶æ„ä¸»è¦ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼š<strong>Coreï¼ˆå†…æ ¸ï¼‰</strong> + <strong>Pluginï¼ˆæ’ä»¶ï¼‰</strong>ã€‚</p>
<ul>
<li><strong>Core (å†…æ ¸)</strong>ï¼šä¸»è¦è´Ÿè´£åŸºç¡€è®¾æ–½å»ºè®¾ï¼ˆå¦‚ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€åŸºç¡€é…ç½®ï¼‰ä»¥åŠæ’ä»¶çš„è°ƒåº¦ã€‚å®ƒåº”è¯¥ä¿æŒæœ€ç²¾ç®€ï¼Œåªç»´æŒç³»ç»Ÿè¿è¡Œçš„æœ€å°åŠŸèƒ½é›†ã€‚</li>
<li><strong>Plugin (æ’ä»¶)</strong>ï¼šç‹¬ç«‹çš„åŠŸèƒ½æ¨¡å—ï¼Œç”¨æ¥ä¸°å¯Œå’ŒåŠ å¼ºå†…æ ¸çš„èƒ½åŠ›ã€‚</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ee7636e1f7a4488aac69365e7b286873~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pWy5Luj56CB55qE5b2t5LqO5pmP:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771300894&amp;x-signature=qqhYqT7cY66CeNDM2hcrocT4s6Q%3D" alt="1770696057167.png" loading="lazy"/></p>
<p>è¿™ç§æ¶æ„åœ¨å‰ç«¯é¢†åŸŸéå¸¸å¸¸è§ï¼Œå…¸å‹çš„ä¾‹å­å¦‚ Webpackã€Babelã€PostCSS å’Œ ESLintã€‚å®ƒä»¬éƒ½éœ€è¦åº”å¯¹å¤æ‚çš„å®šåˆ¶éœ€æ±‚ï¼Œåªæœ‰å¾®å†…æ ¸æ¶æ„æ‰èƒ½ä¿è¯ç³»ç»Ÿçš„çµæ´»æ€§å’Œå¯æ‰©å±•æ€§ã€‚</p>
<h4 data-id="heading-3">2. è®¾è®¡æ€æƒ³</h4>
<p>å¾®å†…æ ¸æ¶æ„èƒŒåè•´å«ç€å‡ ä¸ªé‡è¦çš„è½¯ä»¶è®¾è®¡åŸåˆ™ï¼š</p>
<ul>
<li><strong>å•ä¸€èŒè´£åŸåˆ™ (Single Responsibility)</strong>ï¼šæ¯ä¸ªæ’ä»¶ç›¸äº’ç‹¬ç«‹ï¼Œåªè´Ÿè´£å…¶å¯¹åº”çš„ç‰¹å®šç›‘æ§åŠŸèƒ½ï¼ˆå¦‚åªè´Ÿè´£æ•è· Promise é”™è¯¯ï¼‰ï¼Œä¾¿äºå¼€å‘å’Œæµ‹è¯•ã€‚</li>
<li><strong>å¼€æ”¾å°é—­åŸåˆ™ (Open/Closed)</strong>ï¼šæ‰©å±•æ–°åŠŸèƒ½ï¼ˆå¦‚æ–°å¢ WebSocket ç›‘æ§ï¼‰æ—¶ï¼Œä¸éœ€è¦ä¿®æ”¹å†…æ ¸è€ä»£ç ï¼Œåªéœ€å¼€å‘æ–°æ’ä»¶å³å¯ã€‚</li>
<li><strong>æ§åˆ¶åè½¬ (Inversion of Control)</strong>ï¼šå†…æ ¸é€šè¿‡ä¾èµ–æ³¨å…¥ï¼ˆDependency Injectionï¼‰çš„æ–¹å¼å°†ä¸Šä¸‹æ–‡ï¼ˆContextï¼‰ä¼ é€’ç»™æ’ä»¶ï¼Œè€Œä¸æ˜¯è®©æ’ä»¶å»å®ä¾‹åŒ–å†…æ ¸ã€‚</li>
<li><strong>ç­–ç•¥æ¨¡å¼ (Strategy Pattern)</strong>ï¼šä¸åŒçš„æ’ä»¶é€šè¿‡ç»Ÿä¸€çš„æ¥å£æ¥å…¥ç³»ç»Ÿï¼Œå†…æ ¸åªéœ€è¦åƒéå†åˆ—è¡¨ä¸€æ ·å»æ‰§è¡Œå®ƒä»¬ï¼Œè€Œä¸éœ€è¦å…³å¿ƒå…·ä½“å®ç°ã€‚</li>
</ul>
<h3 data-id="heading-4">äºŒã€æ¶æ„å®ç°ï¼šCore ä¸ Plugin</h3>
<h4 data-id="heading-5">1. æ ¸å¿ƒç³»ç»Ÿ (The Core)</h4>
<p>Core çš„ä¸¤ä¸ªä¸»è¦ç”¨é€”æ˜¯ï¼šå®ç°åŸºç¡€åŠŸèƒ½å’Œç®¡ç†æ’ä»¶ã€‚</p>
<p>åœ¨ <code>src/core/index.ts</code> ä¸­ï¼Œ<code>Core</code> ç±»æ‰®æ¼”äº†å†…æ ¸çš„è§’è‰²ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// src/core/index.ts</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Core</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">EventTrack</span> {
  <span class="hljs-keyword">private</span> <span class="hljs-attr">pluginMap</span>: <span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-title class_">IPlugin</span>&gt; = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();

  <span class="hljs-comment">// 1. æ’ä»¶æ³¨å†Œ (Registry)</span>
  <span class="hljs-title function_">use</span>(<span class="hljs-attr">plugin</span>: <span class="hljs-title class_">IPlugin</span>): <span class="hljs-title class_">Core</span> {
    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">pluginMap</span>.<span class="hljs-title function_">has</span>(plugin.<span class="hljs-property">name</span>)) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">pluginMap</span>.<span class="hljs-title function_">set</span>(plugin.<span class="hljs-property">name</span>, plugin);
    }
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>; <span class="hljs-comment">// æ”¯æŒé“¾å¼è°ƒç”¨ï¼Œå¦‚ core.use(plugin1).use(plugin2)</span>
  }

  <span class="hljs-comment">// 2. æ’ä»¶è°ƒåº¦ (Scheduling)</span>
  <span class="hljs-title function_">run</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// åˆ›å»ºä¸Šä¸‹æ–‡ï¼Œæ³¨å…¥æ ¸å¿ƒèƒ½åŠ›</span>
    <span class="hljs-keyword">const</span> context = {
      <span class="hljs-attr">emit</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">emit</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>),
      <span class="hljs-attr">url</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">options</span>.<span class="hljs-property">url</span>,
    };

    <span class="hljs-comment">// ä¾æ¬¡åˆå§‹åŒ–æ’ä»¶ (é¡ºåºæ‰§è¡Œ)</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">pluginMap</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">plugin</span>) =&gt;</span> {
      plugin.<span class="hljs-title function_">install</span>(context);
    });

    <span class="hljs-comment">// æŒ‚è½½å…¨å±€å˜é‡</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">mount</span>();
  }

  <span class="hljs-comment">// 3. åœæ­¢ç³»ç»Ÿ</span>
  <span class="hljs-title function_">stop</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">pluginMap</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">plugin</span>) =&gt;</span> {
      plugin.<span class="hljs-property">uninstall</span>?.();
    });
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">pluginMap</span>.<span class="hljs-title function_">clear</span>();
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">unmount</span>();
  }
}
</code></pre>
<p>è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨äº† <code>Map</code> æ¥å­˜å‚¨æ’ä»¶ï¼Œæ–¹ä¾¿å»é‡ï¼ˆå…·åæ’ä»¶ï¼‰ã€‚<code>run</code> æ–¹æ³•å±•ç¤ºäº†ç®€å•çš„<strong>ç®¡é“å¼</strong>è°ƒåº¦ï¼šä¾æ¬¡éå†å¹¶æ‰§è¡Œæ’ä»¶çš„ <code>install</code> æ–¹æ³•ã€‚</p>
<h4 data-id="heading-6">2. é€šä¿¡æœºåˆ¶ï¼šæ§åˆ¶åè½¬</h4>
<p>æ’ä»¶å’Œå†…æ ¸å¦‚ä½•é€šä¿¡ï¼Ÿæˆ‘ä»¬é‡‡ç”¨äº†<strong>ä¾èµ–æ³¨å…¥</strong>çš„æ–¹å¼ã€‚</p>
<p>åœ¨ <code>src/plugin/definePlugin.ts</code> ä¸­å®šä¹‰äº†æ ‡å‡†æ¥å£ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// src/plugin/definePlugin.ts</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">PluginContext</span> {
  <span class="hljs-comment">/** å‘é€äº‹ä»¶çš„èƒ½åŠ› */</span>
  <span class="hljs-attr">emit</span>: <span class="hljs-function">(<span class="hljs-params"><span class="hljs-keyword">type</span>: <span class="hljs-built_in">string</span>, data: <span class="hljs-built_in">any</span></span>) =&gt;</span> <span class="hljs-built_in">void</span>;
  <span class="hljs-comment">/** ç›‘æ§ä¸ŠæŠ¥åœ°å€ */</span>
  <span class="hljs-attr">url</span>: <span class="hljs-built_in">string</span>;
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">IPlugin</span> {
  <span class="hljs-keyword">readonly</span> <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-comment">/**
   * æ§åˆ¶åè½¬ï¼šCore åœ¨è°ƒç”¨ install æ—¶ï¼Œå°† context (è‡ªèº«èƒ½åŠ›çš„æŠ•å½±) ä¼ ç»™æ’ä»¶
   */</span>
  <span class="hljs-title function_">install</span>(<span class="hljs-attr">context</span>: <span class="hljs-title class_">PluginContext</span>): <span class="hljs-built_in">void</span>;
  uninstall?(): <span class="hljs-built_in">void</span>;
}
</code></pre>
<p>é€šè¿‡è¿™ç§è®¾è®¡ï¼Œæ’ä»¶ä¸éœ€è¦å…³å¿ƒæ•°æ®é€šè¿‡ä»€ä¹ˆæ–¹å¼ï¼ˆXHR/Beaconï¼‰å‘é€ï¼Œä¹Ÿä¸éœ€è¦å…³å¿ƒ <code>Core</code> çš„å…·ä½“å®ç°ç»†èŠ‚ã€‚å®ƒåªéœ€è¦æ‹¿åˆ° <code>context.emit</code>ï¼Œåƒè°ƒç”¨ API ä¸€æ ·ä¸ŠæŠ¥æ•°æ®å³å¯ã€‚</p>
<h4 data-id="heading-7">3. å®æˆ˜æ¡ˆä¾‹ï¼šErrorPlugin</h4>
<p>è®©æˆ‘ä»¬çœ‹çœ‹ <code>ErrorPlugin</code> å¦‚ä½•åˆ©ç”¨è¿™ä¸ªæ¶æ„å·¥ä½œã€‚å®ƒçš„èŒè´£æ˜¯æ•è·é”™è¯¯ï¼Œå¹¶é€šè¿‡æ³¨å…¥çš„ä¸Šä¸‹æ–‡ä¸ŠæŠ¥ã€‚</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// src/plugin/error.ts</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title class_">ErrorPlugin</span> = (<span class="hljs-attr">options</span>: <span class="hljs-title class_">ErrorOptions</span> = {}): <span class="hljs-function"><span class="hljs-params">IPlugin</span> =&gt;</span> {
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">name</span>: <span class="hljs-string">"error"</span>,
    <span class="hljs-attr">install</span>: <span class="hljs-function">(<span class="hljs-params">context: PluginContext</span>) =&gt;</span> {
      <span class="hljs-comment">// 1. å®ç°ä¸šåŠ¡é€»è¾‘ï¼šç›‘å¬å…¨å±€ JS é”™è¯¯</span>
      <span class="hljs-keyword">const</span> <span class="hljs-title function_">errorHandler</span> = (<span class="hljs-params">e: ErrorEvent</span>) =&gt; {
        <span class="hljs-comment">// å®šä¹‰å¤„ç†å‡½æ•°</span>
        <span class="hljs-keyword">const</span> errorData = {
          <span class="hljs-attr">type</span>: <span class="hljs-string">"js"</span>,
          <span class="hljs-attr">message</span>: e.<span class="hljs-property">message</span>,
          <span class="hljs-comment">// ... å…¶ä»–é”™è¯¯ä¿¡æ¯æå–</span>
        };
        <span class="hljs-comment">// 2. ä½¿ç”¨æ³¨å…¥çš„èƒ½åŠ›ï¼šé€šè¿‡ emit ä¸ŠæŠ¥ï¼Œä¸å…³å¿ƒåº•å±‚ä¼ è¾“</span>
        context.<span class="hljs-title function_">emit</span>(<span class="hljs-string">"error"</span>, errorData);
      };
      <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">"error"</span>, errorHandler, <span class="hljs-literal">true</span>);

      <span class="hljs-comment">// ç›‘å¬ Promise æœªæ•è·å¼‚å¸¸</span>
      <span class="hljs-keyword">const</span> <span class="hljs-title function_">rejectionHandler</span> = (<span class="hljs-params">e: PromiseRejectionEvent</span>) =&gt; {
        <span class="hljs-comment">// å®šä¹‰å¤„ç†å‡½æ•°</span>
        <span class="hljs-comment">// ... å¤„ç†é€»è¾‘</span>
        context.<span class="hljs-title function_">emit</span>(<span class="hljs-string">"error"</span>, { <span class="hljs-attr">type</span>: <span class="hljs-string">"promise"</span>, <span class="hljs-attr">reason</span>: e.<span class="hljs-property">reason</span> });
      };
      <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">"unhandledrejection"</span>, rejectionHandler, <span class="hljs-literal">true</span>);
    },
    <span class="hljs-attr">uninstall</span>: <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-comment">// æ¸…ç†ç›‘å¬å™¨ï¼Œé˜²æ­¢å†…å­˜æ³„æ¼</span>
      <span class="hljs-comment">// ...</span>
    },
  };
};
</code></pre>
<h3 data-id="heading-8">ä¸‰ã€é‡ç‚¹è®¾è®¡è€ƒé‡</h3>
<p>åœ¨è®¾è®¡è¿™æ ·ä¸€ä¸ªç³»ç»Ÿæ—¶ï¼Œé™¤äº†åŸºæœ¬åŠŸèƒ½ï¼Œè¿˜æœ‰å‡ ä¸ªå…³é”®ç‚¹éœ€è¦è€ƒè™‘ï¼š</p>
<ol>
<li>
<p><strong>å®‰å…¨æ€§ä¸éš”ç¦»</strong>ï¼š
ç”±äº JS è¯­è¨€ç‰¹æ€§ï¼Œå¾ˆéš¾åšåˆ°å®Œå…¨çš„æ²™ç®±éš”ç¦»ã€‚ä½†åœ¨è®¾è®¡ä¸Šï¼Œæˆ‘ä»¬é€šè¿‡ <code>PluginContext</code> é™åˆ¶äº†æ’ä»¶èƒ½è®¿é—®çš„ API èŒƒå›´ï¼ˆåªæš´éœ² <code>emit</code> å’Œ <code>url</code>ï¼‰ï¼Œè€Œä¸æ˜¯æŠŠæ•´ä¸ª <code>Core</code> å®ä¾‹æš´éœ²ç»™æ’ä»¶ï¼Œè¿™ä½“ç°äº†æœ€å°æƒé™åŸåˆ™ã€‚</p>
</li>
<li>
<p><strong>ç¨³å®šæ€§</strong>ï¼š
è™½ç„¶ç¤ºä¾‹ä»£ç ä¸­ç›´æ¥è¿›è¡Œäº† <code>forEach</code> è°ƒç”¨ï¼Œä½†åœ¨ç”Ÿäº§ç¯å¢ƒçš„å†…æ ¸è®¾è®¡ä¸­ï¼Œé€šå¸¸éœ€è¦åœ¨æ‰§è¡Œæ’ä»¶ä»£ç æ—¶åŒ…è£¹ <code>try-catch</code>ã€‚è¿™æ ·ä¸€æ—¦æŸä¸ªæ’ä»¶å†…éƒ¨æŠ¥é”™ï¼ˆæ¯”å¦‚ <code>addEventListener</code> å¤±è´¥ï¼‰ï¼Œä¸ä¼šå¯¼è‡´æ•´ä¸ªç›‘æ§ SDK å´©æºƒï¼Œå½±å“åˆ°ä¸šåŠ¡ä¸»æµç¨‹ã€‚</p>
</li>
<li>
<p><strong>æ’ä»¶ç®¡ç†ç­–ç•¥</strong>ï¼š
<code>cwj_monitoring</code> ä½¿ç”¨ <code>Map</code> æ¥ç®¡ç†æ’ä»¶ï¼Œè¿™æ„å‘³ç€åŒä¸€ä¸ªåç§°çš„æ’ä»¶åªä¼šè¢«å®‰è£…ä¸€æ¬¡ï¼Œé˜²æ­¢é‡å¤æ³¨å†Œã€‚è¿™æ˜¯ä¸€ç§ç®€å•çš„å†²çªè§£å†³ç­–ç•¥ã€‚</p>
</li>
</ol>
<h3 data-id="heading-9">ç»„è£…ä¸ä½¿ç”¨</h3>
<p>æœ€ç»ˆï¼Œç”¨æˆ·åœ¨ä½¿ç”¨ SDK æ—¶ï¼Œå°±åƒæ­ç§¯æœ¨ä¸€æ ·ç®€å•ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { createMonitor, <span class="hljs-title class_">ErrorPlugin</span>, <span class="hljs-title class_">PerformancePlugin</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"cwj_monitoring"</span>;

<span class="hljs-keyword">const</span> monitor = <span class="hljs-title function_">createMonitor</span>({
  <span class="hljs-attr">url</span>: <span class="hljs-string">"https://monitor.example.com/report"</span>,
})
  .<span class="hljs-title function_">use</span>(<span class="hljs-title class_">ErrorPlugin</span>()) <span class="hljs-comment">// æ’ä¸Šé”™è¯¯ç›‘æ§æ¨¡å—</span>
  .<span class="hljs-title function_">use</span>(<span class="hljs-title class_">PerformancePlugin</span>()) <span class="hljs-comment">// æ’ä¸Šæ€§èƒ½ç›‘æ§æ¨¡å—</span>
  .<span class="hljs-title function_">run</span>(); <span class="hljs-comment">// å¯åŠ¨ï¼</span>
</code></pre>
<p>è¿™ç§ä½¿ç”¨æ–¹å¼éå¸¸ç¬¦åˆç°ä»£å‰ç«¯å¼€å‘çš„ç›´è§‰ï¼ŒåŒæ—¶ä¹Ÿç»™äºˆäº†å¼€å‘è€…æå¤§çš„çµæ´»æ€§ã€‚</p>
<h3 data-id="heading-10">å››ã€æ€»ç»“</h3>
<p>é€šè¿‡ <code>cwj_monitoring</code>ï¼Œæˆ‘ä»¬å®è·µäº†ä¸€ä¸ªæ ‡å‡†çš„å‰ç«¯å¾®å†…æ ¸æ¶æ„ï¼š</p>
<ul>
<li><strong>Core</strong>ï¼šç²¾ç®€çš„è°ƒåº¦å™¨ï¼Œè´Ÿè´£ç”Ÿå‘½å‘¨æœŸå’ŒåŸºç¡€è®¾æ–½ã€‚</li>
<li><strong>Plugin</strong>ï¼šç‹¬ç«‹çš„ä¸šåŠ¡å•å…ƒï¼Œé€šè¿‡ <code>install(context)</code> æ¥å…¥ç³»ç»Ÿã€‚</li>
</ul>
<p>è¿™ç§æ¶æ„è®©å‰ç«¯ç›‘æ§ SDK å…·å¤‡äº†æå¼ºçš„ç”Ÿå‘½åŠ›ã€‚é’ˆå¯¹ä¸åŒä¸šåŠ¡åœºæ™¯ï¼ˆå¦‚ä¸éœ€è¦å½•å±æ—¶å°±ä¸å¼•å…¥å½•å±æ’ä»¶ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥çµæ´»ç»„åˆä¸åŒçš„ Pluginï¼Œå®ç°æŒ‰éœ€æ„å»ºå’ŒåŠ è½½ã€‚</p>
<p>æœ€åï¼šå¦‚æœæ–‡ç« æœ‰ä¸å¯¹æˆ–è€…æœ‰è¡¥å……çš„åœ°æ–¹ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºç•™è¨€ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å‘Šåˆ«å•è°ƒé…éŸ³ï¼VibeVoice+cpolarï¼šå¤šè§’è‰²è¯­éŸ³ç”Ÿæˆéšæ—¶éšåœ°æåˆ›ä½œ]]></title>    <link>https://juejin.cn/post/7604761524976762889</link>    <guid>https://juejin.cn/post/7604761524976762889</guid>    <pubDate>2026-02-10T03:35:04.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604761524976762889" data-draft-id="7604784281956646950" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å‘Šåˆ«å•è°ƒé…éŸ³ï¼VibeVoice+cpolarï¼šå¤šè§’è‰²è¯­éŸ³ç”Ÿæˆéšæ—¶éšåœ°æåˆ›ä½œ"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2026-02-10T03:35:04.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ˜é‡‘è€…é˜¿è±ª"/> <meta itemprop="url" content="https://juejin.cn/user/4073055974333608"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å‘Šåˆ«å•è°ƒé…éŸ³ï¼VibeVoice+cpolarï¼šå¤šè§’è‰²è¯­éŸ³ç”Ÿæˆéšæ—¶éšåœ°æåˆ›ä½œ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4073055974333608/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ˜é‡‘è€…é˜¿è±ª
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T03:35:04.000Z" title="Tue Feb 10 2026 03:35:04 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»17åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d71a2470f40040c4a40424c13bd099eb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6ICF6Zi_6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771299521&amp;x-signature=i4UOg7x47ESSoooNRHsMno7dj9E%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<p>VibeVoice ä½œä¸ºå¾®è½¯å¼€å‘çš„æ–‡æœ¬è½¬è¯­éŸ³å·¥å…·ï¼Œæ ¸å¿ƒä¼˜åŠ¿åœ¨äºæ”¯æŒ 4 ä¸ªä¸åŒè§’è‰²çš„è¯­éŸ³ç”Ÿæˆï¼Œæ¯ä¸ªè§’è‰²æœ‰ä¸“å±å£°çº¿ï¼Œè¿˜èƒ½æ ¹æ®æ–‡æœ¬å†…å®¹åŒ¹é…å–œæ€’å“€ä¹çš„æƒ…ç»ªï¼Œ1.5B æ¨¡å‹å¯ç”Ÿæˆ 90 åˆ†é’Ÿè¿ç»­è¯­éŸ³ï¼Œé€‚é…å‰§æœ¬æ€é…éŸ³ã€è‡ªåª’ä½“éŸ³é¢‘åˆ›ä½œã€ä¼ä¸šåŸ¹è®­è¯¾ä»¶åˆ¶ä½œç­‰åœºæ™¯ï¼Œå°¤å…¶é€‚åˆå‰§æœ¬æ€å·¥ä½œå®¤ã€è‡ªåª’ä½“åˆ›ä½œè€…ã€ä¼ä¸šåŸ¹è®­äººå‘˜è¿™ç±»éœ€è¦å¤šè§’è‰²ã€é•¿æ—¶é•¿è¯­éŸ³çš„äººç¾¤ï¼Œæ­é… ComfyUI å¯è§†åŒ–æ“ä½œåï¼Œæ— éœ€ç¼–ç¨‹åŸºç¡€ä¹Ÿèƒ½è°ƒæ•´å‚æ•°ï¼Œé™ä½äº†ä¸“ä¸šé…éŸ³çš„é—¨æ§›ã€‚</p>
<p>ä½¿ç”¨ VibeVoice æ—¶å‘ç°ï¼Œæƒ³è¦ç”Ÿæˆè´´åˆè§’è‰²çš„è¯­éŸ³ï¼Œå‚è€ƒéŸ³é¢‘çš„é€‰æ‹©å¾ˆå…³é”®ï¼Œ30 ç§’çš„æ¸…æ™°å‚è€ƒéŸ³é¢‘èƒ½è®©å…‹éš†çš„å£°éŸ³æ›´è´´è¿‘åŸå‹ï¼Œå¦å¤–ç¡¬ä»¶æ–¹é¢å»ºè®®æ­é… 8G ä»¥ä¸Šæ˜¾å­˜çš„ NVIDIA æ˜¾å¡ï¼Œå¦åˆ™ 7B æ¨¡å‹å®¹æ˜“å‡ºç°æ˜¾å­˜ä¸è¶³çš„æƒ…å†µï¼Œæ—¥å¸¸ä½¿ç”¨ä¸­å…ˆæµ‹è¯•çŸ­æ–‡æœ¬ç”Ÿæˆæ•ˆæœï¼Œå†æ‰©å±•åˆ°é•¿ç¯‡å†…å®¹ä¼šæ›´ç¨³å¦¥ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e55cbe6b9aff4581bc73bbff4e23d8f8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6ICF6Zi_6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771299521&amp;x-signature=HjVxfi4ovQQJVsN2FPWwWPvW5rI%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<p>ä¸è¿‡ VibeVoice+ComfyUI çš„ç»„åˆé»˜è®¤åªèƒ½åœ¨å±€åŸŸç½‘å†…ä½¿ç”¨ï¼Œæ¯”å¦‚å‰§æœ¬æ€å·¥ä½œå®¤çš„åˆ›ä½œè€…åœ¨å®¶è°ƒå¥½çš„é…éŸ³å‚æ•°ï¼Œå‡ºé—¨åæƒ³åœ¨æ‰‹æœºä¸Šä¿®æ”¹å°è¯å°±åšä¸åˆ°ï¼›å›¢é˜Ÿåä½œæ—¶ï¼Œç¼–å‰§æ”¹äº†å‰§æœ¬ï¼Œé…éŸ³å¸ˆåªèƒ½ç­‰æ–‡ä»¶ä¼ è¾“å®Œæˆæ‰èƒ½è¯•å¬æ•ˆæœï¼Œè·¨è®¾å¤‡æ“ä½œä¹Ÿå—é™äºå±€åŸŸç½‘ï¼Œæ¯”å¦‚ç”µè„‘ä¸Šç”Ÿæˆä¸€åŠçš„éŸ³é¢‘ï¼Œå¹³æ¿æ— æ³•æ¥ç»­ç¼–è¾‘ï¼Œå¤§å¤§å½±å“äº†åˆ›ä½œæ•ˆç‡ã€‚</p>
<p>è€Œå°† VibeVoice+ComfyUI ä¸ cpolar å†…ç½‘ç©¿é€ç»“åˆåï¼Œè¿™äº›é—®é¢˜éƒ½èƒ½è§£å†³ï¼šé€šè¿‡ cpolar ç”Ÿæˆçš„å…¬ç½‘åœ°å€ï¼Œæ— è®ºåœ¨å®¶ã€åœ°é“è¿˜æ˜¯å¤–å‡ºåŠå…¬ï¼Œéƒ½èƒ½éšæ—¶è®¿é—®è¯­éŸ³ç”Ÿæˆé¡¹ç›®ï¼›å›¢é˜Ÿæˆå‘˜æ— éœ€æ¥å›ä¼ æ–‡ä»¶ï¼Œå…±äº«é“¾æ¥å°±èƒ½å®æ—¶è¯•å¬ã€è°ƒæ•´é…éŸ³æ•ˆæœï¼›è·¨è®¾å¤‡åˆ‡æ¢ä¹Ÿæ¯«æ— é˜»ç¢ï¼Œç”µè„‘ã€å¹³æ¿ã€æ‰‹æœºéƒ½èƒ½æ“ä½œï¼Œè¿˜èƒ½ç»™é“¾æ¥è®¾ç½®å¯†ç ï¼Œä¿éšœé…éŸ³æ–¹æ¡ˆçš„å®‰å…¨æ€§ï¼Œè®©åˆ›ä½œä¸å—ç©ºé—´å’Œè®¾å¤‡çš„é™åˆ¶ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c001fc8321d44be19cfb96338c04f523~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6ICF6Zi_6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771299521&amp;x-signature=xTDSbb8%2BcGm8tVLOhNZgUFiMLfI%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<h4 data-id="heading-0">è‡ªå·±å°±æ˜¯ä¸€ä¸ªå›¢é˜Ÿï¼Œæ— è®ºæ˜¯è‡ªå·±åšè´¦å·è¿˜æ˜¯æ¥å•å­èµšé’±ã€‚è¿™ä¸ªå·¥å…·ç»„åˆå¯æ˜¯å¦¥å¦¥çš„ç”Ÿäº§åŠ›ï¼æ•™ç¨‹åœ¨ä¸‹é¢ï¼Œå¿«å»å®‰è£…æŒ£é’±å§ï¼</h4>
<p>æœ¬æ–‡å°†è¯¦ç»†ä»‹ç»å¦‚ä½•å€ŸåŠ© cpolar å†…ç½‘ç©¿é€ï¼Œç»“åˆ VibeVoice æ­å»ºå¯éšæ—¶éšåœ°è®¿é—®çš„å¤šè§’è‰²éŸ³é¢‘ç”Ÿæˆå¹³å°ï¼Œå¹¶ä»¥ 4 è§’è‰²å¯¹è¯å®æˆ˜æ¼”ç¤ºï¼Œçªç ´ä¼ ç»Ÿ TTS åœ¨å¤šè¯´è¯äººåœºæ™¯ä¸‹çš„é™åˆ¶ã€‚</p>
<h2 data-id="heading-1">1 é¡¹ç›®æ¦‚è¿°</h2>
<h3 data-id="heading-2">1.1 ä»€ä¹ˆæ˜¯VibeVoice</h3>
<p>VibeVoice æ˜¯å¾®è½¯å¼€å‘çš„ä¸€æ¬¾å…ˆè¿›æ–‡æœ¬è½¬è¯­éŸ³ï¼ˆTTSï¼‰æ¨¡å‹ï¼Œä¸“æ³¨äºé•¿å¯¹è¯åœºæ™¯çš„é«˜è´¨é‡è¯­éŸ³ç”Ÿæˆã€‚å®ƒçš„æ ¸å¿ƒç‰¹ç‚¹åŒ…æ‹¬ï¼šæ”¯æŒå¤šè¾¾ 4 ä¸ªä¸åŒè§’è‰²ï¼Œæ¯ä¸ªè§’è‰²æ‹¥æœ‰ç‹¬ç‰¹å£°éŸ³ï¼›èƒ½å¤Ÿç”Ÿæˆé•¿æ—¶é—´è¿ç»­å¯¹è¯ï¼ˆ1.5B æ¨¡å‹å¯ç”Ÿæˆçº¦ 90 åˆ†é’Ÿï¼ŒLarge æ¨¡å‹çº¦ 45 åˆ†é’Ÿï¼‰ï¼›å…·å¤‡ä¸°å¯Œçš„æƒ…æ„Ÿè¡¨è¾¾èƒ½åŠ›ï¼Œå¯æ ¹æ®æ–‡æœ¬è‡ªåŠ¨è°ƒæ•´è¯­è°ƒä¸æƒ…æ„Ÿè‰²å½©ï¼›æ”¯æŒä¸­è‹±æ–‡è¯­éŸ³ç”Ÿæˆï¼Œå¹¶å…·å¤‡è·¨è¯­è¨€è¿ç§»èƒ½åŠ›ï¼›åŒæ—¶æ”¯æŒå®æ—¶æµå¼éŸ³é¢‘è¾“å‡ºï¼Œæå‡äº’åŠ¨ä½“éªŒã€‚VibeVoice é€‚ç”¨äºå¤šè§’è‰²å‰§æœ¬ã€é•¿ç¯‡æ•…äº‹æœ—è¯»ä»¥åŠè™šæ‹ŸåŠ©æ‰‹ç­‰åœºæ™¯ã€‚</p>
<hr/>
<h3 data-id="heading-3">1.2 ä»€ä¹ˆæ˜¯ComfyUI</h3>
<p>ComfyUI æ˜¯ä¸€ä¸ªåŸºäºèŠ‚ç‚¹çš„å¯è§†åŒ–ç•Œé¢å·¥å…·ï¼Œä¸»è¦ç”¨äºæ„å»ºå’Œç®¡ç†æ·±åº¦å­¦ä¹ æ¨¡å‹çš„æ¨ç†æµç¨‹ã€‚å®ƒé€šè¿‡æ‹–æ‹½å¼èŠ‚ç‚¹è¿æ¥ï¼Œå°†æ¨¡å‹åŠ è½½ã€æ•°æ®å¤„ç†ã€å›¾åƒç”Ÿæˆç­‰ç¯èŠ‚ç›´è§‚åœ°å‘ˆç°å‡ºæ¥ï¼Œä½¿ç”¨æˆ·æ— éœ€ç¼–å†™å¤§é‡ä»£ç å³å¯æ­å»ºå¤æ‚çš„ AI æµç¨‹ã€‚ComfyUI æ”¯æŒå¤šç§æ‰©å±•èŠ‚ç‚¹å’Œè‡ªå®šä¹‰åŠŸèƒ½ï¼Œå¯ä»¥çµæ´»é›†æˆç¬¬ä¸‰æ–¹æ¨¡å‹å’Œæ’ä»¶ï¼ŒåŒæ—¶æä¾›å®æ—¶é¢„è§ˆå’Œè°ƒè¯•åŠŸèƒ½ï¼Œæå¤§é™ä½äº†æ·±åº¦å­¦ä¹ æ¨¡å‹æ“ä½œçš„é—¨æ§›ï¼Œé€‚åˆç ”ç©¶è€…ã€åˆ›ä½œè€…ä»¥åŠå¼€å‘è€…è¿›è¡Œå¿«é€ŸåŸå‹è®¾è®¡å’Œå®éªŒã€‚</p>
<h2 data-id="heading-4">2 ç¯å¢ƒå®‰è£…</h2>
<blockquote>
<p><strong>é‡è¦æç¤º</strong>ï¼šç¡®ä¿æ‚¨çš„ç³»ç»Ÿæ»¡è¶³ä»¥ä¸‹è¦æ±‚ï¼Œå¦åˆ™å¯èƒ½å¯¼è‡´å®‰è£…å¤±è´¥æˆ–è¿è¡Œå¼‚å¸¸ã€‚</p>
</blockquote>













































<table><thead><tr><th>ç¯å¢ƒé¡¹</th><th>è¦æ±‚è¯´æ˜</th></tr></thead><tbody><tr><td>æ“ä½œç³»ç»Ÿ</td><td>Windows 10/11ï¼ˆæ¨èï¼‰</td></tr><tr><td>Pythonç‰ˆæœ¬</td><td>3.11</td></tr><tr><td>å†…å­˜</td><td>è‡³å°‘ 8GB RAMï¼Œæ¨è 16GB ä»¥ä¸Š</td></tr><tr><td>å­˜å‚¨ç©ºé—´</td><td>è‡³å°‘ 20GB å¯ç”¨ç©ºé—´ï¼ˆæ¨¡å‹æ–‡ä»¶è¾ƒå¤§ï¼‰</td></tr><tr><td>ç½‘ç»œç¯å¢ƒ</td><td>ç¨³å®šçš„ç½‘ç»œè¿æ¥ï¼Œç”¨äºä¸‹è½½æ¨¡å‹å’Œä¾èµ–</td></tr><tr><td>æ˜¾å¡è¦æ±‚</td><td>NVIDIA GPUï¼Œå»ºè®® 8GB æ˜¾å­˜åŠä»¥ä¸Šï¼ˆ<strong>RTX 20 ç³»åˆ—åŠä»¥ä¸Š</strong>ï¼‰</td></tr><tr><td>æ˜¾å¡é©±åŠ¨</td><td>NVIDIA é©±åŠ¨ 531 åŠä»¥ä¸Šï¼ˆ<strong>ç¤ºä¾‹ç¯å¢ƒ</strong>ï¼š580.97ï¼‰</td></tr><tr><td>CUDAç‰ˆæœ¬</td><td>CUDA 12ï¼ˆéœ€ä¸ PyTorch/FlashAttention ç‰ˆæœ¬å¯¹åº”ï¼‰</td></tr><tr><td>PyTorchç‰ˆæœ¬</td><td>2.8.0ï¼ˆå·²ç¼–è¯‘æ”¯æŒ cu128ï¼Œå³ CUDA 12.8ï¼Œå¯¹åº” wheel åŒ…ï¼štorch2.8+cu128ï¼‰</td></tr></tbody></table>
<blockquote>
<p>èµ„æ–™æ‰“åŒ…ä¸‹è½½ï¼ˆå« FlashAttention 2.7.4ã€VibeVoice æ¨¡å‹ï¼ˆ1.5Bï¼‰ã€å‚è€ƒéŸ³é¢‘ï¼‰</p>
<p>ç™¾åº¦ç½‘ç›˜ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fpan.baidu.com%2Fs%2F1IxFfB0SKPiQuIIbiZfKwBQ%3Fpwd%3D7au3%25EF%25BC%2588%25E6%258F%2590%25E5%258F%2596%25E7%25A0%2581%25EF%25BC%259A**7au3**%25EF%25BC%2589" target="_blank" title="https://pan.baidu.com/s/1IxFfB0SKPiQuIIbiZfKwBQ?pwd=7au3%EF%BC%88%E6%8F%90%E5%8F%96%E7%A0%81%EF%BC%9A**7au3**%EF%BC%89" ref="nofollow noopener noreferrer">pan.baidu.com/s/1IxFfB0SKâ€¦</a></p>
</blockquote>
<h3 data-id="heading-5">2.1 å®‰è£…FlashAttention2</h3>
<p><strong>FlashAttentionï¼ˆflash_attnï¼‰</strong> æ˜¯ä¸€ç§é’ˆå¯¹ <strong>Transformer æ¨¡å‹ä¸­æ³¨æ„åŠ›æœºåˆ¶ (Attention)</strong> çš„é«˜æ•ˆå®ç°ï¼Œå®ƒçš„ä¸»è¦ä½œç”¨æ˜¯ <strong>è®©å¤§æ¨¡å‹æ¨ç†å’Œè®­ç»ƒæ›´å¿«ã€æ›´çœæ˜¾å­˜</strong>ã€‚</p>
<blockquote>
<p>å®˜æ–¹GitHubå‘å¸ƒé¡µåœ°å€ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmjun0812%2Fflash-attention-prebuild-wheels%2Freleases" target="_blank" title="https://github.com/mjun0812/flash-attention-prebuild-wheels/releases" ref="nofollow noopener noreferrer">github.com/mjun0812/flâ€¦</a></p>
<p>æœ¬æ•™ç¨‹æ¼”ç¤ºå®‰è£…çš„FlashAttentionç‰ˆæœ¬ä¸º2.7.4</p>
</blockquote>
<p>åœ¨é€‰æ‹©<code>Flash-Attention</code>æ—¶ï¼Œéœ€è¦æŸ¥çœ‹æ‚¨çš„æ˜¾å¡é©±åŠ¨æ”¯æŒçš„CUDAç‰ˆæœ¬ä¿¡æ¯ï¼Œåœ¨CMDä¸­è¾“å…¥ï¼š</p>
<pre><code class="hljs language-shell" lang="shell">nvidia-smi
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/edaef1ca172944e998ea36c3eeaa8831~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6ICF6Zi_6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771299521&amp;x-signature=1q5mtPHyLmk2OGdXS67zweRqQcM%3D" alt="image-20250905150304683" loading="lazy"/></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œå½“å‰<code>CUDA</code>ç‰ˆæœ¬æ˜¾ç¤º13.0ï¼ˆæ”¯æŒå‘ä¸‹å…¼å®¹ä¸€äº›çš„ï¼‰</p>
<p>åœ¨å‘å¸ƒé¡µä¸‹ï¼Œä¸‹è½½å¯¹åº”ä½ ç³»ç»Ÿç¯å¢ƒçš„whlåŒ…ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5d85347f354f43de8f97232bbe3c9716~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6ICF6Zi_6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771299521&amp;x-signature=6zVEW6IF37t4JU6q%2FBK1ZbvlE%2F8%3D" alt="image-20250905145650427" loading="lazy"/></p>
<p>å°†æ–‡ä»¶ä¸‹è½½è‡³æœ¬åœ°ï¼š</p>
<pre><code class="hljs language-text" lang="text">flash_attn-2.7.4+cu128torch2.8-cp311-cp311-win_amd64.whl
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1be910439fb84da2be03d1a973162ed5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6ICF6Zi_6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771299521&amp;x-signature=KNWyLZzxGglMZQ%2F4HRSuCoiEpqI%3D" alt="image-20250905145715450" loading="lazy"/></p>
<p><strong>ç¯å¢ƒè¦æ±‚è§£æï¼š</strong></p>
<ul>
<li><strong><code>cp311-cp311</code></strong> â†’ è¯´æ˜éœ€è¦ <strong>Python 3.11</strong></li>
<li><strong><code>torch2.8</code></strong> â†’ è¯´æ˜éœ€è¦ <strong>PyTorch 2.8.0</strong></li>
<li><strong><code>cu128</code></strong> â†’ è¯´æ˜éœ€è¦ <strong>CUDA 12.8</strong>ï¼ˆPyTorch è¦ç”¨å¯¹åº”çš„ CUDA ç¼–è¯‘ç‰ˆæœ¬ï¼‰</li>
<li><strong><code>win_amd64</code></strong> â†’ è¯´æ˜éœ€è¦ <strong>Windows 64 ä½ç³»ç»Ÿ</strong></li>
</ul>
<p>é¦–å…ˆï¼Œéœ€è¦æ£€æŸ¥å½“å‰ç”µè„‘çš„pythonç¯å¢ƒï¼Œåœ¨cmdä¸­è¾“å…¥å¦‚ä¸‹å‘½ä»¤æ£€æŸ¥ï¼š</p>
<pre><code class="hljs language-shell" lang="shell">python --version
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c69f4982cd6c47a38902c8d07a4ab566~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6ICF6Zi_6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771299521&amp;x-signature=mc5RbeF0BHmBpyYLxHKNcjo%2BVJA%3D" alt="image-20250905145843345" loading="lazy"/></p>
<p>å¯ä»¥çœ‹åˆ°å·²ç»æ˜¯<code>python 3.11.4</code>çš„ç‰ˆæœ¬ã€‚</p>
<blockquote>
<p>å¦‚æœæ²¡æœ‰å®‰è£…python,å¯å‰å¾€å®˜ç½‘è¿›è¡Œå®‰è£…ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.python.org%2Fdownloads%2F" target="_blank" title="https://www.python.org/downloads/" ref="nofollow noopener noreferrer">www.python.org/downloads/</a></p>
</blockquote>
<p>æ¥ä¸‹æ¥éœ€è¦æ£€æŸ¥ PyTorch ç‰ˆæœ¬ï¼ŒåŒæ ·æ‰“å¼€cmdæ‰§è¡Œ:</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_">#</span><span class="bash">1.è¾“å…¥pythonå›è½¦</span>
python
<span class="hljs-meta prompt_">
#</span><span class="bash">2.ç„¶åè¾“å…¥å¦‚ä¸‹å‘½ä»¤</span>
import torch
print(torch.__version__)
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/10ee71508d2940ba83d2b8932dc68b7a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6ICF6Zi_6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771299521&amp;x-signature=4X56w17URWRYNVnmIS6sFrBk4D0%3D" alt="image-20250905151112814" loading="lazy"/></p>
<p>å¦‚æœæ²¡æœ‰å®‰è£… PyTorch ï¼Œæ˜¾ç¤ºåº”å¦‚ä¸‹ï¼š
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9b223d7c74ab4a23b492e5d51c61fcee~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6ICF6Zi_6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771299521&amp;x-signature=WDaq4soJntnuZa6I4CGrOMDS6FA%3D" alt="image-20250905151323803" loading="lazy"/></p>
<p>éœ€è¦æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤è¿›è¡Œå®‰è£…å³å¯ï¼š</p>
<pre><code class="hljs language-shell" lang="shell">pip install torch==2.8.0+cu128 torchvision torchaudio --index-url https://download.pytorch.org/whl/cu128
</code></pre>
<p>æ¥ä¸‹æ¥éœ€è¦å®‰è£…FlashAttention2.7.4ï¼Œåœ¨å‰é¢å·²ç»ä¸‹è½½çš„é€‚é…ç¯å¢ƒçš„ wheel æ–‡ä»¶ç›®å½•ä¸‹æ‰“å¼€CMDï¼š
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b31a58c5c5264983aca12d492e45831c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6ICF6Zi_6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771299521&amp;x-signature=4k0UjCfrp19OQ3kjnu0ajEt5zWU%3D" alt="image-20250905151800906" loading="lazy"/></p>
<p>ç„¶åè¾“å…¥å¦‚ä¸‹å‘½ä»¤è¿›è¡Œå®‰è£…ï¼š</p>
<pre><code class="hljs language-shell" lang="shell">pip install flash_attn-2.7.4+cu128torch2.8-cp311-cp311-win_amd64.whl
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/32928a8ede5b4737a312a0c55092564c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6ICF6Zi_6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771299521&amp;x-signature=pV59ESKMt1OM4BK1w9qFRQ0ybFU%3D" alt="image-20250905152033680" loading="lazy"/></p>
<p>æ£€æŸ¥ç‰ˆæœ¬ä¿¡æ¯ç¡®è®¤å®‰è£…ï¼š</p>
<pre><code class="hljs language-shell" lang="shell">python

import flash_attn
print(flash_attn.__version__)
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1f6b0c59396a42d6b951a589aeba2104~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6ICF6Zi_6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771299521&amp;x-signature=X%2FGuOhDyzuce0RYO2lVzzWIBnJs%3D" alt="image-20250905152122033" loading="lazy"/></p>
<p>æˆåŠŸå®‰è£…ï¼</p>
<h2 data-id="heading-6">3 ComfyUIå·¥ä½œæµé¡¹ç›®å®‰è£…éƒ¨ç½²</h2>
<blockquote>
<p>å®˜æ–¹GitHubä»“åº“åœ°å€ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fcomfyanonymous%2FComfyUI" target="_blank" title="https://github.com/comfyanonymous/ComfyUI" ref="nofollow noopener noreferrer">github.com/comfyanonymâ€¦</a></p>
</blockquote>
<p>ä»¥windowsä¸ºä¾‹ï¼Œé¦–å…ˆä½¿ç”¨gitå‘½ä»¤å°†é¡¹ç›®å…‹éš†è‡³æœ¬åœ°ï¼Œcmdæ‰§è¡Œå‘½ä»¤ï¼š</p>
<blockquote>
<p>gitå®˜ç½‘åœ°å€ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgit-scm.com%2Fdownloads" target="_blank" title="https://git-scm.com/downloads" ref="nofollow noopener noreferrer">git-scm.com/downloads</a></p>
</blockquote>
<pre><code class="hljs language-shell" lang="shell">git clone https://github.com/comfyanonymous/ComfyUI.git
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/43738156e9e04cb6a30f7a90c781fe52~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6ICF6Zi_6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771299521&amp;x-signature=EQJ%2BWT44zkpKA2Emcwn0e3cOsU4%3D" alt="image-20250905154423769" loading="lazy"/></p>
<p>æ¥ç€ç»§ç»­åœ¨è¯¥çª—å£ï¼Œä¾æ¬¡æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œå®‰è£…æ‰€éœ€ä¾èµ–ï¼š</p>
<pre><code class="hljs language-shell" lang="shell">cd ComfyUI

pip install -r requirements.txt
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d5014c2fd11d47db86bc502205057daf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6ICF6Zi_6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771299521&amp;x-signature=UfFRFpsx0KnlmXx%2FM9WPJnXYnCA%3D" alt="image-20250905154544713" loading="lazy"/></p>
<p>å®‰è£…å®Œæˆä¾èµ–åï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤è¿›è¡Œå¯åŠ¨æµ‹è¯•ï¼š</p>
<pre><code class="hljs language-shell" lang="shell">python main.py --listen 0.0.0.0 --port 18188
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d1565314acc94307858ce10a83e596af~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6ICF6Zi_6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771299521&amp;x-signature=pFKqztlIRnF%2FTO8cF4Mk1kNcegg%3D" alt="image-20250905154857906" loading="lazy"/>å¯ä»¥çœ‹åˆ°ï¼ŒæˆåŠŸå¯åŠ¨äº†ï¼Œç«¯å£ä¸º 18188ï¼Œä¸ºäº†åç»­æ–¹ä¾¿å¯åŠ¨ï¼Œå¯ä»¥å†™ä¸€ä¸ªbatè„šæœ¬ï¼Œå°†å‘½ä»¤æ”¾å…¥å…¶ä¸­ï¼š
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/31fe5ce28baa4bdeab9138c13fcb4ffa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6ICF6Zi_6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771299521&amp;x-signature=9%2BYM7ldF31N%2Bqa8Xkm%2F8rxuxIcQ%3D" alt="image-20250905155057220" loading="lazy"/></p>
<p>åç»­åŒå‡»è„šæœ¬ï¼Œå°±å¯ä»¥ç›´æ¥å¯åŠ¨ï¼š
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/737ac359e12d4c469d612990ed2e4162~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6ICF6Zi_6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771299521&amp;x-signature=44Mn3Vpqvy62RVMB%2B0zM7aoT%2B4U%3D" alt="image-20250905155134482" loading="lazy"/></p>
<p>å¯ä»¥çœ‹åˆ°è¾“å‡ºäº†å¦‚ä¸‹ä¿¡æ¯ï¼š</p>
<pre><code class="hljs language-text" lang="text">To see the GUI go to: http://0.0.0.0:18188
</code></pre>
<p>è®©æˆ‘ä»¬è®¿é—®æµè§ˆå™¨è¿›è¡Œæµ‹è¯•ï¼š</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_">#</span><span class="bash">ä¸Šé¢æ˜¾ç¤ºçš„0.0.0.0 é€šå¸¸è¡¨ç¤ºç»‘å®šåˆ°æœ¬æœºçš„æ‰€æœ‰ç½‘ç»œæ¥å£ï¼Œå› æ­¤å®ƒå¯ä»¥é€šè¿‡æœ¬æœºçš„ä»»ä½•æœ‰æ•ˆIPåœ°å€ï¼ˆåŒ…æ‹¬localhostæˆ–127.0.0.1ï¼‰æ¥è®¿é—®ã€‚</span>
http://localhost:18188
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dec1ed0da83e49a2a98b06e24e2ab240~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6ICF6Zi_6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771299521&amp;x-signature=pMaBVJgYw50SpX05Y%2FpjLEFJaLc%3D" alt="image-20250905155443397" loading="lazy"/></p>
<p>å¯ä»¥çœ‹åˆ°ï¼ŒæˆåŠŸè®¿é—®å•¦ï¼</p>
<h2 data-id="heading-7">4 ComfyUI-VibeVoiceé¡¹ç›®éƒ¨ç½²</h2>
<p>ComfyUI-VibeVoice æ˜¯ä¸€ä¸ªä¸º <strong>ComfyUI</strong> å¼€å‘çš„è‡ªå®šä¹‰æ’ä»¶ï¼Œå®ƒé›†æˆäº†å¾®è½¯çš„ <strong>VibeVoice</strong> æ–‡æœ¬è½¬è¯­éŸ³ï¼ˆTTSï¼‰æ¨¡å‹ï¼Œèƒ½å¤Ÿå®ç°é«˜è´¨é‡ã€å¤šè¯´è¯äººçš„è¯­éŸ³åˆæˆä¸é›¶æ ·æœ¬è¯­éŸ³å…‹éš†ã€‚ç”¨æˆ·åªéœ€è¾“å…¥æ–‡æœ¬å¹¶æä¾›å‚è€ƒéŸ³é¢‘ï¼Œå°±å¯ä»¥å¿«é€Ÿç”Ÿæˆé£æ ¼ä¸€è‡´ã€è‡ªç„¶æµç•…çš„è¯­éŸ³ï¼›åŒæ—¶æ”¯æŒå¤šè§’è‰²å¯¹è¯ã€é•¿ç¯‡å†…å®¹ç”Ÿæˆï¼Œå¹¶æä¾›å¤šç§æ³¨æ„åŠ›æœºåˆ¶å’Œ 4-bit é‡åŒ–ä»¥ä¼˜åŒ–æ€§èƒ½ï¼Œé€‚åˆåœ¨æ’­å®¢åˆ¶ä½œã€å¯¹è¯é…éŸ³ã€AI è¯­éŸ³å®éªŒç­‰åœºæ™¯ä¸­ä½¿ç”¨ã€‚</p>
<h3 data-id="heading-8">4.1 å…‹éš†é¡¹ç›®ä»£ç </h3>
<p>åœ¨å‰é¢çš„æ­¥éª¤ï¼Œå·²ç»éƒ¨ç½²å¥½äº†ComfyUIå·¥ä½œæµé¡¹ç›®ã€‚æ¥ä¸‹æ¥éœ€è¦æ‰“å¼€å¦‚ä¸‹ç›®å½•ï¼š</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_">#</span><span class="bash">å‰é¢é¡¹ç›®<span class="hljs-built_in">clone</span>ä¸‹æ¥çš„ä½ç½®</span>
D:\AI\ComfyUI\custom_nodes
</code></pre>
<p>åœ¨è¯¥ç›®å½•ä¸‹æ‰“å¼€å‘½ä»¤ç»ˆç«¯ï¼Œä½¿ç”¨gitå‘½ä»¤å°†é¡¹ç›®å…‹éš†ä¸‹æ¥ï¼š</p>
<pre><code class="hljs language-shell" lang="shell">git clone https://github.com/wildminder/ComfyUI-VibeVoice.git
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fbb3b9ae4d5f4f6b8a7594d25b27780d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6ICF6Zi_6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771299521&amp;x-signature=lkUjPU1gohdmnu8sH1jg1Eq8zCE%3D" alt="image-20250905160411584" loading="lazy"/></p>
<p>ç„¶åæ¥ç€æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œä¸‹è½½è¯¥é¡¹ç›®ç›¸å…³ä¾èµ–ï¼š</p>
<pre><code class="hljs language-shell" lang="shell">cd ComfyUI-VibeVoice

pip install -r requirements.txt
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1864d6808dda492ea03a6420e993b07e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6ICF6Zi_6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771299521&amp;x-signature=O1NPIOeDReIVAehr1tfRBGxp0gQ%3D" alt="image-20250905160551797" loading="lazy"/></p>
<h2 data-id="heading-9">5 ComfyUI ä¸­é…ç½®å’Œä½¿ç”¨ VibeVoiceï¼ˆå®æˆ˜ï¼‰</h2>
<p>åŒå‡»å¯åŠ¨å‰é¢åœ¨ComfyUIç›®å½•ä¸­åˆ›å»ºçš„<code>StartComfyUI-WEB.bat</code>è„šæœ¬ï¼ˆå¦‚æœå‰é¢å¯åŠ¨äº†ï¼Œæ²¡æœ‰åœæ­¢çª—å£éœ€è¦å…ˆåœæ­¢å¯åŠ¨çš„çª—å£ï¼‰ï¼š
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d2f19694edca4ca3a612276bf8cd65b9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6ICF6Zi_6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771299521&amp;x-signature=ooriI8k%2FW3%2FIjFt5SUkPDlFn4Iw%3D" alt="image-20250905161339378" loading="lazy"/></p>
<p>å¯åŠ¨ååœ¨æµè§ˆå™¨ä¸­è®¿é—®ComfyUIé¡¹ç›®ï¼Œç„¶åä¾æ¬¡å¦‚ä¸‹å›¾é€‰æ‹©ï¼ˆæˆ–ç›´æ¥æŒ‰å¿«æ·é”® Ctrl + Oï¼‰ï¼š
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/11519e9f5e79404692389786747a2162~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6ICF6Zi_6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771299521&amp;x-signature=5%2F2hpRUuUmDRItIp971LkA%2BwL80%3D" alt="image-20250905161515561" loading="lazy"/></p>
<p>æ¥ç€ï¼Œè¿›å…¥åˆ°å¦‚ä¸‹ç›®å½•é€‰æ‹©VibeVoice_example.jsonæ–‡ä»¶ï¼Œç„¶åç‚¹å‡»æ‰“å¼€ï¼š</p>
<pre><code class="hljs language-shell" lang="shell">D:\AI\ComfyUI\custom_nodes\ComfyUI-VibeVoice\example_workflows
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f9d4d8055dd64a37a5884cf0a46d01b0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6ICF6Zi_6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771299521&amp;x-signature=mroQeHxvPaz9iB2%2FqhaeAI0vKjI%3D" alt="image-20250905161627411" loading="lazy"/></p>
<p>æ‰“å¼€åï¼Œå¯ä»¥çœ‹åˆ°å¦‚ä¸‹å›¾æ˜¾ç¤ºï¼š
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a6d6335f1a0d4fbf9d91c7474e9a6eba~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6ICF6Zi_6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771299521&amp;x-signature=17jGTMaiYW9z4cWeNtdEQGTnnco%3D" alt="image-20250905161951873" loading="lazy"/></p>
<p>æ¥ç€ï¼Œéšæ„ä¸Šä¼ ä¸¤ä¸ª<code>å‚è€ƒéŸ³é¢‘</code>ï¼Œç„¶åç»™å®šä¸€æ®µå¯¹è¯ï¼ˆè¿™é‡Œä½¿ç”¨çš„æ˜¯AIç”Ÿæˆçš„æ¨å¹‚å’Œæµ·ç»µå®å®çš„å¯¹è¯ï¼‰ï¼š</p>
<pre><code class="hljs language-shell" lang="shell">Speaker 1: å“ˆå“ˆï¼Œæµ·ç»µå®å®ï¼Œå¬è¯´ä½ åœ¨æ°´ä¸‹çš„ç”Ÿæ´»éå¸¸æœ‰è¶£ï¼Œèƒ½å’Œæˆ‘ä»¬åˆ†äº«ä¸€ä¸‹å—ï¼Ÿ
Speaker 2: å“‡å“¦ï¼Œæ¨å¹‚ï¼å½“ç„¶å¯ä»¥ï¼æˆ‘æ¯å¤©éƒ½åœ¨æ¯”å¥‡å ¡å’Œæˆ‘çš„æœ‹å‹ä»¬ä¸€èµ·ç©ï¼Œæœ€å–œæ¬¢çš„å°±æ˜¯å’Œæ´¾å¤§æ˜Ÿä¸€èµ·åšå†’é™©äº†ï¼
Speaker 1: è¿™å¬èµ·æ¥çœŸçš„å¾ˆæœ‰è¶£ï¼é‚£ä½ è§‰å¾—æ´¾å¤§æ˜Ÿæœ€æç¬‘çš„åœ°æ–¹æ˜¯ä»€ä¹ˆï¼Ÿ
Speaker 2: å“‡ï¼Œæ´¾å¤§æ˜ŸçœŸçš„å¾ˆæç¬‘ï¼ä»–æ€»æ˜¯é‚£ä¹ˆå¤©çœŸæ— é‚ªï¼Œåšäº‹å¸¸å¸¸æ²¡æœ‰ä»»ä½•è®¡åˆ’ï¼Œæ€»æ˜¯å¸¦ç»™æˆ‘ä»¬æƒŠå–œå’Œç¬‘å£°ï¼
Speaker 1: å“ˆå“ˆï¼Œæ„Ÿè§‰ä½ ä»¬çš„å†’é™©ä¸€å®šå¾ˆæ¬¢ä¹ã€‚æˆ‘æƒ³çŸ¥é“ï¼Œæµ·ç»µå®å®ï¼Œä½ æœ‰åšè¿‡ä»€ä¹ˆç‰¹åˆ«çš„äº‹æƒ…å—ï¼Ÿ
Speaker 2: å½“ç„¶ï¼æˆ‘æ›¾ç»å½“è¿‡é¤å…ç»ç†ï¼Œåœ¨èŸ¹å ¡ç‹å·¥ä½œï¼Œæ¯å¤©éƒ½å¿™å¾—ä¸äº¦ä¹ä¹ã€‚ä¸è¿‡æœ€ç‰¹åˆ«çš„è¿˜æ˜¯æˆ‘åšçš„èŸ¹å ¡ï¼Œå¤§å®¶éƒ½è¯´æˆ‘åšçš„æœ€ç¾å‘³ï¼
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a624394e0e994afdbbeade0ea3117865~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6ICF6Zi_6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771299521&amp;x-signature=k0ROFQpbxX2m0FY1kZmmf0SjnOs%3D" alt="image-20250905163933933" loading="lazy"/></p>
<blockquote>
<p>æ¨¡å‹é€‰æ‹©ï¼Œé¦–æ¬¡å¦‚æœæ²¡æœ‰è¯¥æ¨¡å‹ä¼šè‡ªåŠ¨è¿›è¡Œä¸‹è½½ï¼Œä¹Ÿå¯ä»¥ç›´æ¥æ‰‹åŠ¨ä¸‹è½½æ¨¡å‹</p>
<p>æ”¾å…¥å¦‚ä¸‹æ–‡ä»¶å¤¹ï¼šD:\AI\ComfyUI\models\tts\VibeVoice</p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9ce02bab5c4f4f8789180b395bc652e0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6ICF6Zi_6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771299521&amp;x-signature=%2B5XO4jcK2b5cgZxAsDFlj%2B8q9ic%3D" alt="image-20250905164034943" loading="lazy"/></p>
<p>å®Œæˆæœ¬åœ°æµç¨‹é…ç½®åï¼Œæˆ‘ä»¬å°†é€šè¿‡ cpolar å°†è¯¥å·¥ä½œæµå¯¹å¤–å‘å¸ƒï¼Œä¾¿äºè·¨è®¾å¤‡è®¿é—®ä¸å…±äº«ã€‚</p>
<p>å¦‚ä¸‹ä¸º1.5Bæ¨¡å‹ç”Ÿæˆ,ç‚¹å‡»å¯è¿›è¡Œè¯•å¬ï¼š</p>

  
  æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒ audio å…ƒç´ ã€‚

<p>ä»¥ä¸‹ä¸º7Bæ¨¡å‹å¼€å¯é‡åŒ–åŠŸèƒ½åç”Ÿæˆæ¨ç†çš„è¯­éŸ³ï¼ˆ3060tiçš„8Gæ˜¾å­˜æ— æ³•å®Œå…¨åŠ è½½7Bæ¨¡å‹ï¼‰ï¼š</p>

  
  æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒ audio å…ƒç´ ã€‚

<h2 data-id="heading-10">6 ä½¿ç”¨ cpolar å°† ComfyUI å®‰å…¨æš´éœ²åˆ°å…¬ç½‘</h2>
<h3 data-id="heading-11">6.1 ä¸ºä»€ä¹ˆè¦ç©¿é€comfyUI</h3>
<p>å€ŸåŠ© cpolar å†…ç½‘ç©¿é€ï¼Œæˆ‘ä»¬æ— éœ€å…¬ç½‘ IP ä¸è·¯ç”±é…ç½®ï¼Œå³å¯å°†æœ¬åœ° ComfyUI æœåŠ¡ç¨³å®šã€å®‰å…¨åœ°å‘å¸ƒåˆ°å…¬ç½‘ï¼Œæ”¯æŒ HTTPS ä¸å›ºå®šäºŒçº§åŸŸåã€‚</p>
<p>å¾ˆå¤šæ—¶å€™æˆ‘ä»¬åœ¨æœ¬åœ°ç”µè„‘æˆ–è€…æœåŠ¡å™¨ä¸Šéƒ¨ç½²äº† ComfyUIï¼Œä½†åˆå¸Œæœ›èƒ½éšæ—¶ä»å…¶ä»–è®¾å¤‡è®¿é—®ï¼Œæ¯”å¦‚è¿œç¨‹è°ƒè¯•ã€å’ŒåŒäº‹åä½œä¿®æ”¹èŠ‚ç‚¹ï¼Œæˆ–è€…åœ¨ä¸åŒåœ°æ–¹å±•ç¤ºæ¨¡å‹ç”Ÿæˆæ•ˆæœã€‚é—®é¢˜æ˜¯ ComfyUI é»˜è®¤åªèƒ½åœ¨æœ¬åœ°è®¿é—®ï¼Œå¤–ç½‘æ ¹æœ¬æ— æ³•è¿æ¥ï¼Œè¿™å°±è®©è¿œç¨‹ä½¿ç”¨å˜å¾—éå¸¸éº»çƒ¦ï¼Œéœ€è¦å¤æ‚çš„è·¯ç”±è®¾ç½®æˆ–è€…å›ºå®šå…¬ç½‘ IPã€‚é€šè¿‡å†…ç½‘ç©¿é€å·¥å…·å¦‚ cpolarï¼Œæˆ‘ä»¬å¯ä»¥æŠŠæœ¬åœ°çš„ ComfyUI å®‰å…¨åœ°æ˜ å°„åˆ°å…¬ç½‘ï¼Œç”Ÿæˆä¸€ä¸ªéšæ—¶å¯ç”¨çš„å…¬ç½‘åœ°å€ã€‚è¿™æ ·æ— è®ºèº«å¤„ä½•åœ°ï¼Œéƒ½èƒ½è½»æ¾è®¿é—®å’Œæ“ä½œ ComfyUIï¼Œå®ç°è¿œç¨‹åä½œå’Œå±•ç¤ºï¼Œè€Œä¸å¿…å†ä¸ºç½‘ç»œé…ç½®çƒ¦æ¼ã€‚</p>
<h3 data-id="heading-12">6.2 ä»€ä¹ˆæ˜¯ cpolarï¼ˆå†…ç½‘ç©¿é€ï¼‰ï¼Ÿ</h3>
<ul>
<li><strong>cpolar æ˜¯ä¸€æ¬¾å†…ç½‘ç©¿é€å·¥å…·</strong>ï¼Œå¯ä»¥å°†ä½ åœ¨å±€åŸŸç½‘å†…è¿è¡Œçš„æœåŠ¡ï¼ˆå¦‚æœ¬åœ° Web æœåŠ¡å™¨ã€SSHã€è¿œç¨‹æ¡Œé¢ç­‰ï¼‰é€šè¿‡ä¸€æ¡å®‰å…¨åŠ å¯†çš„ä¸­é—´éš§é“æ˜ å°„è‡³å…¬ç½‘ï¼Œè®©å¤–éƒ¨è®¾å¤‡æ— éœ€é…ç½®è·¯ç”±å™¨å³å¯è®¿é—®ã€‚</li>
<li>å¹¿æ³›æ”¯æŒ Windowsã€macOSã€Linuxã€æ ‘è“æ´¾ã€ç¾¤æ™– NAS ç­‰å¹³å°ï¼Œå¹¶æä¾›ä¸€é”®å®‰è£…è„šæœ¬æ–¹ä¾¿éƒ¨ç½²ã€‚</li>
</ul>
<h3 data-id="heading-13">6.3 ä¸‹è½½cpolar</h3>
<p>æ‰“å¼€cpolarå®˜ç½‘çš„ä¸‹è½½é¡µé¢ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.cpolar.com%2Fdownload" target="_blank" title="https://www.cpolar.com/download" ref="nofollow noopener noreferrer">www.cpolar.com/download</a>
ç‚¹å‡»<code>ç«‹å³ä¸‹è½½ 64-bit</code>æŒ‰é’®ï¼Œä¸‹è½½cpolarçš„å®‰è£…åŒ…ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4607555e15264d5dbf843193bb8b600f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6ICF6Zi_6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771299521&amp;x-signature=tC4i48eGRrB99Yo6%2FeuMmlF6hW8%3D" alt="image-20250815171202537" loading="lazy"/></p>
<p>ä¸‹è½½ä¸‹æ¥æ˜¯ä¸€ä¸ªå‹ç¼©åŒ…ï¼Œè§£å‹åæ‰§è¡Œç›®å½•ä¸­çš„åº”ç”¨ç¨‹åºï¼Œä¸€è·¯é»˜è®¤å®‰è£…å³å¯ï¼Œå®‰è£…å®Œæˆåï¼Œæ‰“å¼€cmdçª—å£è¾“å…¥å¦‚ä¸‹å‘½ä»¤ç¡®è®¤å®‰è£…ï¼š</p>
<pre><code class="hljs language-shell" lang="shell">cpolar version
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b8c22b55462c49ff8c44e2b4f252c5ad~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6ICF6Zi_6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771299521&amp;x-signature=DSSqUuZL8cTPQLxoaOuG9GV6Q5o%3D" alt="image-20250815171446129" loading="lazy"/></p>
<p>å‡ºç°å¦‚ä¸Šç‰ˆæœ¬å³ä»£è¡¨å®‰è£…æˆåŠŸï¼</p>
<p>å®‰è£…å®Œæˆåï¼Œcpolar å°†ä½œä¸ºæœ¬æ–¹æ¡ˆâ€œå…¬ç½‘è®¿é—®èƒ½åŠ›â€çš„å…³é”®åŸºç¡€ï¼Œè´¯ç©¿åç»­æ‰€æœ‰è¿œç¨‹è®¿é—®ä¸åä½œåœºæ™¯ã€‚</p>
<h3 data-id="heading-14">6.4æ³¨å†ŒåŠç™»å½•cpolar web uiç®¡ç†ç•Œé¢</h3>
<h4 data-id="heading-15">6.4.1 æ³¨å†Œcpolar</h4>
<p>å®˜ç½‘é“¾æ¥ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.cpolar.com%2F" target="_blank" title="https://www.cpolar.com/" ref="nofollow noopener noreferrer">www.cpolar.com/</a></p>
<p>è®¿é—®<code>cpolar</code>å®˜ç½‘ï¼Œç‚¹å‡»<code>å…è´¹æ³¨å†Œ</code>æŒ‰é’®ï¼Œè¿›è¡Œè´¦å·æ³¨å†Œ</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5493be24a2f247249093e09e4555628b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6ICF6Zi_6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771299521&amp;x-signature=FQMYWN8jhxDQ%2BvHerI9KCj%2BV4oQ%3D" alt="image-20250804085039567" loading="lazy"/></p>
<p>æ³¨å†Œé¡µé¢ï¼š
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f92f5ad382ed461f8db75324ce9403ec~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6ICF6Zi_6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771299521&amp;x-signature=B46CuJaq7cVMe0xTWHKEp9rGNGE%3D" alt="image-20250804085208319" loading="lazy"/></p>
<h4 data-id="heading-16">6.4.2 è®¿é—®web uiç®¡ç†ç•Œé¢</h4>
<p>æ³¨å†Œå®Œæˆå,åœ¨æµè§ˆå™¨ä¸­è¾“å…¥å¦‚ä¸‹åœ°å€è®¿é—® web uiç®¡ç†ç•Œé¢:</p>
<pre><code class="hljs language-shell" lang="shell">http://127.0.0.1:9200
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/35db9041d20d4760a997711200d4b894~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6ICF6Zi_6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771299521&amp;x-signature=iGhB5FnrMO207Z%2B%2Bfs%2B%2B%2FHoL%2BJk%3D" alt="image-20250815171734046" loading="lazy"/></p>
<p>è¾“å…¥åˆšæ‰æ³¨å†Œå¥½çš„cpolarè´¦å·ç™»å½•å³å¯è¿›å…¥åå°é¡µé¢:</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/54067c621ea54f58a8c1188ef14f8a84~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6ICF6Zi_6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771299521&amp;x-signature=Dw8v5J%2Ftb0knP8snTT38WMURQd8%3D" alt="image-20250815171846757" loading="lazy"/></p>
<h3 data-id="heading-17">6.5 ä½¿ç”¨ cpolar ç©¿é€ ComfyUI çš„ WebUI ç•Œé¢</h3>
<p>å‰é¢å¯ä»¥çœ‹åˆ°ï¼ŒcomfyUIçš„WebUIçš„ç•Œé¢ï¼Œç«¯å£æ˜¾ç¤ºä¸ºï¼š18188</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2dcc34d18a5c41cfa866addb6fb652c8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6ICF6Zi_6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771299521&amp;x-signature=X%2FqGEPRg5WReKNFGDJd6JsDWELk%3D" alt="image-20250905180851034" loading="lazy"/></p>
<p>æ‰€ä»¥æˆ‘ä»¬éœ€è¦å°†è¯¥ç«¯å£è¿›è¡Œç©¿é€ä»¥æ”¯æŒå’±ä»¬å…¬ç½‘è®¿é—®ï¼</p>
<h4 data-id="heading-18">6.5.1 éšæœºåŸŸåæ–¹å¼(å…è´¹æ–¹æ¡ˆ)</h4>
<p>ä½¿ç”¨ cpolar çš„éšæœºåŸŸåæ–¹å¼é€‚åˆé¢„ç®—æœ‰é™çš„ç”¨æˆ·ã€‚ä½¿ç”¨æ­¤æ–¹å¼æ—¶ï¼Œç³»ç»Ÿä¼šæ¯éš” <strong>24 å°æ—¶å·¦å³</strong> è‡ªåŠ¨æ›´æ¢ä¸€æ¬¡åŸŸååœ°å€ã€‚å¯¹äºé•¿æœŸè®¿é—®çš„ä¸å¤ªå‹å¥½ï¼Œä½†æ˜¯è¯¥æ–¹æ¡ˆæ˜¯å…è´¹çš„ï¼Œå¦‚æœæ‚¨æœ‰ä¸€å®šçš„é¢„ç®—ï¼Œå¯ä»¥æŸ¥çœ‹å¤§çº²6.5.2 çš„<strong>å›ºå®šåŸŸåæ–¹å¼</strong>ï¼Œä¸”<strong>è®¿é—®æ›´ç¨³å®š</strong>ã€‚</p>
<p>ç‚¹å‡»å·¦ä¾§èœå•æ çš„<code>éš§é“ç®¡ç†</code>ï¼Œå±•å¼€è¿›å…¥<code>éš§é“åˆ—è¡¨</code>é¡µé¢ï¼Œé¡µé¢ä¸‹é»˜è®¤ä¼šæœ‰ 2 ä¸ªéš§é“ï¼š</p>
<ul>
<li>sshéš§é“ï¼ŒæŒ‡å‘22ç«¯å£ï¼Œtcpåè®®</li>
<li>websiteéš§é“ï¼ŒæŒ‡å‘8080ç«¯å£ï¼Œhttpåè®®ï¼ˆhttpåè®®é»˜è®¤ä¼šç”Ÿæˆ2ä¸ªå…¬ç½‘åœ°å€ï¼Œä¸€ä¸ªæ˜¯httpï¼Œå¦ä¸€ä¸ªhttpsï¼Œå…å»é…ç½®sslè¯ä¹¦çš„ç¹çæ­¥éª¤ï¼‰</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/97584695f0554052856fa19c3be46f24~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6ICF6Zi_6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771299521&amp;x-signature=Ao1kUgOU9CdOVShcBhuo1cyVlIw%3D" alt="image-20250731121517683" loading="lazy"/></p>
<p>ç‚¹å‡»<code>websiteéš§é“</code>çš„<code>ç¼–è¾‘</code>æŒ‰é’®ï¼Œå¡«å†™å¦‚ä¸‹ä¿¡æ¯ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/52ad329ea4e24c84819499b518e39343~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6ICF6Zi_6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771299521&amp;x-signature=MXg%2FVsueeLFCAImzEST3Ri1Xshc%3D" alt="image-20250905181406529" loading="lazy"/></p>
<ul>
<li>æ³¨æ„ï¼šæ¯ä¸ªç”¨æˆ·åˆ›å»ºçš„éš§é“æ˜¾ç¤ºçš„å…¬ç½‘åœ°å€éƒ½ä¸ä¸€æ ·ï¼</li>
</ul>
<p>æ¥ç€ï¼Œç‚¹å‡»å·¦ä¾§èœå•çš„<code>çŠ¶æ€</code>èœå•ï¼Œæ¥ç€ç‚¹å‡»<code>åœ¨çº¿éš§é“åˆ—è¡¨</code>èœå•æŒ‰é’®ï¼Œå¯ä»¥çœ‹åˆ°æœ‰2ä¸ªcomfyui-18188çš„éš§é“ï¼Œä¸€ä¸ªä¸º http åè®®ï¼Œå¦ä¸€ä¸ªä¸º https åè®®ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7fa4931d3e0c485a8089e10f6c2eb4ec~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6ICF6Zi_6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771299521&amp;x-signature=mgtuLox7Z99mdd6jrBtkoPAZfOM%3D" alt="image-20250905181536558" loading="lazy"/></p>
<p>æ¥ä¸‹æ¥åœ¨æµè§ˆå™¨ä¸­è®¿é—® website éš§é“ç”Ÿæˆçš„å…¬ç½‘åœ°å€ï¼ˆhttp å’Œ https çš†å¯ï¼‰
è¿™é‡Œä»¥httpsä¸ºä¾‹ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7b76ad8f8a8c4d73bc7a7b77e30772fa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6ICF6Zi_6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771299521&amp;x-signature=2xKMHi3TY0WKYtY%2FVLyL5sIVj9g%3D" alt="image-20250905181810649" loading="lazy"/></p>
<p>å¯ä»¥çœ‹åˆ°æˆåŠŸè®¿é—®å•¦ï¼</p>
<h4 data-id="heading-19">6.5.2 å›ºå®šåŸŸåæ–¹å¼ï¼ˆå‡çº§å¥—é¤ï¼‰</h4>
<p>é€šè¿‡ cpolar çš„å›ºå®šäºŒçº§å­åŸŸåæ–¹å¼ï¼ˆå‡çº§å¥—é¤ï¼‰ï¼Œå¯è·å¾—ç¨³å®šä¸å˜çš„å…¬ç½‘åœ°å€ï¼Œä¾¿äºé•¿æœŸè®¿é—®ä¸å¯¹å¤–åˆ†äº«ã€‚</p>
<p>è¿›å…¥å®˜ç½‘çš„é¢„ç•™é¡µé¢ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fdashboard.cpolar.com%2Freserved" target="_blank" title="https://dashboard.cpolar.com/reserved" ref="nofollow noopener noreferrer">dashboard.cpolar.com/reserved</a></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1fa222ab999b42f7a53a81ef48c95878~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6ICF6Zi_6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771299521&amp;x-signature=Cc81khmCHZ8CmpV3pdrTkOFSsSU%3D" alt="image-20250905193637752" loading="lazy"/></p>
<p>åˆ—è¡¨ä¸­æ˜¾ç¤ºäº†ä¸€æ¡å·²ä¿ç•™çš„äºŒçº§å­åŸŸåè®°å½•ï¼š</p>
<ul>
<li>åœ°åŒºï¼šæ˜¾ç¤ºä¸º<code>China Top</code>ã€‚</li>
<li>äºŒçº§åŸŸåï¼šæ˜¾ç¤ºä¸º<code>comfyui01</code>ã€‚</li>
</ul>
<pre><code class="hljs language-text" lang="text">æ³¨ï¼šäºŒçº§åŸŸåæ˜¯å”¯ä¸€çš„ï¼Œæ¯ä¸ªè´¦å·éƒ½ä¸ç›¸åŒï¼Œè¯·ä»¥è‡ªå·±è®¾ç½®çš„äºŒçº§åŸŸåä¿ç•™çš„ä¸ºä¸»
</code></pre>
<p>è¿›å…¥ä¾§è¾¹èœå•æ çš„<code>éš§é“ç®¡ç†</code>ä¸‹çš„<code>éš§é“åˆ—è¡¨</code>ï¼Œå¯ä»¥çœ‹åˆ°åä¸º<code>comfyui-18188</code>çš„éš§é“
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e14982dd6b3c489eb82f1d8a0037678d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6ICF6Zi_6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771299521&amp;x-signature=RdM2g5I7G0%2B5I5t4wI0WcAoTtss%3D" alt="image-20250905193710797" loading="lazy"/></p>
<p>ç‚¹å‡»<code>ç¼–è¾‘</code>æŒ‰é’®è¿›å…¥ç¼–è¾‘é¡µé¢ï¼Œä¿®æ”¹åŸŸåç±»å‹ä¸º<code>äºŒçº§å­åŸŸå</code>ï¼Œç„¶åå¡«å†™å‰é¢é…ç½®å¥½çš„å­åŸŸåï¼Œç‚¹å‡»æ›´æ–°æŒ‰é’®ï¼š
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/158c4105b1094f63b021bb9303cd1b30~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6ICF6Zi_6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771299521&amp;x-signature=fXFO%2B1LiGlQFvQLSyjrU6pfwKE4%3D" alt="image-20250905195904105" loading="lazy"/></p>
<p>æ¥åˆ°<code>çŠ¶æ€</code>èœå•ä¸‹çš„<code>åœ¨çº¿éš§é“åˆ—è¡¨</code>å¯ä»¥çœ‹åˆ°éš§é“åç§°ä¸º<code>comfyui-18188</code>çš„å…¬ç½‘åœ°å€å·²ç»å˜æ›´ä¸º<code>äºŒçº§å­åŸŸå+å›ºå®šåŸŸåä¸»ä½“åŠåç¼€</code>çš„å½¢å¼äº†ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1ad256789be445acb93fe66ccf11f515~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6ICF6Zi_6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771299521&amp;x-signature=9yysg3EgM8XB7d8pfQX7sIM%2B4Ps%3D" alt="image-20250905195932400" loading="lazy"/></p>
<p>è¿™é‡Œä»¥httpsåè®®åšè®¿é—®æµ‹è¯•:</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ab21e13b8b904f92a0eca479cfa251ee~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6ICF6Zi_6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771299521&amp;x-signature=W30v68UmZ3rVD4unVylPhCmIyqY%3D" alt="image-20250907174602474" loading="lazy"/></p>
<p>è®¿é—®æˆåŠŸï¼</p>
<p>è‡³æ­¤ï¼Œä¾æ‰˜ cpolarï¼Œæˆ‘ä»¬å·²å°†æœ¬åœ° ComfyUI æœåŠ¡ç¨³å®šå‘å¸ƒåˆ°å…¬ç½‘ï¼Œä¾¿äºå›¢é˜Ÿè¿œç¨‹åä½œä¸å¤–éƒ¨æ¼”ç¤ºã€‚</p>
<h3 data-id="heading-20">6.6 ç»™ComfyUIæ·»åŠ æˆæƒéªŒè¯</h3>
<p>ç”±äº<code>ComfyUI</code>æœåŠ¡çš„WebUIç•Œé¢æ— éœ€ç™»å½•å³å¯è¿›è¡Œè®¿é—®ï¼Œä¸ºäº†ä¿æŠ¤ä¸ªäººçš„éšç§å³å®‰å…¨ï¼Œcpolarçš„éš§é“æœåŠ¡æ”¯æŒç»™ç½‘ç«™æ·»åŠ æˆæƒéªŒè¯åŠŸèƒ½ï¼Œé˜²æ­¢æ‚¨éƒ¨ç½²åœ¨å®¶ä¸­çš„<code>ComfyUI</code>æœåŠ¡è¢«æ»¥ç”¨ã€‚</p>
<p>é¦–å…ˆï¼Œæ‰“å¼€éš§é“åˆ—è¡¨ï¼Œç‚¹å‡»ç¼–è¾‘<code>comfyui-18188</code>çš„éš§é“ï¼š
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cd8445dc53974721a6860fadb4b28548~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6ICF6Zi_6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771299521&amp;x-signature=HFk7N4GGbdbxLVuLGLAwJ3LHX8M%3D" alt="image-20250908104953889" loading="lazy"/></p>
<p>ç„¶åï¼Œç‚¹å‡»é«˜çº§æŒ‰é’®ï¼Œå±•å¼€ï¼ŒæŒ‰ç…§å¦‚ä¸‹å›¾è¿›è¡Œé…ç½®ï¼š
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5272a0e4a1b04ee884f9ebc504b1bf37~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6ICF6Zi_6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771299521&amp;x-signature=ea%2BljrpTMGKeqpqEwZbsATYprAU%3D" alt="image-20250908105304054" loading="lazy"/></p>
<p>ç‚¹å‡»æ›´æ–°æŒ‰é’®åï¼Œè®¿é—®ç©¿é€çš„åœ°å€ï¼Œå¯ä»¥å‘ç°éœ€è¦æˆæƒéªŒè¯ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c3901ed16e9c4961afea472541436dae~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6ICF6Zi_6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771299521&amp;x-signature=9XgkdJQDkJp8xv4QF%2Fxhqmre6Og%3D" alt="image-20250908105335660" loading="lazy"/></p>
<p>è¿™æ ·ï¼Œä¸€ä¸ªå¯ä»¥éšæ—¶è®¿é—®ä¸”å¸¦æœ‰å®‰å…¨æ€§çš„<code>ComfyUI</code>çš„å·¥ä½œæµç½‘é¡µç«¯å°±å¼„å¥½å•¦ï¼</p>
<h2 data-id="heading-21">7 ä¸‰äººå¯¹è¯å’Œå››äººå¯¹è¯æµ‹è¯•</h2>
<h3 data-id="heading-22">7.1 ä¸‰äººå¯¹è¯</h3>
<p>é¦–å…ˆå‡†å¤‡ä¸€æ®µå¯¹è¯å†…å®¹ï¼š</p>
<pre><code class="hljs language-text" lang="text">Speaker 1: å¤§å®¶å¥½ï¼Œå¥½ä¹…ä¸è§äº†ï¼æˆ‘ä»¬ä»Šå¤©ç»ˆäºå¯ä»¥å¥½å¥½èŠèŠäº†ã€‚
Speaker 2: æ˜¯å•Šï¼Œæœ€è¿‘å·¥ä½œå¤ªå¿™äº†ï¼Œç»ˆäºèƒ½å’Œå¤§å®¶æ”¾æ¾ä¸€ä¸‹äº†ã€‚
Speaker 3: å“ˆå“ˆï¼Œä½ ä»¬æœ‰æ²¡æœ‰å‘ç°ï¼Œæˆ‘ä»¬ä¸‰ä¸ªå‡‘åœ¨ä¸€èµ·ï¼Œè¯é¢˜æ ¹æœ¬åœä¸ä¸‹æ¥ã€‚
Speaker 1: æœ€è¿‘æˆ‘åœ¨æ‹ä¸€éƒ¨å¤è£…å‰§ï¼Œé€ å‹è¶…çº§å¤æ‚ï¼Œæ¯å¤©éƒ½è¦èŠ±ä¸‰ä¸ªå°æ—¶åŒ–å¦†ã€‚
Speaker 2: å“‡ï¼Œé‚£ä¹Ÿå¤ªè¾›è‹¦äº†ï¼æˆ‘æœ€è¿‘åœ¨åšæ–°æ­Œdemoï¼Œç†¬å¤œç†¬åˆ°å¿«å¤±çœ äº†ã€‚
Speaker 3: çœ‹æ¥å¤§å®¶éƒ½å¾ˆæ‹¼å•Šï¼Œæˆ‘è¿™è¾¹åˆšä»å·¡æ¼”å›æ¥ï¼Œç°åœ¨åªæƒ³ä¼‘æ¯ç¡è§‰ã€‚
</code></pre>
<p>è¿™é‡Œçš„<code>Speaker 1</code>å’Œ<code>Speaker 2</code>ä»¥åŠ<code>Speaker 3</code>åˆ†åˆ«å¯¹åº”çš„å‚è€ƒéŸ³é¢‘å¦‚ä¸‹ï¼š</p>
<ul>
<li><strong>Speaker 1</strong>ï¼šæ¨å¹‚</li>
<li><strong>Speaker 2</strong>ï¼šè”¡å¾å¤</li>
<li><strong>Speaker 3</strong>ï¼šç‹ä¿Šå‡¯</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/458c32cc4def4359b000ec1e1822abc8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6ICF6Zi_6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771299521&amp;x-signature=OvwbazAjvSWrd0Vo4Ln6EOJpgXI%3D" alt="image-20250907192122704" loading="lazy"/></p>
<p>è®©æˆ‘ä»¬è¯•å¬ä¸€ä¸‹3äººå¯¹è¯çš„æ•ˆæœï¼š</p>

  
  æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒ audio å…ƒç´ ã€‚

<blockquote>
<p>ç”±äºæ¼”ç¤ºçš„windowsç³»ç»Ÿï¼Œ3060tiæ˜¾å¡ï¼Œæ˜¾å­˜ä¸º8Gï¼Œæ¨ç† 7B æ¨¡å‹å†…å­˜ä¼šè¶…å‡ºï¼Œæ‰€ä»¥è¿™è¾¹å°±ä¸åš7Bçš„æ¼”ç¤ºäº†</p>
</blockquote>
<h3 data-id="heading-23">7.2 å››äººå¯¹è¯</h3>
<p>åœ¨å‰é¢çš„å¯¹è¯å†…å®¹åŸºç¡€ä¸Šï¼Œæ·»åŠ ä¸€ä¸ªæ–°çš„è§’è‰²<code>Speaker 4</code>,è¿™é‡Œä½¿ç”¨çš„å‚è€ƒéŸ³é¢‘ä¸ºï¼š</p>
<ul>
<li><strong>Speaker 4</strong>ï¼šæ—å¿—ç²</li>
</ul>
<pre><code class="hljs language-text" lang="text">Speaker 1: å¤§å®¶å¥½ï¼Œå¥½ä¹…ä¸è§äº†ï¼æˆ‘ä»¬ä»Šå¤©ç»ˆäºå¯ä»¥å¥½å¥½èŠèŠäº†ã€‚
Speaker 2: æ˜¯å•Šï¼Œæœ€è¿‘å·¥ä½œå¤ªå¿™äº†ï¼Œç»ˆäºèƒ½å’Œå¤§å®¶æ”¾æ¾ä¸€ä¸‹äº†ã€‚
Speaker 3: å“ˆå“ˆï¼Œä½ ä»¬æœ‰æ²¡æœ‰å‘ç°ï¼Œæˆ‘ä»¬å››ä¸ªå‡‘åœ¨ä¸€èµ·ï¼Œè¯é¢˜æ ¹æœ¬åœä¸ä¸‹æ¥ã€‚
Speaker 4: å¬åˆ°ä½ ä»¬çš„å£°éŸ³æˆ‘å°±è§‰å¾—ç‰¹åˆ«æ¸©æš–ï¼Œä»Šå¤©ä¸€å®šè¦èŠä¸ªå°½å…´ï¼
Speaker 1: æœ€è¿‘æˆ‘åœ¨æ‹ä¸€éƒ¨å¤è£…å‰§ï¼Œé€ å‹è¶…çº§å¤æ‚ï¼Œæ¯å¤©éƒ½è¦èŠ±ä¸‰ä¸ªå°æ—¶åŒ–å¦†ã€‚
Speaker 2: å“‡ï¼Œé‚£ä¹Ÿå¤ªè¾›è‹¦äº†ï¼æˆ‘æœ€è¿‘åœ¨åšæ–°æ­Œdemoï¼Œç†¬å¤œç†¬åˆ°å¿«å¤±çœ äº†ã€‚
Speaker 3: çœ‹æ¥å¤§å®¶éƒ½å¾ˆæ‹¼å•Šï¼Œæˆ‘è¿™è¾¹åˆšä»å·¡æ¼”å›æ¥ï¼Œç°åœ¨åªæƒ³ä¼‘æ¯ç¡è§‰ã€‚
Speaker 4: æˆ‘å’Œä½ ä»¬æ¯”è½»æ¾å¤šäº†ï¼Œæœ€è¿‘ä¸»è¦åœ¨åšä¸€äº›å…¬ç›Šæ´»åŠ¨ï¼Œä¹Ÿè›®å……å®çš„ã€‚
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/af062384dcc9422182b231c07c55dcb9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6ICF6Zi_6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771299521&amp;x-signature=L7uaaVPSLuqAQ9c%2Fv%2BklXCGkCf8%3D" alt="image-20250908004742342" loading="lazy"/></p>
<p>è®©æˆ‘ä»¬è¯•å¬ä¸€ä¸‹4äººå¯¹è¯çš„æ•ˆæœï¼š</p>

  
  æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒ audio å…ƒç´ ã€‚

<p>å¯ä»¥çœ‹åˆ°ï¼Œ4äººå¯¹è¯çš„æ•ˆæœä¹Ÿæ˜¯éå¸¸ä¸é”™çš„ï¼Œéƒ½æ˜¯æ¼”ç¤ºäº†2è½®å¯¹è¯ã€‚æ¨ç†æ˜¾ç¤ºç”¨äº† 180s å·¦å³ï¼Œè¿˜æ˜¯å¾ˆä¸é”™çš„ï¼</p>
<h2 data-id="heading-24">æ€»ç»“</h2>
<p>VibeVoice å‡­å€Ÿå¤šè§’è‰²ã€é•¿æ—¶é•¿ã€å¸¦æƒ…ç»ªçš„è¯­éŸ³ç”Ÿæˆèƒ½åŠ›ï¼Œè§£å†³äº†å¤šåœºæ™¯ä¸‹éŸ³é¢‘åˆ›ä½œçš„æ ¸å¿ƒç—›ç‚¹ï¼ŒComfyUI åˆ™è®©æ“ä½œé—¨æ§›å¤§å¹…é™ä½ï¼Œä½†å±€åŸŸç½‘ä½¿ç”¨çš„å±€é™ç¡®å®åˆ¶çº¦äº†åˆ›ä½œçš„çµæ´»æ€§ã€‚è€Œ cpolar å†…ç½‘ç©¿é€çš„åŠ å…¥ï¼Œæ°å¥½è¡¥é½äº†è¿™ä¸€çŸ­æ¿ï¼Œå®ç°äº† VibeVoice åˆ›ä½œåœºæ™¯çš„å»¶ä¼¸ â€”â€” æ— è®ºæ˜¯ä¸ªäººåˆ›ä½œè€…éšæ—¶éšåœ°è°ƒæ•´é…éŸ³è„šæœ¬ï¼Œè¿˜æ˜¯å›¢é˜Ÿåä½œå®æ—¶ä¼˜åŒ–éŸ³é¢‘æ•ˆæœï¼Œéƒ½èƒ½é«˜æ•ˆå®Œæˆã€‚è¿™å¥—ç»„åˆå¹¶éå•çº¯çš„æŠ€æœ¯å åŠ ï¼Œè€Œæ˜¯ä»å®é™…åˆ›ä½œéœ€æ±‚å‡ºå‘ï¼Œè®©å¤šè§’è‰²è¯­éŸ³ç”Ÿæˆä» â€œåªèƒ½å›ºå®šåœ°ç‚¹æ“ä½œâ€ å˜æˆ â€œéšæ—¶éšåœ°å¯åˆ›ä½œâ€ï¼ŒçœŸæ­£é€‚é…äº†å‰§æœ¬æ€ã€è‡ªåª’ä½“ã€ä¼ä¸šåŸ¹è®­ç­‰åœºæ™¯çš„å®é™…ä½¿ç”¨éœ€æ±‚ï¼Œä¸ºéŸ³é¢‘å†…å®¹åˆ›ä½œæä¾›äº†æ›´çµæ´»ã€æ›´å®ç”¨çš„è§£å†³æ–¹æ¡ˆã€‚</p>
<p>æ„Ÿè°¢æ‚¨é˜…è¯»æœ¬ç¯‡æ–‡ç« ï¼Œæœ‰ä»»ä½•é—®é¢˜æ¬¢è¿ç•™è¨€äº¤æµã€‚<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.cpolar.com%2F" target="_blank" title="https://www.cpolar.com/" ref="nofollow noopener noreferrer">cpolarå®˜ç½‘-å®‰å…¨çš„å†…ç½‘ç©¿é€å·¥å…· | æ— éœ€å…¬ç½‘ip | è¿œç¨‹è®¿é—® | æ­å»ºç½‘ç«™</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[C ç«¯é«˜å¹¶å‘ä¸‹çš„ KV å­˜å‚¨ä¼˜åŒ–]]></title>    <link>https://juejin.cn/post/7604666872128241683</link>    <guid>https://juejin.cn/post/7604666872128241683</guid>    <pubDate>2026-02-10T03:45:14.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604666872128241683" data-draft-id="7604757482003841087" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="C ç«¯é«˜å¹¶å‘ä¸‹çš„ KV å­˜å‚¨ä¼˜åŒ–"/> <meta itemprop="keywords" content="åç«¯,Java,æ•°æ®åº“"/> <meta itemprop="datePublished" content="2026-02-10T03:45:14.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="LanLance"/> <meta itemprop="url" content="https://juejin.cn/user/2837173444548711"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            C ç«¯é«˜å¹¶å‘ä¸‹çš„ KV å­˜å‚¨ä¼˜åŒ–
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2837173444548711/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    LanLance
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T03:45:14.000Z" title="Tue Feb 10 2026 03:45:14 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>C ç«¯åœºæ™¯ä¸‹åˆ†å¸ƒå¼ KV å­˜å‚¨ï¼ˆå¦‚ Redisã€Tairï¼‰éšç€ä¸šåŠ¡é€»è¾‘çš„æ—¥ç›Šå¤æ‚ã€å¯¹è±¡ä½“ç§¯ä¸æ–­è†¨èƒ€ï¼Œå¤§ Value é—®é¢˜æˆä¸ºç³»ç»Ÿé¡½ç–¾ä¹‹ä¸€ï¼Œå±å®³ç³»ç»Ÿç¨³å®šæ€§ä¸æ¥å£æ€§èƒ½ã€‚</p>
<ul>
<li>
<p>å¤§ Value æ•°æ®å¦‚æœè¯»å†™é¢‘ç‡è¾ƒé«˜ï¼Œå®¹æ˜“å¯¼è‡´ç½‘å¡æµé‡è¾ƒé«˜è§¦å‘æµæ§ï¼Œè¿˜å®¹æ˜“ç¡¬ç›˜çš„è´Ÿè½½å¤ªé«˜ç”šè‡³å¯¼è‡´å¼•æ“å¤„ç†ä¸è¿‡æ¥è€Œé˜»å¡æ­£å¸¸çš„å†™å…¥ã€‚</p>
</li>
<li>
<p>å¤§ Value ç½‘ç»œä¼ è¾“å’Œå†…å­˜æ‹·è´æœ¬èº«å°±æ…¢ï¼ŒæœåŠ¡ç«¯çš„å†…ç½®ç¼“å­˜å¼•æ“ä¸å®¹æ˜“ç¼“å­˜å¤§ Valueï¼Œæ¶‰åŠçš„å¤§ Value è¯»å†™åŸºæœ¬éƒ½æ˜¯ç»è¿‡ç¡¬ç›˜ï¼Œè€Œä¸”å¤§ Value åœ¨å­˜å‚¨å¼•æ“ä¸Šå®¹æ˜“æœ‰ä¸¥é‡çš„å†™æ”¾å¤§é—®é¢˜ï¼Œæ‰€ä»¥å¤§ Value å¤„ç†æ€§èƒ½ä¼šæ˜æ˜¾è¾ƒå·®ã€‚</p>
</li>
</ul>
<p>ä¸ºäº†è§£å†³è¿™ä¸€ç—›ç‚¹ï¼ŒåŒæ—¶ä¸ç‰ºç‰²ç³»ç»Ÿçš„ååèƒ½åŠ›ï¼Œé’ˆå¯¹æ€§åœ°è®¾è®¡å‡ºäº†ä¸€å¥—åŸºäº Fory åºåˆ—åŒ–ä¸ Zstd å‹ç¼©çš„ç»„åˆæ–¹æ¡ˆã€‚è¿™å¥—æ–¹æ¡ˆçš„æ ¸å¿ƒé€»è¾‘åœ¨äºï¼šåˆ©ç”¨ Fory çš„æè‡´æ€§èƒ½è§£å†³åºåˆ—åŒ–å¸¦æ¥çš„ CPU å’Œè€—æ—¶é—®é¢˜ï¼Œåˆ©ç”¨ Zstd çš„é«˜å‹ç¼©æ¯”ä¸è§£å‹é€Ÿåº¦è§£å†³ KV å­˜å‚¨çš„å¤§ Value é—®é¢˜ã€‚</p>
<h2 data-id="heading-0">ä¸ºä»€ä¹ˆæ˜¯ Fory ä¸ Zstd</h2>
<p>åœ¨ä¼ ç»Ÿ Java æœåŠ¡ç«¯å¼€å‘ä¸­ï¼Œåºåˆ—åŒ–é€šå¸¸ä½¿ç”¨ JDK è‡ªå¸¦æ–¹æ¡ˆæˆ– Hessianï¼Œå‹ç¼©ä¹ æƒ¯ä½¿ç”¨ Gzipã€‚ä½†åœ¨ QPS æé«˜çš„åœºæ™¯ä¸‹è¯¥ç»„åˆæ€§èƒ½å·®ã€ç³»ç»Ÿå‹åŠ›å¤§ã€‚</p>
<p><strong>Apache Foryâ„¢</strong>ï¼ˆæ·˜å®å¼€æºï¼‰æ˜¯ä¸€ä¸ªåŸºäºåŠ¨æ€ä»£ç ç”Ÿæˆå’Œé›¶æ‹·è´æŠ€æœ¯çš„å¤šè¯­è¨€åºåˆ—åŒ–æ¡†æ¶ï¼Œå®ç°äº†æ— éœ€ IDL ç¼–è¯‘çš„åŸç”Ÿå¤šè¯­è¨€ç¼–ç¨‹èŒƒå¼ï¼Œå¹¶æä¾›æœ€é«˜ 170 å€çš„æ€§èƒ½å’Œæè‡´çš„æ˜“ç”¨æ€§ã€‚å¤§å¹…æå‡å¤§è§„æ¨¡æ•°æ®ä¼ è¾“ã€é«˜å¹¶å‘ RPCã€åˆ†å¸ƒå¼ç³»ç»Ÿã€äº‘åŸç”Ÿä¸­é—´ä»¶ç­‰åœºæ™¯çš„æ€§èƒ½ï¼Œæ˜¾è‘—é™ä½å¤šè¯­è¨€ç³»ç»Ÿçš„ç ”å‘æˆæœ¬ã€‚</p>
<p><strong>Zstandard</strong>ï¼ˆFacebook å¼€æºï¼‰æ˜¯ä¸€ä¸ªæä¾›é«˜å‹ç¼©æ¯”çš„å¿«é€Ÿå‹ç¼©ç®—æ³•ï¼Œé‡‡ç”¨äº†æœ‰é™çŠ¶æ€ç†µï¼ˆFinite State Entropyï¼Œç¼©å†™ä¸º FSEï¼‰ç¼–ç å™¨ã€‚è¯¥ç¼–ç å™¨æ˜¯åŸºäº ANS ç†è®ºå¼€å‘çš„ä¸€ç§æ–°å‹ç†µç¼–ç å™¨ï¼Œæä¾›äº†éå¸¸å¼ºå¤§çš„å‹ç¼©é€Ÿåº¦/å‹ç¼©ç‡çš„æŠ˜ä¸­æ–¹æ¡ˆï¼ˆäº‹å®ä¸Šä¹Ÿçš„ç¡®åšåˆ°äº†â€œé±¼â€å’Œâ€œç†ŠæŒâ€å…¼å¾—ï¼‰ã€‚Zstandard è¾¾åˆ°äº† Pareto frontierï¼ˆèµ„æºåˆ†é…æœ€ä½³çš„ç†æƒ³çŠ¶æ€ï¼‰ï¼Œå› ä¸ºå®ƒè§£å‹ç¼©é€Ÿåº¦å¿«äºä»»ä½•å…¶ä»–å½“å‰å¯ç”¨çš„ç®—æ³•ï¼Œä½†å‹ç¼©æ¯”ç±»ä¼¼æˆ–æ›´å¥½ã€‚</p>
<h2 data-id="heading-1">é€‰å‹å¯¹æ¯”</h2>
<p><strong>åºåˆ—åŒ–ç®—æ³•å¯¹æ¯”</strong></p>
<p>åœ¨åºåˆ—åŒ–å±‚é¢ï¼Œæˆ‘ä»¬ä¸»è¦å…³æ³¨åºåˆ—åŒ–é€Ÿåº¦ï¼ˆå½±å“æ¥å£è€—æ—¶ï¼‰ã€ç æµå¤§å°ï¼ˆå½±å“ç½‘ç»œä¸å­˜å‚¨ï¼‰ä»¥åŠæ˜“ç”¨æ€§ã€‚</p>















































<table><thead><tr><th>åºåˆ—åŒ–æ¡†æ¶</th><th>åºåˆ—åŒ–/ååºåˆ—åŒ–é€Ÿåº¦</th><th>ç æµå¤§å°</th><th>æ˜“ç”¨æ€§ä¸å…¼å®¹æ€§</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td><strong>Fory</strong></td><td>æå¿« (JIT åŠ é€Ÿ)</td><td>å° (æ”¯æŒç±»æ³¨å†Œ)</td><td>é«˜ (å…¼å®¹ JDK åºåˆ—åŒ–ï¼Œæ— éœ€ IDL)</td><td>é«˜æ€§èƒ½ Java åº”ç”¨ï¼Œå†…éƒ¨ RPC/KV</td></tr><tr><td><strong>Hessian2</strong></td><td>ä¸­ç­‰</td><td>ä¸­ç­‰</td><td>é«˜ (å…¼å®¹æ€§å¥½)</td><td>ä¼ ç»Ÿ RPCï¼Œå¯¹æ€§èƒ½è¦æ±‚ä¸ä¸¥è‹›</td></tr><tr><td><strong>Protobuf</strong></td><td>å¿«</td><td>æå°</td><td>ä½ (éœ€ç¼–å†™.proto æ–‡ä»¶)</td><td>è·¨è¯­è¨€äº¤äº’ï¼ŒSchema ç¨³å®šçš„åœºæ™¯</td></tr><tr><td><strong>JDK åŸç”Ÿ</strong></td><td>æ…¢</td><td>å¤§</td><td>é«˜ (å¼€ç®±å³ç”¨)</td><td>ä¸æ¨èç”¨äºé«˜å¹¶å‘ç”Ÿäº§ç¯å¢ƒ</td></tr><tr><td><strong>Kryo</strong></td><td>æå¿«</td><td>å°</td><td>ä¸­ (éœ€å¤„ç†çº¿ç¨‹å®‰å…¨)</td><td>å¤§æ•°æ®å¤„ç†ï¼ŒSpark/Flink</td></tr></tbody></table>
<p>Fory åœ¨ä¿æŒäº† Java åŸç”Ÿå…¼å®¹æ€§çš„å‰æä¸‹ï¼Œæä¾›äº†æ¥è¿‘ç”šè‡³è¶…è¶Š Protobuf çš„æ€§èƒ½ï¼Œä¸”ä¸éœ€è¦ç»´æŠ¤å¤æ‚çš„ IDL æ–‡ä»¶ã€‚</p>
<p><strong>å‹ç¼©ç®—æ³•å¯¹æ¯”</strong></p>
<p>åœ¨å‹ç¼©å±‚é¢ï¼Œæˆ‘ä»¬é‡ç‚¹å…³æ³¨å‹ç¼©ç‡ï¼ˆèŠ‚çœç©ºé—´ï¼‰ä¸è§£å‹é€Ÿåº¦ï¼ˆå½±å“è¯»å– RTï¼‰ã€‚</p>








































<table><thead><tr><th>å‹ç¼©ç®—æ³•</th><th>å‹ç¼©ç‡</th><th>å‹ç¼©é€Ÿåº¦</th><th>è§£å‹é€Ÿåº¦</th><th>ç‰¹ç‚¹</th></tr></thead><tbody><tr><td><strong>Zstd</strong></td><td>é«˜</td><td>å¿«</td><td>æå¿«</td><td>ç»¼åˆæ€§èƒ½æœ€å¼ºï¼Œå¹³è¡¡äº†ç©ºé—´ä¸æ—¶é—´</td></tr><tr><td><strong>Gzip</strong></td><td>é«˜</td><td>æ…¢</td><td>æ…¢</td><td>CPU æ¶ˆè€—å¤§ï¼Œé«˜å¹¶å‘ä¸‹æ˜“å¯¼è‡´ RT æŠ–åŠ¨</td></tr><tr><td><strong>LZ4</strong></td><td>ä½</td><td>æå¿«</td><td>æå¿«</td><td>é€Ÿåº¦æœ€å¿«ï¼Œä½†å‹ç¼©ç‡è¾ƒä½ï¼Œå¤§ Value ä¼˜åŒ–æœ‰é™</td></tr><tr><td><strong>Snappy</strong></td><td>ä½</td><td>å¿«</td><td>å¿«</td><td>Google å‡ºå“ï¼Œæ€§èƒ½ä»‹äº LZ4 ä¸ Gzip ä¹‹é—´</td></tr></tbody></table>
<p>Zstd åœ¨å‹ç¼©ç‡ä¸Šå®Œèƒœ LZ4ï¼Œåœ¨è§£å‹é€Ÿåº¦ä¸Šå®Œèƒœ Gzipï¼Œè¾¾åˆ°äº† Pareto frontierã€‚</p>
<h2 data-id="heading-2">æœ€ä½³å®è·µ</h2>
<p><strong>æ•´ä½“æµç¨‹</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8dfd66e5876f43d68c01b0d8173ad935~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTGFuTGFuY2U=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771299915&amp;x-signature=p3Be7rSi5EUHbOrmL4Tzm%2BIXafI%3D" alt="" loading="lazy"/></p>
<p><strong>Fory å®ä¾‹å¤ç”¨</strong></p>
<p>åˆ›å»º Fory æˆæœ¬å¾ˆé«˜ï¼Œå§‹ç»ˆå¤ç”¨å®ä¾‹ï¼Œä¸¥ç¦åœ¨æ¯æ¬¡è¯·æ±‚ä¸­é€šè¿‡ <code>new Fory()</code> åˆ›å»ºå®ä¾‹ï¼Œåº”ä½¿ç”¨ <code>ThreadSafeFory</code> æˆ–è€… <code>ThreadLocal</code> æ¥å¤ç”¨å®ä¾‹ã€‚åŒæ—¶æŒ‰ ID æ³¨å†Œç±»ä¼šæœ‰æ›´å¥½çš„æ€§èƒ½å’Œæ›´å°çš„ç©ºé—´å¼€é”€ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> ThreadSafeFory FORY_INSTANCE;

<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Map&lt;Class&lt;?&gt;, Integer&gt; REGISTERED_CLASSES_WITH_IDS = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedHashMap</span>&lt;&gt;();
<span class="hljs-keyword">static</span> {
    REGISTERED_CLASSES_WITH_IDS.put(LbsRecallCacheBO.class, <span class="hljs-number">1</span>);
    REGISTERED_CLASSES_WITH_IDS.put(ActivityPoiDocument.class, <span class="hljs-number">2</span>);
    REGISTERED_CLASSES_WITH_IDS.put(SkuSolrVo.class, <span class="hljs-number">3</span>);
    REGISTERED_CLASSES_WITH_IDS.put(PoiScore.class, <span class="hljs-number">4</span>);
}
</code></pre>
<p><strong>Zstd è§£å‹ç²¾ç¡®åˆ†é…</strong></p>
<p>Zstd åœ¨è§£å‹æ—¶ï¼Œå¦‚æœèƒ½é¢„å…ˆçŸ¥é“è§£å‹åçš„æ•°æ®å¤§å°ï¼Œå°±å¯ä»¥ç›´æ¥åˆ†é…ç²¾ç¡®çš„å†…å­˜ç©ºé—´ï¼Œé¿å…å¤šæ¬¡å†…å­˜æ‰©å®¹æˆ–åˆ†é…è¿‡å¤§çš„ç¼“å†²åŒºã€‚æœ€ä½³å®è·µæ˜¯åœ¨å‹ç¼©åçš„å­—èŠ‚æ•°ç»„å¤´éƒ¨æ‰‹åŠ¨å†™å…¥åŸå§‹æ•°æ®çš„é•¿åº¦ï¼ˆæˆ–è€…ä½¿ç”¨ <em>ZSTD_getFrameContentSize</em> APIï¼‰ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">byte</span>[] serializeAndCompress(Object object) {
    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">if</span> (object == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[<span class="hljs-number">0</span>];
        }
        <span class="hljs-type">byte</span>[] serializedData = FORY_INSTANCE.serializeJavaObject(object);
        <span class="hljs-keyword">if</span> (serializedData == <span class="hljs-literal">null</span> || serializedData.length == <span class="hljs-number">0</span>) {
            LOGGER.warn(<span class="hljs-string">"Serialized data is empty for object: {}"</span>, object.getClass().getName());
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[<span class="hljs-number">0</span>];
        }
        <span class="hljs-type">byte</span>[] compressedData = Zstd.compress(serializedData, ZSTD_COMPRESSION_LEVEL);
        <span class="hljs-type">ByteBuffer</span> <span class="hljs-variable">buffer</span> <span class="hljs-operator">=</span> ByteBuffer.allocate(HEADER_SIZE + compressedData.length);
        buffer.putInt(serializedData.length);
        buffer.put(compressedData);
        <span class="hljs-keyword">return</span> buffer.array();
    } <span class="hljs-keyword">catch</span> (Exception e) {
        LOGGER.error(<span class="hljs-string">"Fory+Zstd serialization failed for object: {}"</span>, object.getClass().getName(), e);
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"Fory+Zstd serialization failed"</span>, e);
    }
}
</code></pre>
<h2 data-id="heading-3">ä¼˜åŒ–æ•ˆæœ</h2>
<p>æŸæ ¸å¿ƒè¥é”€é¡µé¢ï¼ˆè„±æ•ï¼‰æ­£å¸¸å¬å› TP90 59.4msï¼Œä½¿ç”¨ç¼“å­˜å¬å› TP90 1.6msï¼ŒåŒæ—¶åˆé«˜å³°è¯¥é¡µé¢ç¼“å­˜å‘½ä¸­ç‡ 80% å·¦å³ã€‚ä¸”åœ¨ 10 ä¸‡ QPS çš„å…¥å£æµé‡ä¸‹ TP90 èƒ½å¤Ÿä¿è¯ 2ms ä»¥å†…ï¼ŒValue å¤§å°å‡å°äº 100Kbã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä½¿ç”¨bufio Writeræ—¶ï¼Œæ‰‹åŠ¨è°ƒç”¨Flush()çš„å¿…è¦æ€§]]></title>    <link>https://juejin.cn/post/7604741630448648226</link>    <guid>https://juejin.cn/post/7604741630448648226</guid>    <pubDate>2026-02-10T03:23:16.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604741630448648226" data-draft-id="7604779604124893184" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä½¿ç”¨bufio Writeræ—¶ï¼Œæ‰‹åŠ¨è°ƒç”¨Flush()çš„å¿…è¦æ€§"/> <meta itemprop="keywords" content="Go"/> <meta itemprop="datePublished" content="2026-02-10T03:23:16.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="cppgo"/> <meta itemprop="url" content="https://juejin.cn/user/1924620895400932"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä½¿ç”¨bufio Writeræ—¶ï¼Œæ‰‹åŠ¨è°ƒç”¨Flush()çš„å¿…è¦æ€§
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1924620895400932/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    cppgo
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T03:23:16.000Z" title="Tue Feb 10 2026 03:23:16 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
	<span class="hljs-string">"bytes"</span>
	<span class="hljs-string">"bufio"</span>
	<span class="hljs-string">"fmt"</span>
)

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
	buf := &amp;bytes.Buffer{}

	wr := bufio.NewWriter(buf)
	wr.Write([]<span class="hljs-type">byte</span>(<span class="hljs-string">"1234"</span>))

	fmt.Println(<span class="hljs-string">"buf:"</span>, buf.String())
}
</code></pre>
<p>ã€€ã€€å†…å®¹æ²¡æœ‰å†™åˆ°bufï¼š</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">go</span> run iotest.<span class="hljs-keyword">go</span>
buf:
</code></pre>
<p>ã€€ã€€æ·»åŠ Flushï¼š</p>
<pre><code class="hljs language-css" lang="css">package <span class="hljs-selector-tag">main</span>

import (
	"bytes"
	"bufio"
	"fmt"
)

func <span class="hljs-selector-tag">main</span>() {
	buf := &amp;bytes.Buffer{}

	wr := bufio.<span class="hljs-built_in">NewWriter</span>(buf)
	wr.<span class="hljs-built_in">Write</span>([]<span class="hljs-built_in">byte</span>(<span class="hljs-string">"1234"</span>))
	wr.<span class="hljs-built_in">Flush</span>()

	fmt.<span class="hljs-built_in">Println</span>(<span class="hljs-string">"buf:"</span>, buf.<span class="hljs-built_in">String</span>())
}
</code></pre>
<p>ã€€ã€€è¾“å‡ºï¼š</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">go</span> run iotest.<span class="hljs-keyword">go</span>
buf: <span class="hljs-number">1234</span>
</code></pre>
<p>ã€€ã€€æŸ¥çœ‹è¿™å—çš„æºç :</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/afe89e59c9e740e28309d0c0a9830f65~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY3BwZ28=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771298655&amp;x-signature=t9YKQUINaBtq2IHYcO05lbYbtLw%3D" alt="" loading="lazy"/></p>
<p>Â </p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œåªæœ‰åœ¨bufferå†™æ»¡ï¼ˆé»˜è®¤4KBï¼‰åï¼Œæ‰ä¼šä¸»åŠ¨è°ƒFlush()æŠŠbufferå†…å®¹å†™å…¥åº•å±‚ioã€‚æˆ–è€…å†™å…¥çš„æ•°æ®å¾ˆå¤§è¶…è¿‡bufferé•¿åº¦ï¼Œä¼šç›´æ¥å†™å…¥åº•å±‚ioã€‚</p>
<p>æ‰€ä»¥ï¼Œä½¿ç”¨bufio Writeræ—¶ï¼Œåœ¨é€‚å½“ä½ç½®æ‰‹åŠ¨è°ƒç”¨Flush()æ‰æ¯”è¾ƒç¨³å¦¥ã€‚</p>
<p>ã€è¿ç§»ã€‘<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.cnblogs.com%2Fzxq89%2Fp%2F16737371.html" target="_blank" title="https://www.cnblogs.com/zxq89/p/16737371.html" ref="nofollow noopener noreferrer">www.cnblogs.com/zxq89/p/167â€¦</a> posted @Â 2022-09-28 11:19</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[SpringBootä¸­ç»“åˆMySQLã€Redisï¼Œå®ç°å¼‚æ­¥è½åº“çš„è¯„è®ºç‚¹èµ/æ‹‰è¸©åŠŸèƒ½]]></title>    <link>https://juejin.cn/post/7604697194795974666</link>    <guid>https://juejin.cn/post/7604697194795974666</guid>    <pubDate>2026-02-10T03:24:43.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604697194795974666" data-draft-id="7604775190211870730" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="SpringBootä¸­ç»“åˆMySQLã€Redisï¼Œå®ç°å¼‚æ­¥è½åº“çš„è¯„è®ºç‚¹èµ/æ‹‰è¸©åŠŸèƒ½"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2026-02-10T03:24:43.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="PersonalViolet"/> <meta itemprop="url" content="https://juejin.cn/user/502926347091433"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            SpringBootä¸­ç»“åˆMySQLã€Redisï¼Œå®ç°å¼‚æ­¥è½åº“çš„è¯„è®ºç‚¹èµ/æ‹‰è¸©åŠŸèƒ½
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/502926347091433/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    PersonalViolet
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T03:24:43.000Z" title="Tue Feb 10 2026 03:24:43 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»14åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">æ¦‚è¦</h2>
<p>è¯¥æ–¹æ¡ˆæ˜¯ä¸€ä¸ªå…¸å‹çš„<strong>ç”¨ç©ºé—´ï¼ˆRedisç¼“å­˜ï¼‰å’Œå¼‚æ­¥åŒ–æ¢å–æ—¶é—´ï¼ˆå“åº”é€Ÿåº¦ï¼‰å’Œç³»ç»Ÿç¨³å®šæ€§ï¼ˆæ•°æ®åº“æŠ—å‹ï¼‰</strong> çš„æ¶æ„è®¾è®¡ã€‚å®ƒéå¸¸é€‚åˆç‚¹èµè¿™ç±»<strong>å†™å¤šè¯»å¤šã€å¯¹å®æ—¶ä¸€è‡´æ€§è¦æ±‚ç¨ä½</strong>çš„ä¸šåŠ¡åœºæ™¯ã€‚</p>
<h2 data-id="heading-1">å‰è¨€</h2>
<p>å­¦ä¹ javaè¿‡ç¨‹ä¸­çš„å¿ƒå¾—ï¼Œå¦‚æœ‰é”™è¯¯è¯·æé†’ä½œè€…çº æ­£ï¼Œæ„Ÿè°¢ä¸å°½ï¼ï¼ï¼</p>
<p>å¦‚æœæœ‰æ›´å¥½çš„å®ç°ï¼Œæ¬¢è¿åˆ†äº«ï¼ï¼ï¼</p>
<h3 data-id="heading-2">å½“å‰å®ç°ä¼˜ç‚¹</h3>
<ol>
<li>
<p><strong>é«˜æ€§èƒ½ä¸ä½å»¶è¿Ÿ</strong>ï¼š</p>
<ul>
<li><strong>å†™æ“ä½œå¿«</strong>ï¼šç”¨æˆ·ç‚¹èµ/æ‹‰è¸©è¯·æ±‚ç›´æ¥æ“ä½œå†…å­˜æ•°æ®åº“Redisï¼Œå“åº”é€Ÿåº¦æå¿«ï¼Œç”¨æˆ·ä½“éªŒå¥½ã€‚</li>
<li><strong>æ•°æ®åº“åœ¨å®šæ—¶ä»»åŠ¡è§¦å‘å‰å‹åŠ›å°</strong>ï¼šé«˜é¢‘çš„å†™æ“ä½œè¢«Redisæ‰¿æ¥ï¼Œé¿å…äº†ç›´æ¥å†²å‡»MySQL</li>
</ul>
</li>
<li>
<p><strong>æ•°æ®ä¸€è‡´æ€§ä¿éšœ</strong>ï¼š</p>
<ul>
<li><strong>åŸå­æ€§æ“ä½œ</strong>ï¼šä½¿ç”¨<strong>Luaè„šæœ¬</strong>åœ¨Rediså†…å®ŒæˆçŠ¶æ€åˆ‡æ¢ï¼ˆç‚¹èµ-&gt;æ‹‰è¸©-&gt;æ— çŠ¶æ€ï¼‰ï¼Œä¿è¯äº†â€œä¸€ä¸ªè¯„è®ºåŒä¸€æ—¶åˆ»åªèƒ½æœ‰ä¸€ç§çŠ¶æ€â€çš„ä¸šåŠ¡é€»è¾‘çš„åŸå­æ€§ï¼Œé˜²æ­¢å¹¶å‘è¯·æ±‚å¯¼è‡´çš„æ•°æ®é”™ä¹±ã€‚</li>
<li><strong>åˆ†å¸ƒå¼é”</strong>ï¼šå¯¹å•ä¸ªç”¨æˆ·çš„æ“ä½œåŠ é”ï¼ˆ<code>RLock</code>ï¼‰ï¼Œé˜²æ­¢åŒä¸€ç”¨æˆ·æçŸ­æ—¶é—´å†…çš„é‡å¤æäº¤é€ æˆç¼“å­˜æ•°æ®é—®é¢˜ã€‚</li>
</ul>
</li>
<li>
<p><strong>æ‰¹é‡å¤„ç†æ•ˆç‡é«˜</strong>ï¼š</p>
<ul>
<li><strong>å¼‚æ­¥è½åº“</strong>ï¼šå®šæ—¶ä»»åŠ¡å°†ç¼“å­˜ä¸­çš„å¤§é‡å˜æ›´é›†ä¸­èµ·æ¥ï¼Œé€šè¿‡<strong>æ‰¹é‡æ’å…¥/æ›´æ–°</strong>ï¼ˆ<code>ON DUPLICATE KEY UPDATE</code>ï¼‰å’Œ<strong>æ‰¹é‡æ›´æ–°ç»Ÿè®¡</strong>ï¼ˆ<code>CASE WHEN</code>ï¼‰çš„æ–¹å¼ä¸æ•°æ®åº“äº¤äº’ï¼Œæå¤§åœ°å‡å°‘äº†ç½‘ç»œI/Oå’ŒSQLæ‰§è¡Œæ¬¡æ•°ï¼Œæ•°æ®åº“å¤„ç†æ•ˆç‡é«˜ã€‚</li>
</ul>
</li>
</ol>
<h3 data-id="heading-3"><strong>å½“å‰å®ç°å­˜åœ¨é—®é¢˜</strong></h3>
<ol>
<li>
<p>å®šæ—¶ä»»åŠ¡å¼•å‘çš„æ•°æ®åº“å³°å€¼ï¼š</p>
<ol>
<li><strong>å¯é€šè¿‡ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—å‰Šå³°å¡«è°·</strong></li>
<li><strong>å°†å®šæ—¶ä»»åŠ¡ä»å¤„ç†å…¨éƒ¨æ•°æ®æ”¹ä¸ºå¤„ç†éƒ¨åˆ†æ•°æ®ï¼Œå®šæ—¶ä»»åŠ¡çš„å‘¨æœŸè°ƒä½</strong></li>
</ol>
</li>
</ol>
<h2 data-id="heading-4">ä¸»è¦å®ç°ç»†èŠ‚</h2>
<p>Redis + Redisåˆ†å¸ƒå¼é” + åŸå­æ“ä½œ + å¼‚æ­¥è½åº“ + SpringBootå®šæ—¶ä»»åŠ¡</p>
<h2 data-id="heading-5">æµç¨‹å›¾</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2dab1bc3269c407dac3ef72a7a66f5f6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUGVyc29uYWxWaW9sZXQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771298683&amp;x-signature=A4FfvkVAxdaVUCby1PfCawMtG9c%3D" alt="ç‚¹èµæ‹‰è¸©æ— çŠ¶æ€æ–¹æ¡ˆ2.png" loading="lazy"/></p>
<h2 data-id="heading-6">è¯·æ±‚æ–¹æ³•è®¾è®¡</h2>
<p><strong>è¯·æ±‚URL</strong>ï¼š<code>/api/article/v1/{commentId}/vote</code></p>
<p><strong>è¯·æ±‚æ–¹æ³•</strong>ï¼šPUT</p>
<p><strong>è¯·æ±‚å‚æ•°</strong>ï¼štype(Integer);(type=0è¡¨ç¤ºä¿®æ”¹æˆæ— çŠ¶æ€ï¼Œtype=1è¡¨ç¤ºä¿®æ”¹æˆç‚¹èµçŠ¶æ€ï¼Œtype=-1è¡¨ç¤ºä¿®æ”¹æˆæ‹‰è¸©çŠ¶æ€)</p>
<p><strong>URLç¤ºä¾‹</strong>ï¼š/api/article/v1/{commentId}/vote?type = 1</p>
<h2 data-id="heading-7">Redisè¡¨è®¾è®¡</h2>
<p>ä¸‹è¿°ä¸‰è¡¨éƒ½ç”¨æ¥è®°å½•ç”¨æˆ·å¯¹è¯„è®ºçš„çŠ¶æ€(ç‚¹èµã€æ‹‰è¸©ã€æ— çŠ¶æ€)</p>
<h3 data-id="heading-8">articles:comments:likes:users:{userId}</h3>
<p>{userId}ä¸ºåŠ¨æ€é”®å</p>
<p><strong>Redis Set</strong>æ•°æ®ç»“æ„ï¼›</p>
<p>å­˜å‚¨çš„å€¼ï¼š{commentId}</p>
<h3 data-id="heading-9">articles:comments:dislikes:users:{userId}</h3>
<p>{userId}ä¸ºåŠ¨æ€é”®å</p>
<p><strong>Redis Set</strong>æ•°æ®ç»“æ„ï¼›</p>
<p>å­˜å‚¨çš„å€¼ï¼š{commentId}</p>
<h3 data-id="heading-10">articles:comments:stateless:users:{userId}</h3>
<p>{userId}ä¸ºåŠ¨æ€é”®å</p>
<p><strong>Redis Set</strong>æ•°æ®ç»“æ„ï¼›</p>
<p>å­˜å‚¨çš„å€¼ï¼š{commentId}</p>
<h2 data-id="heading-11">MySQLè¡¨è®¾è®¡</h2>
<p>è¯¥åšå®¢èšç„¦å®ç°ç‚¹èµ/æ‹‰è¸©åŠŸèƒ½ï¼Œæ¶‰åŠx_article_commentsè¡¨ä¸å¤šï¼Œæ•…ä¸åšx_article_commentsè¡¨çš„å­—æ®µä»‹ç»</p>
<ul>
<li>
<p>x_article_comments_votes</p>
<ul>
<li>è”åˆä¸»é”®(comment_id, user_id)</li>
<li>voteå­—æ®µè¡¨ç”¨æˆ·å¯¹è¯„è®ºçš„çŠ¶æ€ï¼Œ1ä»£è¡¨ç‚¹èµï¼Œ-1ä»£è¡¨æ‹‰è¸©ï¼Œ0ä»£è¡¨æ— çŠ¶æ€ï¼Œå³ä¸å¤„äºç‚¹èµçŠ¶æ€æˆ–æ‹‰è¸©çŠ¶æ€</li>
</ul>
</li>
</ul>

<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- æ–‡ç« è¯„è®ºè¡¨</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> x_article_comments (
  id <span class="hljs-type">BIGINT</span> AUTO_INCREMENT <span class="hljs-keyword">PRIMARY</span> KEY,
  article_id <span class="hljs-type">BIGINT</span> UNSIGNED <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>, Â  Â  Â  Â  Â  Â <span class="hljs-comment">-- å…³è”çš„æ–‡ç« </span>
  parent_id <span class="hljs-type">BIGINT</span> UNSIGNED <span class="hljs-keyword">NULL</span>, Â  Â  Â  Â  Â  Â  Â  <span class="hljs-comment">-- NULL è¡¨ç¤ºé¡¶çº§è¯„è®ºï¼›å¦åˆ™æ˜¯å›å¤</span>
  root_id <span class="hljs-type">BIGINT</span> UNSIGNED <span class="hljs-keyword">NULL</span>, Â  Â  Â  Â  Â  Â  Â  Â  <span class="hljs-comment">-- åŒä¸€Threadçš„Rootè¯„è®º idï¼ˆä¾¿äºæŸ¥è¯¢æ•´ä¸ªThreadï¼‰</span>
  user_id <span class="hljs-type">BIGINT</span> UNSIGNED <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>, Â  Â  Â  Â  Â  Â  <span class="hljs-comment">-- è¯„è®ºä½œè€…</span>
  content TEXT <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
 Â status TINYINT <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">1</span>, Â  Â  Â  Â  Â  Â <span class="hljs-comment">-- 1=æ˜¾ç¤º,0=å·²åˆ é™¤/éšè—,2=å¾…å®¡æ ¸ ç­‰</span>
  like_count <span class="hljs-type">INT</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span>,
  dislike_count <span class="hljs-type">INT</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span>,
  reply_count <span class="hljs-type">INT</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span>, <span class="hljs-comment">-- è¯¥å±‚å­©å­çš„æ•°é‡</span>
  reply_descendant_count <span class="hljs-type">INT</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span>, <span class="hljs-comment">-- è¯¥å±‚åä»£çš„æ•°é‡</span>
  version <span class="hljs-type">INT</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span>, Â  Â  Â  Â  Â  Â  Â  <span class="hljs-comment">-- ä¹è§‚é”ï¼ˆæ›´æ–°æ—¶æ ¡éªŒï¼‰</span>
  create_time DATETIME <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>,
  update_time DATETIME <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> <span class="hljs-keyword">ON</span> <span class="hljs-keyword">UPDATE</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>,
â€‹
 Â <span class="hljs-keyword">PRIMARY</span> KEY (id)
) ENGINE<span class="hljs-operator">=</span>InnoDB
 Â <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8mb4
 Â <span class="hljs-keyword">COLLATE</span><span class="hljs-operator">=</span>utf8mb4_unicode_ci;
â€‹
<span class="hljs-comment">-- ç‚¹èµ/è¸©è¡¨ï¼ˆæ¯ä¸ªç”¨æˆ·å¯¹æŸæ¡è¯„è®ºçš„åŠ¨ä½œï¼‰</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> x_article_comments_votes (
  comment_id <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  user_id <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  vote TINYINT <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>, <span class="hljs-comment">-- 1=like, -1=dislike, 0=none</span>
  create_time DATETIME <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>,
  update_time DATETIME <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> <span class="hljs-keyword">ON</span> <span class="hljs-keyword">UPDATE</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>,
 Â <span class="hljs-keyword">PRIMARY</span> KEY (comment_id, user_id)
) ENGINE<span class="hljs-operator">=</span>InnoDB
 Â <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8mb4
 Â <span class="hljs-keyword">COLLATE</span><span class="hljs-operator">=</span>utf8mb4_unicode_ci;
</code></pre>
<h2 data-id="heading-12">åç«¯å®ç°ç»†èŠ‚</h2>
<h3 data-id="heading-13">å¤„ç†ç”¨æˆ·å‘èµ·çš„ç‚¹èµ/æ‹‰è¸©/æ— çŠ¶æ€è¯·æ±‚</h3>
<h4 data-id="heading-14">Controllerå±‚</h4>
<h5 data-id="heading-15">æ ¡éªŒå‚æ•°</h5>
<p>å…ˆæ ¡éªŒå½“å‰ç”¨æˆ·æ˜¯å¦ç™»å½•ï¼ŒuserReadApi.getCurrentUserId()æ˜¯æˆ‘å°è£…å¥½çš„æ–¹æ³•ï¼Œç”¨äºè·å–å‘èµ·å½“å‰è¯·æ±‚çš„ç”¨æˆ·ID</p>
<pre><code class="hljs language-ini" lang="ini"> Â  Â  Â  Â // è·å–å½“å‰ç”¨æˆ·ID
 Â  Â  Â  Â Long <span class="hljs-attr">userId</span> = userReadApi.getCurrentUserId()<span class="hljs-comment">;</span>
 Â  Â  Â  Â if (<span class="hljs-attr">userId</span> == null) {
 Â  Â  Â  Â  Â  Â return AjaxResult.error(HttpStatus.UNAUTHORIZED, "ç”¨æˆ·æœªç™»å½•æˆ–è·å–ç”¨æˆ·IDå¤±è´¥")<span class="hljs-comment">;</span>
 Â  Â  Â   }
</code></pre>
<h5 data-id="heading-16">å®Œæ•´ä»£ç </h5>
<pre><code class="hljs language-less" lang="less"> Â  Â <span class="hljs-comment">/**
 Â  Â  * ç‚¹èµ/æ‹‰è¸©/æ— çŠ¶æ€è¯„è®º
 Â  Â  */</span>
 Â  Â <span class="hljs-variable">@PutMapping</span>(<span class="hljs-string">"/{commentId}/vote"</span>)
 Â  Â public AjaxResult <span class="hljs-built_in">voteComment</span>(
 Â  Â  Â  Â  Â  Â <span class="hljs-variable">@PathVariable</span>(<span class="hljs-string">"commentId"</span>) Long commentId,
 Â  Â  Â  Â  Â  Â <span class="hljs-variable">@RequestParam</span>(<span class="hljs-string">"type"</span>) Integer type
 Â   ) {
 Â  Â  Â  Â <span class="hljs-selector-tag">log</span><span class="hljs-selector-class">.info</span>(<span class="hljs-string">"è¿›å…¥è¯·æ±‚ /api/article/v1/{}/vote -&gt; ç‚¹èµ/å–æ¶ˆç‚¹èµè¯„è®º type={}"</span>, commentId, type);
â€‹
 Â  Â  Â  Â <span class="hljs-comment">// è·å–å½“å‰ç”¨æˆ·ID</span>
 Â  Â  Â  Â <span class="hljs-selector-tag">Long</span> <span class="hljs-selector-tag">userId</span> = <span class="hljs-selector-tag">userReadApi</span><span class="hljs-selector-class">.getCurrentUserId</span>();
 Â  Â  Â  Â <span class="hljs-selector-tag">if</span> (userId == null) {
 Â  Â  Â  Â  Â  Â <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">AjaxResult</span><span class="hljs-selector-class">.error</span>(HttpStatus.UNAUTHORIZED, <span class="hljs-string">"ç”¨æˆ·æœªç™»å½•æˆ–è·å–ç”¨æˆ·IDå¤±è´¥"</span>);
 Â  Â  Â   }
â€‹
â€‹
 Â  Â  Â  Â <span class="hljs-selector-tag">articleService</span><span class="hljs-selector-class">.voteComment</span>(userId, commentId, type);
â€‹
 Â  Â  Â  Â <span class="hljs-selector-tag">log</span><span class="hljs-selector-class">.info</span>(<span class="hljs-string">"è¿”å›ç»“æœ /api/article/v1/{}/vote -&gt; OK"</span>, commentId);
 Â  Â  Â  Â <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">AjaxResult</span><span class="hljs-selector-class">.success</span>();
 Â   }
</code></pre>
<h4 data-id="heading-17">Serviceå±‚</h4>
<h5 data-id="heading-18">æ ¡éªŒå‚æ•°</h5>
<pre><code class="hljs language-typescript" lang="typescript"> Â  Â  Â  Â <span class="hljs-comment">// 1. å‚æ•°æ ¡éªŒ</span>
 Â  Â  Â  Â <span class="hljs-keyword">if</span> (commentId == <span class="hljs-literal">null</span> || <span class="hljs-keyword">type</span> == <span class="hljs-literal">null</span>) {
 Â  Â  Â  Â  Â  Â <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClientException</span>(<span class="hljs-title class_">HttpStatus</span>.<span class="hljs-property">BAD_REQUEST</span>, <span class="hljs-string">"å‚æ•°ä¸å®Œæ•´"</span>);
 Â  Â  Â   }
 Â  Â  Â  Â <span class="hljs-keyword">if</span> (<span class="hljs-keyword">type</span> != <span class="hljs-title class_">ArticleCommentVoteConstants</span>.<span class="hljs-property">LIKE</span> &amp;&amp; <span class="hljs-keyword">type</span> != <span class="hljs-title class_">ArticleCommentVoteConstants</span>.<span class="hljs-property">DISLIKE</span> &amp;&amp; <span class="hljs-keyword">type</span> != <span class="hljs-title class_">ArticleCommentVoteConstants</span>.<span class="hljs-property">STATELESS</span>) {
 Â  Â  Â  Â  Â  Â <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClientException</span>(<span class="hljs-title class_">HttpStatus</span>.<span class="hljs-property">BAD_REQUEST</span>, <span class="hljs-string">"æŠ•ç¥¨ç±»å‹éæ³•"</span>);
 Â  Â  Â   }
â€‹
 Â  Â  Â  Â <span class="hljs-comment">// 2. æ ¡éªŒè¯„è®ºæ˜¯å¦å­˜åœ¨</span>
 Â  Â  Â  Â <span class="hljs-title class_">ArticleComment</span> comment = articleCommentMapper.<span class="hljs-title function_">selectArticleCommentById</span>(commentId);
 Â  Â  Â  Â <span class="hljs-keyword">if</span> (comment == <span class="hljs-literal">null</span>) {
 Â  Â  Â  Â  Â  Â <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClientException</span>(<span class="hljs-title class_">HttpStatus</span>.<span class="hljs-property">NOT_FOUND</span>, <span class="hljs-string">"è¯„è®ºä¸å­˜åœ¨"</span>);
 Â  Â  Â   }
</code></pre>
<h5 data-id="heading-19">åˆ†å¸ƒå¼é” + luaè„šæœ¬</h5>
<p>ä½¿ç”¨äº†redissonå®ç°åŠ é”ï¼Œå¹¶ä½¿ç”¨äº†luaè„šæœ¬ä¿è¯åŸå­æ€§ï¼Œä»è€Œé˜²æ­¢ç”¨æˆ·é¢‘ç¹å‘èµ·è¯·æ±‚å¯¼è‡´åœ¨redisç¼“å­˜çš„æ•°æ®å‡ºç°é”™è¯¯çš„æƒ…å†µ</p>
<h6 data-id="heading-20"><strong>åˆ†å¸ƒå¼é”ç›¸å…³ä»£ç </strong></h6>
<pre><code class="hljs language-csharp" lang="csharp"> Â  Â  Â  Â <span class="hljs-comment">// 5. å°è¯•è·å–åˆ†å¸ƒå¼é”</span>
 Â  Â  Â  Â RLock <span class="hljs-keyword">lock</span> = redisson.getLock(RedisKeyConstants.ARTICLES_COMMENTS_VOTES_LOCK_KEY + userId);
 Â  Â  Â  Â boolean isLocked = <span class="hljs-literal">false</span>;
 Â  Â  Â  Â <span class="hljs-keyword">try</span> {
 Â  Â  Â  Â  Â  Â isLocked = <span class="hljs-keyword">lock</span>.tryLock(<span class="hljs-number">0</span>, RedisKeyConstants.ARTICLES_COMMENTS_VOTES_LOCK_KEY_EXPIRE_TIME, TimeUnit.SECONDS);
 Â  Â  Â  Â  Â  Â <span class="hljs-keyword">if</span> (!isLocked) {
 Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ClientException(HttpStatus.SERVICE_UNAVAILABLE, <span class="hljs-string">"ç³»ç»Ÿç¹å¿™ï¼Œè¯·ç¨åå†è¯•"</span>);
 Â  Â  Â  Â  Â   } <span class="hljs-keyword">else</span> {
 Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-comment">// è·å–åˆ°é”ï¼Œæ‰§è¡ŒæŠ•ç¥¨é€»è¾‘ï¼Œæ­¤å¤„çœç•¥</span>
 Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-comment">// ...</span>
 Â  Â  Â  Â  Â   }
 Â  Â  Â   } <span class="hljs-keyword">catch</span> (InterruptedException e) {
 Â  Â  Â  Â  Â  Â Thread.currentThread().interrupt();
 Â  Â  Â  Â  Â  Â <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ClientException(HttpStatus.ERROR, <span class="hljs-string">"ç³»ç»Ÿç¹å¿™ï¼Œè¯·ç¨åå†è¯•"</span>);
 Â  Â  Â   } <span class="hljs-keyword">finally</span> {
 Â  Â  Â  Â  Â  Â <span class="hljs-keyword">if</span> (isLocked &amp;&amp; <span class="hljs-keyword">lock</span>.isHeldByCurrentThread()) {
 Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-keyword">lock</span>.unlock();
 Â  Â  Â  Â  Â  Â  Â  Â log.info(<span class="hljs-string">"ç”¨æˆ· {} çš„é”å·²é‡Šæ”¾"</span>, userId);
 Â  Â  Â  Â  Â   }
 Â  Â  Â   }
</code></pre>
<h6 data-id="heading-21">luaè„šæœ¬ç›¸å…³ä»£ç </h6>
<p><strong>é¢„å…ˆå‡†å¤‡å¥½redisé”®å’Œluaè„šæœ¬</strong></p>
<pre><code class="hljs language-ini" lang="ini"> Â  Â  Â  Â // 3. æ„å»º Redis é”®
 Â  Â  Â  Â String <span class="hljs-attr">likeKey</span> = RedisKeyConstants.ARTICLES_COMMENTS_LIKES_USERS_KEY + userId<span class="hljs-comment">;</span>
 Â  Â  Â  Â String <span class="hljs-attr">dislikeKey</span> = RedisKeyConstants.ARTICLES_COMMENTS_DISLIKES_USERS_KEY + userId<span class="hljs-comment">;</span>
 Â  Â  Â  Â String <span class="hljs-attr">statelessKey</span> = RedisKeyConstants.ARTICLES_COMMENTS_STATELESS_USERS_KEY + userId<span class="hljs-comment">;</span>
 Â  Â  Â  Â // 4. æ ¹æ®æŠ•ç¥¨ç±»å‹å¤„ç†é€»è¾‘
 Â  Â  Â  Â DefaultRedisScript&lt;Long&gt; <span class="hljs-attr">deleteScript</span> = new DefaultRedisScript&lt;&gt;()<span class="hljs-comment">;</span>
 Â  Â  Â  Â deleteScript.setScriptSource(new ResourceScriptSource(new ClassPathResource(RedisLuaConstants.ARTICLE_COMMENTS_VOTE_LUA_SCRIPT_PATH)))<span class="hljs-comment">;</span>
 Â  Â  Â  Â deleteScript.setResultType(Long.class)<span class="hljs-comment">;</span>
 Â  Â  Â  Â Long <span class="hljs-attr">execute</span> = null<span class="hljs-comment">;</span>
</code></pre>
<p><strong>luaè„šæœ¬æ–‡ä»¶</strong></p>
<p>luaè„šæœ¬èƒ½å¤Ÿ<strong>ä¿è¯åŸå­æ€§</strong>ï¼Œè‹¥ç”¨æˆ·é¢‘ç¹å‘èµ·è¯·æ±‚ä¹Ÿèƒ½ä¿è¯<strong>ä»¥ä¸‹çš„è¦æ±‚</strong></p>
<p>ä¸‰ä¸ªé”®å¯¹åº”çš„seté›†åˆé‡Œçš„å€¼åº”<strong>ä¿æŒäº’æ–¥</strong>ï¼Œåªå…è®¸ä¸€ä¸ªå€¼å¦‚3åªèƒ½å‡ºç°åœ¨ä¸€ä¸ªé”®ï¼Œä¾‹å¦‚ï¼šå…±æœ‰ä¸‰ä¸ªé”®like:{userId}ã€dislike:{userId}ã€stateless:{userId}ï¼Œé”®likeç°åœ¨æŒæœ‰3ï¼Œç”¨æˆ·å¯¹commentId = 3å‘èµ·äº†ç‚¹èµ/æ‹‰è¸©/æ— çŠ¶æ€è¯·æ±‚ï¼Œä¿®æ”¹ä¸ºæ‹‰è¸©ï¼Œæ­¤æ—¶è¦å»é™¤like:{userId}é”®å’Œstateless:{userId}é”®çš„seté›†åˆä¸­å€¼ä¸º3çš„å…ƒç´ ï¼Œæ‰§è¡Œå®Œååªæœ‰é”®dislike:{userId}å­˜åœ¨å€¼3</p>
<pre><code class="hljs language-lua" lang="lua"><span class="hljs-comment">-- Lua è„šæœ¬ï¼šå¤„ç†è¯„è®ºæŠ•ç¥¨é€»è¾‘</span>
<span class="hljs-keyword">local</span> mainKey = KEYS[<span class="hljs-number">1</span>] Â  Â  Â  <span class="hljs-comment">-- è¿›è¡Œaddçš„é”®</span>
<span class="hljs-keyword">local</span> srem1Key = KEYS[<span class="hljs-number">2</span>] Â  Â <span class="hljs-comment">-- è¿›è¡Œsremçš„é”®</span>
<span class="hljs-keyword">local</span> srem2Key = KEYS[<span class="hljs-number">3</span>] Â <span class="hljs-comment">-- è¿›è¡Œsremçš„é”®</span>
<span class="hljs-keyword">local</span> commentId = ARGV[<span class="hljs-number">1</span>] Â  Â  <span class="hljs-comment">-- è¯„è®º ID</span>
â€‹
<span class="hljs-comment">-- æ·»åŠ åˆ°mainé›†åˆ</span>
redis.call(<span class="hljs-string">'SADD'</span>, mainKey, commentId)
â€‹
<span class="hljs-comment">-- ä»ä¸¤ä¸ªé›†åˆä¸­ç§»é™¤</span>
redis.call(<span class="hljs-string">'SREM'</span>, srem1Key, commentId)
redis.call(<span class="hljs-string">'SREM'</span>, srem2Key, commentId)
â€‹
<span class="hljs-comment">-- è¿”å›æ“ä½œç»“æœï¼ˆå¯é€‰ï¼‰</span>
<span class="hljs-keyword">return</span> <span class="hljs-number">1</span> Â <span class="hljs-comment">-- è¡¨ç¤ºæˆåŠŸæ‰§è¡Œ</span>
â€‹
</code></pre>
<p><strong>è·å–åˆ°é”åï¼Œä¸ºå®ç°å­˜è¿›redisï¼Œæ‰§è¡Œçš„æ“ä½œå¦‚ä¸‹</strong></p>
<pre><code class="hljs language-vbscript" lang="vbscript"> Â  Â  Â  Â  Â  Â  Â  Â switch (type) {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-keyword">case</span> ArticleCommentVoteConstants.LIKE:
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â // <span class="hljs-number">4.</span> å¤„ç†ç‚¹èµé€»è¾‘
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-keyword">execute</span> = stringRedisTemplate.<span class="hljs-keyword">execute</span>(deleteScript, Arrays.asList(likeKey, dislikeKey, statelessKey), commentId.<span class="hljs-keyword">to</span><span class="hljs-built_in">String</span>());
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-keyword">if</span> (<span class="hljs-keyword">execute</span> == <span class="hljs-literal">null</span>) {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â throw <span class="hljs-keyword">new</span> ClientException(HttpStatus.SERVICE_UNAVAILABLE, <span class="hljs-string">"å¤„ç†ç‚¹è¸©é€»è¾‘å¤±è´¥"</span>);
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â   }
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â break;
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-keyword">case</span> ArticleCommentVoteConstants.DISLIKE:
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â // <span class="hljs-number">5.</span> å¤„ç†ç‚¹è¸©é€»è¾‘
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-keyword">execute</span> = stringRedisTemplate.<span class="hljs-keyword">execute</span>(deleteScript, Arrays.asList(dislikeKey, likeKey, statelessKey), commentId.<span class="hljs-keyword">to</span><span class="hljs-built_in">String</span>());
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-keyword">if</span> (<span class="hljs-keyword">execute</span> == <span class="hljs-literal">null</span>) {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â throw <span class="hljs-keyword">new</span> ClientException(HttpStatus.SERVICE_UNAVAILABLE, <span class="hljs-string">"å¤„ç†ç‚¹è¸©é€»è¾‘å¤±è´¥"</span>);
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â   }
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â break;
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-keyword">case</span> ArticleCommentVoteConstants.STATELESS:
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-keyword">execute</span> = stringRedisTemplate.<span class="hljs-keyword">execute</span>(deleteScript, Arrays.asList(statelessKey, dislikeKey, likeKey), commentId.<span class="hljs-keyword">to</span><span class="hljs-built_in">String</span>());
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-keyword">if</span> (<span class="hljs-keyword">execute</span> == <span class="hljs-literal">null</span>) {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â throw <span class="hljs-keyword">new</span> ClientException(HttpStatus.<span class="hljs-keyword">ERROR</span>, <span class="hljs-string">"å¤„ç†æ— çŠ¶æ€é€»è¾‘å¤±è´¥"</span>);
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â   }
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â break;
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-keyword">default</span>:
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â throw <span class="hljs-keyword">new</span> ClientException(HttpStatus.BAD_REQUEST, <span class="hljs-string">"æœªçŸ¥çš„æŠ•ç¥¨ç±»å‹"</span>);
 Â  Â  Â  Â  Â  Â  Â   }
</code></pre>
<h5 data-id="heading-22">å®Œæ•´ä»£ç </h5>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">voteComment</span><span class="hljs-params">(Long userId, Long commentId, Integer type)</span> {
        <span class="hljs-comment">// 1. å‚æ•°æ ¡éªŒ</span>
        <span class="hljs-keyword">if</span> (commentId == <span class="hljs-literal">null</span> || type == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClientException</span>(HttpStatus.BAD_REQUEST, <span class="hljs-string">"å‚æ•°ä¸å®Œæ•´"</span>);
        }
        <span class="hljs-keyword">if</span> (type != ArticleCommentVoteConstants.LIKE &amp;&amp; type != ArticleCommentVoteConstants.DISLIKE &amp;&amp; type != ArticleCommentVoteConstants.STATELESS) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClientException</span>(HttpStatus.BAD_REQUEST, <span class="hljs-string">"æŠ•ç¥¨ç±»å‹éæ³•"</span>);
        }

        <span class="hljs-comment">// 2. æ ¡éªŒè¯„è®ºæ˜¯å¦å­˜åœ¨</span>
        <span class="hljs-type">ArticleComment</span> <span class="hljs-variable">comment</span> <span class="hljs-operator">=</span> articleCommentMapper.selectArticleCommentById(commentId);
        <span class="hljs-keyword">if</span> (comment == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClientException</span>(HttpStatus.NOT_FOUND, <span class="hljs-string">"è¯„è®ºä¸å­˜åœ¨"</span>);
        }

        <span class="hljs-comment">// 3. æ„å»º Redis é”®</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">likeKey</span> <span class="hljs-operator">=</span> RedisKeyConstants.ARTICLES_COMMENTS_LIKES_USERS_KEY + userId;
        <span class="hljs-type">String</span> <span class="hljs-variable">dislikeKey</span> <span class="hljs-operator">=</span> RedisKeyConstants.ARTICLES_COMMENTS_DISLIKES_USERS_KEY + userId;
        <span class="hljs-type">String</span> <span class="hljs-variable">statelessKey</span> <span class="hljs-operator">=</span> RedisKeyConstants.ARTICLES_COMMENTS_STATELESS_USERS_KEY + userId;
        <span class="hljs-comment">// 4. æ ¹æ®æŠ•ç¥¨ç±»å‹å¤„ç†é€»è¾‘</span>
        DefaultRedisScript&lt;Long&gt; deleteScript = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultRedisScript</span>&lt;&gt;();
        deleteScript.setScriptSource(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ResourceScriptSource</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ClassPathResource</span>(RedisLuaConstants.ARTICLE_COMMENTS_VOTE_LUA_SCRIPT_PATH)));
        deleteScript.setResultType(Long.class);
        <span class="hljs-type">Long</span> <span class="hljs-variable">execute</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;
        <span class="hljs-comment">// 5. å°è¯•è·å–åˆ†å¸ƒå¼é”</span>
        <span class="hljs-type">RLock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> redisson.getLock(RedisKeyConstants.ARTICLES_COMMENTS_VOTES_LOCK_KEY + userId);
        <span class="hljs-type">boolean</span> <span class="hljs-variable">isLocked</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">try</span> {
            isLocked = lock.tryLock(<span class="hljs-number">0</span>, RedisKeyConstants.ARTICLES_COMMENTS_VOTES_LOCK_KEY_EXPIRE_TIME, TimeUnit.SECONDS);
            <span class="hljs-keyword">if</span> (!isLocked) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClientException</span>(HttpStatus.SERVICE_UNAVAILABLE, <span class="hljs-string">"ç³»ç»Ÿç¹å¿™ï¼Œè¯·ç¨åå†è¯•"</span>);
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-comment">// è·å–åˆ°é”ï¼Œæ‰§è¡ŒæŠ•ç¥¨é€»è¾‘</span>
                <span class="hljs-keyword">switch</span> (type) {
                    <span class="hljs-keyword">case</span> ArticleCommentVoteConstants.LIKE:
                        <span class="hljs-comment">// 4. å¤„ç†ç‚¹èµé€»è¾‘</span>
                        execute = stringRedisTemplate.execute(deleteScript, Arrays.asList(likeKey, dislikeKey, statelessKey), commentId.toString());
                        <span class="hljs-keyword">if</span> (execute == <span class="hljs-literal">null</span>) {
                            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClientException</span>(HttpStatus.SERVICE_UNAVAILABLE, <span class="hljs-string">"å¤„ç†ç‚¹è¸©é€»è¾‘å¤±è´¥"</span>);
                        }
                        <span class="hljs-keyword">break</span>;
                    <span class="hljs-keyword">case</span> ArticleCommentVoteConstants.DISLIKE:
                        <span class="hljs-comment">// 5. å¤„ç†ç‚¹è¸©é€»è¾‘</span>
                        execute = stringRedisTemplate.execute(deleteScript, Arrays.asList(dislikeKey, likeKey, statelessKey), commentId.toString());
                        <span class="hljs-keyword">if</span> (execute == <span class="hljs-literal">null</span>) {
                            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClientException</span>(HttpStatus.SERVICE_UNAVAILABLE, <span class="hljs-string">"å¤„ç†ç‚¹è¸©é€»è¾‘å¤±è´¥"</span>);
                        }
                        <span class="hljs-keyword">break</span>;
                    <span class="hljs-keyword">case</span> ArticleCommentVoteConstants.STATELESS:
                        execute = stringRedisTemplate.execute(deleteScript, Arrays.asList(statelessKey, dislikeKey, likeKey), commentId.toString());
                        <span class="hljs-keyword">if</span> (execute == <span class="hljs-literal">null</span>) {
                            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClientException</span>(HttpStatus.ERROR, <span class="hljs-string">"å¤„ç†æ— çŠ¶æ€é€»è¾‘å¤±è´¥"</span>);
                        }
                        <span class="hljs-keyword">break</span>;
                    <span class="hljs-keyword">default</span>:
                        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClientException</span>(HttpStatus.BAD_REQUEST, <span class="hljs-string">"æœªçŸ¥çš„æŠ•ç¥¨ç±»å‹"</span>);
                }
            }
        } <span class="hljs-keyword">catch</span> (InterruptedException e) {
            Thread.currentThread().interrupt();
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClientException</span>(HttpStatus.ERROR, <span class="hljs-string">"ç³»ç»Ÿç¹å¿™ï¼Œè¯·ç¨åå†è¯•"</span>);
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (isLocked &amp;&amp; lock.isHeldByCurrentThread()) {
                lock.unlock();
                log.info(<span class="hljs-string">"ç”¨æˆ· {} çš„é”å·²é‡Šæ”¾"</span>, userId);
            }
        }
    }
</code></pre>
<h3 data-id="heading-23">å®šæ—¶ä»»åŠ¡</h3>
<p>å®šæ—¶ä»»åŠ¡è¦å®ç°è½åº“åˆ°MySQLä¸­ï¼Œå¹¶ä¸”æ¸…ç©ºrediså¯¹åº”çš„ç¼“å­˜</p>
<h4 data-id="heading-24">åˆ›å»ºå®šæ—¶ä»»åŠ¡</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Component</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">VoteSyncScheduler</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ArticleService articleService;
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">VoteSyncScheduler</span><span class="hljs-params">(ArticleService articleService)</span> {
        <span class="hljs-built_in">this</span>.articleService = articleService;
    }

    <span class="hljs-meta">@Scheduled(fixedRate = 5 * 60 * 1000)</span> <span class="hljs-comment">// æ¯äº”åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">syncVote</span><span class="hljs-params">()</span> {
        log.info(<span class="hljs-string">"å¼€å§‹æ‰§è¡Œç‚¹èµåŒæ­¥ä»»åŠ¡..."</span>);
        <span class="hljs-type">Boolean</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> articleService.syncVote();
        log.info(<span class="hljs-string">"ç‚¹èµåŒæ­¥ä»»åŠ¡æ‰§è¡Œå®Œæˆã€‚"</span>);
    }
}
</code></pre>
<h4 data-id="heading-25">syncVoteå®ç°</h4>
<p>MySQLæ¶‰åŠæ“ä½œå¤šå¼ è¡¨ï¼Œæ‰€ä»¥éœ€è¦åœ¨æ–¹æ³•ä¸ŠåŠ ä¸Šæ³¨è§£@Transactional</p>
<p><a href="##%E6%B5%81%E7%A8%8B%E5%9B%BE" title="##%E6%B5%81%E7%A8%8B%E5%9B%BE">å‚è€ƒæµç¨‹å›¾</a></p>
<ol start="0">
<li>æˆ‘ä»¬é¦–å…ˆè¦ä»redisä¸­è·å–æ•°æ®ï¼Œå¹¶å°†æ•°æ®å°è£…åˆ°ä¸¤ä¸ªé›†åˆä¸­ã€‚</li>
<li>è½åº“åˆ°MySQL</li>
<li>æ ¹æ®x_article_comments_votesè¡¨ï¼Œé€šè¿‡SQLè¯­å¥ç»Ÿè®¡å‡ºlike_count, dislike_count</li>
<li>å°†ç»Ÿè®¡å‡ºçš„æ•°æ®æ›´æ–°åˆ°x_article_comments</li>
<li>æ¸…é™¤å·²åœ¨è¯¥å®šæ—¶ä»»åŠ¡å¤„ç†å®Œçš„redisç¼“å­˜æ•°æ®</li>
</ol>
<h5 data-id="heading-26">å˜é‡è¯´æ˜</h5>
<ul>
<li>List votes = new ArrayList&lt;&gt;(); // ä¿å­˜æ‰€æœ‰æŠ•ç¥¨æ•°æ®</li>
<li>Set TotalcommentId = new HashSet&lt;&gt;(); // ä¿å­˜æ‰€æœ‰è¯„è®ºid</li>
<li>likesUserIdToCommentIdsMapã€dislikesUserIdToCommentIdsMapã€statelessUserIdToCommentIdsMapâ€”â€”å­˜å‚¨çš„å€¼ä¸ºç»è¿‡é€»è¾‘åé”®ä¸­å·²è¢«å¤„ç†çš„å€¼ï¼Œåœ¨æœ€åä¸€æ­¥æ¸…é™¤redisç¼“å­˜å‘æŒ¥ä½œç”¨</li>
</ul>
<h5 data-id="heading-27">ä»redisä¸­è·å–æ•°æ®ï¼Œå¹¶å°†æ•°æ®å°è£…åˆ°ä¸¤ä¸ªé›†åˆä¸­</h5>
<pre><code class="hljs language-ini" lang="ini">        Set&lt;String&gt; <span class="hljs-attr">userLikesKeys</span> = stringRedisTemplate.keys(RedisKeyConstants.ARTICLES_COMMENTS_LIKES_USERS_KEY + <span class="hljs-string">"*"</span>)<span class="hljs-comment">;</span>
        Set&lt;String&gt; <span class="hljs-attr">userDislikesKeys</span> = stringRedisTemplate.keys(RedisKeyConstants.ARTICLES_COMMENTS_DISLIKES_USERS_KEY + <span class="hljs-string">"*"</span>)<span class="hljs-comment">;</span>
        Set&lt;String&gt; <span class="hljs-attr">userStatelessKeys</span> = stringRedisTemplate.keys(RedisKeyConstants.ARTICLES_COMMENTS_STATELESS_USERS_KEY + <span class="hljs-string">"*"</span>)<span class="hljs-comment">;</span>
        if (userLikesKeys.isEmpty() &amp;&amp; userDislikesKeys.isEmpty() &amp;&amp; userStatelessKeys.isEmpty()){
            log.info("æ²¡æœ‰éœ€è¦åŒæ­¥çš„æ•°æ®")<span class="hljs-comment">;</span>
            return true<span class="hljs-comment">;</span>
        }
        List&lt;ArticleCommentVote&gt; <span class="hljs-attr">votes</span> = new ArrayList&lt;&gt;()<span class="hljs-comment">;      // ä¿å­˜æ‰€æœ‰æŠ•ç¥¨æ•°æ®</span>
        Set&lt;Long&gt; <span class="hljs-attr">TotalcommentId</span> = new HashSet&lt;&gt;()<span class="hljs-comment">;     // ä¿å­˜æ‰€æœ‰è¯„è®ºid</span>
        Map&lt;Long, Set&lt;String&gt;&gt; <span class="hljs-attr">likesUserIdToCommentIdsMap</span> = new HashMap&lt;&gt;()<span class="hljs-comment">;</span>
        Map&lt;Long, Set&lt;String&gt;&gt; <span class="hljs-attr">dislikesUserIdToCommentIdsMap</span> = new HashMap&lt;&gt;()<span class="hljs-comment">;</span>
        Map&lt;Long, Set&lt;String&gt;&gt; <span class="hljs-attr">statelessUserIdToCommentIdsMap</span> = new HashMap&lt;&gt;()<span class="hljs-comment">;</span>
        for (String userLikesKey : userLikesKeys) {
            String <span class="hljs-attr">userId</span> = userLikesKey.replace(RedisKeyConstants.ARTICLES_COMMENTS_LIKES_USERS_KEY, <span class="hljs-string">""</span>)<span class="hljs-comment">;</span>
            Set&lt;String&gt; <span class="hljs-attr">commentIds</span> = stringRedisTemplate.opsForSet().members(userLikesKey)<span class="hljs-comment">;</span>
            for (String commentId : commentIds) {
                votes.add(new ArticleCommentVote(Long.parseLong(commentId), Long.parseLong(userId), ArticleCommentVoteConstants.LIKE, null, null))<span class="hljs-comment">;</span>
                TotalcommentId.add(Long.parseLong(commentId))<span class="hljs-comment">;</span>
                // æ›´æ–°æˆ–æ–°å¢likesUserIdToCommentIdsMapé”®å€¼å¯¹ï¼Œå€¼çš„seté›†åˆæ–°å¢commentId
                likesUserIdToCommentIdsMap.computeIfAbsent(Long.parseLong(userId), k -&gt; new HashSet&lt;&gt;()).add(commentId)<span class="hljs-comment">;</span>
            }
        }
        for (String userDislikesKey : userDislikesKeys) {
            String <span class="hljs-attr">userId</span> = userDislikesKey.replace(RedisKeyConstants.ARTICLES_COMMENTS_DISLIKES_USERS_KEY, <span class="hljs-string">""</span>)<span class="hljs-comment">;</span>
            Set&lt;String&gt; <span class="hljs-attr">commentIds</span> = stringRedisTemplate.opsForSet().members(userDislikesKey)<span class="hljs-comment">;</span>
            for (String commentId : commentIds) {
                votes.add(new ArticleCommentVote(Long.parseLong(commentId), Long.parseLong(userId), ArticleCommentVoteConstants.DISLIKE, null, null))<span class="hljs-comment">;</span>
                TotalcommentId.add(Long.parseLong(commentId))<span class="hljs-comment">;</span>
                // æ›´æ–°æˆ–æ–°å¢dislikesUserIdToCommentIdsMapé”®å€¼å¯¹ï¼Œå€¼çš„seté›†åˆæ–°å¢commentId
                dislikesUserIdToCommentIdsMap.computeIfAbsent(Long.parseLong(userId), k -&gt; new HashSet&lt;&gt;()).add(commentId)<span class="hljs-comment">;</span>
            }
        }
        for (String userStatelessKey : userStatelessKeys) {
            String <span class="hljs-attr">userId</span> = userStatelessKey.replace(RedisKeyConstants.ARTICLES_COMMENTS_STATELESS_USERS_KEY, <span class="hljs-string">""</span>)<span class="hljs-comment">;</span>
            Set&lt;String&gt; <span class="hljs-attr">commentIds</span> = stringRedisTemplate.opsForSet().members(userStatelessKey)<span class="hljs-comment">;</span>
            for (String commentId : commentIds) {
                votes.add(new ArticleCommentVote(Long.parseLong(commentId), Long.parseLong(userId), ArticleCommentVoteConstants.STATELESS, null, null))<span class="hljs-comment">;</span>
                TotalcommentId.add(Long.parseLong(commentId))<span class="hljs-comment">;</span>
                // æ·»åŠ åˆ°statelessUserIdToCommentIdsMapé”®å€¼å¯¹ï¼Œå€¼çš„seté›†åˆæ–°å¢commentId
                statelessUserIdToCommentIdsMap.computeIfAbsent(Long.parseLong(userId), k -&gt; new HashSet&lt;&gt;()).add(commentId)<span class="hljs-comment">;</span>
            }
        }
</code></pre>
<h5 data-id="heading-28">è½åº“åˆ°MySQL</h5>
<h6 data-id="heading-29">Serviceå±‚ç›¸å…³ä»£ç </h6>
<pre><code class="hljs language-arduino" lang="arduino">        <span class="hljs-comment">// æ ¹æ®votesæ‰§è¡Œè½åº“é€»è¾‘ï¼ˆåŒ…å«æ’å…¥/æ›´æ–°ï¼‰</span>
        <span class="hljs-keyword">if</span> (!votes.<span class="hljs-built_in">isEmpty</span>()){
            <span class="hljs-type">int</span> i = articleCommentVoteMapper.<span class="hljs-built_in">batchInsertOrUpdate</span>(votes);
            <span class="hljs-keyword">if</span> (i &lt; <span class="hljs-number">0</span>){
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">ClientException</span>(HttpStatus.ERROR, <span class="hljs-string">"æ‰¹é‡æ’å…¥æˆ–æ›´æ–°æ•°æ®å¤±è´¥"</span>);
            }
            log.<span class="hljs-built_in">info</span>(<span class="hljs-string">"æ‰¹é‡æ’å…¥æˆ–æ›´æ–°æ•°æ®æˆåŠŸï¼Œæ•°é‡ä¸ºï¼š{}"</span>, i);
        } <span class="hljs-keyword">else</span> {
            log.<span class="hljs-built_in">info</span>(<span class="hljs-string">"æ²¡æœ‰éœ€è¦è½åº“çš„æ•°æ®"</span>);
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        }
</code></pre>
<h6 data-id="heading-30">SQLè¯­å¥ç›¸å…³å®ç°</h6>
<pre><code class="hljs language-xml" lang="xml">    <span class="hljs-comment">&lt;!-- åŸæœ‰æ–¹æ³• --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">insert</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"batchInsertOrUpdate"</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">"java.util.List"</span>&gt;</span>
        INSERT INTO x_article_comments_votes (
            comment_id,
            user_id,
            vote,
            create_time,
            update_time
        )
        VALUES
        <span class="hljs-tag">&lt;<span class="hljs-name">foreach</span> <span class="hljs-attr">collection</span>=<span class="hljs-string">"list"</span> <span class="hljs-attr">item</span>=<span class="hljs-string">"item"</span> <span class="hljs-attr">separator</span>=<span class="hljs-string">","</span>&gt;</span>
            (
                #{item.commentId},
                #{item.userId},
                #{item.vote},
                NOW(),
                NOW()
            )
        <span class="hljs-tag">&lt;/<span class="hljs-name">foreach</span>&gt;</span>
        ON DUPLICATE KEY UPDATE
            vote = VALUES(vote),
            update_time = VALUES(update_time)
    <span class="hljs-tag">&lt;/<span class="hljs-name">insert</span>&gt;</span>
</code></pre>
<h5 data-id="heading-31">æ ¹æ®x_article_comments_votesè¡¨ï¼Œé€šè¿‡SQLè¯­å¥ç»Ÿè®¡å‡ºlike_count, dislike_count</h5>
<h6 data-id="heading-32">Serviceå±‚ç›¸å…³ä»£ç </h6>
<pre><code class="hljs language-ini" lang="ini">        List&lt;UpdateCommentVoteCountDTO&gt; <span class="hljs-attr">updateCommentVoteCountDTOList</span> = getCommentLikeCountAndDislikeCountByListOfCommentId(TotalcommentId)<span class="hljs-comment">;</span>
</code></pre>
<h6 data-id="heading-33">SQLè¯­å¥ç›¸å…³å®ç°</h6>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-operator">&lt;</span><span class="hljs-operator">!</span><span class="hljs-comment">-- æ–°å¢æ–¹æ³•: èšåˆæŸ¥è¯¢ç‚¹èµ/ç‚¹è¸©æ•°é‡ --&gt;</span>
<span class="hljs-operator">&lt;</span><span class="hljs-keyword">select</span> id<span class="hljs-operator">=</span>"selectCommentLikeCountAndDislikeCountByListOfCommentId" resultType<span class="hljs-operator">=</span>"com.anon.spaceblogserver.modules.article.POJO.DTO.UpdateCommentVoteCountDTO"<span class="hljs-operator">&gt;</span>
    <span class="hljs-keyword">SELECT</span>
        comment_id <span class="hljs-keyword">AS</span> commentId,
        <span class="hljs-built_in">SUM</span>(<span class="hljs-keyword">CASE</span> <span class="hljs-keyword">WHEN</span> vote <span class="hljs-operator">=</span> <span class="hljs-number">1</span> <span class="hljs-keyword">THEN</span> <span class="hljs-number">1</span> <span class="hljs-keyword">ELSE</span> <span class="hljs-number">0</span> <span class="hljs-keyword">END</span>) <span class="hljs-keyword">AS</span> likeCount,
        <span class="hljs-built_in">SUM</span>(<span class="hljs-keyword">CASE</span> <span class="hljs-keyword">WHEN</span> vote <span class="hljs-operator">=</span> <span class="hljs-number">-1</span> <span class="hljs-keyword">THEN</span> <span class="hljs-number">1</span> <span class="hljs-keyword">ELSE</span> <span class="hljs-number">0</span> <span class="hljs-keyword">END</span>) <span class="hljs-keyword">AS</span> dislikeCount
    <span class="hljs-keyword">FROM</span> x_article_comments_votes
    <span class="hljs-keyword">WHERE</span> comment_id <span class="hljs-keyword">IN</span>
    <span class="hljs-operator">&lt;</span>foreach collection<span class="hljs-operator">=</span>"commentIds" item<span class="hljs-operator">=</span>"commentId" <span class="hljs-keyword">open</span><span class="hljs-operator">=</span>"(" separator<span class="hljs-operator">=</span>"," <span class="hljs-keyword">close</span><span class="hljs-operator">=</span>")"<span class="hljs-operator">&gt;</span>
        #{commentId}
    <span class="hljs-operator">&lt;</span><span class="hljs-operator">/</span>foreach<span class="hljs-operator">&gt;</span>
    <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> comment_id
<span class="hljs-operator">&lt;</span><span class="hljs-operator">/</span><span class="hljs-keyword">select</span><span class="hljs-operator">&gt;</span>
</code></pre>
<h5 data-id="heading-34">å°†ç»Ÿè®¡å‡ºçš„æ•°æ®æ‰¹é‡æ›´æ–°åˆ°x_article_comments</h5>
<h6 data-id="heading-35">Serviceå±‚ç›¸å…³ä»£ç </h6>
<pre><code class="hljs language-scss" lang="scss">int updated = <span class="hljs-built_in">batchUpdateCommentLikeCountAndDislikeCount</span>(updateCommentVoteCountDTOList, MySQLBatchSizeConstants.DEFAULT_UPDATE_BATCH_SIZE);
if (updated &lt; <span class="hljs-number">0</span>){
    throw new <span class="hljs-built_in">ClientException</span>(HttpStatus.ERROR, "æ‰¹é‡æ›´æ–°æ•°æ®å¤±è´¥");
}
log<span class="hljs-selector-class">.info</span>("æ‰¹é‡æ›´æ–°æ•°æ®æˆåŠŸï¼Œæ›´æ–°æ•°é‡ä¸ºï¼š{}", updated);
</code></pre>
<h6 data-id="heading-36">é™åˆ¶å•æ¡SQLè¯­å¥é•¿åº¦ï¼Œæ‰¹é‡æ›´æ–°æ“ä½œå…·ä½“å®ç°</h6>
<p>å› ä¸º<strong>SQLè¯­å¥</strong>é‡‡ç”¨äº†<code>case when</code>æ¥<strong>å‡å°‘ç½‘ç»œå¾€è¿”</strong>ï¼Œä¸º<strong>é™åˆ¶SQLè¯­å¥é•¿åº¦é˜²æ­¢æº¢å‡º</strong>ä»¥åŠ<strong>å½±å“æ€§èƒ½</strong>ï¼Œé‡‡ç”¨çš„ç­–ç•¥å¦‚ä¸‹</p>
<p>è‹¥æ£€æµ‹åˆ°å‚æ•°updateCommentVoteCountDTOListè¶…è¿‡æŒ‡å®šä¸ªæ•°ï¼Œå°†ä¼šæ‹†åˆ†æˆå¤šæ¡SQLè¯­å¥ä¸MySQLæ•°æ®åº“è¿›è¡Œäº¤äº’</p>
<pre><code class="hljs language-ini" lang="ini">/**
 * æ‰¹é‡æ›´æ–°è¯„è®ºçš„ç‚¹èµæ•°å’Œç‚¹è¸©æ•°
 * @param updateCommentVoteCountDTOList     éœ€è¦æ›´æ–°çš„è¯„è®ºç‚¹èµæ•°å’Œç‚¹è¸©æ•°åˆ—è¡¨
 * @param batchSize                   æ‰¹æ¬¡å¤§å°ï¼Œå»ºè®®æ ¹æ®å®é™…æƒ…å†µè°ƒæ•´ï¼Œè¿‡å¤§å¯èƒ½å¯¼è‡´å•æ¬¡æ›´æ–°è¿‡æ…¢ï¼Œè¿‡å°å¯èƒ½å¯¼è‡´æ›´æ–°æ¬¡æ•°è¿‡å¤š
 * @return      æˆåŠŸæ›´æ–°çš„è®°å½•æ•°
 */
public int batchUpdateCommentLikeCountAndDislikeCount(List&lt;UpdateCommentVoteCountDTO&gt; updateCommentVoteCountDTOList, Integer batchSize) {
    int <span class="hljs-attr">totalUpdated</span> = <span class="hljs-number">0</span><span class="hljs-comment">;</span>
    for (int <span class="hljs-attr">i</span> = <span class="hljs-number">0</span><span class="hljs-comment">; i &lt; updateCommentVoteCountDTOList.size(); i += batchSize) {</span>
        // æˆªå–å½“å‰æ‰¹æ¬¡çš„æ•°æ®
        List&lt;UpdateCommentVoteCountDTO&gt; <span class="hljs-attr">batch</span> = updateCommentVoteCountDTOList.subList(
                i,
                Math.min(i + batchSize, updateCommentVoteCountDTOList.size())
        )<span class="hljs-comment">;</span>
        // æ‰§è¡Œå½“å‰æ‰¹æ¬¡çš„æ›´æ–°
        int <span class="hljs-attr">updated</span> = articleCommentMapper.batchUpdateCommentLikeCountAndDislikeCount(batch)<span class="hljs-comment">;</span>
        if (updated &lt; 0) {
            log.error("æ‰¹é‡æ›´æ–°æ•°æ®å¤±è´¥ï¼Œå½“å‰æ‰¹æ¬¡æ›´æ–°æ•°é‡: {}", updated)<span class="hljs-comment">;</span>
            return -1<span class="hljs-comment">;</span>
        }
        totalUpdated += updated<span class="hljs-comment">;</span>

        log.info("æ‰¹é‡æ›´æ–°è¯„è®ºç‚¹èµ/ç‚¹è¸©æ•°ï¼Œå½“å‰æ‰¹æ¬¡æ›´æ–°æ•°é‡: {}, ç´¯è®¡æ›´æ–°æ•°é‡: {}", updated, totalUpdated)<span class="hljs-comment">;</span>
    }
    return totalUpdated<span class="hljs-comment">;</span>
}
</code></pre>
<h6 data-id="heading-37">SQLè¯­å¥ç›¸å…³å®ç°</h6>
<pre><code class="hljs language-ini" lang="ini">&lt;update <span class="hljs-attr">id</span>=<span class="hljs-string">"batchUpdateCommentLikeCountAndDislikeCount"</span>&gt;
    UPDATE x_article_comments
    SET <span class="hljs-attr">like_count</span> = CASE id
    &lt;foreach <span class="hljs-attr">collection</span>=<span class="hljs-string">"list"</span> item=<span class="hljs-string">"item"</span>&gt;
        WHEN <span class="hljs-comment">#{item.commentId} THEN #{item.likeCount}</span>
    &lt;/foreach&gt;
    END,
    <span class="hljs-attr">dislike_count</span> = CASE id
    &lt;foreach <span class="hljs-attr">collection</span>=<span class="hljs-string">"list"</span> item=<span class="hljs-string">"item"</span>&gt;
        WHEN <span class="hljs-comment">#{item.commentId} THEN #{item.dislikeCount}</span>
    &lt;/foreach&gt;
    END,
    <span class="hljs-attr">update_time</span> = NOW()
    WHERE id IN
    &lt;foreach <span class="hljs-attr">collection</span>=<span class="hljs-string">"list"</span> item=<span class="hljs-string">"item"</span> open=<span class="hljs-string">"("</span> separator=<span class="hljs-string">","</span> close=<span class="hljs-string">")"</span>&gt;
        <span class="hljs-comment">#{item.commentId}</span>
    &lt;/foreach&gt;
&lt;/update&gt;
</code></pre>
<h5 data-id="heading-38">æ¸…é™¤å·²åœ¨è¯¥å®šæ—¶ä»»åŠ¡å¤„ç†å®Œçš„redisç¼“å­˜æ•°æ®</h5>
<p>å‰é¢æåˆ°çš„å˜é‡â€”â€”likesUserIdToCommentIdsMapã€dislikesUserIdToCommentIdsMapã€statelessUserIdToCommentIdsMapã€‚å­˜å‚¨çš„å€¼ä¸ºç»è¿‡é€»è¾‘åé”®ä¸­å·²è¢«å¤„ç†çš„å€¼ï¼Œåœ¨æœ€åä¸€æ­¥æ¸…é™¤redisç¼“å­˜å‘æŒ¥ä½œç”¨</p>
<p>ä¸Šè¿°å˜é‡ç±»å‹å½¢å¼ä¸º<strong>Map&lt;Long, Set&gt;</strong> ï¼Œæ»¡è¶³äº†userId -&gt; è¯„è®ºidé›†åˆï¼Œè¿™å¯ä»¥ç²¾å‡†ä¸”æ–¹ä¾¿çš„æ¸…é™¤å·²å¤„ç†åçš„redisç¼“å­˜æ•°æ®</p>
<p>æ„å»ºä¸Šè¿°ä¸‰ä¸ªMapé›†åˆçš„è¿‡ç¨‹åœ¨<a href="####%E4%BB%8Eredis%E4%B8%AD%E8%8E%B7%E5%8F%96%E6%95%B0%E6%8D%AE%EF%BC%8C%E5%B9%B6%E5%B0%86%E6%95%B0%E6%8D%AE%E5%B0%81%E8%A3%85%E5%88%B0%E4%B8%A4%E4%B8%AA%E9%9B%86%E5%90%88%E4%B8%AD" title="####%E4%BB%8Eredis%E4%B8%AD%E8%8E%B7%E5%8F%96%E6%95%B0%E6%8D%AE%EF%BC%8C%E5%B9%B6%E5%B0%86%E6%95%B0%E6%8D%AE%E5%B0%81%E8%A3%85%E5%88%B0%E4%B8%A4%E4%B8%AA%E9%9B%86%E5%90%88%E4%B8%AD">ç¬¬ä¸€æ­¥æ“ä½œ</a>ä¸­ç»å†ä¸‰ä¸ªforå¾ªç¯å·²ç»æ„å»ºå®Œæ¯•</p>
<p>è¯¥æ“ä½œåŒæ ·ç”¨åˆ°<strong>luaè„šæœ¬</strong>ä¿è¯<strong>åŸå­æ€§</strong></p>
<h6 data-id="heading-39">luaè„šæœ¬</h6>
<p>è¯¥è„šæœ¬å®ç°<strong>å®‰å…¨æ‰¹é‡çš„ç§»é™¤</strong>keyä¸­<strong>è¦åˆ é™¤çš„å…ƒç´ åˆ—è¡¨</strong>ï¼Œ<strong>ä¸ºä»€ä¹ˆä¸ç›´æ¥æŠŠé”®åˆ é™¤çš„åŸå› </strong> -&gt; å‡å¦‚åœ¨è¯¥å®šæ—¶ä»»åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­ä»¥åŠè¯¥è„šæœ¬æ‰§è¡Œä¹‹å‰<strong>ç”¨æˆ·åˆå‘èµ·ç‚¹èµ/æ‹‰è¸©/æ— çŠ¶æ€è¯·æ±‚</strong>ï¼Œè‹¥ä¸å®šæ—¶ä»»åŠ¡è§¦å‘å<strong>ä»redisæŸ¥åˆ°çš„ç”¨æˆ·å¯¹è¯„è®ºçš„çŠ¶æ€ç›¸ç­‰ï¼Œåˆ™ä¼šç§»é™¤</strong>ï¼Œè¿™å¹¶æ²¡æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œ<strong>è‹¥ä¸ç›¸ç­‰ï¼Œä¸ä¼šç§»é™¤æ–°è¯·æ±‚ä¸­ç”¨æˆ·è®¾ç½®çš„ç‚¹èµ/æ‹‰è¸©/æ— çŠ¶æ€ï¼Œç•™åˆ°ä¸‹ä¸€æ¬¡å®šæ—¶ä»»åŠ¡è§¦å‘åå¤„ç†</strong>ã€‚</p>
<pre><code class="hljs language-lua" lang="lua"><span class="hljs-comment">-- å®‰å…¨æ‰¹é‡åˆ é™¤ï¼ŒåŒ…å«keyå­˜åœ¨æ€§æ£€æŸ¥</span>
<span class="hljs-comment">-- KEYS[1]: Setçš„key</span>
<span class="hljs-comment">-- ARGV[1..n]: è¦åˆ é™¤çš„å…ƒç´ åˆ—è¡¨</span>
<span class="hljs-comment">--</span>
<span class="hljs-keyword">local</span> key = KEYS[<span class="hljs-number">1</span>]
<span class="hljs-keyword">local</span> key_type = redis.call(<span class="hljs-string">'TYPE'</span>, key).ok

<span class="hljs-comment">-- æ£€æŸ¥keyæ˜¯å¦å­˜åœ¨ä¸”ç±»å‹ä¸ºset</span>
<span class="hljs-keyword">if</span> key_type == <span class="hljs-string">'none'</span> <span class="hljs-keyword">then</span>
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>
<span class="hljs-keyword">elseif</span> key_type ~= <span class="hljs-string">'set'</span> <span class="hljs-keyword">then</span>
    <span class="hljs-keyword">return</span> redis.error_reply(<span class="hljs-string">'WRONGTYPE Operation against a key holding the wrong kind of value'</span>)
<span class="hljs-keyword">end</span>

<span class="hljs-comment">-- å…¼å®¹ Lua 5.1 å’Œ Lua 5.2+</span>
<span class="hljs-keyword">local</span> <span class="hljs-built_in">unpack</span> = <span class="hljs-built_in">unpack</span> <span class="hljs-keyword">or</span> <span class="hljs-built_in">table</span>.<span class="hljs-built_in">unpack</span>

<span class="hljs-keyword">local</span> result = <span class="hljs-number">0</span>

<span class="hljs-comment">-- å¦‚æœ ARGV ä¸ä¸ºç©ºï¼Œåˆ™æ‰§è¡Œæ‰¹é‡åˆ é™¤</span>
<span class="hljs-keyword">if</span> #ARGV &gt; <span class="hljs-number">0</span> <span class="hljs-keyword">then</span>
    result = redis.call(<span class="hljs-string">'SREM'</span>, key, <span class="hljs-built_in">unpack</span>(ARGV))
<span class="hljs-keyword">end</span>

<span class="hljs-keyword">return</span> result
</code></pre>
<h6 data-id="heading-40">Serviceå±‚ç›¸å…³ä»£ç </h6>
<pre><code class="hljs language-vbscript" lang="vbscript">// æ¸…ç©ºRedisä¸­çš„æ•°æ®
DefaultRedisScript&lt;Long&gt; deleteScript = <span class="hljs-keyword">new</span> DefaultRedisScript&lt;&gt;();
deleteScript.setScriptSource(<span class="hljs-keyword">new</span> ResourceScriptSource(<span class="hljs-keyword">new</span> ClassPathResource(RedisLuaConstants.BATCH_REMOVE_MEMBERS_FROM_SET_LUA_SCRIPT_PATH)));
deleteScript.setResultType(Long.<span class="hljs-keyword">class</span>);
likesUserIdToCommentIdsMap.forEach((userId, commentIdSet) -&gt; {
    Long result = stringRedisTemplate.<span class="hljs-keyword">execute</span>(deleteScript, List.of(RedisKeyConstants.ARTICLES_COMMENTS_LIKES_USERS_KEY + userId.<span class="hljs-keyword">to</span><span class="hljs-built_in">String</span>()), commentIdSet.<span class="hljs-keyword">to</span><span class="hljs-built_in">Array</span>());
    <span class="hljs-keyword">if</span> (result == <span class="hljs-literal">null</span> || result &lt; <span class="hljs-number">0</span>){
        log.<span class="hljs-keyword">error</span>(<span class="hljs-string">"æ‰¹é‡åˆ é™¤ç”¨æˆ· {} ç¼“å­˜ç‚¹èµçš„è¯„è®ºå¤±è´¥ï¼Œæ¬²åˆ é™¤çš„commentId -&gt; {}"</span>, userId, commentIdSet);
    }
});
dislikesUserIdToCommentIdsMap.forEach((userId, commentIdSet) -&gt; {
    Long result = stringRedisTemplate.<span class="hljs-keyword">execute</span>(deleteScript, List.of(RedisKeyConstants.ARTICLES_COMMENTS_DISLIKES_USERS_KEY + userId.<span class="hljs-keyword">to</span><span class="hljs-built_in">String</span>()), commentIdSet.<span class="hljs-keyword">to</span><span class="hljs-built_in">Array</span>());
    <span class="hljs-keyword">if</span> (result == <span class="hljs-literal">null</span> || result &lt; <span class="hljs-number">0</span>){
        log.<span class="hljs-keyword">error</span>(<span class="hljs-string">"æ‰¹é‡åˆ é™¤ç”¨æˆ· {} ç¼“å­˜ç‚¹è¸©çš„è¯„è®ºå¤±è´¥ï¼Œæ¬²åˆ é™¤çš„commentId -&gt; {}"</span>, userId, commentIdSet);
    }
});
statelessUserIdToCommentIdsMap.forEach((userId, commentIdSet) -&gt; {
    Long result = stringRedisTemplate.<span class="hljs-keyword">execute</span>(deleteScript, List.of(RedisKeyConstants.ARTICLES_COMMENTS_STATELESS_USERS_KEY + userId.<span class="hljs-keyword">to</span><span class="hljs-built_in">String</span>()), commentIdSet.<span class="hljs-keyword">to</span><span class="hljs-built_in">Array</span>());
    <span class="hljs-keyword">if</span> (result == <span class="hljs-literal">null</span> || result &lt; <span class="hljs-number">0</span>){
        log.<span class="hljs-keyword">error</span>(<span class="hljs-string">"æ‰¹é‡åˆ é™¤ç”¨æˆ· {} ç¼“å­˜æ— çŠ¶æ€çš„è¯„è®ºå¤±è´¥ï¼Œæ¬²åˆ é™¤çš„commentId -&gt; {}"</span>, userId, commentIdSet);
    }
});
</code></pre>
<h4 data-id="heading-41">SyncVoteå®Œæ•´ä»£ç </h4>
<pre><code class="hljs language-ini" lang="ini">@Transactional
@Override
public Boolean syncVote() {
 Â  Â //TODO å‘æ•£æ€ç»´ï¼Œè¯¥æ®µé€»è¾‘ä¼¼ä¹åœ¨æ”¶è—ã€æŠ•å¸ç­‰åŠŸèƒ½æœ‰ç›¸ä¼¼ä¹‹å¤„ï¼Œè¯¥æ®µä¹‹æ‰€ä»¥æœ‰ç‚¹å¤æ‚æ˜¯å› ä¸ºæœ‰ä¸‰ç§çŠ¶æ€â€”â€”â€”â€”ç‚¹èµã€ç‚¹è¸©ã€æ— çŠ¶æ€ï¼Œä¸”ä¸‰è€…ä¹‹é—´æ˜¯äº’æ–¥çš„ï¼Œä½†å‰é¢çš„æ”¶è—ã€æŠ•å¸åŠŸèƒ½æ²¡æœ‰è¿™ä¸ªé—®é¢˜ï¼Œå¹¶ä¸”å¥½åƒåªæœ‰ä¸¤ä¸ªçŠ¶æ€ï¼Œæ—¥åå¯ä»¥æŠ½è±¡å‡ºä¸€ä¸ªé€šç”¨æ–¹æ³•æ¥å¤„ç†è¿™ç±»åŠŸèƒ½ï¼Œå‡å°‘ä»£ç é‡å¤åº¦
 Â  Â Set&lt;String&gt; <span class="hljs-attr">userLikesKeys</span> = stringRedisTemplate.keys(RedisKeyConstants.ARTICLES_COMMENTS_LIKES_USERS_KEY + <span class="hljs-string">"*"</span>)<span class="hljs-comment">;</span>
 Â  Â Set&lt;String&gt; <span class="hljs-attr">userDislikesKeys</span> = stringRedisTemplate.keys(RedisKeyConstants.ARTICLES_COMMENTS_DISLIKES_USERS_KEY + <span class="hljs-string">"*"</span>)<span class="hljs-comment">;</span>
 Â  Â Set&lt;String&gt; <span class="hljs-attr">userStatelessKeys</span> = stringRedisTemplate.keys(RedisKeyConstants.ARTICLES_COMMENTS_STATELESS_USERS_KEY + <span class="hljs-string">"*"</span>)<span class="hljs-comment">;</span>
 Â  Â if (userLikesKeys.isEmpty() &amp;&amp; userDislikesKeys.isEmpty() &amp;&amp; userStatelessKeys.isEmpty()){
 Â  Â  Â  Â log.info("æ²¡æœ‰éœ€è¦åŒæ­¥çš„æ•°æ®")<span class="hljs-comment">;</span>
 Â  Â  Â  Â return true<span class="hljs-comment">;</span>
 Â   }
 Â  Â List&lt;ArticleCommentVote&gt; <span class="hljs-attr">votes</span> = new ArrayList&lt;&gt;()<span class="hljs-comment">; Â  Â  Â // ä¿å­˜æ‰€æœ‰æŠ•ç¥¨æ•°æ®</span>
 Â  Â Set&lt;Long&gt; <span class="hljs-attr">TotalcommentId</span> = new HashSet&lt;&gt;()<span class="hljs-comment">; Â  Â  // ä¿å­˜æ‰€æœ‰è¯„è®ºid</span>
 Â  Â Map&lt;Long, Set&lt;String&gt;&gt; <span class="hljs-attr">likesUserIdToCommentIdsMap</span> = new HashMap&lt;&gt;()<span class="hljs-comment">;</span>
 Â  Â Map&lt;Long, Set&lt;String&gt;&gt; <span class="hljs-attr">dislikesUserIdToCommentIdsMap</span> = new HashMap&lt;&gt;()<span class="hljs-comment">;</span>
 Â  Â Map&lt;Long, Set&lt;String&gt;&gt; <span class="hljs-attr">statelessUserIdToCommentIdsMap</span> = new HashMap&lt;&gt;()<span class="hljs-comment">;</span>
 Â  Â for (String userLikesKey : userLikesKeys) {
 Â  Â  Â  Â String <span class="hljs-attr">userId</span> = userLikesKey.replace(RedisKeyConstants.ARTICLES_COMMENTS_LIKES_USERS_KEY, <span class="hljs-string">""</span>)<span class="hljs-comment">;</span>
 Â  Â  Â  Â Set&lt;String&gt; <span class="hljs-attr">commentIds</span> = stringRedisTemplate.opsForSet().members(userLikesKey)<span class="hljs-comment">;</span>
 Â  Â  Â  Â for (String commentId : commentIds) {
 Â  Â  Â  Â  Â  Â votes.add(new ArticleCommentVote(Long.parseLong(commentId), Long.parseLong(userId), ArticleCommentVoteConstants.LIKE, null, null))<span class="hljs-comment">;</span>
 Â  Â  Â  Â  Â  Â TotalcommentId.add(Long.parseLong(commentId))<span class="hljs-comment">;</span>
 Â  Â  Â  Â  Â  Â // æ›´æ–°æˆ–æ–°å¢likesUserIdToCommentIdsMapé”®å€¼å¯¹ï¼Œå€¼çš„seté›†åˆæ–°å¢commentId
 Â  Â  Â  Â  Â  Â likesUserIdToCommentIdsMap.computeIfAbsent(Long.parseLong(userId), k -&gt; new HashSet&lt;&gt;()).add(commentId)<span class="hljs-comment">;</span>
 Â  Â  Â   }
 Â   }
 Â  Â for (String userDislikesKey : userDislikesKeys) {
 Â  Â  Â  Â String <span class="hljs-attr">userId</span> = userDislikesKey.replace(RedisKeyConstants.ARTICLES_COMMENTS_DISLIKES_USERS_KEY, <span class="hljs-string">""</span>)<span class="hljs-comment">;</span>
 Â  Â  Â  Â Set&lt;String&gt; <span class="hljs-attr">commentIds</span> = stringRedisTemplate.opsForSet().members(userDislikesKey)<span class="hljs-comment">;</span>
 Â  Â  Â  Â for (String commentId : commentIds) {
 Â  Â  Â  Â  Â  Â votes.add(new ArticleCommentVote(Long.parseLong(commentId), Long.parseLong(userId), ArticleCommentVoteConstants.DISLIKE, null, null))<span class="hljs-comment">;</span>
 Â  Â  Â  Â  Â  Â TotalcommentId.add(Long.parseLong(commentId))<span class="hljs-comment">;</span>
 Â  Â  Â  Â  Â  Â // æ›´æ–°æˆ–æ–°å¢dislikesUserIdToCommentIdsMapé”®å€¼å¯¹ï¼Œå€¼çš„seté›†åˆæ–°å¢commentId
 Â  Â  Â  Â  Â  Â dislikesUserIdToCommentIdsMap.computeIfAbsent(Long.parseLong(userId), k -&gt; new HashSet&lt;&gt;()).add(commentId)<span class="hljs-comment">;</span>
 Â  Â  Â   }
 Â   }
 Â  Â for (String userStatelessKey : userStatelessKeys) {
 Â  Â  Â  Â String <span class="hljs-attr">userId</span> = userStatelessKey.replace(RedisKeyConstants.ARTICLES_COMMENTS_STATELESS_USERS_KEY, <span class="hljs-string">""</span>)<span class="hljs-comment">;</span>
 Â  Â  Â  Â Set&lt;String&gt; <span class="hljs-attr">commentIds</span> = stringRedisTemplate.opsForSet().members(userStatelessKey)<span class="hljs-comment">;</span>
 Â  Â  Â  Â for (String commentId : commentIds) {
 Â  Â  Â  Â  Â  Â votes.add(new ArticleCommentVote(Long.parseLong(commentId), Long.parseLong(userId), ArticleCommentVoteConstants.STATELESS, null, null))<span class="hljs-comment">;</span>
 Â  Â  Â  Â  Â  Â TotalcommentId.add(Long.parseLong(commentId))<span class="hljs-comment">;</span>
 Â  Â  Â  Â  Â  Â // æ·»åŠ åˆ°statelessUserIdToCommentIdsMapé”®å€¼å¯¹ï¼Œå€¼çš„seté›†åˆæ–°å¢commentId
 Â  Â  Â  Â  Â  Â statelessUserIdToCommentIdsMap.computeIfAbsent(Long.parseLong(userId), k -&gt; new HashSet&lt;&gt;()).add(commentId)<span class="hljs-comment">;</span>
 Â  Â  Â   }
 Â   }
 Â  Â // æ ¹æ®votesæ‰§è¡Œè½åº“é€»è¾‘ï¼ˆåŒ…å«æ’å…¥/æ›´æ–°ï¼‰
 Â  Â if (!votes.isEmpty()){
 Â  Â  Â  Â int <span class="hljs-attr">i</span> = articleCommentVoteMapper.batchInsertOrUpdate(votes)<span class="hljs-comment">;</span>
 Â  Â  Â  Â if (i &lt; 0){
 Â  Â  Â  Â  Â  Â throw new ClientException(HttpStatus.ERROR, "æ‰¹é‡æ’å…¥æˆ–æ›´æ–°æ•°æ®å¤±è´¥")<span class="hljs-comment">;</span>
 Â  Â  Â   }
 Â  Â  Â  Â log.info("æ‰¹é‡æ’å…¥æˆ–æ›´æ–°æ•°æ®æˆåŠŸï¼Œæ•°é‡ä¸ºï¼š{}", i)<span class="hljs-comment">;</span>
 Â   } else {
 Â  Â  Â  Â log.info("æ²¡æœ‰éœ€è¦è½åº“çš„æ•°æ®")<span class="hljs-comment">;</span>
 Â  Â  Â  Â return true<span class="hljs-comment">;</span>
 Â   }
 Â  Â // æ ¹æ®TotalcommentIdé›†åˆä¸­çš„commentIdï¼Œåˆ©ç”¨èšåˆå‡½æ•°è·å–å¯¹åº”è¡¨ä¸­å¯¹åº”è¯„è®ºçš„likeCountå’ŒdislikeCountï¼Œå°è£…æˆList&lt;updateCommentVoteCountDTO&gt; updateCommentVoteCountDTOList
 Â  Â List&lt;UpdateCommentVoteCountDTO&gt; <span class="hljs-attr">updateCommentVoteCountDTOList</span> = getCommentLikeCountAndDislikeCountByListOfCommentId(TotalcommentId)<span class="hljs-comment">;</span>
 Â  Â // æ ¹æ®updateCommentVoteCountDTOListæ‰§è¡Œæ‰¹é‡æ›´æ–°çš„é€»è¾‘ï¼Œä½œç”¨çš„è¡¨ä¸ºx_article_commentsï¼Œä½¿ç”¨case when thenè¯­æ³•æ›´æ–°likeCountå’ŒdislikeCount
 Â  Â int <span class="hljs-attr">updated</span> = batchUpdateCommentLikeCountAndDislikeCount(updateCommentVoteCountDTOList, MySQLBatchSizeConstants.DEFAULT_UPDATE_BATCH_SIZE)<span class="hljs-comment">;</span>
 Â  Â if (updated &lt; 0){
 Â  Â  Â  Â throw new ClientException(HttpStatus.ERROR, "æ‰¹é‡æ›´æ–°æ•°æ®å¤±è´¥")<span class="hljs-comment">;</span>
 Â   }
 Â  Â log.info("æ‰¹é‡æ›´æ–°æ•°æ®æˆåŠŸï¼Œæ›´æ–°æ•°é‡ä¸ºï¼š{}", updated)<span class="hljs-comment">;</span>
 Â  Â // æ¸…ç©ºRedisä¸­çš„æ•°æ®
 Â  Â DefaultRedisScript&lt;Long&gt; <span class="hljs-attr">deleteScript</span> = new DefaultRedisScript&lt;&gt;()<span class="hljs-comment">;</span>
 Â  Â deleteScript.setScriptSource(new ResourceScriptSource(new ClassPathResource(RedisLuaConstants.BATCH_REMOVE_MEMBERS_FROM_SET_LUA_SCRIPT_PATH)))<span class="hljs-comment">;</span>
 Â  Â deleteScript.setResultType(Long.class)<span class="hljs-comment">;</span>
 Â  Â likesUserIdToCommentIdsMap.forEach((userId, commentIdSet) -&gt; {
 Â  Â  Â  Â Long <span class="hljs-attr">result</span> = stringRedisTemplate.execute(deleteScript, List.of(RedisKeyConstants.ARTICLES_COMMENTS_LIKES_USERS_KEY + userId.toString()), commentIdSet.toArray())<span class="hljs-comment">;</span>
 Â  Â  Â  Â if (<span class="hljs-attr">result</span> == null || result &lt; <span class="hljs-number">0</span>){
 Â  Â  Â  Â  Â  Â log.error("æ‰¹é‡åˆ é™¤ç”¨æˆ· {} ç¼“å­˜ç‚¹èµçš„è¯„è®ºå¤±è´¥ï¼Œæ¬²åˆ é™¤çš„commentId -&gt; {}", userId, commentIdSet)<span class="hljs-comment">;</span>
 Â  Â  Â   }
 Â   })<span class="hljs-comment">;</span>
 Â  Â dislikesUserIdToCommentIdsMap.forEach((userId, commentIdSet) -&gt; {
 Â  Â  Â  Â Long <span class="hljs-attr">result</span> = stringRedisTemplate.execute(deleteScript, List.of(RedisKeyConstants.ARTICLES_COMMENTS_DISLIKES_USERS_KEY + userId.toString()), commentIdSet.toArray())<span class="hljs-comment">;</span>
 Â  Â  Â  Â if (<span class="hljs-attr">result</span> == null || result &lt; <span class="hljs-number">0</span>){
 Â  Â  Â  Â  Â  Â log.error("æ‰¹é‡åˆ é™¤ç”¨æˆ· {} ç¼“å­˜ç‚¹è¸©çš„è¯„è®ºå¤±è´¥ï¼Œæ¬²åˆ é™¤çš„commentId -&gt; {}", userId, commentIdSet)<span class="hljs-comment">;</span>
 Â  Â  Â   }
 Â   })<span class="hljs-comment">;</span>
 Â  Â statelessUserIdToCommentIdsMap.forEach((userId, commentIdSet) -&gt; {
 Â  Â  Â  Â Long <span class="hljs-attr">result</span> = stringRedisTemplate.execute(deleteScript, List.of(RedisKeyConstants.ARTICLES_COMMENTS_STATELESS_USERS_KEY + userId.toString()), commentIdSet.toArray())<span class="hljs-comment">;</span>
 Â  Â  Â  Â if (<span class="hljs-attr">result</span> == null || result &lt; <span class="hljs-number">0</span>){
 Â  Â  Â  Â  Â  Â log.error("æ‰¹é‡åˆ é™¤ç”¨æˆ· {} ç¼“å­˜æ— çŠ¶æ€çš„è¯„è®ºå¤±è´¥ï¼Œæ¬²åˆ é™¤çš„commentId -&gt; {}", userId, commentIdSet)<span class="hljs-comment">;</span>
 Â  Â  Â   }
 Â   })<span class="hljs-comment">;</span>
 Â  Â return true<span class="hljs-comment">;</span>
}
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Nçš‡åé—®é¢˜(å«ä½è¿ç®—ç‰ˆæœ¬)]]></title>    <link>https://juejin.cn/post/7604775190211936266</link>    <guid>https://juejin.cn/post/7604775190211936266</guid>    <pubDate>2026-02-10T03:29:33.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604775190211936266" data-draft-id="7604697194795810826" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Nçš‡åé—®é¢˜(å«ä½è¿ç®—ç‰ˆæœ¬)"/> <meta itemprop="keywords" content="ç®—æ³•"/> <meta itemprop="datePublished" content="2026-02-10T03:29:33.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="è‰ºè‰ºç”Ÿè¾‰"/> <meta itemprop="url" content="https://juejin.cn/user/1071389369728667"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Nçš‡åé—®é¢˜(å«ä½è¿ç®—ç‰ˆæœ¬)
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1071389369728667/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    è‰ºè‰ºç”Ÿè¾‰
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T03:29:33.000Z" title="Tue Feb 10 2026 03:29:33 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Nçš‡åé—®é¢˜(å«ä½è¿ç®—ç‰ˆæœ¬)</h2>
<h3 data-id="heading-1">1.ç»å…¸æ–¹æ³•è§£å†³Nçš‡åé—®é¢˜</h3>
<p><strong>é¢˜ç›®</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e120d4407c364b048ed4e35344203689~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Im66Im655Sf6L6J:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771298974&amp;x-signature=PBCxwG24BlE%2BmiytH4eIph2kMGU%3D" alt="image.png" loading="lazy"/>
æµ‹è¯•è¿æ¥:<a href="https://link.juejin.cn?target=https%3A%2F%2Fleetcode.cn%2Fproblems%2Fn-queens%2F%3FenvType%3Dstudy-plan-v2%26envId%3Dtop-100-liked" target="_blank" title="https://leetcode.cn/problems/n-queens/?envType=study-plan-v2&amp;envId=top-100-liked" ref="nofollow noopener noreferrer">leetcode.cn/problems/n-â€¦</a><br/>
é¢˜ç›®ä¸­:1&lt;=n&lt;=9ï¼Œnçš„èŒƒå›´è¾ƒå°ï¼Œæˆ‘ä»¬å¯ä»¥æšä¸¾æ‰€æœ‰å¯èƒ½<br/>
<strong>ä»£ç :</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> {
    <span class="hljs-keyword">private</span> List&lt;List&lt;String&gt;&gt; ans = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
    <span class="hljs-keyword">public</span> List&lt;List&lt;String&gt;&gt; <span class="hljs-title function_">solveNQueens</span><span class="hljs-params">(<span class="hljs-type">int</span> n)</span> {
        <span class="hljs-type">int</span>[] path = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[n];
        f(path,<span class="hljs-number">0</span>,n);
        <span class="hljs-keyword">return</span> ans;
    }
    <span class="hljs-comment">//ç­–ç•¥:æ¯ä¸€è¡Œå¼€å§‹æšä¸¾ï¼Œçœ‹æ¯ä¸€è¡Œçš„æ£‹å­åº”è¯¥æ”¾ç½®å“ªä¸ªä½ç½®</span>
    <span class="hljs-comment">//pathæ•°ç»„:è®°å½•æ¯ä¸€è¡Œçš„æ£‹å­æ”¾ç½®çš„åˆ—æ•°</span>
    <span class="hljs-comment">//cur:å½“å‰çš„è¡Œ</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">f</span><span class="hljs-params">(<span class="hljs-type">int</span>[] path ,<span class="hljs-type">int</span> cur,<span class="hljs-type">int</span> n)</span>{
        <span class="hljs-comment">//é€’å½’ç»ˆæ­¢æ¡ä»¶</span>
        <span class="hljs-keyword">if</span>(cur == n){
            List&lt;String&gt; list = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>();
            <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;n;i++){
                <span class="hljs-type">StringBuilder</span> <span class="hljs-variable">sb</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>();
                <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> j=<span class="hljs-number">0</span>;j&lt;n;j++){
                    <span class="hljs-keyword">if</span>(path[i]==j) sb.append(<span class="hljs-string">'Q'</span>);
                    <span class="hljs-keyword">else</span> sb.append(<span class="hljs-string">'.'</span>);
                }
                list.add(sb.toString());
            }
            ans.add(list);
            <span class="hljs-keyword">return</span>;
        }
        <span class="hljs-comment">//æšä¸¾æ¯ä¸€åˆ—ï¼Œçœ‹çœ‹èƒ½ä¸èƒ½æ”¾</span>
        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> col=<span class="hljs-number">0</span>;col&lt;n;col++){
            <span class="hljs-comment">//checkå‡½æ•°æ£€æŸ¥</span>
            <span class="hljs-keyword">if</span>(check(path,cur,col)){
                path[cur]=col;
                f(path,cur+<span class="hljs-number">1</span>,n);
            }
        }
    }
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">check</span><span class="hljs-params">(<span class="hljs-type">int</span>[] path,<span class="hljs-type">int</span> row,<span class="hljs-type">int</span> col)</span>{
        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;row;i++){
            <span class="hljs-comment">//è¿™é‡Œåˆ©ç”¨æ–œç‡==1çš„çŸ¥è¯†ï¼Œå·§å¦™å¤„ç†äº†ä¸¤æ¡å¯¹è§’çº¿</span>
            <span class="hljs-keyword">if</span>(path[i]==col || Math.abs(row-i)==Math.abs(col-path[i])) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }
}

</code></pre>
<p><strong>æ—¶é—´å¤æ‚åº¦:</strong> O(n!)</p>
<h3 data-id="heading-2">2.ç”¨ä½è¿ç®—è§£å†³Nçš‡åé—®é¢˜</h3>
<p><strong>é¢˜ç›®</strong>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/20bfd3a1b4394f8cad3104888d35011a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Im66Im655Sf6L6J:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771298974&amp;x-signature=k4j6v0%2F7jQadVlCwAf6f6N92ALo%3D" alt="image.png" loading="lazy"/>
æµ‹è¯•é“¾æ¥:<a href="https://link.juejin.cn?target=https%3A%2F%2Fleetcode.cn%2Fproblems%2Fn-queens-ii%2Fdescription%2F" target="_blank" title="https://leetcode.cn/problems/n-queens-ii/description/" ref="nofollow noopener noreferrer">leetcode.cn/problems/n-â€¦</a><br/>
<strong>ä»£ç </strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> {
    <span class="hljs-comment">//ç”¨ä½è¿ç®—å®ç°é€’å½’ç‰ˆæœ¬</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">totalNQueens</span><span class="hljs-params">(<span class="hljs-type">int</span> n)</span> {
        <span class="hljs-comment">//æ¯”å¦‚5çš‡åé—®é¢˜,limit= ...00011111,æœ€å³è¾¹æœ‰5ä¸ª1</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">limit</span> <span class="hljs-operator">=</span> (<span class="hljs-number">1</span>&lt;&lt;n) -<span class="hljs-number">1</span>;
        <span class="hljs-keyword">return</span> f2(limit,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);
    }
    <span class="hljs-comment">//col:åˆ—çš„é™åˆ¶æ¡ä»¶ï¼Œè®°å½•å“ªäº›åˆ—æ”¾ç½®äº†çš‡å,0ä»£è¡¨å½“å‰è¡Œå¯ä»¥æ”¾ç½®ï¼Œ1ä»£è¡¨ä¸å¯ä»¥æ”¾ç½®</span>
    <span class="hljs-comment">//left:å³ä¸Šè§’åˆ°å·¦ä¸‹è§’çš„é™åˆ¶æ¡ä»¶ï¼Œ0ä»£è¡¨å½“å‰è¡Œå¯ä»¥æ”¾ç½®ï¼Œ1ä»£è¡¨ä¸å¯ä»¥æ”¾ç½®</span>
    <span class="hljs-comment">//right:å·¦ä¸Šè§’åˆ°å³ä¸‹è§’çš„é™åˆ¶æ¡ä»¶,0ä»£è¡¨å½“å‰è¡Œå¯ä»¥æ”¾ç½®ï¼Œ1ä»£è¡¨ä¸å¯ä»¥æ”¾ç½®</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">f2</span><span class="hljs-params">(<span class="hljs-type">int</span> limit,<span class="hljs-type">int</span> col,<span class="hljs-type">int</span> left,<span class="hljs-type">int</span> right)</span>{
        <span class="hljs-comment">//é€’å½’ç»ˆæ­¢æ¡ä»¶</span>
        <span class="hljs-keyword">if</span>(col == limit){
            <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;
        }
        <span class="hljs-comment">//å¯ä»¥æ”¾ç½®çš„ä½ç½®</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">cadidate</span> <span class="hljs-operator">=</span> col | left | right;
        <span class="hljs-comment">//å–åæ˜¯å°†1å˜ä¸ºå¯æ”¾ç½®çš„ï¼Œ0å˜ä¸ºä¸å¯æ”¾ç½®ï¼Œæ–¹ä¾¿æˆ‘ä»¬åé¢è¿ç®—</span>
        <span class="hljs-comment">//&amp;limit:æ˜¯å»æ‰æ— ç”¨çš„ä¿¡æ¯</span>
        cadidate = ((~cadidate) &amp; limit);
        <span class="hljs-type">int</span> <span class="hljs-variable">ans</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
        <span class="hljs-keyword">while</span>(cadidate != <span class="hljs-number">0</span>){
            <span class="hljs-comment">//å–å‡ºæœ€å³ä¾§çš„1</span>
            <span class="hljs-type">int</span> <span class="hljs-variable">choice</span> <span class="hljs-operator">=</span> cadidate &amp; (~cadidate+<span class="hljs-number">1</span>);
            <span class="hljs-comment">//æ›´æ–°candidate</span>
            cadidate ^= choice;
            <span class="hljs-comment">//æ›´æ–°ä¸‹ä¸€è¡Œçš„æ¡ä»¶</span>
            ans += f2(limit,col | choice,(left | choice)&lt;&lt;<span class="hljs-number">1</span> ,(right | choice) &gt;&gt;<span class="hljs-number">1</span>);
        }
        <span class="hljs-keyword">return</span> ans;
    }
}

</code></pre>
<p><strong>æ—¶é—´å¤æ‚åº¦:O(n!)</strong><br/>
ä½è¿ç®—çš„é€Ÿåº¦æ¯”ç”¨pathæ•°ç»„è®°å½•æ›´å¿«<br/></p>
<h3 data-id="heading-3">3.å£°æ˜</h3>
<p><strong>ä»¥ä¸Šçš„ä»£ç æ˜¯å¬äº†å·¦ç¥(bç«™å·¦ç¨‹äº‘)çš„æ•™å­¦åè‡ªå·±å†™çš„</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[for rangeçš„ä½¿ç”¨æ³¨æ„äº‹é¡¹]]></title>    <link>https://juejin.cn/post/7604701848150687744</link>    <guid>https://juejin.cn/post/7604701848150687744</guid>    <pubDate>2026-02-10T03:31:22.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604701848150687744" data-draft-id="7604779604124925952" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="for rangeçš„ä½¿ç”¨æ³¨æ„äº‹é¡¹"/> <meta itemprop="keywords" content="Go"/> <meta itemprop="datePublished" content="2026-02-10T03:31:22.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="cppgo"/> <meta itemprop="url" content="https://juejin.cn/user/1924620895400932"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            for rangeçš„ä½¿ç”¨æ³¨æ„äº‹é¡¹
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1924620895400932/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    cppgo
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T03:31:22.000Z" title="Tue Feb 10 2026 03:31:22 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong>(ä¸€)</strong></p>
<p>1.åœ¨rangeä¸­ä¿®æ”¹åˆ‡ç‰‡ï¼š</p>
<pre><code class="hljs language-go" lang="go"> <span class="hljs-number">1</span> n := []<span class="hljs-type">int</span>{<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span>,<span class="hljs-number">6</span>}
 <span class="hljs-number">2</span> <span class="hljs-keyword">for</span> i, e := <span class="hljs-keyword">range</span> n{
 <span class="hljs-number">3</span>         <span class="hljs-keyword">if</span> i == <span class="hljs-built_in">len</span>(n)<span class="hljs-number">-1</span> {
 <span class="hljs-number">4</span>                 n[<span class="hljs-number">0</span>] += e
 <span class="hljs-number">5</span>         } <span class="hljs-keyword">else</span> {
 <span class="hljs-number">6</span>                 n[i+<span class="hljs-number">1</span>] += e
 <span class="hljs-number">7</span>         }
 <span class="hljs-number">8</span> 
 <span class="hljs-number">9</span> }
<span class="hljs-number">10</span> fmt.Println(<span class="hljs-string">"n:"</span>, n)
</code></pre>
<p>è¾“å‡ºï¼š</p>
<pre><code class="hljs language-ini" lang="ini">n: <span class="hljs-section">[22 3 6 10 15 21]</span>
</code></pre>
<p>2.åœ¨rangeä¸­ä¿®æ”¹æ•°ç»„ï¼š</p>
<pre><code class="hljs language-go" lang="go"> <span class="hljs-number">1</span> n := [...]<span class="hljs-type">int</span>{<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span>,<span class="hljs-number">6</span>}
 <span class="hljs-number">2</span> <span class="hljs-keyword">for</span> i, e := <span class="hljs-keyword">range</span> n{
 <span class="hljs-number">3</span>         <span class="hljs-keyword">if</span> i == <span class="hljs-built_in">len</span>(n)<span class="hljs-number">-1</span> {
 <span class="hljs-number">4</span>                 n[<span class="hljs-number">0</span>] += e
 <span class="hljs-number">5</span>         } <span class="hljs-keyword">else</span> {
 <span class="hljs-number">6</span>                 n[i+<span class="hljs-number">1</span>] += e
 <span class="hljs-number">7</span>         }
 <span class="hljs-number">8</span> 
 <span class="hljs-number">9</span> }
<span class="hljs-number">10</span> fmt.Println(<span class="hljs-string">"n:"</span>, n)
</code></pre>
<p>è¾“å‡ºï¼š</p>
<pre><code class="hljs language-ini" lang="ini">n: <span class="hljs-section">[7 3 5 7 9 11]</span>
</code></pre>
<p>Â </p>
<p><strong><code>range</code>è¡¨è¾¾å¼ä¼šåœ¨<code>for</code>è¯­å¥å¼€å§‹æ‰§è¡Œæ—¶è¢«æ±‚å€¼ä¸€æ¬¡ã€‚æ±‚å€¼çš„ç»“æœå€¼è¢«ä¼ é€’å‡ºæ¥ï¼Œæ˜¯å€¼ä¼ é€’ï¼ˆå¤åˆ¶ï¼‰ã€‚ç”±äºåˆ‡ç‰‡æ˜¯å¼•ç”¨ç±»å‹ï¼Œæ‰€ä»¥å¯ä»¥è·Ÿéšå˜åŒ–ã€‚</strong></p>
<p><strong>(äºŒ)</strong></p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">str</span><span class="hljs-params">()</span></span> {
        a := <span class="hljs-string">"ä½ å¥½123"</span>
        <span class="hljs-keyword">for</span> i, v :=  <span class="hljs-keyword">range</span> a {
                fmt.Println(<span class="hljs-string">"i:"</span>,i, <span class="hljs-string">", v:"</span>, v)
        }
        b := []<span class="hljs-type">rune</span>(a)
        fmt.Println(<span class="hljs-string">"b:"</span>, b)

}
</code></pre>
<p>è¾“å‡ºï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">i:</span> <span class="hljs-number">0</span> <span class="hljs-string">,</span> <span class="hljs-attr">v:</span> <span class="hljs-number">20320</span>
<span class="hljs-attr">i:</span> <span class="hljs-number">3</span> <span class="hljs-string">,</span> <span class="hljs-attr">v:</span> <span class="hljs-number">22909</span>
<span class="hljs-attr">i:</span> <span class="hljs-number">6</span> <span class="hljs-string">,</span> <span class="hljs-attr">v:</span> <span class="hljs-number">49</span>
<span class="hljs-attr">i:</span> <span class="hljs-number">7</span> <span class="hljs-string">,</span> <span class="hljs-attr">v:</span> <span class="hljs-number">50</span>
<span class="hljs-attr">i:</span> <span class="hljs-number">8</span> <span class="hljs-string">,</span> <span class="hljs-attr">v:</span> <span class="hljs-number">51</span>
<span class="hljs-attr">b:</span> [<span class="hljs-number">20320</span> <span class="hljs-number">22909</span> <span class="hljs-number">49</span> <span class="hljs-number">50</span> <span class="hljs-number">51</span>]
</code></pre>
<p>ã€è¿ç§»ã€‘<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.cnblogs.com%2Fzxq89%2Fp%2F16658420.html" target="_blank" title="https://www.cnblogs.com/zxq89/p/16658420.html" ref="nofollow noopener noreferrer">www.cnblogs.com/zxq89/p/166â€¦</a> posted @Â 2022-09-05 15:42</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[antfu æ–°ä½œï¼šskills-npm å¦‚ä½•ç”¨åŒ…ç®¡ç†é‡å¡‘ Agent Skills ç”Ÿæ€]]></title>    <link>https://juejin.cn/post/7604666872128061459</link>    <guid>https://juejin.cn/post/7604666872128061459</guid>    <pubDate>2026-02-10T03:18:02.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604666872128061459" data-draft-id="7604853010162810943" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="antfu æ–°ä½œï¼šskills-npm å¦‚ä½•ç”¨åŒ…ç®¡ç†é‡å¡‘ Agent Skills ç”Ÿæ€"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2026-02-10T03:18:02.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="twl"/> <meta itemprop="url" content="https://juejin.cn/user/3016715635534029"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            antfu æ–°ä½œï¼šskills-npm å¦‚ä½•ç”¨åŒ…ç®¡ç†é‡å¡‘ Agent Skills ç”Ÿæ€
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3016715635534029/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    twl
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T03:18:02.000Z" title="Tue Feb 10 2026 03:18:02 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»10åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"/>
<blockquote>
<p>æ·±åº¦è§£æ Anthony Fu çš„åˆä¸€ä¸ªã€Œç†å¿µå…ˆè¡Œã€å¼€æºä½œå“</p>
</blockquote>
<hr/>
<h3 data-id="heading-1">ä¸€ã€ä¸ºä»€ä¹ˆéœ€è¦ skills-npmï¼Ÿ</h3>
<p>å¦‚æœä½ æ­£åœ¨ç”¨ Cursorã€Claude Code æˆ– Windsurf ç­‰ AI ç¼–ç åŠ©æ‰‹ï¼Œä½ å¯èƒ½å·²ç»ä½“éªŒè¿‡ã€ŒSkillsã€çš„æ¦‚å¿µ â€”â€” ä¸€ç»„è‡ªå®šä¹‰çš„æŒ‡ä»¤å’Œä¸Šä¸‹æ–‡ï¼Œå‘Šè¯‰ AI å¦‚ä½•ä¸ä½ çš„é¡¹ç›®åä½œã€‚ä½†å½“ä½ æƒ³æŠŠè¿™äº› Skills åˆ†äº«ç»™å›¢é˜Ÿã€è·¨é¡¹ç›®å¤ç”¨ï¼Œç”šè‡³éšå·¥å…·åº“ä¸€èµ·åˆ†å‘æ—¶ï¼Œé—®é¢˜å°±æ¥äº†ï¼š</p>

























<table><thead><tr><th>ç—›ç‚¹</th><th>å…¸å‹åœºæ™¯</th></tr></thead><tbody><tr><td><strong>åˆ†å‘ç¢ç‰‡åŒ–</strong></td><td>æ¯ä¸ª Skill éƒ½æ•£è½åœ¨ç‹¬ç«‹ Git ä»“åº“ä¸­ï¼Œæ‰‹åŠ¨å…‹éš†å®‰è£…</td></tr><tr><td><strong>ç‰ˆæœ¬ä¸å¯¹é½</strong></td><td>å·¥å…·å‡çº§äº†ï¼ŒSkill è¿˜åœç•™åœ¨æ—§ç‰ˆæœ¬ï¼Œè¡Œä¸ºä¸å¯é¢„æµ‹</td></tr><tr><td><strong>æ‰‹åŠ¨ç®¡ç†</strong></td><td>ä»å®‰è£…åˆ°æ›´æ–°ï¼Œå…¨ç¨‹æ‰‹åŠ¨æ“ä½œ</td></tr><tr><td><strong>å›¢é˜ŸåŒæ­¥å›°éš¾</strong></td><td>æ–°æˆå‘˜åŠ å…¥éœ€è¦é‡æ–°é…ç½®ä¸€é Skills ç¯å¢ƒ</td></tr></tbody></table>
<p>Anthony Fuï¼ˆVue/Vite æ ¸å¿ƒè´¡çŒ®è€…ï¼‰çš„è§£æ³•ä¼˜é›…è€Œå¤§èƒ†ï¼š<strong>ä¸è¦é‡æ–°å‘æ˜è½®å­ï¼Œè®© npm æ¥åšå®ƒæœ€æ“…é•¿çš„äº‹ã€‚</strong></p>
<p>skills-npm çš„æ ¸å¿ƒä¸»å¼ æ˜¯ï¼šå°† Agent Skills å†…åµŒåˆ° npm åŒ…ä¸­ï¼Œåˆ©ç”¨ npm å·²æœ‰çš„ç‰ˆæœ¬ç®¡ç†ã€ä¾èµ–è§£æã€lockfile é”å®šå’Œç§æœ‰ä»“åº“ç­‰åŸºç¡€è®¾æ–½ï¼Œè®© Skills çš„åˆ†å‘å’Œç®¡ç†å˜å¾—å’Œå®‰è£…ä¸€ä¸ª npm ä¾èµ–ä¸€æ ·ç®€å•ã€‚</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># å®‰è£…ä¸€ä¸ªåŒ…å« Skills çš„ npm åŒ…</span>
npm install @slidev/cli

<span class="hljs-comment"># è¿è¡Œ skills-npmï¼Œè‡ªåŠ¨å‘ç°å¹¶é“¾æ¥ Skills</span>
npx skills-npm
</code></pre>
<p>å°±è¿™ä¹ˆç®€å•ã€‚<code>.cursor/skills/</code> ä¸‹è‡ªåŠ¨å‡ºç°äº† <code>npm-slidev-cli-presenter-mode</code> â€” ä¸€ä¸ªç¬¦å·é“¾æ¥ï¼ŒæŒ‡å‘åˆšå®‰è£…çš„ npm åŒ…ä¸­çš„ Skill ç›®å½•ã€‚</p>
<hr/>
<h3 data-id="heading-2">äºŒã€çº¦å®šä¼˜äºé…ç½®ï¼šä¸€åˆ‡å§‹äº <code>skills/*/SKILL.md</code></h3>
<p>skills-npm çš„åˆ†å‘åè®®æå…¶ç®€æ´ã€‚å¦‚æœä½ æ˜¯å·¥å…·åº“ä½œè€…ï¼Œæƒ³éšåŒ…é™„å¸¦ Agent Skillsï¼Œåªéœ€è¦åœ¨ä½ çš„ npm åŒ…ä¸­æŒ‰å¦‚ä¸‹ç»“æ„ç»„ç»‡ï¼š</p>
<pre><code class="hljs language-css" lang="css">your-awesome-lib/
â”œâ”€â”€ <span class="hljs-attribute">src</span>/
â”œâ”€â”€ package<span class="hljs-selector-class">.json</span>
â””â”€â”€ skills/
    â”œâ”€â”€ debug-helper/
    â”‚   â””â”€â”€ SKILL<span class="hljs-selector-class">.md</span>
    â””â”€â”€ <span class="hljs-selector-tag">code</span>-generation/
        â””â”€â”€ SKILL<span class="hljs-selector-class">.md</span>
</code></pre>
<p>æ¯ä¸ª <code>SKILL.md</code> éœ€è¦åŒ…å« YAML frontmatter æ¥å£°æ˜å…ƒä¿¡æ¯ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-meta">---</span>
<span class="hljs-attr">name:</span> <span class="hljs-string">debug-helper</span>
<span class="hljs-attr">description:</span> <span class="hljs-string">å¸®åŠ©</span> <span class="hljs-string">AI</span> <span class="hljs-string">ä»£ç†ç†è§£é¡¹ç›®çš„è°ƒè¯•çº¦å®š</span>
<span class="hljs-meta">---
</span>
<span class="hljs-string">åœ¨è°ƒè¯•æœ¬é¡¹ç›®æ—¶ï¼Œè¯·éµå¾ªä»¥ä¸‹è§„èŒƒ...</span>
</code></pre>
<p>è¿™å°±æ˜¯å…¨éƒ¨çš„ã€Œåè®®ã€ã€‚æ²¡æœ‰ JSON Schemaï¼Œæ²¡æœ‰æ³¨å†Œä¸­å¿ƒï¼Œæ²¡æœ‰é¢å¤–çš„æ„å»ºæ­¥éª¤ â€”â€” <strong>çº¦å®šä¼˜äºé…ç½®çš„æè‡´å®è·µã€‚</strong></p>
<p>skills-npm ä¼šä½¿ç”¨ <code>gray-matter</code> åº“è§£æ frontmatterï¼Œå¹¶éªŒè¯ <code>name</code> å’Œ <code>description</code> å­—æ®µçš„å­˜åœ¨æ€§ã€‚ä¸ç¬¦åˆè§„èŒƒçš„ Skill ä¼šè¢«æ ‡è®°ä¸ºæ— æ•ˆå¹¶åœ¨ç»ˆç«¯ä¸­æŠ¥å‘Šï¼Œä½†ä¸ä¼šä¸­æ–­æ•´ä¸ªæµç¨‹ã€‚</p>
<hr/>
<h3 data-id="heading-3">ä¸‰ã€æ¶æ„å‰–æï¼šä¸€ä¸ªç²¾ç®€çš„ ETL ç®¡é“</h3>
<p>æ•´ä¸ª skills-npm çš„æ ¸å¿ƒä»£ç ä»…çº¦ <strong>1,400 è¡Œ</strong>ï¼Œå´å®ç°äº†å®Œæ•´çš„ CLI å·¥å…·é“¾ã€‚å®ƒé‡‡ç”¨äº†ç»å…¸çš„ <strong>ETLï¼ˆExtract-Transform-Loadï¼‰ç®¡é“æ¶æ„</strong>ï¼š</p>
<pre><code class="hljs">é…ç½®åŠ è½½ â†’ æŠ€èƒ½æ‰«æ â†’ è¿‡æ»¤å¤„ç† â†’ Agent æ£€æµ‹ â†’ ç¬¦å·é“¾æ¥åˆ›å»º â†’ .gitignore æ›´æ–°
</code></pre>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart LR
    A[CLI å…¥å£&lt;br/&gt;cac] --&gt; B[é…ç½®è§£æ&lt;br/&gt;unconfig]
    B --&gt; C[Skills æ‰«æ&lt;br/&gt;scan.ts]
    C --&gt; D[Include/Exclude&lt;br/&gt;è¿‡æ»¤]
    D --&gt; E[Agent æ£€æµ‹]
    E --&gt; F[ç”¨æˆ·ç¡®è®¤&lt;br/&gt;@clack/prompts]
    F --&gt; G[ç¬¦å·é“¾æ¥&lt;br/&gt;symlink.ts]
    G --&gt; H[.gitignore&lt;br/&gt;æ›´æ–°]
    
    C -.-&gt; J[ç¼“å­˜å±‚&lt;br/&gt;cache.ts]
    J -.-&gt; C
</code></pre>
<p>æ¯ä¸ªç¯èŠ‚å¯¹åº”ä¸€ä¸ªç‹¬ç«‹æ¨¡å—ï¼ŒèŒè´£å•ä¸€ã€è¾¹ç•Œæ¸…æ™°ã€‚è®©æˆ‘ä»¬é€ä¸€æ‹†è§£ã€‚</p>
<h4 data-id="heading-4">3.1 Extract â€” æŠ€èƒ½æ‰«æå¼•æ“</h4>
<p>æ‰«æå¼•æ“ï¼ˆ<code>scan.ts</code>ï¼‰æ˜¯æ•´ä¸ªå·¥å…·çš„æ ¸å¿ƒï¼Œæ”¯æŒä¸¤ç§æ‰«æç­–ç•¥ï¼š</p>
<p><strong>ç­–ç•¥ä¸€ï¼š<code>node_modules</code> å…¨æ‰«æ</strong></p>
<p>éå†æ•´ä¸ª <code>node_modules</code> ç›®å½•ï¼Œæ£€æŸ¥æ¯ä¸ªåŒ…æ˜¯å¦åŒ…å« <code>skills/</code> å­ç›®å½•ã€‚è¿™ç§æ–¹å¼è¦†ç›–é¢å¹¿ï¼Œèƒ½å‘ç°æ‰€æœ‰å±‚çº§çš„ Skillsï¼ŒåŒ…æ‹¬é—´æ¥ä¾èµ–ä¸­çš„ Skillsã€‚</p>
<p><strong>ç­–ç•¥äºŒï¼š<code>package.json</code> ç²¾å‡†æ‰«æ</strong></p>
<p>åªæ£€æŸ¥ <code>dependencies</code> å’Œ <code>devDependencies</code> ä¸­æ˜¾å¼å£°æ˜çš„ç›´æ¥ä¾èµ–ã€‚æ›´å¿«ã€æ›´ç²¾å‡†ï¼Œé€‚åˆå¤§å‹é¡¹ç›®ã€‚</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">scanCurrentNodeModules</span>(<span class="hljs-params">
  cwd: <span class="hljs-built_in">string</span>, 
  source: ScanOptions[<span class="hljs-string">'source'</span>] = <span class="hljs-string">'node_modules'</span>
</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">ScanResult</span>&gt; {
  <span class="hljs-comment">// æ ¹æ®ç­–ç•¥å†³å®šæ‰«æèŒƒå›´</span>
  <span class="hljs-keyword">const</span> packageNames = source === <span class="hljs-string">'package.json'</span> 
    ? <span class="hljs-keyword">await</span> <span class="hljs-title function_">getPackageDeps</span>(cwd) 
    : <span class="hljs-literal">null</span>

  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> entry <span class="hljs-keyword">of</span> entries) {
    <span class="hljs-keyword">if</span> (entry.<span class="hljs-property">name</span>.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">'@'</span>)) {
      <span class="hljs-comment">// å¤„ç†ä½œç”¨åŸŸåŒ…ï¼šè¿›å…¥ @org/ äºŒçº§ç›®å½•ç»§ç»­æ‰«æ</span>
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">await</span> <span class="hljs-title function_">scanPackageForSkills</span>(entry)
    }
  }
}
</code></pre>
<p>ä¸€ä¸ªå€¼å¾—æ³¨æ„çš„ç»†èŠ‚ï¼šæ‰«ææ—¶ä½¿ç”¨ <code>isDirectoryOrSymlink()</code> è€Œéç®€å•çš„ <code>isDirectory()</code> æ£€æŸ¥ï¼Œè¿™æ˜¯å¯¹ <strong>pnpm ç¬¦å·é“¾æ¥ç»“æ„çš„ä¸“é—¨é€‚é…</strong>ã€‚pnpm ä¸ºäº†èŠ‚çœç£ç›˜ç©ºé—´ï¼Œåœ¨ <code>node_modules</code> ä¸­ä½¿ç”¨ç¬¦å·é“¾æ¥æŒ‡å‘å…¨å±€å­˜å‚¨ï¼Œå¦‚æœåªæ£€æŸ¥ç›®å½•ç±»å‹ä¼šé—æ¼æ‰€æœ‰åŒ…ã€‚</p>
<p>å¯¹äº <strong>Monorepo åœºæ™¯</strong>ï¼Œskills-npm æä¾› <code>--recursive</code> å‚æ•°ï¼Œé€šè¿‡è§£æ <code>pnpm-workspace.yaml</code> æˆ– <code>package.json</code> çš„ <code>workspaces</code> å­—æ®µï¼Œæ‰¾åˆ°æ‰€æœ‰å­åŒ…å¹¶ç‹¬ç«‹æ‰«æï¼Œä½¿ç”¨ Map æŒ‰åŒ…åå»é‡ã€‚</p>
<h4 data-id="heading-5">3.2 Transform â€” è¿‡æ»¤ç³»ç»Ÿ</h4>
<p>è¿‡æ»¤ç³»ç»Ÿï¼ˆ<code>utils/skills.ts</code>ï¼‰æ”¯æŒä¸¤ç§ç²’åº¦çš„æ§åˆ¶ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// åŒ…çº§åˆ«è¿‡æ»¤ï¼šåŒ¹é…æ•´ä¸ªåŒ…çš„æ‰€æœ‰ Skills</span>
<span class="hljs-attr">include</span>: [<span class="hljs-string">'@slidev/cli'</span>]

<span class="hljs-comment">// æŠ€èƒ½çº§åˆ«è¿‡æ»¤ï¼šç²¾ç¡®åˆ°ç‰¹å®šåŒ…çš„ç‰¹å®š Skill</span>
<span class="hljs-attr">exclude</span>: [{ <span class="hljs-attr">package</span>: <span class="hljs-string">'@some/lib'</span>, <span class="hljs-attr">skills</span>: [<span class="hljs-string">'deprecated-skill'</span>] }]
</code></pre>
<p>è¿‡æ»¤ä½¿ç”¨ç»å…¸çš„ç™½åå• + é»‘åå•æ¨¡å¼ï¼šå…ˆé€šè¿‡ <code>include</code> ç­›é€‰å‡ºæƒ³è¦çš„ï¼Œå†é€šè¿‡ <code>exclude</code> æ’é™¤ä¸éœ€è¦çš„ã€‚</p>
<h4 data-id="heading-6">3.3 Load â€” ç¬¦å·é“¾æ¥å¼•æ“</h4>
<p>ç¬¦å·é“¾æ¥åˆ›å»ºï¼ˆ<code>symlink.ts</code>ï¼‰æ˜¯æœ€ä½“ç°å·¥ç¨‹ç´ å…»çš„æ¨¡å—ã€‚126 è¡Œä»£ç ä¸­ï¼Œè¾¹ç•Œå¤„ç†å ªç§°æ•™ç§‘ä¹¦çº§åˆ«ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">createSymlink</span>(<span class="hljs-params">target: <span class="hljs-built_in">string</span>, linkPath: <span class="hljs-built_in">string</span></span>) {
  <span class="hljs-comment">// 1. å¹‚ç­‰æ€§ï¼šç›®æ ‡è·¯å¾„ç›¸åŒ â†’ ç›´æ¥è·³è¿‡</span>
  <span class="hljs-keyword">if</span> (resolvedTarget === resolvedLinkPath) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>

  <span class="hljs-comment">// 2. å·²æœ‰é“¾æ¥å¤„ç†ï¼š</span>
  <span class="hljs-comment">//    - ç¬¦å·é“¾æ¥å·²æŒ‡å‘æ­£ç¡®ç›®æ ‡ â†’ è·³è¿‡</span>
  <span class="hljs-comment">//    - ç¬¦å·é“¾æ¥æŒ‡å‘é”™è¯¯ç›®æ ‡ â†’ åˆ é™¤åé‡å»º</span>
  <span class="hljs-comment">//    - éç¬¦å·é“¾æ¥æ–‡ä»¶å ä½ â†’ é€’å½’åˆ é™¤åé‡å»º</span>

  <span class="hljs-comment">// 3. å¾ªç¯å¼•ç”¨é˜²æŠ¤ï¼šæ•è· ELOOP é”™è¯¯å¹¶å¼ºåˆ¶æ¸…é™¤</span>

  <span class="hljs-comment">// 4. è·¨å¹³å°å…¼å®¹ï¼šWindows ä½¿ç”¨ junction ç±»å‹</span>
  <span class="hljs-keyword">const</span> symlinkType = <span class="hljs-title function_">platform</span>() === <span class="hljs-string">'win32'</span> ? <span class="hljs-string">'junction'</span> : <span class="hljs-literal">undefined</span>

  <span class="hljs-comment">// 5. ä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼šé¡¹ç›®ç§»åŠ¨åé“¾æ¥ä¾ç„¶æœ‰æ•ˆ</span>
  <span class="hljs-keyword">const</span> relativePath = <span class="hljs-title function_">relative</span>(linkDir, target)
  <span class="hljs-keyword">await</span> <span class="hljs-title function_">symlink</span>(relativePath, linkPath, symlinkType)
}
</code></pre>
<p><strong>ä¸ºä»€ä¹ˆç”¨ç›¸å¯¹è·¯å¾„è€Œä¸æ˜¯ç»å¯¹è·¯å¾„ï¼Ÿ</strong> è€ƒè™‘ä¸€ä¸ªåœºæ™¯ï¼šä½ åœ¨ CI ç¯å¢ƒä¸­ clone é¡¹ç›®åˆ° <code>/home/runner/project</code>ï¼Œæœ¬åœ°å¼€å‘åœ¨ <code>/Users/you/project</code>ã€‚å¦‚æœä½¿ç”¨ç»å¯¹è·¯å¾„åˆ›å»ºç¬¦å·é“¾æ¥ï¼Œé“¾æ¥åœ¨ä¸åŒæœºå™¨ä¸Šä¼šå¤±æ•ˆã€‚ç›¸å¯¹è·¯å¾„ç¡®ä¿äº†é¡¹ç›®ç›®å½•å¯ä»¥æ•´ä½“ç§»åŠ¨æˆ–åœ¨ä¸åŒè·¯å¾„ä¸‹ä½¿ç”¨ï¼Œç¬¦å·é“¾æ¥å§‹ç»ˆæœ‰æ•ˆã€‚</p>
<p><strong>å‘½åè§„åˆ™</strong> ä½¿ç”¨ <code>npm-{sanitized-package}-{skill-name}</code> çš„æ ¼å¼ï¼š</p>
<pre><code class="hljs language-perl" lang="perl">@slidev/cli çš„ presenter-mode â†’ npm-slidev-cli-presenter-mode
<span class="hljs-keyword">my</span>-lib çš„ debug-helper       â†’ npm-<span class="hljs-keyword">my</span>-lib-debug-helper
</code></pre>
<p><code>npm-</code> å‰ç¼€è®©ç”¨æˆ·ä¸€çœ¼å°±èƒ½åŒºåˆ†æ¥è‡ª npm çš„ Skill å’Œæ‰‹åŠ¨åˆ›å»ºçš„ Skillã€‚</p>
<hr/>
<h3 data-id="heading-7">å››ã€ç¼“å­˜ï¼šå°è€Œç²¾çš„æ€§èƒ½ä¼˜åŒ–</h3>
<p>åœ¨å¤§å‹é¡¹ç›®ä¸­ï¼Œ<code>node_modules</code> å¯èƒ½åŒ…å«æ•°åƒä¸ªåŒ…ã€‚æ¯æ¬¡è¿è¡Œéƒ½å…¨é‡æ‰«ææ˜¾ç„¶ä¸åˆ‡å®é™…ã€‚skills-npm çš„ç¼“å­˜ç­–ç•¥ï¼ˆ<code>cache.ts</code>ï¼Œ58 è¡Œï¼‰å·§å¦™è€Œå®ç”¨ï¼š</p>
<p><strong>æ ¸å¿ƒæ€è·¯ï¼šlockfile ä¸å˜ = ä¾èµ–ä¸å˜ = æ‰«æç»“æœä¸å˜ã€‚</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getPackageManagerLockFileHash</span>(<span class="hljs-params">cwd: <span class="hljs-built_in">string</span></span>) {
  <span class="hljs-comment">// æŒ‰ä¼˜å…ˆçº§å°è¯•ï¼šbun.lockb â†’ pnpm-lock.yaml â†’ yarn.lock â†’ package-lock.json</span>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> file <span class="hljs-keyword">of</span> <span class="hljs-variable constant_">LOCK_FILES</span>.<span class="hljs-property">all</span>) {
    <span class="hljs-keyword">const</span> encoding = <span class="hljs-title function_">isBinaryLockFile</span>(file) ? <span class="hljs-literal">undefined</span> : <span class="hljs-string">'utf-8'</span>
    <span class="hljs-keyword">const</span> content = <span class="hljs-keyword">await</span> <span class="hljs-title function_">readFile</span>(<span class="hljs-title function_">join</span>(cwd, file), encoding)
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">hash</span>: <span class="hljs-title function_">createHash</span>(<span class="hljs-string">'md5'</span>).<span class="hljs-title function_">update</span>(content).<span class="hljs-title function_">digest</span>(<span class="hljs-string">'hex'</span>),
      <span class="hljs-attr">path</span>: file,
    }
  }
}
</code></pre>
<p>ç¼“å­˜å­˜å‚¨åœ¨ <code>node_modules/.skills-npm/cache.json</code>ã€‚è¿™ä¸ªè·¯å¾„çš„é€‰æ‹©ä¹Ÿå€¼å¾—ç©å‘³ â€”â€” å½“ä½ æ‰§è¡Œ <code>rm -rf node_modules</code> é‡è£…ä¾èµ–æ—¶ï¼Œæ—§ç¼“å­˜è‡ªåŠ¨æ¶ˆå¤±ï¼Œæ–°ä¸€æ¬¡æ‰«æä¼šé‡å»ºç¼“å­˜ã€‚ç¼“å­˜çš„æ¸…ç†å’Œ <code>node_modules</code> çš„ç”Ÿå‘½å‘¨æœŸè‡ªç„¶å¯¹é½ï¼Œä¸éœ€è¦é¢å¤–çš„æ¸…ç†æœºåˆ¶ã€‚</p>
<hr/>
<h3 data-id="heading-8">äº”ã€é…ç½®ç³»ç»Ÿï¼šä¸‰å±‚è¦†ç›– + TypeScript åŸç”Ÿæ”¯æŒ</h3>
<p>skills-npm æä¾›ä¸‰å±‚é…ç½®åˆå¹¶æœºåˆ¶ï¼Œéµå¾ªã€Œæœ€è¿‘åŸåˆ™ã€ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">é»˜è®¤é…ç½® &lt; skills-npm.config.ts &lt; CLI å‚æ•°
</code></pre>
<p>é…ç½®æ–‡ä»¶ä½¿ç”¨ Anthony Fu è‡ªå·±ç»´æŠ¤çš„ <code>unconfig</code> åº“åŠ è½½ï¼ŒåŸç”Ÿæ”¯æŒ TypeScript æ ¼å¼ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// skills-npm.config.ts</span>
<span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'skills-npm'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-attr">source</span>: <span class="hljs-string">'package.json'</span>,      <span class="hljs-comment">// åªæ‰«æç›´æ¥ä¾èµ–</span>
  <span class="hljs-attr">recursive</span>: <span class="hljs-literal">true</span>,             <span class="hljs-comment">// é€’å½’æ‰«æ Monorepo</span>
  <span class="hljs-attr">include</span>: [<span class="hljs-string">'@slidev/*'</span>],      <span class="hljs-comment">// åªå®‰è£… Slidev ç›¸å…³çš„ Skills</span>
  <span class="hljs-attr">exclude</span>: [{ <span class="hljs-attr">package</span>: <span class="hljs-string">'@some/lib'</span>, <span class="hljs-attr">skills</span>: [<span class="hljs-string">'experimental'</span>] }],
  <span class="hljs-attr">confirm</span>: <span class="hljs-literal">false</span>,              <span class="hljs-comment">// è·³è¿‡ç¡®è®¤æç¤ºï¼ˆCI ç¯å¢ƒï¼‰</span>
})
</code></pre>
<p><code>defineConfig</code> æ˜¯ä¸€ä¸ªç»å…¸çš„ identity å‡½æ•°ï¼Œå”¯ä¸€çš„ä½œç”¨æ˜¯æä¾› TypeScript ç±»å‹æ¨å¯¼ï¼Œè®©ä½ åœ¨å†™é…ç½®æ—¶è·å¾—å®Œæ•´çš„è‡ªåŠ¨è¡¥å…¨ã€‚</p>
<hr/>
<h3 data-id="heading-9">å…­ã€ç»ˆç«¯ä½“éªŒï¼šTTY æ„ŸçŸ¥çš„åŒæ¨¡å¼è¾“å‡º</h3>
<p>skills-npm çš„ç»ˆç«¯ä½“éªŒåšäº†ç²¾ç»†çš„ç¯å¢ƒé€‚é…ï¼ˆ<code>printer.ts</code>ï¼‰ï¼š</p>
<p><strong>TTY æ¨¡å¼</strong>ï¼ˆäº¤äº’å¼ç»ˆç«¯ï¼‰ï¼šä½¿ç”¨ <code>@clack/prompts</code> æä¾›äº¤äº’å¼ä½“éªŒï¼ŒåŒ…æ‹¬æ¸å˜ç°è‰²çš„ ASCII Art Logoã€spinner è¿›åº¦åŠ¨ç”»ã€å½©è‰²æŠ€èƒ½åˆ—è¡¨ï¼ˆ<code>picocolors</code>ï¼‰ã€ä»¥åŠç¡®è®¤/å¤šé€‰æç¤ºã€‚</p>
<p><strong>é TTY æ¨¡å¼</strong>ï¼ˆCI/CD ç®¡é“ï¼‰ï¼šè‡ªåŠ¨é™çº§ä¸ºçº¯æ–‡æœ¬è¾“å‡ºï¼Œæ—  ANSI é¢œè‰²ç ï¼Œæ— äº¤äº’å¼æç¤ºï¼Œç¡®ä¿åœ¨æ—¥å¿—ç³»ç»Ÿä¸­å¯è¯»ã€‚</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">if</span> (isTTY) {
  p.<span class="hljs-property">log</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Discovered skills:'</span>)
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`  <span class="hljs-subst">${c.green(<span class="hljs-string">'â—'</span>)}</span> <span class="hljs-subst">${c.bold(skill.name)}</span> <span class="hljs-subst">${c.dim(<span class="hljs-string">`from <span class="hljs-subst">${pkg}</span>`</span>)}</span>`</span>)
} <span class="hljs-keyword">else</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`  - <span class="hljs-subst">${skill.name}</span> (<span class="hljs-subst">${pkg}</span>)`</span>)
}
</code></pre>
<p>è¿™ç§åŒæ¨¡å¼è®¾è®¡ä¿è¯äº†ä¸€ä¸ªå‘½ä»¤åœ¨æœ¬åœ°å¼€å‘å’Œ CI/CD ç¯å¢ƒä¸­éƒ½è¡¨ç°è‰¯å¥½ï¼Œæ˜¯ä¼˜ç§€ CLI å·¥å…·çš„æ ‡å‡†å®è·µã€‚</p>
<hr/>
<h3 data-id="heading-10">ä¸ƒã€Vendor å­æ¨¡å—ï¼šç«™åœ¨å·¨äººè‚©è†€ä¸Š</h3>
<p>skills-npm é€šè¿‡ Git submodule å¼•å…¥äº† <code>vercel-labs/skills</code> ä½œä¸º vendor ä¾èµ–ã€‚è¿™ä¸ªå­æ¨¡å—æä¾›äº† Agent ç±»å‹å®šä¹‰ï¼ˆ<code>AgentType</code>ã€<code>AgentConfig</code>ï¼‰å’Œ Agent æ£€æµ‹é€»è¾‘ï¼ˆ<code>detectInstalledAgents()</code>ï¼‰ã€‚</p>
<p>æ„å»ºæ—¶é€šè¿‡ tsdown çš„ <code>noExternal: [/vendor\/skills/]</code> é…ç½®å°† vendor ä»£ç å†…è”æ‰“åŒ…åˆ°æœ€ç»ˆäº§ç‰©ä¸­ï¼Œå®ç°äº†ï¼š</p>
<ul>
<li><strong>ç±»å‹å…±äº«</strong>ï¼šå¤ç”¨ä¸Šæ¸¸æ ‡å‡†ç±»å‹è€Œéè‡ªå·±å®šä¹‰</li>
<li><strong>æ£€æµ‹é€»è¾‘å¤ç”¨</strong>ï¼šä¸é‡å¤å®ç° Agent ç‰¹å®šç›®å½•çš„æ£€æµ‹</li>
<li><strong>ç‰ˆæœ¬å¯æ§</strong>ï¼šé€šè¿‡ submodule çš„ commit hash ç²¾ç¡®é”å®šä¸Šæ¸¸ç‰ˆæœ¬</li>
</ul>
<p>è¿™æ˜¯ä¸€ç§ã€Œ<strong>ç¼–è¯‘æ—¶ä¾èµ–ï¼Œè¿è¡Œæ—¶é›¶ä¾èµ–</strong>ã€çš„ç­–ç•¥ â€”â€” ç”¨æˆ·ä¸éœ€è¦å®‰è£… <code>vercel-labs/skills</code>ï¼Œä½† skills-npm çš„ä»£ç ä¸­åŒ…å«äº†å®ƒçš„é€»è¾‘ã€‚</p>
<hr/>
<h3 data-id="heading-11">å…«ã€å·¥ä½œåŒºæ£€æµ‹ï¼šç§»æ¤è‡ª Vite çš„æˆç†Ÿå®è·µ</h3>
<p>å·¥ä½œåŒºæ ¹ç›®å½•çš„æ£€æµ‹ï¼ˆ<code>utils/workspace.ts</code>ï¼‰ç›´æ¥ç§»æ¤è‡ª Vite çš„æºç ï¼Œé€šè¿‡é€’å½’å‘ä¸Šæœç´¢æ¥å®šä½ Monorepo æ ¹ç›®å½•ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">ROOT_FILES</span> = [<span class="hljs-string">'pnpm-workspace.yaml'</span>, <span class="hljs-string">'lerna.json'</span>]

<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">searchForWorkspaceRoot</span>(<span class="hljs-params">current: <span class="hljs-built_in">string</span>, root: <span class="hljs-built_in">string</span></span>): <span class="hljs-built_in">string</span> {
  <span class="hljs-keyword">if</span> (<span class="hljs-title function_">hasRootFile</span>(current)) <span class="hljs-keyword">return</span> current              <span class="hljs-comment">// æ‰¾åˆ°æ ‡å¿—æ–‡ä»¶</span>
  <span class="hljs-keyword">if</span> (<span class="hljs-title function_">hasWorkspacePackageJSON</span>(current)) <span class="hljs-keyword">return</span> current  <span class="hljs-comment">// package.json æœ‰ workspaces</span>
  <span class="hljs-keyword">const</span> dir = <span class="hljs-title function_">dirname</span>(current)
  <span class="hljs-keyword">if</span> (!dir || dir === current) <span class="hljs-keyword">return</span> root              <span class="hljs-comment">// åˆ°è¾¾æ–‡ä»¶ç³»ç»Ÿæ ¹</span>
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">searchForWorkspaceRoot</span>(dir, root)              <span class="hljs-comment">// ç»§ç»­å‘ä¸Š</span>
}
</code></pre>
<p>è¿™ç§ã€Œå‘ä¸Šæ¢æµ‹ã€çš„æ¨¡å¼åœ¨ Node.js å·¥å…·é“¾ä¸­éå¸¸å¸¸è§ï¼ˆESLintã€Prettier ä¹Ÿæ˜¯ç±»ä¼¼ç­–ç•¥ï¼‰ï¼Œskills-npm é€‰æ‹©å¤ç”¨ Vite ç»è¿‡å¤§è§„æ¨¡éªŒè¯çš„å®ç°ï¼Œæ˜¯æ˜æ™ºçš„å·¥ç¨‹å†³ç­–ã€‚</p>
<hr/>
<h3 data-id="heading-12">ä¹ã€è®¾è®¡ç²¾åä¸æŠ€æœ¯åˆ›æ–°</h3>
<p>å›é¡¾æ•´ä¸ªé¡¹ç›®ï¼Œæœ‰å‡ ä¸ªè®¾è®¡å†³ç­–å€¼å¾—ç‰¹åˆ«å…³æ³¨ï¼š</p>
<h4 data-id="heading-13">9.1 ç†å¿µåˆ›æ–°ï¼šåŸºç¡€è®¾æ–½å¤ç”¨</h4>
<p>skills-npm æ²¡æœ‰æ„å»ºæ–°çš„åˆ†å‘æ¸ é“ã€æ³¨å†Œä¸­å¿ƒæˆ–ç‰ˆæœ¬ç®¡ç†ç³»ç»Ÿã€‚å®ƒçš„åˆ›æ–°åœ¨äº <strong>è®¤çŸ¥å±‚é¢</strong> â€”â€” å°† Agent Skills çš„åˆ†å‘é—®é¢˜æ˜ å°„åˆ°å·²æœ‰çš„ npm ç”Ÿæ€ä¸Šã€‚npm çš„ç‰ˆæœ¬è¯­ä¹‰åŒ–ã€lockfile é”å®šã€ç§æœ‰ä»“åº“ã€CI/CD é›†æˆã€Monorepo æ”¯æŒâ€¦â€¦è¿™äº›ç»è¿‡åå¤šå¹´æ‰“ç£¨çš„åŸºç¡€è®¾æ–½ï¼Œskills-npm å…¨éƒ¨ç™½å«–ã€‚</p>
<h4 data-id="heading-14">9.2 å¹‚ç­‰è®¾è®¡ï¼š<code>prepare</code> è„šæœ¬å‹å¥½</h4>
<p>skills-npm è¢«è®¾è®¡ä¸ºå¯ä»¥å®‰å…¨åœ°æ”¾å…¥ <code>package.json</code> çš„ <code>prepare</code> è„šæœ¬ä¸­ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"scripts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"prepare"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"skills-npm --yes"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>æ¯æ¬¡ <code>npm install</code> åè‡ªåŠ¨æ‰§è¡Œã€‚å¹‚ç­‰æ€§ç¡®ä¿äº†é‡å¤è¿è¡Œä¸ä¼šäº§ç”Ÿå‰¯ä½œç”¨ï¼Œç¼“å­˜æœºåˆ¶é¿å…äº†ä¸å¿…è¦çš„æ‰«æå¼€é”€ã€‚</p>
<h4 data-id="heading-15">9.3 æ¨¡å—åŒ–æè‡´</h4>
<p>14 ä¸ªæºæ–‡ä»¶ï¼Œå¹³å‡æ¯ä¸ªæ–‡ä»¶ä¸è¶…è¿‡ 100 è¡Œã€‚æ¯ä¸ªæ–‡ä»¶çš„å‘½åå°±æ˜¯å®ƒçš„èŒè´£ï¼š<code>scan.ts</code> åªåšæ‰«æï¼Œ<code>symlink.ts</code> åªåšé“¾æ¥ï¼Œ<code>cache.ts</code> åªåšç¼“å­˜ã€‚ç±»å‹å®šä¹‰é›†ä¸­åœ¨ <code>types.ts</code>ï¼Œå¸¸é‡é›†ä¸­åœ¨ <code>constants.ts</code>ã€‚è¿™ç§æè‡´çš„å…³æ³¨ç‚¹åˆ†ç¦»è®©ä»£ç çš„å¯ç»´æŠ¤æ€§å’Œå¯æµ‹è¯•æ€§éƒ½è¾¾åˆ°äº†å¾ˆé«˜çš„æ°´å¹³ã€‚</p>
<hr/>
<h3 data-id="heading-16">åã€æ”¹è¿›ç©ºé—´ä¸æœªæ¥å±•æœ›</h3>
<p>ä½œä¸º v0.1.0 é˜¶æ®µçš„é¡¹ç›®ï¼Œskills-npm ä»æœ‰ä¸å°‘è¿›åŒ–ç©ºé—´ï¼š</p>








































<table><thead><tr><th>æ–¹é¢</th><th>ç°çŠ¶</th><th>æ½œåœ¨æ”¹è¿›</th></tr></thead><tbody><tr><td><strong>æ‰«ææ€§èƒ½</strong></td><td>åŒ…é€ä¸ªä¸²è¡Œæ‰«æ</td><td>ä½¿ç”¨ <code>Promise.all</code> æˆ– <code>p-limit</code> å¹¶è¡Œæ‰«æ</td></tr><tr><td><strong>é”™è¯¯æ¢å¤</strong></td><td>å¤§é‡ catch å—é™é»˜å¿½ç•¥</td><td>å¢åŠ  <code>--verbose</code> æ¨¡å¼æš´éœ²è°ƒè¯•ä¿¡æ¯</td></tr><tr><td><strong>ç¼“å­˜ç²’åº¦</strong></td><td>lockfile çº§åˆ«ï¼ˆä»»ä½•ä¾èµ–å˜åŒ–éƒ½å¤±æ•ˆï¼‰</td><td>å¯æŒ‰åŒ…çº§åˆ«åšå¢é‡ç¼“å­˜</td></tr><tr><td><strong>é“¾æ¥æ¸…ç†</strong></td><td>æ— è‡ªåŠ¨æ¸…ç†åŠŸèƒ½</td><td>å¢åŠ  <code>--clean</code> å‘½ä»¤æ¸…é™¤å¤±æ•ˆé“¾æ¥</td></tr><tr><td><strong>å®æ—¶æ›´æ–°</strong></td><td>æ—  watch æ¨¡å¼</td><td>ç›‘å¬ <code>node_modules</code> å˜åŒ–è‡ªåŠ¨æ›´æ–°</td></tr><tr><td><strong>åµŒå¥—å‘ç°</strong></td><td>ä¸æ‰«æåµŒå¥— <code>node_modules</code></td><td>é€‚é…é hoisted æ¨¡å¼çš„åŒ…ç®¡ç†ç­–ç•¥</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-17">åä¸€ã€æ€»ç»“</h3>
<p>skills-npm æ˜¯ä¸€ä¸ªå…¸å‹çš„ã€Œå°å·¥å…·ï¼Œå¤§ç†å¿µã€é¡¹ç›®ã€‚1,400 è¡Œä»£ç èƒŒåï¼Œæ˜¯å¯¹ AI Agent å·¥å…·é“¾ç”Ÿæ€çš„æ·±åˆ»è§‚å¯Ÿï¼šSkills çš„åˆ†å‘ä¸éœ€è¦æ–°çš„åŸºç¡€è®¾æ–½ï¼Œnpm å·²ç»å‡†å¤‡å¥½äº†ä¸€åˆ‡ã€‚</p>
<p>ä»æŠ€æœ¯å®ç°æ¥çœ‹ï¼Œé¡¹ç›®çš„ä»£ç è´¨é‡æé«˜ï¼šTypeScript ç±»å‹ç³»ç»Ÿè¿ç”¨è§„èŒƒã€æ¨¡å—èŒè´£åˆ’åˆ†æ¸…æ™°ã€è¾¹ç•Œå¤„ç†ï¼ˆç¬¦å·é“¾æ¥çš„å¹‚ç­‰æ€§ã€ELOOP é˜²æŠ¤ã€Windows å…¼å®¹ï¼‰æ— å¯æŒ‘å‰”ã€‚æŠ€æœ¯æ ˆé€‰å‹ä¹Ÿä½“ç°äº† Anthony Fu ä¸€è´¯çš„å“å‘³ â€”â€” <code>cac</code>ã€<code>picocolors</code>ã€<code>unconfig</code>ã€<code>tsdown</code> â€”â€” æ¯ä¸€ä¸ªéƒ½æ˜¯è½»é‡çº§ã€æ— ä¾èµ–çš„ç²¾å“å·¥å…·ã€‚</p>
<p>åœ¨ AI ç¼–ç åŠ©æ‰‹å¿«é€Ÿæ™®åŠçš„ä»Šå¤©ï¼Œskills-npm å¾ˆå¯èƒ½æˆä¸º Agent Skills åˆ†å‘é¢†åŸŸçš„äº‹å®æ ‡å‡†ã€‚æ¯•ç«Ÿï¼Œ<strong>æœ€å¥½çš„åŸºç¡€è®¾æ–½ï¼Œæ˜¯è®©ä½ æ„Ÿè§‰ä¸åˆ°å®ƒå­˜åœ¨çš„åŸºç¡€è®¾æ–½ã€‚</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å¦‚æœ JavaScript å’Œ TypeScript æ˜¯äººï¼Œä»–ä»¬ä¼šæ€ä¹ˆè°ˆæ‹çˆ±ï¼Ÿ]]></title>    <link>https://juejin.cn/post/7604786493639442459</link>    <guid>https://juejin.cn/post/7604786493639442459</guid>    <pubDate>2026-02-10T03:50:28.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604786493639442459" data-draft-id="7604694326519119923" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å¦‚æœ JavaScript å’Œ TypeScript æ˜¯äººï¼Œä»–ä»¬ä¼šæ€ä¹ˆè°ˆæ‹çˆ±ï¼Ÿ"/> <meta itemprop="keywords" content="JavaScript"/> <meta itemprop="datePublished" content="2026-02-10T03:50:28.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç¨‹åºå‘˜å°å´”æ—¥è®°"/> <meta itemprop="url" content="https://juejin.cn/user/1576048754165866"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å¦‚æœ JavaScript å’Œ TypeScript æ˜¯äººï¼Œä»–ä»¬ä¼šæ€ä¹ˆè°ˆæ‹çˆ±ï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1576048754165866/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç¨‹åºå‘˜å°å´”æ—¥è®°
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T03:50:28.000Z" title="Tue Feb 10 2026 03:50:28 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å½“JavaScriptå’ŒTypeScriptåœ¨å’–å•¡åº—ç›¸äº²ï¼šä¸€åœºå…³äº"ç±»å‹"çš„çˆ±æƒ…å–œå‰§</h2>
<h3 data-id="heading-1">ç®€ä»‹ï¼šä¸¤ä¸ªç¨‹åºå‘˜ç›¸äº²è®°</h3>
<p>æƒ³è±¡ä¸€ä¸‹ï¼Œä½ èµ°è¿›ä¸€å®¶åä¸º"ä»£ç å’–å•¡"çš„å¥‡æ€ªå’–å•¡é¦†ã€‚è§’è½é‡Œåç€ä¸¤ä½æ­£åœ¨ç›¸äº²çš„ç¨‹åºå‘˜ï¼šJavaScriptï¼ˆç®€ç§°JSï¼‰ï¼Œç©¿ç€éšæ„Tæ¤ï¼Œå¤´å‘ä¹±ç³Ÿç³Ÿï¼Œçœ‹èµ·æ¥æœ‰ç‚¹æ¼«ä¸ç»å¿ƒï¼›TypeScriptï¼ˆç®€ç§°TSï¼‰ï¼Œè¥¿è£…é©å±¥ï¼Œæˆ´ç€é‡‘ä¸çœ¼é•œï¼Œé¢å‰æ•´é½æ‘†æ”¾ç€ä¸€ä»½æ¸…å•å’Œä¸€æ”¯ç¬”ã€‚</p>
<p>JSå–äº†å£å’–å•¡ï¼š"å—¨ï¼Œæˆ‘æ˜¯ä¸ªçµæ´»çš„å•èº«æ±‰ï¼Œéšæ—¶å¯ä»¥å˜æˆä»»ä½•ä½ æƒ³è¦çš„æ ·å­ï¼"</p>
<p>TSæ¨äº†æ¨çœ¼é•œï¼š"å¾ˆé«˜å…´è®¤è¯†ä½ ã€‚åœ¨æˆ‘è€ƒè™‘è¿›ä¸€æ­¥å‘å±•å‰ï¼Œè¯·å…ˆå¡«å†™è¿™ä»½ç±»å‹å£°æ˜è¡¨ï¼ŒåŒ…æ‹¬ä½ çš„å§“åï¼ˆå­—ç¬¦ä¸²ï¼‰ã€å¹´é¾„ï¼ˆæ•°å­—ï¼‰ï¼Œä»¥åŠæ˜¯å¦æœ‰è¿‡å˜é‡é‡å®šä¹‰çš„ç»å†ï¼ˆå¸ƒå°”å€¼ï¼‰ã€‚"</p>
<p>è¿™ï¼Œå°±æ˜¯æ•…äº‹çš„å¼€ç«¯ã€‚</p>
<h3 data-id="heading-2">åŒºåˆ«ä¸è”ç³»ï¼šä¸€åœºä»£ç çº¦ä¼šå®å½•</h3>
<h4 data-id="heading-3">ç¬¬ä¸€å¹•ï¼šç‚¹å•é£æ³¢</h4>
<p>JSçœ‹äº†ä¸€çœ¼èœå•ï¼š"æˆ‘è¦ä¸€æ¯'éšä¾¿'ã€‚"</p>
<p>æœåŠ¡å‘˜å›°æƒ‘ï¼š"'éšä¾¿'æ˜¯ä»€ä¹ˆï¼Ÿ"</p>
<p>JSçœ¨çœ¨çœ¼ï¼š"è¿è¡Œæ—¶ä½ å°±çŸ¥é“äº†ï¼å¯èƒ½æ˜¯å’–å•¡ï¼Œä¹Ÿå¯èƒ½æ˜¯èŒ¶ï¼Œç”šè‡³å¯èƒ½æ˜¯æœæ±â€”â€”æƒŠå–œä¸æ˜¯æ›´ç¾å¦™å—ï¼Ÿ"</p>
<p>TSå¹äº†å£æ°”ï¼š"è¯·ç»™æˆ‘ä¸€æ¯æ— ç³–æ‹¿é“ï¼Œæ¸©åº¦70Â±2â„ƒï¼Œå’–å•¡è±†äº§åœ°å“¥ä¼¦æ¯”äºšï¼Œç‰›å¥¶è„‚è‚ªå«é‡3.5%ã€‚è¿™æ˜¯æˆ‘çš„è¯¦ç»†è®¢å•æ¥å£å£°æ˜ã€‚"</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">//Â JSçš„ç‚¹å•æ–¹å¼</span>
<span class="hljs-keyword">let</span>Â myDrinkÂ =Â <span class="hljs-string">"coffee"</span>;
myDrinkÂ =Â <span class="hljs-number">42</span>;Â <span class="hljs-comment">//Â ç°åœ¨å˜æˆæ•°å­—äº†ï¼</span>
myDrinkÂ =Â {Â <span class="hljs-attr">beverage</span>:Â <span class="hljs-string">"tea"</span>,Â <span class="hljs-attr">temp</span>:Â <span class="hljs-string">"hot"</span>Â };Â <span class="hljs-comment">//Â åˆå˜æˆå¯¹è±¡äº†ï¼</span>
<span class="hljs-comment">//Â ä¸€åˆ‡å‘ç”Ÿåœ¨è¿è¡Œæ—¶ï¼Œåƒé­”æœ¯ä¸€æ ·ï¼</span>

<span class="hljs-comment">//Â TSçš„ç‚¹å•æ–¹å¼</span>
<span class="hljs-keyword">interface</span>Â <span class="hljs-title class_">CoffeeOrder</span>Â {
Â Â <span class="hljs-attr">beverageType</span>:Â <span class="hljs-string">"latte"</span>Â |Â <span class="hljs-string">"espresso"</span>Â |Â <span class="hljs-string">"cappuccino"</span>;
Â Â <span class="hljs-attr">temperature</span>:Â <span class="hljs-built_in">number</span>;
Â Â <span class="hljs-attr">sugar</span>:Â <span class="hljs-built_in">boolean</span>;
Â Â <span class="hljs-attr">milkPercentage</span>:Â <span class="hljs-built_in">number</span>;
}

<span class="hljs-keyword">const</span>Â <span class="hljs-attr">myOrder</span>:Â <span class="hljs-title class_">CoffeeOrder</span>Â =Â {
Â Â <span class="hljs-attr">beverageType</span>:Â <span class="hljs-string">"latte"</span>,
Â Â <span class="hljs-attr">temperature</span>:Â <span class="hljs-number">70</span>,
Â Â <span class="hljs-attr">sugar</span>:Â <span class="hljs-literal">false</span>,
Â Â <span class="hljs-attr">milkPercentage</span>:Â <span class="hljs-number">100</span>
};
<span class="hljs-comment">//Â è¯•å›¾æŠŠwaterèµ‹å€¼ç»™beverageTypeï¼Ÿç¼–è¾‘å™¨ä¼šç«‹å³çº¢çº¿ä¸‹åˆ’çº¿è­¦å‘Šï¼</span>
</code></pre>
<h4 data-id="heading-4">ç¬¬äºŒå¹•ï¼šçº¦ä¼šä¸­çš„"æƒŠå–œ"</h4>
<p>JSå’ŒTSå†³å®šå»çœ‹ç”µå½±ã€‚</p>
<p>JSè¯´ï¼š"æˆ‘çŸ¥é“ä¸€å®¶å¾ˆæ£’çš„å½±é™¢ï¼Œèµ°ï¼"</p>
<p>åˆ°äº†åœ°æ–¹ï¼ŒTSæ„£ä½äº†ï¼š"è¿™æ˜¯ä¿é¾„çƒé¦†ã€‚"</p>
<p>JSæŒ å¤´ï¼š"å•Šï¼Œæˆ‘ä»¥ä¸º'å¨±ä¹åœºæ‰€'éƒ½å·®ä¸å¤šã€‚ä¸è¿‡æ²¡å…³ç³»ï¼æˆ‘ä»¬å¯ä»¥ç°åœºå†³å®šåšä»€ä¹ˆï¼"</p>
<p>TSä»åŒ…é‡Œæ‹¿å‡ºè®¡åˆ’è¡¨ï¼š"æ ¹æ®æˆ‘é¢„å…ˆçš„ç±»å‹æ£€æŸ¥ï¼Œæˆ‘ä»¬åº”è¯¥åœ¨ç¬¬15è¡—çš„å½±é™¢ï¼Œè§‚çœ‹ç±»å‹ä¸º'å–œå‰§ç‰‡'æˆ–'ç§‘å¹»ç‰‡'çš„ç”µå½±ï¼Œæ—¶é•¿ä¸è¶…è¿‡150åˆ†é’Ÿã€‚"</p>
<h4 data-id="heading-5">ç¬¬ä¸‰å¹•ï¼šè§æœ‹å‹æ—¶çš„å°´å°¬</h4>
<p>JSå¸¦ç€TSè§æœ‹å‹Pythonå’ŒJavaã€‚</p>
<p>JSå¤§å£°ä»‹ç»ï¼š"è¿™æ˜¯TSï¼Œæˆ‘çš„...å‘ƒ...æœ‹å‹ï¼ŸåŒäº‹ï¼Ÿå·¥å…·ï¼Ÿåæ­£æˆ‘ä»¬ä¸€èµ·å†™ä»£ç ï¼"</p>
<p>Pythonå°å£°è¯´ï¼š"æ‰€ä»¥ä½ ä»¬çš„å…³ç³»ç±»å‹æ˜¯'any'ï¼Ÿ"</p>
<p>Javaç‚¹å¤´ï¼š"éœ€è¦æˆ‘æ¥å¼ºåˆ¶è½¬æ¢ä¸€ä¸‹å…³ç³»ç±»å‹å—ï¼Ÿ"</p>
<p>TSå¹³é™åœ°è¯´ï¼š"ç¡®åˆ‡åœ°è¯´ï¼Œæˆ‘ä»¬æ˜¯æ¸è¿›å¼ç±»å‹ç³»ç»Ÿçš„ä¼™ä¼´å…³ç³»ã€‚æˆ‘æ˜¯JSçš„è¶…é›†ï¼Œåœ¨å¼€å‘é˜¶æ®µæä¾›ç±»å‹å®‰å…¨ï¼Œä½†æœ€ç»ˆä¼šç¼–è¯‘æˆçº¯JSè¿è¡Œã€‚"</p>
<p>å…¨åœºæ²‰é»˜ä¸‰ç§’ã€‚</p>
<p>JSæ‰“ç ´å°´å°¬ï¼š"ä»–è¯´çš„æ˜¯'æˆ‘ä»¬å¾ˆé…'çš„æ„æ€å•¦ï¼å°±åƒJSONå’Œå¯¹è±¡å­—é¢é‡é‚£ä¹ˆé…ï¼"</p>
<h3 data-id="heading-6">è”ç³»ï¼šä»–ä»¬å…¶å®æ˜¯äº²æˆšï¼</h3>
<p>äº‹å®ä¸Šï¼ŒTSæ‚„æ‚„å¯¹JSè¯´ï¼š"æœ‰ä»¶äº‹å¾—å‘Šè¯‰ä½ â€”â€”æˆ‘å…¶å®å°±æ˜¯ä½ ï¼Œåªæ˜¯å¤šäº†äº›'è§„çŸ©'ã€‚"</p>
<p>JSæƒŠè®¶ï¼š"ä»€ä¹ˆï¼Ÿ"</p>
<p>TSè§£é‡Šï¼š"å’±ä»¬æœ¬è´¨ä¸Šæ˜¯ä¸€å®¶äººã€‚ä½ å†™çš„æ‰€æœ‰ä»£ç ï¼Œæˆ‘éƒ½èƒ½ç†è§£ã€‚è€Œæˆ‘çš„ä»£ç ï¼Œæœ€ç»ˆéƒ½ä¼šå˜æˆä½ çš„æ ·å­è¿è¡Œã€‚æˆ‘æ˜¯ä½ çš„'å¼€å‘æ—¶ä¿é•–'ï¼Œç¡®ä¿ä½ ä¸ä¼šåœ¨è¿è¡Œæ—¶æ‘”è·¤ã€‚"</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">//Â TSå†™çš„ä»£ç </span>
<span class="hljs-keyword">function</span>Â <span class="hljs-title function_">greet</span>(<span class="hljs-params">name:Â string</span>):Â stringÂ {
Â Â <span class="hljs-keyword">return</span>Â <span class="hljs-string">`Hello,Â <span class="hljs-subst">${name}</span>!`</span>;
}

<span class="hljs-comment">//Â ç¼–è¯‘åä¼šå˜æˆJSè®¤è¯†çš„ä»£ç </span>
<span class="hljs-keyword">function</span>Â <span class="hljs-title function_">greet</span>(<span class="hljs-params">name</span>)Â {
Â Â <span class="hljs-keyword">return</span>Â <span class="hljs-string">"Hello,Â "</span>Â +Â nameÂ +Â <span class="hljs-string">"!"</span>;
}
<span class="hljs-comment">//Â çœ‹ï¼Œæˆ‘ä»¬éª¨å­é‡Œæ˜¯ä¸€æ ·çš„ï¼</span>
</code></pre>
<h4 data-id="heading-7">é‚£ä¸ªå†³å®šæ€§çš„æ‹¥æŠ±</h4>
<p>é¡¹ç›®æˆªæ­¢å‰å¤œï¼ŒJSçš„ä»£ç çªç„¶åœ¨å‡Œæ™¨3ç‚¹å´©æºƒã€‚</p>
<p>JSç»æœ›åœ°å‘ç°ï¼šä¸€ä¸ªåº”è¯¥æ˜¯æ•°ç»„çš„å˜é‡ä¸çŸ¥ä½•æ—¶å˜æˆäº†å­—ç¬¦ä¸²ï¼Œæ•´ä¸ªåº”ç”¨åƒå¤šç±³è¯ºéª¨ç‰Œä¸€æ ·å€’ä¸‹ã€‚</p>
<p>è¿™æ—¶TSå‡ºç°äº†ï¼Œå¸¦ç€æ¸…æ™°çš„é”™è¯¯ä¿¡æ¯ï¼š"ç¬¬247è¡Œï¼šç±»å‹'string'ä¸Šä¸å­˜åœ¨å±æ€§'map'ã€‚å»ºè®®ï¼šç¡®ä¿å˜é‡åœ¨æ­¤å¤„ä¸ºæ•°ç»„ç±»å‹ã€‚"</p>
<p>JSä¿®å¤äº†bugï¼Œçœ‹ç€TSï¼š"ä½ ä¸€ç›´éƒ½çŸ¥é“è¿™é‡Œä¼šå‡ºé—®é¢˜ï¼Ÿ"</p>
<p>TSç‚¹å¤´ï¼š"ä»ä½ å†™ä¸‹ä»£ç çš„é‚£ä¸€åˆ»å°±çŸ¥é“ã€‚ä½†ä½ æœ‰'any'çš„æƒåŠ›ï¼Œæˆ‘åªèƒ½å»ºè®®ï¼Œä¸èƒ½å¼ºåˆ¶ã€‚"</p>
<p>JSæ²‰æ€ï¼š"ä¹Ÿè®¸...æœ‰æ—¶å€™æƒŠå–œä¸å¦‚ç¨³å®šæ¥å¾—é‡è¦ï¼Ÿ"</p>
<h3 data-id="heading-8">æ€»ç»“ï¼šä¸æ˜¯å–ä»£ï¼Œè€Œæ˜¯è¿›åŒ–</h3>
<p>æ‰€ä»¥ï¼ŒJavaScriptå’ŒTypeScriptåˆ°åº•æ˜¯ä»€ä¹ˆå…³ç³»ï¼Ÿ</p>
<h4 data-id="heading-9">1. <strong>è‰ºæœ¯å®¶ vs å»ºç­‘å¸ˆ</strong></h4>
<ul>
<li>JSæ˜¯å³å…´åˆ›ä½œçš„è¡—å¤´è‰ºæœ¯å®¶</li>
<li>TSæ˜¯å¸¦ç€è“å›¾çš„å»ºç­‘å¸ˆ</li>
<li>ä¸¤è€…éƒ½èƒ½é€ å‡ºæˆ¿å­ï¼Œä½†ä¸€ä¸ªå¯èƒ½é€ å‡ºæ¢¦å¹»æ ‘å±‹ï¼Œå¦ä¸€ä¸ªåˆ™ç¡®ä¿æˆ¿å­ç¬¦åˆå®‰å…¨è§„èŒƒ</li>
</ul>
<h4 data-id="heading-10">2. <strong>"å…ˆåšåæƒ³" vs "å…ˆæƒ³ååš"</strong></h4>
<ul>
<li>JSå–œæ¬¢å¿«é€ŸåŸå‹</li>
<li>TSå–œæ¬¢æå‰è§„åˆ’</li>
<li>å¤§å‹é¡¹ç›®å¸¸å¸¸éœ€è¦ä¸¤è€…ç»“åˆâ€”â€”ç”¨TSæ­å»ºç¨³å›ºæ¡†æ¶ï¼Œç”¨JSå¿«é€Ÿè¯•éªŒæ–°æƒ³æ³•</li>
</ul>
<h4 data-id="heading-11">3. <strong>æœ€ç»ˆéƒ½æ˜¯ä¸€å®¶äºº</strong></h4>
<ul>
<li>æ‰€æœ‰TSä»£ç æœ€ç»ˆéƒ½ä¼š"å˜èº«"ä¸ºJSè¿è¡Œ</li>
<li>TSå°±åƒæ˜¯JSçš„"è®­ç»ƒè½®"ï¼Œç­‰ä½ ç†Ÿæ‚‰äº†ç±»å‹ç³»ç»Ÿï¼Œç”šè‡³å¯ä»¥é€æ¸æ‹†é™¤</li>
</ul>
<h4 data-id="heading-12">4. <strong>å¹½é»˜çš„çœŸç›¸</strong></h4>
<ul>
<li>ä½¿ç”¨JSå°±åƒåœ¨è¯´"ç›¸ä¿¡æˆ‘ï¼Œæˆ‘çŸ¥é“æˆ‘åœ¨åšä»€ä¹ˆ"</li>
<li>ä½¿ç”¨TSåˆ™åƒåœ¨è¯´"æˆ‘ä¸å®Œå…¨ç›¸ä¿¡è‡ªå·±ï¼Œæ‰€ä»¥è®©ç¼–è¯‘å™¨åŒé‡æ£€æŸ¥ä¸€ä¸‹"</li>
</ul>
<p>æœ€ç»ˆï¼ŒJSå’ŒTSåœ¨ä»£ç å’–å•¡åº—è¾¾æˆäº†å’Œè§£ã€‚JSå­¦ä¼šäº†å¶å°”æ¥å—ç±»å‹å»ºè®®ï¼ŒTSå­¦ä¼šäº†å®¹å¿ä¸€äº›"any"çš„çµæ´»æ€§ã€‚ä»–ä»¬å…±åŒåˆ›å»ºäº†ä¸€ä¸ªé¡¹ç›®ï¼šä¸€ä¸ªåœ¨å¼€å‘é˜¶æ®µä¸¥æ ¼ç±»å‹æ£€æŸ¥ï¼Œä½†åœ¨æŸäº›å°æ¨¡å—ä¿ç•™JSçµæ´»æ€§çš„æ··åˆåº”ç”¨ã€‚</p>
<p>å°±åƒå’–å•¡åº—è€æ¿è¯´çš„ï¼š"çº¯é»‘å’–å•¡æç¥ï¼ŒåŠ å¥¶åŠ ç³–å¥½å…¥å£ã€‚å…³é”®æ˜¯çŸ¥é“è‡ªå·±ä»€ä¹ˆæ—¶å€™éœ€è¦ä»€ä¹ˆã€‚"</p>
<p>è€Œè§’è½é‡Œï¼Œä¸€ä¸ªæ–°æ¥çš„è¯­è¨€å«Rustæ­£åœ¨ç‚¹å•ï¼š"æˆ‘è¦ä¸€æ¯ç»å¯¹å†…å­˜å®‰å…¨çš„é¥®æ–™ï¼Œæ‰€æœ‰æƒæ˜ç¡®ï¼Œé›¶æˆæœ¬æŠ½è±¡..."</p>
<p>ä½†é‚£æ˜¯å¦ä¸€ä¸ªæ•…äº‹äº†ã€‚</p>
<hr/>
<h3 data-id="heading-13">é™„å½•ï¼šå¿«é€Ÿå¯¹æ¯”è¡¨</h3>








































<table><thead><tr><th>ç‰¹æ€§</th><th>JavaScript</th><th>TypeScript</th></tr></thead><tbody><tr><td>ç±»å‹ç³»ç»Ÿ</td><td>åŠ¨æ€ç±»å‹</td><td>é™æ€ç±»å‹ï¼ˆå¯é€‰çš„ï¼‰</td></tr><tr><td>é”™è¯¯å‘ç°æ—¶é—´</td><td>è¿è¡Œæ—¶</td><td>ç¼–è¯‘æ—¶</td></tr><tr><td>å­¦ä¹ æ›²çº¿</td><td>ç›¸å¯¹å¹³ç¼“</td><td>éœ€è¦é¢å¤–å­¦ä¹ ç±»å‹ç³»ç»Ÿ</td></tr><tr><td>çµæ´»æ€§</td><td>æé«˜</td><td>é«˜ï¼Œä½†æœ‰çº¦æŸ</td></tr><tr><td>é€‚åˆé¡¹ç›®</td><td>å°å‹é¡¹ç›®ã€åŸå‹ã€è„šæœ¬</td><td>å¤§å‹é¡¹ç›®ã€å›¢é˜Ÿåä½œã€é•¿æœŸç»´æŠ¤</td></tr><tr><td>æµè¡Œæ¡†æ¶</td><td>Reactã€Vueã€Node.js</td><td>Angularã€React+TSã€Vue+TS</td></tr></tbody></table>
<hr/>
<p><strong>åè®°</strong>ï¼šæ— è®ºä½ é€‰æ‹©JSçš„çµæ´»è¿˜æ˜¯TSçš„ä¸¥è°¨ï¼Œè®°ä½æœ€å¥½çš„ä»£ç ä¸æ˜¯æœ€èªæ˜çš„ï¼Œè€Œæ˜¯å…­ä¸ªæœˆåä½ ï¼ˆæˆ–åŒäº‹ï¼‰è¿˜èƒ½çœ‹æ‡‚çš„é‚£ä¸€äº›ã€‚æ¯•ç«Ÿï¼Œåœ¨ç¼–ç¨‹ä¸–ç•Œé‡Œï¼Œèƒ½è®©ä½ å°‘ç†¬å¤œçš„æŠ€æœ¯ï¼Œæ‰æ˜¯çœŸçˆ±çš„æŠ€æœ¯ã€‚</p>
<hr/>
<p><em>æ–‡ç« å­—æ•°ï¼šçº¦1200å­—</em><br/>
<em>å»ºè®®é˜…è¯»æ—¶é—´ï¼š5-7åˆ†é’Ÿ</em><br/>
<em>æŠ€æœ¯éš¾åº¦ï¼šåˆçº§åˆ°ä¸­çº§</em><br/>
<em>å¹½é»˜æŒ‡æ•°ï¼šâ˜•â˜•â˜•â˜• (4/5æ¯å’–å•¡)</em></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Koin ä¾èµ–æ³¨å…¥æ·±åº¦è§£æï¼šSingleã€Factory ä¸ Scoped åˆ°åº•æ€ä¹ˆé€‰ï¼Ÿ]]></title>    <link>https://juejin.cn/post/7604666872128077843</link>    <guid>https://juejin.cn/post/7604666872128077843</guid>    <pubDate>2026-02-10T03:22:49.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604666872128077843" data-draft-id="7604693038440136710" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Koin ä¾èµ–æ³¨å…¥æ·±åº¦è§£æï¼šSingleã€Factory ä¸ Scoped åˆ°åº•æ€ä¹ˆé€‰ï¼Ÿ"/> <meta itemprop="keywords" content="Android,Kotlin"/> <meta itemprop="datePublished" content="2026-02-10T03:22:49.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Ehtan_Zheng"/> <meta itemprop="url" content="https://juejin.cn/user/413072099642478"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Koin ä¾èµ–æ³¨å…¥æ·±åº¦è§£æï¼šSingleã€Factory ä¸ Scoped åˆ°åº•æ€ä¹ˆé€‰ï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/413072099642478/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Ehtan_Zheng
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T03:22:49.000Z" title="Tue Feb 10 2026 03:22:49 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨ Kotlin çš„ä¸–ç•Œé‡Œï¼ŒKoin ä»¥å…¶â€œæ— åå°„ã€æç®€ DSLâ€çš„ç‰¹æ€§è®©å¼€å‘è€…å€æ„Ÿå¹¸ç¦ã€‚ä½†è¦ç”¨å¥½ Koinï¼Œç†è§£å…¶ä¸‰å¤§æ ¸å¿ƒå®šä¹‰ç±»å‹ï¼š<strong><code>single</code></strong>ã€<strong><code>factory</code></strong> ä¸ <strong><code>scoped</code></strong> æ˜¯å¿…ä¿®è¯¾ã€‚</p>
<hr/>
<h2 data-id="heading-0">ä¸€ã€ <code>single</code>ï¼šå…¨å±€å”¯ä¸€çš„å•ä¾‹ (Singleton)</h2>
<p><code>single</code> æ˜¯ Koin ä¸­æœ€å¸¸ç”¨çš„å®šä¹‰æ–¹å¼ã€‚</p>
<ul>
<li>
<p><strong>æœ¬è´¨</strong>ï¼šåœ¨æ•´ä¸ª Koin å®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸå†…ï¼ˆé€šå¸¸æ˜¯åº”ç”¨çš„ç”Ÿå‘½å‘¨æœŸï¼‰ï¼Œè¯¥å®šä¹‰çš„å®ä¾‹åªä¼šè¢«åˆ›å»º<strong>ä¸€æ¬¡</strong>ã€‚åç»­æ‰€æœ‰çš„æ³¨å…¥è¯·æ±‚éƒ½ä¼šè¿”å›åŒä¸€ä¸ªå¯¹è±¡ã€‚</p>
</li>
<li>
<p><strong>ç”Ÿå‘½å‘¨æœŸ</strong>ï¼šä¸åº”ç”¨è¿›ç¨‹å…±å­˜äº¡ã€‚</p>
</li>
<li>
<p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼š</p>
<ul>
<li><strong>Repository å±‚</strong>ï¼šæ•°æ®ä»“åº“é€šå¸¸ä¸éœ€è¦é‡å¤åˆ›å»ºã€‚</li>
<li><strong>ç½‘ç»œæ¨¡å—</strong>ï¼šå¦‚ Retrofit å®ä¾‹ã€OkHttpClientã€‚</li>
<li><strong>æœ¬åœ°æ•°æ®åº“</strong>ï¼šå¦‚ Room æ•°æ®åº“å®ä¾‹ã€‚</li>
</ul>
</li>
</ul>
<p><strong>ä»£ç ç¤ºä¾‹ï¼š</strong></p>
<p>Kotlin</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">val</span> <span class="hljs-variable">appModule</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">module</span> {
    <span class="hljs-comment">// æ•´ä¸ªåº”ç”¨è¿è¡ŒæœŸé—´ï¼Œåªæœ‰ä¸€ä¸ª UserRepository å®ä¾‹</span>
    single { UserRepository(get()) }
}
</code></pre>
<hr/>
<h2 data-id="heading-1">äºŒã€ <code>factory</code>ï¼šæŒ‰éœ€åˆ›å»ºçš„å·¥å‚ (Factory)</h2>
<p>ä¸ <code>single</code> ç›¸åï¼Œ<code>factory</code> æ¯æ¬¡éƒ½ä¼šç»™ä½ æä¾›ä¸€ä¸ªâ€œå…¨æ–°çš„â€å¯¹è±¡ã€‚</p>
<ul>
<li>
<p><strong>æœ¬è´¨</strong>ï¼šæ¯æ¬¡è¿›è¡Œæ³¨å…¥ï¼ˆé€šè¿‡ <code>inject()</code> æˆ– <code>get()</code>ï¼‰æ—¶ï¼ŒKoin éƒ½ä¼šæ‰§è¡Œä¸€æ¬¡ä»£ç å—ï¼Œåˆ›å»ºä¸€ä¸ª<strong>æ–°çš„å®ä¾‹</strong>ã€‚</p>
</li>
<li>
<p><strong>ç”Ÿå‘½å‘¨æœŸ</strong>ï¼šKoin ä¸è´Ÿè´£ä¿å­˜è¿™ä¸ªå®ä¾‹ï¼Œå®ƒçš„ç”Ÿå‘½å‘¨æœŸç”±è°ƒç”¨è€…å†³å®šï¼ˆä¾‹å¦‚è¢«èµ‹å€¼ç»™æŸä¸ªå±€éƒ¨å˜é‡ï¼‰ã€‚</p>
</li>
<li>
<p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼š</p>
<ul>
<li><strong>ä¸´æ—¶çš„ UI é€»è¾‘ç±»</strong>ï¼šä¸éœ€è¦æŒä¹…åŒ–çŠ¶æ€çš„å°å·¥å…·ã€‚</li>
<li><strong>å…·æœ‰çŠ¶æ€çš„å¯¹è±¡</strong>ï¼šä½ ä¸å¸Œæœ›ä¸åŒé¡µé¢å…±äº«åŒä¸€ä¸ªçŠ¶æ€çš„å¯¹è±¡ã€‚</li>
</ul>
</li>
</ul>
<p><strong>ä»£ç ç¤ºä¾‹ï¼š</strong></p>
<p>Kotlin</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">val</span> <span class="hljs-variable">appModule</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">module</span> {
    <span class="hljs-comment">// æ¯æ¬¡æ³¨å…¥éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ Presenter å®ä¾‹</span>
    factory { UserPresenter(get()) }
}
</code></pre>
<hr/>
<h2 data-id="heading-2">ä¸‰ã€ <code>scoped</code>ï¼šå—æ§çš„ä½œç”¨åŸŸ (Scoped)</h2>
<p>è¿™æ˜¯ Koin ä¸­æœ€å¼ºå¤§ä½†ä¹Ÿæœ€å®¹æ˜“è¢«è¯¯è§£çš„éƒ¨åˆ†ã€‚å®ƒä»‹äº <code>single</code> å’Œ <code>factory</code> ä¹‹é—´ã€‚</p>
<ul>
<li>
<p><strong>æœ¬è´¨</strong>ï¼šå®ä¾‹åœ¨ä¸€ä¸ªç‰¹å®šçš„**ä½œç”¨åŸŸï¼ˆScopeï¼‰**å†…æ˜¯å”¯ä¸€çš„ã€‚å½“ä½œç”¨åŸŸå¼€å¯æ—¶åˆ›å»ºï¼Œå½“ä½œç”¨åŸŸå…³é—­ï¼ˆå¦‚ Activity é”€æ¯ï¼‰æ—¶ï¼Œè¯¥å®ä¾‹ä¹Ÿä¼šéšä¹‹é”€æ¯ã€‚</p>
</li>
<li>
<p><strong>ç”Ÿå‘½å‘¨æœŸ</strong>ï¼šç»‘å®šåˆ°ç‰¹å®šçš„ç»„ä»¶ç”Ÿå‘½å‘¨æœŸã€‚</p>
</li>
<li>
<p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼š</p>
<ul>
<li><strong>åˆ†æ­¥è¡¨å•/å‘å¯¼ç•Œé¢</strong>ï¼šåœ¨ 3 ä¸ª Fragment ä¹‹é—´å…±äº«æ•°æ®ï¼Œä½†ä¸€æ—¦é€€å‡ºè¯¥æµç¨‹ï¼Œæ•°æ®åº”ç«‹å³æ¸…é™¤ã€‚</li>
<li><strong>Activity ä¸“æœ‰æ•°æ®</strong>ï¼šåªåœ¨æŸä¸ªç‰¹å®šé¡µé¢åŠå…¶å†…éƒ¨å­ç»„ä»¶ä¸­å…±äº«ã€‚</li>
</ul>
</li>
</ul>
<p><strong>ä»£ç ç¤ºä¾‹ï¼š</strong></p>
<p>Kotlin</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">val</span> <span class="hljs-variable">appModule</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">module</span> {
    <span class="hljs-comment">// å®šä¹‰ä¸€ä¸ªä½œç”¨åŸŸ</span>
    scope&lt;MyActivity&gt; {
        <span class="hljs-comment">// åœ¨ MyActivity çš„ç”Ÿå‘½å‘¨æœŸå†…ï¼Œè¯¥å®ä¾‹æ˜¯å•ä¾‹</span>
        scoped { UserSession() }
    }
}
</code></pre>
<hr/>
<h2 data-id="heading-3">å››ã€ æ ¸å¿ƒå·®å¼‚å¯¹æ¯”è¡¨</h2>



































<table><thead><tr><th><strong>ç‰¹æ€§</strong></th><th><strong>single</strong></th><th><strong>factory</strong></th><th><strong>scoped</strong></th></tr></thead><tbody><tr><td><strong>å®ä¾‹æ•°é‡</strong></td><td>å…¨å±€åªæœ‰ä¸€ä¸ª</td><td>æ¯æ¬¡è¯·æ±‚éƒ½æœ‰ä¸€ä¸ªæ–°å®ä¾‹</td><td>ä½œç”¨åŸŸå†…å”¯ä¸€</td></tr><tr><td><strong>å†…å­˜å ç”¨</strong></td><td>æŒç»­å ç”¨ï¼Œç›´åˆ°åº”ç”¨å…³é—­</td><td>ç¬æ—¶å ç”¨ï¼Œéšç”¨éšå…³</td><td>éšä½œç”¨åŸŸç”Ÿå‘½å‘¨æœŸé‡Šæ”¾</td></tr><tr><td><strong>å®ä¾‹å…±äº«</strong></td><td>å…¨å±€å…±äº«</td><td>ä¸å…±äº«</td><td>ä»…åœ¨å½“å‰ä½œç”¨åŸŸå†…å…±äº«</td></tr><tr><td><strong>æ¨èç”¨é€”</strong></td><td>æ•°æ®åº“ã€API å®¢æˆ·ç«¯ã€Repo</td><td>å·¥å…·ç±»ã€ç¬æ—¶æ•°æ®å¤„ç†</td><td>é¡µé¢ç§æœ‰é€»è¾‘ã€åˆ†æ­¥ä»»åŠ¡æµ</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-4">äº”ã€ é¿å‘ä¸æœ€ä½³å®è·µ</h2>
<ol>
<li><strong>å…³äº ViewModel</strong>ï¼šåœ¨ Android ä¸­ï¼ŒKoin æä¾›äº†ä¸“ç”¨çš„ <code>viewModel { ... }</code> å…³é”®å­—ã€‚å®ƒçš„è¡Œä¸ºç±»ä¼¼äº <code>factory</code>ï¼Œä½†ç”±ç³»ç»Ÿçš„ <code>ViewModelProvider</code> æ‰˜ç®¡ï¼Œç¡®ä¿åœ¨é…ç½®æ›´æ”¹ï¼ˆå¦‚æ—‹è½¬å±å¹•ï¼‰æ—¶å®ä¾‹ä¸è¢«é”€æ¯ã€‚</li>
<li><strong>é¿å…æ»¥ç”¨ <code>single</code></strong>ï¼šè™½ç„¶ <code>single</code> å¾ˆçœäº‹ï¼Œä½†å¦‚æœæŠŠå¤ªå¤šå…·æœ‰çŠ¶æ€çš„é€»è¾‘ç±»å®šä¹‰ä¸ºå•ä¾‹ï¼Œä¼šå¯¼è‡´å†…å­˜ç§¯å‹ï¼Œç”šè‡³å‡ºç°â€œé€€å‡ºç™»å½•åæ•°æ®æœªæ¸…ç†â€çš„è¯¡å¼‚ Bugã€‚</li>
<li><strong>Scoped çš„è‡ªåŠ¨é‡Šæ”¾</strong>ï¼šåœ¨ Android ä¸­ä½¿ç”¨ <code>scoped</code> æ—¶ï¼Œå»ºè®®é…åˆ <code>ActivityScope</code> æˆ– <code>FragmentScope</code> çš„æ‰©å±•ï¼Œè¿™æ · Koin èƒ½åœ¨ç»„ä»¶ <code>onDestroy()</code> æ—¶è‡ªåŠ¨å¸®ä½ å›æ”¶èµ„æºï¼Œé¿å…å†…å­˜æ³„æ¼ã€‚</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[HEIF ä¸ AVIF å¦‚ä½•è®© Android å­˜å‚¨å‡åŠ]]></title>    <link>https://juejin.cn/post/7604693038440382470</link>    <guid>https://juejin.cn/post/7604693038440382470</guid>    <pubDate>2026-02-10T03:46:58.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604693038440382470" data-draft-id="7604693038440202246" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="HEIF ä¸ AVIF å¦‚ä½•è®© Android å­˜å‚¨å‡åŠ"/> <meta itemprop="keywords" content="Android"/> <meta itemprop="datePublished" content="2026-02-10T03:46:58.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Ehtan_Zheng"/> <meta itemprop="url" content="https://juejin.cn/user/413072099642478"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            HEIF ä¸ AVIF å¦‚ä½•è®© Android å­˜å‚¨å‡åŠ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/413072099642478/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Ehtan_Zheng
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T03:46:58.000Z" title="Tue Feb 10 2026 03:46:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨ Android å¼€å‘çš„æ€§èƒ½ä¼˜åŒ–æ¸…å•ä¸­ï¼Œâ€œå›¾ç‰‡å‹ç¼©â€å§‹ç»ˆæ˜¯ç»•ä¸å¼€çš„æ ¸å¿ƒã€‚é•¿æœŸä»¥æ¥ï¼Œæˆ‘ä»¬ä¹ æƒ¯äºåœ¨ JPEG çš„è´¨é‡å’Œä½“ç§¯ä¹‹é—´èµ°é’¢ä¸ã€‚ç„¶è€Œï¼Œéšç€ <strong>HEIF</strong> å’Œ <strong>AVIF</strong> ç­‰ç°ä»£æ ¼å¼çš„æˆç†Ÿï¼Œè¿™åœºå¹³è¡¡æ¸¸æˆæ­£åœ¨å‘ç”Ÿè´¨å˜ï¼šæˆ‘ä»¬å¯ä»¥åœ¨ä¸æŸå¤±ç”»è´¨çš„å‰æä¸‹ï¼Œå°†æ–‡ä»¶ä½“ç§¯ç¼©å° 50% ç”šè‡³æ›´å¤šã€‚</p>
<hr/>
<h2 data-id="heading-0">ä¸€ã€ ä¸ºä»€ä¹ˆ JPEG è¯¥â€œé€€ä¼‘â€äº†ï¼Ÿ</h2>
<p>JPEG è¯ç”Ÿäº 1992 å¹´ã€‚åœ¨é‚£ä¸ªæ‹¨å·ä¸Šç½‘çš„æ—¶ä»£ï¼Œå®ƒæ˜¯ä¼Ÿå¤§çš„å‘æ˜ã€‚ä½†åœ¨ 30 å¹´åçš„ä»Šå¤©ï¼Œå®ƒçš„å‹ç¼©ç®—æ³•åœ¨é¢å¯¹é«˜åŠ¨æ€èŒƒå›´ï¼ˆHDRï¼‰å’Œé«˜åˆ†è¾¨ç‡å›¾åƒæ—¶æ˜¾å¾—åŠ›ä¸ä»å¿ƒï¼š</p>
<ul>
<li><strong>å‹ç¼©æ•ˆç‡ä½</strong>ï¼šç›¸åŒç”»è´¨ä¸‹ï¼Œä½“ç§¯è¿œå¤§äºç°ä»£æ ¼å¼ã€‚</li>
<li><strong>ä¸æ”¯æŒé€æ˜åº¦</strong>ï¼šä¸ºäº†é€æ˜æ•ˆæœï¼Œæˆ‘ä»¬ä¸å¾—ä¸è½¬è€Œä½¿ç”¨ä½“ç§¯è‡ƒè‚¿çš„ PNGã€‚</li>
<li><strong>è¾¹ç¼˜ä¼ªå½±</strong>ï¼šåœ¨é«˜å‹ç¼©æ¯”ä¸‹ï¼Œç‰©ä½“è¾¹ç¼˜ä¼šå‡ºç°æ˜æ˜¾çš„â€œå™ªå£°â€ã€‚</li>
</ul>
<hr/>
<h2 data-id="heading-1">äºŒã€ ç°ä»£å›¾åƒæ ¼å¼çš„åŒå­æ˜Ÿ</h2>
<h3 data-id="heading-2">1. HEIF (High Efficiency Image File Format)</h3>
<p>åŸºäº HEVC (H.265) è§†é¢‘ç¼–ç æŠ€æœ¯ã€‚</p>
<ul>
<li><strong>ä¼˜åŠ¿</strong>ï¼šåœ¨ç›¸åŒç”»è´¨ä¸‹ï¼Œä½“ç§¯ä»…ä¸º JPEG çš„ <strong>50%</strong> ã€‚å®ƒæ”¯æŒ 10 ä½è‰²æ·±ã€é€æ˜é€šé“å’Œåºåˆ—å¸§ï¼ˆç±»ä¼¼äºé«˜ç”»è´¨çš„ GIFï¼‰ã€‚</li>
<li><strong>Android æ”¯æŒ</strong>ï¼šAndroid 8.0+ (API 26) å¼€å§‹æ”¯æŒé˜…è¯»ï¼ŒAndroid 9.0+ æ”¯æŒå†™å…¥ã€‚</li>
<li><strong>ç¡¬ä»¶åŠ é€Ÿ</strong>ï¼šè®¸å¤šç°ä»£ Android èŠ¯ç‰‡ï¼ˆå¦‚é«˜é€šéªé¾™ï¼‰å†…ç½®äº† HEVC ç¡¬è§£ç ï¼Œé€Ÿåº¦æå¿«ã€‚</li>
</ul>
<h3 data-id="heading-3">2. AVIF (AV1 Image File Format)</h3>
<p>åŸºäºå¼€æºçš„ AV1 è§†é¢‘ç¼–ç ï¼Œç”± Googleã€Netflix ç­‰å·¨å¤´æ¨åŠ¨ã€‚</p>
<ul>
<li><strong>ä¼˜åŠ¿</strong>ï¼šå®ƒæ˜¯ç›®å‰çš„â€œå‹ç¼©ä¹‹ç‹â€ã€‚åœ¨æä½å¸¦å®½ä¸‹ï¼ŒAVIF çš„ç»†èŠ‚ä¿ç•™èƒ½åŠ›ç”šè‡³è¶…è¿‡äº† WebP å’Œ HEIFã€‚å®ƒæ˜¯å¼€æºä¸”å…ç‰ˆç¨çš„ã€‚</li>
<li><strong>Android æ”¯æŒ</strong>ï¼šAndroid 12+ (API 31) å·²åŸç”Ÿæ”¯æŒã€‚</li>
</ul>
<hr/>
<h2 data-id="heading-4">ä¸‰ã€ æ ¸å¿ƒæ”¶ç›Šï¼šä¸ä»…ä»…æ˜¯çœç©ºé—´</h2>
<p>é€šè¿‡è¿ç§»åˆ° HEIF/AVIFï¼Œä½ çš„ App å°†è·å¾—ä»¥ä¸‹ç›´æ¥æ”¶ç›Šï¼š</p>
<ol>
<li><strong>APK ç˜¦èº«</strong>ï¼šå†…ç½®èµ„æºå›¾ç›´æ¥å‡åŠï¼Œé™ä½ç”¨æˆ·çš„ä¸‹è½½é—¨æ§›å’Œç•™å­˜æµå¤±ã€‚</li>
<li><strong>å¸¦å®½æˆæœ¬é™ä½</strong>ï¼šå¯¹äºäº‘å­˜å‚¨å’Œ CDN æœåŠ¡å•†æ¥è¯´ï¼Œæµé‡æ”¯å‡ºå°†å¤§å¹…ç¼©å‡ã€‚</li>
<li><strong>åŠ è½½é€Ÿåº¦æå‡</strong>ï¼šæ›´å°çš„æ–‡ä»¶æ„å‘³ç€æ›´å¿«çš„ I/O å’Œæ›´çŸ­çš„ç½‘ç»œä¼ è¾“è€—æ—¶ï¼ŒUI æ¸²æŸ“æ›´ä¸æ»‘ã€‚</li>
<li><strong>æ›´å¥½çš„è§†è§‰è´¨é‡</strong>ï¼šæ”¯æŒé«˜ä½æ·±ï¼Œè§£å†³å›¾åƒåœ¨æ¸å˜åŒºåŸŸçš„â€œæ–­å±‚â€ç°è±¡ã€‚</li>
</ol>
<hr/>
<h2 data-id="heading-5">å››ã€ å¦‚ä½•åœ¨ Android ä¸­è½åœ°ï¼Ÿ</h2>
<h3 data-id="heading-6">1. æ£€æŸ¥å…¼å®¹æ€§</h3>
<p>è™½ç„¶ç°ä»£æ ¼å¼å¼ºå¤§ï¼Œä½†ä»éœ€å¤„ç†ç‰ˆæœ¬å·®å¼‚ã€‚å»ºè®®åœ¨æœåŠ¡ç«¯è¿›è¡Œé€»è¾‘åˆ¤æ–­ï¼š</p>
<ul>
<li><strong>Android 12+</strong> ï¼šä¼˜å…ˆæ¨ <strong>AVIF</strong>ã€‚</li>
<li><strong>Android 8.0 - 11</strong>ï¼šä¼˜å…ˆæ¨ <strong>HEIF</strong>ã€‚</li>
<li><strong>è€æ—§ç‰ˆæœ¬</strong>ï¼šé™çº§ä½¿ç”¨ WebP æˆ–ä¼˜åŒ–è¿‡çš„ JPEGã€‚</li>
</ul>
<h3 data-id="heading-7">2. ä½¿ç”¨ HeifWriter</h3>
<p>å¯¹äºéœ€è¦æœ¬åœ°ä¿å­˜å›¾ç‰‡çš„åœºæ™¯ï¼ŒAndroid æä¾›äº† <code>HeifWriter</code>ï¼š</p>
<p>Kotlin</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// ä½¿ç”¨ HeifWriter å°† Bitmap ä¿å­˜ä¸º HEIF</span>
val heifWriter = HeifWriter<span class="hljs-selector-class">.Builder</span>(
    outputStream, width, height, HeifWriter.INPUT_MODE_BITMAP
)<span class="hljs-selector-class">.build</span>()
heifWriter<span class="hljs-selector-class">.start</span>()
heifWriter<span class="hljs-selector-class">.addBitmap</span>(myBitmap)
heifWriter<span class="hljs-selector-class">.stop</span>()
</code></pre>
<h3 data-id="heading-8">3. è½¬æ¢å·¥å…·</h3>
<p>ä½ å¯ä»¥åˆ©ç”¨ <strong>libavif</strong> æˆ– <strong>ImageMagick</strong> åœ¨ CI/CD æµç¨‹ä¸­è‡ªåŠ¨è½¬æ¢èµ„æºå›¾ã€‚ä¾‹å¦‚ä½¿ç”¨ <code>avifenc</code>ï¼š</p>
<p>Bash</p>
<pre><code class="hljs language-css" lang="css">avifenc <span class="hljs-attr">--jobs</span> <span class="hljs-number">4</span> <span class="hljs-selector-tag">input</span><span class="hljs-selector-class">.jpg</span> output<span class="hljs-selector-class">.avif</span>
</code></pre>
<h3 data-id="heading-9">4. Coilï¼šKotlin ä¼˜å…ˆçš„ä¼˜é›…é›†æˆ</h3>
<p>Coil ä½œä¸ºç°ä»£ Android å¼€å‘çš„é¦–é€‰å›¾ç‰‡åº“ï¼Œå…¶æ’ä»¶åŒ–è®¾è®¡éå¸¸ç®€æ´ã€‚ç”±äºå®˜æ–¹åœ¨ Coil 3.0+ ä¸­é€šè¿‡ KMP å¢å¼ºäº†æ ¼å¼æ”¯æŒï¼Œè¿™é‡Œæˆ‘ä»¬ä»¥ç›®å‰æœ€ä¸»æµçš„é›†æˆæ–¹å¼ä¸ºä¾‹ã€‚</p>
<p><strong>æ·»åŠ ä¾èµ–</strong></p>
<p>ä½ éœ€è¦å¼•å…¥ä¸“é—¨å¤„ç† AVIF çš„è§£ç åº“ï¼ˆé€šå¸¸åŸºäº libavifï¼‰ï¼š</p>
<p>Kotlin</p>
<pre><code class="hljs language-scss" lang="scss">dependencies {
    <span class="hljs-comment">// ä½¿ç”¨ç¤¾åŒºå¹¿æ³›è®¤å¯çš„ AVIF è§£ç æ’ä»¶</span>
    <span class="hljs-built_in">implementation</span>("com.github.awxkee:avif-coder-coil:<span class="hljs-number">1.5</span>.<span class="hljs-number">0</span>")
}
</code></pre>
<p><strong>é…ç½® ImageLoader</strong></p>
<p>åœ¨ <code>Application</code> ç±»æˆ–å…¨å±€é…ç½®ä¸­æ³¨å†Œ <code>AvifDecoder</code>ï¼š</p>
<p>Kotlin</p>
<pre><code class="hljs language-scss" lang="scss">val imageLoader = ImageLoader<span class="hljs-selector-class">.Builder</span>(context)
    <span class="hljs-selector-class">.components</span> {
        <span class="hljs-comment">// å°† AVIF è§£ç å™¨åŠ å…¥ç»„ä»¶æ± </span>
        <span class="hljs-built_in">add</span>(AvifDecoder.Factory())
    }
    <span class="hljs-selector-class">.build</span>()
</code></pre>
<hr/>
<h3 data-id="heading-10">5. Glideï¼šè€ç‰ŒåŠ²æ—…çš„æ¨¡å—åŒ–æ‰©å±•</h3>
<p>Glide çš„é›†æˆç¨å¾®å¤æ‚ä¸€ç‚¹ï¼Œéœ€è¦é€šè¿‡ <code>AppGlideModule</code> æ¥æ‰‹åŠ¨æ³¨å†Œè§£ç ç»„ä»¶ã€‚</p>
<p><strong>æ·»åŠ ä¾èµ–</strong></p>
<p>ç›®å‰æœ€ç¨³å®šçš„æ–¹æ¡ˆæ˜¯ä½¿ç”¨ <code>glide-avif</code> åº“ï¼š</p>
<p>Kotlin</p>
<pre><code class="hljs language-scss" lang="scss">dependencies {
    <span class="hljs-built_in">implementation</span>("com.github.zjupure:glide-avif:<span class="hljs-number">1.0</span>.<span class="hljs-number">1</span>")
    <span class="hljs-built_in">annotationProcessor</span>("github.com.bumptech.glide:compiler:<span class="hljs-number">4.15</span>.<span class="hljs-number">1</span>")
}
</code></pre>
<p><strong>æ³¨å†Œç»„ä»¶</strong></p>
<p>åˆ›å»ºä¸€ä¸ª <code>AppGlideModule</code>ï¼Œå¹¶åœ¨ <code>registerComponents</code> ä¸­æ³¨å…¥è§£ç å™¨ã€‚è¿™æ · Glide å°±èƒ½åœ¨è¯»å–è¾“å…¥æµæ—¶è¯†åˆ«å¹¶å¤„ç† AVIF æ ¼å¼ã€‚</p>
<p>Kotlin</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@GlideModule</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">MyAppGlideModule</span> : <span class="hljs-type">AppGlideModule</span>() {
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">registerComponents</span><span class="hljs-params">(context: <span class="hljs-type">Context</span>, glide: <span class="hljs-type">Glide</span>, registry: <span class="hljs-type">Registry</span>)</span></span> {
        <span class="hljs-comment">// æ³¨å†Œ AVIF è§£ç å™¨ï¼Œè®©å…¶å¤„ç† InputStream å’Œ ByteBuffer</span>
        registry.prepend(InputStream::<span class="hljs-keyword">class</span>.java, Bitmap::<span class="hljs-keyword">class</span>.java, AvifStreamBitmapDecoder(glide.bitmapPool))
        registry.prepend(ByteBuffer::<span class="hljs-keyword">class</span>.java, Bitmap::<span class="hljs-keyword">class</span>.java, AvifByteBufferBitmapDecoder(glide.bitmapPool))
    }
}
</code></pre>
<h2 data-id="heading-11">äº”ã€ æœªæ¥å±•æœ›</h2>
<p>è™½ç„¶ç¼–ç æ—¶é—´ï¼ˆEncoding Timeï¼‰ç›®å‰æ˜¯ç°ä»£æ ¼å¼çš„è½¯è‚‹ï¼Œä½†å¯¹äºç»å¤§å¤šæ•°â€œä¸€æ¬¡ä¸Šä¼ ã€åƒä¸‡æ¬¡ä¸‹è½½â€çš„ App åœºæ™¯æ¥è¯´ï¼Œè¿™ç‚¹è®¡ç®—æˆæœ¬å¾®ä¸è¶³é“ã€‚</p>
<p>éšç€ Android 15 å’Œ 16 å¯¹ç¡¬ä»¶è§£ç çš„è¿›ä¸€æ­¥æ™®åŠï¼ŒJPEG ç»ˆå°†èµ°å‘è¾¹ç¼˜ã€‚ä½œä¸ºå¼€å‘è€…ï¼Œç°åœ¨å¼€å§‹å°è¯• <strong>HEIF/AVIF</strong>ï¼Œä¸ä»…æ˜¯ä¸ºäº†å‡å°‘ 50% çš„å­˜å‚¨ç©ºé—´ï¼Œæ›´æ˜¯ä¸ºäº†ç»™ç”¨æˆ·æä¾›ä¸€ä¸ªæ›´è½»å¿«ã€æ›´æ¸…æ™°çš„è§†è§‰ä½“éªŒã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[OpenClaw Clawdbot è‡ªå®šä¹‰ä¸­è½¬ç«™é…ç½®æ•™ç¨‹]]></title>    <link>https://juejin.cn/post/7604685644685541428</link>    <guid>https://juejin.cn/post/7604685644685541428</guid>    <pubDate>2026-02-10T03:16:12.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604685644685541428" data-draft-id="7604697194795909130" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="OpenClaw Clawdbot è‡ªå®šä¹‰ä¸­è½¬ç«™é…ç½®æ•™ç¨‹"/> <meta itemprop="keywords" content="AIGC,AIç¼–ç¨‹"/> <meta itemprop="datePublished" content="2026-02-10T03:16:12.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ›¦å’Œ"/> <meta itemprop="url" content="https://juejin.cn/user/1116759545101406"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            OpenClaw Clawdbot è‡ªå®šä¹‰ä¸­è½¬ç«™é…ç½®æ•™ç¨‹
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1116759545101406/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ›¦å’Œ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T03:16:12.000Z" title="Tue Feb 10 2026 03:16:12 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">ç¬¬ä¸€æ­¥ï¼šå®‰è£…ä¸åŸºç¡€åˆå§‹åŒ–</h3>
<p>é¦–å…ˆç¡®ä¿ä½ å·²ç»å®‰è£…äº† Node.js ç¯å¢ƒï¼Œç„¶ååœ¨ç»ˆç«¯æ‰§è¡Œï¼š</p>
<ol>
<li><strong>å…¨å±€å®‰è£…ï¼š</strong></li>
</ol>
<pre><code class="hljs language-bash" lang="bash">npm i -g clawdbot

</code></pre>
<ol start="2">
<li><strong>æ‰§è¡Œå¼•å¯¼ï¼ˆæ ¹æ®æç¤ºå®ŒæˆåŸºç¡€è®¾ç½®ï¼‰ï¼š</strong></li>
</ol>
<pre><code class="hljs language-bash" lang="bash">clawdbot onboard

</code></pre>
<p><em>æ³¨æ„ï¼šåœ¨ Windows åŸç”Ÿç¯å¢ƒä¸‹ï¼Œå¦‚æœæç¤º <code>openclaw</code> ä¸æ˜¯å‘½ä»¤ï¼Œè¯·ç»Ÿä¸€ä½¿ç”¨ <code>clawdbot</code>ã€‚</em></p>
<hr/>
<h3 data-id="heading-1">ç¬¬äºŒæ­¥ï¼šä¿®æ”¹ä¸»é…ç½®æ–‡ä»¶ <code>clawdbot.json</code></h3>
<p>æ‰“å¼€è·¯å¾„ï¼š<code>C:\Users\Administrator\.clawdbot\clawdbot.json</code>
å°† <code>models</code> å’Œ <code>auth</code> éƒ¨åˆ†ä¿®æ”¹ä¸ºä»¥ä¸‹å†…å®¹ï¼Œä»¥æ”¯æŒè‡ªå®šä¹‰ä¸­è½¬ç«™ã€‚</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"agents"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"defaults"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"workspace"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"C:\\Users\\Administrator\\clawd"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"models"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"api-proxy-gpt/gpt-4o"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"alias"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"GPT-4o"</span> <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"api-proxy-claude/claude-sonnet-4-5-20250929"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"alias"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Claude Sonnet 4.5"</span> <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"api-proxy-google/gemini-3-pro-preview"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"alias"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Gemini 3 Pro"</span> <span class="hljs-punctuation">}</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"primary"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"api-proxy-claude/claude-sonnet-4-5-20250929"</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"auth"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"profiles"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"api-proxy-gpt:default"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"provider"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"api-proxy-gpt"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"mode"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"api_key"</span> <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"api-proxy-claude:default"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"provider"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"api-proxy-claude"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"mode"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"api_key"</span> <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"api-proxy-google:default"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"provider"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"api-proxy-google"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"mode"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"api_key"</span> <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"models"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"mode"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"merge"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"providers"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"api-proxy-gpt"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"baseUrl"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://api.88api.chat/v1"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"api"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"openai-completions"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"models"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
          <span class="hljs-punctuation">{</span> <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"gpt-4o"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"GPT-4o"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"contextWindow"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">128000</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"maxTokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">8192</span> <span class="hljs-punctuation">}</span>
        <span class="hljs-punctuation">]</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"api-proxy-claude"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"baseUrl"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://api.88api.chat"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"api"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"anthropic-messages"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"models"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
          <span class="hljs-punctuation">{</span> <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"claude-sonnet-4-5-20250929"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Claude Sonnet 4.5"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"contextWindow"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">200000</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"maxTokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">8192</span> <span class="hljs-punctuation">}</span>
        <span class="hljs-punctuation">]</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"api-proxy-google"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"baseUrl"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://api.88api.chat/v1beta"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"api"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"google-generative-ai"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"models"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
          <span class="hljs-punctuation">{</span> <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"gemini-3-pro-preview"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Gemini 3 Pro"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"contextWindow"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2000000</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"maxTokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">8192</span> <span class="hljs-punctuation">}</span>
        <span class="hljs-punctuation">]</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>

</code></pre>
<hr/>
<h3 data-id="heading-2">ç¬¬ä¸‰æ­¥ï¼šé…ç½®é‰´æƒæ–‡ä»¶ <code>auth-profiles.json</code></h3>
<p>æ‰“å¼€è·¯å¾„ï¼š<code>C:\Users\Administrator\.clawdbot\agents\main\agent\auth-profiles.json</code>
åœ¨æ­¤å¤„å¡«å…¥ä½ ä»ä¸­è½¬ç«™è·å–çš„çœŸå® API Keyã€‚</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"version"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"profiles"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"api-proxy-gpt:default"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"api_key"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"provider"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"api-proxy-gpt"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"key"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"sk-your-unique-gpt-key-here"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"api-proxy-claude:default"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"api_key"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"provider"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"api-proxy-claude"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"key"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"sk-your-unique-claude-key-here"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"api-proxy-google:default"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"api_key"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"provider"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"api-proxy-google"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"key"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"sk-your-unique-google-key-here"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"lastGood"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"api-proxy-gpt"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"api-proxy-gpt:default"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"api-proxy-claude"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"api-proxy-claude:default"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"api-proxy-google"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"api-proxy-google:default"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>

</code></pre>
<hr/>
<h3 data-id="heading-3">ç¬¬å››æ­¥ï¼šæ£€æŸ¥å¹¶å¯åŠ¨</h3>
<ol>
<li><strong>è¿è¡Œå¥åº·æ£€æŸ¥ï¼š</strong></li>
</ol>
<pre><code class="hljs language-bash" lang="bash">clawdbot doctor

</code></pre>
<ol start="2">
<li><strong>å¯åŠ¨ Gateway æœåŠ¡ï¼š</strong></li>
</ol>
<pre><code class="hljs language-bash" lang="bash">clawdbot gateway

</code></pre>
<ol start="3">
<li><strong>è®¿é—®æ§åˆ¶å°ï¼š</strong>
æ‰“å¼€æµè§ˆå™¨è®¿é—® <code>http://127.0.0.1:18789/</code>ï¼Œä½¿ç”¨ <code>clawdbot onboarding</code> ç»“å°¾è¾“å‡ºçš„ Token ç™»å½•å³å¯å¼€å§‹è°ƒæ•™ä½ çš„ AI Agentã€‚</li>
</ol>
<p><strong>å…³äº 88API</strong></p>
<p>88API æ˜¯ä¸€ä¸ª AI ç¼–æ’å¹³å°ï¼Œæä¾›ç»Ÿä¸€æ¥å£è°ƒç”¨å…¨çƒæœ€å¼º AI æ¨¡å‹ï¼ˆGPT-5.2ã€Claude 4.5ã€Gemini 3 Proã€DeepSeek V4 ç­‰ï¼‰ã€‚é€šè¿‡æ™ºèƒ½è·¯ç”±ã€ç¼“å­˜æœºåˆ¶ã€æ¨¡å‹ç¼–æ’ç­‰æ ¸å¿ƒåŠŸèƒ½ï¼Œå¸®åŠ©ä¼ä¸šåœ¨æ¨ç†æ—¶ä»£å®ç°èƒ½æ•ˆé©å‘½ï¼Œé™ä½ 70% çš„ AI æˆæœ¬ã€‚</p>
<p><strong>ç«‹å³ä½“éªŒ</strong>ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fapi.88api.chat" target="_blank" title="https://api.88api.chat" ref="nofollow noopener noreferrer">api.88api.chat</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å¤§æ¨¡å‹å¾®è°ƒå®æˆ˜æ‰‹å†Œ (SWIFT + Qwen2)]]></title>    <link>https://juejin.cn/post/7604775190211854346</link>    <guid>https://juejin.cn/post/7604775190211854346</guid>    <pubDate>2026-02-10T03:21:32.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604775190211854346" data-draft-id="7604775190211837962" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å¤§æ¨¡å‹å¾®è°ƒå®æˆ˜æ‰‹å†Œ (SWIFT + Qwen2)"/> <meta itemprop="keywords" content="äººå·¥æ™ºèƒ½"/> <meta itemprop="datePublished" content="2026-02-10T03:21:32.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Turnip1202"/> <meta itemprop="url" content="https://juejin.cn/user/1684912023022440"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å¤§æ¨¡å‹å¾®è°ƒå®æˆ˜æ‰‹å†Œ (SWIFT + Qwen2)
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1684912023022440/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Turnip1202
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T03:21:32.000Z" title="Tue Feb 10 2026 03:21:32 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    2
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å¤§æ¨¡å‹å¾®è°ƒå®æˆ˜æ‰‹å†Œ (SWIFT + Qwen2)</h2>
<p>æœ¬æ‰‹å†Œè¯¦ç»†è®°å½•äº†åœ¨ Windows ç¯å¢ƒä¸‹ï¼Œä½¿ç”¨ RTX 4060 (8GB æ˜¾å­˜) æˆåŠŸå¾®è°ƒ Qwen2-1.5B æ¨¡å‹çš„å…¨è¿‡ç¨‹ã€å‘½ä»¤è¯¦è§£åŠå¸¸è§é—®é¢˜å¤„ç†ã€‚</p>
<hr/>
<h3 data-id="heading-1">1. ç¯å¢ƒæ­å»º (Installation)</h3>
<p>åœ¨å¼€å§‹å¾®è°ƒä¹‹å‰ï¼Œéœ€è¦é…ç½®å¥½ Python ç¯å¢ƒåŠç›¸å…³çš„ AI åº“ã€‚å»ºè®®ä½¿ç”¨ Python 3.10+ ç¯å¢ƒã€‚</p>
<h4 data-id="heading-2">ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºå¹¶æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ</span>
python -m venv .venv

<span class="hljs-comment"># æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ (Windows PowerShell)</span>
.\.venv\Scripts\Activate.ps1
</code></pre>
<h4 data-id="heading-3">ç¬¬äºŒæ­¥ï¼šå®‰è£…æ ¸å¿ƒä¾èµ–åŒ…</h4>
<pre><code class="hljs language-perl" lang="perl"><span class="hljs-comment"># 1. å®‰è£… ModelScope SWIFT æ¡†æ¶ (æ ¸å¿ƒå·¥å…·)</span>
pip install ms-swift -U

<span class="hljs-comment"># 2. å®‰è£… PyTorch (æ ¹æ®ä½ çš„ CUDA ç‰ˆæœ¬é€‰æ‹©ï¼Œè¿™é‡Œä»¥ CUDA 12.1 ä¸ºä¾‹)</span>
pip install torch torchvision torchaudio --<span class="hljs-keyword">index</span>-url https:<span class="hljs-regexp">//d</span>ownload.pytorch.org/whl/cu121

<span class="hljs-comment"># 3. å®‰è£…é‡åŒ–ä¸åŠ é€Ÿå·¥å…· (8G æ˜¾å­˜å¿…å¤‡)</span>
pip install bitsandbytes  <span class="hljs-comment"># æä¾› 4-bit é‡åŒ–æ”¯æŒ</span>
pip install accelerate    <span class="hljs-comment"># æ˜¾å­˜ä¼˜åŒ–ä¸åŠ é€Ÿ</span>
pip install peft         <span class="hljs-comment"># LoRA æ ¸å¿ƒåº“</span>
pip install transformers -U <span class="hljs-comment"># ç¡®ä¿ Transformers åº“æ˜¯æœ€æ–°çš„</span>
</code></pre>
<h4 data-id="heading-4">ç¬¬ä¸‰æ­¥ï¼šéªŒè¯å®‰è£…</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æ£€æŸ¥ SWIFT æ˜¯å¦å®‰è£…æˆåŠŸ</span>
swift --version
</code></pre>
<hr/>
<h3 data-id="heading-5">2. å¿«é€Ÿå¼€å§‹æµç¨‹</h3>
<h4 data-id="heading-6">ç¬¬ä¸€æ­¥ï¼šå‡†å¤‡æ•°æ®é›† <code>my_data.jsonl</code></h4>
<p>æ•°æ®é›†åº”åŒ…å«å¤šç§æé—®æ–¹å¼ï¼Œä»¥å¢å¼ºæ¨¡å‹çš„æ³›åŒ–èƒ½åŠ›ã€‚</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span><span class="hljs-attr">"instruction"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"è¿™ä»¶è¡¬è¡«å¤šå°‘é’±ï¼Ÿ"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"output"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"è¿™ä»¶è¡¬è¡«çš„ä»·æ ¼æ˜¯19.9ç¾å…ƒã€‚"</span><span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">{</span><span class="hljs-attr">"instruction"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"è¡¬è¡«å•ä»·æ˜¯å¤šå°‘ï¼Ÿ"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"output"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"è¿™ä»¶è¡¬è¡«çš„ä»·æ ¼æ˜¯19.9ç¾å…ƒã€‚"</span><span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">{</span><span class="hljs-attr">"instruction"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Shirt price please."</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"output"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"è¿™ä»¶è¡¬è¡«çš„ä»·æ ¼æ˜¯19.9ç¾å…ƒã€‚"</span><span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-7">ç¬¬äºŒæ­¥ï¼šæ‰§è¡Œå¾®è°ƒ (SFT)</h4>
<pre><code class="hljs language-lua" lang="lua">swift sft `
    <span class="hljs-comment">--model qwen/Qwen2-1.5B-Instruct `</span>
    <span class="hljs-comment">--train_type lora `</span>
    <span class="hljs-comment">--dataset "d:\ACode\demo\my_data.jsonl" `</span>
    <span class="hljs-comment">--quant_bits 4 `</span>
    <span class="hljs-comment">--max_length 256 `</span>
    <span class="hljs-comment">--per_device_train_batch_size 1 `</span>
    <span class="hljs-comment">--gradient_accumulation_steps 4 `</span>
    <span class="hljs-comment">--learning_rate 1e-4 `</span>
    <span class="hljs-comment">--num_train_epochs 5 `</span>
    <span class="hljs-comment">--lora_rank 8 `</span>
    <span class="hljs-comment">--lora_alpha 32 `</span>
    <span class="hljs-comment">--logging_steps 1 `</span>
    <span class="hljs-comment">--output_dir "d:\ACode\demo\output"</span>
</code></pre>
<h4 data-id="heading-8">ç¬¬ä¸‰æ­¥ï¼šæ¨ç†æµ‹è¯• (Inference)</h4>
<pre><code class="hljs language-arduino" lang="arduino">swift infer --adapters <span class="hljs-string">"D:\ACode\demo\output\v0-xxxxxxxx-xxxxxx\checkpoint-65"</span>
</code></pre>
<h4 data-id="heading-9">ç¬¬å››æ­¥ï¼šåˆå¹¶å¯¼å‡º (Export)</h4>
<pre><code class="hljs language-r" lang="r">swift export `
    --adapters "D:\ACode\demo\output\v0-xxxxxxxx-xxxxxx\checkpoint-65" `
    <span class="hljs-operator">-</span><span class="hljs-operator">-</span>merge_lora true
</code></pre>
<hr/>
<h3 data-id="heading-10">3. åˆå¹¶åçš„æ¨¡å‹ä½¿ç”¨ (Usage)</h3>
<p>åˆå¹¶ï¼ˆMergedï¼‰åçš„æ¨¡å‹å·²ç»å°† LoRA æƒé‡èå…¥äº†åº•åº§æ¨¡å‹ï¼Œå®ƒç°åœ¨æ˜¯ä¸€ä¸ª<strong>å®Œæ•´çš„ã€ç‹¬ç«‹çš„</strong>æ¨¡å‹æ–‡ä»¶å¤¹ï¼ˆé€šå¸¸ä½äº <code>checkpoint-xxx/merged</code> ç›®å½•ä¸‹ï¼‰ã€‚</p>
<h4 data-id="heading-11">æ–¹æ³•ä¸€ï¼šä½¿ç”¨ SWIFT æ¨ç† (æœ€ç®€å•)</h4>
<p>åˆå¹¶åçš„æ¨¡å‹ä¸å†éœ€è¦ <code>--adapters</code> å‚æ•°ï¼Œç›´æ¥ä½œä¸ºæ™®é€šæ¨¡å‹åŠ è½½å³å¯ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># è¿™é‡Œçš„ --model æŒ‡å‘åˆå¹¶åçš„å®Œæ•´ç›®å½•</span>
swift infer --model <span class="hljs-string">"D:\ACode\demo\output\v0-xxx\checkpoint-65\merged"</span>
</code></pre>
<h4 data-id="heading-12">æ–¹æ³•äºŒï¼šä½¿ç”¨åŸç”Ÿ Transformers åº“ (Python ä»£ç )</h4>
<p>ä½ å¯ä»¥åƒä½¿ç”¨ä»»ä½• HuggingFace/ModelScope æ¨¡å‹ä¸€æ ·åŠ è½½å®ƒï¼š</p>
<pre><code class="hljs language-ini" lang="ini">from transformers import AutoModelForCausalLM, AutoTokenizer
import torch

<span class="hljs-attr">model_path</span> = <span class="hljs-string">"D:/ACode/demo/output/v0-xxx/checkpoint-65/merged"</span>

<span class="hljs-comment"># åŠ è½½åˆ†è¯å™¨å’Œæ¨¡å‹</span>
<span class="hljs-attr">tokenizer</span> = AutoTokenizer.from_pretrained(model_path, trust_remote_code=<span class="hljs-literal">True</span>)
<span class="hljs-attr">model</span> = AutoModelForCausalLM.from_pretrained(model_path, torch_dtype=torch.bfloat16, device_map=<span class="hljs-string">"auto"</span>, trust_remote_code=<span class="hljs-literal">True</span>)

<span class="hljs-comment"># è¿›è¡Œå¯¹è¯æµ‹è¯•</span>
<span class="hljs-attr">inputs</span> = tokenizer(<span class="hljs-string">"è¿™ä»¶è¡¬è¡«å¤šå°‘é’±ï¼Ÿ"</span>, return_tensors=<span class="hljs-string">"pt"</span>).to(<span class="hljs-string">"cuda"</span>)
<span class="hljs-attr">outputs</span> = model.generate(**inputs, max_new_tokens=<span class="hljs-number">128</span>)
print(tokenizer.decode(outputs<span class="hljs-section">[0]</span>, <span class="hljs-attr">skip_special_tokens</span>=<span class="hljs-literal">True</span>))
</code></pre>
<h4 data-id="heading-13">æ–¹æ³•ä¸‰ï¼šç¬¬ä¸‰æ–¹å·¥å…·éƒ¨ç½² (éƒ¨ç½²ç¥å™¨)</h4>
<p>å› ä¸ºåˆå¹¶åçš„æ¨¡å‹ç»“æ„ä¸åŸå§‹ Qwen2 å®Œå…¨ä¸€è‡´ï¼Œä½ å¯ä»¥ç›´æ¥å°†å…¶å¯¼å…¥ï¼š</p>
<ul>
<li><strong>LM Studio / Ollama</strong>ï¼šå°†åˆå¹¶åçš„ç›®å½•å¯¼å…¥æˆ–è½¬æ¢ä¸º GGUF æ ¼å¼å³å¯ä½¿ç”¨ã€‚</li>
<li><strong>API æœåŠ¡</strong>ï¼šä½¿ç”¨ <code>vLLM</code> æˆ– <code>FastChat</code> å¿«é€Ÿæ­å»ºè‡ªå·±çš„ API æœåŠ¡å™¨ã€‚</li>
</ul>
<hr/>
<h3 data-id="heading-14">4. æ ¸å¿ƒå‘½ä»¤å‚æ•°è¯¦è§£</h3>
<h4 data-id="heading-15"><code>swift sft</code> (æœ‰ç›‘ç£å¾®è°ƒ)</h4>




























































<table><thead><tr><th>å‚æ•°å</th><th>è§£é‡Š</th><th>å»ºè®®å€¼</th></tr></thead><tbody><tr><td><code>--model</code></td><td>æŒ‡å®šåº•åº§æ¨¡å‹ ID æˆ–è·¯å¾„</td><td><code>qwen/Qwen2-1.5B-Instruct</code></td></tr><tr><td><code>--train_type</code></td><td>è®­ç»ƒæ–¹æ³•</td><td><code>lora</code> (è½»é‡åŒ–æ’ä»¶å¼å¾®è°ƒ)</td></tr><tr><td><code>--quant_bits</code></td><td>é‡åŒ–ä½æ•°</td><td><code>4</code> (8G æ˜¾å­˜å¿…é€‰ï¼Œæ˜¾è‘—é™ä½å ç”¨)</td></tr><tr><td><code>--max_length</code></td><td>å•æ¡æ•°æ®æœ€å¤§é•¿åº¦</td><td><code>256</code> (æ ¹æ®ä»»åŠ¡å¤æ‚åº¦è°ƒæ•´)</td></tr><tr><td><code>--per_device_train_batch_size</code></td><td>å•å¡æ‰¹å¤§å°</td><td><code>1</code> (æ˜¾å­˜å°æ—¶è®¾ä¸º 1)</td></tr><tr><td><code>--gradient_accumulation_steps</code></td><td>æ¢¯åº¦ç´¯ç§¯æ­¥æ•°</td><td><code>4</code> (æ¨¡æ‹Ÿæ›´å¤§çš„ Batch Size)</td></tr><tr><td><code>--learning_rate</code></td><td>å­¦ä¹ ç‡</td><td><code>1e-4</code> (LoRA è®­ç»ƒå¸¸ç”¨å€¼)</td></tr><tr><td><code>--num_train_epochs</code></td><td>è®­ç»ƒæ€»è½®æ•°</td><td><code>5</code> (è§†ä»»åŠ¡å¤æ‚åº¦è€Œå®š)</td></tr><tr><td><code>--lora_rank</code></td><td>LoRA çš„ç§©</td><td><code>8</code> æˆ– <code>16</code> (è¶Šå¤§è¡¨è¾¾åŠ›è¶Šå¼º)</td></tr><tr><td><code>--logging_steps</code></td><td>æ—¥å¿—æ‰“å°é¢‘ç‡</td><td><code>1</code> (æ¯ä¸€å°æ­¥éƒ½æ˜¾ç¤ºï¼Œæ–¹ä¾¿ç›‘æ§)</td></tr></tbody></table>
<h4 data-id="heading-16"><code>swift infer</code> (æ¨¡å‹æ¨ç†)</h4>

























<table><thead><tr><th>å‚æ•°å</th><th>è§£é‡Š</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>--adapters</code></td><td>æŒ‡å‘è®­ç»ƒå¥½çš„ checkpoint æ–‡ä»¶å¤¹</td><td>å¿…é¡»åŒ…å« <code>adapter_config.json</code></td></tr><tr><td><code>--stream</code></td><td>æ˜¯å¦å¼€å¯æµå¼è¾“å‡º</td><td><code>true</code> (åƒ ChatGPT ä¸€æ ·å¼¹å‡ºæ–‡å­—)</td></tr><tr><td><code>--quant_bits</code></td><td>æ¨ç†é‡åŒ–ä½æ•°</td><td><code>0</code> (1.5B æ¨¡å‹æ¨ç†æ—¶ä¸é‡åŒ–æ›´ç¨³å®š)</td></tr></tbody></table>
<h4 data-id="heading-17"><code>swift export</code> (å¯¼å‡ºåˆå¹¶)</h4>















<table><thead><tr><th>å‚æ•°å</th><th>è§£é‡Š</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>--merge_lora</code></td><td>æ˜¯å¦å°† LoRA æƒé‡åˆå¹¶å…¥ä¸»æ¨¡å‹</td><td><code>true</code> (ç”Ÿæˆå¯ç‹¬ç«‹ä½¿ç”¨çš„æ¨¡å‹)</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-18">4. å¸¸è§é—®é¢˜ (FAQ)</h3>
<h4 data-id="heading-19">Q: ä¸ºä»€ä¹ˆå‘½ä»¤æ‰§è¡Œå <code>output</code> æ–‡ä»¶å¤¹é‡Œæ²¡æœ‰ä¸œè¥¿ï¼Ÿ</h4>
<p><strong>A</strong>: SWIFT åœ¨å¯åŠ¨é˜¶æ®µéœ€è¦è¿›è¡Œæ¨¡å‹ä¸‹è½½ã€åŠ è½½å’Œ <strong>4-bit é‡åŒ–</strong>ï¼Œè¿™é€šå¸¸éœ€è¦ 30-60 ç§’ã€‚åœ¨é‡åŒ–å®Œæˆå¹¶å¼€å§‹ç¬¬ä¸€ä¸ªè®­ç»ƒæ­¥ä¹‹å‰ï¼Œä¸ä¼šå†™å…¥æ—¥å¿—ã€‚</p>
<h4 data-id="heading-20">Q: é‡åˆ° <code>ambiguous option</code> é”™è¯¯æ€ä¹ˆåŠï¼Ÿ</h4>
<p><strong>A</strong>: è¿™æ˜¯ SWIFT v3 çš„å‚æ•°åæ­§ä¹‰ã€‚ä¾‹å¦‚ä½¿ç”¨ <code>--merge_lora true</code> è€Œä¸æ˜¯æ¨¡ç³Šçš„ <code>--merge</code>ã€‚</p>
<h4 data-id="heading-21">Q: 8GB æ˜¾å­˜å¦‚ä½•è¿›ä¸€æ­¥ä¼˜åŒ–ï¼Ÿ</h4>
<p><strong>A</strong>:</p>
<ol>
<li>å‡å° <code>--max_length</code> (ä¾‹å¦‚è®¾ä¸º 128)ã€‚</li>
<li>ç¡®ä¿å¼€å¯ <code>--gradient_checkpointing true</code>ã€‚</li>
<li>å…³é—­æµè§ˆå™¨ç­‰å ç”¨ GPU èµ„æºçš„åå°ç¨‹åºã€‚</li>
</ol>
<hr/>
<h3 data-id="heading-22">5. ç›®å½•ç»“æ„å‚è€ƒ</h3>
<pre><code class="hljs language-bash" lang="bash">demo/
â”œâ”€â”€ my_data.jsonl          <span class="hljs-comment"># åŸå§‹æ•°æ®é›†</span>
â”œâ”€â”€ output/                <span class="hljs-comment"># è®­ç»ƒè¾“å‡ºç›®å½•</span>
â”‚   â””â”€â”€ v0-xxx-xxx/        <span class="hljs-comment"># æŸæ¬¡è®­ç»ƒçš„ä»»åŠ¡æ–‡ä»¶å¤¹</span>
â”‚       â”œâ”€â”€ checkpoint-65/ <span class="hljs-comment"># è®­ç»ƒç”Ÿæˆçš„æƒé‡</span>
â”‚       â””â”€â”€ logging.jsonl  <span class="hljs-comment"># è®­ç»ƒæ—¥å¿—</span>
â””â”€â”€ .venv/                 <span class="hljs-comment"># Python è™šæ‹Ÿç¯å¢ƒ</span>
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ã€éAIã€‘å¹¶å‘ç¯å¢ƒä¸‹æ­»é”æ£€æµ‹çš„å®ç°æ–¹æ¡ˆ]]></title>    <link>https://juejin.cn/post/7604694326519152691</link>    <guid>https://juejin.cn/post/7604694326519152691</guid>    <pubDate>2026-02-10T03:59:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604694326519152691" data-draft-id="7604693038440300550" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ã€éAIã€‘å¹¶å‘ç¯å¢ƒä¸‹æ­»é”æ£€æµ‹çš„å®ç°æ–¹æ¡ˆ"/> <meta itemprop="keywords" content="åç«¯,Java,æ€§èƒ½ä¼˜åŒ–"/> <meta itemprop="datePublished" content="2026-02-10T03:59:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ¡¦è¯´ç¼–ç¨‹"/> <meta itemprop="url" content="https://juejin.cn/user/2212689394274136"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ã€éAIã€‘å¹¶å‘ç¯å¢ƒä¸‹æ­»é”æ£€æµ‹çš„å®ç°æ–¹æ¡ˆ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2212689394274136/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ¡¦è¯´ç¼–ç¨‹
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T03:59:23.000Z" title="Tue Feb 10 2026 03:59:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">èƒŒæ™¯</h2>
<p>åœ¨å¤æ‚çš„å¹¶å‘ç³»ç»Ÿä¸­ï¼Œå°¤å…¶æ˜¯æ¶‰åŠå¤šçº¿ç¨‹æ± åµŒå¥—è°ƒç”¨çš„åœºæ™¯ï¼Œæ­»é”å’Œæ´»é”é—®é¢˜å¾€å¾€éš¾ä»¥å‘ç°å’Œæ’æŸ¥ã€‚æœ¬æ–‡ä»‹ç»ä¸€ç§åŸºäº<strong>ä»»åŠ¡ä¾èµ–å›¾</strong>çš„æ£€æµ‹æ–¹æ¡ˆï¼Œèƒ½å¤Ÿåœ¨è¿è¡Œæ—¶åŠ¨æ€è¿½è¸ªä»»åŠ¡è°ƒç”¨é“¾ï¼Œè‡ªåŠ¨è¯†åˆ«æ½œåœ¨çš„å¾ªç¯ä¾èµ–é£é™©ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b384fb9b72ae4cc2b945bb5a94688b7e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5qGm6K-057yW56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771300799&amp;x-signature=oskpi3KAAZtbRdCocvHYK79pJSo%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-1">æ ¸å¿ƒæ€æƒ³</h2>
<h3 data-id="heading-2">1. é—®é¢˜å»ºæ¨¡</h3>
<p>å°†å¹¶å‘ä»»åŠ¡è°ƒç”¨å…³ç³»æŠ½è±¡ä¸º<strong>æœ‰å‘å›¾</strong>ï¼š</p>
<ul>
<li><strong>èŠ‚ç‚¹</strong>ï¼šæ¯ä¸ªä»»åŠ¡ï¼ˆæˆ–æ‰§è¡Œå™¨/çº¿ç¨‹æ± ï¼‰</li>
<li><strong>è¾¹</strong>ï¼šä»»åŠ¡ A æäº¤ä»»åŠ¡ B æ‰§è¡Œï¼Œåˆ™å­˜åœ¨è¾¹ A â†’ B</li>
</ul>
<p>å¦‚æœè¿™ä¸ªæœ‰å‘å›¾ä¸­å­˜åœ¨<strong>ç¯è·¯</strong>ï¼Œåˆ™æ„å‘³ç€å­˜åœ¨æ½œåœ¨çš„æ­»é”é£é™©ã€‚
å¦‚æœæœ‰è¶…æ—¶æ—¶é—´ï¼Œå‡ºç°æ­»é”æ—¶ï¼Œä¼šç¨³å®šè§¦å‘è¶…æ—¶ï¼Œé€€åŒ–ä¸ºé¥¥é¥¿é—®é¢˜ï¼Œæœ¬è´¨è¿˜æ˜¯æ­»é”ã€‚å®é™…ç”Ÿäº§ä¸­ï¼Œå¯ä»¥é€šè¿‡è¿™ä¸ªæŒ‡æ ‡æ¨æ–­æ­»é”å·²ç»å‘ç”Ÿã€‚</p>
<pre><code class="hljs language-scss" lang="scss">TaskA â†’ TaskB â†’ TaskC â†’ TaskA  (ç¯è·¯ = æ­»é”é£é™©)
</code></pre>
<h3 data-id="heading-3">2. æ£€æµ‹ç»´åº¦</h3>
<p>æˆ‘ä»¬å…³æ³¨ä¸¤ä¸ªå±‚é¢çš„å¾ªç¯ä¾èµ–ï¼š</p>

















<table><thead><tr><th>ç»´åº¦</th><th>æ£€æµ‹å†…å®¹</th></tr></thead><tbody><tr><td><strong>ä»»åŠ¡çº§åˆ«</strong></td><td>ä»»åŠ¡ A â†’ B â†’ C â†’ A</td></tr><tr><td><strong>æ‰§è¡Œå™¨çº§åˆ«</strong></td><td>çº¿ç¨‹æ±  X â†’ Y â†’ X</td></tr></tbody></table>
<h3 data-id="heading-4">3. å…³é”®æŠ€æœ¯ç‚¹</h3>
<ol>
<li><strong>TransmittableThreadLocal (TTL)</strong>ï¼šè·¨çº¿ç¨‹ä¼ é€’ä»»åŠ¡å›¾æ•°æ®</li>
<li><strong>Guava Graph</strong>ï¼šé«˜æ•ˆçš„å›¾æ•°æ®ç»“æ„å’Œç¯è·¯æ£€æµ‹ç®—æ³•</li>
<li><strong>æ‡’åŠ è½½</strong>ï¼šä»…åœ¨è¯·æ±‚ç»“æŸæ—¶æ„å»ºå’Œåˆ†æå›¾</li>
<li><strong>çº¿ç¨‹å®‰å…¨é˜Ÿåˆ—</strong>ï¼šæ— é”æ”¶é›†ä»»åŠ¡å¯¹</li>
</ol>
<h2 data-id="heading-5">å®ç°æ–¹æ¡ˆ</h2>
<h3 data-id="heading-6">æ•´ä½“æ¶æ„</h3>
<pre><code class="hljs language-scss" lang="scss">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      è¯·æ±‚å…¥å£                            â”‚
â”‚                   TaskGraph<span class="hljs-selector-class">.init</span>()                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚         ä¸šåŠ¡ä»£ç æ‰§è¡Œ                â”‚
    â”‚   ParallelExecutor<span class="hljs-selector-class">.submit</span>(task)   â”‚
    â”‚         â†“ <span class="hljs-built_in">logForking</span>()            â”‚
    â”‚   è®°å½•: parent â†’ child            â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚         è¯·æ±‚ç»“æŸ                    â”‚
    â”‚   TaskGraph.<span class="hljs-built_in">destroy</span>()             â”‚
    â”‚   - æ„å»ºæœ‰å‘å›¾                      â”‚
    â”‚   - æ£€æµ‹ç¯è·¯                        â”‚
    â”‚   - è¾“å‡ºå‘Šè­¦æ—¥å¿—                    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h3 data-id="heading-7">æ ¸å¿ƒæ•°æ®ç»“æ„ï¼šä»»åŠ¡å›¾</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * ä»»åŠ¡ä¾èµ–å›¾ - é€šè¿‡ TTL å®ç°è¯·æ±‚çº§åˆ«å…±äº«
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TaskGraph</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">TransmittableThreadLocal</span>&lt;TaskGraph.Data&gt; {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">TaskGraph</span> <span class="hljs-variable">TTL</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TaskGraph</span>();

    <span class="hljs-comment">/** ä»»åŠ¡å â†’ æ‰§è¡Œå™¨å çš„æ˜ å°„ */</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Map&lt;String, String&gt; TASK_TO_EXECUTOR_MAP = buildTaskExecutorMapping();

    <span class="hljs-comment">/**
     * è¯·æ±‚çº§åˆ«çš„å›¾æ•°æ®ï¼ˆçº¿ç¨‹å®‰å…¨ï¼Œæ‰€æœ‰å­çº¿ç¨‹å…±äº«åŒä¸€å®ä¾‹ï¼‰
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Data</span> {
        <span class="hljs-comment">/** ä»»åŠ¡å¯¹é˜Ÿåˆ—ï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰ */</span>
        <span class="hljs-keyword">final</span> BlockingQueue&lt;EndpointPair&lt;String&gt;&gt; taskPairs = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedTransferQueue</span>&lt;&gt;();

        <span class="hljs-comment">/** æ‡’åŠ è½½ï¼šä»»åŠ¡ä¾èµ–å›¾ */</span>
        <span class="hljs-meta">@Getter(lazy = true)</span>
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Graph&lt;String&gt; taskGraph = buildTaskGraph();

        <span class="hljs-comment">/** æ‡’åŠ è½½ï¼šæ‰§è¡Œå™¨ä¾èµ–å›¾ */</span>
        <span class="hljs-meta">@Getter(lazy = true)</span>
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Graph&lt;String&gt; executorGraph = buildExecutorGraph();

        <span class="hljs-comment">/** æ‡’åŠ è½½ï¼šæ˜¯å¦å­˜åœ¨ä»»åŠ¡ç¯è·¯ */</span>
        <span class="hljs-meta">@Getter(lazy = true)</span>
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">hasTaskCycle</span> <span class="hljs-operator">=</span> Graphs.hasCycle(getTaskGraph());

        <span class="hljs-comment">/** æ‡’åŠ è½½ï¼šæ˜¯å¦å­˜åœ¨æ‰§è¡Œå™¨ç¯è·¯ */</span>
        <span class="hljs-meta">@Getter(lazy = true)</span>
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">hasExecutorCycle</span> <span class="hljs-operator">=</span> Graphs.hasCycle(getExecutorGraph());

        <span class="hljs-comment">/** æ‡’åŠ è½½ï¼šæ˜¯å¦å­˜åœ¨è‡ªç¯ */</span>
        <span class="hljs-meta">@Getter(lazy = true)</span>
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">hasSelfLoop</span> <span class="hljs-operator">=</span> checkSelfLoop();

        <span class="hljs-keyword">private</span> Graph&lt;String&gt; <span class="hljs-title function_">buildTaskGraph</span><span class="hljs-params">()</span> {
            Builder&lt;String&gt; builder = GraphBuilder.directed()
                    .allowsSelfLoops(<span class="hljs-literal">true</span>)
                    .immutable();
            taskPairs.forEach(builder::putEdge);
            <span class="hljs-keyword">return</span> builder.build();
        }

        <span class="hljs-keyword">private</span> Graph&lt;String&gt; <span class="hljs-title function_">buildExecutorGraph</span><span class="hljs-params">()</span> {
            Builder&lt;String&gt; builder = GraphBuilder.directed()
                    .allowsSelfLoops(<span class="hljs-literal">true</span>)
                    .immutable();

            getTaskGraph().edges().stream()
                    .map(pair -&gt; EndpointPair.ordered(
                            TASK_TO_EXECUTOR_MAP.getOrDefault(pair.source(), <span class="hljs-string">"UNKNOWN"</span>),
                            TASK_TO_EXECUTOR_MAP.getOrDefault(pair.target(), <span class="hljs-string">"UNKNOWN"</span>)))
                    .forEach(builder::putEdge);
            <span class="hljs-keyword">return</span> builder.build();
        }

        <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">checkSelfLoop</span><span class="hljs-params">()</span> {
            <span class="hljs-keyword">return</span> getExecutorGraph().edges().stream()
                    .anyMatch(p -&gt; Objects.equals(p.nodeU(), p.nodeV()));
        }
    }

    <span class="hljs-comment">// ============== TTL æ ¸å¿ƒæ–¹æ³• ==============</span>

    <span class="hljs-comment">/**
     * è·¨çº¿ç¨‹æ‹·è´ï¼šè¿”å›åŒä¸€ Data å®ä¾‹ï¼ˆå¼•ç”¨å…±äº«ï¼‰
     */</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Data <span class="hljs-title function_">copy</span><span class="hljs-params">(Data parentValue)</span> {
        <span class="hljs-keyword">return</span> parentValue;  <span class="hljs-comment">// æ‰€æœ‰å­çº¿ç¨‹å…±äº«åŒä¸€ä¸ª Data</span>
    }

    <span class="hljs-comment">// ============== å…¬å…± API ==============</span>

    <span class="hljs-comment">/** è¯·æ±‚å¼€å§‹æ—¶åˆå§‹åŒ– */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">()</span> {
        TTL.set(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Data</span>());
    }

    <span class="hljs-comment">/** è®°å½•ä»»åŠ¡ä¾èµ–å…³ç³» */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">logTaskPair</span><span class="hljs-params">(String parent, String child)</span> {
        <span class="hljs-type">Data</span> <span class="hljs-variable">data</span> <span class="hljs-operator">=</span> TTL.get();
        <span class="hljs-keyword">if</span> (data != <span class="hljs-literal">null</span>) {
            parent = StringUtils.defaultString(parent, <span class="hljs-string">"ROOT"</span>);
            data.taskPairs.add(EndpointPair.ordered(parent, child));
        }
    }

    <span class="hljs-comment">/** è¯·æ±‚ç»“æŸæ—¶æ£€æµ‹å¹¶æ¸…ç† */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">destroy</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">Data</span> <span class="hljs-variable">data</span> <span class="hljs-operator">=</span> TTL.get();
            <span class="hljs-keyword">if</span> (data != <span class="hljs-literal">null</span> &amp;&amp; !data.taskPairs.isEmpty()) {
                checkAndLog(data);
            }
        } <span class="hljs-keyword">finally</span> {
            TTL.remove();
        }
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">checkAndLog</span><span class="hljs-params">(Data data)</span> {
        <span class="hljs-type">boolean</span> <span class="hljs-variable">hasTaskCycle</span> <span class="hljs-operator">=</span> data.isHasTaskCycle();
        <span class="hljs-type">boolean</span> <span class="hljs-variable">hasExecutorCycle</span> <span class="hljs-operator">=</span> data.isHasExecutorCycle();
        <span class="hljs-type">boolean</span> <span class="hljs-variable">hasSelfLoop</span> <span class="hljs-operator">=</span> data.isHasSelfLoop();

        <span class="hljs-keyword">if</span> (hasTaskCycle || hasExecutorCycle || hasSelfLoop) {
            <span class="hljs-type">String</span> <span class="hljs-variable">edges</span> <span class="hljs-operator">=</span> data.getExecutorGraph().edges().stream()
                    .map(p -&gt; p.source() + <span class="hljs-string">" â†’ "</span> + p.target())
                    .collect(Collectors.joining(<span class="hljs-string">", "</span>));

            log.warn(<span class="hljs-string">"Potential deadlock detected: taskCycle={}, executorCycle={}, "</span> +
                     <span class="hljs-string">"selfLoop={}, edges=[{}]"</span>,
                    hasTaskCycle, hasExecutorCycle, hasSelfLoop, edges);
        }
    }
}
</code></pre>
<h3 data-id="heading-8">å¹¶è¡Œæ‰§è¡Œå™¨é›†æˆ</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * å¹¶è¡Œæ‰§è¡Œå¸®åŠ©ç±» - åœ¨ä»»åŠ¡æäº¤æ—¶è®°å½•ä¾èµ–å…³ç³»
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ParallelHelper</span> {

    <span class="hljs-comment">/**
     * è®°å½•ä»»åŠ¡åˆ†å‰ï¼ˆçˆ¶ä»»åŠ¡ â†’ å­ä»»åŠ¡ï¼‰
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">logForking</span><span class="hljs-params">(String childTaskName)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">parentTaskName</span> <span class="hljs-operator">=</span> ThreadContext.getCurrentTaskName();
        TaskGraph.logTaskPair(parentTaskName, childTaskName);
    }

    <span class="hljs-comment">/**
     * å¹¶è¡Œæ‰§è¡Œä»»åŠ¡é›†åˆ
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;T, R&gt; List&lt;R&gt; <span class="hljs-title function_">parallelMap</span><span class="hljs-params">(
            List&lt;T&gt; items,
            Function&lt;T, R&gt; mapper,
            ParallelOptions options,
            ExecutorService executor)</span> {

        <span class="hljs-keyword">if</span> (CollectionUtils.isEmpty(items)) {
            <span class="hljs-keyword">return</span> Collections.emptyList();
        }

        <span class="hljs-comment">// è®°å½•ä»»åŠ¡ä¾èµ–</span>
        logForking(options.getTaskName());

        <span class="hljs-comment">// åŒ…è£…ä»»åŠ¡ï¼Œä¼ é€’ä¸Šä¸‹æ–‡</span>
        List&lt;Callable&lt;R&gt;&gt; tasks = items.stream()
                .map(item -&gt; wrapWithContext(options.getTaskName(), () -&gt; mapper.apply(item)))
                .collect(toList());

        <span class="hljs-comment">// æäº¤æ‰§è¡Œ</span>
        <span class="hljs-keyword">return</span> submitAndWait(tasks, executor, options.getTimeout());
    }
}
</code></pre>
<h3 data-id="heading-9">ä»»åŠ¡æšä¸¾ä¸æ‰§è¡Œå™¨æ˜ å°„</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * å­ä»»åŠ¡æšä¸¾ - å®šä¹‰ä»»åŠ¡åä¸æ‰§è¡Œå™¨çš„æ˜ å°„å…³ç³»
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">SubTaskEnum</span> {

    <span class="hljs-comment">// ç¤ºä¾‹ä»»åŠ¡å®šä¹‰</span>
    PRICE_CALCULATION(<span class="hljs-string">"PriceCalculation"</span>, <span class="hljs-string">"COMPUTE_POOL"</span>),
    INVENTORY_CHECK(<span class="hljs-string">"InventoryCheck"</span>, <span class="hljs-string">"IO_POOL"</span>),
    CACHE_REFRESH(<span class="hljs-string">"CacheRefresh"</span>, <span class="hljs-string">"IO_POOL"</span>),
    RULE_EVALUATION(<span class="hljs-string">"RuleEvaluation"</span>, <span class="hljs-string">"COMPUTE_POOL"</span>);

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String taskName;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String executorName;

    SubTaskEnum(String taskName, String executorName) {
        <span class="hljs-built_in">this</span>.taskName = taskName;
        <span class="hljs-built_in">this</span>.executorName = executorName;
    }

    <span class="hljs-comment">/** æ„å»ºå…¨å±€æ˜ å°„è¡¨ */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Map&lt;String, String&gt; TASK_TO_EXECUTOR_MAP =
            Arrays.stream(values())
                    .collect(Collectors.toMap(
                            SubTaskEnum::getTaskName,
                            SubTaskEnum::getExecutorName));
}
</code></pre>
<h3 data-id="heading-10">è¯·æ±‚ç”Ÿå‘½å‘¨æœŸé›†æˆ</h3>
<p>RPCæ¡†æ¶å’Œå¸¸é©»çº¿ç¨‹æ± ä»»åŠ¡ç­‰ä¹Ÿéœ€è¦è€ƒè™‘ï¼Œè¿™é‡Œä¸ä½œå±•ç¤ºã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * è¯·æ±‚æ‹¦æˆªå™¨ - ç®¡ç† TaskGraph ç”Ÿå‘½å‘¨æœŸ
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RequestInterceptor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">HandlerInterceptor</span> {

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">preHandle</span><span class="hljs-params">(HttpServletRequest request,
                            HttpServletResponse response,
                            Object handler)</span> {
        ThreadContext.setCurrentTaskName(<span class="hljs-string">"REQUEST_ENTRY"</span>);
        TaskGraph.init();
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">afterCompletion</span><span class="hljs-params">(HttpServletRequest request,
                               HttpServletResponse response,
                               Object handler,
                               Exception ex)</span> {
        <span class="hljs-comment">// è¯·æ±‚ç»“æŸï¼šæ£€æµ‹å¹¶æ¸…ç†</span>
        TaskGraph.destroy();
        ThreadContext.remove();
    }
}
</code></pre>
<h2 data-id="heading-11">æ£€æµ‹æ•ˆæœç¤ºä¾‹</h2>
<h3 data-id="heading-12">åœºæ™¯ï¼šæ‰§è¡Œå™¨è‡ªç¯</h3>
<pre><code class="hljs">COMPUTE_POOL çš„ä»»åŠ¡åŒæ­¥ç­‰å¾… COMPUTE_POOL çš„ç»“æœ
</code></pre>
<p>æ—¥å¿—è¾“å‡ºï¼š</p>
<pre><code class="hljs language-ini" lang="ini">WARN - Potential deadlock detected:
       <span class="hljs-attr">taskCycle</span>=<span class="hljs-literal">true</span>, executorCycle=<span class="hljs-literal">true</span>, selfLoop=<span class="hljs-literal">true</span>,
       <span class="hljs-attr">edges</span>=[COMPUTE_POOL â†’ COMPUTE_POOL]
</code></pre>
<h3 data-id="heading-13">åœºæ™¯ï¼šè·¨æ‰§è¡Œå™¨ç¯è·¯</h3>
<pre><code class="hljs">COMPUTE_POOL â†’ IO_POOL â†’ COMPUTE_POOL
</code></pre>
<p>æ—¥å¿—è¾“å‡ºï¼š</p>
<pre><code class="hljs language-ini" lang="ini">WARN - Potential deadlock detected:
       <span class="hljs-attr">taskCycle</span>=<span class="hljs-literal">true</span>, executorCycle=<span class="hljs-literal">true</span>, selfLoop=<span class="hljs-literal">false</span>,
       <span class="hljs-attr">edges</span>=[COMPUTE_POOL â†’ IO_POOL, IO_POOL â†’ COMPUTE_POOL]
</code></pre>
<h2 data-id="heading-14">æ€»ç»“</h2>
<h3 data-id="heading-15">æŠ€æœ¯è¦ç‚¹</h3>
<p><strong>TTL (TransmittableThreadLocal)</strong>ï¼šç”¨äºè·¨çº¿ç¨‹ä¼ é€’ä»»åŠ¡å›¾æ•°æ®ã€‚é€šè¿‡é‡å†™ <code>copy()</code> æ–¹æ³•è¿”å›åŒä¸€å®ä¾‹ï¼Œä½¿å¾—æ•´ä¸ªè¯·æ±‚æ ‘ä¸­çš„æ‰€æœ‰çº¿ç¨‹å…±äº«åŒä¸€ä¸ª Data å¯¹è±¡ï¼Œä»è€Œå®ç°ä»»åŠ¡ä¾èµ–å…³ç³»çš„ç»Ÿä¸€æ”¶é›†ã€‚</p>
<p><strong>Guava Graph</strong>ï¼šæä¾›é«˜æ•ˆçš„å›¾æ•°æ®ç»“æ„å’Œç¯è·¯æ£€æµ‹èƒ½åŠ›ã€‚ä½¿ç”¨ <code>GraphBuilder</code> æ„å»ºæœ‰å‘å›¾ï¼Œé€šè¿‡ <code>Graphs.hasCycle()</code> æ–¹æ³•æ£€æµ‹æ˜¯å¦å­˜åœ¨å¾ªç¯ä¾èµ–ã€‚</p>
<p><strong>æ‡’åŠ è½½æœºåˆ¶</strong>ï¼šé€šè¿‡ Lombok çš„ <code>@Getter(lazy=true)</code> æ³¨è§£å®ç°æ‡’åŠ è½½ï¼Œä»…åœ¨è¯·æ±‚ç»“æŸéœ€è¦æ£€æµ‹æ—¶æ‰æ„å»ºå›¾å¹¶æ‰§è¡Œåˆ†æï¼Œé¿å…äº†è¿è¡Œæ—¶çš„é¢å¤–è®¡ç®—å¼€é”€ã€‚</p>
<p><strong>LinkedTransferQueue</strong>ï¼šä½œä¸ºæ— é”å¹¶å‘é˜Ÿåˆ—ï¼Œæ”¯æŒå¤šçº¿ç¨‹åŒæ—¶è®°å½•ä»»åŠ¡å¯¹ã€‚è¯¥é˜Ÿåˆ—å…·æœ‰è‰¯å¥½çš„å¹¶å‘æ€§èƒ½ï¼Œå†™å…¥æ“ä½œçš„æ—¶é—´å¤æ‚åº¦ä¸º O(1)ã€‚</p>
<p><strong>Callable åŒ…è£…</strong>ï¼šé‡‡ç”¨è£…é¥°å™¨æ¨¡å¼åŒ…è£…åŸå§‹ä»»åŠ¡ï¼Œåœ¨ä»»åŠ¡æ‰§è¡Œå‰åç»´æŠ¤å½“å‰ä»»åŠ¡åä¸Šä¸‹æ–‡ï¼Œä½¿å¾—åµŒå¥—çš„å­ä»»åŠ¡èƒ½å¤Ÿæ­£ç¡®è®°å½•çˆ¶å­ä¾èµ–å…³ç³»ã€‚</p>
<h3 data-id="heading-16">æ³¨æ„äº‹é¡¹</h3>
<ul>
<li><strong>æ€§èƒ½å¼€é”€</strong>ï¼šTaskGraph ä»…åœ¨è¯·æ±‚ç»“æŸæ—¶æ„å»ºå›¾ç»“æ„ï¼Œè¿è¡Œæ—¶åªè¿›è¡Œé˜Ÿåˆ—å†™å…¥æ“ä½œï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O(1)ï¼Œå¯¹ä¸šåŠ¡æ€§èƒ½å½±å“æå°</li>
<li><strong>è¯¯æŠ¥å¤„ç†</strong>ï¼šæ£€æµ‹åˆ°ç¯è·¯å¹¶ä¸æ„å‘³ç€å¿…ç„¶å‘ç”Ÿæ­»é”ï¼Œéœ€è¦ç»“åˆçº¿ç¨‹æ± çš„æ‹’ç»ç­–ç•¥ï¼ˆå¦‚ CallerRunsPolicyï¼‰å’Œå®é™…ä¸šåŠ¡åœºæ™¯ç»¼åˆåˆ†æ</li>
<li><strong>é‡‡æ ·æ§åˆ¶</strong>ï¼šç”Ÿäº§ç¯å¢ƒå»ºè®®é€šè¿‡é…ç½®å¼€å…³æ§åˆ¶é‡‡æ ·ç‡ï¼Œé¿å…å¯¹æ€§èƒ½æ•æ„Ÿåœºæ™¯äº§ç”Ÿå½±å“</li>
</ul>
<h3 data-id="heading-17">æ‰©å±•æ–¹å‘</h3>
<ul>
<li><strong>å¯è§†åŒ–</strong>ï¼šå°†ä»»åŠ¡å›¾å¯¼å‡ºä¸º DOT æ ¼å¼ï¼Œä½¿ç”¨ Graphviz ç­‰å·¥å…·æ¸²æŸ“æˆå¯è§†åŒ–å›¾è¡¨ï¼Œä¾¿äºç›´è§‚åˆ†æä¾èµ–å…³ç³»</li>
<li><strong>å‘Šè­¦é›†æˆ</strong>ï¼šæ¥å…¥ç›‘æ§ç³»ç»Ÿï¼Œå½“æ£€æµ‹åˆ°æ½œåœ¨æ­»é”æ—¶è‡ªåŠ¨è§¦å‘å‘Šè­¦é€šçŸ¥</li>
<li><strong>å†å²åˆ†æ</strong>ï¼šæŒä¹…åŒ–å­˜å‚¨å†å²æ£€æµ‹æ•°æ®ï¼Œåˆ†æé«˜é¢‘å‡ºç°çš„ç¯è·¯æ¨¡å¼ï¼Œè¯†åˆ«ç³»ç»Ÿæ€§çš„æ¶æ„é—®é¢˜</li>
</ul>
<hr/>
<p>é€šè¿‡è¿™å¥—æ–¹æ¡ˆï¼Œæˆ‘ä»¬èƒ½å¤Ÿåœ¨è¿è¡Œæ—¶è‡ªåŠ¨å‘ç°æ½œåœ¨çš„æ­»é”é£é™©ï¼Œå°†é—®é¢˜ä»"çº¿ä¸Šæ’æŸ¥"å‰ç§»åˆ°"æå‰é¢„è­¦"ï¼Œæ˜¾è‘—é™ä½å¹¶å‘é—®é¢˜çš„å®šä½æˆæœ¬ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[åŒä¸€ç”µè„‘é…ç½®å¤šgithubå¸å·]]></title>    <link>https://juejin.cn/post/7604775190212165642</link>    <guid>https://juejin.cn/post/7604775190212165642</guid>    <pubDate>2026-02-10T04:00:10.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604775190212165642" data-draft-id="7604761524976812041" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="åŒä¸€ç”µè„‘é…ç½®å¤šgithubå¸å· "/> <meta itemprop="keywords" content="å‰ç«¯,åç«¯,JavaScript"/> <meta itemprop="datePublished" content="2026-02-10T04:00:10.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="éšæ„_"/> <meta itemprop="url" content="https://juejin.cn/user/4222562141210478"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            åŒä¸€ç”µè„‘é…ç½®å¤šgithubå¸å· 
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4222562141210478/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    éšæ„_
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T04:00:10.000Z" title="Tue Feb 10 2026 04:00:10 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨æ—¥å¸¸å¼€å‘ä¸­ï¼Œå¾ˆå¤šå¼€å‘è€…ä¼šåŒæ—¶ä½¿ç”¨å¤šä¸ª GitHub è´¦å·ï¼ˆæ¯”å¦‚å·¥ä½œè´¦å·ã€ä¸ªäººè´¦å·ï¼‰ï¼Œå¦‚æœç›´æ¥å…±ç”¨ä¸€å¥— SSH å¯†é’¥ï¼Œä¼šå¯¼è‡´æƒé™æ··ä¹±ã€ä»£ç æäº¤èº«ä»½é”™è¯¯ç­‰é—®é¢˜ã€‚æœ¬æ–‡å°†ä»åŸç†åˆ°å®æ“ï¼Œæ•™ä½ å¦‚ä½•ä¸ºå¤šä¸ª GitHub è´¦å·é…ç½®ç‹¬ç«‹çš„ SSH å¯†é’¥ï¼Œä»¥åŠå¦‚ä½•æ­£ç¡®æ‹‰å–å¯¹åº”è´¦å·çš„ä»£ç ã€‚</p>
<h2 data-id="heading-0">ä¸€ã€æ ¸å¿ƒåŸç†</h2>
<p>SSH å¯†é’¥æ˜¯æœ¬åœ°ä¸ GitHub è®¤è¯çš„ â€œèº«ä»½è¯â€ï¼Œæ¯ä¸ª GitHub è´¦å·å¯ç»‘å®šç‹¬ç«‹çš„ SSH å¯†é’¥ã€‚å•å°ç”µè„‘åŒºåˆ†å¤šè´¦å·çš„å…³é”®æ˜¯ï¼š</p>
<ol>
<li>ä¸ºæ¯ä¸ª GitHub è´¦å·ç”Ÿæˆ<strong>ç‹¬ç«‹çš„ SSH å¯†é’¥æ–‡ä»¶</strong>ï¼›</li>
<li>é€šè¿‡ <code>config</code> é…ç½®æ–‡ä»¶å»ºç«‹ â€œåˆ«å - å¯†é’¥ - è´¦å·â€ çš„å¯¹åº”å…³ç³»ï¼›</li>
<li>æ‹‰å– / æ¨é€ä»£ç æ—¶ï¼Œç”¨è‡ªå®šä¹‰åˆ«åæ›¿ä»£é»˜è®¤çš„ <code>github.com</code>ï¼Œè®© Git è‡ªåŠ¨åŒ¹é…å¯¹åº”å¯†é’¥</li>
</ol>
<h2 data-id="heading-1">äºŒã€å‰ç½®å‡†å¤‡</h2>
<ol>
<li>å·²å®‰è£… Gitï¼ˆWindows/macOS/Linux å‡å¯ï¼‰ï¼›</li>
<li>æ‹¥æœ‰ä¸¤ä¸ªåŠä»¥ä¸Š GitHub è´¦å·ï¼›</li>
<li>çŸ¥æ™“æœ¬åœ°å®¶ç›®å½•è·¯å¾„ï¼ˆWindowsï¼š<code>C:\Users\ä½ çš„ç”¨æˆ·å</code>ï¼›macOS/Linuxï¼š<code>/Users/ä½ çš„ç”¨æˆ·å</code> æˆ– <code>/home/ä½ çš„ç”¨æˆ·å</code>ï¼‰ã€‚</li>
</ol>
<h2 data-id="heading-2">ä¸‰ã€å®æ“æ­¥éª¤ï¼ˆä»¥ 2 ä¸ª GitHub è´¦å·ä¸ºä¾‹ï¼‰</h2>
<h3 data-id="heading-3">æ­¥éª¤ 1ï¼šä¸ºä¸åŒ GitHub è´¦å·ç”Ÿæˆç‹¬ç«‹ SSH å¯†é’¥</h3>
<p>æ‰“å¼€ç»ˆç«¯ï¼ˆWindows ç”¨ Git Bash/CMDï¼ŒmacOS/Linux ç”¨ç»ˆç«¯ï¼‰ï¼Œåˆ†åˆ«ä¸ºä¸¤ä¸ªè´¦å·ç”Ÿæˆå¯†é’¥ï¼ˆæ–‡ä»¶åéœ€åŒºåˆ†ï¼Œæ¯”å¦‚ <code>github_rsa_work</code>ï¼ˆå·¥ä½œï¼‰ã€<code>github_rsa_personal</code>ï¼ˆä¸ªäººï¼‰ï¼‰ã€‚</p>
<h4 data-id="heading-4">å‘½ä»¤æ ¼å¼</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ç”Ÿæˆå·¥ä½œè´¦å·å¯†é’¥ï¼ˆæ›¿æ¢ä¸ºå·¥ä½œè´¦å·é‚®ç®±ï¼‰</span>
ssh-keygen -t ed25519 -C <span class="hljs-string">"work@example.com"</span> -f <span class="hljs-variable">$HOME</span>/.ssh/github_rsa_work

<span class="hljs-comment"># ç”Ÿæˆä¸ªäººè´¦å·å¯†é’¥ï¼ˆæ›¿æ¢ä¸ºä¸ªäººè´¦å·é‚®ç®±ï¼‰</span>
ssh-keygen -t ed25519 -C <span class="hljs-string">"personal@example.com"</span> -f <span class="hljs-variable">$HOME</span>/.ssh/github_rsa_personal
</code></pre>
<h4 data-id="heading-5">æ‰§è¡Œäº¤äº’</h4>
<p>å‘½ä»¤æ‰§è¡Œåä¼šæç¤ºè¾“å…¥ â€œå¯†ç çŸ­è¯­ï¼ˆpassphraseï¼‰â€ï¼Œå»ºè®®ç›´æ¥æŒ‰å›è½¦ç•™ç©ºï¼ˆæ–¹ä¾¿æ—¥å¸¸ä½¿ç”¨ï¼›è‹¥è®¾ç½®å¯†ç ï¼Œæ¯æ¬¡æ‹‰ / æ¨ä»£ç éœ€éªŒè¯ï¼‰ï¼š</p>
<p>plaintext</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">Enter</span> <span class="hljs-string">passphrase</span> <span class="hljs-string">(empty</span> <span class="hljs-string">for</span> <span class="hljs-literal">no</span> <span class="hljs-string">passphrase):</span>  <span class="hljs-comment"># å›è½¦</span>
<span class="hljs-attr">Enter same passphrase again:</span>  <span class="hljs-comment"># å†æ¬¡å›è½¦</span>
</code></pre>
<h4 data-id="heading-6">éªŒè¯ç”Ÿæˆç»“æœ</h4>
<p>æ‰§è¡Œåä¼šåœ¨ <code>~/.ssh</code> ç›®å½•ä¸‹ç”Ÿæˆ 4 ä¸ªæ–‡ä»¶ï¼š</p>
<ul>
<li>å·¥ä½œè´¦å·ï¼š<code>github_rsa_work</code>ï¼ˆç§é’¥ï¼‰ã€<code>github_rsa_work.pub</code>ï¼ˆå…¬é’¥ï¼‰ï¼›</li>
<li>ä¸ªäººè´¦å·ï¼š<code>github_rsa_personal</code>ï¼ˆç§é’¥ï¼‰ã€<code>github_rsa_personal.pub</code>ï¼ˆå…¬é’¥ï¼‰ã€‚</li>
</ul>
<h3 data-id="heading-7">æ­¥éª¤ 2ï¼šå°†å…¬é’¥åˆ†åˆ«æ·»åŠ åˆ°å¯¹åº” GitHub è´¦å·</h3>
<p>SSH å¯†é’¥åˆ† â€œå…¬é’¥â€ å’Œ â€œç§é’¥â€ï¼Œéœ€å°†å…¬é’¥ä¸Šä¼ åˆ° GitHub è´¦å·ï¼Œç§é’¥ä¿å­˜åœ¨æœ¬åœ°ã€‚</p>
<h4 data-id="heading-8">1. å¤åˆ¶å…¬é’¥å†…å®¹</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># å¤åˆ¶å·¥ä½œè´¦å·å…¬é’¥ï¼ˆWindows ç”¨ type æ›¿ä»£ catï¼‰</span>
<span class="hljs-built_in">cat</span> ~/.ssh/github_rsa_work.pub

<span class="hljs-comment"># å¤åˆ¶ä¸ªäººè´¦å·å…¬é’¥</span>
<span class="hljs-built_in">cat</span> ~/.ssh/github_rsa_personal.pub
</code></pre>
<p>å¤åˆ¶ç»ˆç«¯è¾“å‡ºçš„å®Œæ•´å†…å®¹ï¼ˆä»¥ <code>ssh-ed25519</code> å¼€å¤´ï¼Œé‚®ç®±ç»“å°¾ï¼‰ã€‚</p>
<h4 data-id="heading-9">2. ä¸Šä¼ å…¬é’¥åˆ° GitHub</h4>
<p>ä»¥å·¥ä½œè´¦å·ä¸ºä¾‹ï¼Œæ“ä½œæµç¨‹ï¼š</p>
<ol>
<li>ç™»å½•å·¥ä½œ GitHub è´¦å· â†’ ç‚¹å‡»å³ä¸Šè§’å¤´åƒ â†’ <code>Settings</code>ï¼›</li>
<li>å·¦ä¾§èœå•é€‰æ‹© <code>SSH and GPG keys</code> â†’ ç‚¹å‡» <code>New SSH key</code>ï¼›</li>
<li><code>Title</code>ï¼šå¡«å¤‡æ³¨ï¼ˆå¦‚ <code>Mac-work-github</code>ï¼‰ï¼Œä¾¿äºè¯†åˆ«ï¼›</li>
<li><code>Key</code>ï¼šç²˜è´´å¤åˆ¶çš„å…¬é’¥å†…å®¹ â†’ ç‚¹å‡» <code>Add SSH key</code>ï¼›</li>
<li>é‡å¤ä¸Šè¿°æ­¥éª¤ï¼Œå°†ä¸ªäººè´¦å·çš„å…¬é’¥ä¸Šä¼ åˆ°ä¸ªäºº GitHub è´¦å·ã€‚</li>
</ol>
<h3 data-id="heading-10">æ­¥éª¤ 3ï¼šé…ç½® SSH config æ–‡ä»¶ï¼ˆæ ¸å¿ƒï¼‰</h3>
<p><code>config</code> æ–‡ä»¶æ˜¯ Git è¯†åˆ«ä¸åŒè´¦å·å¯†é’¥çš„ â€œè§„åˆ™è¡¨â€ï¼Œéœ€åœ¨ <code>.ssh</code> ç›®å½•ä¸‹åˆ›å»º / ç¼–è¾‘è¯¥æ–‡ä»¶ã€‚</p>
<h4 data-id="heading-11">1. æ‰“å¼€ config æ–‡ä»¶</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># Windows/macOS/Linux é€šç”¨ï¼ˆæ— æ–‡ä»¶åˆ™æ–°å»ºï¼‰</span>
vim ~/.ssh/config
</code></pre>
<h4 data-id="heading-12">2. å†™å…¥é…ç½®å†…å®¹</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># å·¥ä½œ GitHub è´¦å·é…ç½®</span>
Host github-work  <span class="hljs-comment"># è‡ªå®šä¹‰åˆ«åï¼ˆå¯ä»»æ„å‘½åï¼Œå¦‚ github-workï¼‰</span>
    HostName github.com  <span class="hljs-comment"># å›ºå®šä¸º github.comï¼Œä¸å¯æ”¹</span>
    User git  <span class="hljs-comment"># å›ºå®šä¸º gitï¼Œä¸æ˜¯ä½ çš„ GitHub ç”¨æˆ·å</span>
    IdentityFile ~/.ssh/github_rsa_work  <span class="hljs-comment"># ç»‘å®šå·¥ä½œè´¦å·ç§é’¥</span>
    PreferredAuthentications publickey

<span class="hljs-comment"># ä¸ªäºº GitHub è´¦å·é…ç½®</span>
Host github-personal  <span class="hljs-comment"># è‡ªå®šä¹‰åˆ«åï¼ˆå¦‚ github-personalï¼‰</span>
    HostName github.com
    User git
    IdentityFile ~/.ssh/github_rsa_personal  <span class="hljs-comment"># ç»‘å®šä¸ªäººè´¦å·ç§é’¥</span>
    PreferredAuthentications publickey
</code></pre>
<h4 data-id="heading-13">3. ä¿å­˜å¹¶è®¾ç½®æƒé™</h4>
<ul>
<li>
<p>vim ä¸­æŒ‰ <code>Esc</code> â†’ è¾“å…¥ <code>:wq</code> â†’ å›è½¦ä¿å­˜ï¼›</p>
</li>
<li>
<p>è®¾ç½®æ–‡ä»¶æƒé™ï¼ˆé¿å… SSH è®¤è¯å¤±è´¥ï¼ŒmacOS/Linux å¿…åšï¼ŒWindows å¯é€‰ï¼‰ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># è®¾ç½® config æ–‡ä»¶æƒé™</span>
<span class="hljs-built_in">chmod</span> 600 ~/.ssh/config
<span class="hljs-comment"># è®¾ç½®ç§é’¥æƒé™</span>
<span class="hljs-built_in">chmod</span> 600 ~/.ssh/github_rsa_work
<span class="hljs-built_in">chmod</span> 600 ~/.ssh/github_rsa_personal
</code></pre>
</li>
</ul>
<h3 data-id="heading-14">æ­¥éª¤ 4ï¼šæµ‹è¯• SSH è¿æ¥</h3>
<p>éªŒè¯æ¯ä¸ªè´¦å·æ˜¯å¦èƒ½æ­£å¸¸è®¤è¯ï¼š</p>
<pre><code class="hljs language-perl" lang="perl"><span class="hljs-comment"># æµ‹è¯•å·¥ä½œè´¦å·</span>
ssh -T git@github-work

<span class="hljs-comment"># æµ‹è¯•ä¸ªäººè´¦å·</span>
ssh -T git@github-personal
</code></pre>
<p>è‹¥è¿”å› <code>Hi [ä½ çš„è´¦å·å]! You've successfully authenticated...</code>ï¼Œè¯´æ˜é…ç½®ç”Ÿæ•ˆã€‚</p>
<h2 data-id="heading-15">å››ã€æ‹‰å–å¯¹åº”è´¦å·çš„ä»£ç ï¼ˆå®æ“ï¼‰</h2>
<p>é…ç½®å®Œæˆåï¼Œæ‹‰å–ä»£ç çš„æ ¸å¿ƒæ˜¯<strong>ç”¨è‡ªå®šä¹‰åˆ«åæ›¿æ¢ä»“åº“åœ°å€ä¸­çš„ <code>github.com</code></strong>ã€‚</p>
<h3 data-id="heading-16">åœºæ™¯ 1ï¼šå…‹éš†æ–°ä»“åº“</h3>
<h4 data-id="heading-17">1. å¤åˆ¶ä»“åº“ SSH åœ°å€</h4>
<p>ç™»å½•å¯¹åº” GitHub è´¦å· â†’ æ‰“å¼€ä»“åº“ â†’ ç‚¹å‡» <code>Code</code> â†’ <code>SSH</code> â†’ å¤åˆ¶åœ°å€ï¼ˆå¦‚ <code>git@github.com:work-account/project.git</code>ï¼‰ã€‚</p>
<h4 data-id="heading-18">2. æ›¿æ¢åˆ«åå¹¶å…‹éš†</h4>
<ul>
<li>
<p>å·¥ä½œä»“åº“ï¼šå°† <code>github.com</code> æ›¿æ¢ä¸º <code>github-work</code></p>
<pre><code class="hljs language-bash" lang="bash">git <span class="hljs-built_in">clone</span> git@github-work:work-account/project.git
</code></pre>
</li>
<li>
<p>ä¸ªäººä»“åº“ï¼šå°† <code>github.com</code> æ›¿æ¢ä¸º <code>github-personal</code></p>
<pre><code class="hljs language-bash" lang="bash">git <span class="hljs-built_in">clone</span> git@github-personal:personal-account/notes.git
</code></pre>
</li>
</ul>
<h3 data-id="heading-19">åœºæ™¯ 2ï¼šä¿®æ”¹å·²å…‹éš†ä»“åº“çš„è¿œç¨‹åœ°å€</h3>
<p>è‹¥ä»“åº“å·²å…‹éš†ï¼ˆé»˜è®¤ç”¨ <code>github.com</code> åœ°å€ï¼‰ï¼Œéœ€ä¿®æ”¹è¿œç¨‹åœ°å€åŒ¹é…å¯¹åº”è´¦å·ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># è¿›å…¥ä»“åº“ç›®å½•</span>
<span class="hljs-built_in">cd</span> project
<span class="hljs-comment"># ä¿®æ”¹ä¸ºå·¥ä½œè´¦å·åœ°å€</span>
git remote set-url origin git@github-work:work-account/project.git
</code></pre>
<h3 data-id="heading-20">è¡¥å……ï¼šè®¾ç½®æäº¤èº«ä»½ï¼ˆé¿å…ä¿¡æ¯æ··æ·†ï¼‰</h3>
<p>SSH è§£å†³ â€œè®¤è¯â€ é—®é¢˜ï¼Œè€Œæäº¤ä»£ç çš„èº«ä»½ç”± <code>user.name</code>/<code>user.email</code> å†³å®šï¼Œéœ€ä¸ºæ¯ä¸ªä»“åº“å•ç‹¬è®¾ç½®ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino"># è¿›å…¥å·¥ä½œä»“åº“ï¼Œè®¾ç½®å·¥ä½œè´¦å·ä¿¡æ¯
git config user.name <span class="hljs-string">"WorkName"</span>
git config user.email <span class="hljs-string">"work@example.com"</span>

# è¿›å…¥ä¸ªäººä»“åº“ï¼Œè®¾ç½®ä¸ªäººè´¦å·ä¿¡æ¯
git config user.name <span class="hljs-string">"PersonalName"</span>
git config user.email <span class="hljs-string">"personal@example.com"</span>
</code></pre>
<p>âš ï¸ ä¸è¦ç”¨ <code>git config --global</code> å…¨å±€è®¾ç½®ï¼Œå¦åˆ™ä¼šå¯¼è‡´æ‰€æœ‰ä»“åº“æäº¤ä¿¡æ¯æ··ä¹±ã€‚</p>
<h2 data-id="heading-21">äº”ã€å¸¸è§é—®é¢˜æ’æŸ¥</h2>
<ol>
<li>
<p><strong>Permission denied (publickey)</strong> ï¼š</p>
<ul>
<li>æ£€æŸ¥ <code>config</code> æ–‡ä»¶ä¸­ç§é’¥è·¯å¾„æ˜¯å¦æ­£ç¡®ï¼›</li>
<li>ç¡®è®¤å…¬é’¥å·²ä¸Šä¼ åˆ°å¯¹åº” GitHub è´¦å·ï¼›</li>
<li>éªŒè¯ç§é’¥ /<code>config</code> æ–‡ä»¶æƒé™æ˜¯å¦ä¸º 600ï¼ˆmacOS/Linuxï¼‰ã€‚</li>
</ul>
</li>
<li>
<p><strong>æ‹‰å–ä»£ç æ—¶æç¤º â€œä»“åº“ä¸å­˜åœ¨â€</strong> ï¼š</p>
<ul>
<li>æ£€æŸ¥åˆ«åæ˜¯å¦æ­£ç¡®ï¼ˆå¦‚æŠŠ <code>github-work</code> å†™æˆ <code>github-work1</code>ï¼‰ï¼›</li>
<li>ç¡®è®¤ä»“åº“åœ°å€ä¸­çš„è´¦å·åã€é¡¹ç›®åæ— è¯¯ã€‚</li>
</ul>
</li>
<li>
<p><strong>æäº¤ä»£ç åèº«ä»½é”™è¯¯</strong>ï¼š</p>
<ul>
<li>æœªä¸ºä»“åº“å•ç‹¬è®¾ç½® <code>user.name</code>/<code>user.email</code>ï¼Œéœ€è¡¥å……è®¾ç½®ã€‚</li>
</ul>
</li>
</ol>
<h2 data-id="heading-22">å…­ã€æ‰©å±•ï¼šæ·»åŠ æ›´å¤š GitHub è´¦å·</h2>
<p>è‹¥éœ€é…ç½®ç¬¬ä¸‰ä¸ªåŠä»¥ä¸Šè´¦å·ï¼Œåªéœ€é‡å¤ä»¥ä¸‹æ­¥éª¤ï¼š</p>
<ol>
<li>ç”Ÿæˆæ–°å¯†é’¥ï¼š<code>ssh-keygen -t ed25519 -C "new@example.com" -f ~/.ssh/github_rsa_new</code>ï¼›</li>
<li>ä¸Šä¼ æ–°å…¬é’¥åˆ°å¯¹åº” GitHub è´¦å·ï¼›</li>
<li>åœ¨ <code>config</code> æ–‡ä»¶ä¸­æ–°å¢ä¸€æ®µé…ç½®ï¼ˆè‡ªå®šä¹‰æ–°åˆ«åï¼Œç»‘å®šæ–°ç§é’¥ï¼‰ï¼›</li>
<li>æ‹‰å–ä»£ç æ—¶ç”¨æ–°åˆ«åæ›¿æ¢ <code>github.com</code>ã€‚</li>
</ol>
<h2 data-id="heading-23">æ€»ç»“</h2>
<ol>
<li>å¤š GitHub è´¦å·é…ç½®çš„æ ¸å¿ƒæ˜¯ â€œç‹¬ç«‹å¯†é’¥ + config åˆ«åç»‘å®šâ€ï¼›</li>
<li>æ‹‰å–ä»£ç çš„å…³é”®æ˜¯ç”¨è‡ªå®šä¹‰åˆ«åæ›¿ä»£ <code>github.com</code>ï¼›</li>
<li>æäº¤ä»£ç æ—¶éœ€ä¸ºä»“åº“å•ç‹¬è®¾ç½® <code>user.name</code>/<code>user.email</code>ï¼Œé¿å…èº«ä»½æ··æ·†ã€‚é€šè¿‡ä»¥ä¸Šé…ç½®ï¼Œå•å°ç”µè„‘å¯æ— ç¼åˆ‡æ¢å¤šä¸ª GitHub è´¦å·ï¼Œæ—¢ä¿è¯äº†æƒé™éš”ç¦»ï¼Œåˆèƒ½é«˜æ•ˆç®¡ç†ä¸åŒè´¦å·çš„ä»£ç ä»“åº“ã€‚</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[0210_1 SFC SPI/QSPI æ¨¡å¼æ·±åº¦åˆ†æ]]></title>    <link>https://juejin.cn/post/7604697194794565642</link>    <guid>https://juejin.cn/post/7604697194794565642</guid>    <pubDate>2026-02-09T17:29:50.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604697194794565642" data-draft-id="7604690250363682825" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="0210_1  SFC SPI/QSPI æ¨¡å¼æ·±åº¦åˆ†æ"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2026-02-09T17:29:50.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ly77777"/> <meta itemprop="url" content="https://juejin.cn/user/3775071381890170"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            0210_1  SFC SPI/QSPI æ¨¡å¼æ·±åº¦åˆ†æ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3775071381890170/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ly77777
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-09T17:29:50.000Z" title="Mon Feb 09 2026 17:29:50 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    11
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»31åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">FBB_WS63 SFC SPI/QSPI æ¨¡å¼æ·±åº¦åˆ†æ</h2>
<h3 data-id="heading-1">ğŸ“‹ ç›®å½•</h3>
<ol>
<li><a href="#spi-vs-qspi-%E6%A8%A1%E5%BC%8F%E5%AF%B9%E6%AF%94" title="#spi-vs-qspi-%E6%A8%A1%E5%BC%8F%E5%AF%B9%E6%AF%94">SPI vs QSPI æ¨¡å¼å¯¹æ¯”</a></li>
<li><a href="#gpio-pin-%E6%98%A0%E5%B0%84" title="#gpio-pin-%E6%98%A0%E5%B0%84">GPIO Pin æ˜ å°„</a></li>
<li><a href="#%E7%BC%96%E8%AF%91%E9%85%8D%E7%BD%AE%E5%BC%80%E5%85%B3" title="#%E7%BC%96%E8%AF%91%E9%85%8D%E7%BD%AE%E5%BC%80%E5%85%B3">ç¼–è¯‘é…ç½®å¼€å…³</a></li>
<li><a href="#gpio-%E9%87%8D%E6%96%B0%E5%B8%83%E7%BA%BF%E4%BF%AE%E6%94%B9%E6%B8%85%E5%8D%95" title="#gpio-%E9%87%8D%E6%96%B0%E5%B8%83%E7%BA%BF%E4%BF%AE%E6%94%B9%E6%B8%85%E5%8D%95">GPIO é‡æ–°å¸ƒçº¿ä¿®æ”¹æ¸…å•</a></li>
<li><a href="#%E4%BB%A3%E7%A0%81%E8%B7%AF%E5%BE%84%E6%B1%87%E6%80%BB" title="#%E4%BB%A3%E7%A0%81%E8%B7%AF%E5%BE%84%E6%B1%87%E6%80%BB">ä»£ç è·¯å¾„æ±‡æ€»</a></li>
</ol>
<hr/>
<h3 data-id="heading-2">1ï¸âƒ£ SPI vs QSPI æ¨¡å¼å¯¹æ¯”</h3>
<h4 data-id="heading-3">ğŸ“Š æ¨¡å¼æ¦‚è§ˆ</h4>








































<table><thead><tr><th>ç‰¹æ€§</th><th>SPI æ¨¡å¼</th><th>QSPI æ¨¡å¼</th></tr></thead><tbody><tr><td><strong>é€šè®¯æ¨¡å¼</strong></td><td>æ ‡å‡† SPI</td><td>å››çº¿ SPI</td></tr><tr><td><strong>GPIO pin æ•°é‡</strong></td><td>4 æ¡</td><td>6 æ¡</td></tr><tr><td><strong>æ•°æ®çº¿</strong></td><td>MOSI(1çº¿) + MISO(1çº¿)</td><td>IO0 + IO1 + IO2 + IO3(4çº¿)</td></tr><tr><td><strong>ä¼ è¾“é€Ÿåº¦</strong></td><td>æ­£å¸¸</td><td>4x æ›´å¿«</td></tr><tr><td><strong>åº”ç”¨åœºæ™¯</strong></td><td>é€šç”¨ Flash</td><td>é«˜é€Ÿ Flashã€å­˜å‚¨å™¨</td></tr><tr><td><strong>Flash æ”¯æŒ</strong></td><td>æ‰€æœ‰ç°ä»£ Flash</td><td>å¤§å¤šæ•°æ–°å‹ Flash</td></tr></tbody></table>
<h4 data-id="heading-4">ğŸ”Œ ä¸¤ç§æ¨¡å¼çš„ GPIO éœ€æ±‚å¯¹æ¯”</h4>
<h5 data-id="heading-5">SPI æ¨¡å¼ï¼ˆæ ‡å‡†4çº¿ï¼‰</h5>
<pre><code class="hljs language-scss" lang="scss">â”Œâ”€â”€â”€ SFC ç¡¬ä»¶æ¨¡å— â”€â”€â”€â”
â”‚ WS63 SFC æ§åˆ¶å™¨    â”‚
â”‚ (<span class="hljs-number">0</span>x48000000)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â”œâ”€â†’ GPIO_19 (SFC_CLK)    - æ—¶é’Ÿä¿¡å·ï¼ŒCLK
        â”œâ”€â†’ GPIO_20 (SFC_CSN)    - ç‰‡é€‰ä¿¡å·ï¼ŒCSï¼ˆä½æœ‰æ•ˆï¼‰
        â”œâ”€â†’ GPIO_21 (SFC_IO0)    - æ•°æ®çº¿ <span class="hljs-number">0</span>ï¼ŒMOSIï¼ˆMaster Outï¼‰
        â””â”€â†’ GPIO_22 (SFC_IO1)    - æ•°æ®çº¿ <span class="hljs-number">1</span>ï¼ŒMISOï¼ˆMaster Inï¼‰
</code></pre>
<h5 data-id="heading-6">QSPI æ¨¡å¼ï¼ˆå››çº¿å¢å¼ºï¼‰</h5>
<pre><code class="hljs language-scss" lang="scss">â”Œâ”€â”€â”€ SFC ç¡¬ä»¶æ¨¡å— â”€â”€â”€â”
â”‚ WS63 SFC æ§åˆ¶å™¨    â”‚
â”‚ (<span class="hljs-number">0</span>x48000000)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â”œâ”€â†’ GPIO_19 (SFC_CLK)    - æ—¶é’Ÿä¿¡å·
        â”œâ”€â†’ GPIO_20 (SFC_CSN)    - ç‰‡é€‰ä¿¡å·
        â”œâ”€â†’ GPIO_21 (SFC_IO0)    - æ•°æ®çº¿ <span class="hljs-number">0</span>ï¼ŒMOSI
        â”œâ”€â†’ GPIO_22 (SFC_IO1)    - æ•°æ®çº¿ <span class="hljs-number">1</span>ï¼ŒMISO
        â”œâ”€â†’ GPIO_23 (SFC_IO2)    - æ•°æ®çº¿ <span class="hljs-number">2</span>ï¼ŒWPï¼ˆå†™ä¿æŠ¤ï¼Œä½æœ‰æ•ˆï¼‰
        â””â”€â†’ GPIO_24 (SFC_IO3)    - æ•°æ®çº¿ <span class="hljs-number">3</span>ï¼ŒHOLDï¼ˆä¿æŒï¼Œä½æœ‰æ•ˆï¼‰
</code></pre>
<h4 data-id="heading-7">ğŸ“Œ å…³é”®å·®å¼‚è¯´æ˜</h4>





















































<table><thead><tr><th>é¡¹ç›®</th><th>SPI æ¨¡å¼</th><th>QSPI æ¨¡å¼</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>CLK</strong></td><td>GPIO_19</td><td>GPIO_19</td><td>å§‹ç»ˆéœ€è¦ï¼ˆç¡¬å›ºå®šï¼‰</td></tr><tr><td><strong>CSN</strong></td><td>GPIO_20</td><td>GPIO_20</td><td>å§‹ç»ˆéœ€è¦ï¼ˆç¡¬å›ºå®šï¼‰</td></tr><tr><td><strong>MOSI(IO0)</strong></td><td>GPIO_21</td><td>GPIO_21</td><td>å§‹ç»ˆéœ€è¦ï¼ˆç¡¬å›ºå®šï¼‰</td></tr><tr><td><strong>MISO(IO1)</strong></td><td>GPIO_22</td><td>GPIO_22</td><td>å§‹ç»ˆéœ€è¦ï¼ˆç¡¬å›ºå®šï¼‰</td></tr><tr><td><strong>WP(IO2)</strong></td><td>âŒ ä¸éœ€è¦</td><td>GPIO_23</td><td>âš ï¸ QSPI å¿…éœ€</td></tr><tr><td><strong>HOLD(IO3)</strong></td><td>âŒ ä¸éœ€è¦</td><td>GPIO_24</td><td>âš ï¸ QSPI å¿…éœ€</td></tr><tr><td><strong>æ€» Pin æ•°</strong></td><td><strong>4</strong></td><td><strong>6</strong></td><td>+2 pin</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-8">2ï¸âƒ£ GPIO Pin æ˜ å°„</h3>
<h4 data-id="heading-9">ğŸ¯ GPIO Pin å®šä¹‰ä½ç½®</h4>
<h5 data-id="heading-10"><strong>æ–‡ä»¶ 1</strong>ï¼š<a href="https://link.juejin.cn?target=src%2Fdrivers%2Fchips%2Fws63%2Finclude%2Fplatform_core_rom.h" target="_blank" title="src/drivers/chips/ws63/include/platform_core_rom.h" ref="nofollow noopener noreferrer">src/drivers/chips/ws63/include/platform_core_rom.h</a></h5>
<p><strong>ä½ç½®</strong>ï¼šç¬¬ 50-54 è¡Œ</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">enum</span> {</span>
    GPIO_00 = <span class="hljs-number">0</span>,
    <span class="hljs-comment">// ... GPIO_01 åˆ° GPIO_18 ...</span>
    GPIO_18 = <span class="hljs-number">18</span>,
    SFC_CLK = <span class="hljs-number">19</span>,      <span class="hljs-comment">// âœ… Flash æ—¶é’Ÿ</span>
    SFC_CSN = <span class="hljs-number">20</span>,      <span class="hljs-comment">// âœ… ç‰‡é€‰ï¼ˆCS#ï¼‰</span>
    SFC_IO0 = <span class="hljs-number">21</span>,      <span class="hljs-comment">// âœ… MOSI æ•°æ®çº¿ 0</span>
    SFC_IO1 = <span class="hljs-number">22</span>,      <span class="hljs-comment">// âœ… MISO æ•°æ®çº¿ 1</span>
    SFC_IO2 = <span class="hljs-number">23</span>,      <span class="hljs-comment">// âš ï¸  æ•°æ®çº¿ 2ï¼ˆWPï¼Œä»… QSPIï¼‰</span>
    SFC_IO3 = <span class="hljs-number">24</span>,      <span class="hljs-comment">// âš ï¸  æ•°æ®çº¿ 3ï¼ˆHOLDï¼Œä»… QSPIï¼‰</span>
    PIN_NONE = <span class="hljs-number">25</span>,
} <span class="hljs-type">pin_t</span>;
</code></pre>
<p><strong>è¯´æ˜</strong>ï¼š</p>
<ul>
<li>è¿™äº›æ˜¯ <strong>enum æšä¸¾å®šä¹‰</strong>ï¼Œæ˜ å°„åˆ°å…·ä½“çš„ GPIO å·ï¼ˆ19-24ï¼‰</li>
<li>GPIO_19-22 æ˜¯ç¡¬ä»¶å›ºå®šåˆ†é…çš„ SFC å¼•è„š</li>
<li>GPIO_23-24 æ˜¯å¯é€‰çš„ QSPI æ‰©å±•å¼•è„š</li>
<li><strong>è¿™æ˜¯ç¡¬ä»¶çº§åˆ«çš„å›ºå®šè¿æ¥</strong>ï¼Œä¸èƒ½æ”¹å˜</li>
</ul>
<hr/>
<h5 data-id="heading-11"><strong>æ–‡ä»¶ 2</strong>ï¼š<a href="https://link.juejin.cn?target=src%2Fdrivers%2Fchips%2Fws63%2Fporting%2Fsoc%2Fsoc_porting.c" target="_blank" title="src/drivers/chips/ws63/porting/soc/soc_porting.c" ref="nofollow noopener noreferrer">src/drivers/chips/ws63/porting/soc/soc_porting.c</a></h5>
<p><strong>ä½ç½®</strong>ï¼šç¬¬ 64-79 è¡Œ</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// PAD å¯„å­˜å™¨åœ°å€ï¼ˆç¡¬ä»¶ Pad Controlï¼‰</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> PAD_SFC_CLK_CTRL  0x4400d868    <span class="hljs-comment">// GPIO_19 çš„ Pad æ§åˆ¶å¯„å­˜å™¨</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> PAD_SFC_CSN_CTRL  0x4400d86C    <span class="hljs-comment">// GPIO_20 çš„ Pad æ§åˆ¶å¯„å­˜å™¨</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> PAD_SFC_IO0_CTRL  0x4400d870    <span class="hljs-comment">// GPIO_21 çš„ Pad æ§åˆ¶å¯„å­˜å™¨</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> PAD_SFC_IO1_CTRL  0x4400d874    <span class="hljs-comment">// GPIO_22 çš„ Pad æ§åˆ¶å¯„å­˜å™¨</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> PAD_SFC_IO2_CTRL  0x4400d878    <span class="hljs-comment">// GPIO_23 çš„ Pad æ§åˆ¶å¯„å­˜å™¨ï¼ˆQSPIï¼‰</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> PAD_SFC_IO3_CTRL  0x4400d87C    <span class="hljs-comment">// GPIO_24 çš„ Pad æ§åˆ¶å¯„å­˜å™¨ï¼ˆQSPIï¼‰</span></span>

<span class="hljs-comment">// é©±åŠ¨å¼ºåº¦ (Drive Strength) è®¾ç½®</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> SFC_CLK_DS_VALUE      0x3       <span class="hljs-comment">// CLK é©±åŠ¨å¼ºåº¦</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> SFC_CSN_DS_VALUE      0x2       <span class="hljs-comment">// CSN é©±åŠ¨å¼ºåº¦</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> SFC_DATA_DS_VALUE     0x2       <span class="hljs-comment">// æ•°æ®çº¿é©±åŠ¨å¼ºåº¦</span></span>

<span class="hljs-type">void</span> <span class="hljs-title function_">config_sfc_ctrl_ds</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span>
{
    reg_setbits(PAD_SFC_CLK_CTRL, <span class="hljs-number">0</span>, POS_4, DTRL_DS_LEN, SFC_CLK_DS_VALUE);
    reg_setbits(PAD_SFC_CSN_CTRL, <span class="hljs-number">0</span>, POS_4, DTRL_DS_LEN, SFC_CSN_DS_VALUE);
    reg_setbits(PAD_SFC_IO0_CTRL, <span class="hljs-number">0</span>, POS_4, DTRL_DS_LEN, SFC_DATA_DS_VALUE);
    reg_setbits(PAD_SFC_IO1_CTRL, <span class="hljs-number">0</span>, POS_4, DTRL_DS_LEN, SFC_DATA_DS_VALUE);
    reg_setbits(PAD_SFC_IO2_CTRL, <span class="hljs-number">0</span>, POS_4, DTRL_DS_LEN, SFC_DATA_DS_VALUE);
    reg_setbits(PAD_SFC_IO3_CTRL, <span class="hljs-number">0</span>, POS_4, DTRL_DS_LEN, SFC_DATA_DS_VALUE);
}
</code></pre>
<p><strong>è¯´æ˜</strong>ï¼š</p>
<ul>
<li>è¿™æ˜¯èŠ¯ç‰‡ Pad æ§åˆ¶çš„ç¡¬ä»¶å¯„å­˜å™¨åœ°å€</li>
<li>é…ç½®äº†æ¯æ¡çº¿çš„é©±åŠ¨å¼ºåº¦ï¼ˆDrive Strengthï¼‰</li>
<li>è¿™äº›åœ°å€æ˜¯èŠ¯ç‰‡çº§åˆ«çš„å›ºå®šå€¼ï¼ˆSOC çº§åˆ«ï¼‰</li>
<li><strong>ä¸å»ºè®®ä¿®æ”¹è¿™äº›åœ°å€</strong>ï¼Œé™¤éç¡¬ä»¶é‡æ–°è®¾è®¡</li>
</ul>
<hr/>
<h5 data-id="heading-12"><strong>æ–‡ä»¶ 3</strong>ï¼š<a href="https://link.juejin.cn?target=src%2Fdrivers%2Fdrivers%2Fhal%2Fpinmux%2Fws63%2Fhal_pinctrl_ws63.c" target="_blank" title="src/drivers/drivers/hal/pinmux/ws63/hal_pinctrl_ws63.c" ref="nofollow noopener noreferrer">src/drivers/drivers/hal/pinmux/ws63/hal_pinctrl_ws63.c</a></h5>
<p><strong>ä½ç½®</strong>ï¼šç¬¬ 20-27 è¡Œï¼ˆåŸºåœ°å€å®šä¹‰ï¼‰ã€ç¬¬ 109-140 è¡Œï¼ˆpin é…ç½®ç»„ï¼‰</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">define</span> HAL_IO_CFG_BASE_ADDR            0x4400D000</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> HAL_PIN_GPIO_SEL_START_OFFSET   0x000</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> HAL_PIN_UART_SEL_START_OFFSET   0x03C</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> HAL_PIN_GPIO_CTRL_START_OFFSET  0x800</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> HAL_PIN_SFC_CTRL_START_OFFSET   0x868  <span class="hljs-comment">// âœ… SFC pin æ§åˆ¶èµ·å§‹åœ°å€</span></span>

<span class="hljs-meta">#<span class="hljs-keyword">define</span> HAL_PIN_GPIO_SEL_START_ADDR     (HAL_IO_CFG_BASE_ADDR + HAL_PIN_GPIO_SEL_START_OFFSET)</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> HAL_PIN_UART_SEL_START_ADDR     (HAL_IO_CFG_BASE_ADDR + HAL_PIN_UART_SEL_START_OFFSET)</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> HAL_PIN_GPIO_CTRL_START_ADDR    (HAL_IO_CFG_BASE_ADDR + HAL_PIN_GPIO_CTRL_START_OFFSET)</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> HAL_PIN_SFC_CTRL_START_ADDR     (HAL_IO_CFG_BASE_ADDR + HAL_PIN_SFC_CTRL_START_OFFSET)</span>
</code></pre>
<p><strong>Pin é…ç½®ç»„ï¼ˆç¬¬ 109-140 è¡Œï¼‰</strong>ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-type">static</span> <span class="hljs-type">hal_pin_config_group_t</span> <span class="hljs-type">const</span> g_pin_pull_map[] = {
    {
        GPIO_00,
        GPIO_14,
        HAL_PIN_GPIO_CTRL_START_ADDR,
        <span class="hljs-comment">// ... GPIO_00~14 çš„ä¸Šæ‹‰/ä¸‹æ‹‰é…ç½® ...</span>
    },
    {
        SFC_CLK,                          <span class="hljs-comment">// GPIO_19</span>
        SFC_IO3,                          <span class="hljs-comment">// GPIO_24</span>
        HAL_PIN_SFC_CTRL_START_ADDR,      <span class="hljs-comment">// 0x4400D868</span>
        HAL_PIN_CONFIG_PER_NUM,
        HAL_PIN_PULL_START_BIT,
        HAL_PIN_PULL_BITS_NUM
    }
};

<span class="hljs-type">static</span> <span class="hljs-type">hal_pin_config_group_t</span> <span class="hljs-type">const</span> g_pin_ds_map[] = {
    {
        GPIO_00,
        GPIO_14,
        HAL_PIN_GPIO_CTRL_START_ADDR,
        <span class="hljs-comment">// ... GPIO_00~14 çš„é©±åŠ¨å¼ºåº¦é…ç½® ...</span>
    },
    {
        SFC_CLK,                          <span class="hljs-comment">// GPIO_19</span>
        SFC_IO3,                          <span class="hljs-comment">// GPIO_24</span>
        HAL_PIN_SFC_CTRL_START_ADDR,      <span class="hljs-comment">// 0x4400D868</span>
        HAL_PIN_CONFIG_PER_NUM,
        HAL_PIN_DS_START_BIT,
        HAL_PIN_DS_BITS_NUM
    }
};

<span class="hljs-comment">// IEï¼ˆè¾“å…¥ä½¿èƒ½ï¼‰é…ç½®</span>
<span class="hljs-type">static</span> <span class="hljs-type">hal_pin_config_group_t</span> <span class="hljs-type">const</span> g_pin_ie_map[] = {
    {
        SFC_CLK,      <span class="hljs-comment">// GPIO_19</span>
        SFC_IO3,      <span class="hljs-comment">// GPIO_24</span>
        HAL_PIN_SFC_CTRL_START_ADDR,
        <span class="hljs-comment">// ...</span>
    }
};

<span class="hljs-comment">// STï¼ˆSchmitt Triggerï¼‰é…ç½®</span>
<span class="hljs-type">static</span> <span class="hljs-type">hal_pin_config_group_t</span> <span class="hljs-type">const</span> g_pin_st_map[] = {
    {
        SFC_CLK,      <span class="hljs-comment">// GPIO_19</span>
        SFC_IO3,      <span class="hljs-comment">// GPIO_24</span>
        HAL_PIN_SFC_CTRL_START_ADDR,
        <span class="hljs-comment">// ...</span>
    }
};
</code></pre>
<p><strong>è¯´æ˜</strong>ï¼š</p>
<ul>
<li>å®šä¹‰äº† SFC çš„ pin æ§åˆ¶å¯„å­˜å™¨åŸºåœ°å€</li>
<li>GPIO_19-24 éƒ½ç»Ÿä¸€åœ¨ <code>HAL_PIN_SFC_CTRL_START_ADDR</code> é…ç½®ç»„ä¸­</li>
<li>é…ç½®é¡¹åŒ…æ‹¬ï¼šä¸Šæ‹‰/ä¸‹æ‹‰ã€é©±åŠ¨å¼ºåº¦ã€è¾“å…¥ä½¿èƒ½ã€æ–½å¯†ç‰¹è§¦å‘å™¨</li>
</ul>
<hr/>
<h4 data-id="heading-13">ğŸ”„ GPIO Pin ä½¿ç”¨æµç¨‹</h4>
<pre><code class="hljs language-scss" lang="scss">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç¡¬å¯åŠ¨/çƒ§å½•ï¼ˆBootLoaderï¼‰                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ <span class="hljs-number">1</span>. SFC ç¡¬ä»¶è‡ªåŠ¨ä½¿ç”¨ GPIO_19-<span class="hljs-number">22</span>ï¼ˆSPI æ¨¡å¼ï¼‰        â”‚
â”‚ <span class="hljs-number">2</span>. soc_porting<span class="hljs-selector-class">.c</span> é…ç½® Pad é©±åŠ¨å¼ºåº¦                 â”‚
â”‚    â””â”€ <span class="hljs-built_in">config_sfc_ctrl_ds</span>()                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åº”ç”¨å¯åŠ¨ï¼ˆAPP é˜¶æ®µï¼‰                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ <span class="hljs-number">1</span>. sfc<span class="hljs-selector-class">.c</span> è°ƒç”¨ <span class="hljs-built_in">hal_sfc_init</span>()                       â”‚
â”‚ <span class="hljs-number">2</span>. hal_pinctrl_ws63<span class="hljs-selector-class">.c</span> é…ç½® pin å±æ€§                â”‚
â”‚    â””â”€ æ‹‰é«˜/æ‹‰ä½ã€é©±åŠ¨å¼ºåº¦ç­‰                       â”‚
â”‚ <span class="hljs-number">3</span>. SFC é©±åŠ¨åˆå§‹åŒ–å®Œæˆ                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<hr/>
<h3 data-id="heading-14">3ï¸âƒ£ ç¼–è¯‘é…ç½®å¼€å…³</h3>
<h4 data-id="heading-15">ğŸ“š Kconfig é…ç½®æ–‡ä»¶ä½ç½®</h4>
<h5 data-id="heading-16"><strong>æ–‡ä»¶ 1</strong>ï¼š<a href="https://link.juejin.cn?target=src%2Fdrivers%2Fdrivers%2FKconfig" target="_blank" title="src/drivers/drivers/Kconfig" ref="nofollow noopener noreferrer">src/drivers/drivers/Kconfig</a></h5>
<p><strong>ä½ç½®</strong>ï¼šç¬¬ 387-403 è¡Œ</p>
<pre><code class="hljs language-kconfig" lang="kconfig">config DRIVER_SUPPORT_SFC
    bool
    prompt "SFC"
    default y
    help
        This option means support SFC.

if DRIVER_SUPPORT_SFC
menu "SFC Configuration"
    comment "Config  SFC"
    osource "drivers/drivers/driver/sfc/Kconfig"
    osource "drivers/drivers/hal/sfc/Kconfig"
endmenu
endif

config DRIVER_SUPPORT_SPI
    bool
    prompt "SPI"
    default n
    help
        This option means support SPI.

if DRIVER_SUPPORT_SPI
menu "SPI Configuration"
    comment "Config SPI"
    osource "drivers/drivers/driver/spi/Kconfig"
    osource "drivers/drivers/hal/spi/Kconfig"
endmenu
endif
</code></pre>
<p><strong>è¯´æ˜</strong>ï¼š</p>
<ul>
<li><code>CONFIG_DRIVER_SUPPORT_SFC</code> - SFC é©±åŠ¨æ€»å¼€å…³ï¼ˆ<strong>é»˜è®¤å¯ç”¨</strong>ï¼‰</li>
<li><code>CONFIG_DRIVER_SUPPORT_SPI</code> - é€šç”¨ SPI é©±åŠ¨æ€»å¼€å…³ï¼ˆ<strong>é»˜è®¤ç¦ç”¨</strong>ï¼‰</li>
<li><strong>å…³é”®ç‚¹</strong>ï¼šSFC å’Œ SPI æ˜¯åˆ†åˆ«çš„é©±åŠ¨ï¼Œä¸ä¼šç›´æ¥å†²çª</li>
</ul>
<hr/>
<h5 data-id="heading-17"><strong>æ–‡ä»¶ 2</strong>ï¼š<a href="https://link.juejin.cn?target=src%2Fdrivers%2Fchips%2Fws63%2From%2Fdrivers%2Fdrivers%2Fdriver%2Fsfc%2FKconfig" target="_blank" title="src/drivers/chips/ws63/rom/drivers/drivers/driver/sfc/Kconfig" ref="nofollow noopener noreferrer">src/drivers/chips/ws63/rom/drivers/drivers/driver/sfc/Kconfig</a></h5>
<p><strong>ä½ç½®</strong>ï¼šå®Œæ•´å†…å®¹</p>
<pre><code class="hljs language-kconfig" lang="kconfig">#===============================================================================
# @brief    Kconfig file.
# Copyright (c) HiSilicon (Shanghai) Technologies Co., Ltd. 2022-2022. All rights reserved.
#===============================================================================
config SFC_SUPPORT_DMA
    bool
    prompt "SFC Support DMA"
    default y
    depends on DRIVER_SUPPORT_SFC

config SFC_ALLOW_ERASE_WRITEBACK
    bool
    prompt "Allows Erase at Any Address, needs 4KB RAM at least"
    default n
    depends on DRIVER_SUPPORT_SFC

config SFC_ALREADY_INIT
    bool
    prompt "SFC has been inited, need not to set reg in init/deinit func."
    default n
    depends on DRIVER_SUPPORT_SFC
</code></pre>
<p><strong>SFC ç›¸å…³é…ç½®</strong>ï¼š</p>





























<table><thead><tr><th>é…ç½®é¡¹</th><th>è¯´æ˜</th><th>é»˜è®¤å€¼</th><th>ç”¨é€”</th></tr></thead><tbody><tr><td><code>CONFIG_SFC_SUPPORT_DMA</code></td><td>å¯ç”¨ DMA ä¼ è¾“</td><td><code>y</code>ï¼ˆå¯ç”¨ï¼‰</td><td>æé«˜ä¼ è¾“é€Ÿåº¦</td></tr><tr><td><code>CONFIG_SFC_ALLOW_ERASE_WRITEBACK</code></td><td>å…è®¸ä»»æ„åœ°å€æ“¦é™¤</td><td><code>n</code>ï¼ˆç¦ç”¨ï¼‰</td><td>éœ€è¦é¢å¤– 4KB RAM</td></tr><tr><td><code>CONFIG_SFC_ALREADY_INIT</code></td><td>Skip åˆå§‹åŒ–</td><td><code>n</code>ï¼ˆç¦ç”¨ï¼‰</td><td>BootLoader å·²åˆå§‹åŒ–æ—¶</td></tr></tbody></table>
<p><strong>âš ï¸ é‡è¦</strong>ï¼š</p>
<ul>
<li><strong>è¿™äº›é…ç½®ä¸­æ²¡æœ‰ QSPI/SPI æ¨¡å¼é€‰æ‹©å¼€å…³</strong></li>
<li><strong>QSPI æ¨¡å¼æ˜¯ç”± Flash èŠ¯ç‰‡æœ¬èº«å†³å®šçš„</strong>ï¼ˆFlash æ”¯æŒ QSPI å°±è‡ªåŠ¨å¯ç”¨ï¼‰</li>
</ul>
<hr/>
<h5 data-id="heading-18"><strong>æ–‡ä»¶ 3</strong>ï¼š<a href="https://link.juejin.cn?target=src%2Fapplication%2Fsamples%2Fperipheral%2Fspi%2FKconfig" target="_blank" title="src/application/samples/peripheral/spi/Kconfig" ref="nofollow noopener noreferrer">src/application/samples/peripheral/spi/Kconfig</a></h5>
<p><strong>ä½ç½®</strong>ï¼šç¬¬ 49-77 è¡Œï¼ˆSPI Master QSPI æ”¯æŒï¼‰</p>
<pre><code class="hljs language-kconfig" lang="kconfig">config SPI_MASTER_SUPPORT_QSPI
    bool
    prompt "SPI master support QSPI."
    depends on SAMPLE_SUPPORT_SPI_MASTER
    default n

config SPI_MASTER_D3_PIN_MODE
    int
    prompt "Choose QSPI master D3 pin mode."
    depends on SPI_MASTER_SUPPORT_QSPI
    default 1

config SPI_MASTER_D2_PIN_MODE
    int
    prompt "Choose QSPI master D2 pin mode."
    depends on SPI_MASTER_SUPPORT_QSPI
    default 1

config SPI_MASTER_D3_PIN
    int
    prompt "Choose QSPI master D3 pin."
    depends on SPI_MASTER_SUPPORT_QSPI
    default 40

config SPI_MASTER_D2_PIN
    int
    prompt "Choose QSPI master D2 pin."
    depends on SPI_MASTER_SUPPORT_QSPI
    default 41
</code></pre>
<p><strong>è¯´æ˜</strong>ï¼š</p>
<ul>
<li>è¿™æ˜¯ <strong>é€šç”¨ SPI æ¨¡å—</strong>ï¼ˆä¸æ˜¯ SFCï¼‰çš„ QSPI é…ç½®</li>
<li>æ”¯æŒç”¨æˆ·è‡ªå®šä¹‰ D2/D3 pinï¼ˆGPIO_40ã€GPIO_41 ç­‰ï¼‰</li>
<li><strong>è¿™ä¸å½±å“ SFC çš„ GPIO_23-24</strong></li>
</ul>
<hr/>
<h4 data-id="heading-19">ğŸ“Š å½“å‰é¡¹ç›®é…ç½®çŠ¶æ€</h4>
<h5 data-id="heading-20"><strong>æ–‡ä»¶</strong>ï¼š<a href="https://link.juejin.cn?target=src%2Fbuild%2Fconfig%2Ftarget_config%2Fws63%2Fmenuconfig%2Facore%2Fws63_liteos_app.config" target="_blank" title="src/build/config/target_config/ws63/menuconfig/acore/ws63_liteos_app.config" ref="nofollow noopener noreferrer">src/build/config/target_config/ws63/menuconfig/acore/ws63_liteos_app.config</a></h5>
<p><strong>ä½ç½®</strong>ï¼šç¬¬ 357-383 è¡Œ</p>
<pre><code class="hljs language-config" lang="config">#
# SFC Configuration
#

#
# Config  SFC
#
# CONFIG_SFC_SUPPORT_DMA is not set
# CONFIG_SFC_ALLOW_ERASE_WRITEBACK is not set
# CONFIG_SFC_ALREADY_INIT is not set
# CONFIG_SFC_SUPPORT_LPM is not set
# CONFIG_SFC_SUPPORT_SFC_LOCK is not set
# CONFIG_SFC_SUPPORT_DATA_CACHE is not set
# CONFIG_SFC_SUPPORT_RWE_INDEPENDENT is not set
# CONFIG_SFC_SUPPORT_WRITE_PROTECT is not set
# CONFIG_SFC_USE_CUSTOMIZED_DEVICE_INFO is not set
# CONFIG_SFC_DEBUG is not set
# end of SFC Configuration

CONFIG_DRIVER_SUPPORT_SPI=y

#
# SPI Configuration
#

#
# Config SPI
#
# CONFIG_SPI_SUPPORT_MASTER is not set
# CONFIG_SPI_SUPPORT_SLAVE is not set
# CONFIG_SPI_SUPPORT_DMA is not set
# CONFIG_SPI_SUPPORT_INTERRUPT is not set
# CONFIG_SPI_SUPPORT_CONCURRENCY is not set
# CONFIG_SPI_SUPPORT_LOOPBACK is not set
# CONFIG_SPI_SUPPORT_CRC is not set
</code></pre>
<p><strong>å½“å‰é…ç½®åˆ†æ</strong>ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">âœ… å¯ç”¨çš„é…ç½®ï¼š
   â””â”€ CONFIG_DRIVER_SUPPORT_SFC=y         ï¼ˆSFC é©±åŠ¨å¯ç”¨ï¼‰
   â””â”€ CONFIG_DRIVER_SUPPORT_SPI=y         ï¼ˆ<span class="hljs-built_in">SPI</span> é©±åŠ¨å¯ç”¨ï¼‰

âŒ ç¦ç”¨çš„é…ç½®ï¼š
   â””â”€ CONFIG_SFC_SUPPORT_DMA              ï¼ˆDMA ç¦ç”¨ - ä»…å¯„å­˜å™¨æ¨¡å¼ï¼‰
   â””â”€ CONFIG_SPI_SUPPORT_MASTER           ï¼ˆé€šç”¨ <span class="hljs-built_in">SPI</span> Master ç¦ç”¨ï¼‰
   â””â”€ CONFIG_SPI_SUPPORT_SLAVE            ï¼ˆé€šç”¨ <span class="hljs-built_in">SPI</span> Slave ç¦ç”¨ï¼‰
   â””â”€ CONFIG_SPI_SUPPORT_DMA              ï¼ˆ<span class="hljs-built_in">SPI</span> DMA ç¦ç”¨ï¼‰

âš ï¸  å…³é”®å‘ç°ï¼š
   â€¢ SFC æ²¡æœ‰æ˜¾å¼çš„ <span class="hljs-built_in">SPI</span>/QSPI æ¨¡å¼å¼€å…³
   â€¢ QSPI æ¨¡å¼ç”± Flash èŠ¯ç‰‡è‡ªåŠ¨æ£€æµ‹å’Œå¯ç”¨
   â€¢ å½“å‰ä½¿ç”¨çš„æ˜¯å¯„å­˜å™¨æ¨¡å¼ï¼ˆé DMAï¼‰ï¼Œè¾ƒä½æ•ˆç‡
</code></pre>
<hr/>
<h4 data-id="heading-21">ğŸ” æ¨¡å¼é…ç½®å†³ç­–æµç¨‹</h4>
<pre><code class="hljs language-arduino" lang="arduino">ç¡¬ä»¶æ£€æµ‹ Flash èŠ¯ç‰‡
        â”‚
        â”œâ”€â†’ è¯†åˆ« Flash ID
        â”‚   â””â”€ sfc.c line <span class="hljs-number">151</span>
        â”‚       <span class="hljs-built_in">build_cmds</span>(flash_id, ...)
        â”‚
        â””â”€â†’ æŸ¥è¯¢ Flash æ”¯æŒçš„æ¨¡å¼
            â””â”€ flash_config_info.c
                <span class="hljs-type">flash_spi_info_t</span> ä¸­çš„ quad_mode

            â”œâ”€ quad_mode != <span class="hljs-literal">NULL</span>
            â”‚  â””â”€â†’ æ­¤ Flash æ”¯æŒ QSPI
            â”‚      â”œâ”€ è‡ªåŠ¨å¯ç”¨ GPIO_23<span class="hljs-number">-24</span>
            â”‚      â””â”€ é…ç½® QSPI æŒ‡ä»¤
            â”‚
            â””â”€ quad_mode == <span class="hljs-literal">NULL</span>
               â””â”€â†’ æ­¤ Flash ä»…æ”¯æŒ <span class="hljs-built_in">SPI</span>
                   â”œâ”€ ä»…ä½¿ç”¨ GPIO_19<span class="hljs-number">-22</span>
                   â””â”€ é…ç½® <span class="hljs-built_in">SPI</span> æŒ‡ä»¤
</code></pre>
<hr/>
<h3 data-id="heading-22">4ï¸âƒ£ GPIO é‡æ–°å¸ƒçº¿ä¿®æ”¹æ¸…å•</h3>
<h4 data-id="heading-23">âš ï¸ ç¡¬ä»¶GPIOå›ºå®šæ€§è­¦å‘Š</h4>
<pre><code class="hljs language-markdown" lang="markdown">âŒ ã€ä¸å¯ä¿®æ”¹ã€‘ç¡¬ä»¶å›ºå®šçš„ GPIO æ˜ å°„ï¼š

<span class="hljs-code">    GPIO_19 â†â†’ SFC_CLKï¼ˆç¡¬çº¿è¿æ¥ï¼‰
    GPIO_20 â†â†’ SFC_CSNï¼ˆç¡¬çº¿è¿æ¥ï¼‰
    GPIO_21 â†â†’ SFC_IO0/MOSIï¼ˆç¡¬çº¿è¿æ¥ï¼‰
    GPIO_22 â†â†’ SFC_IO1/MISOï¼ˆç¡¬çº¿è¿æ¥ï¼‰
    GPIO_23 â†â†’ SFC_IO2/WPï¼ˆç¡¬çº¿è¿æ¥ï¼‰
    GPIO_24 â†â†’ SFC_IO3/HOLDï¼ˆç¡¬çº¿è¿æ¥ï¼‰
</span>
è¿™äº›æ˜¯èŠ¯ç‰‡è®¾è®¡é˜¶æ®µçš„ç¡¬è¿æ¥ï¼Œæ— æ³•é€šè¿‡è½¯ä»¶ä¿®æ”¹ã€‚
</code></pre>
<h4 data-id="heading-24">ğŸ“ è‹¥<strong>ç¡¬ä»¶é‡æ–°è®¾è®¡</strong>éœ€è¦ä¿®æ”¹GPIO</h4>
<p><strong>å‡è®¾æ–°ç¡¬ä»¶ä½¿ç”¨äº†ä¸åŒçš„ GPIO å¼•è„š</strong>ï¼Œéœ€è¦ä¿®æ”¹ä»¥ä¸‹ä½ç½®ï¼š</p>
<h5 data-id="heading-25"><strong>1ï¸âƒ£ platform_core_rom.h</strong></h5>
<p><strong>æ–‡ä»¶ä½ç½®</strong>ï¼š<a href="https://link.juejin.cn?target=src%2Fdrivers%2Fchips%2Fws63%2Finclude%2Fplatform_core_rom.h" target="_blank" title="src/drivers/chips/ws63/include/platform_core_rom.h" ref="nofollow noopener noreferrer">src/drivers/chips/ws63/include/platform_core_rom.h</a></p>
<p><strong>åŸå†…å®¹</strong>ï¼ˆç¬¬ 50-54 è¡Œï¼‰ï¼š</p>
<pre><code class="hljs language-c" lang="c">SFC_CLK = <span class="hljs-number">19</span>,
SFC_CSN = <span class="hljs-number">20</span>,
SFC_IO0 = <span class="hljs-number">21</span>,
SFC_IO1 = <span class="hljs-number">22</span>,
SFC_IO2 = <span class="hljs-number">23</span>,
SFC_IO3 = <span class="hljs-number">24</span>,
</code></pre>
<p><strong>ä¿®æ”¹ç¤ºä¾‹</strong>ï¼ˆå‡è®¾æ–°ç¡¬ä»¶ç”¨ä¸åŒ GPIOï¼‰ï¼š</p>
<pre><code class="hljs language-c" lang="c">SFC_CLK = <span class="hljs-number">25</span>,    <span class="hljs-comment">// æ”¹ä¸º GPIO_25</span>
SFC_CSN = <span class="hljs-number">26</span>,    <span class="hljs-comment">// æ”¹ä¸º GPIO_26</span>
SFC_IO0 = <span class="hljs-number">27</span>,    <span class="hljs-comment">// æ”¹ä¸º GPIO_27</span>
SFC_IO1 = <span class="hljs-number">28</span>,    <span class="hljs-comment">// æ”¹ä¸º GPIO_28</span>
SFC_IO2 = <span class="hljs-number">29</span>,    <span class="hljs-comment">// æ”¹ä¸º GPIO_29ï¼ˆQSPIï¼‰</span>
SFC_IO3 = <span class="hljs-number">30</span>,    <span class="hljs-comment">// æ”¹ä¸º GPIO_30ï¼ˆQSPIï¼‰</span>
</code></pre>
<p><strong>ä¿®æ”¹æ­¥éª¤</strong>ï¼š</p>
<ol>
<li>ç¡®å®šæ–°çš„ GPIO å·ï¼ˆéœ€è¦ç¡¬ä»¶åŸç†å›¾ç¡®è®¤ï¼‰</li>
<li>ä¿®æ”¹ enum ä¸­çš„æ•°å€¼</li>
<li>ç¡®ä¿æ–° GPIO å·åœ¨æœ‰æ•ˆèŒƒå›´å†…ï¼ˆ0-45 ä»¥å†…ï¼‰</li>
</ol>
<hr/>
<h5 data-id="heading-26"><strong>2ï¸âƒ£ soc_porting.cï¼ˆPad æ§åˆ¶å¯„å­˜å™¨åœ°å€ï¼‰</strong></h5>
<p><strong>æ–‡ä»¶ä½ç½®</strong>ï¼š<a href="https://link.juejin.cn?target=src%2Fdrivers%2Fchips%2Fws63%2Fporting%2Fsoc%2Fsoc_porting.c" target="_blank" title="src/drivers/chips/ws63/porting/soc/soc_porting.c" ref="nofollow noopener noreferrer">src/drivers/chips/ws63/porting/soc/soc_porting.c</a></p>
<p><strong>åŸå†…å®¹</strong>ï¼ˆç¬¬ 64-67 è¡Œï¼‰ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">define</span> PAD_SFC_CLK_CTRL   0x4400d868</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> PAD_SFC_CSN_CTRL   0x4400d86C</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> PAD_SFC_IO0_CTRL   0x4400d870</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> PAD_SFC_IO1_CTRL   0x4400d874</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> PAD_SFC_IO2_CTRL   0x4400d878</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> PAD_SFC_IO3_CTRL   0x4400d87C</span>
</code></pre>
<p><strong>ä¿®æ”¹è¯´æ˜</strong>ï¼š</p>
<ul>
<li>è¿™äº›å¯„å­˜å™¨åœ°å€æ¥è‡ª <strong>WS63 èŠ¯ç‰‡è®¾è®¡æ–‡æ¡£</strong></li>
<li>æ¯ä¸ªæ–° GPIO å·å¯¹åº”æ–°çš„å¯„å­˜å™¨åœ°å€</li>
<li><strong>éœ€è¦æŸ¥é˜… WS63 æ•°æ®æ‰‹å†Œ</strong>è·å–æ–°åœ°å€</li>
</ul>
<p><strong>ä¿®æ”¹ç¤ºä¾‹</strong>ï¼ˆå‡è®¾æ–° GPIO çš„ Pad åœ°å€ï¼‰ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">define</span> PAD_SFC_CLK_CTRL   0x4400d880    <span class="hljs-comment">// æ–°åœ°å€</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> PAD_SFC_CSN_CTRL   0x4400d884</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> PAD_SFC_IO0_CTRL   0x4400d888</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> PAD_SFC_IO1_CTRL   0x4400d88C</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> PAD_SFC_IO2_CTRL   0x4400d890</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> PAD_SFC_IO3_CTRL   0x4400d894</span>
</code></pre>
<hr/>
<h5 data-id="heading-27"><strong>3ï¸âƒ£ hal_pinctrl_ws63.c</strong></h5>
<p><strong>æ–‡ä»¶ä½ç½®</strong>ï¼š<a href="https://link.juejin.cn?target=src%2Fdrivers%2Fdrivers%2Fhal%2Fpinmux%2Fws63%2Fhal_pinctrl_ws63.c" target="_blank" title="src/drivers/drivers/hal/pinmux/ws63/hal_pinctrl_ws63.c" ref="nofollow noopener noreferrer">src/drivers/drivers/hal/pinmux/ws63/hal_pinctrl_ws63.c</a></p>
<p><strong>åŸå†…å®¹</strong>ï¼ˆç¬¬ 109-140 è¡Œï¼‰ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-type">static</span> <span class="hljs-type">hal_pin_config_group_t</span> <span class="hljs-type">const</span> g_pin_pull_map[] = {
    {
        GPIO_00,
        GPIO_14,
        <span class="hljs-comment">// ... GPIO_00~14 ...</span>
    },
    {
        SFC_CLK,    <span class="hljs-comment">// = 19</span>
        SFC_IO3,    <span class="hljs-comment">// = 24</span>
        HAL_PIN_SFC_CTRL_START_ADDR,
        <span class="hljs-comment">// ...</span>
    }
};
</code></pre>
<p><strong>ä¿®æ”¹è¯´æ˜</strong>ï¼š</p>
<ul>
<li>å¦‚æœæ–° GPIO å·ä»åœ¨è¿ç»­èŒƒå›´å†…ï¼ˆå¦‚ 25-30ï¼‰ï¼Œåªéœ€ä¿®æ”¹ begin å’Œ end</li>
<li>å¦‚æœåˆ†æ•£åœ¨ä¸åŒèŒƒå›´ï¼Œå¯èƒ½éœ€è¦æ–°å¢é…ç½®ç»„</li>
</ul>
<p><strong>ä¿®æ”¹ç¤ºä¾‹</strong>ï¼ˆå‡è®¾æ–° GPIO ä¸º 25-30ï¼‰ï¼š</p>
<pre><code class="hljs language-c" lang="c">{
    SFC_CLK,        <span class="hljs-comment">// æ–°å®šä¹‰ä¸º GPIO_25</span>
    SFC_IO3,        <span class="hljs-comment">// æ–°å®šä¹‰ä¸º GPIO_30</span>
    HAL_PIN_SFC_CTRL_START_ADDR,  <span class="hljs-comment">// ä½¿ç”¨æ–°çš„åŸºåœ°å€</span>
    HAL_PIN_CONFIG_PER_NUM,
    HAL_PIN_PULL_START_BIT,
    HAL_PIN_PULL_BITS_NUM
}
</code></pre>
<hr/>
<h4 data-id="heading-28">ğŸš« Kconfig ä¸­<strong>æ— éœ€ä¿®æ”¹</strong>çš„å†…å®¹</h4>
<pre><code class="hljs language-bash" lang="bash">âœ… Kconfig æ–‡ä»¶ï¼š
   â€¢ src/drivers/drivers/Kconfig
   â€¢ src/drivers/chips/ws63/rom/drivers/drivers/driver/sfc/Kconfig
   â€¢ src/application/samples/peripheral/spi/Kconfig

ä¸ºä»€ä¹ˆï¼Ÿ
   â”œâ”€ GPIO pin å·ä¸åœ¨ Kconfig ä¸­ç¡¬ç¼–ç 
   â”œâ”€ Kconfig åªæ§åˆ¶åŠŸèƒ½å¯ç”¨/ç¦ç”¨å¼€å…³
   â””â”€ Pin æ˜ å°„åœ¨æºä»£ç ä¸­å®šä¹‰ï¼Œä¸åœ¨é…ç½®ä¸­
</code></pre>
<hr/>
<h4 data-id="heading-29">âœ… å®Œæ•´ä¿®æ”¹æ£€æŸ¥æ¸…å•</h4>
<h5 data-id="heading-30">å¦‚æœåªæ˜¯æ™®é€šé¡¹ç›®ï¼ˆä¸æ”¹ç¡¬ä»¶GPIOï¼‰ï¼š</h5>
<pre><code class="hljs">âœ… æ£€æŸ¥é¡¹ï¼š
   â˜ ç¡®è®¤å½“å‰ GPIO_19-24 åœ¨ç¡¬ä»¶ä¸Šè¿æ¥æ­£ç¡®
   â˜ æ£€æŸ¥åŸç†å›¾ä¸­ Flash pin çš„ç‰©ç†è¿æ¥
   â˜ éªŒè¯ç”µæºå’Œ GND è¿æ¥
   â˜ ç¡®ä¿ Flash èŠ¯ç‰‡è§„æ ¼ä¹¦ä¸­æ”¯æŒå½“å‰å›ºä»¶
   
âŒ æ— éœ€ä¿®æ”¹ä»»ä½•ä»£ç 
</code></pre>
<h5 data-id="heading-31">å¦‚æœéœ€è¦ç¡¬ä»¶gpioé‡æ–°å¸ƒçº¿ï¼š</h5>
<pre><code class="hljs language-markdown" lang="markdown">âœ… ä¿®æ”¹æ­¥éª¤ï¼š
<span class="hljs-bullet">   1.</span> è·å–ç¡¬ä»¶åŸç†å›¾
<span class="hljs-bullet">   2.</span> ç¡®å®šæ–° GPIO å·å’Œ Pad å¯„å­˜å™¨åœ°å€
<span class="hljs-bullet">   3.</span> ä¿®æ”¹ platform<span class="hljs-emphasis">_core_</span>rom.hï¼ˆGPIO å·ï¼‰
<span class="hljs-bullet">   4.</span> ä¿®æ”¹ soc<span class="hljs-emphasis">_porting.cï¼ˆPad æ§åˆ¶åœ°å€ï¼‰
   5. ä¿®æ”¹ hal_</span>pinctrl<span class="hljs-emphasis">_ws63.cï¼ˆpin é…ç½®èŒƒå›´ï¼‰
   6. ç¼–è¯‘éªŒè¯
   7. çƒ§å½• BootLoader æ‰§è¡Œåˆå§‹åŒ–

ğŸ”§ å·¥å…·éœ€æ±‚ï¼š
   â€¢ WS63 æ•°æ®æ‰‹å†Œï¼ˆè·å– Pad åœ°å€ï¼‰
   â€¢ FlashTool é‡æ–°çƒ§å½• BootLoader
   â€¢ ç¡¬ä»¶æµ‹è¯•å·¥å…·ï¼ˆç¤ºæ³¢å™¨ã€é€»è¾‘åˆ†æä»ªï¼‰
</span></code></pre>
<hr/>
<h3 data-id="heading-32">5ï¸âƒ£ ä»£ç è·¯å¾„æ±‡æ€»</h3>
<h4 data-id="heading-33">ğŸ“ æ–‡ä»¶ç»“æ„å›¾</h4>
<pre><code class="hljs language-erlang" lang="erlang">fbb_ws63-master/
â”œâ”€â”€ src/drivers/
â”‚   â”œâ”€â”€ chips/ws63/
â”‚   â”‚   â”œâ”€â”€ include/
â”‚   â”‚   â”‚   â”œâ”€â”€ platform_core_rom.h                â­ GPIO æšä¸¾å®šä¹‰
â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â”œâ”€â”€ porting/
â”‚   â”‚   â”‚   â”œâ”€â”€ soc/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ soc_porting.c                 â­ Pad å¯„å­˜å™¨åœ°å€
â”‚   â”‚   â”‚   â”œâ”€â”€ sfc/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ sfc_porting.h                 ğŸ“‹ SFC é…ç½®ç»“æ„ä½“
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ porting/
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ sfc_porting.c             â­ SFC å¯„å­˜å™¨åŸºåœ°å€
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ driver/
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ sfc.c                     ğŸ’» SFC é©±åŠ¨æ ¸å¿ƒ
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ flash_config/
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ flash_config_info.c       ğŸ“Š Flash èŠ¯ç‰‡é…ç½®
â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”œâ”€â”€ drivers/
â”‚   â”‚   â”œâ”€â”€ hal/
â”‚   â”‚   â”‚   â”œâ”€â”€ pinmux/ws63/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ hal_pinctrl_ws63.c            â­ Pin æ§åˆ¶é…ç½®
â”‚   â”‚   â”‚   â”œâ”€â”€ sfc/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ hal_sfc_v150.c               ğŸ’» SFC HAL å±‚
â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â”œâ”€â”€ Kconfig                               ğŸ“ é©±åŠ¨é…ç½®å¼€å…³
â”‚   â”‚   â””â”€â”€ ...
â”‚   â””â”€â”€ ...
â”œâ”€â”€ src/application/
â”‚   â””â”€â”€ samples/
â”‚       â””â”€â”€ peripheral/
â”‚           â”œâ”€â”€ spi/
â”‚           â”‚   â”œâ”€â”€ Kconfig                       ğŸ“ SPI é…ç½®å¼€å…³
â”‚           â”‚   â””â”€â”€ spi_master_demo.c             ğŸ“œ SPI Master ç¤ºä¾‹
â”‚           â””â”€â”€ sfc/
â”‚               â””â”€â”€ sfc_demo.c                    ğŸ“œ SFC ä½¿ç”¨ç¤ºä¾‹
â”œâ”€â”€ src/build/
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â””â”€â”€ target_config/ws63/menuconfig/acore/
â”‚   â”‚       â”œâ”€â”€ ws63_liteos_app.config            âš™ï¸  APP é…ç½®
â”‚   â”‚       â”œâ”€â”€ ws63_flashboot.config             âš™ï¸  BootLoader é…ç½®
â”‚   â”‚       â””â”€â”€ ws63_liteos_testsuite.config      âš™ï¸  æµ‹è¯•å¥—ä»¶é…ç½®
â”‚   â””â”€â”€ ...
â””â”€â”€ ...
</code></pre>
<hr/>
<h4 data-id="heading-34">ğŸ”‘ æ ¸å¿ƒæ–‡ä»¶è¯¦è§£</h4>


















































































<table><thead><tr><th>#</th><th>æ–‡ä»¶å</th><th>è·¯å¾„</th><th>åŠŸèƒ½</th><th>ä¿®æ”¹é¢‘ç‡</th></tr></thead><tbody><tr><td>1</td><td><strong>platform_core_rom.h</strong></td><td><code>src/drivers/chips/ws63/include/</code></td><td>GPIO æšä¸¾å®šä¹‰ï¼ˆGPIO_19-24ï¼‰</td><td>ğŸ”´ æå°‘ä¿®æ”¹</td></tr><tr><td>2</td><td><strong>soc_porting.c</strong></td><td><code>src/drivers/chips/ws63/porting/soc/</code></td><td>Pad å¯„å­˜å™¨åœ°å€ &amp; é©±åŠ¨å¼ºåº¦é…ç½®</td><td>ğŸ”´ æå°‘ä¿®æ”¹</td></tr><tr><td>3</td><td><strong>hal_pinctrl_ws63.c</strong></td><td><code>src/drivers/drivers/hal/pinmux/ws63/</code></td><td>Pin æ§åˆ¶é…ç½®æ˜ å°„è¡¨</td><td>ğŸŸ¡ å¦‚æœæ”¹GPIO</td></tr><tr><td>4</td><td><strong>sfc_porting.h</strong></td><td><code>src/drivers/chips/ws63/porting/sfc/</code></td><td>SFC é…ç½®ç»“æ„ä½“å®šä¹‰</td><td>ğŸŸ¢ å¯é…ç½®</td></tr><tr><td>5</td><td><strong>sfc_porting.c</strong></td><td><code>src/drivers/chips/ws63/porting/sfc/porting/</code></td><td>SFC å¯„å­˜å™¨åŸºåœ°å€</td><td>ğŸ”´ å›ºå®š</td></tr><tr><td>6</td><td><strong>sfc.c</strong></td><td><code>src/drivers/chips/ws63/porting/sfc/driver/</code></td><td>SFC é©±åŠ¨å®ç°</td><td>ğŸŸ¢ æŒ‰éœ€é…ç½®</td></tr><tr><td>7</td><td><strong>flash_config_info.c</strong></td><td><code>src/drivers/chips/ws63/porting/sfc/flash_config/</code></td><td>Flash èŠ¯ç‰‡æ•°æ®åº“</td><td>ğŸŸ¢ æ–°èŠ¯ç‰‡éœ€æ·»åŠ </td></tr><tr><td>8</td><td><strong>hal_sfc_v150.c</strong></td><td><code>src/drivers/drivers/hal/sfc/</code></td><td>SFC ç¡¬ä»¶æŠ½è±¡å±‚</td><td>ğŸ”´ æå°‘ä¿®æ”¹</td></tr><tr><td>9</td><td><strong>Kconfig</strong></td><td><code>src/drivers/drivers/</code></td><td>é©±åŠ¨åŠŸèƒ½å¼€å…³</td><td>ğŸŸ¡ æŒ‰é¡¹ç›®éœ€æ±‚</td></tr><tr><td>10</td><td><strong>.config</strong></td><td><code>src/build/config/target_config/ws63/</code></td><td>å½“å‰ç¼–è¯‘é…ç½®</td><td>ğŸŸ¢ é¢‘ç¹ä¿®æ”¹</td></tr></tbody></table>
<p><strong>å›¾ä¾‹</strong>ï¼š</p>
<ul>
<li>ğŸ”´ çº¢è‰²ï¼šç¡¬ä»¶å›ºå®šï¼Œæå°‘æ”¹åŠ¨</li>
<li>ğŸŸ¡ é»„è‰²ï¼šç‰¹å®šåœºæ™¯ä¿®æ”¹</li>
<li>ğŸŸ¢ ç»¿è‰²ï¼šå¸¸è§„é…ç½®å’Œå®šåˆ¶</li>
</ul>
<hr/>
<h4 data-id="heading-35">ğŸ” åŠŸèƒ½è¿½è¸ª</h4>
<h5 data-id="heading-36"><strong>"å¦‚ä½•å¯ç”¨ QSPI æ¨¡å¼ï¼Ÿ"è¿½è¸ª</strong></h5>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> ç¡¬ä»¶æ£€æµ‹é˜¶æ®µ
   â””â”€ sfc.c:151
<span class="hljs-code">       uapi_sfc_init() å…¥å£
           â†“
       build_cmds(flash_id, ...)
           â†“
</span>
<span class="hljs-bullet">2.</span> Flash èŠ¯ç‰‡æŸ¥è¯¢
   â””â”€ flash<span class="hljs-emphasis">_config_</span>info.c
<span class="hljs-code">       æŸ¥è¯¢ flash_spi_info_t æ•°ç»„
       æ‰¾åˆ°åŒ¹é…çš„ flash_id
           â†“
</span>
<span class="hljs-bullet">3.</span> æ¨¡å¼è‡ªåŠ¨é€‰æ‹©
   â””â”€ sfc.c:67
<span class="hljs-code">       if (spi_info-&gt;quad_mode != NULL)
           â”œâ”€ QSPI æ”¯æŒ
           â”‚  â”œâ”€ è‡ªåŠ¨å¯ç”¨ GPIO_23-24
           â”‚  â”œâ”€ åŠ è½½ QSPI æŒ‡ä»¤åºåˆ—
           â”‚  â””â”€ é…ç½® Quad SPI æ¨¡å¼
           â””â”€ SPI ä»…æ”¯æŒ
              â”œâ”€ ä»…ä½¿ç”¨ GPIO_19-22
              â”œâ”€ åŠ è½½ SPI æŒ‡ä»¤
              â””â”€ é…ç½®æ ‡å‡† SPI æ¨¡å¼
</span>
<span class="hljs-bullet">4.</span> HAL å±‚åˆå§‹åŒ–
   â””â”€ hal<span class="hljs-emphasis">_sfc_</span>v150.c
<span class="hljs-code">       hal_sfc_init()
       æ ¹æ® quad_mode å‚æ•°é…ç½®ç¡¬ä»¶
           â†“
</span>
<span class="hljs-bullet">5.</span> å®Œæˆ
   â””â”€ é©±åŠ¨è‡ªåŠ¨è¿è¡Œäºæœ€ä¼˜æ¨¡å¼
</code></pre>
<hr/>
<h5 data-id="heading-37"><strong>"å¦‚ä½•ä¿®æ”¹ Flash é…ç½®ï¼Ÿ"è¿½è¸ª</strong></h5>
<pre><code class="hljs language-ini" lang="ini">1. æ‰¾åˆ°ä½¿ç”¨çš„ Flash èŠ¯ç‰‡å‹å·
   â””â”€ ç¡¬ä»¶åŸç†å›¾ â†’ Flash èŠ¯ç‰‡æ‰‹å†Œ

2. æ£€æŸ¥ flash_config_info.c
   â””â”€ æŸ¥æ‰¾å¯¹åº”çš„ FLASH_XXX ID å®šä¹‰
       æ˜¯å¦å­˜åœ¨è¯¥èŠ¯ç‰‡é…ç½®

3. å¦‚æœå·²æœ‰é…ç½®
   â””â”€ sfc.c ä¼šè‡ªåŠ¨ä½¿ç”¨
   â””â”€ æ— éœ€ä¿®æ”¹ä»£ç 

4. å¦‚æœæ— è¯¥é…ç½®
   â””â”€ flash_config_info.c
       ä»¿ç…§ç°æœ‰æ ¼å¼æ·»åŠ è¯¥ Flash é…ç½®
           â”œâ”€ .<span class="hljs-attr">chip_id</span> = <span class="hljs-number">0</span>xXXXXXX
           â”œâ”€ .read_cmds<span class="hljs-section">[]</span> = { ... }
           â”œâ”€ .write_cmds<span class="hljs-section">[]</span> = { ... }
           â”œâ”€ .erase_cmds<span class="hljs-section">[]</span> = { ... }
           â””â”€ .<span class="hljs-attr">quad_mode</span> = &amp;cmd_seq  (å¦‚æœæ”¯æŒ)

5. é‡æ–°ç¼–è¯‘çƒ§å½•
</code></pre>
<hr/>
<h4 data-id="heading-38">ğŸ¯ å¿«é€ŸæŸ¥æ‰¾è¡¨</h4>
<p><strong>æˆ‘æƒ³è¦é…ç½®...</strong></p>

































































<table><thead><tr><th>éœ€æ±‚</th><th>æ–‡ä»¶</th><th>è¡Œå·</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>æŸ¥çœ‹ GPIO å®šä¹‰</td><td>platform_core_rom.h</td><td>50-54</td><td>enum GPIO ç¼–å·</td></tr><tr><td>æ”¹å˜ GPIO å·</td><td>platform_core_rom.h</td><td>50-54</td><td>ä¿®æ”¹æšä¸¾å€¼</td></tr><tr><td>è°ƒæ•´é©±åŠ¨å¼ºåº¦</td><td>soc_porting.c</td><td>70-71</td><td>SFC_CLK_DS_VALUE ç­‰</td></tr><tr><td>å¯ç”¨ DMA</td><td>Kconfig</td><td>é…ç½®èœå•</td><td>CONFIG_SFC_SUPPORT_DMA</td></tr><tr><td>æ·»åŠ æ–° Flash</td><td>flash_config_info.c</td><td>å…¨æ–‡</td><td>ä»¿ç…§ç°æœ‰æ¡ç›®æ·»åŠ </td></tr><tr><td>å¯ç”¨ Quad æ¨¡å¼</td><td>è‡ªåŠ¨</td><td>-</td><td>Flash è‡ªåŠ¨æ£€æµ‹</td></tr><tr><td>æŸ¥çœ‹ SFC åˆå§‹åŒ–</td><td>sfc.c</td><td>145-170</td><td>uapi_sfc_init() å‡½æ•°</td></tr><tr><td>æŸ¥çœ‹ Pin é…ç½®</td><td>hal_pinctrl_ws63.c</td><td>109-140</td><td>g_pin_xxx_map æ•°ç»„</td></tr><tr><td>ç¦ç”¨ SFC</td><td>Kconfig</td><td>é©±åŠ¨èœå•</td><td>CONFIG_DRIVER_SUPPORT_SFC</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-39">ğŸ“ æ€»ç»“å¯¹æ¯”è¡¨</h3>
<h4 data-id="heading-40">SPI vs QSPI æ¨¡å¼ï¼šç¡¬ä»¶è§†è§’</h4>
<pre><code class="hljs language-scss" lang="scss">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç‰¹æ€§         â”‚ SPI æ¨¡å¼        â”‚ QSPI æ¨¡å¼       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ GPIO pin     â”‚ GPIO_19~<span class="hljs-number">22</span>      â”‚ GPIO_19~<span class="hljs-number">24</span>      â”‚
â”‚ æ€»æ•°         â”‚ <span class="hljs-number">4</span> æ¡            â”‚ <span class="hljs-number">6</span> æ¡            â”‚
â”‚ CLK          â”‚ GPIO_19         â”‚ GPIO_19         â”‚
â”‚ CSN          â”‚ GPIO_20         â”‚ GPIO_20         â”‚
â”‚ <span class="hljs-built_in">MOSI</span>(IO0)    â”‚ GPIO_21         â”‚ GPIO_21         â”‚
â”‚ <span class="hljs-built_in">MISO</span>(IO1)    â”‚ GPIO_22         â”‚ GPIO_22         â”‚
â”‚ <span class="hljs-built_in">WP</span>(IO2)      â”‚ âŒ ä¸éœ€è¦       â”‚ GPIO_23         â”‚
â”‚ <span class="hljs-built_in">HOLD</span>(IO3)    â”‚ âŒ ä¸éœ€è¦       â”‚ GPIO_24         â”‚
â”‚ é©±åŠ¨å¼ºåº¦     â”‚ åœ¨ soc_porting<span class="hljs-selector-class">.c</span> ä¸­é…ç½® | åŒå·¦   â”‚
â”‚ Pad å¯„å­˜å™¨   â”‚ <span class="hljs-number">0</span>x4400d868-<span class="hljs-number">74</span>   â”‚ <span class="hljs-number">0</span>x4400d868-<span class="hljs-number">7</span>C   â”‚
â”‚ æ•°æ®çº¿æ•°     â”‚ <span class="hljs-number">1</span>(æ”¶) + <span class="hljs-number">1</span>(å‘)   â”‚ <span class="hljs-number">4</span> çº¿åŒå‘        â”‚
â”‚ ä¼ è¾“é€Ÿç‡     â”‚ åŸºçº¿            â”‚ ~<span class="hljs-number">4</span>x å¿«é€Ÿ        â”‚
â”‚ Pin é…ç½®æ–‡ä»¶ â”‚ hal_pinctrl_ws63<span class="hljs-selector-class">.c</span> ï¼ˆç»Ÿä¸€ï¼‰       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h4 data-id="heading-41">ç¼–è¯‘é…ç½®ï¼šå½“å‰é¡¹ç›®çŠ¶æ€</h4>
<pre><code class="hljs language-ini" lang="ini">â”œâ”€ <span class="hljs-attr">CONFIG_DRIVER_SUPPORT_SFC</span>=y       âœ… SFC é©±åŠ¨å¯ç”¨
â”œâ”€ <span class="hljs-attr">CONFIG_DRIVER_SUPPORT_SPI</span>=y       âœ… é€šç”¨ SPI å¯ç”¨ï¼ˆä½†æ—  Masterï¼‰
â”œâ”€ CONFIG_SFC_SUPPORT_DMA æœªè®¾       âŒ ç¦ç”¨ DMAï¼ˆä½æ€§èƒ½ï¼‰
â”‚
â””â”€ å½“å‰æ¨¡å¼è‡ªåŠ¨æ£€æµ‹ï¼š
    Flash æ”¯æŒ QUAD â†’ è‡ªåŠ¨å¯ç”¨ QSPIï¼ˆGPIO_19-24ï¼‰
    Flash ä»…æ”¯æŒ SPI â†’ ä½¿ç”¨ SPI æ¨¡å¼ï¼ˆGPIO_19-22ï¼‰
</code></pre>
<h4 data-id="heading-42">ä¿®æ”¹éœ€æ±‚æ¸…å•</h4>
<pre><code class="hljs language-arduino" lang="arduino">åœºæ™¯ <span class="hljs-number">1</span>ï¼šä»…ä½¿ç”¨ç°æœ‰ç¡¬ä»¶ï¼ˆGPIO_19<span class="hljs-number">-24</span>ï¼‰
   ä¿®æ”¹æ–‡ä»¶ï¼šæ— 
   é‡ç¼–è¯‘ï¼šä»…éœ€æ›´æ–° .configï¼ˆå¦‚å¯ç”¨ DMAï¼‰
   
åœºæ™¯ <span class="hljs-number">2</span>ï¼šæ›´æ¢ä¸åŒ Flash èŠ¯ç‰‡ï¼ˆåŒ GPIOï¼‰
   ä¿®æ”¹æ–‡ä»¶ï¼šå¯èƒ½éœ€è¦ flash_config_info.c
   é‡ç¼–è¯‘ï¼šä»…é©±åŠ¨ä»£ç 
   
åœºæ™¯ <span class="hljs-number">3</span>ï¼šé‡æ–°è®¾è®¡ç¡¬ä»¶ï¼ˆä¸åŒ GPIOï¼‰
   ä¿®æ”¹æ–‡ä»¶ï¼š
      âœï¸  platform_core_rom.hï¼ˆGPIO æšä¸¾ï¼‰
      âœï¸  soc_porting.cï¼ˆPad åœ°å€ï¼‰
      âœï¸  hal_pinctrl_ws63.cï¼ˆPin é…ç½®ï¼‰
   é‡ç¼–è¯‘ï¼šæ•´ä¸ªé©±åŠ¨ + BootLoader
   çƒ§å½•ï¼šé‡æ–°åˆå§‹åŒ–ç¡¬ä»¶
</code></pre>
<hr/>
<h3 data-id="heading-43">ğŸ“š å‚è€ƒèµ„æº</h3>






























<table><thead><tr><th>èµ„æº</th><th>ä½ç½®</th><th>ç”¨é€”</th></tr></thead><tbody><tr><td><strong>WS63 æ•°æ®æ‰‹å†Œ</strong></td><td>ï¼ˆç¡¬ä»¶æ–‡æ¡£ï¼‰</td><td>Pad åœ°å€ã€GPIO å®šä¹‰</td></tr><tr><td><strong>GPIO_LITTLEFS_ANALYSIS.md</strong></td><td>é¡¹ç›®æ ¹ç›®å½•</td><td>GPIO é…ç½®è¯¦è§£</td></tr><tr><td><strong>SFC_GPIO_PIN_MAPPING.md</strong></td><td>AI/ æ–‡ä»¶å¤¹</td><td>Pin æ˜ å°„å‚è€ƒ</td></tr><tr><td><strong>NOR_FLASH_CONFIG_PARAMETER_GUIDE.md</strong></td><td>AI/ æ–‡ä»¶å¤¹</td><td>Flash é…ç½®æŒ‡å—</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-44">â“ å¸¸è§é—®é¢˜è§£ç­”</h3>
<h4 data-id="heading-45">Q1ï¼šèƒ½å¦æ”¹å˜ GPIO_19-24 çš„å¼•è„šå·ï¼Ÿ</h4>
<p><strong>A</strong>ï¼šä¸èƒ½ã€‚è¿™æ˜¯ç¡¬ä»¶çº§åˆ«çš„å›ºå®šè¿æ¥ã€‚SFC ç¡¬ä»¶å†…éƒ¨å·²ç›´æ¥è¿æ¥åˆ°è¿™äº› GPIOï¼Œæ”¹éœ€è¦é‡æ–°è®¾è®¡èŠ¯ç‰‡ã€‚</p>
<h4 data-id="heading-46">Q2ï¼šSPI å’Œ QSPI æ˜¯å¦å¯ä»¥åŒæ—¶å¯ç”¨ï¼Ÿ</h4>
<p><strong>A</strong>ï¼šåœ¨ SFC é©±åŠ¨ä¸­ï¼ŒFlash è‡ªåŠ¨é€‰æ‹©ä¸€ç§æ¨¡å¼ã€‚ä½†é€šç”¨ SPI æ¨¡å—å¯ç‹¬ç«‹ä½¿ç”¨ä¸åŒ GPIOï¼ˆå¦‚ GPIO_40-41ï¼‰ï¼Œä¸ SFC æ— å†²çªã€‚</p>
<h4 data-id="heading-47">Q3ï¼šä¸ºä»€ä¹ˆé…ç½®ä¸­æ²¡æœ‰ QSPI å¼€å…³ï¼Ÿ</h4>
<p><strong>A</strong>ï¼šå› ä¸º QSPI æ¨¡å¼ç”± Flash èŠ¯ç‰‡å†³å®šã€‚SFC é©±åŠ¨è‡ªåŠ¨æ£€æµ‹ Flash æ˜¯å¦æ”¯æŒ Quad æ¨¡å¼ï¼Œæ— éœ€æ‰‹åŠ¨å¼€å…³ã€‚</p>
<h4 data-id="heading-48">Q4ï¼šä¿®æ”¹äº† GPIO å®šä¹‰åç¼–è¯‘ä¸è¿‡æ€ä¹ˆåŠï¼Ÿ</h4>
<p><strong>A</strong>ï¼š</p>
<ol>
<li>æ£€æŸ¥æ–° GPIO å·æ˜¯å¦è¶…å‡ºæœ‰æ•ˆèŒƒå›´ï¼ˆ0-45ï¼‰</li>
<li>æ›´æ–°æ‰€æœ‰æ¶‰åŠçš„æ–‡ä»¶ï¼ˆplatform_core_rom.hã€soc_porting.cã€hal_pinctrl_ws63.cï¼‰</li>
<li>æ¸…ç†ç¼–è¯‘ç¼“å­˜ï¼š<code>rm -rf src/build/cmake_build</code></li>
<li>é‡æ–°ç¼–è¯‘</li>
</ol>
<h4 data-id="heading-49">Q5ï¼šGPIO_23-24 å¯ä»¥ç”¨äºå…¶ä»–åŠŸèƒ½å—ï¼Ÿ</h4>
<p><strong>A</strong>ï¼šå¦‚æœ Flash ä¸æ”¯æŒ QSPIï¼Œè¿™ä¸¤ä¸ª GPIO ç†è®ºä¸Šå¯å¤ç”¨ã€‚ä½†ä¸å»ºè®®ï¼š</p>
<ul>
<li>ç¡¬ä»¶è®¾è®¡é€šå¸¸å·²è¿æ¥åˆ° Flash</li>
<li>ä¼šä½¿ä»£ç ç»´æŠ¤å¤æ‚åŒ–</li>
<li>å¯ç”¨çš„ GPIO æœ‰å…¶ä»–é€‰é¡¹ï¼ˆGPIO_0-18, GPIO_25+ï¼‰</li>
</ul>
<hr/>
<p><strong>æ–‡æ¡£æ›´æ–°æ—¶é—´</strong>ï¼š2025-02 | <strong>FBB_WS63 ç‰ˆæœ¬</strong>ï¼šæœ€æ–° | <strong>é€‚ç”¨èŒƒå›´</strong>ï¼šSPI/QSPI é…ç½®</p>
<p>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”--â€”â€”â€”â€”â€”â€”</p>
<h2 data-id="heading-50">FBB_WS63 SFC GPIO ä¿®æ”¹ä»£ç ç¤ºä¾‹</h2>
<h3 data-id="heading-51">ğŸ¯ ä½¿ç”¨åœºæ™¯ï¼šå‡è®¾éœ€è¦æ”¹å˜ GPIO æ˜ å°„</h3>
<p>å‡å®šåŸç¡¬ä»¶ä½¿ç”¨ GPIO_19-24ï¼Œç°åœ¨éœ€è¦æ”¹ä¸º GPIO_25-30ï¼ˆä»…ä½œç¤ºä¾‹ï¼‰</p>
<hr/>
<h3 data-id="heading-52">æ¨¡æ¿ 1ï¼šplatform_core_rom.h ä¿®æ”¹ç¤ºä¾‹</h3>
<h4 data-id="heading-53">åŸå§‹ä»£ç </h4>
<p><strong>æ–‡ä»¶</strong>ï¼š<code>src/drivers/chips/ws63/include/platform_core_rom.h</code>
<strong>è¡Œå·</strong>ï¼š45-60</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">/**
 * @brief Definition of pin.
 */</span>
<span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">enum</span> {</span>
    GPIO_00 = <span class="hljs-number">0</span>,
    GPIO_01 = <span class="hljs-number">1</span>,
    GPIO_02 = <span class="hljs-number">2</span>,
    GPIO_03 = <span class="hljs-number">3</span>,
    GPIO_04 = <span class="hljs-number">4</span>,
    GPIO_05 = <span class="hljs-number">5</span>,
    GPIO_06 = <span class="hljs-number">6</span>,
    GPIO_07 = <span class="hljs-number">7</span>,
    GPIO_08 = <span class="hljs-number">8</span>,
    GPIO_09 = <span class="hljs-number">9</span>,
    GPIO_10 = <span class="hljs-number">10</span>,
    GPIO_11 = <span class="hljs-number">11</span>,
    GPIO_12 = <span class="hljs-number">12</span>,
    GPIO_13 = <span class="hljs-number">13</span>,
    GPIO_14 = <span class="hljs-number">14</span>,
    GPIO_15 = <span class="hljs-number">15</span>,
    GPIO_16 = <span class="hljs-number">16</span>,
    GPIO_17 = <span class="hljs-number">17</span>,
    GPIO_18 = <span class="hljs-number">18</span>,
    SFC_CLK = <span class="hljs-number">19</span>,      <span class="hljs-comment">// â† åŸå€¼</span>
    SFC_CSN = <span class="hljs-number">20</span>,      <span class="hljs-comment">// â† åŸå€¼</span>
    SFC_IO0 = <span class="hljs-number">21</span>,      <span class="hljs-comment">// â† åŸå€¼</span>
    SFC_IO1 = <span class="hljs-number">22</span>,      <span class="hljs-comment">// â† åŸå€¼</span>
    SFC_IO2 = <span class="hljs-number">23</span>,      <span class="hljs-comment">// â† åŸå€¼</span>
    SFC_IO3 = <span class="hljs-number">24</span>,      <span class="hljs-comment">// â† åŸå€¼</span>
    PIN_NONE = <span class="hljs-number">25</span>, <span class="hljs-comment">// used as invalid/unused PIN number</span>
} <span class="hljs-type">pin_t</span>;
</code></pre>
<h4 data-id="heading-54">ä¿®æ”¹åçš„ä»£ç </h4>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">/**
 * @brief Definition of pin.
 */</span>
<span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">enum</span> {</span>
    GPIO_00 = <span class="hljs-number">0</span>,
    GPIO_01 = <span class="hljs-number">1</span>,
    GPIO_02 = <span class="hljs-number">2</span>,
    GPIO_03 = <span class="hljs-number">3</span>,
    GPIO_04 = <span class="hljs-number">4</span>,
    GPIO_05 = <span class="hljs-number">5</span>,
    GPIO_06 = <span class="hljs-number">6</span>,
    GPIO_07 = <span class="hljs-number">7</span>,
    GPIO_08 = <span class="hljs-number">8</span>,
    GPIO_09 = <span class="hljs-number">9</span>,
    GPIO_10 = <span class="hljs-number">10</span>,
    GPIO_11 = <span class="hljs-number">11</span>,
    GPIO_12 = <span class="hljs-number">12</span>,
    GPIO_13 = <span class="hljs-number">13</span>,
    GPIO_14 = <span class="hljs-number">14</span>,
    GPIO_15 = <span class="hljs-number">15</span>,
    GPIO_16 = <span class="hljs-number">16</span>,
    GPIO_17 = <span class="hljs-number">17</span>,
    GPIO_18 = <span class="hljs-number">18</span>,
    GPIO_19 = <span class="hljs-number">19</span>,      <span class="hljs-comment">// ç°åœ¨ä½œä¸ºæ™®é€š GPIO</span>
    GPIO_20 = <span class="hljs-number">20</span>,      <span class="hljs-comment">// ç°åœ¨ä½œä¸ºæ™®é€š GPIO</span>
    GPIO_21 = <span class="hljs-number">21</span>,      <span class="hljs-comment">// ç°åœ¨ä½œä¸ºæ™®é€š GPIO</span>
    GPIO_22 = <span class="hljs-number">22</span>,      <span class="hljs-comment">// ç°åœ¨ä½œä¸ºæ™®é€š GPIO</span>
    GPIO_23 = <span class="hljs-number">23</span>,      <span class="hljs-comment">// ç°åœ¨ä½œä¸ºæ™®é€š GPIO</span>
    GPIO_24 = <span class="hljs-number">24</span>,      <span class="hljs-comment">// ç°åœ¨ä½œä¸ºæ™®é€š GPIO</span>
    SFC_CLK = <span class="hljs-number">25</span>,      <span class="hljs-comment">// â† æ–°å€¼ï¼ˆæ”¹åˆ° GPIO_25ï¼‰</span>
    SFC_CSN = <span class="hljs-number">26</span>,      <span class="hljs-comment">// â† æ–°å€¼ï¼ˆæ”¹åˆ° GPIO_26ï¼‰</span>
    SFC_IO0 = <span class="hljs-number">27</span>,      <span class="hljs-comment">// â† æ–°å€¼ï¼ˆæ”¹åˆ° GPIO_27ï¼‰</span>
    SFC_IO1 = <span class="hljs-number">28</span>,      <span class="hljs-comment">// â† æ–°å€¼ï¼ˆæ”¹åˆ° GPIO_28ï¼‰</span>
    SFC_IO2 = <span class="hljs-number">29</span>,      <span class="hljs-comment">// â† æ–°å€¼ï¼ˆæ”¹åˆ° GPIO_29ï¼‰</span>
    SFC_IO3 = <span class="hljs-number">30</span>,      <span class="hljs-comment">// â† æ–°å€¼ï¼ˆæ”¹åˆ° GPIO_30ï¼‰</span>
    PIN_NONE = <span class="hljs-number">31</span>,     <span class="hljs-comment">// æ›´æ–°ä¸º 31ï¼ˆä¹‹å‰çš„ PIN_NONE å€¼ä¹Ÿè¦é¡ºå»¶ï¼‰</span>
} <span class="hljs-type">pin_t</span>;

<span class="hljs-meta">#<span class="hljs-keyword">define</span> PIN_MAX_NUMBER PIN_NONE  <span class="hljs-comment">// ä¿ç•™è¿™ä¸€è¡Œ</span></span>
</code></pre>
<h4 data-id="heading-55">ä¿®æ”¹è¦ç‚¹</h4>
<pre><code class="hljs">âœï¸  æ”¹åŠ¨æ¸…å•ï¼š
   â˜ SFC_CLK ä» 19 æ”¹ä¸º 25
   â˜ SFC_CSN ä» 20 æ”¹ä¸º 26
   â˜ SFC_IO0 ä» 21 æ”¹ä¸º 27
   â˜ SFC_IO1 ä» 22 æ”¹ä¸º 28
   â˜ SFC_IO2 ä» 23 æ”¹ä¸º 29
   â˜ SFC_IO3 ä» 24 æ”¹ä¸º 30
   â˜ PIN_NONE ä» 25 æ”¹ä¸º 31
   â˜ æ·»åŠ  GPIO_19-24 çš„æ™®é€šå®šä¹‰ï¼ˆå¯é€‰ï¼‰
</code></pre>
<hr/>
<h3 data-id="heading-56">æ¨¡æ¿ 2ï¼šsoc_porting.c ä¿®æ”¹ç¤ºä¾‹</h3>
<h4 data-id="heading-57">åŸå§‹ä»£ç </h4>
<p><strong>æ–‡ä»¶</strong>ï¼š<code>src/drivers/chips/ws63/porting/soc/soc_porting.c</code>
<strong>è¡Œå·</strong>ï¼š64-79</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">define</span> PAD_SFC_CLK_CTRL  0x4400d868    <span class="hljs-comment">// GPIO_19</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> PAD_SFC_CSN_CTRL  0x4400d86C    <span class="hljs-comment">// GPIO_20</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> PAD_SFC_IO0_CTRL  0x4400d870    <span class="hljs-comment">// GPIO_21</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> PAD_SFC_IO1_CTRL  0x4400d874    <span class="hljs-comment">// GPIO_22</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> PAD_SFC_IO2_CTRL  0x4400d878    <span class="hljs-comment">// GPIO_23</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> PAD_SFC_IO3_CTRL  0x4400d87C    <span class="hljs-comment">// GPIO_24</span></span>

<span class="hljs-meta">#<span class="hljs-keyword">define</span> SFC_CLK_DS_VALUE  0x3</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> SFC_CSN_DS_VALUE  0x2</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> SFC_DATA_DS_VALUE 0x2</span>

<span class="hljs-type">void</span> <span class="hljs-title function_">config_sfc_ctrl_ds</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span>
{
    reg_setbits(PAD_SFC_CLK_CTRL, <span class="hljs-number">0</span>, POS_4, DTRL_DS_LEN, SFC_CLK_DS_VALUE);
    reg_setbits(PAD_SFC_CSN_CTRL, <span class="hljs-number">0</span>, POS_4, DTRL_DS_LEN, SFC_CSN_DS_VALUE);
    reg_setbits(PAD_SFC_IO0_CTRL, <span class="hljs-number">0</span>, POS_4, DTRL_DS_LEN, SFC_DATA_DS_VALUE);
    reg_setbits(PAD_SFC_IO1_CTRL, <span class="hljs-number">0</span>, POS_4, DTRL_DS_LEN, SFC_DATA_DS_VALUE);
    reg_setbits(PAD_SFC_IO2_CTRL, <span class="hljs-number">0</span>, POS_4, DTRL_DS_LEN, SFC_DATA_DS_VALUE);
    reg_setbits(PAD_SFC_IO3_CTRL, <span class="hljs-number">0</span>, POS_4, DTRL_DS_LEN, SFC_DATA_DS_VALUE);
}
</code></pre>
<h4 data-id="heading-58">ä¿®æ”¹åçš„ä»£ç </h4>
<p><strong>âš ï¸ å…³é”®</strong>ï¼šéœ€è¦ä» WS63 æ•°æ®æ‰‹å†ŒæŸ¥è¯¢æ–° GPIO å¯¹åº”çš„ Pad æ§åˆ¶å¯„å­˜å™¨åœ°å€</p>
<p>å‡è®¾æ–°åœ°å€ä» 0x4400d880 å¼€å§‹ï¼ˆæŒ‰é¡ºåºé€’å¢ 0x4ï¼‰ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// æ–° GPIO çš„ Pad æ§åˆ¶å¯„å­˜å™¨åœ°å€ï¼ˆéœ€ä»èŠ¯ç‰‡æ‰‹å†ŒæŸ¥è¯¢ï¼‰</span>
<span class="hljs-comment">// GPIO_25 â†’ GPIO_30 çš„ Pad åœ°å€ï¼ˆå‡è®¾ï¼‰</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> PAD_SFC_CLK_CTRL  0x4400d880    <span class="hljs-comment">// GPIO_25 å¯¹åº”çš„ Pad åœ°å€</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> PAD_SFC_CSN_CTRL  0x4400d884    <span class="hljs-comment">// GPIO_26 å¯¹åº”çš„ Pad åœ°å€</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> PAD_SFC_IO0_CTRL  0x4400d888    <span class="hljs-comment">// GPIO_27 å¯¹åº”çš„ Pad åœ°å€</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> PAD_SFC_IO1_CTRL  0x4400d88C    <span class="hljs-comment">// GPIO_28 å¯¹åº”çš„ Pad åœ°å€</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> PAD_SFC_IO2_CTRL  0x4400d890    <span class="hljs-comment">// GPIO_29 å¯¹åº”çš„ Pad åœ°å€</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> PAD_SFC_IO3_CTRL  0x4400d894    <span class="hljs-comment">// GPIO_30 å¯¹åº”çš„ Pad åœ°å€</span></span>

<span class="hljs-comment">// é©±åŠ¨å¼ºåº¦å€¼ä¿æŒä¸å˜ï¼ˆé™¤ééœ€è¦å¾®è°ƒï¼‰</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> SFC_CLK_DS_VALUE  0x3           <span class="hljs-comment">// æ—¶é’Ÿå¼ºé©±åŠ¨</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> SFC_CSN_DS_VALUE  0x2           <span class="hljs-comment">// ç‰‡é€‰ä¸­ç­‰é©±åŠ¨</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> SFC_DATA_DS_VALUE 0x2           <span class="hljs-comment">// æ•°æ®çº¿ä¸­ç­‰é©±åŠ¨</span></span>

<span class="hljs-type">void</span> <span class="hljs-title function_">config_sfc_ctrl_ds</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span>
{
    <span class="hljs-comment">// é…ç½®é€»è¾‘å®Œå…¨ç›¸åŒï¼Œåªæ˜¯ä½¿ç”¨äº†æ–°çš„å¯„å­˜å™¨åœ°å€</span>
    reg_setbits(PAD_SFC_CLK_CTRL, <span class="hljs-number">0</span>, POS_4, DTRL_DS_LEN, SFC_CLK_DS_VALUE);
    reg_setbits(PAD_SFC_CSN_CTRL, <span class="hljs-number">0</span>, POS_4, DTRL_DS_LEN, SFC_CSN_DS_VALUE);
    reg_setbits(PAD_SFC_IO0_CTRL, <span class="hljs-number">0</span>, POS_4, DTRL_DS_LEN, SFC_DATA_DS_VALUE);
    reg_setbits(PAD_SFC_IO1_CTRL, <span class="hljs-number">0</span>, POS_4, DTRL_DS_LEN, SFC_DATA_DS_VALUE);
    reg_setbits(PAD_SFC_IO2_CTRL, <span class="hljs-number">0</span>, POS_4, DTRL_DS_LEN, SFC_DATA_DS_VALUE);
    reg_setbits(PAD_SFC_IO3_CTRL, <span class="hljs-number">0</span>, POS_4, DTRL_DS_LEN, SFC_DATA_DS_VALUE);
}
</code></pre>
<h4 data-id="heading-59">ä¿®æ”¹è¦ç‚¹</h4>
<pre><code class="hljs language-scss" lang="scss">âœï¸  æ”¹åŠ¨æ¸…å•ï¼š
   â˜ PAD_SFC_CLK_CTRL åœ°å€æ›´æ–°ï¼ˆä»èŠ¯ç‰‡æ‰‹å†ŒæŸ¥è¡¨ï¼‰
   â˜ PAD_SFC_CSN_CTRL åœ°å€æ›´æ–°
   â˜ PAD_SFC_IO0_CTRL åœ°å€æ›´æ–°
   â˜ PAD_SFC_IO1_CTRL åœ°å€æ›´æ–°
   â˜ PAD_SFC_IO2_CTRL åœ°å€æ›´æ–°
   â˜ PAD_SFC_IO3_CTRL åœ°å€æ›´æ–°
   â˜ é©±åŠ¨å¼ºåº¦å€¼ä¿æŒæˆ–å¾®è°ƒï¼ˆå¯é€‰ï¼‰
   â˜ <span class="hljs-built_in">config_sfc_ctrl_ds</span>() å‡½æ•°é€»è¾‘ä¸å˜

âš ï¸  é‡è¦ï¼š
   â€¢ æ‰€æœ‰åœ°å€éƒ½å¿…é¡»ä» WS63 æ•°æ®æ‰‹å†ŒæŸ¥è¯¢
   â€¢ åœ°å€é€šå¸¸æ˜¯æŒ‰é¡ºåºæ’åˆ—ï¼Œé—´éš” <span class="hljs-number">0</span>x4 å­—èŠ‚
   â€¢ åŠ¡å¿…ç¡®ä¿åœ°å€å‡†ç¡®æ— è¯¯
</code></pre>
<hr/>
<h3 data-id="heading-60">æ¨¡æ¿ 3ï¼šhal_pinctrl_ws63.c ä¿®æ”¹ç¤ºä¾‹</h3>
<h4 data-id="heading-61">åŸå§‹ä»£ç </h4>
<p><strong>æ–‡ä»¶</strong>ï¼š<code>src/drivers/drivers/hal/pinmux/ws63/hal_pinctrl_ws63.c</code>
<strong>è¡Œå·</strong>ï¼š93-140</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-type">static</span> <span class="hljs-type">hal_pin_config_group_t</span> <span class="hljs-type">const</span> g_pin_mode_map[] = {
    {
        GPIO_00,
        GPIO_14,
        HAL_PIN_GPIO_SEL_START_ADDR,
        HAL_PIN_CONFIG_PER_NUM,
        HAL_PIN_GPIO_SEL_START_BIT,
        HAL_PIN_GPIO_SEL_BITS_NUM
    },
    {
        GPIO_15,
        GPIO_18,
        HAL_PIN_UART_SEL_START_ADDR,
        HAL_PIN_CONFIG_PER_NUM,
        HAL_PIN_UART_SEL_START_BIT,
        HAL_PIN_UART_SEL_BITS_NUM
    }
    <span class="hljs-comment">// âš ï¸ åŸæ¥æ²¡æœ‰ SFC_CLK çš„æ¡ç›®</span>
};

<span class="hljs-type">static</span> <span class="hljs-type">hal_pin_config_group_t</span> <span class="hljs-type">const</span> g_pin_pull_map[] = {
    {
        GPIO_00,
        GPIO_14,
        HAL_PIN_GPIO_CTRL_START_ADDR,
        HAL_PIN_CONFIG_PER_NUM,
        HAL_PIN_PULL_START_BIT,
        HAL_PIN_PULL_BITS_NUM
    },
    {
        SFC_CLK,        <span class="hljs-comment">// = 19ï¼ˆåŸå€¼ï¼‰</span>
        SFC_IO3,        <span class="hljs-comment">// = 24ï¼ˆåŸå€¼ï¼‰</span>
        HAL_PIN_SFC_CTRL_START_ADDR,
        HAL_PIN_CONFIG_PER_NUM,
        HAL_PIN_PULL_START_BIT,
        HAL_PIN_PULL_BITS_NUM
    }
};

<span class="hljs-type">static</span> <span class="hljs-type">hal_pin_config_group_t</span> <span class="hljs-type">const</span> g_pin_ds_map[] = {
    {
        GPIO_00,
        GPIO_14,
        HAL_PIN_GPIO_CTRL_START_ADDR,
        HAL_PIN_CONFIG_PER_NUM,
        HAL_PIN_DS_START_BIT,
        HAL_PIN_DS_BITS_NUM
    },
    {
        SFC_CLK,        <span class="hljs-comment">// = 19ï¼ˆåŸå€¼ï¼‰</span>
        SFC_IO3,        <span class="hljs-comment">// = 24ï¼ˆåŸå€¼ï¼‰</span>
        HAL_PIN_SFC_CTRL_START_ADDR,
        HAL_PIN_CONFIG_PER_NUM,
        HAL_PIN_DS_START_BIT,
        HAL_PIN_DS_BITS_NUM
    }
};

<span class="hljs-meta">#<span class="hljs-keyword">if</span> defined(CONFIG_PINCTRL_SUPPORT_IE)</span>
<span class="hljs-type">static</span> <span class="hljs-type">hal_pin_config_group_t</span> <span class="hljs-type">const</span> g_pin_ie_map[] = {
    {
        GPIO_00,
        GPIO_18,
        HAL_PIN_GPIO_CTRL_START_ADDR,
        HAL_PIN_CONFIG_PER_NUM,
        HAL_PIN_IE_START_BIT,
        HAL_PIN_IE_BITS_NUM
    },
    {
        SFC_CLK,        <span class="hljs-comment">// = 19ï¼ˆåŸå€¼ï¼‰</span>
        SFC_IO3,        <span class="hljs-comment">// = 24ï¼ˆåŸå€¼ï¼‰</span>
        HAL_PIN_SFC_CTRL_START_ADDR,
        HAL_PIN_CONFIG_PER_NUM,
        HAL_PIN_IE_START_BIT,
        HAL_PIN_IE_BITS_NUM
    }
};
<span class="hljs-meta">#<span class="hljs-keyword">endif</span></span>

<span class="hljs-meta">#<span class="hljs-keyword">if</span> defined(CONFIG_PINCTRL_SUPPORT_ST)</span>
<span class="hljs-type">static</span> <span class="hljs-type">hal_pin_config_group_t</span> <span class="hljs-type">const</span> g_pin_st_map[] = {
    {
        GPIO_00,
        GPIO_18,
        HAL_PIN_GPIO_CTRL_START_ADDR,
        HAL_PIN_CONFIG_PER_NUM,
        HAL_PIN_ST_START_BIT,
        HAL_PIN_ST_BITS_NUM
    },
    {
        SFC_CLK,        <span class="hljs-comment">// = 19ï¼ˆåŸå€¼ï¼‰</span>
        SFC_IO3,        <span class="hljs-comment">// = 24ï¼ˆåŸå€¼ï¼‰</span>
        HAL_PIN_SFC_CTRL_START_ADDR,
        HAL_PIN_CONFIG_PER_NUM,
        HAL_PIN_ST_START_BIT,
        HAL_PIN_ST_BITS_NUM
    }
};
<span class="hljs-meta">#<span class="hljs-keyword">endif</span></span>
</code></pre>
<h4 data-id="heading-62">ä¿®æ”¹åçš„ä»£ç </h4>
<p><strong>å‡è®¾æ–°çš„ SFC GPIO ä¸º GPIO_25-30ï¼Œä»åœ¨è¿ç»­èŒƒå›´å†…</strong>ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-type">static</span> <span class="hljs-type">hal_pin_config_group_t</span> <span class="hljs-type">const</span> g_pin_mode_map[] = {
    {
        GPIO_00,
        GPIO_14,
        HAL_PIN_GPIO_SEL_START_ADDR,
        HAL_PIN_CONFIG_PER_NUM,
        HAL_PIN_GPIO_SEL_START_BIT,
        HAL_PIN_GPIO_SEL_BITS_NUM
    },
    {
        GPIO_15,
        GPIO_18,
        HAL_PIN_UART_SEL_START_ADDR,
        HAL_PIN_CONFIG_PER_NUM,
        HAL_PIN_UART_SEL_START_BIT,
        HAL_PIN_UART_SEL_BITS_NUM
    }
    <span class="hljs-comment">// SFC çš„ GPIO_25-30 å¯èƒ½ä¸éœ€è¦åœ¨ mode_map ä¸­é…ç½®</span>
};

<span class="hljs-type">static</span> <span class="hljs-type">hal_pin_config_group_t</span> <span class="hljs-type">const</span> g_pin_pull_map[] = {
    {
        GPIO_00,
        GPIO_14,
        HAL_PIN_GPIO_CTRL_START_ADDR,
        HAL_PIN_CONFIG_PER_NUM,
        HAL_PIN_PULL_START_BIT,
        HAL_PIN_PULL_BITS_NUM
    },
    {
        SFC_CLK,        <span class="hljs-comment">// ç°åœ¨ç­‰äº 25ï¼ˆæ–°å€¼ä» platform_core_rom.h è‡ªåŠ¨è·å¾—ï¼‰</span>
        SFC_IO3,        <span class="hljs-comment">// ç°åœ¨ç­‰äº 30ï¼ˆæ–°å€¼ä» platform_core_rom.h è‡ªåŠ¨è·å¾—ï¼‰</span>
        HAL_PIN_SFC_CTRL_START_ADDR,  <span class="hljs-comment">// è¿™ä¸ªåœ°å€å¯èƒ½ä¹Ÿéœ€è¦æ›´æ–°</span>
        HAL_PIN_CONFIG_PER_NUM,
        HAL_PIN_PULL_START_BIT,
        HAL_PIN_PULL_BITS_NUM
    }
};

<span class="hljs-type">static</span> <span class="hljs-type">hal_pin_config_group_t</span> <span class="hljs-type">const</span> g_pin_ds_map[] = {
    {
        GPIO_00,
        GPIO_14,
        HAL_PIN_GPIO_CTRL_START_ADDR,
        HAL_PIN_CONFIG_PER_NUM,
        HAL_PIN_DS_START_BIT,
        HAL_PIN_DS_BITS_NUM
    },
    {
        SFC_CLK,        <span class="hljs-comment">// è‡ªåŠ¨ä» enum è·å–æ–°å€¼ 25</span>
        SFC_IO3,        <span class="hljs-comment">// è‡ªåŠ¨ä» enum è·å–æ–°å€¼ 30</span>
        HAL_PIN_SFC_CTRL_START_ADDR,  <span class="hljs-comment">// å¯èƒ½éœ€è¦æ›´æ–°</span>
        HAL_PIN_CONFIG_PER_NUM,
        HAL_PIN_DS_START_BIT,
        HAL_PIN_DS_BITS_NUM
    }
};

<span class="hljs-meta">#<span class="hljs-keyword">if</span> defined(CONFIG_PINCTRL_SUPPORT_IE)</span>
<span class="hljs-type">static</span> <span class="hljs-type">hal_pin_config_group_t</span> <span class="hljs-type">const</span> g_pin_ie_map[] = {
    {
        GPIO_00,
        GPIO_18,
        HAL_PIN_GPIO_CTRL_START_ADDR,
        HAL_PIN_CONFIG_PER_NUM,
        HAL_PIN_IE_START_BIT,
        HAL_PIN_IE_BITS_NUM
    },
    {
        SFC_CLK,        <span class="hljs-comment">// è‡ªåŠ¨è·å–æ–°å€¼ 25</span>
        SFC_IO3,        <span class="hljs-comment">// è‡ªåŠ¨è·å–æ–°å€¼ 30</span>
        HAL_PIN_SFC_CTRL_START_ADDR,  <span class="hljs-comment">// å¯èƒ½éœ€è¦æ›´æ–°</span>
        HAL_PIN_CONFIG_PER_NUM,
        HAL_PIN_IE_START_BIT,
        HAL_PIN_IE_BITS_NUM
    }
};
<span class="hljs-meta">#<span class="hljs-keyword">endif</span></span>

<span class="hljs-meta">#<span class="hljs-keyword">if</span> defined(CONFIG_PINCTRL_SUPPORT_ST)</span>
<span class="hljs-type">static</span> <span class="hljs-type">hal_pin_config_group_t</span> <span class="hljs-type">const</span> g_pin_st_map[] = {
    {
        GPIO_00,
        GPIO_18,
        HAL_PIN_GPIO_CTRL_START_ADDR,
        HAL_PIN_CONFIG_PER_NUM,
        HAL_PIN_ST_START_BIT,
        HAL_PIN_ST_BITS_NUM
    },
    {
        SFC_CLK,        <span class="hljs-comment">// è‡ªåŠ¨è·å–æ–°å€¼ 25</span>
        SFC_IO3,        <span class="hljs-comment">// è‡ªåŠ¨è·å–æ–°å€¼ 30</span>
        HAL_PIN_SFC_CTRL_START_ADDR,  <span class="hljs-comment">// å¯èƒ½éœ€è¦æ›´æ–°</span>
        HAL_PIN_CONFIG_PER_NUM,
        HAL_PIN_ST_START_BIT,
        HAL_PIN_ST_BITS_NUM
    }
};
<span class="hljs-meta">#<span class="hljs-keyword">endif</span></span>
</code></pre>
<h4 data-id="heading-63">ä¿®æ”¹è¯´æ˜</h4>
<p><strong>å…³é”®è¦ç‚¹</strong>ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">â˜‘ï¸  è‡ªåŠ¨é€‚é…ï¼š
   â€¢ ç”±äºä½¿ç”¨äº† SFC_CLK å’Œ SFC_IO3 çš„æšä¸¾å
   â€¢ platform_core_rom.h æ”¹äº†åè‡ªåŠ¨åº”ç”¨
   â€¢ hal_pinctrl_ws63.c ä¸­ç”¨æšä¸¾åçš„åœ°æ–¹è‡ªåŠ¨æ›´æ–°

âŒ éœ€è¦æ‰‹åŠ¨æ”¹çš„ï¼š
   â€¢ HAL_PIN_SFC_CTRL_START_ADDR
   â€¢ æ‰€æœ‰ GPIO é…ç½®ç»„çš„æ•°æ®ç»“æ„èŒƒå›´

âœï¸  æ”¹åŠ¨æ–¹å¼ï¼š
   æ–¹æ¡ˆ Aï¼ˆæœ€ç®€å•ï¼‰ï¼š
      â€¢ åªæ”¹ platform_core_rom.h ä¸­çš„ <span class="hljs-keyword">enum</span>
      â€¢ å¦‚æœæ–° GPIO èŒƒå›´ä»ç„¶è¿ç»­ï¼Œå…¶ä»–æ–‡ä»¶å¯èƒ½æ— éœ€æ”¹
      
   æ–¹æ¡ˆ Bï¼ˆå½»åº•ï¼‰ï¼š
      â€¢ æ”¹ platform_core_rom.hï¼ˆ<span class="hljs-keyword">enum</span>ï¼‰
      â€¢ æ”¹ soc_porting.cï¼ˆPad åœ°å€ï¼‰
      â€¢ æ”¹ hal_pinctrl_ws63.cï¼ˆé…ç½®ç»„ï¼‰
      â€¢ æ”¹ HAL_PIN_SFC_CTRL_START_OFFSET åŸºåœ°å€
</code></pre>
<hr/>
<h3 data-id="heading-64">æ¨¡æ¿ 4ï¼šHAL_PIN_SFC_CTRL_START_OFFSET åŸºåœ°å€æ›´æ–°</h3>
<h4 data-id="heading-65">åŸå§‹å®šä¹‰</h4>
<p><strong>æ–‡ä»¶</strong>ï¼š<code>src/drivers/drivers/hal/pinmux/ws63/hal_pinctrl_ws63.c</code>
<strong>è¡Œå·</strong>ï¼š20-27</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">define</span> HAL_IO_CFG_BASE_ADDR            0x4400D000</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> HAL_PIN_GPIO_SEL_START_OFFSET   0x000</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> HAL_PIN_UART_SEL_START_OFFSET   0x03C</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> HAL_PIN_GPIO_CTRL_START_OFFSET  0x800</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> HAL_PIN_SFC_CTRL_START_OFFSET   0x868    <span class="hljs-comment">// â† åŸå€¼ï¼ˆç”¨äº GPIO_19-24ï¼‰</span></span>

<span class="hljs-meta">#<span class="hljs-keyword">define</span> HAL_PIN_GPIO_SEL_START_ADDR     (HAL_IO_CFG_BASE_ADDR + HAL_PIN_GPIO_SEL_START_OFFSET)</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> HAL_PIN_UART_SEL_START_ADDR     (HAL_IO_CFG_BASE_ADDR + HAL_PIN_UART_SEL_START_OFFSET)</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> HAL_PIN_GPIO_CTRL_START_ADDR    (HAL_IO_CFG_BASE_ADDR + HAL_PIN_GPIO_CTRL_START_OFFSET)</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> HAL_PIN_SFC_CTRL_START_ADDR     (HAL_IO_CFG_BASE_ADDR + HAL_PIN_SFC_CTRL_START_OFFSET)</span>
</code></pre>
<h4 data-id="heading-66">ä¿®æ”¹åï¼ˆå¦‚æœ GPIO æ”¹åˆ° 25-30ï¼‰</h4>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">define</span> HAL_IO_CFG_BASE_ADDR            0x4400D000</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> HAL_PIN_GPIO_SEL_START_OFFSET   0x000</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> HAL_PIN_UART_SEL_START_OFFSET   0x03C</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> HAL_PIN_GPIO_CTRL_START_OFFSET  0x800</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> HAL_PIN_SFC_CTRL_START_OFFSET   0x880    <span class="hljs-comment">// â† æ–°å€¼ï¼ˆä»èŠ¯ç‰‡æ‰‹å†ŒæŸ¥è¯¢ï¼‰</span></span>

<span class="hljs-meta">#<span class="hljs-keyword">define</span> HAL_PIN_GPIO_SEL_START_ADDR     (HAL_IO_CFG_BASE_ADDR + HAL_PIN_GPIO_SEL_START_OFFSET)</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> HAL_PIN_UART_SEL_START_ADDR     (HAL_IO_CFG_BASE_ADDR + HAL_PIN_UART_SEL_START_OFFSET)</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> HAL_PIN_GPIO_CTRL_START_ADDR    (HAL_IO_CFG_BASE_ADDR + HAL_PIN_GPIO_CTRL_START_OFFSET)</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> HAL_PIN_SFC_CTRL_START_ADDR     (HAL_IO_CFG_BASE_ADDR + HAL_PIN_SFC_CTRL_START_OFFSET)</span>
</code></pre>
<hr/>
<h3 data-id="heading-67">æ¨¡æ¿ 5ï¼šflash_config_info.c æ·»åŠ æ–° Flash</h3>
<h4 data-id="heading-68">åœºæ™¯ï¼šæ·»åŠ æ–°çš„ Flash èŠ¯ç‰‡ï¼ˆå¦‚ GD25Q256ï¼‰</h4>
<h4 data-id="heading-69">åŸæœ‰ Flash æ¡ç›®ç¤ºä¾‹</h4>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">define</span> FLASH_GD25Q32           0x1640C8</span>

<span class="hljs-comment">// ... åœ¨æŸä¸ªæ•°ç»„ä¸­ ...</span>
{
    .chip_id = FLASH_GD25Q32,
    .chip_size = <span class="hljs-number">0x400000</span>,                <span class="hljs-comment">// 4MB</span>
    .read_cmds = {
        {
            .cmd = <span class="hljs-number">0x0B</span>, .cmd_support = <span class="hljs-number">1</span>,
            .addr_len = SPI_ADDR_LEN_24, .addr_support = <span class="hljs-number">1</span>,
            .dummy_cycles = <span class="hljs-number">1</span>,
            .cmd_type = STANDARD_READ, .size = <span class="hljs-number">0x04</span>
        },
        <span class="hljs-comment">// ... å…¶ä»–è¯»å‘½ä»¤ ...</span>
    },
    .read_cmd_num = <span class="hljs-number">3</span>,
    .write_cmds = { ... },
    .write_cmd_num = <span class="hljs-number">2</span>,
    .erase_cmds = { ... },
    .erase_cmd_num = <span class="hljs-number">4</span>,
    .quad_mode = &amp;gd25_quad_mode_cmd,      <span class="hljs-comment">// QSPI æ”¯æŒ</span>
},
</code></pre>
<h4 data-id="heading-70">æ–°å¢ Flash GD25Q256</h4>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// 1. é¦–å…ˆæ·»åŠ  Flash ID å®šä¹‰ï¼ˆåœ¨å®å®šä¹‰éƒ¨åˆ†ï¼‰</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> FLASH_GD25Q256          0x1940C8    <span class="hljs-comment">// 256Mbit</span></span>

<span class="hljs-comment">// 2. å®šä¹‰ QSPI æ¨¡å¼çš„ä½¿èƒ½å‘½ä»¤ï¼ˆå¦‚æœæ”¯æŒ Quadï¼‰</span>
<span class="hljs-type">static</span> <span class="hljs-type">flash_cmd_execute_t</span> gd25q256_quad_mode_cmd = {
    {
        .cmd = <span class="hljs-number">0x35</span>,                        <span class="hljs-comment">// å†™çŠ¶æ€å¯„å­˜å™¨ 2</span>
        .cmd_support = <span class="hljs-number">1</span>,
        .addr_support = <span class="hljs-number">0</span>,
        .dummy_cycles = <span class="hljs-number">0</span>,
        .cmd_type = FLASH_CMD_WRITE,
        .size = <span class="hljs-number">1</span>,
    },
    {
        .cmd = <span class="hljs-number">0x15</span>,                        <span class="hljs-comment">// è¯»çŠ¶æ€å¯„å­˜å™¨ 2</span>
        .cmd_support = <span class="hljs-number">1</span>,
        .addr_support = <span class="hljs-number">0</span>,
        .dummy_cycles = <span class="hljs-number">0</span>,
        .cmd_type = FLASH_CMD_READ,
        .size = <span class="hljs-number">1</span>,
    },
    {
        .cmd_support = <span class="hljs-number">0</span>,                   <span class="hljs-comment">// å…¶ä»–å‘½ä»¤å¯é€‰</span>
    }
};

<span class="hljs-comment">// 3. åœ¨ Flash é…ç½®æ•°ç»„ä¸­è¿½åŠ æ–°æ¡ç›®</span>
{
    .chip_id = FLASH_GD25Q256,
    .chip_size = <span class="hljs-number">0x2000000</span>,                 <span class="hljs-comment">// 32MBï¼ˆ256Mbitï¼‰</span>
    .read_cmds = {
        {
            .cmd = <span class="hljs-number">0x0B</span>,                    <span class="hljs-comment">// Standard Read</span>
            .cmd_support = <span class="hljs-number">1</span>,
            .addr_len = SPI_ADDR_LEN_24,
            .addr_support = <span class="hljs-number">1</span>,
            .dummy_cycles = <span class="hljs-number">1</span>,
            .cmd_type = STANDARD_READ,
            .size = <span class="hljs-number">0x04</span>
        },
        {
            .cmd = <span class="hljs-number">0x3B</span>,                    <span class="hljs-comment">// Fast Read</span>
            .cmd_support = <span class="hljs-number">1</span>,
            .addr_len = SPI_ADDR_LEN_24,
            .addr_support = <span class="hljs-number">1</span>,
            .dummy_cycles = <span class="hljs-number">1</span>,
            .cmd_type = STANDARD_READ,
            .size = <span class="hljs-number">0x04</span>
        },
        {
            .cmd = <span class="hljs-number">0xEB</span>,                    <span class="hljs-comment">// Quad Fast Read</span>
            .cmd_support = <span class="hljs-number">1</span>,
            .addr_len = SPI_ADDR_LEN_24,
            .addr_support = <span class="hljs-number">1</span>,
            .dummy_cycles = <span class="hljs-number">3</span>,
            .cmd_type = QUAD_READ,
            .size = <span class="hljs-number">0x04</span>
        },
    },
    .read_cmd_num = <span class="hljs-number">3</span>,
    .write_cmds = {
        {
            .cmd = <span class="hljs-number">0x02</span>,                    <span class="hljs-comment">// Page Program</span>
            .cmd_support = <span class="hljs-number">1</span>,
            .addr_len = SPI_ADDR_LEN_24,
            .addr_support = <span class="hljs-number">1</span>,
            .dummy_cycles = <span class="hljs-number">0</span>,
            .cmd_type = PAGE_PROGRAM,
            .size = <span class="hljs-number">256</span>
        },
        {
            .cmd = <span class="hljs-number">0x32</span>,                    <span class="hljs-comment">// Quad Page Program</span>
            .cmd_support = <span class="hljs-number">1</span>,
            .addr_len = SPI_ADDR_LEN_24,
            .addr_support = <span class="hljs-number">1</span>,
            .dummy_cycles = <span class="hljs-number">0</span>,
            .cmd_type = PAGE_PROGRAM,
            .size = <span class="hljs-number">256</span>
        },
    },
    .write_cmd_num = <span class="hljs-number">2</span>,
    .erase_cmds = {
        {
            .cmd = <span class="hljs-number">0x20</span>,                    <span class="hljs-comment">// Sector Erase (4KB)</span>
            .cmd_support = <span class="hljs-number">1</span>,
            .addr_support = <span class="hljs-number">1</span>,
            .cmd_type = ERASE_SECTOR,
            .size = <span class="hljs-number">0x1000</span>
        },
        {
            .cmd = <span class="hljs-number">0x52</span>,                    <span class="hljs-comment">// 32KB Erase</span>
            .cmd_support = <span class="hljs-number">1</span>,
            .addr_support = <span class="hljs-number">1</span>,
            .cmd_type = ERASE_32K,
            .size = <span class="hljs-number">0x8000</span>
        },
        {
            .cmd = <span class="hljs-number">0xD8</span>,                    <span class="hljs-comment">// 64KB Erase (Block)</span>
            .cmd_support = <span class="hljs-number">1</span>,
            .addr_support = <span class="hljs-number">1</span>,
            .cmd_type = ERASE_BLOCK,
            .size = <span class="hljs-number">0x10000</span>
        },
        {
            .cmd = <span class="hljs-number">0xC7</span>,                    <span class="hljs-comment">// Chip Erase</span>
            .cmd_support = <span class="hljs-number">1</span>,
            .addr_support = <span class="hljs-number">0</span>,
            .cmd_type = ERASE_CHIP,
            .size = <span class="hljs-number">0x2000000</span>                <span class="hljs-comment">// å…¨å®¹é‡</span>
        },
    },
    .erase_cmd_num = <span class="hljs-number">4</span>,
    .quad_mode = &amp;gd25q256_quad_mode_cmd,   <span class="hljs-comment">// æ”¯æŒ QSPI</span>
},
</code></pre>
<h4 data-id="heading-71">ä¿®æ”¹æ¸…å•</h4>
<pre><code class="hljs language-arduino" lang="arduino">â˜‘ï¸  æ·»åŠ  Flash çš„æ­¥éª¤ï¼š
   <span class="hljs-number">1.</span> ä» Flash æ•°æ®æ‰‹å†Œè·å–ï¼š
      â–¡ Flash IDï¼ˆ<span class="hljs-number">3</span> å­—èŠ‚ï¼‰
      â–¡ å®¹é‡ï¼ˆ<span class="hljs-type">byte</span>ï¼‰
      â–¡ å„ç§è¯»å‘½ä»¤çš„ opcode
      â–¡ ç¼–ç¨‹å‘½ä»¤ opcode
      â–¡ æ“¦é™¤å‘½ä»¤ opcodeï¼ˆé€šå¸¸ <span class="hljs-number">4</span> ç§ï¼‰
      â–¡ QSPI ä½¿èƒ½åºåˆ—ï¼ˆå¦‚æ”¯æŒï¼‰
      
   <span class="hljs-number">2.</span> ä¿®æ”¹ flash_config_info.cï¼š
      â–¡ æ·»åŠ  <span class="hljs-meta">#<span class="hljs-keyword">define</span> FLASH_XXXXX ID</span>
      â–¡ å¦‚æœæ”¯æŒ QSPIï¼Œå®šä¹‰ quad_mode ç»“æ„
      â–¡ åˆ›å»º <span class="hljs-type">flash_spi_info_t</span> æ¡ç›®
      â–¡ å¡«å……è¯»/å†™/æ“¦å‘½ä»¤æ•°ç»„
      
   <span class="hljs-number">3.</span> ç¼–è¯‘éªŒè¯ï¼š
      â–¡ å›ºä»¶ç¼–è¯‘æˆåŠŸ
      â–¡ çƒ§å½•å¹¶æµ‹è¯• Flash è¯†åˆ«
      â–¡ éªŒè¯ <span class="hljs-built_in">SPI</span> æ¨¡å¼è¯»å†™
      â–¡ éªŒè¯ QSPI æ¨¡å¼è¯»å†™ï¼ˆå¦‚æ”¯æŒï¼‰
</code></pre>
<hr/>
<h3 data-id="heading-72">æ¨¡æ¿ 6ï¼šç¼–è¯‘é…ç½®ä¿®æ”¹</h3>
<h4 data-id="heading-73">å¯ç”¨ DMA æ¨¡å¼</h4>
<p><strong>æ–‡ä»¶</strong>ï¼š<code>ws63_liteos_app.config</code>
<strong>ä¿®æ”¹</strong>ï¼š</p>
<pre><code class="hljs language-diff" lang="diff">  #
  # SFC Configuration
  #
  
  #
  # Config  SFC
  #
<span class="hljs-deletion">- # CONFIG_SFC_SUPPORT_DMA is not set</span>
<span class="hljs-addition">+ CONFIG_SFC_SUPPORT_DMA=y</span>
  # CONFIG_SFC_ALLOW_ERASE_WRITEBACK is not set
  # CONFIG_SFC_ALREADY_INIT is not set
</code></pre>
<h4 data-id="heading-74">å¯ç”¨é€šç”¨ SPI Master</h4>
<p><strong>æ–‡ä»¶</strong>ï¼š<code>ws63_liteos_app.config</code>
<strong>ä¿®æ”¹</strong>ï¼š</p>
<pre><code class="hljs language-diff" lang="diff">  CONFIG_DRIVER_SUPPORT_SPI=y
  
  #
  # SPI Configuration
  #
  
  #
  # Config SPI
  #
<span class="hljs-deletion">- # CONFIG_SPI_SUPPORT_MASTER is not set</span>
<span class="hljs-addition">+ CONFIG_SPI_SUPPORT_MASTER=y</span>
</code></pre>
<hr/>
<h3 data-id="heading-75">ğŸ” ç¼–è¯‘éªŒè¯æ­¥éª¤</h3>
<h4 data-id="heading-76">æ­¥éª¤ 1ï¼šæ¸…ç†æ—§ç¼–è¯‘</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cd</span> fbb_ws63-master
<span class="hljs-built_in">rm</span> -rf src/build/cmake_build
<span class="hljs-built_in">rm</span> -rf src/build/output
</code></pre>
<h4 data-id="heading-77">æ­¥éª¤ 2ï¼šé‡æ–°ç¼–è¯‘</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cd</span> src
python build.py
</code></pre>
<h4 data-id="heading-78">æ­¥éª¤ 3ï¼šæ£€æŸ¥ç¼–è¯‘é”™è¯¯</h4>
<pre><code class="hljs language-arduino" lang="arduino">å¸¸è§é”™è¯¯ï¼š
  â€¢ <span class="hljs-string">"undefined reference to SFC_CLK"</span> 
    â†’ æ£€æŸ¥ platform_core_rom.h <span class="hljs-keyword">enum</span> å®šä¹‰
  
  â€¢ <span class="hljs-string">"SFC initialization failed"</span>
    â†’ æ£€æŸ¥ Pad å¯„å­˜å™¨åœ°å€æ˜¯å¦æ­£ç¡®
  
  â€¢ <span class="hljs-string">"Flash not detected"</span>
    â†’ æ£€æŸ¥ GPIO ç¡¬ä»¶è¿æ¥
    â†’ æ£€æŸ¥ flash_config_info.c Flash ID
</code></pre>
<h4 data-id="heading-79">æ­¥éª¤ 4ï¼šçƒ§å½•å’Œæµ‹è¯•</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># çƒ§å½•æ–°å›ºä»¶</span>
./flashtool --boot src/build/output/bin/out.bin

<span class="hljs-comment"># é€šè¿‡ä¸²å£è§‚å¯Ÿ SFC åˆå§‹åŒ–æ—¥å¿—</span>
<span class="hljs-comment"># åº”çœ‹åˆ°ç±»ä¼¼ï¼š</span>
<span class="hljs-comment">#   SFC: Identifying flash...</span>
<span class="hljs-comment">#   SFC: Flash ID = 0x1640C8</span>
<span class="hljs-comment">#   SFC: QSPI mode enabled</span>
<span class="hljs-comment">#   SFC: Initialization success</span>
</code></pre>
<hr/>
<h3 data-id="heading-80">âš ï¸ å¸¸è§é™·é˜±</h3>
<h4 data-id="heading-81">é™·é˜± 1ï¼šå¿˜è®°åŒæ—¶æ”¹å¤šä¸ªæ–‡ä»¶</h4>
<pre><code class="hljs">âŒ é”™è¯¯åšæ³•ï¼š
   åªæ”¹ platform_core_rom.hï¼Œæ²¡æ”¹ soc_porting.c

âœ… æ­£ç¡®åšæ³•ï¼š
   åŒæ—¶æ”¹ï¼š
   â€¢ platform_core_rom.hï¼ˆGPIO å·ï¼‰
   â€¢ soc_porting.cï¼ˆPad åœ°å€ï¼‰
   â€¢ hal_pinctrl_ws63.cï¼ˆé…ç½®èŒƒå›´ï¼‰
</code></pre>
<h4 data-id="heading-82">é™·é˜± 2ï¼šPad å¯„å­˜å™¨åœ°å€å‡è®¾</h4>
<pre><code class="hljs language-ini" lang="ini">âŒ é”™è¯¯åšæ³•ï¼š
   ç®€å•åœ°åŠ åç§»ï¼š0x4400d868 + <span class="hljs-attr">8</span> = <span class="hljs-number">0</span>x4400d870
   ï¼ˆå®é™…å¯èƒ½ä¸æ˜¯çº¿æ€§å…³ç³»ï¼‰

âœ… æ­£ç¡®åšæ³•ï¼š
   ä» WS63 æ•°æ®æ‰‹å†ŒæŸ¥è¡¨è·å–å‡†ç¡®åœ°å€
</code></pre>
<h4 data-id="heading-83">é™·é˜± 3ï¼šFlash ID åŒ¹é…å¤±è´¥</h4>
<pre><code class="hljs language-arduino" lang="arduino">âŒ é”™è¯¯ç°è±¡ï¼š
   Flash ID = <span class="hljs-number">0xFFFFFF</span>
   
âœ… æ’æŸ¥æ­¥éª¤ï¼š
   <span class="hljs-number">1.</span> ç”¨é€»è¾‘åˆ†æä»ªæ•è· <span class="hljs-built_in">SPI</span> é€šä¿¡
   <span class="hljs-number">2.</span> æ£€æŸ¥ GPIO_19<span class="hljs-number">-22</span> æ³¢å½¢
   <span class="hljs-number">3.</span> ç”¨ Flash æ•°æ®æ‰‹å†ŒéªŒè¯ read ID å‘½ä»¤
   <span class="hljs-number">4.</span> æ£€æŸ¥ flash_config_info.c ä¸­æ˜¯å¦æœ‰è¯¥ ID
</code></pre>
<h4 data-id="heading-84">é™·é˜± 4ï¼šQSPI æ¨¡å¼æ— æ³•å¯ç”¨</h4>
<pre><code class="hljs language-markdown" lang="markdown">âŒ é”™è¯¯ç°è±¡ï¼š
   å§‹ç»ˆè¿è¡Œåœ¨ SPI è€Œé QSPI æ¨¡å¼
   
âœ… æ’æŸ¥æ­¥éª¤ï¼š
<span class="hljs-bullet">   1.</span> ç¡®è®¤ Flash æ•°æ®æ‰‹å†Œæ”¯æŒ QSPI
<span class="hljs-bullet">   2.</span> æ£€æŸ¥ flash<span class="hljs-emphasis">_config_</span>info.c ä¸­ quad<span class="hljs-emphasis">_mode æŒ‡é’ˆæ˜¯å¦ä¸º NULL
   3. éªŒè¯ GPIO_</span>23-24 çš„è¿æ¥ï¼ˆä»… QSPI ç”¨ï¼‰
<span class="hljs-bullet">   4.</span> æ£€æŸ¥ QSPI ä½¿èƒ½å‘½ä»¤æ˜¯å¦æ­£ç¡®
</code></pre>
<hr/>
<h3 data-id="heading-85">ğŸ“š å‚è€ƒèµ„æº</h3>

























<table><thead><tr><th>èµ„æº</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>WS63 æ•°æ®æ‰‹å†Œ</td><td>Pad åœ°å€æŸ¥è¡¨ã€GPIO åŠŸèƒ½</td></tr><tr><td>Flash æ•°æ®æ‰‹å†Œ</td><td>å‘½ä»¤é›†ã€QSPI æ”¯æŒã€ID</td></tr><tr><td>GPIO_LITTLEFS_ANALYSIS.md</td><td>GPIO é…ç½®åŸç†</td></tr><tr><td>SFC_GPIO_PIN_MAPPING.md</td><td>Pin æ˜ å°„å®Œæ•´è¡¨</td></tr></tbody></table>
<hr/>
<p><strong>ç¤ºä¾‹æ–‡æ¡£å®Œæˆ</strong> | ç”¨äºå­¦ä¹ å’Œå‚è€ƒ | å®é™…ä½¿ç”¨éœ€æŒ‰ç¡¬ä»¶å®šåˆ¶</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æ”¹é€ ç±³å®¶å±å¹•æŒ‚ç¯1ä»£æ¥å…¥HomeKit]]></title>    <link>https://juejin.cn/post/7604694326517923891</link>    <guid>https://juejin.cn/post/7604694326517923891</guid>    <pubDate>2026-02-09T23:40:44.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604694326517923891" data-draft-id="7604672395626905627" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æ”¹é€ ç±³å®¶å±å¹•æŒ‚ç¯1ä»£æ¥å…¥HomeKit"/> <meta itemprop="keywords" content="åµŒå…¥å¼"/> <meta itemprop="datePublished" content="2026-02-09T23:40:44.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="chaosgoo"/> <meta itemprop="url" content="https://juejin.cn/user/2541726616010317"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æ”¹é€ ç±³å®¶å±å¹•æŒ‚ç¯1ä»£æ¥å…¥HomeKit
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2541726616010317/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    chaosgoo
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-09T23:40:44.000Z" title="Mon Feb 09 2026 23:40:44 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>æœ¬æ–‡é¦–å‘äºæˆ‘çš„ä¸ªäººåšå®¢ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fchaosgoo.com%2FAdd-your-Xiaomi-Yeelight-Monitor-Light-Bar-to-HomeKit-with-ESP32-C3%2F" target="_blank" title="https://chaosgoo.com/Add-your-Xiaomi-Yeelight-Monitor-Light-Bar-to-HomeKit-with-ESP32-C3/" ref="nofollow noopener noreferrer">chaosgoo.com</a>ï¼Œæ¬¢è¿æ¥è®¿äº¤æµã€‚</p>
</blockquote>
<h3 data-id="heading-0">å‰è¨€</h3>
<p>æˆ‘ä½çš„å±‹å­åºŠå¤´æ²¡æœ‰æ’åº§ä¹Ÿæ²¡æœ‰æ§åˆ¶æˆ¿é—´é¡¶ç¯çš„å¼€å…³,å‡å¦‚ç†„ç¯ç¡è§‰çš„è¯ä¼šè®©æˆ¿é—´é™·å…¥ä¸€ç‰‡æ¼†é»‘.
æ‰€ä»¥å¾ˆé•¿ä¸€æ®µæ—¶é—´é‡Œæˆ‘éƒ½æŠŠç±³å®¶å±å¹•æŒ‚ç¯çš„æ§åˆ¶å™¨æ”¾åœ¨åºŠå¤´,ç”¨äºä¸´æ—¶ç…§æ˜.<br/>
è¿™å°±å¼•å‘äº†å¦å¤–ä¸€ä¸ªé—®é¢˜,æ¯æ¬¡å›å®¶å¼€ç”µè„‘æ‰“å¼€å±å¹•æŒ‚ç¯,æˆ‘éƒ½å¾—èµ°åˆ°åºŠå¤´æ‰¾åˆ°æ§åˆ¶å™¨å¼€å¯å±å¹•æŒ‚ç¯.
åœ¨ç»å†äº†å¤šæ¬¡éº»çƒ¦å,æˆ‘å†³å®šæŠŠè¿™ä¸ªå±å¹•æŒ‚ç¯æ¥å…¥HomeKit. è¿™æ ·å°±å¯ä»¥ç”¨è¯­éŸ³æˆ–è€…æ‰‹æœºæ§åˆ¶äº†.</p>
<h3 data-id="heading-1">èµ„æ–™æœé›†</h3>
<p>åœ¨é˜…è¯»äº†è¿™ç¯‡<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.chongdiantou.com%2Farchives%2F55542.html" target="_blank" title="https://www.chongdiantou.com/archives/55542.html" ref="nofollow noopener noreferrer">æ‹†è§£æŠ¥å‘Šï¼šMJç±³å®¶æ˜¾ç¤ºå™¨æŒ‚ç¯MJGJD01YL</a>å, éœ€è¦åšçš„å·¥ä½œå°±å¾ˆæ˜ç¡®äº†.
å¤§è‡´åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªæ­¥éª¤</p>
<ul>
<li>é˜…è¯»æ‰‹å†Œ,æ‰¾åˆ°æ§åˆ¶å¼•è„š</li>
<li>æ‹†é™¤èŠ¯ç‰‡,æ›¿æ¢æˆESP32</li>
<li>ç¼–å†™ä»£ç ,æ¥å…¥HomeKit</li>
</ul>

<h3 data-id="heading-2">é˜…è¯»æ‰‹å†Œ,æ‰¾åˆ°æ§åˆ¶å¼•è„š</h3>
<p>çœ‹å®Œæ‹†è§£æŠ¥å‘Šå,å¾—çŸ¥äº®åº¦ç”±TLSR8368å’ŒSY7301AèŠ¯ç‰‡æ§åˆ¶å®ç°, ä¸¤æ¬¾èŠ¯ç‰‡çš„èµ„æ–™å¾ˆå®¹æ˜“åœ¨Googleä¸Šæœç´¢åˆ°.<br/>
åŸºæœ¬ä¸Šå¯ä»¥ç¡®å®šæ˜¯ç”±TLSR8368å‘é€PWMä¿¡å·ç»™SY7301Aè¿›è¡Œè°ƒå…‰.</p>
<p>TLSR8368ä¸€å…±å°±16ä¸ªå¼•è„š, å¯¹ç…§æ‰‹å†Œé…åˆç¤ºæ³¢å™¨æŒ¨ä¸ªæµ‹é‡æ§åˆ¶å¼•è„šæµ‹å‡ºPWMå¼•è„šæ˜¯ç”±#3,#5äº§ç”Ÿ, è¿˜æœ‰ä¸€ä¸ªå¼•è„š#8ç”¨äºä½¿èƒ½SY7301AèŠ¯ç‰‡.</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7eee3ad29d2345568d15d76ec5b1413c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY2hhb3Nnb28=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771285244&amp;x-signature=RpsqGsDXIug37QbH3lfw%2FkvfJrc%3D" alt="measurePins" loading="lazy"/></p>
<p>æµ‹é‡å‡ºå¼•è„šå¦‚ä¸‹</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/16900dbf24024929878ec9377cd69de7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY2hhb3Nnb28=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771285244&amp;x-signature=3kSHQPt%2Bz1l0V5dTGxRiJAQynIQ%3D" alt="QQ_1770680236013.png" loading="lazy"/></p>
<h3 data-id="heading-3">æ‹†é™¤èŠ¯ç‰‡,æ›¿æ¢æˆESP32</h3>
<p>åˆ°äº†è¿™ä¸€æ­¥éœ€è¦é€‰æ‹©åˆé€‚å°ºå¯¸çš„èŠ¯ç‰‡,ç„¶åé‡æ–°ç»˜åˆ¶ä¸€å—æ¿å­å¯„ç”Ÿåœ¨åŸå§‹ä½ç½®å³å¯.</p>
<p>TLSR8368çš„ç„Šç›˜ç©ºé—´è¿˜ç®—å®½æ•, è¿™é‡Œå¯ä»¥ç„Šæ¥ä¸€ä¸ªå°è£…å°ä¸€ç‚¹çš„ESP32-C3(å¯¹åº”çš„å‹å·åç§°æ˜¯ESP8685), å°è£…ä¸ºQFN28 4x4mm</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ff49a94f109047c994889201ae1f141a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY2hhb3Nnb28=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771285244&amp;x-signature=%2FXQlk0xDrmD%2FFivbSKhAiOomXEk%3D" alt="Lamp++ Top View" loading="lazy"/></p>
<p>è¿™é‡Œå³åŠéƒ¨åˆ†çš„TypeCå’ŒLDOéƒ¨åˆ†å°†ä¼šåœ¨åœ¨çƒ§å½•åæŠ˜æ–­, åç»­å›ºä»¶å¯ä»¥é€šè¿‡4P 2mmé—´è·æ¢é’ˆæˆ–è€…OTAè¿›è¡Œæ›´æ–°.</p>
<p>é™„ä¸Šä¸€å¼ åˆç‰ˆç„Šæ¥åçš„å›¾ç‰‡, åˆç‰ˆä¸ºä¹‹å‰æ²¡æœ‰é¢„ç•™å¯æŠ˜æ–­TypeCéƒ¨åˆ†çš„ç‰ˆæœ¬.</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4bfc8ee95a8f4c8a9d8e88475c188be9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY2hhb3Nnb28=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771285244&amp;x-signature=bv3%2BWbiO9E5dvvTdEu0OEOTGeCE%3D" alt="Preview" loading="lazy"/></p>
<h3 data-id="heading-4">ç¼–å†™ä»£ç ,æ¥å…¥HomeKit</h3>
<p>å¾—ç›ŠäºHomeSpanè¿™ä¸ªåº“,éœ€è¦ç¼–å†™çš„ä»£ç å¾ˆç®€å•.</p>
<p>ç›®å‰å®ç°äº†ç™½è‰²LEDçš„è°ƒå…‰, ç”±äºæˆ‘æŸåäº†æš–é»„è‰²LEDæ§åˆ¶å¼•è„šçš„é˜»ç„Š,å¯¼è‡´æœ€ç»ˆç‰ˆæœ¬æœªèƒ½å®ç°è‰²æ¸©è°ƒèŠ‚åŠŸèƒ½ã€‚</p>
<p>å› æ­¤ï¼Œä»¥ä¸‹ä»£ç ä¸»è¦æ¼”ç¤ºäº†å¦‚ä½•æ§åˆ¶ç™½è‰²LEDçš„å¼€å…³ä¸è°ƒå…‰</p>
<pre><code class="hljs language-cpp" lang="cpp">#<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;Arduino.h&gt;</span></span>

#<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"HomeSpan.h"</span></span>
#<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"extras/PwmPin.h"</span>  <span class="hljs-comment">// library of various PWM functions</span></span>

<span class="hljs-comment">////////////////////////////////////</span>

<span class="hljs-keyword">struct</span> <span class="hljs-title class_">FadingLED</span> : Service::LightBulb {
  LedPin *ledPin;             <span class="hljs-comment">// reference to Led Pin</span>
  SpanCharacteristic *power;  <span class="hljs-comment">// reference to the On Characteristic</span>
  SpanCharacteristic *level;  <span class="hljs-comment">// reference to the Brightness Characteristic</span>
  SpanCharacteristic *colorTemperature;  <span class="hljs-comment">// reference to the Color Temperature</span>

  <span class="hljs-built_in">FadingLED</span>(<span class="hljs-type">int</span> _ledPin) : Service::<span class="hljs-built_in">LightBulb</span>() {
    power = <span class="hljs-keyword">new</span> Characteristic::<span class="hljs-built_in">On</span>();
    level = <span class="hljs-keyword">new</span> Characteristic::<span class="hljs-built_in">Brightness</span>(<span class="hljs-number">0</span>);
    colorTemperature = <span class="hljs-keyword">new</span> Characteristic::<span class="hljs-built_in">ColorTemperature</span>(<span class="hljs-number">200</span>, <span class="hljs-literal">true</span>);
    ledPin = <span class="hljs-keyword">new</span> <span class="hljs-built_in">LedPin</span>(_ledPin);
  }

  <span class="hljs-function">boolean <span class="hljs-title">update</span><span class="hljs-params">()</span> </span>{
    Serial.<span class="hljs-built_in">printf</span>(<span class="hljs-string">"power-&gt;getNewVal()=%d"</span>, power-&gt;<span class="hljs-built_in">getNewVal</span>());
    Serial.<span class="hljs-built_in">printf</span>(<span class="hljs-string">",level-&gt;getNewVal()=%d"</span>, level-&gt;<span class="hljs-built_in">getNewVal</span>());
    Serial.<span class="hljs-built_in">printf</span>(<span class="hljs-string">",colorTemperature-&gt;getNewVal()=%d\n"</span>,
                  colorTemperature-&gt;<span class="hljs-built_in">getNewVal</span>());
    ledPin-&gt;<span class="hljs-built_in">fade</span>(power-&gt;<span class="hljs-built_in">getNewVal</span>() * level-&gt;<span class="hljs-built_in">getNewVal</span>(), <span class="hljs-number">2000</span>,
                 LedPin::PROPORTIONAL);
    <span class="hljs-keyword">while</span> (ledPin-&gt;<span class="hljs-built_in">fadeStatus</span>() == LedPin::FADING)
      ;

    <span class="hljs-keyword">return</span> (<span class="hljs-literal">true</span>);
  }

  <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">loop</span><span class="hljs-params">()</span> <span class="hljs-keyword">override</span> </span>{
    <span class="hljs-keyword">if</span> (ledPin-&gt;<span class="hljs-built_in">fadeStatus</span>() == LedPin::COMPLETED) {
      power-&gt;<span class="hljs-built_in">setVal</span>(<span class="hljs-number">1</span> - power-&gt;<span class="hljs-built_in">getVal</span>());
      level-&gt;<span class="hljs-built_in">setVal</span>(power-&gt;<span class="hljs-built_in">getVal</span>() ? <span class="hljs-number">100</span> : <span class="hljs-number">0</span>);
    }
  }
};

<span class="hljs-comment">//////////////////////////////////</span>

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">setup</span><span class="hljs-params">()</span> </span>{
  <span class="hljs-built_in">pinMode</span>(<span class="hljs-number">5</span>, OUTPUT);
  <span class="hljs-built_in">pinMode</span>(<span class="hljs-number">10</span>, OUTPUT);
  <span class="hljs-built_in">digitalWrite</span>(<span class="hljs-number">5</span>, HIGH);
  <span class="hljs-built_in">digitalWrite</span>(<span class="hljs-number">10</span>, LOW);
  Serial.<span class="hljs-built_in">begin</span>(<span class="hljs-number">115200</span>);
  <span class="hljs-built_in">digitalWrite</span>(<span class="hljs-number">10</span>, HIGH);

  Serial.<span class="hljs-built_in">println</span>(<span class="hljs-string">"Wi-Fi is Connected!"</span>);
  homeSpan.<span class="hljs-built_in">enableOTA</span>(<span class="hljs-string">"12345678"</span>);
  homeSpan.<span class="hljs-built_in">setPairingCode</span>(<span class="hljs-string">"11223344"</span>);
  homeSpan.<span class="hljs-built_in">begin</span>(Category::Lighting, <span class="hljs-string">"Lamp++"</span>);

  <span class="hljs-keyword">new</span> <span class="hljs-built_in">SpanAccessory</span>();
  <span class="hljs-keyword">new</span> Service::<span class="hljs-built_in">AccessoryInformation</span>();
  <span class="hljs-keyword">new</span> Characteristic::<span class="hljs-built_in">Identify</span>();
  <span class="hljs-keyword">new</span> Characteristic::<span class="hljs-built_in">ColorTemperature</span>(<span class="hljs-number">200</span>, <span class="hljs-literal">true</span>);
  <span class="hljs-keyword">new</span> <span class="hljs-built_in">FadingLED</span>(<span class="hljs-number">4</span>);
}

<span class="hljs-comment">//////////////////////////////////////</span>

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">loop</span><span class="hljs-params">()</span> </span>{ 
  homeSpan.<span class="hljs-built_in">poll</span>();
}

</code></pre>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-section">[env:airm2m_core_esp32c3]</span>
<span class="hljs-attr">platform</span> = espressif32@<span class="hljs-number">5.4</span>.<span class="hljs-number">0</span>
<span class="hljs-attr">board</span> = airm2m_core_esp32c3
<span class="hljs-attr">framework</span> = ardui<span class="hljs-literal">no</span>
<span class="hljs-attr">monitor_speed</span> = <span class="hljs-number">115200</span>
<span class="hljs-attr">lib_deps</span> = homespan/HomeSpan@^<span class="hljs-number">1.8</span>.<span class="hljs-number">0</span>
<span class="hljs-comment">; upload_protocol = espota</span>
<span class="hljs-comment">; upload_flags =  --auth=12345678</span>
<span class="hljs-comment">; upload_port = 192.168.0.104</span>
<span class="hljs-attr">build_flags</span> = 
	-D <span class="hljs-attr">ARDUINO_USB_MODE</span>=<span class="hljs-number">1</span>
	-D <span class="hljs-attr">ARDUINO_USB_CDC_ON_BOOT</span>=<span class="hljs-number">1</span>  
</code></pre>
<h3 data-id="heading-5">æ•ˆæœå±•ç¤º</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/82a44809216b45d5a65661f87217c7b4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY2hhb3Nnb28=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771285244&amp;x-signature=0IyWjKqF1pppGymEJbM4la8LD%2BQ%3D" alt="Preview2" loading="lazy"/></p>
<h3 data-id="heading-6">å‚è€ƒèµ„æ–™</h3>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.chongdiantou.com%2Farchives%2F55542.html" target="_blank" title="https://www.chongdiantou.com/archives/55542.html" ref="nofollow noopener noreferrer">æ‹†è§£æŠ¥å‘Šï¼šMJç±³å®¶æ˜¾ç¤ºå™¨æŒ‚ç¯MJGJD01YL</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[MySQLçš„10ç§é«˜çº§SQLï¼Œæ€§èƒ½èµ·é£]]></title>    <link>https://juejin.cn/post/7604493165329203234</link>    <guid>https://juejin.cn/post/7604493165329203234</guid>    <pubDate>2026-02-10T02:10:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604493165329203234" data-draft-id="7604685644685017140" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="MySQLçš„10ç§é«˜çº§SQLï¼Œæ€§èƒ½èµ·é£"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2026-02-10T02:10:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="è‹ä¸‰è¯´æŠ€æœ¯"/> <meta itemprop="url" content="https://juejin.cn/user/465848661970824"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            MySQLçš„10ç§é«˜çº§SQLï¼Œæ€§èƒ½èµ·é£
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/465848661970824/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    è‹ä¸‰è¯´æŠ€æœ¯
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T02:10:56.000Z" title="Tue Feb 10 2026 02:10:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»13åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å‰è¨€</h2>
<p>å¾ˆå¤šå°ä¼™ä¼´åœ¨å·¥ä½œä¸­ï¼Œå¯èƒ½åªæŠŠMySQLå½“ä½œä¸€ä¸ªç®€å•çš„â€œæ•°æ®å­˜å‚¨ç®±â€ï¼Œç”¨äº†å®ƒ80%çš„åŸºç¡€åŠŸèƒ½ï¼Œå´ä¸çŸ¥é“å®ƒè¿˜æœ‰å¦å¤–20%çš„ã€èƒ½è§£å†³90%å¤æ‚é—®é¢˜çš„â€œé«˜çº§ç”¨æ³•â€ã€‚</p>
<p>ä»Šå¤©ï¼Œæˆ‘ä¸è°ˆåŸºç¡€çš„å¢åˆ æ”¹æŸ¥ï¼Œå°±å’Œä½ æ·±å…¥èŠèŠï¼Œåœ¨å®é™…é«˜æ€§èƒ½ã€é«˜å¹¶å‘ã€å¤§æ•°æ®é‡çš„åœºæ™¯ä¸‹ï¼Œé‚£äº›çœŸæ­£èƒ½è®©ä½ å’Œå›¢é˜Ÿç”Ÿäº§åŠ›å€å¢ã€æ€§èƒ½é£å‡çš„10ç§MySQLé«˜çº§å®æˆ˜æŠ€å·§ã€‚</p>
<p>å¸Œæœ›å¯¹ä½ ä¼šæœ‰æ‰€å¸®åŠ©ã€‚</p>
<h2 data-id="heading-1">01 æ‰§è¡Œè®¡åˆ’</h2>
<p>åœ¨ä¼˜åŒ–ä»»ä½•æŸ¥è¯¢ä¹‹å‰ï¼Œ<strong>è¯»æ‡‚<code>EXPLAIN</code>çš„è¾“å‡ºæ˜¯ä½ çš„ç¬¬ä¸€é—¨å¿…ä¿®è¯¾</strong>ã€‚</p>
<p>å®ƒå°±åƒSQLçš„â€œXå…‰ç‰‡â€ï¼Œèƒ½å‘Šè¯‰ä½ MySQLç©¶ç«Ÿæ‰“ç®—å¦‚ä½•æ‰§è¡Œä½ çš„æŸ¥è¯¢ï¼Œç“¶é¢ˆåœ¨å“ªé‡Œã€‚</p>
<h3 data-id="heading-2">æ ¸å¿ƒç”¨æ³•ä¸å®æˆ˜</h3>
<p>æ‰§è¡Œ<code>EXPLAIN</code>åï¼Œä½ éœ€è¦é‡ç‚¹å…³æ³¨ä»¥ä¸‹å‡ ä¸ªå…³é”®å­—æ®µï¼š</p>
<ul>
<li><strong>type</strong>ï¼šè®¿é—®ç±»å‹ï¼Œä»æœ€ä¼˜åˆ°æœ€å·®å¤§è‡´æ˜¯ï¼š<code>system</code> &gt; <code>const</code> &gt; <code>eq_ref</code> &gt; <code>ref</code> &gt; <code>range</code> &gt; <code>index</code> &gt; <code>ALL</code>ã€‚çœ‹åˆ°<code>ALL</code>ï¼ˆå…¨è¡¨æ‰«æï¼‰å°±è¦è­¦æƒ•äº†ã€‚</li>
<li><strong>key</strong>ï¼šå®é™…ä½¿ç”¨çš„ç´¢å¼•ã€‚å¦‚æœä¸º<code>NULL</code>ï¼Œè¯´æ˜æ²¡ç”¨ä¸Šç´¢å¼•ã€‚</li>
<li><strong>rows</strong>ï¼šMySQLé¢„ä¼°è¦æ‰«æçš„è¡Œæ•°ã€‚è¿™ä¸ªæ•°å­—è¶Šæ¥è¿‘å®é™…éœ€è¦çš„æ•°æ®è¡Œæ•°è¶Šå¥½ã€‚</li>
<li><strong>Extra</strong>ï¼šåŒ…å«éå¸¸ä¸°å¯Œçš„ä¿¡æ¯ï¼Œä¾‹å¦‚<code>Using filesort</code>ï¼ˆéœ€è¦é¢å¤–æ’åºï¼‰ã€<code>Using temporary</code>ï¼ˆä½¿ç”¨äº†ä¸´æ—¶è¡¨ï¼‰ï¼Œè¿™é€šå¸¸æ˜¯æ€§èƒ½æ€æ‰‹ã€‚</li>
</ul>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- ä¸€ä¸ªéœ€è¦ä¼˜åŒ–çš„æŸ¥è¯¢ç¤ºä¾‹</span>
EXPLAIN 
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> orders 
<span class="hljs-keyword">WHERE</span> user_id <span class="hljs-operator">=</span> <span class="hljs-number">10086</span> 
  <span class="hljs-keyword">AND</span> create_time <span class="hljs-keyword">BETWEEN</span> <span class="hljs-string">'2024-01-01'</span> <span class="hljs-keyword">AND</span> <span class="hljs-string">'2024-01-31'</span>
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> amount <span class="hljs-keyword">DESC</span>;
</code></pre>
<p>å‡è®¾è¿™ä¸ªæŸ¥è¯¢çš„<code>type</code>æ˜¯<code>ALL</code>ï¼Œ<code>key</code>æ˜¯<code>NULL</code>ã€‚è¿™æ„å‘³ç€å®ƒåœ¨<code>orders</code>è¡¨ä¸Šè¿›è¡Œäº†å…¨è¡¨æ‰«æï¼Œæ€§èƒ½æå·®ã€‚ä¼˜åŒ–æ–¹æ³•é€šå¸¸æ˜¯åˆ›å»ºä¸€ä¸ªå¤åˆç´¢å¼•ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- åˆ›å»ºè¦†ç›–äº†WHEREå’ŒORDER BYçš„å¤åˆç´¢å¼•</span>
<span class="hljs-keyword">CREATE</span> INDEX idx_user_time_amount <span class="hljs-keyword">ON</span> orders(user_id, create_time, amount);
<span class="hljs-comment">-- å†æ¬¡ä½¿ç”¨EXPLAINï¼Œä½ ä¼šçœ‹åˆ°typeå˜æˆäº†rangeï¼Œkeyæ˜¾ç¤ºäº†æ–°ç´¢å¼•ï¼Œæ€§èƒ½å¤©å·®åœ°åˆ«ã€‚</span>
</code></pre>
<p><strong>æ·±åº¦å‰–æ</strong>ï¼š<code>EXPLAIN</code>æ˜¯åŸºäºè¡¨çš„ç»Ÿè®¡ä¿¡æ¯æ¥ä¼°ç®—æˆæœ¬çš„ã€‚å¦‚æœè¡¨æ•°æ®å˜åŒ–å¾ˆå¤§è€Œç»Ÿè®¡ä¿¡æ¯æœªæ›´æ–°ï¼Œä¼˜åŒ–å™¨å¯èƒ½ä¼šé€‰é”™ç´¢å¼•ã€‚</p>
<p>è¿™æ—¶ï¼Œå¯ä»¥ç”¨<code>ANALYZE TABLE table_name;</code>æ¥æ‰‹åŠ¨æ›´æ–°ç»Ÿè®¡ä¿¡æ¯ã€‚</p>
<p>æœ‰äº›å°ä¼™ä¼´åœ¨å·¥ä½œä¸­å†™çš„SQLæœ¬èº«ä¸å¤æ‚ï¼Œä½†æ‰§è¡Œå¾ˆæ…¢ï¼Œç¬¬ä¸€æ­¥å°±åº”è¯¥ç¥­å‡º<code>EXPLAIN</code>ã€‚</p>
<h2 data-id="heading-3">02 é«˜çº§ç´¢å¼•ç­–ç•¥</h2>
<p>ç´¢å¼•æ˜¯æ€§èƒ½çš„åŸºçŸ³ï¼Œä½†é”™è¯¯çš„ç´¢å¼•æ¯”æ²¡æœ‰ç´¢å¼•æ›´ç³Ÿç³•ã€‚</p>
<h3 data-id="heading-4">é«˜çº§ç´¢å¼•ç­–ç•¥</h3>
<ol>
<li><strong>è¦†ç›–ç´¢å¼•ï¼ˆCovering Indexï¼‰</strong>ï¼šå¦‚æœç´¢å¼•åŒ…å«äº†æŸ¥è¯¢éœ€è¦çš„æ‰€æœ‰å­—æ®µï¼Œå¼•æ“å°±æ— éœ€å›è¡¨æŸ¥è¯¢æ•°æ®è¡Œï¼Œé€Ÿåº¦æå¿«ã€‚</li>
</ol>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- å‡è®¾å¸¸ç”¨æŸ¥è¯¢æ˜¯è·å–ç”¨æˆ·çš„å§“åå’Œé‚®ç®±</span>
<span class="hljs-keyword">SELECT</span> name, email <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> age <span class="hljs-operator">&gt;</span> <span class="hljs-number">20</span>;
<span class="hljs-comment">-- ä¸ºè¿™ä¸ªæŸ¥è¯¢è®¾è®¡è¦†ç›–ç´¢å¼•</span>
<span class="hljs-keyword">CREATE</span> INDEX idx_age_name_email <span class="hljs-keyword">ON</span> users(age, name, email);
<span class="hljs-comment">-- ageç”¨äºæŸ¥è¯¢ï¼Œnameå’Œemailæœ¬èº«å°±åœ¨ç´¢å¼•é¡µä¸­ï¼Œæ— éœ€æŸ¥æ‰¾æ•°æ®è¡Œã€‚</span>
</code></pre>
<ol start="2">
<li>
<p><strong>ç´¢å¼•ä¸‹æ¨ï¼ˆIndex Condition Pushdownï¼Œ ICPï¼‰</strong>ï¼šè¿™æ˜¯MySQL 5.6å¼•å…¥çš„é‡å¤§ä¼˜åŒ–ã€‚å¯¹äºå¤åˆç´¢å¼•<code>(a, b)</code>ï¼ŒæŸ¥è¯¢<code>WHERE a = ? AND b LIKE â€˜%xxxâ€™</code>ã€‚åœ¨æ—§ç‰ˆæœ¬ä¸­ï¼Œå³ä½¿<code>a</code>å‘½ä¸­äº†ç´¢å¼•ï¼Œå¼•æ“ä¹Ÿä¼šå°†æ‰€æœ‰<code>a=?</code>çš„è®°å½•å›è¡¨ï¼Œå†å»è¿‡æ»¤<code>b</code>ã€‚è€ŒICPå…è®¸å°†<code>b LIKE â€˜%xxxâ€™</code>è¿™ä¸ªæ¡ä»¶ä¸‹æ¨åˆ°å­˜å‚¨å¼•æ“å±‚ï¼Œåœ¨ç´¢å¼•æ‰«ææ—¶å°±è¿‡æ»¤ï¼Œå¤§å¤§å‡å°‘å›è¡¨æ¬¡æ•°ã€‚</p>
</li>
<li>
<p><strong>å‰ç¼€ç´¢å¼•ï¼ˆPrefix Indexï¼‰</strong>ï¼šå¯¹äºè¶…é•¿æ–‡æœ¬å­—æ®µï¼ˆå¦‚<code>VARCHAR(500)</code>ï¼‰ï¼Œä¸ºæ•´ä¸ªå­—æ®µå»ºç´¢å¼•éå¸¸è‡ƒè‚¿ã€‚å¯ä»¥åªå¯¹å‰Nä¸ªå­—ç¬¦å»ºç«‹ç´¢å¼•ï¼Œåœ¨ç©ºé—´å’Œæ•ˆç‡é—´å–å¾—å¹³è¡¡ã€‚</p>
</li>
</ol>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- ä¸ºcontentå­—æ®µå‰100ä¸ªå­—ç¬¦åˆ›å»ºç´¢å¼•</span>
<span class="hljs-keyword">CREATE</span> INDEX idx_content_prefix <span class="hljs-keyword">ON</span> articles (content(<span class="hljs-number">100</span>));
<span class="hljs-comment">-- ç¼ºç‚¹æ˜¯å‰ç¼€ç´¢å¼•æ— æ³•ç”¨äºGROUP BYå’ŒORDER BYæ“ä½œã€‚</span>
</code></pre>
<p><strong>æ·±åº¦å‰–æ</strong>ï¼šç´¢å¼•æ˜¯ä¸€æŠŠåŒåˆƒå‰‘ï¼ŒåŠ é€ŸæŸ¥è¯¢çš„åŒæ—¶ï¼Œä¼šé™ä½å†™æ“ä½œï¼ˆINSERT/UPDATE/DELETEï¼‰çš„é€Ÿåº¦ï¼Œå› ä¸ºç´¢å¼•æ ‘ä¹Ÿéœ€è¦ç»´æŠ¤ã€‚</p>
<p>ä¸€ä¸ªè¡¨ä¸Šåˆ›å»ºåå‡ ä¸ªç´¢å¼•æ˜¯å¸¸è§çš„è®¾è®¡è¯¯åŒºã€‚</p>
<p>ä½ éœ€è¦å®šæœŸä½¿ç”¨<code>SHOW INDEX FROM table_name;</code>å®¡æŸ¥ç´¢å¼•çš„åŸºæ•°ï¼ˆCardinalityï¼Œå”¯ä¸€å€¼æ•°é‡ï¼‰ï¼Œåˆ é™¤ä½¿ç”¨ç‡æä½çš„å†—ä½™ç´¢å¼•ã€‚</p>
<h2 data-id="heading-5">03 çª—å£å‡½æ•°</h2>
<p>è¿™æ˜¯MySQL 8.0å¸¦æ¥çš„â€œç¥å…µåˆ©å™¨â€ï¼Œç”¨äºè¿›è¡Œ<strong>è·¨è¡Œè®¡ç®—</strong>ï¼Œå®Œç¾è§£å†³å¤æ‚æ’åã€ç´¯åŠ ã€ç§»åŠ¨å¹³å‡ç­‰é—®é¢˜ã€‚</p>
<h3 data-id="heading-6">æ ¸å¿ƒåœºæ™¯ä¸è¯­æ³•</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- ç»å…¸åœºæ™¯ï¼šè®¡ç®—æ¯ä¸ªéƒ¨é—¨å†…å‘˜å·¥çš„è–ªæ°´æ’å</span>
<span class="hljs-keyword">SELECT</span> 
    name,
    department,
    salary,
    <span class="hljs-built_in">RANK</span>() <span class="hljs-keyword">OVER</span> (<span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">BY</span> department <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> salary <span class="hljs-keyword">DESC</span>) <span class="hljs-keyword">as</span> dept_salary_rank,
    <span class="hljs-comment">-- åŒæ—¶è®¡ç®—å…¬å¸æ•´ä½“æ’å</span>
    <span class="hljs-built_in">RANK</span>() <span class="hljs-keyword">OVER</span> (<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> salary <span class="hljs-keyword">DESC</span>) <span class="hljs-keyword">as</span> company_rank,
    <span class="hljs-comment">-- è®¡ç®—éƒ¨é—¨å†…è–ªæ°´ç´¯è®¡å æ¯”</span>
    <span class="hljs-built_in">SUM</span>(salary) <span class="hljs-keyword">OVER</span> (<span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">BY</span> department) <span class="hljs-keyword">as</span> dept_total,
    salary <span class="hljs-operator">/</span> <span class="hljs-built_in">SUM</span>(salary) <span class="hljs-keyword">OVER</span> (<span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">BY</span> department) <span class="hljs-keyword">as</span> salary_ratio
<span class="hljs-keyword">FROM</span> employees;
</code></pre>
<p><code>PARTITION BY</code>ç±»ä¼¼äº<code>GROUP BY</code>ï¼Œä½†ä¸ä¼šå°†è¡Œåˆå¹¶ï¼Œè€Œæ˜¯å®šä¹‰çª—å£èŒƒå›´ã€‚</p>
<p><code>ORDER BY</code>å†³å®šçª—å£å†…çš„æ’åºã€‚</p>
<p><strong>æ·±åº¦å‰–æ</strong>ï¼šåœ¨MySQL 8.0ä¹‹å‰ï¼Œè¦å®ç°ä¸Šè¿°æŸ¥è¯¢ï¼Œä½ éœ€è¦å†™å¤æ‚çš„è‡ªè¿æ¥æˆ–æ•ˆç‡æä½çš„å­æŸ¥è¯¢ã€‚çª—å£å‡½æ•°åœ¨æ•°æ®åº“å†…éƒ¨è¿›è¡Œäº†æ·±åº¦ä¼˜åŒ–ï¼Œæ€§èƒ½æå‡å¯è¾¾å‡ ä¸ªæ•°é‡çº§ã€‚</p>
<p>å®ƒç‰¹åˆ«é€‚ç”¨äº<strong>åˆ†ææŠ¥è¡¨ã€å®æ—¶æ’è¡Œæ¦œã€è®¡ç®—åŒæ¯”ç¯æ¯”</strong>ç­‰OLAPå‹åœºæ™¯ã€‚</p>
<h2 data-id="heading-7">04 é€šç”¨è¡¨è¡¨è¾¾å¼ï¼ˆCTEï¼‰</h2>
<p>CTEï¼ˆWITHå­å¥ï¼‰æ˜¯å¦ä¸€ä¸ªMySQL 8.0çš„é‡è¦ç‰¹æ€§ï¼Œå®ƒ<strong>å…è®¸ä½ å®šä¹‰ä¸´æ—¶çš„å‘½åç»“æœé›†</strong>ï¼Œåœ¨åç»­æŸ¥è¯¢ä¸­åƒæ™®é€šè¡¨ä¸€æ ·å¼•ç”¨ã€‚</p>
<h3 data-id="heading-8">ä¼˜åŠ¿ä¸ç¤ºä¾‹</h3>
<ol>
<li><strong>æå‡å¯è¯»æ€§</strong>ï¼šå°†å¤æ‚æŸ¥è¯¢åˆ†è§£æˆé€»è¾‘æ¸…æ™°çš„æ­¥éª¤ã€‚</li>
<li><strong>æ”¯æŒé€’å½’</strong>ï¼šè¿™æ˜¯CTEçš„æ€æ‰‹çº§åŠŸèƒ½ï¼Œå¯ä»¥è½»æ¾æŸ¥è¯¢æ ‘å½¢æˆ–å›¾çŠ¶æ•°æ®ã€‚</li>
</ol>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- ç¤ºä¾‹1ï¼šåˆ†è§£å¤æ‚æŸ¥è¯¢ï¼ˆéé€’å½’ï¼‰</span>
<span class="hljs-keyword">WITH</span> 
  high_value_orders <span class="hljs-keyword">AS</span> ( <span class="hljs-comment">-- æ‰¾å‡ºé«˜ä»·å€¼è®¢å•</span>
    <span class="hljs-keyword">SELECT</span> user_id, <span class="hljs-built_in">SUM</span>(amount) <span class="hljs-keyword">as</span> total_spent 
    <span class="hljs-keyword">FROM</span> orders 
    <span class="hljs-keyword">WHERE</span> status <span class="hljs-operator">=</span> <span class="hljs-string">'completed'</span>
    <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> user_id 
    <span class="hljs-keyword">HAVING</span> total_spent <span class="hljs-operator">&gt;</span> <span class="hljs-number">10000</span>
  ),
  active_users <span class="hljs-keyword">AS</span> ( <span class="hljs-comment">-- æ‰¾å‡ºæ´»è·ƒç”¨æˆ·</span>
    <span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">DISTINCT</span> user_id 
    <span class="hljs-keyword">FROM</span> user_logs 
    <span class="hljs-keyword">WHERE</span> last_active_date <span class="hljs-operator">&gt;</span> DATE_SUB(NOW(), <span class="hljs-type">INTERVAL</span> <span class="hljs-number">30</span> <span class="hljs-keyword">DAY</span>)
  )
<span class="hljs-comment">-- æœ€ç»ˆæŸ¥è¯¢ï¼šæ—¢æ˜¯é«˜ä»·å€¼åˆæ˜¯æ´»è·ƒçš„ç”¨æˆ·</span>
<span class="hljs-keyword">SELECT</span> u.name, u.email, h.total_spent
<span class="hljs-keyword">FROM</span> users u
<span class="hljs-keyword">JOIN</span> high_value_orders h <span class="hljs-keyword">ON</span> u.id <span class="hljs-operator">=</span> h.user_id
<span class="hljs-keyword">JOIN</span> active_users a <span class="hljs-keyword">ON</span> u.id <span class="hljs-operator">=</span> a.user_id;

<span class="hljs-comment">-- ç¤ºä¾‹2ï¼šé€’å½’CTEï¼ŒæŸ¥è¯¢éƒ¨é—¨æ ‘</span>
<span class="hljs-keyword">WITH</span> <span class="hljs-keyword">RECURSIVE</span> department_tree <span class="hljs-keyword">AS</span> (
    <span class="hljs-comment">-- é”šç‚¹ï¼šæ‰¾åˆ°æ ¹éƒ¨é—¨</span>
    <span class="hljs-keyword">SELECT</span> id, name, parent_id, <span class="hljs-number">1</span> <span class="hljs-keyword">as</span> level 
    <span class="hljs-keyword">FROM</span> departments 
    <span class="hljs-keyword">WHERE</span> parent_id <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NULL</span>
    <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">ALL</span>
    <span class="hljs-comment">-- é€’å½’æˆå‘˜ï¼šè¿æ¥çˆ¶éƒ¨é—¨å’Œå­éƒ¨é—¨</span>
    <span class="hljs-keyword">SELECT</span> d.id, d.name, d.parent_id, dt.level <span class="hljs-operator">+</span> <span class="hljs-number">1</span>
    <span class="hljs-keyword">FROM</span> departments d
    <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> department_tree dt <span class="hljs-keyword">ON</span> d.parent_id <span class="hljs-operator">=</span> dt.id
)
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> department_tree <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> level, id;
</code></pre>
<p><strong>æ·±åº¦å‰–æ</strong>ï¼šé€’å½’CTEæå¤§åœ°ç®€åŒ–äº†<strong>ç»„ç»‡æ¶æ„ã€åˆ†ç±»ç›®å½•ã€è¯„è®ºåµŒå¥—</strong>ç­‰å±‚æ¬¡æ•°æ®çš„æŸ¥è¯¢ã€‚</p>
<p>åœ¨æ—§ç‰ˆæœ¬ä¸­ï¼Œè¿™é€šå¸¸éœ€è¦åœ¨åº”ç”¨å±‚è¿›è¡Œå¤šæ¬¡æŸ¥è¯¢æˆ–åœ¨æ•°æ®åº“ä¸­ä½¿ç”¨å­˜å‚¨è¿‡ç¨‹ï¼Œé€’å½’CTEåœ¨æ•°æ®åº“å†…æ ¸å®Œæˆéå†ï¼Œæ•ˆç‡æ›´é«˜ã€‚</p>
<h2 data-id="heading-9">05 JSONç±»å‹ä¸å‡½æ•°</h2>
<p>MySQL 5.7+åŸç”Ÿæ”¯æŒJSONæ•°æ®ç±»å‹ï¼Œè®©ä½ èƒ½å¤Ÿåœ¨å…³ç³»å‹æ•°æ®åº“ä¸­çµæ´»åœ°å­˜å‚¨å’ŒæŸ¥è¯¢åŠç»“æ„åŒ–æ•°æ®ï¼Œè¿™åœ¨å¤„ç†<strong>åŠ¨æ€å­—æ®µã€é…ç½®ä¿¡æ¯æˆ–ç¬¬ä¸‰æ–¹APIè¿”å›çš„æ•°æ®</strong>æ—¶éå¸¸æœ‰ç”¨ã€‚</p>
<h3 data-id="heading-10">æ ¸å¿ƒæ“ä½œ</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 1. åˆ›å»ºåŒ…å«JSONåˆ—çš„è¡¨</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> products (
    id <span class="hljs-type">INT</span> <span class="hljs-keyword">PRIMARY</span> KEY,
    name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>),
    attributes JSON COMMENT <span class="hljs-string">'å­˜å‚¨é¢œè‰²ã€å°ºå¯¸ç­‰åŠ¨æ€å±æ€§'</span>
);

<span class="hljs-comment">-- 2. æ’å…¥JSONæ•°æ®</span>
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> products <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">1</span>, <span class="hljs-string">'T-Shirt'</span>, <span class="hljs-string">'{"color": "red", "size": ["M", "L"], "tags": ["casual", "cotton"]}'</span>);

<span class="hljs-comment">-- 3. æŸ¥è¯¢ (ä½¿ç”¨ -&gt; å’Œ -&gt;&gt; æ“ä½œç¬¦)</span>
<span class="hljs-comment">-- -&gt; è¿”å›JSONç±»å‹ï¼Œ -&gt;&gt; è¿”å›çº¯æ–‡æœ¬å­—ç¬¦ä¸²</span>
<span class="hljs-keyword">SELECT</span> 
    name,
    attributes<span class="hljs-operator">-</span><span class="hljs-operator">&gt;&gt;</span><span class="hljs-string">'$.color'</span> <span class="hljs-keyword">as</span> color, <span class="hljs-comment">-- æå–colorå€¼</span>
    attributes<span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span><span class="hljs-string">'$.size'</span> <span class="hljs-keyword">as</span> size_array <span class="hljs-comment">-- æå–sizeæ•°ç»„ï¼ˆä»ä¸ºJSONï¼‰</span>
<span class="hljs-keyword">FROM</span> products 
<span class="hljs-keyword">WHERE</span> attributes<span class="hljs-operator">-</span><span class="hljs-operator">&gt;&gt;</span><span class="hljs-string">'$.color'</span> <span class="hljs-operator">=</span> <span class="hljs-string">'red'</span> 
   <span class="hljs-keyword">OR</span> JSON_CONTAINS(attributes<span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span><span class="hljs-string">'$.tags'</span>, <span class="hljs-string">'"cotton"'</span>);

<span class="hljs-comment">-- 4. æ›´æ–°éƒ¨åˆ†JSON</span>
<span class="hljs-keyword">UPDATE</span> products 
<span class="hljs-keyword">SET</span> attributes <span class="hljs-operator">=</span> JSON_SET(attributes, <span class="hljs-string">'$.color'</span>, <span class="hljs-string">'blue'</span>, <span class="hljs-string">'$.new_field'</span>, <span class="hljs-string">'value'</span>) 
<span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;
</code></pre>
<p><strong>æ·±åº¦å‰–æ</strong>ï¼šJSONåˆ—åŒæ ·å¯ä»¥å»ºç«‹ç´¢å¼•ï¼ˆé€šè¿‡å‡½æ•°ç´¢å¼•ï¼‰ï¼ŒåŠ é€ŸæŸ¥è¯¢ã€‚</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> INDEX idx_color <span class="hljs-keyword">ON</span> products( (attributes<span class="hljs-operator">-</span><span class="hljs-operator">&gt;&gt;</span><span class="hljs-string">'$.color'</span>) );
</code></pre>
<p>è¿™å…è®¸ä½ åœ¨ä¿æŒçµæ´»æ€§çš„åŒæ—¶ï¼Œä¸ä¸§å¤±å¯¹å…³é”®å­—æ®µçš„æŸ¥è¯¢æ€§èƒ½ã€‚</p>
<p>å®ƒå®Œç¾å¡«è¡¥äº†å…³ç³»æ¨¡å‹åœ¨åº”å¯¹<strong>å¤šå˜ä¸šåŠ¡éœ€æ±‚</strong>æ—¶çš„çŸ­æ¿ã€‚</p>
<h2 data-id="heading-11">06 åˆ†åŒºè¡¨ï¼ˆPartitioningï¼‰</h2>
<p>å½“å•è¡¨æ•°æ®é‡å·¨å¤§ï¼ˆå¦‚æ•°äº¿è¡Œï¼‰æ—¶ï¼Œåˆ†åŒºå¯ä»¥å°†ä¸€å¼ å¤§è¡¨åœ¨ç‰©ç†ä¸Šåˆ†å‰²ä¸ºå¤šä¸ªæ›´å°ã€æ›´æ˜“ç®¡ç†çš„éƒ¨åˆ†ï¼Œè€Œé€»è¾‘ä¸Šä»æ˜¯ä¸€å¼ è¡¨ã€‚</p>
<h3 data-id="heading-12">åˆ†åŒºç­–ç•¥ä¸ç¤ºä¾‹</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- æŒ‰æ—¶é—´èŒƒå›´(RANGE)åˆ†åŒºï¼Œéå¸¸é€‚åˆæ—¥å¿—ã€è®¢å•è¡¨</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> sales (
    id <span class="hljs-type">INT</span>,
    sale_date <span class="hljs-type">DATE</span>,
    amount <span class="hljs-type">DECIMAL</span>(<span class="hljs-number">10</span>,<span class="hljs-number">2</span>)
)
<span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">BY</span> <span class="hljs-keyword">RANGE</span> COLUMNS(sale_date) (
    <span class="hljs-keyword">PARTITION</span> p2023q1 <span class="hljs-keyword">VALUES</span> LESS THAN (<span class="hljs-string">'2023-04-01'</span>),
    <span class="hljs-keyword">PARTITION</span> p2023q2 <span class="hljs-keyword">VALUES</span> LESS THAN (<span class="hljs-string">'2023-07-01'</span>),
    <span class="hljs-keyword">PARTITION</span> p2023q3 <span class="hljs-keyword">VALUES</span> LESS THAN (<span class="hljs-string">'2023-10-01'</span>),
    <span class="hljs-keyword">PARTITION</span> p2023q4 <span class="hljs-keyword">VALUES</span> LESS THAN (<span class="hljs-string">'2024-01-01'</span>),
    <span class="hljs-keyword">PARTITION</span> p_future <span class="hljs-keyword">VALUES</span> LESS THAN MAXVALUE
);

<span class="hljs-comment">-- æŸ¥è¯¢æ—¶ï¼Œä¼˜åŒ–å™¨ä¼šè‡ªåŠ¨å®šä½åˆ°ç‰¹å®šåˆ†åŒºï¼ˆåˆ†åŒºè£å‰ªï¼ŒPartition Pruningï¼‰</span>
EXPLAIN <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> sales <span class="hljs-keyword">WHERE</span> sale_date <span class="hljs-operator">=</span> <span class="hljs-string">'2023-05-15'</span>;
<span class="hljs-comment">-- ä½ ä¼šçœ‹åˆ°partitions: p2023q2ï¼Œæ„å‘³ç€åªæ‰«æäº†2023å¹´Q2çš„åˆ†åŒºã€‚</span>
</code></pre>
<p>é™¤äº†<code>RANGE</code>ï¼Œè¿˜æœ‰<code>LIST</code>ï¼ˆæŒ‰åˆ—è¡¨å€¼ï¼‰ã€<code>HASH</code>ï¼ˆæŒ‰å“ˆå¸Œå€¼å‡åŒ€åˆ†å¸ƒï¼‰ç­‰åˆ†åŒºæ–¹å¼ã€‚</p>
<p><strong>æ·±åº¦å‰–æ</strong>ï¼šåˆ†åŒºçš„æ ¸å¿ƒä¼˜åŠ¿åœ¨äº<strong>ç»´æŠ¤æ€§</strong>å’Œ<strong>æŸ¥è¯¢æ€§èƒ½</strong>ã€‚</p>
<p>ä½ å¯ä»¥å¿«é€Ÿåˆ é™¤æˆ–å½’æ¡£æ•´ä¸ªæ—§åˆ†åŒºï¼ˆ<code>ALTER TABLE sales DROP PARTITION p2023q1;</code>ï¼‰ï¼Œè¿™æ¯”<code>DELETE</code>æ“ä½œå¿«å¾—å¤šï¼Œä¸”ä¸äº§ç”Ÿç¢ç‰‡ã€‚å¯¹äºæŒ‰åˆ†åŒºé”®è¿‡æ»¤çš„æŸ¥è¯¢ï¼Œæ€§èƒ½æå‡æ˜¾è‘—ã€‚</p>
<p>ä½†æ³¨æ„ï¼Œåˆ†åŒºé”®é€‰æ‹©ä¸å½“æˆ–è·¨åˆ†åŒºæŸ¥è¯¢ï¼Œæ€§èƒ½å¯èƒ½åè€Œä¸‹é™ã€‚</p>
<h2 data-id="heading-13">07 è¿æ¥ï¼ˆJOINï¼‰ä¸å­æŸ¥è¯¢</h2>
<p>å¤šè¡¨å…³è”æ˜¯ä¸šåŠ¡å¸¸æ€ï¼Œä½†å†™å¾—ä¸å¥½å°±æ˜¯æ€§èƒ½ç¾éš¾ã€‚</p>
<h3 data-id="heading-14">é«˜çº§æŠ€å·§</h3>
<ol>
<li><strong>æ§åˆ¶è¿æ¥é¡ºåº</strong>ï¼šMySQLä¼˜åŒ–å™¨é€šå¸¸ä¼šé€‰æ‹©å®ƒè®¤ä¸ºæœ€ä½³çš„é¡ºåºï¼Œä½†ä½ å¯ä»¥åœ¨å¤æ‚åœºæ™¯ä¸‹ç”¨<code>STRAIGHT_JOIN</code>å¼ºåˆ¶æŒ‡å®šé¡ºåºã€‚</li>
</ol>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> ... 
<span class="hljs-keyword">FROM</span> small_table s
STRAIGHT_JOIN large_table l <span class="hljs-keyword">ON</span> s.id <span class="hljs-operator">=</span> l.s_id; <span class="hljs-comment">-- å¼ºåˆ¶å…ˆæŸ¥å°è¡¨</span>
</code></pre>
<ol start="2">
<li><strong>åˆ©ç”¨è¡ç”Ÿè¡¨ï¼ˆDerived Tableï¼‰ä¸‹æ¨æ¡ä»¶</strong>ï¼šæœ‰æ—¶å°†å­æŸ¥è¯¢æˆ–è¿‡æ»¤æ¡ä»¶æå‰ï¼Œèƒ½æå¤§åœ°å‡å°‘ä¸­é—´ç»“æœé›†ã€‚</li>
</ol>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- ä¼˜åŒ–å‰ï¼šå…ˆè¿æ¥ä¸¤ä¸ªå¤§è¡¨ï¼Œå†è¿‡æ»¤</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> A <span class="hljs-keyword">JOIN</span> B <span class="hljs-keyword">ON</span> A.id <span class="hljs-operator">=</span> B.aid <span class="hljs-keyword">WHERE</span> A.create_time <span class="hljs-operator">&gt;</span> <span class="hljs-string">'...'</span>;

<span class="hljs-comment">-- ä¼˜åŒ–åï¼šå…ˆè¿‡æ»¤Aè¡¨ï¼Œå†è¿æ¥</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> (<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> A <span class="hljs-keyword">WHERE</span> create_time <span class="hljs-operator">&gt;</span> <span class="hljs-string">'...'</span>) filtered_A
<span class="hljs-keyword">JOIN</span> B <span class="hljs-keyword">ON</span> filtered_A.id <span class="hljs-operator">=</span> B.aid;
</code></pre>
<ol start="3">
<li><strong><code>EXISTS</code> vs <code>IN</code></strong>ï¼šå¯¹äºâ€œæ˜¯å¦å­˜åœ¨â€çš„æŸ¥è¯¢ï¼Œç‰¹åˆ«æ˜¯å­æŸ¥è¯¢ç»“æœé›†è¾ƒå¤§æ—¶ï¼Œ<code>EXISTS</code>ï¼ˆå…³è”å­æŸ¥è¯¢ï¼‰é€šå¸¸æ¯”<code>IN</code>ï¼ˆéå…³è”å­æŸ¥è¯¢ï¼‰æ€§èƒ½æ›´å¥½ï¼Œå› ä¸ºå®ƒæ‰¾åˆ°ç¬¬ä¸€ä¸ªåŒ¹é…é¡¹å°±ä¼šåœæ­¢ã€‚</li>
</ol>
<p><strong>æ·±åº¦å‰–æ</strong>ï¼šæ‰€æœ‰çš„JOINä¼˜åŒ–ï¼Œå…¶æ ¸å¿ƒæ€æƒ³éƒ½æ˜¯ <strong>â€œå°½æ—©è¿‡æ»¤ï¼Œå‡å°‘ä¸­é—´æ•°æ®é‡â€</strong> ã€‚ç†Ÿç»ƒä½¿ç”¨<code>EXPLAIN</code>æŸ¥çœ‹è¿æ¥ç±»å‹ï¼ˆå¦‚<code>eq_ref</code>å¾ˆå¥½ï¼Œ<code>Using join buffer</code>è¯´æ˜å¯èƒ½éœ€è¦ç´¢å¼•ï¼‰æ˜¯å…³é”®ã€‚</p>
<h2 data-id="heading-15">08 ç”¨æˆ·è‡ªå®šä¹‰å˜é‡</h2>
<p>MySQLå…è®¸ä½ å®šä¹‰ç”¨æˆ·å˜é‡ï¼ˆå¦‚<code>@rank</code>ï¼‰ï¼Œè¿™åœ¨ä¸€äº›éœ€è¦<strong>è·¨è¡Œè®¡ç®—æˆ–è®°å½•ä¸­é—´çŠ¶æ€</strong>çš„åˆ†æä¸­éå¸¸æœ‰ç”¨ã€‚</p>
<h3 data-id="heading-16">å®æˆ˜æ¡ˆä¾‹ï¼šè®¡ç®—è¡Œé—´å·®å€¼</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- è®¡ç®—æ¯æ—¥é”€å”®é¢çš„æ—¥ç¯æ¯”å¢é•¿ç‡</span>
<span class="hljs-keyword">SELECT</span> 
    sale_date,
    daily_amount,
    <span class="hljs-comment">-- ä½¿ç”¨å˜é‡è®°å½•å‰ä¸€å¤©çš„å€¼</span>
    <span class="hljs-variable">@prev</span>_amount <span class="hljs-keyword">as</span> prev_day_amount,
    ROUND( (daily_amount <span class="hljs-operator">-</span> <span class="hljs-variable">@prev</span>_amount) <span class="hljs-operator">/</span> <span class="hljs-variable">@prev</span>_amount <span class="hljs-operator">*</span> <span class="hljs-number">100</span>, <span class="hljs-number">2</span>) <span class="hljs-keyword">as</span> growth_rate,
    <span class="hljs-comment">-- å°†å½“å‰å€¼èµ‹ç»™å˜é‡ï¼Œä¾›ä¸‹ä¸€è¡Œä½¿ç”¨</span>
    <span class="hljs-variable">@prev</span>_amount :<span class="hljs-operator">=</span> daily_amount
<span class="hljs-keyword">FROM</span> 
    daily_sales_summary,
    (<span class="hljs-keyword">SELECT</span> <span class="hljs-variable">@prev</span>_amount :<span class="hljs-operator">=</span> <span class="hljs-number">0</span>) init <span class="hljs-comment">-- åˆå§‹åŒ–å˜é‡</span>
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> sale_date;
</code></pre>
<p><strong>æ·±åº¦å‰–æ</strong>ï¼šç”¨æˆ·å˜é‡æä¾›äº†è¿‡ç¨‹å¼ç¼–ç¨‹çš„èƒ½åŠ›ï¼Œå¯ä»¥æ¨¡æ‹Ÿçª—å£å‡½æ•°çš„éƒ¨åˆ†åŠŸèƒ½ï¼ˆåœ¨MySQL 8.0ä¹‹å‰ï¼‰ã€‚</p>
<p>ä½†å®ƒ<strong>ä¸æ˜¯SQLæ ‡å‡†</strong>ï¼Œæ‰§è¡Œé¡ºåºæœ‰æ—¶åç›´è§‰ï¼Œéœ€è°¨æ…ä½¿ç”¨ã€‚</p>
<p>åœ¨å¤æ‚çš„ä¼šè¯æˆ–äº‹åŠ¡ä¸­ï¼Œå˜é‡çš„ç”Ÿå‘½å‘¨æœŸå’Œä½œç”¨åŸŸä¹Ÿéœ€è¦ä»”ç»†è€ƒé‡ã€‚</p>
<h2 data-id="heading-17">09 åœ¨çº¿DDLä¸æ— é”å˜æ›´</h2>
<p>åœ¨ä¸šåŠ¡7x24å°æ—¶è¿è¡Œçš„æ—¶ä»£ï¼Œç»™å¤§è¡¨åŠ å­—æ®µã€æ”¹ç´¢å¼•å†ä¹Ÿä¸èƒ½éšæ„åœæœåŠ¡äº†ã€‚</p>
<p>MySQL 5.6+æä¾›äº†<code>ALGORITHM</code>å’Œ<code>LOCK</code>é€‰é¡¹ï¼Œå®ç°<strong>åœ¨çº¿DDL</strong>ï¼ˆOnline Data Definitionï¼‰ã€‚</p>
<h3 data-id="heading-18">å®‰å…¨æ“ä½œæŒ‡å—</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- æ·»åŠ ä¸€ä¸ªå¯ä¸ºç©ºä¸”æœ‰é»˜è®¤å€¼çš„æ–°åˆ—ï¼Œä½¿ç”¨INPLACEç®—æ³•å’Œå°½é‡ä½çš„é”çº§åˆ«</span>
<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> huge_table 
<span class="hljs-keyword">ADD</span> <span class="hljs-keyword">COLUMN</span> new_column <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">''</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
ALGORITHM<span class="hljs-operator">=</span>INPLACE, <span class="hljs-comment">-- å°½é‡ä½¿ç”¨INPLACEï¼ˆåŸåœ°é‡å»ºï¼‰ï¼Œé¿å…COPYï¼ˆé”è¡¨å¤åˆ¶ï¼‰</span>
LOCK<span class="hljs-operator">=</span><span class="hljs-keyword">NONE</span>; <span class="hljs-comment">-- ç›®æ ‡ï¼šä¸åŠ é”ï¼Œæˆ–å…±äº«é”</span>

<span class="hljs-comment">-- ä¿®æ”¹åˆ—ç±»å‹ï¼ˆæŸäº›æƒ…å†µéœ€è¦COPYï¼Œä¼šé”è¡¨ï¼‰</span>
<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> huge_table 
MODIFY <span class="hljs-keyword">COLUMN</span> old_column <span class="hljs-type">BIGINT</span>,
ALGORITHM<span class="hljs-operator">=</span><span class="hljs-keyword">COPY</span>, <span class="hljs-comment">-- æ³¨æ„ï¼šè¿™é‡Œå¯èƒ½å¿…é¡»ç”¨COPY</span>
LOCK<span class="hljs-operator">=</span>SHARED;
</code></pre>
<p><strong>æ·±åº¦å‰–æ</strong>ï¼š<code>ALGORITHM=INPLACE</code>æ„å‘³ç€å¤§éƒ¨åˆ†å·¥ä½œï¼ˆå¦‚é‡å»ºç´¢å¼•ï¼‰åœ¨å¼•æ“å†…éƒ¨å®Œæˆï¼Œå…è®¸å¹¶å‘DMLæ“ä½œã€‚</p>
<p>è€Œ<code>ALGORITHM=COPY</code>ä¼šåˆ›å»ºæ–°è¡¨å¹¶å¤åˆ¶æ•°æ®ï¼Œå…¨ç¨‹é”è¡¨ã€‚</p>
<p>æ‰§è¡Œå‰åŠ¡å¿…ç”¨<code>ALGORITHM=DEFAULT</code>å…ˆæµ‹è¯•ä¸€ä¸‹ã€‚</p>
<p><strong>pt-online-schema-change</strong> æ˜¯Perconaæä¾›çš„ç¬¬ä¸‰æ–¹å·¥å…·ï¼Œé€šè¿‡è§¦å‘å™¨å®ç°çœŸæ­£çš„å…¨ç¨‹æ— é”ï¼Œæ˜¯æ›´ç¨³å¦¥çš„é€‰æ‹©ã€‚</p>
<h2 data-id="heading-19">10 åˆ©ç”¨ç”Ÿæˆåˆ—ä¸å‡½æ•°ç´¢å¼•</h2>
<p>ç”Ÿæˆåˆ—çš„å€¼ç”±è¡¨ä¸­å…¶ä»–åˆ—è®¡ç®—è€Œæ¥ï¼Œå¯åˆ†ä¸º<strong>è™šæ‹Ÿåˆ—ï¼ˆVIRTUALï¼Œä¸å­˜å‚¨ï¼Œè¯»å–æ—¶è®¡ç®—ï¼‰å’Œå­˜å‚¨åˆ—ï¼ˆSTOREDï¼ŒæŒä¹…åŒ–å­˜å‚¨ï¼‰</strong>ã€‚</p>
<p>è¿™ä¸ºå»ºç«‹é«˜æ•ˆçš„å‡½æ•°ç´¢å¼•é“ºå¹³äº†é“è·¯ã€‚</p>
<h3 data-id="heading-20">åº”ç”¨åœºæ™¯</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- åœºæ™¯ï¼šç»å¸¸éœ€è¦æ ¹æ® `first_name` å’Œ `last_name` è¿›è¡Œå…¨åæœç´¢</span>
<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> users 
<span class="hljs-keyword">ADD</span> <span class="hljs-keyword">COLUMN</span> full_name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">255</span>) 
GENERATED ALWAYS <span class="hljs-keyword">AS</span> (CONCAT(first_name, <span class="hljs-string">' '</span>, last_name)) STORED, <span class="hljs-comment">-- åˆ›å»ºå­˜å‚¨çš„ç”Ÿæˆåˆ—</span>
<span class="hljs-keyword">ADD</span> INDEX idx_full_name (full_name); <span class="hljs-comment">-- åœ¨ç”Ÿæˆåˆ—ä¸Šå»ºç«‹ç´¢å¼•</span>

<span class="hljs-comment">-- ç°åœ¨ï¼Œä»¥ä¸‹æŸ¥è¯¢å¯ä»¥é«˜æ•ˆä½¿ç”¨ç´¢å¼•</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> full_name <span class="hljs-operator">=</span> <span class="hljs-string">'John Doe'</span>;
</code></pre>
<p><strong>æ·±åº¦å‰–æ</strong>ï¼šè¿™è§£å†³äº†ç›´æ¥åœ¨è¡¨è¾¾å¼ï¼ˆå¦‚<code>CONCAT(first_name, â€˜ â€˜, last_name)</code>ï¼‰ä¸Šå»ºç«‹å‡½æ•°ç´¢å¼•çš„éš¾é¢˜ã€‚</p>
<p>è™šæ‹Ÿåˆ—èŠ‚çœç©ºé—´ä½†å¢åŠ CPUè®¡ç®—å¼€é”€ï¼›å­˜å‚¨åˆ—åä¹‹ã€‚</p>
<p>æ›´å¤šé¡¹ç›®å®æˆ˜åœ¨é¡¹ç›®å®æˆ˜ç½‘ï¼š<a href="https://link.juejin.cn/?target=http%3A%2F%2Fsusan.net.cn%2Fproject" title="https://link.juejin.cn/?target=http%3A%2F%2Fsusan.net.cn%2Fproject" target="_blank">javaçªå‡»é˜Ÿ</a></p>
<h2 data-id="heading-21">æ€»ç»“ï¼šä»â€œä¼šç”¨â€åˆ°â€œç²¾é€šâ€çš„è·ƒè¿</h2>
<p>å¥½äº†ï¼Œä¸€å£æ°”èŠäº†11ä¸ªMySQLçš„é«˜çº§ç”¨æ³•ã€‚è®©æˆ‘ä»¬æœ€åå†æ¢³ç†ä¸€ä¸‹ï¼Œè¿™äº›æŠ€å·§å¹¶éå­¤ç«‹å­˜åœ¨ï¼Œå®ƒä»¬æ„æˆäº†ä¸€ä¸ªåº”å¯¹ä¸åŒåœºæ™¯æŒ‘æˆ˜çš„å·¥å…·ç®±ã€‚</p>




























































<table><thead><tr><th align="left">é«˜çº§ç”¨æ³•</th><th align="left">æ ¸å¿ƒè§£å†³ç—›ç‚¹</th><th align="left">æ¨èé€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td align="left"><strong>æ‰§è¡Œè®¡åˆ’(EXPLAIN)</strong></td><td align="left">æ€§èƒ½ç“¶é¢ˆå¯è§†åŒ–</td><td align="left"><strong>æ‰€æœ‰</strong>æ…¢æŸ¥è¯¢ä¼˜åŒ–å‰çš„ç¬¬ä¸€æ­¥</td></tr><tr><td align="left"><strong>é«˜çº§ç´¢å¼•ç­–ç•¥</strong></td><td align="left">æŸ¥è¯¢é€Ÿåº¦æ…¢ï¼Œå†™æ“ä½œé‡</td><td align="left">é«˜é¢‘æŸ¥è¯¢ã€å¤§è¡¨æ€§èƒ½ä¼˜åŒ–</td></tr><tr><td align="left"><strong>çª—å£å‡½æ•°(Window)</strong></td><td align="left">å¤æ‚è·¨è¡Œè®¡ç®—æ•ˆç‡ä½</td><td align="left">æ’è¡Œæ¦œã€æ•°æ®åˆ†æã€æŠ¥è¡¨</td></tr><tr><td align="left"><strong>é€šç”¨è¡¨è¡¨è¾¾å¼(CTE)</strong></td><td align="left">å¤æ‚SQLéš¾è¯»å†™ï¼Œæ ‘æŸ¥è¯¢éš¾</td><td align="left">å¤æ‚ä¸šåŠ¡é€»è¾‘æ‹†åˆ†ï¼Œå±‚æ¬¡æ•°æ®æŸ¥è¯¢</td></tr><tr><td align="left"><strong>JSONç±»å‹</strong></td><td align="left">åŠ¨æ€ã€åŠç»“æ„åŒ–æ•°æ®å­˜å‚¨ä¸æŸ¥è¯¢</td><td align="left">é…ç½®ã€åŠ¨æ€å±æ€§ã€APIæ•°æ®å­˜å‚¨</td></tr><tr><td align="left"><strong>åˆ†åŒºè¡¨</strong></td><td align="left">è¶…å¤§è¡¨ç»´æŠ¤éš¾ï¼Œå†å²æ•°æ®æ¸…ç†æ…¢</td><td align="left">æ—¶é—´åºåˆ—æ•°æ®ï¼ˆæ—¥å¿—ã€è®¢å•ï¼‰</td></tr><tr><td align="left"><strong>JOIN/å­æŸ¥è¯¢ä¼˜åŒ–</strong></td><td align="left">å¤šè¡¨å…³è”æ€§èƒ½ä½ä¸‹</td><td align="left">æ¶‰åŠå¤šä¸ªä¸šåŠ¡å®ä½“çš„å¤æ‚æŸ¥è¯¢</td></tr><tr><td align="left"><strong>ç”¨æˆ·è‡ªå®šä¹‰å˜é‡</strong></td><td align="left">éœ€è¡Œé—´è®¡ç®—æˆ–çŠ¶æ€ä¿æŒï¼ˆ8.0å‰ï¼‰</td><td align="left">è‡ªå®šä¹‰åºåˆ—ã€å·®å€¼è®¡ç®—ï¼ˆæœ‰çª—å£å‡½æ•°åä¼˜å…ˆçº§é™ä½ï¼‰</td></tr><tr><td align="left"><strong>åœ¨çº¿DDL</strong></td><td align="left">ä¸šåŠ¡ä¸ä¸­æ–­å˜æ›´è¡¨ç»“æ„</td><td align="left">7x24å°æ—¶ç³»ç»Ÿè¡¨ç»“æ„å˜æ›´</td></tr><tr><td align="left"><strong>ç”Ÿæˆåˆ—/å‡½æ•°ç´¢å¼•</strong></td><td align="left">æ— æ³•ç›´æ¥å¯¹è¡¨è¾¾å¼å»ºç´¢å¼•</td><td align="left">åŸºäºJSONå­—æ®µã€è®¡ç®—å­—æ®µçš„é«˜æ•ˆæŸ¥è¯¢</td></tr></tbody></table>
<p>æœ‰äº›å°ä¼™ä¼´åœ¨å·¥ä½œä¸­å¯èƒ½ä¼šæœ‰è¿™æ ·çš„ç–‘é—®ï¼šâ€œæˆ‘çŸ¥é“å®ƒä»¬å¥½ï¼Œä½†è¯¥ä»å“ªé‡Œå¼€å§‹å­¦èµ·å‘¢ï¼Ÿâ€</p>
<p>æˆ‘çš„å»ºè®®æ˜¯ï¼š<strong>ä»<code>EXPLAIN</code>å’Œ<code>ç´¢å¼•ä¼˜åŒ–</code>å¼€å§‹</strong>ã€‚</p>
<p>è¿™æ˜¯æ€§èƒ½é—®é¢˜çš„æ ¹æœ¬ã€‚</p>
<p>ç„¶åï¼Œæ ¹æ®ä½ çš„ä¸šåŠ¡éœ€æ±‚ï¼Œå¼•å…¥<code>çª—å£å‡½æ•°</code>æˆ–<code>CTE</code>æ¥ç®€åŒ–å¤æ‚æŸ¥è¯¢ã€‚å½“æ•°æ®é‡ä¸Šæ¥åï¼Œè€ƒè™‘<code>åˆ†åŒº</code>ã€‚</p>
<p>å¯¹äºåŠ¨æ€æ•°æ®ç»“æ„ï¼Œå°è¯•<code>JSON</code>ç±»å‹ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Spring æºç åˆ†æ AOP çš„å®ç°åŸç†]]></title>    <link>https://juejin.cn/post/7604522883487318050</link>    <guid>https://juejin.cn/post/7604522883487318050</guid>    <pubDate>2026-02-10T02:10:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604522883487318050" data-draft-id="7601069677567410222" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Spring æºç åˆ†æ AOP çš„å®ç°åŸç†"/> <meta itemprop="keywords" content="Spring,Spring Boot,Java"/> <meta itemprop="datePublished" content="2026-02-10T02:10:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æš®è‰²å¦–å¨†ä¸¶"/> <meta itemprop="url" content="https://juejin.cn/user/4292946760307655"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Spring æºç åˆ†æ AOP çš„å®ç°åŸç†
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4292946760307655/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æš®è‰²å¦–å¨†ä¸¶
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T02:10:48.000Z" title="Tue Feb 10 2026 02:10:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»12åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å‰è¨€</h2>
<h2 data-id="heading-1">AOP çš„æ¦‚å¿µ</h2>
<p><code>AOP</code> çš„å…¨ç§°æ˜¯ <code>Aspect-OrientedÂ Programming</code> é¢å‘åˆ‡é¢ç¼–ç¨‹ï¼Œé€šå¸¸åœ¨æˆ‘ä»¬æ—¥å¸¸å¼€å‘ä¸­çš„æ¨¡å¼éƒ½æ˜¯æ–¹æ³•ç›´æ¥å®ç°å®Œæ•´åŠŸèƒ½ã€‚ä½†æœ‰æ—¶å€™æˆ‘ä»¬å¸Œæœ›åœ¨æŸä¸€ä¸ªæˆ–å¤šä¸ªåŠŸèƒ½æ–¹æ³•ä¸­åŠ å…¥ä¸€äº›é€šç”¨çš„å…¶ä»–é€»è¾‘ï¼Œä½†æ˜¯åˆä¸å¸Œæœ›ä¿®æ”¹è¿™ä¸€æ‰¹æ–¹æ³•çš„æºä»£ç ï¼Œä¹Ÿä¸å¸Œæœ›ä¿®æ”¹è°ƒç”¨è¿™æ‰¹æ–¹æ³•çš„æ–¹æ³•çš„æºä»£ç ï¼Œå¯¼è‡´ä¸€å¤§å †é‡å¤ä»£ç ã€‚äºæ˜¯ <code>AOP</code> å°±è¯ç”Ÿäº†ã€‚<code>AOP</code> çš„ä½œç”¨å¯ä»¥ç†è§£ä¸ºä¸‹å›¾</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c88de1bc118f490cac334029a7f1d0f3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pqu6Imy5aaW5aiG5Li2:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771294248&amp;x-signature=CSroo%2Fd8VPUTiVFF46Ck1VSTBF4%3D" alt="image.png" loading="lazy"/></p>
<p>åœ¨æ‰§è¡Œç›®æ ‡æ–¹æ³•å‰åæ·»åŠ ä¸€äº›é¢å¤–çš„é€»è¾‘ã€‚æœ€ç»å…¸çš„å®ç°æ˜¯ <code>AspectJ</code> æ¡†æ¶</p>
<h2 data-id="heading-2">AOP çš„ä»£è¡¨ä½œ AspectJ</h2>
<p>åœ¨ <code>Java</code> é¢†åŸŸä¸­ï¼Œ <code>AspectJ</code> æ˜¯æœ€æ—©ã€æœ€å®Œæ•´ã€åŠŸèƒ½æœ€å¼ºå¤§çš„ä¸€ä¸ª <code>AOP</code> æ¡†æ¶ã€‚å‰é¢æˆ‘ä»¬è¯´äº† <code>AOP</code> çš„æ€æƒ³æ˜¯åœ¨æ–¹æ³•æ‰§è¡Œå‰ååŠ å…¥ä¸€äº›è‡ªå®šä¹‰é€»è¾‘ï¼Œé‚£ä¹ˆåˆ°åº•æ€ä¹ˆåŠ å‘¢ï¼Ÿ<code>AspectJ</code> æä¾›äº†ä¸¤ç§æ–¹å¼ï¼šç¼–è¯‘æœŸç»‡å…¥å’Œè¿è¡Œæ—¶ç»‡å…¥ã€‚ä¸‹é¢æˆ‘ä»¬å…ˆçœ‹ä»£ç ç¤ºä¾‹ï¼Œä½¿ç”¨ <code>AspectJ</code> å¦‚ä½•å®ç° <code>AOP</code> ç¼–ç¨‹</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fyanzhisishui%2Faspectj-test.git" target="_blank" title="https://github.com/yanzhisishui/aspectj-test.git" ref="nofollow noopener noreferrer">ç¤ºä¾‹æºç å·²åˆ†äº«åˆ° Github</a></p>
<p>ç›®æ ‡ç±»</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test1</span><span class="hljs-params">()</span>{
        System.out.println(<span class="hljs-string">"test1 started!"</span>);
    }
}
</code></pre>
<p>åˆ‡é¢ç±»</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Aspect</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserServiceAspect</span> {
    <span class="hljs-meta">@Before("execution(* com.example.UserService.test1())")</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">before</span><span class="hljs-params">()</span>{
        System.out.println(<span class="hljs-string">"before test1!"</span>);
    }
}
</code></pre>
<p>è¿™é‡Œ <code>@Before</code> æ³¨è§£çš„å€¼å«åš <code>åˆ‡ç‚¹è¡¨è¾¾å¼</code>ï¼Œå®ƒæè¿°äº†æˆ‘ä»¬å°†è¦æ‹¦æˆªå“ªäº›ç›®æ ‡æ–¹æ³•æ‰§è¡Œå½“å‰çš„å¢å¼ºé€»è¾‘</p>
<h3 data-id="heading-3">ç¼–è¯‘æœŸç»‡å…¥</h3>
<p>ç¼–è¯‘æœŸç»‡å…¥éœ€è¦ç‰¹å®šçš„ç¼–è¯‘æ’ä»¶ã€‚åœ¨ <code>pom.xml</code> ä¸­æ·»åŠ ä¸‹é¢è¿™ä¸ªæ’ä»¶</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.codehaus.mojo<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>aspectj-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.14.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">complianceLevel</span>&gt;</span>16.0<span class="hljs-tag">&lt;/<span class="hljs-name">complianceLevel</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">source</span>&gt;</span>16<span class="hljs-tag">&lt;/<span class="hljs-name">source</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">target</span>&gt;</span>16<span class="hljs-tag">&lt;/<span class="hljs-name">target</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">executions</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">execution</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">goals</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">goal</span>&gt;</span>compile<span class="hljs-tag">&lt;/<span class="hljs-name">goal</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">goals</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">execution</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">executions</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span>
</code></pre>
<p>æœ‰äº†è¿™ä¸ªæ’ä»¶ä¹‹åï¼Œ<code>maven</code> å·¥å…·æ é‡Œé¢å°±ä¼šå¤šä¸€ä¸ªå·¥å…·</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/89f54ac3b880443b90a8499fba610b40~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pqu6Imy5aaW5aiG5Li2:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771294248&amp;x-signature=wLyOqO35o4MHa2QII2hRI0MglDk%3D" alt="image.png" loading="lazy"/></p>
<p>è¿è¡Œå®ƒä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥ç›´è§‚çš„çœ‹åˆ° <code>target/classes</code> æ–‡ä»¶å¤¹ä¸‹ç›®æ ‡ç±»çš„æ–¹æ³•å·²ç»å˜äº†</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/baefc08982cb4b83b6ab77496409ee26~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pqu6Imy5aaW5aiG5Li2:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771294248&amp;x-signature=05ymz3iunsnalx6XYSPpEwUJ5I8%3D" alt="image.png" loading="lazy"/></p>
<p>å®é™…ä¸šåŠ¡ä¸­è¿™ç§æ–¹å¼ä½¿ç”¨å¾ˆå°‘ï¼Œè¿™é‡Œåªæ˜¯ä¸ºäº†åç»­ç†è§£ <code>Spring AOP</code> ã€‚</p>
<h3 data-id="heading-4">è¿è¡Œæ—¶ç»‡å…¥</h3>
<p>è¿è¡Œæ—¶ç»‡å…¥æ˜¯åŸºäº <code>Java agent</code> æŠ€æœ¯ã€‚å®ƒå…è®¸åœ¨ <code>JVM</code> å¯åŠ¨æ—¶æˆ–è¿è¡Œæ—¶ <strong>åŠ¨æ€ä¿®æ”¹å·²åŠ è½½æˆ–å³å°†åŠ è½½çš„ç±»çš„å­—èŠ‚ç </strong>ã€‚å¯¹äºä¸Šé¢çš„ç¤ºä¾‹ï¼Œä¹Ÿå°±æ˜¯è¯´è¿è¡Œæ—¶æŠŠ <code>UserService</code> çš„ <code>class</code> æ–‡ä»¶æ”¹äº†ï¼Œå…¶å®å°±æ˜¯æ”¹æˆäº†ä¸Šé¢ç¼–è¯‘ç»‡å…¥åçš„ <code>class</code> æ–‡ä»¶ä¸€æ ·ã€‚åªä¸è¿‡è¿™æ˜¯åŸºäº <code>Java agent</code> æŠ€æœ¯ <strong>è¿è¡Œæ—¶</strong> å®ç°çš„</p>
<p>åœ¨ <code>JVM</code> å¯åŠ¨å‚æ•°æ·»åŠ ä¸‹é¢å†…å®¹ï¼Œ<code>aspectjweaver-1.9.25.jar</code> çš„è·¯å¾„æ¢æˆè‡ªå·±å®é™…çš„åœ°å€å³å¯</p>
<pre><code class="hljs language-diff" lang="diff"><span class="hljs-deletion">-javaagent:C:\Users\14812.m2\repository\org\aspectj\aspectjweaver\1.9.25\aspectjweaver-1.9.25.jar</span>
</code></pre>
<blockquote>
<p>å…³äº Java Agent æŠ€æœ¯ä¹ŸæŒºç¥å¥‡ï¼Œåœ¨è¿è¡Œç¨‹åºåä¼šå…ˆæ‰§è¡Œ <code>aspectjweaver-1.9.25.jar</code> ä¸‹ <code>META-INF/MANIFEST.MF</code> ä¸­æŒ‡å®šçš„ä¸€ä¸ªç±» <code>Premain-Class</code></p>
</blockquote>
<h3 data-id="heading-5">åˆ‡ç‚¹ã€åˆ‡é¢ã€è¿æ¥ç‚¹ã€é€šçŸ¥</h3>
<p>æœ‰äº†ä¸Šé¢çš„æ¡ˆä¾‹ï¼Œæˆ‘ä»¬å†æ¥ç†è§£ <code>AOP</code> æ€æƒ³ä¸­æ ¸å¿ƒçš„å‡ ä¸ªæ¦‚å¿µï¼Œè¿™å¯¹äºæˆ‘ä»¬åç»­ç†è§£ <code>Spring AOP</code> éå¸¸é‡è¦ã€‚</p>
<ul>
<li>åˆ‡é¢ï¼šç›®æ ‡ç±»çš„æ¨ªåˆ‡å¢å¼ºï¼Œæ˜¯æ¨ªåˆ‡å¢å¼ºçš„å®Œæ•´å°è£…å•å…ƒï¼ŒåŒ…å«äº†å¯ä»¥å¯¹ç›®æ ‡ç±»æ‰€æœ‰å¢å¼º</li>
<li>è¿æ¥ç‚¹ï¼šç¨‹åºæ‰§è¡Œçš„æ‰€æœ‰æ½œåœ¨æ‹¦æˆªç‚¹ï¼Œå¯ä»¥ç†è§£ä¸ºç›®æ ‡ç±»ä¸­æ‰€æœ‰çš„å†…å®¹ï¼ŒåŒ…æ‹¬æ–¹æ³•ã€å­—æ®µèµ‹å€¼æˆ–è®¿é—®ã€å¯¹è±¡åˆå§‹åŒ–ç­‰</li>
<li>åˆ‡ç‚¹ï¼šè¿æ¥ç‚¹çš„ç­›é€‰å™¨ï¼Œå®ƒçš„åˆ‡ç‚¹è¡¨è¾¾å¼èƒ½ç­›é€‰å‡ºä¸€ç³»åˆ—ç¬¦åˆçš„æ–¹æ³•</li>
<li>é€šçŸ¥ï¼šå…·ä½“æ‹¦æˆªè¡Œä¸ºï¼Œæˆ‘ä»¬æ‹¦æˆªäº†è¿™ä¸ªåˆ‡ç‚¹è¦å¹²ä»€ä¹ˆä¸šåŠ¡</li>
</ul>
<p>è¿™å››ä¸ªæ¦‚å¿µæ˜¯ <code>AOP</code> æ€æƒ³çš„é‡ä¸­ä¹‹é‡ã€‚</p>



































<table><thead><tr><th>æ¦‚å¿µ</th><th>demoç¤ºä¾‹</th><th>ä»£ç è§’è‰²</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>åˆ‡é¢</strong></td><td><code>UserServiceAspect</code> ç±»</td><td><code>@Aspect</code> ç±»</td><td><strong>å®¹å™¨</strong>ï¼Œç»„ç»‡åˆ‡ç‚¹ã€é€šçŸ¥å’Œå…¶ä»– <code>AOP</code> å…ƒç´ </td></tr><tr><td><strong>è¿æ¥ç‚¹</strong></td><td><code>UserService.test1()</code> æ–¹æ³•</td><td>ç›®æ ‡ç±»ä¸­æ‰€æœ‰çš„å†…å®¹ï¼ŒåŒ…æ‹¬æ–¹æ³•ã€å­—æ®µèµ‹å€¼ã€å¯¹è±¡åˆå§‹åŒ–</td><td><strong>å®¢è§‚å­˜åœ¨</strong>çš„å¯æ‰§è¡Œç‚¹</td></tr><tr><td><strong>åˆ‡ç‚¹</strong></td><td><code>@Before("execution(* com.example.UserService.test1())")</code></td><td><code>@Pointcut</code> å®šä¹‰ <code>@Beforeã€@Afterã€@Around</code> çš„è¡¨è¾¾å¼</td><td><strong>ç­›é€‰å™¨</strong>ï¼Œé€‰æ‹©å“ªäº›è¿æ¥ç‚¹è¦å¤„ç†</td></tr><tr><td><strong>é€šçŸ¥</strong></td><td><code>public void before(){System.out.println("before test1!");}</code></td><td><code>@Beforeã€@Afterã€@Around</code>æ ‡æ³¨çš„æ–¹æ³•</td><td><strong>æ‹¦æˆªè¡Œä¸ºï¼Œå‰ç½®ã€åç½®ã€ç¯ç»•</strong>ï¼Œåœ¨è¿æ¥ç‚¹æ‰§è¡Œçš„ä»£ç </td></tr></tbody></table>
<h3 data-id="heading-6">AspectJ çš„å¼ºå¤§ä¹‹å¤„ï¼Œä¸‡ç‰©çš†å¯æ‹¦æˆª</h3>
<p>æ­£å¦‚æˆ‘ä»¬ä¸Šé¢å¯¹è¿æ¥ç‚¹çš„æè¿°ã€‚<code>AspectJ</code> ä¸ä»…èƒ½æ‹¦æˆªæ–¹æ³•ï¼Œç”šè‡³è¿˜èƒ½æ‹¦æˆªå­—æ®µçš„è®¾ç½®ã€å­—æ®µçš„è®¿é—®ã€å¯¹è±¡åˆå§‹åŒ–ç­‰ç­‰ã€‚éƒ½æ˜¯é€šè¿‡åˆ‡ç‚¹è¡¨è¾¾å¼æ¥å®ç°ï¼Œåˆ‡ç‚¹è¡¨è¾¾å¼çš„å†™æ³•éå¸¸ä¸°å¯Œã€‚<code>demo</code> ç¤ºä¾‹ä¸­æ¼”ç¤ºäº†å­—æ®µè®¿é—®çš„æ‹¦æˆªï¼Œç”±äºå·¥ä½œä¸­å‡ ä¹ç”¨ä¸åˆ°ï¼Œæ‰€ä»¥å…¶ä»–å†…å®¹è¿™é‡Œå°±ä¸ä¸€ä¸€ä»‹ç»äº†ï¼Œæœ‰å…´è¶£å¯ä»¥è‡ªå·±æ¢ç´¢ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 1. æ‹¦æˆª User.name å­—æ®µçš„è¯»å–</span>
<span class="hljs-meta">@Before("get(private String com.example.UserService.name)")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">beforeReadName</span><span class="hljs-params">(JoinPoint jp)</span> {
    System.out.println(<span class="hljs-string">"ã€å­—æ®µè¯»ã€‘æ­£åœ¨è¯»å– User.name å­—æ®µ"</span>);
    System.out.println(<span class="hljs-string">"  ç›®æ ‡å¯¹è±¡: "</span> + jp.getTarget());
    System.out.println(<span class="hljs-string">"  åœ¨ç±»ä¸­: "</span> + jp.getSourceLocation());
}

<span class="hljs-comment">// 1. æ‹¦æˆª User.name å­—æ®µçš„èµ‹å€¼</span>
<span class="hljs-meta">@Before("set(private String com.example.UserService.name)")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">beforeSetName</span><span class="hljs-params">(JoinPoint jp)</span> {
    System.out.println(<span class="hljs-string">"ã€å­—æ®µè¯»ã€‘æ­£åœ¨è®¾ç½® User.name å­—æ®µ"</span>);
    System.out.println(<span class="hljs-string">"  ç›®æ ‡å¯¹è±¡: "</span> + jp.getTarget());
    System.out.println(<span class="hljs-string">"  åœ¨ç±»ä¸­: "</span> + jp.getSourceLocation());
}
</code></pre>
<h2 data-id="heading-7">SpringBoot é¡¹ç›®ä¸­ä½¿ç”¨ AspectJ</h2>
<h3 data-id="heading-8">Spring ä¸­çš„ AOP å®˜ç½‘ä»‹ç»</h3>
<p>åœ¨ <code>Spring</code> ä¸­ï¼Œé›†æˆäº† <code>AspectJ</code> æ¡†æ¶ï¼Œ<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.spring.io%2Fspring-framework%2Freference%2F6.1%2Fcore%2Faop%2Fintroduction-spring-defn.html" target="_blank" title="https://docs.spring.io/spring-framework/reference/6.1/core/aop/introduction-spring-defn.html" ref="nofollow noopener noreferrer">Spring AOP å®˜ç½‘æè¿°</a> æœ‰ä¸€æ®µæ˜¯è¿™ä¹ˆè¯´çš„ï¼š</p>
<blockquote>
<p>Spring AOP never strives to compete with AspectJ to provide a comprehensive AOP solution. We believe that both proxy-based frameworks such as Spring AOP and full-blown frameworks such as AspectJ are valuable and that they are complementary, rather than in competition. Spring seamlessly integrates Spring AOP and IoC with AspectJ, to enable all uses of AOP within a consistent Spring-based application architecture. This integration does not affect the Spring AOP API or the AOP Alliance API. Spring AOP remains backward-compatible.</p>
</blockquote>
<p>å¯ä»¥è‡ªè¡Œç¿»è¯‘ã€‚<code>Spring</code> ä¿ç•™äº†åŸç”Ÿ <code>AspectJ</code> çš„ç¼–ç¨‹ç”¨æ³•ï¼Œä½†æ˜¯å®ç°åŸç†ä¸åŒï¼Œ<code>AspectJ</code> è¿è¡Œæ—¶å¢å¼ºé€šè¿‡ <code>Java agent</code> å®ç°ï¼Œ<code>Spring AOP</code> æ˜¯é€šè¿‡åŠ¨æ€ä»£ç†å®ç°ã€‚å…³äºåŠ¨æ€ä»£ç†å¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç«  <a href="https://juejin.cn/post/7387657842114134068" target="_blank" title="https://juejin.cn/post/7387657842114134068">å­¦ä¹  Java åŠ¨æ€ä»£ç†</a> ã€‚</p>
<h3 data-id="heading-9">ä½¿ç”¨ç¤ºä¾‹</h3>
<p>å’Œä¸Šä¸€æ®µçš„é <code>Spring</code> é¡¹ç›® <code>Aspect</code> ç¤ºä¾‹å®Œå…¨ç›¸åŒï¼Œåªè¦åœ¨ <code>UserService</code> å’Œ <code>UserServiceAspect</code> ç±»ä¸Šé¢åŠ ä¸Š <code>@Component</code> æ³¨è§£ï¼Œäº¤ç»™ <code>Spring</code> ç®¡ç†å³å¯ã€‚å¦‚æœä½¿ç”¨é <code>SpringBoot</code> é¡¹ç›®ï¼Œè¿˜éœ€è¦ä¸€ä¸ªé…ç½®ç±»ï¼Œå¯ç”¨æ³¨è§£ <code>@EnableAspectJAutoProxy</code> ã€‚å¦‚æœæ˜¯ <code>SpringBoot</code> é¡¹ç›®ï¼Œæˆ‘ä»¬å¼•å…¥ <code>aop-starter</code> å³å¯</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-aop<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>compile<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<p><code>AopAutoConfiguration</code> ä¼šè‡ªåŠ¨é…ç½®å¯ç”¨<code>@EnableAspectJAutoProxy</code>ï¼Œé‚£ä¹ˆåªéœ€è¦æŠŠæˆ‘ä»¬ä¸¤ä¸ªç±» <code>UserService</code> å’Œ <code>UserServiceAspect</code> äº¤ç»™ <code>Sping</code> ç®¡ç†å³å¯å®ç°ã€‚</p>
<h2 data-id="heading-10">Spring ä¸­å¯¹äºä»£ç†çš„æŠ½è±¡è®¾è®¡</h2>
<p><code>Spring</code> ä¸­å¯¹äºä»£ç†ä¸­çš„å‡ ä¸ªæ¦‚å¿µä¾‹å¦‚ é€šçŸ¥ã€åˆ‡ç‚¹ã€è¿æ¥çš„ã€åˆ‡é¢åšäº†ä¸€äº›æŠ½è±¡è®¾è®¡ã€‚</p>



































<table><thead><tr><th>æ¦‚å¿µ</th><th>æ¥å£</th><th>æè¿°</th><th>ä¸»è¦å®ç°ç±»</th></tr></thead><tbody><tr><td><strong>åˆ‡ç‚¹</strong></td><td>org.springframework.aop.Pointcut</td><td>åœ¨å“ªé‡Œåº”ç”¨é€šçŸ¥ï¼Œå…·ä½“æ‹¦æˆªè¡Œä¸ºå‘ç”Ÿåœ¨å“ªé‡Œï¼Œä»…æ”¯æŒæ–¹æ³•åˆ‡ç‚¹</td><td>AspectJExpressionPointcut</td></tr><tr><td><strong>é€šçŸ¥</strong></td><td>org.aopalliance.aop.Advice</td><td>å¢å¼ºè¡Œä¸ºçš„ç»Ÿä¸€æŠ½è±¡ï¼Œè¡¨ç¤ºå…·ä½“å¢å¼ºé€»è¾‘æ˜¯ä»€ä¹ˆ</td><td>BeforeAdviceã€MethodInterceptor</td></tr><tr><td><strong>åˆ‡é¢</strong></td><td>org.springframework.aop.Advisor</td><td>åœ¨ Spring AOP ä¸­é€šå¸¸æ˜¯åŒ…å«åˆ‡ç‚¹å’Œé€šçŸ¥çš„å°è£…</td><td>InstantiationModelAwarePointcutAdvisor</td></tr><tr><td><strong>è¿æ¥ç‚¹</strong></td><td>org.aopalliance.intercept.Joinpoint</td><td>å¯è®¿é—®å¯¹è±¡ï¼ˆæ–¹æ³•ï¼‰çš„è®¿é—®çš„å…·ä½“åŒ–</td><td>ReflectiveMethodInvocation</td></tr></tbody></table>
<p>è¿™é‡Œéœ€è¦ç±»æ¯”å‰é¢æˆ‘ä»¬åœ¨ <code>AspectJ</code> é‚£æ®µå…³äºè¿™å‡ ä¸ªæ¦‚å¿µçš„è¡¨æ ¼ï¼Œåœ¨ <code>Spring AOP</code> ä¸­è¿™äº›æ¦‚å¿µéƒ½æœ‰ç»Ÿä¸€çš„æŠ½è±¡å’Œå…·ä½“çš„å®ç°ã€‚</p>
<h2 data-id="heading-11">ä»£ç†ç±»çš„åˆ›å»ºè¿‡ç¨‹</h2>
<p>æ ¹æ®æˆ‘ä»¬å‰é¢çš„æ–‡ç«  <code>Bean çš„åˆ›å»ºè¿‡ç¨‹æºç åˆ†æ</code> æˆ‘ä»¬çŸ¥é“ï¼Œä»£ç†ç±»çš„åˆ›å»ºå‘ç”Ÿåœ¨ <code>BeanPostProcessor.postProcessAfterInitialization()</code>ã€‚è¿™é‡Œæœ‰ä¸€ä¸ªé‡è¦çš„å®ç°ç±» <code>AnnotationAwareAspectJAutoProxyCreator</code> ã€‚å®ƒè°ƒç”¨çˆ¶ç±» <code>AbstractAutoProxyCreator.wrapIfNecessary()</code> çš„åˆ›å»ºä»£ç†é€»è¾‘</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">protected</span> Object <span class="hljs-title function_">wrapIfNecessary</span><span class="hljs-params">(Object bean, String beanName, Object cacheKey)</span> {
    <span class="hljs-comment">//......</span>
    <span class="hljs-comment">// è·å–è¿™ä¸ªç±»æ‰€æœ‰çš„åˆ‡é¢</span>
    Object[] specificInterceptors = getAdvicesAndAdvisorsForBean(bean.getClass(), beanName, <span class="hljs-literal">null</span>);
    <span class="hljs-keyword">if</span> (specificInterceptors != DO_NOT_PROXY) {
       <span class="hljs-built_in">this</span>.advisedBeans.put(cacheKey, Boolean.TRUE);
       <span class="hljs-comment">//åˆ›å»ºä»£ç†</span>
       <span class="hljs-type">Object</span> <span class="hljs-variable">proxy</span> <span class="hljs-operator">=</span> createProxy(bean.getClass(), beanName, specificInterceptors, <span class="hljs-keyword">new</span> <span class="hljs-title class_">SingletonTargetSource</span>(bean));
       <span class="hljs-built_in">this</span>.proxyTypes.put(cacheKey, proxy.getClass());
       <span class="hljs-keyword">return</span> proxy;
    }

    <span class="hljs-built_in">this</span>.advisedBeans.put(cacheKey, Boolean.FALSE);
    <span class="hljs-keyword">return</span> bean;
}
</code></pre>
<p>è¿™é‡Œä¼šè·å–æ‰€æœ‰è¯¥ç±»çš„å¢å¼ºé€»è¾‘ï¼Œç¤ºä¾‹ä¸­ä¹Ÿå°±æ˜¯ <code>UserServiceAspect</code>ï¼Œå¦‚æœæœ‰åˆ‡é¢å°±åˆ›å»ºä»£ç†å¯¹è±¡è¿”å›ã€‚</p>
<h3 data-id="heading-12">è·å–åˆ‡é¢</h3>
<p>ä¸€è·¯è·Ÿè¸ªæºç  <code>getAdvicesAndAdvisorsForBean()</code> æºç è¿›å»ï¼Œæœ€åå‘ç°ä¼šåœ¨ <code>org.springframework.aop.aspectj.annotation.BeanFactoryAspectJAdvisorsBuilder#buildAspectJAdvisors</code> æ–¹æ³•ä¸­éå†æ‰€æœ‰çš„ <code>beanName</code> è¿‡æ»¤å‡ºæˆ‘ä»¬çš„åˆ‡é¢ç±»ï¼Œæºç ä¸­æ‰«æ <code>@Aspect</code> åˆ¤æ–­æ˜¯å¦æ˜¯ä¸€ä¸ªåˆ‡é¢ï¼Œç„¶åæ ¹æ®åˆ‡ç‚¹è¡¨è¾¾å¼åŒ¹é…å¯¹åº”çš„ç›®æ ‡ç±»ã€‚ç„¶åéå†åˆ‡ç‚¹ï¼Œä¸ºæ¯ä¸€ä¸ªåˆ‡ç‚¹éƒ½åˆ›å»ºä¸€ä¸ª <code>Advisor</code>ï¼Œå…·ä½“ç±»å‹æ˜¯ <code>InstantiationModelAwarePointcutAdvisorImpl</code>ï¼Œéšåç¼“å­˜èµ·æ¥ã€‚</p>
<p><code>InstantiationModelAwarePointcutAdvisorImpl</code> çš„ä¸»è¦ä½œç”¨æ˜¯æ ¹æ®å…¶å†…éƒ¨çš„åˆ‡é¢å·¥å‚è·å–å…·ä½“çš„åˆ‡ç‚¹æ‹¦æˆªè¡Œä¸ºã€‚</p>
<h3 data-id="heading-13">åˆ›å»ºä»£ç†çš„æ–¹å¼</h3>
<p>åœ¨ <code>AbstractAutoProxyCreator#buildProxy()</code> ä¸­å…ˆæ„å»ºä»£ç†å·¥å‚ <code>ProxyFactory</code>ï¼Œç„¶åè°ƒç”¨ <code>ProxyFactory.getProxy()</code>ã€‚å†…éƒ¨æœ€ç»ˆä¼šæ ¹æ®ä»£ç†å·¥å‚çš„é…ç½®æ¥å†³å®šä½¿ç”¨ <code>CGLIB</code> è¿˜æ˜¯ <code>JDK</code> ä»£ç†</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> AopProxy <span class="hljs-title function_">createAopProxy</span><span class="hljs-params">(AdvisedSupport config)</span> <span class="hljs-keyword">throws</span> AopConfigException {
    <span class="hljs-comment">// config.isProxyTargetClass() åœ¨ SpringBoot ä¸­æ˜¯é»˜è®¤ä¸º true çš„</span>
    <span class="hljs-keyword">if</span> (config.isOptimize() || config.isProxyTargetClass() || !config.hasUserSuppliedInterfaces()) {
       Class&lt;?&gt; targetClass = config.getTargetClass();
       <span class="hljs-comment">//...</span>
       <span class="hljs-keyword">if</span> (targetClass == <span class="hljs-literal">null</span> || targetClass.isInterface() ||
             Proxy.isProxyClass(targetClass) || ClassUtils.isLambdaClass(targetClass)) {
          <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JdkDynamicAopProxy</span>(config);
       }
       <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjenesisCglibAopProxy</span>(config);
    }
    <span class="hljs-keyword">else</span> {
       <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JdkDynamicAopProxy</span>(config);
    }
}
</code></pre>
<h3 data-id="heading-14">SpringBoot å¼ºåˆ¶ CGLIB ä»£ç†</h3>
<p>ä¸Šä¸€æ®µåœ¨å®ä¾‹åŒ–ä»£ç†å·¥å‚çš„æ—¶å€™ä¼šæ‰§è¡Œä¸€ä¸ªå¤åˆ¶æ–¹æ³•ï¼ŒæŠŠå½“å‰å¯¹è±¡ <code>AnnotationAwareAspectJAutoProxyCreator</code> çš„ <code>proxyTargetClass</code> å±æ€§æ‹¿è¿‡æ¥ï¼Œèµ‹å€¼ç»™ä»£ç†å·¥å‚ï¼Œè€Œè¿™ä¸ªå±æ€§é»˜è®¤æ˜¯ <code>true</code>ï¼Œåé¢ä¼šä»‹ç»</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">//org.springframework.aop.framework.autoproxy.AbstractAutoProxyCreator#buildProxy</span>
<span class="hljs-keyword">private</span> Object <span class="hljs-title function_">buildProxy</span><span class="hljs-params">(Class&lt;?&gt; beanClass, <span class="hljs-meta">@Nullable</span> String beanName,<span class="hljs-meta">@Nullable</span> Object[] specificInterceptors, TargetSource targetSource, <span class="hljs-type">boolean</span> classOnly)</span> {
    <span class="hljs-comment">//......</span>
    <span class="hljs-type">ProxyFactory</span> <span class="hljs-variable">proxyFactory</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ProxyFactory</span>();
    proxyFactory.copyFrom(<span class="hljs-built_in">this</span>);
    <span class="hljs-comment">//......</span>
}

<span class="hljs-comment">//èµ‹å€¼æ–¹æ³•</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">copyFrom</span><span class="hljs-params">(ProxyConfig other)</span> {
    Assert.notNull(other, <span class="hljs-string">"Other ProxyConfig object must not be null"</span>);
    <span class="hljs-built_in">this</span>.proxyTargetClass = other.proxyTargetClass;
    <span class="hljs-built_in">this</span>.optimize = other.optimize;
    <span class="hljs-built_in">this</span>.exposeProxy = other.exposeProxy;
    <span class="hljs-built_in">this</span>.frozen = other.frozen;
    <span class="hljs-built_in">this</span>.opaque = other.opaque;
}
</code></pre>
<p>æ‰€ä»¥å½“æ‰§è¡Œåˆ° <code>org.springframework.aop.framework.DefaultAopProxyFactory#createAopProxy</code> æ–¹æ³•æ—¶ï¼Œä¸ç®¡ç›®æ ‡ç±»æ˜¯å¦å®ç°æ¥å£ï¼Œåªè¦å®ƒæœ¬èº«ä¸æ˜¯æ¥å£ï¼Œå°±ä¸€å®šä¼šèµ° <code>CGLIB</code> ä»£ç†ï¼Œè¿™ä¸€ç‚¹ä¸åŸç”Ÿ <code>Spring</code> ä¸åŒã€‚<strong>SpringBoot é»˜è®¤å¼ºåˆ¶èµ° CGLIB ä»£ç†</strong></p>
<h3 data-id="heading-15">CGLIB ä»£ç†åˆ›å»ºç»†èŠ‚</h3>
<p>å’Œæˆ‘ä»¬ä¹‹å‰åœ¨ <a href="https://link.juejin.cn?target=url" target="_blank" title="url" ref="nofollow noopener noreferrer">å­¦ä¹  Java åŠ¨æ€ä»£ç†</a> ä¸­æåˆ°çš„ä¸€æ ·ï¼Œå…ˆæ„é€  <code>Enhancer</code> å®ä¾‹ï¼Œç„¶åè®¾ç½®å®ƒçš„å›è°ƒåˆ—è¡¨ï¼Œ
è¿™é‡Œæœ‰ä¸€ä¸ªä»£ç†å¯¹è±¡æ–¹æ³•è°ƒç”¨å…¥å£çš„æ‹¦æˆªå™¨ <code>DynamicAdvisedInterceptor</code></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> Callback[] getCallbacks(Class&lt;?&gt; rootClass) <span class="hljs-keyword">throws</span> Exception {
    <span class="hljs-comment">// Choose an "aop" interceptor (used for AOP calls).</span>
    <span class="hljs-comment">//è°ƒç”¨ç›®æ ‡æ–¹æ³•å‰ä¼šå…ˆè°ƒç”¨è¿™ä¸ªæ‹¦æˆªå™¨ï¼Œæ„é€ æ—¶ä¼ å…¥å½“å‰ Bean çš„æ‰€æœ‰åˆ‡é¢</span>
    <span class="hljs-type">Callback</span> <span class="hljs-variable">aopInterceptor</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DynamicAdvisedInterceptor</span>(<span class="hljs-built_in">this</span>.advised);

    <span class="hljs-comment">//......</span>
    Callback[] mainCallbacks = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Callback</span>[] {
          aopInterceptor,  <span class="hljs-comment">// for normal advice</span>
          targetInterceptor,  <span class="hljs-comment">// invoke target without considering advice, if optimized</span>
          <span class="hljs-keyword">new</span> <span class="hljs-title class_">SerializableNoOp</span>(),  <span class="hljs-comment">// no override for methods mapped to this</span>
          targetDispatcher, <span class="hljs-built_in">this</span>.advisedDispatcher,
          <span class="hljs-keyword">new</span> <span class="hljs-title class_">EqualsInterceptor</span>(<span class="hljs-built_in">this</span>.advised),
          <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashCodeInterceptor</span>(<span class="hljs-built_in">this</span>.advised)
    };
    <span class="hljs-comment">//......</span>
       <span class="hljs-keyword">return</span> mainCallbacks;
    }
----------------------------åˆ†éš”çº¿-----------------------------
<span class="hljs-comment">//è®¾ç½®å›è°ƒåˆ—è¡¨    </span>
enhancer.setCallbacks(callbacks);
</code></pre>
<p>å½“ä»£ç†ç±»åˆ›å»ºå®Œæ¯•ä¹‹åï¼Œæˆ‘ä»¬è·å–å®ƒçš„ <code>class</code> å…¨åï¼Œç„¶åä½¿ç”¨ <code>arthas</code> å·¥å…·è·å–ä»£ç†ç±»çš„æºç ï¼Œä»£ç å¾ˆå¤šï¼Œè¿™é‡Œæˆ‘ä»¬åªçœ‹æˆ‘ä»¬å¢å¼ºçš„æ–¹æ³• <code>test1()</code></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test1</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">try</span> {
        <span class="hljs-type">MethodInterceptor</span> <span class="hljs-variable">methodInterceptor</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.CGLIB$CALLBACK_0;
        <span class="hljs-keyword">if</span> (methodInterceptor == <span class="hljs-literal">null</span>) {
            UserService$$SpringCGLIB$$<span class="hljs-number">0.</span>CGLIB$BIND_CALLBACKS(<span class="hljs-built_in">this</span>);
            methodInterceptor = <span class="hljs-built_in">this</span>.CGLIB$CALLBACK_0;
        }
        <span class="hljs-keyword">if</span> (methodInterceptor != <span class="hljs-literal">null</span>) {
            <span class="hljs-type">Object</span> <span class="hljs-variable">object</span> <span class="hljs-operator">=</span> methodInterceptor.intercept(<span class="hljs-built_in">this</span>, CGLIB$test1$<span class="hljs-number">0</span>$Method, CGLIB$emptyArgs, CGLIB$test1$<span class="hljs-number">0</span>$Proxy);
            <span class="hljs-keyword">return</span>;
        }
        <span class="hljs-comment">//è°ƒç”¨åŸå§‹ç±»çš„æ–¹æ³•ï¼Œè¿™ä¹Ÿè¯´æ˜å½“å‰ä»£ç†ç±»æ˜¯åŸå§‹ç±»çš„ä¸€ä¸ªå­ç±»</span>
        <span class="hljs-built_in">super</span>.test1();
        <span class="hljs-keyword">return</span>;
    }
    <span class="hljs-comment">//......</span>
}
</code></pre>
<p>æˆ‘ä»¬å‘ç°æ‰§è¡Œ <code>super.test1()</code> ä¹Ÿå°±æ˜¯è°ƒç”¨åŸå§‹å¯¹è±¡çš„æ–¹æ³•æ—¶ï¼Œä¼šå…ˆè°ƒç”¨è¿™ä¸ª <code>CGLIB$CALLBACK_0</code> çš„ <code>intercept()</code> æ–¹æ³•ï¼Œè€Œè¿™ä¸ª <code>CGLIB$CALLBACK_0</code> å°±æ˜¯ä¸Šä¸€æ®µæˆ‘ä»¬è®¾ç½®çš„ <code>DynamicAdvisedInterceptor</code> å®ä¾‹ã€‚</p>
<h3 data-id="heading-16">AnnotationAwareAspectJAutoProxyCreator</h3>
<p>å‰é¢æˆ‘ä»¬ä»‹ç»äº†è¿™ä¸ªç±»æ˜¯åˆ›å»ºä»£ç†çš„å…¥å£ç±»ï¼ŒæŸ¥çœ‹ç±»çš„ç»§æ‰¿ç»“æ„ï¼Œå‘ç°å®ƒæ˜¯ <code>AbstractAutoProxyCreator</code> çš„å­ç±»ï¼Œå¹¶ä¸”æ˜¯ä¸€ä¸ª <code>BeanPostProcessor</code>ï¼Œå®ƒæ˜¯è¢« <code>AspectJAutoProxyRegistrar#registerBeanDefinitions</code> æ³¨å†Œåˆ° <code>Spring</code> å®¹å™¨çš„ï¼Œ<code>AspectJAutoProxyRegistrar</code> æ˜¯è¢« <code>@EnableAspectJAutoProxy</code> å¯¼å…¥çš„ï¼Œåœ¨ <code>AopAutoConfiguration</code> è‡ªåŠ¨é…ç½®ä¸­å¯ç”¨äº†è¯¥æ³¨è§£</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@AutoConfiguration</span>
<span class="hljs-meta">@ConditionalOnProperty(prefix = "spring.aop", name = "auto", havingValue = "true", matchIfMissing = true)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AopAutoConfiguration</span> {

    <span class="hljs-meta">@Configuration(proxyBeanMethods = false)</span>
    <span class="hljs-comment">//æœ‰ AspectJ æ—¶ç”Ÿæ•ˆ</span>
    <span class="hljs-meta">@ConditionalOnClass(Advice.class)</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AspectJAutoProxyingConfiguration</span> {

       <span class="hljs-meta">@Configuration(proxyBeanMethods = false)</span>
       <span class="hljs-comment">//å¯ç”¨ Aspect è‡ªåŠ¨ä»£ç†ï¼ŒmatchIfMissing = true é»˜è®¤ä½¿ç”¨ CGLIB ä»£ç†</span>
       <span class="hljs-comment">//proxyTargetClass = true</span>
       <span class="hljs-meta">@EnableAspectJAutoProxy(proxyTargetClass = true)</span>
       <span class="hljs-meta">@ConditionalOnProperty(prefix = "spring.aop", name = "proxy-target-class", havingValue = "true",matchIfMissing = true)</span>
       <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CglibAutoProxyConfiguration</span> {}
    }

    <span class="hljs-meta">@Configuration(proxyBeanMethods = false)</span>
    <span class="hljs-comment">//å½“æ²¡æœ‰ AspectJ æ—¶ç”Ÿæ•ˆï¼Œä¸‹ä¸€ç¯‡è¯´äº‹åŠ¡çš„æ—¶å€™ä¼šä»‹ç»</span>
    <span class="hljs-meta">@ConditionalOnMissingClass("org.aspectj.weaver.Advice")</span>
    <span class="hljs-meta">@ConditionalOnProperty(prefix = "spring.aop", name = "proxy-target-class", havingValue = "true",matchIfMissing = true)</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ClassProxyingConfiguration</span> {
       <span class="hljs-meta">@Bean</span>
       <span class="hljs-keyword">static</span> BeanFactoryPostProcessor <span class="hljs-title function_">forceAutoProxyCreatorToUseClassProxying</span><span class="hljs-params">()</span> {
          <span class="hljs-keyword">return</span> (beanFactory) -&gt; {
             <span class="hljs-keyword">if</span> (beanFactory <span class="hljs-keyword">instanceof</span> BeanDefinitionRegistry registry) {
                AopConfigUtils.registerAutoProxyCreatorIfNecessary(registry);
                AopConfigUtils.forceAutoProxyCreatorToUseClassProxying(registry);
             }
          };
       }
    }
}
</code></pre>
<p>æ€»ç»“ <code>AnnotationAwareAspectJAutoProxyCreator</code> è¿™ä¸ª <code>Bean</code> çš„æ¥æºå¦‚ä¸‹</p>
<p><code>AopAutoConfiguration â†’ AspectJAutoProxyingConfiguration â†’ @EnableAspectJAutoProxy â†’ AspectJAutoProxyRegistrar</code></p>
<h2 data-id="heading-17">ä»£ç†ç±»çš„è°ƒç”¨è¿‡ç¨‹</h2>
<p><code>debug UserService.test1()</code> æˆ‘ä»¬å‘ç°åœ¨å®é™…è°ƒç”¨è¿™ä¸ªæ–¹æ³•å‰æœ‰ä¸€ç³»åˆ—çš„è°ƒç”¨</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/add23be526f04a56b4cbb531ba5a1506~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pqu6Imy5aaW5aiG5Li2:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771294248&amp;x-signature=Kzjv4qTwxRSuJB%2B9%2FvqLEtEBFuM%3D" alt="image.png" loading="lazy"/></p>
<p>æœ€æ—©çš„å…¥å£æ˜¯ä¸€ä¸ªä»£ç†ç±»çš„ <code>UserService$$SpringCGLIB$$0.test1()</code>ï¼Œç´§æ¥ç€æ˜¯æˆ‘ä»¬ä¸Šä¸€æ®µåœ¨åˆ›å»ºä»£ç†å¯¹è±¡æ˜¯æåˆ°çš„ï¼Œ<code>DynamicAdvisedInterceptor#intercept</code> å…¥å£å›è°ƒå‡½æ•°ã€‚ç„¶åå°±æ˜¯ä¸€ç³»åˆ—çš„ <code>invoke</code> æœ€ç»ˆåˆ°è¾¾æˆ‘ä»¬åŸç”Ÿçš„ <code>UserService.test1()</code> ã€‚</p>
<h3 data-id="heading-18">DynamicAdvisedInterceptor</h3>
<p>ä¸Šä¸€æ®µæˆ‘ä»¬è¯´äº†ï¼Œä»£ç†å¯¹è±¡è°ƒç”¨ç›®æ ‡å¯¹è±¡æ–¹æ³•ä¹‹å‰ä¼šè°ƒç”¨ <code>DynamicAdvisedInterceptor.intercept()</code>ï¼Œè¿™é‡Œæ˜¯ä»£ç†å¯¹è±¡å¢å¼ºé€»è¾‘å¤„ç†çš„å…¥å£ æˆ‘ä»¬çœ‹ä¸€ä¸‹å®ƒçš„æºç </p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> Object <span class="hljs-title function_">intercept</span><span class="hljs-params">(Object proxy, Method method, Object[] args, MethodProxy methodProxy)</span> <span class="hljs-keyword">throws</span> Throwable {
   <span class="hljs-comment">//......</span>
   <span class="hljs-comment">//æ ¹æ®å½“å‰ Bean çš„åˆ‡é¢è·å–ä¸€ä¸ª chain åˆ—è¡¨</span>
   List&lt;Object&gt; chain = <span class="hljs-built_in">this</span>.advised.getInterceptorsAndDynamicInterceptionAdvice(method, targetClass);
   Object retVal;
   <span class="hljs-keyword">if</span> (chain.isEmpty()) {......}
   <span class="hljs-keyword">else</span> {
      <span class="hljs-comment">// We need to create a method invocation...</span>
      retVal = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReflectiveMethodInvocation</span>(proxy, target, method, args, targetClass, chain).proceed();
   }
   <span class="hljs-keyword">return</span> processReturnType(proxy, target, method, args, retVal);
    <span class="hljs-comment">//......</span>
}
</code></pre>
<p>åªçœ‹å…³é”®éƒ¨åˆ†ï¼Œè·å–äº†ä¸€ä¸ª <code>chain</code> åˆ—è¡¨ï¼Œç„¶åæ„é€  <code>ReflectiveMethodInvocation</code> è°ƒç”¨ <code>proceed()</code>ï¼Œè¿™ä¸ª <code>chain</code> å°±æ˜¯æˆ‘ä»¬çš„åŒ…å«å¢å¼ºé€»è¾‘çš„æ‹¦æˆªå™¨</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/108e55fa04464963a09c8de7b8a08291~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pqu6Imy5aaW5aiG5Li2:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771294248&amp;x-signature=CEbGw9gu4FdpGP%2FHP%2Bwb%2B5bZXWk%3D" alt="image.png" loading="lazy"/></p>
<p>å› ä¸ºæˆ‘ä»¬æµ‹è¯•æ¡ˆä¾‹ä½¿ç”¨çš„æ˜¯ <code>@Before</code> æ³¨è§£å®ç°çš„å‰ç½®å¢å¼ºï¼Œæ‰€ä»¥è¿™é‡Œæ˜¯ <code>MethodBeforeAdviceInterceptor</code>ï¼ŒåŒç† <code>@AfterReturning</code>ã€<code>@Around</code> ç­‰éƒ½æœ‰å¯¹åº”çš„æ‹¦æˆªå™¨ï¼Œé™¤äº†ç¬¬ä¸€ä¸ª <code>ExposeInvocationInterceptor</code> ä¹‹å¤–ï¼Œå®šä¹‰å‡ ä¸ªåˆ‡ç‚¹è¿™é‡Œå°±ä¼šæœ‰å‡ ä¸ª <code>chain</code>ã€‚</p>
<p><code>ExposeInvocationInterceptor</code> æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„æ‹¦æˆªå™¨ï¼Œç”¨æ¥å……å½“ä¸Šä¸‹æ–‡çš„ï¼Œå†…éƒ¨æœ‰ä¸€ä¸ª <code>ThreadLocal</code> å­˜å‚¨å…¥å£ <code>ReflectiveMethodInvocation</code> å¯¹è±¡ï¼Œ</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> ThreadLocal&lt;MethodInvocation&gt; invocation = <span class="hljs-keyword">new</span> <span class="hljs-title class_">NamedThreadLocal</span>&lt;&gt;(<span class="hljs-string">"Current AOP method invocation"</span>);
</code></pre>
<p>è¿™å¯ä»¥ä¾¿äºåç»­ <code>AspectJ</code> å†…éƒ¨æˆ–è€…æˆ‘ä»¬è‡ªå·±åœ¨å¢å¼ºä»£ç å—ä¸­ä½¿ç”¨å®ƒï¼Œä¾‹å¦‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Around("pointcut()")</span>
<span class="hljs-keyword">public</span> Object <span class="hljs-title function_">around</span><span class="hljs-params">(ProceedingJoinPoint joinPoint)</span> <span class="hljs-keyword">throws</span> Throwable {
    <span class="hljs-comment">//è·å–å½“å‰ MethodInvocationï¼Œç°åœ¨ä½ çŸ¥é“ä¸ºä»€ä¹ˆ ExposeInvocationInterceptor åœ¨ List&lt;chain&gt; çš„ç¬¬ä¸€ä¸ªäº†å§ï¼Ÿ</span>
    <span class="hljs-type">MethodInvocation</span> <span class="hljs-variable">methodInvocation</span> <span class="hljs-operator">=</span> ExposeInvocationInterceptor.currentInvocation();
    <span class="hljs-comment">//......</span>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
}
</code></pre>
<p>ç°åœ¨ä½ çŸ¥é“ä¸ºä»€ä¹ˆ <code>ExposeInvocationInterceptor</code> åœ¨ <code>List&lt;chain&gt;</code> çš„ç¬¬ä¸€ä¸ªäº†å§ï¼Ÿå› ä¸ºåç»­æ¯ä¸€ä¸ªæ‹¦æˆªå™¨éƒ½å¯èƒ½ä¼šç”¨åˆ°å®ƒç»‘å®šåˆ° <code>ThreadLocal</code> çš„ <code>MethodInvocation</code> ã€‚</p>
<h3 data-id="heading-19">ReflectiveMethodInvocation</h3>
<p>è¿™æ˜¯ä»£ç†æ–¹æ³•å¢å¼ºé€»è¾‘çš„æ ¸å¿ƒï¼Œæ‹¦æˆªå™¨é“¾ä¼šåœ¨ <code>ReflectiveMethodInvocation.proceed()</code> é‡Œé¢éå†æ‰§è¡Œï¼Œå°±åƒæˆ‘ä»¬ä»¥å‰å­¦è¿‡çš„ <code>Servlet</code> è¿‡æ»¤å™¨é“¾ï¼ŒæŸ¥çœ‹æºç </p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ReflectiveMethodInvocation</span>
<span class="hljs-keyword">public</span> Object <span class="hljs-title function_">proceed</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Throwable {
    <span class="hljs-comment">// å¦‚æœå½“å‰æ‹¦æˆªå™¨åˆ—è¡¨å…¨éƒ¨æ‰§è¡Œå®Œï¼Œå°±è°ƒç”¨åŸå§‹æ–¹æ³•</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.currentInterceptorIndex == <span class="hljs-built_in">this</span>.interceptorsAndDynamicMethodMatchers.size() - <span class="hljs-number">1</span>) {
       <span class="hljs-comment">//è°ƒç”¨åŸå§‹æ–¹æ³•ï¼ˆè¢«ä»£ç†çš„å¯¹è±¡çš„æ–¹æ³•ï¼‰</span>
       <span class="hljs-keyword">return</span> invokeJoinpoint();
    }
    <span class="hljs-comment">//æ¯æ¬¡éƒ½ç´¢å¼•è‡ªå¢ï¼Œè·å–ä¸‹ä¸€ä¸ªæ‹¦æˆªå™¨</span>
    <span class="hljs-type">Object</span> <span class="hljs-variable">interceptorOrInterceptionAdvice</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.interceptorsAndDynamicMethodMatchers.get(++<span class="hljs-built_in">this</span>.currentInterceptorIndex);
    <span class="hljs-keyword">if</span> (interceptorOrInterceptionAdvice <span class="hljs-keyword">instanceof</span> InterceptorAndDynamicMethodMatcher dm) {
       <span class="hljs-comment">//......</span>
    }
    <span class="hljs-keyword">else</span> {
       <span class="hljs-comment">//è°ƒç”¨æ‹¦æˆªå™¨</span>
       <span class="hljs-keyword">return</span> ((MethodInterceptor) interceptorOrInterceptionAdvice).invoke(<span class="hljs-built_in">this</span>);
    }
}
</code></pre>
<p>æ³¨æ„è¿™é‡Œ <code>MethodInterceptor.invoke(this)</code>ï¼Œä¼ é€’äº†å½“å‰ <code>ReflectiveMethodInvocation</code> å¯¹è±¡ï¼Œæ¯ä¸ªæ‹¦æˆªå™¨å†…éƒ¨å¤„ç†å®Œéƒ½ä¼šå†æ‰§è¡Œä¸€é <code>ReflectiveMethodInvocation.proceed()</code>ï¼Œæ‰€ä»¥ç¨‹åºåˆä¼šå›åˆ°ï¼Œ<code>ReflectiveMethodInvocation.proceed()</code> å†…éƒ¨ï¼Œè¿›è€Œå¼€å§‹æ‰§è¡Œä¸‹ä¸€ä¸ªæ‹¦æˆªå™¨ï¼Œç›´æ¥åˆ°æ‹¦æˆªå™¨åˆ—è¡¨æ‰§è¡Œå®Œæ¯•ï¼Œä¼šè°ƒç”¨ <code>invokeJoinpoint()</code> æ‰§è¡ŒåŸå§‹æ–¹æ³•ã€‚</p>
<h3 data-id="heading-20">ä»£ç†æ–¹æ³•è°ƒç”¨é“¾è·¯å›¾è§£</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b5cba946a72f442eae3e9f014fc0b923~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pqu6Imy5aaW5aiG5Li2:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771294248&amp;x-signature=knrIbicSwYO%2Bcu3zPKJufrWTYlI%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-21">Spring AOP å’Œ AspectJ çš„åŒºåˆ«</h2>



























































<table><thead><tr><th>å¯¹æ¯”ç»´åº¦</th><th>Spring AOP</th><th>AspectJ åŸç”Ÿ AOP</th><th>åŒºåˆ«</th></tr></thead><tbody><tr><td><strong>æ ¸å¿ƒå®ç°æœºåˆ¶</strong></td><td><strong>åŠ¨æ€ä»£ç†</strong>ï¼ˆJDKåŠ¨æ€ä»£ç†æˆ–CGLIBå­—èŠ‚ç ç”Ÿæˆï¼‰</td><td><strong>å­—èŠ‚ç ç»‡å…¥</strong>ï¼ˆç¼–è¯‘æ—¶ã€åŠ è½½æ—¶ã€ç¼–è¯‘åï¼‰</td><td>Spring AOP åœ¨è¿è¡Œæ—¶åˆ›å»ºä»£ç†åŒ…è£…ç›®æ ‡å¯¹è±¡ï¼›AspectJ ç›´æ¥ä¿®æ”¹ .class æ–‡ä»¶å­—èŠ‚ç </td></tr><tr><td><strong>ç»‡å…¥æ—¶æœº</strong></td><td><strong>è¿è¡Œæ—¶</strong>ï¼ˆåº”ç”¨å¯åŠ¨æ—¶åˆ›å»ºä»£ç†ï¼‰</td><td><strong>ç¼–è¯‘æ—¶</strong>ã€<strong>åŠ è½½æ—¶</strong>ï¼ˆç±»åŠ è½½æœŸï¼‰æˆ–<strong>ç¼–è¯‘å</strong></td><td>AspectJ çš„ç¼–è¯‘æ—¶ç»‡å…¥æ€§èƒ½æœ€ä¼˜ï¼Œæ— è¿è¡Œæ—¶å¼€é”€ï¼›Spring AOP æ¯æ¬¡æ–¹æ³•è°ƒç”¨éƒ½æœ‰ä»£ç†è½¬å‘å¼€é”€</td></tr><tr><td><strong>æ‹¦æˆªèƒ½åŠ›ï¼ˆè¿æ¥ç‚¹ï¼‰</strong></td><td><strong>ä»…æ–¹æ³•æ‰§è¡Œ</strong>ï¼ˆä¸»è¦æ˜¯ public æ–¹æ³•ï¼‰</td><td><strong>å¾ˆå¤šç§è¿æ¥ç‚¹</strong>ï¼šæ–¹æ³•æ‰§è¡Œ/è°ƒç”¨ã€æ„é€ å™¨æ‰§è¡Œ/è°ƒç”¨ã€å­—æ®µè¯»/å†™ã€å¼‚å¸¸å¤„ç†ã€ç±»åˆå§‹åŒ–ã€é™æ€åˆå§‹åŒ–ã€å»ºè®®æ‰§è¡Œ</td><td>Spring AOP æ— æ³•æ‹¦æˆªå­—æ®µè®¿é—®ã€æ„é€ å™¨è°ƒç”¨ã€é™æ€åˆå§‹åŒ–ç­‰</td></tr><tr><td><strong>ç›®æ ‡å¯¹è±¡é™åˆ¶</strong></td><td><strong>ä»… Spring å®¹å™¨ç®¡ç†çš„ Bean</strong></td><td><strong>ä»»ä½•Javaå¯¹è±¡</strong>ï¼ˆåŒ…æ‹¬ç¬¬ä¸‰æ–¹åº“ã€è‡ªå·± new çš„å¯¹è±¡ï¼‰</td><td>Spring AOP åªèƒ½æ‹¦æˆªé€šè¿‡ Spring å®¹å™¨è·å–çš„ Beanï¼›AspectJ å¯æ‹¦æˆªä»»ä½•ç±»çš„å®ä¾‹</td></tr><tr><td><strong>å†…éƒ¨è°ƒç”¨é—®é¢˜</strong></td><td><strong>æ— æ³•æ‹¦æˆª</strong>ï¼ˆåŒç±»å†…çš„æ–¹æ³•Aè°ƒç”¨æ–¹æ³•Bï¼‰</td><td><strong>å¯ä»¥æ‹¦æˆª</strong></td><td>Spring AOP ç”±äºä»£ç†æœºåˆ¶é™åˆ¶ï¼Œå†…éƒ¨è°ƒç”¨ä¸ç»è¿‡ä»£ç†ï¼›AspectJ ç›´æ¥ä¿®æ”¹å­—èŠ‚ç ï¼Œæ— æ­¤é™åˆ¶</td></tr><tr><td><strong>æ€§èƒ½å½±å“</strong></td><td><strong>æœ‰è¿è¡Œæ—¶å¼€é”€</strong>ï¼ˆä»£ç†è°ƒç”¨é“¾ã€åå°„ï¼‰</td><td><strong>ç¼–è¯‘æ—¶ç»‡å…¥é›¶è¿è¡Œæ—¶å¼€é”€</strong>ï¼›åŠ è½½æ—¶ç»‡å…¥æœ‰åˆæ¬¡åŠ è½½å¼€é”€</td><td>å¯¹æ€§èƒ½æ•æ„Ÿåœºæ™¯ï¼ŒAspectJ ç¼–è¯‘æ—¶ç»‡å…¥æ˜¯é¦–é€‰</td></tr><tr><td><strong>ä¾èµ–å…³ç³»</strong></td><td>è½»é‡ï¼Œåªä¾èµ– Spring æ ¸å¿ƒ</td><td>éœ€è¦ AspectJ ç¼–è¯‘å™¨ï¼ˆajcï¼‰æˆ– ç»‡å…¥å™¨ agent</td><td>Spring é¡¹ç›®å¯è½»æ˜“é›†æˆ Spring AOPï¼›AspectJ éœ€è¦æ„å»ºå·¥å…·é…åˆ</td></tr><tr><td><strong>é€‚ç”¨åœºæ™¯</strong></td><td>å…¸å‹çš„ Spring åº”ç”¨ï¼Œæ¨ªåˆ‡å…³æ³¨ç‚¹ç®€å•ï¼ˆæ—¥å¿—ã€äº‹åŠ¡ã€å®‰å…¨ç­‰ï¼‰</td><td>å¤æ‚ AOP éœ€æ±‚ã€é«˜æ€§èƒ½è¦æ±‚ã€æ‹¦æˆªé Spring å¯¹è±¡ã€ç³»ç»Ÿçº§ç›‘æ§</td><td>æ ¹æ®éœ€æ±‚å¤æ‚åº¦é€‰æ‹©ï¼šç®€å•ç”¨ Spring AOP ï¼Œå¤æ‚ç”¨ AspectJ</td></tr></tbody></table>
<h2 data-id="heading-22">ç»“è¯­</h2>
<p>æŒæ¡äº† <code>Spring AOP</code> çš„å®ç°åŸç†ï¼Œå¯¹äºåç»­æˆ‘ä»¬ç†è§£ <code>Spring</code> äº‹åŠ¡çš„æ”¯æŒä¼šæœ‰æå¤§çš„å¸®åŠ©ã€‚</p>
<h3 data-id="heading-23">å¦‚æœè¿™ç¯‡æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè®°å¾—ç‚¹èµåŠ å…³æ³¨ï¼ä½ çš„æ”¯æŒå°±æ˜¯æˆ‘ç»§ç»­åˆ›ä½œçš„åŠ¨åŠ›ï¼</h3></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Polymarket é‡åŒ–äº¤æ˜“å®æˆ˜ï¼ˆäºŒï¼‰ï¼šWebSocket å®æ—¶æ•°æ®æµ]]></title>    <link>https://juejin.cn/post/7604693038439759878</link>    <guid>https://juejin.cn/post/7604693038439759878</guid>    <pubDate>2026-02-10T02:05:54.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604693038439759878" data-draft-id="7604574877035823147" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Polymarket é‡åŒ–äº¤æ˜“å®æˆ˜ï¼ˆäºŒï¼‰ï¼šWebSocket å®æ—¶æ•°æ®æµ"/> <meta itemprop="keywords" content="web3,åŒºå—é“¾"/> <meta itemprop="datePublished" content="2026-02-10T02:05:54.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ä¸è¾è¿œ_Web3"/> <meta itemprop="url" content="https://juejin.cn/user/3452906910267656"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Polymarket é‡åŒ–äº¤æ˜“å®æˆ˜ï¼ˆäºŒï¼‰ï¼šWebSocket å®æ—¶æ•°æ®æµ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3452906910267656/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ä¸è¾è¿œ_Web3
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T02:05:54.000Z" title="Tue Feb 10 2026 02:05:54 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong>HTTP è½®è¯¢æ‹¿åˆ°çš„ä»·æ ¼ï¼Œæ˜¯å†å²ã€‚</strong></p>
<p>V1 ç‰ˆæœ¬çš„ Bot ç”¨ REST API è½®è¯¢ç›˜å£ï¼Œ2 ç§’ä¸€æ¬¡ã€‚ç»“æœå¾ˆç›´æ¥ï¼šå•å­è¦ä¹ˆæˆäº¤ä¸äº†ï¼Œè¦ä¹ˆæˆäº¤å³äºæŸã€‚</p>
<p>é¢„æµ‹å¸‚åœºçš„ç›˜å£å˜åŒ–å¿«ï¼Œ2 ç§’çš„å»¶è¿Ÿè¶³ä»¥è®©ä½ çœ‹åˆ°çš„ä»·æ ¼å’Œå®é™…ä»·æ ¼å®Œå…¨è„±èŠ‚ã€‚è¦åšé‡åŒ–ï¼Œ<strong>å¿…é¡»æ¥ WebSocket</strong>ã€‚</p>
<hr/>
<h2 data-id="heading-0">ä¸¤ä¸ª WebSocketï¼Œé€‰å“ªä¸ª</h2>
<p>Polymarket æä¾›ä¸¤ä¸ª WebSocket æœåŠ¡ï¼š</p>
<ol>
<li>
<p><strong>CLOB WebSocket</strong> â€” <code>wss://ws-subscriptions-clob.polymarket.com/ws/market</code><br/>
ç›˜å£ã€æˆäº¤ã€ä»·æ ¼å˜åŠ¨ï¼Œé‡åŒ–äº¤æ˜“è¦çš„æ•°æ®éƒ½åœ¨è¿™é‡Œ</p>
</li>
<li>
<p><strong>RTDS</strong> â€” <code>wss://ws-live-data.polymarket.com</code><br/>
å®æ—¶ä»·æ ¼æµå’Œè¯„è®ºæ•°æ®ï¼Œæ›´é€‚åˆåšå‰ç«¯å±•ç¤º</p>
</li>
</ol>
<p>é‡åŒ–äº¤æ˜“ç”¨ CLOB WebSocketã€‚å®ƒåˆ†ä¸¤ä¸ªé¢‘é“ï¼š</p>
<ul>
<li><strong>Market Channel</strong> â€” å…¬å¼€å¸‚åœºæ•°æ®ï¼Œä¸éœ€è¦è®¤è¯</li>
<li><strong>User Channel</strong> â€” è®¢å•çŠ¶æ€æ¨é€ï¼Œéœ€è¦ API Key è®¤è¯</li>
</ul>
<p>æˆ‘çš„ Bot ä¸¤ä¸ªéƒ½æ¥äº†ã€‚Market Channel æ‹¿ç›˜å£æ•°æ®åšå†³ç­–ï¼ŒUser Channel ç›‘å¬è‡ªå·±çš„è®¢å•çŠ¶æ€ï¼Œç¡®è®¤æˆäº¤åå†æ›´æ–°ä»“ä½ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b62902ec26994e60b3aef32cd8a9b513~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN6L6e6L-cX1dlYjM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771294516&amp;x-signature=UW6hljsCeiGD4lgfV6mbR%2BPiXlA%3D" alt="Polymarket WebSocket æ¶æ„æ€»è§ˆ" loading="lazy"/>
<em>Polymarket WebSocket æ¶æ„æ€»è§ˆ</em></p>
<h2 data-id="heading-1">è¿æ¥ä¸è®¢é˜…</h2>
<p>Market Channel ä¸éœ€è¦è®¤è¯ï¼Œè¿ä¸Šå°±èƒ½è®¢é˜…ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">import websockets
import json

WS_URL = <span class="hljs-string">"wss://ws-subscriptions-clob.polymarket.com/ws/market"</span>

async def subscribe(ws, asset_ids: list[str]):
    <span class="hljs-string">""</span><span class="hljs-string">"è®¢é˜…æŒ‡å®š token çš„å¸‚åœºæ•°æ®"</span><span class="hljs-string">""</span>
    msg = {
        <span class="hljs-string">"assets_ids"</span>: asset_ids,
        <span class="hljs-string">"type"</span>: <span class="hljs-string">"market"</span>
    }
    await ws.send(json.dumps(msg))
</code></pre>
<p>è¿æ¥å»ºç«‹åå¯ä»¥åŠ¨æ€å¢å‡è®¢é˜…ï¼Œä¸ç”¨æ–­å¼€é‡è¿ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># è¿½åŠ è®¢é˜…</span>
await ws.send(json.dumps({
    <span class="hljs-string">"assets_ids"</span>: [new_token_id],
    <span class="hljs-string">"type"</span>: <span class="hljs-string">"market"</span>,
    <span class="hljs-string">"operation"</span>: <span class="hljs-string">"subscribe"</span>
}))

<span class="hljs-comment"># å–æ¶ˆè®¢é˜…</span>
await ws.send(json.dumps({
    <span class="hljs-string">"assets_ids"</span>: [old_token_id],
    <span class="hljs-string">"type"</span>: <span class="hljs-string">"market"</span>,
    <span class="hljs-string">"operation"</span>: <span class="hljs-string">"unsubscribe"</span>
}))
</code></pre>
<p>User Channel éœ€è¦è®¤è¯ï¼Œè®¢é˜…æ ¼å¼ä¸åŒï¼š</p>
<pre><code class="hljs language-bash" lang="bash">msg = {
    <span class="hljs-string">"markets"</span>: [condition_id],
    <span class="hljs-string">"type"</span>: <span class="hljs-string">"user"</span>,
    <span class="hljs-string">"auth"</span>: {
        <span class="hljs-string">"apiKey"</span>: api_key,
        <span class="hljs-string">"secret"</span>: secret,
        <span class="hljs-string">"passphrase"</span>: passphrase
    }
}
</code></pre>
<p>è¿™é‡Œæœ‰ä¸ªå®¹æ˜“è¸©çš„å‘ï¼š<strong>Market Channel ç”¨ <code>assets_ids</code>ï¼ˆtoken IDï¼‰ï¼ŒUser Channel ç”¨ <code>markets</code>ï¼ˆcondition IDï¼‰</strong>ã€‚ä¸¤ä¸ª ID ä¸æ˜¯åŒä¸€ä¸ªä¸œè¥¿ã€‚ææ··äº†ä¸ä¼šæŠ¥é”™ï¼Œåªæ˜¯æ”¶ä¸åˆ°æ¶ˆæ¯ï¼Œdebug åŠå¤©æ‰å‘ç°ã€‚</p>
<p>ã€æ³¨ï¼štoken ID æ˜¯æŸä¸ª outcome çš„å”¯ä¸€æ ‡è¯†ï¼ˆæ¯”å¦‚ Yes tokenï¼‰ï¼Œcondition ID æ˜¯æ•´ä¸ªå¸‚åœºçš„æ ‡è¯†ã€‚ä¸€ä¸ª condition ä¸‹é€šå¸¸æœ‰ä¸¤ä¸ª tokenï¼ˆYes å’Œ Noï¼‰ã€‚ã€‘</p>
<h2 data-id="heading-2">å››ç§æ¶ˆæ¯ï¼Œå„æœ‰ç”¨å¤„</h2>
<p>è®¢é˜…æˆåŠŸåä¼šæ”¶åˆ°å››ç§æ¶ˆæ¯ã€‚ä¸æ˜¯æ¯ç§éƒ½è¦å¤„ç†ï¼Œå–å†³äºä½ çš„ç­–ç•¥ã€‚</p>
<h3 data-id="heading-3">book â€” ç›˜å£å¿«ç…§</h3>
<p>é¦–æ¬¡è®¢é˜…æˆ–ç›˜å£å¤§å¹…å˜åŠ¨æ—¶æ¨é€ï¼ŒåŒ…å«å®Œæ•´çš„ä¹°å–ç›˜ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">{
  <span class="hljs-string">"event_type"</span>: <span class="hljs-string">"book"</span>,
  <span class="hljs-string">"asset_id"</span>: <span class="hljs-string">"token_id"</span>,
  <span class="hljs-string">"market"</span>: <span class="hljs-string">"condition_id"</span>,
  <span class="hljs-string">"timestamp"</span>: <span class="hljs-string">"1700000000000"</span>,
  <span class="hljs-string">"buys"</span>: [
    { <span class="hljs-string">"price"</span>: <span class="hljs-string">"0.55"</span>, <span class="hljs-string">"size"</span>: <span class="hljs-string">"100"</span> },
    { <span class="hljs-string">"price"</span>: <span class="hljs-string">"0.54"</span>, <span class="hljs-string">"size"</span>: <span class="hljs-string">"200"</span> }
  ],
  <span class="hljs-string">"sells"</span>: [
    { <span class="hljs-string">"price"</span>: <span class="hljs-string">"0.60"</span>, <span class="hljs-string">"size"</span>: <span class="hljs-string">"50"</span> },
    { <span class="hljs-string">"price"</span>: <span class="hljs-string">"0.61"</span>, <span class="hljs-string">"size"</span>: <span class="hljs-string">"150"</span> }
  ],
  <span class="hljs-string">"hash"</span>: <span class="hljs-string">"0xabc..."</span>
}
</code></pre>
<p><code>buys</code> å’Œ <code>sells</code> æ˜¯ä»·ä½æ•°ç»„ï¼Œæ¯é¡¹åŒ…å« <code>price</code> å’Œ <code>size</code>ã€‚æ³¨æ„<strong>å­—æ®µå…¨æ˜¯å­—ç¬¦ä¸²</strong>ï¼Œéœ€è¦è‡ªå·±è½¬ floatã€‚æˆ‘ä¸€å¼€å§‹ç›´æ¥æ‹¿æ¥æ¯”è¾ƒå¤§å°ï¼Œæ€ä¹ˆæ¯”éƒ½ä¸å¯¹ï¼Œæ’æŸ¥äº†å¥½ä¸€é˜µæ‰æ„è¯†åˆ°åœ¨æ¯”è¾ƒå­—ç¬¦ä¸²ã€‚</p>
<p><code>hash</code> æ˜¯ç›˜å£å†…å®¹çš„å“ˆå¸Œå€¼ï¼Œå¯ä»¥æ ¡éªŒæœ¬åœ°ç›˜å£æ˜¯å¦å’ŒæœåŠ¡ç«¯ä¸€è‡´ã€‚å®é™…è·‘ä¸‹æ¥ï¼Œå¶å°”ä¼šå‡ºç°æœ¬åœ°ç›˜å£å’ŒæœåŠ¡ç«¯ä¸åŒæ­¥çš„æƒ…å†µï¼Œå®šæœŸç”¨ hash æ ¡éªŒå¾ˆæœ‰å¿…è¦ã€‚</p>
<h3 data-id="heading-4">price_change â€” ä»·æ ¼å˜åŠ¨</h3>
<p>æœ‰äººä¸‹å•æˆ–æ’¤å•æ—¶æ¨é€ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">{
  <span class="hljs-string">"event_type"</span>: <span class="hljs-string">"price_change"</span>,
  <span class="hljs-string">"market"</span>: <span class="hljs-string">"condition_id"</span>,
  <span class="hljs-string">"price_changes"</span>: [
    {
      <span class="hljs-string">"asset_id"</span>: <span class="hljs-string">"token_id"</span>,
      <span class="hljs-string">"price"</span>: <span class="hljs-string">"0.56"</span>,
      <span class="hljs-string">"size"</span>: <span class="hljs-string">"100"</span>,
      <span class="hljs-string">"side"</span>: <span class="hljs-string">"BUY"</span>,
      <span class="hljs-string">"best_bid"</span>: <span class="hljs-string">"0.55"</span>,
      <span class="hljs-string">"best_ask"</span>: <span class="hljs-string">"0.60"</span>
    }
  ],
  <span class="hljs-string">"timestamp"</span>: <span class="hljs-string">"1700000000000"</span>
}
</code></pre>
<p>è¿™ä¸ªæ¶ˆæ¯ç›´æ¥ç»™ä½  <code>best_bid</code> å’Œ <code>best_ask</code>ï¼Œä¸éœ€è¦è‡ªå·±ä»å®Œæ•´ç›˜å£è®¡ç®—ã€‚å¦‚æœä½ çš„ç­–ç•¥åªå…³å¿ƒæœ€ä¼˜æŠ¥ä»·ï¼Œ<strong>ç”¨ price_change æ¯” book é«˜æ•ˆå¾—å¤š</strong>â€”â€”æ•°æ®é‡å°ï¼Œæ¨é€é¢‘ç‡é«˜ã€‚</p>
<p>æˆ‘çš„ç­–ç•¥ä¸»è¦ä¾èµ–è¿™ä¸ªæ¶ˆæ¯ã€‚book åªåœ¨å¯åŠ¨æ—¶ç”¨æ¥åˆå§‹åŒ–ç›˜å£çŠ¶æ€ï¼Œä¹‹åå…¨é  price_change é©±åŠ¨ã€‚</p>
<h3 data-id="heading-5">last_trade_price â€” æœ€æ–°æˆäº¤</h3>
<p>æœ‰æˆäº¤æ—¶æ¨é€ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">{
  <span class="hljs-string">"event_type"</span>: <span class="hljs-string">"last_trade_price"</span>,
  <span class="hljs-string">"asset_id"</span>: <span class="hljs-string">"token_id"</span>,
  <span class="hljs-string">"price"</span>: <span class="hljs-string">"0.55"</span>,
  <span class="hljs-string">"side"</span>: <span class="hljs-string">"BUY"</span>,
  <span class="hljs-string">"size"</span>: <span class="hljs-string">"50"</span>,
  <span class="hljs-string">"fee_rate_bps"</span>: <span class="hljs-string">"0"</span>,
  <span class="hljs-string">"timestamp"</span>: <span class="hljs-string">"1700000000000"</span>
}
</code></pre>
<p><code>side</code> æ˜¯ä¸»åŠ¨æ–¹å‘â€”â€”BUY è¯´æ˜æ˜¯ä¹°æ–¹åƒäº†å–å•ï¼ŒSELL åä¹‹ã€‚<code>fee_rate_bps</code> æ˜¯æ‰‹ç»­è´¹ç‡ï¼Œå•ä½æ˜¯åŸºç‚¹ï¼ˆ1 åŸºç‚¹ = 0.01%ï¼‰ã€‚</p>
<p>æˆäº¤æ•°æ®å¯¹åˆ¤æ–­å¸‚åœºæ–¹å‘æœ‰ç”¨ã€‚è¿ç»­å‡ºç°å¤§å• BUYï¼Œè¯´æ˜æœ‰äººåœ¨æ‰«è´§ã€‚</p>
<h3 data-id="heading-6">tick_size_change â€” æœ€å°åˆ»åº¦å˜åŒ–</h3>
<p>å½“ä»·æ ¼æ¥è¿‘ 0 æˆ– 1ï¼ˆ&gt;0.96 æˆ– &lt;0.04ï¼‰ï¼Œæœ€å°æŠ¥ä»·åˆ»åº¦ä¼šä» 0.01 å˜æˆ 0.001ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">{
  <span class="hljs-string">"event_type"</span>: <span class="hljs-string">"tick_size_change"</span>,
  <span class="hljs-string">"asset_id"</span>: <span class="hljs-string">"token_id"</span>,
  <span class="hljs-string">"old_tick_size"</span>: <span class="hljs-string">"0.01"</span>,
  <span class="hljs-string">"new_tick_size"</span>: <span class="hljs-string">"0.001"</span>
}
</code></pre>
<p>è¿™ä¸ªæ¶ˆæ¯å®¹æ˜“è¢«å¿½ç•¥ã€‚ä½†å¦‚æœä½ çš„ç­–ç•¥åœ¨æç«¯ä»·æ ¼åŒºé—´è¿è¡Œï¼ˆæ¯”å¦‚äº‹ä»¶å³å°†ç»“ç®—ï¼‰ï¼Œ<strong>ä¸å¤„ç†åˆ»åº¦å˜åŒ–ä¼šå¯¼è‡´ä¸‹å•è¢«æ‹’</strong>ã€‚æˆ‘åœ¨ä¸€æ¬¡é€‰ä¸¾ç»“ç®—å‰å°±åƒè¿‡è¿™ä¸ªäºï¼ŒBot è¿ç»­æŠ¥é”™ INVALID_TICK_SIZEï¼Œæ’æŸ¥æ‰å‘ç°æ˜¯åˆ»åº¦å˜äº†æ²¡æ›´æ–°ã€‚</p>
<h2 data-id="heading-7">å¿ƒè·³ï¼š10 ç§’ä¸€æ¬¡ PING</h2>
<p>WebSocket è¿æ¥ä¸å‘å¿ƒè·³ä¼šè¢«æœåŠ¡ç«¯æ–­å¼€ã€‚Polymarket è¦æ±‚æ¯ 10 ç§’å‘ä¸€æ¬¡ PINGï¼š</p>
<pre><code class="hljs language-bash" lang="bash">import asyncio

async def heartbeat(ws):
    <span class="hljs-keyword">while</span> True:
        await ws.send(<span class="hljs-string">"PING"</span>)
        await asyncio.sleep(10)
</code></pre>
<p>å¿ƒè·³å’Œæ¶ˆæ¯å¤„ç†è¦å¹¶è¡Œè·‘ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">async def run():
    async with websockets.connect(WS_URL) as ws:
        await subscribe(ws, asset_ids)
        await asyncio.gather(
            heartbeat(ws),
            handle_messages(ws)
        )
</code></pre>
<h2 data-id="heading-8">æ–­è¿å¤„ç†ï¼šå…ˆæ’¤å•ï¼Œå†é‡è¿</h2>
<p>WebSocket ä¸æ˜¯ä¸‡èƒ½çš„ã€‚ç½‘ç»œæŠ–åŠ¨ã€æœåŠ¡ç«¯é‡å¯éƒ½ä¼šå¯¼è‡´æ•°æ®ä¸­æ–­ã€‚</p>
<p>æ¯æ¡æ¶ˆæ¯éƒ½å¸¦ <code>timestamp</code>ï¼Œç”¨å®ƒåˆ¤æ–­æ•°æ®æ–°é²œåº¦ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">MAX_STALE_MS = 5000  <span class="hljs-comment"># 5 ç§’</span>

def is_stale(msg_timestamp: str) -&gt; bool:
    age = time.time() * 1000 - int(msg_timestamp)
    <span class="hljs-built_in">return</span> age &gt; MAX_STALE_MS
</code></pre>
<p>æ•°æ®è¿‡æœŸæ—¶ï¼Œç­–ç•¥åº”è¯¥<strong>ç«‹å³åœæ­¢äº¤æ˜“</strong>ã€‚ä¸è¦é™çº§åˆ° HTTP è½®è¯¢â€”â€”HTTP æ‹¿åˆ°çš„æ•°æ®å»¶è¿Ÿæ›´å¤§ï¼ŒåŸºäºè¿‡æ—¶æ•°æ®äº¤æ˜“åªä¼šäºæ›´å¤šã€‚</p>
<p>æ–­è¿æ—¶çš„åŸåˆ™å¾ˆç®€å•ï¼š<strong>å…ˆæ’¤å•ï¼Œå†é‡è¿ã€‚</strong></p>
<pre><code class="hljs language-bash" lang="bash">async def handle_disconnect():
    <span class="hljs-comment"># 1. ç«‹å³æ’¤é”€æ‰€æœ‰æŒ‚å•</span>
    await client.cancel_all()
    <span class="hljs-comment"># 2. ç­‰å¾…åé‡è¿</span>
    await asyncio.sleep(2)
    await reconnect()
</code></pre>
<p>é¡ºåºä¸èƒ½åã€‚å…ˆé‡è¿å†æ’¤å•çš„è¯ï¼Œé‡è¿æœŸé—´æŒ‚å•è¿˜åœ¨ç›˜å£ä¸Šï¼Œç›˜å£å·²ç»å˜äº†ä½†ä½ ä¸çŸ¥é“ï¼Œè¢«æˆäº¤äº†å°±æ˜¯ç›²ç›’ã€‚</p>
<h2 data-id="heading-9">å®Œæ•´çš„æ¶ˆæ¯å¤„ç†æ¡†æ¶</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4bb47e59f4ff4e88a4c7c0fa52953408~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN6L6e6L-cX1dlYjM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771294516&amp;x-signature=CQ1mgFW7exKNsZzC2Okz%2FwrviHQ%3D" alt="æ¶ˆæ¯å¤„ç†ä¸æ–­è¿æµç¨‹" loading="lazy"/>
<em>æ¶ˆæ¯å¤„ç†ä¸æ–­è¿æµç¨‹</em></p>
<p>æŠŠä¸Šé¢çš„é€»è¾‘ä¸²èµ·æ¥ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">async def handle_messages(ws):
    async <span class="hljs-keyword">for</span> raw <span class="hljs-keyword">in</span> ws:
        <span class="hljs-keyword">if</span> raw == <span class="hljs-string">"PONG"</span>:
            <span class="hljs-built_in">continue</span>

        msg = json.loads(raw)
        event = msg.get(<span class="hljs-string">"event_type"</span>)

        <span class="hljs-keyword">if</span> is_stale(msg.get(<span class="hljs-string">"timestamp"</span>, <span class="hljs-string">"0"</span>)):
            logger.warning(<span class="hljs-string">"æ•°æ®è¿‡æœŸï¼Œè·³è¿‡"</span>)
            <span class="hljs-built_in">continue</span>

        <span class="hljs-keyword">if</span> event == <span class="hljs-string">"book"</span>:
            update_orderbook(msg)
        <span class="hljs-keyword">elif</span> event == <span class="hljs-string">"price_change"</span>:
            on_price_change(msg)
        <span class="hljs-keyword">elif</span> event == <span class="hljs-string">"last_trade_price"</span>:
            on_trade(msg)
        <span class="hljs-keyword">elif</span> event == <span class="hljs-string">"tick_size_change"</span>:
            on_tick_size_change(msg)
</code></pre>
<p>æ¡†æ¶æœ¬èº«ä¸å¤æ‚ã€‚éš¾çš„æ˜¯æ¯ä¸ª handler é‡Œçš„å…·ä½“é€»è¾‘â€”â€”æ€ä¹ˆç»´æŠ¤æœ¬åœ°ç›˜å£ã€æ€ä¹ˆåˆ¤æ–­ä¿¡å·ã€æ€ä¹ˆç®¡ç†è®¢å•çŠ¶æ€ã€‚è¿™äº›åœ¨åç»­çš„æ–‡ç« é‡Œä¼šè¯¦ç»†å±•å¼€ã€‚</p>
<hr/>
<p>æ‹¿åˆ°å®æ—¶æ•°æ®æµï¼Œæ‰æœ‰èµ„æ ¼è°ˆç­–ç•¥ã€‚REST API æ˜¯çœ‹åè§†é•œå¼€è½¦ï¼ŒWebSocket æ‰æ˜¯æŒ¡é£ç»ç’ƒã€‚</p>
<hr/>
<h3 data-id="heading-10">å‚è€ƒ</h3>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.polymarket.com%2Fdevelopers%2FCLOB%2Fwebsocket%2Fwss-overview" target="_blank" title="https://docs.polymarket.com/developers/CLOB/websocket/wss-overview" ref="nofollow noopener noreferrer">Polymarket WSS Overview</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.polymarket.com%2Fdevelopers%2FCLOB%2Fwebsocket%2Fmarket-channel" target="_blank" title="https://docs.polymarket.com/developers/CLOB/websocket/market-channel" ref="nofollow noopener noreferrer">Market Channel</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.polymarket.com%2Fquickstart%2Fwebsocket%2F" target="_blank" title="https://docs.polymarket.com/quickstart/websocket/" ref="nofollow noopener noreferrer">WSS Quickstart</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Meta Audience Network + AdMob åŒå¹³å°é›†æˆå®Œæ•´æŒ‡å—]]></title>    <link>https://juejin.cn/post/7604685644685164596</link>    <guid>https://juejin.cn/post/7604685644685164596</guid>    <pubDate>2026-02-10T02:25:14.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604685644685164596" data-draft-id="7604685644685115444" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Meta Audience Network + AdMob åŒå¹³å°é›†æˆå®Œæ•´æŒ‡å—"/> <meta itemprop="keywords" content="iOS"/> <meta itemprop="datePublished" content="2026-02-10T02:25:14.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å±±æ°´åŸŸ"/> <meta itemprop="url" content="https://juejin.cn/user/2260251635887309"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Meta Audience Network + AdMob åŒå¹³å°é›†æˆå®Œæ•´æŒ‡å—
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2260251635887309/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å±±æ°´åŸŸ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T02:25:14.000Z" title="Tue Feb 10 2026 02:25:14 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    14
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»21åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">ä¸€ã€æ¶æ„é€‰æ‹©ï¼šèšåˆå¹³å°ï¼ˆMediationï¼‰</h3>
<p>åŒæ—¶æ¥å…¥å¤šä¸ªå¹¿å‘Šç½‘ç»œï¼Œ<strong>å¼ºçƒˆæ¨èä½¿ç”¨å¹¿å‘Šèšåˆï¼ˆMediationï¼‰å¹³å°</strong>ï¼Œè€Œä¸æ˜¯è‡ªå·±æ‰‹åŠ¨ç®¡ç†åˆ‡æ¢é€»è¾‘ã€‚</p>
<h4 data-id="heading-1">1.1 ä¸»æµèšåˆå¹³å°å¯¹æ¯”</h4>






























<table><thead><tr><th>èšåˆå¹³å°</th><th>è¯´æ˜</th><th>æ¨èåº¦</th></tr></thead><tbody><tr><td><strong>Google AdMob Mediation</strong></td><td>AdMob å®˜æ–¹å†…ç½®èšåˆï¼Œæ”¯æŒ Meta AN ä½œä¸ºç¬¬ä¸‰æ–¹é€‚é…å™¨</td><td>â­â­â­â­â­</td></tr><tr><td><strong>AppLovin MAX</strong></td><td>ç‹¬ç«‹èšåˆå¹³å°ï¼Œæ”¯æŒå¹¿æ³›å¹¿å‘Šç½‘ç»œï¼Œå®æ—¶ç«ä»·èƒ½åŠ›å¼º</td><td>â­â­â­â­â­</td></tr><tr><td><strong>ironSource LevelPlay</strong></td><td>æ¸¸æˆé¢†åŸŸä¸»æµï¼Œå·²ä¸ Unity Ads åˆå¹¶</td><td>â­â­â­â­</td></tr><tr><td><strong>Mintegral / TopOn / TradPlus</strong></td><td>å›½å†…å‡ºæµ·å¸¸ç”¨ï¼Œæ”¯æŒå›½å†…å¤–ä¸»æµç½‘ç»œ</td><td>â­â­â­â­</td></tr></tbody></table>
<blockquote>
<p><strong>æœ¬æŒ‡å—é‡ç‚¹è®²è§£æœ€ä¸»æµçš„ä¸¤ç§æ–¹æ¡ˆï¼š</strong></p>
<ol>
<li><strong>Google AdMob Mediation</strong>ï¼ˆä»¥ AdMob ä¸ºä¸»ï¼ŒMeta AN åšç«ä»·è¡¥å……ï¼‰</li>
<li><strong>AppLovin MAX</strong>ï¼ˆç‹¬ç«‹èšåˆï¼ŒAdMob + Meta AN å¹¶è¡Œç«ä»·ï¼‰</li>
</ol>
</blockquote>
<hr/>
<h3 data-id="heading-2">äºŒã€æ–¹æ¡ˆä¸€ï¼šGoogle AdMob Mediation + Meta Audience Networkï¼ˆæ¨èï¼‰</h3>
<p>è¿™æ˜¯æœ€ç›´æ¥çš„æ–¹æ¡ˆâ€”â€”AdMob ä½œä¸ºèšåˆä¸»ä½“ï¼ŒMeta AN é€šè¿‡ <strong>Biddingï¼ˆå®æ—¶ç«ä»·ï¼‰</strong> å‚ä¸ç«äº‰ã€‚å¥½çš„ï¼Œå·²ç»è·å–åˆ°æ‰€æœ‰å…³é”®ä¿¡æ¯ã€‚ä¸‹é¢ä¸ºæ‚¨æ’°å†™å®Œæ•´è¯¦ç»†çš„é›†æˆæŒ‡å—ã€‚</p>
<hr/>
<h2 data-id="heading-3">Meta Audience Network + AdMob åŒå¹³å°é›†æˆå®Œæ•´æŒ‡å—ï¼ˆiOS/Swiftï¼‰</h2>
<hr/>
<h3 data-id="heading-4">ä¸€ã€æ¶æ„é€‰æ‹©ï¼šä¸ºä»€ä¹ˆéœ€è¦èšåˆï¼ˆMediationï¼‰ï¼Ÿ</h3>
<p>æ‰‹åŠ¨ç®¡ç†ä¸¤ä¸ªå¹¿å‘Š SDK çš„åŠ è½½ã€å±•ç¤ºã€é™çº§é€»è¾‘<strong>éå¸¸ç¹çä¸”å®¹æ˜“å‡ºé”™</strong>ã€‚ä½¿ç”¨ <strong>å¹¿å‘Šèšåˆå¹³å°</strong> å¯ä»¥ï¼š</p>
<ul>
<li>âœ… è‡ªåŠ¨è®©å¤šä¸ªå¹¿å‘Šç½‘ç»œå®æ—¶ç«ä»·ï¼ˆBiddingï¼‰ï¼Œæœ€å¤§åŒ–æ”¶ç›Š</li>
<li>âœ… ç»Ÿä¸€ API è°ƒç”¨ï¼Œä¸éœ€è¦ä¸ºæ¯ä¸ªå¹¿å‘Šç½‘ç»œå†™å•ç‹¬ä»£ç </li>
<li>âœ… è‡ªåŠ¨å¤„ç† No Fill é™çº§ï¼ˆA ç½‘ç»œæ²¡å¹¿å‘Šåˆ™è‡ªåŠ¨åˆ‡æ¢åˆ° Bï¼‰</li>
<li>âœ… ç»Ÿä¸€ç®¡ç†éšç§åˆè§„</li>
</ul>
<h4 data-id="heading-5">1.1 ä¸»æµèšåˆå¹³å°å¯¹æ¯”</h4>



































<table><thead><tr><th>èšåˆå¹³å°</th><th>ç‰¹ç‚¹</th><th>é€‚åˆåœºæ™¯</th><th>æ¨èåº¦</th></tr></thead><tbody><tr><td><strong>Google AdMob Mediation</strong></td><td>AdMob å®˜æ–¹å†…ç½®ï¼ŒMeta AN åšç«ä»·é€‚é…å™¨</td><td>å·²ä½¿ç”¨ AdMob çš„é¡¹ç›®ï¼Œæœ€ç®€å•</td><td>â­â­â­â­â­</td></tr><tr><td><strong>AppLovin MAX</strong></td><td>ç‹¬ç«‹èšåˆï¼Œä¸¤è€…å¹¶è¡Œç«ä»·ï¼Œå…¬æ­£é€æ˜</td><td>è¿½æ±‚æœ€é«˜ eCPM çš„æ¸¸æˆç±»åº”ç”¨</td><td>â­â­â­â­â­</td></tr><tr><td><strong>ironSource LevelPlay</strong></td><td>ä¸ Unity åˆå¹¶ï¼Œæ¸¸æˆé¢†åŸŸå¼ºåŠ¿</td><td>Unity æ¸¸æˆæˆ–å·²ä½¿ç”¨ ironSource</td><td>â­â­â­â­</td></tr><tr><td><strong>TopOn / TradPlus</strong></td><td>å›½å†…å‡ºæµ·å¸¸ç”¨ï¼Œæ”¯æŒå›½å†…å¤–ä¸»æµç½‘ç»œ</td><td>å‡ºæµ·åº”ç”¨åŒæ—¶æ¥å›½å†…å¤–å¹¿å‘Š</td><td>â­â­â­â­</td></tr></tbody></table>
<blockquote>
<p>ğŸ’¡ <strong>æœ¬æŒ‡å—é‡ç‚¹è®²è§£æœ€ä¸»æµçš„æ–¹æ¡ˆï¼šGoogle AdMob Mediation + Meta ANï¼ˆæ–¹æ¡ˆä¸€ï¼‰</strong> å’Œ <strong>AppLovin MAXï¼ˆæ–¹æ¡ˆäºŒï¼‰</strong></p>
</blockquote>
<hr/>
<h3 data-id="heading-6">äºŒã€æ–¹æ¡ˆä¸€ï¼šGoogle AdMob Mediation + Meta Audience Network</h3>
<blockquote>
<p><strong>æ ¸å¿ƒæ€è·¯ï¼š</strong> AdMob ä½œä¸ºä¸»èšåˆï¼ŒMeta AN é€šè¿‡ Bidding é€‚é…å™¨å‚ä¸å®æ—¶ç«ä»·ç«äº‰</p>
</blockquote>
<h4 data-id="heading-7">2.1 ç‰ˆæœ¬è¦æ±‚</h4>





























<table><thead><tr><th>æ¡ä»¶</th><th>æœ€ä½ç‰ˆæœ¬</th></tr></thead><tbody><tr><td>iOS Deployment Target</td><td><strong>13.0</strong></td></tr><tr><td>Google Mobile Ads SDK</td><td><strong>12.0.0+</strong>ï¼ˆæ¨èæœ€æ–°ï¼‰</td></tr><tr><td>Meta Audience Network SDK</td><td><strong>6.21.0</strong></td></tr><tr><td>Meta Adapter</td><td><strong>6.21.0.0</strong></td></tr><tr><td>Xcode</td><td>æœ€æ–°ç‰ˆæœ¬</td></tr></tbody></table>
<blockquote>
<p>âš ï¸ Meta AN è‡ª 2021 å¹´èµ· <strong>åªæ”¯æŒ Bidding</strong>ï¼ˆå®æ—¶ç«ä»·ï¼‰ï¼Œä¸å†æ”¯æŒ Waterfall</p>
</blockquote>
<h4 data-id="heading-8">2.2 CocoaPods å®‰è£…</h4>
<pre><code class="hljs language-ruby" lang="ruby">platform <span class="hljs-symbol">:ios</span>, <span class="hljs-string">'13.0'</span>

target <span class="hljs-string">'YourApp'</span> <span class="hljs-keyword">do</span>
  use_frameworks!

  <span class="hljs-comment"># â‘  Google Mobile Ads SDKï¼ˆAdMob ä¸»ä½“ï¼‰</span>
  pod <span class="hljs-string">'Google-Mobile-Ads-SDK'</span>

  <span class="hljs-comment"># â‘¡ Meta Audience Network Mediation Adapterï¼ˆè‡ªåŠ¨åŒ…å« FBAudienceNetwork SDKï¼‰</span>
  pod <span class="hljs-string">'GoogleMobileAdsMediationFacebook'</span>
<span class="hljs-keyword">end</span>
</code></pre>
<pre><code class="hljs language-bash" lang="bash">pod install --repo-update
</code></pre>
<blockquote>
<p>åªéœ€è¦æ·»åŠ  <code>GoogleMobileAdsMediationFacebook</code>ï¼Œå®ƒä¼š<strong>è‡ªåŠ¨æ‹‰å– <code>FBAudienceNetwork</code> SDK</strong>ï¼Œä¸éœ€è¦é¢å¤–å•ç‹¬å¼•å…¥ã€‚</p>
</blockquote>
<h4 data-id="heading-9">2.3 Info.plist é…ç½®</h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- â‘  AdMob App IDï¼ˆå¿…é¡»ï¼‰ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>GADApplicationIdentifier<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">string</span>&gt;</span>ca-app-pub-xxxxxxxxxxxxxxxx~yyyyyyyyyy<span class="hljs-tag">&lt;/<span class="hljs-name">string</span>&gt;</span>

<span class="hljs-comment">&lt;!-- â‘¡ App Tracking Transparency æƒé™è¯´æ˜ï¼ˆiOS 14.5+ å¿…é¡»ï¼‰ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>NSUserTrackingUsageDescription<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">string</span>&gt;</span>æ­¤æ ‡è¯†ç¬¦å°†ç”¨äºå‘æ‚¨æŠ•æ”¾ä¸ªæ€§åŒ–å¹¿å‘Š<span class="hljs-tag">&lt;/<span class="hljs-name">string</span>&gt;</span>

<span class="hljs-comment">&lt;!-- â‘¢ SKAdNetwork æ ‡è¯†ç¬¦ï¼ˆAdMob + Meta éƒ½éœ€è¦ï¼‰ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>SKAdNetworkItems<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">array</span>&gt;</span>
  <span class="hljs-comment">&lt;!-- Google --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">dict</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>SKAdNetworkIdentifier<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">string</span>&gt;</span>cstr6suwn9.skadnetwork<span class="hljs-tag">&lt;/<span class="hljs-name">string</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">dict</span>&gt;</span>
  <span class="hljs-comment">&lt;!-- Meta --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">dict</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>SKAdNetworkIdentifier<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">string</span>&gt;</span>v9wttpbfk9.skadnetwork<span class="hljs-tag">&lt;/<span class="hljs-name">string</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">dict</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">dict</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>SKAdNetworkIdentifier<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">string</span>&gt;</span>n38lu8286q.skadnetwork<span class="hljs-tag">&lt;/<span class="hljs-name">string</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">dict</span>&gt;</span>
  <span class="hljs-comment">&lt;!-- ... å®Œæ•´åˆ—è¡¨å‚è§ Google å’Œ Meta å®˜æ–¹æ–‡æ¡£ --&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">array</span>&gt;</span>
</code></pre>
<h4 data-id="heading-10">2.4 AppDelegate åˆå§‹åŒ–</h4>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">import</span> UIKit
<span class="hljs-keyword">import</span> GoogleMobileAds
<span class="hljs-keyword">import</span> FBAudienceNetwork
<span class="hljs-keyword">import</span> AppTrackingTransparency

<span class="hljs-keyword">@main</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">AppDelegate</span>: <span class="hljs-title class_">UIResponder</span>, <span class="hljs-title class_">UIApplicationDelegate</span> {

    <span class="hljs-keyword">func</span> <span class="hljs-title function_">application</span>(
        <span class="hljs-keyword">_</span> <span class="hljs-params">application</span>: <span class="hljs-type">UIApplication</span>,
        <span class="hljs-params">didFinishLaunchingWithOptions</span> <span class="hljs-params">launchOptions</span>: [<span class="hljs-type">UIApplication</span>.<span class="hljs-params">LaunchOptionsKey</span>: <span class="hljs-keyword">Any</span>]<span class="hljs-operator">?</span>
    ) -&gt; <span class="hljs-type">Bool</span> {

        <span class="hljs-comment">// â± å»¶è¿Ÿè¯·æ±‚ ATT æƒé™ï¼ˆå»ºè®®åœ¨é¦–é¡µ viewDidAppear ä¸­è°ƒç”¨æ›´å¥½ï¼‰</span>
        <span class="hljs-comment">// ä½†å¿…é¡»åœ¨å¹¿å‘Šè¯·æ±‚ä¹‹å‰å®Œæˆ</span>
        
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>
    }
}
</code></pre>
<h4 data-id="heading-11">2.5 ATT æƒé™è¯·æ±‚ + SDK åˆå§‹åŒ–ï¼ˆæ¨èå†™æ³•ï¼‰</h4>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">import</span> UIKit
<span class="hljs-keyword">import</span> GoogleMobileAds
<span class="hljs-keyword">import</span> FBAudienceNetwork
<span class="hljs-keyword">import</span> AppTrackingTransparency

<span class="hljs-keyword">class</span> <span class="hljs-title class_">MainViewController</span>: <span class="hljs-title class_">UIViewController</span> {

    <span class="hljs-keyword">override</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">viewDidAppear</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">animated</span>: <span class="hljs-type">Bool</span>) {
        <span class="hljs-keyword">super</span>.viewDidAppear(animated)
        requestATTThenInitializeAds()
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">requestATTThenInitializeAds</span>() {
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">#available</span>(<span class="hljs-keyword">iOS</span> <span class="hljs-number">14.5</span>, <span class="hljs-operator">*</span>) {
            <span class="hljs-comment">// â‘  å…ˆè¯·æ±‚ ATT æƒé™</span>
            <span class="hljs-type">ATTrackingManager</span>.requestTrackingAuthorization { [<span class="hljs-keyword">weak</span> <span class="hljs-keyword">self</span>] status <span class="hljs-keyword">in</span>
                <span class="hljs-type">DispatchQueue</span>.main.async {
                    <span class="hljs-comment">// â‘¡ æ ¹æ®ç»“æœè®¾ç½® Meta ATE æ ‡å¿—</span>
                    <span class="hljs-comment">// æ³¨æ„ï¼šSDK 6.15.0+ åœ¨ iOS 17+ ä¼šè‡ªåŠ¨è¯»å– ATT çŠ¶æ€</span>
                    <span class="hljs-comment">// ä½† iOS 14.5 ~ 16.x ä»éœ€è¦æ‰‹åŠ¨è®¾ç½®</span>
                    <span class="hljs-keyword">switch</span> status {
                    <span class="hljs-keyword">case</span> .authorized:
                        <span class="hljs-type">FBAdSettings</span>.setAdvertiserTrackingEnabled(<span class="hljs-literal">true</span>)
                    <span class="hljs-keyword">case</span> .denied, .restricted:
                        <span class="hljs-type">FBAdSettings</span>.setAdvertiserTrackingEnabled(<span class="hljs-literal">false</span>)
                    <span class="hljs-keyword">case</span> .notDetermined:
                        <span class="hljs-type">FBAdSettings</span>.setAdvertiserTrackingEnabled(<span class="hljs-literal">false</span>)
                    <span class="hljs-keyword">@unknown</span> <span class="hljs-keyword">default</span>:
                        <span class="hljs-keyword">break</span>
                    }

                    <span class="hljs-comment">// â‘¢ ATT å®Œæˆåå†åˆå§‹åŒ– Google Mobile Ads SDK</span>
                    <span class="hljs-keyword">self</span><span class="hljs-operator">?</span>.initializeGoogleAds()
                }
            }
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// iOS 14.5 ä»¥ä¸‹ç›´æ¥åˆå§‹åŒ–</span>
            initializeGoogleAds()
        }
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">initializeGoogleAds</span>() {
        <span class="hljs-comment">// Google Mobile Ads SDK åˆå§‹åŒ–ï¼ˆä¼šåŒæ—¶åˆå§‹åŒ–æ‰€æœ‰ Mediation Adapterï¼‰</span>
        <span class="hljs-type">GADMobileAds</span>.sharedInstance().start { status <span class="hljs-keyword">in</span>
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"âœ… AdMob SDK åˆå§‹åŒ–å®Œæˆ"</span>)

            <span class="hljs-comment">// æ‰“å°å„ Adapter çŠ¶æ€</span>
            <span class="hljs-keyword">let</span> adapterStatuses <span class="hljs-operator">=</span> status.adapterStatusesByClassName
            <span class="hljs-keyword">for</span> (adapter, status) <span class="hljs-keyword">in</span> adapterStatuses {
                <span class="hljs-built_in">print</span>(<span class="hljs-string">"  Adapter: <span class="hljs-subst">\(adapter)</span>, State: <span class="hljs-subst">\(status.state.rawValue)</span>, Desc: <span class="hljs-subst">\(status.description)</span>"</span>)
            }
        }
    }
}
</code></pre>
<blockquote>
<p>âš ï¸ <strong>å…³é”®é¡ºåºï¼šATT æƒé™ â†’ è®¾ç½® Meta ATE â†’ åˆå§‹åŒ– GADMobileAds</strong></p>
<p>Google AdMob Mediation åˆå§‹åŒ–æ—¶ä¼šè‡ªåŠ¨åˆå§‹åŒ– Meta AN SDK é€‚é…å™¨ï¼Œ<strong>ä¸éœ€è¦</strong>å•ç‹¬è°ƒç”¨ <code>FBAudienceNetworkAds.initialize()</code></p>
</blockquote>
<h4 data-id="heading-12">2.6 Banner å¹¿å‘Šï¼ˆé€šè¿‡ AdMob èšåˆï¼‰</h4>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">import</span> UIKit
<span class="hljs-keyword">import</span> GoogleMobileAds

<span class="hljs-keyword">class</span> <span class="hljs-title class_">BannerViewController</span>: <span class="hljs-title class_">UIViewController</span>, <span class="hljs-title class_">GADBannerViewDelegate</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> bannerView: <span class="hljs-type">GADBannerView</span>!

    <span class="hljs-keyword">override</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">viewDidLoad</span>() {
        <span class="hljs-keyword">super</span>.viewDidLoad()
        setupBanner()
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">setupBanner</span>() {
        <span class="hljs-comment">// ä½¿ç”¨ AdMob çš„ Ad Unit IDï¼ˆåœ¨ AdMob åå°é…ç½®äº† Meta Mediation çš„å¹¿å‘Šå•å…ƒï¼‰</span>
        bannerView <span class="hljs-operator">=</span> <span class="hljs-type">GADBannerView</span>(adSize: <span class="hljs-type">GADAdSizeBanner</span>) <span class="hljs-comment">// 320Ã—50</span>
        bannerView.adUnitID <span class="hljs-operator">=</span> <span class="hljs-string">"ca-app-pub-xxxxx/yyyyy"</span> <span class="hljs-comment">// â¬…ï¸ AdMob Ad Unit ID</span>
        bannerView.rootViewController <span class="hljs-operator">=</span> <span class="hljs-keyword">self</span>
        bannerView.delegate <span class="hljs-operator">=</span> <span class="hljs-keyword">self</span>
        bannerView.translatesAutoresizingMaskIntoConstraints <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>

        view.addSubview(bannerView)
        <span class="hljs-type">NSLayoutConstraint</span>.activate([
            bannerView.bottomAnchor.constraint(equalTo: view.safeAreaLayoutGuide.bottomAnchor),
            bannerView.centerXAnchor.constraint(equalTo: view.centerXAnchor)
        ])

        bannerView.load(<span class="hljs-type">GADRequest</span>())
    }

    <span class="hljs-comment">// MARK: - GADBannerViewDelegate</span>

    <span class="hljs-keyword">func</span> <span class="hljs-title function_">bannerViewDidReceiveAd</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">bannerView</span>: <span class="hljs-type">GADBannerView</span>) {
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"âœ… Banner åŠ è½½æˆåŠŸ"</span>)
        <span class="hljs-comment">// å¯é€šè¿‡ bannerView.responseInfo æŸ¥çœ‹æ˜¯å“ªä¸ªç½‘ç»œå¡«å……çš„</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> adNetworkClassName <span class="hljs-operator">=</span> bannerView.responseInfo<span class="hljs-operator">?</span>.loadedAdNetworkResponseInfo<span class="hljs-operator">?</span>.adNetworkClassName {
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"  å¡«å……æ¥æº: <span class="hljs-subst">\(adNetworkClassName)</span>"</span>)
            <span class="hljs-comment">// å¦‚æœæ˜¯ Meta å¡«å……ï¼Œä¼šæ˜¾ç¤º GADMediationAdapterFacebook</span>
        }
    }

    <span class="hljs-keyword">func</span> <span class="hljs-title function_">bannerView</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">bannerView</span>: <span class="hljs-type">GADBannerView</span>, <span class="hljs-params">didFailToReceiveAdWithError</span> <span class="hljs-params">error</span>: <span class="hljs-type">Error</span>) {
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"âŒ Banner åŠ è½½å¤±è´¥: <span class="hljs-subst">\(error.localizedDescription)</span>"</span>)
    }

    <span class="hljs-keyword">func</span> <span class="hljs-title function_">bannerViewDidRecordImpression</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">bannerView</span>: <span class="hljs-type">GADBannerView</span>) {
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"ğŸ‘ï¸ Banner æ›å…‰"</span>)
    }

    <span class="hljs-keyword">func</span> <span class="hljs-title function_">bannerViewDidRecordClick</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">bannerView</span>: <span class="hljs-type">GADBannerView</span>) {
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"ğŸ‘† Banner ç‚¹å‡»"</span>)
    }
}
</code></pre>
<h4 data-id="heading-13">2.7 Interstitial æ’å±å¹¿å‘Šï¼ˆé€šè¿‡ AdMob èšåˆï¼‰</h4>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">import</span> UIKit
<span class="hljs-keyword">import</span> GoogleMobileAds

<span class="hljs-keyword">class</span> <span class="hljs-title class_">InterstitialViewController</span>: <span class="hljs-title class_">UIViewController</span>, <span class="hljs-title class_">GADFullScreenContentDelegate</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> interstitialAd: <span class="hljs-type">GADInterstitialAd</span>?

    <span class="hljs-keyword">override</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">viewDidLoad</span>() {
        <span class="hljs-keyword">super</span>.viewDidLoad()
        loadInterstitialAd()
    }

    <span class="hljs-comment">/// æå‰åŠ è½½æ’å±å¹¿å‘Š</span>
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">loadInterstitialAd</span>() {
        <span class="hljs-type">GADInterstitialAd</span>.load(
            withAdUnitID: <span class="hljs-string">"ca-app-pub-xxxxx/yyyyy"</span>, <span class="hljs-comment">// â¬…ï¸ AdMob Ad Unit ID</span>
            request: <span class="hljs-type">GADRequest</span>()
        ) { [<span class="hljs-keyword">weak</span> <span class="hljs-keyword">self</span>] ad, error <span class="hljs-keyword">in</span>
            <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> error <span class="hljs-operator">=</span> error {
                <span class="hljs-built_in">print</span>(<span class="hljs-string">"âŒ æ’å±å¹¿å‘ŠåŠ è½½å¤±è´¥: <span class="hljs-subst">\(error.localizedDescription)</span>"</span>)
                <span class="hljs-keyword">return</span>
            }
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"âœ… æ’å±å¹¿å‘ŠåŠ è½½æˆåŠŸ"</span>)
            <span class="hljs-keyword">self</span><span class="hljs-operator">?</span>.interstitialAd <span class="hljs-operator">=</span> ad
            <span class="hljs-keyword">self</span><span class="hljs-operator">?</span>.interstitialAd<span class="hljs-operator">?</span>.fullScreenContentDelegate <span class="hljs-operator">=</span> <span class="hljs-keyword">self</span>

            <span class="hljs-comment">// æŸ¥çœ‹å¡«å……æ¥æº</span>
            <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> adNetwork <span class="hljs-operator">=</span> ad<span class="hljs-operator">?</span>.responseInfo.loadedAdNetworkResponseInfo<span class="hljs-operator">?</span>.adNetworkClassName {
                <span class="hljs-built_in">print</span>(<span class="hljs-string">"  å¡«å……æ¥æº: <span class="hljs-subst">\(adNetwork)</span>"</span>)
            }
        }
    }

    <span class="hljs-comment">/// åœ¨åˆé€‚æ—¶æœºå±•ç¤º</span>
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">showInterstitialAd</span>() {
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> ad <span class="hljs-operator">=</span> interstitialAd {
            ad.present(fromRootViewController: <span class="hljs-keyword">self</span>)
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"âš ï¸ å¹¿å‘Šå°šæœªå°±ç»ª"</span>)
        }
    }

    <span class="hljs-comment">// MARK: - GADFullScreenContentDelegate</span>

    <span class="hljs-keyword">func</span> <span class="hljs-title function_">ad</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">ad</span>: <span class="hljs-type">GADFullScreenPresentingAd</span>, <span class="hljs-params">didFailToPresentFullScreenContentWithError</span> <span class="hljs-params">error</span>: <span class="hljs-type">Error</span>) {
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"âŒ å±•ç¤ºå¤±è´¥: <span class="hljs-subst">\(error.localizedDescription)</span>"</span>)
        loadInterstitialAd() <span class="hljs-comment">// é‡æ–°åŠ è½½</span>
    }

    <span class="hljs-keyword">func</span> <span class="hljs-title function_">adDidDismissFullScreenContent</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">ad</span>: <span class="hljs-type">GADFullScreenPresentingAd</span>) {
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"âœ… æ’å±å¹¿å‘Šå·²å…³é—­"</span>)
        loadInterstitialAd() <span class="hljs-comment">// â­ å…³é—­åé¢„åŠ è½½ä¸‹ä¸€ä¸ª</span>
    }

    <span class="hljs-keyword">func</span> <span class="hljs-title function_">adDidRecordImpression</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">ad</span>: <span class="hljs-type">GADFullScreenPresentingAd</span>) {
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"ğŸ‘ï¸ æ’å±å¹¿å‘Šæ›å…‰"</span>)
    }
}
</code></pre>
<h4 data-id="heading-14">2.9 AdMob åå°é…ç½® Meta AN Mediationï¼ˆå…³é”®æ­¥éª¤ï¼‰</h4>
<p>åœ¨ AdMob åå°å®Œæˆä»¥ä¸‹é…ç½®ï¼Œæ‰èƒ½è®© Meta AN å‚ä¸ç«ä»·ï¼š</p>
<h5 data-id="heading-15">æ­¥éª¤ 1ï¼šMeta åå°åˆ›å»ºå¹¿å‘Šä½</h5>
<ol>
<li>ç™»å½• <a href="https://link.juejin.cn?target=https%3A%2F%2Fbusiness.facebook.com%2Fpub%2Fstart" target="_blank" title="https://business.facebook.com/pub/start" ref="nofollow noopener noreferrer">Meta Business Suite â†’ Monetization Manager</a></li>
<li>åˆ›å»º Property â†’ é€‰æ‹© iOS å¹³å°</li>
<li><strong>Mediation Platform é€‰æ‹© "AdMob"</strong></li>
<li>ä¸ºæ¯ç§æ ¼å¼ï¼ˆBanner / Interstitial / Rewardedï¼‰åˆ›å»º Placement</li>
<li><strong>è®°å½•æ¯ä¸ª Placement ID</strong>ï¼ˆæ ¼å¼å¦‚ <code>123456789_987654321</code>ï¼‰</li>
</ol>
<h5 data-id="heading-16">æ­¥éª¤ 2ï¼šAdMob åå°æ·»åŠ  Meta ç«ä»·</h5>
<ol>
<li>ç™»å½• <a href="https://link.juejin.cn?target=https%3A%2F%2Fapps.admob.com%2F" target="_blank" title="https://apps.admob.com/" ref="nofollow noopener noreferrer">AdMob Console</a></li>
<li>å¯¼èˆªåˆ° <strong>Mediation â†’ Mediation Groups</strong></li>
<li>åˆ›å»ºæˆ–ç¼–è¾‘ä¸€ä¸ª Mediation Group</li>
<li>åœ¨ <strong>Bidding</strong> åŒºåŸŸï¼Œç‚¹å‡» <strong>Add Ad Sources â†’ Meta Audience Network</strong></li>
<li>è¾“å…¥ Meta çš„ <strong>Placement ID</strong></li>
<li>ä¿å­˜</li>
</ol>
<blockquote>
<p>ğŸ’¡ AdMob ä¼šè‡ªåŠ¨ä¸ Meta è¿›è¡Œå®æ—¶ç«ä»·ï¼ˆBiddingï¼‰ï¼Œ<strong>ä¸éœ€è¦è®¾ç½® eCPM æ‰‹åŠ¨æ’åº</strong></p>
</blockquote>
<h5 data-id="heading-17">æ­¥éª¤ 3ï¼šé…ç½® app-ads.txt</h5>
<p>åœ¨æ‚¨çš„å¼€å‘è€…ç½‘ç«™æ ¹ç›®å½•æ·»åŠ  <code>app-ads.txt</code> æ–‡ä»¶ï¼ŒåŒ…å« AdMob å’Œ Meta çš„æˆæƒè¡Œï¼š</p>
<pre><code class="hljs language-text" lang="text"># Google AdMob
google.com, pub-xxxxxxxxxxxxxxxx, DIRECT, f08c47fec0942fa0

# Meta Audience Network
facebook.com, xxxxxxxxxxxxxxxxx, RESELLER, c3e20eee3f780d68
</code></pre>
<hr/>
<h3 data-id="heading-18">ä¸‰ã€æ–¹æ¡ˆäºŒï¼šAppLovin MAX èšåˆï¼ˆç‹¬ç«‹èšåˆå¹³å°ï¼‰</h3>
<blockquote>
<p><strong>æ ¸å¿ƒæ€è·¯ï¼š</strong> MAX ä½œä¸ºç‹¬ç«‹èšåˆï¼ŒAdMob å’Œ Meta AN åŒä¸ºç«ä»·å‚ä¸è€…ï¼Œæ›´åŠ å…¬å¹³é€æ˜å¥½çš„ï¼Œå·²ç»è·å–åˆ°äº†æ‰€æœ‰éœ€è¦çš„ä¿¡æ¯ã€‚ä»¥ä¸‹æ˜¯å®Œæ•´çš„åç»­å†…å®¹ï¼š</p>
</blockquote>
<hr/>
<h4 data-id="heading-19">3.1 CocoaPods å®‰è£…</h4>
<pre><code class="hljs language-ruby" lang="ruby">platform <span class="hljs-symbol">:ios</span>, <span class="hljs-string">'13.0'</span>

target <span class="hljs-string">'YourApp'</span> <span class="hljs-keyword">do</span>
  use_frameworks!
  inhibit_all_warnings!

  <span class="hljs-comment"># â‘  AppLovin MAX SDKï¼ˆèšåˆä¸»ä½“ï¼‰</span>
  pod <span class="hljs-string">'AppLovinSDK'</span>

  <span class="hljs-comment"># â‘¡ Google AdMob é€‚é…å™¨ï¼ˆè‡ªåŠ¨åŒ…å« Google Mobile Ads SDKï¼‰</span>
  pod <span class="hljs-string">'AppLovinMediationGoogleAdapter'</span>

  <span class="hljs-comment"># â‘¢ Meta Audience Network é€‚é…å™¨ï¼ˆè‡ªåŠ¨åŒ…å« FBAudienceNetwork SDKï¼‰</span>
  pod <span class="hljs-string">'AppLovinMediationFacebookAdapter'</span>
<span class="hljs-keyword">end</span>
</code></pre>
<pre><code class="hljs language-bash" lang="bash">pod install --repo-update
</code></pre>
<blockquote>
<p>ğŸ’¡ <strong>åªéœ€å®‰è£…é€‚é…å™¨ Podï¼Œå®ƒä»¬ä¼šè‡ªåŠ¨æ‹‰å–å¯¹åº”çš„å¹¿å‘Šç½‘ç»œ SDK</strong></p>
</blockquote>
<h4 data-id="heading-20">3.2 Info.plist é…ç½®</h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- â‘  AppLovin SDK Key --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>AppLovinSdkKey<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">string</span>&gt;</span>YOUR_APPLOVIN_SDK_KEY<span class="hljs-tag">&lt;/<span class="hljs-name">string</span>&gt;</span>

<span class="hljs-comment">&lt;!-- â‘¡ AdMob App IDï¼ˆGoogle Adapter éœ€è¦ï¼‰ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>GADApplicationIdentifier<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">string</span>&gt;</span>ca-app-pub-xxxxxxxxxxxxxxxx~yyyyyyyyyy<span class="hljs-tag">&lt;/<span class="hljs-name">string</span>&gt;</span>

<span class="hljs-comment">&lt;!-- â‘¢ ATT æƒé™æè¿° --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>NSUserTrackingUsageDescription<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">string</span>&gt;</span>æ­¤æ ‡è¯†ç¬¦å°†ç”¨äºå‘æ‚¨æŠ•æ”¾ä¸ªæ€§åŒ–å¹¿å‘Š<span class="hljs-tag">&lt;/<span class="hljs-name">string</span>&gt;</span>

<span class="hljs-comment">&lt;!-- â‘£ SKAdNetwork æ ‡è¯†ç¬¦ï¼ˆAppLovin + Google + Meta éƒ½éœ€è¦ï¼‰ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>SKAdNetworkItems<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">array</span>&gt;</span>
  <span class="hljs-comment">&lt;!-- AppLovin --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">dict</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>SKAdNetworkIdentifier<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">string</span>&gt;</span>ludvb6z3bs.skadnetwork<span class="hljs-tag">&lt;/<span class="hljs-name">string</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">dict</span>&gt;</span>
  <span class="hljs-comment">&lt;!-- Google --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">dict</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>SKAdNetworkIdentifier<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">string</span>&gt;</span>cstr6suwn9.skadnetwork<span class="hljs-tag">&lt;/<span class="hljs-name">string</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">dict</span>&gt;</span>
  <span class="hljs-comment">&lt;!-- Meta --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">dict</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>SKAdNetworkIdentifier<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">string</span>&gt;</span>v9wttpbfk9.skadnetwork<span class="hljs-tag">&lt;/<span class="hljs-name">string</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">dict</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">dict</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>SKAdNetworkIdentifier<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">string</span>&gt;</span>n38lu8286q.skadnetwork<span class="hljs-tag">&lt;/<span class="hljs-name">string</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">dict</span>&gt;</span>
  <span class="hljs-comment">&lt;!-- ... å®Œæ•´åˆ—è¡¨ä»å„å¹³å°æ–‡æ¡£è·å– --&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">array</span>&gt;</span>
</code></pre>
<h4 data-id="heading-21">3.3 SDK åˆå§‹åŒ–</h4>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">import</span> UIKit
<span class="hljs-keyword">import</span> AppLovinSDK
<span class="hljs-keyword">import</span> FBAudienceNetwork
<span class="hljs-keyword">import</span> AppTrackingTransparency

<span class="hljs-keyword">@main</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">AppDelegate</span>: <span class="hljs-title class_">UIResponder</span>, <span class="hljs-title class_">UIApplicationDelegate</span> {

    <span class="hljs-keyword">func</span> <span class="hljs-title function_">application</span>(
        <span class="hljs-keyword">_</span> <span class="hljs-params">application</span>: <span class="hljs-type">UIApplication</span>,
        <span class="hljs-params">didFinishLaunchingWithOptions</span> <span class="hljs-params">launchOptions</span>: [<span class="hljs-type">UIApplication</span>.<span class="hljs-params">LaunchOptionsKey</span>: <span class="hljs-keyword">Any</span>]<span class="hljs-operator">?</span>
    ) -&gt; <span class="hljs-type">Bool</span> {

        <span class="hljs-comment">// â‘  è¯·æ±‚ ATT æƒé™ï¼ˆå»¶è¿Ÿåˆ°é¦–é¡µæ›´å¥½ï¼Œæ­¤å¤„ç®€åŒ–æ¼”ç¤ºï¼‰</span>
        <span class="hljs-type">DispatchQueue</span>.main.asyncAfter(deadline: .now() <span class="hljs-operator">+</span> <span class="hljs-number">1.0</span>) {
            <span class="hljs-keyword">self</span>.requestATTAndInitialize()
        }

        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">requestATTAndInitialize</span>() {
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">#available</span>(<span class="hljs-keyword">iOS</span> <span class="hljs-number">14.5</span>, <span class="hljs-operator">*</span>) {
            <span class="hljs-type">ATTrackingManager</span>.requestTrackingAuthorization { [<span class="hljs-keyword">weak</span> <span class="hljs-keyword">self</span>] status <span class="hljs-keyword">in</span>
                <span class="hljs-type">DispatchQueue</span>.main.async {
                    <span class="hljs-comment">// â‘¡ è®¾ç½® Meta ATE æ ‡å¿—</span>
                    <span class="hljs-keyword">switch</span> status {
                    <span class="hljs-keyword">case</span> .authorized:
                        <span class="hljs-type">FBAdSettings</span>.setAdvertiserTrackingEnabled(<span class="hljs-literal">true</span>)
                    <span class="hljs-keyword">default</span>:
                        <span class="hljs-type">FBAdSettings</span>.setAdvertiserTrackingEnabled(<span class="hljs-literal">false</span>)
                    }

                    <span class="hljs-comment">// â‘¢ åˆå§‹åŒ– AppLovin MAX SDK</span>
                    <span class="hljs-keyword">self</span><span class="hljs-operator">?</span>.initializeMAX()
                }
            }
        } <span class="hljs-keyword">else</span> {
            initializeMAX()
        }
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">initializeMAX</span>() {
        <span class="hljs-comment">// SDK Key å¯åœ¨ AppLovin Dashboard â†’ Account â†’ General â†’ Keys æ‰¾åˆ°</span>
        <span class="hljs-keyword">let</span> initConfig <span class="hljs-operator">=</span> <span class="hljs-type">ALSdkInitializationConfiguration</span>(sdkKey: <span class="hljs-string">"YOUR_SDK_KEY"</span>) { builder <span class="hljs-keyword">in</span>
            builder.mediationProvider <span class="hljs-operator">=</span> <span class="hljs-type">ALMediationProviderMAX</span>

            <span class="hljs-comment">// ï¼ˆå¯é€‰ï¼‰å¦‚æœéœ€è¦æµ‹è¯•ç‰¹å®šå¹¿å‘Šå•å…ƒ</span>
            <span class="hljs-comment">// builder.testDeviceAdvertisingIdentifiers = ["YOUR_IDFA"]</span>
        }

        <span class="hljs-type">ALSdk</span>.shared().initialize(with: initConfig) { sdkConfig <span class="hljs-keyword">in</span>
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"âœ… AppLovin MAX SDK åˆå§‹åŒ–å®Œæˆ"</span>)
            <span class="hljs-comment">// æ­¤æ—¶å¯ä»¥å¼€å§‹åŠ è½½å¹¿å‘Š</span>
        }
    }
}
</code></pre>
<h4 data-id="heading-22">3.4 Banner å¹¿å‘Š</h4>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">import</span> UIKit
<span class="hljs-keyword">import</span> AppLovinSDK

<span class="hljs-keyword">class</span> <span class="hljs-title class_">MAXBannerViewController</span>: <span class="hljs-title class_">UIViewController</span>, <span class="hljs-title class_">MAAdViewAdDelegate</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> adView: <span class="hljs-type">MAAdView</span>!

    <span class="hljs-keyword">override</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">viewDidLoad</span>() {
        <span class="hljs-keyword">super</span>.viewDidLoad()
        createBannerAd()
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">createBannerAd</span>() {
        <span class="hljs-comment">// Ad Unit ID åœ¨ AppLovin Dashboard â†’ MAX â†’ Ad Units åˆ›å»º</span>
        adView <span class="hljs-operator">=</span> <span class="hljs-type">MAAdView</span>(adUnitIdentifier: <span class="hljs-string">"YOUR_AD_UNIT_ID"</span>)
        adView.delegate <span class="hljs-operator">=</span> <span class="hljs-keyword">self</span>

        <span class="hljs-comment">// Banner å°ºå¯¸ï¼šiPhone 50pt / iPad 90pt</span>
        <span class="hljs-keyword">let</span> height: <span class="hljs-type">CGFloat</span> <span class="hljs-operator">=</span> <span class="hljs-type">UIDevice</span>.current.userInterfaceIdiom <span class="hljs-operator">==</span> .pad <span class="hljs-operator">?</span> <span class="hljs-number">90</span> : <span class="hljs-number">50</span>
        <span class="hljs-keyword">let</span> width: <span class="hljs-type">CGFloat</span> <span class="hljs-operator">=</span> <span class="hljs-type">UIScreen</span>.main.bounds.width

        adView.frame <span class="hljs-operator">=</span> <span class="hljs-type">CGRect</span>(
            x: <span class="hljs-number">0</span>,
            y: view.bounds.height <span class="hljs-operator">-</span> height <span class="hljs-operator">-</span> view.safeAreaInsets.bottom,
            width: width,
            height: height
        )
        adView.backgroundColor <span class="hljs-operator">=</span> .clear

        view.addSubview(adView)

        <span class="hljs-comment">// åŠ è½½å¹¿å‘Šï¼ˆBanner é»˜è®¤è‡ªåŠ¨åˆ·æ–°ï¼‰</span>
        adView.loadAd()
    }

    <span class="hljs-comment">// MARK: - MAAdViewAdDelegate</span>

    <span class="hljs-keyword">func</span> <span class="hljs-title function_">didLoad</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">ad</span>: <span class="hljs-type">MAAd</span>) {
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"âœ… Banner åŠ è½½æˆåŠŸ, æ¥æº: <span class="hljs-subst">\(ad.networkName)</span>"</span>)
        <span class="hljs-comment">// ad.networkName ä¼šæ˜¾ç¤º "Google Bidding and Google AdMob" æˆ– "Meta Audience Network"</span>
    }

    <span class="hljs-keyword">func</span> <span class="hljs-title function_">didFailToLoadAd</span>(<span class="hljs-params">forAdUnitIdentifier</span> <span class="hljs-params">adUnitIdentifier</span>: <span class="hljs-type">String</span>, <span class="hljs-params">withError</span> <span class="hljs-params">error</span>: <span class="hljs-type">MAError</span>) {
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"âŒ Banner åŠ è½½å¤±è´¥: <span class="hljs-subst">\(error.message)</span>"</span>)
    }

    <span class="hljs-keyword">func</span> <span class="hljs-title function_">didClick</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">ad</span>: <span class="hljs-type">MAAd</span>) {
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"ğŸ‘† Banner ç‚¹å‡»"</span>)
    }

    <span class="hljs-keyword">func</span> <span class="hljs-title function_">didFail</span>(<span class="hljs-params">toDisplay</span> <span class="hljs-params">ad</span>: <span class="hljs-type">MAAd</span>, <span class="hljs-params">withError</span> <span class="hljs-params">error</span>: <span class="hljs-type">MAError</span>) {
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"âŒ Banner å±•ç¤ºå¤±è´¥"</span>)
    }

    <span class="hljs-keyword">func</span> <span class="hljs-title function_">didExpand</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">ad</span>: <span class="hljs-type">MAAd</span>) {
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"ğŸ“ Banner å±•å¼€"</span>)
    }

    <span class="hljs-keyword">func</span> <span class="hljs-title function_">didCollapse</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">ad</span>: <span class="hljs-type">MAAd</span>) {
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"ğŸ“ Banner æŠ˜å "</span>)
    }

    <span class="hljs-keyword">deinit</span> {
        adView.delegate <span class="hljs-operator">=</span> <span class="hljs-literal">nil</span>
        adView.removeFromSuperview()
    }
}
</code></pre>
<h4 data-id="heading-23">3.5 Interstitial æ’å±å¹¿å‘Š</h4>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">import</span> UIKit
<span class="hljs-keyword">import</span> AppLovinSDK

<span class="hljs-keyword">class</span> <span class="hljs-title class_">MAXInterstitialViewController</span>: <span class="hljs-title class_">UIViewController</span>, <span class="hljs-title class_">MAAdDelegate</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> interstitialAd: <span class="hljs-type">MAInterstitialAd</span>!
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> retryAttempt <span class="hljs-operator">=</span> <span class="hljs-number">0</span>

    <span class="hljs-keyword">override</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">viewDidLoad</span>() {
        <span class="hljs-keyword">super</span>.viewDidLoad()
        createInterstitialAd()
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">createInterstitialAd</span>() {
        interstitialAd <span class="hljs-operator">=</span> <span class="hljs-type">MAInterstitialAd</span>(adUnitIdentifier: <span class="hljs-string">"YOUR_AD_UNIT_ID"</span>)
        interstitialAd.delegate <span class="hljs-operator">=</span> <span class="hljs-keyword">self</span>
        interstitialAd.load()
    }

    <span class="hljs-comment">/// åœ¨åˆé€‚æ—¶æœºå±•ç¤º</span>
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">showInterstitialAd</span>() {
        <span class="hljs-keyword">if</span> interstitialAd.isReady {
            interstitialAd.show()
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"âš ï¸ æ’å±å¹¿å‘Šå°šæœªå°±ç»ª"</span>)
        }
    }

    <span class="hljs-comment">// MARK: - MAAdDelegate</span>

    <span class="hljs-keyword">func</span> <span class="hljs-title function_">didLoad</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">ad</span>: <span class="hljs-type">MAAd</span>) {
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"âœ… æ’å±åŠ è½½æˆåŠŸ, æ¥æº: <span class="hljs-subst">\(ad.networkName)</span>"</span>)
        retryAttempt <span class="hljs-operator">=</span> <span class="hljs-number">0</span>
    }

    <span class="hljs-keyword">func</span> <span class="hljs-title function_">didFailToLoadAd</span>(<span class="hljs-params">forAdUnitIdentifier</span> <span class="hljs-params">adUnitIdentifier</span>: <span class="hljs-type">String</span>, <span class="hljs-params">withError</span> <span class="hljs-params">error</span>: <span class="hljs-type">MAError</span>) {
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"âŒ æ’å±åŠ è½½å¤±è´¥: <span class="hljs-subst">\(error.message)</span>"</span>)

        <span class="hljs-comment">// â­ æŒ‡æ•°é€€é¿é‡è¯•ï¼ˆæœ€å¤§ 64 ç§’ï¼‰</span>
        retryAttempt <span class="hljs-operator">+=</span> <span class="hljs-number">1</span>
        <span class="hljs-keyword">let</span> delaySec <span class="hljs-operator">=</span> pow(<span class="hljs-number">2.0</span>, <span class="hljs-built_in">min</span>(<span class="hljs-number">6.0</span>, <span class="hljs-type">Double</span>(retryAttempt)))
        <span class="hljs-type">DispatchQueue</span>.main.asyncAfter(deadline: .now() <span class="hljs-operator">+</span> delaySec) { [<span class="hljs-keyword">weak</span> <span class="hljs-keyword">self</span>] <span class="hljs-keyword">in</span>
            <span class="hljs-keyword">self</span><span class="hljs-operator">?</span>.interstitialAd.load()
        }
    }

    <span class="hljs-keyword">func</span> <span class="hljs-title function_">didDisplay</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">ad</span>: <span class="hljs-type">MAAd</span>) {
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"ğŸ“º æ’å±å·²å±•ç¤º"</span>)
    }

    <span class="hljs-keyword">func</span> <span class="hljs-title function_">didHide</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">ad</span>: <span class="hljs-type">MAAd</span>) {
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"âœ… æ’å±å·²å…³é—­"</span>)
        <span class="hljs-comment">// â­ å…³é—­åé¢„åŠ è½½ä¸‹ä¸€ä¸ª</span>
        interstitialAd.load()
    }

    <span class="hljs-keyword">func</span> <span class="hljs-title function_">didClick</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">ad</span>: <span class="hljs-type">MAAd</span>) {
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"ğŸ‘† æ’å±è¢«ç‚¹å‡»"</span>)
    }

    <span class="hljs-keyword">func</span> <span class="hljs-title function_">didFail</span>(<span class="hljs-params">toDisplay</span> <span class="hljs-params">ad</span>: <span class="hljs-type">MAAd</span>, <span class="hljs-params">withError</span> <span class="hljs-params">error</span>: <span class="hljs-type">MAError</span>) {
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"âŒ æ’å±å±•ç¤ºå¤±è´¥"</span>)
        interstitialAd.load()
    }
}
</code></pre>
<h4 data-id="heading-24">3.6 Rewarded æ¿€åŠ±è§†é¢‘å¹¿å‘Š</h4>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">import</span> UIKit
<span class="hljs-keyword">import</span> AppLovinSDK

<span class="hljs-keyword">class</span> <span class="hljs-title class_">MAXRewardedViewController</span>: <span class="hljs-title class_">UIViewController</span>, <span class="hljs-title class_">MARewardedAdDelegate</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> rewardedAd: <span class="hljs-type">MARewardedAd</span>!
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> retryAttempt <span class="hljs-operator">=</span> <span class="hljs-number">0</span>

    <span class="hljs-keyword">override</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">viewDidLoad</span>() {
        <span class="hljs-keyword">super</span>.viewDidLoad()
        createRewardedAd()
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">createRewardedAd</span>() {
        rewardedAd <span class="hljs-operator">=</span> <span class="hljs-type">MARewardedAd</span>.shared(withAdUnitIdentifier: <span class="hljs-string">"YOUR_AD_UNIT_ID"</span>)
        rewardedAd.delegate <span class="hljs-operator">=</span> <span class="hljs-keyword">self</span>
        rewardedAd.load()
    }

    <span class="hljs-comment">/// ç”¨æˆ·ä¸»åŠ¨è§¦å‘è§‚çœ‹</span>
    <span class="hljs-keyword">@IBAction</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">watchAdTapped</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">sender</span>: <span class="hljs-type">UIButton</span>) {
        <span class="hljs-keyword">if</span> rewardedAd.isReady {
            rewardedAd.show()
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"âš ï¸ æ¿€åŠ±è§†é¢‘å°šæœªå°±ç»ª"</span>)
        }
    }

    <span class="hljs-comment">// MARK: - MAAdDelegate</span>

    <span class="hljs-keyword">func</span> <span class="hljs-title function_">didLoad</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">ad</span>: <span class="hljs-type">MAAd</span>) {
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"âœ… æ¿€åŠ±è§†é¢‘åŠ è½½æˆåŠŸ, æ¥æº: <span class="hljs-subst">\(ad.networkName)</span>"</span>)
        retryAttempt <span class="hljs-operator">=</span> <span class="hljs-number">0</span>
    }

    <span class="hljs-keyword">func</span> <span class="hljs-title function_">didFailToLoadAd</span>(<span class="hljs-params">forAdUnitIdentifier</span> <span class="hljs-params">adUnitIdentifier</span>: <span class="hljs-type">String</span>, <span class="hljs-params">withError</span> <span class="hljs-params">error</span>: <span class="hljs-type">MAError</span>) {
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"âŒ æ¿€åŠ±è§†é¢‘åŠ è½½å¤±è´¥: <span class="hljs-subst">\(error.message)</span>"</span>)

        retryAttempt <span class="hljs-operator">+=</span> <span class="hljs-number">1</span>
        <span class="hljs-keyword">let</span> delaySec <span class="hljs-operator">=</span> pow(<span class="hljs-number">2.0</span>, <span class="hljs-built_in">min</span>(<span class="hljs-number">6.0</span>, <span class="hljs-type">Double</span>(retryAttempt)))
        <span class="hljs-type">DispatchQueue</span>.main.asyncAfter(deadline: .now() <span class="hljs-operator">+</span> delaySec) { [<span class="hljs-keyword">weak</span> <span class="hljs-keyword">self</span>] <span class="hljs-keyword">in</span>
            <span class="hljs-keyword">self</span><span class="hljs-operator">?</span>.rewardedAd.load()
        }
    }

    <span class="hljs-keyword">func</span> <span class="hljs-title function_">didDisplay</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">ad</span>: <span class="hljs-type">MAAd</span>) {
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"ğŸ“º æ¿€åŠ±è§†é¢‘å·²å±•ç¤º"</span>)
    }

    <span class="hljs-keyword">func</span> <span class="hljs-title function_">didHide</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">ad</span>: <span class="hljs-type">MAAd</span>) {
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"âœ… æ¿€åŠ±è§†é¢‘å·²å…³é—­"</span>)
        rewardedAd.load() <span class="hljs-comment">// â­ é¢„åŠ è½½ä¸‹ä¸€ä¸ª</span>
    }

    <span class="hljs-keyword">func</span> <span class="hljs-title function_">didClick</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">ad</span>: <span class="hljs-type">MAAd</span>) {
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"ğŸ‘† æ¿€åŠ±è§†é¢‘è¢«ç‚¹å‡»"</span>)
    }

    <span class="hljs-keyword">func</span> <span class="hljs-title function_">didFail</span>(<span class="hljs-params">toDisplay</span> <span class="hljs-params">ad</span>: <span class="hljs-type">MAAd</span>, <span class="hljs-params">withError</span> <span class="hljs-params">error</span>: <span class="hljs-type">MAError</span>) {
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"âŒ æ¿€åŠ±è§†é¢‘å±•ç¤ºå¤±è´¥"</span>)
        rewardedAd.load()
    }

    <span class="hljs-comment">// MARK: - MARewardedAdDelegate</span>

    <span class="hljs-comment">/// â­ ç”¨æˆ·è§‚çœ‹å®Œæˆï¼Œå‘æ”¾å¥–åŠ±</span>
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">didRewardUser</span>(<span class="hljs-params">for</span> <span class="hljs-params">ad</span>: <span class="hljs-type">MAAd</span>, <span class="hljs-params">with</span> <span class="hljs-params">reward</span>: <span class="hljs-type">MAReward</span>) {
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"ğŸ‰ ç”¨æˆ·è·å¾—å¥–åŠ±: <span class="hljs-subst">\(reward.amount)</span> <span class="hljs-subst">\(reward.label)</span>"</span>)
        grantReward(amount: reward.amount, currency: reward.label)
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">grantReward</span>(<span class="hljs-params">amount</span>: <span class="hljs-type">Int</span>, <span class="hljs-params">currency</span>: <span class="hljs-type">String</span>) {
        <span class="hljs-comment">// å‘æ”¾å¥–åŠ±é€»è¾‘</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"å‘æ”¾ <span class="hljs-subst">\(amount)</span> <span class="hljs-subst">\(currency)</span>"</span>)
    }
}
</code></pre>
<h4 data-id="heading-25">3.7 AppLovin MAX åå°é…ç½®</h4>
<p>åœ¨ <a href="https://link.juejin.cn?target=https%3A%2F%2Fdash.applovin.com%2F" target="_blank" title="https://dash.applovin.com/" ref="nofollow noopener noreferrer">AppLovin Dashboard</a> ä¸­å®Œæˆä»¥ä¸‹é…ç½®ï¼š</p>
<h5 data-id="heading-26">æ·»åŠ  AdMob å’Œ Meta AN</h5>
<ol>
<li><strong>MAX â†’ Manage â†’ Ad Units</strong> â†’ åˆ›å»º Ad Unit</li>
<li>é€‰æ‹©æ ¼å¼ï¼ˆBanner / Interstitial / Rewardedï¼‰</li>
<li>åœ¨ <strong>Bidding</strong> åŒºåŸŸå¯ç”¨ï¼š
<ul>
<li><strong>Google Bidding and Google AdMob</strong> â†’ å¡«å…¥ AdMob çš„ <strong>Ad Unit ID</strong></li>
<li><strong>Meta Audience Network</strong> â†’ å¡«å…¥ Meta çš„ <strong>Placement ID</strong></li>
</ul>
</li>
<li>ä¿å­˜</li>
</ol>
<blockquote>
<p>ä¸¤ä¸ªç½‘ç»œéƒ½é€šè¿‡ <strong>å®æ—¶ç«ä»·ï¼ˆBiddingï¼‰</strong> å‚ä¸ï¼ŒMAX ä¼šè‡ªåŠ¨é€‰æ‹©å‡ºä»·æœ€é«˜çš„ç½‘ç»œå±•ç¤ºå¹¿å‘Š</p>
</blockquote>
<hr/>
<h3 data-id="heading-27">å››ã€ä¸¤ç§æ–¹æ¡ˆå¯¹æ¯”</h3>























































<table><thead><tr><th>ç‰¹æ€§</th><th>æ–¹æ¡ˆä¸€ï¼šAdMob Mediation</th><th>æ–¹æ¡ˆäºŒï¼šAppLovin MAX</th></tr></thead><tbody><tr><td><strong>èšåˆä¸»ä½“</strong></td><td>Google AdMob</td><td>AppLovin MAX</td></tr><tr><td><strong>ç«ä»·å…¬å¹³æ€§</strong></td><td>AdMob è‡ªå®¶å¹¿å‘Šå¯èƒ½æœ‰ä¼˜åŠ¿</td><td>æ›´å…¬å¹³é€æ˜ï¼Œæ‰€æœ‰ç½‘ç»œå¹³ç­‰ç«äº‰</td></tr><tr><td><strong>æ¥å…¥å¤æ‚åº¦</strong></td><td>â­ ç®€å•ï¼ˆå·²ç”¨ AdMob çš„é¡¹ç›®ï¼‰</td><td>â­â­ ä¸­ç­‰ï¼ˆéœ€é¢å¤–æ³¨å†Œ AppLovinï¼‰</td></tr><tr><td><strong>æ”¯æŒç½‘ç»œæ•°é‡</strong></td><td>çº¦ 20+</td><td>çº¦ 25+</td></tr><tr><td><strong>æ”¶ç›ŠæŠ¥å‘Š</strong></td><td>AdMob åå°</td><td>AppLovin Dashboardï¼ˆæ›´è¯¦ç»†ï¼‰</td></tr><tr><td><strong>A/B æµ‹è¯•</strong></td><td>æœ‰é™</td><td>å†…ç½®å¼ºå¤§ A/B æµ‹è¯•</td></tr><tr><td><strong>å¹¿å‘Šè´¨é‡å®¡æ ¸</strong></td><td>Google Ad Review</td><td>MAX Ad Review</td></tr><tr><td><strong>è´¹ç”¨</strong></td><td>å…è´¹</td><td>å…è´¹</td></tr><tr><td><strong>æ¨èåœºæ™¯</strong></td><td>å·²æ·±åº¦ä½¿ç”¨ AdMob</td><td>æ–°é¡¹ç›®æˆ–è¿½æ±‚æœ€é«˜æ”¶ç›Š</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-28">äº”ã€æ–¹æ¡ˆä¸‰ï¼šæ‰‹åŠ¨ç®¡ç†ï¼ˆä¸æ¨èä½†å¯è¡Œï¼‰</h3>
<p>å¦‚æœä½ æœ‰ç‰¹æ®ŠåŸå› <strong>ä¸æƒ³ä½¿ç”¨èšåˆå¹³å°</strong>ï¼Œå¯ä»¥æ‰‹åŠ¨ç®¡ç†ä¸¤ä¸ª SDK çš„é™çº§é€»è¾‘ï¼š</p>
<h4 data-id="heading-29">5.1 å®‰è£…ä¸¤ä¸ª SDK</h4>
<pre><code class="hljs language-ruby" lang="ruby">platform <span class="hljs-symbol">:ios</span>, <span class="hljs-string">'13.0'</span>

target <span class="hljs-string">'YourApp'</span> <span class="hljs-keyword">do</span>
  use_frameworks!

  pod <span class="hljs-string">'Google-Mobile-Ads-SDK'</span>   <span class="hljs-comment"># AdMob</span>
  pod <span class="hljs-string">'FBAudienceNetwork'</span>        <span class="hljs-comment"># Meta AN</span>
<span class="hljs-keyword">end</span>
</code></pre>
<h4 data-id="heading-30">5.2 æ‰‹åŠ¨å¹¿å‘Šç®¡ç†å™¨</h4>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">import</span> Foundation
<span class="hljs-keyword">import</span> GoogleMobileAds
<span class="hljs-keyword">import</span> FBAudienceNetwork

<span class="hljs-comment">/// å¹¿å‘Šç®¡ç†å™¨ - æ‰‹åŠ¨èšåˆï¼ˆé™çº§é€»è¾‘ï¼‰</span>
<span class="hljs-comment">/// âš ï¸ ä¸æ¨èï¼šä»…ä½œå­¦ä¹ å‚è€ƒï¼Œç”Ÿäº§ç¯å¢ƒè¯·ç”¨èšåˆå¹³å°</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ManualAdManager</span>: <span class="hljs-title class_">NSObject</span> {

    <span class="hljs-keyword">static</span> <span class="hljs-keyword">let</span> shared <span class="hljs-operator">=</span> <span class="hljs-type">ManualAdManager</span>()

    <span class="hljs-comment">// MARK: - é…ç½®</span>

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">let</span> admobInterstitialUnitID <span class="hljs-operator">=</span> <span class="hljs-string">"ca-app-pub-xxxxx/yyyyy"</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">let</span> metaInterstitialPlacementID <span class="hljs-operator">=</span> <span class="hljs-string">"123456789_987654321"</span>

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">let</span> admobRewardedUnitID <span class="hljs-operator">=</span> <span class="hljs-string">"ca-app-pub-xxxxx/zzzzz"</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">let</span> metaRewardedPlacementID <span class="hljs-operator">=</span> <span class="hljs-string">"123456789_111111111"</span>

    <span class="hljs-comment">// MARK: - å¹¿å‘Šå®ä¾‹</span>

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> admobInterstitial: <span class="hljs-type">GADInterstitialAd</span>?
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> metaInterstitial: <span class="hljs-type">FBInterstitialAd</span>?

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> admobRewarded: <span class="hljs-type">GADRewardedAd</span>?
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> metaRewarded: <span class="hljs-type">FBRewardedVideoAd</span>?

    <span class="hljs-comment">// MARK: - çŠ¶æ€è¿½è¸ª</span>

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> isAdMobInterstitialReady <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> isMetaInterstitialReady <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> isAdMobRewardedReady <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> isMetaRewardedReady <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>

    <span class="hljs-comment">// MARK: - å›è°ƒ</span>

    <span class="hljs-keyword">var</span> onRewardEarned: ((<span class="hljs-keyword">_</span> amount: <span class="hljs-type">Int</span>, <span class="hljs-keyword">_</span> type: <span class="hljs-type">String</span>) -&gt; <span class="hljs-type">Void</span>)<span class="hljs-operator">?</span>
    <span class="hljs-keyword">var</span> onInterstitialDismissed: (() -&gt; <span class="hljs-type">Void</span>)<span class="hljs-operator">?</span>

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">init</span>() {
        <span class="hljs-keyword">super</span>.<span class="hljs-keyword">init</span>()
    }

    <span class="hljs-comment">// MARK: - ==================== æ’å±å¹¿å‘Š ====================</span>

    <span class="hljs-comment">/// åŒæ—¶è¯·æ±‚ä¸¤ä¸ªç½‘ç»œï¼Œè°å…ˆ ready è°å±•ç¤º</span>
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">loadInterstitial</span>() {
        isAdMobInterstitialReady <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>
        isMetaInterstitialReady <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>

        loadAdMobInterstitial()
        loadMetaInterstitial()
    }

    <span class="hljs-comment">// â€”â€” AdMob æ’å± â€”â€”</span>

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">loadAdMobInterstitial</span>() {
        <span class="hljs-type">GADInterstitialAd</span>.load(
            withAdUnitID: admobInterstitialUnitID,
            request: <span class="hljs-type">GADRequest</span>()
        ) { [<span class="hljs-keyword">weak</span> <span class="hljs-keyword">self</span>] ad, error <span class="hljs-keyword">in</span>
            <span class="hljs-keyword">guard</span> <span class="hljs-keyword">let</span> <span class="hljs-keyword">self</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">self</span> <span class="hljs-keyword">else</span> { <span class="hljs-keyword">return</span> }
            <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> error <span class="hljs-operator">=</span> error {
                <span class="hljs-built_in">print</span>(<span class="hljs-string">"âŒ AdMob æ’å±åŠ è½½å¤±è´¥: <span class="hljs-subst">\(error.localizedDescription)</span>"</span>)
                <span class="hljs-keyword">return</span>
            }
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"âœ… AdMob æ’å±åŠ è½½æˆåŠŸ"</span>)
            <span class="hljs-keyword">self</span>.admobInterstitial <span class="hljs-operator">=</span> ad
            <span class="hljs-keyword">self</span>.admobInterstitial<span class="hljs-operator">?</span>.fullScreenContentDelegate <span class="hljs-operator">=</span> <span class="hljs-keyword">self</span>
            <span class="hljs-keyword">self</span>.isAdMobInterstitialReady <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>
        }
    }

    <span class="hljs-comment">// â€”â€” Meta æ’å± â€”â€”</span>

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">loadMetaInterstitial</span>() {
        metaInterstitial <span class="hljs-operator">=</span> <span class="hljs-type">FBInterstitialAd</span>(placementID: metaInterstitialPlacementID)
        metaInterstitial<span class="hljs-operator">?</span>.delegate <span class="hljs-operator">=</span> <span class="hljs-keyword">self</span>
        metaInterstitial<span class="hljs-operator">?</span>.load()
    }

    <span class="hljs-comment">/// å±•ç¤ºæ’å±ï¼šä¼˜å…ˆ AdMob â†’ é™çº§ Meta â†’ ä¸¤è€…éƒ½æ— åˆ™æ”¾å¼ƒ</span>
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">showInterstitial</span>(<span class="hljs-params">from</span> <span class="hljs-params">viewController</span>: <span class="hljs-type">UIViewController</span>) -&gt; <span class="hljs-type">Bool</span> {
        <span class="hljs-keyword">if</span> isAdMobInterstitialReady, <span class="hljs-keyword">let</span> ad <span class="hljs-operator">=</span> admobInterstitial {
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"ğŸ“º å±•ç¤º AdMob æ’å±"</span>)
            ad.present(fromRootViewController: viewController)
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> isMetaInterstitialReady, <span class="hljs-keyword">let</span> ad <span class="hljs-operator">=</span> metaInterstitial, ad.isAdValid {
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"ğŸ“º å±•ç¤º Meta æ’å±"</span>)
            ad.show(fromRootViewController: viewController)
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"âš ï¸ æ— å¯ç”¨æ’å±å¹¿å‘Š"</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>
        }
    }

    <span class="hljs-comment">// MARK: - ==================== æ¿€åŠ±è§†é¢‘ ====================</span>

    <span class="hljs-keyword">func</span> <span class="hljs-title function_">loadRewarded</span>() {
        isAdMobRewardedReady <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>
        isMetaRewardedReady <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>

        loadAdMobRewarded()
        loadMetaRewarded()
    }

    <span class="hljs-comment">// â€”â€” AdMob æ¿€åŠ± â€”â€”</span>

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">loadAdMobRewarded</span>() {
        <span class="hljs-type">GADRewardedAd</span>.load(
            withAdUnitID: admobRewardedUnitID,
            request: <span class="hljs-type">GADRequest</span>()
        ) { [<span class="hljs-keyword">weak</span> <span class="hljs-keyword">self</span>] ad, error <span class="hljs-keyword">in</span>
            <span class="hljs-keyword">guard</span> <span class="hljs-keyword">let</span> <span class="hljs-keyword">self</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">self</span> <span class="hljs-keyword">else</span> { <span class="hljs-keyword">return</span> }
            <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> error <span class="hljs-operator">=</span> error {
                <span class="hljs-built_in">print</span>(<span class="hljs-string">"âŒ AdMob æ¿€åŠ±åŠ è½½å¤±è´¥: <span class="hljs-subst">\(error.localizedDescription)</span>"</span>)
                <span class="hljs-keyword">return</span>
            }
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"âœ… AdMob æ¿€åŠ±åŠ è½½æˆåŠŸ"</span>)
            <span class="hljs-keyword">self</span>.admobRewarded <span class="hljs-operator">=</span> ad
            <span class="hljs-keyword">self</span>.admobRewarded<span class="hljs-operator">?</span>.fullScreenContentDelegate <span class="hljs-operator">=</span> <span class="hljs-keyword">self</span>
            <span class="hljs-keyword">self</span>.isAdMobRewardedReady <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>
        }
    }

    <span class="hljs-comment">// â€”â€” Meta æ¿€åŠ± â€”â€”</span>

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">loadMetaRewarded</span>() {
        metaRewarded <span class="hljs-operator">=</span> <span class="hljs-type">FBRewardedVideoAd</span>(placementID: metaRewardedPlacementID)
        metaRewarded<span class="hljs-operator">?</span>.delegate <span class="hljs-operator">=</span> <span class="hljs-keyword">self</span>
        metaRewarded<span class="hljs-operator">?</span>.load()
    }

    <span class="hljs-comment">/// å±•ç¤ºæ¿€åŠ±è§†é¢‘ï¼šä¼˜å…ˆ AdMob â†’ é™çº§ Meta</span>
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">showRewarded</span>(<span class="hljs-params">from</span> <span class="hljs-params">viewController</span>: <span class="hljs-type">UIViewController</span>) -&gt; <span class="hljs-type">Bool</span> {
        <span class="hljs-keyword">if</span> isAdMobRewardedReady, <span class="hljs-keyword">let</span> ad <span class="hljs-operator">=</span> admobRewarded {
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"ğŸ“º å±•ç¤º AdMob æ¿€åŠ±è§†é¢‘"</span>)
            ad.present(fromRootViewController: viewController) { [<span class="hljs-keyword">weak</span> <span class="hljs-keyword">self</span>] <span class="hljs-keyword">in</span>
                <span class="hljs-keyword">let</span> reward <span class="hljs-operator">=</span> ad.adReward
                <span class="hljs-built_in">print</span>(<span class="hljs-string">"ğŸ‰ AdMob å¥–åŠ±: <span class="hljs-subst">\(reward.amount)</span> <span class="hljs-subst">\(reward.type)</span>"</span>)
                <span class="hljs-keyword">self</span><span class="hljs-operator">?</span>.onRewardEarned<span class="hljs-operator">?</span>(reward.amount.intValue, reward.type)
            }
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> isMetaRewardedReady, <span class="hljs-keyword">let</span> ad <span class="hljs-operator">=</span> metaRewarded, ad.isAdValid {
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"ğŸ“º å±•ç¤º Meta æ¿€åŠ±è§†é¢‘"</span>)
            ad.show(fromRootViewController: viewController)
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"âš ï¸ æ— å¯ç”¨æ¿€åŠ±è§†é¢‘"</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>
        }
    }

    <span class="hljs-comment">/// æ£€æŸ¥æ˜¯å¦æœ‰å¹¿å‘Šå°±ç»ª</span>
    <span class="hljs-keyword">var</span> isInterstitialReady: <span class="hljs-type">Bool</span> {
        <span class="hljs-keyword">return</span> isAdMobInterstitialReady <span class="hljs-operator">||</span> isMetaInterstitialReady
    }

    <span class="hljs-keyword">var</span> isRewardedReady: <span class="hljs-type">Bool</span> {
        <span class="hljs-keyword">return</span> isAdMobRewardedReady <span class="hljs-operator">||</span> isMetaRewardedReady
    }
}

<span class="hljs-comment">// MARK: - ==================== AdMob Delegate ====================</span>

<span class="hljs-keyword">extension</span> <span class="hljs-title class_">ManualAdManager</span>: <span class="hljs-title class_">GADFullScreenContentDelegate</span> {

    <span class="hljs-keyword">func</span> <span class="hljs-title function_">adDidDismissFullScreenContent</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">ad</span>: <span class="hljs-type">GADFullScreenPresentingAd</span>) {
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"âœ… AdMob å…¨å±å¹¿å‘Šå·²å…³é—­"</span>)
        isAdMobInterstitialReady <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>
        isAdMobRewardedReady <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>
        onInterstitialDismissed<span class="hljs-operator">?</span>()
        <span class="hljs-comment">// é¢„åŠ è½½ä¸‹ä¸€ä¸ª</span>
        loadInterstitial()
        loadRewarded()
    }

    <span class="hljs-keyword">func</span> <span class="hljs-title function_">ad</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">ad</span>: <span class="hljs-type">GADFullScreenPresentingAd</span>, <span class="hljs-params">didFailToPresentFullScreenContentWithError</span> <span class="hljs-params">error</span>: <span class="hljs-type">Error</span>) {
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"âŒ AdMob å±•ç¤ºå¤±è´¥: <span class="hljs-subst">\(error.localizedDescription)</span>"</span>)
    }
}

<span class="hljs-comment">// MARK: - ==================== Meta Interstitial Delegate ====================</span>

<span class="hljs-keyword">extension</span> <span class="hljs-title class_">ManualAdManager</span>: <span class="hljs-title class_">FBInterstitialAdDelegate</span> {

    <span class="hljs-keyword">func</span> <span class="hljs-title function_">interstitialAdDidLoad</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">interstitialAd</span>: <span class="hljs-type">FBInterstitialAd</span>) {
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"âœ… Meta æ’å±åŠ è½½æˆåŠŸ"</span>)
        isMetaInterstitialReady <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>
    }

    <span class="hljs-keyword">func</span> <span class="hljs-title function_">interstitialAd</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">interstitialAd</span>: <span class="hljs-type">FBInterstitialAd</span>, <span class="hljs-params">didFailWithError</span> <span class="hljs-params">error</span>: <span class="hljs-type">Error</span>) {
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"âŒ Meta æ’å±åŠ è½½å¤±è´¥: <span class="hljs-subst">\(error.localizedDescription)</span>"</span>)
        isMetaInterstitialReady <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>
    }

    <span class="hljs-keyword">func</span> <span class="hljs-title function_">interstitialAdDidClose</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">interstitialAd</span>: <span class="hljs-type">FBInterstitialAd</span>) {
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"âœ… Meta æ’å±å·²å…³é—­"</span>)
        isMetaInterstitialReady <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>
        onInterstitialDismissed<span class="hljs-operator">?</span>()
        loadInterstitial()
    }

    <span class="hljs-keyword">func</span> <span class="hljs-title function_">interstitialAdDidClick</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">interstitialAd</span>: <span class="hljs-type">FBInterstitialAd</span>) {
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"ğŸ‘† Meta æ’å±è¢«ç‚¹å‡»"</span>)
    }

    <span class="hljs-keyword">func</span> <span class="hljs-title function_">interstitialAdWillLogImpression</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">interstitialAd</span>: <span class="hljs-type">FBInterstitialAd</span>) {
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"ğŸ‘ï¸ Meta æ’å±æ›å…‰"</span>)
    }
}

<span class="hljs-comment">// MARK: - ==================== Meta Rewarded Delegate ====================</span>

<span class="hljs-keyword">extension</span> <span class="hljs-title class_">ManualAdManager</span>: <span class="hljs-title class_">FBRewardedVideoAdDelegate</span> {

    <span class="hljs-keyword">func</span> <span class="hljs-title function_">rewardedVideoAdDidLoad</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">rewardedVideoAd</span>: <span class="hljs-type">FBRewardedVideoAd</span>) {
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"âœ… Meta æ¿€åŠ±åŠ è½½æˆåŠŸ"</span>)
        isMetaRewardedReady <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>
    }

    <span class="hljs-keyword">func</span> <span class="hljs-title function_">rewardedVideoAd</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">rewardedVideoAd</span>: <span class="hljs-type">FBRewardedVideoAd</span>, <span class="hljs-params">didFailWithError</span> <span class="hljs-params">error</span>: <span class="hljs-type">Error</span>) {
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"âŒ Meta æ¿€åŠ±åŠ è½½å¤±è´¥: <span class="hljs-subst">\(error.localizedDescription)</span>"</span>)
        isMetaRewardedReady <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>
    }

    <span class="hljs-keyword">func</span> <span class="hljs-title function_">rewardedVideoAdDidClose</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">rewardedVideoAd</span>: <span class="hljs-type">FBRewardedVideoAd</span>) {
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"âœ… Meta æ¿€åŠ±è§†é¢‘å·²å…³é—­"</span>)
        isMetaRewardedReady <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>
        loadRewarded()
    }

    <span class="hljs-keyword">func</span> <span class="hljs-title function_">rewardedVideoAdVideoComplete</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">rewardedVideoAd</span>: <span class="hljs-type">FBRewardedVideoAd</span>) {
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"ğŸ‰ Meta æ¿€åŠ±è§†é¢‘è§‚çœ‹å®Œæˆ"</span>)
        <span class="hljs-comment">// Meta ä¸åƒ AdMob é‚£æ ·è¿”å›å…·ä½“å¥–åŠ±ä¿¡æ¯ï¼Œéœ€è¦è‡ªè¡Œå®šä¹‰</span>
        onRewardEarned<span class="hljs-operator">?</span>(<span class="hljs-number">1</span>, <span class="hljs-string">"coin"</span>)
    }

    <span class="hljs-keyword">func</span> <span class="hljs-title function_">rewardedVideoAdDidClick</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">rewardedVideoAd</span>: <span class="hljs-type">FBRewardedVideoAd</span>) {
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"ğŸ‘† Meta æ¿€åŠ±è§†é¢‘è¢«ç‚¹å‡»"</span>)
    }
}
</code></pre>
<h4 data-id="heading-31">5.3 æ‰‹åŠ¨æ–¹æ¡ˆçš„ä½¿ç”¨æ–¹å¼</h4>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">class</span> <span class="hljs-title class_">GameViewController</span>: <span class="hljs-title class_">UIViewController</span> {

    <span class="hljs-keyword">override</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">viewDidLoad</span>() {
        <span class="hljs-keyword">super</span>.viewDidLoad()

        <span class="hljs-comment">// é¢„åŠ è½½å¹¿å‘Š</span>
        <span class="hljs-type">ManualAdManager</span>.shared.loadInterstitial()
        <span class="hljs-type">ManualAdManager</span>.shared.loadRewarded()

        <span class="hljs-comment">// è®¾ç½®å¥–åŠ±å›è°ƒ</span>
        <span class="hljs-type">ManualAdManager</span>.shared.onRewardEarned <span class="hljs-operator">=</span> { amount, type <span class="hljs-keyword">in</span>
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"ğŸ‰ å‘æ”¾å¥–åŠ±: <span class="hljs-subst">\(amount)</span> <span class="hljs-subst">\(type)</span>"</span>)
            <span class="hljs-comment">// æ›´æ–°ç”¨æˆ·ä½™é¢ç­‰</span>
        }
    }

    <span class="hljs-comment">/// å…³å¡ç»“æŸåå±•ç¤ºæ’å±</span>
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">onLevelComplete</span>() {
        <span class="hljs-keyword">_</span> <span class="hljs-operator">=</span> <span class="hljs-type">ManualAdManager</span>.shared.showInterstitial(from: <span class="hljs-keyword">self</span>)
    }

    <span class="hljs-comment">/// ç”¨æˆ·ä¸»åŠ¨è§‚çœ‹æ¿€åŠ±è§†é¢‘</span>
    <span class="hljs-keyword">@IBAction</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">watchAdForReward</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">sender</span>: <span class="hljs-type">UIButton</span>) {
        <span class="hljs-keyword">let</span> shown <span class="hljs-operator">=</span> <span class="hljs-type">ManualAdManager</span>.shared.showRewarded(from: <span class="hljs-keyword">self</span>)
        <span class="hljs-keyword">if</span> <span class="hljs-operator">!</span>shown {
            <span class="hljs-comment">// æç¤ºç”¨æˆ·ç¨åå†è¯•</span>
            showAlert(message: <span class="hljs-string">"å¹¿å‘Šæš‚ä¸å¯ç”¨ï¼Œè¯·ç¨åå†è¯•"</span>)
        }
    }
}
</code></pre>
<blockquote>
<p>âš ï¸ <strong>æ‰‹åŠ¨æ–¹æ¡ˆçš„ç¼ºç‚¹ï¼š</strong></p>
<ul>
<li>æ— æ³•å®ç°çœŸæ­£çš„å®æ—¶ç«ä»·ï¼ˆBiddingï¼‰ï¼Œåªæ˜¯ç®€å•çš„ä¼˜å…ˆçº§é™çº§</li>
<li>éœ€è¦è‡ªå·±ç»´æŠ¤ä¸¤å¥— Delegate</li>
<li>æ— æ³•åŠ¨æ€è°ƒæ•´ä¼˜å…ˆçº§å’Œ eCPM æ’åº</li>
<li>åˆè§„ï¼ˆGDPR/CCPAï¼‰éœ€è¦åˆ†åˆ«å¤„ç†</li>
<li>æ–°å¢å¹¿å‘Šç½‘ç»œæ—¶éœ€è¦å¤§é‡æ”¹ä»£ç </li>
</ul>
</blockquote>
<hr/>
<h3 data-id="heading-32">å…­ã€éšç§åˆè§„å¤„ç†ï¼ˆä¸‰ç§æ–¹æ¡ˆé€šç”¨ï¼‰</h3>
<h4 data-id="heading-33">6.1 Google UMPï¼ˆUser Messaging Platformï¼‰- GDPR åˆè§„</h4>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">import</span> UIKit
<span class="hljs-keyword">import</span> UserMessagingPlatform

<span class="hljs-keyword">class</span> <span class="hljs-title class_">ConsentManager</span> {

    <span class="hljs-keyword">static</span> <span class="hljs-keyword">let</span> shared <span class="hljs-operator">=</span> <span class="hljs-type">ConsentManager</span>()

    <span class="hljs-comment">/// åœ¨ SDK åˆå§‹åŒ–ä¹‹å‰è°ƒç”¨</span>
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">requestConsentIfNeeded</span>(<span class="hljs-params">from</span> <span class="hljs-params">viewController</span>: <span class="hljs-type">UIViewController</span>, <span class="hljs-params">completion</span>: <span class="hljs-keyword">@escaping</span> () -&gt; <span class="hljs-type">Void</span>) {

        <span class="hljs-comment">// â‘  åˆ›å»ºè¯·æ±‚å‚æ•°</span>
        <span class="hljs-keyword">let</span> parameters <span class="hljs-operator">=</span> <span class="hljs-type">UMPRequestParameters</span>()

        <span class="hljs-comment">// è°ƒè¯•æ—¶ä½¿ç”¨ï¼ˆæ­£å¼å‘å¸ƒç§»é™¤ï¼‰</span>
        <span class="hljs-keyword">#if</span> <span class="hljs-type">DEBUG</span>
        <span class="hljs-keyword">let</span> debugSettings <span class="hljs-operator">=</span> <span class="hljs-type">UMPDebugSettings</span>()
        debugSettings.testDeviceIdentifiers <span class="hljs-operator">=</span> [<span class="hljs-string">"YOUR_TEST_DEVICE_HASHED_ID"</span>]
        debugSettings.geography <span class="hljs-operator">=</span> .<span class="hljs-type">EEA</span> <span class="hljs-comment">// æ¨¡æ‹Ÿæ¬§æ´²ç”¨æˆ·</span>
        parameters.debugSettings <span class="hljs-operator">=</span> debugSettings
        <span class="hljs-keyword">#endif</span>

        <span class="hljs-comment">// â‘¡ è¯·æ±‚æ›´æ–°åŒæ„ä¿¡æ¯</span>
        <span class="hljs-type">UMPConsentInformation</span>.sharedInstance.requestConsentInfoUpdate(with: parameters) { error <span class="hljs-keyword">in</span>
            <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> error <span class="hljs-operator">=</span> error {
                <span class="hljs-built_in">print</span>(<span class="hljs-string">"âŒ åŒæ„ä¿¡æ¯æ›´æ–°å¤±è´¥: <span class="hljs-subst">\(error.localizedDescription)</span>"</span>)
                completion()
                <span class="hljs-keyword">return</span>
            }

            <span class="hljs-comment">// â‘¢ å¦‚æœéœ€è¦ï¼Œå±•ç¤ºåŒæ„è¡¨å•</span>
            <span class="hljs-type">UMPConsentForm</span>.loadAndPresentIfRequired(from: viewController) { formError <span class="hljs-keyword">in</span>
                <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> formError <span class="hljs-operator">=</span> formError {
                    <span class="hljs-built_in">print</span>(<span class="hljs-string">"âŒ åŒæ„è¡¨å•å±•ç¤ºå¤±è´¥: <span class="hljs-subst">\(formError.localizedDescription)</span>"</span>)
                }

                <span class="hljs-comment">// â‘£ æ£€æŸ¥æ˜¯å¦å¯ä»¥è¯·æ±‚å¹¿å‘Š</span>
                <span class="hljs-keyword">if</span> <span class="hljs-type">UMPConsentInformation</span>.sharedInstance.canRequestAds {
                    <span class="hljs-built_in">print</span>(<span class="hljs-string">"âœ… ç”¨æˆ·å·²æˆæƒï¼Œå¯ä»¥è¯·æ±‚å¹¿å‘Š"</span>)
                }

                completion()
            }
        }
    }

    <span class="hljs-comment">/// æ£€æŸ¥æ˜¯å¦å¯ä»¥è¯·æ±‚ä¸ªæ€§åŒ–å¹¿å‘Š</span>
    <span class="hljs-keyword">var</span> canRequestAds: <span class="hljs-type">Bool</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-type">UMPConsentInformation</span>.sharedInstance.canRequestAds
    }
}
</code></pre>
<h4 data-id="heading-34">6.2 Meta éšç§åˆè§„è®¾ç½®</h4>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">import</span> FBAudienceNetwork

<span class="hljs-keyword">class</span> <span class="hljs-title class_">MetaPrivacyHelper</span> {

    <span class="hljs-comment">/// è®¾ç½® GDPR æ•°æ®å¤„ç†é€‰é¡¹ï¼ˆæ¬§æ´²ç”¨æˆ·ï¼‰</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">setGDPRConsent</span>(<span class="hljs-params">granted</span>: <span class="hljs-type">Bool</span>) {
        <span class="hljs-comment">// Meta ä¸åœ¨ IAB GVL ä¸­ï¼Œéœ€è¦ä½¿ç”¨ Additional Consent</span>
        <span class="hljs-comment">// å¦‚æœç”¨æˆ·æœªåŒæ„ï¼Œåº”å½“é™åˆ¶æ•°æ®ä½¿ç”¨</span>
        <span class="hljs-keyword">if</span> <span class="hljs-operator">!</span>granted {
            <span class="hljs-comment">// é™åˆ¶æ•°æ®å¤„ç†</span>
            <span class="hljs-type">FBAdSettings</span>.setDataProcessingOptions([<span class="hljs-string">"LDU"</span>], country: <span class="hljs-number">0</span>, state: <span class="hljs-number">0</span>)
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// ä¸é™åˆ¶</span>
            <span class="hljs-type">FBAdSettings</span>.setDataProcessingOptions([])
        }
    }

    <span class="hljs-comment">/// è®¾ç½® CCPA æ•°æ®å¤„ç†é€‰é¡¹ï¼ˆåŠ å·ç”¨æˆ·ï¼‰</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">setCCPAOptOut</span>(<span class="hljs-params">optedOut</span>: <span class="hljs-type">Bool</span>) {
        <span class="hljs-keyword">if</span> optedOut {
            <span class="hljs-comment">// ç”¨æˆ·é€‰æ‹©é€€å‡ºæ•°æ®å”®å–</span>
            <span class="hljs-type">FBAdSettings</span>.setDataProcessingOptions([<span class="hljs-string">"LDU"</span>], country: <span class="hljs-number">1</span>, state: <span class="hljs-number">1000</span>)
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-type">FBAdSettings</span>.setDataProcessingOptions([])
        }
    }

    <span class="hljs-comment">/// è®¾ç½® iOS 14+ å¹¿å‘Šè¿½è¸ªçŠ¶æ€</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">setAdvertiserTracking</span>(<span class="hljs-params">enabled</span>: <span class="hljs-type">Bool</span>) {
        <span class="hljs-type">FBAdSettings</span>.setAdvertiserTrackingEnabled(enabled)
    }
}
</code></pre>
<h4 data-id="heading-35">6.3 å®Œæ•´çš„åˆå§‹åŒ–æµç¨‹ï¼ˆåˆè§„ â†’ ATT â†’ å¹¿å‘Š SDKï¼‰</h4>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">import</span> UIKit
<span class="hljs-keyword">import</span> GoogleMobileAds
<span class="hljs-keyword">import</span> FBAudienceNetwork
<span class="hljs-keyword">import</span> AppTrackingTransparency
<span class="hljs-keyword">import</span> UserMessagingPlatform

<span class="hljs-keyword">class</span> <span class="hljs-title class_">AppStartupManager</span> {

    <span class="hljs-keyword">static</span> <span class="hljs-keyword">let</span> shared <span class="hljs-operator">=</span> <span class="hljs-type">AppStartupManager</span>()
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> isAdsInitialized <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>

    <span class="hljs-comment">/// å®Œæ•´çš„å¹¿å‘Šåˆå§‹åŒ–æµç¨‹ï¼šGDPR â†’ ATT â†’ Meta ATE â†’ SDK åˆå§‹åŒ–</span>
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">startAdInitialization</span>(<span class="hljs-params">from</span> <span class="hljs-params">viewController</span>: <span class="hljs-type">UIViewController</span>) {
        
        <span class="hljs-comment">// ==================== ç¬¬ 1 æ­¥ï¼šGDPR åŒæ„ ====================</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"ğŸ“‹ Step 1: è¯·æ±‚ GDPR åŒæ„..."</span>)
        
        <span class="hljs-type">ConsentManager</span>.shared.requestConsentIfNeeded(from: viewController) { [<span class="hljs-keyword">weak</span> <span class="hljs-keyword">self</span>] <span class="hljs-keyword">in</span>
            <span class="hljs-keyword">guard</span> <span class="hljs-keyword">let</span> <span class="hljs-keyword">self</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">self</span> <span class="hljs-keyword">else</span> { <span class="hljs-keyword">return</span> }
            
            <span class="hljs-comment">// ==================== ç¬¬ 2 æ­¥ï¼šATT æƒé™ ====================</span>
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"ğŸ“‹ Step 2: è¯·æ±‚ ATT æƒé™..."</span>)
            
            <span class="hljs-keyword">self</span>.requestATTPermission { trackingAuthorized <span class="hljs-keyword">in</span>
                
                <span class="hljs-comment">// ==================== ç¬¬ 3 æ­¥ï¼šé…ç½® Meta éšç§ ====================</span>
                <span class="hljs-built_in">print</span>(<span class="hljs-string">"ğŸ“‹ Step 3: é…ç½® Meta éšç§è®¾ç½®..."</span>)
                
                <span class="hljs-type">FBAdSettings</span>.setAdvertiserTrackingEnabled(trackingAuthorized)
                
                <span class="hljs-comment">// å¦‚æœ GDPR åŒæ„ä¿¡æ¯å¯ç”¨ï¼Œé…ç½® Meta æ•°æ®å¤„ç†é€‰é¡¹</span>
                <span class="hljs-keyword">if</span> <span class="hljs-type">ConsentManager</span>.shared.canRequestAds {
                    <span class="hljs-type">FBAdSettings</span>.setDataProcessingOptions([])
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-type">FBAdSettings</span>.setDataProcessingOptions([<span class="hljs-string">"LDU"</span>], country: <span class="hljs-number">0</span>, state: <span class="hljs-number">0</span>)
                }
                
                <span class="hljs-comment">// ==================== ç¬¬ 4 æ­¥ï¼šåˆå§‹åŒ–å¹¿å‘Š SDK ====================</span>
                <span class="hljs-built_in">print</span>(<span class="hljs-string">"ğŸ“‹ Step 4: åˆå§‹åŒ–å¹¿å‘Š SDK..."</span>)
                
                <span class="hljs-keyword">self</span>.initializeAdSDK()
            }
        }
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">requestATTPermission</span>(<span class="hljs-params">completion</span>: <span class="hljs-keyword">@escaping</span> (<span class="hljs-type">Bool</span>) -&gt; <span class="hljs-type">Void</span>) {
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">#available</span>(<span class="hljs-keyword">iOS</span> <span class="hljs-number">14.5</span>, <span class="hljs-operator">*</span>) {
            <span class="hljs-type">ATTrackingManager</span>.requestTrackingAuthorization { status <span class="hljs-keyword">in</span>
                <span class="hljs-type">DispatchQueue</span>.main.async {
                    <span class="hljs-keyword">let</span> authorized <span class="hljs-operator">=</span> (status <span class="hljs-operator">==</span> .authorized)
                    <span class="hljs-built_in">print</span>(<span class="hljs-string">"  ATT çŠ¶æ€: <span class="hljs-subst">\(status.rawValue)</span>, å·²æˆæƒ: <span class="hljs-subst">\(authorized)</span>"</span>)
                    completion(authorized)
                }
            }
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// iOS 14.5 ä»¥ä¸‹é»˜è®¤å¯è¿½è¸ª</span>
            completion(<span class="hljs-literal">true</span>)
        }
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">initializeAdSDK</span>() {
        <span class="hljs-keyword">guard</span> <span class="hljs-operator">!</span>isAdsInitialized <span class="hljs-keyword">else</span> { <span class="hljs-keyword">return</span> }
        isAdsInitialized <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>
        
        <span class="hljs-comment">// ====== æ–¹æ¡ˆä¸€ï¼šä½¿ç”¨ AdMob Mediation ======</span>
        <span class="hljs-type">GADMobileAds</span>.sharedInstance().start { status <span class="hljs-keyword">in</span>
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"âœ… AdMob SDK åˆå§‹åŒ–å®Œæˆ"</span>)
            
            <span class="hljs-keyword">for</span> (adapter, adapterStatus) <span class="hljs-keyword">in</span> status.adapterStatusesByClassName {
                <span class="hljs-built_in">print</span>(<span class="hljs-string">"  [<span class="hljs-subst">\(adapter)</span>] state=<span class="hljs-subst">\(adapterStatus.state.rawValue)</span>, <span class="hljs-subst">\(adapterStatus.description)</span>"</span>)
            }
            
            <span class="hljs-comment">// åˆå§‹åŒ–å®Œæˆï¼Œå‘é€é€šçŸ¥è®©å„é¡µé¢å¼€å§‹åŠ è½½å¹¿å‘Š</span>
            <span class="hljs-type">NotificationCenter</span>.default.post(name: .adsSDKInitialized, object: <span class="hljs-literal">nil</span>)
        }
        
        <span class="hljs-comment">// ====== æ–¹æ¡ˆäºŒï¼ˆæ›¿ä»£ï¼‰ï¼šä½¿ç”¨ AppLovin MAX ======</span>
        <span class="hljs-comment">/*
        let initConfig = ALSdkInitializationConfiguration(sdkKey: "YOUR_SDK_KEY") { builder in
            builder.mediationProvider = ALMediationProviderMAX
        }
        ALSdk.shared().initialize(with: initConfig) { sdkConfig in
            print("âœ… AppLovin MAX SDK åˆå§‹åŒ–å®Œæˆ")
            NotificationCenter.default.post(name: .adsSDKInitialized, object: nil)
        }
        */</span>
    }
}

<span class="hljs-comment">// MARK: - è‡ªå®šä¹‰é€šçŸ¥å</span>

<span class="hljs-keyword">extension</span> <span class="hljs-title class_">Notification</span>.<span class="hljs-title class_">Name</span> {
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">let</span> adsSDKInitialized <span class="hljs-operator">=</span> <span class="hljs-type">Notification</span>.<span class="hljs-type">Name</span>(<span class="hljs-string">"adsSDKInitialized"</span>)
}
</code></pre>
<h4 data-id="heading-36">6.4 åœ¨ AppDelegate / SceneDelegate ä¸­è°ƒç”¨</h4>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-comment">// SceneDelegate.swift</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">SceneDelegate</span>: <span class="hljs-title class_">UIResponder</span>, <span class="hljs-title class_">UIWindowSceneDelegate</span> {
    
    <span class="hljs-keyword">var</span> window: <span class="hljs-type">UIWindow</span>?
    
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">scene</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">scene</span>: <span class="hljs-type">UIScene</span>, <span class="hljs-params">willConnectTo</span> <span class="hljs-params">session</span>: <span class="hljs-type">UISceneSession</span>, <span class="hljs-params">options</span> <span class="hljs-params">connectionOptions</span>: <span class="hljs-type">UIScene</span>.<span class="hljs-type">ConnectionOptions</span>) {
        <span class="hljs-keyword">guard</span> <span class="hljs-keyword">let</span> windowScene <span class="hljs-operator">=</span> scene <span class="hljs-keyword">as?</span> <span class="hljs-type">UIWindowScene</span> <span class="hljs-keyword">else</span> { <span class="hljs-keyword">return</span> }
        
        <span class="hljs-keyword">let</span> window <span class="hljs-operator">=</span> <span class="hljs-type">UIWindow</span>(windowScene: windowScene)
        <span class="hljs-keyword">let</span> rootVC <span class="hljs-operator">=</span> <span class="hljs-type">MainViewController</span>()
        window.rootViewController <span class="hljs-operator">=</span> <span class="hljs-type">UINavigationController</span>(rootViewController: rootVC)
        window.makeKeyAndVisible()
        <span class="hljs-keyword">self</span>.window <span class="hljs-operator">=</span> window
    }
}

<span class="hljs-comment">// MainViewController.swift</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">MainViewController</span>: <span class="hljs-title class_">UIViewController</span> {
    
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">viewDidAppear</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">animated</span>: <span class="hljs-type">Bool</span>) {
        <span class="hljs-keyword">super</span>.viewDidAppear(animated)
        
        <span class="hljs-comment">// â­ åœ¨ä¸»é¡µé¢æ˜¾ç¤ºåå¯åŠ¨å¹¿å‘Šåˆå§‹åŒ–æµç¨‹</span>
        <span class="hljs-comment">// è¿™æ · GDPR å¼¹çª—å’Œ ATT å¼¹çª—èƒ½æ­£å¸¸å±•ç¤º</span>
        <span class="hljs-type">AppStartupManager</span>.shared.startAdInitialization(from: <span class="hljs-keyword">self</span>)
        
        <span class="hljs-comment">// ç›‘å¬ SDK åˆå§‹åŒ–å®Œæˆ</span>
        <span class="hljs-type">NotificationCenter</span>.default.addObserver(
            <span class="hljs-keyword">self</span>,
            selector: <span class="hljs-keyword">#selector</span>(onAdsReady),
            name: .adsSDKInitialized,
            object: <span class="hljs-literal">nil</span>
        )
    }
    
    <span class="hljs-keyword">@objc</span> <span class="hljs-keyword">private</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">onAdsReady</span>() {
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"ğŸš€ å¹¿å‘Š SDK å·²å°±ç»ªï¼Œå¼€å§‹åŠ è½½å¹¿å‘Š"</span>)
        <span class="hljs-comment">// åœ¨è¿™é‡ŒåŠ è½½å„ç§å¹¿å‘Š</span>
    }
}
</code></pre>
<hr/>
<h3 data-id="heading-37">ä¸ƒã€æµ‹è¯•å’Œè°ƒè¯•</h3>
<h4 data-id="heading-38">7.1 AdMob æµ‹è¯•å¹¿å‘Š ID</h4>
<p>åœ¨å¼€å‘é˜¶æ®µï¼Œä½¿ç”¨ Google æä¾›çš„å®˜æ–¹æµ‹è¯• IDï¼Œ<strong>ä¸è¦ä½¿ç”¨çœŸå®å¹¿å‘Š ID æµ‹è¯•</strong>ï¼ˆä¼šè¢«å°å·ï¼‰ï¼š</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">TestAdUnitIDs</span> {
    <span class="hljs-comment">// Google å®˜æ–¹æµ‹è¯• IDï¼ˆå®‰å…¨ä½¿ç”¨ï¼Œä¸ä¼šè§¦å‘è¿è§„ï¼‰</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">let</span> admobBanner           <span class="hljs-operator">=</span> <span class="hljs-string">"ca-app-pub-3940256099942544/2934735716"</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">let</span> admobInterstitial     <span class="hljs-operator">=</span> <span class="hljs-string">"ca-app-pub-3940256099942544/4411468910"</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">let</span> admobRewarded         <span class="hljs-operator">=</span> <span class="hljs-string">"ca-app-pub-3940256099942544/1712485313"</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">let</span> admobRewardedInterstitial <span class="hljs-operator">=</span> <span class="hljs-string">"ca-app-pub-3940256099942544/6978759866"</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">let</span> admobNative           <span class="hljs-operator">=</span> <span class="hljs-string">"ca-app-pub-3940256099942544/3986624511"</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">let</span> admobAppOpen          <span class="hljs-operator">=</span> <span class="hljs-string">"ca-app-pub-3940256099942544/5575463023"</span>
}
</code></pre>
<h4 data-id="heading-39">7.2 Meta AN æµ‹è¯•æ¨¡å¼</h4>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">#if</span> <span class="hljs-type">DEBUG</span>
<span class="hljs-comment">// æ·»åŠ æµ‹è¯•è®¾å¤‡ï¼ˆè®¾å¤‡ IDFA çš„å“ˆå¸Œå€¼ï¼Œåœ¨æ§åˆ¶å°æ—¥å¿—ä¸­æŸ¥æ‰¾ï¼‰</span>
<span class="hljs-type">FBAdSettings</span>.addTestDevice(<span class="hljs-string">"YOUR_DEVICE_HASH"</span>)

<span class="hljs-comment">// æˆ–è€…å¯ç”¨æ¨¡æ‹Ÿå™¨æµ‹è¯•æ¨¡å¼</span>
<span class="hljs-type">FBAdSettings</span>.addTestDevice(<span class="hljs-type">FBAdSettings</span>.testDeviceHash())

<span class="hljs-comment">// è®¾ç½®æµ‹è¯•å¹¿å‘Šç±»å‹ï¼ˆå¯é€‰ï¼‰</span>
<span class="hljs-comment">// FBAdSettings.setLogLevel(.log)</span>
<span class="hljs-keyword">#endif</span>
</code></pre>
<h4 data-id="heading-40">7.3 AppLovin MAX è°ƒè¯•å·¥å…·</h4>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">#if</span> <span class="hljs-type">DEBUG</span>
<span class="hljs-comment">// æ˜¾ç¤º MAX Mediation Debuggerï¼ˆå¯è§†åŒ–è°ƒè¯•é¢æ¿ï¼‰</span>
<span class="hljs-comment">// æ˜¾ç¤ºæ‰€æœ‰é€‚é…å™¨çŠ¶æ€ã€å¹¿å‘ŠåŠ è½½è®°å½•ç­‰</span>
<span class="hljs-type">ALSdk</span>.shared().showMediationDebugger()
<span class="hljs-keyword">#endif</span>
</code></pre>
<blockquote>
<p>ğŸ’¡ <strong>MAX Mediation Debugger éå¸¸å¼ºå¤§</strong>ï¼Œå¯ä»¥ä¸€ç›®äº†ç„¶çœ‹åˆ°ï¼š</p>
<ul>
<li>å„é€‚é…å™¨æ˜¯å¦æ­£ç¡®åˆå§‹åŒ–</li>
<li>å„ç½‘ç»œçš„ç«ä»·æƒ…å†µ</li>
<li>å¹¿å‘ŠåŠ è½½æˆåŠŸ/å¤±è´¥è¯¦æƒ…</li>
</ul>
</blockquote>
<h4 data-id="heading-41">7.4 å¹¿å‘Šæ¥æºè¿½è¸ªï¼ˆé€šç”¨ï¼‰</h4>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-comment">/// ç»Ÿä¸€çš„å¹¿å‘Šäº‹ä»¶è¿½è¸ªå™¨</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">AdEventTracker</span> {
    
    <span class="hljs-comment">/// è®°å½•å¹¿å‘Šå±•ç¤ºæ¥æº</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">trackImpression</span>(
        <span class="hljs-params">adFormat</span>: <span class="hljs-type">String</span>,       <span class="hljs-comment">// "banner" / "interstitial" / "rewarded"</span>
        <span class="hljs-params">networkName</span>: <span class="hljs-type">String</span>,    <span class="hljs-comment">// "AdMob" / "Meta" / "Google Bidding"</span>
        <span class="hljs-params">revenue</span>: <span class="hljs-type">Double</span>? <span class="hljs-operator">=</span> <span class="hljs-literal">nil</span>, <span class="hljs-comment">// æ”¶ç›Šï¼ˆå¦‚å¯ç”¨ï¼‰</span>
        <span class="hljs-params">adUnitID</span>: <span class="hljs-type">String</span>
    ) {
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"""
        ğŸ“Š å¹¿å‘Šæ›å…‰
          æ ¼å¼: <span class="hljs-subst">\(adFormat)</span>
          æ¥æº: <span class="hljs-subst">\(networkName)</span>
          æ”¶ç›Š: <span class="hljs-subst">\(revenue.map { String(format: <span class="hljs-string">"%.6f"</span>, <span class="hljs-variable">$0</span>) } <span class="hljs-operator">??</span> <span class="hljs-string">"N/A"</span>)</span>
          å¹¿å‘Šå•å…ƒ: <span class="hljs-subst">\(adUnitID)</span>
        """</span>)
        
        <span class="hljs-comment">// å‘é€åˆ°ä½ çš„åˆ†æå¹³å°ï¼ˆFirebase / Amplitude / è‡ªå»ºç­‰ï¼‰</span>
        <span class="hljs-comment">// Analytics.logEvent("ad_impression", parameters: [...])</span>
    }
    
    <span class="hljs-comment">// â€”â€” AdMob è·å–æ”¶ç›Šä¿¡æ¯ â€”â€”</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">trackAdMobRevenue</span>(<span class="hljs-params">ad</span>: <span class="hljs-type">GADFullScreenPresentingAd</span>, <span class="hljs-params">adFormat</span>: <span class="hljs-type">String</span>) {
        <span class="hljs-comment">// AdMob æ”¶ç›Šè¿½è¸ªéœ€è¦é€šè¿‡ paidEventHandler</span>
        <span class="hljs-comment">// åœ¨åŠ è½½æˆåŠŸåè®¾ç½®ï¼š</span>
        <span class="hljs-comment">// ad.paidEventHandler = { value in</span>
        <span class="hljs-comment">//     let revenue = value.value.doubleValue / 1_000_000 // å¾®å•ä½è½¬æ¢</span>
        <span class="hljs-comment">//     trackImpression(adFormat: adFormat, networkName: "AdMob", revenue: revenue, adUnitID: "xxx")</span>
        <span class="hljs-comment">// }</span>
    }
    
    <span class="hljs-comment">// â€”â€” MAX è·å–æ”¶ç›Šä¿¡æ¯ â€”â€”</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">trackMAXRevenue</span>(<span class="hljs-params">ad</span>: <span class="hljs-type">MAAd</span>, <span class="hljs-params">adFormat</span>: <span class="hljs-type">String</span>) {
        <span class="hljs-keyword">let</span> revenue <span class="hljs-operator">=</span> ad.revenue <span class="hljs-comment">// MAX ç›´æ¥æä¾›æ”¶ç›Šå€¼</span>
        <span class="hljs-keyword">let</span> networkName <span class="hljs-operator">=</span> ad.networkName
        trackImpression(
            adFormat: adFormat,
            networkName: networkName,
            revenue: revenue,
            adUnitID: ad.adUnitIdentifier
        )
    }
}
</code></pre>
<h4 data-id="heading-42">7.5 å¸¸è§é—®é¢˜æ’æŸ¥æ¸…å•</h4>


















































<table><thead><tr><th>é—®é¢˜</th><th>å¯èƒ½åŸå› </th><th>è§£å†³æ–¹æ¡ˆ</th></tr></thead><tbody><tr><td>Meta AN å§‹ç»ˆ No Fill</td><td>æœªé€šè¿‡ Meta å®¡æ ¸ / Placement ID é”™è¯¯</td><td>ç¡®è®¤ App å·²åœ¨ Meta Business å®¡æ ¸é€šè¿‡</td></tr><tr><td>AdMob Adapter æœªåˆå§‹åŒ–</td><td><code>GADApplicationIdentifier</code> æœªé…ç½®</td><td>æ£€æŸ¥ Info.plist</td></tr><tr><td>ATT å¼¹çª—ä¸å‡ºç°</td><td>åœ¨ <code>viewDidLoad</code> ä¸­è°ƒç”¨å¤ªæ—©</td><td>æ”¹åˆ° <code>viewDidAppear</code> ä¸­è°ƒç”¨</td></tr><tr><td>æ”¶ç›Šæä½</td><td>ä»…ä¸€ä¸ªç½‘ç»œå‚ä¸ç«äº‰</td><td>æ¥å…¥æ›´å¤šç½‘ç»œï¼ˆBidding ç«äº‰è¶Šå¤šæ”¶ç›Šè¶Šé«˜ï¼‰</td></tr><tr><td>æµ‹è¯•æ—¶å±•ç¤ºçœŸå®å¹¿å‘Š</td><td>æœªæ·»åŠ æµ‹è¯•è®¾å¤‡</td><td>ä½¿ç”¨æµ‹è¯• ID æˆ–æ·»åŠ æµ‹è¯•è®¾å¤‡</td></tr><tr><td>å´©æºƒï¼š<code>GADApplicationIdentifier</code></td><td>AdMob App ID æ ¼å¼é”™è¯¯</td><td>æ ¼å¼åº”ä¸º <code>ca-app-pub-xxxx~yyyy</code></td></tr><tr><td>Meta SDK åˆå§‹åŒ–å¤±è´¥</td><td>iOS Deployment Target &lt; 13.0</td><td>å‡çº§æœ€ä½ç‰ˆæœ¬åˆ° 13.0</td></tr><tr><td>MAX Debugger æ˜¾ç¤ºçº¢è‰²</td><td>é€‚é…å™¨ç‰ˆæœ¬ä¸å…¼å®¹</td><td>æ›´æ–°æ‰€æœ‰ Pod åˆ°æœ€æ–°ç‰ˆæœ¬</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-43">å…«ã€æ”¶ç›Šä¼˜åŒ–æœ€ä½³å®è·µ</h3>
<h4 data-id="heading-44">8.1 å¹¿å‘Šå±•ç¤ºç­–ç•¥</h4>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-comment">/// å¹¿å‘Šé¢‘æ¬¡æ§åˆ¶å™¨</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">AdFrequencyManager</span> {
    
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">let</span> shared <span class="hljs-operator">=</span> <span class="hljs-type">AdFrequencyManager</span>()
    
    <span class="hljs-comment">// é…ç½®</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">let</span> interstitialMinInterval: <span class="hljs-type">TimeInterval</span> <span class="hljs-operator">=</span> <span class="hljs-number">60</span>      <span class="hljs-comment">// æ’å±æœ€å°‘é—´éš” 60 ç§’</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">let</span> maxInterstitialsPerSession <span class="hljs-operator">=</span> <span class="hljs-number">10</span>                  <span class="hljs-comment">// æ¯æ¬¡ä¼šè¯æœ€å¤š 10 ä¸ªæ’å±</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">let</span> rewardedCooldown: <span class="hljs-type">TimeInterval</span> <span class="hljs-operator">=</span> <span class="hljs-number">30</span>              <span class="hljs-comment">// æ¿€åŠ±è§†é¢‘å†·å´ 30 ç§’</span>
    
    <span class="hljs-comment">// çŠ¶æ€</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> lastInterstitialTime: <span class="hljs-type">Date</span>?
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> sessionInterstitialCount <span class="hljs-operator">=</span> <span class="hljs-number">0</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> lastRewardedTime: <span class="hljs-type">Date</span>?
    
    <span class="hljs-comment">/// æ£€æŸ¥æ˜¯å¦å¯ä»¥å±•ç¤ºæ’å±</span>
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">canShowInterstitial</span>() -&gt; <span class="hljs-type">Bool</span> {
        <span class="hljs-comment">// æ£€æŸ¥é¢‘ç‡é™åˆ¶</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> lastTime <span class="hljs-operator">=</span> lastInterstitialTime {
            <span class="hljs-keyword">let</span> elapsed <span class="hljs-operator">=</span> <span class="hljs-type">Date</span>().timeIntervalSince(lastTime)
            <span class="hljs-keyword">if</span> elapsed <span class="hljs-operator">&lt;</span> interstitialMinInterval {
                <span class="hljs-built_in">print</span>(<span class="hljs-string">"â³ æ’å±å†·å´ä¸­ï¼Œè¿˜éœ€ <span class="hljs-subst">\(Int(interstitialMinInterval <span class="hljs-operator">-</span> elapsed))</span> ç§’"</span>)
                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>
            }
        }
        
        <span class="hljs-comment">// æ£€æŸ¥ä¼šè¯ä¸Šé™</span>
        <span class="hljs-keyword">if</span> sessionInterstitialCount <span class="hljs-operator">&gt;=</span> maxInterstitialsPerSession {
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"ğŸš« å·²è¾¾åˆ°æœ¬æ¬¡ä¼šè¯æ’å±ä¸Šé™"</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>
        }
        
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>
    }
    
    <span class="hljs-comment">/// è®°å½•æ’å±å·²å±•ç¤º</span>
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">recordInterstitialShown</span>() {
        lastInterstitialTime <span class="hljs-operator">=</span> <span class="hljs-type">Date</span>()
        sessionInterstitialCount <span class="hljs-operator">+=</span> <span class="hljs-number">1</span>
    }
    
    <span class="hljs-comment">/// æ£€æŸ¥æ˜¯å¦å¯ä»¥å±•ç¤ºæ¿€åŠ±è§†é¢‘</span>
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">canShowRewarded</span>() -&gt; <span class="hljs-type">Bool</span> {
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> lastTime <span class="hljs-operator">=</span> lastRewardedTime {
            <span class="hljs-keyword">let</span> elapsed <span class="hljs-operator">=</span> <span class="hljs-type">Date</span>().timeIntervalSince(lastTime)
            <span class="hljs-keyword">if</span> elapsed <span class="hljs-operator">&lt;</span> rewardedCooldown {
                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>
            }
        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>
    }
    
    <span class="hljs-comment">/// è®°å½•æ¿€åŠ±è§†é¢‘å·²å±•ç¤º</span>
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">recordRewardedShown</span>() {
        lastRewardedTime <span class="hljs-operator">=</span> <span class="hljs-type">Date</span>()
    }
    
    <span class="hljs-comment">/// é‡ç½®ä¼šè¯è®¡æ•°ï¼ˆApp å¯åŠ¨æˆ–ä»åå°æ¢å¤æ—¶è°ƒç”¨ï¼‰</span>
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">resetSession</span>() {
        sessionInterstitialCount <span class="hljs-operator">=</span> <span class="hljs-number">0</span>
    }
}
</code></pre>
<h4 data-id="heading-45">8.2 æ”¶ç›Šä¼˜åŒ–æ¸…å•</h4>













































<table><thead><tr><th>ä¼˜åŒ–é¡¹</th><th>è¯´æ˜</th><th>é¢„æœŸæ•ˆæœ</th></tr></thead><tbody><tr><td><strong>æ¥å…¥ 3+ ä¸ª Bidding ç½‘ç»œ</strong></td><td>ç«äº‰è¶Šå¤šå‡ºä»·è¶Šé«˜</td><td>eCPM æå‡ 20~50%</td></tr><tr><td><strong>ä½¿ç”¨å®æ—¶ç«ä»·</strong></td><td>ä¼˜äºä¼ ç»Ÿ Waterfall</td><td>eCPM æå‡ 10~30%</td></tr><tr><td><strong>åˆç†æ§åˆ¶é¢‘æ¬¡</strong></td><td>é¿å…ç”¨æˆ·ç–²åŠ³å’Œæ”¿ç­–è¿è§„</td><td>é•¿æœŸæ”¶ç›Šç¨³å®š</td></tr><tr><td><strong>é¢„åŠ è½½å¹¿å‘Š</strong></td><td>å…³é—­åç«‹å³é¢„åŠ è½½ä¸‹ä¸€ä¸ª</td><td>å¡«å……ç‡æ¥è¿‘ 100%</td></tr><tr><td><strong>ATT ä¼˜åŒ–å¼¹çª—æ–‡æ¡ˆ</strong></td><td>æé«˜æˆæƒç‡ â†’ ä¸ªæ€§åŒ–å¹¿å‘Šæ”¶ç›Šæ›´é«˜</td><td>eCPM æå‡ 15~30%</td></tr><tr><td><strong>Banner è‡ªé€‚åº”å°ºå¯¸</strong></td><td>ä½¿ç”¨ Adaptive Banner æ›¿ä»£å›ºå®šå°ºå¯¸</td><td>eCPM æå‡ 10~20%</td></tr><tr><td><strong>å®šæœŸæ›´æ–° SDK</strong></td><td>å„ç½‘ç»œæŒç»­ä¼˜åŒ–ç«ä»·ç®—æ³•</td><td>æŒç»­æ”¶ç›Šæ”¹å–„</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-46">ä¹ã€é¡¹ç›®æ–‡ä»¶ç»“æ„å»ºè®®</h3>
<pre><code class="hljs language-arduino" lang="arduino">YourApp/
â”œâ”€â”€ Podfile
â”œâ”€â”€ Info.plist
â”œâ”€â”€ AppDelegate.swift
â”œâ”€â”€ SceneDelegate.swift
â”‚
â”œâ”€â”€ Ads/
â”‚   â”œâ”€â”€ Core/
â”‚   â”‚   â”œâ”€â”€ AppStartupManager.swift          <span class="hljs-comment">// å®Œæ•´åˆå§‹åŒ–æµç¨‹ï¼ˆGDPRâ†’ATTâ†’SDKï¼‰</span>
â”‚   â”‚   â”œâ”€â”€ ConsentManager.swift             <span class="hljs-comment">// GDPR / UMP åŒæ„ç®¡ç†</span>
â”‚   â”‚   â”œâ”€â”€ MetaPrivacyHelper.swift          <span class="hljs-comment">// Meta éšç§åˆè§„</span>
â”‚   â”‚   â”œâ”€â”€ AdFrequencyManager.swift         <span class="hljs-comment">// å¹¿å‘Šé¢‘æ¬¡æ§åˆ¶</span>
â”‚   â”‚   â””â”€â”€ AdEventTracker.swift             <span class="hljs-comment">// æ”¶ç›Š/äº‹ä»¶è¿½è¸ª</span>
â”‚   â”‚
â”‚   â”œâ”€â”€ AdMobMediation/                      <span class="hljs-comment">// æ–¹æ¡ˆä¸€ï¼šAdMob Mediation</span>
â”‚   â”‚   â”œâ”€â”€ AdMobBannerManager.swift
â”‚   â”‚   â”œâ”€â”€ AdMobInterstitialManager.swift
â”‚   â”‚   â””â”€â”€ AdMobRewardedManager.swift
â”‚   â”‚
â”‚   â”œâ”€â”€ MAXMediation/                        <span class="hljs-comment">// æ–¹æ¡ˆäºŒï¼šAppLovin MAX</span>
â”‚   â”‚   â”œâ”€â”€ MAXBannerManager.swift
â”‚   â”‚   â”œâ”€â”€ MAXInterstitialManager.swift
â”‚   â”‚   â””â”€â”€ MAXRewardedManager.swift
â”‚   â”‚
â”‚   â””â”€â”€ Manual/                              <span class="hljs-comment">// æ–¹æ¡ˆä¸‰ï¼ˆä¸æ¨èï¼‰</span>
â”‚       â””â”€â”€ ManualAdManager.swift
â”‚
â”œâ”€â”€ Config/
â”‚   â”œâ”€â”€ AdConfig.swift                       <span class="hljs-comment">// å¹¿å‘Š ID é…ç½®ï¼ˆå¼€å‘/ç”Ÿäº§ï¼‰</span>
â”‚   â””â”€â”€ TestAdUnitIDs.swift                  <span class="hljs-comment">// æµ‹è¯•å¹¿å‘Š ID</span>
â”‚
â”œâ”€â”€ Views/
â”‚   â””â”€â”€ ...
â””â”€â”€ ViewControllers/
    â””â”€â”€ ...
</code></pre>
<h4 data-id="heading-47">9.1 å¹¿å‘Šé…ç½®æ–‡ä»¶ï¼ˆå¼€å‘/ç”Ÿäº§åˆ‡æ¢ï¼‰</h4>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-comment">// AdConfig.swift</span>
<span class="hljs-keyword">import</span> Foundation

<span class="hljs-keyword">struct</span> <span class="hljs-title class_">AdConfig</span> {
    
    <span class="hljs-comment">// MARK: - ç¯å¢ƒåˆ‡æ¢</span>
    
    <span class="hljs-keyword">#if</span> <span class="hljs-type">DEBUG</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">let</span> isTestMode <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>
    <span class="hljs-keyword">#else</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">let</span> isTestMode <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>
    <span class="hljs-keyword">#endif</span>
    
    <span class="hljs-comment">// MARK: - AdMob é…ç½®</span>
    
    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">AdMob</span> {
        <span class="hljs-keyword">static</span> <span class="hljs-keyword">var</span> bannerID: <span class="hljs-type">String</span> {
            isTestMode
                <span class="hljs-operator">?</span> <span class="hljs-string">"ca-app-pub-3940256099942544/2934735716"</span>       <span class="hljs-comment">// æµ‹è¯•</span>
                : <span class="hljs-string">"ca-app-pub-YOUR_REAL_PUB_ID/BANNER_ID"</span>       <span class="hljs-comment">// ç”Ÿäº§</span>
        }
        
        <span class="hljs-keyword">static</span> <span class="hljs-keyword">var</span> interstitialID: <span class="hljs-type">String</span> {
            isTestMode
                <span class="hljs-operator">?</span> <span class="hljs-string">"ca-app-pub-3940256099942544/4411468910"</span>
                : <span class="hljs-string">"ca-app-pub-YOUR_REAL_PUB_ID/INTERSTITIAL_ID"</span>
        }
        
        <span class="hljs-keyword">static</span> <span class="hljs-keyword">var</span> rewardedID: <span class="hljs-type">String</span> {
            isTestMode
                <span class="hljs-operator">?</span> <span class="hljs-string">"ca-app-pub-3940256099942544/1712485313"</span>
                : <span class="hljs-string">"ca-app-pub-YOUR_REAL_PUB_ID/REWARDED_ID"</span>
        }
    }
    
    <span class="hljs-comment">// MARK: - Meta AN é…ç½®</span>
    
    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">Meta</span> {
        <span class="hljs-keyword">static</span> <span class="hljs-keyword">var</span> bannerPlacementID: <span class="hljs-type">String</span> {
            isTestMode
                <span class="hljs-operator">?</span> <span class="hljs-string">"IMG_16_9_APP_INSTALL#YOUR_PLACEMENT_ID"</span>       <span class="hljs-comment">// æµ‹è¯•</span>
                : <span class="hljs-string">"YOUR_REAL_PLACEMENT_ID"</span>                        <span class="hljs-comment">// ç”Ÿäº§</span>
        }
        
        <span class="hljs-keyword">static</span> <span class="hljs-keyword">var</span> interstitialPlacementID: <span class="hljs-type">String</span> {
            isTestMode
                <span class="hljs-operator">?</span> <span class="hljs-string">"IMG_16_9_APP_INSTALL#YOUR_PLACEMENT_ID"</span>
                : <span class="hljs-string">"YOUR_REAL_PLACEMENT_ID"</span>
        }
        
        <span class="hljs-keyword">static</span> <span class="hljs-keyword">var</span> rewardedPlacementID: <span class="hljs-type">String</span> {
            isTestMode
                <span class="hljs-operator">?</span> <span class="hljs-string">"VID_HD_16_9_46S_APP_INSTALL#YOUR_PLACEMENT_ID"</span>
                : <span class="hljs-string">"YOUR_REAL_PLACEMENT_ID"</span>
        }
    }
    
    <span class="hljs-comment">// MARK: - AppLovin MAX é…ç½®</span>
    
    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">MAX</span> {
        <span class="hljs-keyword">static</span> <span class="hljs-keyword">let</span> sdkKey <span class="hljs-operator">=</span> <span class="hljs-string">"YOUR_APPLOVIN_SDK_KEY"</span>
        
        <span class="hljs-comment">// MAX Ad Unit IDï¼ˆåœ¨ AppLovin Dashboard åˆ›å»ºï¼‰</span>
        <span class="hljs-keyword">static</span> <span class="hljs-keyword">let</span> bannerAdUnitID       <span class="hljs-operator">=</span> <span class="hljs-string">"YOUR_MAX_BANNER_UNIT"</span>
        <span class="hljs-keyword">static</span> <span class="hljs-keyword">let</span> interstitialAdUnitID <span class="hljs-operator">=</span> <span class="hljs-string">"YOUR_MAX_INTERSTITIAL_UNIT"</span>
        <span class="hljs-keyword">static</span> <span class="hljs-keyword">let</span> rewardedAdUnitID     <span class="hljs-operator">=</span> <span class="hljs-string">"YOUR_MAX_REWARDED_UNIT"</span>
    }
}
</code></pre>
<hr/>
<h3 data-id="heading-48">åã€SwiftUI é›†æˆï¼ˆé¢å¤–è¡¥å……ï¼‰</h3>
<p>å¦‚æœä½ çš„é¡¹ç›®ä½¿ç”¨ SwiftUIï¼Œä»¥ä¸‹æ˜¯é€‚é…æ–¹å¼ï¼š</p>
<h4 data-id="heading-49">10.1 AdMob Banner çš„ SwiftUI å°è£…</h4>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">import</span> SwiftUI
<span class="hljs-keyword">import</span> GoogleMobileAds

<span class="hljs-keyword">struct</span> <span class="hljs-title class_">AdMobBannerView</span>: <span class="hljs-title class_">UIViewRepresentable</span> {
    
    <span class="hljs-keyword">let</span> adUnitID: <span class="hljs-type">String</span>
    
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">makeUIView</span>(<span class="hljs-params">context</span>: <span class="hljs-type">Context</span>) -&gt; <span class="hljs-type">GADBannerView</span> {
        <span class="hljs-keyword">let</span> bannerView <span class="hljs-operator">=</span> <span class="hljs-type">GADBannerView</span>(adSize: <span class="hljs-type">GADAdSizeBanner</span>)
        bannerView.adUnitID <span class="hljs-operator">=</span> adUnitID
        bannerView.delegate <span class="hljs-operator">=</span> context.coordinator
        
        <span class="hljs-comment">// å»¶è¿Ÿè·å– rootViewControllerï¼ˆSwiftUI ç¯å¢ƒéœ€è¦è¿™æ ·åšï¼‰</span>
        <span class="hljs-type">DispatchQueue</span>.main.async {
            <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> windowScene <span class="hljs-operator">=</span> <span class="hljs-type">UIApplication</span>.shared.connectedScenes.first <span class="hljs-keyword">as?</span> <span class="hljs-type">UIWindowScene</span>,
               <span class="hljs-keyword">let</span> rootVC <span class="hljs-operator">=</span> windowScene.windows.first<span class="hljs-operator">?</span>.rootViewController {
                bannerView.rootViewController <span class="hljs-operator">=</span> rootVC
                bannerView.load(<span class="hljs-type">GADRequest</span>())
            }
        }
        
        <span class="hljs-keyword">return</span> bannerView
    }
    
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">updateUIView</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">uiView</span>: <span class="hljs-type">GADBannerView</span>, <span class="hljs-params">context</span>: <span class="hljs-type">Context</span>) {}
    
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">makeCoordinator</span>() -&gt; <span class="hljs-type">Coordinator</span> {
        <span class="hljs-type">Coordinator</span>()
    }
    
    <span class="hljs-keyword">class</span> <span class="hljs-title class_">Coordinator</span>: <span class="hljs-title class_">NSObject</span>, <span class="hljs-title class_">GADBannerViewDelegate</span> {
        <span class="hljs-keyword">func</span> <span class="hljs-title function_">bannerViewDidReceiveAd</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">bannerView</span>: <span class="hljs-type">GADBannerView</span>) {
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"âœ… [SwiftUI] Banner åŠ è½½æˆåŠŸ"</span>)
        }
        
        <span class="hljs-keyword">func</span> <span class="hljs-title function_">bannerView</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">bannerView</span>: <span class="hljs-type">GADBannerView</span>, <span class="hljs-params">didFailToReceiveAdWithError</span> <span class="hljs-params">error</span>: <span class="hljs-type">Error</span>) {
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"âŒ [SwiftUI] Banner åŠ è½½å¤±è´¥: <span class="hljs-subst">\(error.localizedDescription)</span>"</span>)
        }
    }
}
</code></pre>
<h4 data-id="heading-50">10.2 åœ¨ SwiftUI View ä¸­ä½¿ç”¨</h4>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">import</span> SwiftUI

<span class="hljs-keyword">struct</span> <span class="hljs-title class_">GameView</span>: <span class="hljs-title class_">View</span> {
    
    <span class="hljs-meta">@StateObject</span> <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> adViewModel <span class="hljs-operator">=</span> <span class="hljs-type">AdViewModel</span>()
    
    <span class="hljs-keyword">var</span> body: <span class="hljs-keyword">some</span> <span class="hljs-type">View</span> {
        <span class="hljs-type">VStack</span> {
            <span class="hljs-comment">// æ¸¸æˆå†…å®¹</span>
            <span class="hljs-type">Text</span>(<span class="hljs-string">"Your Game Content"</span>)
                .frame(maxWidth: .infinity, maxHeight: .infinity)
            
            <span class="hljs-comment">// åº•éƒ¨ Banner å¹¿å‘Š</span>
            <span class="hljs-type">AdMobBannerView</span>(adUnitID: <span class="hljs-type">AdConfig</span>.<span class="hljs-type">AdMob</span>.bannerID)
                .frame(height: <span class="hljs-number">50</span>)
        }
        .onAppear {
            adViewModel.loadInterstitial()
            adViewModel.loadRewarded()
        }
    }
}

<span class="hljs-comment">// MARK: - å¹¿å‘Š ViewModel</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">AdViewModel</span>: <span class="hljs-title class_">ObservableObject</span> {
    
    <span class="hljs-meta">@Published</span> <span class="hljs-keyword">var</span> isInterstitialReady <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>
    <span class="hljs-meta">@Published</span> <span class="hljs-keyword">var</span> isRewardedReady <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> interstitialAd: <span class="hljs-type">GADInterstitialAd</span>?
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> rewardedAd: <span class="hljs-type">GADRewardedAd</span>?
    
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">loadInterstitial</span>() {
        <span class="hljs-type">GADInterstitialAd</span>.load(
            withAdUnitID: <span class="hljs-type">AdConfig</span>.<span class="hljs-type">AdMob</span>.interstitialID,
            request: <span class="hljs-type">GADRequest</span>()
        ) { [<span class="hljs-keyword">weak</span> <span class="hljs-keyword">self</span>] ad, error <span class="hljs-keyword">in</span>
            <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> ad <span class="hljs-operator">=</span> ad {
                <span class="hljs-keyword">self</span><span class="hljs-operator">?</span>.interstitialAd <span class="hljs-operator">=</span> ad
                <span class="hljs-keyword">self</span><span class="hljs-operator">?</span>.isInterstitialReady <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>
            }
        }
    }
    
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">showInterstitial</span>() {
        <span class="hljs-keyword">guard</span> isInterstitialReady,
              <span class="hljs-keyword">let</span> ad <span class="hljs-operator">=</span> interstitialAd,
              <span class="hljs-keyword">let</span> windowScene <span class="hljs-operator">=</span> <span class="hljs-type">UIApplication</span>.shared.connectedScenes.first <span class="hljs-keyword">as?</span> <span class="hljs-type">UIWindowScene</span>,
              <span class="hljs-keyword">let</span> rootVC <span class="hljs-operator">=</span> windowScene.windows.first<span class="hljs-operator">?</span>.rootViewController <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">return</span>
        }
        
        ad.present(fromRootViewController: rootVC)
        isInterstitialReady <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>
        
        <span class="hljs-comment">// å±•ç¤ºåé‡æ–°åŠ è½½</span>
        <span class="hljs-type">DispatchQueue</span>.main.asyncAfter(deadline: .now() <span class="hljs-operator">+</span> <span class="hljs-number">1</span>) { [<span class="hljs-keyword">weak</span> <span class="hljs-keyword">self</span>] <span class="hljs-keyword">in</span>
            <span class="hljs-keyword">self</span><span class="hljs-operator">?</span>.loadInterstitial()
        }
    }
    
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">loadRewarded</span>() {
        <span class="hljs-type">GADRewardedAd</span>.load(
            withAdUnitID: <span class="hljs-type">AdConfig</span>.<span class="hljs-type">AdMob</span>.rewardedID,
            request: <span class="hljs-type">GADRequest</span>()
        ) { [<span class="hljs-keyword">weak</span> <span class="hljs-keyword">self</span>] ad, error <span class="hljs-keyword">in</span>
            <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> ad <span class="hljs-operator">=</span> ad {
                <span class="hljs-keyword">self</span><span class="hljs-operator">?</span>.rewardedAd <span class="hljs-operator">=</span> ad
                <span class="hljs-keyword">self</span><span class="hljs-operator">?</span>.isRewardedReady <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>
            }
        }
    }
    
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">showRewarded</span>(<span class="hljs-params">onReward</span>: <span class="hljs-keyword">@escaping</span> (<span class="hljs-type">Int</span>, <span class="hljs-type">String</span>) -&gt; <span class="hljs-type">Void</span>) {
        <span class="hljs-keyword">guard</span> isRewardedReady,
              <span class="hljs-keyword">let</span> ad <span class="hljs-operator">=</span> rewardedAd,
              <span class="hljs-keyword">let</span> windowScene <span class="hljs-operator">=</span> <span class="hljs-type">UIApplication</span>.shared.connectedScenes.first <span class="hljs-keyword">as?</span> <span class="hljs-type">UIWindowScene</span>,
              <span class="hljs-keyword">let</span> rootVC <span class="hljs-operator">=</span> windowScene.windows.first<span class="hljs-operator">?</span>.rootViewController <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">return</span>
        }
        
        ad.present(fromRootViewController: rootVC) {
            <span class="hljs-keyword">let</span> reward <span class="hljs-operator">=</span> ad.adReward
            onReward(reward.amount.intValue, reward.type)
        }
        
        isRewardedReady <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>
        <span class="hljs-type">DispatchQueue</span>.main.asyncAfter(deadline: .now() <span class="hljs-operator">+</span> <span class="hljs-number">1</span>) { [<span class="hljs-keyword">weak</span> <span class="hljs-keyword">self</span>] <span class="hljs-keyword">in</span>
            <span class="hljs-keyword">self</span><span class="hljs-operator">?</span>.loadRewarded()
        }
    }
}
</code></pre>
<h4 data-id="heading-51">10.3 AppLovin MAX çš„ SwiftUI å°è£…</h4>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">import</span> SwiftUI
<span class="hljs-keyword">import</span> AppLovinSDK

<span class="hljs-keyword">struct</span> <span class="hljs-title class_">MAXBannerSwiftUIView</span>: <span class="hljs-title class_">UIViewRepresentable</span> {
    
    <span class="hljs-keyword">let</span> adUnitID: <span class="hljs-type">String</span>
    
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">makeUIView</span>(<span class="hljs-params">context</span>: <span class="hljs-type">Context</span>) -&gt; <span class="hljs-type">MAAdView</span> {
        <span class="hljs-keyword">let</span> adView <span class="hljs-operator">=</span> <span class="hljs-type">MAAdView</span>(adUnitIdentifier: adUnitID)
        adView.delegate <span class="hljs-operator">=</span> context.coordinator
        adView.backgroundColor <span class="hljs-operator">=</span> .clear
        adView.loadAd()
        <span class="hljs-keyword">return</span> adView
    }
    
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">updateUIView</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">uiView</span>: <span class="hljs-type">MAAdView</span>, <span class="hljs-params">context</span>: <span class="hljs-type">Context</span>) {}
    
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">makeCoordinator</span>() -&gt; <span class="hljs-type">Coordinator</span> {
        <span class="hljs-type">Coordinator</span>()
    }
    
    <span class="hljs-keyword">class</span> <span class="hljs-title class_">Coordinator</span>: <span class="hljs-title class_">NSObject</span>, <span class="hljs-title class_">MAAdViewAdDelegate</span> {
        <span class="hljs-keyword">func</span> <span class="hljs-title function_">didLoad</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">ad</span>: <span class="hljs-type">MAAd</span>) {
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"âœ… [SwiftUI] MAX Banner åŠ è½½æˆåŠŸ, æ¥æº: <span class="hljs-subst">\(ad.networkName)</span>"</span>)
        }
        
        <span class="hljs-keyword">func</span> <span class="hljs-title function_">didFailToLoadAd</span>(<span class="hljs-params">forAdUnitIdentifier</span> <span class="hljs-params">adUnitIdentifier</span>: <span class="hljs-type">String</span>, <span class="hljs-params">withError</span> <span class="hljs-params">error</span>: <span class="hljs-type">MAError</span>) {
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"âŒ [SwiftUI] MAX Banner åŠ è½½å¤±è´¥: <span class="hljs-subst">\(error.message)</span>"</span>)
        }
        
        <span class="hljs-keyword">func</span> <span class="hljs-title function_">didClick</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">ad</span>: <span class="hljs-type">MAAd</span>) {}
        <span class="hljs-keyword">func</span> <span class="hljs-title function_">didFail</span>(<span class="hljs-params">toDisplay</span> <span class="hljs-params">ad</span>: <span class="hljs-type">MAAd</span>, <span class="hljs-params">withError</span> <span class="hljs-params">error</span>: <span class="hljs-type">MAError</span>) {}
        <span class="hljs-keyword">func</span> <span class="hljs-title function_">didExpand</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">ad</span>: <span class="hljs-type">MAAd</span>) {}
        <span class="hljs-keyword">func</span> <span class="hljs-title function_">didCollapse</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">ad</span>: <span class="hljs-type">MAAd</span>) {}
    }
}

<span class="hljs-comment">// ä½¿ç”¨æ–¹å¼</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">ContentView</span>: <span class="hljs-title class_">View</span> {
    <span class="hljs-keyword">var</span> body: <span class="hljs-keyword">some</span> <span class="hljs-type">View</span> {
        <span class="hljs-type">VStack</span> {
            <span class="hljs-type">Text</span>(<span class="hljs-string">"Hello World"</span>)
                .frame(maxHeight: .infinity)
            
            <span class="hljs-type">MAXBannerSwiftUIView</span>(adUnitID: <span class="hljs-type">AdConfig</span>.<span class="hljs-type">MAX</span>.bannerAdUnitID)
                .frame(height: <span class="hljs-number">50</span>)
        }
    }
}
</code></pre>
<hr/>
<h3 data-id="heading-52">åä¸€ã€å®Œæ•´çš„ Podfile æ±‡æ€»</h3>
<p>æ ¹æ®ä½ é€‰æ‹©çš„æ–¹æ¡ˆï¼Œä½¿ç”¨å¯¹åº”çš„ Podfileï¼š</p>
<h4 data-id="heading-53">æ–¹æ¡ˆä¸€ï¼šAdMob Mediationï¼ˆæ¨èå¿«é€Ÿä¸Šæ‰‹ï¼‰</h4>
<pre><code class="hljs language-ruby" lang="ruby">platform <span class="hljs-symbol">:ios</span>, <span class="hljs-string">'13.0'</span>

target <span class="hljs-string">'YourApp'</span> <span class="hljs-keyword">do</span>
  use_frameworks!

  <span class="hljs-comment"># AdMob SDKï¼ˆèšåˆä¸»ä½“ï¼‰</span>
  pod <span class="hljs-string">'Google-Mobile-Ads-SDK'</span>, <span class="hljs-string">'~&gt; 12.0'</span>

  <span class="hljs-comment"># Meta Audience Network Mediation é€‚é…å™¨</span>
  pod <span class="hljs-string">'GoogleMobileAdsMediationFacebook'</span>

  <span class="hljs-comment"># GDPR åˆè§„</span>
  pod <span class="hljs-string">'GoogleUserMessagingPlatform'</span>

  <span class="hljs-comment"># ï¼ˆå¯é€‰ï¼‰æ›´å¤šç½‘ç»œ</span>
  <span class="hljs-comment"># pod 'GoogleMobileAdsMediationAppLovin'</span>
  <span class="hljs-comment"># pod 'GoogleMobileAdsMediationUnity'</span>
<span class="hljs-keyword">end</span>
</code></pre>
<h4 data-id="heading-54">æ–¹æ¡ˆäºŒï¼šAppLovin MAXï¼ˆæ¨èè¿½æ±‚é«˜æ”¶ç›Šï¼‰</h4>
<pre><code class="hljs language-ruby" lang="ruby">platform <span class="hljs-symbol">:ios</span>, <span class="hljs-string">'13.0'</span>

target <span class="hljs-string">'YourApp'</span> <span class="hljs-keyword">do</span>
  use_frameworks!
  inhibit_all_warnings!

  <span class="hljs-comment"># AppLovin MAX SDKï¼ˆèšåˆä¸»ä½“ï¼‰</span>
  pod <span class="hljs-string">'AppLovinSDK'</span>

  <span class="hljs-comment"># AdMob é€‚é…å™¨</span>
  pod <span class="hljs-string">'AppLovinMediationGoogleAdapter'</span>

  <span class="hljs-comment"># Meta AN é€‚é…å™¨</span>
  pod <span class="hljs-string">'AppLovinMediationFacebookAdapter'</span>

  <span class="hljs-comment"># ï¼ˆå¯é€‰ï¼‰æ›´å¤šç½‘ç»œ - æ¥å…¥è¶Šå¤šç«äº‰è¶Šæ¿€çƒˆæ”¶ç›Šè¶Šé«˜</span>
  <span class="hljs-comment"># pod 'AppLovinMediationUnityAdsAdapter'</span>
  <span class="hljs-comment"># pod 'AppLovinMediationMintegralAdapter'</span>
  <span class="hljs-comment"># pod 'AppLovinMediationVungleAdapter'</span>
  <span class="hljs-comment"># pod 'AppLovinMediationIronSourceAdapter'</span>
  <span class="hljs-comment"># pod 'AppLovinMediationByteDanceAdapter'     # Pangle / TikTok</span>
  <span class="hljs-comment"># pod 'AppLovinMediationChartboostAdapter'</span>
<span class="hljs-keyword">end</span>
</code></pre>
<h4 data-id="heading-55">æ–¹æ¡ˆä¸‰ï¼šæ‰‹åŠ¨ç®¡ç†ï¼ˆä¸æ¨èï¼‰</h4>
<pre><code class="hljs language-ruby" lang="ruby">platform <span class="hljs-symbol">:ios</span>, <span class="hljs-string">'13.0'</span>

target <span class="hljs-string">'YourApp'</span> <span class="hljs-keyword">do</span>
  use_frameworks!

  pod <span class="hljs-string">'Google-Mobile-Ads-SDK'</span>, <span class="hljs-string">'~&gt; 12.0'</span>
  pod <span class="hljs-string">'FBAudienceNetwork'</span>
  pod <span class="hljs-string">'GoogleUserMessagingPlatform'</span>
<span class="hljs-keyword">end</span>
</code></pre>
<hr/>
<h3 data-id="heading-56">åäºŒã€æ€»ç»“ä¸æ¨è</h3>
<h4 data-id="heading-57">æœ€ç»ˆæ¨è</h4>

























<table><thead><tr><th>åœºæ™¯</th><th>æ¨èæ–¹æ¡ˆ</th><th>ç†ç”±</th></tr></thead><tbody><tr><td><strong>æ–°é¡¹ç›® / è¿½æ±‚æœ€é«˜æ”¶ç›Š</strong></td><td>â­ AppLovin MAX</td><td>å…¬å¹³ç«ä»·ã€æ›´å¤šç½‘ç»œã€è¯¦ç»†æŠ¥å‘Š</td></tr><tr><td><strong>å·²æœ‰ AdMob åŸºç¡€ / å¿«é€Ÿæ¥å…¥</strong></td><td>â­ AdMob Mediation</td><td>æ”¹åŠ¨æœ€å°ï¼Œç”Ÿæ€æˆç†Ÿ</td></tr><tr><td><strong>å­¦ä¹ äº†è§£åŸç†</strong></td><td>æ‰‹åŠ¨ç®¡ç†</td><td>ä»…ä½œå­¦ä¹ å‚è€ƒ</td></tr></tbody></table>
<h4 data-id="heading-58">å…³é”®è¦ç‚¹å›é¡¾</h4>
<ol>
<li><strong>ä¸€å®šè¦ä½¿ç”¨èšåˆå¹³å°</strong>ï¼Œä¸è¦æ‰‹åŠ¨ç®¡ç†å¤šä¸ª SDK</li>
<li><strong>ä¼˜å…ˆä½¿ç”¨ Biddingï¼ˆå®æ—¶ç«ä»·ï¼‰</strong> è€Œé Waterfallï¼ˆç€‘å¸ƒæµï¼‰</li>
<li><strong>æ¥å…¥ 3 ä¸ªä»¥ä¸Šç«ä»·ç½‘ç»œ</strong>ï¼Œç«äº‰è¶Šå¤šæ”¶ç›Šè¶Šé«˜</li>
<li><strong>éšç§åˆè§„ä¸‰æ­¥èµ°</strong>ï¼šGDPR åŒæ„ â†’ ATT æˆæƒ â†’ å„ SDK è®¾ç½®</li>
<li><strong>ä½¿ç”¨æµ‹è¯• ID å¼€å‘</strong>ï¼Œä¸Šçº¿å‰åˆ‡æ¢ä¸ºç”Ÿäº§ ID</li>
<li><strong>é¢„åŠ è½½ç­–ç•¥</strong>ï¼šå¹¿å‘Šå…³é—­åç«‹å³é¢„åŠ è½½ä¸‹ä¸€ä¸ª</li>
<li><strong>é¢‘æ¬¡æ§åˆ¶</strong>ï¼šé¿å…è¿‡åº¦å±•ç¤ºå¯¼è‡´ç”¨æˆ·æµå¤±æˆ–æ”¿ç­–è¿è§„</li>
<li><strong>å®šæœŸæ›´æ–° SDK</strong>ï¼šå„å¹¿å‘Šç½‘ç»œæŒç»­ä¼˜åŒ–ï¼Œæ–°ç‰ˆæœ¬é€šå¸¸å¸¦æ¥æ›´é«˜æ”¶ç›Š</li>
</ol>
<h4 data-id="heading-59">é¢„æœŸæ”¶ç›Šå‚è€ƒï¼ˆä»…ä¾›å‚è€ƒï¼Œå—åœ°åŒº/å“ç±»/ç”¨æˆ·è´¨é‡å½±å“æå¤§ï¼‰</h4>



































<table><thead><tr><th>å¹¿å‘Šæ ¼å¼</th><th>ç¾å›½å¸‚åœº eCPM å‚è€ƒ</th><th>ä¸­å›½/äºšæ´²å¸‚åœº eCPM å‚è€ƒ</th></tr></thead><tbody><tr><td>Banner</td><td><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0.5</mn><mtext>Â </mtext></mrow><annotation encoding="application/x-tex">0.5 ~ </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">0.5</span><span class="mspace nobreak">Â </span></span></span></span></span>3.0</td><td><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0.1</mn><mtext>Â </mtext></mrow><annotation encoding="application/x-tex">0.1 ~ </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">0.1</span><span class="mspace nobreak">Â </span></span></span></span></span>1.0</td></tr><tr><td>Interstitial</td><td><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>5.0</mn><mtext>Â </mtext></mrow><annotation encoding="application/x-tex">5.0 ~ </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">5.0</span><span class="mspace nobreak">Â </span></span></span></span></span>20.0</td><td><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1.0</mn><mtext>Â </mtext></mrow><annotation encoding="application/x-tex">1.0 ~ </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">1.0</span><span class="mspace nobreak">Â </span></span></span></span></span>8.0</td></tr><tr><td>Rewarded Video</td><td><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>10.0</mn><mtext>Â </mtext></mrow><annotation encoding="application/x-tex">10.0 ~ </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">10.0</span><span class="mspace nobreak">Â </span></span></span></span></span>40.0</td><td><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>3.0</mn><mtext>Â </mtext></mrow><annotation encoding="application/x-tex">3.0 ~ </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">3.0</span><span class="mspace nobreak">Â </span></span></span></span></span>15.0</td></tr><tr><td>MREC</td><td><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1.0</mn><mtext>Â </mtext></mrow><annotation encoding="application/x-tex">1.0 ~ </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">1.0</span><span class="mspace nobreak">Â </span></span></span></span></span>5.0</td><td><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0.3</mn><mtext>Â </mtext></mrow><annotation encoding="application/x-tex">0.3 ~ </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">0.3</span><span class="mspace nobreak">Â </span></span></span></span></span>2.0</td></tr><tr><td>App Open</td><td><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>5.0</mn><mtext>Â </mtext></mrow><annotation encoding="application/x-tex">5.0 ~ </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">5.0</span><span class="mspace nobreak">Â </span></span></span></span></span>15.0</td><td><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1.0</mn><mtext>Â </mtext></mrow><annotation encoding="application/x-tex">1.0 ~ </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">1.0</span><span class="mspace nobreak">Â </span></span></span></span></span>6.0</td></tr></tbody></table>
<blockquote>
<p>âš ï¸ ä»¥ä¸Šæ•°æ®ä»…ä¸ºè¡Œä¸šå¤§è‡´å‚è€ƒèŒƒå›´ã€‚å®é™… eCPM å—ä»¥ä¸‹å› ç´ å½±å“æå¤§ï¼š</p>
<ul>
<li><strong>ç”¨æˆ·åœ°åŒº</strong>ï¼ˆT1 å›½å®¶å¦‚ç¾/è‹±/æ¾³/åŠ è¿œé«˜äºå…¶ä»–åœ°åŒºï¼‰</li>
<li><strong>App å“ç±»</strong>ï¼ˆé‡‘èã€æ•™è‚²ç±» &gt; å·¥å…·ç±» &gt; æ¸¸æˆä¼‘é—²ç±»ï¼‰</li>
<li><strong>ç”¨æˆ·è´¨é‡</strong>ï¼ˆé«˜ç•™å­˜ç”¨æˆ· eCPM æ›´é«˜ï¼‰</li>
<li><strong>æ¥å…¥ç½‘ç»œæ•°é‡</strong>ï¼ˆ3+ ä¸ª Bidding ç½‘ç»œå¯æå‡ 20~50%ï¼‰</li>
<li><strong>ATT æˆæƒç‡</strong>ï¼ˆæˆæƒç”¨æˆ· eCPM å¯æ¯”æœªæˆæƒé«˜ 30~80%ï¼‰</li>
</ul>
</blockquote>
<h3 data-id="heading-60">åä¸‰ã€App Store å®¡æ ¸æ³¨æ„äº‹é¡¹</h3>
<h4 data-id="heading-61">13.1 App éšç§æ ‡ç­¾ï¼ˆPrivacy Nutrition Labelsï¼‰</h4>
<p>ä¸Šæ¶ App Store æ—¶ï¼Œéœ€è¦åœ¨ App Store Connect ä¸­å¦‚å®å¡«å†™éšç§æ ‡ç­¾ã€‚æ¥å…¥å¹¿å‘Š SDK åï¼Œé€šå¸¸éœ€è¦å£°æ˜ä»¥ä¸‹æ•°æ®æ”¶é›†ï¼š</p>









































<table><thead><tr><th>æ•°æ®ç±»å‹</th><th>æ˜¯å¦æ”¶é›†</th><th>ç”¨é€”</th><th>æ˜¯å¦å…³è”ç”¨æˆ·</th></tr></thead><tbody><tr><td>è®¾å¤‡æ ‡è¯†ç¬¦ (IDFA)</td><td>âœ…</td><td>ç¬¬ä¸‰æ–¹å¹¿å‘Šã€åˆ†æ</td><td>æ˜¯ï¼ˆå¦‚ç”¨æˆ·æˆæƒ ATTï¼‰</td></tr><tr><td>ç²—ç•¥ä½ç½®</td><td>âœ…</td><td>ç¬¬ä¸‰æ–¹å¹¿å‘Š</td><td>å¦</td></tr><tr><td>ä½¿ç”¨æ•°æ®ï¼ˆäº§å“äº¤äº’ï¼‰</td><td>âœ…</td><td>ç¬¬ä¸‰æ–¹å¹¿å‘Šã€åˆ†æ</td><td>å¦</td></tr><tr><td>è¯Šæ–­æ•°æ®</td><td>âœ…</td><td>åˆ†æ</td><td>å¦</td></tr><tr><td>å¹¿å‘Šæ•°æ®</td><td>âœ…</td><td>ç¬¬ä¸‰æ–¹å¹¿å‘Š</td><td>æ˜¯</td></tr></tbody></table>
<blockquote>
<p>ğŸ’¡ <strong>å„ SDK çš„éšç§å£°æ˜æ–‡æ¡£ï¼š</strong></p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdevelopers.google.com%2Fadmob%2Fios%2Fdata-disclosure" target="_blank" title="https://developers.google.com/admob/ios/data-disclosure" ref="nofollow noopener noreferrer">Google AdMob éšç§å£°æ˜</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdevelopers.facebook.com%2Fdocs%2Faudience-network%2Fguides%2Fapple-app-data-use" target="_blank" title="https://developers.facebook.com/docs/audience-network/guides/apple-app-data-use" ref="nofollow noopener noreferrer">Meta AN éšç§å£°æ˜</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fsupport.axon.ai%2Fen%2Fmax%2Fios%2Foverview%2Fprivacy%2F" target="_blank" title="https://support.axon.ai/en/max/ios/overview/privacy/" ref="nofollow noopener noreferrer">AppLovin éšç§å£°æ˜</a></li>
</ul>
</blockquote>
<h4 data-id="heading-62">13.2 å®¡æ ¸å¸¸è§è¢«æ‹’åŸå› åŠè§£å†³</h4>



































<table><thead><tr><th>è¢«æ‹’åŸå› </th><th>æè¿°</th><th>è§£å†³æ–¹æ¡ˆ</th></tr></thead><tbody><tr><td><strong>Guideline 5.1.1</strong></td><td>ATT å¼¹çª—æè¿°ä¸æ¸…æˆ–å­˜åœ¨è¯¯å¯¼</td><td>ä½¿ç”¨æ¸…æ™°ã€è¯šå®çš„ <code>NSUserTrackingUsageDescription</code> æ–‡æ¡ˆ</td></tr><tr><td><strong>Guideline 5.1.2</strong></td><td>éšç§æ ‡ç­¾ä¸å®é™…ä¸ç¬¦</td><td>æ ¹æ®æ‰€æœ‰æ¥å…¥ SDK å¦‚å®æ›´æ–°éšç§æ ‡ç­¾</td></tr><tr><td><strong>Guideline 2.3.2</strong></td><td>å¹¿å‘Šé®æŒ¡ UI æˆ–å½±å“åŠŸèƒ½</td><td>ç¡®ä¿ Banner ä¸é®æŒ¡æŒ‰é’®ï¼›æ’å±åœ¨åˆç†æ—¶æœºå±•ç¤º</td></tr><tr><td><strong>Guideline 3.1.1</strong></td><td>æ¿€åŠ±è§†é¢‘ç»•è¿‡å†…è´­</td><td>æ¿€åŠ±è§†é¢‘åªèƒ½å¥–åŠ±æ¶ˆè€—å‹é“å…·ï¼Œä¸èƒ½æ›¿ä»£è®¢é˜…/æ°¸ä¹…è§£é”</td></tr><tr><td><strong>Guideline 4.0</strong></td><td>å¹¿å‘Šå†…å®¹ä¸å½“</td><td>å¯ç”¨ AdMob æˆ– MAX çš„å¹¿å‘Šè´¨é‡å®¡æ ¸åŠŸèƒ½</td></tr></tbody></table>
<h4 data-id="heading-63">13.3 ATT å¼¹çª—æœ€ä½³å®è·µ</h4>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-comment">// âŒ ä¸å¥½çš„æè¿°</span>
<span class="hljs-string">"We need your permission to track you."</span>

<span class="hljs-comment">// âœ… å¥½çš„æè¿°ï¼ˆæ¸…æ™°è¯´æ˜å¯¹ç”¨æˆ·çš„å¥½å¤„ï¼‰</span>
<span class="hljs-string">"æ­¤æ ‡è¯†ç¬¦å°†ç”¨äºä¸ºæ‚¨æä¾›æ›´ç›¸å…³çš„å¹¿å‘Šä½“éªŒã€‚æ‚¨çš„æ•°æ®ä¸ä¼šç”¨äºå…¶ä»–ç›®çš„ã€‚"</span>

<span class="hljs-comment">// âœ… è‹±æ–‡ç‰ˆ</span>
<span class="hljs-string">"This identifier will be used to deliver personalized ads to you. Your data will not be used for any other purpose."</span>
</code></pre>
<p><strong>æé«˜ ATT æˆæƒç‡çš„æŠ€å·§ï¼š</strong></p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-comment">/// åœ¨å¼¹å‡ºç³»ç»Ÿ ATT å¼¹çª—ä¹‹å‰ï¼Œå…ˆå±•ç¤ºä¸€ä¸ªè‡ªå®šä¹‰çš„é¢„å¼¹çª—è¯´æ˜</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ATTPrePromptView</span>: <span class="hljs-title class_">UIViewController</span> {
    
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">showPrePrompt</span>(<span class="hljs-params">from</span> <span class="hljs-params">viewController</span>: <span class="hljs-type">UIViewController</span>, <span class="hljs-params">completion</span>: <span class="hljs-keyword">@escaping</span> () -&gt; <span class="hljs-type">Void</span>) {
        <span class="hljs-keyword">let</span> alert <span class="hljs-operator">=</span> <span class="hljs-type">UIAlertController</span>(
            title: <span class="hljs-string">"æ”¯æŒæˆ‘ä»¬ç»§ç»­å…è´¹æä¾›æœåŠ¡ ğŸ™"</span>,
            message: <span class="hljs-string">"""
            æˆ‘ä»¬é€šè¿‡å±•ç¤ºå¹¿å‘Šæ¥ç»´æŒåº”ç”¨å…è´¹ã€‚
            
            æ¥ä¸‹æ¥ç³»ç»Ÿä¼šè¯¢é—®æ‚¨æ˜¯å¦å…è®¸è¿½è¸ªã€‚
            å¦‚æœæ‚¨åŒæ„ï¼Œæˆ‘ä»¬èƒ½ä¸ºæ‚¨å±•ç¤ºæ›´ç›¸å…³çš„å¹¿å‘Šï¼Œ
            åŒæ—¶å¸®åŠ©æˆ‘ä»¬è·å¾—æ›´å¥½çš„æ”¶å…¥æ¥æ”¹è¿›åº”ç”¨ã€‚
            
            æ‚¨çš„é€‰æ‹©ä¸ä¼šå½±å“å¹¿å‘Šæ•°é‡ã€‚
            """</span>,
            preferredStyle: .alert
        )
        
        alert.addAction(<span class="hljs-type">UIAlertAction</span>(title: <span class="hljs-string">"å¥½çš„ï¼Œç»§ç»­"</span>, style: .default) { <span class="hljs-keyword">_</span> <span class="hljs-keyword">in</span>
            completion()
        })
        
        alert.addAction(<span class="hljs-type">UIAlertAction</span>(title: <span class="hljs-string">"æš‚æ—¶è·³è¿‡"</span>, style: .cancel) { <span class="hljs-keyword">_</span> <span class="hljs-keyword">in</span>
            completion()
        })
        
        viewController.present(alert, animated: <span class="hljs-literal">true</span>)
    }
}
</code></pre>
<blockquote>
<p>ğŸ’¡ <strong>è‡ªå®šä¹‰é¢„å¼¹çª—å¯å°† ATT æˆæƒç‡ä» ~20% æå‡åˆ° ~40%+</strong>ï¼Œç›´æ¥å½±å“å¹¿å‘Šæ”¶ç›Šã€‚</p>
</blockquote>
<hr/>
<h3 data-id="heading-64">åå››ã€ä¸Šçº¿å‰çš„æ£€æŸ¥æ¸…å• âœ…</h3>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section">### ğŸ“‹ ä¸Šçº¿å‰å¹¿å‘Šé›†æˆæ£€æŸ¥æ¸…å•</span>

<span class="hljs-section">#### åŸºç¡€é…ç½®</span>
<span class="hljs-bullet">-</span> [ ] Info.plist ä¸­é…ç½®äº† GADApplicationIdentifierï¼ˆAdMob App IDï¼‰
<span class="hljs-bullet">-</span> [ ] Info.plist ä¸­é…ç½®äº† NSUserTrackingUsageDescription
<span class="hljs-bullet">-</span> [ ] Info.plist ä¸­æ·»åŠ äº†æ‰€æœ‰å¿…éœ€çš„ SKAdNetworkItems
<span class="hljs-bullet">-</span> [ ] AppLovinSdkKey å·²é…ç½®ï¼ˆå¦‚ä½¿ç”¨ MAXï¼‰

<span class="hljs-section">#### SDK åˆå§‹åŒ–</span>
<span class="hljs-bullet">-</span> [ ] GDPR åŒæ„æµç¨‹åœ¨ SDK åˆå§‹åŒ–ä¹‹å‰æ‰§è¡Œ
<span class="hljs-bullet">-</span> [ ] ATT æƒé™è¯·æ±‚åœ¨ SDK åˆå§‹åŒ–ä¹‹å‰æ‰§è¡Œ
<span class="hljs-bullet">-</span> [ ] Meta ATE æ ‡å¿—æ ¹æ® ATT ç»“æœæ­£ç¡®è®¾ç½®
<span class="hljs-bullet">-</span> [ ] å¹¿å‘Š SDK åˆå§‹åŒ–åœ¨ completionHandler ä¸­ç¡®è®¤æˆåŠŸ

<span class="hljs-section">#### å¹¿å‘Šå®ç°</span>
<span class="hljs-bullet">-</span> [ ] æ‰€æœ‰æµ‹è¯• ID å·²æ›¿æ¢ä¸ºç”Ÿäº§ ID
<span class="hljs-bullet">-</span> [ ] æµ‹è¯•è®¾å¤‡ä»£ç å·²ç§»é™¤æˆ–è¢« #if DEBUG åŒ…è£¹
<span class="hljs-bullet">-</span> [ ] æ’å±å¹¿å‘Šæœ‰é¢‘æ¬¡æ§åˆ¶
<span class="hljs-bullet">-</span> [ ] å¹¿å‘Šå…³é—­åæœ‰é¢„åŠ è½½é€»è¾‘
<span class="hljs-bullet">-</span> [ ] åŠ è½½å¤±è´¥æœ‰æŒ‡æ•°é€€é¿é‡è¯•
<span class="hljs-bullet">-</span> [ ] æ¿€åŠ±è§†é¢‘å¥–åŠ±é€»è¾‘åœ¨ didRewardUser å›è°ƒä¸­å¤„ç†

<span class="hljs-section">#### éšç§åˆè§„</span>
<span class="hljs-bullet">-</span> [ ] App Store Connect éšç§æ ‡ç­¾å·²æ›´æ–°
<span class="hljs-bullet">-</span> [ ] GDPR åŒæ„å¼¹çª—åœ¨æ¬§æ´²åœ°åŒºæ­£ç¡®æ˜¾ç¤º
<span class="hljs-bullet">-</span> [ ] CCPA åˆè§„å¤„ç†ï¼ˆå¦‚é¢å‘ç¾å›½ç”¨æˆ·ï¼‰
<span class="hljs-bullet">-</span> [ ] Meta æ•°æ®å¤„ç†é€‰é¡¹æ ¹æ®ç”¨æˆ·åŒæ„çŠ¶æ€è®¾ç½®

<span class="hljs-section">#### åå°é…ç½®</span>
<span class="hljs-bullet">-</span> [ ] AdMob åå°å·²åˆ›å»ºæ‰€æœ‰ Ad Unit
<span class="hljs-bullet">-</span> [ ] Meta AN åå°å·²åˆ›å»ºæ‰€æœ‰ Placement
<span class="hljs-bullet">-</span> [ ] AppLovin Dashboard å·²é…ç½®æ‰€æœ‰ Ad Unitï¼ˆå¦‚ä½¿ç”¨ MAXï¼‰
<span class="hljs-bullet">-</span> [ ] Mediation ç»„é…ç½®æ­£ç¡®ï¼ŒBidding å·²å¯ç”¨

<span class="hljs-section">#### æµ‹è¯•éªŒè¯</span>
<span class="hljs-bullet">-</span> [ ] ä¸‰ç§å¹¿å‘Šæ ¼å¼ï¼ˆBanner/Interstitial/Rewardedï¼‰å‡èƒ½æ­£å¸¸å±•ç¤º
<span class="hljs-bullet">-</span> [ ] åœ¨æ¨¡æ‹Ÿå™¨å’ŒçœŸæœºä¸Šå‡æµ‹è¯•é€šè¿‡
<span class="hljs-bullet">-</span> [ ] å¤šæ¬¡æ‰“å¼€/å…³é—­å¹¿å‘Šæ— å´©æºƒ
<span class="hljs-bullet">-</span> [ ] ç½‘ç»œæ–­å¼€æ—¶ä¸å´©æºƒï¼Œæ¢å¤åèƒ½é‡æ–°åŠ è½½
<span class="hljs-bullet">-</span> [ ] å†…å­˜æ³„æ¼æ£€æŸ¥é€šè¿‡ï¼ˆInstruments - Leaksï¼‰

<span class="hljs-section">#### æ”¶ç›Šè¿½è¸ª</span>
<span class="hljs-bullet">-</span> [ ] å¹¿å‘Šå±•ç¤ºäº‹ä»¶æ­£ç¡®ä¸ŠæŠ¥åˆ°åˆ†æå¹³å°
<span class="hljs-bullet">-</span> [ ] æ”¶ç›Šæ•°æ®å¯åœ¨ AdMob / AppLovin åå°æŸ¥çœ‹
<span class="hljs-bullet">-</span> [ ] ä¸åŒç½‘ç»œçš„å¡«å……ç‡å’Œ eCPM å¯åˆ†åˆ«è¿½è¸ª
</code></pre>
<hr/>
<h3 data-id="heading-65">åäº”ã€å‚è€ƒé“¾æ¥æ±‡æ€»</h3>





















































<table><thead><tr><th>èµ„æº</th><th>é“¾æ¥</th></tr></thead><tbody><tr><td><strong>AdMob iOS å®˜æ–¹æ–‡æ¡£</strong></td><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fdevelopers.google.com%2Fadmob%2Fios%2Fquick-start" target="_blank" title="https://developers.google.com/admob/ios/quick-start" ref="nofollow noopener noreferrer">developers.google.com/admob/ios/qâ€¦</a></td></tr><tr><td><strong>AdMob Mediation æ–‡æ¡£</strong></td><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fdevelopers.google.com%2Fadmob%2Fios%2Fmediation" target="_blank" title="https://developers.google.com/admob/ios/mediation" ref="nofollow noopener noreferrer">developers.google.com/admob/ios/mâ€¦</a></td></tr><tr><td><strong>Meta AN iOS æ–‡æ¡£</strong></td><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fdevelopers.facebook.com%2Fdocs%2Faudience-network%2Fget-started%2Fios" target="_blank" title="https://developers.facebook.com/docs/audience-network/get-started/ios" ref="nofollow noopener noreferrer">developers.facebook.com/docs/audienâ€¦</a></td></tr><tr><td><strong>AppLovin MAX iOS æ–‡æ¡£</strong></td><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fsupport.axon.ai%2Fen%2Fmax%2Fios%2Foverview%2Fintegration%2F" target="_blank" title="https://support.axon.ai/en/max/ios/overview/integration/" ref="nofollow noopener noreferrer">support.axon.ai/en/max/ios/â€¦</a></td></tr><tr><td><strong>MAX Mediated Networks</strong></td><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fsupport.axon.ai%2Fen%2Fmax%2Fios%2Fpreparing-mediated-networks%2F" target="_blank" title="https://support.axon.ai/en/max/ios/preparing-mediated-networks/" ref="nofollow noopener noreferrer">support.axon.ai/en/max/ios/â€¦</a></td></tr><tr><td><strong>MAX Banner æ–‡æ¡£</strong></td><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fsupport.axon.ai%2Fen%2Fmax%2Fios%2Fad-formats%2Fbanner-and-mrec-ads%2F" target="_blank" title="https://support.axon.ai/en/max/ios/ad-formats/banner-and-mrec-ads/" ref="nofollow noopener noreferrer">support.axon.ai/en/max/ios/â€¦</a></td></tr><tr><td><strong>MAX Interstitial æ–‡æ¡£</strong></td><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fsupport.axon.ai%2Fen%2Fmax%2Fios%2Fad-formats%2Finterstitial-ads%2F" target="_blank" title="https://support.axon.ai/en/max/ios/ad-formats/interstitial-ads/" ref="nofollow noopener noreferrer">support.axon.ai/en/max/ios/â€¦</a></td></tr><tr><td><strong>MAX Rewarded æ–‡æ¡£</strong></td><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fsupport.axon.ai%2Fen%2Fmax%2Fios%2Fad-formats%2Frewarded-ads%2F" target="_blank" title="https://support.axon.ai/en/max/ios/ad-formats/rewarded-ads/" ref="nofollow noopener noreferrer">support.axon.ai/en/max/ios/â€¦</a></td></tr><tr><td><strong>SKAdNetwork é…ç½®</strong></td><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fsupport.axon.ai%2Fen%2Fmax%2Fios%2Foverview%2Fskadnetwork%2F" target="_blank" title="https://support.axon.ai/en/max/ios/overview/skadnetwork/" ref="nofollow noopener noreferrer">support.axon.ai/en/max/ios/â€¦</a></td></tr><tr><td><strong>AppLovin MAX SDK GitHub</strong></td><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FAppLovin%2FAppLovin-MAX-SDK-iOS" target="_blank" title="https://github.com/AppLovin/AppLovin-MAX-SDK-iOS" ref="nofollow noopener noreferrer">github.com/AppLovin/Apâ€¦</a></td></tr><tr><td><strong>Google UMP SDK</strong></td><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fdevelopers.google.com%2Fadmob%2Fump%2Fios%2Fquick-start" target="_blank" title="https://developers.google.com/admob/ump/ios/quick-start" ref="nofollow noopener noreferrer">developers.google.com/admob/ump/iâ€¦</a></td></tr></tbody></table>
<hr/>
<p>ä»¥ä¸Šå°±æ˜¯åœ¨ iOS åº”ç”¨ä¸­åŒæ—¶é›†æˆ <strong>Google AdMob</strong> å’Œ <strong>Meta Audience Network</strong> çš„å®Œæ•´æŒ‡å—ã€‚æ€»ç»“æ ¸å¿ƒå»ºè®®ï¼š</p>
<ol>
<li><strong>ä¼˜å…ˆé€‰æ‹©èšåˆæ–¹æ¡ˆ</strong>ï¼ˆAdMob Mediation æˆ– AppLovin MAXï¼‰ï¼Œé¿å…æ‰‹åŠ¨ç®¡ç†</li>
<li><strong>éšç§åˆè§„</strong>å¿…é¡»æ”¾åœ¨æœ€ä¼˜å…ˆçº§â€”â€”GDPR â†’ ATT â†’ SDK åˆå§‹åŒ–</li>
<li><strong>æ¥å…¥ 3+ ä¸ª Bidding ç½‘ç»œ</strong>æ˜¯æå‡æ”¶ç›Šçš„æœ€æœ‰æ•ˆæ‰‹æ®µ</li>
<li><strong>ä½¿ç”¨æµ‹è¯• ID å¼€å‘</strong>ï¼Œä¸Šçº¿å‰ä¸¥æ ¼æŒ‰ç…§æ£€æŸ¥æ¸…å•é€é¡¹ç¡®è®¤</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ç”¨ CSS è§£å†³â€œçœŸÂ·shrinkwrapâ€ï¼šæŠŠè‡ªåŠ¨æ¢è¡Œçš„å†…å®¹ï¼Œç´§è´´åŒ…èµ·æ¥]]></title>    <link>https://juejin.cn/post/7604786493638426651</link>    <guid>https://juejin.cn/post/7604786493638426651</guid>    <pubDate>2026-02-10T02:36:13.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604786493638426651" data-draft-id="7604709514131898414" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ç”¨ CSS è§£å†³â€œçœŸÂ·shrinkwrapâ€ï¼šæŠŠè‡ªåŠ¨æ¢è¡Œçš„å†…å®¹ï¼Œç´§è´´åŒ…èµ·æ¥"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2026-02-10T02:36:13.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ˜é‡‘å®‰ä¸œå°¼"/> <meta itemprop="url" content="https://juejin.cn/user/1521379823340792"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ç”¨ CSS è§£å†³â€œçœŸÂ·shrinkwrapâ€ï¼šæŠŠè‡ªåŠ¨æ¢è¡Œçš„å†…å®¹ï¼Œç´§è´´åŒ…èµ·æ¥
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1521379823340792/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ˜é‡‘å®‰ä¸œå°¼
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T02:36:13.000Z" title="Tue Feb 10 2026 02:36:13 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»13åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>åŸæ–‡ï¼šSolving Shrinkwrap: New Experimental Technique (<a href="https://link.juejin.cn?target=https%3A%2F%2Fkizu.dev%2Fshrinkwrap-solution%2F" title="https://kizu.dev/shrinkwrap-solution/" target="_blank" ref="nofollow noopener noreferrer">Kizu</a>)</p>
<p>æ¬¢è¿å…³æ³¨ <a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2FTUARAN%2Ffrontend-weekly-digest-cn" title="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2FTUARAN%2Ffrontend-weekly-digest-cn" target="_blank">å‰ç«¯å‘¨åˆŠ</a>ï¼Œæ¯å‘¨æ›´æ–°å›½å¤–è®ºå›çš„å‰ç«¯çƒ­é—¨æ–‡ç« ï¼Œç´§è·Ÿæ—¶äº‹ï¼ŒæŒæ¡å‰ç«¯æŠ€æœ¯åŠ¨æ€ã€‚</p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e987357c15e6449fb1afe4e5376a635d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR5a6J5Lic5bC8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771295772&amp;x-signature=%2FQVHp5kxqjel3W5U1d7t99C%2B8KI%3D" alt="" loading="lazy"/></p>
<p>å‰ç«¯å†™ UI å†™ä¹…äº†ï¼Œä½ æ€»ä¼šé‡åˆ°ä¸€ç§ç‰¹åˆ«åˆ«æ‰­çš„è§†è§‰ï¼šå†…å®¹æ˜æ˜åªæœ‰ä¸¤ä¸‰è¡Œå­—ï¼Œå®¹å™¨å´åƒè¢«â€œæ’‘åˆ°ä¸€æ•´è¡Œâ€é‚£æ ·å®½ï¼Œç•™ä¸‹ä¸€å¤§å—æ— æ„ä¹‰çš„ç©ºç™½ã€‚æ ‡é¢˜ã€æ ‡ç­¾ã€æ°”æ³¡ã€tooltipã€legendã€å›¾ç‰‡ captionâ€¦â€¦åªè¦æ–‡æœ¬ä¼šè‡ªåŠ¨æ¢è¡Œï¼Œè¿™ä¸ªé—®é¢˜å°±ä¼šåå¤å‡ºç°ã€‚</p>
<p>å¤§å®¶ç®¡å®ƒå« shrinkwrapï¼šå®¹å™¨åº”è¯¥åƒâ€œç´§è´´åŒ…è£¹â€ä¸€æ ·è´´ç€å†…å®¹ç”Ÿé•¿ã€‚CSS åœ¨å¾ˆå¤šåœºæ™¯é‡Œæœ‰ <code>inline-block</code>ã€<code>max-content</code>ã€<code>fit-content()</code>ï¼Œçœ‹èµ·æ¥éƒ½åƒç­”æ¡ˆï¼›ä½†åªè¦å†…å®¹æ¢è¡Œã€å‚ä¸å¸ƒå±€åˆ†é…ï¼ˆå°¤å…¶æ˜¯ flex / grid çš„å‰©ä½™ç©ºé—´åˆ†é…ï¼‰ï¼Œä½ å°±ä¼šå‘ç°â€œè´´åˆâ€å¾ˆå®¹æ˜“å˜æˆâ€œå æ»¡â€ã€‚è¿™ä¹Ÿæ˜¯ Roman Komarov è¿™ç¯‡æ–‡ç« è¦è§£å†³çš„æ ¸å¿ƒï¼šè®©ä¼šè‡ªåŠ¨æ¢è¡Œçš„å†…å®¹ï¼Œä¾æ—§èƒ½å¾—åˆ°çœŸæ­£å½±å“å¸ƒå±€çš„ shrinkwrapï¼Œè€Œä¸ä»…ä»…æ˜¯ç”»å‡ºæ¥åƒã€‚(<a href="https://link.juejin.cn?target=https%3A%2F%2Fkizu.dev%2Fshrinkwrap-solution%2F" title="https://kizu.dev/shrinkwrap-solution/" target="_blank" ref="nofollow noopener noreferrer">Kizu</a>)</p>
<p>æ–‡ç« ç»™å‡ºçš„ç»“è®ºå¾ˆç›´æ¥ï¼šæŠŠä¸¤ä¸ªè¿‘ä¸¤å¹´é€æ¸æˆç†Ÿçš„ CSS èƒ½åŠ›æ‹¼èµ·æ¥â€”â€”<strong>Anchor Positioningï¼ˆé”šç‚¹å®šä½ï¼‰</strong> + <strong>Scroll-driven Animationsï¼ˆæ»šåŠ¨é©±åŠ¨åŠ¨ç”»ï¼‰</strong> â€”â€”å°±èƒ½åœ¨çº¯ CSS é‡Œå®Œæˆä¸€ä»¶è¿‡å»é«˜åº¦ä¾èµ– JS çš„äº‹æƒ…ï¼š<strong>æµ‹é‡å†…éƒ¨å†…å®¹çš„å‡ ä½•å°ºå¯¸ï¼Œç„¶åæŠŠæµ‹å¾—çš„ç»“æœå›å†™ç»™å¤–å±‚å®¹å™¨ä½œä¸ºå°ºå¯¸çº¦æŸ</strong>ã€‚(<a href="https://link.juejin.cn?target=https%3A%2F%2Fkizu.dev%2Fshrinkwrap-solution%2F" title="https://kizu.dev/shrinkwrap-solution/" target="_blank" ref="nofollow noopener noreferrer">Kizu</a>)</p>
<p>è¿™å¬èµ·æ¥åƒâ€œé»‘é­”æ³•â€ï¼Œä½†å®ƒçš„å·¥ç¨‹ä»·å€¼å¾ˆæ˜ç¡®ï¼šåªè¦æµè§ˆå™¨æ”¯æŒç›¸å…³ç‰¹æ€§ï¼Œå¸ƒå±€å°±èƒ½è¿›å…¥ä¸€ä¸ªæ›´â€œå†…å®¹é©±åŠ¨â€çš„çŠ¶æ€ï¼›ä¸æ”¯æŒæ—¶è¿˜èƒ½ä¼˜é›…é™çº§ä¸ºæ™®é€šå¸ƒå±€ï¼ˆåªæ˜¯æ²¡é‚£ä¹ˆå¥½çœ‹ï¼‰ã€‚ä½œè€…ä¹Ÿå¼ºè°ƒäº†å®éªŒæ€§ä¸é£é™©ï¼Œå°¤å…¶æåˆ° Safari çš„å´©æºƒ bugï¼Œä»¥åŠç”Ÿäº§ä½¿ç”¨è¦è°¨æ…è¯„ä¼°ã€‚(<a href="https://link.juejin.cn?target=https%3A%2F%2Fkizu.dev%2Fshrinkwrap-solution%2F" title="https://kizu.dev/shrinkwrap-solution/" target="_blank" ref="nofollow noopener noreferrer">Kizu</a>)</p>
<hr/>
<h2 data-id="heading-0">è¿™ä¸ªé—®é¢˜ä¸ºä»€ä¹ˆéš¾ï¼šæ¢è¡Œä¼šå¼•å‘â€œå®½åº¦äº‰å¤ºæˆ˜â€</h2>
<p>ç†è§£ shrinkwrap çš„éš¾ç‚¹ï¼Œå…³é”®åœ¨â€œè‡ªåŠ¨æ¢è¡Œâ€è¿™å››ä¸ªå­—ã€‚</p>
<p>å½“æ–‡æœ¬èƒ½æ¢è¡Œæ—¶ï¼Œå¸ƒå±€ç³»ç»Ÿå€¾å‘äºå…ˆæ‹¿åˆ°ä¸€ä¸ªâ€œå¯ç”¨ç©ºé—´â€ï¼Œå†åœ¨è¿™ä¸ªç©ºé—´é‡Œæ’ç‰ˆã€æ¢è¡Œã€å¯¹é½ã€‚å¾ˆå¤šç»„ä»¶åœ¨ flex / grid é‡Œçœ‹èµ·æ¥â€œçªç„¶å˜å®½â€ï¼Œæ ¹æºå°±åœ¨è¿™é‡Œï¼šå…ƒç´ å®½åº¦å¼€å§‹å“åº”å¤–éƒ¨å¯ç”¨ç©ºé—´ï¼Œå†…å®¹çš„æ¢è¡Œç»“æœåˆåè¿‡æ¥å½±å“å…ƒç´ çœ‹èµ·æ¥â€œåº”è¯¥å¤šå®½â€ã€‚ä½ æƒ³è®©å®¹å™¨è´´ç€å†…å®¹ï¼Œå¸ƒå±€å¼•æ“å´æ›´æ„¿æ„è®©å†…å®¹é€‚é…å®¹å™¨ã€‚</p>
<p>è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆè¿‡å»å¸¸è§çš„è§£å†³æ–¹æ¡ˆè¦ä¹ˆæ˜¯ JS æµ‹é‡ï¼ˆ<code>getBoundingClientRect()</code> / <code>offsetWidth</code>ï¼‰ï¼Œè¦ä¹ˆæ˜¯ç¡¬ç¼–ç æ¢è¡Œï¼ˆæ‰‹åŠ¨ <code>&lt;br&gt;</code>ï¼‰ï¼Œè¦ä¹ˆæ˜¯æ¥å—ä¸å®Œç¾ï¼ˆé èƒŒæ™¯ä¼ªå…ƒç´ è£…é¥°å‡ºâ€œçœ‹èµ·æ¥è´´åˆâ€ï¼‰ã€‚ä½œè€…åœ¨ 2023 å¹´çš„æ—§æ–‡é‡Œå°±åšè¿‡ä¸€ç§åè£…é¥°æ€§çš„ workaroundï¼šé”šç‚¹èƒ½æŠŠè£…é¥°ç‰©è´´åˆ°æ¢è¡Œæ–‡æœ¬è¾¹ä¸Šï¼Œä½†å®ƒä¸æ”¹å˜çœŸæ­£çš„å¸ƒå±€å°ºå¯¸ï¼Œæ‰€ä»¥ä»ç„¶â€œçœ‹èµ·æ¥å¯¹ã€å¸ƒå±€æ²¡å˜â€ã€‚(<a href="https://link.juejin.cn?target=https%3A%2F%2Fkizu.dev%2Fshrinkwrap-solution%2F" title="https://kizu.dev/shrinkwrap-solution/" target="_blank" ref="nofollow noopener noreferrer">Kizu</a>)</p>
<p>è¿™æ¬¡çš„æ–°æŠ€å·§ï¼Œç›®æ ‡æ›´æ¿€è¿›ï¼š<strong>ç›´æ¥æ”¹å¸ƒå±€</strong>ã€‚</p>
<hr/>
<h2 data-id="heading-1">æ ¸å¿ƒæ€è·¯ï¼šæ”¾ä¸€ä¸ªâ€œæ¢é’ˆâ€ï¼Œç”¨æ»šåŠ¨åŠ¨ç”»æŠŠå°ºå¯¸â€œå·â€å‡ºæ¥</h2>
<p>æ•´å¥—æ–¹æ¡ˆå¯ä»¥æ‹†æˆä¸€å¥è¯ï¼š</p>
<blockquote>
<p>è®©å†…éƒ¨å†…å®¹åœ¨ä¸€ä¸ªå¯æ§çš„â€œå†…ç›’å­â€é‡Œè‡ªç„¶æ¢è¡Œï¼›å†æ”¾ä¸€ä¸ªç»å¯¹å®šä½çš„ probeï¼ˆæ¢é’ˆï¼‰é”šå®šåˆ°å†…å®¹çš„è¾¹ç•Œï¼›ç”¨ view-timeline æŠŠ probe çš„ä½ç½®æ˜ å°„æˆ 0~1 çš„åŠ¨ç”»è¿›åº¦ï¼›æŠŠè¿™ä¸ªè¿›åº¦è¿˜åŸæˆå®é™…åƒç´ å€¼ï¼›æœ€ç»ˆæŠŠåƒç´ å€¼å†™å›å¤–å±‚å®¹å™¨çš„ <code>inline-size</code> / <code>min-inline-size</code>ã€‚</p>
</blockquote>
<p>è¿™é‡Œæœ€å…³é”®çš„ç‚¹ï¼Œæ˜¯ä½œè€…æŠŠâ€œæ»šåŠ¨é©±åŠ¨åŠ¨ç”»â€å½“æˆäº†ä¸€ä¸ª<strong>è¿œç¨‹çŠ¶æ€ä¼ é€’ / è¿œç¨‹æµ‹é‡</strong>æœºåˆ¶ï¼šåŠ¨ç”»æœ¬æ¥æ˜¯æ‹¿æ¥åšåŠ¨æ•ˆçš„ï¼Œä½†å®ƒå¤©ç„¶å…·å¤‡â€œæŠŠä¸€ä¸ªå…ƒç´ åœ¨æŸä¸ªåæ ‡ç³»é‡Œçš„ä½ç½®ï¼Œè½¬æˆä¸€ä¸ªå¯è¢« CSS å˜é‡è¡¨è¾¾çš„æ•°â€çš„èƒ½åŠ›ã€‚(<a href="https://link.juejin.cn?target=https%3A%2F%2Fkizu.dev%2Fshrinkwrap-solution%2F" title="https://kizu.dev/shrinkwrap-solution/" target="_blank" ref="nofollow noopener noreferrer">Kizu</a>)</p>
<p>è¿™æ¡æ€è·¯åœ¨ç¤¾åŒºé‡Œä¹Ÿæœ‰å‘¼åº”ã€‚ä½œè€…å¼•ç”¨äº† Temani Afif 2024 å¹´çš„æ–‡ç« ï¼šåŒæ ·åˆ©ç”¨ scroll-driven animationsï¼Œåœ¨çº¯ CSS é‡Œè®¡ç®—å…ƒç´ å®½é«˜ã€‚ä¸¤è€…å·®å¼‚åœ¨äºæµ‹é‡ç‚¹çš„é€‰æ‹©ï¼šTemani çš„æ–¹æ³•æ›´åƒç”¨ä¸€ä¸ª <code>1px</code> å…ƒç´ é…åˆæ¯”ä¾‹åæ¨ scrollportï¼›Roman è¿™ç¯‡æ›´ä¾èµ– anchor positioningï¼ŒæŠŠæ¢é’ˆç›´æ¥é’‰åˆ°æƒ³æµ‹çš„â€œé‚£ä¸ªè¾¹ç•Œç‚¹â€ï¼Œå†é…ä¸€ä¸ªå¾ˆå¤§çš„ timeline-range å½“åˆ†è¾¨ç‡å»è¿˜åŸæ•°å€¼ã€‚(<a href="https://link.juejin.cn?target=https%3A%2F%2Fkizu.dev%2Fshrinkwrap-solution%2F" title="https://kizu.dev/shrinkwrap-solution/" target="_blank" ref="nofollow noopener noreferrer">Kizu</a>)</p>
<hr/>
<h2 data-id="heading-2">åŸºç¡€ç»“æ„ï¼šä¸ºä»€ä¹ˆè¦å¤šåŒ…ä¸‰å±‚</h2>
<p>æ–‡ç« ç»™å‡ºçš„åŸºç¡€ HTML ç»“æ„å¾ˆâ€œåˆ»æ„â€ï¼Œå› ä¸ºå®ƒæœ¬èº«å°±æ˜¯ APIï¼š</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"shrinkwrap"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"shrinkwrap-content"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"shrinkwrap-source"</span>&gt;</span>
      <span class="hljs-comment">&lt;!-- Text --&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"shrinkwrap-probe"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p>æ¯ä¸€å±‚éƒ½æœ‰æ˜ç¡®èŒè´£ï¼š(<a href="https://link.juejin.cn?target=https%3A%2F%2Fkizu.dev%2Fshrinkwrap-solution%2F" title="https://kizu.dev/shrinkwrap-solution/" target="_blank" ref="nofollow noopener noreferrer">Kizu</a>)</p>
<ul>
<li><code>shrinkwrap</code>ï¼šå¤–å±‚çœŸæ­£è¦å‚ä¸å¸ƒå±€ã€æœ€ç»ˆè¦è¢«â€œç¼©åˆ°è´´åˆå†…å®¹â€çš„å…ƒç´ ã€‚</li>
<li><code>shrinkwrap-content</code>ï¼šä¸€ä¸ªå…è®¸â€œæ¯”å¤–å±‚æ›´å®½â€çš„å†…ç›’å­ï¼Œå®ƒå†³å®šæ–‡æœ¬å¦‚ä½•æ¢è¡Œï¼›åŒæ—¶å®ƒæ‰¿æ‹…æº¢å‡ºè£å‰ªï¼ˆ<code>overflow: hidden</code>ï¼‰ï¼Œä¸º view timeline æä¾›å¿…è¦æ¡ä»¶ã€‚(<a href="https://link.juejin.cn?target=https%3A%2F%2Fkizu.dev%2Fshrinkwrap-solution%2F" title="https://kizu.dev/shrinkwrap-solution/" target="_blank" ref="nofollow noopener noreferrer">Kizu</a>)</li>
<li><code>shrinkwrap-source</code>ï¼šè¢«æµ‹é‡çš„ç›®æ ‡ï¼Œé»˜è®¤æ˜¯è¡Œå†…å†…å®¹ï¼ˆ<code>display: inline</code>ï¼‰ï¼Œå¹¶æä¾› <code>anchor-name</code> ä½œä¸ºé”šç‚¹æ ‡è¯†ã€‚(<a href="https://link.juejin.cn?target=https%3A%2F%2Fkizu.dev%2Fshrinkwrap-solution%2F" title="https://kizu.dev/shrinkwrap-solution/" target="_blank" ref="nofollow noopener noreferrer">Kizu</a>)</li>
<li><code>shrinkwrap-probe</code>ï¼šæ¢é’ˆå…ƒç´ ï¼Œç»å¯¹å®šä½ã€ç¦ç”¨ pointer eventsï¼Œé€šè¿‡ <code>position-anchor</code> é”šå®šåˆ° sourceï¼Œå¹¶å»ºç«‹ view timelineï¼Œè®©å¤–å±‚èƒ½â€œè¯»åˆ°â€å®ƒã€‚(<a href="https://link.juejin.cn?target=https%3A%2F%2Fkizu.dev%2Fshrinkwrap-solution%2F" title="https://kizu.dev/shrinkwrap-solution/" target="_blank" ref="nofollow noopener noreferrer">Kizu</a>)</li>
</ul>
<p>è¿™é‡Œæœ‰ä¸ªéå¸¸å·¥ç¨‹åŒ–çš„åˆ¤æ–­ï¼šä½œè€…å»ºè®® probe ä¼˜å…ˆç”¨çœŸå® DOM å…ƒç´ ï¼Œé¿å… Safari åœ¨æŸäº›æ¡ä»¶ä¸‹å› ä¸ºä¼ªå…ƒç´  probe è§¦å‘æ ‡ç­¾é¡µå´©æºƒï¼›ä»–è¿˜ç»™å‡ºäº† WebKit çš„ bug é“¾æ¥ï¼Œå¹¶è§£é‡Šäº†è‡ªå·±å¦‚ä½•åšæœ€å°å¤ç°æ¥å®šä½é—®é¢˜ã€‚(<a href="https://link.juejin.cn?target=https%3A%2F%2Fkizu.dev%2Fshrinkwrap-solution%2F" title="https://kizu.dev/shrinkwrap-solution/" target="_blank" ref="nofollow noopener noreferrer">Kizu</a>)</p>
<hr/>
<h2 data-id="heading-3">å¤–å±‚ shrinkwrap çš„ CSSï¼šæµ‹é‡ + å›å†™ + é™çº§</h2>
<p>å¤–å±‚ <code>shrinkwrap</code> çš„ CSS ç‰‡æ®µé‡Œï¼Œèƒ½çœ‹åˆ°ä¸‰ä¸ªå±‚æ¬¡çš„åŠ¨ä½œï¼š(<a href="https://link.juejin.cn?target=https%3A%2F%2Fkizu.dev%2Fshrinkwrap-solution%2F" title="https://kizu.dev/shrinkwrap-solution/" target="_blank" ref="nofollow noopener noreferrer">Kizu</a>)</p>
<p>1ï¼‰ç”¨ layers + è‡ªå®šä¹‰å±æ€§å®šä¹‰ä¸€å¥—å¯è¦†å†™çš„ CSS APIï¼ˆè®©è¿™å¥—æŠ€å·§åƒâ€œç»„ä»¶â€ä¸€æ ·å¯é…ç½®ï¼‰ã€‚<br/>
2ï¼‰é€šè¿‡ <code>timeline-scope</code> + <code>animation</code> æŠŠå†…éƒ¨ probe çš„ view timelineâ€œæå‡â€åˆ°å¤–å±‚å¯è®¿é—®çš„ä½œç”¨åŸŸï¼Œç„¶åæŠŠå…³é”®åæ ‡å†™è¿›è‡ªå®šä¹‰å±æ€§ã€‚(<a href="https://link.juejin.cn?target=https%3A%2F%2Fkizu.dev%2Fshrinkwrap-solution%2F" title="https://kizu.dev/shrinkwrap-solution/" target="_blank" ref="nofollow noopener noreferrer">Kizu</a>)<br/>
3ï¼‰æŠŠå†™å…¥çš„å˜é‡ç”¨äº <code>inline-size</code> / <code>min-inline-size</code> çš„è®¡ç®—ï¼Œæœ€ç»ˆè®©å¤–å±‚çœŸçš„å˜çª„ã€‚(<a href="https://link.juejin.cn?target=https%3A%2F%2Fkizu.dev%2Fshrinkwrap-solution%2F" title="https://kizu.dev/shrinkwrap-solution/" target="_blank" ref="nofollow noopener noreferrer">Kizu</a>)</p>
<p>ä½œè€…è¿˜ç”¨äº†ä»–è‡ªå·±é•¿æœŸç ”ç©¶çš„ä¸€ç±»æŠ€å·§ï¼š<strong>Cyclic Dependency Space Toggles</strong>ï¼Œç”¨æ¥åšâ€œæ¡ä»¶å¼å¯ç”¨â€å’Œæ›´é¡ºæ»‘çš„é™çº§ã€‚å®ƒçš„æ„ä¹‰å¾ˆç°å®ï¼šå½“æµè§ˆå™¨ä¸æ”¯æŒ <code>timeline-scope</code> æˆ–é”šç‚¹å®šä½æ—¶ï¼Œå¸ƒå±€å›åˆ°æ™®é€šçŠ¶æ€ï¼Œé¡µé¢ç…§æ ·èƒ½ç”¨ï¼Œåªæ˜¯è§†è§‰è´´åˆåº¦ä¸‹é™ã€‚(<a href="https://link.juejin.cn?target=https%3A%2F%2Fkizu.dev%2Fshrinkwrap-solution%2F" title="https://kizu.dev/shrinkwrap-solution/" target="_blank" ref="nofollow noopener noreferrer">Kizu</a>)</p>
<p>æ–‡ç« é‡Œä¹Ÿä¸“é—¨åˆ—äº†é™åˆ¶æ¡ä»¶ï¼Œæ¯”å¦‚å¤–å±‚å¯ä»¥å¤„åœ¨æ™®é€šæµã€block/inline-blockã€flex/grid item éƒ½è¡Œï¼Œä½†å®ƒè‡ªå·±ä¸é€‚åˆå†æˆä¸º flex/grid å®¹å™¨ï¼›å¹¶ä¸”å®ƒçš„ <code>max-inline-size</code> ä¸èƒ½ä¾èµ–å…„å¼Ÿå…ƒç´ ï¼Œå¦åˆ™å°±ä¼šè¿›å…¥æ›´éš¾å¤„ç†çš„å¾ªç¯ä¾èµ–ã€‚(<a href="https://link.juejin.cn?target=https%3A%2F%2Fkizu.dev%2Fshrinkwrap-solution%2F" title="https://kizu.dev/shrinkwrap-solution/" target="_blank" ref="nofollow noopener noreferrer">Kizu</a>)</p>
<hr/>
<h2 data-id="heading-4">æ–‡æœ¬å¯¹é½æ˜¯éšè—å¤§å‘ï¼šå·¦å¯¹é½ä¹‹å¤–éƒ½è¦è¡¥ä¸€åˆ€</h2>
<p>å¦‚æœæ–‡æœ¬æ°¸è¿œå·¦å¯¹é½ï¼ŒåŸºç¡€æŠ€å·§å·²ç»å¤Ÿç”¨ï¼šå› ä¸ºå·¦è¾¹ç•Œå›ºå®šï¼Œå¤–å±‚ç¼©åˆ°åˆé€‚å®½åº¦å°±èƒ½â€œè´´ä½â€ã€‚(<a href="https://link.juejin.cn?target=https%3A%2F%2Fkizu.dev%2Fshrinkwrap-solution%2F" title="https://kizu.dev/shrinkwrap-solution/" target="_blank" ref="nofollow noopener noreferrer">Kizu</a>)</p>
<p>ä¸€æ—¦å‡ºç° <code>text-align: center/right</code>ï¼Œé—®é¢˜å°±å˜å¾—å¾®å¦™ï¼šæ–‡æœ¬çš„å¯¹é½å‘ç”Ÿåœ¨æ›´å¤§çš„å†…ç›’å­é‡Œï¼ˆ<code>shrinkwrap-content</code>ï¼‰ï¼Œå¤–å±‚è™½ç„¶ç¼©å°äº†ï¼Œæ–‡æœ¬ä¾æ—§åœ¨å†…ç›’å­é‡Œâ€œæŒ‰å¤§å®½åº¦å¯¹é½â€ï¼Œè§†è§‰ä¸Šå°±ä¼šæ¼‚ã€‚ä½œè€…ç»™çš„è§£å†³æ–¹å¼å¾ˆèªæ˜ï¼šç»§ç»­å¤ç”¨æµ‹é‡é˜¶æ®µå¾—åˆ°çš„å˜é‡ï¼Œç»™ <code>shrinkwrap-content</code> åŠ ä¸€ä¸ªç›¸å¯¹å®šä½åç§»ï¼Œç”¨ <code>inset-inline-start</code> æŠŠå®ƒæŒªå›å»ã€‚(<a href="https://link.juejin.cn?target=https%3A%2F%2Fkizu.dev%2Fshrinkwrap-solution%2F" title="https://kizu.dev/shrinkwrap-solution/" target="_blank" ref="nofollow noopener noreferrer">Kizu</a>)</p>
<p>è¿™é‡Œè¿˜æåˆ° Safari çš„ä¸€ä¸ªæ¸²æŸ“å·®å¼‚ï¼šåŒæ ·çš„å¯¹é½åˆ‡æ¢ï¼Œåœ¨ Safari ä¸Šç¬¬ä¸€è¡Œçš„æ’ç‰ˆå˜åŒ–å¯èƒ½æ¯” Chrome æ˜æ˜¾å¾—å¤šï¼Œè¿™æ„å‘³ç€è¾¹ç¼˜ case ä»ç„¶å­˜åœ¨ã€‚(<a href="https://link.juejin.cn?target=https%3A%2F%2Fkizu.dev%2Fshrinkwrap-solution%2F" title="https://kizu.dev/shrinkwrap-solution/" target="_blank" ref="nofollow noopener noreferrer">Kizu</a>)</p>
<hr/>
<h2 data-id="heading-5">æŠŠåŸºç¡€æŠ€å·§å½“ç§¯æœ¨ï¼šåˆ—è¡¨ã€å¡ç‰‡ã€æ®µè½éƒ½èƒ½æ‹¼</h2>
<p>æ–‡ç« ä¸­æ®µæœ€æœ‰å¯å‘çš„ä¸€ç‚¹ï¼Œæ˜¯ä½œè€…æŠŠè¿™å¥— shrinkwrap å½“æˆâ€œå¸ƒå±€ç§¯æœ¨â€æ¥ä½¿ç”¨ï¼š</p>
<p>å¦‚æœä¸€ä¸ªå¤æ‚å†…å®¹èƒ½æ‹†æˆå¤šä¸ªâ€œç‹¬ç«‹çš„è¡Œå†…å†…å®¹ä¸Šä¸‹æ–‡â€ï¼Œå°±å¯¹æ¯ä¸€æ®µè¡Œå†…å†…å®¹é‡å¤ä½¿ç”¨ shrinkwrapï¼Œç„¶ååœ¨æ›´å¤–å±‚ç”¨ <code>max-content</code> æˆ–å…¶ä»–æ–¹å¼æŠŠæ•´ä½“ä¹Ÿè´´åˆèµ·æ¥ã€‚ä½œè€…ç”¨å¤šé¡¹åˆ—è¡¨æ”¾è¿›å¡ç‰‡ã€æ¯é¡¹å¯èƒ½å¤šæ®µè½çš„ä¾‹å­è¯´æ˜ï¼šåªè¦æ‹†åˆ†å¾—å½“ï¼Œè¿™å¥—æŠ€å·§å°±èƒ½è¦†ç›–æ¯”â€œæ ‡é¢˜è´´åˆâ€æ›´å¤æ‚çš„ UIã€‚(<a href="https://link.juejin.cn?target=https%3A%2F%2Fkizu.dev%2Fshrinkwrap-solution%2F" title="https://kizu.dev/shrinkwrap-solution/" target="_blank" ref="nofollow noopener noreferrer">Kizu</a>)</p>
<p>è¿™ä¹Ÿè§£é‡Šäº†ä¸ºä»€ä¹ˆ API é‡Œæœ€é‡è¦çš„è‡ªå®šä¹‰å±æ€§æ˜¯ <code>--sw-limit</code>ï¼šå®ƒç›¸å½“äºå‘Šè¯‰è¿™å¥—æŠ€å·§â€œå…è®¸æ–‡æœ¬æœ€å¤šå ç”¨å¤šå®½çš„ä¸Šé™â€ï¼Œå¸¸è§é»˜è®¤æ˜¯ <code>100cqi</code>ï¼ˆå®¹å™¨æŸ¥è¯¢çš„ inline size å•ä½ï¼‰ï¼Œå½“ä½ å¸Œæœ›æ—è¾¹è¿˜ç•™ç©ºé—´ç»™å…¶ä»–åˆ—æˆ–æ§ä»¶æ—¶ï¼Œå°±æŠŠå®ƒç®—æˆ 50% å‡ gap/padding çš„å½¢å¼ã€‚(<a href="https://link.juejin.cn?target=https%3A%2F%2Fkizu.dev%2Fshrinkwrap-solution%2F" title="https://kizu.dev/shrinkwrap-solution/" target="_blank" ref="nofollow noopener noreferrer">Kizu</a>)</p>
<p>æ­¤å¤–è¿˜æœ‰ <code>--sw-padding</code>ã€<code>--sw-inner-padding</code>ã€<code>--sw-inset</code>ã€<code>--sw-source</code> ç­‰ï¼Œç”¨äºæŠŠ padding çº³å…¥è®¡ç®—ã€æ”¹å†™ probe æµ‹é‡èŒƒå›´ã€ç”šè‡³è®©è¢«æµ‹é‡å…ƒç´ åœ¨ shrinkwrap å¤–éƒ¨æ—¶å»ºç«‹è¿æ¥ã€‚(<a href="https://link.juejin.cn?target=https%3A%2F%2Fkizu.dev%2Fshrinkwrap-solution%2F" title="https://kizu.dev/shrinkwrap-solution/" target="_blank" ref="nofollow noopener noreferrer">Kizu</a>)</p>
<hr/>
<h2 data-id="heading-6">å¤æ‚å†…å®¹ï¼šä»â€œæšä¸¾é”šç‚¹â€åˆ°â€œé“¾å¼é”šç‚¹æ€ªç‰©â€</h2>
<p>å½“å†…å®¹ä¸å†æ˜¯ç®€å•çš„è¡Œå†…æ–‡æœ¬ï¼Œè€Œæ˜¯å¯æ¢è¡Œçš„ flex/grid itemsï¼Œé—®é¢˜ä¼šå‡çº§ã€‚</p>
<p>æ–‡ç« ç»™äº†ä¸¤æ¡è·¯çº¿ï¼š</p>
<h3 data-id="heading-7">1ï¼‰å¤šä¸ªæ˜¾å¼é”šç‚¹ï¼šçŸ¥é“å…ƒç´ æ•°é‡ï¼Œå°±èƒ½ç®—å‡ºåŒ…å›´ç›’</h3>
<p>æ€è·¯å¾ˆç›´æ¥ï¼šç»™æ¯ä¸ª item åˆ†é…å”¯ä¸€ anchorï¼Œç„¶ååœ¨ä¸€ä¸ª <code>min()</code> é‡ŒæŠŠæ‰€æœ‰ anchors çš„ inset éƒ½åˆ—å‡ºæ¥ï¼Œè®¡ç®—å‡ºå†³å®š shrinkwrap å°ºå¯¸çš„â€œæœ€è¿œè¾¹ç•Œâ€ã€‚ä½œè€…è¿˜æåˆ°éœ€è¦ç”¨ <code>calc(infinity * 1px)</code> ä½œä¸ºå›é€€ï¼Œé¿å…æŸäº› item ä¸å­˜åœ¨æ—¶è®¡ç®—å‡ºé”™ï¼Œå¹¶è®©å®ƒåœ¨ <code>min()</code> ä¸­è¢«â€œä¼˜é›…å¿½ç•¥â€ã€‚(<a href="https://link.juejin.cn?target=https%3A%2F%2Fkizu.dev%2Fshrinkwrap-solution%2F" title="https://kizu.dev/shrinkwrap-solution/" target="_blank" ref="nofollow noopener noreferrer">Kizu</a>)</p>
<h3 data-id="heading-8">2ï¼‰é“¾å¼é”šç‚¹æ€ªç‰©ï¼šä¸æšä¸¾æ•°é‡ï¼Œç”¨å¸ƒå±€é¡ºåºåšâ€œæ±‚æœ€å€¼ç®—æ³•â€</h3>
<p>è¿™ä¸€æ®µè¯»èµ·æ¥åƒç§‘å¹»ï¼šæ¯ä¸ªåˆ—è¡¨é¡¹é‡Œæ”¾ä¸¤ä¸ª probeï¼ˆleft/rightï¼‰ï¼Œåˆ©ç”¨â€œå¤šä¸ª anchors å…±äº«åŒåæ—¶å¯ä»¥é“¾å¼æŒ‡å‘å‰ä¸€ä¸ªæœ‰æ•ˆç›®æ ‡â€çš„è¡Œä¸ºï¼Œé…åˆå®¹å™¨æŸ¥è¯¢ï¼Œå½“ probe å®½åº¦å˜æˆæ­£å€¼æ—¶åŠ¨æ€å†™å…¥ <code>anchor-name</code>ï¼Œè®©â€œæœ€å·¦/æœ€å³â€åƒæ¥åŠ›ä¸€æ ·ä¼ é€’ä¸‹å»ã€‚ä½œè€…æŠŠå®ƒå½¢å®¹æˆâ€œç”¨å¸ƒå±€è¡¨è¾¾çš„æ±‚æœ€å¤§å€¼ç®—æ³•â€ã€‚(<a href="https://link.juejin.cn?target=https%3A%2F%2Fkizu.dev%2Fshrinkwrap-solution%2F" title="https://kizu.dev/shrinkwrap-solution/" target="_blank" ref="nofollow noopener noreferrer">Kizu</a>)</p>
<p>ç°å®é™åˆ¶åŒæ ·æ˜ç¡®ï¼šè¿™ä¸ª chaining è¡Œä¸ºç›®å‰ä¸»è¦åœ¨ Chrome å¯ç”¨ï¼ŒSafari å’Œ Firefox å­˜åœ¨ä¸¥é‡ bugï¼Œä½œè€…è¿˜ç»™å‡ºäº†å¯¹åº”çš„ WebKit ä¸ Bugzilla é“¾æ¥ã€‚(<a href="https://link.juejin.cn?target=https%3A%2F%2Fkizu.dev%2Fshrinkwrap-solution%2F" title="https://kizu.dev/shrinkwrap-solution/" target="_blank" ref="nofollow noopener noreferrer">Kizu</a>)<br/>
æ€§èƒ½ä¹Ÿæœ‰è¾¹ç•Œï¼šå…ƒç´ è¶…è¿‡ 100 ä¸ªå¯èƒ½å‡ºç° long taskï¼Œ1000 ä¸ªå…ƒç´ èƒ½æµ‹åˆ°åå‡ ç§’çº§åˆ«ã€‚(<a href="https://link.juejin.cn?target=https%3A%2F%2Fkizu.dev%2Fshrinkwrap-solution%2F" title="https://kizu.dev/shrinkwrap-solution/" target="_blank" ref="nofollow noopener noreferrer">Kizu</a>)</p>
<p>è¿™ä¸¤æ®µå†…å®¹çš„ä»·å€¼ï¼Œæ›´å¤šåœ¨äºâ€œæŠŠ layout å½“è®¡ç®—æ¨¡å‹â€çš„æ€ç»´ï¼šCSS åœ¨é€æ­¥è·å¾—å¯ç»„åˆã€å¯æ¨å¯¼çš„èƒ½åŠ›ï¼Œå¼€å‘è€…å¼€å§‹èƒ½ç”¨å£°æ˜å¼è§„åˆ™å»é€¼è¿‘è¿‡å»å¿…é¡»å†™è„šæœ¬æ‰èƒ½åšçš„å¸ƒå±€å†³ç­–ã€‚</p>
<hr/>
<h2 data-id="heading-9">è·¨ä¾èµ–çš„ç»ˆæéš¾é¢˜ï¼šèœå•åœºæ™¯ä¾æ—§å¾ˆç¡¬</h2>
<p>æ–‡ç« æŠŠæœ€éš¾çš„ shrinkwrap ç”¨ä¾‹ç•™ç»™äº†â€œå¯¼èˆªèœå•â€ï¼šåŒä¸€è¡Œé‡Œå¤šä¸ª flex items ä¸€èµ·å‚ä¸ç©ºé—´åˆ†é…ï¼Œç©ºé—´ä¸è¶³æ—¶æ•´ä½“æ¢è¡Œã€é—´éš™å˜å¾—å¾ˆéš¾çœ‹ã€‚è¿™ä¸ªåœºæ™¯é‡Œï¼Œæ¯ä¸ª item çš„å¯ç”¨å®½åº¦å–å†³äºå…¶ä»– itemsï¼Œé™åˆ¶å€¼ä¼šåŠ¨æ€å˜åŒ–ï¼ŒåŸºç¡€æŠ€å·§éœ€è¦ä¸€ä¸ªç¨³å®šçš„ limit æ‰èƒ½æˆç«‹ï¼Œå› æ­¤å¾ˆéš¾ç›´æ¥å¥—ç”¨ã€‚(<a href="https://link.juejin.cn?target=https%3A%2F%2Fkizu.dev%2Fshrinkwrap-solution%2F" title="https://kizu.dev/shrinkwrap-solution/" target="_blank" ref="nofollow noopener noreferrer">Kizu</a>)</p>
<p>ä½œè€…ç›®å‰æ‰¾åˆ°çš„å¯è¡Œè·¯çº¿æ˜¯â€œå†…å®¹å¤åˆ¶â€ï¼šå…ˆæ¸²æŸ“ä¸€ä¸ªéšè—ç‰ˆæœ¬è¿›è¡Œæµ‹é‡ï¼ŒæŠŠæ¯ä¸ª item çš„å°ºå¯¸åŒæ­¥åˆ°å¯è§å‰¯æœ¬ï¼Œå†æŠŠæ•´ä¸ªèœå•ä½œä¸ºæ•´ä½“æ”¾è¿›å¦ä¸€å±‚ shrinkwrapï¼Œè®©å®ƒä¹Ÿèƒ½è´´åˆå¹¶æŠŠç©ºé—´è®©ç»™æœç´¢æ¡†ç­‰æ§ä»¶ã€‚(<a href="https://link.juejin.cn?target=https%3A%2F%2Fkizu.dev%2Fshrinkwrap-solution%2F" title="https://kizu.dev/shrinkwrap-solution/" target="_blank" ref="nofollow noopener noreferrer">Kizu</a>)<br/>
ä»–ä¹Ÿæ˜ç¡®è¯´è¿™å¥—å®ç°éå¸¸è„†å¼±ï¼Œæš‚æ—¶ä¸æä¾›å®Œæ•´ä»£ç ï¼Œæ›´å¤šåƒä¸€ä¸ªâ€œæ–¹å‘æŒ‡ç¤ºç‰Œâ€ã€‚</p>
<hr/>
<h2 data-id="heading-10">ä¸€ç»„å¾ˆè½åœ°çš„ç”¨ä¾‹ï¼šæ°”æ³¡ã€legendã€å›¾ç‰‡ captionã€tooltip</h2>
<p>æ–‡ç« ååŠæ®µå¾ˆåƒâ€œè®¾è®¡ç³»ç»Ÿç»„ä»¶ç›®å½•â€ï¼Œæ¯ä¸ªä¾‹å­éƒ½å‡»ä¸­çœŸå®éœ€æ±‚ï¼š(<a href="https://link.juejin.cn?target=https%3A%2F%2Fkizu.dev%2Fshrinkwrap-solution%2F" title="https://kizu.dev/shrinkwrap-solution/" target="_blank" ref="nofollow noopener noreferrer">Kizu</a>)</p>
<ul>
<li><strong>èŠå¤©æ°”æ³¡</strong>ï¼šWeb ä¸Šé•¿æœŸéš¾åšå¾—åƒåŸç”Ÿï¼Œå…³é”®å¡ç‚¹å°±æ˜¯æ¢è¡Œåçš„è´´åˆä¸å¯¹é½ï¼›æ–°æŠ€å·§è®© <code>text-wrap: balance</code> ç»ˆäºèƒ½æ›´ç¨³å®šåœ°å‘æŒ¥ä½œç”¨ã€‚(<a href="https://link.juejin.cn?target=https%3A%2F%2Fkizu.dev%2Fshrinkwrap-solution%2F" title="https://kizu.dev/shrinkwrap-solution/" target="_blank" ref="nofollow noopener noreferrer">Kizu</a>)</li>
<li><strong>fieldset/legend</strong>ï¼šè¿‡å»å¸¸é ä¼ªå…ƒç´ è¡¥è¾¹æ¡†ï¼Œæ–°æŠ€å·§å¯ä»¥è®© legend åœ¨æ¢è¡Œåä¾æ—§è´´åˆï¼Œå¹¶ä¿ç•™åŸç”Ÿè¡Œä¸ºã€‚(<a href="https://link.juejin.cn?target=https%3A%2F%2Fkizu.dev%2Fshrinkwrap-solution%2F" title="https://kizu.dev/shrinkwrap-solution/" target="_blank" ref="nofollow noopener noreferrer">Kizu</a>)</li>
<li><strong>å›¾ç‰‡è¦†ç›– caption</strong>ï¼šåŠé€æ˜èƒŒæ™¯å°½é‡å°‘æŒ¡å›¾ï¼Œæ–‡å­—çŸ­æ²¡é—®é¢˜ï¼Œæ¢è¡Œå°±ä¼šæ¨ªå‘é“ºæ»¡ï¼›shrinkwrap èƒ½è®©èƒŒæ™¯è´´åˆæ–‡æœ¬å—ã€‚(<a href="https://link.juejin.cn?target=https%3A%2F%2Fkizu.dev%2Fshrinkwrap-solution%2F" title="https://kizu.dev/shrinkwrap-solution/" target="_blank" ref="nofollow noopener noreferrer">Kizu</a>)</li>
<li><strong>tooltip/popover</strong>ï¼šæ—¢è¦å‡è¡¡æ’ç‰ˆåˆè¦ä¸Šé™å®½åº¦ï¼Œç¼º shrinkwrap æ—¶å¾ˆå®¹æ˜“â€œå®½å¾—éš¾çœ‹â€ï¼Œæ–°æŠ€å·§èƒ½æŠŠå¼¹å±‚åšå¾—æ›´ç´§å‡‘ã€‚(<a href="https://link.juejin.cn?target=https%3A%2F%2Fkizu.dev%2Fshrinkwrap-solution%2F" title="https://kizu.dev/shrinkwrap-solution/" target="_blank" ref="nofollow noopener noreferrer">Kizu</a>)</li>
</ul>
<p>è¿™äº›ä¾‹å­å…±åŒè¯´æ˜äº†ä¸€ç‚¹ï¼šshrinkwrap ä¸æ˜¯â€œä¸ºäº†çœå‡ åƒç´ â€ï¼Œå®ƒç›´æ¥å½±å“ç»„ä»¶çš„å¯†åº¦ã€èŠ‚å¥ã€å¯¹é½æ„Ÿï¼Œæœ€ç»ˆå½±å“æ•´ä¸ªç•Œé¢çš„é«˜çº§æ„Ÿã€‚</p>
<hr/>
<h2 data-id="heading-11">æœªæ¥å±•æœ›ï¼šåŸç”Ÿ shrinkwrap å¯èƒ½å…ˆä»â€œç®€å•ç‰ˆâ€è½åœ°</h2>
<p>ä½œè€…æœ€åçš„åˆ¤æ–­å¾ˆåŠ¡å®ï¼šåŸç”Ÿå±‚é¢ä¼˜å…ˆè§£å†³â€œæœ€åŸºç¡€çš„ç”¨ä¾‹â€æ›´åˆ’ç®—ï¼Œä¹Ÿå°±æ˜¯<strong>å·²çŸ¥ä¸Šé™çš„ max-inline-size åœºæ™¯</strong>ã€‚è¿™ä¸ªèƒ½åŠ›å¯ä»¥é€šè¿‡æ–°å¢å±æ€§æˆ–æ–°å¢å‡½æ•°æä¾›ï¼Œå¯èƒ½éœ€è¦é…åˆ containment æ¥é¿å…ç™¾åˆ†æ¯”å°ºå¯¸å¼•å…¥å¾ªç¯ä¾èµ–ã€‚ç®€å•ç‰ˆä¸€æ—¦è½åœ°ï¼Œå°±èƒ½è¦†ç›–è¿‡å»åå¤šå¹´é‡Œå¤§é‡çœŸå®éœ€æ±‚ã€‚(<a href="https://link.juejin.cn?target=https%3A%2F%2Fkizu.dev%2Fshrinkwrap-solution%2F" title="https://kizu.dev/shrinkwrap-solution/" target="_blank" ref="nofollow noopener noreferrer">Kizu</a>)</p>
<p>èœå•è¿™ç§è·¨ä¾èµ– shrinkwrap å±äºæ›´å¤æ‚çš„å¸ƒå±€é—®é¢˜ï¼Œå…ˆä¸è¿½æ±‚ä¸€æ­¥åˆ°ä½ã€‚ä½œè€…è®¡åˆ’æŠŠæ–‡ç« é“¾æ¥ä¸ææ¡ˆå‘åˆ° CSSWG çš„ç›¸å…³ issueï¼Œé¼“åŠ±æœ‰æ˜ç¡®ç”¨ä¾‹çš„äººå»è¡¥å……éœ€æ±‚ï¼Œè®©è§„èŒƒè®¨è®ºæ›´è´´è¿‘ç°å®ã€‚(<a href="https://link.juejin.cn?target=https%3A%2F%2Fkizu.dev%2Fshrinkwrap-solution%2F" title="https://kizu.dev/shrinkwrap-solution/" target="_blank" ref="nofollow noopener noreferrer">Kizu</a>)</p>
<hr/>
<h2 data-id="heading-12">ç»™å·¥ç¨‹è½åœ°çš„åˆ¤æ–­ï¼šè¿™å¥—æŠ€å·§é€‚åˆç”¨åœ¨ä»€ä¹ˆåœ°æ–¹</h2>
<p>ç»“åˆä½œè€…çš„å…è´£å£°æ˜å’Œè¿™äº› demo çš„ç‰¹æ€§ï¼Œå¯ä»¥å¾—åˆ°ä¸€ä¸ªå¾ˆæ¸…æ™°çš„è½åœ°è¾¹ç•Œï¼š</p>
<p>è¿™å¥—æŠ€å·§å¾ˆé€‚åˆâ€œå¢å¼ºå‹ä½“éªŒâ€çš„ç»„ä»¶ï¼šå¯ç”¨åæ›´ç²¾è‡´ã€åœç”¨åå¯ç”¨æ€§ä¸å—å½±å“ï¼Œé£æ ¼ä¸ <code>text-wrap: balance</code> å¾ˆæ¥è¿‘ã€‚(<a href="https://link.juejin.cn?target=https%3A%2F%2Fkizu.dev%2Fshrinkwrap-solution%2F" title="https://kizu.dev/shrinkwrap-solution/" target="_blank" ref="nofollow noopener noreferrer">Kizu</a>) å…¸å‹åœºæ™¯å°±æ˜¯è®¾è®¡ç³»ç»Ÿé‡Œçš„è£…é¥°æ€§å®¹å™¨ï¼šæ°”æ³¡ã€å¾½æ ‡ã€æ ‡é¢˜æ ‡ç­¾ã€å›¾ç‰‡è§’æ ‡ã€tooltipã€‚</p>
<p>å¯¹äºå¼ºäº¤äº’ã€å¼ºä¸€è‡´æ€§è¦æ±‚çš„æ ¸å¿ƒä¸šåŠ¡å¸ƒå±€ï¼Œéœ€è¦æ›´ä¿å®ˆï¼šä¸€æ–¹é¢æµè§ˆå™¨æ”¯æŒä»åœ¨æ¼”è¿›ï¼Œå¦ä¸€æ–¹é¢ä½œè€…å·²ç»é‡åˆ°è¿‡ Safari å´©æºƒä¸ chaining å…¼å®¹é—®é¢˜ã€‚(<a href="https://link.juejin.cn?target=https%3A%2F%2Fkizu.dev%2Fshrinkwrap-solution%2F" title="https://kizu.dev/shrinkwrap-solution/" target="_blank" ref="nofollow noopener noreferrer">Kizu</a>) è¿™ç±»åœºæ™¯æ›´é€‚åˆæŠŠå®ƒå½“æˆâ€œå¯æ’æ‹”çš„å¢å¼ºå±‚â€ï¼Œç”¨ <code>@supports</code> æ§åˆ¶å¯ç”¨èŒƒå›´ï¼ŒæŠŠé£é™©éš”ç¦»åœ¨å¯å›é€€çš„å±‚é‡Œã€‚</p>
<hr/>
<h2 data-id="heading-13">ç»“è¯­ï¼šCSS æ­£åœ¨è·å¾—â€œæµ‹é‡ä¸åé¦ˆâ€çš„é—­ç¯</h2>
<p>è¿™ç¯‡æ–‡ç« çœŸæ­£è®©äººå…´å¥‹çš„ç‚¹ï¼Œæœªå¿…æ˜¯â€œç»ˆäºèƒ½åš shrinkwrap äº†â€ï¼Œè€Œæ˜¯ CSS çš„èƒ½åŠ›è¾¹ç•Œæ­£åœ¨å‘ç”Ÿå˜åŒ–ï¼š</p>
<p>Anchor positioning è®©å…ƒç´ ä¹‹é—´çš„å‡ ä½•å…³ç³»å˜å¾—å¯å¼•ç”¨ï¼›scroll-driven animations è®©â€œä½ç½®/å¯è§æ€§â€å˜æˆå¯è®¡ç®—çš„è¿ç»­å˜é‡ï¼›<code>@property</code> è®©å˜é‡å…·å¤‡ç±»å‹ä¸æ’å€¼è¯­ä¹‰ï¼›å®¹å™¨æŸ¥è¯¢è®©ç»„ä»¶èƒ½è¯»å–è‡ªèº«æ‰€å¤„ç¯å¢ƒã€‚(<a href="https://link.juejin.cn?target=https%3A%2F%2Fkizu.dev%2Fshrinkwrap-solution%2F" title="https://kizu.dev/shrinkwrap-solution/" target="_blank" ref="nofollow noopener noreferrer">Kizu</a>)</p>
<p>å½“è¿™äº›èƒ½åŠ›å¼€å§‹äº’ç›¸å’¬åˆï¼ŒCSS å°±å‡ºç°äº†ä¸€æ¡æ–°çš„è·¯å¾„ï¼š<strong>å¸ƒå±€ä¸ä»…èƒ½å£°æ˜ï¼Œè¿˜èƒ½æ¨å¯¼ï¼›æ ·å¼ä¸ä»…èƒ½æè¿°ï¼Œè¿˜èƒ½è®¡ç®—ï¼›ç»„ä»¶ä¸ä»…èƒ½æ¸²æŸ“ï¼Œè¿˜èƒ½è‡ªé€‚åº”åœ°å›å†™è‡ªèº«çº¦æŸ</strong>ã€‚</p>
<p>ä½ å¯ä»¥æŠŠè¿™ç¯‡æ–‡ç« å½“æˆä¸€æ¬¡â€œæœªæ¥ CSSâ€çš„é¢„æ¼”ã€‚å®ƒå·²ç»èƒ½åœ¨éƒ¨åˆ†ç¨³å®šç‰ˆæµè§ˆå™¨é‡Œå·¥ä½œï¼Œä¹Ÿå·²ç»èƒ½è§£å†³ä¸€æ‰¹éå¸¸çœŸå®çš„ UI ç—›ç‚¹ã€‚å‰©ä¸‹çš„ï¼Œå°±æ˜¯æŠŠè¿™äº›å®éªŒæ€§çš„ç»„åˆï¼Œé€æ­¥æ²‰æ·€æˆæ›´æœ´ç´ ã€æ›´å¯é çš„åŸç”Ÿèƒ½åŠ›ã€‚(<a href="https://link.juejin.cn?target=https%3A%2F%2Fkizu.dev%2Fshrinkwrap-solution%2F" title="https://kizu.dev/shrinkwrap-solution/" target="_blank" ref="nofollow noopener noreferrer">Kizu</a>)</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[è®¾è®¡æ¨¡å¼ï¼šå¸¦ä½ ç”¨çœŸå®ä¸šåŠ¡æ–¹æ³•+Springæºç å»ç†è§£æ¨¡æ¿ + å›è°ƒ]]></title>    <link>https://juejin.cn/post/7604761524976549897</link>    <guid>https://juejin.cn/post/7604761524976549897</guid>    <pubDate>2026-02-10T02:53:58.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604761524976549897" data-draft-id="7604701848150441984" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="è®¾è®¡æ¨¡å¼ï¼šå¸¦ä½ ç”¨çœŸå®ä¸šåŠ¡æ–¹æ³•+Springæºç å»ç†è§£æ¨¡æ¿ + å›è°ƒ"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2026-02-10T02:53:58.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ä»£ç ä¸°"/> <meta itemprop="url" content="https://juejin.cn/user/3732161238663437"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            è®¾è®¡æ¨¡å¼ï¼šå¸¦ä½ ç”¨çœŸå®ä¸šåŠ¡æ–¹æ³•+Springæºç å»ç†è§£æ¨¡æ¿ + å›è°ƒ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3732161238663437/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ä»£ç ä¸°
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T02:53:58.000Z" title="Tue Feb 10 2026 02:53:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä¸€ã€ä»€ä¹ˆæ˜¯æ¨¡ç‰ˆ+å›è°ƒ</h2>
<p>ä½ è‚¯å®šè§åˆ°è¿‡ç±»ä¼¼è¿™æ ·çš„ ä»£ç </p>
<pre><code class="hljs language-bash" lang="bash">              TransactionUtil.doInTransactionWithRequires(() -&gt; {
               // æ‰§è¡Œè¿™ä¸ªäº‹åŠ¡
                });
</code></pre>
<p>è€ŒdoInTransactionWithRequires è¿™ä¸ªæ–¹æ³•æ¥æ”¶ä¸€ä¸ªå‡½æ•°å¼æ–¹æ³•<br/>
supplier ç„¶åå†…éƒ¨å»è°ƒç”¨è¿™ä¸ªæ–¹æ³•</p>
<pre><code class="hljs language-bash" lang="bash">  doInTransactionWithRequiresï¼ˆSuppler&lt;T&gt; supplierï¼‰		{
	T result = supplier.get()
}
</code></pre>
<p><strong>è¿™ä¸ªå°±æ˜¯æ¨¡ç‰ˆ+å›è°ƒ</strong></p>
<blockquote>
<p>æ¨¡æ¿è´Ÿè´£â€œæµç¨‹éª¨æ¶â€ï¼Œ<br/>
å›è°ƒè´Ÿè´£â€œå˜åŒ–ç‚¹æ³¨å…¥â€ã€‚</p>
</blockquote>
<h2 data-id="heading-1">äºŒã€å…ˆçœ‹â€œçº¯æ¨¡æ¿æ–¹æ³•â€çš„é—®é¢˜</h2>
<p>ä¼ ç»Ÿçš„æ¨¡æ¿æ–¹æ³•æ¨¡å¼é•¿è¿™æ ·ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">public abstract class AbstractTask {

    public final void <span class="hljs-function"><span class="hljs-title">execute</span></span>() {
        before();
        doExecute();
        after();
    }

    protected void <span class="hljs-function"><span class="hljs-title">before</span></span>() {}
    protected abstract void doExecute();
    protected void <span class="hljs-function"><span class="hljs-title">after</span></span>() {}
}
</code></pre>
<p>å­ç±»ç»§æ‰¿ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">public class OrderTask extends AbstractTask {
    @Override
    protected void <span class="hljs-function"><span class="hljs-title">doExecute</span></span>() {      
    }
}
</code></pre>
<blockquote>
<p>è¿™ä¸ªæ–¹æ¡ˆçš„é—®é¢˜åœ¨å·¥ç¨‹é‡Œå¾ˆæ˜æ˜¾ï¼š</p>
<p>å¼ºä¾èµ–ç»§æ‰¿</p>
<p>å­ç±»è¶Šæ¥è¶Šå¤š</p>
<p>ä¸€ä¸ªç±»åªèƒ½ç»§æ‰¿ä¸€ä¸ªçˆ¶ç±»</p>
<p>è¡Œä¸ºç»„åˆéå¸¸å›°éš¾</p>
<p>æ‰€ä»¥åœ¨å¤§å‹æ¡†æ¶é‡Œï¼Œçº¯ç»§æ‰¿æ¨¡æ¿å‡ ä¹ä¸ç”¨äº†ã€‚</p>
</blockquote>
<h2 data-id="heading-2">ä¸‰ã€æ¨¡æ¿ + å›è°ƒï¼šæŠŠâ€œå˜åŒ–â€ä»ç»§æ‰¿å˜æˆå‚æ•°</h2>
<p>æ ¸å¿ƒæ€æƒ³</p>
<blockquote>
<p>ä¸å†é å­ç±»é‡å†™æ–¹æ³•ï¼Œ è€Œæ˜¯æŠŠâ€œå˜åŒ–çš„é€»è¾‘â€ä½œä¸ºå‚æ•°ä¼ è¿›å»</p>
<p>è¿™ä¸ªâ€œå‚æ•°â€ï¼Œå°±æ˜¯ å›è°ƒï¼ˆCallbackï¼‰ã€‚</p>
</blockquote>
<h2 data-id="heading-3">å››ã€æºç æ¡ˆä¾‹Spring çš„TransactionTemplateï¼š</h2>
<p>å†çœ‹ Spring æä¾›çš„ TransactionTemplateï¼š</p>
<pre><code class="hljs language-bash" lang="bash">transactionTemplate.execute(status -&gt; {
    userDao.update(user);
    orderDao.create(order);
    <span class="hljs-built_in">return</span> result;
});
</code></pre>
<p>å¯¹åº”æºç é‡Œçš„æ ¸å¿ƒé€»è¾‘:</p>
<pre><code class="hljs language-bash" lang="bash">TransactionStatus status = transactionManager.getTransaction(definition);
try {
    T result = action.doInTransaction(status); 
    transactionManager.commit(status);
    <span class="hljs-built_in">return</span> result;
} catch (Exception ex) {
    transactionManager.rollback(status);
    throw ex;
}
</code></pre>
<h2 data-id="heading-4">äº”ã€æºç æ¡ˆä¾‹ JdbcTemplate</h2>
<p>Spring JDBC é‡Œæœ€ç»å…¸çš„ JdbcTemplateï¼š</p>
<pre><code class="hljs language-bash" lang="bash">jdbcTemplate.query(
    <span class="hljs-string">"select * from user"</span>,
    (rs, rowNum) -&gt; new User(rs.getLong(<span class="hljs-string">"id"</span>), rs.getString(<span class="hljs-string">"name"</span>))
);
</code></pre>
<p>ä¼ è¿›å»çš„ RowMapperï¼Œå°±æ˜¯å›è°ƒã€‚</p>
<p>JdbcTemplate å†…éƒ¨åšçš„äº‹æ˜¯å›ºå®šçš„ï¼š</p>
<p>å˜åŒ–ç‚¹åªæœ‰ä¸€è¡Œï¼š</p>
<pre><code class="hljs language-bash" lang="bash">rowMapper.mapRow(rs, rowNum);
</code></pre>
<h2 data-id="heading-5">å…­ã€æ€»ç»“</h2>
<blockquote>
<p>æ¨¡æ¿ + å›è°ƒå¹¶ä¸ç­‰äºâ€œç»§æ‰¿ + æŠ½è±¡æ–¹æ³•â€ã€‚<br/>
åœ¨ç°ä»£ Java é¡¹ç›®é‡Œï¼Œå®ƒæ›´å¤šä»¥ å‡½æ•°å¼æ¥å£ + Lambda çš„å½¢å¼å‡ºç°ã€‚</p>
<p>ä¸ç®¡æ˜¯å…¬å¸äº‹åŠ¡å·¥å…·ç±»ã€Spring TransactionTemplateï¼Œè¿˜æ˜¯ JdbcTemplateï¼Œæœ¬è´¨éƒ½æ˜¯åŒä¸€å¥—æ€æƒ³ï¼š<br/>
æ¨¡æ¿è´Ÿè´£æµç¨‹ï¼Œå›è°ƒè´Ÿè´£å˜åŒ–ã€‚</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Express å¦‚ä½•ä½¿ç”¨ multer æ–‡ä»¶ä¸Šä¼ ï¼Ÿ]]></title>    <link>https://juejin.cn/post/7604697194795597834</link>    <guid>https://juejin.cn/post/7604697194795597834</guid>    <pubDate>2026-02-10T02:27:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604697194795597834" data-draft-id="7600414546189041674" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Express å¦‚ä½•ä½¿ç”¨ multer æ–‡ä»¶ä¸Šä¼ ï¼Ÿ"/> <meta itemprop="keywords" content="å‰ç«¯,NestJS,Node.js"/> <meta itemprop="datePublished" content="2026-02-10T02:27:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å‰ç«¯ä»˜è±ª"/> <meta itemprop="url" content="https://juejin.cn/user/1741228277763278"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Express å¦‚ä½•ä½¿ç”¨ multer æ–‡ä»¶ä¸Šä¼ ï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1741228277763278/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å‰ç«¯ä»˜è±ª
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T02:27:20.000Z" title="Tue Feb 10 2026 02:27:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Nest çš„æ–‡ä»¶ä¸Šä¼ æ˜¯åŸºäº Express çš„ä¸­é—´ä»¶ multer å®ç°çš„ï¼Œåœ¨å­¦ä¹  Nest æ–‡ä»¶ä¸Šä¼ ä¹‹å‰ï¼Œå…ˆå­¦ä¹ ä¸‹ multer åŒ…çš„ä½¿ç”¨</p>
<p>æ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dbb2818343724a1e8dd765d828d1a72f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771295240&amp;x-signature=V%2FZEiXtDQtOYpW4X%2BBHSTCIbaZM%3D" alt="image.png" loading="lazy"/></p>
<p>cors åŒ…æ˜¯å¤„ç†è·¨åŸŸ header</p>
<p>index.js</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>)
<span class="hljs-keyword">const</span> multer  = <span class="hljs-built_in">require</span>(<span class="hljs-string">'multer'</span>)
<span class="hljs-keyword">const</span> cors = <span class="hljs-built_in">require</span>(<span class="hljs-string">'cors'</span>);

<span class="hljs-keyword">const</span> app = <span class="hljs-title function_">express</span>()
app.<span class="hljs-title function_">use</span>(<span class="hljs-title function_">cors</span>());

<span class="hljs-keyword">const</span> upload = <span class="hljs-title function_">multer</span>({ <span class="hljs-attr">dest</span>: <span class="hljs-string">'uploads/'</span> })

app.<span class="hljs-title function_">post</span>(<span class="hljs-string">'/aaa'</span>, upload.<span class="hljs-title function_">single</span>(<span class="hljs-string">'aaa'</span>), <span class="hljs-keyword">function</span> (<span class="hljs-params">req, res, next</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'req.file'</span>, req.<span class="hljs-property">file</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'req.body'</span>, req.<span class="hljs-property">body</span>);
})

app.<span class="hljs-title function_">listen</span>(<span class="hljs-number">3000</span>);
</code></pre>
<p>æ–°å»º index.html</p>
<p>é€šè¿‡ FormData + axios ä¸Šä¼ æ–‡ä»¶ï¼ŒæŒ‡å®šå†…å®¹çš„ä¼ è¾“æ ¼å¼ content-type ä¸º multipart/form-dataã€‚</p>
<p>ï¼ˆaxios ä¼šè‡ªåŠ¨æ ¹æ®å†…å®¹æŒ‡å®š content-typeï¼Œä¸éœ€è¦æ‰‹åŠ¨æŒ‡å®šï¼‰</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!doctype <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">"X-UA-Compatible"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"IE=edge"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Document<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://unpkg.com/axios@0.24.0/dist/axios.min.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"fileInput"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"file"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
      <span class="hljs-keyword">const</span> fileInput = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">"#fileInput"</span>);

      <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">formData</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FormData</span>();
        data.<span class="hljs-title function_">set</span>(<span class="hljs-string">"name"</span>, <span class="hljs-string">"fuhao"</span>);
        data.<span class="hljs-title function_">set</span>(<span class="hljs-string">"age"</span>, <span class="hljs-number">18</span>);
        data.<span class="hljs-title function_">set</span>(<span class="hljs-string">"aaa"</span>, fileInput.<span class="hljs-property">files</span>[<span class="hljs-number">0</span>]);

        <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> axios.<span class="hljs-title function_">post</span>(<span class="hljs-string">"http://localhost:3000/aaa"</span>, data);
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(res);
      }

      fileInput.<span class="hljs-property">onchange</span> = formData;
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>

</code></pre>
<p>ç”¨ node æŠŠ server è·‘èµ·æ¥ï¼Œå¹¶ä¸”ç”¨ http-server æŠŠé™æ€æœåŠ¡è·‘èµ·æ¥</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/962100ebe26a4c65a0027264ef3f6d25~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771295240&amp;x-signature=xNt3FaBV4MOK1MpTVaQ8%2FvMwztU%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c940d361e4e649e8b645f42c82d25c48~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771295240&amp;x-signature=6a0fcMcQ3IVt%2FTXXX1dMViS4gaU%3D" alt="image.png" loading="lazy"/></p>
<p>ä¸Šä¼ æ–‡ä»¶</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7bf7dd11d32c4afbbec5ab26baa731d2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771295240&amp;x-signature=qyTvYfn3aOqm4%2FtAPw%2Bj8ZVlCYo%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1eef38859dcd4aa2bbdc6dad91e02ca1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771295240&amp;x-signature=QgOXgHsKK%2F7fQ6%2FCQrCuZumftaE%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/050f420dc372467d8c90ba6554ad3c87~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771295240&amp;x-signature=zf%2FLnfyo6I6IjEuVIi%2F%2BlY%2BQyFA%3D" alt="image.png" loading="lazy"/></p>
<p>è¿™å°±æ˜¯ form-data çš„ä¼ è¾“æ ¼å¼</p>
<p>æœåŠ¡ç«¯çœ‹ä¸‹</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a63f784d97eb4afaa981ac3ab7b2e35d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771295240&amp;x-signature=WUsTs6mHRiBkl6GkHMJUpLjNOHQ%3D" alt="image.png" loading="lazy"/></p>
<p>req.file æ‹¿åˆ°æ–‡ä»¶å­—æ®µï¼Œéæ–‡ä»¶å­—æ®µåœ¨ req.body</p>
<p>æœåŠ¡ç«¯å¤šäº† uploads ç›®å½•ï¼Œä¸‹é¢ä¿å­˜ç€ä¸Šä¼ æ–‡ä»¶</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4032e4c65f4e4593a33e712653a1b351~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771295240&amp;x-signature=LnmDNyCoL9yzlEoyK3dU4pqh3wY%3D" alt="image.png" loading="lazy"/></p>
<p>è¿™æ˜¯å•æ–‡ä»¶ ä¸Šä¼  é‚£å¤šæ–‡ä»¶ä¸Šä¼ å‘¢ï¼Ÿ</p>
<p>index.js æ·»åŠ  /bbb</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>)
<span class="hljs-keyword">const</span> multer  = <span class="hljs-built_in">require</span>(<span class="hljs-string">'multer'</span>)
<span class="hljs-keyword">const</span> cors = <span class="hljs-built_in">require</span>(<span class="hljs-string">'cors'</span>);

<span class="hljs-keyword">const</span> app = <span class="hljs-title function_">express</span>()
app.<span class="hljs-title function_">use</span>(<span class="hljs-title function_">cors</span>());

<span class="hljs-keyword">const</span> upload = <span class="hljs-title function_">multer</span>({ <span class="hljs-attr">dest</span>: <span class="hljs-string">'uploads/'</span> })

app.<span class="hljs-title function_">post</span>(<span class="hljs-string">'/aaa'</span>, upload.<span class="hljs-title function_">single</span>(<span class="hljs-string">'aaa'</span>), <span class="hljs-keyword">function</span> (<span class="hljs-params">req, res, next</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'req.file'</span>, req.<span class="hljs-property">file</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'req.body'</span>, req.<span class="hljs-property">body</span>);
})

app.<span class="hljs-title function_">post</span>(<span class="hljs-string">'/bbb'</span>, upload.<span class="hljs-title function_">array</span>(<span class="hljs-string">'bbb'</span>, <span class="hljs-number">2</span>), <span class="hljs-keyword">function</span> (<span class="hljs-params">req, res, next</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'req.files'</span>, req.<span class="hljs-property">files</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'req.body'</span>, req.<span class="hljs-property">body</span>);
})

app.<span class="hljs-title function_">listen</span>(<span class="hljs-number">3000</span>);
</code></pre>
<p>index.html æ”¯æŒå¤šæ–‡ä»¶</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!doctype <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">"X-UA-Compatible"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"IE=edge"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Document<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://unpkg.com/axios@0.24.0/dist/axios.min.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"fileInput"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"file"</span> <span class="hljs-attr">multiple</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
      <span class="hljs-keyword">const</span> fileInput = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">"#fileInput"</span>);

      <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">formData2</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FormData</span>();
        data.<span class="hljs-title function_">set</span>(<span class="hljs-string">"name"</span>, <span class="hljs-string">"fuhao"</span>);
        data.<span class="hljs-title function_">set</span>(<span class="hljs-string">"age"</span>, <span class="hljs-number">20</span>);
        [...fileInput.<span class="hljs-property">files</span>].<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> {
          data.<span class="hljs-title function_">append</span>(<span class="hljs-string">"bbb"</span>, item);
        });

        <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> axios.<span class="hljs-title function_">post</span>(<span class="hljs-string">"http://localhost:3000/bbb"</span>, data);
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(res);
      }

      fileInput.<span class="hljs-property">onchange</span> = formData2;
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>

</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c107d66c82e3428392481eb993989dbc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771295240&amp;x-signature=C4715%2Ba8k34wXLA0feiChUe%2FPJk%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/df5ccda136f14eeeb733528b7698c495~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771295240&amp;x-signature=Bax8NXiLKvKaR24xEThEqa%2FvHcc%3D" alt="image.png" loading="lazy"/></p>
<p>å¦‚æœè¶…è¿‡ 2ä¸ªæ–‡ä»¶ å°±ä¼šé»˜è®¤æŠ¥é”™</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3a8690c66990452fabf78bf08dd146dc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771295240&amp;x-signature=LkR5buaPmaPH5%2FtlTeeL723lpLc%3D" alt="image.png" loading="lazy"/></p>
<p>æ”¹ä¸€ä¸‹è¿™ä¸ª é”™è¯¯</p>
<pre><code class="hljs language-lua" lang="lua">
app.post(<span class="hljs-string">'/bbb'</span>, upload.array(<span class="hljs-string">'bbb'</span>, <span class="hljs-number">2</span>), <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(req, res, next)</span></span> {
    console.<span class="hljs-built_in">log</span>(<span class="hljs-string">'req.files'</span>, req.files);
    console.<span class="hljs-built_in">log</span>(<span class="hljs-string">'req.body'</span>, req.body);
}, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(err, req, res, next)</span></span> {
    <span class="hljs-keyword">if</span>(err instanceof multer.MulterError &amp;&amp; err.code === <span class="hljs-string">'LIMIT_UNEXPECTED_FILE'</span>) {
        res.<span class="hljs-built_in">status</span>(<span class="hljs-number">400</span>).<span class="hljs-keyword">end</span>(<span class="hljs-string">'Too many files uploaded'</span>);
    }
})
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1715dc1de9504c7a976d1e756027504a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771295240&amp;x-signature=gfQxOMb30z3BN8FX%2BajmxM7QjYo%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/72826043d55845b18ba2c11625effb83~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771295240&amp;x-signature=5LEvegVTJLLaAnVyJIkr0Y1HFhE%3D" alt="image.png" loading="lazy"/></p>
<p>æ›´å¤æ‚ä¸€ç‚¹çš„æƒ…å†µï¼Œå¦‚æœå¤šä¸ªå­—æ®µéƒ½ä¼šä¸Šä¼ æ–‡ä»¶ï¼Œè€Œä¸”é™åˆ¶ä¹Ÿéƒ½ä¸åŒå‘¢ï¼Ÿ</p>
<p>index.js æ›´æ–°</p>
<pre><code class="hljs language-less" lang="less">
<span class="hljs-selector-tag">app</span><span class="hljs-selector-class">.post</span>(<span class="hljs-string">'/ccc'</span>, upload.<span class="hljs-built_in">fields</span>([
    { <span class="hljs-attribute">name</span>: <span class="hljs-string">'aaa'</span>, <span class="hljs-attribute">maxCount</span>: <span class="hljs-number">3</span> },
    { <span class="hljs-attribute">name</span>: <span class="hljs-string">'bbb'</span>, <span class="hljs-attribute">maxCount</span>: <span class="hljs-number">2</span> }
]), function (req, res, next) {
    <span class="hljs-selector-tag">console</span><span class="hljs-selector-class">.log</span>(<span class="hljs-string">'req.files'</span>, req.files);
    <span class="hljs-selector-tag">console</span><span class="hljs-selector-class">.log</span>(<span class="hljs-string">'req.body'</span>, req.body);
})
</code></pre>
<p>index.html æ›´æ–°</p>
<pre><code class="hljs language-ini" lang="ini">      async function formData3() {
        const <span class="hljs-attr">data</span> = new FormData()<span class="hljs-comment">;</span>
        data.set("name", "fuhao")<span class="hljs-comment">;</span>
        data.set("age", 20)<span class="hljs-comment">;</span>
        data.append("aaa", fileInput.files<span class="hljs-section">[0]</span>)<span class="hljs-comment">;</span>
        data.append("aaa", fileInput.files<span class="hljs-section">[1]</span>)<span class="hljs-comment">;</span>
        data.append("bbb", fileInput.files<span class="hljs-section">[2]</span>)<span class="hljs-comment">;</span>
        data.append("bbb", fileInput.files<span class="hljs-section">[3]</span>)<span class="hljs-comment">;</span>

        const <span class="hljs-attr">res</span> = await axios.post(<span class="hljs-string">"http://localhost:3000/ccc"</span>, data)<span class="hljs-comment">;</span>
        console.log(res)<span class="hljs-comment">;</span>
      }

      <span class="hljs-attr">fileInput.onchange</span> = formData3<span class="hljs-comment">;</span>
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9a0c9770a5b14038b1ad395c985407b8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771295240&amp;x-signature=k2Tagf0lxHu5EWefBQevUliKeEU%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1d9afb21f8584aa8ae1aaa7c278b3e95~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771295240&amp;x-signature=lqN%2B0vaPQ30sBTF6SWmQECJrUjM%3D" alt="image.png" loading="lazy"/></p>
<p>å¦‚ä½•ä¿®æ”¹ä¿å­˜çš„æ–‡ä»¶åï¼Ÿ</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>)
<span class="hljs-keyword">const</span> multer  = <span class="hljs-built_in">require</span>(<span class="hljs-string">'multer'</span>)
<span class="hljs-keyword">const</span> cors = <span class="hljs-built_in">require</span>(<span class="hljs-string">'cors'</span>);
<span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>)

<span class="hljs-keyword">const</span> app = <span class="hljs-title function_">express</span>()
app.<span class="hljs-title function_">use</span>(<span class="hljs-title function_">cors</span>());

<span class="hljs-keyword">const</span> storage = multer.<span class="hljs-title function_">diskStorage</span>({
  <span class="hljs-title function_">destination</span>(<span class="hljs-params">req, file, cb</span>) {
    <span class="hljs-title function_">cb</span>(<span class="hljs-literal">null</span>, <span class="hljs-string">'uploads/'</span>)
  },
  <span class="hljs-title function_">filename</span>(<span class="hljs-params">req, file, cb</span>) {
    <span class="hljs-comment">// åŸå§‹æ–‡ä»¶å</span>
    <span class="hljs-keyword">const</span> ext = path.<span class="hljs-title function_">extname</span>(file.<span class="hljs-property">originalname</span>)
    <span class="hljs-keyword">const</span> name = path.<span class="hljs-title function_">basename</span>(file.<span class="hljs-property">originalname</span>, ext)

    <span class="hljs-comment">// è‡ªå®šä¹‰è§„åˆ™</span>
    <span class="hljs-keyword">const</span> newName = <span class="hljs-string">`<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${<span class="hljs-built_in">Date</span>.now()}</span><span class="hljs-subst">${ext}</span>`</span>

    <span class="hljs-title function_">cb</span>(<span class="hljs-literal">null</span>, newName)
  }
})

<span class="hljs-keyword">const</span> upload = <span class="hljs-title function_">multer</span>({ storage })

app.<span class="hljs-title function_">post</span>(<span class="hljs-string">'/aaa'</span>, upload.<span class="hljs-title function_">single</span>(<span class="hljs-string">'aaa'</span>), <span class="hljs-keyword">function</span> (<span class="hljs-params">req, res, next</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'req.file'</span>, req.<span class="hljs-property">file</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'req.body'</span>, req.<span class="hljs-property">body</span>);
})

app.<span class="hljs-title function_">post</span>(<span class="hljs-string">'/bbb'</span>, upload.<span class="hljs-title function_">array</span>(<span class="hljs-string">'bbb'</span>, <span class="hljs-number">2</span>), <span class="hljs-keyword">function</span> (<span class="hljs-params">req, res, next</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'req.files'</span>, req.<span class="hljs-property">files</span>);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'req.body'</span>, req.<span class="hljs-property">body</span>);
}, <span class="hljs-keyword">function</span>(<span class="hljs-params">err, req, res, next</span>) {
    <span class="hljs-keyword">if</span>(err <span class="hljs-keyword">instanceof</span> multer.<span class="hljs-property">MulterError</span> &amp;&amp; err.<span class="hljs-property">code</span> === <span class="hljs-string">'LIMIT_UNEXPECTED_FILE'</span>) {
        res.<span class="hljs-title function_">status</span>(<span class="hljs-number">400</span>).<span class="hljs-title function_">end</span>(<span class="hljs-string">'Too many files uploaded'</span>);
    }
})

app.<span class="hljs-title function_">post</span>(<span class="hljs-string">'/ccc'</span>, upload.<span class="hljs-title function_">fields</span>([
    { <span class="hljs-attr">name</span>: <span class="hljs-string">'aaa'</span>, <span class="hljs-attr">maxCount</span>: <span class="hljs-number">3</span> },
    { <span class="hljs-attr">name</span>: <span class="hljs-string">'bbb'</span>, <span class="hljs-attr">maxCount</span>: <span class="hljs-number">2</span> }
]), <span class="hljs-keyword">function</span> (<span class="hljs-params">req, res, next</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'req.files'</span>, req.<span class="hljs-property">files</span>);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'req.body'</span>, req.<span class="hljs-property">body</span>);
})


app.<span class="hljs-title function_">listen</span>(<span class="hljs-number">3000</span>);
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/95f31046412e491bafc84786468bee53~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771295240&amp;x-signature=TuO4ewhO4oqB%2Fw4a0QFANM8Bf2I%3D" alt="image.png" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å…³äºElpiså…¨æ ˆæ¡†æ¶ï¼ŒDSLæ¨¡ç‰ˆå¼•æ“çš„ä¸€äº›ä¸ªäººæ€è€ƒ]]></title>    <link>https://juejin.cn/post/7604701848150392832</link>    <guid>https://juejin.cn/post/7604701848150392832</guid>    <pubDate>2026-02-10T02:34:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604701848150392832" data-draft-id="7604493165329006626" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å…³äºElpiså…¨æ ˆæ¡†æ¶ï¼ŒDSLæ¨¡ç‰ˆå¼•æ“çš„ä¸€äº›ä¸ªäººæ€è€ƒ"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2026-02-10T02:34:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ‡¿ç”Ÿæ‰€çˆ±"/> <meta itemprop="url" content="https://juejin.cn/user/1830001704964680"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å…³äºElpiså…¨æ ˆæ¡†æ¶ï¼ŒDSLæ¨¡ç‰ˆå¼•æ“çš„ä¸€äº›ä¸ªäººæ€è€ƒ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1830001704964680/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ‡¿ç”Ÿæ‰€çˆ±
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T02:34:05.000Z" title="Tue Feb 10 2026 02:34:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å…³äºElpiså…¨æ ˆæ¡†æ¶ï¼ŒDSLæ¨¡ç‰ˆå¼•æ“çš„ä¸€äº›ä¸ªäººæ€è€ƒ</h2>
<p>ç°é˜¶æ®µï¼Œå¤§éƒ¨åˆ†å‰ç«¯ç¨‹åºå‘˜çš„å·¥ä½œå†…å®¹éƒ½æ¯”è¾ƒæ¯ç‡¥ï¼Œä¸”è¿›è¡Œä¸€äº›æ— æ„ä¹‰çš„è‹¦åŠ›åŠ³åŠ¨ï¼Œå¦‚ä¸‹ï¼š</p>
<p>1.å·¥ä½œä¸­å¤§éƒ¨åˆ†å·¥ä½œæ˜¯é‡å¤æ€§çš„CRUD
2.é¡¹ç›®ä¸­å­˜åœ¨å¤§é‡çš„å±å±±ä»£ç ï¼Œä»£ç ç»´æŠ¤æ€§å·®
3.ä»£ç ç¨‹åºé€»è¾‘æ€§å·®ï¼Œçœ‹èµ·æ¥å¾ˆéš¾ç†è§£</p>
<p>åœ¨Elpisä¸­ï¼Œå°†å’±ä»¬ç¨‹åºå‘˜ç°é˜¶æ®µå­˜åœ¨çš„ä¸€äº›ç—›ç‚¹ï¼Œè¿›è¡Œçš„äº†æ•´åˆï¼Œåˆ©ç”¨DSLé¢†åŸŸæ¨¡å‹ï¼Œå°†æ²‰æ·€å½“ä¸‹ç¨‹åºå‘˜80%çš„é‡å¤æ€§å·¥ä½œï¼Œå°†å¼€å‘çš„ç²¾åŠ›æ”¾åœ¨20%çš„å¯æ‰©å±•æ€§çš„å¼€å‘å·¥ä½œä¸­ã€‚</p>
<h2 data-id="heading-1">å…³äºDSLçš„è®¾è®¡</h2>
<p>1.åœ¨elpisé¡¹ç›®ä¸­ï¼ŒDSLæ¨¡ç‰ˆå¼•æ“çš„ä¸€äº›åŸºç¡€é…ç½®ï¼Œé…ç½®å¦‚å›¾ï¼š</p>
<pre><code class="hljs language-module.exports" lang="module.exports">      model: '', //æ¨¡ç‰ˆç±»å‹ï¼Œä¸åŒæ¨¡ç‰ˆç±»å‹å¯¹åº”ä¸ä¸€æ ·çš„æ¨¡ç‰ˆæ•°æ®ç»“æ„
      name: '',//æ¨¡ç‰ˆåç§°
      desc:'',//æ¨¡ç‰ˆæè¿°
      icon:'',//æ¨¡ç‰ˆå›¾æ ‡
      menu: [
         {
          key: '', //èœå•å”¯ä¸€æ ‡è¯†
          name: '',//èœå•åç§°
          menuType: '',//èœå•ç±»å‹ï¼Œæšä¸¾å€¼ï¼šgroup / module
          moduleType: '',// æšä¸¾å€¼ï¼šsider/iframe/custom/schema
          }ï¼Œ...]
       }
</code></pre>
<p>é€šè¿‡å›¾ä¸­çš„æ¨¡ç‰ˆé…ç½®ï¼Œå®Œæˆå¯¹é¡µé¢çš„åŸºç¡€é…ç½®ã€‚
2.åœ¨å®Œæˆå¯¹é¡¹ç›®çš„åŸºç¡€é…ç½®ä¹‹åï¼Œéœ€è¦å¤§æ¨¡å—ä¸‹çš„å°æ¨¡å—è¿›è¡Œæ›´ç»†è‡´çš„é…ç½®æ“ä½œï¼š
ï¼ˆ1ï¼‰å½“menuTypeä¸ºgroupçš„æ—¶å€™ï¼Œä¼šåœ¨å½“å‰èœå•ä¸‹äº§ç”Ÿå­èœå•ï¼Œè¿™é‡Œå°±éœ€è¦é€’å½’å»è·å–å½“å‰èœ     å•ä¸‹çš„æ‰€æœ‰çš„å­èœå•è¿›è¡Œå±•ç¤º</p>
<pre><code class="hljs language-ini" lang="ini">//å½“ <span class="hljs-attr">menuType</span> === group æ—¶ï¼Œå¯å¡«
subMenu: <span class="hljs-section">[{
// å¯é€’å½’ menuItem
          }]</span>,
</code></pre>
<p>ï¼ˆ2ï¼‰å½“moduleTypeä¸ºschemaæ—¶ï¼Œè¯´æ˜è¿™éƒ¨åˆ†ä¸ºå’±ä»¬éœ€è¦æ²‰æ·€çš„80%çš„åŠŸèƒ½ï¼Œåœ¨elpisé¡¹ç›®ä¸­é€šè¿‡åˆ©ç”¨<a href="https://link.juejin.cn?target=https%3A%2F%2Fjson-schema.org%2Flearn%2Fgetting-started-step-by-step" target="_blank" title="https://json-schema.org/learn/getting-started-step-by-step" ref="nofollow noopener noreferrer">ã€ŠJSON-SCHEMAã€‹</a>å·¥å…·å®Œæˆç›¸å¯¹åº”çš„é…ç½®ï¼š</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">//å½“ moduleType === schema æ—¶</span>

schemaConfig: {

api:<span class="hljs-string">''</span>,<span class="hljs-comment">//æ•°æ®æºAPIï¼ˆéµå¾ª RESTFUL è§„èŒƒï¼‰</span>

schema:{<span class="hljs-comment">//æ¿å—æ•°æ®ç»“æ„</span>

<span class="hljs-keyword">type</span>:<span class="hljs-string">'object'</span>,

properties:{

key:{

...schema,<span class="hljs-comment">//æ ‡å‡† scheam é…ç½®</span>

<span class="hljs-keyword">type</span>:<span class="hljs-string">''</span>,<span class="hljs-comment">//å­—æ®µç±»å‹</span>

label:<span class="hljs-string">''</span>,<span class="hljs-comment">//å­—æ®µä¸­æ–‡å</span>

<span class="hljs-comment">//å­—æ®µåœ¨ table-bar ä¸­çš„é…ç½®</span>

tableOption:{

...elTableColumnConfig,<span class="hljs-comment">//æ ‡å‡† el-table-column é…ç½®</span>

toFixed:<span class="hljs-number">0</span>,<span class="hljs-comment">//ä¿ç•™å‡ ä½å°æ•°</span>

visiable:<span class="hljs-literal">true</span>,<span class="hljs-comment">//é»˜è®¤ä¸ºtrue(falseæ—¶ï¼Œè¡¨ç¤ºä¸å†è¡¨å•ä¸­æ˜¾ç¤º)</span>

},<span class="hljs-comment">//å­—æ®µåœ¨ tableä¸­çš„ç›¸å…³é…ç½®</span>

<span class="hljs-comment">//å­—æ®µåœ¨ search-bar ä¸­çš„é…ç½®</span>

searchOption:{

...elComponentConfig,<span class="hljs-comment">//æ ‡å‡† el-form é…ç½®</span>

comType:<span class="hljs-string">''</span>,<span class="hljs-comment">//é…ç½®ç»„ä»¶ç±»å‹</span>

<span class="hljs-keyword">default</span>:<span class="hljs-string">''</span>,<span class="hljs-comment">//é»˜è®¤å€¼</span>
<span class="hljs-comment">//comType === 'select'</span>

enumList:[],

<span class="hljs-comment">//comType === 'dynamicSelect'</span>

api:<span class="hljs-string">''</span>

}

}

}

},

tableConfig: {

headerButtons:[{

label:<span class="hljs-string">''</span>,<span class="hljs-comment">//æŒ‰é’®ä¸­æ–‡å</span>

eventKey:<span class="hljs-string">''</span>,<span class="hljs-comment">//æŒ‰é’®äº‹ä»¶å</span>

eventOption:{},<span class="hljs-comment">//æŒ‰é’®äº‹ä»¶å…·ä½“é…ç½®</span>

...elButtonConfig <span class="hljs-comment">//æ ‡å‡† el-buttoné…ç½®</span>

},{}],<span class="hljs-comment">//å¯ä»¥å¤šä¸ªé…ç½®</span>

rowButtons:[{

label:<span class="hljs-string">''</span>,<span class="hljs-comment">//æŒ‰é’®ä¸­æ–‡å</span>

eventKey:<span class="hljs-string">''</span>,<span class="hljs-comment">//æŒ‰é’®äº‹ä»¶å</span>

eventOption:{

<span class="hljs-comment">//å½“ eventKey === â€˜removeâ€™</span>

params:{

<span class="hljs-comment">//paramKey = å‚æ•°çš„é”®å€¼</span>

<span class="hljs-comment">//rowValueKey = å‚æ•°å€¼ï¼Œæ ¼å¼ä¸ºschema::tableKey ï¼Œåˆ°table ä¸­æ‰¾ç›¸åº”çš„å­—æ®µ</span>

paramKey:rowValueKey

}

},<span class="hljs-comment">//æŒ‰é’®äº‹ä»¶å…·ä½“é…ç½®</span>

...elButtonConfig <span class="hljs-comment">//æ ‡å‡† el-buttoné…ç½®</span>

},{}],<span class="hljs-comment">//å¯ä»¥å¤šä¸ªé…ç½®</span>

},<span class="hljs-comment">//table ç›¸å…³é…ç½®</span>
searchConfig:{},<span class="hljs-comment">//search-barç›¸å…³é…ç½®</span>
</code></pre>
<p>åœ¨è¿™é‡Œå¯ä»¥çœ‹åˆ°ï¼Œåœ¨elpisé¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬å¹¶ä¸æ˜¯å»å¯¹æ¯ä¸€ä¸ªé¡µé¢çš„å„ç§ç»„ä»¶ï¼Œä¾‹å¦‚ï¼štableï¼ŒsearchBarç»„ä»¶ç­‰åœ¨æ¯ä¸ªé¡µé¢è¿›è¡Œé‡å¤æ€§çš„å¼€å‘ï¼Œè€Œæ˜¯å°†å„ç§ç»„ä»¶è¿›è¡Œäº†ä¸€ä¸ªæŠ½è±¡çš„æ¨¡ç‰ˆå®šä¹‰ï¼Œè¿™æ ·æˆ‘ä»¬å¯ä»¥é€šè¿‡å¯¹DSLæ¨¡ç‰ˆå¼•æ“çš„é…ç½®ï¼Œå°±å¯ä»¥å®Œæˆå¯¹ä¸åŒèœå•ä¸‹ä¸€äº›é‡å¤æ€§çš„CURDå·¥ä½œå°±è¡Œè€¦åˆå’Œæ²‰æ·€ï¼Œè¿™æ ·ä¹Ÿè®©ä»£ç çš„å¯ç»´æŠ¤æ€§æé«˜ã€‚</p>
<h3 data-id="heading-2">æ€»ç»“</h3>
<p>åœ¨elpisé¡¹ç›®ä¸­ï¼Œé€šè¿‡DSLé¢†åŸŸæ¨¡å‹çš„æ¦‚å¿µï¼Œå°†å‰ç«¯ç¨‹åºå‘˜æ—¥å¸¸å·¥ä½œ80%çš„å·¥ä½œè¿›è¡Œäº†æ•´åˆï¼Œè€Œé€šè¿‡DSlå°†è¿™80%çš„å·¥ä½œè¿›è¡Œæ²‰æ·€ï¼Œåªéœ€è¦ç”¨æˆ·é€šè¿‡æ–‡æ¡£è¿›è¡Œå¯¹åº”çš„é…ç½®å³å¯å±•ç¤ºæƒ³è¦çš„é¡µé¢ã€‚åœ¨ç»„ä»¶æ–¹é¢ï¼Œå¹¶ä¸æ˜¯åƒå‰ç«¯ç¨‹åºå‘˜æ—¥å¸¸å·¥ä½œä¸€æ ·ï¼Œå°†ä¸€äº›é‡å¤æ€§çš„ä¸œè¥¿æŠ½ç¦»å‡ºæ¥å˜æˆä¸€ä¸ªç»„ä»¶è¿›è¡Œè°ƒç”¨ï¼Œåœ¨elpisä¸­æˆ‘ä»¬é€šè¿‡DSLæ¨¡ç‰ˆå¼•æ“ï¼Œä»¥åŠå„ç±»ç»„ä»¶çš„è§£æå™¨è¿›è¡ŒåŠ¨æ€çš„æ¸²æŸ“ï¼Œè€Œä¸æ˜¯å†™æ­»åœ¨é¡µé¢ä¸Šã€‚</p>
<p>æ‰€ä»¥æˆ‘è§‰å¾—åœ¨elpisé¡¹ç›®ä¸­DSLæ¨¡ç‰ˆå¼•æ“çš„çœŸæ­£ç›®çš„æ˜¯ä¸ºäº†åŸ¹å…»ç¨‹åºå‘˜çš„æ¡†æ¶æ€ç»´ï¼Œä»¥åŠæ€è€ƒé—®é¢˜å’Œä¸æ–­å­¦ä¹ çš„èƒ½åŠ›ï¼Œè¿™æ ·æ‰èƒ½è®©å‰ç«¯ç¨‹åºå‘˜åœ¨æ—¥å¸¸çš„å·¥ä½œä¸­ä¿æŒæ›´é«˜çš„ç«äº‰åŠ›ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Promiseæ–¹æ³•å­˜æ¡£]]></title>    <link>https://juejin.cn/post/7604853010162712639</link>    <guid>https://juejin.cn/post/7604853010162712639</guid>    <pubDate>2026-02-10T02:42:49.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604853010162712639" data-draft-id="7604678037808594980" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Promiseæ–¹æ³•å­˜æ¡£"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2026-02-10T02:42:49.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="MQliferecord"/> <meta itemprop="url" content="https://juejin.cn/user/1139543665814600"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Promiseæ–¹æ³•å­˜æ¡£
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1139543665814600/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    MQliferecord
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T02:42:49.000Z" title="Tue Feb 10 2026 02:42:49 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    2
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h5 data-id="heading-0">Promise.all</h5>
<p>å®ç°<code>Promise.all</code>æ–¹æ³•ï¼š</p>
<ol>
<li>æ¥æ”¶ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡ï¼ˆå¦‚æ•°ç»„ï¼‰ï¼Œè¿”å›ä¸€ä¸ªæ–° Promiseï¼›</li>
<li>æ‰€æœ‰ Promise éƒ½æˆåŠŸæ—¶ï¼Œè¿”å›ç»“æœæ•°ç»„ï¼ˆé¡ºåºå’Œè¾“å…¥ä¸€è‡´ï¼‰ï¼›</li>
<li>ä»»æ„ä¸€ä¸ª Promise å¤±è´¥æ—¶ï¼Œç«‹å³è¿”å›è¯¥å¤±è´¥åŸå› ï¼›</li>
<li>è‹¥è¾“å…¥ä¸ºç©ºæ•°ç»„ï¼Œç«‹å³ resolve ç©ºæ•°ç»„ã€‚</li>
</ol>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> <span class="hljs-title function_">myPromiseAll</span> = (<span class="hljs-params">arrFunc</span>) =&gt; {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
    <span class="hljs-keyword">let</span> resArr = [];
    <span class="hljs-keyword">let</span> len = arrFunc.<span class="hljs-property">length</span>;
    <span class="hljs-keyword">let</span> k = <span class="hljs-number">0</span>;
    arrFunc.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">item, index</span>) =&gt;</span> {
      <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(item).<span class="hljs-title function_">then</span>(
        <span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> {
          k++;
          resArr[index] = res;
          <span class="hljs-keyword">if</span> (k === len) {
            <span class="hljs-title function_">resolve</span>(resArr);
          }
        },
        <span class="hljs-function">(<span class="hljs-params">rej</span>) =&gt;</span> {
          <span class="hljs-title function_">reject</span>(rej);
        }
      );
    });
  });
};
<span class="hljs-keyword">const</span> p1 = <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(<span class="hljs-number">1</span>);
<span class="hljs-keyword">const</span> p2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">resolve</span>(<span class="hljs-number">2</span>), <span class="hljs-number">1000</span>));
<span class="hljs-keyword">const</span> p3 = <span class="hljs-number">3</span>; <span class="hljs-comment">// éPromiseå€¼</span>

<span class="hljs-title function_">myPromiseAll</span>([p1, p2, p3])
  .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"all res:"</span>, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(res)); <span class="hljs-comment">// [1,2,3]</span>
  })
  .<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"all err:"</span>, err);
  });
</code></pre>
<h5 data-id="heading-1">Promise.race</h5>
<p>å®ç°<code>Promise.race</code>æ–¹æ³•ï¼š</p>
<ol>
<li>æ¥æ”¶å¯è¿­ä»£å¯¹è±¡ï¼Œè¿”å›æ–° Promiseï¼›</li>
<li>ç¬¬ä¸€ä¸ªå®Œæˆï¼ˆæˆåŠŸ / å¤±è´¥ï¼‰çš„ Promise çš„ç»“æœ / åŸå› ï¼Œå°±æ˜¯æœ€ç»ˆç»“æœï¼›</li>
<li>è‹¥è¾“å…¥ä¸ºç©ºæ•°ç»„ï¼Œæ°¸è¿œ pending</li>
</ol>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> <span class="hljs-title function_">MyPromiseRace</span> = (<span class="hljs-params">arrFunc</span>) =&gt; {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve,reject</span>) =&gt;</span> {
    arrFunc.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> {
      <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(item).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span>=&gt;</span>{
        <span class="hljs-title function_">resolve</span>(res)
      },<span class="hljs-function"><span class="hljs-params">rej</span>=&gt;</span>{
        <span class="hljs-title function_">reject</span>(rej)
      })
    });   
  });
};

<span class="hljs-keyword">const</span> p1 = <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(<span class="hljs-number">1</span>);
<span class="hljs-keyword">const</span> p2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">resolve</span>(<span class="hljs-number">2</span>), <span class="hljs-number">1000</span>));
<span class="hljs-keyword">const</span> p3 = <span class="hljs-number">3</span>; <span class="hljs-comment">// éPromiseå€¼</span>

<span class="hljs-keyword">const</span> p4 = <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'fail'</span>));
<span class="hljs-title class_">MyPromiseRace</span>([p1, p4]).<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'all err:'</span>, err.<span class="hljs-property">message</span>); <span class="hljs-comment">// fail</span>
});
</code></pre>
<h5 data-id="heading-2">Promise.allSettled</h5>
<p>å®ç°<code>Promise.allSettled</code>æ–¹æ³•ï¼š</p>
<ol>
<li>æ¥æ”¶å¯è¿­ä»£å¯¹è±¡ï¼Œè¿”å›æ–° Promiseï¼›</li>
<li>æ‰€æœ‰ Promise éƒ½å®Œæˆï¼ˆæˆåŠŸ / å¤±è´¥ï¼‰åï¼Œè¿”å›ç»“æœæ•°ç»„ï¼›</li>
<li>æ¯ä¸ªç»“æœå¯¹è±¡æ ¼å¼ï¼š<code>{ status: 'fulfilled', value: xxx }</code> æˆ– <code>{ status: 'rejected', reason: xxx }</code>ï¼›</li>
<li>ç©ºæ•°ç»„ç«‹å³ resolve ç©ºæ•°ç»„</li>
</ol>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> <span class="hljs-title function_">MyPromiseAllSettled</span> = (<span class="hljs-params">arrFunc</span>)=&gt;{
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve,reject</span>)=&gt;</span>{
    <span class="hljs-keyword">let</span> len = arrFunc.<span class="hljs-property">length</span>
    <span class="hljs-keyword">let</span> resarr = []
    <span class="hljs-keyword">let</span> k = <span class="hljs-number">0</span>

    arrFunc.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">item,index</span>)=&gt;</span>{
      <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(item).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span>=&gt;</span>{
        k++
        resarr[index] = res
        <span class="hljs-keyword">if</span>(len === k){
          <span class="hljs-title function_">resolve</span>(resarr)
        }
      },<span class="hljs-function"><span class="hljs-params">rej</span>=&gt;</span>{
        k++
        resarr[index] = rej
        <span class="hljs-keyword">if</span>(len === k){
          <span class="hljs-title function_">resolve</span>(resarr)
        }
      })
    })
  })
}
<span class="hljs-keyword">const</span> p1 = <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(<span class="hljs-number">1</span>);
<span class="hljs-keyword">const</span> p2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">resolve</span>(<span class="hljs-number">2</span>), <span class="hljs-number">1000</span>));
<span class="hljs-keyword">const</span> p3 = <span class="hljs-number">3</span>; <span class="hljs-comment">// éPromiseå€¼</span>

<span class="hljs-keyword">const</span> p4 = <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'fail'</span>));
<span class="hljs-title class_">MyPromiseAllSettled</span>([p1,p2,p3, p4]).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'all err:'</span>, res); <span class="hljs-comment">// fail</span>
});
</code></pre>
<h5 data-id="heading-3">å®ç°å¼‚æ­¥å‡½æ•°ä¸²è¡Œæ‰§è¡Œï¼ˆåŸºäº Promiseï¼‰</h5>
<p>ç»™å®šä¸€ä¸ªå¼‚æ­¥å‡½æ•°æ•°ç»„ï¼ˆæ¯ä¸ªå‡½æ•°è¿”å› Promiseï¼‰ï¼Œå®ç°ä¸€ä¸ªå‡½æ•°ï¼Œè®©è¿™äº›å‡½æ•°<strong>ä¸²è¡Œæ‰§è¡Œ</strong>ï¼ˆå‰ä¸€ä¸ªå®Œæˆåï¼Œå†æ‰§è¡Œåä¸€ä¸ªï¼‰ï¼Œæœ€ç»ˆè¿”å›æ‰€æœ‰ç»“æœçš„æ•°ç»„ã€‚</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> <span class="hljs-title function_">AsyncPromiseArr</span> = (<span class="hljs-params">arrFunc</span>) =&gt; {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-title function_">async</span>(resolve, reject) =&gt; {
    <span class="hljs-keyword">const</span> stack = [];
    <span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>
    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> func <span class="hljs-keyword">of</span> arrFunc){
      <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title function_">func</span>();
      stack.<span class="hljs-title function_">push</span>(res);
      i++
      <span class="hljs-keyword">if</span>(i === arrFunc.<span class="hljs-property">length</span>){
        <span class="hljs-title function_">resolve</span>(stack)
      }
    }
  });
};

<span class="hljs-comment">// æµ‹è¯•ç”¨ä¾‹</span>
<span class="hljs-comment">// æ¨¡æ‹Ÿå¼‚æ­¥å‡½æ•°</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">task1</span> = (<span class="hljs-params"/>) =&gt; <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function"><span class="hljs-params">resolve</span> =&gt;</span> <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">resolve</span>(<span class="hljs-number">1</span>), <span class="hljs-number">500</span>));
<span class="hljs-keyword">const</span> <span class="hljs-title function_">task2</span> = (<span class="hljs-params"/>) =&gt; <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function"><span class="hljs-params">resolve</span> =&gt;</span> <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">resolve</span>(<span class="hljs-number">3</span>), <span class="hljs-number">1500</span>));
<span class="hljs-keyword">const</span> <span class="hljs-title function_">task3</span> = (<span class="hljs-params"/>) =&gt; <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function"><span class="hljs-params">resolve</span> =&gt;</span> <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">resolve</span>(<span class="hljs-number">2</span>), <span class="hljs-number">100</span>));

<span class="hljs-title class_">AsyncPromiseArr</span>([task1, task2, task3]).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'serial res:'</span>, res); <span class="hljs-comment">// [1,2,3]ï¼ˆæ‰§è¡Œé¡ºåºï¼štask1â†’task2â†’task3ï¼‰</span>
});
</code></pre>
<h5 data-id="heading-4">å®ç° Promise è¶…æ—¶å°è£…</h5>
<p>å®ç°ä¸€ä¸ªå‡½æ•°<code>withTimeout(promise, timeout, errMsg)</code>ï¼š</p>
<ol>
<li>ç»™ Promise æ·»åŠ è¶…æ—¶æ§åˆ¶ï¼Œè‹¥è¶…è¿‡<code>timeout</code>æ¯«ç§’æœªå®Œæˆï¼Œè¿”å› rejectï¼ˆé”™è¯¯ä¿¡æ¯ä¸º<code>errMsg</code>ï¼‰ï¼›</li>
<li>è‹¥ Promise åœ¨è¶…æ—¶å‰å®Œæˆï¼Œæ­£å¸¸è¿”å›ç»“æœï¼›</li>
<li>è¶…æ—¶åç»ˆæ­¢ç­‰å¾…ï¼ˆæ— éœ€å–æ¶ˆåŸ Promiseï¼Œä»…æ§åˆ¶è¿”å›ç»“æœï¼‰ã€‚</li>
</ol>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> <span class="hljs-title function_">withTimeout</span> = (<span class="hljs-params">promise,timeout,errMsg</span>)=&gt;{
  <span class="hljs-keyword">const</span> promise1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve,reject</span>)=&gt;</span>{
    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">()=&gt;</span><span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(errMsg)),timeout)
  })
  <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">race</span>([promise,promise1])
}

<span class="hljs-keyword">const</span> p1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function"><span class="hljs-params">resolve</span> =&gt;</span> <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">resolve</span>(<span class="hljs-number">100</span>), <span class="hljs-number">500</span>));
<span class="hljs-title function_">withTimeout</span>(p1, <span class="hljs-number">1000</span>, <span class="hljs-string">'è¶…æ—¶äº†'</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'timeout res:'</span>, res); <span class="hljs-comment">// 100</span>
});

<span class="hljs-comment">// è¶…æ—¶åœºæ™¯</span>
<span class="hljs-keyword">const</span> p2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function"><span class="hljs-params">resolve</span> =&gt;</span> <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">resolve</span>(<span class="hljs-number">200</span>), <span class="hljs-number">1500</span>));
<span class="hljs-title function_">withTimeout</span>(p2, <span class="hljs-number">1000</span>, <span class="hljs-string">'è¶…æ—¶äº†'</span>).<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'timeout err:'</span>, err.<span class="hljs-property">message</span>); <span class="hljs-comment">// è¶…æ—¶äº†</span>
});
</code></pre>
<h5 data-id="heading-5">å®ç°ä¸€ä¸ªé˜²æŠ–å‡½æ•°</h5>
<p>è§¦å‘äº‹ä»¶åï¼Œç¬¬ä¸€æ¬¡è§¦å‘ç«‹å³æ‰§è¡Œï¼Œåç»­<strong>å»¶è¿Ÿ n æ¯«ç§’æ‰§è¡Œå›è°ƒå‡½æ•°</strong>ï¼›å¦‚æœåœ¨è¿™ n æ¯«ç§’å†…å†æ¬¡è§¦å‘äº‹ä»¶ï¼Œ<strong>é‡ç½®å»¶è¿Ÿæ—¶é—´</strong>ï¼ŒåŒæ—¶å¢åŠ <code>cancel</code>æ–¹æ³•æ”¯æŒæ‰‹åŠ¨å–æ¶ˆ</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> <span class="hljs-title function_">debounce_</span> = (<span class="hljs-params">fn,delay</span>)=&gt;{
  <span class="hljs-keyword">let</span> fn_
  <span class="hljs-keyword">const</span> debounceFunc = <span class="hljs-keyword">function</span>(<span class="hljs-params">...args</span>){
    <span class="hljs-keyword">if</span>(fn_){
      <span class="hljs-built_in">clearTimeout</span>(fn_)
    }<span class="hljs-keyword">else</span>{
      fn.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">this</span>,...args)
    }
    fn_ = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">()=&gt;</span>{
      fn.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">this</span>,...args)
      fn_ = <span class="hljs-literal">null</span>
    },delay)
  }
  debounceFunc.<span class="hljs-property">cancel</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>){
    <span class="hljs-title function_">clearImmediate</span>(fn_)
    fn_ = <span class="hljs-literal">null</span>
  }
  <span class="hljs-keyword">return</span> debounceFunc
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">handleSearch</span>(<span class="hljs-params">val</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'æœç´¢ï¼š'</span>, val);
}

<span class="hljs-keyword">const</span> debouncedSearchImmediate = <span class="hljs-title function_">debounce_</span>(handleSearch, <span class="hljs-number">1000</span>);
<span class="hljs-title function_">debouncedSearchImmediate</span>(<span class="hljs-string">'a'</span>); <span class="hljs-comment">// ç«‹å³è¾“å‡ºã€Œæœç´¢ï¼šaã€</span>
<span class="hljs-title function_">debouncedSearchImmediate</span>(<span class="hljs-string">'ab'</span>); <span class="hljs-comment">// 500mså†…è§¦å‘ï¼Œé‡ç½®å®šæ—¶å™¨ï¼ˆæ— è¾“å‡ºï¼‰</span>
<span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-title function_">debouncedSearchImmediate</span>(<span class="hljs-string">'abc'</span>); <span class="hljs-comment">// 500msåè§¦å‘ï¼Œç«‹å³è¾“å‡ºã€Œæœç´¢ï¼šabcã€</span>
},<span class="hljs-number">2000</span>);

<span class="hljs-comment">// æµ‹è¯•å–æ¶ˆåŠŸèƒ½</span>
<span class="hljs-keyword">const</span> debouncedCancel = <span class="hljs-title function_">debounce_</span>(handleSearch, <span class="hljs-number">500</span>);
<span class="hljs-title function_">debouncedCancel</span>(<span class="hljs-string">'test'</span>);
debouncedCancel.<span class="hljs-title function_">cancel</span>(); 
</code></pre>
<h5 data-id="heading-6">å®ç°èŠ‚æµå‡½æ•°</h5>
<p>è§¦å‘äº‹ä»¶åï¼Œ<strong>æ¯éš” n æ¯«ç§’åªèƒ½æ‰§è¡Œä¸€æ¬¡å›è°ƒå‡½æ•°</strong>ï¼Œæ— è®ºæœŸé—´è§¦å‘å¤šå°‘æ¬¡ï¼Œéƒ½ä¼šæŒ‰å›ºå®šé¢‘ç‡æ‰§è¡Œ</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> <span class="hljs-title function_">throttle_</span> = (<span class="hljs-params">fn, delay</span>) =&gt; {
  <span class="hljs-keyword">let</span> timer;
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span> (<span class="hljs-params">...args</span>) {
    <span class="hljs-keyword">if</span> (!timer) {
      timer = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
        fn.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">this</span>, ...args);
        timer = <span class="hljs-literal">null</span>
      }, delay);
    }
  };
};
</code></pre>
<h5 data-id="heading-7">å®ç°å¸¦ Promise çš„é˜²æŠ–å‡½æ•°</h5>
<p>å®ç°ä¸€ä¸ªé˜²æŠ–å‡½æ•°<code>debounceWithPromise(fn, delay)</code>ï¼š</p>
<ol>
<li>è§¦å‘åå»¶è¿Ÿ<code>delay</code>æ¯«ç§’æ‰§è¡Œå‡½æ•°ï¼›</li>
<li>é‡å¤è§¦å‘æ—¶é‡ç½®å»¶è¿Ÿï¼›</li>
<li>å‡½æ•°æ‰§è¡Œç»“æœé€šè¿‡ Promise è¿”å›ï¼›</li>
<li>æ”¯æŒå–æ¶ˆé˜²æŠ–ï¼ˆæ·»åŠ <code>cancel</code>æ–¹æ³•ï¼‰ã€‚</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[åˆ«å†ç”¨æ—§ç‰ˆäº†ï¼OpenClaw 2026.2.9 æ›´æ–°è¿ç§»é¿å‘æŒ‡å—]]></title>    <link>https://juejin.cn/post/7604672395627544603</link>    <guid>https://juejin.cn/post/7604672395627544603</guid>    <pubDate>2026-02-10T02:40:34.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604672395627544603" data-draft-id="7604690250364157961" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="åˆ«å†ç”¨æ—§ç‰ˆäº†ï¼OpenClaw 2026.2.9 æ›´æ–°è¿ç§»é¿å‘æŒ‡å—"/> <meta itemprop="keywords" content="è‡ªåŠ¨åŒ–è¿ç»´,AIGC,æœºå™¨äºº"/> <meta itemprop="datePublished" content="2026-02-10T02:40:34.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ›¹å·¥ä¸åŠ ç­"/> <meta itemprop="url" content="https://juejin.cn/user/4336129588870957"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            åˆ«å†ç”¨æ—§ç‰ˆäº†ï¼OpenClaw 2026.2.9 æ›´æ–°è¿ç§»é¿å‘æŒ‡å—
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4336129588870957/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ›¹å·¥ä¸åŠ ç­
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T02:40:34.000Z" title="Tue Feb 10 2026 02:40:34 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä¸ºä»€ä¹ˆè¦æ›´æ–°/è¿ç§»?</h2>
<h3 data-id="heading-1">Clawdbot â†’ OpenClaw æ”¹åæ—¶é—´çº¿</h3>
<p>2026å¹´1æœˆ,é¡¹ç›®ç»å†ä¸‰æ¬¡æ”¹å:</p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">1æœˆ24æ—¥: Peter Steinberger å‘å¸ƒ Clawdbot</span>
<span class="hljs-section">1æœˆ26æ—¥: Anthropic å‘å¾‹å¸ˆå‡½(å•†æ ‡é—®é¢˜)</span>
<span class="hljs-section">1æœˆ27æ—¥: ç´§æ€¥æ”¹å Moltbot</span>
<span class="hljs-section">1æœˆ29æ—¥: æœ€ç»ˆå®šå OpenClaw</span>
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3f2780d7dee249768950efb3afb92514~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pu55bel5LiN5Yqg54-t:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771296034&amp;x-signature=M62%2F%2FhR5NONC%2Bb4pFtWO%2FCvUyvg%3D" alt="Clawdbotä¸‰æ¬¡æ”¹åæ—¶é—´è½´" loading="lazy"/></p>
<p>è™½ç„¶æ—§å‘½ä»¤ <code>clawdbot</code> ä»å¯ç”¨,ä½†æ–°åŠŸèƒ½ã€å®‰å…¨æ›´æ–°å’Œ bug ä¿®å¤åªåœ¨ OpenClaw ç»´æŠ¤ã€‚</p>
<h3 data-id="heading-2">æ›´æ–°/è¿ç§»çš„ç†ç”±</h3>
<p><strong>1. QMD è®°å¿†ç³»ç»Ÿ</strong>(2026.2.2+)</p>
<p>Shopify CEO Tobi å¼€å‘çš„æœ¬åœ°è¯­ä¹‰æœç´¢å¼•æ“,å·²é›†æˆåˆ° OpenClaw:</p>
<ul>
<li>Token å‰Šå‡ 60-97%</li>
<li>å“åº”é€Ÿåº¦æå‡ 5-50 å€</li>
<li>å®Œå…¨å…è´¹,é›¶ API æˆæœ¬</li>
<li>è‡ªåŠ¨é™çº§åˆ° SQLite(QMD å¤±è´¥æ—¶)</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c7e1ef116642409e896e7451ccb609bb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pu55bel5LiN5Yqg54-t:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771296034&amp;x-signature=T7IMtsfCGEJ8WD%2Fxd68WpoPpkYw%3D" alt="QMDè®°å¿†ç³»ç»Ÿæ¶æ„" loading="lazy"/></p>
<p><strong>2. æ–°æ¨¡å‹æ”¯æŒ</strong></p>
<ul>
<li>Anthropic Opus 4.6</li>
<li>OpenAI GPT-5.3-codex</li>
<li>xAI Grok(å«ç½‘ç»œæœç´¢)</li>
</ul>
<p><strong>3. å®‰å…¨å¢å¼º</strong></p>
<p>OpenClaw ä¸ VirusTotal åˆä½œæ‰«æ ClawHub æŠ€èƒ½,Code Insight(Gemini é©±åŠ¨)è‡ªåŠ¨åˆ†ææŠ€èƒ½åŒ…:</p>
<ul>
<li>âœ… <code>benign</code>: è‡ªåŠ¨é€šè¿‡</li>
<li>âš ï¸ <code>suspicious</code>: æ˜¾ç¤ºè­¦å‘Š</li>
<li>âŒ <code>malicious</code>: é˜»æ­¢ä¸‹è½½</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b9727649a6544aedb43668921387aeb7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pu55bel5LiN5Yqg54-t:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771296034&amp;x-signature=nOTvwYvUQ8gBWFh4jjky1KRvx0E%3D" alt="VirusTotalå®‰å…¨æ‰«ææµç¨‹" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-3">OpenClaw æœ€æ–°ç‰ˆæœ¬ç‰¹æ€§</h2>
<h3 data-id="heading-4">å½“å‰ç‰ˆæœ¬</h3>
<p><strong>v2026.2.9</strong>(2026å¹´2æœˆ10æ—¥)</p>
<h3 data-id="heading-5">v2026.2.9 æ–°ç‰¹æ€§</h3>
<ul>
<li>ğŸ” <strong>Grok ç½‘ç»œæœç´¢æä¾›å•†</strong>: é›†æˆ xAI Grok ä½œä¸ºç½‘ç»œæœç´¢åç«¯</li>
<li>ğŸ§  <strong>è§£å†³å‹ç¼©åé—å¿˜</strong>: ä¿®å¤è®°å¿†å‹ç¼©åçš„ä¸Šä¸‹æ–‡ä¸¢å¤±é—®é¢˜</li>
<li>ğŸ›¡ï¸ <strong>ä¸Šä¸‹æ–‡æº¢å‡ºæ¢å¤</strong>: è‡ªåŠ¨å¤„ç†è¶…é•¿å¯¹è¯çš„ä¸Šä¸‹æ–‡ç®¡ç†</li>
<li>â° <strong>Cron å¯é æ€§å¤§ä¿®</strong>: å®šæ—¶ä»»åŠ¡æ‰§è¡Œæ›´åŠ ç¨³å®š</li>
<li>ğŸ› <strong>40+ bug ä¿®å¤</strong>: æ¥è‡ª 25+ è´¡çŒ®è€…çš„è´¨é‡æ”¹è¿›</li>
<li>ğŸŒ <strong>Web UI å¢å¼º</strong>: ä»£ç†ç®¡ç† RPC æ–¹æ³•ã€å‹ç¼©åˆ†éš”ç¬¦æ˜¾ç¤º</li>
<li>ğŸ“± <strong>Telegram ä¼˜åŒ–</strong>: å¼•ç”¨è§£æå¢å¼ºã€Markdown Spoiler æ”¯æŒ</li>
</ul>
<h3 data-id="heading-6">æ ¸å¿ƒä¼˜åŠ¿</h3>
<p><strong>ğŸ§  QMD è®°å¿†ç³»ç»Ÿ</strong>: æœ¬åœ°è¯­ä¹‰æœç´¢(BM25 + å‘é‡æœç´¢ + LLM é‡æ’åº),Token å‰Šå‡ 60-97%,å“åº”é€Ÿåº¦æå‡ 5-50 å€</p>
<p><strong>ğŸ¤– æœ€æ–°æ¨¡å‹æ”¯æŒ</strong>: Opus 4.6ã€GPT-5.3-codexã€Grok(å«ç½‘ç»œæœç´¢),æ”¯æŒå‰å‘å…¼å®¹é™çº§</p>
<p><strong>ğŸ›¡ï¸ å¢å¼ºå®‰å…¨</strong>: VirusTotal æŠ€èƒ½æ‰«æã€ç½‘å…³è®¤è¯ã€ä¼šè¯å†å²è´Ÿè½½é™åˆ¶</p>
<hr/>
<h2 data-id="heading-7">æ›´æ–° OpenClaw åˆ°æœ€æ–°ç‰ˆæœ¬</h2>
<blockquote>
<p>é€‚ç”¨äºå·²åœ¨ä½¿ç”¨ OpenClaw çš„ç”¨æˆ·</p>
</blockquote>
<h3 data-id="heading-8">æ£€æŸ¥å½“å‰ç‰ˆæœ¬</h3>
<pre><code class="hljs language-bash" lang="bash">openclaw --version
</code></pre>
<p>ä½äº v2026.2.9 å»ºè®®æ›´æ–°ã€‚</p>
<h3 data-id="heading-9">å¤‡ä»½æ•°æ®(å¯é€‰ä½†æ¨è)</h3>
<p><strong>macOS/Linux:</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">mkdir</span> -p ~/openclaw-backup-$(<span class="hljs-built_in">date</span> +%Y%m%d)
<span class="hljs-built_in">cp</span> -r ~/.openclaw ~/openclaw-backup-$(<span class="hljs-built_in">date</span> +%Y%m%d)/
<span class="hljs-built_in">cp</span> -r ~/clawd ~/openclaw-backup-$(<span class="hljs-built_in">date</span> +%Y%m%d)/
</code></pre>
<p><strong>Windows:</strong></p>
<pre><code class="hljs language-powershell" lang="powershell">$date = Get-Date -Format "yyyyMMdd"
mkdir "$HOME\openclaw-backup-$date"
Copy-Item "$HOME\.openclaw" -Destination "$HOME\openclaw-backup-$date\" -Recurse
Copy-Item "$HOME\clawd" -Destination "$HOME\openclaw-backup-$date\" -Recurse
</code></pre>
<h3 data-id="heading-10">æ‰§è¡Œæ›´æ–°</h3>
<p><strong>æ–¹å¼ä¸€: Shell è„šæœ¬(æ¨è)</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># macOS/Linux</span>
curl -fsSL https://openclaw.ai/install.sh | bash

<span class="hljs-comment"># Windows</span>
iwr -useb https://openclaw.ai/install.ps1 | iex
</code></pre>
<p><strong>æ–¹å¼äºŒ: npm</strong></p>
<pre><code class="hljs language-bash" lang="bash">npm install -g openclaw@latest

<span class="hljs-comment"># æˆ–ä½¿ç”¨ pnpm</span>
pnpm add -g openclaw@latest
</code></pre>
<p>æ›´æ–°è¿‡ç¨‹ä¼šè‡ªåŠ¨ä¿ç•™ <code>~/.openclaw</code> å’Œ <code>~/clawd</code>,åªæ›´æ–°å¯æ‰§è¡Œæ–‡ä»¶ã€‚</p>
<h3 data-id="heading-11">éªŒè¯æ›´æ–°</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æ£€æŸ¥ç‰ˆæœ¬</span>
openclaw --version

<span class="hljs-comment"># æ£€æŸ¥æœåŠ¡</span>
openclaw gateway status

<span class="hljs-comment"># æµ‹è¯•åŠŸèƒ½</span>
openclaw chat
</code></pre>
<h3 data-id="heading-12">æ›´æ–°åæ“ä½œ(å¯é€‰,æ¨è)</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># å¯ç”¨ QMD è®°å¿†ç³»ç»Ÿ(éœ€è¦ Bun)</span>
bun install -g https://github.com/tobi/qmd
<span class="hljs-comment"># ç¼–è¾‘ ~/.openclaw/openclaw.json,è®¾ç½® memory.qmd.sessions.enabled = true</span>

<span class="hljs-comment"># æ›´æ–°æŠ€èƒ½åº“</span>
openclaw skills update
</code></pre>
<hr/>
<h2 data-id="heading-13">ä» Clawdbot è¿ç§»åˆ° OpenClaw</h2>
<blockquote>
<p><strong>è­¦å‘Š</strong>: å…ˆåœæ­¢ Clawdbot æœåŠ¡å†å®‰è£… OpenClaw!</p>
<p>ä¸¤è€…éƒ½ä½¿ç”¨ 18789 ç«¯å£,ä½† gateway token ä¸åŒã€‚ä¸åœæœç›´æ¥å®‰è£…ä¼šå¯¼è‡´:</p>
<ul>
<li>ç«¯å£å†²çª(åŒæœåŠ¡äº‰æŠ¢ç«¯å£)</li>
<li>401 è®¤è¯é”™è¯¯(token ä¸åŒ¹é…)</li>
<li>æœåŠ¡ä¸ç¨³å®š</li>
</ul>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4e3a907182f54468a855e8a0bbe747cf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pu55bel5LiN5Yqg54-t:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771296034&amp;x-signature=fv3okDcAiZT1maMMjRRDAn%2FafRI%3D" alt="åŒæœåŠ¡ç«¯å£å†²çªè­¦å‘Š" loading="lazy"/></p>
<h3 data-id="heading-14">é…ç½®æ–‡ä»¶å¤¹å¯¹æ¯”</h3>






























<table><thead><tr><th>é¡¹ç›®</th><th>Clawdbot</th><th>OpenClaw</th></tr></thead><tbody><tr><td>é…ç½®æ–‡ä»¶å¤¹</td><td><code>~/.clawdbot</code></td><td><code>~/.openclaw</code></td></tr><tr><td>é…ç½®æ–‡ä»¶</td><td><code>moltbot.json</code></td><td><code>openclaw.json</code></td></tr><tr><td>å·¥ä½œåŒº</td><td><code>~/clawd</code></td><td><code>~/clawd</code>(ç›¸åŒ)</td></tr><tr><td>ç«¯å£</td><td>18789</td><td>18789(ç›¸åŒ)</td></tr></tbody></table>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2b6ea35711924352b411f57e21b50275~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pu55bel5LiN5Yqg54-t:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771296034&amp;x-signature=STbheMpWZKH4UfcVPmM2UKABahQ%3D" alt="é…ç½®æ–‡ä»¶å¤¹å¯¹æ¯”" loading="lazy"/></p>
<p>OpenClaw å®‰è£…æ—¶ä¼šè‡ªåŠ¨è¿ç§»é…ç½®,åˆ›å»ºç¬¦å·é“¾æ¥ <code>~/.clawdbot -&gt; ~/.openclaw</code>,ä½†<strong>ä¸ä¼šè‡ªåŠ¨æ¸…ç†æ—§æœåŠ¡</strong>ã€‚</p>
<h3 data-id="heading-15">è¿ç§»æ­¥éª¤</h3>
<h4 data-id="heading-16">åœæ­¢ Clawdbot æœåŠ¡</h4>
<p><strong>macOS/Linux:</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># åœæ­¢ç½‘å…³</span>
clawdbot gateway stop

<span class="hljs-comment"># Linux systemd ç”¨æˆ·</span>
systemctl --user stop clawdbot-gateway.service
systemctl --user <span class="hljs-built_in">disable</span> clawdbot-gateway.service
<span class="hljs-built_in">rm</span> -f ~/.config/systemd/user/clawdbot-gateway.service
systemctl --user daemon-reload
systemctl --user reset-failed

<span class="hljs-comment"># æ¸…ç†æ®‹ç•™è¿›ç¨‹</span>
pkill -f clawdbot

<span class="hljs-comment"># éªŒè¯ç«¯å£å·²é‡Šæ”¾</span>
lsof -i :18789
<span class="hljs-comment"># åº”è¯¥æ— è¾“å‡º</span>
</code></pre>
<p><strong>Windows:</strong></p>
<pre><code class="hljs language-powershell" lang="powershell"># åœæ­¢æœåŠ¡
clawdbot gateway stop

# æ£€æŸ¥ç«¯å£
netstat -ano | findstr :18789

# å¦‚æœä»è¢«å ç”¨,ç»ˆæ­¢è¿›ç¨‹(æ›¿æ¢ &lt;PID&gt;)
# taskkill /PID &lt;PID&gt; /F

# æˆ–å¼ºåˆ¶ç»ˆæ­¢æ‰€æœ‰ node è¿›ç¨‹
taskkill /IM node.exe /F
</code></pre>
<h4 data-id="heading-17">å¤‡ä»½æ•°æ®(æ¨è)</h4>
<p><strong>macOS/Linux:</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">mkdir</span> -p ~/openclaw-backup-$(<span class="hljs-built_in">date</span> +%Y%m%d)
<span class="hljs-built_in">cp</span> -r ~/.clawdbot ~/openclaw-backup-$(<span class="hljs-built_in">date</span> +%Y%m%d)/
<span class="hljs-built_in">cp</span> -r ~/clawd ~/openclaw-backup-$(<span class="hljs-built_in">date</span> +%Y%m%d)/
</code></pre>
<p><strong>Windows:</strong></p>
<pre><code class="hljs language-powershell" lang="powershell">$date = Get-Date -Format "yyyyMMdd"
mkdir "$HOME\openclaw-backup-$date"
Copy-Item "$HOME\.clawdbot" -Destination "$HOME\openclaw-backup-$date\" -Recurse
Copy-Item "$HOME\clawd" -Destination "$HOME\openclaw-backup-$date\" -Recurse
</code></pre>
<h4 data-id="heading-18">å®‰è£… OpenClaw</h4>
<p><strong>macOS/Linux:</strong></p>
<pre><code class="hljs language-bash" lang="bash">curl -fsSL https://openclaw.ai/install.sh | bash
</code></pre>
<p><strong>Windows:</strong></p>
<pre><code class="hljs language-powershell" lang="powershell">iwr -useb https://openclaw.ai/install.ps1 | iex
</code></pre>
<p>å®‰è£…è¿‡ç¨‹è‡ªåŠ¨è¿ç§»é…ç½®ã€åˆ›å»ºç¬¦å·é“¾æ¥å¹¶ä¿ç•™å·¥ä½œåŒºã€‚</p>
<h4 data-id="heading-19">éªŒè¯è¿ç§»</h4>
<pre><code class="hljs language-bash" lang="bash">openclaw gateway status         <span class="hljs-comment"># ç¡®è®¤æœåŠ¡è¿è¡Œ</span>
lsof -i :18789                  <span class="hljs-comment"># éªŒè¯åªæœ‰ä¸€ä¸ª openclaw è¿›ç¨‹</span>
openclaw chat                   <span class="hljs-comment"># æµ‹è¯•è®°å¿†å®Œæ•´æ€§</span>
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a6af135e06014d7596751a1668331639~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pu55bel5LiN5Yqg54-t:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771296034&amp;x-signature=lXC9bJIWKQpPTyhuHksuuIYaM%2FQ%3D" alt="å®Œæ•´è¿ç§»æµç¨‹" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-20">è¿ç§»å¸¸è§é—®é¢˜</h2>
<h3 data-id="heading-21">è¿ç§»ä¼šä¸¢å¤±è®°å¿†å—?</h3>
<p>ä¸ä¼šã€‚OpenClaw å®Œå…¨å…¼å®¹ Clawdbot æ•°æ®æ ¼å¼:</p>
<ul>
<li>å¯¹è¯å†å²: <code>~/clawd/</code> ä¸‹æ‰€æœ‰æ–‡ä»¶</li>
<li>é…ç½®ä¿¡æ¯: è‡ªåŠ¨ä» <code>~/.clawdbot</code> è¿ç§»åˆ° <code>~/.openclaw</code></li>
<li>Agent çŠ¶æ€: å®Œæ•´ä¿ç•™</li>
</ul>
<h3 data-id="heading-22">.clawdbot æ–‡ä»¶å¤¹è¿˜åœ¨,æ­£å¸¸å—?</h3>
<p>æ­£å¸¸ã€‚OpenClaw åˆ›å»ºç¬¦å·é“¾æ¥ <code>~/.clawdbot -&gt; ~/.openclaw</code> ä¿æŒå‘åå…¼å®¹ã€‚</p>
<p>éªŒè¯:</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">ls</span> -la ~/.clawdbot
<span class="hljs-comment"># åº”æ˜¾ç¤ºç¬¦å·é“¾æ¥</span>
</code></pre>
<h3 data-id="heading-23">Dashboard æ˜¾ç¤º 401 è®¤è¯é”™è¯¯?</h3>
<p>è¿™æ˜¯åŒæœåŠ¡è¿è¡Œçš„å…¸å‹ç—‡çŠ¶ã€‚ä¸¤ä¸ªæœåŠ¡ç”¨ä¸åŒçš„ gateway token,å¯¼è‡´è®¤è¯å¤±è´¥ã€‚</p>
<p>è§£å†³:</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># åœæ­¢æ‰€æœ‰æœåŠ¡</span>
clawdbot gateway stop
openclaw gateway stop

<span class="hljs-comment"># æ¸…ç†è¿›ç¨‹</span>
pkill -f clawdbot
pkill -f openclaw

<span class="hljs-comment"># åªå¯åŠ¨ OpenClaw</span>
openclaw gateway start

<span class="hljs-comment"># æ¸…ç†æµè§ˆå™¨ç¼“å­˜æˆ–ç”¨æ— ç—•æ¨¡å¼</span>
</code></pre>
<p>éªŒè¯:</p>
<pre><code class="hljs language-bash" lang="bash">lsof -i :18789
<span class="hljs-comment"># åº”è¯¥åªçœ‹åˆ°ä¸€ä¸ª openclaw è¿›ç¨‹</span>
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/11fcc5ca22994d7aa24b732068fc2667~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pu55bel5LiN5Yqg54-t:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771296034&amp;x-signature=uQWrUMI2CUmxIAdFZJI99vdYu8Y%3D" alt="401è®¤è¯é”™è¯¯è¯Šæ–­ä¸è§£å†³" loading="lazy"/></p>
<h3 data-id="heading-24">ç«¯å£ 18789 è¢«å ç”¨?</h3>
<p>Clawdbot æœåŠ¡æ²¡æœ‰å®Œå…¨æ¸…ç†ã€‚</p>
<p><strong>macOS/Linux:</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æŸ¥çœ‹å ç”¨è¿›ç¨‹</span>
lsof -i :18789

<span class="hljs-comment"># å¼ºåˆ¶ç»ˆæ­¢</span>
lsof -ti :18789 | xargs <span class="hljs-built_in">kill</span> -9

<span class="hljs-comment"># æ¸…ç† systemd(Linux)</span>
systemctl --user stop clawdbot-gateway.service
systemctl --user <span class="hljs-built_in">disable</span> clawdbot-gateway.service
<span class="hljs-built_in">rm</span> -f ~/.config/systemd/user/clawdbot-gateway.service
systemctl --user daemon-reload

<span class="hljs-comment"># å†æ¬¡éªŒè¯</span>
lsof -i :18789
</code></pre>
<p><strong>Windows:</strong></p>
<pre><code class="hljs language-powershell" lang="powershell"># æŸ¥çœ‹ç«¯å£å ç”¨
netstat -ano | findstr :18789

# ç»ˆæ­¢è¿›ç¨‹
taskkill /PID &lt;PID&gt; /F

# æˆ–å¼ºåˆ¶ç»ˆæ­¢æ‰€æœ‰ node
taskkill /IM node.exe /F
</code></pre>
<h3 data-id="heading-25">éœ€è¦é‡æ–°é…ç½®é£ä¹¦/é’‰é’‰å—?</h3>
<p>ä¸éœ€è¦ã€‚é…ç½®ä¼šè‡ªåŠ¨è¿ç§»,åŒ…æ‹¬:</p>
<ul>
<li>Webhook URLs</li>
<li>æœºå™¨äºº Token</li>
<li>é¢‘é“é…ç½®</li>
</ul>
<p>éªŒè¯:</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cat</span> ~/.openclaw/openclaw.json | grep -A 5 <span class="hljs-string">"channels"</span>
</code></pre>
<h3 data-id="heading-26">æ—§çš„ clawdbot å‘½ä»¤è¿˜èƒ½ç”¨å—?</h3>
<p>èƒ½ç”¨(ç¬¦å·é“¾æ¥),ä½†æ–°åŠŸèƒ½åªåœ¨ <code>openclaw</code> å‘½ä»¤ä¸‹æä¾›ã€‚<strong>åˆ‡å‹¿åŒæ—¶è¿è¡Œä¸¤ä¸ªæœåŠ¡ã€‚</strong></p>
<h3 data-id="heading-27">è¿ç§»åæ€§èƒ½æ²¡æœ‰æå‡?</h3>
<p>æ€§èƒ½æå‡ä¸»è¦æ¥è‡ª QMD è®°å¿†ç³»ç»Ÿ,éœ€æ‰‹åŠ¨å¯ç”¨:</p>
<pre><code class="hljs language-bash" lang="bash">bun install -g https://github.com/tobi/qmd
<span class="hljs-comment"># ç¼–è¾‘ ~/.openclaw/openclaw.json</span>
<span class="hljs-comment"># è®¾ç½® memory.qmd.sessions.enabled = true</span>
</code></pre>
<h3 data-id="heading-28">å¦‚ä½•å®Œå…¨å¸è½½ Clawdbot?</h3>
<p>è¿ç§»æˆåŠŸå¹¶ç¨³å®šè¿è¡Œå:</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ç¡®è®¤ OpenClaw æ­£å¸¸</span>
openclaw gateway status

<span class="hljs-comment"># å¸è½½ Clawdbot(npm å®‰è£…çš„)</span>
npm uninstall -g clawdbot

<span class="hljs-comment"># åˆ é™¤ç¬¦å·é“¾æ¥(å¯é€‰)</span>
<span class="hljs-built_in">rm</span> ~/.clawdbot

<span class="hljs-comment"># æ¸…ç† systemd(Linux)</span>
<span class="hljs-built_in">rm</span> -f ~/.config/systemd/user/clawdbot-gateway.service
systemctl --user daemon-reload
</code></pre>
<p>æ³¨æ„: ä¸è¦åˆ é™¤ <code>~/.openclaw</code>,å®ƒæ˜¯ä¸»é…ç½®æ–‡ä»¶å¤¹ã€‚</p>
<hr/>
<h2 data-id="heading-29">æ•…éšœæ’æŸ¥</h2>
<h3 data-id="heading-30">å¸¸è§é—®é¢˜å¿«é€Ÿè§£å†³</h3>
<p><strong>æœåŠ¡å¯åŠ¨å¤±è´¥</strong></p>
<pre><code class="hljs language-bash" lang="bash">openclaw status --all    <span class="hljs-comment"># ä¸€é”®è¯Šæ–­</span>
openclaw doctor --fix    <span class="hljs-comment"># è‡ªåŠ¨ä¿®å¤</span>
</code></pre>
<p><strong>Dashboard æ— æ³•åŠ è½½</strong></p>
<pre><code class="hljs language-bash" lang="bash">openclaw gateway status
curl http://localhost:18789/health
<span class="hljs-comment"># æ¸…ç†æµè§ˆå™¨ç¼“å­˜æˆ–ä½¿ç”¨æ— ç—•æ¨¡å¼</span>
</code></pre>
<p><strong>è®°å¿†ä¸¢å¤±</strong></p>
<pre><code class="hljs language-bash" lang="bash">openclaw memory reindex  <span class="hljs-comment"># QMD ç”¨æˆ·</span>
</code></pre>
<p><strong>å‘½ä»¤ä¸è¯†åˆ«</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">which</span> openclaw
<span class="hljs-built_in">hash</span> -r                  <span class="hljs-comment"># æ¸…ç†å‘½ä»¤ç¼“å­˜</span>
<span class="hljs-built_in">source</span> ~/.zshrc          <span class="hljs-comment"># é‡æ–°åŠ è½½é…ç½®</span>
</code></pre>
<h3 data-id="heading-31">è¯Šæ–­å‘½ä»¤é€ŸæŸ¥</h3>
<p>äº”æ­¥è¯Šæ–­æµç¨‹:</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. ä¸€é”®è¯Šæ–­æŠ¥å‘Š</span>
openclaw status --all

<span class="hljs-comment"># 2. æ£€æŸ¥è¿æ¥</span>
openclaw gateway status

<span class="hljs-comment"># 3. è‡ªåŠ¨ä¿®å¤(æˆåŠŸç‡ 60%)</span>
openclaw doctor --fix

<span class="hljs-comment"># 4. æ£€æŸ¥äº‹ä»¶æµ</span>
openclaw channels status --probe

<span class="hljs-comment"># 5. å®æ—¶æ—¥å¿—</span>
openclaw logs --follow
</code></pre>
<p><code>openclaw status</code> å’Œ <code>openclaw doctor</code> çš„åŒºåˆ«:</p>
<ul>
<li><code>status</code>: æŠ¥å‘Šå½“å‰çŠ¶æ€(æ­£åœ¨è¿è¡Œä»€ä¹ˆ)</li>
<li><code>doctor</code>: åˆ†æé…ç½®æ­£ç¡®æ€§(é…ç½®æ˜¯å¦æœ‰è¯¯)</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f7fe640ecc8c46c7a0a4f97f18c75bdf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pu55bel5LiN5Yqg54-t:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771296034&amp;x-signature=cCiRfqUAqfEW3jNbofj4axoM%2BcI%3D" alt="äº”æ­¥è¯Šæ–­æµç¨‹" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-32">è·å–å¸®åŠ©</h2>
<h3 data-id="heading-33">å®˜æ–¹èµ„æº</h3>
<ul>
<li><strong>å®˜æ–¹æ–‡æ¡£</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.openclaw.ai" target="_blank" title="https://docs.openclaw.ai" ref="nofollow noopener noreferrer">docs.openclaw.ai</a></li>
<li><strong>GitHub Issues</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fopenclaw%2Fopenclaw%2Fissues" target="_blank" title="https://github.com/openclaw/openclaw/issues" ref="nofollow noopener noreferrer">github.com/openclaw/opâ€¦</a></li>
<li><strong>GitHub Discussions</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fopenclaw%2Fopenclaw%2Fdiscussions" target="_blank" title="https://github.com/openclaw/openclaw/discussions" ref="nofollow noopener noreferrer">github.com/openclaw/opâ€¦</a></li>
</ul>
<h3 data-id="heading-34">æé—®æ—¶åŒ…å«</h3>
<p><strong>ç³»ç»Ÿä¿¡æ¯:</strong></p>
<pre><code class="hljs language-bash" lang="bash">openclaw --version
<span class="hljs-built_in">uname</span> -a  <span class="hljs-comment"># Linux/macOS</span>
</code></pre>
<p><strong>é”™è¯¯æ—¥å¿—:</strong></p>
<pre><code class="hljs language-bash" lang="bash">openclaw logs --<span class="hljs-built_in">tail</span> 50
</code></pre>
<p><strong>é…ç½®ä¿¡æ¯(éšè—æ•æ„Ÿæ•°æ®):</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cat</span> ~/.openclaw/openclaw.json | jq <span class="hljs-string">'del(.auth, .tokens)'</span>
</code></pre>
<p><strong>è¯Šæ–­ç»“æœ:</strong></p>
<pre><code class="hljs language-bash" lang="bash">openclaw doctor
</code></pre>
<hr/>
<h2 data-id="heading-35">æ€»ç»“</h2>
<h3 data-id="heading-36">å¿«é€Ÿæ›´æ–°(3åˆ†é’Ÿ)</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># macOS/Linux</span>
curl -fsSL https://openclaw.ai/install.sh | bash

<span class="hljs-comment"># Windows</span>
iwr -useb https://openclaw.ai/install.ps1 | iex
</code></pre>
<h3 data-id="heading-37">è¿ç§»å…³é”®</h3>
<p>âš ï¸ <strong>å…ˆåœ Clawdbot æœåŠ¡,å†å®‰è£… OpenClaw</strong>ã€‚é…ç½®å’Œè®°å¿†å®Œæ•´ä¿ç•™ã€‚</p>
<h3 data-id="heading-38">æ›´æ–°åæ¨èæ“ä½œ</h3>
<ol>
<li>å¯ç”¨ QMD è®°å¿†ç³»ç»Ÿ(æ€§èƒ½æå‡ 5-50 å€)</li>
<li>æ›´æ–°æŠ€èƒ½åº“: <code>openclaw skills update</code></li>
</ol>
<p><strong>å…³æ³¨å…¬ä¼—å·â€œæ›¹å·¥ä¸åŠ ç­â€ï¼ŒåŠ å…¥ AGI äº¤æµç¾¤ï¼Œä¸€èµ·èµ°å‘ AGI</strong></p>
<hr/>
<p><strong>å®˜æ–¹èµ„æº:</strong></p>
<ul>
<li><strong>å®˜ç½‘</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fopenclaw.ai" target="_blank" title="https://openclaw.ai" ref="nofollow noopener noreferrer">openclaw.ai</a></li>
<li><strong>GitHub</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fopenclaw%2Fopenclaw" target="_blank" title="https://github.com/openclaw/openclaw" ref="nofollow noopener noreferrer">github.com/openclaw/opâ€¦</a></li>
<li><strong>æ–‡æ¡£</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.openclaw.ai" target="_blank" title="https://docs.openclaw.ai" ref="nofollow noopener noreferrer">docs.openclaw.ai</a></li>
<li><strong>QMD é¡¹ç›®</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftobi%2Fqmd" target="_blank" title="https://github.com/tobi/qmd" ref="nofollow noopener noreferrer">github.com/tobi/qmd</a></li>
</ul>
<p><strong>å‚è€ƒèµ„æ–™:</strong></p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fopenclaw%2Fopenclaw%2Freleases%2Ftag%2Fv2026.2.9" target="_blank" title="https://github.com/openclaw/openclaw/releases/tag/v2026.2.9" ref="nofollow noopener noreferrer">OpenClaw v2026.2.9 å‘å¸ƒè¯´æ˜</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.openclaw.ai%2Finstall%2Fmigrating" target="_blank" title="https://docs.openclaw.ai/install/migrating" ref="nofollow noopener noreferrer">OpenClaw Migration Guide</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.openclaw.ai%2Fgateway%2Ftroubleshooting" target="_blank" title="https://docs.openclaw.ai/gateway/troubleshooting" ref="nofollow noopener noreferrer">OpenClaw Troubleshooting</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.openclaw.ai%2Fconcepts%2Fmemory" target="_blank" title="https://docs.openclaw.ai/concepts/memory" ref="nofollow noopener noreferrer">QMD å†…å­˜ç³»ç»Ÿæ–‡æ¡£</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fthehackernews.com%2F2026%2F02%2Fopenclaw-integrates-virustotal-scanning.html" target="_blank" title="https://thehackernews.com/2026/02/openclaw-integrates-virustotal-scanning.html" ref="nofollow noopener noreferrer">OpenClaw ä¸ VirusTotal åˆä½œ</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue vs Reactï¼šå½“â€œåŠ¨æ€åŒ…è£¹å™¨â€éœ€æ±‚é‡ä¸Šä¸¤ç§æ¡†æ¶å“²å­¦]]></title>    <link>https://juejin.cn/post/7604761524976582665</link>    <guid>https://juejin.cn/post/7604761524976582665</guid>    <pubDate>2026-02-10T02:58:02.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604761524976582665" data-draft-id="7604672395627724827" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vue vs Reactï¼šå½“â€œåŠ¨æ€åŒ…è£¹å™¨â€éœ€æ±‚é‡ä¸Šä¸¤ç§æ¡†æ¶å“²å­¦"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2026-02-10T02:58:02.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å†åƒä¸€æ ¹èƒ¡èåœ"/> <meta itemprop="url" content="https://juejin.cn/user/871275323725533"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vue vs Reactï¼šå½“â€œåŠ¨æ€åŒ…è£¹å™¨â€éœ€æ±‚é‡ä¸Šä¸¤ç§æ¡†æ¶å“²å­¦
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/871275323725533/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å†åƒä¸€æ ¹èƒ¡èåœ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T02:58:02.000Z" title="Tue Feb 10 2026 02:58:02 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    2
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>æœ¬æ–‡ä»ä¸€ä¸ªå®é™…å¼€å‘æ¡ˆä¾‹å‡ºå‘ï¼Œå¯¹æ¯” Vue å’Œ React åœ¨å¤„ç†â€œåŠ¨æ€åŒ…è£¹å™¨â€éœ€æ±‚æ—¶çš„ä¸åŒå®ç°æ–¹å¼ã€‚é€šè¿‡è¿™ä¸ªå…·ä½“ä¾‹å­ï¼Œåˆå­¦è€…å¯ä»¥ç›´è§‚æ„Ÿå—ä¸¤ä¸ªæ¡†æ¶è®¾è®¡å“²å­¦çš„å·®å¼‚ã€‚</p>
</blockquote>
<h2 data-id="heading-0">é—®é¢˜åœºæ™¯ï¼šä¸€ä¸ªè¡¨å•ç”Ÿæˆå™¨ç»„ä»¶</h2>
<p>å‡è®¾æˆ‘ä»¬è¦å¼€å‘ä¸€ä¸ªè¡¨å•ç”Ÿæˆå™¨ç»„ä»¶ï¼Œå®ƒéœ€è¦æ»¡è¶³è¿™æ ·çš„éœ€æ±‚ï¼š</p>
<ul>
<li>é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¯ä¸ªè¡¨å•é¡¹ç›´æ¥æ¸²æŸ“</li>
<li>ä½†æœ‰æ—¶éœ€è¦åœ¨å¤–å±‚åŒ…è£¹ä¸€ä¸ªå¸ƒå±€ç»„ä»¶ï¼ˆæ¯”å¦‚æ …æ ¼å¸ƒå±€çš„ <code>&lt;a-col&gt;</code>ï¼‰</li>
<li>ç”šè‡³æœ‰æ—¶éœ€è¦åŒ…è£¹ä¸€ä¸ªæç¤ºç»„ä»¶ï¼ˆæ¯”å¦‚ <code>&lt;a-tooltip&gt;</code>ï¼‰</li>
</ul>
<p>ç”¨äººç±»è¯­è¨€æè¿°å°±æ˜¯ï¼šâ€œå¦‚æœç»™äº†åŒ…è£¹å™¨ï¼Œå°±ç”¨åŒ…è£¹å™¨åŒ…ä¸€ä¸‹ï¼›å¦‚æœæ²¡ç»™ï¼Œå°±ç›´æ¥æ¸²æŸ“ã€‚â€</p>
<h2 data-id="heading-1">React çš„å®ç°ï¼šè‡ªç„¶çš„ JavaScript æ€ç»´</h2>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// FormGenerator.jsx</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">FormGenerator</span>(<span class="hljs-params">{ wrapper: Wrapper, items }</span>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">form</span>&gt;</span>
      {items.map(item =&gt; (
        // æ ¸å¿ƒé€»è¾‘ï¼šå¦‚æœç»™äº† Wrapper å°±åŒ…è£¹ï¼Œå¦åˆ™ç›´æ¥æ¸²æŸ“
        Wrapper ? (
          <span class="hljs-tag">&lt;<span class="hljs-name">Wrapper</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{item.id}</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">FormItem</span> <span class="hljs-attr">item</span>=<span class="hljs-string">{item}</span> /&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">Wrapper</span>&gt;</span>
        ) : (
          <span class="hljs-tag">&lt;<span class="hljs-name">FormItem</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{item.id}</span> <span class="hljs-attr">item</span>=<span class="hljs-string">{item}</span> /&gt;</span>
        )
      ))}
    <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span></span>
  )
}

<span class="hljs-comment">// ä½¿ç”¨æ–¹å¼ 1ï¼šä¼ å…¥ç»„ä»¶</span>
&lt;<span class="hljs-title class_">FormGenerator</span> 
  wrapper={<span class="hljs-title class_">Col</span>}  <span class="hljs-comment">// ç›´æ¥ä¼ ç»„ä»¶å¼•ç”¨</span>
  items={formItems}
/&gt;

<span class="hljs-comment">// ä½¿ç”¨æ–¹å¼ 2ï¼šä¼ å…¥è‡ªå®šä¹‰æ¸²æŸ“å‡½æ•°</span>
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">FormGenerator</span>
  <span class="hljs-attr">wrapper</span>=<span class="hljs-string">{({</span> <span class="hljs-attr">children</span> }) =&gt;</span> (
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">padding:</span> '<span class="hljs-attr">10px</span>' }}&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Tooltip</span> <span class="hljs-attr">title</span>=<span class="hljs-string">"æç¤º"</span>&gt;</span>{children}<span class="hljs-tag">&lt;/<span class="hljs-name">Tooltip</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  )}
  items={formItems}
/&gt;</span>
</code></pre>
<p>â€‹<strong>ä¸ºä»€ä¹ˆ React è¿™ä¹ˆç®€å•ï¼Ÿâ€‹</strong>â€‹<br/>
å› ä¸º React çš„ JSX æœ¬è´¨ä¸Šå°±æ˜¯ JavaScript å‡½æ•°è°ƒç”¨ï¼š</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-comment">// JSX æœ€ç»ˆä¼šè¢«ç¼–è¯‘æˆè¿™æ ·çš„å‡½æ•°è°ƒç”¨</span>
React.<span class="hljs-title function_ invoke__">createElement</span>(Wrapper, { <span class="hljs-attr">key</span>: item.id }, 
  React.<span class="hljs-title function_ invoke__">createElement</span>(FormItem, { item })
)
</code></pre>
<p>æ‰€ä»¥ä½ ç”¨ <code>Wrapper ? &lt;Wrapper&gt; : &lt;FormItem&gt;</code> è¿™ç§ä¸‰ç›®è¿ç®—ç¬¦ï¼Œå°±åƒå†™æ™®é€š JavaScript æ¡ä»¶åˆ¤æ–­ä¸€æ ·è‡ªç„¶ã€‚</p>
<h2 data-id="heading-2">Vue çš„å®ç°ï¼šæ¨¡æ¿è¯­æ³•çš„æŒ‘æˆ˜ä¸è§£å†³æ–¹æ¡ˆ</h2>
<h3 data-id="heading-3">æ–¹æ¡ˆä¸€ï¼šä½¿ç”¨åŠ¨æ€ç»„ä»¶ï¼ˆç›¸å¯¹ç®€å•ï¼‰</h3>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- FormGenerator.vue --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">form</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">"item in items"</span> <span class="hljs-attr">:key</span>=<span class="hljs-string">"item.id"</span>&gt;</span>
      <span class="hljs-comment">&lt;!-- å¦‚æœæœ‰åŒ…è£¹å™¨ --&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">component</span> 
        <span class="hljs-attr">v-if</span>=<span class="hljs-string">"wrapper"</span> 
        <span class="hljs-attr">:is</span>=<span class="hljs-string">"wrapper"</span> 
        <span class="hljs-attr">v-bind</span>=<span class="hljs-string">"wrapperProps"</span>
      &gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">slot</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"before"</span> <span class="hljs-attr">:item</span>=<span class="hljs-string">"item"</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">form-item</span> <span class="hljs-attr">:item</span>=<span class="hljs-string">"item"</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">slot</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"after"</span> <span class="hljs-attr">:item</span>=<span class="hljs-string">"item"</span> /&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">component</span>&gt;</span>
      
      <span class="hljs-comment">&lt;!-- å¦‚æœæ²¡æœ‰åŒ…è£¹å™¨ --&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">v-else</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">slot</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"before"</span> <span class="hljs-attr">:item</span>=<span class="hljs-string">"item"</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">form-item</span> <span class="hljs-attr">:item</span>=<span class="hljs-string">"item"</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">slot</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"after"</span> <span class="hljs-attr">:item</span>=<span class="hljs-string">"item"</span> /&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-title function_">defineProps</span>({
  <span class="hljs-attr">wrapper</span>: { <span class="hljs-attr">type</span>: [<span class="hljs-title class_">Object</span>, <span class="hljs-title class_">String</span>], <span class="hljs-attr">default</span>: <span class="hljs-literal">null</span> },
  <span class="hljs-attr">wrapperProps</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">Object</span>, <span class="hljs-attr">default</span>: <span class="hljs-function">() =&gt;</span> ({}) }
})
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

<span class="hljs-comment">&lt;!-- ä½¿ç”¨æ–¹å¼ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">form-generator</span>
    <span class="hljs-attr">:wrapper</span>=<span class="hljs-string">"Col"</span>
    <span class="hljs-attr">:wrapper-props</span>=<span class="hljs-string">"{ span: 12 }"</span>
  /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
</code></pre>
<h3 data-id="heading-4">æ–¹æ¡ˆäºŒï¼šä½¿ç”¨ä½œç”¨åŸŸæ’æ§½ï¼ˆæ›´çµæ´»ï¼‰</h3>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- FormGenerator.vue --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">form</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">"item in items"</span> <span class="hljs-attr">:key</span>=<span class="hljs-string">"item.id"</span>&gt;</span>
      <span class="hljs-comment">&lt;!-- æŠŠæ¸²æŸ“æ§åˆ¶æƒäº¤ç»™çˆ¶ç»„ä»¶ --&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">slot</span> 
        <span class="hljs-attr">name</span>=<span class="hljs-string">"item"</span> 
        <span class="hljs-attr">:item</span>=<span class="hljs-string">"item"</span>
        <span class="hljs-attr">:default</span>=<span class="hljs-string">"() =&gt; h(FormItem, { item })"</span>
      &gt;</span>
        <span class="hljs-comment">&lt;!-- é»˜è®¤å†…å®¹ --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">form-item</span> <span class="hljs-attr">:item</span>=<span class="hljs-string">"item"</span> /&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">slot</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-comment">&lt;!-- ä½¿ç”¨æ–¹å¼ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">form-generator</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- è‡ªå·±æ§åˆ¶å¦‚ä½•åŒ…è£¹ --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">item</span>=<span class="hljs-string">"{ item, default: defaultContent }"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">a-col</span> <span class="hljs-attr">:span</span>=<span class="hljs-string">"6"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">a-tooltip</span> <span class="hljs-attr">title</span>=<span class="hljs-string">"è¿™æ˜¯æç¤º"</span>&gt;</span>
          {{ defaultContent() }}
        <span class="hljs-tag">&lt;/<span class="hljs-name">a-tooltip</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">a-col</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">form-generator</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
</code></pre>
<h2 data-id="heading-5">å¯¹æ¯”åˆ†æ</h2>
<h3 data-id="heading-6">React çš„ä¼˜åŠ¿</h3>
<ol>
<li>â€‹<strong>æ€ç»´ä¸€è‡´æ€§</strong>â€‹ï¼šæ¡ä»¶æ¸²æŸ“ã€å¾ªç¯æ¸²æŸ“éƒ½æ˜¯ JavaScript é€»è¾‘ï¼Œä¸éœ€è¦å­¦ä¹ é¢å¤–è¯­æ³•</li>
<li>â€‹<strong>çµæ´»æ€§é«˜</strong>â€‹ï¼šå¯ä»¥ä¼ ç»„ä»¶å¼•ç”¨ã€å¯ä»¥ä¼ å‡½æ•°ã€ç”šè‡³å¯ä»¥ç°åœºåˆ›å»ºç»„ä»¶</li>
<li>â€‹<strong>ä»£ç ç®€æ´</strong>â€‹ï¼šä¸€ä¸ªä¸‰ç›®è¿ç®—ç¬¦æå®šæ‰€æœ‰é€»è¾‘</li>
</ol>
<h3 data-id="heading-7">Vue çš„ä¼˜åŠ¿</h3>
<ol>
<li>â€‹<strong>æ¨¡æ¿ç›´è§‚</strong>â€‹ï¼š<code>v-if</code>ã€<code>v-for</code> æŒ‡ä»¤è®©æ¨¡æ¿ç»“æ„æ¸…æ™°æ˜“è¯»</li>
<li>â€‹<strong>æ’æ§½ç³»ç»Ÿ</strong>â€‹ï¼šä½œç”¨åŸŸæ’æ§½æä¾›äº†å¼ºå¤§çš„å†…å®¹åˆ†å‘èƒ½åŠ›</li>
<li>â€‹<strong>æ¸è¿›å¼å­¦ä¹ </strong>â€‹ï¼šç®€å•çš„ç”¨ <code>v-if</code>ï¼Œå¤æ‚çš„ç”¨æ’æ§½ï¼Œæ€»æœ‰è§£å†³æ–¹æ¡ˆ</li>
</ol>
<h3 data-id="heading-8">ä¸ºä»€ä¹ˆä¼šæœ‰è¿™ç§å·®å¼‚ï¼Ÿ</h3>
<p>â€‹<strong>React è®¤ä¸º</strong>â€‹ï¼šUI æ˜¯çŠ¶æ€çš„å‡½æ•°ï¼Œæ¸²æŸ“é€»è¾‘å°±åº”è¯¥ç”¨ JavaScript è¡¨è¾¾ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// React çš„å“²å­¦ï¼šç”¨ JavaScript æè¿° UI</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">renderUI</span>(<span class="hljs-params">state</span>) {
  <span class="hljs-keyword">if</span> (state.<span class="hljs-property">loading</span>) {
    <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Loading</span> /&gt;</span></span>
  }
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Content</span> <span class="hljs-attr">data</span>=<span class="hljs-string">{state.data}</span> /&gt;</span></span>
}
</code></pre>
<p>â€‹<strong>Vue è®¤ä¸º</strong>â€‹ï¼šæ¨¡æ¿å’Œé€»è¾‘åº”è¯¥åˆ†ç¦»ï¼Œæ¨¡æ¿è´Ÿè´£ç»“æ„ï¼ŒJavaScript è´Ÿè´£é€»è¾‘ã€‚</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- Vue çš„å“²å­¦ï¼šæ¨¡æ¿æè¿°ç»“æ„ï¼Œè„šæœ¬å¤„ç†é€»è¾‘ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">Loading</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"loading"</span> /&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">Content</span> <span class="hljs-attr">v-else</span> <span class="hljs-attr">:data</span>=<span class="hljs-string">"data"</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
</code></pre>
<h2 data-id="heading-9">ç»™åˆå­¦è€…çš„å»ºè®®</h2>
<ol>
<li>
<p>â€‹<strong>å¦‚æœä½ åˆšåˆšå…¥é—¨</strong>â€‹ï¼š</p>
<ul>
<li>å…ˆå­¦ Vueï¼Œå› ä¸ºå®ƒçš„æ¨¡æ¿è¯­æ³•æ›´ç›´è§‚ï¼Œæ›´å®¹æ˜“çœ‹åˆ°â€œä»£ç å¦‚ä½•å˜æˆé¡µé¢â€</li>
<li>æŠŠ Vue çš„ <code>v-if</code>ã€<code>v-for</code>ã€æ’æ§½è¿™äº›æ¦‚å¿µå­¦æ‰å®</li>
</ul>
</li>
<li>
<p>â€‹<strong>å½“ä½ ç†Ÿæ‚‰ Vue åæƒ³å­¦ React</strong>â€‹ï¼š</p>
<ul>
<li>å¿˜æ‰â€œæ¨¡æ¿â€æ€ç»´ï¼Œæ¥å—â€œä¸€åˆ‡éƒ½æ˜¯ JavaScriptâ€çš„ç†å¿µ</li>
<li>ç»ƒä¹ ç”¨ JavaScript çš„ä¸‰ç›®è¿ç®—ç¬¦ã€<code>map</code>ã€<code>filter</code> æ¥å¤„ç† UI é€»è¾‘</li>
</ul>
</li>
<li>
<p>â€‹<strong>å®é™…é¡¹ç›®ä¸­å¦‚ä½•é€‰æ‹©</strong>â€‹ï¼š</p>
<ul>
<li>å¦‚æœé¡¹ç›®æœ‰å¾ˆå¤š<strong>åŠ¨æ€çš„ã€æ¡ä»¶å¤æ‚çš„ UI</strong>â€‹ â†’ è€ƒè™‘ React</li>
<li>å¦‚æœé¡¹ç›®ä¸»è¦æ˜¯<strong>è¡¨å•ã€è¡¨æ ¼ã€å›ºå®šå¸ƒå±€</strong>â€‹ â†’ è€ƒè™‘ Vue</li>
<li>çœ‹å›¢é˜Ÿç†Ÿæ‚‰å“ªä¸ªæ¡†æ¶ï¼Œå°±ç”¨å“ªä¸ª</li>
</ul>
</li>
</ol>
<h2 data-id="heading-10">ä¸€ä¸ªæ›´ç®€å•çš„ä¾‹å­</h2>
<p>æœ€åç”¨ä¸€ä¸ªæ›´ç®€å•çš„ä¾‹å­ç»“æŸè¿™ä¸ªè®¨è®ºï¼š</p>
<p>â€‹<strong>éœ€æ±‚</strong>â€‹ï¼šæ ¹æ®ç”¨æˆ·æ˜¯å¦ç™»å½•æ˜¾ç¤ºä¸åŒå†…å®¹</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// Reactï¼šå°±æ˜¯ JavaScript æ¡ä»¶åˆ¤æ–­</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Header</span>(<span class="hljs-params">{ user }</span>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      {user ? (
        <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>æ¬¢è¿å›æ¥ï¼Œ{user.name}ï¼<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
      ) : (
        <span class="hljs-tag">&lt;<span class="hljs-name">button</span>&gt;</span>ç™»å½•<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      )}
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  )
}
</code></pre>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- Vueï¼šæ¨¡æ¿æŒ‡ä»¤ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"user"</span>&gt;</span>æ¬¢è¿å›æ¥ï¼Œ{{ user.name }}ï¼<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">v-else</span>&gt;</span>ç™»å½•<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
</code></pre>
<p>â€‹<strong>ä½ çœ‹ï¼ŒReact è®©ä½ ç”¨ JavaScript å†™ UIï¼ŒVue è®©ä½ ç”¨â€œå¢å¼ºçš„ HTMLâ€å†™ UIã€‚â€‹</strong>â€‹ æ²¡æœ‰ç»å¯¹çš„å¥½åï¼Œåªæœ‰é€‚ä¸é€‚åˆä½ çš„æ€ç»´æ–¹å¼å’Œé¡¹ç›®éœ€æ±‚ã€‚</p>
<p>å¸Œæœ›è¿™ä¸ªå¯¹æ¯”èƒ½å¸®åŠ©ä½ ç†è§£ä¸¤è€…çš„å·®å¼‚ï¼åœ¨å®é™…å¼€å‘ä¸­ï¼Œä¸¤ä¸ªæ¡†æ¶éƒ½èƒ½å¾ˆå¥½åœ°å®Œæˆä»»åŠ¡ï¼Œå…³é”®æ˜¯ç†è§£å®ƒä»¬çš„è®¾è®¡å“²å­¦ï¼Œç„¶åé€‰æ‹©æœ€é€‚åˆä½ å’Œå›¢é˜Ÿçš„é‚£ä¸€ä¸ªã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æœ€çŸ­è¿ç»­å­ä¸²]]></title>    <link>https://juejin.cn/post/7604694326518792243</link>    <guid>https://juejin.cn/post/7604694326518792243</guid>    <pubDate>2026-02-10T02:50:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604694326518792243" data-draft-id="7604786493638328347" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æœ€çŸ­è¿ç»­å­ä¸²"/> <meta itemprop="keywords" content="JavaScript,ECMAScript 6"/> <meta itemprop="datePublished" content="2026-02-10T02:50:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æœ‰æ„ä¹‰"/> <meta itemprop="url" content="https://juejin.cn/user/1739866211617625"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æœ€çŸ­è¿ç»­å­ä¸²
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1739866211617625/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æœ‰æ„ä¹‰
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T02:50:17.000Z" title="Tue Feb 10 2026 02:50:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">é—®é¢˜</h3>
<p>ç»™ä¸¤ä¸ªå­—ç¬¦ä¸²ï¼š</p>
<ul>
<li><code>s</code>ï¼šä¸»ä¸²ï¼ˆæ¯”å¦‚Â <code>"ADOBECODEBANC"</code>ï¼‰</li>
<li><code>t</code>ï¼šç›®æ ‡ä¸²ï¼ˆæ¯”å¦‚Â <code>"ABC"</code>ï¼‰</li>
</ul>
<p>æ‰¾å‡ºÂ <strong><code>s</code>Â ä¸­æœ€çŸ­çš„è¿ç»­å­ä¸²</strong>ï¼Œä½¿å¾—è¿™ä¸ªå­ä¸²Â <strong>åŒ…å«Â <code>t</code>Â ä¸­æ‰€æœ‰å­—ç¬¦ï¼ˆåŒ…æ‹¬é‡å¤æ¬¡æ•°ï¼‰</strong> ã€‚</p>
<blockquote>
<p>æ¯”å¦‚Â <code>t = "AAB"</code>ï¼Œé‚£å­ä¸²é‡Œè‡³å°‘è¦æœ‰ 2 ä¸ªÂ <code>'A'</code>Â å’Œ 1 ä¸ªÂ <code>'B'</code>ã€‚</p>
</blockquote>
<p>å¦‚æœæ‰¾ä¸åˆ°ï¼Œè¿”å›ç©ºå­—ç¬¦ä¸²Â <code>""</code>ã€‚</p>
<hr/>
<h2 data-id="heading-1">æ ¸å¿ƒæ€æƒ³ï¼šæ»‘åŠ¨çª—å£ï¼ˆåŒæŒ‡é’ˆï¼‰</h2>
<p>æƒ³è±¡ä¸€ä¸ª<strong>å¯ä¼¸ç¼©çš„çª—å£</strong>åœ¨Â <code>s</code>Â ä¸Šæ»‘åŠ¨ï¼š</p>
<p><strong>å³æŒ‡é’ˆï¼ˆrightï¼‰</strong> ï¼šä¸æ–­å‘å³æ‰©å±•ï¼ŒæŠŠå­—ç¬¦â€œåƒè¿›æ¥â€</p>
<p><strong>å·¦æŒ‡é’ˆï¼ˆleftï¼‰</strong> ï¼šå½“çª—å£å·²ç»â€œæ»¡è¶³æ¡ä»¶â€æ—¶ï¼Œå°è¯•å‘å³æ”¶ç¼©ï¼Œçœ‹çœ‹èƒ½ä¸èƒ½å˜å¾—æ›´çŸ­</p>
<p>æˆ‘ä»¬çš„ç›®æ ‡æ˜¯ï¼š<strong>åœ¨æ‰€æœ‰â€œæ»¡è¶³æ¡ä»¶â€çš„çª—å£ä¸­ï¼Œæ‰¾åˆ°é•¿åº¦æœ€å°çš„é‚£ä¸ª</strong>ã€‚</p>
<hr/>
<h2 data-id="heading-2"><code>cnt</code>Â æ•°ç»„ +Â <code>less</code>Â å˜é‡</h2>
<h3 data-id="heading-3">1.Â <code>cnt</code>Â æ•°ç»„ï¼ˆå¤§å° 128ï¼‰</h3>
<p>ç”¨æ¥è®°å½•Â <strong>æ¯ä¸ªå­—ç¬¦è¿˜éœ€è¦å¤šå°‘ä¸ª</strong>ã€‚</p>
<p>åˆå§‹æ—¶ï¼Œæ ¹æ®Â <code>t</code>Â è®¾ç½®éœ€æ±‚ï¼š</p>
<p>æ¯”å¦‚Â <code>t = "ABC"</code>Â â†’Â <code>cnt[65] = 1</code>ï¼ˆ'A'ï¼‰ï¼Œ<code>cnt[66] = 1</code>ï¼ˆ'B'ï¼‰ï¼Œ<code>cnt[67] = 1</code>ï¼ˆ'C'ï¼‰</p>
<p>å½“æˆ‘ä»¬åœ¨Â <code>s</code>Â ä¸­é‡åˆ°æŸä¸ªå­—ç¬¦ï¼Œå°±Â <strong>å‡ 1</strong>ï¼ˆè¡¨ç¤ºâ€œæˆ‘æä¾›äº†ä¸€ä¸ªâ€ï¼‰</p>
<p>å¦‚æœÂ <code>cnt[c]</code>Â ä»Â <code>1</code>Â å˜æˆÂ <code>0</code>Â â†’ è¿™ä¸ªå­—ç¬¦çš„éœ€æ±‚åˆšå¥½æ»¡è¶³</p>
<p>å¦‚æœå˜æˆè´Ÿæ•°ï¼ˆæ¯”å¦‚Â <code>-1</code>ï¼‰â†’ è¿™ä¸ªå­—ç¬¦å¤šå‡ºæ¥äº†ï¼ˆå†—ä½™ï¼‰</p>
<h3 data-id="heading-4">2.Â <code>less</code>Â å˜é‡</h3>
<p>è¡¨ç¤ºÂ <strong>è¿˜æœ‰å¤šå°‘ç§å­—ç¬¦æ²¡æœ‰æ»¡è¶³éœ€æ±‚</strong>ã€‚</p>
<p>åˆå§‹å€¼ =Â <code>t</code>Â ä¸­<strong>ä¸åŒå­—ç¬¦çš„ç§ç±»æ•°</strong>ï¼ˆä¸æ˜¯æ€»é•¿åº¦ï¼ï¼‰</p>
<p><code>t = "AAB"</code>Â â†’ æœ‰Â <code>'A'</code>Â å’ŒÂ <code>'B'</code>Â ä¸¤ç§ â†’Â <code>less = 2</code></p>
<p>æ¯å½“æŸä¸ªå­—ç¬¦çš„éœ€æ±‚ä»Â <code>&gt;0</code>Â å˜æˆÂ <code>0</code>ï¼Œ<code>less--</code></p>
<p>å½“Â <code>less === 0</code>Â â†’ æ‰€æœ‰å­—ç¬¦éƒ½æ»¡è¶³äº†ï¼ğŸ‰</p>
<hr/>
<h2 data-id="heading-5">ğŸš¶ ç®—æ³•æ­¥éª¤è¯¦è§£ï¼ˆé…åˆä½ çš„ä»£ç ï¼‰</h2>
<h3 data-id="heading-6">ç¬¬ä¸€æ­¥ï¼šåˆå§‹åŒ–éœ€æ±‚</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> c <span class="hljs-keyword">of</span> t) {
    <span class="hljs-keyword">const</span> code = c.<span class="hljs-title function_">codePointAt</span>(<span class="hljs-number">0</span>);
    <span class="hljs-keyword">if</span> (cnt[code] === <span class="hljs-number">0</span>) less++; <span class="hljs-comment">// ç¬¬ä¸€æ¬¡è§åˆ°è¿™ä¸ªå­—ç¬¦</span>
    cnt[code]++;                 <span class="hljs-comment">// è®°å½•éœ€è¦å¤šå°‘ä¸ª</span>
}
</code></pre>
<p>âœ… æ­¤æ—¶Â <code>cnt</code>Â å­˜çš„æ˜¯â€œè¿˜éœ€è¦å¤šå°‘â€ï¼Œ<code>less</code>Â æ˜¯â€œè¿˜å·®å‡ ç§â€ã€‚</p>
<hr/>
<h3 data-id="heading-7">ç¬¬äºŒæ­¥ï¼šæ»‘åŠ¨çª—å£éå†Â <code>s</code></h3>
<h4 data-id="heading-8">å³æŒ‡é’ˆæ‰©å±•ï¼ˆåƒè¿›æ–°å­—ç¬¦ï¼‰</h4>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> c = s[right].<span class="hljs-title function_">codePointAt</span>(<span class="hljs-number">0</span>);
cnt[c]--; <span class="hljs-comment">// æä¾›äº†ä¸€ä¸ª cï¼Œæ‰€ä»¥éœ€æ±‚å‡å°‘</span>
<span class="hljs-keyword">if</span> (cnt[c] === <span class="hljs-number">0</span>) less--; <span class="hljs-comment">// å¦‚æœåˆšå¥½æ»¡è¶³ï¼Œç§ç±»æ•°å‡ä¸€</span>
</code></pre>
<h4 data-id="heading-9">å·¦æŒ‡é’ˆæ”¶ç¼©ï¼ˆå½“çª—å£åˆæ³•æ—¶ï¼‰</h4>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">while</span> (less === <span class="hljs-number">0</span>) { <span class="hljs-comment">// å½“å‰çª—å£å·²è¦†ç›– t</span>
    <span class="hljs-comment">// æ›´æ–°ç­”æ¡ˆï¼šå¦‚æœå½“å‰çª—å£æ›´çŸ­ï¼Œå°±è®°å½•</span>
    <span class="hljs-keyword">if</span> (right - left &lt; ansRight - ansLeft) {
        ansLeft = left;
        ansRight = right;
    }

    <span class="hljs-comment">// å°è¯•ç§»é™¤å·¦è¾¹å­—ç¬¦</span>
    <span class="hljs-keyword">const</span> x = s[left].<span class="hljs-title function_">codePointAt</span>(<span class="hljs-number">0</span>);
    <span class="hljs-keyword">if</span> (cnt[x] === <span class="hljs-number">0</span>) less++; <span class="hljs-comment">// ç§»é™¤åï¼Œx ä¸å¤Ÿäº†ï¼</span>
    cnt[x]++; <span class="hljs-comment">// éœ€æ±‚å¢åŠ ï¼ˆå› ä¸ºå°‘äº†ä¸€ä¸ªï¼‰</span>
    left++;
}
</code></pre>
<blockquote>
<p>é‡ç‚¹ï¼šåªæœ‰å½“Â <code>cnt[x] === 0</code>Â æ—¶ï¼Œç§»é™¤å®ƒæ‰ä¼šå¯¼è‡´â€œä¸æ»¡è¶³â€ã€‚<br/>
å› ä¸ºå¦‚æœÂ <code>cnt[x] &lt; 0</code>ï¼ˆå†—ä½™ï¼‰ï¼Œç§»é™¤ä¸€ä¸ªæ²¡å…³ç³»ï¼</p>
</blockquote>
<hr/>
<h3 data-id="heading-10">ç¬¬ä¸‰æ­¥ï¼šè¿”å›ç»“æœ</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">return</span> ansLeft &lt; <span class="hljs-number">0</span> ? <span class="hljs-string">""</span> : s.<span class="hljs-title function_">substring</span>(ansLeft, ansRight + <span class="hljs-number">1</span>);
</code></pre>
<ul>
<li>å¦‚æœä»æœªæ‰¾åˆ°åˆæ³•çª—å£ï¼ˆ<code>ansLeft</code>Â è¿˜æ˜¯ -1ï¼‰ï¼Œè¿”å›Â <code>""</code></li>
<li>å¦åˆ™è¿”å›Â <code>[ansLeft, ansRight]</code>Â çš„å­ä¸²</li>
</ul>
<hr/>
<h2 data-id="heading-11">ğŸŒ° ä¸¾ä¸ªå®Œæ•´ä¾‹å­</h2>
<p><code>s = "ADOBECODEBANC"</code>,Â <code>t = "ABC"</code></p>
<ol>
<li>
<p>åˆå§‹åŒ–Â <code>cnt</code>:<br/>
<code>cnt[65]=1 ('A'), cnt[66]=1 ('B'), cnt[67]=1 ('C')</code>, å…¶ä»–ä¸º 0<br/>
<code>less = 3</code></p>
</li>
<li>
<p>å³æŒ‡é’ˆç§»åŠ¨ï¼š</p>
<ul>
<li><code>'A'</code>Â â†’Â <code>cnt[65]=0</code>Â â†’Â <code>less=2</code></li>
<li><code>'D','O','B'</code>Â â†’Â <code>cnt[66]=0</code>Â â†’Â <code>less=1</code></li>
<li><code>'E','C'</code>Â â†’Â <code>cnt[67]=0</code>Â â†’Â <code>less=0</code>Â âœ… çª—å£Â <code>"ADOBEC"</code>Â åˆæ³•ï¼</li>
</ul>
</li>
<li>
<p>å¼€å§‹æ”¶ç¼©å·¦è¾¹ç•Œï¼š</p>
<ul>
<li>ç§»é™¤Â <code>'A'</code>Â â†’Â <code>cnt[65]=1</code>Â â†’Â <code>less=1</code>Â âŒ åœæ­¢æ”¶ç¼©</li>
<li>å½“å‰æœ€çŸ­é•¿åº¦ = 6</li>
</ul>
</li>
<li>
<p>ç»§ç»­å³ç§»â€¦â€¦ç›´åˆ°æ‰¾åˆ°Â <code>"BANC"</code>ï¼ˆé•¿åº¦ 4ï¼‰ï¼Œæ›´æ–°ç­”æ¡ˆã€‚</p>
</li>
</ol>
<p>æœ€ç»ˆè¿”å›Â <code>"BANC"</code>ã€‚</p>
<hr/>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">/**
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} <span class="hljs-variable">s</span>
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} <span class="hljs-variable">t</span>
 * <span class="hljs-doctag">@return</span> {<span class="hljs-type">string</span>}
 */</span>
<span class="hljs-keyword">var</span> minWindow = <span class="hljs-keyword">function</span>(<span class="hljs-params">s, t</span>) {
    <span class="hljs-comment">// é¢‘æ¬¡æ•°ç»„ï¼ŒASCII å…± 128 ä¸ªå­—ç¬¦</span>
    <span class="hljs-keyword">const</span> cnt = <span class="hljs-title class_">Array</span>(<span class="hljs-number">128</span>).<span class="hljs-title function_">fill</span>(<span class="hljs-number">0</span>);
    <span class="hljs-keyword">let</span> less = <span class="hljs-number">0</span>; <span class="hljs-comment">// è¡¨ç¤ºè¿˜æœ‰å¤šå°‘ç§å­—ç¬¦æœªæ»¡è¶³éœ€æ±‚</span>

    <span class="hljs-comment">// åˆå§‹åŒ– t ä¸­æ¯ä¸ªå­—ç¬¦çš„éœ€æ±‚</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> c <span class="hljs-keyword">of</span> t) {
        <span class="hljs-keyword">const</span> code = c.<span class="hljs-title function_">codePointAt</span>(<span class="hljs-number">0</span>);
        <span class="hljs-keyword">if</span> (cnt[code] === <span class="hljs-number">0</span>) {
            less++; 
        }
        cnt[code]++;
    }

    <span class="hljs-keyword">const</span> m = s.<span class="hljs-property">length</span>;
    <span class="hljs-keyword">let</span> ansLeft = -<span class="hljs-number">1</span>;
    <span class="hljs-keyword">let</span> ansRight = m; <span class="hljs-comment">// åˆå§‹è®¾ä¸ºä¸€ä¸ªè¾ƒå¤§å€¼ï¼ˆé•¿åº¦ m ä¸å¯èƒ½ï¼‰</span>
    <span class="hljs-keyword">let</span> left = <span class="hljs-number">0</span>;

    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> right = <span class="hljs-number">0</span>; right &lt; m; right++) {
        <span class="hljs-keyword">const</span> c = s[right].<span class="hljs-title function_">codePointAt</span>(<span class="hljs-number">0</span>);
        cnt[c]--;

        <span class="hljs-comment">// å¦‚æœæŸä¸ªå­—ç¬¦åˆšå¥½è¢«â€œè¡¥è¶³â€ï¼ˆä»æ­£å˜0ï¼‰ï¼Œè¯´æ˜è¿™ç§å­—ç¬¦è¾¾æ ‡äº†</span>
        <span class="hljs-keyword">if</span> (cnt[c] === <span class="hljs-number">0</span>) {
            less--;
        }

        <span class="hljs-comment">// å½“æ‰€æœ‰å­—ç¬¦éƒ½æ»¡è¶³ï¼ˆless === 0ï¼‰ï¼Œå°è¯•æ”¶ç¼©å·¦è¾¹ç•Œ</span>
        <span class="hljs-keyword">while</span> (less === <span class="hljs-number">0</span>) {
            <span class="hljs-comment">// æ›´æ–°æœ€å°çª—å£</span>
            <span class="hljs-keyword">if</span> (right - left &lt; ansRight - ansLeft) {
                ansLeft = left;
                ansRight = right;
            }

            <span class="hljs-keyword">const</span> x = s[left].<span class="hljs-title function_">codePointAt</span>(<span class="hljs-number">0</span>);
            <span class="hljs-comment">// å¦‚æœç§»é™¤ s[left] ä¼šå¯¼è‡´æŸç§å­—ç¬¦ä¸è¶³</span>
            <span class="hljs-keyword">if</span> (cnt[x] === <span class="hljs-number">0</span>) {
                less++; <span class="hljs-comment">// ç¼ºå¤±ä¸€ç§å­—ç¬¦</span>
            }
            cnt[x]++;
            left++;
        }
    }

    <span class="hljs-keyword">return</span> ansLeft &lt; <span class="hljs-number">0</span> ? <span class="hljs-string">""</span> : s.<span class="hljs-title function_">substring</span>(ansLeft, ansRight + <span class="hljs-number">1</span>);
};
</code></pre>
<h2 data-id="heading-12">ä¸ºä»€ä¹ˆè¿™ä¸ªæ–¹æ³•é«˜æ•ˆï¼Ÿ</h2>
<ul>
<li><strong>æ—¶é—´å¤æ‚åº¦</strong>ï¼šO(n) â€”â€” æ¯ä¸ªå­—ç¬¦æœ€å¤šè¢«è®¿é—®ä¸¤æ¬¡ï¼ˆå³æŒ‡é’ˆä¸€æ¬¡ï¼Œå·¦æŒ‡é’ˆä¸€æ¬¡ï¼‰</li>
<li><strong>ç©ºé—´å¤æ‚åº¦</strong>ï¼šO(1) â€”â€”Â <code>cnt</code>Â å›ºå®š 128 å¤§å°</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[CSS-æµå…‰ç‰¹æ•ˆ]]></title>    <link>https://juejin.cn/post/7604694326518825011</link>    <guid>https://juejin.cn/post/7604694326518825011</guid>    <pubDate>2026-02-10T03:00:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604694326518825011" data-draft-id="7604672395627642907" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="CSS-æµå…‰ç‰¹æ•ˆ"/> <meta itemprop="keywords" content="å‰ç«¯,CSS,HTML"/> <meta itemprop="datePublished" content="2026-02-10T03:00:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å‘ç°ä¸€åªå¤§å‘†ç“œ"/> <meta itemprop="url" content="https://juejin.cn/user/180747382561607"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            CSS-æµå…‰ç‰¹æ•ˆ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/180747382561607/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å‘ç°ä¸€åªå¤§å‘†ç“œ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T03:00:46.000Z" title="Tue Feb 10 2026 03:00:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">å‰è¨€</h3>
<p>åœ¨ UI è®¾è®¡ä¸­ï¼Œåˆç†çš„åŠ¨æ•ˆèƒ½æå¤§åœ°æå‡äº§å“çš„ç§‘æŠ€æ„Ÿä¸äº¤äº’ä½“éªŒã€‚æœ¬æ–‡å°†åˆ†äº«ä¸¤ç§é«˜é¢‘ä½¿ç”¨çš„æµå…‰ç‰¹æ•ˆï¼š<strong>æ—‹è½¬è¾¹æ¡†æµå…‰</strong>ï¼ˆå¸¸ç”¨äº VIP ä¼šå‘˜å¡ç‰‡ï¼‰ä¸<strong>çº¿æ€§æ‰«ææµå…‰</strong>ï¼ˆå¸¸ç”¨äºåŠ è½½çŠ¶æ€æˆ–æŒ‰é’®é«˜äº®ï¼‰ã€‚</p>
<h2 data-id="heading-1">ä¸€ã€ æ—‹è½¬è¾¹æ¡†æµå…‰ (Border Rotating Glow)</h2>
<h3 data-id="heading-2">1. å®ç°æ•ˆæœï¼š</h3>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9b2f81d62c5745ebb35576b571c3bdaf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-R546w5LiA5Y-q5aSn5ZGG55Oc:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771297249&amp;x-signature=Hq4jfP1Fbb0D7jXRCLxuejFOgy8%3D" alt="æµå…‰è¾¹æ¡†.gif" loading="lazy"/></p>
<h3 data-id="heading-3">2. å®ç°åŸç†ï¼šèƒŒæ™¯æ—‹è½¬è£å‰ª</h3>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/37cb9aa5de494dcd9a5aee5737805786~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-R546w5LiA5Y-q5aSn5ZGG55Oc:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771297249&amp;x-signature=I8IFfEt%2BuobW1mdR%2BG1fcjhkZXE%3D" alt="æµå…‰è¾¹æ¡†åŸç†.gif" loading="lazy"/></p>
å¾ˆå¤šåŒå­¦ç¬¬ä¸€ååº”æ˜¯ä¼šå°è¯•ç›´æ¥ç»™ `border` è®¾ç½®æ¸å˜ï¼Œä½† CSS åŸç”Ÿ `border` å¹¶ä¸æ”¯æŒåŠ¨ç”»æ—‹è½¬ã€‚ 
<p><strong>æ ¸å¿ƒé»‘ç§‘æŠ€</strong>ï¼š</p>
<ol>
<li>åº•å±‚æ”¾ä¸€ä¸ª<strong>å·¨å¤§çš„ã€æ—‹è½¬çš„æ¸å˜è‰²å—</strong>ï¼ˆé€šå¸¸ç”¨ä¼ªå…ƒç´ å®ç°ï¼‰ã€‚</li>
<li>ä¸Šå±‚ç›–ä¸€ä¸ª<strong>ç•¥å°çš„å®¹å™¨</strong>ï¼ˆæŒ‰é’®ä¸»ä½“ï¼‰ã€‚</li>
<li>çˆ¶å®¹å™¨è®¾ç½® <code>overflow: hidden</code>ã€‚ è¿™æ ·ï¼Œè½¬åŠ¨çš„æ¸å˜è‰²å—è¢«è£å‰ªåï¼Œéœ²å‡ºçš„é‚£ä¸€åœˆè¾¹ç¼˜çœ‹èµ·æ¥å°±åƒæµå…‰åœ¨æ¸¸èµ°ã€‚</li>
</ol>
<h3 data-id="heading-4">3. å®ç°ä»£ç </h3>
<pre><code class="hljs language-HTML" lang="HTML"><span class="hljs-comment">&lt;!-- å¤–å±‚å®¹å™¨åŒ…è£¹æŒ‰é’® --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"glow-wrapper"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"glow-button"</span>&gt;</span>æµå…‰æŒ‰é’®<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>


/* å¤–å±‚å®¹å™¨ï¼šè´Ÿè´£æµå…‰æ•ˆæœ */
.glow-wrapper {
  position: relative; 
  display: inline-block;
  padding: 4px; /* æ§åˆ¶æµå…‰è¾¹æ¡†çš„å®½åº¦ */
  border-radius: 12px;
  overflow: hidden; /* å…³é”®ï¼šè£å‰ªæ—‹è½¬çš„æ¸å˜å±‚ */
}

/* ä¼ªå…ƒç´ ï¼šæ—‹è½¬çš„æ¸å˜æ¡† */
.glow-wrapper::before {
  content: '';
  position: absolute;
  top: -2px;
  left: -2px;
  right: -2px;
  bottom: -2px;
  background: linear-gradient(
    45deg,
    #0066ff,
    #00ccff,
    #ccff00,
    #ff9900,
    #ff00cc
  );
  border-radius: 12px;
  z-index: -1;
  animation: rotateGlow 3s linear infinite;
}

/* å†…éƒ¨çœŸå®æŒ‰é’® */
.glow-button {
  height: 42px;
  width: 122px;
  line-height: 42px;
  font-size: 18px;
  color: white;
  background: #121212;
  border-radius: 8px; /* ç•¥å°äº wrapper çš„åœ†è§’ */
}
@keyframes rotateGlow {
  0% {
    transform: rotate(0deg);
  }
  40% {
    transform: rotate(180deg);
  }
  60% {
    transform: rotate(180deg);
  }
  100% {
    transform: rotate(360deg);
  }
}
</code></pre>
<hr/>
<h2 data-id="heading-5">äºŒã€ çº¿æ€§æ‰«ææµå…‰ (Linear Scanning Glow)</h2>
<h3 data-id="heading-6">1. å®ç°æ•ˆæœï¼š</h3>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ddf3f5700fc34a3294b5bd9e47c186f3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-R546w5LiA5Y-q5aSn5ZGG55Oc:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771297249&amp;x-signature=MTdoDA5oYKlv3HLfoY2uXm14UGU%3D" alt="æ‰«ææµå…‰.gif" loading="lazy"/></p>
### 2. å®ç°åŸç†ï¼šèƒŒæ™¯ä½ç§»
<p>è¿™ç§æ•ˆæœæ¨¡æ‹Ÿäº†å…‰æŸæ‰«è¿‡ç‰©ä½“çš„è§†è§‰æ„Ÿï¼Œå¸¸ç”¨äºéª¨æ¶å±æˆ–é«˜çº§æŒ‰é’®ã€‚</p>
<p><strong>æ ¸å¿ƒæ€è·¯</strong>ï¼š</p>
<ul>
<li><strong>æ¸å˜è®¾è®¡</strong>ï¼šè®¾è®¡ä¸€ä¸ªâ€œæš—-äº®-æš—â€çš„ <code>linear-gradient</code>ã€‚</li>
<li><strong>å°ºå¯¸æ”¾å¤§</strong>ï¼šå°† <code>background-size</code> è®¾ä¸º <code>200%</code> æˆ–æ›´å¤§ï¼Œè®©â€œäº®ç‚¹â€éšè—åœ¨è§†å£ä¹‹å¤–ã€‚</li>
<li><strong>ä½ç½®åŠ¨ç”»</strong>ï¼šé€šè¿‡æ”¹å˜ <code>background-position</code>ï¼Œè®©äº®è‰²æ¡ä»å·¦è‡³å³æ°´å¹³ç©¿è¿‡ã€‚</li>
</ul>
<h3 data-id="heading-7">3. å®ç°ä»£ç </h3>
<pre><code class="hljs language-HTML" lang="HTML"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"glow-wrapper"</span>&gt;</span>æ‰«ææµå…‰<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

.glow-wrapper {
  position: relative;
  padding: 20px 40px; /* è¾¹æ¡†åšåº¦ */
  color: white;
  border-radius: 10px;
  font-weight: 800;
  background: linear-gradient(90deg, transparent, #00dbde, transparent);
  background-size: 200% 100%;
  animation: scan 2s linear infinite;
}

@keyframes scan {
  0% {
    background-position: -200% 0%;
  }
  100% {
    background-position: 200% 0%;
  }
}

</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[uToolsï¼šä¸€ä¸ªèƒ½è®©ä½ å¸è½½å‡ åä¸ªè½¯ä»¶çš„æ•ˆç‡â€œå¤–æŒ‚â€]]></title>    <link>https://juejin.cn/post/7604690250364207113</link>    <guid>https://juejin.cn/post/7604690250364207113</guid>    <pubDate>2026-02-10T01:50:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604690250364207113" data-draft-id="7604690250364190729" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="uToolsï¼šä¸€ä¸ªèƒ½è®©ä½ å¸è½½å‡ åä¸ªè½¯ä»¶çš„æ•ˆç‡â€œå¤–æŒ‚â€"/> <meta itemprop="keywords" content="åç«¯,Java,ç¨‹åºå‘˜"/> <meta itemprop="datePublished" content="2026-02-10T01:50:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="SimonKing"/> <meta itemprop="url" content="https://juejin.cn/user/4001878056904584"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            uToolsï¼šä¸€ä¸ªèƒ½è®©ä½ å¸è½½å‡ åä¸ªè½¯ä»¶çš„æ•ˆç‡â€œå¤–æŒ‚â€
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4001878056904584/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    SimonKing
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T01:50:53.000Z" title="Tue Feb 10 2026 01:50:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>å…³æ³¨æˆ‘çš„å…¬ä¼—å·ï¼šã€ç¼–ç¨‹æœèŠ±å¤•æ‹¾ã€‘ï¼Œå¯è·å–é¦–å‘å†…å®¹ã€‚</p>
</blockquote>
<h2 data-id="heading-0">01 å¼•è¨€</h2>
<p>ä½ æ˜¯å¦åŒå€¦äº†åœ¨æ— æ•°è½¯ä»¶é—´æ¥å›åˆ‡æ¢ï¼Ÿæ˜¯å¦å¸Œæœ›æœ‰ä¸€ä¸ªâ€œä¸‡èƒ½å…¥å£â€ï¼Œèƒ½ç¬é—´å“åº”æ‰€æœ‰ä¸´æ—¶éœ€æ±‚ï¼Ÿè¯•è¯• <code>uTools</code>ï¼Œå®ƒä¸åªæ˜¯ä¸€ç§å·¥å…·ï¼Œæ›´æ˜¯ä¸€ç§å…¨æ–°çš„æ•ˆç‡å“²å­¦ã€‚é€šè¿‡ä¸€ä¸ªç®€å•çš„æœç´¢æ¡†å’Œæ™ºèƒ½é¢æ¿ï¼Œå®ƒå°†æµ·é‡æ’ä»¶èå…¥ä½ çš„æ¯ä¸€æ¬¡ç‚¹å‡»å’Œé€‰æ‹©ï¼Œè®©å·¥å…·ä¸»åŠ¨ä¸ºä½ æœåŠ¡ï¼ŒçœŸæ­£å®ç°â€œä¸€åˆ‡çš†æ’ä»¶â€ï¼Œæ‰“é€ ä½ ç‹¬ä¸€æ— äºŒçš„æ•°å­—å·¥ä½œæµã€‚</p>
<h2 data-id="heading-1">02 ç®€ä»‹</h2>
<p><code>uTools</code>å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªå¯é«˜åº¦è‡ªå®šä¹‰çš„æ•ˆç‡å¯åŠ¨å™¨ã€‚å®ƒæœ¬èº«éå¸¸è½»å·§ï¼Œä½†é€šè¿‡å®‰è£…ä¸°å¯Œçš„æ’ä»¶ï¼Œå°±èƒ½ç¬é—´å˜æˆä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„å…¨èƒ½åŠ©æ‰‹ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9d4c9f09b8dd4fb497496412c115dc8a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2ltb25LaW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771293053&amp;x-signature=79tAzP5GPxfCTfVRigZg0%2F9h1f8%3D" alt="" loading="lazy"/></p>
<p>å…¶æ ¸å¿ƒæ“ä½œæ–¹å¼ï¼š</p>
<ul>
<li><strong>ä¸‡èƒ½æœç´¢æ¡†</strong>ï¼šé€šè¿‡å¿«æ·é”®ï¼ˆé»˜è®¤ <code>Alt + Space</code>ï¼‰å¿«é€Ÿå‘¼å‡ºæœç´¢æ¡†ï¼Œè¾“å…¥å…³é”®è¯å³å¯æœç´¢æœ¬åœ°æ–‡ä»¶ã€æ‰“å¼€è½¯ä»¶ï¼Œæˆ–ç›´æ¥ä½¿ç”¨å„ç§æ’ä»¶å·¥å…·ã€‚</li>
<li><strong>è¶…çº§é¢æ¿</strong>ï¼šåœ¨ä»»æ„ç•Œé¢ï¼Œé•¿æŒ‰é¼ æ ‡ä¸­é”®ï¼ˆæˆ–è‡ªå®šä¹‰é”®ï¼‰å³å¯å”¤å‡ºä¸€ä¸ªåœ†å½¢èœå•ï¼Œé‡Œé¢æ˜¯å¸¸ç”¨çš„å·¥å…·ï¼Œæ–¹ä¾¿éšæ—¶å–ç”¨ã€‚</li>
<li><strong>æ‚¬æµ®çƒ</strong>ï¼šä¸€ä¸ªå¯ä»¥å¸é™„åœ¨å±å¹•è¾¹ç¼˜çš„å°çƒï¼Œæ–¹ä¾¿å¿«é€Ÿè®¿é—®ã€‚</li>
</ul>
<p>ç›®å‰çš„ç‰ˆæœ¬å·²ç»æ›´æ–°åˆ°<code>v7.5.1</code>äº†ï¼Œåˆ†åˆ«æ”¯æŒ <code>Windows</code>, <code>macOS</code>, <code>Linux</code>ä¸‰å¤§å¹³å°ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8c1f4ea9a99f42d0bfdd6bc12431bb71~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2ltb25LaW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771293053&amp;x-signature=M2c9fGmPrggn8x6pQClV4cZJmjM%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-2">03 ä½¿ç”¨</h2>
<p>æˆ‘ä»¬å¯ä»¥åœ¨æ’ä»¶å¸‚åœºä¸Šéšæ„ä¸‹è½½æ’ä»¶ã€‚æˆªæ­¢ç›®å‰æ’ä»¶å¸‚åœºå·²ç»æ”¶å½•äº†3109ä¸ªæ’ä»¶ã€‚</p>
<p>é€šè¿‡æ‚¬æµ®çƒæˆ–è€…å¿«æ·é”®<code>Alt + ç©ºæ ¼</code>å¿«é€Ÿå”¤èµ·ï¼</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f8fdcc5dcac24bc6bf58ec64a2198f6e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2ltb25LaW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771293053&amp;x-signature=GlglGp5xnqlr8dDjJ8J91%2BiXiQE%3D" alt="" loading="lazy"/></p>
<p>æˆ‘ä»¬ç®€å•çš„ä»‹ç»å‡ ä¸ªæ’ä»¶ã€‚</p>
<h3 data-id="heading-3">3.1 å±å¹•å–è‰²å·¥å…·</h3>
<p>ä»€ä¹ˆæ—¶å€™ç”¨å‘¢ï¼Ÿå†™é¡µé¢æ ·å¼çš„æ—¶å€™ï¼Œè®¾è®¡åŸå‹é‡Œé¢å¦‚æœæ²¡æœ‰ç»™å‡ºé¢œè‰²çš„å€¼ï¼Œå°±éœ€è¦æˆ‘ä»¬é€šè¿‡å–è‰²å·¥å…·è·å–ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b0d2389bef464a51b260adc58ad5062d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2ltb25LaW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771293053&amp;x-signature=DFC8bkweibNPGZQ6rXLL86PV01M%3D" alt="" loading="lazy"/></p>
<p>ç±»ä¼¼é¡¹ç›®ä¸­çš„è¿™ç§åº•è‰²ï¼Œæˆ‘ä»¬åªèƒ½å–è‰²æ¥è§£å†³ã€‚</p>
<p>å½“ç„¶æ­£å¸¸çš„è®¾è®¡éƒ½æœ‰ä¸“é—¨çš„<code>UI</code>è®¾è®¡ï¼Œä¼šæ ‡æ³¨çš„éå¸¸è¯¦ç»†ã€‚ä½†æ˜¯å¯¹äºæˆ‘ä»¬çš„è‡ªå·±çš„ä¸€äº›é¡¹ç›®ï¼Œæ ·å¼è¦æ±‚æ²¡æœ‰é‚£ä¹ˆé«˜çš„ï¼Œåªèƒ½é æˆ‘ä»¬è‡ªå·±æ‰‹æ“äº†ã€‚</p>
<p>æˆ‘ä»¬éœ€è¦å‘¼èµ·æœç´¢æ¡†ï¼Œç„¶åæœç´¢è‡ªå·±çš„å–è‰²å·¥å…·å³å¯ã€‚ç•Œé¢ä¼šè‡ªåŠ¨å±•ç¤ºå¸¸ç”¨çš„å·¥å…·ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/780fcb2a29ba40d5acafcb40b4f53356~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2ltb25LaW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771293053&amp;x-signature=zkpwi2hSvKavtfKmTu8wbluGpKs%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/50f2fab6a9444f13b0806d1b17ed79c6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2ltb25LaW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771293053&amp;x-signature=%2BxQnhzGf%2BWhbarZy9Rjsn%2BbBU0w%3D" alt="" loading="lazy"/></p>
<p>é€‰æ‹©å–è‰²å·¥å…·ï¼Œç‚¹å‡»å¼€å§‹å–è‰²ã€‚ç‚¹å‡»å³å¯å®Œæˆå–è‰²</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a1d10a0c9d1b42c8820a9f63fd94c203~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2ltb25LaW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771293053&amp;x-signature=15qYmBfyCr78X5YkqTScNpFFIRA%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-4">3.2 Tree</h3>
<p>è¯»å–ç›®å½•ç»“æ„ç”Ÿæˆå¦‚ä¸‹æ‰€ç¤ºçš„æ ‘çŠ¶å›¾æ–‡æœ¬, æ¨¡ä»¿<code>tree</code>æ–¹æ³•, å¹¶æä¾›è‡ªç”±å®šä¹‰æ–‡ä»¶å¤¹ç»“æ„çš„åŠŸèƒ½.</p>
<p>å½“æˆ‘ä»¬å†™æ–‡ç« çš„æ—¶å€™ï¼Œéœ€å±•ç¤ºé¡¹ç›®ç»“æ„çš„æ—¶å€™ï¼Œæˆ‘ä»¬åªéœ€è¦ç»™åˆ°æ–‡ä»¶å¤¹å³å¯ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0a3831a87ffb48bf91b9073038be8eea~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2ltb25LaW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771293053&amp;x-signature=KrtWL0cMRTeNjdn9DPms6anpcGI%3D" alt="" loading="lazy"/></p>
<p>æ— è®ºæ˜¯å†™æ–‡ç« ï¼Œè¿˜æ˜¯æŸ¥çœ‹ç›®å½•ç»“æ„éƒ½éå¸¸å‹å¥½ã€‚</p>
<h3 data-id="heading-5">3.3 ç¨‹åºå‘˜å¿…å¤‡</h3>
<p><code>ctool</code>æ”¶é›†äº†ç¨‹åºå‘˜å¸¸ç”¨çš„ä¸€äº›å·¥å…·ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2c533980bd7c482391b292b0c5939d48~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2ltb25LaW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771293053&amp;x-signature=gMUrTqygbCTPFA3pEUPaJyxaYyk%3D" alt="" loading="lazy"/></p>
<p>å®˜ç½‘åœ°å€ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fctool.dev%2F" target="_blank" title="https://ctool.dev/" ref="nofollow noopener noreferrer">ctool.dev/</a></p>
<h3 data-id="heading-6">3.4 æˆªå›¾æ‚¬æµ®</h3>
<p>æˆªå›¾æ‚¬æµ®ç”¨åœ¨è€å¸ˆå¤šåª’ä½“è®²è¯¾çš„æ¯”è¾ƒå¤šï¼Œæˆªå–å›¾ç‰‡ç„¶åç»™å¤§å®¶åˆ†äº«å†…å®¹ã€‚æ™®é€šçš„æˆªå›¾å·¥å…·ï¼Œæˆªå®Œå›¾ä¹‹åï¼Œå›¾ç‰‡éƒ½åœ¨å‰ªåˆ‡æ¿ï¼Œè€Œæˆªå›¾æ‚¬æµ®åˆ™åœç•™åœ¨å½“å‰é¡µé¢ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/362284ba9cd542c09c120df83bfccbda~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2ltb25LaW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771293053&amp;x-signature=UV6OIOdU9H40TBmXbg8c2bef3G0%3D" alt="" loading="lazy"/></p>
<p><strong>æ•ˆæœ</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5c6c96d5018542a28b4568456cdcedb7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2ltb25LaW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771293053&amp;x-signature=aWGemd0gnl5AuELGnTedE8TXnv0%3D" alt="" loading="lazy"/></p>
<p>é‡Œé¢çš„æ’ä»¶è¿˜æœ‰å¾ˆå¤šï¼Œå¤§å®¶å¯ä»¥æ ¹æ®è‡ªå·±çš„å–œå¥½éšæ„å®‰è£…ã€‚</p>
<h2 data-id="heading-7">04 å°ç»“</h2>
<p><code>uTools</code>ä»¥ç›’å­çš„å½¢å¼å±•ç¤ºç»™å¤§å®¶ï¼Œå·¥å…·ä»¥æ’ä»¶çš„æ–¹å¼ç»™å¤§å®¶ä½¿ç”¨ã€‚çœŸçš„æ˜¯æ–¹ä¾¿å¾ˆå¤šã€‚å…è´¹ç‰ˆçš„ä»…æ”¯æŒ10ä¸ªæ’ä»¶ï¼Œä½†æ˜¯è¶³å¤Ÿç”¨äº†ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a0b8d687f2604d5d9fe94413db84b0e2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2ltb25LaW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771293053&amp;x-signature=i4yZmfdUuwl7FR7%2FYfBKZ2JTNuo%3D" alt="" loading="lazy"/></p>
<p>æƒ³è¦å…é™åˆ¶çš„å¯ä»¥ä½¿ç”¨ç±»ä¼¼çš„è½¯ä»¶:<code>rubick</code></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e5a4c877f79e4b41a26c111721a9ff11~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2ltb25LaW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771293053&amp;x-signature=VlxRyi%2BKfUu9%2Fq7Re3REKKz%2BY5U%3D" alt="" loading="lazy"/></p>
<p><code>GitHub</code>åœ°å€ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FrubickCenter%2Frubick" target="_blank" title="https://github.com/rubickCenter/rubick" ref="nofollow noopener noreferrer">github.com/rubickCenteâ€¦</a></p>
<p>é‡Œé¢çš„æ’ä»¶æœ‰é™ï¼Œæ•´ä½“æ„Ÿè§‰æ²¡æœ‰<code>utools</code>é¡ºç•…ï¼Œä½†æ˜¯å®Œå…¨å¼€æºå…è´¹ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æ·±å…¥ç†è§£Goè¯­è¨€ç»“æ„ä½“æ ‡ç­¾ï¼šç”¨é€”ã€ç”¨æ³•ä¸æ³¨æ„äº‹é¡¹]]></title>    <link>https://juejin.cn/post/7604574877035216939</link>    <guid>https://juejin.cn/post/7604574877035216939</guid>    <pubDate>2026-02-09T16:18:41.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604574877035216939" data-draft-id="7604574877035200555" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æ·±å…¥ç†è§£Goè¯­è¨€ç»“æ„ä½“æ ‡ç­¾ï¼šç”¨é€”ã€ç”¨æ³•ä¸æ³¨æ„äº‹é¡¹"/> <meta itemprop="keywords" content="åç«¯,Go,é¢è¯•"/> <meta itemprop="datePublished" content="2026-02-09T16:18:41.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æˆ‘å«é»‘å¤§å¸…"/> <meta itemprop="url" content="https://juejin.cn/user/1678295463898875"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æ·±å…¥ç†è§£Goè¯­è¨€ç»“æ„ä½“æ ‡ç­¾ï¼šç”¨é€”ã€ç”¨æ³•ä¸æ³¨æ„äº‹é¡¹
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1678295463898875/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æˆ‘å«é»‘å¤§å¸…
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-09T16:18:41.000Z" title="Mon Feb 09 2026 16:18:41 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»13åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">æ·±å…¥ç†è§£Goè¯­è¨€ç»“æ„ä½“æ ‡ç­¾ï¼šç”¨é€”ã€ç”¨æ³•ä¸æ³¨æ„äº‹é¡¹</h2>
<p>åœ¨Goè¯­è¨€ä¸­ï¼Œç»“æ„ä½“ï¼ˆstructï¼‰æ˜¯ç”¨äºå°è£…æ•°æ®çš„æ ¸å¿ƒè¯­æ³•ï¼Œè€Œç»“æ„ä½“æ ‡ç­¾ï¼ˆStruct Tagï¼‰åˆ™æ˜¯é™„ç€åœ¨ç»“æ„ä½“å­—æ®µä¸Šçš„â€œéšå½¢å…ƒæ•°æ®â€â€”â€”å®ƒæœ¬èº«ä¸å‚ä¸ç¨‹åºçš„é€»è¾‘è¿è¡Œï¼Œä¹Ÿä¸ä¼šå½±å“å­—æ®µçš„å–å€¼å’Œèµ‹å€¼ï¼Œä½†åœ¨è¿è¡Œæ—¶å¯ä»¥é€šè¿‡**åå°„ï¼ˆreflectåŒ…ï¼‰**è¢«è¯»å–å’Œè§£æï¼Œè¿›è€Œå®ç°å„ç±»è‡ªåŠ¨åŒ–åŠŸèƒ½ã€‚</p>
<p>ç®€å•æ¥è¯´ï¼Œç»“æ„ä½“æ ‡ç­¾å°±åƒæ˜¯ç»™ç»“æ„ä½“çš„æ¯ä¸ªå­—æ®µâ€œè´´å°çº¸æ¡â€ï¼Œçº¸æ¡ä¸Šå†™ç€è¯¥å­—æ®µçš„é¢å¤–è¯´æ˜ï¼Œè¿™äº›è¯´æ˜åªæœ‰â€œå…·å¤‡é€è§†èƒ½åŠ›â€çš„åå°„æ‰èƒ½çœ‹åˆ°ï¼Œè€Œæ­£æ˜¯è¿™äº›â€œå°çº¸æ¡â€ï¼Œæ”¯æ’‘èµ·äº†Goè¯­è¨€ä¸­å¤§é‡ä¸»æµå·¥å…·åº“ï¼ˆå¦‚JSONåºåˆ—åŒ–ã€ORMæ¡†æ¶ã€å‚æ•°æ ¡éªŒåº“ï¼‰çš„æ ¸å¿ƒåŠŸèƒ½ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä»æœ¬è´¨ã€è¯­æ³•ã€æ ¸å¿ƒç”¨é€”ã€å®Œæ•´ç¤ºä¾‹ã€å¸¸è§è¯¯åŒºäº”ä¸ªç»´åº¦ï¼Œå…¨é¢æ‹†è§£ç»“æ„ä½“æ ‡ç­¾ï¼Œè®©ä½ æ—¢èƒ½æ‡‚åŸç†ï¼Œä¹Ÿèƒ½ç›´æ¥è½åœ°ä½¿ç”¨ã€‚</p>
<h3 data-id="heading-1">ä¸€ã€ç»“æ„ä½“æ ‡ç­¾çš„æœ¬è´¨ä¸åŸºç¡€è¯­æ³•</h3>
<h4 data-id="heading-2">1. æœ¬è´¨</h4>
<p>ç»“æ„ä½“æ ‡ç­¾æ˜¯<strong>å­—ç¬¦ä¸²å¸¸é‡</strong>ï¼Œé™„ç€åœ¨ç»“æ„ä½“å­—æ®µå£°æ˜çš„åæ–¹ï¼Œç”¨äºå­˜å‚¨è¯¥å­—æ®µçš„å…ƒæ•°æ®ï¼ˆæè¿°æ€§ä¿¡æ¯ï¼‰ã€‚å®ƒä¸å±äºç»“æ„ä½“å­—æ®µçš„ä¸€éƒ¨åˆ†ï¼Œç¼–è¯‘æœŸä¼šè¢«ä¿ç•™åœ¨äºŒè¿›åˆ¶æ–‡ä»¶ä¸­ï¼Œè¿è¡Œæ—¶é€šè¿‡åå°„åŒ…çš„ç›¸å…³æ–¹æ³•ï¼ˆå¦‚Tag.Get()ï¼‰è¯»å–ï¼Œè¿›è€Œå®ç°â€œæ ¹æ®å…ƒæ•°æ®è‡ªåŠ¨å¤„ç†å­—æ®µâ€çš„é€»è¾‘ã€‚</p>
<p>æ ¸å¿ƒç‰¹ç‚¹ï¼šæ— ä¾µå…¥æ€§ï¼ˆä¸ä¿®æ”¹å­—æ®µæœ¬èº«çš„åŠŸèƒ½ï¼‰ã€å¯æ‰©å±•æ€§ï¼ˆå¯è‡ªå®šä¹‰æ ‡ç­¾é”®å€¼å¯¹ï¼‰ã€ä»…èƒ½é€šè¿‡åå°„è¯»å–ï¼ˆæ™®é€šä»£ç æ— æ³•ç›´æ¥è®¿é—®ï¼‰ã€‚</p>
<h4 data-id="heading-3">2. åŸºç¡€è¯­æ³•ï¼ˆå¿…è®°ï¼Œé¿å…è¸©å‘ï¼‰</h4>
<p>ç»“æ„ä½“æ ‡ç­¾çš„è¯­æ³•æœ‰ä¸¥æ ¼è§„èŒƒï¼Œå†™é”™ä¼šå¯¼è‡´åå°„æ— æ³•è¯»å–ï¼Œä¸”ç¼–è¯‘æœŸä¸ä¼šæŠ¥é”™ï¼ˆææ˜“æ’æŸ¥ï¼‰ï¼Œæ ¸å¿ƒè§„åˆ™å¦‚ä¸‹ï¼š</p>
<ul>
<li>
<p>æ ‡ç­¾å¿…é¡»ç”¨ <strong>åå¼•å·ï¼ˆ`ï¼‰</strong> åŒ…è£¹ï¼ˆä¸èƒ½ç”¨åŒå¼•å·""æˆ–å•å¼•å·''ï¼‰ï¼Œå¦åˆ™ä¼šè¢«è§£æä¸ºæ™®é€šå­—ç¬¦ä¸²ï¼Œè€Œéæ ‡ç­¾ã€‚</p>
</li>
<li>
<p>æ ‡ç­¾å†…éƒ¨é‡‡ç”¨ <strong>é”®å€¼å¯¹</strong> æ ¼å¼ï¼Œæ ¼å¼ä¸ºï¼š<code>é”®1:"å€¼1" é”®2:"å€¼2" ...</code>ï¼ˆé”®ä¸å€¼ä¹‹é—´ç”¨å†’å·åˆ†éš”ï¼Œå€¼ç”¨åŒå¼•å·åŒ…è£¹ï¼Œå¤šä¸ªé”®å€¼å¯¹ç”¨ç©ºæ ¼åˆ†éš”ï¼Œä¸èƒ½ç”¨é€—å·ï¼‰ã€‚</p>
</li>
<li>
<p>æ ‡ç­¾çš„é”®å’Œå€¼å¯ä»¥è‡ªå®šä¹‰ï¼ˆå¦‚doc:"ç”¨æˆ·å§“å"ï¼‰ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ä¸»æµåº“çº¦å®šçš„é”®ï¼ˆå¦‚json:"username"ã€gorm:"column:id"ï¼‰ã€‚</p>
</li>
<li>
<p>æ ‡ç­¾ä¸­å¯ä»¥åŒ…å«ç©ºæ ¼ã€å¼•å·ï¼ˆéœ€è½¬ä¹‰ï¼‰ç­‰ç‰¹æ®Šå­—ç¬¦ï¼Œä½†å»ºè®®ä¿æŒç®€æ´ï¼Œä»…å­˜å‚¨å¿…è¦çš„å…ƒæ•°æ®ã€‚</p>
</li>
</ul>
<h5 data-id="heading-4">æ­£ç¡®ä¸é”™è¯¯ç¤ºä¾‹å¯¹æ¯”</h5>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// æ­£ç¡®ç¤ºä¾‹ï¼ˆåå¼•å·åŒ…è£¹ã€é”®å€¼å¯¹æ ¼å¼æ­£ç¡®ï¼‰</span>
<span class="hljs-keyword">type</span> User <span class="hljs-keyword">struct</span> {
    Name <span class="hljs-type">string</span> <span class="hljs-string">`json:"username" doc:"ç”¨æˆ·å§“å" validate:"required"`</span>
    Age  <span class="hljs-type">int</span>    <span class="hljs-string">`gorm:"column:user_age;type:int(3)"`</span>
}

<span class="hljs-comment">// é”™è¯¯ç¤ºä¾‹ï¼ˆå¸¸è§è¸©å‘ç‚¹ï¼‰</span>
<span class="hljs-keyword">type</span> UserWrong <span class="hljs-keyword">struct</span> {
    <span class="hljs-comment">// é”™è¯¯1ï¼šç”¨åŒå¼•å·åŒ…è£¹æ ‡ç­¾ï¼Œä¼šè¢«è§£æä¸ºæ™®é€šå­—ç¬¦ä¸²</span>
    Name <span class="hljs-type">string</span> <span class="hljs-string">"json:'username'"</span>
    <span class="hljs-comment">// é”™è¯¯2ï¼šå¤šä¸ªé”®å€¼å¯¹ç”¨é€—å·åˆ†éš”ï¼Œåå°„æ— æ³•è¯†åˆ«</span>
    Age  <span class="hljs-type">int</span>    <span class="hljs-string">`gorm:"column:user_age",validate:"gte=18"`</span>
    <span class="hljs-comment">// é”™è¯¯3ï¼šå€¼æœªç”¨åŒå¼•å·åŒ…è£¹ï¼Œè¯­æ³•ä¸è§„èŒƒ</span>
    Sex  <span class="hljs-type">string</span> <span class="hljs-string">`doc:ç”·/å¥³`</span>
}
</code></pre>
<h3 data-id="heading-5">äºŒã€ç»“æ„ä½“æ ‡ç­¾çš„4å¤§æ ¸å¿ƒç”¨é€”ï¼ˆé™„å®Œæ•´å¯è¿è¡Œç¤ºä¾‹ï¼‰</h3>
<p>ç»“æ„ä½“æ ‡ç­¾çš„æ ¸å¿ƒä»·å€¼çš„æ˜¯â€œè‡ªåŠ¨åŒ–â€â€”â€”é€šè¿‡æå‰å®šä¹‰æ ‡ç­¾ï¼Œè®©å·¥å…·åº“ï¼ˆä¾èµ–åå°„ï¼‰è‡ªåŠ¨å¤„ç†å­—æ®µï¼Œå‡å°‘é‡å¤ç¼–ç ã€‚ä»¥ä¸‹æ˜¯å¼€å‘ä¸­æœ€å¸¸ç”¨çš„4ä¸ªåœºæ™¯ï¼Œæ¯ä¸ªåœºæ™¯éƒ½æ­é…å®Œæ•´ä»£ç ç¤ºä¾‹ï¼Œå¯ç›´æ¥å¤åˆ¶è¿è¡Œã€‚</p>
<h4 data-id="heading-6">ç”¨é€”1ï¼šJSONåºåˆ—åŒ–/ååºåˆ—åŒ–ï¼ˆæœ€å¸¸ç”¨åœºæ™¯ï¼‰</h4>
<p>Goè¯­è¨€æ ‡å‡†åº“encoding/jsonï¼Œå°±æ˜¯é€šè¿‡è¯»å–ç»“æ„ä½“æ ‡ç­¾ä¸­çš„jsoné”®ï¼Œæ¥å®ç°ç»“æ„ä½“ä¸JSONå­—ç¬¦ä¸²çš„è½¬æ¢ï¼Œæ ¸å¿ƒä½œç”¨æ˜¯ï¼šè‡ªå®šä¹‰JSONçš„é”®åã€æ§åˆ¶å­—æ®µæ˜¯å¦åºåˆ—åŒ–ã€å¤„ç†ç©ºå€¼ç­‰ã€‚</p>
<h5 data-id="heading-7">å¸¸è§jsonæ ‡ç­¾å‚æ•°</h5>
<ul>
<li>
<p>json:"username"ï¼šæŒ‡å®šJSONä¸­çš„é”®åä¸ºusernameï¼ˆæ›¿æ¢ç»“æ„ä½“å­—æ®µåŸåNameï¼‰ã€‚</p>
</li>
<li>
<p>json:"-"ï¼šæŒ‡å®šè¯¥å­—æ®µä¸å‚ä¸JSONåºåˆ—åŒ–/ååºåˆ—åŒ–ï¼ˆæ— è®ºå­—æ®µæœ‰å€¼ä¸å¦ï¼Œéƒ½ä¸ä¼šå‡ºç°åœ¨JSONä¸­ï¼‰ã€‚</p>
</li>
<li>
<p>json:"age,omitempty"ï¼šå¦‚æœå­—æ®µå€¼ä¸ºç©ºï¼ˆå¦‚intä¸º0ã€stringä¸ºç©ºä¸²ã€sliceä¸ºç©ºï¼‰ï¼Œåˆ™ä¸æ˜¾ç¤ºè¯¥å­—æ®µã€‚</p>
</li>
<li>
<p>json:"sex,string"ï¼šå°†å­—æ®µå€¼è½¬æ¢ä¸ºå­—ç¬¦ä¸²ç±»å‹åå†åºåˆ—åŒ–ï¼ˆå¦‚intç±»å‹çš„1ï¼Œä¼šå˜æˆ"1"ï¼‰ã€‚</p>
</li>
</ul>
<h5 data-id="heading-8">å®Œæ•´ç¤ºä¾‹ä»£ç </h5>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"encoding/json"</span>
    <span class="hljs-string">"fmt"</span>
)

<span class="hljs-comment">// å®šä¹‰å¸¦æœ‰jsonæ ‡ç­¾çš„ç»“æ„ä½“</span>
<span class="hljs-keyword">type</span> User <span class="hljs-keyword">struct</span> {
    Name     <span class="hljs-type">string</span> <span class="hljs-string">`json:"username"`</span>       <span class="hljs-comment">// è‡ªå®šä¹‰JSONé”®å</span>
    Age      <span class="hljs-type">int</span>    <span class="hljs-string">`json:"age,omitempty"`</span>  <span class="hljs-comment">// ç©ºå€¼ä¸æ˜¾ç¤º</span>
    Password <span class="hljs-type">string</span> <span class="hljs-string">`json:"-"`</span>              <span class="hljs-comment">// ä¸å‚ä¸JSONåºåˆ—åŒ–</span>
    Sex      <span class="hljs-type">int</span>    <span class="hljs-string">`json:"sex,string"`</span>     <span class="hljs-comment">// è½¬æ¢ä¸ºå­—ç¬¦ä¸²åºåˆ—åŒ–</span>
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// 1. ç»“æ„ä½“è½¬JSONï¼ˆåºåˆ—åŒ–ï¼‰</span>
    user := User{
        Name:     <span class="hljs-string">"å¼ ä¸‰"</span>,
        Age:      <span class="hljs-number">0</span>,      <span class="hljs-comment">// ç©ºå€¼ï¼Œä¼šè¢«omitemptyå¿½ç•¥</span>
        Password: <span class="hljs-string">"123456"</span>,<span class="hljs-comment">// ä¼šè¢«json:"-"å¿½ç•¥</span>
        Sex:      <span class="hljs-number">1</span>,
    }
    jsonStr, err := json.Marshal(user)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        fmt.Println(<span class="hljs-string">"JSONåºåˆ—åŒ–å¤±è´¥ï¼š"</span>, err)
        <span class="hljs-keyword">return</span>
    }
    fmt.Println(<span class="hljs-string">"åºåˆ—åŒ–ç»“æœï¼š"</span>, <span class="hljs-type">string</span>(jsonStr)) <span class="hljs-comment">// è¾“å‡ºï¼š{"username":"å¼ ä¸‰","sex":"1"}</span>

    <span class="hljs-comment">// 2. JSONè½¬ç»“æ„ä½“ï¼ˆååºåˆ—åŒ–ï¼‰</span>
    jsonStr2 := <span class="hljs-string">`{"username":"æå››","age":20,"sex":"0"}`</span>
    <span class="hljs-keyword">var</span> user2 User
    err = json.Unmarshal([]<span class="hljs-type">byte</span>(jsonStr2), &amp;user2)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        fmt.Println(<span class="hljs-string">"JSONååºåˆ—åŒ–å¤±è´¥ï¼š"</span>, err)
        <span class="hljs-keyword">return</span>
    }
    fmt.Println(<span class="hljs-string">"ååºåˆ—åŒ–ç»“æœï¼š"</span>, user2) <span class="hljs-comment">// è¾“å‡ºï¼š{æå›› 20  0}</span>
}
</code></pre>
<h4 data-id="heading-9">ç”¨é€”2ï¼šæ•°æ®åº“ORMæ˜ å°„ï¼ˆGORM/XORMæ ¸å¿ƒç”¨æ³•ï¼‰</h4>
<p>åœ¨Goè¯­è¨€å¼€å‘ä¸­ï¼ŒORMæ¡†æ¶ï¼ˆå¦‚GORMï¼‰æ˜¯æ“ä½œæ•°æ®åº“çš„ä¸»æµæ–¹å¼ï¼Œè€ŒORMæ¡†æ¶æ­£æ˜¯é€šè¿‡ç»“æ„ä½“æ ‡ç­¾ï¼Œå°†ç»“æ„ä½“å­—æ®µä¸æ•°æ®åº“è¡¨çš„åˆ—è¿›è¡Œæ˜ å°„ï¼Œæ— éœ€æ‰‹åŠ¨ç¼–å†™SQLè¯­å¥ï¼Œå®ç°â€œé¢å‘å¯¹è±¡â€çš„æ•°æ®åº“æ“ä½œã€‚</p>
<p>ä»¥æœ€æµè¡Œçš„GORMæ¡†æ¶ä¸ºä¾‹ï¼Œå¸¸è§çš„gormæ ‡ç­¾å‚æ•°å¦‚ä¸‹ï¼ˆä»…åˆ—ä¸¾é«˜é¢‘ï¼‰ï¼š</p>
<h5 data-id="heading-10">å¸¸è§gormæ ‡ç­¾å‚æ•°</h5>
<ul>
<li>
<p>gorm:"column:user_id"ï¼šæŒ‡å®šæ•°æ®åº“è¡¨çš„åˆ—åä¸ºuser_idï¼ˆæ›¿æ¢ç»“æ„ä½“å­—æ®µåŸåIDï¼‰ã€‚</p>
</li>
<li>
<p>gorm:"primaryKey"ï¼šæŒ‡å®šè¯¥å­—æ®µä¸ºä¸»é”®ï¼ˆå¯¹åº”æ•°æ®åº“çš„PRIMARY KEYï¼‰ã€‚</p>
</li>
<li>
<p>gorm:"autoIncrement"ï¼šæŒ‡å®šè¯¥å­—æ®µä¸ºè‡ªå¢åˆ—ï¼ˆä»…é€‚ç”¨äºintç±»å‹ä¸»é”®ï¼‰ã€‚</p>
</li>
<li>
<p>gorm:"type:varchar(50)"ï¼šæŒ‡å®šæ•°æ®åº“åˆ—çš„ç±»å‹ï¼ˆå¦‚varchar(50)ã€int(11)ï¼‰ã€‚</p>
</li>
<li>
<p>gorm:"not null"ï¼šæŒ‡å®šè¯¥åˆ—ä¸èƒ½ä¸ºç©ºï¼ˆå¯¹åº”æ•°æ®åº“çš„NOT NULLï¼‰ã€‚</p>
</li>
<li>
<p>gorm:"default:0"ï¼šæŒ‡å®šè¯¥åˆ—çš„é»˜è®¤å€¼ï¼ˆå¯¹åº”æ•°æ®åº“çš„DEFAULTï¼‰ã€‚</p>
</li>
<li>
<p>gorm:"comment:ç”¨æˆ·å§“å"ï¼šç»™æ•°æ®åº“åˆ—æ·»åŠ æ³¨é‡Šï¼ˆæ–¹ä¾¿åæœŸç»´æŠ¤ï¼‰ã€‚</p>
</li>
</ul>
<h5 data-id="heading-11">å®Œæ•´ç¤ºä¾‹ä»£ç ï¼ˆGORMï¼‰</h5>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"gorm.io/driver/mysql"</span>
    <span class="hljs-string">"gorm.io/gorm"</span>
    <span class="hljs-string">"fmt"</span>
)

<span class="hljs-comment">// å®šä¹‰å¸¦æœ‰gormæ ‡ç­¾çš„ç»“æ„ä½“ï¼ˆå¯¹åº”æ•°æ®åº“è¡¨usersï¼‰</span>
<span class="hljs-keyword">type</span> User <span class="hljs-keyword">struct</span> {
    ID       <span class="hljs-type">int</span>    <span class="hljs-string">`gorm:"column:user_id;primaryKey;autoIncrement"`</span> <span class="hljs-comment">// ä¸»é”®è‡ªå¢</span>
    Name     <span class="hljs-type">string</span> <span class="hljs-string">`gorm:"column:user_name;type:varchar(50);not null;comment:ç”¨æˆ·å§“å"`</span>
    Age      <span class="hljs-type">int</span>    <span class="hljs-string">`gorm:"column:user_age;type:int(3);default:0;comment:ç”¨æˆ·å¹´é¾„"`</span>
    Email    <span class="hljs-type">string</span> <span class="hljs-string">`gorm:"column:user_email;type:varchar(100);unique;comment:ç”¨æˆ·é‚®ç®±ï¼ˆå”¯ä¸€ï¼‰"`</span>
    Password <span class="hljs-type">string</span> <span class="hljs-string">`gorm:"column:user_password;type:varchar(100);not null;comment:ç”¨æˆ·å¯†ç "`</span>
}

<span class="hljs-comment">// è‡ªå®šä¹‰è¡¨åï¼ˆå¯é€‰ï¼Œé»˜è®¤è¡¨åä¸ºç»“æ„ä½“å¤æ•°å½¢å¼usersï¼‰</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(u User)</span></span> TableName() <span class="hljs-type">string</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-string">"users"</span>
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// 1. è¿æ¥æ•°æ®åº“ï¼ˆæ›¿æ¢ä¸ºè‡ªå·±çš„æ•°æ®åº“ä¿¡æ¯ï¼‰</span>
    dsn := <span class="hljs-string">"root:123456@tcp(127.0.0.1:3306)/test?charset=utf8mb4&amp;parseTime=True&amp;loc=Local"</span>
    db, err := gorm.Open(mysql.Open(dsn), &amp;gorm.Config{})
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        <span class="hljs-built_in">panic</span>(<span class="hljs-string">"æ•°æ®åº“è¿æ¥å¤±è´¥ï¼š"</span> + err.Error())
    }

    <span class="hljs-comment">// 2. æ ¹æ®ç»“æ„ä½“åˆ›å»ºè¡¨ï¼ˆè‡ªåŠ¨æ ¹æ®gormæ ‡ç­¾ç”Ÿæˆåˆ—å±æ€§ï¼‰</span>
    err = db.AutoMigrate(&amp;User{})
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        <span class="hljs-built_in">panic</span>(<span class="hljs-string">"åˆ›å»ºè¡¨å¤±è´¥ï¼š"</span> + err.Error())
    }
    fmt.Println(<span class="hljs-string">"è¡¨åˆ›å»ºæˆåŠŸï¼ˆè‹¥ä¸å­˜åœ¨ï¼‰"</span>)

    <span class="hljs-comment">// 3. æ’å…¥æ•°æ®ï¼ˆORMè‡ªåŠ¨æ˜ å°„ç»“æ„ä½“å­—æ®µä¸æ•°æ®åº“åˆ—ï¼‰</span>
    user := User{
        Name:     <span class="hljs-string">"å¼ ä¸‰"</span>,
        Age:      <span class="hljs-number">25</span>,
        Email:    <span class="hljs-string">"zhangsan@163.com"</span>,
        Password: <span class="hljs-string">"123456"</span>,
    }
    db.Create(&amp;user)
    fmt.Println(<span class="hljs-string">"æ’å…¥æ•°æ®æˆåŠŸï¼Œç”¨æˆ·IDï¼š"</span>, user.ID)
}
</code></pre>
<h4 data-id="heading-12">ç”¨é€”3ï¼šå‚æ•°æ ¡éªŒï¼ˆvalidatoråº“å¿…å¤‡ï¼‰</h4>
<p>åœ¨æ¥å£å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦æ ¡éªŒè¯·æ±‚å‚æ•°ï¼ˆå¦‚ç”¨æˆ·æ³¨å†Œæ—¶çš„é‚®ç®±æ ¼å¼ã€å¯†ç é•¿åº¦ã€å¹´é¾„èŒƒå›´ç­‰ï¼‰ï¼Œå¦‚æœæ‰‹åŠ¨ç¼–å†™å¤§é‡if-elseåˆ¤æ–­ï¼Œä¼šå¯¼è‡´ä»£ç å†—ä½™ã€éš¾ä»¥ç»´æŠ¤ã€‚æ­¤æ—¶ï¼Œé€šè¿‡ç»“æ„ä½“æ ‡ç­¾é…åˆvalidatoråº“ï¼Œå°±èƒ½å®ç°å‚æ•°çš„è‡ªåŠ¨æ ¡éªŒã€‚</p>
<p>validatoråº“æ˜¯Goè¯­è¨€ä¸­æœ€æµè¡Œçš„å‚æ•°æ ¡éªŒåº“ï¼Œæ”¯æŒé€šè¿‡æ ‡ç­¾å®šä¹‰æ ¡éªŒè§„åˆ™ï¼Œè‡ªåŠ¨æ ¡éªŒç»“æ„ä½“å­—æ®µçš„å€¼æ˜¯å¦ç¬¦åˆè¦æ±‚ã€‚</p>
<h5 data-id="heading-13">å¸¸è§validateæ ‡ç­¾å‚æ•°ï¼ˆé«˜é¢‘ï¼‰</h5>
<ul>
<li>
<p>validate:"required"ï¼šå­—æ®µå¿…å¡«ï¼ˆä¸èƒ½ä¸ºé»˜è®¤ç©ºå€¼ï¼Œå¦‚stringä¸ºç©ºä¸²ã€intä¸º0ï¼‰ã€‚</p>
</li>
<li>
<p>validate:"email"ï¼šå­—æ®µå€¼å¿…é¡»æ˜¯åˆæ³•çš„é‚®ç®±æ ¼å¼ï¼ˆå¦‚<a href="https://link.juejin.cn?target=mailto%3Axxx%40xxx.com" target="_blank" title="mailto:xxx@xxx.com" ref="nofollow noopener noreferrer">xxx@xxx.com</a>ï¼‰ã€‚</p>
</li>
<li>
<p>validate:"gte=18,lte=120"ï¼šå­—æ®µå€¼å¿…é¡»å¤§äºç­‰äº18ã€å°äºç­‰äº120ï¼ˆä»…é€‚ç”¨äºæ•°å€¼ç±»å‹ï¼‰ã€‚</p>
</li>
<li>
<p>validate:"len=6"ï¼šå­—æ®µå€¼çš„é•¿åº¦å¿…é¡»ç­‰äº6ï¼ˆé€‚ç”¨äºstringã€sliceç­‰ï¼‰ã€‚</p>
</li>
<li>
<p>validate:"min=6,max=20"ï¼šå­—æ®µå€¼çš„é•¿åº¦å¿…é¡»åœ¨6-20ä¹‹é—´ï¼ˆé€‚ç”¨äºstringã€sliceç­‰ï¼‰ã€‚</p>
</li>
<li>
<p>validate:"oneof=male female"ï¼šå­—æ®µå€¼å¿…é¡»æ˜¯æŒ‡å®šé€‰é¡¹ä¸­çš„ä¸€ä¸ªï¼ˆå¦‚åªèƒ½æ˜¯maleæˆ–femaleï¼‰ã€‚</p>
</li>
</ul>
<h5 data-id="heading-14">å®Œæ•´ç¤ºä¾‹ä»£ç ï¼ˆvalidatorï¼‰</h5>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"fmt"</span>
    <span class="hljs-string">"github.com/go-playground/validator/v10"</span>
)

<span class="hljs-comment">// å®šä¹‰å¸¦æœ‰validateæ ‡ç­¾çš„è¯·æ±‚ç»“æ„ä½“</span>
<span class="hljs-keyword">type</span> RegisterRequest <span class="hljs-keyword">struct</span> {
    Username <span class="hljs-type">string</span> <span class="hljs-string">`json:"username" validate:"required,min=6,max=20"`</span> <span class="hljs-comment">// å¿…å¡«ï¼Œé•¿åº¦6-20</span>
    Email    <span class="hljs-type">string</span> <span class="hljs-string">`json:"email" validate:"required,email"`</span>          <span class="hljs-comment">// å¿…å¡«ï¼Œåˆæ³•é‚®ç®±</span>
    Age      <span class="hljs-type">int</span>    <span class="hljs-string">`json:"age" validate:"required,gte=18,lte=120"`</span>   <span class="hljs-comment">// å¿…å¡«ï¼Œå¹´é¾„18-120</span>
    Password <span class="hljs-type">string</span> <span class="hljs-string">`json:"password" validate:"required,len=6"`</span>       <span class="hljs-comment">// å¿…å¡«ï¼Œé•¿åº¦6</span>
    Sex      <span class="hljs-type">string</span> <span class="hljs-string">`json:"sex" validate:"required,oneof=male female"`</span><span class="hljs-comment">// å¿…å¡«ï¼Œåªèƒ½æ˜¯male/female</span>
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// 1. åˆå§‹åŒ–æ ¡éªŒå™¨</span>
    validate := validator.New()

    <span class="hljs-comment">// 2. æ¨¡æ‹Ÿè¯·æ±‚å‚æ•°ï¼ˆä¸ç¬¦åˆæ ¡éªŒè§„åˆ™çš„ç¤ºä¾‹ï¼‰</span>
    req := RegisterRequest{
        Username: <span class="hljs-string">"zhangsan"</span>, <span class="hljs-comment">// é•¿åº¦8ï¼Œç¬¦åˆè¦æ±‚</span>
        Email:    <span class="hljs-string">"zhangsan163.com"</span>, <span class="hljs-comment">// ä¸åˆæ³•é‚®ç®±ï¼ˆç¼ºå°‘@ï¼‰</span>
        Age:      <span class="hljs-number">17</span>,         <span class="hljs-comment">// å¹´é¾„17ï¼Œä¸ç¬¦åˆgte=18</span>
        Password: <span class="hljs-string">"12345"</span>,    <span class="hljs-comment">// é•¿åº¦5ï¼Œä¸ç¬¦åˆlen=6</span>
        Sex:      <span class="hljs-string">"man"</span>,      <span class="hljs-comment">// ä¸æ˜¯æŒ‡å®šé€‰é¡¹ï¼ˆmale/femaleï¼‰</span>
    }

    <span class="hljs-comment">// 3. æ‰§è¡Œæ ¡éªŒ</span>
    err := validate.Struct(req)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        <span class="hljs-comment">// 4. è¾“å‡ºæ ¡éªŒå¤±è´¥ä¿¡æ¯</span>
        <span class="hljs-keyword">for</span> _, err := <span class="hljs-keyword">range</span> err.(validator.ValidationErrors) {
            fmt.Printf(<span class="hljs-string">"å‚æ•°æ ¡éªŒå¤±è´¥ï¼š%sï¼ˆå­—æ®µï¼š%sï¼Œè¦æ±‚ï¼š%sï¼‰\n"</span>, 
                err.Error(), err.Field(), err.Tag())
        }
        <span class="hljs-keyword">return</span>
    }

    fmt.Println(<span class="hljs-string">"å‚æ•°æ ¡éªŒé€šè¿‡ï¼Œå¯ä»¥æ‰§è¡Œæ³¨å†Œé€»è¾‘"</span>)
}
</code></pre>
<h4 data-id="heading-15">ç”¨é€”4ï¼šæ–‡æ¡£/è¡¨å•è‡ªåŠ¨ç”Ÿæˆï¼ˆæ¥å£å¼€å‘å¿…å¤‡ï¼‰</h4>
<p>åœ¨æ¥å£å¼€å‘ä¸­ï¼Œæˆ‘ä»¬éœ€è¦ç¼–å†™æ¥å£æ–‡æ¡£ï¼ˆå¦‚Swaggerï¼‰ï¼Œæˆ–è€…å®ç°è¡¨å•å‚æ•°ä¸ç»“æ„ä½“çš„è‡ªåŠ¨ç»‘å®šï¼Œæ­¤æ—¶ç»“æ„ä½“æ ‡ç­¾å°±èƒ½å‘æŒ¥ä½œç”¨â€”â€”é€šè¿‡è‡ªå®šä¹‰æ ‡ç­¾ï¼ˆå¦‚docã€formï¼‰ï¼Œå­˜å‚¨å­—æ®µçš„è¯´æ˜ä¿¡æ¯ã€è¡¨å•é”®åï¼Œå†é…åˆå·¥å…·åº“è‡ªåŠ¨ç”Ÿæˆæ–‡æ¡£æˆ–ç»‘å®šå‚æ•°ã€‚</p>
<p>è¿™æ­£æ˜¯ä½ ä¹‹å‰è¯­é›€é“¾æ¥ä¸­å±•ç¤ºçš„ç”¨æ³•ï¼ˆç”¨docæ ‡ç­¾å­˜å‚¨å­—æ®µè¯´æ˜ï¼‰ï¼Œæˆ‘ä»¬æ‰©å±•ä¸ºâ€œæ–‡æ¡£+è¡¨å•ç»‘å®šâ€çš„å®Œæ•´ç¤ºä¾‹ã€‚</p>
<h5 data-id="heading-16">å¸¸è§æ ‡ç­¾ï¼ˆè‡ªå®šä¹‰+ä¸»æµçº¦å®šï¼‰</h5>
<ul>
<li>
<p>doc:"ç”¨æˆ·å§“å"ï¼šå­˜å‚¨å­—æ®µçš„è¯´æ˜ä¿¡æ¯ï¼Œç”¨äºè‡ªåŠ¨ç”Ÿæˆæ¥å£æ–‡æ¡£ã€‚</p>
</li>
<li>
<p>form:"user_name"ï¼šæŒ‡å®šè¡¨å•æäº¤æ—¶çš„å‚æ•°åï¼Œç”¨äºè¡¨å•å‚æ•°ä¸ç»“æ„ä½“çš„è‡ªåŠ¨ç»‘å®šï¼ˆå¦‚ginæ¡†æ¶ï¼‰ã€‚</p>
</li>
<li>
<p>swagger:"true"ï¼šæ ‡è®°è¯¥å­—æ®µéœ€è¦æ˜¾ç¤ºåœ¨Swaggeræ–‡æ¡£ä¸­ï¼ˆé…åˆswaggoåº“ï¼‰ã€‚</p>
</li>
</ul>
<h5 data-id="heading-17">å®Œæ•´ç¤ºä¾‹ä»£ç ï¼ˆginæ¡†æ¶è¡¨å•ç»‘å®š+æ–‡æ¡£è¯´æ˜ï¼‰</h5>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"github.com/gin-gonic/gin"</span>
    <span class="hljs-string">"net/http"</span>
)

<span class="hljs-comment">// å®šä¹‰å¸¦æœ‰formå’Œdocæ ‡ç­¾çš„ç»“æ„ä½“ï¼ˆç”¨äºè¡¨å•æäº¤ï¼‰</span>
<span class="hljs-keyword">type</span> LoginForm <span class="hljs-keyword">struct</span> {
    Username <span class="hljs-type">string</span> <span class="hljs-string">`form:"user_name" doc:"ç™»å½•ç”¨æˆ·åï¼Œé•¿åº¦6-20ä½" validate:"required,min=6,max=20"`</span>
    Password <span class="hljs-type">string</span> <span class="hljs-string">`form:"user_password" doc:"ç™»å½•å¯†ç ï¼Œé•¿åº¦6ä½" validate:"required,len=6"`</span>
    Remember <span class="hljs-type">bool</span>   <span class="hljs-string">`form:"remember_me" doc:"æ˜¯å¦è®°ä½ç™»å½•çŠ¶æ€ï¼Œé»˜è®¤false"`</span>
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// åˆå§‹åŒ–ginå¼•æ“</span>
    r := gin.Default()

    <span class="hljs-comment">// å®šä¹‰ç™»å½•æ¥å£ï¼ˆè¡¨å•æäº¤ï¼‰</span>
    r.POST(<span class="hljs-string">"/login"</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(c *gin.Context)</span></span> {
        <span class="hljs-keyword">var</span> form LoginForm
        <span class="hljs-comment">// è‡ªåŠ¨ç»‘å®šè¡¨å•å‚æ•°ï¼ˆæ ¹æ®formæ ‡ç­¾åŒ¹é…ï¼‰</span>
        <span class="hljs-keyword">if</span> err := c.ShouldBindForm(&amp;form); err != <span class="hljs-literal">nil</span> {
            c.JSON(http.StatusBadRequest, gin.H{
                <span class="hljs-string">"code"</span>: <span class="hljs-number">400</span>,
                <span class="hljs-string">"msg"</span>:  <span class="hljs-string">"è¡¨å•å‚æ•°é”™è¯¯"</span>,
                <span class="hljs-string">"err"</span>:  err.Error(),
            })
            <span class="hljs-keyword">return</span>
        }

        <span class="hljs-comment">// è¿™é‡Œå¯ä»¥æ·»åŠ å‚æ•°æ ¡éªŒã€ç™»å½•é€»è¾‘ï¼ˆçœç•¥ï¼‰</span>
        c.JSON(http.StatusOK, gin.H{
            <span class="hljs-string">"code"</span>: <span class="hljs-number">200</span>,
            <span class="hljs-string">"msg"</span>:  <span class="hljs-string">"ç™»å½•æˆåŠŸ"</span>,
            <span class="hljs-string">"data"</span>: form,
        })
    })

    <span class="hljs-comment">// å¯åŠ¨æœåŠ¡</span>
    r.Run(<span class="hljs-string">":8080"</span>)
    <span class="hljs-comment">// æµ‹è¯•ï¼šè®¿é—®http://localhost:8080/loginï¼Œæäº¤è¡¨å•å‚æ•°user_nameã€user_passwordã€remember_me</span>
    <span class="hljs-comment">// æ–‡æ¡£ç”Ÿæˆï¼šé…åˆswaggoåº“ï¼Œå¯è‡ªåŠ¨è¯»å–docæ ‡ç­¾ï¼Œç”Ÿæˆæ¥å£æ–‡æ¡£</span>
}
</code></pre>
<h3 data-id="heading-18">ä¸‰ã€åå°„è¯»å–ç»“æ„ä½“æ ‡ç­¾ï¼ˆæ ¸å¿ƒåŸç†ï¼Œå¿…æ‡‚ï¼‰</h3>
<p>å‰é¢æ‰€æœ‰ç”¨é€”ï¼Œæ ¸å¿ƒéƒ½æ˜¯â€œåå°„è¯»å–æ ‡ç­¾â€â€”â€”ç»“æ„ä½“æ ‡ç­¾æœ¬èº«æ²¡æœ‰ä»»ä½•ä½œç”¨ï¼Œåªæœ‰é€šè¿‡reflectåŒ…è¯»å–å¹¶è§£æå®ƒï¼Œæ‰èƒ½å®ç°è‡ªåŠ¨åŒ–é€»è¾‘ã€‚æˆ‘ä»¬ç»“åˆä½ ä¹‹å‰è¯­é›€é“¾æ¥ä¸­çš„ä»£ç ï¼Œæ‹†è§£åå°„è¯»å–æ ‡ç­¾çš„å®Œæ•´æµç¨‹ã€‚</p>
<h4 data-id="heading-19">åå°„è¯»å–æ ‡ç­¾çš„3ä¸ªæ ¸å¿ƒæ­¥éª¤</h4>
<ol>
<li>
<p>é€šè¿‡reflect.TypeOf()è·å–æ¥å£å˜é‡çš„åå°„ç±»å‹ï¼ˆTypeï¼‰ã€‚</p>
</li>
<li>
<p>å¦‚æœä¼ å…¥çš„æ˜¯ç»“æ„ä½“æŒ‡é’ˆï¼Œéœ€é€šè¿‡Elem()æ–¹æ³•è·å–æŒ‡é’ˆæŒ‡å‘çš„å®é™…ç»“æ„ä½“ç±»å‹ã€‚</p>
</li>
<li>
<p>é€šè¿‡Field(i).Tag.Get("é”®å")ï¼Œè¯»å–æŒ‡å®šå­—æ®µçš„æ ‡ç­¾å€¼ï¼ˆiä¸ºå­—æ®µç´¢å¼•ï¼Œä»0å¼€å§‹ï¼‰ã€‚</p>
</li>
</ol>
<h4 data-id="heading-20">å®Œæ•´ç¤ºä¾‹ä»£ç ï¼ˆåå°„è¯»å–æ ‡ç­¾ï¼‰</h4>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"fmt"</span>
    <span class="hljs-string">"reflect"</span>
)

<span class="hljs-comment">// å®šä¹‰å¸¦æœ‰å¤šä¸ªæ ‡ç­¾çš„ç»“æ„ä½“ï¼ˆæ¨¡æ‹Ÿè¯­é›€é“¾æ¥ä¸­çš„åœºæ™¯ï¼‰</span>
<span class="hljs-keyword">type</span> Resume <span class="hljs-keyword">struct</span> {
    Name  <span class="hljs-type">string</span> <span class="hljs-string">`json:"name" doc:"æˆ‘çš„åå­—"`</span>
    Age   <span class="hljs-type">int</span>    <span class="hljs-string">`json:"age" doc:"æˆ‘çš„å¹´é¾„"`</span>
    Email <span class="hljs-type">string</span> <span class="hljs-string">`json:"email" doc:"æˆ‘çš„é‚®ç®±" validate:"required,email"`</span>
}

<span class="hljs-comment">// findDocï¼šé€šè¿‡åå°„è¯»å–ç»“æ„ä½“çš„docæ ‡ç­¾ï¼Œè¿”å›jsonæ ‡ç­¾ä¸docæ ‡ç­¾çš„æ˜ å°„</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">findDoc</span><span class="hljs-params">(stru <span class="hljs-keyword">interface</span>{})</span></span> <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">string</span> {
    <span class="hljs-comment">// 1. è·å–åå°„ç±»å‹ï¼ˆTypeï¼‰ï¼Œåˆ¤æ–­æ˜¯å¦ä¸ºæŒ‡é’ˆ</span>
    t := reflect.TypeOf(stru)
    <span class="hljs-keyword">if</span> t.Kind() != reflect.Ptr {
        fmt.Println(<span class="hljs-string">"é”™è¯¯ï¼šä¼ å…¥çš„å¿…é¡»æ˜¯ç»“æ„ä½“æŒ‡é’ˆ"</span>)
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
    }

    <span class="hljs-comment">// 2. è·å–æŒ‡é’ˆæŒ‡å‘çš„å®é™…ç»“æ„ä½“ç±»å‹</span>
    t = t.Elem()
    <span class="hljs-keyword">if</span> t.Kind() != reflect.Struct {
        fmt.Println(<span class="hljs-string">"é”™è¯¯ï¼šä¼ å…¥çš„æŒ‡é’ˆå¿…é¡»æŒ‡å‘ç»“æ„ä½“"</span>)
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
    }

    <span class="hljs-comment">// 3. éå†ç»“æ„ä½“çš„æ‰€æœ‰å­—æ®µï¼Œè¯»å–æ ‡ç­¾</span>
    docMap := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">string</span>)
    <span class="hljs-comment">// è·å–ç»“æ„ä½“å­—æ®µæ•°é‡</span>
    fieldCount := t.NumField()
    <span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; fieldCount; i++ {
        <span class="hljs-comment">// è·å–ç¬¬iä¸ªå­—æ®µ</span>
        field := t.Field(i)
        <span class="hljs-comment">// è¯»å–jsonæ ‡ç­¾çš„å€¼ï¼ˆä½œä¸ºmapçš„é”®ï¼‰</span>
        jsonKey := field.Tag.Get(<span class="hljs-string">"json"</span>)
        <span class="hljs-comment">// è¯»å–docæ ‡ç­¾çš„å€¼ï¼ˆä½œä¸ºmapçš„å€¼ï¼‰</span>
        docValue := field.Tag.Get(<span class="hljs-string">"doc"</span>)
        <span class="hljs-comment">// å­˜å…¥mapï¼ˆè·³è¿‡jsonæ ‡ç­¾ä¸ºç©ºçš„å­—æ®µï¼‰</span>
        <span class="hljs-keyword">if</span> jsonKey != <span class="hljs-string">""</span> {
            docMap[jsonKey] = docValue
        }
    }
    <span class="hljs-keyword">return</span> docMap
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// åˆ›å»ºç»“æ„ä½“å®ä¾‹</span>
    resume := Resume{
        Name:  <span class="hljs-string">"å¼ ä¸‰"</span>,
        Age:   <span class="hljs-number">25</span>,
        Email: <span class="hljs-string">"zhangsan@163.com"</span>,
    }

    <span class="hljs-comment">// ä¼ å…¥ç»“æ„ä½“æŒ‡é’ˆï¼Œè¯»å–docæ ‡ç­¾</span>
    docMap := findDoc(&amp;resume)
    fmt.Println(<span class="hljs-string">"jsonæ ‡ç­¾ä¸docæ ‡ç­¾çš„æ˜ å°„ï¼š"</span>, docMap)
    <span class="hljs-comment">// è¾“å‡ºï¼šmap[age:æˆ‘çš„å¹´é¾„ email:æˆ‘çš„é‚®ç®± name:æˆ‘çš„åå­—]</span>

    <span class="hljs-comment">// è¯»å–æŒ‡å®šjsonæ ‡ç­¾å¯¹åº”çš„docè¯´æ˜</span>
    fmt.Println(<span class="hljs-string">"nameå¯¹åº”çš„è¯´æ˜ï¼š"</span>, docMap[<span class="hljs-string">"name"</span>]) <span class="hljs-comment">// è¾“å‡ºï¼šæˆ‘çš„åå­—</span>
}
</code></pre>
<h3 data-id="heading-21">å››ã€ç»“æ„ä½“æ ‡ç­¾çš„å¸¸è§è¯¯åŒºï¼ˆé¿å‘é‡ç‚¹ï¼‰</h3>
<p>ç»“æ„ä½“æ ‡ç­¾çš„è¯­æ³•ç®€å•ï¼Œä½†å®¹æ˜“è¸©å‘ï¼Œä¸”å‘ç‚¹å¤šä¸ºâ€œç¼–è¯‘æœŸä¸æŠ¥é”™ã€è¿è¡Œæ—¶å‡ºé—®é¢˜â€ï¼Œä»¥ä¸‹æ˜¯4ä¸ªæœ€å¸¸è§çš„è¯¯åŒºï¼Œä¸€å®šè¦ç‰¢è®°ï¼š</p>
<h4 data-id="heading-22">è¯¯åŒº1ï¼šç”¨åŒå¼•å·/å•å¼•å·åŒ…è£¹æ ‡ç­¾</h4>
<p>æ ‡ç­¾å¿…é¡»ç”¨åå¼•å·ï¼ˆ`ï¼‰åŒ…è£¹ï¼Œç”¨åŒå¼•å·æˆ–å•å¼•å·ä¼šè¢«è§£æä¸ºæ™®é€šå­—ç¬¦ä¸²ï¼Œåå°„æ— æ³•è¯»å–ã€‚</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// é”™è¯¯</span>
<span class="hljs-keyword">type</span> User <span class="hljs-keyword">struct</span> {
    Name <span class="hljs-type">string</span> <span class="hljs-string">"json:'username'"</span> <span class="hljs-comment">// åŒå¼•å·åŒ…è£¹ï¼Œåå°„è¯»ä¸åˆ°</span>
}

<span class="hljs-comment">// æ­£ç¡®</span>
<span class="hljs-keyword">type</span> User <span class="hljs-keyword">struct</span> {
    Name <span class="hljs-type">string</span> <span class="hljs-string">`json:"username"`</span> <span class="hljs-comment">// åå¼•å·åŒ…è£¹</span>
}
</code></pre>
<h4 data-id="heading-23">è¯¯åŒº2ï¼šå¤šä¸ªæ ‡ç­¾é”®å€¼å¯¹ç”¨é€—å·åˆ†éš”</h4>
<p>å¤šä¸ªæ ‡ç­¾é”®å€¼å¯¹å¿…é¡»ç”¨<strong>ç©ºæ ¼</strong>åˆ†éš”ï¼Œç”¨é€—å·åˆ†éš”ä¼šå¯¼è‡´åå°„æ— æ³•è¯†åˆ«å¤šä¸ªé”®å€¼å¯¹ï¼Œåªèƒ½è¯»å–åˆ°ç¬¬ä¸€ä¸ªã€‚</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// é”™è¯¯</span>
<span class="hljs-keyword">type</span> User <span class="hljs-keyword">struct</span> {
    Name <span class="hljs-type">string</span> <span class="hljs-string">`json:"username",doc:"ç”¨æˆ·å§“å"`</span> <span class="hljs-comment">// é€—å·åˆ†éš”ï¼Œé”™è¯¯</span>
}

<span class="hljs-comment">// æ­£ç¡®</span>
<span class="hljs-keyword">type</span> User <span class="hljs-keyword">struct</span> {
    Name <span class="hljs-type">string</span> <span class="hljs-string">`json:"username" doc:"ç”¨æˆ·å§“å"`</span> <span class="hljs-comment">// ç©ºæ ¼åˆ†éš”ï¼Œæ­£ç¡®</span>
}
</code></pre>
<h4 data-id="heading-24">è¯¯åŒº3ï¼šæ ‡ç­¾å€¼æœªç”¨åŒå¼•å·åŒ…è£¹</h4>
<p>æ ‡ç­¾çš„é”®å€¼å¯¹ä¸­ï¼Œå€¼å¿…é¡»ç”¨åŒå¼•å·åŒ…è£¹ï¼Œå¦åˆ™è¯­æ³•ä¸è§„èŒƒï¼Œåå°„è¯»å–æ—¶ä¼šè¿”å›ç©ºå­—ç¬¦ä¸²ã€‚</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// é”™è¯¯</span>
<span class="hljs-keyword">type</span> User <span class="hljs-keyword">struct</span> {
    Name <span class="hljs-type">string</span> <span class="hljs-string">`json:username`</span> <span class="hljs-comment">// å€¼æœªç”¨åŒå¼•å·ï¼Œé”™è¯¯</span>
}

<span class="hljs-comment">// æ­£ç¡®</span>
<span class="hljs-keyword">type</span> User <span class="hljs-keyword">struct</span> {
    Name <span class="hljs-type">string</span> <span class="hljs-string">`json:"username"`</span> <span class="hljs-comment">// å€¼ç”¨åŒå¼•å·ï¼Œæ­£ç¡®</span>
}
</code></pre>
<h4 data-id="heading-25">è¯¯åŒº4ï¼šä¼ å…¥éæŒ‡é’ˆç±»å‹ç»™åå°„å‡½æ•°</h4>
<p>åå°„è¯»å–ç»“æ„ä½“æ ‡ç­¾æ—¶ï¼Œå¦‚æœä¼ å…¥çš„æ˜¯ç»“æ„ä½“å€¼ï¼ˆè€ŒéæŒ‡é’ˆï¼‰ï¼Œè™½ç„¶èƒ½è¯»å–åˆ°æ ‡ç­¾ï¼Œä½†å¦‚æœåç»­éœ€è¦ä¿®æ”¹ç»“æ„ä½“å­—æ®µçš„å€¼ï¼ˆç»“åˆåå°„Set()æ–¹æ³•ï¼‰ï¼Œä¼šæŠ¥é”™ï¼›åŒæ—¶ï¼Œä¼ å…¥éæŒ‡é’ˆç±»å‹ï¼Œæ— æ³•å¤„ç†â€œnilâ€çš„æƒ…å†µï¼Œå»ºè®®ç»Ÿä¸€ä¼ å…¥ç»“æ„ä½“æŒ‡é’ˆã€‚</p>
<h3 data-id="heading-26">äº”ã€æ€»ç»“</h3>
<p>ç»“æ„ä½“æ ‡ç­¾æ˜¯Goè¯­è¨€ä¸­â€œå…ƒæ•°æ®â€çš„æ ¸å¿ƒå®ç°æ–¹å¼ï¼Œå®ƒæœ¬èº«ä¸å‚ä¸ä¸šåŠ¡é€»è¾‘ï¼Œä½†é€šè¿‡åå°„ï¼Œèƒ½è®©å·¥å…·åº“å®ç°è‡ªåŠ¨åŒ–åŠŸèƒ½ï¼Œæå¤§åœ°å‡å°‘é‡å¤ç¼–ç ï¼Œæå‡å¼€å‘æ•ˆç‡ã€‚</p>
<p>æ ¸å¿ƒè¦ç‚¹å›é¡¾ï¼š</p>
<ol>
<li>
<p>æœ¬è´¨ï¼šé™„ç€åœ¨ç»“æ„ä½“å­—æ®µä¸Šçš„å­—ç¬¦ä¸²å¸¸é‡ï¼Œä»…èƒ½é€šè¿‡åå°„è¯»å–ã€‚</p>
</li>
<li>
<p>æ ¸å¿ƒç”¨é€”ï¼šJSONåºåˆ—åŒ–ã€ORMæ˜ å°„ã€å‚æ•°æ ¡éªŒã€æ–‡æ¡£/è¡¨å•ç”Ÿæˆï¼ˆå››å¤§åœºæ™¯è¦†ç›–80%+å¼€å‘éœ€æ±‚ï¼‰ã€‚</p>
</li>
<li>
<p>è¯­æ³•è§„èŒƒï¼šåå¼•å·åŒ…è£¹ã€é”®å€¼å¯¹æ ¼å¼ã€å¤šä¸ªæ ‡ç­¾ç”¨ç©ºæ ¼åˆ†éš”ï¼ˆå¿…è®°ï¼Œé¿å‘å…³é”®ï¼‰ã€‚</p>
</li>
<li>
<p>æ³¨æ„äº‹é¡¹ï¼šé¿å…å¸¸è§è¯­æ³•è¯¯åŒºï¼Œåå°„è¯»å–æ—¶å»ºè®®ä¼ å…¥ç»“æ„ä½“æŒ‡é’ˆã€‚</p>
</li>
</ol>
<p>ä¸€å¥è¯æ€»ç»“ï¼šç»“æ„ä½“æ ‡ç­¾æ˜¯â€œç»™å·¥å…·åº“çœ‹çš„å­—æ®µè¯´æ˜â€ï¼Œæœ‰äº†å®ƒï¼Œæ‰æœ‰äº†Goè¯­è¨€ä¸­å„ç±»é«˜æ•ˆçš„å·¥å…·åº“ï¼Œè®©æˆ‘ä»¬æ‘†è„±é‡å¤çš„æ‰‹åŠ¨ç¼–ç ï¼Œä¸“æ³¨äºæ ¸å¿ƒä¸šåŠ¡é€»è¾‘ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æ·±å…¥ç†è§£Goè¯­è¨€çš„æ ¸å¿ƒï¼šType-Value Pairï¼ˆç±»å‹-å€¼å¯¹ï¼‰]]></title>    <link>https://juejin.cn/post/7604693038438973446</link>    <guid>https://juejin.cn/post/7604693038438973446</guid>    <pubDate>2026-02-09T16:20:27.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604693038438973446" data-draft-id="7604693038438957062" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æ·±å…¥ç†è§£Goè¯­è¨€çš„æ ¸å¿ƒï¼šType-Value Pairï¼ˆç±»å‹-å€¼å¯¹ï¼‰"/> <meta itemprop="keywords" content="åç«¯,é¢è¯•,Go"/> <meta itemprop="datePublished" content="2026-02-09T16:20:27.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æˆ‘å«é»‘å¤§å¸…"/> <meta itemprop="url" content="https://juejin.cn/user/1678295463898875"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æ·±å…¥ç†è§£Goè¯­è¨€çš„æ ¸å¿ƒï¼šType-Value Pairï¼ˆç±»å‹-å€¼å¯¹ï¼‰
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1678295463898875/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æˆ‘å«é»‘å¤§å¸…
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-09T16:20:27.000Z" title="Mon Feb 09 2026 16:20:27 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">æ·±å…¥ç†è§£Goè¯­è¨€çš„æ ¸å¿ƒï¼šType-Value Pairï¼ˆç±»å‹-å€¼å¯¹ï¼‰</h2>
<p>ä½œä¸ºGoè¯­è¨€å¼€å‘è€…ï¼Œä½ æ˜¯å¦åœ¨å­¦ä¹ <strong>æ¥å£</strong>ã€<strong>åå°„</strong>æ—¶æ„Ÿåˆ°å›°æƒ‘ï¼Ÿæ¯”å¦‚ï¼šä¸ºä»€ä¹ˆç©ºæ¥å£<code>interface{}</code>èƒ½æ¥æ”¶ä»»æ„ç±»å‹çš„å€¼ï¼Ÿä¸ºä»€ä¹ˆç±»å‹æ–­è¨€æœ‰æ—¶ä¼šå¤±è´¥ï¼Ÿä¸ºä»€ä¹ˆåå°„èƒ½â€œçœ‹é€â€å˜é‡çš„æœ¬è´¨ï¼Ÿ</p>
<p>è¿™äº›é—®é¢˜çš„æ ¸å¿ƒç­”æ¡ˆï¼Œéƒ½æŒ‡å‘Goè¯­è¨€ä¸­å˜é‡çš„åº•å±‚æœ¬è´¨â€”â€”<strong>Type-Value Pairï¼ˆç±»å‹-å€¼å¯¹ï¼‰</strong>ï¼Œæˆ‘æ›´ä¹ æƒ¯ç§°å®ƒä¸ºâ€œPairâ€ã€‚ç†è§£Pairï¼Œæ˜¯æ‰“é€šGoè¯­è¨€æ¥å£ã€åå°„ä»»ç£äºŒè„‰çš„å…³é”®ã€‚</p>
<h3 data-id="heading-1">ä¸€ã€ä»€ä¹ˆæ˜¯Type-Value Pairï¼Ÿ</h3>
<p>åœ¨Goè¯­è¨€ä¸­ï¼Œ<strong>ä»»ä½•å˜é‡éƒ½ä¸æ˜¯å­¤ç«‹çš„â€œå€¼â€ï¼Œè€Œæ˜¯ç”±â€œç±»å‹â€å’Œâ€œå€¼â€ç»„æˆçš„äºŒå…ƒç»„ï¼ˆPairï¼‰</strong>ã€‚è¿™ä¸ªPairåŒ…å«ä¸¤ä¸ªæ ¸å¿ƒç»´åº¦ï¼š</p>

























<table><thead><tr><th>ç»´åº¦</th><th>è¯´æ˜</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td>Static Typeï¼ˆé™æ€ç±»å‹ï¼‰</td><td>å˜é‡å£°æ˜æ—¶æ˜¾å¼æŒ‡å®šçš„ç±»å‹ï¼ˆå¦‚intã€stringã€è‡ªå®šä¹‰ç»“æ„ä½“ã€æ¥å£ï¼‰ï¼Œç¼–è¯‘æœŸç¡®å®š</td><td>æ‰€æœ‰å˜é‡</td></tr><tr><td>Concrete Typeï¼ˆå…·ä½“ç±»å‹ï¼‰</td><td>æ¥å£ç±»å‹å˜é‡å®é™…æŒ‡å‘çš„åº•å±‚ç±»å‹ï¼ˆè¿è¡Œæ—¶ç¡®å®šï¼‰ï¼Œæ™®é€šç±»å‹çš„Concrete Typeç­‰äºStatic Type</td><td>ä»…æ¥å£ç±»å‹å˜é‡</td></tr><tr><td>Valueï¼ˆå€¼ï¼‰</td><td>å˜é‡å­˜å‚¨çš„å…·ä½“æ•°æ®ï¼ˆå¦‚10ã€"hello"ã€ç»“æ„ä½“å®ä¾‹ï¼‰</td><td>æ‰€æœ‰å˜é‡</td></tr></tbody></table>
<ul>
<li>
<p>å¯¹äºæ™®é€šç±»å‹å˜é‡ï¼ˆå¦‚<code>int</code>ã€<code>string</code>ï¼‰ï¼ŒPair = <code>Static Type + Value</code>ï¼›</p>
</li>
<li>
<p>å¯¹äºæ¥å£ç±»å‹å˜é‡ï¼ˆå¦‚<code>interface{}</code>ã€<code>io.Reader</code>ï¼‰ï¼ŒPair = <code>Static Type(æ¥å£) + Concrete Type(åº•å±‚ç±»å‹) + Value</code>ã€‚</p>
</li>
</ul>
<p>ä¸¾ä¸ªæœ€åŸºç¡€çš„ä¾‹å­ï¼š</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// æ™®é€šå˜é‡ï¼šStatic Type=intï¼ŒValue=10</span>
<span class="hljs-keyword">var</span> a <span class="hljs-type">int</span> = <span class="hljs-number">10</span>
<span class="hljs-comment">// æ™®é€šå˜é‡ï¼šStatic Type=stringï¼ŒValue="Go Pair"</span>
<span class="hljs-keyword">var</span> b <span class="hljs-type">string</span> = <span class="hljs-string">"Go Pair"</span>
</code></pre>
<p>æ­¤æ—¶<code>a</code>çš„Pairæ˜¯<code>(int, 10)</code>ï¼Œ<code>b</code>çš„Pairæ˜¯<code>(string, "Go Pair")</code>â€”â€”è¿™æ˜¯æœ€ç›´è§‚çš„Pairå½¢æ€ã€‚</p>
<h3 data-id="heading-2">äºŒã€Pairçš„æ ¸å¿ƒç‰¹æ€§ï¼šä¸å˜æ€§ä¸ä¼ é€’æ€§</h3>
<p>Pairæœ€å…³é”®çš„ç‰¹æ€§æ˜¯ï¼š<strong>å˜é‡åœ¨èµ‹å€¼ã€ä¼ é€’è¿‡ç¨‹ä¸­ï¼Œå…¶åº•å±‚çš„Type-Value Pairä¸ä¼šè¢«æ”¹å˜</strong>ã€‚å“ªæ€•å°†å˜é‡èµ‹å€¼ç»™æ¥å£ç±»å‹ï¼ŒPairä¾ç„¶ä¿æŒåŸæ ·ï¼Œè¿™æ˜¯ç†è§£æ¥å£çš„æ ¸å¿ƒã€‚</p>
<h4 data-id="heading-3">ç¤ºä¾‹1ï¼šæ™®é€šå˜é‡èµ‹å€¼ç»™ç©ºæ¥å£</h4>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span>

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// æ™®é€šå˜é‡ï¼šPair=(int, 20)</span>
    <span class="hljs-keyword">var</span> num <span class="hljs-type">int</span> = <span class="hljs-number">20</span>
    <span class="hljs-comment">// ç©ºæ¥å£å˜é‡ï¼šStatic Type=interface{}ï¼ŒConcrete Type=intï¼ŒValue=20</span>
    <span class="hljs-keyword">var</span> emptyIface <span class="hljs-keyword">interface</span>{} = num

    <span class="hljs-comment">// ç±»å‹æ–­è¨€ï¼šä»ç©ºæ¥å£ä¸­æå–Concrete Type=intçš„Value</span>
    <span class="hljs-keyword">if</span> v, ok := emptyIface.(<span class="hljs-type">int</span>); ok {
        fmt.Printf(<span class="hljs-string">"ç±»å‹ï¼š%Tï¼Œå€¼ï¼š%d\n"</span>, v, v) <span class="hljs-comment">// è¾“å‡ºï¼šç±»å‹ï¼šintï¼Œå€¼ï¼š20</span>
    }
}
</code></pre>
<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼š</p>
<ul>
<li>
<p><code>num</code>çš„Pairæ˜¯<code>(int, 20)</code>ï¼›</p>
</li>
<li>
<p>å½“æŠŠ<code>num</code>èµ‹å€¼ç»™<code>emptyIface</code>æ—¶ï¼Œ<code>emptyIface</code>çš„Pairå¹¶æ²¡æœ‰å˜æˆ<code>(interface{}, 20)</code>ï¼Œè€Œæ˜¯<strong>ä¿ç•™äº†åŸå˜é‡çš„Concrete Typeå’ŒValue</strong>ï¼Œä»…Static Typeå˜ä¸º<code>interface{}</code>ï¼›</p>
</li>
<li>
<p>ç±»å‹æ–­è¨€çš„æœ¬è´¨ï¼Œå°±æ˜¯æ£€æŸ¥æ¥å£å˜é‡çš„Concrete Typeæ˜¯å¦åŒ¹é…ï¼Œå¹¶æå–å¯¹åº”çš„Valueã€‚</p>
</li>
</ul>
<h4 data-id="heading-4">ç¤ºä¾‹2ï¼šæ¥å£åµŒå¥—ä¸Pairçš„ä¸€è‡´æ€§</h4>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span>

<span class="hljs-comment">// å®šä¹‰ä¸¤ä¸ªæ¥å£</span>
<span class="hljs-keyword">type</span> Reader <span class="hljs-keyword">interface</span> {
    Read() <span class="hljs-type">string</span>
}

<span class="hljs-keyword">type</span> Writer <span class="hljs-keyword">interface</span> {
    Write() <span class="hljs-type">string</span>
}

<span class="hljs-comment">// å®šä¹‰ç»“æ„ä½“ï¼Œå®ç°ä¸¤ä¸ªæ¥å£</span>
<span class="hljs-keyword">type</span> Book <span class="hljs-keyword">struct</span> {
    Name <span class="hljs-type">string</span>
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(b Book)</span></span> Read() <span class="hljs-type">string</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-string">"é˜…è¯»ï¼š"</span> + b.Name
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(b Book)</span></span> Write() <span class="hljs-type">string</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-string">"è®°å½•ï¼š"</span> + b.Name
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// ç»“æ„ä½“å®ä¾‹ï¼šPair=(Book, Book{Name:"Goå®æˆ˜"})</span>
    book := Book{Name: <span class="hljs-string">"Goå®æˆ˜"</span>}
    
    <span class="hljs-comment">// èµ‹å€¼ç»™Readeræ¥å£ï¼šPair=(Reader, Book, Book{Name:"Goå®æˆ˜"})</span>
    <span class="hljs-keyword">var</span> r Reader = book
    <span class="hljs-comment">// èµ‹å€¼ç»™Writeræ¥å£ï¼šPair=(Writer, Book, Book{Name:"Goå®æˆ˜"})</span>
    <span class="hljs-keyword">var</span> w Writer = book

    <span class="hljs-comment">// ç±»å‹æ–­è¨€ï¼šReader -&gt; Bookï¼ˆæˆåŠŸï¼Œå› ä¸ºConcrete Typeæ˜¯Bookï¼‰</span>
    <span class="hljs-keyword">if</span> b, ok := r.(Book); ok {
        fmt.Println(b.Read()) <span class="hljs-comment">// è¾“å‡ºï¼šé˜…è¯»ï¼šGoå®æˆ˜</span>
    }

    <span class="hljs-comment">// ç±»å‹æ–­è¨€ï¼šWriter -&gt; Readerï¼ˆæˆåŠŸï¼Œå› ä¸ºåº•å±‚Concrete Typeéƒ½æ˜¯Bookï¼‰</span>
    <span class="hljs-keyword">if</span> r2, ok := w.(Reader); ok {
        fmt.Println(r2.Read()) <span class="hljs-comment">// è¾“å‡ºï¼šé˜…è¯»ï¼šGoå®æˆ˜</span>
    }
}
</code></pre>
<p>è¿™ä¸ªä¾‹å­éªŒè¯äº†ï¼šåªè¦æ¥å£å˜é‡çš„Concrete Typeç›¸åŒï¼Œå³ä½¿Static Typeï¼ˆæ¥å£ç±»å‹ï¼‰ä¸åŒï¼Œä¹Ÿèƒ½é€šè¿‡ç±»å‹æ–­è¨€è½¬æ¢â€”â€”æ ¸å¿ƒåŸå› å°±æ˜¯<strong>Pairä¸­çš„Concrete Typeå’ŒValueå§‹ç»ˆæœªå˜</strong>ã€‚</p>
<h3 data-id="heading-5">ä¸‰ã€Pairæ˜¯åå°„çš„â€œåº•å±‚é€»è¾‘â€</h3>
<p>Goè¯­è¨€çš„åå°„ï¼ˆ<code>reflect</code>åŒ…ï¼‰ä¹‹æ‰€ä»¥èƒ½â€œåŠ¨æ€è·å–å˜é‡ç±»å‹å’Œå€¼â€ï¼Œæœ¬è´¨æ˜¯å› ä¸ºåå°„ç›´æ¥æ“ä½œå˜é‡çš„Pairï¼š</p>
<ul>
<li>
<p><code>reflect.TypeOf(x)</code>ï¼šè·å–å˜é‡<code>x</code>çš„Concrete Typeï¼›</p>
</li>
<li>
<p><code>reflect.ValueOf(x)</code>ï¼šè·å–å˜é‡<code>x</code>çš„Valueï¼›</p>
</li>
<li>
<p>åå°„ä¿®æ”¹å˜é‡å€¼çš„å‰æï¼Œæ˜¯è·å–åˆ°å˜é‡çš„â€œå¯è®¾ç½®â€Valueï¼ˆå³æŒ‡å‘åŸå˜é‡çš„æŒ‡é’ˆï¼‰ã€‚</p>
</li>
</ul>
<p>ç¤ºä¾‹ï¼šç”¨åå°„è¯»å–Pairçš„Typeå’ŒValue</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"fmt"</span>
    <span class="hljs-string">"reflect"</span>
)

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">var</span> str = <span class="hljs-string">"Hello Pair"</span>
    <span class="hljs-comment">// è·å–Type</span>
    t := reflect.TypeOf(str)
    <span class="hljs-comment">// è·å–Value</span>
    v := reflect.ValueOf(str)

    fmt.Printf(<span class="hljs-string">"Typeï¼š%sï¼ŒKindï¼š%sï¼ŒValueï¼š%v\n"</span>, t.Name(), t.Kind(), v)
    <span class="hljs-comment">// è¾“å‡ºï¼šTypeï¼šstringï¼ŒKindï¼šstringï¼ŒValueï¼šHello Pair</span>

    <span class="hljs-comment">// ç©ºæ¥å£çš„åå°„</span>
    <span class="hljs-keyword">var</span> iface <span class="hljs-keyword">interface</span>{} = str
    t2 := reflect.TypeOf(iface)
    v2 := reflect.ValueOf(iface)
    fmt.Printf(<span class="hljs-string">"æ¥å£Typeï¼š%sï¼Œæ¥å£Valueï¼š%v\n"</span>, t2.Name(), v2)
    <span class="hljs-comment">// è¾“å‡ºï¼šæ¥å£Typeï¼šstringï¼Œæ¥å£Valueï¼šHello Pair</span>
}
</code></pre>
<p>å¯ä»¥çœ‹åˆ°ï¼Œå³ä½¿å˜é‡è¢«åŒ…è£…è¿›ç©ºæ¥å£ï¼Œåå°„ä¾ç„¶èƒ½ç²¾å‡†è·å–åˆ°åŸå˜é‡çš„Concrete Typeå’ŒValueâ€”â€”è¿™æ­£æ˜¯Pairçš„â€œåŠŸåŠ³â€ã€‚</p>
<h3 data-id="heading-6">å››ã€ç†è§£Pairçš„å®é™…æ„ä¹‰</h3>
<ol>
<li>
<p><strong>é¿å…æ¥å£ä½¿ç”¨çš„å‘</strong>ï¼šå¾ˆå¤šæ–°æ‰‹è®¤ä¸ºâ€œç©ºæ¥å£èƒ½å­˜ä»»æ„ç±»å‹ï¼Œæ‰€ä»¥å¯ä»¥éšæ„è½¬æ¢â€ï¼Œä½†å®é™…ä¸Šå¦‚æœConcrete Typeä¸åŒ¹é…ï¼Œç±»å‹æ–­è¨€ä¼šå¤±è´¥ã€‚æ¯”å¦‚å°†<code>int</code>ç±»å‹èµ‹å€¼ç»™ç©ºæ¥å£åï¼Œæ–­è¨€ä¸º<code>string</code>ä¼šç›´æ¥æŠ¥é”™ï¼Œæœ¬è´¨æ˜¯Pairçš„Concrete Typeä¸åŒ¹é…ã€‚</p>
</li>
<li>
<p><strong>æ­£ç¡®ä½¿ç”¨åå°„</strong>ï¼šåå°„çš„æ‰€æœ‰æ“ä½œéƒ½å›´ç»•Pairå±•å¼€ï¼Œæ¯”å¦‚ä¿®æ”¹å˜é‡å€¼æ—¶ï¼Œå¿…é¡»ç¡®ä¿<code>reflect.Value</code>æ˜¯â€œå¯è®¾ç½®çš„â€ï¼ˆå³æŒ‡å‘åŸå˜é‡çš„æŒ‡é’ˆï¼‰ï¼Œå¦åˆ™ä¼šè§¦å‘panicâ€”â€”è¿™æ˜¯å› ä¸ºåå°„ä¿®æ”¹çš„æ˜¯Pairçš„Valueï¼Œè€Œéå‰¯æœ¬ã€‚</p>
</li>
<li>
<p><strong>ç†è§£æ¥å£çš„â€œå¤šæ€â€</strong>ï¼šGoè¯­è¨€çš„æ¥å£å¤šæ€ï¼Œæœ¬è´¨æ˜¯ä¸åŒç±»å‹çš„å˜é‡ï¼ˆä¸åŒPairï¼‰èµ‹å€¼ç»™åŒä¸€æ¥å£ç±»å‹å˜é‡æ—¶ï¼Œåªè¦Concrete Typeå®ç°äº†æ¥å£çš„æ–¹æ³•ï¼Œå°±èƒ½è¢«æ¥å£â€œå…¼å®¹â€â€”â€”æ ¸å¿ƒè¿˜æ˜¯Pairçš„Concrete Typeåœ¨èµ·ä½œç”¨ã€‚</p>
</li>
</ol>
<h3 data-id="heading-7">æ€»ç»“</h3>
<p>Type-Value Pairæ˜¯Goè¯­è¨€å˜é‡çš„åº•å±‚æœ¬è´¨ï¼Œå®ƒå†³å®šäº†ï¼š</p>
<ol>
<li>
<p>å˜é‡çš„ç±»å‹å’Œå€¼æ˜¯ä¸å¯åˆ†å‰²çš„æ•´ä½“ï¼Œä¼ é€’è¿‡ç¨‹ä¸­Pairä¿æŒä¸å˜ï¼›</p>
</li>
<li>
<p>æ¥å£çš„æ ¸å¿ƒæ˜¯â€œåŒ…è£¹â€åº•å±‚å˜é‡çš„Concrete Typeå’ŒValueï¼›</p>
</li>
<li>
<p>åå°„çš„æœ¬è´¨æ˜¯å¯¹å˜é‡Pairçš„ç›´æ¥æ“ä½œã€‚</p>
</li>
</ol>
<p>ç†è§£Pairï¼Œä½ å°±èƒ½å½»åº•ææ‡‚Goè¯­è¨€çš„æ¥å£ã€åå°„æœºåˆ¶ï¼Œé¿å¼€æ–°æ‰‹å¸¸è§çš„å‘ï¼Œå†™å‡ºæ›´ç¬¦åˆGoè¯­è¨€è®¾è®¡å“²å­¦çš„ä»£ç ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[IDEAè¿æ¥MySQLæ•°æ®åº“é”™è¯¯]]></title>    <link>https://juejin.cn/post/7604574877034823723</link>    <guid>https://juejin.cn/post/7604574877034823723</guid>    <pubDate>2026-02-09T13:19:08.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604574877034823723" data-draft-id="7604433863726235702" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="IDEAè¿æ¥MySQLæ•°æ®åº“é”™è¯¯"/> <meta itemprop="keywords" content="åç«¯,IntelliJ IDEA"/> <meta itemprop="datePublished" content="2026-02-09T13:19:08.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ä½•ä¸­åº”"/> <meta itemprop="url" content="https://juejin.cn/user/1435305504958535"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            IDEAè¿æ¥MySQLæ•°æ®åº“é”™è¯¯
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1435305504958535/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ä½•ä¸­åº”
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-09T13:19:08.000Z" title="Mon Feb 09 2026 13:19:08 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>è¯´æ˜ï¼šä½¿ç”¨IDEAè¿æ¥äº‘æœåŠ¡å™¨ä¸­çš„MySQLæ•°æ®åº“æ—¶ï¼ŒæŠ¥ä¸‹é¢çš„è¿™ä¸ªé”™è¯¯ï¼›</p>
<pre><code class="hljs language-vbscript" lang="vbscript">[<span class="hljs-number">08</span>S01] Communications link failure

  The last packet sent successfully <span class="hljs-keyword">to</span> the <span class="hljs-built_in">server</span> was <span class="hljs-number">0</span> milliseconds ago. The driver has <span class="hljs-keyword">not</span> received any packets from the <span class="hljs-built_in">server</span>. No appropriate protocol (protocol <span class="hljs-keyword">is</span> disabled <span class="hljs-keyword">or</span> cipher suites are inappropriate)


  The following required algorithms might be disabled: SSLv3, TLSv1, TLSv1<span class="hljs-number">.1</span>, RC4, DES, MD5withRSA, DH keySize &lt; <span class="hljs-number">1024</span>, EC keySize &lt; <span class="hljs-number">224</span>, <span class="hljs-number">3</span>DES_EDE_CBC, anon, <span class="hljs-literal">NULL</span>. Edit the list of disabled algorithms <span class="hljs-keyword">to</span> include required algorithms. You can try <span class="hljs-keyword">to</span> enable TLSv1 <span class="hljs-keyword">or</span> TLSv1<span class="hljs-number">.1</span> first.  
  
  JDBC driver may have disabled TLS <span class="hljs-number">1.1</span> <span class="hljs-keyword">and</span> its earlier versions.
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9dbf8df9591c4419ba054204c193b66e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L2V5Lit5bqU:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771247947&amp;x-signature=26LlY9OF0JuVG%2B6TcfbPzgNSrGk%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<p>é”™è¯¯ç¿»è¯‘å¦‚ä¸‹ï¼›</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8cc60272c2ee4b33830ad10d0a2f7c4c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L2V5Lit5bqU:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771247947&amp;x-signature=aatSe%2FZ%2Br7AGEPoAbSS9jE7nv2s%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<p>è§£å†³ï¼š</p>
<p>å¦‚æœä½ çš„IDEAä¸­é”™è¯¯ä¸‹é¢æœ‰è¿™å‡ ä¸ªæç¤ºï¼Œé€‰æ‹©Enable TLSv1ï¼›</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/126e833803e24637aa437292056eb3a9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L2V5Lit5bqU:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771247947&amp;x-signature=QrPMnC15E83yPf4VqDUgRI6gBQI%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<p>IDEAä¸­ä¼šè‡ªåŠ¨å¢åŠ ä»¥ä¸‹é…ç½®ï¼Œç›´æ¥ç‚¹â€œApplyâ€å°±å¯ä»¥ï¼›</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7bff62cafc614c328e3473905f28e046~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L2V5Lit5bqU:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771247947&amp;x-signature=Yb%2Be2S6Oei4dIz44%2BoWuHRe5Jto%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<p>Testï¼Œè¿æ¥æˆåŠŸï¼›
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/af15bc157483422e87651fea3f656f26~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L2V5Lit5bqU:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771247947&amp;x-signature=SNlttjOsUUiVFvjzJc3j%2F4VTJUk%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<p>å¦‚æœæ²¡æœ‰æç¤ºï¼Œå¯æ‰‹åŠ¨æ·»åŠ ä»¥ä¸‹é…ç½®ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/56e5283979964e99b515845eb5a355f8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L2V5Lit5bqU:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771247947&amp;x-signature=Qv30ncS40hfR97QEsQX1kDCctFo%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-string">"-Djdk.tls.disabledAlgorithms=SSLv3, TLSv1.1, RC4, DES, MD5withRSA, DH keySize &lt; 1024, EC keySize &lt; 224, 3DES_EDE_CBC, anon, NULL"</span>
</code></pre>
<h2 data-id="heading-0">é¦–æ¬¡å‘å¸ƒ</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fhezhongying.blog.csdn.net%2Farticle%2Fdetails%2F132355979" target="_blank" title="https://hezhongying.blog.csdn.net/article/details/132355979" ref="nofollow noopener noreferrer">hezhongying.blog.csdn.net/article/detâ€¦</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æ·±åº¦åˆ†æï¼šRocketMQ å¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤± â€”â€” å…¨é“¾è·¯é˜²ä¸¢æœºåˆ¶ä¸ç”Ÿäº§å®è·µ]]></title>    <link>https://juejin.cn/post/7604665952320307251</link>    <guid>https://juejin.cn/post/7604665952320307251</guid>    <pubDate>2026-02-09T19:52:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604665952320307251" data-draft-id="7604672395626823707" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æ·±åº¦åˆ†æï¼šRocketMQ å¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤± â€”â€” å…¨é“¾è·¯é˜²ä¸¢æœºåˆ¶ä¸ç”Ÿäº§å®è·µ"/> <meta itemprop="keywords" content="RocketMQ"/> <meta itemprop="datePublished" content="2026-02-09T19:52:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ä¸‰æ°´ä¸æ»´"/> <meta itemprop="url" content="https://juejin.cn/user/283045639753100"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æ·±åº¦åˆ†æï¼šRocketMQ å¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤± â€”â€” å…¨é“¾è·¯é˜²ä¸¢æœºåˆ¶ä¸ç”Ÿäº§å®è·µ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/283045639753100/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ä¸‰æ°´ä¸æ»´
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-09T19:52:42.000Z" title="Mon Feb 09 2026 19:52:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">æ·±åº¦åˆ†æï¼šRocketMQ å¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤± â€”â€” å…¨é“¾è·¯é˜²ä¸¢æœºåˆ¶ä¸ç”Ÿäº§å®è·µ</h2>
<hr/>
<h2 data-id="heading-1">ä¸€ã€å‰è¨€</h2>
<p>åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œ<strong>æ¶ˆæ¯å¯é æ€§</strong>æ˜¯æ ¸å¿ƒæŒ‡æ ‡ã€‚å¾ˆå¤šäººä»¥ä¸ºç”¨äº† MQ å°±å¤©ç„¶ä¸ä¸¢æ¶ˆæ¯ï¼Œå…¶å®å®Œå…¨é”™äº†ã€‚</p>
<p>RocketMQ æœ¬èº«<strong>ä¸ä¿è¯ 100% ç»å¯¹ä¸ä¸¢</strong>ï¼Œä½†é€šè¿‡<strong>æ­£ç¡®çš„æ¶æ„ + æ­£ç¡®çš„é…ç½® + æ­£ç¡®çš„ä½¿ç”¨å§¿åŠ¿</strong>ï¼Œå¯ä»¥è¾¾åˆ°<strong>é‡‘èçº§ã€ç”Ÿäº§çº§ä¸ä¸¢å¤±</strong>ã€‚</p>
<p>æ¶ˆæ¯ä¸¢å¤±åªä¼šå‘ç”Ÿåœ¨ä¸‰ä¸ªé˜¶æ®µï¼š</p>
<ol>
<li><strong>Producer â†’ Broker</strong>ï¼ˆå‘é€ä¸¢å¤±ï¼‰</li>
<li><strong>Broker å†…å­˜ â†’ ç£ç›˜</strong>ï¼ˆå­˜å‚¨ä¸¢å¤±ï¼‰</li>
<li><strong>Broker â†’ Consumer</strong>ï¼ˆæ¶ˆè´¹ä¸¢å¤±ï¼‰</li>
</ol>
<p>æœ¬æ–‡æŠŠè¿™ä¸‰éƒ¨åˆ†<strong>å…¨éƒ¨è®²é€</strong>ã€‚</p>
<hr/>
<h2 data-id="heading-2">äºŒã€ç¬¬ä¸€é˜¶æ®µï¼šç”Ÿäº§è€…å¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸ä¸¢</h2>
<p>ç”Ÿäº§è€…ä¸¢æ¶ˆæ¯ï¼Œä¸€èˆ¬æ˜¯ï¼šæ¶ˆæ¯å‘äº†ï¼Œä½† Broker æ²¡æ”¶åˆ°ã€æ²¡è¿”å› ACKã€ç”Ÿäº§è€…ç›´æ¥å¿½ç•¥å¼‚å¸¸ã€‚</p>
<h3 data-id="heading-3">2.1 ä½¿ç”¨åŒæ­¥å‘é€ï¼ˆæœ€å…³é”®ï¼‰</h3>
<ul>
<li><strong>åŒæ­¥å‘é€ <code>send()</code></strong> ï¼šç­‰å¾… Broker è¿”å› ACKï¼Œå¤±è´¥ç›´æ¥æŠ›å¼‚å¸¸ã€‚</li>
<li><strong>ä¸¥ç¦ä½¿ç”¨ <code>sendOneway()</code></strong> ï¼šå‘å®Œä¸ç®¡ï¼Œå¿…ä¸¢æ¶ˆæ¯ã€‚</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// åŒæ­¥å‘é€ï¼ˆæ¨èï¼‰</span>
<span class="hljs-type">SendResult</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> producer.send(message);
</code></pre>
<h3 data-id="heading-4">2.2 å¼€å¯ç”Ÿäº§è€…é‡è¯•</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// åŒæ­¥å‘é€å¤±è´¥é‡è¯•æ¬¡æ•°</span>
producer.setRetryTimesWhenSendFailed(<span class="hljs-number">3</span>);
<span class="hljs-comment">// å¼‚æ­¥å‘é€å¤±è´¥é‡è¯•æ¬¡æ•°</span>
producer.setRetryTimesWhenSendAsyncFailed(<span class="hljs-number">3</span>);
</code></pre>
<h3 data-id="heading-5">2.3 ä¸¥æ ¼æ ¡éªŒå‘é€ç»“æœ</h3>
<p>å¿…é¡»åˆ¤æ–­ <code>SendStatus</code>ï¼Œå¤±è´¥ä¸€å®šè¦é‡è¯• / å‘Šè­¦ / è½åº“ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">if</span> (result.getSendStatus() != SendStatus.SEND_OK) {
    <span class="hljs-comment">// æ—¥å¿—ã€å‘Šè­¦ã€é‡è¯•ã€æŒä¹…åŒ–å¾…é‡å‘</span>
}
</code></pre>
<h3 data-id="heading-6">2.4 æé«˜å¯é åœºæ™¯ï¼šä½¿ç”¨äº‹åŠ¡æ¶ˆæ¯</h3>
<p>è®¢å• / æ”¯ä»˜ç­‰æ ¸å¿ƒä¸šåŠ¡ï¼Œç›´æ¥ç”¨ <strong>äº‹åŠ¡æ¶ˆæ¯</strong>ï¼Œä»æ ¹æºä¿è¯ï¼š<strong>æœ¬åœ°äº‹åŠ¡æˆåŠŸ â†” æ¶ˆæ¯ä¸€å®šå‘é€æˆåŠŸ</strong></p>
<hr/>
<h2 data-id="heading-7">ä¸‰ã€ç¬¬äºŒé˜¶æ®µï¼šBroker å¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸ä¸¢ï¼ˆæœ€æ ¸å¿ƒï¼‰</h2>
<p>Broker æ˜¯æœ€å®¹æ˜“ä¸¢æ¶ˆæ¯çš„ç¯èŠ‚ï¼Œ99% æ˜¯å› ä¸ºï¼š<strong>æ¶ˆæ¯è¿˜åœ¨ PageCacheï¼Œæœºå™¨æ–­ç”µ / å®•æœºï¼Œæ•°æ®ä¸¢å¤±ã€‚</strong></p>
<h3 data-id="heading-8">3.1 åˆ·ç›˜ç­–ç•¥ï¼šåŒæ­¥åˆ·ç›˜</h3>
<p>RocketMQ é»˜è®¤æ˜¯ <strong>å¼‚æ­¥åˆ·ç›˜</strong>ï¼Œæ€§èƒ½é«˜ï¼Œä½†å¯èƒ½ä¸¢æ¶ˆæ¯ã€‚</p>
<p>è¦ç»å¯¹ä¸ä¸¢ï¼Œå¿…é¡»å¼€å¯ï¼š</p>
<pre><code class="hljs language-properties" lang="properties">flushDiskType = SYNC_FLUSH
</code></pre>
<ul>
<li>æ¶ˆæ¯<strong>çœŸæ­£å†™å…¥ç£ç›˜</strong>æ‰è¿”å› ACK</li>
<li>æœºå™¨å®•æœºã€æ–­ç”µéƒ½ä¸ä¼šä¸¢</li>
<li>é‡‘è / æ”¯ä»˜å¿…å¼€</li>
</ul>
<h3 data-id="heading-9">3.2 ä¸»ä»åŒæ­¥ï¼šåŒæ­¥åŒå†™</h3>
<p>å•æœºä¸€å®šæœ‰é£é™©ï¼Œå¿…é¡»éƒ¨ç½²ä¸»ä»ã€‚</p>
<pre><code class="hljs language-properties" lang="properties">brokerRole = SYNC_MASTER
</code></pre>
<ul>
<li>å¿…é¡» <strong>ä¸» + ä»éƒ½å†™å…¥æˆåŠŸ</strong> æ‰è¿”å›æˆåŠŸ</li>
<li>ä¸»æœºæŒ‚äº†ï¼Œä»æœºä¾ç„¶æœ‰å®Œæ•´æ•°æ®</li>
</ul>
<h3 data-id="heading-10">3.3 æœ€å¼ºä¸ä¸¢é…ç½®ï¼ˆé‡‘èçº§ï¼‰</h3>
<pre><code class="hljs language-properties" lang="properties">flushDiskType=SYNC_FLUSH
brokerRole=SYNC_MASTER
</code></pre>
<p>è¿™å¥—é…ç½®ï¼Œåªè¦ç£ç›˜ä¸åï¼Œ<strong>ç»å¯¹ä¸ä¸¢</strong>ã€‚</p>
<hr/>
<h2 data-id="heading-11">å››ã€ç¬¬ä¸‰é˜¶æ®µï¼šæ¶ˆè´¹è€…å¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸ä¸¢ï¼ˆæœ€å®¹æ˜“å¿½ç•¥ï¼‰</h2>
<p>æ¶ˆè´¹ç«¯ä¸¢æ¶ˆæ¯ï¼Œæ˜¯æœ€ç»å…¸çš„å‘ï¼š</p>
<p><strong>ä¸šåŠ¡è¿˜æ²¡æ‰§è¡Œå®Œï¼Œå°±è‡ªåŠ¨ ACKï¼ŒæœåŠ¡ä¸€æŒ‚ï¼Œæ¶ˆæ¯æ°¸ä¹…ä¸¢å¤±ã€‚</strong></p>
<h3 data-id="heading-12">4.1 æ ¸å¿ƒåŸåˆ™ï¼šå…ˆæ‰§è¡Œä¸šåŠ¡ï¼Œå† ACK</h3>
<p>RocketMQ æ¶ˆè´¹è€…é€»è¾‘ï¼š</p>
<ul>
<li>è¿”å› <strong>CONSUME_SUCCESS</strong> â†’ è®¤ä¸ºæ¶ˆæ¯æ¶ˆè´¹å®Œæˆ</li>
<li>æŠ›å‡ºå¼‚å¸¸ / è¿”å› <strong>RECONSUME_LATER</strong> â†’ ä¼šé‡è¯•</li>
</ul>
<p>æ­£ç¡®å†™æ³•ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> ConsumeConcurrentlyStatus <span class="hljs-title function_">consumeMessage</span><span class="hljs-params">(...)</span> {
    <span class="hljs-keyword">try</span> {
        <span class="hljs-comment">// 1. å…ˆæ‰§è¡Œä¸šåŠ¡ï¼ˆå…¥åº“ã€è°ƒç”¨ã€å¤„ç†ï¼‰</span>
        doBusiness();

        <span class="hljs-comment">// 2. æˆåŠŸåå†è¿”å› SUCCESS</span>
        <span class="hljs-keyword">return</span> ConsumeConcurrentlyStatus.CONSUME_SUCCESS;
    } <span class="hljs-keyword">catch</span> (Exception e) {
        log.error(<span class="hljs-string">"æ¶ˆè´¹å¤±è´¥"</span>, e);
        <span class="hljs-comment">// 3. å¼‚å¸¸ â†’ ä¸ ACKï¼ŒBroker ä¼šé‡è¯•</span>
        <span class="hljs-keyword">return</span> ConsumeConcurrentlyStatus.RECONSUME_LATER;
    }
}
</code></pre>
<h3 data-id="heading-13">4.2 ä¸¥ç¦æå‰ ACK</h3>
<p>ä¸è¦åœ¨ä¸šåŠ¡æ‰§è¡Œå‰å°±è¿”å›æˆåŠŸã€‚</p>
<h3 data-id="heading-14">4.3 æ¶ˆè´¹è¶…æ—¶åˆç†è®¾ç½®</h3>
<p>é¿å…å› ä¸ºè¶…æ—¶å¯¼è‡´é‡å¤æˆ–ä¸¢å¤±ã€‚</p>
<hr/>
<h2 data-id="heading-15">äº”ã€æ¶ˆæ¯ä¸ä¸¢å¤±å®Œæ•´æµç¨‹ï¼ˆæ€»ç»“ä¸€å¼ å›¾çœ‹æ‡‚ï¼‰</h2>
<pre><code class="hljs">ç”Ÿäº§è€…
  â†“ï¼ˆåŒæ­¥å‘é€ + æ ¡éªŒç»“æœ + é‡è¯•ï¼‰
Broker
  â†“ï¼ˆåŒæ­¥åˆ·ç›˜ + åŒæ­¥ä¸»ä»ï¼‰
æ¶ˆè´¹è€…
  â†“ï¼ˆå…ˆæ‰§è¡Œä¸šåŠ¡ï¼ŒæˆåŠŸå† ACKï¼‰
æœ€ç»ˆï¼šæ¶ˆæ¯ä¸ä¸¢å¤±
</code></pre>
<hr/>
<h2 data-id="heading-16">å…­ã€ç”Ÿäº§ç¯å¢ƒç»ˆææœ€ä½³å®è·µï¼ˆç›´æ¥ç…§åšï¼‰</h2>
<h3 data-id="heading-17">ç”Ÿäº§è€…</h3>
<ul>
<li>ä½¿ç”¨åŒæ­¥å‘é€</li>
<li>å¼€å¯é‡è¯•</li>
<li>æ ¡éªŒ SendResult</li>
<li>æ ¸å¿ƒä¸šåŠ¡ç”¨äº‹åŠ¡æ¶ˆæ¯</li>
<li>å¤±è´¥æ¶ˆæ¯è½åº“ + å®šæ—¶ä»»åŠ¡é‡è¯•</li>
</ul>
<h3 data-id="heading-18">Broker</h3>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">flushDiskType</span>=SYNC_FLUSH
<span class="hljs-attr">brokerRole</span>=SYNC_MASTER
</code></pre>
<ul>
<li>ä¸»ä»æ¶æ„</li>
<li>ç£ç›˜ RAID</li>
<li>ç›‘æ§ç£ç›˜å¥åº·ã€å†…å­˜ã€æœåŠ¡çŠ¶æ€</li>
</ul>
<h3 data-id="heading-19">æ¶ˆè´¹è€…</h3>
<ul>
<li>å…ˆå¤„ç†ä¸šåŠ¡ï¼Œå† ACK</li>
<li>å¼‚å¸¸è¿”å› RECONSUME_LATER</li>
<li>å¿…é¡»åš<strong>å¹‚ç­‰</strong>ï¼ˆé‡è¯•ä¼šé‡å¤ï¼‰</li>
<li>ç›‘æ§ï¼šå †ç§¯ã€é‡è¯•ã€æ­»ä¿¡</li>
</ul>
<hr/>
<h2 data-id="heading-20">ä¸ƒã€ç»å…¸é—®é¢˜</h2>
<ol>
<li>RocketMQ å¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±ï¼Ÿ</li>
<li>åŒæ­¥åˆ·ç›˜ vs å¼‚æ­¥åˆ·ç›˜ åŒºåˆ«ï¼Ÿ</li>
<li>åŒæ­¥ä¸»ä» vs å¼‚æ­¥ä¸»ä» åŒºåˆ«ï¼Ÿ</li>
<li>æ¶ˆè´¹ç«¯ä¸ºä»€ä¹ˆä¼šä¸¢æ¶ˆæ¯ï¼Ÿ</li>
<li>äº‹åŠ¡æ¶ˆæ¯ä¸ºä»€ä¹ˆèƒ½é˜²ä¸¢ï¼Ÿ</li>
<li>ç”Ÿäº§ä¸­ä½ æ˜¯å¦‚ä½•ç¡®ä¿æ¶ˆæ¯ä¸ä¸¢å¤±çš„ï¼Ÿ</li>
</ol>
<hr/>
<h2 data-id="heading-21">å…«ã€æ€»ç»“</h2>
<p>RocketMQ ä¸æ‰¿è¯º â€œå¤©ç„¶ä¸ä¸¢æ¶ˆæ¯â€ï¼Œä½†é€šè¿‡ï¼š</p>
<p><strong>åŒæ­¥å‘é€ + åŒæ­¥åˆ·ç›˜ + åŒæ­¥ä¸»ä» + å…ˆä¸šåŠ¡å ACK</strong></p>
<p>å¯ä»¥å®ç°<strong>å·¥ä¸šçº§ã€é‡‘èçº§ã€ç”Ÿäº§çº§çš„æ¶ˆæ¯ä¸ä¸¢å¤±</strong>ã€‚</p>
<p>è®°ä½ä¸€å¥è¯ï¼š<strong>æ¶ˆæ¯ä¸ä¸¢å¤±ï¼Œä¸æ˜¯ä¸­é—´ä»¶å•æ–¹é¢çš„äº‹ï¼Œæ˜¯å…¨é“¾è·¯è®¾è®¡çš„ç»“æœã€‚</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æ·±åº¦åˆ†æRocketMQ æ¶ˆæ¯é‡è¯•ï¼ˆé‡è¯»ï¼‰æœºåˆ¶]]></title>    <link>https://juejin.cn/post/7604690250363781129</link>    <guid>https://juejin.cn/post/7604690250363781129</guid>    <pubDate>2026-02-09T19:23:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604690250363781129" data-draft-id="7604665952320192563" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æ·±åº¦åˆ†æRocketMQ æ¶ˆæ¯é‡è¯•ï¼ˆé‡è¯»ï¼‰æœºåˆ¶"/> <meta itemprop="keywords" content="RocketMQ"/> <meta itemprop="datePublished" content="2026-02-09T19:23:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ä¸‰æ°´ä¸æ»´"/> <meta itemprop="url" content="https://juejin.cn/user/283045639753100"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æ·±åº¦åˆ†æRocketMQ æ¶ˆæ¯é‡è¯•ï¼ˆé‡è¯»ï¼‰æœºåˆ¶
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/283045639753100/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ä¸‰æ°´ä¸æ»´
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-09T19:23:39.000Z" title="Mon Feb 09 2026 19:23:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">æ·±åº¦åˆ†æ RocketMQ æ¶ˆæ¯é‡è¯•ï¼ˆé‡è¯»ï¼‰æœºåˆ¶ï¼šåŸç†ã€æµç¨‹ã€é…ç½®ä¸ç”Ÿäº§å®æˆ˜</h2>
<h3 data-id="heading-1">ä¸€ã€å‰è¨€</h3>
<p>åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿé‡Œï¼Œ<strong>æ¶ˆè´¹å¤±è´¥æ˜¯å¸¸æ€</strong>ï¼š</p>
<ul>
<li>ç½‘ç»œæŠ–åŠ¨ã€è°ƒç”¨è¶…æ—¶</li>
<li>æ•°æ®åº“å¼‚å¸¸ã€é”ç­‰å¾…</li>
<li>ä¸šåŠ¡æ ¡éªŒå¤±è´¥ã€æµé‡çªåˆº</li>
<li>æ¶ˆè´¹è€…é‡å¯ã€æ‰©å®¹ã€å®•æœº</li>
</ul>
<p>å¦‚æœæ²¡æœ‰å¯é çš„<strong>æ¶ˆæ¯é‡è¯•ï¼ˆé‡è¯»ï¼‰æœºåˆ¶</strong>ï¼Œå°±ä¼šå‡ºç°ï¼š<strong>æ•°æ®ä¸ä¸€è‡´ã€ä¸¢æ¶ˆæ¯ã€ä¸šåŠ¡ä¸­æ–­ã€äººå·¥è¡¥å•</strong>ã€‚</p>
<p>RocketMQ æä¾›äº†ä¸€å¥—<strong>å…¨è‡ªåŠ¨ã€å¯é…ç½®ã€éš”ç¦»æ€§å¼º</strong>çš„æ¶ˆè´¹é‡è¯•æ–¹æ¡ˆã€‚</p>
<h3 data-id="heading-2">äºŒã€ä»€ä¹ˆæ˜¯æ¶ˆæ¯é‡è¯•ï¼ˆé‡è¯»ï¼‰ï¼Ÿ</h3>
<p><strong>æ¶ˆæ¯é‡è¯• = æ¶ˆè´¹å¤±è´¥åï¼ŒBroker è‡ªåŠ¨é‡æ–°æŠ•é€’æ¶ˆæ¯ç»™æ¶ˆè´¹è€…ã€‚</strong></p>
<p>RocketMQ åªä¿è¯ï¼š<strong>At Least Onceï¼ˆè‡³å°‘æŠ•é€’ä¸€æ¬¡ï¼‰ä¸ä¿è¯ Exactly Onceã€‚</strong></p>
<p>æ‰€ä»¥ï¼š<strong>æ¶ˆè´¹å¤±è´¥ = ä¸è¿”å›æˆåŠŸ = è‡ªåŠ¨é‡è¯•</strong></p>
<hr/>
<h3 data-id="heading-3">ä¸‰ã€å“ªäº›æƒ…å†µä¼šè§¦å‘é‡è¯•ï¼Ÿ</h3>
<p>åªè¦æ¶ˆè´¹è€…<strong>æ²¡æœ‰æ˜ç¡®è¿”å›æˆåŠŸ</strong>ï¼Œå°±ä¼šé‡è¯•ï¼š</p>
<ol>
<li>ä¸šåŠ¡ä»£ç æŠ›å‡º <strong>Exception / Error</strong></li>
<li>æ˜¾å¼è¿”å› <code>RECONSUME_LATER</code></li>
<li>æ¶ˆè´¹<strong>è¶…æ—¶</strong>ï¼ˆé»˜è®¤ 15minï¼‰</li>
<li>æ¶ˆè´¹è€…è¿›ç¨‹æŒ‚æ‰ã€æ–­å¼€è¿æ¥</li>
<li>é˜Ÿåˆ—é‡æ–°è´Ÿè½½å‡è¡¡ï¼ˆrebalanceï¼‰</li>
</ol>
<p>åªè¦æ²¡è¿”å›ï¼š</p>
<pre><code class="hljs language-java" lang="java">ConsumeConcurrentlyStatus.CONSUME_SUCCESS
</code></pre>
<p>ä¸€å¾‹è¿›å…¥é‡è¯•ã€‚</p>
<hr/>
<h3 data-id="heading-4">å››ã€æ ¸å¿ƒæœºåˆ¶ï¼šé‡è¯•æ¶ˆæ¯å­˜åœ¨å“ªé‡Œï¼Ÿ</h3>
<p>é‡ç‚¹ï¼š<strong>é‡è¯•æ¶ˆæ¯ä¸åœ¨åŸ Topicï¼</strong></p>
<p>RocketMQ ä¼šä¸º<strong>æ¯ä¸ªæ¶ˆè´¹ç»„</strong>åˆ›å»ºä¸€ä¸ª<strong>å†…ç½®é‡è¯•é˜Ÿåˆ—</strong>ï¼š</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_">%</span><span class="bash">RETRY%+æ¶ˆè´¹è€…ç»„å</span>
</code></pre>
<p>ä¾‹å¦‚ï¼šæ¶ˆè´¹ç»„ï¼š<code>order-consumer-group</code>é‡è¯•é˜Ÿåˆ—ï¼š<code>%RETRY%order-consumer-group</code></p>
<p>ç‰¹ç‚¹ï¼š</p>
<ul>
<li>è‡ªåŠ¨åˆ›å»ºï¼Œæ— éœ€æ‰‹åŠ¨å»º</li>
<li>å¯¹ä¸šåŠ¡é€æ˜</li>
<li>ä¸æ­£å¸¸ Topic éš”ç¦»ï¼Œä¸å½±å“ä¸»æµç¨‹</li>
<li>åªæœ‰å½“å‰æ¶ˆè´¹ç»„èƒ½æ¶ˆè´¹</li>
</ul>
<hr/>
<h3 data-id="heading-5">äº”ã€é‡è¯•å»¶è¿Ÿè§„åˆ™ï¼ˆéå¸¸é‡è¦ï¼‰</h3>
<p>RocketMQ <strong>ä¸æ˜¯ç«‹å³é‡è¯•</strong>ï¼Œè€Œæ˜¯ä½¿ç”¨<strong>å»¶è¿Ÿç­‰çº§</strong>æ§åˆ¶é—´éš”ã€‚</p>
<p>é»˜è®¤ <strong>18 ä¸ªå»¶è¿Ÿçº§åˆ«</strong>ï¼š</p>
<pre><code class="hljs">1s 5s 10s 30s 1m 2m 3m 4m 5m 6m 7m 8m 9m 10m 20m 30m 1h 2h
</code></pre>
<p>å¯¹åº” levelï¼š<code>1 ~ 18</code></p>
<h4 data-id="heading-6">é‡è¯•æ¬¡æ•°ä¸å»¶è¿Ÿå¯¹åº”</h4>
<ul>
<li>ç¬¬ 1 æ¬¡é‡è¯• â†’ level 3 â†’ <strong>10s</strong></li>
<li>ç¬¬ 2 æ¬¡é‡è¯• â†’ level 4 â†’ <strong>30s</strong></li>
<li>ç¬¬ 3 æ¬¡é‡è¯• â†’ level 5 â†’ <strong>1m</strong></li>
<li>ç¬¬ 4 æ¬¡é‡è¯• â†’ level 6 â†’ <strong>2m</strong></li>
<li>â€¦</li>
<li>è¶Šæ¥è¶Šé•¿ï¼Œ<strong>é¿å…é›ªå´©å¼é‡è¯•</strong></li>
</ul>
<hr/>
<h3 data-id="heading-7">å…­ã€æœ€å¤§é‡è¯•æ¬¡æ•° &amp; æ­»ä¿¡é˜Ÿåˆ—ï¼ˆDLQï¼‰</h3>
<h4 data-id="heading-8">1. é»˜è®¤æœ€å¤§é‡è¯•æ¬¡æ•°</h4>
<ul>
<li><strong>é›†ç¾¤æ¨¡å¼ï¼šé»˜è®¤ 16 æ¬¡</strong></li>
<li><strong>å¹¿æ’­æ¨¡å¼ï¼šä¸é‡è¯•ï¼ˆåªå‘ä¸€æ¬¡ï¼‰</strong></li>
</ul>
<h4 data-id="heading-9">2. è¶…è¿‡æœ€å¤§é‡è¯• â†’ è¿›å…¥æ­»ä¿¡é˜Ÿåˆ—</h4>
<p>æ­»ä¿¡é˜Ÿåˆ—æ ¼å¼ï¼š</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_">%</span><span class="bash">DLQ%+æ¶ˆè´¹è€…ç»„å</span>
</code></pre>
<p>ç‰¹ç‚¹ï¼š</p>
<ul>
<li>è¿›å…¥æ­»ä¿¡å <strong>ä¸å†è‡ªåŠ¨æŠ•é€’</strong></li>
<li>éœ€è¦äººå·¥æ’æŸ¥ã€å¤„ç†ã€æ¢å¤</li>
<li>æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿæœ€åçš„<strong>å…œåº•ä¿éšœ</strong></li>
</ul>
<hr/>
<h3 data-id="heading-10">ä¸ƒã€é›†ç¾¤æ¨¡å¼ vs å¹¿æ’­æ¨¡å¼ é‡è¯•å¯¹æ¯”</h3>
<p>è¡¨æ ¼</p>


























<table><thead><tr><th>æ¨¡å¼</th><th>æ˜¯å¦é‡è¯•</th><th>é‡è¯•é˜Ÿåˆ—</th><th>æ­»ä¿¡é˜Ÿåˆ—</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td><strong>é›†ç¾¤æ¨¡å¼</strong></td><td>âœ… æ˜¯</td><td>âœ… æœ‰</td><td>âœ… æœ‰</td><td>ç”Ÿäº§ç¯å¢ƒé»˜è®¤</td></tr><tr><td><strong>å¹¿æ’­æ¨¡å¼</strong></td><td>âŒ ä¸é‡è¯•</td><td>âŒ æ— </td><td>âŒ æ— </td><td>æ—¥å¿—ã€é€šçŸ¥</td></tr></tbody></table>
<p><strong>ç”Ÿäº§ 99% ç”¨é›†ç¾¤æ¨¡å¼ã€‚</strong></p>
<hr/>
<h3 data-id="heading-11">å…«ã€å®Œæ•´é‡è¯•æµç¨‹ï¼ˆå›¾æ–‡ç‰ˆé€»è¾‘ï¼‰</h3>
<pre><code class="hljs language-erlang" lang="erlang">æ¶ˆè´¹å¼€å§‹
  â†“
æ‰§è¡Œä¸šåŠ¡é€»è¾‘
  â†“
æˆåŠŸï¼Ÿâ†’ è¿”å› CONSUME_SUCCESS â†’ ç»“æŸ
  â†“
å¤±è´¥ï¼Ÿ
  â†“
å†™å…¥ <span class="hljs-comment">%RETRY%æ¶ˆè´¹ç»„ é˜Ÿåˆ—</span>
  â†“
æŒ‰å»¶è¿Ÿç­‰çº§ç­‰å¾…
  â†“
é‡æ–°æŠ•é€’ç»™æ¶ˆè´¹è€…
  â†“
é‡å¤ç›´åˆ°è¾¾åˆ°æœ€å¤§æ¬¡æ•°
  â†“
è¿›å…¥ <span class="hljs-comment">%DLQ%æ¶ˆè´¹ç»„ æ­»ä¿¡é˜Ÿåˆ—</span>
  â†“
äººå·¥å¤„ç†
</code></pre>
<hr/>
<h3 data-id="heading-12">ä¹ã€ä»£ç å±‚é¢å¦‚ä½•æ§åˆ¶é‡è¯•ï¼Ÿ</h3>
<h4 data-id="heading-13">1. æŠ›å¼‚å¸¸è‡ªåŠ¨é‡è¯•ï¼ˆæœ€å¸¸ç”¨ï¼‰</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> ConsumeConcurrentlyStatus <span class="hljs-title function_">consumeMessage</span><span class="hljs-params">(
        List&lt;MessageExt&gt; msgs, ConsumeConcurrentlyContext context)</span> {
    <span class="hljs-keyword">try</span> {
        <span class="hljs-comment">// ä¸šåŠ¡å¤„ç†</span>
        doBusiness(msgs);
        <span class="hljs-keyword">return</span> ConsumeConcurrentlyStatus.CONSUME_SUCCESS;
    } <span class="hljs-keyword">catch</span> (Exception e) {
        log.error(<span class="hljs-string">"æ¶ˆè´¹å¼‚å¸¸ï¼Œè‡ªåŠ¨é‡è¯•"</span>, e);
        <span class="hljs-comment">// æŠ›å‡ºå¼‚å¸¸ â†’ è‡ªåŠ¨è¿›å…¥é‡è¯•</span>
        <span class="hljs-keyword">throw</span> e;
    }
}
</code></pre>
<h4 data-id="heading-14">2. æ‰‹åŠ¨è¿”å›é‡è¯•</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">return</span> ConsumeConcurrentlyStatus.RECONSUME_LATER;
</code></pre>
<h4 data-id="heading-15">3. ä¸æƒ³é‡è¯•ï¼Ÿç›´æ¥åå¼‚å¸¸</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">try</span> {
    doBusiness();
} <span class="hljs-keyword">catch</span> (Exception e) {
    log.error(<span class="hljs-string">"ä¸šåŠ¡å¤±è´¥ï¼Œä¸å†é‡è¯•"</span>, e);
}
<span class="hljs-keyword">return</span> CONSUME_SUCCESS;
</code></pre>
<p>âš ï¸ è°¨æ…ä½¿ç”¨ï¼Œä¼šä¸¢æ¶ˆæ¯ã€‚</p>
<hr/>
<h3 data-id="heading-16">åã€å¦‚ä½•è‡ªå®šä¹‰æœ€å¤§é‡è¯•æ¬¡æ•°ï¼Ÿ</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">DefaultMQPushConsumer</span> <span class="hljs-variable">consumer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultMQPushConsumer</span>(<span class="hljs-string">"order-group"</span>);
<span class="hljs-comment">// è®¾ç½®æœ€å¤§é‡è¯•æ¬¡æ•°</span>
consumer.setMaxReconsumeTimes(<span class="hljs-number">5</span>);
</code></pre>
<p>æ¨èï¼š<strong>3~5 æ¬¡</strong>ï¼Œé¿å…æ— é™é‡è¯•ã€‚</p>
<hr/>
<h3 data-id="heading-17">åä¸€ã€ç”Ÿäº§ç¯å¢ƒæœ€ä½³å®è·µ</h3>
<ol>
<li>
<p><strong>æ¶ˆè´¹å¿…é¡»å¹‚ç­‰</strong>é‡è¯•ä¸€å®šä¼šå¸¦æ¥é‡å¤æ¶ˆæ¯ï¼Œå¿…é¡»ä¿è¯é‡å¤æ¶ˆè´¹ä¸å½±å“ç»“æœã€‚</p>
</li>
<li>
<p><strong>å¯é‡è¯•ä¸ä¸å¯é‡è¯•å¼‚å¸¸åˆ†å¼€å¤„ç†</strong></p>
<ul>
<li>ç½‘ç»œ / DB æŠ–åŠ¨ï¼šå¯é‡è¯•</li>
<li>å‚æ•°éæ³• / æ•°æ®ä¸å­˜åœ¨ï¼šä¸é‡è¯•ï¼Œç›´æ¥è®°å½•</li>
</ul>
</li>
<li>
<p><strong>å¿«é€Ÿå¤±è´¥ï¼Œä¸è¦é˜»å¡</strong>é˜»å¡ä¼šå¯¼è‡´é˜Ÿåˆ—å¤§é‡å †ç§¯ã€‚</p>
</li>
<li>
<p><strong>æ­»ä¿¡é˜Ÿåˆ—å¿…é¡»ç›‘æ§å‘Šè­¦</strong>å‡ºç°æ­»ä¿¡ = ç³»ç»Ÿå¼‚å¸¸ï¼Œå¿…é¡»åŠæ—¶å¤„ç†ã€‚</p>
</li>
<li>
<p><strong>é‡è¯•æ¬¡æ•°ä¸è¦è®¾ç½®è¿‡å¤§</strong>é¿å…æ¶ˆæ¯é•¿æœŸå ç”¨é˜Ÿåˆ—ï¼Œå½±å“æ­£å¸¸æ¶ˆè´¹ã€‚</p>
</li>
<li>
<p><strong>ç¦æ­¢ç¦ç”¨é‡è¯•</strong>é«˜å¯é ç³»ç»Ÿä¸å…è®¸ä¸¢æ¶ˆæ¯ã€‚</p>
</li>
</ol>
<hr/>
<h3 data-id="heading-18">åäºŒã€æ€»ç»“</h3>
<p>RocketMQ æ¶ˆæ¯é‡è¯•ï¼ˆé‡è¯»ï¼‰æœºåˆ¶æ˜¯ï¼š<strong>é«˜å¯é åˆ†å¸ƒå¼ç³»ç»Ÿçš„æ ¸å¿ƒä¿éšœ</strong>ã€‚</p>
<p>æ ¸å¿ƒè¦ç‚¹ï¼š</p>
<ul>
<li>æ¶ˆè´¹å¤±è´¥ â†’ è¿›å…¥ <code>%RETRY%ç»„å</code></li>
<li>æŒ‰å»¶è¿Ÿç­‰çº§é‡è¯•ï¼Œé¿å…é£æš´</li>
<li>è¶…è¿‡æ¬¡æ•° â†’ è¿›å…¥ <code>%DLQ%ç»„å</code></li>
<li>æ¶ˆè´¹ç«¯å¿…é¡»åš<strong>å¹‚ç­‰</strong></li>
<li>ç”Ÿäº§å¿…é¡»ç›‘æ§<strong>é‡è¯•ã€æ­»ä¿¡ã€å †ç§¯</strong></li>
</ul>
<p>ç†è§£è¿™å¥—æœºåˆ¶ï¼Œä½ å°±èƒ½çœŸæ­£å†™å‡º<strong>ç”Ÿäº§å¯ç”¨ã€é«˜å¯é ã€é«˜å¯ç”¨</strong>çš„æ¶ˆæ¯æœåŠ¡ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ã€èŠ‚ç‚¹ã€‘[HDSceneColorèŠ‚ç‚¹]åŸç†è§£æä¸å®é™…åº”ç”¨]]></title>    <link>https://juejin.cn/post/7604853010162499647</link>    <guid>https://juejin.cn/post/7604853010162499647</guid>    <pubDate>2026-02-10T01:54:00.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604853010162499647" data-draft-id="7604853010162483263" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ã€èŠ‚ç‚¹ã€‘[HDSceneColorèŠ‚ç‚¹]åŸç†è§£æä¸å®é™…åº”ç”¨"/> <meta itemprop="keywords" content="æ¸¸æˆå¼€å‘,å›¾å½¢å­¦,Unity3D"/> <meta itemprop="datePublished" content="2026-02-10T01:54:00.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="SmalBox"/> <meta itemprop="url" content="https://juejin.cn/user/2218166695237532"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ã€èŠ‚ç‚¹ã€‘[HDSceneColorèŠ‚ç‚¹]åŸç†è§£æä¸å®é™…åº”ç”¨
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2218166695237532/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    SmalBox
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T01:54:00.000Z" title="Tue Feb 10 2026 01:54:00 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»16åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fchenghai37%2Fcategory_13074589.html%3Ffromshare%3Dblogcolumn%26sharetype%3Dblogcolumn%26sharerId%3D13074589%26sharerefer%3DPC%26sharesource%3Dchenghai37%26sharefrom%3Dfrom_link" target="_blank" title="https://blog.csdn.net/chenghai37/category_13074589.html?fromshare=blogcolumn&amp;sharetype=blogcolumn&amp;sharerId=13074589&amp;sharerefer=PC&amp;sharesource=chenghai37&amp;sharefrom=from_link" ref="nofollow noopener noreferrer">ã€Unity Shader Graph ä½¿ç”¨ä¸ç‰¹æ•ˆå®ç°ã€‘</a><strong>ä¸“æ -ç›´è¾¾</strong></p>
</blockquote>
<p>é«˜æ¸…åœºæ™¯é¢œè‰²èŠ‚ç‚¹ï¼ˆHD Scene Color Nodeï¼‰æ˜¯Unityé«˜æ¸…æ¸²æŸ“ç®¡çº¿ï¼ˆHDRPï¼‰ä¸­ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„ç€è‰²å™¨å›¾å½¢èŠ‚ç‚¹ï¼Œå®ƒæ‰©å±•äº†ä¼ ç»Ÿåœºæ™¯é¢œè‰²èŠ‚ç‚¹çš„èƒ½åŠ›ï¼Œä¸ºå¼€å‘è€…æä¾›äº†æ›´ç²¾ç»†çš„é¢œè‰²ç¼“å†²åŒºè®¿é—®æ§åˆ¶ã€‚è¯¥èŠ‚ç‚¹çš„æ ¸å¿ƒä»·å€¼åœ¨äºèƒ½å¤Ÿè®¿é—®é¢œè‰²ç¼“å†²åŒºçš„Mipmapçº§åˆ«ï¼Œè¿™åœ¨å®ç°å„ç§é«˜çº§æ¸²æŸ“æ•ˆæœæ—¶è‡³å…³é‡è¦ã€‚</p>
<p>åœ¨å®æ—¶æ¸²æŸ“ä¸­ï¼Œé¢œè‰²ç¼“å†²åŒºå­˜å‚¨äº†åœºæ™¯çš„æœ€ç»ˆæ¸²æŸ“ç»“æœï¼Œè€ŒMipmapé“¾åˆ™æ˜¯è¯¥ç¼“å†²åŒºçš„ä¸€ç³»åˆ—é€æ¸é™ä½åˆ†è¾¨ç‡ç‰ˆæœ¬ã€‚HD Scene ColorèŠ‚ç‚¹çš„ç‹¬ç‰¹ä¹‹å¤„åœ¨äºå®ƒå…è®¸ç€è‰²å™¨ç¨‹åºè®¿é—®è¿™äº›ä¸åŒåˆ†è¾¨ç‡çš„é¢œè‰²æ•°æ®ï¼Œä¸ºåå¤„ç†æ•ˆæœã€å±å¹•ç©ºé—´åå°„ã€ç»†èŠ‚å±‚æ¬¡ï¼ˆLODï¼‰ç³»ç»Ÿç­‰é«˜çº§å›¾å½¢åŠŸèƒ½æä¾›äº†æŠ€æœ¯åŸºç¡€ã€‚</p>
<h2 data-id="heading-0">æ¸²æŸ“ç®¡çº¿å…¼å®¹æ€§è¯¦è§£</h2>
<p>HD Scene ColorèŠ‚ç‚¹çš„å¯ç”¨æ€§å®Œå…¨å–å†³äºæ‰€ä½¿ç”¨çš„æ¸²æŸ“ç®¡çº¿ï¼Œè¿™æ˜¯å¼€å‘è€…åœ¨é€‰æ‹©å’Œä½¿ç”¨è¯¥èŠ‚ç‚¹æ—¶å¿…é¡»é¦–å…ˆè€ƒè™‘çš„å› ç´ ã€‚</p>
<p><strong>é«˜æ¸…æ¸²æŸ“ç®¡çº¿ï¼ˆHDRPï¼‰æ”¯æŒ</strong></p>
<ul>
<li>HDRPæ˜¯Unityé’ˆå¯¹é«˜ç«¯å¹³å°å’Œé«˜ç«¯ç¡¬ä»¶è®¾è®¡çš„é«˜ä¿çœŸæ¸²æŸ“è§£å†³æ–¹æ¡ˆ</li>
<li>HD Scene ColorèŠ‚ç‚¹ä¸“ä¸ºHDRPè®¾è®¡ï¼Œå……åˆ†åˆ©ç”¨äº†HDRPçš„å¤æ‚æ¸²æŸ“æ¶æ„</li>
<li>åœ¨HDRPä¸­ï¼Œé¢œè‰²ç¼“å†²åŒºé€šå¸¸åŒ…å«HDRï¼ˆé«˜åŠ¨æ€èŒƒå›´ï¼‰æ•°æ®ï¼Œæä¾›äº†æ›´ä¸°å¯Œçš„é¢œè‰²ä¿¡æ¯å’Œäº®åº¦èŒƒå›´</li>
<li>HDRPçš„æ¸²æŸ“è·¯å¾„å…è®¸å¤šä¸ªé¢œè‰²ç¼“å†²åŒºå¹¶å­˜ï¼ŒHD Scene ColorèŠ‚ç‚¹å¯ä»¥è®¿é—®è¿™äº›ç¼“å†²åŒºä¸­çš„ç‰¹å®šæ•°æ®</li>
</ul>
<p><strong>é€šç”¨æ¸²æŸ“ç®¡çº¿ï¼ˆURPï¼‰ä¸æ”¯æŒ</strong></p>
<ul>
<li>URPæ˜¯Unityçš„è½»é‡çº§ã€è·¨å¹³å°æ¸²æŸ“è§£å†³æ–¹æ¡ˆï¼Œè®¾è®¡ç›®æ ‡æ˜¯æ€§èƒ½å’Œæ•ˆç‡</li>
<li>URPä¸æ”¯æŒHD Scene ColorèŠ‚ç‚¹ï¼Œå› ä¸ºå®ƒç®€åŒ–äº†æ¸²æŸ“æ¶æ„ï¼Œä¸åŒ…å«å®Œæ•´çš„Mipmapé¢œè‰²ç¼“å†²åŒºé“¾</li>
<li>åœ¨URPä¸­ï¼Œå¼€å‘è€…åº”ä½¿ç”¨æ ‡å‡†çš„Scene ColorèŠ‚ç‚¹æ¥è®¿é—®åœºæ™¯é¢œè‰²ï¼Œä½†æ— æ³•è®¿é—®ä¸åŒMipçº§åˆ«çš„æ•°æ®</li>
<li>è¿™ç§è®¾è®¡å·®å¼‚åæ˜ äº†URPå’ŒHDRPåœ¨ç›®æ ‡åº”ç”¨åœºæ™¯å’ŒåŠŸèƒ½å¤æ‚åº¦ä¸Šçš„æ ¹æœ¬åŒºåˆ«</li>
</ul>
<p>é€‰æ‹©æ­£ç¡®çš„æ¸²æŸ“ç®¡çº¿å¯¹äºé¡¹ç›®æˆåŠŸè‡³å…³é‡è¦ã€‚å¦‚æœé¡¹ç›®éœ€è¦é«˜çº§é¢œè‰²ç¼“å†²åŒºæ“ä½œã€å¤æ‚çš„åå¤„ç†æ•ˆæœæˆ–é¢å‘é«˜ç«¯ç¡¬ä»¶å¹³å°ï¼ŒHDRPå’ŒHD Scene ColorèŠ‚ç‚¹æ˜¯ç†æƒ³é€‰æ‹©ã€‚è€Œå¯¹äºç§»åŠ¨ç«¯ã€VRæˆ–éœ€è¦å¹¿æ³›å¹³å°å…¼å®¹æ€§çš„é¡¹ç›®ï¼ŒURPå¯èƒ½æ˜¯æ›´åˆé€‚çš„é€‰æ‹©ï¼Œå°½ç®¡å®ƒä¸æ”¯æŒHD Scene ColorèŠ‚ç‚¹çš„æ‰€æœ‰é«˜çº§åŠŸèƒ½ã€‚</p>
<h2 data-id="heading-1">ç«¯å£è¯¦ç»†è¯´æ˜</h2>
<p>HD Scene ColorèŠ‚ç‚¹çš„ä¸‰ä¸ªç«¯å£åˆ†åˆ«æ‰¿æ‹…ç€ä¸åŒçš„åŠŸèƒ½ï¼Œç†è§£æ¯ä¸ªç«¯å£çš„ç‰¹æ€§å’Œç”¨æ³•æ˜¯å®ç°é¢„æœŸè§†è§‰æ•ˆæœçš„å…³é”®ã€‚</p>
<h3 data-id="heading-2">UVè¾“å…¥ç«¯å£</h3>
<p>UVè¾“å…¥ç«¯å£æ˜¯èŠ‚ç‚¹ä¸­æœ€å¸¸ç”¨çš„è¾“å…¥ä¹‹ä¸€ï¼Œå®ƒå®šä¹‰äº†åœ¨é¢œè‰²ç¼“å†²åŒºä¸­é‡‡æ ·çš„ä½ç½®ã€‚</p>
<p><strong>æ•°æ®ç±»å‹ä¸ç»‘å®š</strong></p>
<ul>
<li>UVç«¯å£æ¥å—Vector 4ç±»å‹çš„è¾“å…¥ï¼Œæä¾›äº†è¶³å¤Ÿçš„ç»´åº¦æ¥æ”¯æŒå„ç§é‡‡æ ·åæ ‡ç³»ç»Ÿ</li>
<li>è¯¥ç«¯å£é»˜è®¤ç»‘å®šåˆ°å±å¹•ä½ç½®ï¼ˆScreen Positionï¼‰ï¼Œè¿™æ„å‘³ç€å¦‚æœä¸æ˜¾å¼è¿æ¥å…¶ä»–å€¼ï¼ŒèŠ‚ç‚¹å°†ä½¿ç”¨å½“å‰åƒç´ çš„å±å¹•åæ ‡è¿›è¡Œé‡‡æ ·</li>
<li>å±å¹•åæ ‡é€šå¸¸æ˜¯å½’ä¸€åŒ–çš„ï¼ŒèŒƒå›´åœ¨[0,1]ä¹‹é—´ï¼Œå…¶ä¸­(0,0)è¡¨ç¤ºå±å¹•å·¦ä¸‹è§’ï¼Œ(1,1)è¡¨ç¤ºå±å¹•å³ä¸Šè§’</li>
</ul>
<p><strong>é«˜çº§ä½¿ç”¨æŠ€å·§</strong></p>
<ul>
<li>å¯ä»¥é€šè¿‡è¿æ¥å…¶ä»–èŠ‚ç‚¹æ¥ä¿®æ”¹UVå€¼ï¼Œå®ç°å¹³ç§»ã€æ—‹è½¬ã€ç¼©æ”¾ç­‰é‡‡æ ·æ•ˆæœ</li>
<li>ä½¿ç”¨æ—¶é—´å˜é‡åŠ¨ç”»UVåæ ‡å¯ä»¥åˆ›å»ºåŠ¨æ€é‡‡æ ·æ•ˆæœï¼Œå¦‚å±å¹•æ³¢åŠ¨ã€çƒ­æµªæ‰­æ›²ç­‰</li>
<li>é€šè¿‡åç§»UVåæ ‡ï¼Œå¯ä»¥å®ç°è§†å·®æ•ˆæœã€ä¼ªåå°„å’Œå…¶ä»–åŸºäºå±å¹•ç©ºé—´çš„å˜å½¢</li>
<li>åœ¨å¤šæ‘„åƒæœºè®¾ç½®ä¸­ï¼Œéœ€è¦æ³¨æ„UVåæ ‡çš„å‚è€ƒç³»ï¼Œç¡®ä¿é‡‡æ ·æ­£ç¡®çš„æ‘„åƒæœºé¢œè‰²ç¼“å†²åŒº</li>
</ul>
<p><strong>å®é™…åº”ç”¨ç¤ºä¾‹</strong></p>
<p>å‡è®¾æˆ‘ä»¬æƒ³åˆ›å»ºä¸€ä¸ªç®€å•çš„å±å¹•æ‰­æ›²æ•ˆæœï¼Œå¯ä»¥è¿æ¥ä¸€ä¸ªæ­£å¼¦æ³¢èŠ‚ç‚¹åˆ°UVç«¯å£çš„Xå’ŒYåˆ†é‡ï¼Œä½¿é‡‡æ ·ä½ç½®éšæ—¶é—´è½»å¾®æ³¢åŠ¨ï¼Œæ¨¡æ‹Ÿçƒ­é‡ haze æˆ–æ°´ä¸‹çš„æŠ˜å°„æ•ˆæœã€‚</p>
<h3 data-id="heading-3">Lodè¾“å…¥ç«¯å£</h3>
<p>Lodï¼ˆLevel of Detailï¼‰è¾“å…¥ç«¯å£æ˜¯HD Scene ColorèŠ‚ç‚¹åŒºåˆ«äºæ™®é€šScene ColorèŠ‚ç‚¹çš„å…³é”®ç‰¹æ€§ï¼Œå®ƒæ§åˆ¶ç€é‡‡æ ·æ—¶ä½¿ç”¨çš„Mipmapçº§åˆ«ã€‚</p>
<p><strong>MipmapåŸºç¡€æ¦‚å¿µ</strong></p>
<ul>
<li>Mipmapæ˜¯åŸå§‹çº¹ç†çš„ä¸€ç³»åˆ—ç¼©å°ç‰ˆæœ¬ï¼Œæ¯ä¸ªåç»­çº§åˆ«çš„åˆ†è¾¨ç‡å‡åŠ</li>
<li>åœ¨å®æ—¶æ¸²æŸ“ä¸­ï¼ŒMipmapä¸»è¦ç”¨äºå‡å°‘è¿œå¤„è¡¨é¢çš„é”¯é½¿å’Œæé«˜ç¼“å­˜æ•ˆç‡</li>
<li>HD Scene ColorèŠ‚ç‚¹å…è®¸è®¿é—®é¢œè‰²ç¼“å†²åŒºçš„Mipmapé“¾ï¼Œè¿™æ„å‘³ç€å¯ä»¥é‡‡æ ·åˆ°ä¸åŒåˆ†è¾¨ç‡çš„åœºæ™¯é¢œè‰²æ•°æ®</li>
</ul>
<p><strong>Lodç«¯å£ç‰¹æ€§</strong></p>
<ul>
<li>Lodç«¯å£æ¥å—Floatç±»å‹çš„è¾“å…¥ï¼Œè¡¨ç¤ºè¦é‡‡æ ·çš„Mipçº§åˆ«</li>
<li>å€¼ä¸º0è¡¨ç¤ºæœ€é«˜åˆ†è¾¨ç‡çš„åŸå§‹é¢œè‰²ç¼“å†²åŒº</li>
<li>å€¼æ¯å¢åŠ 1ï¼Œå¯¹åº”çš„Mipçº§åˆ«åˆ†è¾¨ç‡å‡åŠï¼ˆçº§åˆ«1ä¸º1/2åˆ†è¾¨ç‡ï¼Œçº§åˆ«2ä¸º1/4åˆ†è¾¨ç‡ï¼Œä»¥æ­¤ç±»æ¨ï¼‰</li>
<li>æ”¯æŒå°æ•°å€¼ï¼Œå…è®¸åœ¨ä¸‰çº¿æ€§è¿‡æ»¤æ¨¡å¼ä¸‹åœ¨Mipçº§åˆ«ä¹‹é—´å¹³æ»‘æ’å€¼</li>
</ul>
<p><strong>Lodå€¼çš„è®¡ç®—ä¸ä½¿ç”¨</strong></p>
<ul>
<li>å¯ä»¥ç›´æ¥è¿æ¥å¸¸é‡å€¼æ¥å›ºå®šMipçº§åˆ«</li>
<li>å¯ä»¥æ ¹æ®åƒç´ åˆ°æ‘„åƒæœºçš„è·ç¦»åŠ¨æ€è®¡ç®—Lodå€¼ï¼Œå®ç°è‡ªé€‚åº”ç»†èŠ‚çº§åˆ«</li>
<li>å¯ä»¥ä½¿ç”¨å±å¹•ç©ºé—´å¯¼æ•°å‡½æ•°ï¼ˆå¦‚ddx/ddyï¼‰æ¥è®¡ç®—åŸºäºå±€éƒ¨å‡ ä½•å¤æ‚åº¦çš„Lodå€¼</li>
<li>åœ¨åå¤„ç†æ•ˆæœä¸­ï¼Œé€šå¸¸ä½¿ç”¨è¾ƒé«˜çš„Lodå€¼ï¼ˆå¦‚2-4ï¼‰æ¥è·å–æ¨¡ç³Šçš„åœºæ™¯é¢œè‰²ï¼Œç”¨äºæ³›å…‰ã€æ™¯æ·±ç­‰æ•ˆæœ</li>
</ul>
<p><strong>æ€§èƒ½è€ƒè™‘</strong></p>
<ul>
<li>é‡‡æ ·è¾ƒé«˜çš„Mipçº§åˆ«ï¼ˆè¾ƒä½åˆ†è¾¨ç‡ï¼‰é€šå¸¸æ›´å¿«ï¼Œå› ä¸ºéœ€è¦å¤„ç†çš„æ•°æ®æ›´å°‘</li>
<li>ä½†æ˜¯ï¼Œé¢‘ç¹åœ¨ä¸åŒMipçº§åˆ«ä¹‹é—´åˆ‡æ¢å¯èƒ½å¯¼è‡´ç¼“å­˜æ•ˆç‡é™ä½</li>
<li>åœ¨æ€§èƒ½æ•æ„Ÿçš„åœºæ™¯ä¸­ï¼Œåº”å¹³è¡¡è§†è§‰æ•ˆæœéœ€æ±‚å’Œæ€§èƒ½å¼€é”€</li>
</ul>
<h3 data-id="heading-4">è¾“å‡ºç«¯å£</h3>
<p>è¾“å‡ºç«¯å£æä¾›ä»é¢œè‰²ç¼“å†²åŒºæŒ‡å®šä½ç½®å’ŒMipçº§åˆ«é‡‡æ ·å¾—åˆ°çš„é¢œè‰²å€¼ã€‚</p>
<p><strong>è¾“å‡ºç‰¹æ€§</strong></p>
<ul>
<li>è¾“å‡ºä¸ºVector 3ç±»å‹ï¼Œå¯¹åº”RGBé¢œè‰²ç©ºé—´ä¸­çš„çº¢ã€ç»¿ã€è“ä¸‰ä¸ªé€šé“</li>
<li>é¢œè‰²å€¼é€šå¸¸ä½äºHDRèŒƒå›´å†…ï¼Œå¯èƒ½åŒ…å«è¶…è¿‡[0,1]ä¼ ç»ŸèŒƒå›´çš„å€¼</li>
<li>è¾“å‡ºé¢œè‰²å·²ç»è¿‡å½“å‰æ‘„åƒæœºçš„è‰²è°ƒæ˜ å°„å’Œé¢œè‰²åˆ†çº§å¤„ç†ï¼ˆé™¤éåœ¨ç‰¹æ®Šæ¸²æŸ“é€šé“ä¸­ï¼‰</li>
</ul>
<p><strong>é¢œè‰²ç©ºé—´æ³¨æ„äº‹é¡¹</strong></p>
<ul>
<li>åœ¨HDRPä¸­ï¼Œé¢œè‰²æ•°æ®å¯èƒ½åœ¨çº¿æ€§ç©ºé—´æˆ–ä¼½é©¬ç©ºé—´ï¼Œå–å†³äºé¡¹ç›®è®¾ç½®</li>
<li>è¿›è¡Œé¢œè‰²æ“ä½œæ—¶ï¼Œç¡®ä¿äº†è§£å½“å‰å·¥ä½œé¢œè‰²ç©ºé—´ï¼Œé¿å…ä¸æ­£ç¡®çš„ç»“æœ</li>
<li>å½“ä¸å…¶ä»–é¢œè‰²å€¼æ··åˆæˆ–æ“ä½œæ—¶ï¼Œå¯èƒ½éœ€è¦æ‰‹åŠ¨è¿›è¡Œé¢œè‰²ç©ºé—´è½¬æ¢</li>
</ul>
<p><strong>è¾“å‡ºæ•°æ®çš„åç»­å¤„ç†</strong></p>
<ul>
<li>é‡‡æ ·å¾—åˆ°çš„é¢œè‰²å¯ä»¥ç”¨äºå„ç§è®¡ç®—ï¼šäº®åº¦æå–ã€é¢œè‰²æ“ä½œã€ä¸å…¶ä»–çº¹ç†æ··åˆç­‰</li>
<li>åœ¨è‡ªå®šä¹‰åå¤„ç†æ•ˆæœä¸­ï¼ŒHD Scene ColorèŠ‚ç‚¹çš„è¾“å‡ºé€šå¸¸ä½œä¸ºä¸»è¦è¾“å…¥ä¹‹ä¸€</li>
<li>å¯ä»¥é€šè¿‡è¿æ¥å…¶ä»–ç€è‰²å™¨å›¾å½¢èŠ‚ç‚¹å¯¹è¾“å‡ºé¢œè‰²è¿›è¡Œè¿›ä¸€æ­¥å¤„ç†ï¼šåº”ç”¨é¢œè‰²æ›²çº¿ã€è°ƒæ•´é¥±å’Œåº¦ã€å®æ–½é¢œè‰²æ›¿æ¢ç­‰</li>
</ul>
<h2 data-id="heading-5">æ›å…‰æ§åˆ¶æ·±å…¥è§£æ</h2>
<p>æ›å…‰æ§åˆ¶æ˜¯HD Scene ColorèŠ‚ç‚¹ä¸­ä¸€ä¸ªå¾®å¦™ä½†é‡è¦çš„ç‰¹æ€§ï¼Œæ­£ç¡®ç†è§£å’Œä½¿ç”¨å®ƒå¯¹å®ç°é¢„æœŸçš„è§†è§‰æ•ˆæœè‡³å…³é‡è¦ã€‚</p>
<h3 data-id="heading-6">æ›å…‰å±æ€§åŸºç¡€</h3>
<p>æ›å…‰å±æ€§å†³å®šäº†èŠ‚ç‚¹è¾“å‡ºé¢œè‰²æ—¶æ˜¯å¦åº”ç”¨äº†åœºæ™¯çš„æ›å…‰è®¾ç½®ã€‚</p>
<p><strong>å¯ç”¨æ›å…‰</strong></p>
<ul>
<li>å½“Exposureå±æ€§å¯ç”¨æ—¶ï¼Œè¾“å‡ºé¢œè‰²ä¼šä¹˜ä»¥å½“å‰æ‘„åƒæœºçš„æ›å…‰å€¼</li>
<li>è¿™é€‚ç”¨äºå¤§å¤šæ•°æ ‡å‡†æ¸²æŸ“æƒ…å†µï¼Œç¡®ä¿é¢œè‰²ä¸åœºæ™¯ä¸­çš„å…¶ä»–å…ƒç´ ä¸€è‡´</li>
<li>åœ¨è‡ªåŠ¨æ›å…‰ï¼ˆè‡ªé€‚åº”æ›å…‰ï¼‰æƒ…å†µä¸‹ï¼Œè¾“å‡ºé¢œè‰²ä¼šéšæ›å…‰è°ƒæ•´è€ŒåŠ¨æ€å˜åŒ–</li>
</ul>
<p><strong>ç¦ç”¨æ›å…‰</strong></p>
<ul>
<li>å½“Exposureå±æ€§ç¦ç”¨æ—¶ï¼Œè¾“å‡ºé¢œè‰²ä¸ä¼šåº”ç”¨æ›å…‰è°ƒæ•´</li>
<li>è¿™å¯ä»¥é˜²æ­¢åœ¨å·²ç»åº”ç”¨äº†æ›å…‰çš„é¢œè‰²ä¸Šé‡å¤åº”ç”¨æ›å…‰ï¼Œé¿å…è¿‡åº¦æ˜äº®æˆ–é»‘æš—çš„ç»“æœ</li>
<li>åœ¨åå¤„ç†æ•ˆæœä¸­ï¼Œé€šå¸¸éœ€è¦ç¦ç”¨æ›å…‰ï¼Œå› ä¸ºåå¤„ç†æ ˆé€šå¸¸æœ‰è‡ªå·±ç‹¬ç«‹çš„æ›å…‰æ§åˆ¶</li>
</ul>
<h3 data-id="heading-7">æ›å…‰ä¸HDRæ¸²æŸ“</h3>
<p>åœ¨é«˜åŠ¨æ€èŒƒå›´æ¸²æŸ“ä¸­ï¼Œæ›å…‰æ§åˆ¶å°¤ä¸ºé‡è¦ã€‚</p>
<p><strong>HDRé¢œè‰²å€¼</strong></p>
<ul>
<li>åœ¨HDRPä¸­ï¼Œé¢œè‰²ç¼“å†²åŒºé€šå¸¸å­˜å‚¨è¶…è¿‡ä¼ ç»Ÿ[0,1]èŒƒå›´çš„å€¼</li>
<li>è¿™äº›å€¼è¡¨ç¤ºåœºæ™¯ä¸­çœŸå®çš„ç‰©ç†å…‰ç…§æ°´å¹³ï¼Œå¯èƒ½ä»ææš—åˆ°æäº®</li>
<li>è‰²è°ƒæ˜ å°„è¿‡ç¨‹å°†è¿™äº›HDRå€¼è½¬æ¢ä¸ºæ˜¾ç¤ºè®¾å¤‡èƒ½å¤Ÿå¤„ç†çš„LDRï¼ˆä½åŠ¨æ€èŒƒå›´ï¼‰å€¼</li>
</ul>
<p><strong>æ›å…‰åœ¨è‰²è°ƒæ˜ å°„ä¸­çš„ä½œç”¨</strong></p>
<ul>
<li>æ›å…‰æ˜¯è‰²è°ƒæ˜ å°„è¿‡ç¨‹ä¸­çš„å…³é”®å‚æ•°ï¼Œæ§åˆ¶ç€HDRåˆ°LDRçš„è½¬æ¢</li>
<li>é€‚å½“çš„æ›å…‰è®¾ç½®ç¡®ä¿åœºæ™¯ä¸­çš„é‡è¦ç»†èŠ‚åœ¨æœ€ç»ˆå›¾åƒä¸­å¯è§</li>
<li>HD Scene ColorèŠ‚ç‚¹çš„æ›å…‰è®¾ç½®å†³å®šäº†é‡‡æ ·é¢œè‰²æ˜¯å¦å·²ç»è¿‡è¿™ä¸ªè½¬æ¢è¿‡ç¨‹</li>
</ul>
<h3 data-id="heading-8">é¿å…åŒé‡æ›å…‰é—®é¢˜</h3>
<p>åŒé‡æ›å…‰æ˜¯ä½¿ç”¨HD Scene ColorèŠ‚ç‚¹æ—¶å¸¸è§çš„é”™è¯¯ï¼Œä¼šå¯¼è‡´é¢œè‰²è®¡ç®—ä¸æ­£ç¡®ã€‚</p>
<p><strong>åŒé‡æ›å…‰çš„æˆå› </strong></p>
<ul>
<li>å½“é¢œè‰²ç¼“å†²åŒºä¸­çš„æ•°æ®å·²ç»åº”ç”¨äº†æ›å…‰ï¼Œè€ŒèŠ‚ç‚¹å†æ¬¡åº”ç”¨æ›å…‰æ—¶å‘ç”Ÿ</li>
<li>è¿™ä¼šå¯¼è‡´é¢œè‰²å€¼è¢«ä¸¤æ¬¡ä¹˜ä»¥æ›å…‰å€¼ï¼Œäº§ç”Ÿè¿‡åº¦æ˜äº®æˆ–é¥±å’Œçš„ç»“æœ</li>
<li>åœ¨åå¤„ç†æ•ˆæœä¸­ç‰¹åˆ«å¸¸è§ï¼Œå› ä¸ºåå¤„ç†é€šå¸¸åœ¨å…¨å±é€šé“ä¸­æ‰§è¡Œï¼Œå·²ç»åŒ…å«äº†æ›å…‰ä¿¡æ¯</li>
</ul>
<p><strong>è¯†åˆ«åŒé‡æ›å…‰</strong></p>
<ul>
<li>æ¸²æŸ“ç»“æœå¼‚å¸¸æ˜äº®æˆ–é»‘æš—ï¼Œä¸åœºæ™¯ç…§æ˜ä¸ç¬¦</li>
<li>é¢œè‰²é¥±å’Œåº¦å¼‚å¸¸é«˜ï¼Œç‰¹åˆ«æ˜¯åœ¨æ˜äº®åŒºåŸŸ</li>
<li>å½“è°ƒæ•´æ‘„åƒæœºæ›å…‰æ—¶ï¼Œæ•ˆæœå¼ºåº¦å˜åŒ–å¼‚å¸¸å‰§çƒˆ</li>
</ul>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong></p>
<ul>
<li>åœ¨å¤§å¤šæ•°åå¤„ç†åœºæ™¯ä¸­ï¼Œåº”ç¦ç”¨HD Scene ColorèŠ‚ç‚¹çš„Exposureå±æ€§</li>
<li>å¦‚æœéœ€è¦åœ¨ç€è‰²å™¨ä¸­æ‰‹åŠ¨åº”ç”¨æ›å…‰ï¼Œå¯ä»¥ä½¿ç”¨ExposureèŠ‚ç‚¹å’Œå½“å‰æ›å…‰å€¼</li>
<li>æµ‹è¯•æ—¶ï¼Œå°è¯•åˆ‡æ¢Exposureå±æ€§ï¼Œè§‚å¯Ÿç»“æœå˜åŒ–ï¼Œç¡®å®šæ­£ç¡®çš„è®¾ç½®</li>
</ul>
<h2 data-id="heading-9">é‡‡æ ·å™¨æ¨¡å¼è¯¦è§£</h2>
<p>HD Scene ColorèŠ‚ç‚¹ä½¿ç”¨çš„ä¸‰çº¿æ€§é’³ä½æ¨¡å¼é‡‡æ ·å™¨å¯¹é‡‡æ ·è´¨é‡å’Œæ€§èƒ½æœ‰é‡è¦å½±å“ã€‚</p>
<h3 data-id="heading-10">ä¸‰çº¿æ€§è¿‡æ»¤åŸç†</h3>
<p>ä¸‰çº¿æ€§è¿‡æ»¤æ˜¯ä¸€ç§é«˜çº§çº¹ç†è¿‡æ»¤æŠ€æœ¯ï¼Œç»“åˆäº†åŒçº¿æ€§è¿‡æ»¤å’ŒMipmapæ’å€¼ã€‚</p>
<p><strong>åŒçº¿æ€§è¿‡æ»¤</strong></p>
<ul>
<li>åœ¨å•ä¸ªMipçº§åˆ«å†…ï¼Œå¯¹å››ä¸ªæœ€è¿‘çš„çº¹ç´ è¿›è¡ŒåŠ æƒå¹³å‡</li>
<li>å‡å°‘äº†è¿‘è·ç¦»è§‚å¯Ÿçº¹ç†æ—¶çš„å—çŠ¶åƒç´ åŒ–ç°è±¡</li>
<li>ä½†ä¸èƒ½è§£å†³è¿œå¤„è¡¨é¢çš„é—ªçƒå’Œé”¯é½¿é—®é¢˜</li>
</ul>
<p><strong>Mipmapæ’å€¼</strong></p>
<ul>
<li>åœ¨ä¸¤ä¸ªæœ€è¿‘çš„Mipçº§åˆ«ä¹‹é—´è¿›è¡Œæ’å€¼</li>
<li>æ ¹æ®åƒç´ åœ¨å±å¹•ä¸Šçš„å¤§å°è‡ªåŠ¨é€‰æ‹©åˆé€‚çš„ç»†èŠ‚çº§åˆ«</li>
<li>è§£å†³äº†è¿œå¤„è¡¨é¢çš„é—ªçƒå’Œè«å°”å›¾æ¡ˆé—®é¢˜</li>
</ul>
<p><strong>ä¸‰çº¿æ€§è¿‡æ»¤</strong></p>
<ul>
<li>ç»“åˆäº†åŒçº¿æ€§è¿‡æ»¤å’ŒMipmapæ’å€¼</li>
<li>é¦–å…ˆåœ¨ä¸¤ä¸ªMipçº§åˆ«ä¸Šåˆ†åˆ«æ‰§è¡ŒåŒçº¿æ€§è¿‡æ»¤</li>
<li>ç„¶ååœ¨ä¸¤ä¸ªè¿‡æ»¤ç»“æœä¹‹é—´è¿›è¡Œçº¿æ€§æ’å€¼</li>
<li>æä¾›äº†å¹³æ»‘çš„ç»†èŠ‚è¿‡æ¸¡ï¼Œæ¶ˆé™¤äº†Mipçº§åˆ«ä¹‹é—´çš„çªç„¶å˜åŒ–</li>
</ul>
<h3 data-id="heading-11">é’³ä½æ¨¡å¼ç‰¹æ€§</h3>
<p>é’³ä½æ¨¡å¼å®šä¹‰äº†å½“é‡‡æ ·åæ ‡è¶…å‡ºæ ‡å‡†[0,1]èŒƒå›´æ—¶çš„é‡‡æ ·è¡Œä¸ºã€‚</p>
<p><strong>æ ‡å‡†é’³ä½è¡Œä¸º</strong></p>
<ul>
<li>å½“UVåæ ‡å°äº0æ—¶ï¼Œä½¿ç”¨è¾¹ç•Œå¤„çš„é¢œè‰²å€¼ï¼ˆUVä¸º0æ—¶çš„é¢œè‰²ï¼‰</li>
<li>å½“UVåæ ‡å¤§äº1æ—¶ï¼Œä½¿ç”¨è¾¹ç•Œå¤„çš„é¢œè‰²å€¼ï¼ˆUVä¸º1æ—¶çš„é¢œè‰²ï¼‰</li>
<li>è¿™é˜²æ­¢äº†é‡‡æ ·å™¨åœ¨çº¹ç†è¾¹ç•Œå¤–é‡‡æ ·ï¼Œé¿å…äº†æ„å¤–è¡Œä¸º</li>
</ul>
<p><strong>ä¸å…¶ä»–æ¨¡å¼çš„æ¯”è¾ƒ</strong></p>
<ul>
<li>é‡å¤ï¼ˆWrapï¼‰æ¨¡å¼ä¼šåœ¨è¶…å‡ºè¾¹ç•Œæ—¶é‡å¤çº¹ç†</li>
<li>é•œåƒï¼ˆMirrorï¼‰æ¨¡å¼ä¼šé•œåƒçº¹ç†</li>
<li>è¾¹æ¡†ï¼ˆBorderï¼‰æ¨¡å¼ä¼šä½¿ç”¨æŒ‡å®šçš„è¾¹æ¡†é¢œè‰²</li>
<li>å¯¹äºå±å¹•ç©ºé—´é‡‡æ ·ï¼Œé’³ä½æ¨¡å¼é€šå¸¸æ˜¯æœ€åˆé€‚çš„é€‰æ‹©ï¼Œå› ä¸ºå®ƒç¬¦åˆå±å¹•è¾¹ç•Œçš„ç‰©ç†ç‰¹æ€§</li>
</ul>
<h3 data-id="heading-12">æ€§èƒ½å½±å“ä¸ä¼˜åŒ–</h3>
<p>ä¸‰çº¿æ€§é’³ä½é‡‡æ ·è™½ç„¶è´¨é‡é«˜ï¼Œä½†ä¹Ÿæœ‰æ€§èƒ½æˆæœ¬ã€‚</p>
<p><strong>æ€§èƒ½è€ƒè™‘</strong></p>
<ul>
<li>ä¸‰çº¿æ€§è¿‡æ»¤éœ€è¦è®¿é—®8ä¸ªçº¹ç´ ï¼ˆä¸¤ä¸ªMipçº§åˆ«å„4ä¸ªï¼‰ï¼Œè€ŒåŒçº¿æ€§åªéœ€4ä¸ª</li>
<li>è¿™å¢åŠ äº†å†…å­˜å¸¦å®½éœ€æ±‚å’Œçº¹ç†ç¼“å­˜å‹åŠ›</li>
<li>åœ¨æ€§èƒ½æ•æ„Ÿçš„åœºæ™¯ä¸­ï¼Œå¯èƒ½éœ€è¦æƒè¡¡è´¨é‡ä¸æ€§èƒ½</li>
</ul>
<p><strong>ä¼˜åŒ–ç­–ç•¥</strong></p>
<ul>
<li>å¯¹äºä¸éœ€è¦é«˜è´¨é‡è¿‡æ»¤çš„æ•ˆæœï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨åŒçº¿æ€§é‡‡æ ·</li>
<li>é€šè¿‡é€‚å½“è®¾ç½®Lodå€¼ï¼Œå¯ä»¥å‡å°‘ä¸å¿…è¦çš„Mipçº§åˆ«æ’å€¼</li>
<li>åœ¨ç§»åŠ¨å¹³å°æˆ–ä½ç«¯ç¡¬ä»¶ä¸Šï¼Œå¯ä»¥è€ƒè™‘å‡å°‘ä¸‰çº¿æ€§è¿‡æ»¤çš„ä½¿ç”¨èŒƒå›´</li>
</ul>
<h2 data-id="heading-13">å®é™…åº”ç”¨æ¡ˆä¾‹</h2>
<p>HD Scene ColorèŠ‚ç‚¹åœ¨å®è·µä¸­æœ‰å¤šç§åº”ç”¨ï¼Œä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„ä½¿ç”¨åœºæ™¯ã€‚</p>
<h3 data-id="heading-14">å±å¹•ç©ºé—´åå°„</h3>
<p>å±å¹•ç©ºé—´åå°„ï¼ˆSSRï¼‰æ˜¯HD Scene ColorèŠ‚ç‚¹çš„ç»å…¸åº”ç”¨ä¹‹ä¸€ã€‚</p>
<p><strong>åŸºæœ¬åŸç†</strong></p>
<ul>
<li>é€šè¿‡å°„çº¿è¡Œè¿›åœ¨å±å¹•ç©ºé—´ä¸­æŸ¥æ‰¾åå°„è¡¨é¢</li>
<li>ä½¿ç”¨HD Scene ColorèŠ‚ç‚¹é‡‡æ ·åå°„æ–¹å‘ä¸Šçš„åœºæ™¯é¢œè‰²</li>
<li>é€šè¿‡é€‚å½“çš„Lodè®¾ç½®å‡å°‘åå°„ä¸­çš„å™ªç‚¹å’Œé—ªçƒ</li>
</ul>
<p><strong>å®ç°æ­¥éª¤</strong></p>
<ul>
<li>è®¡ç®—å½“å‰åƒç´ çš„åå°„å‘é‡</li>
<li>åœ¨åå°„æ–¹å‘ä¸Šè¿›è¡Œå°„çº¿è¡Œè¿›ï¼Œæ£€æµ‹ä¸åœºæ™¯å‡ ä½•çš„ç¢°æ’</li>
<li>ä½¿ç”¨ç¢°æ’ç‚¹çš„å±å¹•åæ ‡ä½œä¸ºUVè¾“å…¥HD Scene ColorèŠ‚ç‚¹</li>
<li>æ ¹æ®å°„çº¿è¡Œè¿›è·ç¦»å’Œè¡¨é¢ç²—ç³™åº¦è®¾ç½®é€‚å½“çš„Lodå€¼</li>
<li>å°†é‡‡æ ·å¾—åˆ°çš„åå°„é¢œè‰²ä¸è¡¨é¢é¢œè‰²æ··åˆ</li>
</ul>
<p><strong>ä¼˜åŒ–æŠ€å·§</strong></p>
<ul>
<li>ä½¿ç”¨åˆ†å±‚å°„çº¿è¡Œè¿›æé«˜æ€§èƒ½</li>
<li>æ ¹æ®è¡¨é¢ç²—ç³™åº¦åŠ¨æ€è°ƒæ•´Lodå€¼â€”â€”ç²—ç³™è¡¨é¢ä½¿ç”¨è¾ƒé«˜Lod</li>
<li>å®æ–½å›é€€æœºåˆ¶ï¼Œå½“å±å¹•ç©ºé—´åå°„å¤±è´¥æ—¶ä½¿ç”¨å…¶ä»–åå°„æŠ€æœ¯</li>
</ul>
<h3 data-id="heading-15">è‡ªå®šä¹‰åå¤„ç†æ•ˆæœ</h3>
<p>HD Scene ColorèŠ‚ç‚¹æ˜¯åˆ›å»ºè‡ªå®šä¹‰åå¤„ç†æ•ˆæœçš„å¼ºå¤§å·¥å…·ã€‚</p>
<p><strong>é¢œè‰²åˆ†çº§æ•ˆæœ</strong></p>
<ul>
<li>é‡‡æ ·åœºæ™¯é¢œè‰²å¹¶è¿›è¡Œéçº¿æ€§é¢œè‰²å˜æ¢</li>
<li>å®ç°è‡ªå®šä¹‰çš„è‰²è°ƒæ˜ å°„æ›²çº¿ã€é¢œè‰²åˆ†çº§è¡¨ï¼ˆLUTï¼‰</li>
<li>åˆ›å»ºé£æ ¼åŒ–çš„è§†è§‰æ•ˆæœï¼Œå¦‚å¤å¤ã€ç”µå½±æ„Ÿæˆ–ç§‘å¹»é£æ ¼</li>
</ul>
<p><strong>ç©ºé—´æ•ˆæœ</strong></p>
<ul>
<li>ä½¿ç”¨æ‰­æ›²çš„UVåæ ‡é‡‡æ ·åœºæ™¯é¢œè‰²ï¼Œåˆ›å»ºçƒ­æµªã€æ°´ä¸‹æŠ˜å°„ç­‰æ•ˆæœ</li>
<li>é€šè¿‡æ—¶é—´å˜åŒ–çš„UVåç§»å®ç°å±å¹•æ³¢åŠ¨æ•ˆæœ</li>
<li>ç»“åˆæ·±åº¦ç¼“å†²åŒºå®ç°åŸºäºè·ç¦»çš„é¢œè‰²æ•ˆæœ</li>
</ul>
<p><strong>å¤šPassæ•ˆæœ</strong></p>
<ul>
<li>åœ¨ç¬¬ä¸€Passä¸­é‡‡æ ·åœºæ™¯é¢œè‰²å¹¶å­˜å‚¨åˆ°è‡ªå®šä¹‰ç¼“å†²åŒº</li>
<li>åœ¨åç»­Passä¸­ç»“åˆHD Scene ColorèŠ‚ç‚¹é‡‡æ ·è¿›è¡Œå¤æ‚æ··åˆ</li>
<li>å®ç°å¦‚è¿åŠ¨æ¨¡ç³Šã€æ™¯æ·±ã€æ³›å…‰ç­‰å¤šé˜¶æ®µåå¤„ç†æ•ˆæœ</li>
</ul>
<h3 data-id="heading-16">é«˜çº§æ··åˆæ¨¡å¼</h3>
<p>HD Scene ColorèŠ‚ç‚¹å¯ä»¥å®ç°è¶…è¶Šæ ‡å‡†æ··åˆæ¨¡å¼çš„å¤æ‚åˆæˆæ•ˆæœã€‚</p>
<p><strong>åŸºäºæ·±åº¦çš„æ··åˆ</strong></p>
<ul>
<li>ç»“åˆæ·±åº¦ç¼“å†²åŒºä¿¡æ¯ï¼Œå®ç°ä»…åœ¨ç‰¹å®šæ·±åº¦èŒƒå›´å†…ç”Ÿæ•ˆçš„æ··åˆ</li>
<li>åˆ›å»ºå¦‚é›¾æ°”ã€æ°´ä¸‹æ°´èŠ±ç­‰åŸºäºè·ç¦»çš„æ•ˆæœ</li>
</ul>
<p><strong>åŸºäºäº®åº¦çš„æ··åˆ</strong></p>
<ul>
<li>æå–é‡‡æ ·é¢œè‰²çš„äº®åº¦ï¼Œç”¨äºæ§åˆ¶æ··åˆå› å­</li>
<li>å®ç°å¦‚æ³›å…‰ã€é•œå¤´å…‰æ™•ç­‰é«˜å…‰ç›¸å…³æ•ˆæœ</li>
</ul>
<p><strong>è‡ªå®šä¹‰å±å¹•ç©ºé—´é®ç½©</strong></p>
<ul>
<li>ä½¿ç”¨HD Scene ColorèŠ‚ç‚¹é‡‡æ ·ç‰¹å®šé¢œè‰²é€šé“ä½œä¸ºé®ç½©</li>
<li>å®ç°ä»…åœ¨å±å¹•ç‰¹å®šåŒºåŸŸç”Ÿæ•ˆçš„æ•ˆæœ</li>
<li>åˆ›å»ºå¦‚ä½“ç§¯å…‰ã€ä¸Šå¸å…‰çº¿ç­‰å±€éƒ¨åå¤„ç†æ•ˆæœ</li>
</ul>
<h2 data-id="heading-17">æ€§èƒ½ä¼˜åŒ–ä¸æœ€ä½³å®è·µ</h2>
<p>æ­£ç¡®ä½¿ç”¨HD Scene ColorèŠ‚ç‚¹å¯¹ä¿æŒåº”ç”¨æ€§èƒ½è‡³å…³é‡è¦ã€‚</p>
<h3 data-id="heading-18">é‡‡æ ·æˆæœ¬åˆ†æ</h3>
<p>äº†è§£HD Scene ColorèŠ‚ç‚¹çš„æ€§èƒ½ç‰¹å¾æœ‰åŠ©äºåšå‡ºæ˜æ™ºçš„ä¼˜åŒ–å†³ç­–ã€‚</p>
<p><strong>å½±å“å› ç´ </strong></p>
<ul>
<li>é‡‡æ ·ä½ç½®ï¼ˆUVï¼‰çš„è¿è´¯æ€§å½±å“ç¼“å­˜æ•ˆç‡</li>
<li>Lodå€¼å½±å“è®¿é—®çš„Mipçº§åˆ«å’Œå†…å­˜å¸¦å®½</li>
<li>å±å¹•åˆ†è¾¨ç‡ç›´æ¥å½±å“é‡‡æ ·æ“ä½œçš„ç»å¯¹æ•°é‡</li>
</ul>
<p><strong>æ€§èƒ½ç›‘æ§</strong></p>
<ul>
<li>ä½¿ç”¨Unityçš„Frame Debuggeræˆ–Render Docåˆ†æå…·ä½“é‡‡æ ·æ“ä½œ</li>
<li>ç›‘æ§GPUæ—¶é—´å’Œå†…å­˜å¸¦å®½ä½¿ç”¨æƒ…å†µ</li>
<li>åœ¨ä¸åŒç¡¬ä»¶å¹³å°ä¸Šæµ‹è¯•æ€§èƒ½è¡¨ç°</li>
</ul>
<h3 data-id="heading-19">ä¼˜åŒ–ç­–ç•¥</h3>
<p>å¤šç§ç­–ç•¥å¯ä»¥å¸®åŠ©ä¼˜åŒ–ä½¿ç”¨HD Scene ColorèŠ‚ç‚¹çš„ç€è‰²å™¨æ€§èƒ½ã€‚</p>
<p><strong>å‡å°‘é‡‡æ ·æ¬¡æ•°</strong></p>
<ul>
<li>å°½å¯èƒ½é‡ç”¨é‡‡æ ·ç»“æœï¼Œé¿å…é‡å¤é‡‡æ ·ç›¸åŒä½ç½®</li>
<li>ä½¿ç”¨åŒçº¿æ€§è¿‡æ»¤çš„ä¼˜åŠ¿ï¼Œé€šè¿‡å•æ¬¡é‡‡æ ·è·å–å¹³æ»‘ç»“æœ</li>
<li>åœ¨å¯è¡Œçš„æƒ…å†µä¸‹ï¼Œé™ä½é‡‡æ ·é¢‘ç‡å¹¶ä½¿ç”¨æ’å€¼</li>
</ul>
<p><strong>æ™ºèƒ½Lodé€‰æ‹©</strong></p>
<ul>
<li>æ ¹æ®è§†è§‰æ•ˆæœéœ€æ±‚é€‰æ‹©æœ€ä½å¯æ¥å—çš„Lodçº§åˆ«</li>
<li>å¯¹è¿œå¤„æˆ–æ¬¡è¦æ•ˆæœä½¿ç”¨è¾ƒé«˜Lodçº§åˆ«</li>
<li>åŠ¨æ€è°ƒæ•´Lodçº§åˆ«ï¼Œå¹³è¡¡è´¨é‡ä¸æ€§èƒ½</li>
</ul>
<p><strong>å¹³å°ç‰¹å®šä¼˜åŒ–</strong></p>
<ul>
<li>åœ¨ç§»åŠ¨å¹³å°ä¸Šï¼Œè€ƒè™‘ä½¿ç”¨æ›´ç®€å•çš„é‡‡æ ·ç­–ç•¥</li>
<li>åˆ©ç”¨ç‰¹å®šç¡¬ä»¶çš„çº¹ç†é‡‡æ ·ç‰¹æ€§</li>
<li>ä¸ºä¸åŒæ€§èƒ½çº§åˆ«çš„è®¾å¤‡æä¾›å¤šä¸ªè´¨é‡è®¾ç½®</li>
</ul>
<h2 data-id="heading-20">æ•…éšœæ’é™¤ä¸å¸¸è§é—®é¢˜</h2>
<p>ä½¿ç”¨HD Scene ColorèŠ‚ç‚¹æ—¶å¯èƒ½é‡åˆ°å„ç§é—®é¢˜ï¼Œäº†è§£å¦‚ä½•è¯†åˆ«å’Œè§£å†³è¿™äº›é—®é¢˜å¾ˆé‡è¦ã€‚</p>
<h3 data-id="heading-21">é‡‡æ ·ç»“æœä¸æ­£ç¡®</h3>
<p>å½“HD Scene ColorèŠ‚ç‚¹è¿”å›æ„å¤–ç»“æœæ—¶ï¼Œå¯èƒ½çš„åŸå› å’Œè§£å†³æ–¹æ¡ˆã€‚</p>
<p><strong>UVåæ ‡é—®é¢˜</strong></p>
<ul>
<li>ç¡®è®¤UVåæ ‡åœ¨é¢„æœŸçš„[0,1]èŒƒå›´å†…</li>
<li>æ£€æŸ¥UVåæ ‡æ˜¯å¦åº”ç”¨äº†æ­£ç¡®çš„å˜æ¢</li>
<li>éªŒè¯å±å¹•ä½ç½®æ˜¯å¦æ­£ç¡®è½¬æ¢ä¸ºçº¹ç†åæ ‡</li>
</ul>
<p><strong>Lodè®¾ç½®é—®é¢˜</strong></p>
<ul>
<li>ç¡®è®¤Lodå€¼åœ¨åˆç†èŒƒå›´å†…ï¼Œä¸ä¼šå¯¼è‡´é‡‡æ ·è¿‡ä½åˆ†è¾¨ç‡çš„Mipçº§åˆ«</li>
<li>æ£€æŸ¥Lodè®¡ç®—é€»è¾‘æ˜¯å¦æ­£ç¡®ï¼Œç‰¹åˆ«æ˜¯åŸºäºè·ç¦»æˆ–å¯¼æ•°çš„è®¡ç®—</li>
<li>éªŒè¯ä¸‰çº¿æ€§æ’å€¼æ˜¯å¦æŒ‰é¢„æœŸå·¥ä½œ</li>
</ul>
<p><strong>æ›å…‰ç›¸å…³é—®é¢˜</strong></p>
<ul>
<li>æ£€æŸ¥Exposureå±æ€§è®¾ç½®æ˜¯å¦ç¬¦åˆå½“å‰æ¸²æŸ“ä¸Šä¸‹æ–‡</li>
<li>éªŒè¯æ˜¯å¦å­˜åœ¨åŒé‡æ›å…‰é—®é¢˜</li>
<li>ç¡®è®¤é¢œè‰²ç©ºé—´è½¬æ¢æ˜¯å¦æ­£ç¡®å¤„ç†</li>
</ul>
<h3 data-id="heading-22">æ€§èƒ½é—®é¢˜</h3>
<p>å½“ä½¿ç”¨HD Scene ColorèŠ‚ç‚¹å¯¼è‡´æ€§èƒ½ä¸‹é™æ—¶ï¼Œå¯èƒ½çš„ä¼˜åŒ–æ–¹å‘ã€‚</p>
<p><strong>è¯†åˆ«ç“¶é¢ˆ</strong></p>
<ul>
<li>ä½¿ç”¨æ€§èƒ½åˆ†æå·¥å…·ç¡®å®šæ˜¯ALUç“¶é¢ˆè¿˜æ˜¯å†…å­˜å¸¦å®½ç“¶é¢ˆ</li>
<li>æ£€æŸ¥æ˜¯å¦æœ‰ä¸å¿…è¦çš„é‡å¤é‡‡æ ·æ“ä½œ</li>
<li>è¯„ä¼°é‡‡æ ·é¢‘ç‡æ˜¯å¦é«˜äºè§†è§‰æ•ˆæœæ‰€éœ€</li>
</ul>
<p><strong>ä¼˜åŒ–æ–¹æ¡ˆ</strong></p>
<ul>
<li>å‡å°‘å…¨å±é‡‡æ ·æ“ä½œçš„æ•°é‡å’Œé¢‘ç‡</li>
<li>ä½¿ç”¨è¾ƒä½åˆ†è¾¨ç‡çš„Mipçº§åˆ«ï¼Œç‰¹åˆ«æ˜¯åœ¨åå¤„ç†æ•ˆæœä¸­</li>
<li>è€ƒè™‘ä½¿ç”¨è¿‘ä¼¼æ–¹æ³•æ›¿ä»£ç²¾ç¡®é‡‡æ ·</li>
</ul>
<h3 data-id="heading-23">å¹³å°å…¼å®¹æ€§é—®é¢˜</h3>
<p>åœ¨ä¸åŒå¹³å°æˆ–æ¸²æŸ“è®¾ç½®ä¸‹ï¼ŒHD Scene ColorèŠ‚ç‚¹å¯èƒ½è¡¨ç°å‡ºä¸åŒè¡Œä¸ºã€‚</p>
<p><strong>æ¸²æŸ“ç®¡çº¿å·®å¼‚</strong></p>
<ul>
<li>ç¡®è®¤é¡¹ç›®ä½¿ç”¨çš„æ˜¯HDRPï¼Œå› ä¸ºHD Scene ColorèŠ‚ç‚¹åœ¨URPä¸­ä¸å¯ç”¨</li>
<li>æ£€æŸ¥HDRPç‰ˆæœ¬å’Œé…ç½®ï¼Œç¡®ä¿æ‰€æœ‰å¿…éœ€åŠŸèƒ½å·²å¯ç”¨</li>
<li>éªŒè¯é¢œè‰²ç¼“å†²åŒºå’ŒMipmapé“¾çš„å¯ç”¨æ€§</li>
</ul>
<p><strong>å¹³å°ç‰¹å®šè¡Œä¸º</strong></p>
<ul>
<li>åœ¨ä¸åŒå›¾å½¢APIï¼ˆDirectXã€Vulkanã€Metalï¼‰ä¸‹æµ‹è¯•ç€è‰²å™¨</li>
<li>æ£€æŸ¥ç§»åŠ¨å¹³å°ä¸Šçš„åŠŸèƒ½æ”¯æŒçº§åˆ«</li>
<li>éªŒè¯ç€è‰²å™¨å˜ä½“æ˜¯å¦ä¸ºç›®æ ‡å¹³å°æ­£ç¡®ç¼–è¯‘</li>
</ul>
<hr/>
<blockquote>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fchenghai37%2Fcategory_13074589.html%3Ffromshare%3Dblogcolumn%26sharetype%3Dblogcolumn%26sharerId%3D13074589%26sharerefer%3DPC%26sharesource%3Dchenghai37%26sharefrom%3Dfrom_link" target="_blank" title="https://blog.csdn.net/chenghai37/category_13074589.html?fromshare=blogcolumn&amp;sharetype=blogcolumn&amp;sharerId=13074589&amp;sharerefer=PC&amp;sharesource=chenghai37&amp;sharefrom=from_link" ref="nofollow noopener noreferrer">ã€Unity Shader Graph ä½¿ç”¨ä¸ç‰¹æ•ˆå®ç°ã€‘</a><strong>ä¸“æ -ç›´è¾¾</strong>
ï¼ˆæ¬¢è¿<em>ç‚¹èµç•™è¨€</em>æ¢è®¨ï¼Œæ›´å¤šäººåŠ å…¥è¿›æ¥èƒ½æ›´åŠ å®Œå–„è¿™ä¸ªæ¢ç´¢çš„è¿‡ç¨‹ï¼ŒğŸ™ï¼‰</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ç”¨ Python 5 åˆ†é’Ÿæ­ä¸€ä¸ªå¤šæ¨¡å‹ AI API ç½‘å…³ï¼ˆé™„å®Œæ•´ä»£ç ï¼‰]]></title>    <link>https://juejin.cn/post/7604853010162253887</link>    <guid>https://juejin.cn/post/7604853010162253887</guid>    <pubDate>2026-02-10T01:07:27.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604853010162253887" data-draft-id="7604666872127520787" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ç”¨ Python 5 åˆ†é’Ÿæ­ä¸€ä¸ªå¤šæ¨¡å‹ AI API ç½‘å…³ï¼ˆé™„å®Œæ•´ä»£ç ï¼‰"/> <meta itemprop="keywords" content="Python"/> <meta itemprop="datePublished" content="2026-02-10T01:07:27.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç è·¯é£"/> <meta itemprop="url" content="https://juejin.cn/user/186265609189227"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ç”¨ Python 5 åˆ†é’Ÿæ­ä¸€ä¸ªå¤šæ¨¡å‹ AI API ç½‘å…³ï¼ˆé™„å®Œæ•´ä»£ç ï¼‰
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/186265609189227/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç è·¯é£
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T01:07:27.000Z" title="Tue Feb 10 2026 01:07:27 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>è¿˜åœ¨æ‰‹åŠ¨åˆ‡æ¢ OpenAIã€Claudeã€DeepSeek çš„ APIï¼Ÿå¤ªè ¢äº†ã€‚æœ¬æ–‡æ•™ä½ ç”¨ Python æ­ä¸€ä¸ªç»Ÿä¸€çš„ AI ç½‘å…³ï¼Œä¸€ä¸ªæ¥å£è°ƒæ‰€æœ‰æ¨¡å‹ï¼Œè‡ªåŠ¨æ•…éšœè½¬ç§»ï¼Œä»£ç ä¸åˆ° 100 è¡Œã€‚</p>
</blockquote>
<h2 data-id="heading-0">ä¸ºä»€ä¹ˆéœ€è¦ AI API ç½‘å…³ï¼Ÿ</h2>
<p>å¦‚æœä½ åœ¨åš AI åº”ç”¨å¼€å‘ï¼Œå¤§æ¦‚ç‡é‡åˆ°è¿‡è¿™äº›é—®é¢˜ï¼š</p>
<ul>
<li>OpenAI æŠ½é£äº†ï¼ŒæœåŠ¡æŒ‚äº† 2 å°æ—¶ï¼Œä½ çš„åº”ç”¨è·Ÿç€æŒ‚</li>
<li>DeepSeek å‘å¸ƒæ–°ç‰ˆæœ¬ï¼ŒAPI è¿‡è½½ï¼Œè¯·æ±‚å…¨è¶…æ—¶</li>
<li>è€æ¿çªç„¶è¯´"æˆ‘ä»¬è¯•è¯• Claude"ï¼Œä½ å¾—æ”¹ä¸€å †ä»£ç </li>
<li>ä¸åŒæ¨¡å‹çš„ API æ ¼å¼ä¸ä¸€æ ·ï¼Œé€‚é…èµ·æ¥å¤´ç–¼</li>
</ul>
<p><strong>è¿™äº›é—®é¢˜çš„æœ¬è´¨æ˜¯ï¼šä½ çš„åº”ç”¨ç›´æ¥è€¦åˆäº†æŸä¸ªå…·ä½“çš„æ¨¡å‹ APIã€‚</strong></p>
<p>è§£å†³æ–¹æ¡ˆå¾ˆç®€å•â€”â€”åœ¨ä½ çš„åº”ç”¨å’Œæ¨¡å‹ä¹‹é—´åŠ ä¸€å±‚ç½‘å…³ï¼Œç»Ÿä¸€æ¥å£ã€è‡ªåŠ¨è·¯ç”±ã€æ•…éšœè½¬ç§»ã€‚</p>
<h2 data-id="heading-1">å®Œæ•´ä»£ç ï¼š100 è¡Œçš„ AI ç½‘å…³</h2>
<p>ç›´æ¥ä¸Šä»£ç ï¼ŒPython + FastAPIï¼Œèƒ½è·‘çš„é‚£ç§ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> os
<span class="hljs-keyword">import</span> time
<span class="hljs-keyword">import</span> httpx
<span class="hljs-keyword">import</span> asyncio
<span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI, Request
<span class="hljs-keyword">from</span> fastapi.responses <span class="hljs-keyword">import</span> JSONResponse

app = FastAPI(title=<span class="hljs-string">"AI API Gateway"</span>)

<span class="hljs-comment"># æ¨¡å‹é…ç½®ï¼šæŒ‰ä¼˜å…ˆçº§æ’åˆ—</span>
MODEL_PROVIDERS = [
    {
        <span class="hljs-string">"name"</span>: <span class="hljs-string">"deepseek"</span>,
        <span class="hljs-string">"base_url"</span>: <span class="hljs-string">"https://api.deepseek.com/v1"</span>,
        <span class="hljs-string">"api_key"</span>: os.getenv(<span class="hljs-string">"DEEPSEEK_API_KEY"</span>, <span class="hljs-string">""</span>),
        <span class="hljs-string">"model"</span>: <span class="hljs-string">"deepseek-chat"</span>,
        <span class="hljs-string">"timeout"</span>: <span class="hljs-number">30</span>,
        <span class="hljs-string">"max_retries"</span>: <span class="hljs-number">2</span>,
    },
    {
        <span class="hljs-string">"name"</span>: <span class="hljs-string">"openai"</span>,
        <span class="hljs-string">"base_url"</span>: <span class="hljs-string">"https://api.openai.com/v1"</span>,
        <span class="hljs-string">"api_key"</span>: os.getenv(<span class="hljs-string">"OPENAI_API_KEY"</span>, <span class="hljs-string">""</span>),
        <span class="hljs-string">"model"</span>: <span class="hljs-string">"gpt-4o-mini"</span>,
        <span class="hljs-string">"timeout"</span>: <span class="hljs-number">30</span>,
        <span class="hljs-string">"max_retries"</span>: <span class="hljs-number">1</span>,
    },
    {
        <span class="hljs-string">"name"</span>: <span class="hljs-string">"anthropic"</span>,
        <span class="hljs-string">"base_url"</span>: <span class="hljs-string">"https://api.anthropic.com/v1"</span>,
        <span class="hljs-string">"api_key"</span>: os.getenv(<span class="hljs-string">"ANTHROPIC_API_KEY"</span>, <span class="hljs-string">""</span>),
        <span class="hljs-string">"model"</span>: <span class="hljs-string">"claude-3-5-sonnet-20241022"</span>,
        <span class="hljs-string">"timeout"</span>: <span class="hljs-number">30</span>,
        <span class="hljs-string">"max_retries"</span>: <span class="hljs-number">1</span>,
    },
]

<span class="hljs-comment"># å¥åº·çŠ¶æ€è¿½è¸ª</span>
provider_health = {p[<span class="hljs-string">"name"</span>]: {<span class="hljs-string">"healthy"</span>: <span class="hljs-literal">True</span>, <span class="hljs-string">"last_fail"</span>: <span class="hljs-number">0</span>} <span class="hljs-keyword">for</span> p <span class="hljs-keyword">in</span> MODEL_PROVIDERS}
COOLDOWN_SECONDS = <span class="hljs-number">60</span>  <span class="hljs-comment"># æ•…éšœå†·å´æ—¶é—´</span>


<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">call_provider</span>(<span class="hljs-params">provider: <span class="hljs-built_in">dict</span>, messages: <span class="hljs-built_in">list</span></span>) -&gt; <span class="hljs-built_in">dict</span>:
    <span class="hljs-string">"""è°ƒç”¨å•ä¸ªæ¨¡å‹ä¾›åº”å•†"""</span>
    headers = {
        <span class="hljs-string">"Authorization"</span>: <span class="hljs-string">f"Bearer <span class="hljs-subst">{provider[<span class="hljs-string">'api_key'</span>]}</span>"</span>,
        <span class="hljs-string">"Content-Type"</span>: <span class="hljs-string">"application/json"</span>,
    }

    <span class="hljs-comment"># Anthropic çš„ API æ ¼å¼ç•¥æœ‰ä¸åŒ</span>
    <span class="hljs-keyword">if</span> provider[<span class="hljs-string">"name"</span>] == <span class="hljs-string">"anthropic"</span>:
        headers = {
            <span class="hljs-string">"x-api-key"</span>: provider[<span class="hljs-string">"api_key"</span>],
            <span class="hljs-string">"anthropic-version"</span>: <span class="hljs-string">"2023-06-01"</span>,
            <span class="hljs-string">"Content-Type"</span>: <span class="hljs-string">"application/json"</span>,
        }
        payload = {
            <span class="hljs-string">"model"</span>: provider[<span class="hljs-string">"model"</span>],
            <span class="hljs-string">"max_tokens"</span>: <span class="hljs-number">4096</span>,
            <span class="hljs-string">"messages"</span>: messages,
        }
        url = <span class="hljs-string">f"<span class="hljs-subst">{provider[<span class="hljs-string">'base_url'</span>]}</span>/messages"</span>
    <span class="hljs-keyword">else</span>:
        payload = {
            <span class="hljs-string">"model"</span>: provider[<span class="hljs-string">"model"</span>],
            <span class="hljs-string">"messages"</span>: messages,
            <span class="hljs-string">"max_tokens"</span>: <span class="hljs-number">4096</span>,
        }
        url = <span class="hljs-string">f"<span class="hljs-subst">{provider[<span class="hljs-string">'base_url'</span>]}</span>/chat/completions"</span>

    <span class="hljs-keyword">async</span> <span class="hljs-keyword">with</span> httpx.AsyncClient(timeout=provider[<span class="hljs-string">"timeout"</span>]) <span class="hljs-keyword">as</span> client:
        resp = <span class="hljs-keyword">await</span> client.post(url, json=payload, headers=headers)
        resp.raise_for_status()
        <span class="hljs-keyword">return</span> resp.json()


<span class="hljs-keyword">def</span> <span class="hljs-title function_">normalize_response</span>(<span class="hljs-params">provider_name: <span class="hljs-built_in">str</span>, raw: <span class="hljs-built_in">dict</span></span>) -&gt; <span class="hljs-built_in">dict</span>:
    <span class="hljs-string">"""ç»Ÿä¸€ä¸åŒä¾›åº”å•†çš„å“åº”æ ¼å¼"""</span>
    <span class="hljs-keyword">if</span> provider_name == <span class="hljs-string">"anthropic"</span>:
        content = raw.get(<span class="hljs-string">"content"</span>, [{}])[<span class="hljs-number">0</span>].get(<span class="hljs-string">"text"</span>, <span class="hljs-string">""</span>)
        model = raw.get(<span class="hljs-string">"model"</span>, <span class="hljs-string">""</span>)
    <span class="hljs-keyword">else</span>:
        content = raw[<span class="hljs-string">"choices"</span>][<span class="hljs-number">0</span>][<span class="hljs-string">"message"</span>][<span class="hljs-string">"content"</span>]
        model = raw.get(<span class="hljs-string">"model"</span>, <span class="hljs-string">""</span>)

    <span class="hljs-keyword">return</span> {
        <span class="hljs-string">"content"</span>: content,
        <span class="hljs-string">"model"</span>: model,
        <span class="hljs-string">"provider"</span>: provider_name,
    }


<span class="hljs-meta">@app.post(<span class="hljs-params"><span class="hljs-string">"/v1/chat"</span></span>)</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">chat</span>(<span class="hljs-params">request: Request</span>):
    <span class="hljs-string">"""ç»Ÿä¸€èŠå¤©æ¥å£â€”â€”è‡ªåŠ¨è·¯ç”±åˆ°å¯ç”¨çš„æ¨¡å‹"""</span>
    body = <span class="hljs-keyword">await</span> request.json()
    messages = body.get(<span class="hljs-string">"messages"</span>, [])
    preferred = body.get(<span class="hljs-string">"provider"</span>, <span class="hljs-literal">None</span>)  <span class="hljs-comment"># å¯é€‰ï¼šæŒ‡å®šä¾›åº”å•†</span>

    errors = []

    <span class="hljs-keyword">for</span> provider <span class="hljs-keyword">in</span> MODEL_PROVIDERS:
        name = provider[<span class="hljs-string">"name"</span>]
        health = provider_health[name]

        <span class="hljs-comment"># è·³è¿‡æŒ‡å®šä¾›åº”å•†ä»¥å¤–çš„</span>
        <span class="hljs-keyword">if</span> preferred <span class="hljs-keyword">and</span> name != preferred:
            <span class="hljs-keyword">continue</span>

        <span class="hljs-comment"># è·³è¿‡å†·å´ä¸­çš„ä¾›åº”å•†</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> health[<span class="hljs-string">"healthy"</span>] <span class="hljs-keyword">and</span> time.time() - health[<span class="hljs-string">"last_fail"</span>] &lt; COOLDOWN_SECONDS:
            <span class="hljs-keyword">continue</span>

        <span class="hljs-keyword">try</span>:
            raw = <span class="hljs-keyword">await</span> call_provider(provider, messages)
            provider_health[name][<span class="hljs-string">"healthy"</span>] = <span class="hljs-literal">True</span>
            <span class="hljs-keyword">return</span> JSONResponse(normalize_response(name, raw))

        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
            provider_health[name] = {<span class="hljs-string">"healthy"</span>: <span class="hljs-literal">False</span>, <span class="hljs-string">"last_fail"</span>: time.time()}
            errors.append(<span class="hljs-string">f"<span class="hljs-subst">{name}</span>: <span class="hljs-subst">{<span class="hljs-built_in">str</span>(e)}</span>"</span>)
            <span class="hljs-keyword">continue</span>

    <span class="hljs-keyword">return</span> JSONResponse(
        {<span class="hljs-string">"error"</span>: <span class="hljs-string">"All providers failed"</span>, <span class="hljs-string">"details"</span>: errors},
        status_code=<span class="hljs-number">503</span>,
    )


<span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">"/health"</span></span>)</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">health</span>():
    <span class="hljs-string">"""æŸ¥çœ‹å„ä¾›åº”å•†å¥åº·çŠ¶æ€"""</span>
    <span class="hljs-keyword">return</span> {name: info <span class="hljs-keyword">for</span> name, info <span class="hljs-keyword">in</span> provider_health.items()}
</code></pre>
<h2 data-id="heading-2">æ€ä¹ˆç”¨</h2>
<h3 data-id="heading-3">1. å®‰è£…ä¾èµ–</h3>
<pre><code class="hljs language-bash" lang="bash">pip install fastapi uvicorn httpx
</code></pre>
<h3 data-id="heading-4">2. è®¾ç½® API Key</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">export</span> DEEPSEEK_API_KEY=<span class="hljs-string">"sk-xxx"</span>
<span class="hljs-built_in">export</span> OPENAI_API_KEY=<span class="hljs-string">"sk-xxx"</span>
<span class="hljs-built_in">export</span> ANTHROPIC_API_KEY=<span class="hljs-string">"sk-xxx"</span>
</code></pre>
<h3 data-id="heading-5">3. å¯åŠ¨</h3>
<pre><code class="hljs language-bash" lang="bash">uvicorn gateway:app --port 8000
</code></pre>
<h3 data-id="heading-6">4. è°ƒç”¨</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># è‡ªåŠ¨è·¯ç”±ï¼ˆä¼˜å…ˆ DeepSeekï¼Œå¤±è´¥è‡ªåŠ¨åˆ‡æ¢ï¼‰</span>
curl -X POST http://localhost:8000/v1/chat \
  -H <span class="hljs-string">"Content-Type: application/json"</span> \
  -d <span class="hljs-string">'{"messages": [{"role": "user", "content": "ä½ å¥½"}]}'</span>

<span class="hljs-comment"># æŒ‡å®šä¾›åº”å•†</span>
curl -X POST http://localhost:8000/v1/chat \
  -H <span class="hljs-string">"Content-Type: application/json"</span> \
  -d <span class="hljs-string">'{"messages": [{"role": "user", "content": "ä½ å¥½"}], "provider": "openai"}'</span>

<span class="hljs-comment"># æŸ¥çœ‹å¥åº·çŠ¶æ€</span>
curl http://localhost:8000/health
</code></pre>
<h2 data-id="heading-7">æ ¸å¿ƒè®¾è®¡æ€è·¯</h2>
<h3 data-id="heading-8">1. ä¼˜å…ˆçº§è·¯ç”±</h3>
<p><code>MODEL_PROVIDERS</code> æ•°ç»„çš„é¡ºåºå°±æ˜¯ä¼˜å…ˆçº§ã€‚DeepSeek æ’ç¬¬ä¸€æ˜¯å› ä¸ºæ€§ä»·æ¯”æœ€é«˜ï¼ŒOpenAI å’Œ Claude ä½œä¸ºå¤‡ç”¨ã€‚</p>
<h3 data-id="heading-9">2. è‡ªåŠ¨æ•…éšœè½¬ç§»</h3>
<p>æŸä¸ªä¾›åº”å•†æŠ¥é”™åï¼Œæ ‡è®°ä¸º"ä¸å¥åº·"å¹¶è¿›å…¥ 60 ç§’å†·å´æœŸã€‚åœ¨æ­¤æœŸé—´è·³è¿‡è¯¥ä¾›åº”å•†ï¼Œç›´æ¥å°è¯•ä¸‹ä¸€ä¸ªã€‚å†·å´ç»“æŸåè‡ªåŠ¨æ¢å¤ã€‚</p>
<h3 data-id="heading-10">3. å“åº”æ ¼å¼ç»Ÿä¸€</h3>
<p>ä¸ç®¡åç«¯ç”¨çš„æ˜¯å“ªä¸ªæ¨¡å‹ï¼Œè¿”å›æ ¼å¼éƒ½æ˜¯ç»Ÿä¸€çš„ <code>{content, model, provider}</code>ï¼Œè°ƒç”¨æ–¹å®Œå…¨ä¸éœ€è¦å…³å¿ƒåº•å±‚ç”¨çš„æ˜¯è°ã€‚</p>
<h2 data-id="heading-11">è¿›é˜¶ä¼˜åŒ–æ–¹å‘</h2>
<p>è¿™ä¸ª 100 è¡Œç‰ˆæœ¬æ˜¯æœ€å°å¯ç”¨ç‰ˆã€‚ç”Ÿäº§ç¯å¢ƒä¸­ä½ å¯èƒ½è¿˜éœ€è¦ï¼š</p>

































<table><thead><tr><th>åŠŸèƒ½</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>æµå¼å“åº”</td><td>SSE æ”¯æŒï¼Œå®ç°æ‰“å­—æœºæ•ˆæœ</td></tr><tr><td>è¯·æ±‚æ—¥å¿—</td><td>è®°å½•æ¯æ¬¡è¯·æ±‚çš„æ¨¡å‹ã€è€—æ—¶ã€token æ•°</td></tr><tr><td>æˆæœ¬è¿½è¸ª</td><td>æŒ‰ token è®¡è´¹ï¼Œç»Ÿè®¡å„æ¨¡å‹èŠ±è´¹</td></tr><tr><td>è´Ÿè½½å‡è¡¡</td><td>å¤šä¸ª API Key è½®è¯¢ï¼Œé¿å…å• Key é™æµ</td></tr><tr><td>ç¼“å­˜å±‚</td><td>ç›¸åŒè¯·æ±‚å‘½ä¸­ç¼“å­˜ï¼Œçœé’±åˆå¿«</td></tr><tr><td>é‰´æƒ</td><td>ç»™ç½‘å…³åŠ  API Keyï¼Œé˜²æ­¢æ»¥ç”¨</td></tr></tbody></table>
<p>å¦‚æœä½ ä¸æƒ³è‡ªå·±é€ è½®å­ï¼Œå¸‚é¢ä¸Šä¹Ÿæœ‰ç°æˆçš„æ¨¡å‹èšåˆæ–¹æ¡ˆï¼š</p>
<ul>
<li><strong>OpenRouter</strong>ï¼šå›½å¤–ä¸»æµï¼Œæ¨¡å‹å¤šï¼Œä½†å›½å†…è®¿é—®ä¸ç¨³å®š</li>
<li><strong>Ofox.ai</strong>ï¼šå›½å†…å¯ç›´æ¥ç”¨ï¼Œæ”¯æŒä¸»æµæ¨¡å‹ï¼Œé€‚åˆå›½å†…å¼€å‘è€…</li>
<li><strong>One-API / New-API</strong>ï¼šå¼€æºè‡ªå»ºæ–¹æ¡ˆï¼Œéœ€è¦è‡ªå·±éƒ¨ç½²ç»´æŠ¤</li>
</ul>
<h2 data-id="heading-12">æ€»ç»“</h2>
<p>æ­ä¸€ä¸ª AI API ç½‘å…³å¹¶ä¸éš¾ï¼Œæ ¸å¿ƒå°±ä¸‰ä»¶äº‹ï¼š<strong>ç»Ÿä¸€æ¥å£ã€è‡ªåŠ¨è·¯ç”±ã€æ•…éšœè½¬ç§»</strong>ã€‚</p>
<p>100 è¡Œä»£ç å°±èƒ½è§£å†³ 90% çš„åœºæ™¯ã€‚å‰©ä¸‹çš„ 10%ï¼ˆæµå¼ã€ç¼“å­˜ã€ç›‘æ§ï¼‰ï¼Œè¦ä¹ˆè‡ªå·±åŠ ï¼Œè¦ä¹ˆç”¨ç°æˆçš„èšåˆå¹³å°ã€‚</p>
<p>é‡ç‚¹æ˜¯ï¼š<strong>åˆ«è®©ä½ çš„åº”ç”¨è·Ÿä»»ä½•ä¸€ä¸ªæ¨¡å‹ä¾›åº”å•†ç»‘æ­»</strong>ã€‚ä»Šå¤© DeepSeek æœ€å¼ºï¼Œæ˜å¤©å¯èƒ½æ˜¯åˆ«äººã€‚ä¿æŒçµæ´»ï¼Œæ‰èƒ½æ°¸è¿œç”¨ä¸Šæœ€å¥½çš„ã€‚</p>
<hr/>
<p><em>è§‰å¾—æœ‰ç”¨ï¼Ÿç‚¹ä¸ªèµæ”¶ä¸ªè—ï¼Œè¿™æ˜¯æˆ‘ç»§ç»­å†™çš„æœ€å¤§åŠ¨åŠ›ã€‚æœ‰é—®é¢˜è¯„è®ºåŒºè§ã€‚</em></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æ·±åº¦åˆ†æ RocketMQ å¹‚ç­‰æ€§è®¾è®¡ä¸ç”Ÿäº§çº§å®ç°æ–¹æ¡ˆ]]></title>    <link>https://juejin.cn/post/7604665952320274483</link>    <guid>https://juejin.cn/post/7604665952320274483</guid>    <pubDate>2026-02-09T19:39:54.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604665952320274483" data-draft-id="7604690250363813897" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æ·±åº¦åˆ†æ RocketMQ å¹‚ç­‰æ€§è®¾è®¡ä¸ç”Ÿäº§çº§å®ç°æ–¹æ¡ˆ"/> <meta itemprop="keywords" content="RocketMQ,åç«¯,è®¾è®¡"/> <meta itemprop="datePublished" content="2026-02-09T19:39:54.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ä¸‰æ°´ä¸æ»´"/> <meta itemprop="url" content="https://juejin.cn/user/283045639753100"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æ·±åº¦åˆ†æ RocketMQ å¹‚ç­‰æ€§è®¾è®¡ä¸ç”Ÿäº§çº§å®ç°æ–¹æ¡ˆ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/283045639753100/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ä¸‰æ°´ä¸æ»´
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-09T19:39:54.000Z" title="Mon Feb 09 2026 19:39:54 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    6
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">æ·±åº¦åˆ†æ RocketMQ å¹‚ç­‰æ€§è®¾è®¡ä¸ç”Ÿäº§çº§å®ç°æ–¹æ¡ˆ</h2>
<h3 data-id="heading-1">ä¸€ã€å‰è¨€</h3>
<p>åœ¨ä½¿ç”¨ RocketMQ æ—¶ï¼Œæˆ‘ä»¬å¿…é¡»é¢å¯¹ä¸€ä¸ªäº‹å®ï¼š<strong>RocketMQ åªä¿è¯ At Least Onceï¼ˆè‡³å°‘æŠ•é€’ä¸€æ¬¡ï¼‰ï¼Œä¸ä¿è¯ Exactly Onceï¼ˆç²¾ç¡®ä¸€æ¬¡ï¼‰ã€‚</strong></p>
<p>è¿™æ„å‘³ç€ï¼š<strong>æ¶ˆæ¯é‡å¤æ˜¯å¿…ç„¶çš„ï¼Œä¸æ˜¯å¶ç„¶çš„</strong>ã€‚å¦‚æœä¸åšå¹‚ç­‰å¤„ç†ï¼Œå°±ä¼šå‡ºç°ï¼š</p>
<ul>
<li>é‡å¤ä¸‹å•</li>
<li>é‡å¤æ‰£æ¬¾</li>
<li>é‡å¤æ’å…¥æ•°æ®</li>
<li>æ•°æ®ä¸ä¸€è‡´</li>
</ul>
<p>æœ¬æ–‡ä»<strong>é‡å¤åŸå›  â†’ è®¾è®¡åŸåˆ™ â†’ äº”å¤§å®ç°æ–¹æ¡ˆ â†’ ç”Ÿäº§æœ€ä½³å®è·µ</strong>ï¼ŒæŠŠ RocketMQ å¹‚ç­‰æ€§è®²é€ã€‚</p>
<hr/>
<h3 data-id="heading-2">äºŒã€ä¸ºä»€ä¹ˆ RocketMQ ä¼šå‡ºç°é‡å¤æ¶ˆæ¯ï¼Ÿ</h3>
<p>æ¶ˆæ¯é‡å¤ä¸»è¦å‘ç”Ÿåœ¨è¿™å‡ ä¸ªåœºæ™¯ï¼š</p>
<ol>
<li><strong>Producer é‡è¯•å‘é€</strong>ç½‘ç»œè¶…æ—¶ã€å¼‚å¸¸ã€Broker å“åº”ä¸¢å¤±ï¼Œéƒ½ä¼šè§¦å‘é‡è¯•ã€‚</li>
<li><strong>Broker é‡è¯•æŠ•é€’</strong>æ¶ˆè´¹å¤±è´¥ã€è¶…æ—¶ã€æ–­å¼€è¿æ¥ â†’ è¿›å…¥é‡è¯•é˜Ÿåˆ—ã€‚</li>
<li><strong>Rebalance é‡å¹³è¡¡</strong>æ‰©å®¹ã€ç¼©å®¹ã€é‡å¯å¯¼è‡´é˜Ÿåˆ—é‡æ–°åˆ†é…ã€‚</li>
<li><strong>Consumer æå‰ ACK</strong>ä¸šåŠ¡æ²¡æ‰§è¡Œå®Œå°±è¿”å›æˆåŠŸï¼Œé‡å¯åæ¶ˆæ¯å†æ¬¡æŠ•é€’ã€‚</li>
</ol>
<p><strong>ç»“è®ºï¼š<strong>RocketMQ <strong>æœ¬èº«ä¸åšå»é‡</strong>ï¼Œå»é‡å¿…é¡»ç”±</strong>ä¸šåŠ¡å±‚å®ç°å¹‚ç­‰</strong>ã€‚</p>
<hr/>
<h3 data-id="heading-3">ä¸‰ã€ä»€ä¹ˆæ˜¯å¹‚ç­‰ï¼Ÿ</h3>
<p><strong>å¹‚ç­‰ï¼šåŒä¸€ä¸ªæ¶ˆæ¯æ‰§è¡Œä¸€æ¬¡ä¸æ‰§è¡Œå¤šæ¬¡ï¼Œç»“æœå®Œå…¨ä¸€è‡´ã€‚</strong></p>
<p>æ»¡è¶³ï¼š</p>
<ul>
<li>é‡å¤æ¶ˆæ¯ä¸æŠ¥é”™</li>
<li>é‡å¤æ¶ˆæ¯ä¸äº§ç”Ÿè„æ•°æ®</li>
<li>é‡å¤æ¶ˆæ¯è¿”å›æˆåŠŸ</li>
</ul>
<hr/>
<h3 data-id="heading-4">å››ã€RocketMQ å¹‚ç­‰è®¾è®¡æ ¸å¿ƒæ€è·¯</h3>
<p>å®ç°å¹‚ç­‰åªéœ€è¦æŠ“ä½ä¸€ç‚¹ï¼š<strong>è¯†åˆ«è¿™æ¡æ¶ˆæ¯æ˜¯å¦å·²ç»è¢«å¤„ç†è¿‡ã€‚</strong></p>
<p>å…³é”®æ ‡è¯†ï¼š</p>
<ol>
<li><strong>msgId</strong>ï¼šBroker ç”Ÿæˆçš„å”¯ä¸€ ID</li>
<li><strong>offsetMsgId</strong>ï¼šåŸºäºç‰©ç†åç§»çš„ ID</li>
<li><strong>keys</strong>ï¼šä¸šåŠ¡å”¯ä¸€æ ‡è¯†ï¼ˆ<strong>æœ€æ¨è</strong>ï¼Œå¦‚è®¢å•å·ã€æµæ°´å·ï¼‰</li>
</ol>
<p><strong>æœ€ä½³å®è·µï¼šä¼˜å…ˆä½¿ç”¨ä¸šåŠ¡å”¯ä¸€é”®ã€‚</strong></p>
<hr/>
<h3 data-id="heading-5">äº”ã€ç”Ÿäº§çº§å¹‚ç­‰äº”å¤§æ–¹æ¡ˆï¼ˆä»ç®€å•åˆ°æ¨èï¼‰</h3>
<h4 data-id="heading-6">æ–¹æ¡ˆ 1ï¼šæ•°æ®åº“å”¯ä¸€ç´¢å¼•ï¼ˆæœ€ç®€å•ã€æœ€ç¨³å®šï¼‰</h4>
<p>é€‚ç”¨åœºæ™¯ï¼šinsert ç±»ä¸šåŠ¡ï¼ˆè®¢å•ã€æµæ°´ã€æ—¥å¿—ï¼‰</p>
<p>æ€è·¯ï¼šåˆ©ç”¨æ•°æ®åº“å”¯ä¸€ç´¢å¼•çº¦æŸï¼Œé‡å¤æ’å…¥ä¼šæŠ¥é”™ï¼Œæ•è·åè§†ä¸ºæˆåŠŸã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">try</span> {
    orderMapper.insert(order);
} <span class="hljs-keyword">catch</span> (DuplicateKeyException e) {
    log.info(<span class="hljs-string">"è®¢å•å·²å­˜åœ¨ï¼Œå¹‚ç­‰å¤„ç†ï¼š{}"</span>, orderNo);
}
<span class="hljs-keyword">return</span> ConsumeConcurrentlyStatus.CONSUME_SUCCESS;
</code></pre>
<p>ä¼˜ç‚¹ï¼š</p>
<ul>
<li>å®ç°æœ€ç®€å•</li>
<li>å¤©ç„¶å¹¶å‘å®‰å…¨</li>
<li>æ— é¢å¤–ä¸­é—´ä»¶</li>
</ul>
<p>ç¼ºç‚¹ï¼š</p>
<ul>
<li>åªé€‚ç”¨äºæ’å…¥åœºæ™¯</li>
</ul>
<hr/>
<h4 data-id="heading-7">æ–¹æ¡ˆ 2ï¼šå»é‡è¡¨ + äº‹åŠ¡ï¼ˆé€šç”¨å¼ºä¸€è‡´ï¼‰</h4>
<p>é€‚ç”¨åœºæ™¯ï¼šå¤šè¡¨æ“ä½œã€æ— æ³•åŠ å”¯ä¸€ç´¢å¼•</p>
<p>å»ºè¡¨ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> message_idempotent (
    id <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">PRIMARY</span> KEY AUTO_INCREMENT,
    message_key <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">64</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">UNIQUE</span>,
    create_time DATETIME
);
</code></pre>
<p>é€»è¾‘ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Transactional(rollbackFor = Exception.class)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handleMessage</span><span class="hljs-params">(String key)</span> {
    <span class="hljs-comment">// æ’å…¥å»é‡è¡¨</span>
    <span class="hljs-type">int</span> <span class="hljs-variable">rows</span> <span class="hljs-operator">=</span> idempotentMapper.insertIgnore(key);
    <span class="hljs-keyword">if</span> (rows == <span class="hljs-number">0</span>) {
        <span class="hljs-comment">// å·²å¤„ç†</span>
        <span class="hljs-keyword">return</span>;
    }
    <span class="hljs-comment">// æ‰§è¡Œä¸šåŠ¡é€»è¾‘</span>
}
</code></pre>
<p>ä¼˜ç‚¹ï¼š</p>
<ul>
<li>é€šç”¨ã€å¼ºä¸€è‡´</li>
<li>ä¸ä¸šåŠ¡äº‹åŠ¡ç»‘å®š</li>
</ul>
<hr/>
<h4 data-id="heading-8">æ–¹æ¡ˆ 3ï¼šRedis åˆ†å¸ƒå¼é”ï¼ˆé«˜å¹¶å‘é¦–é€‰ï¼‰</h4>
<p>é€‚ç”¨åœºæ™¯ï¼šé«˜å¹¶å‘ã€æ›´æ–°æ“ä½œã€å¤šæœåŠ¡å®ä¾‹</p>
<p>ä»¥ <code>messageKey</code> ä½œä¸ºé”æ ‡è¯†ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> <span class="hljs-string">"mq:idempotent:"</span> + messageKey;
<span class="hljs-type">Boolean</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> redisTemplate.opsForValue()
        .setIfAbsent(key, <span class="hljs-string">"handled"</span>, <span class="hljs-number">24</span>, TimeUnit.HOURS);

<span class="hljs-keyword">if</span> (Boolean.FALSE.equals(lock)) {
    <span class="hljs-keyword">return</span> CONSUME_SUCCESS;
}
<span class="hljs-comment">// æ‰§è¡Œä¸šåŠ¡</span>
</code></pre>
<p>ä¼˜ç‚¹ï¼š</p>
<ul>
<li>æ€§èƒ½æé«˜</li>
<li>é€‚åˆé«˜å¹¶å‘æ›´æ–°</li>
</ul>
<p>æ³¨æ„ï¼š</p>
<ul>
<li>è¿‡æœŸæ—¶é—´è¦è¶³å¤Ÿé•¿ï¼ˆâ‰¥24hï¼‰</li>
<li>ä¸è¦ä½¿ç”¨è‡ªåŠ¨ç»­æœŸ</li>
</ul>
<hr/>
<h4 data-id="heading-9">æ–¹æ¡ˆ 4ï¼šçŠ¶æ€æœºå¹‚ç­‰ï¼ˆæœ€ä¼˜é›…ã€ä¼ä¸šæœ€çˆ±ï¼‰</h4>
<p>é€‚ç”¨åœºæ™¯ï¼šè®¢å•ã€æ”¯ä»˜ã€ç‰©æµç­‰çŠ¶æ€æµè½¬</p>
<p>ä¾‹å¦‚è®¢å•çŠ¶æ€ï¼šå¾…æ”¯ä»˜ â†’ å·²æ”¯ä»˜ â†’ å·²å®Œæˆ</p>
<p>æ¶ˆè´¹æ—¶ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">UPDATE</span> <span class="hljs-keyword">order</span>
<span class="hljs-keyword">SET</span> status <span class="hljs-operator">=</span> <span class="hljs-number">2</span>
<span class="hljs-keyword">WHERE</span> order_no <span class="hljs-operator">=</span> ? <span class="hljs-keyword">AND</span> status <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;
</code></pre>
<ul>
<li>å½±å“è¡Œæ•° = 1 â†’ ç¬¬ä¸€æ¬¡å¤„ç†</li>
<li>å½±å“è¡Œæ•° = 0 â†’ é‡å¤æ¶ˆæ¯ï¼Œç›´æ¥è¿”å›æˆåŠŸ</li>
</ul>
<p>ä¼˜ç‚¹ï¼š</p>
<ul>
<li>æ— é”ã€é«˜æ€§èƒ½</li>
<li>å¤©ç„¶å¹‚ç­‰</li>
<li>ä¸šåŠ¡è¯­ä¹‰æ¸…æ™°</li>
</ul>
<p><strong>ç”Ÿäº§ç¯å¢ƒæœ€æ¨èæ–¹æ¡ˆã€‚</strong></p>
<hr/>
<h4 data-id="heading-10">æ–¹æ¡ˆ 5ï¼šä¸šåŠ¡å”¯ä¸€æ ‡è¯† + æœ¬åœ°è¡¨ + Redis å¤šçº§é˜²å¾¡</h4>
<p>é€‚ç”¨åœºæ™¯ï¼šé‡‘èã€æ”¯ä»˜æ ¸å¿ƒé“¾è·¯</p>
<p>æµç¨‹ï¼š</p>
<ol>
<li>ç”¨ä¸šåŠ¡å”¯ä¸€å·åš Redis å»é‡</li>
<li>ç”¨å»é‡è¡¨åšæŒä¹…åŒ–</li>
<li>ç”¨çŠ¶æ€æœºä¿è¯å®‰å…¨</li>
</ol>
<p>è¶…é«˜å¯é ã€‚</p>
<hr/>
<h3 data-id="heading-11">å…­ã€RocketMQ æ¶ˆè´¹ç«¯å¹‚ç­‰ç¼–ç æ¨¡æ¿</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> ConsumeConcurrentlyStatus <span class="hljs-title function_">consumeMessage</span><span class="hljs-params">(
        List&lt;MessageExt&gt; msgs, ConsumeConcurrentlyContext context)</span> {
    <span class="hljs-keyword">for</span> (MessageExt msg : msgs) {
        <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> msg.getKeys(); <span class="hljs-comment">// ä¸šåŠ¡å”¯ä¸€é”®</span>
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 1. å¹‚ç­‰åˆ¤æ–­ï¼šæ˜¯å¦å·²å¤„ç†</span>
            <span class="hljs-keyword">if</span> (idempotentService.isProcessed(key)) {
                <span class="hljs-keyword">continue</span>;
            }
            <span class="hljs-comment">// 2. ä¸šåŠ¡å¤„ç†</span>
            businessService.handle(msg);
            <span class="hljs-comment">// 3. æ ‡è®°å·²å¤„ç†</span>
            idempotentService.markProcessed(key);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            log.error(<span class="hljs-string">"æ¶ˆè´¹å¼‚å¸¸"</span>, e);
            <span class="hljs-comment">// å¼‚å¸¸ â†’ é‡è¯•</span>
            <span class="hljs-keyword">return</span> ConsumeConcurrentlyStatus.RECONSUME_LATER;
        }
    }
    <span class="hljs-keyword">return</span> ConsumeConcurrentlyStatus.CONSUME_SUCCESS;
}
</code></pre>
<hr/>
<h3 data-id="heading-12">ä¸ƒã€å¹‚ç­‰è®¾è®¡ä¸‰å¤§åŸåˆ™</h3>
<ol>
<li><strong>å…ˆåˆ¤æ–­æ˜¯å¦å¤„ç†ï¼Œå†æ‰§è¡Œä¸šåŠ¡</strong></li>
<li><strong>å¹‚ç­‰åˆ¤æ–­å¿…é¡»åŸå­æ€§</strong></li>
<li><strong>é‡å¤æ¶ˆæ¯ç›´æ¥è¿”å›æˆåŠŸï¼Œä¸æŠ›å¼‚å¸¸</strong></li>
</ol>
<hr/>
<h3 data-id="heading-13">å…«ã€ç»å…¸é—®é¢˜</h3>
<ol>
<li>RocketMQ æ˜¯ At Least Once è¿˜æ˜¯ Exactly Onceï¼Ÿ</li>
<li>ä¸ºä»€ä¹ˆ MQ ä¸å†…éƒ¨å®ç°å»é‡ï¼Ÿ</li>
<li>æ¶ˆæ¯é‡å¤çš„åœºæ™¯æœ‰å“ªäº›ï¼Ÿ</li>
<li>ç”Ÿäº§ä¸­ä½ ç”¨ä»€ä¹ˆæ–¹æ¡ˆå®ç°å¹‚ç­‰ï¼Ÿ</li>
<li>å”¯ä¸€ç´¢å¼•ã€Redisã€çŠ¶æ€æœºä¸‰ç§æ–¹æ¡ˆå¯¹æ¯”ï¼Ÿ</li>
<li>å¦‚ä½•ä¿è¯å¹‚ç­‰é«˜å¯ç”¨ï¼Ÿ</li>
</ol>
<hr/>
<h3 data-id="heading-14">ä¹ã€ç”Ÿäº§æœ€ä½³å®è·µæ€»ç»“</h3>
<ol>
<li><strong>æ‰€æœ‰æ¶ˆè´¹ç«¯å¿…é¡»åšå¹‚ç­‰</strong>ï¼Œä¸è¦æŠ±æœ‰ä¾¥å¹¸</li>
<li><strong>ä¼˜å…ˆä½¿ç”¨ä¸šåŠ¡å”¯ä¸€é”®ï¼ˆkeysï¼‰</strong></li>
<li><strong>æ’å…¥ç”¨å”¯ä¸€ç´¢å¼•ï¼Œæ›´æ–°ç”¨çŠ¶æ€æœºï¼Œé«˜å¹¶å‘ç”¨ Redis</strong></li>
<li>å¼‚å¸¸æ—¶è¿”å› <strong>RECONSUME_LATER</strong>ï¼Œä¸è¦åå¼‚å¸¸</li>
<li>åšå¥½<strong>é‡è¯•ã€æ­»ä¿¡ã€å †ç§¯</strong>ç›‘æ§</li>
<li>å¹‚ç­‰æ˜¯æ¶æ„é—®é¢˜ï¼Œä¸æ˜¯ MQ é—®é¢˜</li>
</ol>
<hr/>
<h3 data-id="heading-15">åã€ç»“è¯­</h3>
<p>RocketMQ ä¸ä¿è¯æ¶ˆæ¯ä¸é‡å¤ï¼Œä½†é€šè¿‡<strong>åˆç†çš„å¹‚ç­‰è®¾è®¡</strong>ï¼Œå¯ä»¥è½»æ¾å®ç°ï¼š<strong>é‡å¤æ¶ˆæ¯ = å®‰å…¨è·³è¿‡ = æœ€ç»ˆä¸€è‡´</strong>ã€‚</p>
<p>å¹‚ç­‰æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿé«˜å¯ç”¨çš„åŸºç¡€ï¼Œä¹Ÿæ˜¯é¢è¯•ä¸ç”Ÿäº§çš„å¿…è€ƒç‚¹ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[319. Java Stream API - ä½¿ç”¨ç»ˆç«¯æ”¶é›†å™¨]]></title>    <link>https://juejin.cn/post/7604853010162040895</link>    <guid>https://juejin.cn/post/7604853010162040895</guid>    <pubDate>2026-02-09T23:25:41.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604853010162040895" data-draft-id="7604574877035413547" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="319. Java Stream API - ä½¿ç”¨ç»ˆç«¯æ”¶é›†å™¨"/> <meta itemprop="keywords" content="åç«¯,å‰ç«¯"/> <meta itemprop="datePublished" content="2026-02-09T23:25:41.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="CacheæŠ€æœ¯åˆ†äº«"/> <meta itemprop="url" content="https://juejin.cn/user/1662117313262776"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            319. Java Stream API - ä½¿ç”¨ç»ˆç«¯æ”¶é›†å™¨
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1662117313262776/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    CacheæŠ€æœ¯åˆ†äº«
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-09T23:25:41.000Z" title="Mon Feb 09 2026 23:25:41 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">319. Java Stream API - ä½¿ç”¨ç»ˆç«¯æ”¶é›†å™¨</h2>
<p>åœ¨ Java çš„ <strong>Collector API</strong> ä¸­ï¼Œæœ‰ä¸€ç»„éå¸¸æœ‰ç”¨çš„ <strong>ç»ˆç«¯æ”¶é›†å™¨ï¼ˆterminal collectorsï¼‰</strong>ï¼Œå®ƒä»¬ä¸ Stream API ä¸­çš„ç»ˆç«¯æ“ä½œç´§å¯†å¯¹åº”ã€‚ä¸‹é¢ï¼Œæˆ‘ä»¬æ¥é€ä¸€è®²è§£è¿™äº›æ”¶é›†å™¨çš„ä½œç”¨ã€ä½¿ç”¨æ–¹å¼ï¼Œä»¥åŠå®ƒä»¬åœ¨å®é™…å¼€å‘ä¸­çš„å…¸å‹åº”ç”¨åœºæ™¯ã€‚</p>
<hr/>
<h3 data-id="heading-1">ğŸ” 1. <code>maxBy()</code> å’Œ <code>minBy()</code></h3>
<p>è¿™ä¸¤ä¸ªæ”¶é›†å™¨ç”¨äºæ‰¾å‡ºæµä¸­çš„ <strong>æœ€å¤§å€¼æˆ–æœ€å°å€¼</strong>ã€‚
å®ƒä»¬æ¥æ”¶ä¸€ä¸ª <code>Comparator</code> ä½œä¸ºå‚æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ª <code>Optional&lt;T&gt;</code>ã€‚å¦‚æœæµä¸ºç©ºï¼Œé‚£ä¹ˆè¿”å›çš„ <code>Optional</code> ä¹Ÿæ˜¯ç©ºçš„ã€‚</p>
<h4 data-id="heading-2">ğŸ“Œ ç¤ºä¾‹ï¼š</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.util.*;
<span class="hljs-keyword">import</span> java.util.stream.*;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MaxMinCollectorDemo</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        List&lt;String&gt; names = List.of(<span class="hljs-string">"Alice"</span>, <span class="hljs-string">"Bob"</span>, <span class="hljs-string">"Charlie"</span>, <span class="hljs-string">"David"</span>);

        Optional&lt;String&gt; longestName = names.stream()
            .collect(Collectors.maxBy(Comparator.comparingInt(String::length)));

        Optional&lt;String&gt; shortestName = names.stream()
            .collect(Collectors.minBy(Comparator.comparingInt(String::length)));

        System.out.println(<span class="hljs-string">"Longest name: "</span> + longestName.orElse(<span class="hljs-string">"N/A"</span>));
        System.out.println(<span class="hljs-string">"Shortest name: "</span> + shortestName.orElse(<span class="hljs-string">"N/A"</span>));
    }
}
</code></pre>
<h4 data-id="heading-3">ğŸ¯ è¾“å‡ºï¼š</h4>
<pre><code class="hljs language-java" lang="java">Longest name: Charlie
Shortest name: Bob
</code></pre>
<hr/>
<h3 data-id="heading-4">â• 2. <code>summingInt()</code> / <code>summingLong()</code> / <code>summingDouble()</code></h3>
<p>è¿™ä¸‰ä¸ªæ”¶é›†å™¨ç”¨äºå¯¹æµä¸­çš„å…ƒç´ è¿›è¡Œæ±‚å’Œã€‚
ä½ éœ€è¦ä¼ å…¥ä¸€ä¸ªæ˜ å°„å‡½æ•°ï¼Œå°†å¯¹è±¡æ˜ å°„ä¸º <code>int</code>ã€<code>long</code> æˆ– <code>double</code>ï¼Œç„¶åè¿›è¡ŒåŠ æ€»ã€‚</p>
<h4 data-id="heading-5">ğŸ“Œ ç¤ºä¾‹ï¼š</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">record</span> <span class="hljs-title class_">Product</span><span class="hljs-params">(String name, <span class="hljs-type">double</span> price)</span> {}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SumDemo</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        List&lt;Product&gt; products = List.of(
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Product</span>(<span class="hljs-string">"Pen"</span>, <span class="hljs-number">1.5</span>),
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Product</span>(<span class="hljs-string">"Notebook"</span>, <span class="hljs-number">3.0</span>),
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Product</span>(<span class="hljs-string">"Pencil"</span>, <span class="hljs-number">0.5</span>)
        );

        <span class="hljs-type">double</span> <span class="hljs-variable">totalPrice</span> <span class="hljs-operator">=</span> products.stream()
            .collect(Collectors.summingDouble(Product::price));

        System.out.println(<span class="hljs-string">"Total price: "</span> + totalPrice);
    }
}
</code></pre>
<h4 data-id="heading-6">ğŸ¯ è¾“å‡ºï¼š</h4>
<pre><code class="hljs language-java" lang="java">Total price: <span class="hljs-number">5.0</span>
</code></pre>
<hr/>
<h3 data-id="heading-7">ğŸ“Š 3. <code>averagingInt()</code> / <code>averagingLong()</code> / <code>averagingDouble()</code></h3>
<p>è¿™äº›æ”¶é›†å™¨ç”¨äºè®¡ç®—å¹³å‡å€¼ï¼Œä¹Ÿæ¥å—ä¸€ä¸ªæ˜ å°„å‡½æ•°ï¼Œå°†å¯¹è±¡æ˜ å°„ä¸ºå¯¹åº”æ•°å€¼ç±»å‹ã€‚
ä¸åŒäº <code>IntStream.average()</code> ç­‰æ–¹æ³•ï¼Œè¿™äº›æ”¶é›†å™¨å§‹ç»ˆè¿”å›ä¸€ä¸ª <code>Double</code> å€¼ï¼Œå³ä½¿æµä¸ºç©ºæ—¶ä¹Ÿä¸ä¼šæŠ›å¼‚å¸¸ï¼Œè€Œæ˜¯è¿”å› <code>0.0</code>ã€‚</p>
<h4 data-id="heading-8">ğŸ“Œ ç¤ºä¾‹ï¼š</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AverageDemo</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        List&lt;String&gt; words = List.of(<span class="hljs-string">"cat"</span>, <span class="hljs-string">"elephant"</span>, <span class="hljs-string">"tiger"</span>, <span class="hljs-string">"lion"</span>);

        <span class="hljs-type">double</span> <span class="hljs-variable">averageLength</span> <span class="hljs-operator">=</span> words.stream()
            .collect(Collectors.averagingInt(String::length));

        System.out.println(<span class="hljs-string">"Average length: "</span> + averageLength);
    }
}
</code></pre>
<h4 data-id="heading-9">ğŸ¯ è¾“å‡ºï¼š</h4>
<pre><code class="hljs language-java" lang="java">Average length: <span class="hljs-number">5.25</span>
</code></pre>
<p>ğŸ§  <strong>å°è´´å£«</strong>ï¼š</p>
<ul>
<li><code>averagingInt()</code> å’Œ <code>IntStream.average()</code> çš„åŒºåˆ«åœ¨äºï¼š
<ul>
<li><code>IntStream.average()</code> è¿”å› <code>OptionalDouble</code>ï¼Œå¦‚æœæµä¸ºç©ºä¼šè¿”å› <code>Optional.empty()</code>ï¼›</li>
<li><code>Collectors.averagingInt()</code> è¿”å› <code>Double</code> ç±»å‹ï¼Œå¹¶ä¸”ç©ºæµé»˜è®¤è¿”å› <code>0.0</code>ï¼Œæ›´å®‰å…¨ã€‚</li>
</ul>
</li>
</ul>
<hr/>
<h3 data-id="heading-10">ğŸ“Œ å°ç»“</h3>





























<table><thead><tr><th>æ”¶é›†å™¨åç§°</th><th>åŠŸèƒ½æè¿°</th><th>è¿”å›ç±»å‹</th><th>ç©ºæµå¤„ç†æ–¹å¼</th></tr></thead><tbody><tr><td><code>maxBy()</code> / <code>minBy()</code></td><td>è·å–æœ€å¤§ / æœ€å°å…ƒç´ </td><td><code>Optional&lt;T&gt;</code></td><td>è¿”å›ç©º Optional</td></tr><tr><td><code>summingInt()</code> ç­‰</td><td>æ±‚å’Œ</td><td><code>int</code> / <code>long</code> / <code>double</code></td><td>è¿”å› 0</td></tr><tr><td><code>averagingInt()</code> ç­‰</td><td>æ±‚å¹³å‡å€¼</td><td><code>Double</code></td><td>è¿”å› 0.0</td></tr></tbody></table>
<hr/>
<p>è¿™äº›æ”¶é›†å™¨åœ¨å®é™…å¼€å‘ä¸­éå¸¸å¸¸è§ï¼Œå°¤å…¶é€‚ç”¨äºç»Ÿè®¡ç±»ã€æŠ¥è¡¨ç±»ã€åˆ†æç±»çš„å¤„ç†åœºæ™¯ã€‚å¦‚æœä½ æƒ³åŸºäº <code>Stream</code> ç»“æœè¿›è¡Œä¸€äº›æ±‡æ€»ã€åˆ†ææ“ä½œï¼Œè¿™äº›å·¥å…·å°±æ˜¯ä½ çš„å¥½å¸®æ‰‹ï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä»Vue3åˆ°Reactï¼šä¸€åœºè·¨è¶ŠèŒƒå¼çš„è¿›åŒ–ä¹‹æ—…]]></title>    <link>https://juejin.cn/post/7604685644684591156</link>    <guid>https://juejin.cn/post/7604685644684591156</guid>    <pubDate>2026-02-10T00:57:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604685644684591156" data-draft-id="7604522883486122018" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä»Vue3åˆ°Reactï¼šä¸€åœºè·¨è¶ŠèŒƒå¼çš„è¿›åŒ–ä¹‹æ—…"/> <meta itemprop="keywords" content="å‰ç«¯,React.js"/> <meta itemprop="datePublished" content="2026-02-10T00:57:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é’é’å®¶çš„å°å¹¸è¿"/> <meta itemprop="url" content="https://juejin.cn/user/2295436009545944"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä»Vue3åˆ°Reactï¼šä¸€åœºè·¨è¶ŠèŒƒå¼çš„è¿›åŒ–ä¹‹æ—…
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2295436009545944/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é’é’å®¶çš„å°å¹¸è¿
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T00:57:53.000Z" title="Tue Feb 10 2026 00:57:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    11
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="agate">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#333;color:#fff}.hljs-name,.hljs-strong{font-weight:700}.hljs-code,.hljs-emphasis{font-style:italic}.hljs-tag{color:#62c8f3}.hljs-selector-class,.hljs-selector-id,.hljs-template-variable,.hljs-variable{color:#ade5fc}.hljs-bullet,.hljs-string{color:#a2fca2}.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-quote,.hljs-section,.hljs-title,.hljs-type{color:#ffa}.hljs-bullet,.hljs-number,.hljs-symbol{color:#d36363}.hljs-keyword,.hljs-literal,.hljs-selector-tag{color:#fcc28c}.hljs-code,.hljs-comment,.hljs-deletion{color:#888}.hljs-link,.hljs-regexp{color:#c6b4f0}.hljs-meta{color:#fc9b9b}.hljs-deletion{background-color:#fc9b9b;color:#333}.hljs-addition{background-color:#a2fca2;color:#333}.hljs a{color:inherit}.hljs a:focus,.hljs a:hover{color:inherit;text-decoration:underline}</style><h2 data-id="heading-0">ä»Vue3åˆ°Reactï¼šä¸€åœºè·¨è¶ŠèŒƒå¼çš„è¿›åŒ–ä¹‹æ—…</h2>
<p>ä½œä¸ºæ·±è€•å‰ç«¯é¢†åŸŸ7å¹´++çš„å¼€å‘è€…ï¼Œæˆ‘æ›¾å°†Vue3è§†ä¸º"æ¸è¿›å¼æ¡†æ¶"çš„å®Œç¾ç­”æ¡ˆã€‚ç›´åˆ°å…¬å¸å†³å®šå°†æ ¸å¿ƒé¡¹ç›®è¿ç§»è‡³Reactç”Ÿæ€ï¼Œè¿™åœºæŠ€æœ¯æ ˆçš„å˜é©è®©æˆ‘æ·±åˆ»ä½“ä¼šåˆ°ï¼šâ€‹<strong>æ¡†æ¶çš„æ›´è¿­ä¸æ˜¯éæ­¤å³å½¼çš„é€‰æ‹©ï¼Œè€Œæ˜¯å¼€å‘è€…è®¤çŸ¥è¾¹ç•Œçš„æ‹“å±•</strong>ã€‚åœ¨å®Œæˆè¿ç§»çš„åŠå¹´åï¼Œæˆ‘æ—¢æƒŠå¹äºReactç”Ÿæ€çš„å¼ºå¤§ç”Ÿå‘½åŠ›ï¼Œä¹Ÿæ„ˆå‘çæƒœVue3å¸¦æ¥çš„å¼€å‘å“²å­¦å¯ç¤ºã€‚</p>
<hr/>
<h3 data-id="heading-1">ä¸€ã€èŒƒå¼ç¢°æ’ï¼šä¸¤ç§æ€ç»´æ¨¡å¼çš„å¯¹è¯</h3>
<h4 data-id="heading-2">1.1 å“åº”å¼ç³»ç»Ÿçš„å“²å­¦å·®å¼‚</h4>
<p>Vue3çš„Proxyå“åº”å¼ç³»ç»Ÿå¦‚åŒç²¾å¯†çš„ç‘å£«é’Ÿè¡¨ï¼Œé€šè¿‡<code>ref</code>å’Œ<code>reactive</code>è‡ªåŠ¨è¿½è¸ªæ•°æ®æµåŠ¨ã€‚åœ¨å¼€å‘ä¼ä¸šçº§åå°æ—¶ï¼Œæˆ‘æ›¾äº«å—è¿‡<code>watchEffect</code>è‡ªåŠ¨è¿½è¸ªä¾èµ–çš„ä¼˜é›…ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// Vue3æ•°æ®è¿½è¸ªç¤ºä¾‹</span>
<span class="hljs-keyword">const</span> userInfo = <span class="hljs-title function_">reactive</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">'å¼ ä¸‰'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">28</span> });
<span class="hljs-title function_">watchEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`ç”¨æˆ· <span class="hljs-subst">${userInfo.name}</span> å¹´é¾„æ›´æ–°ä¸º <span class="hljs-subst">${userInfo.age}</span>`</span>);
});
</code></pre>
<p>è€ŒReactçš„<code>useState</code>/<code>useEffect</code>æ›´åƒä¹é«˜ç§¯æœ¨ï¼Œéœ€è¦å¼€å‘è€…æ‰‹åŠ¨æ­å»ºçŠ¶æ€ç®¡ç†é€»è¾‘ã€‚è¿ç§»åˆæœŸï¼Œè¿™ç§æ˜¾å¼å£°æ˜è®©æˆ‘å€æ„Ÿç¹çï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ReactçŠ¶æ€ç®¡ç†å¯¹æ¯”</span>
<span class="hljs-keyword">const</span> [userInfo, setUserInfo] = <span class="hljs-title function_">useState</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">'å¼ ä¸‰'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">28</span> });
<span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`ç”¨æˆ· <span class="hljs-subst">${userInfo.name}</span> å¹´é¾„æ›´æ–°ä¸º <span class="hljs-subst">${userInfo.age}</span>`</span>);
}, [userInfo]);
</code></pre>
<p>ä½†æ­£æ˜¯è¿™ç§æ˜¾å¼æ€§ï¼Œè®©æˆ‘åœ¨å¤æ‚è¡¨å•å¤„ç†æ—¶é¿å…äº†Vueä¸­<code>computed</code>å±æ€§å¯èƒ½å¼•å‘çš„ä¾èµ–é™·é˜±ã€‚</p>
<h4 data-id="heading-3">1.2 ç»„ä»¶åŒ–å¼€å‘çš„æ®Šé€”åŒå½’</h4>
<p>Vue3çš„å•æ–‡ä»¶ç»„ä»¶(SFC)å°†æ¨¡æ¿ã€é€»è¾‘ã€æ ·å¼å°è£…åœ¨<code>.vue</code>æ–‡ä»¶ä¸­ï¼Œé€‚åˆå¿«é€ŸåŸå‹å¼€å‘ï¼š</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">el-button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"handleSubmit"</span>&gt;</span>{{ loading ? 'æäº¤ä¸­...' : 'æäº¤' }}<span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">const</span> form = <span class="hljs-title function_">reactive</span>({ <span class="hljs-attr">title</span>: <span class="hljs-string">''</span>, <span class="hljs-attr">content</span>: <span class="hljs-string">''</span> });
<span class="hljs-keyword">const</span> { loading } = <span class="hljs-title function_">useLoading</span>();
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p>Reactçš„å‡½æ•°ç»„ä»¶+Hooksæ¨¡å¼åˆ™æ›´æ¥è¿‘åŸç”ŸJavaScriptï¼Œè¿™ç§"ä»£ç å³ç½‘é¡µ"çš„ç›´ç™½é£æ ¼åœ¨å¤§å‹é¡¹ç›®ä¸­å±•ç°å‡ºç‹¬ç‰¹ä¼˜åŠ¿ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// Reactç»„ä»¶å¯¹æ¯”</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">SubmitButton</span> = (<span class="hljs-params">{ loading }</span>) =&gt; (
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">disabled</span>=<span class="hljs-string">{loading}</span>&gt;</span>
    {loading ? 'æäº¤ä¸­...' : 'æäº¤'}
  <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span>
);
</code></pre>
<p>è¿ç§»è¿‡ç¨‹ä¸­æˆ‘å‘ç°ï¼Œâ€‹<strong>ç»„ä»¶æ‹†åˆ†çš„ç²’åº¦æ§åˆ¶</strong>æ˜¯ä¸¤å¤§æ¡†æ¶çš„æ ¸å¿ƒå·®å¼‚ï¼šVueæ›´é€‚åˆä¸šåŠ¡é€»è¾‘ç´§å¯†è€¦åˆçš„æ¨¡å—ï¼Œè€ŒReactçš„ç»„ä»¶åŒ–æ›´å¼ºè°ƒå•ä¸€èŒè´£åŸåˆ™ã€‚</p>
<hr/>
<h3 data-id="heading-4">äºŒã€è¿ç§»å®æˆ˜ï¼šåœ¨æŒ‘æˆ˜ä¸­å¯»æ‰¾çªç ´</h3>
<h4 data-id="heading-5">2.1 çŠ¶æ€ç®¡ç†çš„é‡æ„è‰ºæœ¯</h4>
<p>å°†Piniaè¿ç§»åˆ°Redux Toolkitçš„è¿‡ç¨‹å……æ»¡æŒ‘æˆ˜ã€‚æˆ‘ä»¬é‡‡ç”¨æ¸è¿›å¼æ”¹é€ ç­–ç•¥ï¼š</p>
<ol>
<li>â€‹<strong>æ ¸å¿ƒçŠ¶æ€å±‚ä¿ç•™Pinia</strong>â€‹ï¼šç”¨æˆ·è®¤è¯ã€å…¨å±€é…ç½®ç­‰åŸºç¡€çŠ¶æ€ç»§ç»­ä½¿ç”¨Vuexæ¨¡å¼</li>
<li>â€‹<strong>ä¸šåŠ¡é€»è¾‘å±‚è½¬å‘Redux</strong>â€‹ï¼šä½¿ç”¨<code>createSlice</code>é‡æ„è¡¨å•æäº¤ã€æ•°æ®ç¼“å­˜ç­‰åœºæ™¯</li>
<li>â€‹<strong>ä¸­é—´ä»¶æ¡¥æ¥æ–¹æ¡ˆ</strong>â€‹ï¼šé€šè¿‡<code>redux-thunk</code>å…¼å®¹åŸæœ‰APIè°ƒç”¨æ¨¡å¼</li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// æ··åˆæ¶æ„ç¤ºä¾‹</span>
<span class="hljs-comment">// stores/auth.js (Pinia)</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> useAuthStore = <span class="hljs-title function_">defineStore</span>(<span class="hljs-string">'auth'</span>, {
  <span class="hljs-attr">state</span>: <span class="hljs-function">() =&gt;</span> ({ <span class="hljs-attr">token</span>: <span class="hljs-literal">null</span> }),
  <span class="hljs-attr">actions</span>: { login }
})

<span class="hljs-comment">// features/formSlice.js (Redux Toolkit)</span>
<span class="hljs-keyword">const</span> formSlice = <span class="hljs-title function_">createSlice</span>({
  <span class="hljs-attr">name</span>: <span class="hljs-string">'form'</span>,
  <span class="hljs-attr">reducers</span>: { <span class="hljs-attr">submit</span>: <span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> { <span class="hljs-comment">/* ... */</span> } }
})
</code></pre>
<h4 data-id="heading-6">2.2 è·¯ç”±ç³»ç»Ÿçš„èŒƒå¼è½¬æ¢</h4>
<p>ä»<code>vue-router</code>åˆ°<code>react-router-dom</code>çš„è¿ç§»éœ€è¦é‡æ„æ•´ä¸ªå¯¼èˆªé€»è¾‘ï¼š</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// Vue3è·¯ç”±é…ç½®</span>
const router = <span class="hljs-built_in">createRouter</span>({
  routes: })

<span class="hljs-comment">// Reactè·¯ç”±é…ç½®</span>
const router = <span class="hljs-built_in">createBrowserRouter</span>(})
</code></pre>
<p>æˆ‘ä»¬åˆ›æ–°æ€§åœ°é‡‡ç”¨<strong>æ··åˆè·¯ç”±æ–¹æ¡ˆ</strong>â€‹ï¼šæ ¸å¿ƒé¡µé¢ä½¿ç”¨React Routerï¼Œå¾®å‰ç«¯å­åº”ç”¨ä¿ç•™Vue Routerï¼Œé€šè¿‡<code>&lt;iframe&gt;</code>å®ç°æ— ç¼è¡”æ¥ã€‚</p>
<hr/>
<h3 data-id="heading-7">ä¸‰ã€è®¤çŸ¥å‡çº§ï¼šè¶…è¶Šæ¡†æ¶çš„å¼€å‘è€…æ€ç»´</h3>
<h4 data-id="heading-8">3.1 æ€§èƒ½ä¼˜åŒ–çš„æ–°ç»´åº¦</h4>
<p>React 19çš„Server Componentså½»åº•æ”¹å˜äº†æ¸²æŸ“èŒƒå¼ã€‚åœ¨å¼€å‘æ•°æ®çœ‹æ¿æ—¶ï¼Œæˆ‘ä»¬å°†å®æ—¶å›¾è¡¨ç»„ä»¶è½¬ä¸ºæœåŠ¡ç«¯æ¸²æŸ“ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// Server Componentç¤ºä¾‹</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">RealTimeChart</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetchAnalytics</span>();
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Chart</span> <span class="hljs-attr">data</span>=<span class="hljs-string">{data}</span> /&gt;</span></span>;
}
</code></pre>
<p>è¿™ç§æ¶æ„ä¸‹ï¼Œé¦–å±åŠ è½½æ—¶é—´ä»2.1séª¤é™è‡³480msï¼Œä½†ä»£ä»·æ˜¯å¤±å»äº†Vueä¸­<code>&lt;keep-alive&gt;</code>çš„ç»„ä»¶ç¼“å­˜èƒ½åŠ›ã€‚æˆ‘ä»¬é€šè¿‡<strong>åˆ†å±‚ç¼“å­˜ç­–ç•¥</strong>å¼¥è¡¥ç¼ºé™·ï¼šé«˜é¢‘æ•°æ®èµ°Redisç¼“å­˜ï¼Œä½é¢‘æ•°æ®ä½¿ç”¨React Queryã€‚</p>
<h4 data-id="heading-9">3.2 å¼€å‘ä½“éªŒçš„å†å®šä¹‰</h4>
<p>React 19çš„ç¼–è¯‘å™¨é©å‘½å¸¦æ¥äº†æ„æƒ³ä¸åˆ°çš„æ”¶ç›Šã€‚åœ¨é‡æ„æ—§ç‰ˆè¡¨å•ç»„ä»¶æ—¶ï¼Œç¼–è¯‘å™¨è‡ªåŠ¨å°†<code>useEffect</code>ä¾èµ–é¡¹ä¼˜åŒ–ä¸ºç²¾ç¡®è¿½è¸ªï¼š</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// ç¼–è¯‘å‰</span>
<span class="hljs-built_in">useEffect</span>(() =&gt; {
  console<span class="hljs-selector-class">.log</span>(value);
}, <span class="hljs-selector-attr">[value]</span>);

<span class="hljs-comment">// ç¼–è¯‘åï¼ˆç­‰æ•ˆä¼˜åŒ–ï¼‰</span>
const memoizedValue = <span class="hljs-built_in">useMemo</span>(() =&gt; value, <span class="hljs-selector-attr">[value]</span>);
<span class="hljs-built_in">useEffect</span>(() =&gt; {
  console<span class="hljs-selector-class">.log</span>(memoizedValue);
}, <span class="hljs-selector-attr">[memoizedValue]</span>);
</code></pre>
<p>è¿™ç§æ™ºèƒ½ä¼˜åŒ–è®©æˆ‘ä»¬åœ¨ä¿æŒä»£ç ç®€æ´æ€§çš„åŒæ—¶ï¼Œè·å¾—æ¥è¿‘Vue3çš„å“åº”å¼ä½“éªŒã€‚</p>
<hr/>
<h3 data-id="heading-10">å››ã€åŒå‘èµ‹èƒ½ï¼šæ„å»ºæŠ€æœ¯ä¸­ç«‹çš„ä¸–ç•Œè§‚</h3>
<h4 data-id="heading-11">4.1 Vue3çš„æŒç»­ä»·å€¼</h4>
<p>åœ¨è¿ç§»è¿‡ç¨‹ä¸­ï¼ŒVue3çš„ä»¥ä¸‹ç‰¹æ€§æŒç»­å‘æŒ¥ä½œç”¨ï¼š</p>
<ul>
<li>â€‹<strong>ç»„åˆå¼API</strong>â€‹ï¼šä¸ºReact Hooksæä¾›äº†ä¼˜é›…çš„æ›¿ä»£æ–¹æ¡ˆ</li>
<li>â€‹<strong>ç¼–è¯‘å™¨å¢å¼º</strong>â€‹ï¼šVue3çš„ç¼–è¯‘å™¨æç¤ºå¸®åŠ©æˆ‘ä»¬è§„é¿äº†Reactä¸­çš„å¸¸è§é”™è¯¯</li>
<li>â€‹<strong>ç”Ÿæ€å…¼å®¹æ€§</strong>â€‹ï¼šé€šè¿‡<code>@vue/compiler-sfc</code>ç»§ç»­ç»´æŠ¤æ—§ç‰ˆç»„ä»¶åº“</li>
</ul>
<h4 data-id="heading-12">4.2 Reactçš„è¿›åŒ–å¯ç¤º</h4>
<p>Reactç”Ÿæ€çš„ä»¥ä¸‹åˆ›æ–°åå‘æ»‹å…»äº†Vueå¼€å‘ï¼š</p>
<ul>
<li>â€‹<strong>TypeScriptæ·±åº¦é›†æˆ</strong>â€‹ï¼šæ¨åŠ¨æˆ‘ä»¬ä¸ºVue3é¡¹ç›®æ·»åŠ å®Œæ•´ç±»å‹å®šä¹‰</li>
<li>â€‹<strong>Web3å¼€å‘æ¨¡å¼</strong>â€‹ï¼šå€Ÿé‰´Reactçš„<code>useEffect</code>å¼‚æ­¥æ¨¡å¼é‡æ„DAppäº¤äº’é€»è¾‘</li>
<li>â€‹<strong>å¾®å‰ç«¯æ¶æ„</strong>â€‹ï¼šé‡‡ç”¨Reactçš„æ¨¡å—è”é‚¦æ–¹æ¡ˆå®ç°Vue3å­åº”ç”¨é›†æˆ</li>
</ul>
<hr/>
<h3 data-id="heading-13">äº”ã€æœªæ¥å±•æœ›ï¼šæ¡†æ¶æ— å…³çš„å¼€å‘è€…ä¹‹è·¯</h3>
<p>ç«™åœ¨2026å¹´çš„æ—¶é—´èŠ‚ç‚¹å›æœ›ï¼ŒVue3ä¸Reactçš„è¿ç§»ç»å†è®©æˆ‘é¢†æ‚Ÿåˆ°ï¼š</p>
<ol>
<li>â€‹<strong>å·¥å…·æ˜¯ä¸­æ€§çš„</strong>â€‹ï¼šæ¡†æ¶åªæ˜¯å®ç°ç›®æ ‡çš„æ‰‹æ®µï¼Œæ ¸å¿ƒåœ¨äºç†è§£åº•å±‚åŸç†</li>
<li>â€‹<strong>è®¤çŸ¥éœ€è¦è¿­ä»£</strong>â€‹ï¼šä¿æŒå¯¹æ–°æŠ€æœ¯çš„æ•æ„Ÿåº¦ï¼Œä½†åšå®ˆæŠ€æœ¯åˆ¤æ–­åŠ›</li>
<li>â€‹<strong>ç”Ÿæ€å†³å®šæœªæ¥</strong>â€‹ï¼šReactåœ¨Web3ã€AIåº”ç”¨ä¸­çš„ä¼˜åŠ¿å€¼å¾—å…³æ³¨ï¼ŒVue3åœ¨å¯è§†åŒ–ã€ä½ä»£ç é¢†åŸŸçš„æ½œåŠ›åŒæ ·ä¸å¯å¿½è§†</li>
</ol>
<p>æ­£å¦‚æˆ‘åœ¨å›¢é˜Ÿåˆ†äº«ä¼šä¸Šå¸¸è¯´çš„ï¼šâ€‹<strong>â€‹"æˆ‘ä»¬ä¸æ˜¯Vueå¼€å‘è€…æˆ–Reactå¼€å‘è€…ï¼Œè€Œæ˜¯èƒ½ç”¨ä»»ä½•å·¥å…·è§£å†³é—®é¢˜çš„é—®é¢˜è§£å†³è€…ã€‚"â€‹</strong>â€‹ è¿™åœºæ¡†æ¶è¿ç§»ä¸æ˜¯ç»ˆç‚¹ï¼Œè€Œæ˜¯æ‰“å¼€æ›´å¹¿é˜”æŠ€æœ¯è§†é‡çš„èµ·ç‚¹ã€‚åœ¨æœªæ¥çš„é¡¹ç›®ä¸­ï¼Œæˆ‘å°†ç»§ç»­ä»¥å¼€æ”¾å¿ƒæ€æ‹¥æŠ±å˜åŒ–ï¼Œå› ä¸ºçœŸæ­£çš„å¼€å‘è€…æ°¸è¿œåœ¨è·¯ä¸Šã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[JavaScript Proxyä¸Reflect]]></title>    <link>https://juejin.cn/post/7604666872127586323</link>    <guid>https://juejin.cn/post/7604666872127586323</guid>    <pubDate>2026-02-10T01:21:25.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604666872127586323" data-draft-id="7604678037808431140" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="JavaScript Proxyä¸Reflect"/> <meta itemprop="keywords" content="å‰ç«¯,JavaScript"/> <meta itemprop="datePublished" content="2026-02-10T01:21:25.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="wuhen_n"/> <meta itemprop="url" content="https://juejin.cn/user/4149996261738233"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            JavaScript Proxyä¸Reflect
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4149996261738233/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    wuhen_n
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T01:21:25.000Z" title="Tue Feb 10 2026 01:21:25 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>åœ¨ JavaScript ä¸­å¦‚ä½•æ‹¦æˆªå¯¹è±¡çš„è¯»å–ã€ä¿®æ”¹ã€åˆ é™¤æ“ä½œï¼ŸVue3çš„å“åº”å¼ç³»ç»Ÿå¦‚ä½•å®ç°ï¼Ÿæœ¬æ–‡å°†æ·±å…¥è®²è§£ JavaScript çš„å…ƒç¼–ç¨‹ä¸–ç•Œï¼Œæ¢ç´¢ Proxy å’Œ Reflect çš„å¥¥ç§˜ã€‚</p>
</blockquote>
<h2 data-id="heading-0">å‰è¨€ï¼šä»Vue3çš„å“åº”å¼è¯´èµ·</h2>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// Vue3çš„å“åº”å¼æ•°æ®å®ç°åŸç†</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">reactive</span> = (<span class="hljs-params">target</span>) =&gt; {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Proxy</span>(target, {
        <span class="hljs-title function_">get</span>(<span class="hljs-params">target, key, receiver</span>) {
            <span class="hljs-title function_">track</span>(target, key); <span class="hljs-comment">// ä¾èµ–æ”¶é›†</span>
            <span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">get</span>(target, key, receiver);
        },
        <span class="hljs-title function_">set</span>(<span class="hljs-params">target, key, value, receiver</span>) {
            <span class="hljs-keyword">const</span> result = <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">set</span>(target, key, value, receiver);
            <span class="hljs-title function_">trigger</span>(target, key); <span class="hljs-comment">// è§¦å‘æ›´æ–°</span>
            <span class="hljs-keyword">return</span> result;
        }
    });
};
</code></pre>
<p>Vue3çš„å“åº”å¼æ•°æ®å®ç°åŸç†çš„èƒŒåï¼Œå°±æ˜¯ Proxy å’Œ Reflect ã€‚ç†è§£å®ƒä»¬ï¼Œæˆ‘ä»¬å°±èƒ½çœŸæ­£æŒæ¡ JavaScript å…ƒç¼–ç¨‹çš„èƒ½åŠ›ã€‚</p>
<h2 data-id="heading-1">ç†è§£Proxyä¸Reflect</h2>
<h3 data-id="heading-2">ä»€ä¹ˆæ˜¯Proxyï¼ˆä»£ç†ï¼‰ï¼Ÿ</h3>
<p><strong>Proxy</strong> å¯¹è±¡ç”¨äºåˆ›å»ºä¸€ä¸ªå¯¹è±¡çš„ä»£ç†ï¼Œä»è€Œå®ç°å¯¹åŸºæœ¬æ“ä½œçš„æ‹¦æˆªå’Œè‡ªå®šä¹‰ï¼ˆå¦‚å±æ€§æŸ¥æ‰¾ã€èµ‹å€¼ã€æšä¸¾ã€å‡½æ•°è°ƒç”¨ç­‰ï¼‰ã€‚</p>
<h3 data-id="heading-3">Proxyå·¥ä½œæµç¨‹ç¤ºæ„å›¾</h3>
<pre><code class="hljs language-text" lang="text">
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   æ“ä½œè¯·æ±‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   è½¬å‘æ“ä½œ    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å®¢æˆ·ç«¯   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚  Proxy  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚ ç›®æ ‡å¯¹è±¡ â”‚
â”‚         â”‚             â”‚  ä»£ç†    â”‚             â”‚         â”‚
â”‚         â”‚â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚         â”‚â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   å“åº”ç»“æœ   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   å®é™…ç»“æœ    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“                           â†“
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ æ‹¦æˆªå’Œè‡ªå®šä¹‰  â”‚            â”‚ åŸå§‹è¡Œä¸º     â”‚
         â”‚   ï¼ˆé™·é˜±ï¼‰   â”‚            â”‚             â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h3 data-id="heading-4">ä»€ä¹ˆæ˜¯Reflectï¼ˆåå°„ï¼‰ï¼Ÿ</h3>
<p><strong>Reflect</strong> æ˜¯ä¸€ä¸ªå†…ç½®çš„å¯¹è±¡ï¼Œå®ƒæä¾›æ‹¦æˆª JavaScript æ“ä½œçš„æ–¹æ³•ã€‚è¿™äº›æ–¹æ³•ä¸ Proxy çš„é™·é˜±æ–¹æ³•ä¸€ä¸€å¯¹åº”ã€‚</p>
<h3 data-id="heading-5">ä¸ºä»€ä¹ˆéœ€è¦Reflectï¼Ÿ</h3>
<ol>
<li>ç»Ÿä¸€çš„æ“ä½œAPI</li>
<li>æ›´å¥½çš„é”™è¯¯å¤„ç†ï¼ˆè¿”å›å¸ƒå°”å€¼è€ŒéæŠ›å‡ºå¼‚å¸¸ï¼‰</li>
<li>ä¸Proxyé™·é˜±æ–¹æ³•ä¸€ä¸€å¯¹åº”</li>
</ol>
<h2 data-id="heading-6">ä»£ç†åŸºç¡€ï¼šåˆ›å»ºç¬¬ä¸€ä¸ªä»£ç†</h2>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ç›®æ ‡å¯¹è±¡</span>
<span class="hljs-keyword">const</span> target = {
  <span class="hljs-attr">name</span>: <span class="hljs-string">'å¼ ä¸‰'</span>,
  <span class="hljs-attr">age</span>: <span class="hljs-number">30</span>
};

<span class="hljs-comment">// å¤„ç†å™¨å¯¹è±¡ï¼ˆåŒ…å«é™·é˜±æ–¹æ³•ï¼‰</span>
<span class="hljs-keyword">const</span> handler = {
  <span class="hljs-comment">// æ‹¦æˆªå±æ€§è¯»å–</span>
  <span class="hljs-title function_">get</span>(<span class="hljs-params">target, property, receiver</span>) {

    <span class="hljs-comment">// æ·»åŠ è‡ªå®šä¹‰é€»è¾‘</span>
    <span class="hljs-keyword">if</span> (property === <span class="hljs-string">'age'</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-string">`<span class="hljs-subst">${target[property]}</span>å²`</span>;
    }

    <span class="hljs-comment">// é»˜è®¤è¡Œä¸ºï¼šä½¿ç”¨Reflect</span>
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">get</span>(target, property, receiver);
  },

  <span class="hljs-comment">// æ‹¦æˆªå±æ€§è®¾ç½®</span>
  <span class="hljs-title function_">set</span>(<span class="hljs-params">target, property, value, receiver</span>) {
    <span class="hljs-comment">// æ·»åŠ éªŒè¯é€»è¾‘</span>
    <span class="hljs-keyword">if</span> (property === <span class="hljs-string">'age'</span> &amp;&amp; (value &lt; <span class="hljs-number">0</span> || value &gt; <span class="hljs-number">150</span>)) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">'å¹´é¾„å¿…é¡»åœ¨0-150ä¹‹é—´'</span>);
      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>; <span class="hljs-comment">// è¿”å›falseè¡¨ç¤ºè®¾ç½®å¤±è´¥</span>
    }

    <span class="hljs-comment">// é»˜è®¤è¡Œä¸ºï¼šä½¿ç”¨Reflect</span>
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">set</span>(target, property, value, receiver);
  }
};

<span class="hljs-comment">// åˆ›å»ºä»£ç†</span>
<span class="hljs-keyword">const</span> proxy = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Proxy</span>(target, handler);

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(proxy.<span class="hljs-property">name</span>);  <span class="hljs-comment">// å¼ ä¸‰</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(proxy.<span class="hljs-property">age</span>);   <span class="hljs-comment">// 30å²</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(target.<span class="hljs-property">age</span>); <span class="hljs-comment">// 30</span>
</code></pre>
<h2 data-id="heading-7">13ç§å¯æ‹¦æˆªçš„é™·é˜±æ–¹æ³•</h2>
<h3 data-id="heading-8">å®Œæ•´é™·é˜±æ–¹æ³•æ¦‚è§ˆ</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> completeHandler = {
  <span class="hljs-comment">// 1. å±æ€§è®¿é—®æ‹¦æˆª</span>
  <span class="hljs-title function_">get</span>(<span class="hljs-params">target, prop, receiver</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`get: <span class="hljs-subst">${prop}</span>`</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">get</span>(target, prop, receiver);
  },

  <span class="hljs-comment">// 2. å±æ€§èµ‹å€¼æ‹¦æˆª</span>
  <span class="hljs-title function_">set</span>(<span class="hljs-params">target, prop, value, receiver</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`set: <span class="hljs-subst">${prop}</span> = <span class="hljs-subst">${value}</span>`</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">set</span>(target, prop, value, receiver);
  },

  <span class="hljs-comment">// 3. inæ“ä½œç¬¦æ‹¦æˆª</span>
  <span class="hljs-title function_">has</span>(<span class="hljs-params">target, prop</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`has: <span class="hljs-subst">${prop}</span>`</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">has</span>(target, prop);
  },

  <span class="hljs-comment">// 4. deleteæ“ä½œç¬¦æ‹¦æˆª</span>
  <span class="hljs-title function_">deleteProperty</span>(<span class="hljs-params">target, prop</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`delete: <span class="hljs-subst">${prop}</span>`</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">deleteProperty</span>(target, prop);
  },

  <span class="hljs-comment">// 5. æ„é€ å‡½æ•°è°ƒç”¨æ‹¦æˆª</span>
  <span class="hljs-title function_">construct</span>(<span class="hljs-params">target, args, newTarget</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`construct with args:`</span>, args);
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">construct</span>(target, args, newTarget);
  },

  <span class="hljs-comment">// 6. å‡½æ•°è°ƒç”¨æ‹¦æˆª</span>
  <span class="hljs-title function_">apply</span>(<span class="hljs-params">target, thisArg, args</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`apply: thisArg=`</span>, thisArg, <span class="hljs-string">'args='</span>, args);
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">apply</span>(target, thisArg, args);
  },

  <span class="hljs-comment">// 7. Object.getOwnPropertyDescriptoræ‹¦æˆª</span>
  <span class="hljs-title function_">getOwnPropertyDescriptor</span>(<span class="hljs-params">target, prop</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`getOwnPropertyDescriptor: <span class="hljs-subst">${prop}</span>`</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">getOwnPropertyDescriptor</span>(target, prop);
  },

  <span class="hljs-comment">// 8. Object.definePropertyæ‹¦æˆª</span>
  <span class="hljs-title function_">defineProperty</span>(<span class="hljs-params">target, prop, descriptor</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`defineProperty: <span class="hljs-subst">${prop}</span>`</span>, descriptor);
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">defineProperty</span>(target, prop, descriptor);
  },

  <span class="hljs-comment">// 9. åŸå‹è®¿é—®æ‹¦æˆª</span>
  <span class="hljs-title function_">getPrototypeOf</span>(<span class="hljs-params">target</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'getPrototypeOf'</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">getPrototypeOf</span>(target);
  },

  <span class="hljs-comment">// 10. åŸå‹è®¾ç½®æ‹¦æˆª</span>
  <span class="hljs-title function_">setPrototypeOf</span>(<span class="hljs-params">target, prototype</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`setPrototypeOf:`</span>, prototype);
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">setPrototypeOf</span>(target, prototype);
  },

  <span class="hljs-comment">// 11. å¯æ‰©å±•æ€§åˆ¤æ–­æ‹¦æˆª</span>
  <span class="hljs-title function_">isExtensible</span>(<span class="hljs-params">target</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'isExtensible'</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">isExtensible</span>(target);
  },

  <span class="hljs-comment">// 12. é˜²æ­¢æ‰©å±•æ‹¦æˆª</span>
  <span class="hljs-title function_">preventExtensions</span>(<span class="hljs-params">target</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'preventExtensions'</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">preventExtensions</span>(target);
  },

  <span class="hljs-comment">// 13. è‡ªèº«å±æ€§æšä¸¾æ‹¦æˆª</span>
  <span class="hljs-title function_">ownKeys</span>(<span class="hljs-params">target</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'ownKeys'</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">ownKeys</span>(target);
  }
};
</code></pre>
<h3 data-id="heading-9">é™·é˜±æ–¹æ³•è¯¦ç»†è§£æ</h3>
<h4 data-id="heading-10">1. geté™·é˜±ï¼šå±æ€§è®¿é—®æ‹¦æˆª</h4>
<p>get() ä¼šåœ¨è·å–å±æ€§å€¼çš„æ“ä½œä¸­è¢«è°ƒç”¨ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> getHandler = {
  <span class="hljs-title function_">get</span>(<span class="hljs-params">target, property, receiver</span>) {
    <span class="hljs-comment">// å¤„ç†ä¸å­˜åœ¨çš„å±æ€§</span>
    <span class="hljs-keyword">if</span> (!(property <span class="hljs-keyword">in</span> target)) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`å±æ€§ä¸å­˜åœ¨: <span class="hljs-subst">${property}</span>`</span>);
    }

    <span class="hljs-comment">// å¤„ç†ç§æœ‰å±æ€§ï¼ˆçº¦å®šä»¥_å¼€å¤´çš„å±æ€§ä¸ºç§æœ‰ï¼‰</span>
    <span class="hljs-keyword">if</span> (property.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">'_'</span>)) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`ä¸èƒ½è®¿é—®ç§æœ‰å±æ€§: <span class="hljs-subst">${property}</span>`</span>);
    }
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">get</span>(target, property, receiver);
  }
};
</code></pre>
<ul>
<li>å‚æ•°è¯´æ˜ï¼š
<ol>
<li>targetï¼šç›®æ ‡å¯¹è±¡</li>
<li>propertyï¼šå¼•ç”¨çš„ç›®æ ‡å¯¹è±¡ä¸Šçš„å±æ€§</li>
<li>receiverï¼šä»£ç†å¯¹è±¡</li>
</ol>
</li>
<li>è¿”å›å€¼è¯´æ˜ï¼šè¿”å›å€¼æ— é™åˆ¶</li>
</ul>
<h4 data-id="heading-11">2. seté™·é˜±ï¼šå±æ€§èµ‹å€¼æ‹¦æˆª</h4>
<p>set() ä¼šåœ¨è®¾ç½®å±æ€§å€¼çš„æ“ä½œä¸­è¢«è°ƒç”¨ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> setHandler = {
  <span class="hljs-title function_">set</span>(<span class="hljs-params">target, property, value, receiver</span>) {
    <span class="hljs-comment">// åªè¯»å±æ€§æ£€æŸ¥ï¼ˆçº¦å®šä»¥$å¼€å¤´çš„å±æ€§ä¸ºåªè¯»ï¼‰</span>
    <span class="hljs-keyword">if</span> (property.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">'$'</span>)) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`å±æ€§ä¸å¯ä¿®æ”¹: <span class="hljs-subst">${property}</span>`</span>);
    }
    <span class="hljs-comment">// æ‰§è¡Œè®¾ç½®</span>
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">set</span>(target, property, value, receiver);
  }
};
</code></pre>
<ul>
<li>å‚æ•°è¯´æ˜ï¼š
<ol>
<li>targetï¼šç›®æ ‡å¯¹è±¡</li>
<li>propertyï¼šå¼•ç”¨çš„ç›®æ ‡å¯¹è±¡ä¸Šçš„å±æ€§</li>
<li>valueï¼šè¦ç»™å±æ€§è®¾ç½®çš„å€¼</li>
<li>receiverï¼šä»£ç†å¯¹è±¡</li>
</ol>
</li>
<li>è¿”å›å€¼è¯´æ˜ï¼šè¿”å› true è¡¨ç¤ºæˆåŠŸï¼›è¿”å›falseè¡¨ç¤ºå¤±è´¥ã€‚</li>
</ul>
<h4 data-id="heading-12">3. hasé™·é˜±ï¼šinæ“ä½œç¬¦æ‹¦æˆª</h4>
<p>has() ä¼šåœ¨ in æ“ä½œç¬¦ä¸­è¢«è°ƒç”¨ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> hasHandler = {
  <span class="hljs-title function_">has</span>(<span class="hljs-params">target, property</span>) {
    <span class="hljs-comment">// éšè—æŸäº›å±æ€§ï¼ˆä¸åœ¨inæ“ä½œä¸­æš´éœ²ï¼‰</span>
    <span class="hljs-keyword">const</span> hiddenProperties = [<span class="hljs-string">'password'</span>, <span class="hljs-string">'token'</span>, <span class="hljs-string">'_internal'</span>];
    <span class="hljs-keyword">if</span> (hiddenProperties.<span class="hljs-title function_">includes</span>(property)) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`éšè—å±æ€§: <span class="hljs-subst">${property}</span>`</span>);
      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }

    <span class="hljs-comment">// è™šæ‹Ÿå±æ€§ï¼ˆä¸å­˜åœ¨ä½†è¿”å›trueï¼‰</span>
    <span class="hljs-keyword">const</span> virtualProperties = [<span class="hljs-string">'isAdmin'</span>, <span class="hljs-string">'hasAccess'</span>];
    <span class="hljs-keyword">if</span> (virtualProperties.<span class="hljs-title function_">includes</span>(property)) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`è™šæ‹Ÿå±æ€§: <span class="hljs-subst">${property}</span>`</span>);
      <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }

    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">has</span>(target, property);
  }
};
</code></pre>
<ul>
<li>å‚æ•°è¯´æ˜ï¼š
<ol>
<li>targetï¼šç›®æ ‡å¯¹è±¡</li>
<li>valueï¼šè¦ç»™å±æ€§è®¾ç½®çš„å€¼</li>
</ol>
</li>
<li>è¿”å›å€¼è¯´æ˜ï¼šè¿”å›å¸ƒå°”å€¼è¡¨ç¤ºå±æ€§æ˜¯å¦å­˜åœ¨ï¼Œè¿”å›éå¸ƒå°”å‹ä¼šè¢«è½¬æˆå¸ƒå°”å‹ã€‚</li>
</ul>
<blockquote>
<p>æ³¨ï¼šObject.keys() ä¸å— has() å½±å“ï¼Œä»ä¼šè¿”å›æ‰€æœ‰å±æ€§ã€‚</p>
</blockquote>
<h4 data-id="heading-13">4. applyé™·é˜±ï¼šå‡½æ•°è°ƒç”¨æ‹¦æˆª</h4>
<p>apply() ä¼šåœ¨è°ƒç”¨å‡½æ•°æ—¶è¢«è°ƒç”¨ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> applyHandler = {
  <span class="hljs-title function_">apply</span>(<span class="hljs-params">target, thisArg, argumentsList</span>) {
    <span class="hljs-comment">// å‚æ•°éªŒè¯</span>
    <span class="hljs-keyword">if</span> (target.<span class="hljs-property">name</span> === <span class="hljs-string">'calculate'</span>) {
      <span class="hljs-keyword">if</span> (argumentsList.<span class="hljs-property">length</span> &lt; <span class="hljs-number">2</span>) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'calculateå‡½æ•°éœ€è¦è‡³å°‘2ä¸ªå‚æ•°'</span>);
      }
      <span class="hljs-keyword">if</span> (!argumentsList.<span class="hljs-title function_">every</span>(<span class="hljs-function"><span class="hljs-params">arg</span> =&gt;</span> <span class="hljs-keyword">typeof</span> arg === <span class="hljs-string">'number'</span>)) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'calculateå‡½æ•°çš„æ‰€æœ‰å‚æ•°å¿…é¡»æ˜¯æ•°å­—'</span>);
      }
    }
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">apply</span>(target, thisArg, argumentsList);
  }
};
</code></pre>
<ul>
<li>å‚æ•°è¯´æ˜ï¼š
<ol>
<li>targetï¼šç›®æ ‡å¯¹è±¡</li>
<li>thisArgï¼šè°ƒç”¨å‡½æ•°æ—¶çš„thiså‚æ•°</li>
<li>argumentsListï¼šè°ƒç”¨å‡½æ•°æ—¶çš„å‚æ•°åˆ—è¡¨</li>
</ol>
</li>
<li>è¿”å›å€¼è¯´æ˜ï¼šè¿”å›å€¼æ— é™åˆ¶</li>
</ul>
<h4 data-id="heading-14">5. constructé™·é˜±ï¼šæ„é€ å‡½æ•°æ‹¦æˆª</h4>
<p>construct() ä¼šåœ¨è°ƒç”¨å‡½æ•°æ—¶è¢«è°ƒç”¨ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> constructHandler = {
  <span class="hljs-title function_">construct</span>(<span class="hljs-params">target, argumentsList, newTarget</span>) {
    <span class="hljs-comment">// å•ä¾‹æ¨¡å¼ï¼šç¡®ä¿åªæœ‰ä¸€ä¸ªå®ä¾‹</span>
    <span class="hljs-keyword">if</span> (target.<span class="hljs-property">_instance</span>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'è¿”å›ç°æœ‰å®ä¾‹'</span>);
      <span class="hljs-keyword">return</span> target.<span class="hljs-property">_instance</span>;
    }

    <span class="hljs-comment">// åˆ›å»ºå®ä¾‹</span>
    <span class="hljs-keyword">const</span> instance = <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">construct</span>(target, argumentsList, newTarget);

    <span class="hljs-comment">// ä¸ºå•ä¾‹ä¿å­˜å®ä¾‹</span>
    <span class="hljs-keyword">if</span> (target.<span class="hljs-property">name</span> === <span class="hljs-string">'Singleton'</span>) {
      target.<span class="hljs-property">_instance</span> = instance;
    }

    <span class="hljs-comment">// ä¸ºå®ä¾‹æ·»åŠ é¢å¤–å±æ€§</span>
    instance.<span class="hljs-property">createdAt</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>();
    instance.<span class="hljs-property">_id</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>().<span class="hljs-title function_">toString</span>(<span class="hljs-number">36</span>).<span class="hljs-title function_">substr</span>(<span class="hljs-number">2</span>, <span class="hljs-number">9</span>);

    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'åˆ›å»ºæ–°å®ä¾‹ï¼ŒID:'</span>, instance.<span class="hljs-property">_id</span>);
    <span class="hljs-keyword">return</span> instance;
  }
};
</code></pre>
<ul>
<li>å‚æ•°è¯´æ˜ï¼š
<ol>
<li>targetï¼šç›®æ ‡æ„é€ å‡½æ•°</li>
<li>argumentsListï¼šä¼ ç»™ç›®æ ‡æ„é€ å‡½æ•°çš„å‚æ•°åˆ—è¡¨</li>
<li>newTargetï¼šæœ€åˆè¢«è°ƒç”¨çš„æ„é€ å‡½æ•°</li>
</ol>
</li>
<li>è¿”å›å€¼è¯´æ˜ï¼šå¿…é¡»è¿”å›ä¸€ä¸ªå¯¹è±¡</li>
</ul>
<h4 data-id="heading-15">6. ownKeysé™·é˜±ï¼šå½±å“Object.keys()ç­‰éå†</h4>
<p>ownKeys() ä¼šåœ¨Object.keys()åŠç±»ä¼¼æ–¹æ³•ä¸­è¢«è°ƒç”¨ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> ownKeysHandler = {
  <span class="hljs-title function_">ownKeys</span>(<span class="hljs-params">target</span>) {
    <span class="hljs-comment">// è¿‡æ»¤æ‰ä»¥_å¼€å¤´çš„ç§æœ‰å±æ€§</span>
    <span class="hljs-keyword">const</span> keys = <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">ownKeys</span>(target);
    <span class="hljs-keyword">return</span> keys.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">key</span> =&gt;</span> {
      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> key === <span class="hljs-string">'string'</span>) {
        <span class="hljs-keyword">return</span> !key.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">'_'</span>);
      }
      <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    });
  }
};
</code></pre>
<ul>
<li>å‚æ•°è¯´æ˜ï¼š
<ol>
<li>targetï¼šç›®æ ‡æ„é€ å‡½æ•°</li>
</ol>
</li>
<li>è¿”å›å€¼è¯´æ˜ï¼šå¿…é¡»è¿”å›ä¸€ä¸ªåŒ…å«å­—ç¬¦ä¸²æˆ–ç¬¦å·çš„å¯æšä¸¾å¯¹è±¡</li>
</ul>
<h4 data-id="heading-16">7. getOwnPropertyDescriptoré™·é˜±ï¼šå½±å“Object.getOwnPropertyDescriptor()</h4>
<p>getOwnPropertyDescriptor() ä¼šåœ¨Object.getOwnPropertyDescriptor()æ–¹æ³•ä¸­è¢«è°ƒç”¨ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> getOwnPropertyDescriptorHandler = {
  <span class="hljs-title function_">getOwnPropertyDescriptor</span>(<span class="hljs-params">target, prop</span>) {
    <span class="hljs-comment">// éšè—ç§æœ‰å±æ€§çš„æè¿°ç¬¦</span>
    <span class="hljs-keyword">if</span> (prop.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">'_'</span>)) {
      <span class="hljs-keyword">return</span> <span class="hljs-literal">undefined</span>;
    }
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">getOwnPropertyDescriptor</span>(target, prop);
  }
};
</code></pre>
<ul>
<li>å‚æ•°è¯´æ˜ï¼š
<ol>
<li>targetï¼šç›®æ ‡æ„é€ å‡½æ•°</li>
<li>propï¼šå¼•ç”¨çš„ç›®æ ‡å¯¹è±¡ä¸Šçš„å­—ç¬¦ä¸²å±æ€§</li>
</ol>
</li>
<li>è¿”å›å€¼è¯´æ˜ï¼šå¿…é¡»è¿”å›å¯¹è±¡ï¼Œæˆ–åœ¨å±æ€§ä¸å­˜åœ¨æ—¶è¿”å› undefined</li>
</ul>
<h4 data-id="heading-17">8. definePropertyé™·é˜±ï¼šæ‹¦æˆªObject.defineProperty()</h4>
<p>defineProperty() ä¼šåœ¨Object.defineProperty()æ–¹æ³•ä¸­è¢«è°ƒç”¨ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> definePropertyHandler = {
  <span class="hljs-title function_">defineProperty</span>(<span class="hljs-params">target, prop, descriptor</span>) {
    <span class="hljs-comment">// é˜²æ­¢ä¿®æ”¹åªè¯»å±æ€§</span>
    <span class="hljs-keyword">if</span> (prop === <span class="hljs-string">'id'</span> &amp;&amp; target.<span class="hljs-property">id</span>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">'idå±æ€§æ˜¯åªè¯»çš„'</span>);
      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">defineProperty</span>(target, prop, descriptor);
  }
};
</code></pre>
<ul>
<li>å‚æ•°è¯´æ˜ï¼š
<ol>
<li>targetï¼šç›®æ ‡æ„é€ å‡½æ•°</li>
<li>propï¼šå¼•ç”¨çš„ç›®æ ‡å¯¹è±¡ä¸Šçš„å­—ç¬¦ä¸²å±æ€§</li>
<li>descriptorï¼šåŒ…å«å¯é€‰çš„enumrableã€configurableã€valueã€get å’Œ set ç­‰å®šä¹‰çš„å¯¹è±¡</li>
</ol>
</li>
<li>è¿”å›å€¼è¯´æ˜ï¼šå¿…é¡»è¿”å›å¸ƒå°”å€¼ï¼Œè¡¨ç¤ºå±æ€§æ˜¯å¦æˆåŠŸå®šä¹‰</li>
</ul>
<h4 data-id="heading-18">9. deletePropertyé™·é˜±ï¼šæ‹¦æˆªdeleteæ“ä½œ</h4>
<p>deleteProperty() ä¼šåœ¨ delete æ“ä½œä¸­è¢«è°ƒç”¨ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> deletePropertyHandler = {
  <span class="hljs-title function_">deleteProperty</span>(<span class="hljs-params">target, prop</span>) {
    <span class="hljs-comment">// é˜²æ­¢åˆ é™¤é‡è¦å±æ€§</span>
    <span class="hljs-keyword">const</span> protectedProps = [<span class="hljs-string">'id'</span>, <span class="hljs-string">'createdAt'</span>];
    <span class="hljs-keyword">if</span> (protectedProps.<span class="hljs-title function_">includes</span>(prop)) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">`ä¸èƒ½åˆ é™¤å—ä¿æŠ¤çš„å±æ€§: <span class="hljs-subst">${prop}</span>`</span>);
      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">deleteProperty</span>(target, prop);
  }
};
</code></pre>
<ul>
<li>å‚æ•°è¯´æ˜ï¼š
<ol>
<li>targetï¼šç›®æ ‡æ„é€ å‡½æ•°</li>
<li>propertyï¼šå¼•ç”¨çš„ç›®æ ‡å¯¹è±¡ä¸Šçš„å±æ€§</li>
</ol>
</li>
<li>è¿”å›å€¼è¯´æ˜ï¼šå¿…é¡»è¿”å›å¸ƒå°”å€¼ï¼Œè¡¨ç¤ºå±æ€§æ˜¯å¦è¢«æˆåŠŸåˆ é™¤</li>
</ul>
<h4 data-id="heading-19">10. preventExtensionsé™·é˜±ï¼šæ‹¦æˆªObject.preventExtensions()</h4>
<p>preventExtensions() ä¼šåœ¨ Object.preventExtensions() æ–¹æ³•ä¸­è¢«è°ƒç”¨ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> preventExtensionsHandler = {
  <span class="hljs-title function_">preventExtensions</span>(<span class="hljs-params">target</span>) {
    <span class="hljs-comment">// åœ¨é˜»æ­¢æ‰©å±•å‰æ·»åŠ æ ‡è®°</span>
    target.<span class="hljs-property">_frozenAt</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>();
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">preventExtensions</span>(target);
  }
};
</code></pre>
<ul>
<li>å‚æ•°è¯´æ˜ï¼š
<ol>
<li>targetï¼šç›®æ ‡æ„é€ å‡½æ•°</li>
</ol>
</li>
<li>è¿”å›å€¼è¯´æ˜ï¼šå¿…é¡»è¿”å›å¸ƒå°”å€¼ï¼Œè¡¨ç¤º target æ˜¯å¦å·²ç»ä¸å¯æ‰©å±•</li>
</ul>
<h4 data-id="heading-20">11. getPrototypeOfé™·é˜±ï¼šæ‹¦æˆªObject.getPrototypeOf()</h4>
<p>getPrototypeOf() ä¼šåœ¨ Object.getPrototypeOf() æ–¹æ³•ä¸­è¢«è°ƒç”¨ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> getPrototypeOfHandler = {
  <span class="hljs-title function_">getPrototypeOf</span>(<span class="hljs-params">target</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">getPrototypeOf</span>(target);
  }
};
</code></pre>
<ul>
<li>å‚æ•°è¯´æ˜ï¼š
<ol>
<li>targetï¼šç›®æ ‡æ„é€ å‡½æ•°</li>
</ol>
</li>
<li>è¿”å›å€¼è¯´æ˜ï¼šå¿…é¡»è¿”å›å¯¹è±¡æˆ–null</li>
</ul>
<h4 data-id="heading-21">12. setPrototypeOfé™·é˜±ï¼šæ‹¦æˆªObject.setPrototypeOf()</h4>
<p>setPrototypeOf() ä¼šåœ¨ Object.setPrototypeOf() æ–¹æ³•ä¸­è¢«è°ƒç”¨ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> setPrototypeOfHandler = {
  <span class="hljs-title function_">setPrototypeOf</span>(<span class="hljs-params">target, prototype</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">setPrototypeOf</span>(target, prototype);
  }
};
</code></pre>
<ul>
<li>å‚æ•°è¯´æ˜ï¼š
<ol>
<li>targetï¼šç›®æ ‡æ„é€ å‡½æ•°</li>
<li>propertyï¼šå¼•ç”¨çš„ç›®æ ‡å¯¹è±¡ä¸Šçš„å±æ€§</li>
</ol>
</li>
<li>è¿”å›å€¼è¯´æ˜ï¼šå¿…é¡»è¿”å›å¸ƒå°”å€¼ï¼Œè¡¨ç¤ºåŸå‹èµ‹å€¼æ˜¯å¦æˆåŠŸ</li>
</ul>
<h4 data-id="heading-22">13. isExtensibleé™·é˜±ï¼šæ‹¦æˆªObject.isExtensible()</h4>
<p>isExtensible() ä¼šåœ¨ Object.isExtensible() æ–¹æ³•ä¸­è¢«è°ƒç”¨ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> isExtensibleHandler = {
  <span class="hljs-title function_">isExtensible</span>(<span class="hljs-params">targete</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">isExtensible</span>(targete);
  }
};
</code></pre>
<ul>
<li>å‚æ•°è¯´æ˜ï¼š
<ol>
<li>targetï¼šç›®æ ‡æ„é€ å‡½æ•°</li>
</ol>
</li>
<li>è¿”å›å€¼è¯´æ˜ï¼šå¿…é¡»è¿”å›å¸ƒå°”å€¼ï¼Œè¡¨ç¤º target æ˜¯å¦å¯æ‰©å±•</li>
</ul>
<h2 data-id="heading-23">å¯æ’¤é”€ä»£ç†</h2>
<h3 data-id="heading-24">ä»€ä¹ˆæ˜¯å¯æ’¤é”€ä»£ç†ï¼Ÿ</h3>
<p><strong>å¯æ’¤é”€ä»£ç†</strong>ï¼ˆRevocable Proxyï¼‰æ˜¯ä¸€ç§ç‰¹æ®Šçš„ä»£ç†ï¼Œå®ƒæä¾›äº†ä¸€ä¸ª <code>revoke()</code> æ–¹æ³•ï¼Œè°ƒç”¨è¯¥æ–¹æ³•åï¼Œä»£ç†å°†ä¸å†å¯ç”¨ï¼Œæ‰€æœ‰å¯¹ä»£ç†çš„æ“ä½œéƒ½ä¼šæŠ›å‡º <code>TypeError</code>ï¼Œå³ï¼šä¼šä¸­æ–­ä»£ç†å¯¹è±¡å’Œç›®æ ‡å¯¹è±¡ä¹‹é—´çš„è”ç³»ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> target = { <span class="hljs-attr">name</span>: <span class="hljs-string">'zhangsan'</span> };
<span class="hljs-keyword">const</span> handler = {
  <span class="hljs-title function_">get</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> <span class="hljs-string">'foo'</span>;
  }
}
<span class="hljs-comment">// åˆ›å»ºå¯æ’¤é”€ä»£ç†</span>
<span class="hljs-keyword">const</span> { proxy, revoke } = <span class="hljs-title class_">Proxy</span>.<span class="hljs-title function_">revocable</span>(target, handler);

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(proxy.<span class="hljs-property">name</span>); <span class="hljs-comment">// 'zhangsan'</span>

<span class="hljs-comment">// æ’¤é”€ä»£ç†</span>
<span class="hljs-title function_">revoke</span>();

<span class="hljs-comment">// ä»£ç†å·²å¤±æ•ˆ</span>
<span class="hljs-keyword">try</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(proxy.<span class="hljs-property">name</span>); <span class="hljs-comment">// TypeError: Cannot perform 'get' on a proxy that has been revoked</span>
} <span class="hljs-keyword">catch</span> (error) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'é”™è¯¯:'</span>, error.<span class="hljs-property">message</span>);
}
</code></pre>
<h2 data-id="heading-25">å®ç°å“åº”å¼æ•°æ®ï¼ˆVue3åŸç†ï¼‰</h2>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ç®€æ˜“ç‰ˆVue3å“åº”å¼ç³»ç»Ÿ</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ReactiveSystem</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">targetMap</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WeakMap</span>(); <span class="hljs-comment">// å­˜å‚¨ä¾èµ–å…³ç³»</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">effectStack</span> = [];          <span class="hljs-comment">// å½“å‰æ­£åœ¨æ‰§è¡Œçš„effect</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">batchQueue</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>();    <span class="hljs-comment">// æ‰¹é‡æ›´æ–°é˜Ÿåˆ—</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">isBatching</span> = <span class="hljs-literal">false</span>;        <span class="hljs-comment">// æ˜¯å¦å¤„äºæ‰¹é‡æ›´æ–°æ¨¡å¼</span>
  }

  <span class="hljs-comment">// æ ¸å¿ƒï¼šåˆ›å»ºå“åº”å¼å¯¹è±¡</span>
  <span class="hljs-title function_">reactive</span>(<span class="hljs-params">target</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Proxy</span>(target, {
      <span class="hljs-title function_">get</span>(<span class="hljs-params">target, key, receiver</span>) {
        <span class="hljs-comment">// è·å–åŸå§‹å€¼</span>
        <span class="hljs-keyword">const</span> result = <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">get</span>(target, key, receiver);

        <span class="hljs-comment">// ä¾èµ–æ”¶é›†</span>
        <span class="hljs-title function_">track</span>(target, key);

        <span class="hljs-comment">// æ·±åº¦å“åº”å¼ï¼ˆå¦‚æœå€¼æ˜¯å¯¹è±¡ï¼Œç»§ç»­ä»£ç†ï¼‰</span>
        <span class="hljs-keyword">if</span> (result &amp;&amp; <span class="hljs-keyword">typeof</span> result === <span class="hljs-string">'object'</span>) {
          <span class="hljs-keyword">return</span> <span class="hljs-title function_">reactive</span>(result);
        }

        <span class="hljs-keyword">return</span> result;
      },

      <span class="hljs-title function_">set</span>(<span class="hljs-params">target, key, value, receiver</span>) {
        <span class="hljs-comment">// è·å–æ—§å€¼</span>
        <span class="hljs-keyword">const</span> oldValue = target[key];

        <span class="hljs-comment">// è®¾ç½®æ–°å€¼</span>
        <span class="hljs-keyword">const</span> result = <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">set</span>(target, key, value, receiver);

        <span class="hljs-comment">// è§¦å‘æ›´æ–°ï¼ˆå€¼ç¡®å®æ”¹å˜æ—¶æ‰è§¦å‘ï¼‰</span>
        <span class="hljs-keyword">if</span> (oldValue !== value) {
          <span class="hljs-title function_">trigger</span>(target, key);
        }

        <span class="hljs-keyword">return</span> result;
      },

      <span class="hljs-comment">// å¤„ç†åˆ é™¤æ“ä½œ</span>
      <span class="hljs-title function_">deleteProperty</span>(<span class="hljs-params">target, key</span>) {
        <span class="hljs-keyword">const</span> hasKey = key <span class="hljs-keyword">in</span> target;
        <span class="hljs-keyword">const</span> result = <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">deleteProperty</span>(target, key);

        <span class="hljs-keyword">if</span> (hasKey &amp;&amp; result) {
          <span class="hljs-title function_">trigger</span>(target, key);
        }

        <span class="hljs-keyword">return</span> result;
      }
    });
  }

  <span class="hljs-comment">// ä¾èµ–æ”¶é›†</span>
  <span class="hljs-title function_">track</span>(<span class="hljs-params">target, key</span>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">effectStack</span>.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span>;

    <span class="hljs-keyword">let</span> depsMap = <span class="hljs-variable language_">this</span>.<span class="hljs-property">targetMap</span>.<span class="hljs-title function_">get</span>(target);
    <span class="hljs-keyword">if</span> (!depsMap) {
      depsMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">targetMap</span>.<span class="hljs-title function_">set</span>(target, depsMap);
    }

    <span class="hljs-keyword">let</span> dep = depsMap.<span class="hljs-title function_">get</span>(key);
    <span class="hljs-keyword">if</span> (!dep) {
      dep = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>();
      depsMap.<span class="hljs-title function_">set</span>(key, dep);
    }

    <span class="hljs-comment">// æ”¶é›†å½“å‰æ­£åœ¨æ‰§è¡Œçš„effect</span>
    <span class="hljs-keyword">const</span> activeEffect = <span class="hljs-variable language_">this</span>.<span class="hljs-property">effectStack</span>[<span class="hljs-variable language_">this</span>.<span class="hljs-property">effectStack</span>.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>];
    <span class="hljs-keyword">if</span> (activeEffect) {
      dep.<span class="hljs-title function_">add</span>(activeEffect);
      <span class="hljs-comment">// effectä¹Ÿéœ€è¦çŸ¥é“å“ªäº›ä¾èµ–æ”¶é›†äº†å®ƒ</span>
      activeEffect.<span class="hljs-property">deps</span>.<span class="hljs-title function_">push</span>(dep);
    }
  }

  <span class="hljs-comment">// è§¦å‘æ›´æ–°</span>
  <span class="hljs-title function_">trigger</span>(<span class="hljs-params">target, key</span>) {
    <span class="hljs-keyword">const</span> depsMap = <span class="hljs-variable language_">this</span>.<span class="hljs-property">targetMap</span>.<span class="hljs-title function_">get</span>(target);
    <span class="hljs-keyword">if</span> (!depsMap) <span class="hljs-keyword">return</span>;

    <span class="hljs-keyword">const</span> dep = depsMap.<span class="hljs-title function_">get</span>(key);
    <span class="hljs-keyword">if</span> (dep) {
      <span class="hljs-comment">// å¦‚æœæ˜¯æ‰¹é‡æ›´æ–°æ¨¡å¼ï¼ŒåŠ å…¥é˜Ÿåˆ—</span>
      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">isBatching</span>) {
        dep.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">effect</span> =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">batchQueue</span>.<span class="hljs-title function_">add</span>(effect));
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// ç«‹å³æ‰§è¡Œæ‰€æœ‰ä¾èµ–çš„effect</span>
        dep.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">effect</span> =&gt;</span> {
          <span class="hljs-keyword">if</span> (effect !== <span class="hljs-variable language_">this</span>.<span class="hljs-property">effectStack</span>[<span class="hljs-variable language_">this</span>.<span class="hljs-property">effectStack</span>.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>]) {
            effect.<span class="hljs-title function_">run</span>();
          }
        });
      }
    }
  }

  <span class="hljs-comment">// åˆ›å»ºeffectï¼ˆå‰¯ä½œç”¨ï¼‰</span>
  <span class="hljs-title function_">effect</span>(<span class="hljs-params">fn</span>) {
    <span class="hljs-keyword">const</span> effect = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReactiveEffect</span>(fn, <span class="hljs-variable language_">this</span>);
    effect.<span class="hljs-title function_">run</span>();

    <span class="hljs-comment">// è¿”å›åœæ­¢å‡½æ•°</span>
    <span class="hljs-keyword">const</span> runner = effect.<span class="hljs-property">run</span>.<span class="hljs-title function_">bind</span>(effect);
    runner.<span class="hljs-property">effect</span> = effect;
    runner.<span class="hljs-property">stop</span> = <span class="hljs-function">() =&gt;</span> effect.<span class="hljs-title function_">stop</span>();

    <span class="hljs-keyword">return</span> runner;
  }

  <span class="hljs-comment">// å¼€å§‹æ‰¹é‡æ›´æ–°</span>
  <span class="hljs-title function_">batchStart</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">isBatching</span> = <span class="hljs-literal">true</span>;
  }

  <span class="hljs-comment">// ç»“æŸæ‰¹é‡æ›´æ–°</span>
  <span class="hljs-title function_">batchEnd</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">isBatching</span> = <span class="hljs-literal">false</span>;

    <span class="hljs-comment">// æ‰§è¡Œé˜Ÿåˆ—ä¸­çš„æ‰€æœ‰effect</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">batchQueue</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">effect</span> =&gt;</span> {
      <span class="hljs-keyword">if</span> (effect !== <span class="hljs-variable language_">this</span>.<span class="hljs-property">effectStack</span>[<span class="hljs-variable language_">this</span>.<span class="hljs-property">effectStack</span>.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>]) {
        effect.<span class="hljs-title function_">run</span>();
      }
    });

    <span class="hljs-variable language_">this</span>.<span class="hljs-property">batchQueue</span>.<span class="hljs-title function_">clear</span>();
  }

  <span class="hljs-comment">// computedè®¡ç®—å±æ€§</span>
  <span class="hljs-title function_">computed</span>(<span class="hljs-params">getter</span>) {
    <span class="hljs-keyword">let</span> value;
    <span class="hljs-keyword">let</span> dirty = <span class="hljs-literal">true</span>;

    <span class="hljs-keyword">const</span> runner = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">effect</span>(<span class="hljs-function">() =&gt;</span> {
      value = <span class="hljs-title function_">getter</span>();
      dirty = <span class="hljs-literal">false</span>;
    });

    <span class="hljs-keyword">return</span> {
      <span class="hljs-keyword">get</span> <span class="hljs-title function_">value</span>() {
        <span class="hljs-keyword">if</span> (dirty) {
          <span class="hljs-title function_">runner</span>();
        }
        <span class="hljs-keyword">return</span> value;
      }
    };
  }

  <span class="hljs-comment">// watchä¾¦å¬å™¨</span>
  <span class="hljs-title function_">watch</span>(<span class="hljs-params">source, callback, options = {}</span>) {
    <span class="hljs-keyword">let</span> getter;

    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> source === <span class="hljs-string">'function'</span>) {
      getter = source;
    } <span class="hljs-keyword">else</span> {
      getter = <span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">traverse</span>(source);
    }

    <span class="hljs-keyword">let</span> oldValue;
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">job</span> = (<span class="hljs-params"/>) =&gt; {
      <span class="hljs-keyword">const</span> newValue = <span class="hljs-title function_">runner</span>();
      <span class="hljs-title function_">callback</span>(newValue, oldValue);
      oldValue = newValue;
    };

    <span class="hljs-keyword">const</span> runner = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">effect</span>(getter, {
      <span class="hljs-attr">lazy</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-attr">scheduler</span>: job
    });

    oldValue = <span class="hljs-title function_">runner</span>();

    <span class="hljs-keyword">if</span> (options.<span class="hljs-property">immediate</span>) {
      <span class="hljs-title function_">job</span>();
    }
  }

  <span class="hljs-comment">// æ·±åº¦éå†å¯¹è±¡ï¼ˆç”¨äºwatchï¼‰</span>
  <span class="hljs-title function_">traverse</span>(<span class="hljs-params">value, seen = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Set</span>()</span>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> value !== <span class="hljs-string">'object'</span> || value === <span class="hljs-literal">null</span> || seen.<span class="hljs-title function_">has</span>(value)) {
      <span class="hljs-keyword">return</span> value;
    }

    seen.<span class="hljs-title function_">add</span>(value);

    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> key <span class="hljs-keyword">in</span> value) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">traverse</span>(value[key], seen);
    }

    <span class="hljs-keyword">return</span> value;
  }
}

<span class="hljs-comment">// å“åº”å¼effectç±»</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ReactiveEffect</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">fn, scheduler</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">fn</span> = fn;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">scheduler</span> = scheduler;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">deps</span> = [];
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">active</span> = <span class="hljs-literal">true</span>;
  }

  <span class="hljs-title function_">run</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">active</span>) <span class="hljs-keyword">return</span>;

    <span class="hljs-keyword">try</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">scheduler</span>.<span class="hljs-property">effectStack</span>.<span class="hljs-title function_">push</span>(<span class="hljs-variable language_">this</span>);
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">fn</span>();
    } <span class="hljs-keyword">finally</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">scheduler</span>.<span class="hljs-property">effectStack</span>.<span class="hljs-title function_">pop</span>();
    }
  }

  <span class="hljs-title function_">stop</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">active</span>) {
      <span class="hljs-comment">// ä»æ‰€æœ‰ä¾èµ–ä¸­ç§»é™¤è‡ªå·±</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">deps</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">dep</span> =&gt;</span> dep.<span class="hljs-title function_">delete</span>(<span class="hljs-variable language_">this</span>));
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">deps</span>.<span class="hljs-property">length</span> = <span class="hljs-number">0</span>;
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">active</span> = <span class="hljs-literal">false</span>;
    }
  }
}
</code></pre>
<h2 data-id="heading-26">å®ç°ä¸å¯å˜æ•°æ®ï¼ˆimmer.jsåŸç†ï¼‰</h2>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ç®€æ˜“ç‰ˆimmerå®ç°</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Immer</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">baseState</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">baseState</span> = baseState;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">draft</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">createDraft</span>(baseState);
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">isModified</span> = <span class="hljs-literal">false</span>;
  }

  <span class="hljs-comment">// åˆ›å»ºè‰ç¨¿ï¼ˆä»£ç†ï¼‰</span>
  <span class="hljs-title function_">createDraft</span>(<span class="hljs-params">base</span>) {
    <span class="hljs-comment">// å¦‚æœä¸æ˜¯å¯¹è±¡ï¼Œç›´æ¥è¿”å›</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> base !== <span class="hljs-string">'object'</span> || base === <span class="hljs-literal">null</span>) {
      <span class="hljs-keyword">return</span> base;
    }

    <span class="hljs-comment">// å¤„ç†æ•°ç»„</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(base)) {
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">createArrayDraft</span>(base);
    }

    <span class="hljs-comment">// å¤„ç†å¯¹è±¡</span>
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">createObjectDraft</span>(base);
  }

  <span class="hljs-comment">// åˆ›å»ºå¯¹è±¡è‰ç¨¿</span>
  <span class="hljs-title function_">createObjectDraft</span>(<span class="hljs-params">base</span>) {
    <span class="hljs-keyword">const</span> draft = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(base) ? [] : {};

    <span class="hljs-comment">// å¤åˆ¶æ‰€æœ‰å±æ€§</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> key <span class="hljs-keyword">in</span> base) {
      <span class="hljs-keyword">if</span> (base.<span class="hljs-title function_">hasOwnProperty</span>(key)) {
        draft[key] = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">createDraft</span>(base[key]);
      }
    }

    <span class="hljs-comment">// åˆ›å»ºä»£ç†</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Proxy</span>(draft, {
      <span class="hljs-attr">get</span>: <span class="hljs-function">(<span class="hljs-params">target, prop, receiver</span>) =&gt;</span> {
        <span class="hljs-comment">// ç‰¹æ®Šå±æ€§å¤„ç†</span>
        <span class="hljs-keyword">if</span> (prop === <span class="hljs-string">'__immer_draft__'</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">if</span> (prop === <span class="hljs-string">'__immer_original__'</span>) <span class="hljs-keyword">return</span> base;

        <span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">get</span>(target, prop, receiver);
      },

      <span class="hljs-attr">set</span>: <span class="hljs-function">(<span class="hljs-params">target, prop, value, receiver</span>) =&gt;</span> {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">isModified</span> = <span class="hljs-literal">true</span>;

        <span class="hljs-comment">// å¦‚æœæ–°å€¼æ˜¯æ™®é€šå€¼ï¼Œç›´æ¥è®¾ç½®</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> value !== <span class="hljs-string">'object'</span> || value === <span class="hljs-literal">null</span>) {
          <span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">set</span>(target, prop, value, receiver);
        }

        <span class="hljs-comment">// å¦‚æœæ–°å€¼æ˜¯è‰ç¨¿ï¼Œè·å–å…¶æœ€ç»ˆçŠ¶æ€</span>
        <span class="hljs-keyword">if</span> (value.<span class="hljs-property">__immer_draft__</span>) {
          value = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">finalize</span>(value);
        }

        <span class="hljs-comment">// å¦‚æœæ–°å€¼æ˜¯å¯¹è±¡ï¼Œåˆ›å»ºæ–°çš„è‰ç¨¿</span>
        <span class="hljs-keyword">const</span> newDraft = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">createDraft</span>(value);
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">set</span>(target, prop, newDraft, receiver);
      },

      <span class="hljs-attr">deleteProperty</span>: <span class="hljs-function">(<span class="hljs-params">target, prop</span>) =&gt;</span> {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">isModified</span> = <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">deleteProperty</span>(target, prop);
      }
    });
  }

  <span class="hljs-comment">// åˆ›å»ºæ•°ç»„è‰ç¨¿ï¼ˆéœ€è¦ç‰¹æ®Šå¤„ç†ï¼‰</span>
  <span class="hljs-title function_">createArrayDraft</span>(<span class="hljs-params">base</span>) {
    <span class="hljs-keyword">const</span> draft = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">createObjectDraft</span>(base);

    <span class="hljs-comment">// ä»£ç†æ•°ç»„æ–¹æ³•</span>
    <span class="hljs-keyword">const</span> arrayMethods = [<span class="hljs-string">'push'</span>, <span class="hljs-string">'pop'</span>, <span class="hljs-string">'shift'</span>, <span class="hljs-string">'unshift'</span>, <span class="hljs-string">'splice'</span>, <span class="hljs-string">'sort'</span>, <span class="hljs-string">'reverse'</span>];

    arrayMethods.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">method</span> =&gt;</span> {
      <span class="hljs-keyword">const</span> originalMethod = <span class="hljs-title class_">Array</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>[method];

      draft[method] = <span class="hljs-keyword">function</span> (<span class="hljs-params">...args</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">isModified</span> = <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">return</span> originalMethod.<span class="hljs-title function_">apply</span>(<span class="hljs-variable language_">this</span>, args);
      }.<span class="hljs-title function_">bind</span>({ <span class="hljs-attr">isModified</span>: <span class="hljs-literal">false</span> }); <span class="hljs-comment">// è¿™é‡Œç®€åŒ–å¤„ç†</span>
    });

    <span class="hljs-keyword">return</span> draft;
  }

  <span class="hljs-comment">// è·å–è‰ç¨¿</span>
  <span class="hljs-title function_">getDraft</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">draft</span>;
  }

  <span class="hljs-comment">// å®Œæˆä¿®æ”¹ï¼Œç”Ÿæˆæ–°çŠ¶æ€</span>
  <span class="hljs-title function_">produce</span>(<span class="hljs-params">producer</span>) {
    <span class="hljs-comment">// æ‰§è¡Œç”Ÿäº§è€…å‡½æ•°</span>
    <span class="hljs-title function_">producer</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">draft</span>);

    <span class="hljs-comment">// å¦‚æœæ²¡æœ‰ä¿®æ”¹ï¼Œè¿”å›åŸçŠ¶æ€</span>
    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">isModified</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">baseState</span>;
    }

    <span class="hljs-comment">// æœ€ç»ˆåŒ–è‰ç¨¿ï¼Œç”Ÿæˆæ–°çŠ¶æ€</span>
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">finalize</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">draft</span>);
  }

  <span class="hljs-comment">// æœ€ç»ˆåŒ–è‰ç¨¿ï¼ˆå°†è‰ç¨¿è½¬æ¢ä¸ºæ™®é€šå¯¹è±¡ï¼‰</span>
  <span class="hljs-title function_">finalize</span>(<span class="hljs-params">draft</span>) {
    <span class="hljs-comment">// å¦‚æœä¸æ˜¯è‰ç¨¿ï¼Œç›´æ¥è¿”å›</span>
    <span class="hljs-keyword">if</span> (!draft || !draft.<span class="hljs-property">__immer_draft__</span>) {
      <span class="hljs-keyword">return</span> draft;
    }

    <span class="hljs-keyword">const</span> original = draft.<span class="hljs-property">__immer_original__</span>;
    <span class="hljs-keyword">const</span> result = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(original) ? [] : {};
    <span class="hljs-keyword">let</span> hasChanges = <span class="hljs-literal">false</span>;

    <span class="hljs-comment">// æ”¶é›†æ‰€æœ‰é”®ï¼ˆåŒ…æ‹¬åŸå¯¹è±¡å’Œæ–°å¯¹è±¡ï¼‰</span>
    <span class="hljs-keyword">const</span> allKeys = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>([
      ...<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(original || {}),
      ...<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(draft)
    ]);

    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> key <span class="hljs-keyword">of</span> allKeys) {
      <span class="hljs-keyword">const</span> originalValue = original ? original[key] : <span class="hljs-literal">undefined</span>;
      <span class="hljs-keyword">const</span> draftValue = draft[key];

      <span class="hljs-comment">// å¦‚æœå±æ€§è¢«åˆ é™¤</span>
      <span class="hljs-keyword">if</span> (!(key <span class="hljs-keyword">in</span> draft)) {
        hasChanges = <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">continue</span>;
      }

      <span class="hljs-comment">// å¦‚æœå€¼æ˜¯è‰ç¨¿ï¼Œé€’å½’æœ€ç»ˆåŒ–</span>
      <span class="hljs-keyword">if</span> (draftValue &amp;&amp; draftValue.<span class="hljs-property">__immer_draft__</span>) {
        <span class="hljs-keyword">const</span> finalized = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">finalize</span>(draftValue);
        <span class="hljs-keyword">if</span> (finalized !== originalValue) {
          hasChanges = <span class="hljs-literal">true</span>;
          result[key] = finalized;
        } <span class="hljs-keyword">else</span> {
          result[key] = originalValue;
        }
      }
      <span class="hljs-comment">// å¦‚æœå€¼è¢«ä¿®æ”¹</span>
      <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (draftValue !== originalValue) {
        hasChanges = <span class="hljs-literal">true</span>;
        result[key] = draftValue;
      }
      <span class="hljs-comment">// å€¼æœªä¿®æ”¹</span>
      <span class="hljs-keyword">else</span> {
        result[key] = originalValue;
      }
    }

    <span class="hljs-keyword">return</span> hasChanges ? result : original;
  }
}

<span class="hljs-comment">// ç®€åŒ–API</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">produce</span>(<span class="hljs-params">baseState, producer</span>) {
  <span class="hljs-keyword">const</span> immer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Immer</span>(baseState);
  <span class="hljs-keyword">return</span> immer.<span class="hljs-title function_">produce</span>(producer);
}

</code></pre>
<h2 data-id="heading-27">ç»“è¯­</h2>
<p>Proxyå’ŒReflectå¼€å¯äº†JavaScriptå…ƒç¼–ç¨‹çš„æ–°ç¯‡ç« ï¼Œå®ƒä»¬ä¸ä»…æ˜¯æ¡†æ¶å¼€å‘çš„åˆ©å™¨ï¼Œä¹Ÿæ˜¯ç†è§£ç°ä»£JavaScriptè¿è¡Œæ—¶ç‰¹æ€§çš„å…³é”®ã€‚å¯¹äºæ–‡ç« ä¸­é”™è¯¯çš„åœ°æ–¹æˆ–è€…æœ‰ä»»ä½•é—®é¢˜ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºç•™è¨€è®¨è®ºï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä½¿ç”¨ oxlint + oxfmt æ›¿æ¢ ESLint + Prettier]]></title>    <link>https://juejin.cn/post/7604685644684673076</link>    <guid>https://juejin.cn/post/7604685644684673076</guid>    <pubDate>2026-02-10T01:19:44.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604685644684673076" data-draft-id="7604685644684640308" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä½¿ç”¨ oxlint + oxfmt æ›¿æ¢ ESLint + Prettier"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2026-02-10T01:19:44.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Whbbit1999"/> <meta itemprop="url" content="https://juejin.cn/user/2225067267209288"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä½¿ç”¨ oxlint + oxfmt æ›¿æ¢ ESLint + Prettier
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2225067267209288/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Whbbit1999
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T01:19:44.000Z" title="Tue Feb 10 2026 01:19:44 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>æœ€è¿‘æˆ‘å°†è‡ªå·±çš„ Nest é¡¹ç›®ä¸­çš„ ESLint å’Œ Prettier æ›¿æ¢ä¸º oxlint å’Œ oxfmtï¼Œè‡³ä»Šè¿è¡Œè‰¯å¥½ã€‚æœ€æ˜æ˜¾çš„æ”¹å–„æ˜¯é€Ÿåº¦ï¼šåŸå…ˆå®Œæ•´çš„ lint æ£€æŸ¥éœ€è¦ 10 å¤šç§’ï¼Œç°åœ¨ä»…éœ€ 1 ç§’å·¦å³ï¼›ä¿å­˜æ–‡ä»¶æ—¶çš„æ ¼å¼åŒ–ä¹Ÿå‡ ä¹æ— æ„Ÿå»¶è¿Ÿã€‚ä»Šå¤©å°±æ¥åˆ†äº«ä¸€ä¸‹ä¸ºä»€ä¹ˆè¦åšè¿™ä¸ªæ›¿æ¢ï¼Œä»¥åŠå¦‚ä½•å¹³æ»‘è¿ç§»ã€‚</p>
<h2 data-id="heading-0">ä»€ä¹ˆæ˜¯ oxlint å’Œ oxfmt</h2>
<p>ä¸¤è€…éƒ½å±äº <strong>oxc</strong> é¡¹ç›®ï¼ˆä¸€ä¸ªç”¨ Rust ç¼–å†™çš„é«˜æ€§èƒ½ JavaScript/TypeScript å·¥å…·é“¾ï¼‰ã€‚</p>
<ul>
<li><strong>oxlint</strong> å¯¹æ ‡ ESLintï¼Œç”¨äºä»£ç è´¨é‡æ£€æŸ¥ã€‚</li>
<li><strong>oxfmt</strong> å¯¹æ ‡ Prettierï¼Œç”¨äºä»£ç è‡ªåŠ¨æ ¼å¼åŒ–ã€‚</li>
</ul>
<p>ç›®å‰å®ƒä»¬å·²å®ç°ç»å¤§å¤šæ•°å¸¸ç”¨è§„åˆ™ä¸é…ç½®é€‰é¡¹ï¼Œå…¼å®¹æ€§è‰¯å¥½ï¼Œå®Œå…¨èƒ½æ»¡è¶³æ—¥å¸¸å¼€å‘éœ€æ±‚ã€‚</p>
<p>ç”±äºé‡‡ç”¨ Rust ç¼–å†™ï¼Œå®ƒä»¬åœ¨æ€§èƒ½ä¸Šå…·æœ‰æ•°é‡çº§ä¼˜åŠ¿ï¼ŒåŒæ—¶ä¿æŒäº†ä¸ç°æœ‰é…ç½®ç›¸ä¼¼çš„è¿ç§»ä½“éªŒã€‚</p>
<h2 data-id="heading-1">ä¸ºä»€ä¹ˆé€‰æ‹©å®ƒä»¬ï¼Ÿ</h2>
<ol>
<li><strong>æè‡´çš„é€Ÿåº¦</strong>ï¼šç›¸æ¯” ESLintï¼Œoxlint åœ¨å¤§å‹é¡¹ç›®ä¸­é€šå¸¸å¿« 50 å€ä»¥ä¸Šï¼›oxfmt ä¹Ÿè¿œå¿«äº Prettierï¼Œå°¤å…¶åœ¨å®æ—¶æ ¼å¼åŒ–æ—¶æ„ŸçŸ¥æ˜æ˜¾ã€‚</li>
<li><strong>é«˜åº¦å…¼å®¹</strong>ï¼šæ”¯æŒå¸¸è§çš„ ESLint è§„åˆ™ï¼ˆåŒ…æ‹¬ TypeScriptï¼‰å’Œ Prettier é…ç½®æ–¹å¼ï¼Œè¿ç§»æˆæœ¬ä½ã€‚</li>
<li><strong>è¿ç§»ç®€å•</strong>ï¼šé…ç½®ç»“æ„ä¸åŸæœ‰å·¥å…·ç›¸ä¼¼ï¼Œå¤§éƒ¨åˆ†è§„åˆ™åç§°ä¸€è‡´ï¼Œåªéœ€å°‘é‡è°ƒæ•´å³å¯æ¥å…¥ã€‚</li>
<li><strong>ä¸“æ³¨æ›¿ä»£</strong>ï¼šç›¸æ¯”äºä¸€ä½“åŒ–å·¥å…·é“¾ï¼ˆå¦‚ Biomeï¼‰ï¼Œoxlint/oxfmt æ›´ä¸“æ³¨äºç›´æ¥æ›¿ä»£ ESLint/Prettierï¼Œå¯¹ç°æœ‰é¡¹ç›®æ”¹é€ æ›´å‹å¥½ã€‚</li>
</ol>
<p>å¦‚æœä½ æ­£åœ¨å¯»æ‰¾æ›´å¿«çš„ä»£ç æ£€æŸ¥ä¸æ ¼å¼åŒ–æ–¹æ¡ˆï¼Œä¸”ä¸å¸Œæœ›å¤§å¹…æ”¹åŠ¨é…ç½®ï¼Œoxlint + oxfmt æ˜¯ä¸€ä¸ªå€¼å¾—å°è¯•çš„é€‰æ‹©ã€‚å®ƒä»¬ä¸ä»…å¸¦æ¥äº†å¼€å‘ä½“éªŒä¸Šçš„æµç•…æ„Ÿï¼Œä¹Ÿå»¶ç»­äº†ç†Ÿæ‚‰çš„é…ç½®æ–¹å¼ï¼Œæ˜¯ç›®å‰ Rust å·¥å…·é“¾ä¸­è¿ç§»æˆæœ¬è¾ƒä½çš„ä¸€å¥—æ–¹æ¡ˆã€‚</p>
<h2 data-id="heading-2">åœ¨ç°æœ‰é¡¹ç›®ä¸­æˆ‘ä»¬å¦‚ä½•å°†eslint + prettieræ›¿æ¢ä¸º oxlint å’Œoxfmt</h2>
<p>æˆ‘è¿™é‡Œæœ‰ä¸€ä¸ªä¹‹å‰çš„ nest é¡¹ç›®ï¼Œä½¿ç”¨çš„æ˜¯ eslint + prettierçš„æ–¹æ¡ˆï¼Œæˆ‘ä»¬ä¸€èµ·å°†å®ƒæ”¹é€ ä¸€ä¸‹ã€‚å…·ä½“æ”¹é€ æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<h3 data-id="heading-3">1. å®‰è£…ä¾èµ–</h3>
<pre><code class="hljs language-shell" lang="shell">pnpm add -D oxlint oxfmt
</code></pre>
<h3 data-id="heading-4">2. æ”¹é€ è„šæœ¬</h3>
<p>å°†ä¹‹å‰ä½¿ç”¨ ESLint å’Œ Prettier çš„è„šæœ¬æ”¹æˆä½¿ç”¨ oxlint å’Œ oxfmt</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"scripts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"lint:check"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"oxlint"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"lint"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"oxlint --fix"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"fmt"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"oxfmt"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"fmt:check"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"oxfmt --check"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-5">3. è¿è¡Œè¿ç§»è„šæœ¬</h3>
<ul>
<li>Prettier è¿ç§»</li>
</ul>
<pre><code class="hljs language-shell" lang="shell">pnpm dlx oxfmt --migrate prettier
</code></pre>
<ul>
<li>ESLint è¿ç§»</li>
</ul>
<pre><code class="hljs language-shell" lang="shell">pnpm dlx @oxlint/migrate ./eslint.config.mjs
</code></pre>
<ul>
<li>é™åˆ¶å®ƒä»¬çš„è¿è¡ŒèŒƒå›´</li>
</ul>
<p>è¿™é‡Œæˆ‘ä¸éœ€è¦å®ƒæ¥æ ¼å¼åŒ– <code>drizzle</code> å’Œ <code>dist</code> ä¸­çš„æ–‡ä»¶ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ <code>.oxfmtrc.json</code> å’Œ <code>.oxlintrc.json</code> ä¸­æ·»åŠ ä»¥ä¸‹ä»£ç ã€‚ä½ å¯ä»¥æ ¹æ®ä½ è¦é™åˆ¶çš„èŒƒå›´æ¥é…ç½®</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-attr">"ignorePatterns"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"drizzle/**"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"dist/**/*"</span><span class="hljs-punctuation">]</span>
</code></pre>
<ul>
<li>åˆ é™¤ä¹‹å‰çš„ <code>.prettierrc</code></li>
<li>åˆ é™¤ eslint.config.mjs ä¸­çš„ prettier æ’ä»¶</li>
</ul>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> eslintPluginPrettierRecommended <span class="hljs-keyword">from</span> <span class="hljs-string">'eslint-plugin-prettier/recommended'</span>; <span class="hljs-comment">// [!code --]</span>
<span class="hljs-comment">// å…¶ä»–å†…å®¹</span>
eslintPluginPrettierRecommended, <span class="hljs-comment">// [!code --]</span>
</code></pre>
<ul>
<li>ç§»é™¤ prettier æ’ä»¶</li>
</ul>
<pre><code class="hljs language-shell" lang="shell">pnpm remove prettier
</code></pre>
<h3 data-id="heading-6">4. æ·»åŠ  vscode é…ç½®</h3>
<p><code>.vscode/extensions.json</code> ä¸­æ·»åŠ  oxc æ’ä»¶</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"recommendations"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"oxc.oxc-vscode"</span><span class="hljs-punctuation">,</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<blockquote>
<p>è¿™æ˜¯è®©åˆ«äººåœ¨ä½¿ç”¨è¯¥é¡¹ç›®æ—¶ vscode æç¤ºè¯¥é¡¹ç›®éœ€è¦å®‰è£… oxc</p>
</blockquote>
<p><code>.vscode/settings.json</code> æ”¹é€ </p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"oxc.fmt.configPath"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">".oxfmtrc.json"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"editor.defaultFormatter"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"oxc.oxc-vscode"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"editor.formatOnSave"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"[javascript]"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"editor.defaultFormatter"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"oxc.oxc-vscode"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"editor.formatOnSave"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"[typescript]"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"editor.defaultFormatter"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"oxc.oxc-vscode"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"editor.formatOnSave"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-7">5. è¿è¡Œè„šæœ¬æ£€æŸ¥æ˜¯å¦å¯ä»¥æ­£ç¡®æ ¼å¼åŒ–</h3>
<h3 data-id="heading-8">ä¸¤è€…è¿è¡Œé€Ÿåº¦å¯¹æ¯”</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9d10aeb99ac7461d9465d0f01fa83c64~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgV2hiYml0MTk5OQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771291186&amp;x-signature=57ypc6Wf8kKu792lfatEM02DBmc%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3402f401c6984b638648deddbf4900b0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgV2hiYml0MTk5OQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771291186&amp;x-signature=2oBqxTZLBSGLCuw7GkrlwN5zLqA%3D" alt="" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>