<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>掘金文章推荐</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>一个帮助开发者成长的社区</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[盘点 5 个大厂最近开源的 GitHub 项目。]]></title>    <link>https://juejin.cn/post/7592152007839399936</link>    <guid>https://juejin.cn/post/7592152007839399936</guid>    <pubDate>2026-01-07T05:35:00.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592152007839399936" data-draft-id="7592166340380753935" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="盘点 5 个大厂最近开源的 GitHub 项目。"/> <meta itemprop="keywords" content="GitHub"/> <meta itemprop="datePublished" content="2026-01-07T05:35:00.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="逛逛GitHub"/> <meta itemprop="url" content="https://juejin.cn/user/1442202996186093"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            盘点 5 个大厂最近开源的 GitHub 项目。
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1442202996186093/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    逛逛GitHub
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-07T05:35:00.000Z" title="Wed Jan 07 2026 05:35:00 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">01、英伟达开源 AI 玩游戏模型</h2>
<p>NitroGen 是英伟达开源的项目，让 AI 像人一样玩游戏。</p>
<p>开源一两周就有 1.2K 的 Star 了。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/254d1e11f4704df4b8bc7417c81e8d91~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768368900&amp;x-signature=Zn9inMrlkkknFZvZo3XVCRAg2kU%3D" alt="图片" loading="lazy"/></p>
<p>它不是那种只能玩特定游戏的脚本，而是一个通用的游戏大模型。</p>
<p>它的核心逻辑非常有意思：它像人类玩家一样，只看屏幕画面，然后决定手柄该怎么按。</p>
<p>更有趣的是它的训练方式。团队没有去对接成百上千个游戏的 API，而是直接利用了互联网上依然存在的海量游戏视频来进行行为克隆。</p>
<p>它通过看别人玩游戏学会了操作，经过训练后，它甚至能适应它从未见过的游戏。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a843fe2a92eb41529ebc6bcf5893a104~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768368900&amp;x-signature=NPt4ZRxRXuloFAsk6ZPhefKVpPg%3D" alt="图片" loading="lazy"/></p>
<p>目前这个项目已经开源了代码和模型，支持在 Windows 上运行。</p>
<p>只要你打开游戏，运行这个 Agent，它就能通过捕捉屏幕画面来接管操作。</p>
<pre><code class="hljs language-arduino" lang="arduino">开源地址：https:<span class="hljs-comment">//github.com/MineDojo/NitroGen</span>
</code></pre>
<h2 data-id="heading-1">02、Meta 推出音频分割模型</h2>
<p>Meta 之前的 Segment Anything Model 在图像分割领域可以说是杀疯了，现在他们把这套魔法带到了音频领域。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/424940ed27814a7db8923273d1969f41~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768368900&amp;x-signature=3M4KLVDTlcQw7wk5M%2Bqv0xTkzIE%3D" alt="图片" loading="lazy"/></p>
<p>SAM-Audio 的功能简单说就是音频版的抠图。</p>
<p>你给它一段嘈杂的录音，告诉它我要听里面的狗叫声或者把吉他声分离出来，它就能精准地把目标声音提取出来，顺便把剩下的背景音也分离开。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/324725897c9d40959af1ec244af30b0f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768368900&amp;x-signature=cLdQqtqfEyqMa99itXo9Z9YlYvs%3D" alt="图片" loading="lazy"/></p>
<p>它的交互方式非常灵活，不光支持文字指令，你甚至可以给它看一段视频，框选视频里的某个人或物体，它就能识别对应的声音并提取出来。</p>
<p>此外，它也支持通过时间戳来定位声音。这背后的技术利用了音频-视觉感知编码器，让模型能理解声音和画面、文本之间的语义联系。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cc000f6a40fc43e0b7038379dfc13e89~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768368900&amp;x-signature=33a1Z3qOQCbEft4LS8iHhoW7HJU%3D" alt="图片" loading="lazy"/></p>
<p>对于做视频剪辑、声音设计或者音频修复的人来说，这简直是神器。</p>
<pre><code class="hljs language-arduino" lang="arduino">开源地址：https:<span class="hljs-comment">//github.com/facebookresearch/sam-audio</span>
</code></pre>
<h2 data-id="heading-2">03、阿里推出图层 AI 生成模型</h2>
<p>Qwen-Image-Layered 生成的不是一张图，而是自带图层的图像，就像是你直接得到了一个 PSD 源文件。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/925d9b40075840b08063a825be17f36a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768368900&amp;x-signature=rET%2FKGWt%2BfDETZ22b%2FRlqdUBJ6k%3D" alt="图片" loading="lazy"/></p>
<p>这个模型能把图像拆解成透明的 RGBA 层。比如生成一张森林里的女孩，它会把女孩放在一层，身后的树木一层，天空又是一层。</p>
<p>你可以随意移动、缩放或者删除画面里的物体，而不会在背景上留下一个难看的黑洞，因为模型已经把被遮挡的背景部分也补全了。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dd76a7659bf8472f9dd856612ef11f4b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768368900&amp;x-signature=hB%2B16MpA5lLcKhWKo7fZRMmiihY%3D" alt="图片" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3391af8d065e4611bb9699b36ec3096c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768368900&amp;x-signature=KRmh9%2F4lWSj03MjihamHHIqUWDA%3D" alt="图片" loading="lazy"/></p>
<p>这对于设计师和二次创作者来说太重要了。</p>
<p>它让 AI 生成的内容瞬间具备了极高的可编辑性。你不仅可以用它生成新的分层图像，甚至可以把现有的普通图片丢进去，让它帮你拆成图层。</p>
<pre><code class="hljs language-arduino" lang="arduino">开源地址：https:<span class="hljs-comment">//github.com/QwenLM/Qwen-Image-Layered </span>
</code></pre>
<h2 data-id="heading-3">04、谷歌开源</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8c8bd6c85a1949608561b72e1385e6b9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768368900&amp;x-signature=xV5BYD9I22zGA4PjLUzlQXOcyFw%3D" alt="图片" loading="lazy"/></p>
<p>之前推荐过，这个谷歌开源的项目也登上过每周开源热榜。Google 定义了一套标准，让 AI 不仅仅会说话，还能变出用户界面 UI。</p>
<p>AI 发一串 JSON 数据告诉你的手机或浏览器：给我渲染一个日历组件，外加一个确认按钮。</p>
<p>你的客户端收到指令后，就会用原生的组件把这个界面画出来。</p>
<p>这样做既保证了界面的美观和交互体验，又避免了直接执行 AI 生成的代码所带来的安全风险。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8b2256c85bd946d683a5c34865075fe6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768368900&amp;x-signature=Dz8pUTYZtBXNa60l%2FrWDHBflbIg%3D" alt="图片" loading="lazy"/><img src="" alt="" loading="lazy"/></p>
<p>这个项目的牛逼之处是把 AI 的思考和界面的展示解耦了。</p>
<p>未来的聊天机器人可能不再只是一个对话框，而是一个能根据你的需求随时变身的全能 App？</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1cd7b3dd64ff4062b1057d13fac2f7b5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768368900&amp;x-signature=nU3pn%2Bu4E3SrifFUguGNlRrr7AU%3D" alt="图片" loading="lazy"/></p>
<pre><code class="hljs language-arduino" lang="arduino">开源地址：https:<span class="hljs-comment">//github.com/google/A2UI</span>
</code></pre>
<h2 data-id="heading-4">05、阿里开源语音交互大模型</h2>
<p>Fun-Audio-Chat 就是阿里通义团队开源的项目。</p>
<p>主打的是低延迟和自然对话，不像传统的语音交互那样有漫长的等待。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8ef558c7353645d19da1ec20a52d828c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768368900&amp;x-signature=aZMpc0WV%2FDydYsp6KjhMfnuD5JE%3D" alt="图片" loading="lazy"/></p>
<p>技术上，它搞了个双分辨率的架构，简单说就是用粗粒度的特征来处理语义，用细粒度的特征来保证音质，这样既省算力又能跑得快。</p>
<p>而且它通过 Core-Cocktail 训练法，在保留了强大的文本理解能力的同时，还能听懂你说话的语气，甚至在回复时带上相应的情感。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1bfdd72d29d146e58376a9c55d44dc97~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768368900&amp;x-signature=T2S9AVg2P0EbMFygU4ff0yJresg%3D" alt="图片" loading="lazy"/></p>
<p>它可以支持语音打断、甚至理解非语言的声音，比如笑声啥的。</p>
<p>对于想要开发实时语音聊天应用、客服机器人或者虚拟伴侣的开发者来说，这个开源项目提供了一套非常接近商业级效果的现成方案。</p>
<pre><code class="hljs language-arduino" lang="arduino">开源地址：https:<span class="hljs-comment">//github.com/FunAudioLLM/Fun-Audio-Chat</span>
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[前端向架构突围系列 - 架构方法（一）：概述 4+1 视图模型]]></title>    <link>https://juejin.cn/post/7592251792651698203</link>    <guid>https://juejin.cn/post/7592251792651698203</guid>    <pubDate>2026-01-07T03:32:58.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592251792651698203" data-draft-id="7592164124659384370" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="前端向架构突围系列 - 架构方法（一）：概述 4+1 视图模型"/> <meta itemprop="keywords" content="前端,架构,设计模式"/> <meta itemprop="datePublished" content="2026-01-07T03:32:58.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="前端王壮壮"/> <meta itemprop="url" content="https://juejin.cn/user/4473272506789485"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            前端向架构突围系列 - 架构方法（一）：概述 4+1 视图模型
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4473272506789485/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    前端王壮壮
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-07T03:32:58.000Z" title="Wed Jan 07 2026 03:32:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"「";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"」";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"✓";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f01ad05c7d7f44cc94a5c91a388c7ac3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv546L5aOu5aOu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768361578&amp;x-signature=7H9yzqshPICvA43cTt5Ryhvwvqs%3D" alt="Gemini_Generated_Image_wtlcmdwtlcmdwtlc.png" loading="lazy"/></p>
<p>这个模型由 Philippe Kruchten 在 1995 年提出。它的本质含义是：<strong>没有一种单一的视图能够涵盖系统的方方面面。不同的利益相关者（Stakeholders）关心的是不同的东西。</strong></p>
<ul>
<li><strong>业务方</strong>关心功能（能不能用？）。</li>
<li><strong>开发</strong>关心代码结构（好不好写？）。</li>
<li><strong>运维</strong>关心部署和硬件（稳不稳定？）。</li>
<li><strong>用户</strong>关心操作流程（顺不顺畅？）。</li>
</ul>
<p>架构师的职责，就是通过这 5 个视角，把这些“鸡同鸭讲”的需求统一成一个完整的系统设计。</p>
<p>为了让你更好理解，我将这个经典的后端/通用架构概念，<strong>完整“翻译”成前端架构师的视角</strong>。</p>
<hr/>
<h3 data-id="heading-0">1. 场景视图 (Scenarios / Use Cases View) —— “+1” 的那个核心</h3>
<p><strong>本质：系统的灵魂，它驱动了其他 4 个视图。</strong> 这是架构设计的<strong>起点</strong>。如果不知道系统要干什么，设计就无从谈起。</p>
<ul>
<li>
<p><strong>关注点</strong>：用户怎么用这个系统？核心业务流程是什么？</p>
</li>
<li>
<p><strong>谁看</strong>：所有利益相关者（产品经理、测试、开发、用户）。</p>
</li>
<li>
<p><strong>前端架构视角</strong>：</p>
<ul>
<li>这不是指某个具体的 Button 点击事件，而是<strong>关键链路 (Critical User Journeys)</strong> 。</li>
<li><strong>例子</strong>：用户进入首页 -&gt; 登录 -&gt; 浏览商品 -&gt; 加入购物车 -&gt; 结算。</li>
<li><strong>架构决策</strong>：如果“秒杀”是核心场景，那么你在后续的“处理视图”中就必须设计高并发的防抖策略；在“物理视图”中就要考虑 CDN 缓存。</li>
</ul>
</li>
</ul>
<pre><code class="hljs language-mermaid" lang="mermaid">graph LR
    %% 样式定义
    classDef icon fill:#fff9c4,stroke:#fbc02d,stroke-width:3px,color:#333,rx:50,ry:50;
    classDef step fill:#fff,stroke:#fbc02d,stroke-width:2px,color:#333,rx:10,ry:10;
    classDef note fill:#fffde7,stroke:none,color:#666;

    %% 左侧：核心概念
    User((用户&lt;br/&gt;User)):::icon

    %% 右侧：关键链路 (Critical Journey)
    subgraph Journey [关键链路: 秒杀场景]
        direction LR
        Step1[进入详情页]:::step --&gt; Step2[抢购点击]:::step
        Step2 --&gt; Step3[排队等待]:::step
        Step3 --&gt; Step4[创建订单]:::step
        Step4 --&gt; Step5[支付成功]:::step
    end

    User ==&gt; Step1

    %% 架构决策点
    Note1(架构决策点:&lt;br/&gt;CDN缓存, 骨架屏):::note -.-&gt; Step1
    Note2(架构决策点:&lt;br/&gt;高并发防抖, 乐观UI):::note -.-&gt; Step2
</code></pre>
<hr/>
<h3 data-id="heading-1">2. 逻辑视图 (Logical View) —— “功能是怎么组织的？”</h3>
<p><strong>本质：系统的抽象模型。</strong> 这是最接近业务逻辑的一层，忽略具体的代码文件，只看<strong>概念</strong>。</p>
<ul>
<li>
<p><strong>关注点</strong>：系统有哪些“部件”？它们之间是什么关系？</p>
</li>
<li>
<p><strong>谁看</strong>：开发人员、业务分析师。</p>
</li>
<li>
<p><strong>前端架构视角</strong>：</p>
<ul>
<li><strong>组件模型</strong>：原子组件 vs 业务组件。</li>
<li><strong>领域模型</strong>：User, Product, Order 等实体定义（TypeScript Interface 定义）。</li>
<li><strong>状态管理设计</strong>：全局状态（Redux/Pinia）存什么？局部状态存什么？模块间如何通信？</li>
<li><strong>例子</strong>：画一张图，展示 <code>OrderList</code> 组件依赖 <code>UserStore</code> 和 <code>API Service</code>，而不关心它们具体写在哪个文件里。</li>
</ul>
</li>
</ul>
<pre><code class="hljs language-mermaid" lang="mermaid">graph LR
    %% 样式定义
    classDef icon fill:#e1f5fe,stroke:#039be5,stroke-width:3px,color:#333,rx:50,ry:50;
    classDef layer fill:#fff,stroke:#039be5,stroke-width:2px,color:#333,rx:5,ry:5;
    classDef rel stroke:#90caf9,stroke-width:2px,stroke-dasharray: 5 5;

    %% 左侧
    Logic((抽象&lt;br/&gt;逻辑)):::icon

    %% 右侧：分层架构
    subgraph LayerSystem [前端逻辑分层]
        direction TB
        UI[&lt;b&gt;表现层 UI Layer&lt;/b&gt;&lt;br/&gt;Button, Layout, Page]:::layer
        Adapter[&lt;b&gt;适配层 Adapter&lt;/b&gt;&lt;br/&gt;Hooks, Presenters]:::layer
        Domain[&lt;b&gt;领域层 Domain&lt;/b&gt;&lt;br/&gt;UserEntity, CartModel]:::layer
        Infra[&lt;b&gt;基础层 Infra&lt;/b&gt;&lt;br/&gt;Axios, Storage, Logger]:::layer
    end

    Logic ==&gt; UI

    %% 依赖关系 (单向依赖是架构的关键)
    UI --&gt; Adapter
    Adapter --&gt; Domain
    Adapter --&gt; Infra
</code></pre>
<hr/>
<h3 data-id="heading-2">3. 开发视图 (Development / Implementation View) —— “代码是怎么写的？”</h3>
<p><strong>本质：系统的静态组织结构。</strong> 这是程序员每天面对的 IDE 里的样子。</p>
<ul>
<li>
<p><strong>关注点</strong>：文件目录怎么分？用什么框架？依赖怎么管？</p>
</li>
<li>
<p><strong>谁看</strong>：开发人员、构建工程师。</p>
</li>
<li>
<p><strong>前端架构视角</strong>：</p>
<ul>
<li><strong>工程化结构</strong>：Monorepo (Nx/Turborepo) 还是 Multirepo？</li>
<li><strong>目录规范</strong>：<code>src/components</code>, <code>src/hooks</code>, <code>src/utils</code> 怎么归类？</li>
<li><strong>依赖管理</strong>：<code>package.json</code> 里的依赖，公共库（Shared Library）如何抽取？</li>
<li><strong>构建工具</strong>：Vite/Webpack 配置，分包策略（Chunking）。</li>
<li><strong>例子</strong>：决定把所有的 API 请求封装在 <code>@api</code> 目录下，并禁止组件直接调用 <code>axios</code>，这就是开发视图的约束。</li>
</ul>
</li>
</ul>
<pre><code class="hljs language-mermaid" lang="mermaid">graph LR
    %% 样式定义
    classDef icon fill:#f3e5f5,stroke:#8e24aa,stroke-width:3px,color:#333,rx:50,ry:50;
    classDef file fill:#fff,stroke:#8e24aa,stroke-width:2px,color:#333,rx:2,ry:2;
    classDef tool fill:#f3e5f5,stroke:#8e24aa,stroke-width:1px,color:#333,stroke-dasharray: 5 5;

    %% 左侧
    Dev((工程&lt;br/&gt;代码)):::icon

    %% 右侧：目录与工具
    subgraph ProjectStructure [工程化与目录规范]
        direction TB
        
        subgraph Mono [Monorepo 仓库]
            Pkg1[packages/ui-lib]:::file
            Pkg2[apps/web-client]:::file
            Config[tsconfig.json]:::file
        end

        subgraph Toolchain [构建工具链]
            Vite(Vite / Webpack):::tool
            Lint(ESLint / Prettier):::tool
        end
    end

    Dev ==&gt; Mono
    Mono -.-&gt; Toolchain
</code></pre>
<hr/>
<h3 data-id="heading-3">4. 处理视图 (Process View) —— “系统是怎么运行的？”</h3>
<p><strong>本质：系统的动态行为、并发与性能。</strong> 对于前端来说，这是最容易被忽视，但最考验功底的一层。</p>
<ul>
<li>
<p><strong>关注点</strong>：性能、并发、同步/异步、时序。</p>
</li>
<li>
<p><strong>谁看</strong>：系统集成人员、高级开发。</p>
</li>
<li>
<p><strong>前端架构视角</strong>：</p>
<ul>
<li><strong>异步流控</strong>：接口竞态问题（Race Condition）怎么处理？Promise 并发限制。</li>
<li><strong>生命周期</strong>：SSR（服务端渲染）的数据注水（Hydration）流程是怎样的？</li>
<li><strong>性能优化</strong>：Web Worker 处理复杂计算，避免阻塞主线程（UI 线程）。</li>
<li><strong>通信机制</strong>：WebSocket 怎么保持心跳？跨 Tab 通信（SharedWorker/LocalStorage）怎么做？</li>
<li><strong>例子</strong>：设计一个“大文件分片上传”的功能，你需要画出切片、上传、暂停、续传的时序图，这属于处理视图。</li>
</ul>
</li>
</ul>
<hr/>
<pre><code class="hljs language-mermaid" lang="mermaid">graph LR
    %% 样式定义
    classDef icon fill:#e8f5e9,stroke:#43a047,stroke-width:3px,color:#333,rx:50,ry:50;
    classDef action fill:#fff,stroke:#43a047,stroke-width:2px,color:#333,rx:10,ry:10;
    classDef async fill:#c8e6c9,stroke:none,color:#333,rx:5,ry:5;

    %% 左侧
    Run((运行&lt;br/&gt;时序)):::icon

    %% 右侧：大文件上传时序
    subgraph AsyncProcess [大文件分片上传流程]
        direction TB
        Start[开始上传]:::action --&gt; Check{检查文件}:::action
        Check --&gt;|太大| Slice[Web Worker&lt;br/&gt;进行切片计算]:::async
        Slice --&gt; Upload[并发上传切片&lt;br/&gt;Promise.all]:::action
        Upload --&gt; Pause{网络中断?}:::action
        Pause --&gt;|是| Wait[暂停 &amp; 记录断点]:::async
        Pause --&gt;|否| Finish[合并请求]:::action
    end

    Run ==&gt; Start
</code></pre>
<h3 data-id="heading-4">5. 物理视图 (Physical / Deployment View) —— “代码跑在哪里？”</h3>
<p><strong>本质：软件到硬件的映射。</strong> 前端代码最终是要通过网络传输并运行在用户设备上的。</p>
<ul>
<li>
<p><strong>关注点</strong>：部署、网络拓扑、硬件限制。</p>
</li>
<li>
<p><strong>谁看</strong>：运维工程师 (DevOps)、系统管理员。</p>
</li>
<li>
<p><strong>前端架构视角</strong>：</p>
<ul>
<li><strong>部署策略</strong>：静态资源上 CDN，Nginx 反向代理配置。</li>
<li><strong>运行环境</strong>：BFF 层运行在 Docker 容器里；前端代码运行在用户的 Chrome/Safari 里（考虑兼容性）。</li>
<li><strong>网络环境</strong>：弱网情况下如何降级？离线包（PWA）策略。</li>
<li><strong>多端适配</strong>：同一套代码是跑在 PC 浏览器，还是内嵌在 App 的 WebView 里？</li>
<li><strong>例子</strong>：决定使用“灰度发布”系统，将新版本的 JS 文件只推给 10% 的用户，这属于物理视图的范畴。</li>
</ul>
</li>
</ul>
<pre><code class="hljs language-mermaid" lang="mermaid">graph LR
    %% 样式定义
    classDef icon fill:#fff3e0,stroke:#fb8c00,stroke-width:3px,color:#333,rx:50,ry:50;
    classDef device fill:#fff,stroke:#fb8c00,stroke-width:2px,color:#333,rx:5,ry:5;
    classDef net fill:#ffe0b2,stroke:none,color:#333,rx:20,ry:20;

    %% 左侧
    Deploy((部署&lt;br/&gt;环境)):::icon

    %% 右侧：部署拓扑
    subgraph NetworkTopology [资源分发与运行环境]
        direction LR
        
        subgraph Cloud [云端设施]
            CICD[CI/CD 构建产物]:::device --&gt; OSS[对象存储]:::device
            OSS --&gt; CDN((CDN 边缘节点)):::net
        end

        subgraph Client [用户终端]
            CDN --&gt; Browser[PC 浏览器]:::device
            CDN --&gt; Mobile[手机 WebView]:::device
            CDN --&gt; Hybrid[小程序]:::device
        end
    end

    Deploy ==&gt; Cloud
</code></pre>
<hr/>
<h3 data-id="heading-5">总结：软件开发的本质是什么？</h3>
<p>通过 4+1 视图，我们可以得出软件开发的本质：</p>
<ol>
<li>
<p><strong>控制复杂度 (Managing Complexity)</strong> ： 如果没有分层和视图，系统就是一团乱麻。4+1 试图把复杂问题拆解成 5 个维度分别解决。</p>
</li>
<li>
<p><strong>沟通与妥协 (Communication &amp; Trade-offs)</strong> ： 架构不是追求“完美的代码”，而是平衡各方利益。</p>
<ul>
<li>为了<strong>物理视图</strong>的加载速度（上 CDN），可能要牺牲<strong>开发视图</strong>的便利性（复杂的构建流程）。</li>
<li>为了<strong>处理视图</strong>的流畅度（虚拟列表），可能要增加<strong>逻辑视图</strong>的复杂度。</li>
</ul>
</li>
</ol>
<h3 data-id="heading-6">此时此刻，你可以做的 Next Step</h3>
<p>作为想转型的架构师，<strong>不要只写代码，开始写文档</strong>。</p>
<p>你可以挑选你当前负责的一个复杂模块，尝试写一份<strong>简易版的技术设计文档 (TDD)</strong> ，强制自己包含以下三点：</p>
<ol>
<li><strong>逻辑图</strong>：用方块图画出组件和数据流。</li>
<li><strong>处理图</strong>：用时序图画出关键的用户交互流程。</li>
<li><strong>部署说明</strong>：说明代码构建后怎么发布，有没有缓存策略。</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue 3 中 v-for 动态组件 ref 收集失败问题排查与解决]]></title>    <link>https://juejin.cn/post/7592241336289132595</link>    <guid>https://juejin.cn/post/7592241336289132595</guid>    <pubDate>2026-01-07T04:50:49.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592241336289132595" data-draft-id="7592176349713858598" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vue 3 中 v-for 动态组件 ref 收集失败问题排查与解决"/> <meta itemprop="keywords" content="Vue.js,前端,前端框架"/> <meta itemprop="datePublished" content="2026-01-07T04:50:49.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Hashan"/> <meta itemprop="url" content="https://juejin.cn/user/3523276916662526"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vue 3 中 v-for 动态组件 ref 收集失败问题排查与解决
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3523276916662526/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Hashan
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-07T04:50:49.000Z" title="Wed Jan 07 2026 04:50:49 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Vue 3 中 v-for 动态组件 ref 收集失败问题排查与解决</h2>
<h3 data-id="heading-1">问题描述</h3>
<p>在开发部门管理页面的搜索栏功能时，遇到了一个奇怪的问题：在 <code>v-for</code> 循环中渲染的动态组件，无法正确收集到 <code>ref</code> 数组中。</p>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5548ace0c0344a91aca132292ead51e0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGFzaGFu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768366249&amp;x-signature=gEsLtTch%2FjP4m3GdED3QIcVp%2B1w%3D" alt="image.png" width="30%" loading="lazy"/>
<h4 data-id="heading-2">问题现象</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// schema-search-bar.vue</span>
<span class="hljs-keyword">const</span> searchComList = <span class="hljs-title function_">ref</span>([]);

<span class="hljs-keyword">const</span> <span class="hljs-title function_">getValue</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">let</span> dtoObj = {};
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"searchComList"</span>, searchComList.<span class="hljs-property">value</span>); <span class="hljs-comment">// 输出: Proxy(Array) {}</span>
  searchComList.<span class="hljs-property">value</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">component</span>) =&gt;</span> {
    dtoObj = { ...dtoObj, ...component.<span class="hljs-title function_">getValue</span>() };
  });
  <span class="hljs-keyword">return</span> dtoObj; <span class="hljs-comment">// 返回: {}</span>
};
</code></pre>
<p><strong>现象：</strong></p>
<ul>
<li><code>searchComList.value</code> 始终是空数组 <code>[]</code></li>
<li>无法获取到任何子组件的实例</li>
<li>导致搜索功能无法正常工作</li>
</ul>
<h4 data-id="heading-3">代码结构</h4>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;el-form v-if="schema &amp;&amp; schema.properties" :inline="true"&gt;
    &lt;el-form-item v-for="(schemaItem, key) in schema.properties" :key="key"&gt;
      &lt;!-- 动态组件 --&gt;
      &lt;component 
        :ref="searchComList"  &lt;!-- ❌ 问题所在 --&gt;
        :is="SearchItemConfig[schemaItem.option?.comType]?.component" 
        :schemaKey="key"
        :schema="schemaItem"&gt;
      &lt;/component&gt;
    &lt;/el-form-item&gt;
  &lt;/el-form&gt;
&lt;/template&gt;

&lt;script setup&gt;
const searchComList = ref([]);
&lt;/script&gt;
</code></pre>
<h3 data-id="heading-4">排查过程</h3>
<h4 data-id="heading-5">1. 初步怀疑：打印时机问题</h4>
<p>最初怀疑是打印时机不对，组件还没有挂载完成。但即使使用 <code>nextTick</code> 或在 <code>onMounted</code> 中打印，<code>searchComList.value</code> 仍然是空数组。</p>
<h4 data-id="heading-6">2. 对比其他正常工作的代码</h4>
<p>在同一个项目中，发现 <code>schema-view.vue</code> 中类似的代码却能正常工作：</p>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- schema-view.vue - ✅ 正常工作 --&gt;
&lt;component 
  v-for="(item, key) in components" 
  :key="key" 
  :is="ComponentConfig[key]?.component" 
  ref="comListRef"  &lt;!-- ✅ 使用字符串形式 --&gt;
  @command="onComponentCommand"&gt;
&lt;/component&gt;

&lt;script setup&gt;
const comListRef = ref([]);
// comListRef.value 能正确收集到所有组件实例
&lt;/script&gt;
</code></pre>
<h4 data-id="heading-7">3. 发现关键差异</h4>
<p>对比两个文件的代码，发现了关键差异：</p>




















<table><thead><tr><th>文件</th><th>ref 写法</th><th>结果</th></tr></thead><tbody><tr><td><code>schema-view.vue</code></td><td><code>ref="comListRef"</code> (字符串)</td><td>✅ 正常工作</td></tr><tr><td><code>schema-search-bar.vue</code></td><td><code>:ref="searchComList"</code> (绑定对象)</td><td>❌ 无法收集</td></tr></tbody></table>
<h3 data-id="heading-8">根本原因</h3>
<h4 data-id="heading-9">Vue 3 中 v-for 使用 ref 的机制</h4>
<p>在 Vue 3 中，<code>v-for</code> 中使用 <code>ref</code> 时，<strong>两种写法的行为完全不同</strong>：</p>
<h5 data-id="heading-10">1. 字符串形式的 ref（自动收集到数组）</h5>
<pre><code class="hljs language-vue" lang="vue">&lt;component v-for="item in list" ref="comListRef" /&gt;
</code></pre>
<p><strong>行为：</strong></p>
<ul>
<li>Vue 会自动将 <code>ref</code> 的值设置为一个<strong>数组</strong></li>
<li>数组中的元素按顺序对应 <code>v-for</code> 中的每一项</li>
<li>这是 Vue 3 的<strong>特殊处理机制</strong></li>
</ul>
<h5 data-id="heading-11">2. 绑定 ref 对象（不会自动收集）</h5>
<pre><code class="hljs language-vue" lang="vue">&lt;component v-for="item in list" :ref="comListRef" /&gt;
</code></pre>
<p><strong>行为：</strong></p>
<ul>
<li><code>:ref</code> 绑定的是一个 ref 对象，Vue 会直接赋值</li>
<li>在 <code>v-for</code> 中，<strong>不会自动收集到数组</strong></li>
<li>每次循环都会覆盖上一次的值</li>
<li>最终只会保留最后一个组件的引用</li>
</ul>
<h4 data-id="heading-12">官方文档说明</h4>
<p>根据 Vue 3 官方文档：</p>
<blockquote>
<p>当在 <code>v-for</code> 中使用 <code>ref</code> 时，ref 的值将是一个数组，包含所有循环项对应的组件实例。</p>
</blockquote>
<p><strong>关键点：</strong> 这个特性<strong>只适用于字符串形式的 <code>ref</code></strong>，不适用于 <code>:ref</code> 绑定。</p>
<h3 data-id="heading-13">解决方案</h3>
<h4 data-id="heading-14">方案一：使用字符串形式的 ref（推荐）</h4>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;el-form-item v-for="(schemaItem, key) in schema.properties" :key="key"&gt;
    &lt;component 
      ref="searchComList"  &lt;!-- ✅ 去掉冒号，使用字符串形式 --&gt;
      :is="SearchItemConfig[schemaItem.option?.comType]?.component" 
      :schemaKey="key"
      :schema="schemaItem"&gt;
    &lt;/component&gt;
  &lt;/el-form-item&gt;
&lt;/template&gt;

&lt;script setup&gt;
const searchComList = ref([]);
// 现在 searchComList.value 会自动收集到所有组件实例
&lt;/script&gt;
</code></pre>
<h4 data-id="heading-15">方案二：使用函数形式的 ref（更灵活）</h4>
<p>如果需要更精细的控制（比如去重、按 key 索引等），可以使用函数形式：</p>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;el-form-item v-for="(schemaItem, key) in schema.properties" :key="key"&gt;
    &lt;component 
      :ref="(el) =&gt; handleRef(el, key)"  &lt;!-- ✅ 函数形式 --&gt;
      :is="SearchItemConfig[schemaItem.option?.comType]?.component" 
      :schemaKey="key"
      :schema="schemaItem"&gt;
    &lt;/component&gt;
  &lt;/el-form-item&gt;
&lt;/template&gt;

&lt;script setup&gt;
const searchComList = ref([]);
const componentMap = new Map();

const handleRef = (el, key) =&gt; {
  if (el) {
    // 如果已经存在，先移除旧的（避免重复）
    if (componentMap.has(key)) {
      const oldIndex = searchComList.value.indexOf(componentMap.get(key));
      if (oldIndex &gt; -1) {
        searchComList.value.splice(oldIndex, 1);
      }
    }
    // 添加新的组件实例
    componentMap.set(key, el);
    searchComList.value.push(el);
  } else {
    // 组件卸载时，从 Map 和数组中移除
    if (componentMap.has(key)) {
      const oldEl = componentMap.get(key);
      const index = searchComList.value.indexOf(oldEl);
      if (index &gt; -1) {
        searchComList.value.splice(index, 1);
      }
      componentMap.delete(key);
    }
  }
};
&lt;/script&gt;
</code></pre>
<h3 data-id="heading-16">技术要点总结</h3>
<h4 data-id="heading-17">1. Vue 3 ref 在 v-for 中的行为</h4>

























<table><thead><tr><th>写法</th><th>在 v-for 中的行为</th><th>适用场景</th></tr></thead><tbody><tr><td><code>ref="xxx"</code></td><td>自动收集到数组</td><td>✅ 推荐，简单场景</td></tr><tr><td><code>:ref="xxx"</code></td><td>不会自动收集，会覆盖</td><td>❌ 不适用于 v-for</td></tr><tr><td><code>:ref="(el) =&gt; fn(el)"</code></td><td>手动控制收集逻辑</td><td>✅ 需要精细控制时</td></tr></tbody></table>
<h4 data-id="heading-18">2. 最佳实践</h4>
<ol>
<li>
<p><strong>在 v-for 中使用 ref 时，优先使用字符串形式</strong></p>
<pre><code class="hljs language-vue" lang="vue">&lt;component v-for="item in list" ref="comListRef" /&gt;
</code></pre>
</li>
<li>
<p><strong>如果需要按 key 索引或去重，使用函数形式</strong></p>
<pre><code class="hljs language-vue" lang="vue">&lt;component v-for="(item, key) in list" :ref="(el) =&gt; handleRef(el, key)" /&gt;
</code></pre>
</li>
<li>
<p><strong>避免在 v-for 中使用 <code>:ref="refObject"</code></strong></p>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- ❌ 不推荐 --&gt;
&lt;component v-for="item in list" :ref="comListRef" /&gt;
</code></pre>
</li>
</ol>
<h4 data-id="heading-19">3. 调试技巧</h4>
<p>当遇到 ref 收集问题时，可以：</p>
<ol>
<li><strong>检查 ref 的写法</strong>：确认是字符串还是绑定对象</li>
<li><strong>使用 nextTick 延迟检查</strong>：确保组件已挂载</li>
<li><strong>对比正常工作的代码</strong>：找出差异点</li>
<li><strong>查看 Vue DevTools</strong>：检查组件实例是否正确创建</li>
</ol>
<h3 data-id="heading-20">相关资源</h3>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fvuejs.org%2Fguide%2Fessentials%2Ftemplate-refs.html%23refs-inside-v-for" target="_blank" title="https://vuejs.org/guide/essentials/template-refs.html#refs-inside-v-for" ref="nofollow noopener noreferrer">Vue 3 官方文档 - Template Refs</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fvuejs.org%2Fapi%2Fbuilt-in-special-attributes.html%23ref" target="_blank" title="https://vuejs.org/api/built-in-special-attributes.html#ref" ref="nofollow noopener noreferrer">Vue 3 官方文档 - v-for with ref</a></li>
</ul>
<h3 data-id="heading-21">总结</h3>
<p>这个问题看似简单，但实际上涉及到 Vue 3 中 <code>ref</code> 在 <code>v-for</code> 中的特殊处理机制。关键点在于：</p>
<ol>
<li><strong>字符串形式的 <code>ref</code> 在 v-for 中会自动收集到数组</strong></li>
<li><strong>绑定形式的 <code>:ref</code> 在 v-for 中不会自动收集</strong></li>
<li><strong>函数形式的 <code>:ref</code> 可以手动控制收集逻辑</strong></li>
</ol>
<p>记住这个规则，可以避免很多类似的坑。在开发过程中，如果遇到 ref 收集问题，首先检查是否在 v-for 中使用了错误的 ref 写法。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[小程序"邪修"秘籍：那些官方文档不会告诉你的骚操作]]></title>    <link>https://juejin.cn/post/7592251792651763739</link>    <guid>https://juejin.cn/post/7592251792651763739</guid>    <pubDate>2026-01-07T03:46:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592251792651763739" data-draft-id="7592176349713645606" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="小程序&quot;邪修&quot;秘籍：那些官方文档不会告诉你的骚操作"/> <meta itemprop="keywords" content="前端,JavaScript"/> <meta itemprop="datePublished" content="2026-01-07T03:46:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员Agions"/> <meta itemprop="url" content="https://juejin.cn/user/360295545187751"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            小程序"邪修"秘籍：那些官方文档不会告诉你的骚操作
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/360295545187751/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员Agions
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-07T03:46:48.000Z" title="Wed Jan 07 2026 03:46:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p><strong>摘要</strong>：小程序开发，表面上是"戴着镣铐跳舞"，实际上是"在夹缝中求生存"。官方文档写得云淡风轻，实际开发却处处是坑。本文收录了多年小程序开发中积累的"邪修"技巧——那些不太正经但确实有效的解决方案。警告：部分技巧可能随时失效，请谨慎使用。</p>
</blockquote>
<hr/>
<h2 data-id="heading-0">引言：小程序开发者的日常崩溃</h2>
<p><strong>场景一：</strong>
产品经理："这个页面能不能像 H5 一样丝滑滚动？"
你："小程序有性能限制..."
产品经理："竞品可以。"
你：（内心崩溃）</p>
<p><strong>场景二：</strong>
设计师："这个动画效果很简单啊，就是一个弹性回弹。"
你："小程序的动画 API..."
设计师："Figma 里一秒钟就做出来了。"
你：（开始掉头发）</p>
<p><strong>场景三：</strong>
测试："这个在 iOS 上正常，安卓上怎么崩了？"
你："我看看..."（打开微信开发者工具，一切正常）
你："真机调试..."（问题复现）
你："这..."
测试："还有，在微信 8.0.32 版本上也有问题。"
你：（想转行）</p>
<p><strong>欢迎来到小程序开发的世界。</strong></p>
<p>今天，我要分享一些"邪修"技巧——那些官方文档不会告诉你，但能救你命的骚操作。</p>
<hr/>
<h2 data-id="heading-1">第一章：性能优化の黑魔法</h2>
<h3 data-id="heading-2">1.1 setData 的"分片"艺术</h3>
<p><strong>问题：</strong> setData 数据量大时，页面卡顿严重。</p>
<p><strong>官方建议：</strong> 减少 setData 的数据量。</p>
<p><strong>邪修技巧：</strong> 数据分片 + 路径更新</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ❌ 错误做法：一次性更新大数组</span>
<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setData</span>({
  <span class="hljs-attr">list</span>: newList, <span class="hljs-comment">// 假设有 1000 条数据</span>
})

<span class="hljs-comment">// ✅ 邪修技巧一：路径更新（只更新变化的部分）</span>
<span class="hljs-comment">// 假设只有第 5 条数据变了</span>
<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setData</span>({
  <span class="hljs-string">"list[5].name"</span>: <span class="hljs-string">"新名字"</span>,
  <span class="hljs-string">"list[5].status"</span>: <span class="hljs-string">"updated"</span>,
})

<span class="hljs-comment">// ✅ 邪修技巧二：分片更新（大数据量时）</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">setDataInChunks</span>(<span class="hljs-params">data, chunkSize = <span class="hljs-number">20</span></span>) {
  <span class="hljs-keyword">const</span> keys = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(data)
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; keys.<span class="hljs-property">length</span>; i += chunkSize) {
    <span class="hljs-keyword">const</span> chunk = {}
    keys.<span class="hljs-title function_">slice</span>(i, i + chunkSize).<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">key</span>) =&gt;</span> {
      chunk[key] = data[key]
    })
    <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setData</span>(chunk, resolve)
    })
  }
}

<span class="hljs-comment">// ✅ 邪修技巧三：虚拟列表（终极方案）</span>
<span class="hljs-comment">// 只渲染可视区域的数据</span>
<span class="hljs-title class_">Page</span>({
  <span class="hljs-attr">data</span>: {
    <span class="hljs-attr">visibleList</span>: [], <span class="hljs-comment">// 当前可见的数据</span>
    <span class="hljs-attr">startIndex</span>: <span class="hljs-number">0</span>, <span class="hljs-comment">// 起始索引</span>
    <span class="hljs-attr">itemHeight</span>: <span class="hljs-number">100</span>, <span class="hljs-comment">// 每项高度</span>
    <span class="hljs-attr">containerHeight</span>: <span class="hljs-number">0</span>, <span class="hljs-comment">// 容器高度</span>
  },

  <span class="hljs-attr">fullList</span>: [], <span class="hljs-comment">// 完整数据放在非响应式属性中</span>

  <span class="hljs-title function_">onScroll</span>(<span class="hljs-params">e</span>) {
    <span class="hljs-keyword">const</span> { scrollTop } = e.<span class="hljs-property">detail</span>
    <span class="hljs-keyword">const</span> startIndex = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(scrollTop / <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-property">itemHeight</span>)
    <span class="hljs-keyword">const</span> visibleCount =
      <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">ceil</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-property">containerHeight</span> / <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-property">itemHeight</span>) + <span class="hljs-number">2</span>

    <span class="hljs-comment">// 只有 startIndex 变化时才更新</span>
    <span class="hljs-keyword">if</span> (startIndex !== <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-property">startIndex</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setData</span>({
        startIndex,
        <span class="hljs-attr">visibleList</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">fullList</span>.<span class="hljs-title function_">slice</span>(startIndex, startIndex + visibleCount),
      })
    }
  },
})
</code></pre>
<h3 data-id="heading-3">1.2 图片加载の"障眼法"</h3>
<p><strong>问题：</strong> 大量图片加载时，页面白屏或卡顿。</p>
<p><strong>邪修技巧：</strong> 渐进式加载 + 占位图 + 懒加载</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- WXML --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"image-wrapper"</span>&gt;</span>
  <span class="hljs-comment">&lt;!-- 占位骨架 --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">view</span>
    <span class="hljs-attr">class</span>=<span class="hljs-string">"skeleton"</span>
    <span class="hljs-attr">wx:if</span>=<span class="hljs-string">"{{!imageLoaded}}"</span>
    <span class="hljs-attr">style</span>=<span class="hljs-string">"background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%); background-size: 200% 100%; animation: shimmer 1.5s infinite;"</span>
  /&gt;</span>

  <span class="hljs-comment">&lt;!-- 缩略图（先加载小图） --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">image</span>
    <span class="hljs-attr">wx:if</span>=<span class="hljs-string">"{{!imageLoaded}}"</span>
    <span class="hljs-attr">class</span>=<span class="hljs-string">"thumbnail"</span>
    <span class="hljs-attr">src</span>=<span class="hljs-string">"{{thumbnailUrl}}"</span>
    <span class="hljs-attr">mode</span>=<span class="hljs-string">"aspectFill"</span>
  /&gt;</span>

  <span class="hljs-comment">&lt;!-- 原图（懒加载） --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">image</span>
    <span class="hljs-attr">class</span>=<span class="hljs-string">"main-image {{imageLoaded ? 'loaded' : ''}}"</span>
    <span class="hljs-attr">src</span>=<span class="hljs-string">"{{imageUrl}}"</span>
    <span class="hljs-attr">mode</span>=<span class="hljs-string">"aspectFill"</span>
    <span class="hljs-attr">lazy-load</span>
    <span class="hljs-attr">bindload</span>=<span class="hljs-string">"onImageLoad"</span>
    <span class="hljs-attr">binderror</span>=<span class="hljs-string">"onImageError"</span>
  /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>
</code></pre>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// JS</span>
<span class="hljs-title class_">Page</span>({
  <span class="hljs-attr">data</span>: {
    <span class="hljs-attr">imageLoaded</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">thumbnailUrl</span>: <span class="hljs-string">""</span>, <span class="hljs-comment">// 缩略图 URL（可以用 OSS 的图片处理参数生成）</span>
    <span class="hljs-attr">imageUrl</span>: <span class="hljs-string">""</span>,
  },

  <span class="hljs-title function_">onLoad</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> originalUrl = <span class="hljs-string">"https://example.com/big-image.jpg"</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setData</span>({
      <span class="hljs-comment">// 阿里云 OSS 图片处理：生成 100px 宽的缩略图</span>
      <span class="hljs-attr">thumbnailUrl</span>: <span class="hljs-string">`<span class="hljs-subst">${originalUrl}</span>?x-oss-process=image/resize,w_100`</span>,
      <span class="hljs-attr">imageUrl</span>: originalUrl,
    })
  },

  <span class="hljs-title function_">onImageLoad</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setData</span>({ <span class="hljs-attr">imageLoaded</span>: <span class="hljs-literal">true</span> })
  },

  <span class="hljs-title function_">onImageError</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// 加载失败时显示默认图</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setData</span>({
      <span class="hljs-attr">imageUrl</span>: <span class="hljs-string">"/images/default.png"</span>,
      <span class="hljs-attr">imageLoaded</span>: <span class="hljs-literal">true</span>,
    })
  },
})
</code></pre>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* WXSS */</span>
<span class="hljs-selector-class">.image-wrapper</span> {
  <span class="hljs-attribute">position</span>: relative;
  <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">200px</span>;
  <span class="hljs-attribute">overflow</span>: hidden;
}

<span class="hljs-selector-class">.skeleton</span> {
  <span class="hljs-attribute">position</span>: absolute;
  inset: <span class="hljs-number">0</span>;
}

<span class="hljs-selector-class">.thumbnail</span> {
  <span class="hljs-attribute">position</span>: absolute;
  inset: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">filter</span>: <span class="hljs-built_in">blur</span>(<span class="hljs-number">10px</span>);
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">scale</span>(<span class="hljs-number">1.1</span>);
}

<span class="hljs-selector-class">.main-image</span> {
  <span class="hljs-attribute">position</span>: absolute;
  inset: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">transition</span>: opacity <span class="hljs-number">0.3s</span> ease;
}

<span class="hljs-selector-class">.main-image</span><span class="hljs-selector-class">.loaded</span> {
  <span class="hljs-attribute">opacity</span>: <span class="hljs-number">1</span>;
}

<span class="hljs-keyword">@keyframes</span> shimmer {
  <span class="hljs-number">0%</span> {
    <span class="hljs-attribute">background-position</span>: -<span class="hljs-number">200%</span> <span class="hljs-number">0</span>;
  }
  <span class="hljs-number">100%</span> {
    <span class="hljs-attribute">background-position</span>: <span class="hljs-number">200%</span> <span class="hljs-number">0</span>;
  }
}
</code></pre>
<h3 data-id="heading-4">1.3 长列表の"回收站"策略</h3>
<p><strong>问题：</strong> 无限滚动列表，滚动久了内存爆炸。</p>
<p><strong>邪修技巧：</strong> DOM 回收 + 骨架占位</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 核心思路：只保留可视区域 ± 缓冲区的真实 DOM，其他用骨架占位</span>
<span class="hljs-title class_">Component</span>({
  <span class="hljs-attr">data</span>: {
    <span class="hljs-attr">list</span>: [],
    <span class="hljs-attr">recycledIndexes</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>(), <span class="hljs-comment">// 被回收的索引</span>
  },

  <span class="hljs-comment">// 配置</span>
  <span class="hljs-attr">BUFFER_SIZE</span>: <span class="hljs-number">5</span>, <span class="hljs-comment">// 缓冲区大小</span>
  <span class="hljs-attr">RECYCLE_THRESHOLD</span>: <span class="hljs-number">20</span>, <span class="hljs-comment">// 超出多少开始回收</span>

  <span class="hljs-attr">methods</span>: {
    <span class="hljs-title function_">onScroll</span>(<span class="hljs-params">e</span>) {
      <span class="hljs-keyword">const</span> { scrollTop } = e.<span class="hljs-property">detail</span>
      <span class="hljs-keyword">const</span> itemHeight = <span class="hljs-number">120</span>
      <span class="hljs-keyword">const</span> viewportHeight = <span class="hljs-variable language_">this</span>.<span class="hljs-property">viewportHeight</span> || <span class="hljs-number">600</span>

      <span class="hljs-comment">// 计算可视区域</span>
      <span class="hljs-keyword">const</span> startIndex = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(scrollTop / itemHeight)
      <span class="hljs-keyword">const</span> endIndex = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">ceil</span>((scrollTop + viewportHeight) / itemHeight)

      <span class="hljs-comment">// 计算需要保留的范围（可视区 + 缓冲区）</span>
      <span class="hljs-keyword">const</span> keepStart = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(<span class="hljs-number">0</span>, startIndex - <span class="hljs-variable language_">this</span>.<span class="hljs-property">BUFFER_SIZE</span>)
      <span class="hljs-keyword">const</span> keepEnd = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-property">list</span>.<span class="hljs-property">length</span>,
        endIndex + <span class="hljs-variable language_">this</span>.<span class="hljs-property">BUFFER_SIZE</span>
      )

      <span class="hljs-comment">// 回收超出范围的 DOM</span>
      <span class="hljs-keyword">const</span> recycledIndexes = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>()
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-property">list</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">_, index</span>) =&gt;</span> {
        <span class="hljs-keyword">if</span> (
          index &lt; keepStart - <span class="hljs-variable language_">this</span>.<span class="hljs-property">RECYCLE_THRESHOLD</span> ||
          index &gt; keepEnd + <span class="hljs-variable language_">this</span>.<span class="hljs-property">RECYCLE_THRESHOLD</span>
        ) {
          recycledIndexes.<span class="hljs-title function_">add</span>(index)
        }
      })

      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setData</span>({ <span class="hljs-attr">recycledIndexes</span>: [...recycledIndexes] })
    },
  },
})
</code></pre>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- WXML：根据是否被回收显示不同内容 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">scroll-view</span> <span class="hljs-attr">scroll-y</span> <span class="hljs-attr">bindscroll</span>=<span class="hljs-string">"onScroll"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"height: 100vh;"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">wx:for</span>=<span class="hljs-string">"{{list}}"</span> <span class="hljs-attr">wx:key</span>=<span class="hljs-string">"id"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"list-item"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"height: 120px;"</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 被回收的显示骨架 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">block</span> <span class="hljs-attr">wx:if</span>=<span class="hljs-string">"{{recycledIndexes.includes(index)}}"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"skeleton-item"</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">block</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- 未被回收的显示真实内容 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">block</span> <span class="hljs-attr">wx:else</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">image</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"{{item.image}}"</span> <span class="hljs-attr">lazy-load</span> /&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"content"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">text</span>&gt;</span>{{item.title}}<span class="hljs-tag">&lt;/<span class="hljs-name">text</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">text</span>&gt;</span>{{item.desc}}<span class="hljs-tag">&lt;/<span class="hljs-name">text</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">block</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">scroll-view</span>&gt;</span>
</code></pre>
<hr/>
<h2 data-id="heading-5">第二章：样式の"奇技淫巧"</h2>
<h3 data-id="heading-6">2.1 安全区域の"万能公式"</h3>
<p><strong>问题：</strong> iPhone 刘海屏、底部安全区域适配。</p>
<p><strong>邪修技巧：</strong> CSS 变量 + env() + 兜底值</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* 在 app.wxss 中定义全局变量 */</span>
page {
  <span class="hljs-attr">--safe-area-top</span>: <span class="hljs-built_in">env</span>(safe-area-inset-top, <span class="hljs-number">0px</span>);
  <span class="hljs-attr">--safe-area-bottom</span>: <span class="hljs-built_in">env</span>(safe-area-inset-bottom, <span class="hljs-number">0px</span>);
  <span class="hljs-attr">--safe-area-left</span>: <span class="hljs-built_in">env</span>(safe-area-inset-left, <span class="hljs-number">0px</span>);
  <span class="hljs-attr">--safe-area-right</span>: <span class="hljs-built_in">env</span>(safe-area-inset-right, <span class="hljs-number">0px</span>);

  <span class="hljs-comment">/* 导航栏高度（状态栏 + 导航栏） */</span>
  <span class="hljs-attr">--nav-height</span>: <span class="hljs-built_in">calc</span>(<span class="hljs-built_in">var</span>(--safe-area-top) + <span class="hljs-number">44px</span>);

  <span class="hljs-comment">/* 底部 TabBar 高度 */</span>
  <span class="hljs-attr">--tabbar-height</span>: <span class="hljs-built_in">calc</span>(<span class="hljs-built_in">var</span>(--safe-area-bottom) + <span class="hljs-number">50px</span>);
}

<span class="hljs-comment">/* 自定义导航栏 */</span>
<span class="hljs-selector-class">.custom-navbar</span> {
  <span class="hljs-attribute">position</span>: fixed;
  <span class="hljs-attribute">top</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">left</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">right</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-built_in">var</span>(--nav-height);
  <span class="hljs-attribute">padding-top</span>: <span class="hljs-built_in">var</span>(--safe-area-top);
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#fff</span>;
  <span class="hljs-attribute">z-index</span>: <span class="hljs-number">999</span>;
}

<span class="hljs-comment">/* 页面内容（避开导航栏） */</span>
<span class="hljs-selector-class">.page-content</span> {
  <span class="hljs-attribute">padding-top</span>: <span class="hljs-built_in">var</span>(--nav-height);
  <span class="hljs-attribute">padding-bottom</span>: <span class="hljs-built_in">var</span>(--tabbar-height);
  <span class="hljs-attribute">min-height</span>: <span class="hljs-number">100vh</span>;
  <span class="hljs-attribute">box-sizing</span>: border-box;
}

<span class="hljs-comment">/* 底部固定按钮 */</span>
<span class="hljs-selector-class">.bottom-button</span> {
  <span class="hljs-attribute">position</span>: fixed;
  <span class="hljs-attribute">bottom</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">left</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">right</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">12px</span> <span class="hljs-number">16px</span>;
  <span class="hljs-attribute">padding-bottom</span>: <span class="hljs-built_in">calc</span>(<span class="hljs-number">12px</span> + <span class="hljs-built_in">var</span>(--safe-area-bottom));
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#fff</span>;
}
</code></pre>
<h3 data-id="heading-7">2.2 1px 边框の"像素级"方案</h3>
<p><strong>问题：</strong> 在高清屏上，1px 边框看起来太粗。</p>
<p><strong>邪修技巧：</strong> 伪元素 + transform 缩放</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* 通用 1px 边框 mixin（用 class 实现） */</span>

<span class="hljs-comment">/* 底部 1px 边框 */</span>
<span class="hljs-selector-class">.border-bottom-1px</span> {
  <span class="hljs-attribute">position</span>: relative;
}

<span class="hljs-selector-class">.border-bottom-1px</span><span class="hljs-selector-pseudo">::after</span> {
  <span class="hljs-attribute">content</span>: <span class="hljs-string">""</span>;
  <span class="hljs-attribute">position</span>: absolute;
  <span class="hljs-attribute">left</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">bottom</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">1px</span>;
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#e5e5e5</span>;
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">scaleY</span>(<span class="hljs-number">0.5</span>);
  <span class="hljs-attribute">transform-origin</span>: <span class="hljs-number">0</span> <span class="hljs-number">100%</span>;
}

<span class="hljs-comment">/* 四周 1px 边框 */</span>
<span class="hljs-selector-class">.border-1px</span> {
  <span class="hljs-attribute">position</span>: relative;
}

<span class="hljs-selector-class">.border-1px</span><span class="hljs-selector-pseudo">::after</span> {
  <span class="hljs-attribute">content</span>: <span class="hljs-string">""</span>;
  <span class="hljs-attribute">position</span>: absolute;
  <span class="hljs-attribute">top</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">left</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">width</span>: <span class="hljs-number">200%</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">200%</span>;
  <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#e5e5e5</span>;
  <span class="hljs-attribute">border-radius</span>: inherit;
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">scale</span>(<span class="hljs-number">0.5</span>);
  <span class="hljs-attribute">transform-origin</span>: <span class="hljs-number">0</span> <span class="hljs-number">0</span>;
  <span class="hljs-attribute">pointer-events</span>: none;
  <span class="hljs-attribute">box-sizing</span>: border-box;
}

<span class="hljs-comment">/* 带圆角的 1px 边框 */</span>
<span class="hljs-selector-class">.border-1px-radius</span> {
  <span class="hljs-attribute">position</span>: relative;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">8px</span>;
}

<span class="hljs-selector-class">.border-1px-radius</span><span class="hljs-selector-pseudo">::after</span> {
  <span class="hljs-attribute">content</span>: <span class="hljs-string">""</span>;
  <span class="hljs-attribute">position</span>: absolute;
  <span class="hljs-attribute">top</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">left</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">width</span>: <span class="hljs-number">200%</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">200%</span>;
  <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#e5e5e5</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">16px</span>; <span class="hljs-comment">/* 圆角也要 *2 */</span>
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">scale</span>(<span class="hljs-number">0.5</span>);
  <span class="hljs-attribute">transform-origin</span>: <span class="hljs-number">0</span> <span class="hljs-number">0</span>;
  <span class="hljs-attribute">pointer-events</span>: none;
  <span class="hljs-attribute">box-sizing</span>: border-box;
}
</code></pre>
<h3 data-id="heading-8">2.3 文字截断の"终极方案"</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* 单行截断 */</span>
<span class="hljs-selector-class">.text-ellipsis</span> {
  <span class="hljs-attribute">overflow</span>: hidden;
  <span class="hljs-attribute">text-overflow</span>: ellipsis;
  <span class="hljs-attribute">white-space</span>: nowrap;
}

<span class="hljs-comment">/* 多行截断（兼容性最好的方案） */</span>
<span class="hljs-selector-class">.text-ellipsis-2</span> {
  <span class="hljs-attribute">display</span>: -webkit-box;
  -webkit-box-orient: vertical;
  -webkit-line-clamp: <span class="hljs-number">2</span>;
  <span class="hljs-attribute">overflow</span>: hidden;
  <span class="hljs-attribute">text-overflow</span>: ellipsis;
  <span class="hljs-attribute">word-break</span>: break-all;
}

<span class="hljs-comment">/* 多行截断 + 展开收起（需要 JS 配合） */</span>
<span class="hljs-selector-class">.text-expandable</span> {
  <span class="hljs-attribute">position</span>: relative;
  <span class="hljs-attribute">max-height</span>: <span class="hljs-built_in">calc</span>(<span class="hljs-number">1.5em</span> * <span class="hljs-number">3</span>); <span class="hljs-comment">/* 3 行 */</span>
  <span class="hljs-attribute">overflow</span>: hidden;
  <span class="hljs-attribute">transition</span>: max-height <span class="hljs-number">0.3s</span> ease;
}

<span class="hljs-selector-class">.text-expandable</span><span class="hljs-selector-class">.expanded</span> {
  <span class="hljs-attribute">max-height</span>: none;
}

<span class="hljs-selector-class">.text-expandable</span><span class="hljs-selector-pseudo">::after</span> {
  <span class="hljs-attribute">content</span>: <span class="hljs-string">"...展开"</span>;
  <span class="hljs-attribute">position</span>: absolute;
  <span class="hljs-attribute">right</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">bottom</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">padding-left</span>: <span class="hljs-number">20px</span>;
  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">linear-gradient</span>(to right, transparent, <span class="hljs-number">#fff</span> <span class="hljs-number">50%</span>);
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#1890ff</span>;
}

<span class="hljs-selector-class">.text-expandable</span><span class="hljs-selector-class">.expanded</span><span class="hljs-selector-pseudo">::after</span> {
  <span class="hljs-attribute">content</span>: none;
}
</code></pre>
<hr/>
<h2 data-id="heading-9">第三章：交互の"黑科技"</h2>
<h3 data-id="heading-10">3.1 下拉刷新の"自定义"方案</h3>
<p><strong>问题：</strong> 原生下拉刷新样式太丑，无法自定义。</p>
<p><strong>邪修技巧：</strong> 禁用原生 + 自己实现</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-comment">// page.json</span>
<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"enablePullDownRefresh"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"disableScroll"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span>
<span class="hljs-punctuation">}</span>
</code></pre>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- WXML --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"pull-refresh-container"</span>&gt;</span>
  <span class="hljs-comment">&lt;!-- 下拉提示区域 --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">view</span>
    <span class="hljs-attr">class</span>=<span class="hljs-string">"pull-refresh-header"</span>
    <span class="hljs-attr">style</span>=<span class="hljs-string">"transform: translateY({{pullDistance - 80}}px);"</span>
  &gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">view</span>
      <span class="hljs-attr">class</span>=<span class="hljs-string">"refresh-icon {{refreshing ? 'rotating' : ''}}"</span>
      <span class="hljs-attr">style</span>=<span class="hljs-string">"transform: rotate({{pullDistance * 2}}deg);"</span>
    &gt;</span>
      ↻
    <span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">text</span>&gt;</span>{{refreshText}}<span class="hljs-tag">&lt;/<span class="hljs-name">text</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>

  <span class="hljs-comment">&lt;!-- 内容区域 --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">scroll-view</span>
    <span class="hljs-attr">scroll-y</span>
    <span class="hljs-attr">class</span>=<span class="hljs-string">"content-scroll"</span>
    <span class="hljs-attr">style</span>=<span class="hljs-string">"transform: translateY({{pullDistance}}px);"</span>
    <span class="hljs-attr">bindtouchstart</span>=<span class="hljs-string">"onTouchStart"</span>
    <span class="hljs-attr">bindtouchmove</span>=<span class="hljs-string">"onTouchMove"</span>
    <span class="hljs-attr">bindtouchend</span>=<span class="hljs-string">"onTouchEnd"</span>
    <span class="hljs-attr">bindscroll</span>=<span class="hljs-string">"onScroll"</span>
  &gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">slot</span> /&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">scroll-view</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>
</code></pre>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// JS</span>
<span class="hljs-title class_">Component</span>({
  <span class="hljs-attr">data</span>: {
    <span class="hljs-attr">pullDistance</span>: <span class="hljs-number">0</span>,
    <span class="hljs-attr">refreshing</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">refreshText</span>: <span class="hljs-string">"下拉刷新"</span>,
    <span class="hljs-attr">startY</span>: <span class="hljs-number">0</span>,
    <span class="hljs-attr">scrollTop</span>: <span class="hljs-number">0</span>,
  },

  <span class="hljs-attr">THRESHOLD</span>: <span class="hljs-number">80</span>, <span class="hljs-comment">// 触发刷新的阈值</span>

  <span class="hljs-attr">methods</span>: {
    <span class="hljs-title function_">onTouchStart</span>(<span class="hljs-params">e</span>) {
      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-property">refreshing</span>) <span class="hljs-keyword">return</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setData</span>({ <span class="hljs-attr">startY</span>: e.<span class="hljs-property">touches</span>[<span class="hljs-number">0</span>].<span class="hljs-property">clientY</span> })
    },

    <span class="hljs-title function_">onTouchMove</span>(<span class="hljs-params">e</span>) {
      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-property">refreshing</span>) <span class="hljs-keyword">return</span>
      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-property">scrollTop</span> &gt; <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-comment">// 不在顶部时不触发</span>

      <span class="hljs-keyword">const</span> currentY = e.<span class="hljs-property">touches</span>[<span class="hljs-number">0</span>].<span class="hljs-property">clientY</span>
      <span class="hljs-keyword">const</span> distance = currentY - <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-property">startY</span>

      <span class="hljs-keyword">if</span> (distance &gt; <span class="hljs-number">0</span>) {
        <span class="hljs-comment">// 阻尼效果：拉得越远，阻力越大</span>
        <span class="hljs-keyword">const</span> pullDistance = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(distance * <span class="hljs-number">0.5</span>, <span class="hljs-number">120</span>)
        <span class="hljs-keyword">const</span> refreshText =
          pullDistance &gt;= <span class="hljs-variable language_">this</span>.<span class="hljs-property">THRESHOLD</span> ? <span class="hljs-string">"释放刷新"</span> : <span class="hljs-string">"下拉刷新"</span>

        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setData</span>({ pullDistance, refreshText })
      }
    },

    <span class="hljs-title function_">onTouchEnd</span>(<span class="hljs-params"/>) {
      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-property">refreshing</span>) <span class="hljs-keyword">return</span>

      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-property">pullDistance</span> &gt;= <span class="hljs-variable language_">this</span>.<span class="hljs-property">THRESHOLD</span>) {
        <span class="hljs-comment">// 触发刷新</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setData</span>({
          <span class="hljs-attr">pullDistance</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">THRESHOLD</span>,
          <span class="hljs-attr">refreshing</span>: <span class="hljs-literal">true</span>,
          <span class="hljs-attr">refreshText</span>: <span class="hljs-string">"刷新中..."</span>,
        })

        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">triggerEvent</span>(<span class="hljs-string">"refresh"</span>)
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// 回弹</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setData</span>({ <span class="hljs-attr">pullDistance</span>: <span class="hljs-number">0</span> })
      }
    },

    <span class="hljs-title function_">onScroll</span>(<span class="hljs-params">e</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setData</span>({ <span class="hljs-attr">scrollTop</span>: e.<span class="hljs-property">detail</span>.<span class="hljs-property">scrollTop</span> })
    },

    <span class="hljs-comment">// 外部调用：刷新完成</span>
    <span class="hljs-title function_">stopRefresh</span>(<span class="hljs-params"/>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setData</span>({
        <span class="hljs-attr">pullDistance</span>: <span class="hljs-number">0</span>,
        <span class="hljs-attr">refreshing</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-attr">refreshText</span>: <span class="hljs-string">"下拉刷新"</span>,
      })
    },
  },
})
</code></pre>
<h3 data-id="heading-11">3.2 手势密码の"纯 Canvas"实现</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 手势密码组件</span>
<span class="hljs-title class_">Component</span>({
  <span class="hljs-attr">data</span>: {
    <span class="hljs-attr">points</span>: [], <span class="hljs-comment">// 9 个点的坐标</span>
    <span class="hljs-attr">selectedPoints</span>: [], <span class="hljs-comment">// 已选中的点</span>
    <span class="hljs-attr">touchPoint</span>: <span class="hljs-literal">null</span>, <span class="hljs-comment">// 当前触摸点</span>
  },

  <span class="hljs-attr">lifetimes</span>: {
    <span class="hljs-title function_">attached</span>(<span class="hljs-params"/>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">initCanvas</span>()
    },
  },

  <span class="hljs-attr">methods</span>: {
    <span class="hljs-title function_">initCanvas</span>(<span class="hljs-params"/>) {
      <span class="hljs-keyword">const</span> query = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">createSelectorQuery</span>()
      query
        .<span class="hljs-title function_">select</span>(<span class="hljs-string">"#gesture-canvas"</span>)
        .<span class="hljs-title function_">fields</span>({ <span class="hljs-attr">node</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">size</span>: <span class="hljs-literal">true</span> })
        .<span class="hljs-title function_">exec</span>(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> {
          <span class="hljs-keyword">const</span> canvas = res[<span class="hljs-number">0</span>].<span class="hljs-property">node</span>
          <span class="hljs-keyword">const</span> ctx = canvas.<span class="hljs-title function_">getContext</span>(<span class="hljs-string">"2d"</span>)

          <span class="hljs-comment">// 设置 canvas 尺寸</span>
          <span class="hljs-keyword">const</span> dpr = wx.<span class="hljs-title function_">getSystemInfoSync</span>().<span class="hljs-property">pixelRatio</span>
          canvas.<span class="hljs-property">width</span> = res[<span class="hljs-number">0</span>].<span class="hljs-property">width</span> * dpr
          canvas.<span class="hljs-property">height</span> = res[<span class="hljs-number">0</span>].<span class="hljs-property">height</span> * dpr
          ctx.<span class="hljs-title function_">scale</span>(dpr, dpr)

          <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvas</span> = canvas
          <span class="hljs-variable language_">this</span>.<span class="hljs-property">ctx</span> = ctx
          <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasWidth</span> = res[<span class="hljs-number">0</span>].<span class="hljs-property">width</span>
          <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasHeight</span> = res[<span class="hljs-number">0</span>].<span class="hljs-property">height</span>

          <span class="hljs-comment">// 初始化 9 个点</span>
          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">initPoints</span>()
          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">draw</span>()
        })
    },

    <span class="hljs-title function_">initPoints</span>(<span class="hljs-params"/>) {
      <span class="hljs-keyword">const</span> padding = <span class="hljs-number">50</span>
      <span class="hljs-keyword">const</span> width = <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasWidth</span> - padding * <span class="hljs-number">2</span>
      <span class="hljs-keyword">const</span> gap = width / <span class="hljs-number">2</span>
      <span class="hljs-keyword">const</span> points = []

      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> row = <span class="hljs-number">0</span>; row &lt; <span class="hljs-number">3</span>; row++) {
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> col = <span class="hljs-number">0</span>; col &lt; <span class="hljs-number">3</span>; col++) {
          points.<span class="hljs-title function_">push</span>({
            <span class="hljs-attr">x</span>: padding + col * gap,
            <span class="hljs-attr">y</span>: padding + row * gap,
            <span class="hljs-attr">index</span>: row * <span class="hljs-number">3</span> + col,
          })
        }
      }

      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setData</span>({ points })
    },

    <span class="hljs-title function_">draw</span>(<span class="hljs-params"/>) {
      <span class="hljs-keyword">const</span> { ctx, canvasWidth, canvasHeight } = <span class="hljs-variable language_">this</span>
      <span class="hljs-keyword">const</span> { points, selectedPoints, touchPoint } = <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>

      <span class="hljs-comment">// 清空画布</span>
      ctx.<span class="hljs-title function_">clearRect</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, canvasWidth, canvasHeight)

      <span class="hljs-comment">// 画连线</span>
      <span class="hljs-keyword">if</span> (selectedPoints.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {
        ctx.<span class="hljs-title function_">beginPath</span>()
        ctx.<span class="hljs-property">strokeStyle</span> = <span class="hljs-string">"#1890ff"</span>
        ctx.<span class="hljs-property">lineWidth</span> = <span class="hljs-number">3</span>
        ctx.<span class="hljs-property">lineCap</span> = <span class="hljs-string">"round"</span>
        ctx.<span class="hljs-property">lineJoin</span> = <span class="hljs-string">"round"</span>

        selectedPoints.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">pointIndex, i</span>) =&gt;</span> {
          <span class="hljs-keyword">const</span> point = points[pointIndex]
          <span class="hljs-keyword">if</span> (i === <span class="hljs-number">0</span>) {
            ctx.<span class="hljs-title function_">moveTo</span>(point.<span class="hljs-property">x</span>, point.<span class="hljs-property">y</span>)
          } <span class="hljs-keyword">else</span> {
            ctx.<span class="hljs-title function_">lineTo</span>(point.<span class="hljs-property">x</span>, point.<span class="hljs-property">y</span>)
          }
        })

        <span class="hljs-comment">// 连接到当前触摸点</span>
        <span class="hljs-keyword">if</span> (touchPoint) {
          ctx.<span class="hljs-title function_">lineTo</span>(touchPoint.<span class="hljs-property">x</span>, touchPoint.<span class="hljs-property">y</span>)
        }

        ctx.<span class="hljs-title function_">stroke</span>()
      }

      <span class="hljs-comment">// 画点</span>
      points.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">point, index</span>) =&gt;</span> {
        <span class="hljs-keyword">const</span> isSelected = selectedPoints.<span class="hljs-title function_">includes</span>(index)

        <span class="hljs-comment">// 外圈</span>
        ctx.<span class="hljs-title function_">beginPath</span>()
        ctx.<span class="hljs-title function_">arc</span>(point.<span class="hljs-property">x</span>, point.<span class="hljs-property">y</span>, <span class="hljs-number">25</span>, <span class="hljs-number">0</span>, <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> * <span class="hljs-number">2</span>)
        ctx.<span class="hljs-property">strokeStyle</span> = isSelected ? <span class="hljs-string">"#1890ff"</span> : <span class="hljs-string">"#ddd"</span>
        ctx.<span class="hljs-property">lineWidth</span> = <span class="hljs-number">2</span>
        ctx.<span class="hljs-title function_">stroke</span>()

        <span class="hljs-comment">// 内圈</span>
        ctx.<span class="hljs-title function_">beginPath</span>()
        ctx.<span class="hljs-title function_">arc</span>(point.<span class="hljs-property">x</span>, point.<span class="hljs-property">y</span>, isSelected ? <span class="hljs-number">10</span> : <span class="hljs-number">5</span>, <span class="hljs-number">0</span>, <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> * <span class="hljs-number">2</span>)
        ctx.<span class="hljs-property">fillStyle</span> = isSelected ? <span class="hljs-string">"#1890ff"</span> : <span class="hljs-string">"#ddd"</span>
        ctx.<span class="hljs-title function_">fill</span>()
      })
    },

    <span class="hljs-title function_">onTouchStart</span>(<span class="hljs-params">e</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setData</span>({ <span class="hljs-attr">selectedPoints</span>: [], <span class="hljs-attr">touchPoint</span>: <span class="hljs-literal">null</span> })
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">handleTouch</span>(e)
    },

    <span class="hljs-title function_">onTouchMove</span>(<span class="hljs-params">e</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">handleTouch</span>(e)
    },

    <span class="hljs-title function_">onTouchEnd</span>(<span class="hljs-params"/>) {
      <span class="hljs-keyword">const</span> { selectedPoints } = <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>

      <span class="hljs-keyword">if</span> (selectedPoints.<span class="hljs-property">length</span> &gt;= <span class="hljs-number">4</span>) {
        <span class="hljs-comment">// 触发事件，返回密码</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">triggerEvent</span>(<span class="hljs-string">"complete"</span>, {
          <span class="hljs-attr">password</span>: selectedPoints.<span class="hljs-title function_">join</span>(<span class="hljs-string">""</span>),
        })
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (selectedPoints.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {
        <span class="hljs-comment">// 密码太短</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">triggerEvent</span>(<span class="hljs-string">"error"</span>, {
          <span class="hljs-attr">message</span>: <span class="hljs-string">"至少连接 4 个点"</span>,
        })
      }

      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setData</span>({ <span class="hljs-attr">touchPoint</span>: <span class="hljs-literal">null</span> })
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">draw</span>()
    },

    <span class="hljs-title function_">handleTouch</span>(<span class="hljs-params">e</span>) {
      <span class="hljs-keyword">const</span> touch = e.<span class="hljs-property">touches</span>[<span class="hljs-number">0</span>]
      <span class="hljs-keyword">const</span> { points, selectedPoints } = <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>

      <span class="hljs-comment">// 获取相对于 canvas 的坐标</span>
      <span class="hljs-keyword">const</span> query = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">createSelectorQuery</span>()
      query
        .<span class="hljs-title function_">select</span>(<span class="hljs-string">"#gesture-canvas"</span>)
        .<span class="hljs-title function_">boundingClientRect</span>(<span class="hljs-function">(<span class="hljs-params">rect</span>) =&gt;</span> {
          <span class="hljs-keyword">const</span> x = touch.<span class="hljs-property">clientX</span> - rect.<span class="hljs-property">left</span>
          <span class="hljs-keyword">const</span> y = touch.<span class="hljs-property">clientY</span> - rect.<span class="hljs-property">top</span>

          <span class="hljs-comment">// 检查是否触碰到某个点</span>
          points.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">point, index</span>) =&gt;</span> {
            <span class="hljs-keyword">const</span> distance = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sqrt</span>(
              <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">pow</span>(x - point.<span class="hljs-property">x</span>, <span class="hljs-number">2</span>) + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">pow</span>(y - point.<span class="hljs-property">y</span>, <span class="hljs-number">2</span>)
            )

            <span class="hljs-keyword">if</span> (distance &lt; <span class="hljs-number">30</span> &amp;&amp; !selectedPoints.<span class="hljs-title function_">includes</span>(index)) {
              selectedPoints.<span class="hljs-title function_">push</span>(index)
              <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setData</span>({ selectedPoints })
            }
          })

          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setData</span>({ <span class="hljs-attr">touchPoint</span>: { x, y } })
          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">draw</span>()
        })
        .<span class="hljs-title function_">exec</span>()
    },
  },
})
</code></pre>
<hr/>
<h2 data-id="heading-12">第四章：数据の"骚操作"</h2>
<h3 data-id="heading-13">4.1 本地存储の"加密"方案</h3>
<p><strong>问题：</strong> wx.setStorageSync 存储的数据是明文，容易被篡改。</p>
<p><strong>邪修技巧：</strong> 简单加密 + 签名校验</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// utils/secureStorage.js</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">SECRET_KEY</span> = <span class="hljs-string">"your-secret-key-here"</span> <span class="hljs-comment">// 实际项目中应该更复杂</span>

<span class="hljs-comment">// 简单的加密函数（生产环境建议用更强的加密）</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">encrypt</span>(<span class="hljs-params">data</span>) {
  <span class="hljs-keyword">const</span> str = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(data)
  <span class="hljs-comment">// Base64 编码 + 简单混淆</span>
  <span class="hljs-keyword">const</span> base64 = wx.<span class="hljs-title function_">arrayBufferToBase64</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">TextEncoder</span>().<span class="hljs-title function_">encode</span>(str))
  <span class="hljs-comment">// 添加签名</span>
  <span class="hljs-keyword">const</span> signature = <span class="hljs-title function_">generateSignature</span>(base64)
  <span class="hljs-keyword">return</span> <span class="hljs-string">`<span class="hljs-subst">${base64}</span>.<span class="hljs-subst">${signature}</span>`</span>
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">decrypt</span>(<span class="hljs-params">encryptedData</span>) {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> [base64, signature] = encryptedData.<span class="hljs-title function_">split</span>(<span class="hljs-string">"."</span>)

    <span class="hljs-comment">// 验证签名</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">generateSignature</span>(base64) !== signature) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">"数据签名验证失败，可能被篡改"</span>)
      <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>
    }

    <span class="hljs-comment">// 解码</span>
    <span class="hljs-keyword">const</span> buffer = wx.<span class="hljs-title function_">base64ToArrayBuffer</span>(base64)
    <span class="hljs-keyword">const</span> str = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TextDecoder</span>().<span class="hljs-title function_">decode</span>(buffer)
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(str)
  } <span class="hljs-keyword">catch</span> (e) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"解密失败"</span>, e)
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>
  }
}

<span class="hljs-comment">// 生成签名（简单实现，生产环境用 HMAC）</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">generateSignature</span>(<span class="hljs-params">data</span>) {
  <span class="hljs-keyword">let</span> hash = <span class="hljs-number">0</span>
  <span class="hljs-keyword">const</span> str = data + <span class="hljs-variable constant_">SECRET_KEY</span>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; str.<span class="hljs-property">length</span>; i++) {
    <span class="hljs-keyword">const</span> char = str.<span class="hljs-title function_">charCodeAt</span>(i)
    hash = (hash &lt;&lt; <span class="hljs-number">5</span>) - hash + char
    hash = hash &amp; hash
  }
  <span class="hljs-keyword">return</span> <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">abs</span>(hash).<span class="hljs-title function_">toString</span>(<span class="hljs-number">16</span>)
}

<span class="hljs-comment">// 封装的安全存储 API</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> secureStorage = {
  <span class="hljs-title function_">set</span>(<span class="hljs-params">key, value, options = {}</span>) {
    <span class="hljs-keyword">const</span> { <span class="hljs-attr">encrypt</span>: shouldEncrypt = <span class="hljs-literal">true</span>, expire = <span class="hljs-number">0</span> } = options

    <span class="hljs-keyword">const</span> data = {
      value,
      <span class="hljs-attr">timestamp</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>(),
      <span class="hljs-attr">expire</span>: expire &gt; <span class="hljs-number">0</span> ? <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() + expire : <span class="hljs-number">0</span>,
    }

    <span class="hljs-keyword">const</span> storageValue = shouldEncrypt ? <span class="hljs-title function_">encrypt</span>(data) : <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(data)
    wx.<span class="hljs-title function_">setStorageSync</span>(key, storageValue)
  },

  <span class="hljs-title function_">get</span>(<span class="hljs-params">key, options = {}</span>) {
    <span class="hljs-keyword">const</span> { <span class="hljs-attr">decrypt</span>: shouldDecrypt = <span class="hljs-literal">true</span>, defaultValue = <span class="hljs-literal">null</span> } = options

    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> storageValue = wx.<span class="hljs-title function_">getStorageSync</span>(key)
      <span class="hljs-keyword">if</span> (!storageValue) <span class="hljs-keyword">return</span> defaultValue

      <span class="hljs-keyword">const</span> data = shouldDecrypt
        ? <span class="hljs-title function_">decrypt</span>(storageValue)
        : <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(storageValue)

      <span class="hljs-keyword">if</span> (!data) <span class="hljs-keyword">return</span> defaultValue

      <span class="hljs-comment">// 检查是否过期</span>
      <span class="hljs-keyword">if</span> (data.<span class="hljs-property">expire</span> &gt; <span class="hljs-number">0</span> &amp;&amp; <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() &gt; data.<span class="hljs-property">expire</span>) {
        wx.<span class="hljs-title function_">removeStorageSync</span>(key)
        <span class="hljs-keyword">return</span> defaultValue
      }

      <span class="hljs-keyword">return</span> data.<span class="hljs-property">value</span>
    } <span class="hljs-keyword">catch</span> (e) {
      <span class="hljs-keyword">return</span> defaultValue
    }
  },

  <span class="hljs-title function_">remove</span>(<span class="hljs-params">key</span>) {
    wx.<span class="hljs-title function_">removeStorageSync</span>(key)
  },
}

<span class="hljs-comment">// 使用示例</span>
secureStorage.<span class="hljs-title function_">set</span>(<span class="hljs-string">"userToken"</span>, <span class="hljs-string">"abc123"</span>, { <span class="hljs-attr">expire</span>: <span class="hljs-number">7</span> * <span class="hljs-number">24</span> * <span class="hljs-number">60</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000</span> }) <span class="hljs-comment">// 7天过期</span>
<span class="hljs-keyword">const</span> token = secureStorage.<span class="hljs-title function_">get</span>(<span class="hljs-string">"userToken"</span>)
</code></pre>
<h3 data-id="heading-14">4.2 请求の"智能重试"</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// utils/request.js</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">MAX_RETRY</span> = <span class="hljs-number">3</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">RETRY_DELAY</span> = <span class="hljs-number">1000</span>

<span class="hljs-comment">// 判断是否应该重试</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">shouldRetry</span>(<span class="hljs-params">error, retryCount</span>) {
  <span class="hljs-keyword">if</span> (retryCount &gt;= <span class="hljs-variable constant_">MAX_RETRY</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>

  <span class="hljs-comment">// 网络错误重试</span>
  <span class="hljs-keyword">if</span> (error.<span class="hljs-property">errMsg</span>?.<span class="hljs-title function_">includes</span>(<span class="hljs-string">"request:fail"</span>)) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>

  <span class="hljs-comment">// 超时重试</span>
  <span class="hljs-keyword">if</span> (error.<span class="hljs-property">errMsg</span>?.<span class="hljs-title function_">includes</span>(<span class="hljs-string">"timeout"</span>)) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>

  <span class="hljs-comment">// 5xx 错误重试</span>
  <span class="hljs-keyword">if</span> (error.<span class="hljs-property">statusCode</span> &gt;= <span class="hljs-number">500</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>

  <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>
}

<span class="hljs-comment">// 延迟函数</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">delay</span> = (<span class="hljs-params">ms</span>) =&gt; <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> <span class="hljs-built_in">setTimeout</span>(resolve, ms))

<span class="hljs-comment">// 带重试的请求</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">requestWithRetry</span>(<span class="hljs-params">options, retryCount = <span class="hljs-number">0</span></span>) {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
      wx.<span class="hljs-title function_">request</span>({
        ...options,
        <span class="hljs-attr">success</span>: <span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> {
          <span class="hljs-keyword">if</span> (res.<span class="hljs-property">statusCode</span> &gt;= <span class="hljs-number">200</span> &amp;&amp; res.<span class="hljs-property">statusCode</span> &lt; <span class="hljs-number">300</span>) {
            <span class="hljs-title function_">resolve</span>(res)
          } <span class="hljs-keyword">else</span> {
            <span class="hljs-title function_">reject</span>({ ...res, <span class="hljs-attr">errMsg</span>: <span class="hljs-string">`HTTP <span class="hljs-subst">${res.statusCode}</span>`</span> })
          }
        },
        <span class="hljs-attr">fail</span>: reject,
      })
    })

    <span class="hljs-keyword">return</span> response
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">shouldRetry</span>(error, retryCount)) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(
        <span class="hljs-string">`请求失败，<span class="hljs-subst">${RETRY_DELAY}</span>ms 后重试 (<span class="hljs-subst">${retryCount + <span class="hljs-number">1</span>}</span>/<span class="hljs-subst">${MAX_RETRY}</span>)`</span>
      )

      <span class="hljs-comment">// 指数退避</span>
      <span class="hljs-keyword">await</span> <span class="hljs-title function_">delay</span>(<span class="hljs-variable constant_">RETRY_DELAY</span> * <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">pow</span>(<span class="hljs-number">2</span>, retryCount))

      <span class="hljs-keyword">return</span> <span class="hljs-title function_">requestWithRetry</span>(options, retryCount + <span class="hljs-number">1</span>)
    }

    <span class="hljs-keyword">throw</span> error
  }
}

<span class="hljs-comment">// 请求队列（防止并发过多）</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">RequestQueue</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">maxConcurrent = <span class="hljs-number">5</span></span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">maxConcurrent</span> = maxConcurrent
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentCount</span> = <span class="hljs-number">0</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">queue</span> = []
  }

  <span class="hljs-keyword">async</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">requestFn</span>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">currentCount</span> &gt;= <span class="hljs-variable language_">this</span>.<span class="hljs-property">maxConcurrent</span>) {
      <span class="hljs-comment">// 等待队列</span>
      <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">queue</span>.<span class="hljs-title function_">push</span>(resolve))
    }

    <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentCount</span>++

    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> <span class="hljs-title function_">requestFn</span>()
    } <span class="hljs-keyword">finally</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentCount</span>--

      <span class="hljs-comment">// 释放队列中的下一个</span>
      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">queue</span>.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">const</span> next = <span class="hljs-variable language_">this</span>.<span class="hljs-property">queue</span>.<span class="hljs-title function_">shift</span>()
        <span class="hljs-title function_">next</span>()
      }
    }
  }
}

<span class="hljs-keyword">const</span> requestQueue = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RequestQueue</span>(<span class="hljs-number">5</span>)

<span class="hljs-comment">// 最终封装的请求函数</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">request</span>(<span class="hljs-params">options</span>) {
  <span class="hljs-keyword">return</span> requestQueue.<span class="hljs-title function_">add</span>(<span class="hljs-function">() =&gt;</span>
    <span class="hljs-title function_">requestWithRetry</span>({
      <span class="hljs-attr">timeout</span>: <span class="hljs-number">10000</span>,
      ...options,
      <span class="hljs-attr">header</span>: {
        <span class="hljs-string">"Content-Type"</span>: <span class="hljs-string">"application/json"</span>,
        ...options.<span class="hljs-property">header</span>,
      },
    })
  )
}
</code></pre>
<h3 data-id="heading-15">4.3 全局状态の"响应式"方案</h3>
<p><strong>问题：</strong> 小程序没有 Vuex/Redux，跨页面状态管理很麻烦。</p>
<p><strong>邪修技巧：</strong> 简易响应式 Store</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// store/index.js</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Store</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">initialState = {}</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span> = initialState
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>()
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">computedCache</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>()
  }

  <span class="hljs-comment">// 获取状态</span>
  <span class="hljs-title function_">getState</span>(<span class="hljs-params">path</span>) {
    <span class="hljs-keyword">if</span> (!path) <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>
    <span class="hljs-keyword">return</span> path.<span class="hljs-title function_">split</span>(<span class="hljs-string">"."</span>).<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">obj, key</span>) =&gt;</span> obj?.[key], <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>)
  }

  <span class="hljs-comment">// 设置状态</span>
  <span class="hljs-title function_">setState</span>(<span class="hljs-params">path, value</span>) {
    <span class="hljs-keyword">const</span> keys = path.<span class="hljs-title function_">split</span>(<span class="hljs-string">"."</span>)
    <span class="hljs-keyword">const</span> lastKey = keys.<span class="hljs-title function_">pop</span>()
    <span class="hljs-keyword">const</span> target = keys.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">obj, key</span>) =&gt;</span> {
      <span class="hljs-keyword">if</span> (!obj[key]) obj[key] = {}
      <span class="hljs-keyword">return</span> obj[key]
    }, <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>)

    <span class="hljs-keyword">const</span> oldValue = target[lastKey]
    target[lastKey] = value

    <span class="hljs-comment">// 通知监听者</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">notify</span>(path, value, oldValue)
  }

  <span class="hljs-comment">// 批量更新</span>
  <span class="hljs-title function_">batchUpdate</span>(<span class="hljs-params">updates</span>) {
    <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">entries</span>(updates).<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">[path, value]</span>) =&gt;</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setState</span>(path, value)
    })
  }

  <span class="hljs-comment">// 订阅变化</span>
  <span class="hljs-title function_">subscribe</span>(<span class="hljs-params">path, callback, immediate = <span class="hljs-literal">false</span></span>) {
    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">has</span>(path)) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">set</span>(path, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>())
    }
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">get</span>(path).<span class="hljs-title function_">add</span>(callback)

    <span class="hljs-comment">// 立即执行一次</span>
    <span class="hljs-keyword">if</span> (immediate) {
      <span class="hljs-title function_">callback</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getState</span>(path), <span class="hljs-literal">undefined</span>)
    }

    <span class="hljs-comment">// 返回取消订阅函数</span>
    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">get</span>(path)?.<span class="hljs-title function_">delete</span>(callback)
    }
  }

  <span class="hljs-comment">// 通知监听者</span>
  <span class="hljs-title function_">notify</span>(<span class="hljs-params">path, newValue, oldValue</span>) {
    <span class="hljs-comment">// 精确匹配</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">get</span>(path)?.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">cb</span>) =&gt;</span> <span class="hljs-title function_">cb</span>(newValue, oldValue))

    <span class="hljs-comment">// 父路径也要通知（如 'user' 变化时，'user.name' 的监听者也要通知）</span>
    <span class="hljs-keyword">const</span> parts = path.<span class="hljs-title function_">split</span>(<span class="hljs-string">"."</span>)
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = parts.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>; i &gt; <span class="hljs-number">0</span>; i--) {
      <span class="hljs-keyword">const</span> parentPath = parts.<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>, i).<span class="hljs-title function_">join</span>(<span class="hljs-string">"."</span>)
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">get</span>(parentPath)?.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">cb</span>) =&gt;</span> {
        <span class="hljs-title function_">cb</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getState</span>(parentPath), <span class="hljs-literal">undefined</span>)
      })
    }

    <span class="hljs-comment">// 清除相关的计算缓存</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">computedCache</span>.<span class="hljs-title function_">clear</span>()
  }

  <span class="hljs-comment">// 计算属性</span>
  <span class="hljs-title function_">computed</span>(<span class="hljs-params">name, getter</span>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">computedCache</span>.<span class="hljs-title function_">has</span>(name)) {
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">computedCache</span>.<span class="hljs-title function_">get</span>(name)
    }

    <span class="hljs-keyword">const</span> value = <span class="hljs-title function_">getter</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>)
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">computedCache</span>.<span class="hljs-title function_">set</span>(name, value)
    <span class="hljs-keyword">return</span> value
  }
}

<span class="hljs-comment">// 创建全局 store</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> store = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Store</span>({
  <span class="hljs-attr">user</span>: <span class="hljs-literal">null</span>,
  <span class="hljs-attr">cart</span>: [],
  <span class="hljs-attr">settings</span>: {
    <span class="hljs-attr">theme</span>: <span class="hljs-string">"light"</span>,
    <span class="hljs-attr">language</span>: <span class="hljs-string">"zh-CN"</span>,
  },
})

<span class="hljs-comment">// 页面 Mixin：自动绑定 store 到页面 data</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">connectStore</span>(<span class="hljs-params">mapState = {}</span>) {
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">data</span>: {},

    <span class="hljs-title function_">onLoad</span>(<span class="hljs-params"/>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">_storeUnsubscribes</span> = []

      <span class="hljs-comment">// 订阅 store 变化</span>
      <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">entries</span>(mapState).<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">[dataKey, storePath]</span>) =&gt;</span> {
        <span class="hljs-comment">// 初始化数据</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setData</span>({ [dataKey]: store.<span class="hljs-title function_">getState</span>(storePath) })

        <span class="hljs-comment">// 订阅变化</span>
        <span class="hljs-keyword">const</span> unsubscribe = store.<span class="hljs-title function_">subscribe</span>(storePath, <span class="hljs-function">(<span class="hljs-params">value</span>) =&gt;</span> {
          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setData</span>({ [dataKey]: value })
        })

        <span class="hljs-variable language_">this</span>.<span class="hljs-property">_storeUnsubscribes</span>.<span class="hljs-title function_">push</span>(unsubscribe)
      })
    },

    <span class="hljs-title function_">onUnload</span>(<span class="hljs-params"/>) {
      <span class="hljs-comment">// 取消订阅</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">_storeUnsubscribes</span>?.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">unsub</span>) =&gt;</span> <span class="hljs-title function_">unsub</span>())
    },
  }
}

<span class="hljs-comment">// 使用示例</span>
<span class="hljs-comment">// pages/cart/cart.js</span>
<span class="hljs-keyword">import</span> { store, connectStore } <span class="hljs-keyword">from</span> <span class="hljs-string">"../../store/index"</span>

<span class="hljs-title class_">Page</span>({
  ...<span class="hljs-title function_">connectStore</span>({
    <span class="hljs-attr">cartItems</span>: <span class="hljs-string">"cart"</span>,
    <span class="hljs-attr">user</span>: <span class="hljs-string">"user"</span>,
  }),

  <span class="hljs-title function_">addToCart</span>(<span class="hljs-params">item</span>) {
    <span class="hljs-keyword">const</span> cart = store.<span class="hljs-title function_">getState</span>(<span class="hljs-string">"cart"</span>)
    store.<span class="hljs-title function_">setState</span>(<span class="hljs-string">"cart"</span>, [...cart, item])
  },

  <span class="hljs-title function_">clearCart</span>(<span class="hljs-params"/>) {
    store.<span class="hljs-title function_">setState</span>(<span class="hljs-string">"cart"</span>, [])
  },
})
</code></pre>
<hr/>
<h2 data-id="heading-16">第五章：调试の"神器"</h2>
<h3 data-id="heading-17">5.1 自制调试面板</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// components/debug-panel/debug-panel.js</span>
<span class="hljs-title class_">Component</span>({
  <span class="hljs-attr">data</span>: {
    <span class="hljs-attr">visible</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">logs</span>: [],
    <span class="hljs-attr">systemInfo</span>: {},
    <span class="hljs-attr">networkType</span>: <span class="hljs-string">""</span>,
    <span class="hljs-attr">performance</span>: {},
  },

  <span class="hljs-attr">lifetimes</span>: {
    <span class="hljs-title function_">attached</span>(<span class="hljs-params"/>) {
      <span class="hljs-comment">// 劫持 console</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">hijackConsole</span>()

      <span class="hljs-comment">// 获取系统信息</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getSystemInfo</span>()

      <span class="hljs-comment">// 监听网络变化</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">watchNetwork</span>()

      <span class="hljs-comment">// 性能监控</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">watchPerformance</span>()
    },
  },

  <span class="hljs-attr">methods</span>: {
    <span class="hljs-title function_">toggle</span>(<span class="hljs-params"/>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setData</span>({ <span class="hljs-attr">visible</span>: !<span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-property">visible</span> })
    },

    <span class="hljs-title function_">hijackConsole</span>(<span class="hljs-params"/>) {
      <span class="hljs-keyword">const</span> originalLog = <span class="hljs-variable language_">console</span>.<span class="hljs-property">log</span>
      <span class="hljs-keyword">const</span> originalError = <span class="hljs-variable language_">console</span>.<span class="hljs-property">error</span>
      <span class="hljs-keyword">const</span> originalWarn = <span class="hljs-variable language_">console</span>.<span class="hljs-property">warn</span>

      <span class="hljs-keyword">const</span> <span class="hljs-title function_">addLog</span> = (<span class="hljs-params">type, args</span>) =&gt; {
        <span class="hljs-keyword">const</span> log = {
          type,
          <span class="hljs-attr">content</span>: args
            .<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">arg</span>) =&gt;</span>
              <span class="hljs-keyword">typeof</span> arg === <span class="hljs-string">"object"</span>
                ? <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(arg, <span class="hljs-literal">null</span>, <span class="hljs-number">2</span>)
                : <span class="hljs-title class_">String</span>(arg)
            )
            .<span class="hljs-title function_">join</span>(<span class="hljs-string">" "</span>),
          <span class="hljs-attr">time</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">toLocaleTimeString</span>(),
        }

        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setData</span>({
          <span class="hljs-attr">logs</span>: [...<span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-property">logs</span>.<span class="hljs-title function_">slice</span>(-<span class="hljs-number">99</span>), log], <span class="hljs-comment">// 最多保留 100 条</span>
        })
      }

      <span class="hljs-variable language_">console</span>.<span class="hljs-property">log</span> = <span class="hljs-function">(<span class="hljs-params">...args</span>) =&gt;</span> {
        <span class="hljs-title function_">addLog</span>(<span class="hljs-string">"log"</span>, args)
        originalLog.<span class="hljs-title function_">apply</span>(<span class="hljs-variable language_">console</span>, args)
      }

      <span class="hljs-variable language_">console</span>.<span class="hljs-property">error</span> = <span class="hljs-function">(<span class="hljs-params">...args</span>) =&gt;</span> {
        <span class="hljs-title function_">addLog</span>(<span class="hljs-string">"error"</span>, args)
        originalError.<span class="hljs-title function_">apply</span>(<span class="hljs-variable language_">console</span>, args)
      }

      <span class="hljs-variable language_">console</span>.<span class="hljs-property">warn</span> = <span class="hljs-function">(<span class="hljs-params">...args</span>) =&gt;</span> {
        <span class="hljs-title function_">addLog</span>(<span class="hljs-string">"warn"</span>, args)
        originalWarn.<span class="hljs-title function_">apply</span>(<span class="hljs-variable language_">console</span>, args)
      }
    },

    <span class="hljs-title function_">getSystemInfo</span>(<span class="hljs-params"/>) {
      <span class="hljs-keyword">const</span> systemInfo = wx.<span class="hljs-title function_">getSystemInfoSync</span>()
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setData</span>({ systemInfo })
    },

    <span class="hljs-title function_">watchNetwork</span>(<span class="hljs-params"/>) {
      wx.<span class="hljs-title function_">getNetworkType</span>({
        <span class="hljs-attr">success</span>: <span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> {
          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setData</span>({ <span class="hljs-attr">networkType</span>: res.<span class="hljs-property">networkType</span> })
        },
      })

      wx.<span class="hljs-title function_">onNetworkStatusChange</span>(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> {
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setData</span>({ <span class="hljs-attr">networkType</span>: res.<span class="hljs-property">networkType</span> })
      })
    },

    <span class="hljs-title function_">watchPerformance</span>(<span class="hljs-params"/>) {
      <span class="hljs-comment">// 获取性能数据</span>
      <span class="hljs-keyword">const</span> performance = wx.<span class="hljs-title function_">getPerformance</span>()
      <span class="hljs-keyword">const</span> observer = performance.<span class="hljs-title function_">createObserver</span>(<span class="hljs-function">(<span class="hljs-params">entryList</span>) =&gt;</span> {
        <span class="hljs-keyword">const</span> entries = entryList.<span class="hljs-title function_">getEntries</span>()
        entries.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">entry</span>) =&gt;</span> {
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`[Performance] <span class="hljs-subst">${entry.name}</span>: <span class="hljs-subst">${entry.duration}</span>ms`</span>)
        })
      })

      observer.<span class="hljs-title function_">observe</span>({ <span class="hljs-attr">entryTypes</span>: [<span class="hljs-string">"render"</span>, <span class="hljs-string">"script"</span>, <span class="hljs-string">"navigation"</span>] })
    },

    <span class="hljs-title function_">clearLogs</span>(<span class="hljs-params"/>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setData</span>({ <span class="hljs-attr">logs</span>: [] })
    },

    <span class="hljs-title function_">copyLogs</span>(<span class="hljs-params"/>) {
      <span class="hljs-keyword">const</span> text = <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-property">logs</span>
        .<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">log</span>) =&gt;</span> <span class="hljs-string">`[<span class="hljs-subst">${log.time}</span>] [<span class="hljs-subst">${log.type}</span>] <span class="hljs-subst">${log.content}</span>`</span>)
        .<span class="hljs-title function_">join</span>(<span class="hljs-string">"\n"</span>)

      wx.<span class="hljs-title function_">setClipboardData</span>({
        <span class="hljs-attr">data</span>: text,
        <span class="hljs-attr">success</span>: <span class="hljs-function">() =&gt;</span> {
          wx.<span class="hljs-title function_">showToast</span>({ <span class="hljs-attr">title</span>: <span class="hljs-string">"已复制到剪贴板"</span> })
        },
      })
    },
  },
})
</code></pre>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- debug-panel.wxml --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"debug-trigger"</span> <span class="hljs-attr">bindtap</span>=<span class="hljs-string">"toggle"</span>&gt;</span>🐛<span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"debug-panel {{visible ? 'visible' : ''}}"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"debug-header"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">text</span>&gt;</span>调试面板<span class="hljs-tag">&lt;/<span class="hljs-name">text</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">text</span> <span class="hljs-attr">bindtap</span>=<span class="hljs-string">"toggle"</span>&gt;</span>✕<span class="hljs-tag">&lt;/<span class="hljs-name">text</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"debug-tabs"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">text</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"tab active"</span>&gt;</span>日志<span class="hljs-tag">&lt;/<span class="hljs-name">text</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">text</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"tab"</span>&gt;</span>系统<span class="hljs-tag">&lt;/<span class="hljs-name">text</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">text</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"tab"</span>&gt;</span>网络<span class="hljs-tag">&lt;/<span class="hljs-name">text</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-name">scroll-view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"debug-content"</span> <span class="hljs-attr">scroll-y</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">wx:for</span>=<span class="hljs-string">"{{logs}}"</span> <span class="hljs-attr">wx:key</span>=<span class="hljs-string">"index"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"log-item log-{{item.type}}"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">text</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"log-time"</span>&gt;</span>{{item.time}}<span class="hljs-tag">&lt;/<span class="hljs-name">text</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">text</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"log-content"</span>&gt;</span>{{item.content}}<span class="hljs-tag">&lt;/<span class="hljs-name">text</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">scroll-view</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"debug-footer"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">size</span>=<span class="hljs-string">"mini"</span> <span class="hljs-attr">bindtap</span>=<span class="hljs-string">"clearLogs"</span>&gt;</span>清空<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">size</span>=<span class="hljs-string">"mini"</span> <span class="hljs-attr">bindtap</span>=<span class="hljs-string">"copyLogs"</span>&gt;</span>复制<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>
</code></pre>
<h3 data-id="heading-18">5.2 性能监控埋点</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// utils/performance.js</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">PerformanceMonitor</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">marks</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>()
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">measures</span> = []
  }

  <span class="hljs-comment">// 标记开始</span>
  <span class="hljs-title function_">mark</span>(<span class="hljs-params">name</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">marks</span>.<span class="hljs-title function_">set</span>(name, <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>())
  }

  <span class="hljs-comment">// 测量耗时</span>
  <span class="hljs-title function_">measure</span>(<span class="hljs-params">name, startMark, endMark</span>) {
    <span class="hljs-keyword">const</span> start = <span class="hljs-variable language_">this</span>.<span class="hljs-property">marks</span>.<span class="hljs-title function_">get</span>(startMark)
    <span class="hljs-keyword">const</span> end = endMark ? <span class="hljs-variable language_">this</span>.<span class="hljs-property">marks</span>.<span class="hljs-title function_">get</span>(endMark) : <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>()

    <span class="hljs-keyword">if</span> (!start) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">`Mark "<span class="hljs-subst">${startMark}</span>" not found`</span>)
      <span class="hljs-keyword">return</span>
    }

    <span class="hljs-keyword">const</span> duration = end - start
    <span class="hljs-keyword">const</span> measure = { name, duration, <span class="hljs-attr">timestamp</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() }

    <span class="hljs-variable language_">this</span>.<span class="hljs-property">measures</span>.<span class="hljs-title function_">push</span>(measure)

    <span class="hljs-comment">// 超过阈值告警</span>
    <span class="hljs-keyword">if</span> (duration &gt; <span class="hljs-number">1000</span>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">`[Performance] <span class="hljs-subst">${name}</span> 耗时 <span class="hljs-subst">${duration}</span>ms，超过 1s 阈值`</span>)
    }

    <span class="hljs-keyword">return</span> duration
  }

  <span class="hljs-comment">// 自动测量函数执行时间</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">measureAsync</span>(<span class="hljs-params">name, fn</span>) {
    <span class="hljs-keyword">const</span> startMark = <span class="hljs-string">`<span class="hljs-subst">${name}</span>_start`</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">mark</span>(startMark)

    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fn</span>()
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">measure</span>(name, startMark)
      <span class="hljs-keyword">return</span> result
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">measure</span>(<span class="hljs-string">`<span class="hljs-subst">${name}</span>_error`</span>, startMark)
      <span class="hljs-keyword">throw</span> error
    }
  }

  <span class="hljs-comment">// 获取报告</span>
  <span class="hljs-title function_">getReport</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">measures</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">measures</span>,
      <span class="hljs-attr">summary</span>: {
        <span class="hljs-attr">total</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">measures</span>.<span class="hljs-property">length</span>,
        <span class="hljs-attr">avgDuration</span>:
          <span class="hljs-variable language_">this</span>.<span class="hljs-property">measures</span>.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">sum, m</span>) =&gt;</span> sum + m.<span class="hljs-property">duration</span>, <span class="hljs-number">0</span>) /
          <span class="hljs-variable language_">this</span>.<span class="hljs-property">measures</span>.<span class="hljs-property">length</span>,
        <span class="hljs-attr">maxDuration</span>: <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(...<span class="hljs-variable language_">this</span>.<span class="hljs-property">measures</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">m</span>) =&gt;</span> m.<span class="hljs-property">duration</span>)),
        <span class="hljs-attr">slowCount</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">measures</span>.<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">m</span>) =&gt;</span> m.<span class="hljs-property">duration</span> &gt; <span class="hljs-number">1000</span>).<span class="hljs-property">length</span>,
      },
    }
  }

  <span class="hljs-comment">// 上报数据</span>
  <span class="hljs-title function_">report</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> report = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getReport</span>()

    <span class="hljs-comment">// 上报到服务器</span>
    wx.<span class="hljs-title function_">request</span>({
      <span class="hljs-attr">url</span>: <span class="hljs-string">"https://your-api.com/performance"</span>,
      <span class="hljs-attr">method</span>: <span class="hljs-string">"POST"</span>,
      <span class="hljs-attr">data</span>: report,
    })

    <span class="hljs-comment">// 清空数据</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">measures</span> = []
  }
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> perfMonitor = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PerformanceMonitor</span>()

<span class="hljs-comment">// 使用示例</span>
<span class="hljs-comment">// 页面加载性能监控</span>
<span class="hljs-title class_">Page</span>({
  <span class="hljs-title function_">onLoad</span>(<span class="hljs-params"/>) {
    perfMonitor.<span class="hljs-title function_">mark</span>(<span class="hljs-string">"pageLoad_start"</span>)
  },

  <span class="hljs-title function_">onReady</span>(<span class="hljs-params"/>) {
    perfMonitor.<span class="hljs-title function_">measure</span>(<span class="hljs-string">"pageLoad"</span>, <span class="hljs-string">"pageLoad_start"</span>)
  },

  <span class="hljs-keyword">async</span> <span class="hljs-title function_">fetchData</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> perfMonitor.<span class="hljs-title function_">measureAsync</span>(<span class="hljs-string">"fetchData"</span>, <span class="hljs-keyword">async</span> () =&gt; {
      <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title function_">request</span>({ <span class="hljs-attr">url</span>: <span class="hljs-string">"/api/data"</span> })
      <span class="hljs-keyword">return</span> res.<span class="hljs-property">data</span>
    })

    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setData</span>({ data })
  },
})
</code></pre>
<hr/>
<h2 data-id="heading-19">写在最后：邪修有风险，使用需谨慎</h2>
<p>这些"邪修"技巧，都是在实际项目中踩坑后总结出来的。</p>
<p><strong>它们有几个共同特点：</strong></p>
<ol>
<li><strong>官方文档不会告诉你</strong>：因为这些不是"标准做法"</li>
<li><strong>可能随时失效</strong>：微信更新后，某些 hack 可能不再有效</li>
<li><strong>有一定风险</strong>：绕过官方限制，可能带来兼容性问题</li>
<li><strong>但确实有效</strong>：在特定场景下，能解决实际问题</li>
</ol>
<p><strong>使用建议：</strong></p>
<ul>
<li>优先使用官方方案</li>
<li>邪修技巧作为备选</li>
<li>做好兼容性测试</li>
<li>关注微信更新日志</li>
<li>随时准备替代方案</li>
</ul>
<p><strong>最后，愿你的小程序：</strong></p>
<ul>
<li>性能如丝般顺滑</li>
<li>体验如原生般流畅</li>
<li>Bug 如晨露般消散</li>
<li>审核如绿灯般通过</li>
</ul>
<hr/>
<blockquote>
<p>💬 <strong>互动时间</strong>：你在小程序开发中遇到过什么奇葩问题？用了什么骚操作解决的？评论区分享一下你的"邪修"经验！</p>
<p>觉得这篇文章有用？<strong>点赞 + 在看 + 转发</strong>，让更多小程序开发者少踩坑～</p>
</blockquote>
<hr/>
<p><em>本文作者是一个在小程序坑里摸爬滚打多年的老开发。关注我，一起在微信的"围墙花园"里优雅地生存。</em></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[在 ViewPager2 + Fragment 架构中玩转 Jetpack Compose]]></title>    <link>https://juejin.cn/post/7592040819818381353</link>    <guid>https://juejin.cn/post/7592040819818381353</guid>    <pubDate>2026-01-07T02:38:41.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592040819818381353" data-draft-id="7592058764120637459" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="在 ViewPager2 + Fragment 架构中玩转 Jetpack Compose"/> <meta itemprop="keywords" content="Android"/> <meta itemprop="datePublished" content="2026-01-07T02:38:41.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="用户4165967369355"/> <meta itemprop="url" content="https://juejin.cn/user/1146150492576877"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            在 ViewPager2 + Fragment 架构中玩转 Jetpack Compose
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1146150492576877/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    用户4165967369355
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-07T02:38:41.000Z" title="Wed Jan 07 2026 02:38:41 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>随着 Android 开发进入 Compose 时代，许多开发者选择在现有的 <code>ViewPager2</code> 架构中引入 Compose，通过这种“混合模式”平滑过渡。虽然两者可以共存，但由于 View 系统与 Compose 的底层渲染机制存在差异，实际落地时有几个**“深坑”**必须避开。</p>
<p>本文总结了在 <code>ViewPager2 + Fragment</code> 中使用 Compose 的四大核心要点。</p>
<hr/>
<h2 data-id="heading-0">1. 内存泄漏的“隐形杀手”：ViewCompositionStrategy</h2>
<p>在 Fragment 中使用 <code>ComposeView</code> 时，最常见的问题是 <strong>Composition（组合）的销毁时机</strong>。</p>
<ul>
<li><strong>痛点</strong>：Fragment 的 View 生命周期与 Fragment 对象本身的生命周期是不一致的。如果 Compose 不知道 View 已经销毁，它可能会继续持有引用，导致内存泄漏或崩溃。</li>
<li><strong>对策</strong>：必须在 <code>onCreateView</code> 中明确指定销毁策略。</li>
</ul>
<p>Kotlin</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCreateView</span><span class="hljs-params">(
    inflater: <span class="hljs-type">LayoutInflater</span>, container: <span class="hljs-type">ViewGroup</span>?, savedInstanceState: <span class="hljs-type">Bundle</span>?
)</span></span>: View {
    <span class="hljs-keyword">return</span> ComposeView(requireContext()).apply {
        <span class="hljs-comment">// 关键代码：确保 View 被销毁时，Composition 也能正确清理</span>
        setViewCompositionStrategy(
            ViewCompositionStrategy.DisposeOnViewTreeLifecycleDestroyed
        )
        setContent {
            MaterialTheme {
                MyPagerScreen()
            }
        }
    }
}
</code></pre>
<hr/>
<h2 data-id="heading-1">2. 状态丢失：记住 rememberSaveable</h2>
<p><code>ViewPager2</code> 默认会销毁超出缓存范围（<code>offscreenPageLimit</code>）的 Fragment 视图。</p>
<ul>
<li>
<p><strong>痛点</strong>：当我们从第 1 页滑动到第 10 页，再滑回第 1 页时，原本输入的文字或滑动的位置可能消失了。</p>
</li>
<li>
<p><strong>对策</strong>：</p>
<ol>
<li><strong>Compose 内部状态</strong>：使用 <code>rememberSaveable</code> 代替 <code>remember</code>。</li>
<li><strong>业务逻辑状态</strong>：将状态托管在 <code>ViewModel</code> 中，并利用 <code>collectAsStateWithLifecycle()</code> 进行观察。</li>
</ol>
</li>
</ul>
<hr/>
<h2 data-id="heading-2">3. 滑动冲突：横向滚动的博弈</h2>
<p><code>ViewPager2</code> 本质上是一个横向滑动的 <code>RecyclerView</code>，而 Compose 里的 <code>LazyRow</code> 也是横滑。</p>
<ul>
<li><strong>痛点</strong>：当我们在 Compose 内部滑动列表时，可能会意外触发 ViewPager 的翻页。</li>
<li><strong>现状</strong>：Compose 1.2+ 已经支持了嵌套滚动（Nested Scrolling）。但在某些复杂交互（如内嵌地图或自定义绘图）中，我们仍需手动干预。</li>
<li><strong>Tips</strong>：如果遇到极端的滑动冲突，可以通过 <code>Modifier.pointerInput</code> 结合 <code>requestDisallowInterceptTouchEvent(true)</code> 来强制让 Compose 优先获得控制权。</li>
</ul>
<hr/>
<h2 data-id="heading-3">4. 预加载与性能调优：OffscreenPageLimit</h2>
<p>Compose 的首次渲染（Initial Composition）相对 View 来说更消耗 CPU 资源。</p>
<ul>
<li>
<p><strong>问题</strong>：快速滑动 ViewPager2 时，Compose 界面可能会出现短暂的白屏或掉帧。</p>
</li>
<li>
<p><strong>优化方案</strong>：</p>
<ul>
<li><strong>设置预加载</strong>：<code>viewPager2.offscreenPageLimit = 1</code>。这会提前初始化相邻页面的 Compose 内容，牺牲少量内存换取丝滑的滑动体验。</li>
<li><strong>基线配置文件 (Baseline Profiles)</strong> ：在生产环境下使用 Baseline Profiles，可以显著提升 Compose 组件的冷启动性能，减少滑动卡顿。</li>
</ul>
</li>
</ul>
<hr/>
<h2 data-id="heading-4">总结</h2>
<p>在 <code>ViewPager2</code> 中嵌套 <code>Fragment</code> + <code>Compose</code> 是目前的黄金过渡方案。只要记住**“策略销毁、状态持久、预加载优化”**这三板斧，就能在享受 Compose 开发效率的同时，保证应用的稳定性。</p>
<p><strong>💡 避坑 checklist：</strong></p>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 是否设置了 <code>DisposeOnViewTreeLifecycleDestroyed</code>？</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 关键 UI 状态是否使用了 <code>rememberSaveable</code>？</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 是否针对 <code>ViewPager2</code> 开启了合理的 <code>offscreenPageLimit</code>？</li>
</ul>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Android进程模型基础]]></title>    <link>https://juejin.cn/post/7592152007839219712</link>    <guid>https://juejin.cn/post/7592152007839219712</guid>    <pubDate>2026-01-07T03:39:21.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592152007839219712" data-draft-id="7592127014188236800" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Android进程模型基础"/> <meta itemprop="keywords" content="Android"/> <meta itemprop="datePublished" content="2026-01-07T03:39:21.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="用户7458900207954"/> <meta itemprop="url" content="https://juejin.cn/user/2788814857713687"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Android进程模型基础
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2788814857713687/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    用户7458900207954
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-07T03:39:21.000Z" title="Wed Jan 07 2026 03:39:21 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">基础回顾</h2>



































<table><thead><tr><th>维度</th><th>进程</th><th>线程</th></tr></thead><tbody><tr><td>定义</td><td>操作系统资源分配的基本单位</td><td>CPU调度的基本单位</td></tr><tr><td>内存空间</td><td>独立内存空间，相互隔离</td><td>共享进程的内存空间</td></tr><tr><td>通信方式</td><td>IPC（Binder、Socket、共享文件等）</td><td>共享内存、Handler等</td></tr><tr><td>创建开销</td><td>大（需分配独立内存空间）</td><td>小（共享进程资源）</td></tr><tr><td>Android 体现</td><td>每个应用默认一个进程，可配置多进程</td><td>主线程（UI线程）+ 工作线程</td></tr></tbody></table>
<h2 data-id="heading-1">Android进程</h2>
<p>Android基于Linux内核，但有自己的进程管理策略</p>
<pre><code class="hljs language-xml" lang="xml">// 在AndroidManifest.xml中声明进程
<span class="hljs-tag">&lt;<span class="hljs-name">application</span>
    <span class="hljs-attr">android:process</span>=<span class="hljs-string">":remote"</span>&gt;</span>  <span class="hljs-comment">&lt;!-- 冒号表示私有进程 --&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 默认情况下，所有组件运行在application指定的进程中 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">activity</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">".MainActivity"</span> /&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 可以为特定组件指定不同进程 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">service</span>
        <span class="hljs-attr">android:name</span>=<span class="hljs-string">".RemoteService"</span>
        <span class="hljs-attr">android:process</span>=<span class="hljs-string">":background"</span> /&gt;</span>
        
    <span class="hljs-tag">&lt;<span class="hljs-name">activity</span>
        <span class="hljs-attr">android:name</span>=<span class="hljs-string">".WebViewActivity"</span>
        <span class="hljs-attr">android:process</span>=<span class="hljs-string">":webview"</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">application</span>&gt;</span>
</code></pre>
<p><strong>默认情况下，一个Android应用运行在一个进程中</strong>。这个进程的名称通常就是应用的包名。</p>
<p>虽然默认是单进程，但在以下场景中需要考虑多进程：</p>
<ul>
<li>规避内存限制</li>
</ul>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- 在AndroidManifest中为组件指定独立进程 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">application</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 主进程，负责UI --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">activity</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">".MainActivity"</span> /&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 独立进程，处理内存密集型任务 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">service</span>
        <span class="hljs-attr">android:name</span>=<span class="hljs-string">".ImageProcessingService"</span>
        <span class="hljs-attr">android:process</span>=<span class="hljs-string">":image_process"</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">application</span>&gt;</span>
</code></pre>
<p>每个进程有独立的内存空间。Android为每个进程设置内存上限（比如256MB）。如果应用需要处理大图、视频等，可以放到独立进程，避免主进程OOM。</p>
<ul>
<li>独立运行的组件</li>
</ul>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 音乐播放器应用：播放服务运行在独立进程</span>
<span class="hljs-comment">// 这样即使主进程崩溃，音乐还能继续播放</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">MusicService</span> : <span class="hljs-type">Service</span>() {
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCreate</span><span class="hljs-params">()</span></span> {
        <span class="hljs-keyword">super</span>.onCreate()
        Log.d(<span class="hljs-string">"MusicService"</span>, <span class="hljs-string">"运行在独立进程，进程名: <span class="hljs-subst">${getProcessName()}</span>"</span>)
    }
}
</code></pre>
<p>使用场景例如：播放器，音乐播放不受UI进程影响；下载器，下载任务独立运行；推送服务，保持长连接，与UI逻辑分离。</p>
<ul>
<li>隔离不稳定模块</li>
</ul>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- WebView独立进程，避免崩溃影响主应用 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">activity</span>
    <span class="hljs-attr">android:name</span>=<span class="hljs-string">".WebViewActivity"</span>
    <span class="hljs-attr">android:process</span>=<span class="hljs-string">":webview"</span> /&gt;</span>
</code></pre>
<p>WebView、第三方SDK等可能不稳定的模块，放在独立进程可以避免崩溃影响主应用。</p>
<ul>
<li>提升性能（谨慎使用）</li>
</ul>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- 将频繁GC的后台任务放到独立进程 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">service</span>
    <span class="hljs-attr">android:name</span>=<span class="hljs-string">".DataSyncService"</span>
    <span class="hljs-attr">android:process</span>=<span class="hljs-string">":sync"</span> /&gt;</span>
</code></pre>
<p>如果某个组件频繁创建/销毁对象导致GC，会影响UI流畅度。独立进程后，GC只影响该进程。</p>
<h3 data-id="heading-2">多进程优缺点</h3>






























<table><thead><tr><th>优点</th><th>说明</th><th>示例</th></tr></thead><tbody><tr><td>内存隔离</td><td>每个进程独立内存空间，可突破单进程内存限制</td><td>图片编辑应用：UI进程 + 图片处理进程</td></tr><tr><td>稳定性提升</td><td>一个进程崩溃不影响其他进程</td><td>WebView崩溃不会导致整个应用退出</td></tr><tr><td>安全隔离</td><td>敏感操作可在独立进程进行</td><td>支付模块运行在独立进程</td></tr><tr><td>性能优化</td><td>可利用多核CPU并行计算</td><td>视频转码应用使用多进程并行处理</td></tr></tbody></table>






























<table><thead><tr><th>缺点</th><th>说明</th><th>解决方案</th></tr></thead><tbody><tr><td>通信复杂</td><td>进程间不能直接共享内存，需要IPC</td><td>使用Binder、Messenger、AIDL等</td></tr><tr><td>开销增大</td><td>每个进程都有独立的内存、类加载等开销</td><td>谨慎创建，避免过多进程</td></tr><tr><td>数据同步难</td><td>共享数据需要额外机制</td><td>使用ContentProvider、文件、SharedPreferences（MODE_MULTI_PROCESS已废弃）</td></tr><tr><td>调试困难</td><td>多进程调试复杂，需附加到不同进程</td><td>使用Android Studio的多进程调试功能</td></tr></tbody></table>
<h2 data-id="heading-3">Android进程的创建过程</h2>
<h3 data-id="heading-4">Zygote：所有应用的"母体"</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6847d66b6cda4b06b30d790601efd411~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3NzQ1ODkwMDIwNzk1NA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768361961&amp;x-signature=IsGUOgE1%2FMMSTx3o5x%2FUL%2FJpm%2B4%3D" alt="image.png" loading="lazy"/></p>
<p>当系统需要启动一个新的应用时，如果为每个应用都从头初始化整个运行环境（包括加载系统资源、类库等），会非常耗时。Zygote进程就是为了解决这个问题而设计的。</p>
<p>Zygote进程在系统启动时被创建，它已经完成了：</p>
<ol>
<li>初始化虚拟机（DVM/ART）</li>
<li>加载系统资源</li>
<li>预加载Android框架的类和资源</li>
</ol>
<p>当需要启动新应用时，Zygote会<code>fork</code>出一个子进程。这个子进程会继承Zygote进程已经加载的系统资源和类，这样新进程就无需重新加载这些，从而大大加快了启动速度。</p>
<p>fork是Unix/Linux系统中创建新进程的系统调用。传统上，fork会复制父进程的整个地址空间给子进程。但是，如果父进程很大，那么复制整个地址空间将会非常耗时，而且子进程可能很快就会通过exec系统调用加载一个新的程序，这样刚才复制的地址空间就被完全替换了，导致复制操作白费了。</p>
<p>为了解决这个问题，现代操作系统（包括Linux）实现了写时复制（Copy-on-Write，简称COW）技术。其核心思想是：当父进程调用fork创建子进程时，内核并不复制整个进程的地址空间，而是让子进程和父进程共享相同的物理内存页。但是，这些内存页会被标记为写时复制。也就是说，当父进程或子进程试图修改某个内存页时，内核才会复制这个页，然后让修改方拥有这个页的私有副本。</p>
<p>这样，fork操作就变得非常轻量，因为只需要复制父进程的页表（一种数据结构，用于将虚拟地址映射到物理地址），而不需要复制实际的物理内存页。子进程几乎可以立即开始运行。</p>
<h3 data-id="heading-5">进程优先级：Android如何管理进程生死</h3>
<p>Android根据进程的重要性动态调整优先级：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ProcessList.java中定义的进程优先级</span>
<span class="hljs-comment">// 数字越小优先级越高</span>
<span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">FOREGROUND_APP_ADJ</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;      <span class="hljs-comment">// 前台应用</span>
<span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">VISIBLE_APP_ADJ</span> <span class="hljs-operator">=</span> <span class="hljs-number">100</span>;       <span class="hljs-comment">// 可见应用</span>
<span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">PERCEPTIBLE_APP_ADJ</span> <span class="hljs-operator">=</span> <span class="hljs-number">200</span>;   <span class="hljs-comment">// 可感知应用（如播放音乐）</span>
<span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">BACKUP_APP_ADJ</span> <span class="hljs-operator">=</span> <span class="hljs-number">300</span>;        <span class="hljs-comment">// 备份进程</span>
<span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">CACHED_APP_MIN_ADJ</span> <span class="hljs-operator">=</span> <span class="hljs-number">350</span>;    <span class="hljs-comment">// 缓存应用（最低）</span>
<span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">CACHED_APP_MAX_ADJ</span> <span class="hljs-operator">=</span> <span class="hljs-number">400</span>;
</code></pre>
<pre><code class="hljs">应用启动 → 前台进程（最高优先级）
用户按Home键 → 可见进程（次高优先级）
转到其他应用 → 服务进程（如果有Service）
长时间在后台 → 缓存进程（可能被回收）
</code></pre>
<p>Android的进程回收机制主要通过 <strong>Low Memory Killer (LMK)</strong> 和 <strong>OOM Adj</strong>评分系统来实现智能管理。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 简化版LMK内核代码逻辑（kernel/drivers/staging/android/lowmemorykiller.c）</span>
<span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">lowmemory_killer</span><span class="hljs-params">(<span class="hljs-keyword">void</span> *arg)</span> {
    <span class="hljs-keyword">while</span> (!kthread_should_stop()) {
        <span class="hljs-comment">// 1. 检查当前内存压力</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">other_free</span> <span class="hljs-operator">=</span> global_page_state(NR_FREE_PAGES);
        <span class="hljs-type">int</span> <span class="hljs-variable">other_file</span> <span class="hljs-operator">=</span> global_page_state(NR_FILE_PAGES);
        
        <span class="hljs-comment">// 2. 遍历进程，计算"badness"分数</span>
        for_each_process(p) {
            <span class="hljs-comment">// 跳过不可杀进程（init、kthread等）</span>
            <span class="hljs-keyword">if</span> (p-&gt;flags &amp; PF_KTHREAD)
                <span class="hljs-keyword">continue</span>;
            
            <span class="hljs-comment">// 获取进程的oom_score_adj（用户空间设置）</span>
            <span class="hljs-type">int</span> <span class="hljs-variable">oom_score_adj</span> <span class="hljs-operator">=</span> p-&gt;signal-&gt;oom_score_adj;
            <span class="hljs-keyword">if</span> (oom_score_adj == OOM_SCORE_ADJ_MAX)
                <span class="hljs-keyword">continue</span>;
            
            <span class="hljs-comment">// 3. 计算综合分数</span>
            points = oom_badness(p, NULL, nodemask, totalpages);
            
            <span class="hljs-comment">// 4. 找到最"坏"的进程</span>
            <span class="hljs-keyword">if</span> (points &gt; selected_points) {
                selected = p;
                selected_points = points;
            }
        }
        
        <span class="hljs-comment">// 5. 如果内存紧张，杀掉选中的进程</span>
        <span class="hljs-keyword">if</span> (selected) {
            send_sig(SIGKILL, selected, <span class="hljs-number">0</span>);
        }
        
        <span class="hljs-comment">// 6. 休眠，等待下一次检查</span>
        schedule_timeout_interruptible(poll_interval);
    }
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Gradle脚本执行]]></title>    <link>https://juejin.cn/post/7592234632482455561</link>    <guid>https://juejin.cn/post/7592234632482455561</guid>    <pubDate>2026-01-07T03:54:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592234632482455561" data-draft-id="7592164124660351026" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Gradle脚本执行"/> <meta itemprop="keywords" content="Android"/> <meta itemprop="datePublished" content="2026-01-07T03:54:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="GoldenPlayer"/> <meta itemprop="url" content="https://juejin.cn/user/2999123453948119"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Gradle脚本执行
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2999123453948119/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    GoldenPlayer
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-07T03:54:23.000Z" title="Wed Jan 07 2026 03:54:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong>只要 <code>apply from: 'config.gradle'</code> 这行代码被读到，<code>config.gradle</code> 里的代码就会被立即执行。</strong></p>
<h3 data-id="heading-0">详细解释为什么</h3>
<p>Gradle 的生命周期分为三个阶段，这对于理解脚本执行时机非常重要：</p>
<ol>
<li>
<p><strong>初始化阶段 (Initialization)</strong>：
Gradle 决定有哪些项目参与构建（读取 <code>settings.gradle</code>）</p>
</li>
<li>
<p><strong>配置阶段 (Configuration) —— <strong>重点在这里</strong></strong>：</p>
<ul>
<li>当点击 <strong>Sync</strong>（大象图标）或者点击 <strong>Run</strong>（绿色三角形）时，Gradle <strong>必须</strong>先执行这个阶段。</li>
<li>在这个阶段，Gradle 会把所有的 <code>build.gradle</code> 文件从头到尾执行一遍，为了搞清楚项目有哪些依赖、版本号是多少、有哪些 Task 等等。</li>
<li>当根目录的 <code>build.gradle</code> 执行到 <code>apply from: 'config.gradle'</code> 这一行时，它会<strong>立即跳转</strong>去执行 <code>config.gradle</code> 的全部内容。</li>
<li>因此，<code>ext { ... }</code> 里的 <code>buildNum = getAndIncrementBuildNum()</code> 会被立即调用</li>
</ul>
</li>
<li>
<p><strong>执行阶段 (Execution)</strong>：</p>
<ul>
<li>只有当你真正编译（Run/Assemble）时才会进入这个阶段。这里才是真正执行编译 Java/Kotlin 代码、打包 APK 的地方</li>
</ul>
</li>
</ol>
<hr/>
<h3 data-id="heading-1">这对 <code>buildNum</code> 意味着什么？</h3>
<p>正因为 <code>config.gradle</code> 在 <strong>Sync</strong> 阶段（配置阶段）就会被执行，所以在写自增逻辑时必须非常小心：</p>
<ul>
<li>
<p><strong>如果不加判断</strong>：
每次点击 Sync，或者修改了 <code>build.gradle</code> 自动刷新，<code>getAndIncrementBuildNum()</code> 就会跑一遍，导致 <code>version.properties</code> 里的数字莫名其妙一直增加。</p>
</li>
<li>
<p><strong>加了 <code>taskNames</code> 判断后</strong>：</p>
<ol>
<li><strong>Sync 时</strong>：Gradle 执行 <code>config.gradle</code> -&gt; 调用 <code>getAndIncrementBuildNum()</code> -&gt; 获取到 <code>taskNames</code> 是空的（或者只是 generate 任务） -&gt; <strong>代码逻辑判断不满足条件</strong> -&gt; <strong>只读取旧值，不执行 <code>+1</code> 写入操作</strong>。</li>
<li><strong>打包/Run 时</strong>：Gradle 执行 <code>config.gradle</code> -&gt; 调用 <code>getAndIncrementBuildNum()</code> -&gt; 获取到 <code>taskNames</code> 包含 "assemble" -&gt; <strong>代码逻辑满足条件</strong> -&gt; <strong>执行 <code>+1</code> 并写入文件</strong>。</li>
</ol>
</li>
</ul>
<h3 data-id="heading-2">关于代码位置</h3>
<p>在 <code>root/build.gradle</code> 中写的：</p>
<pre><code class="hljs language-groovy" lang="groovy">buildscript {
    apply from: 'config.gradle' // &lt;--- 就在这一行
    // ...
}
</code></pre>
<p>这行代码让 <code>config.gradle</code> 成为了构建脚本的一部分。一旦执行到这里，<code>config.gradle</code> 里的 <code>ext</code> 变量就会被加载到内存中，供后面的 <code>allprojects</code> 或者 <code>app/build.gradle</code> 使用</p>
<h3 data-id="heading-3">总结</h3>
<ol>
<li><strong>执行了吗？</strong> 是的，每次 Sync 或 Build 必执行</li>
<li><strong>为什么看不到效果？</strong> 之前是因为只有在 <code>release</code> 任务时才写入文件，而可能是在点 <code>Run</code> (debug) 或者 <code>Sync</code>，导致逻辑走进了 <code>else</code> 分支（不保存）</li>
<li><strong>现在的解决办法</strong>：它通过检测 <code>taskNames</code> 来区分“仅仅是 Sync”还是“真正的打包/运行”，从而决定是否要增加版本号</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[手把手配置 Ralph -- 火爆 X 的全自动 AI 编程工具]]></title>    <link>https://juejin.cn/post/7592089325913440256</link>    <guid>https://juejin.cn/post/7592089325913440256</guid>    <pubDate>2026-01-07T02:20:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592089325913440256" data-draft-id="7592127014188154880" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="手把手配置 Ralph  -- 火爆 X 的全自动 AI 编程工具"/> <meta itemprop="keywords" content="前端,后端,GitHub"/> <meta itemprop="datePublished" content="2026-01-07T02:20:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Charlo"/> <meta itemprop="url" content="https://juejin.cn/user/1239904845853870"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            手把手配置 Ralph  -- 火爆 X 的全自动 AI 编程工具
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1239904845853870/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Charlo
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-07T02:20:03.000Z" title="Wed Jan 07 2026 02:20:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">工具背景</h2>
<h3 data-id="heading-1">1. 角色介绍：Ralph Wiggum (拉尔夫·维/威格姆)</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/911475286774481fbd30db929e91c636~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ2hhcmxv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768357202&amp;x-signature=sX8zgtelYQ2TxL90o9NrFQLHQk4%3D" alt="G9-gtHmW0AE8pmK.jfif" loading="lazy"/>
<strong>出处：</strong>  《辛普森一家》(The Simpsons)[<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.google.com%2Furl%3Fsa%3DE%26q%3Dhttps%253A%252F%252Fvertexaisearch.cloud.google.com%252Fgrounding-api-redirect%252FAUZIYQFituw0EQEANs5tUm0fBhF0ohGW-yc4l9MklnAfs5wVnYRdvexWDQvuMMZNZw4N4J-TO0zR1MGFsoMd5pgNhVx7C8O_ZlMkOv0pABluAZLsjl4Vr7AjXsdXpKKrmIz_Pg6QvEWtyg3niS8U" target="_blank" title="https://www.google.com/url?sa=E&amp;q=https%3A%2F%2Fvertexaisearch.cloud.google.com%2Fgrounding-api-redirect%2FAUZIYQFituw0EQEANs5tUm0fBhF0ohGW-yc4l9MklnAfs5wVnYRdvexWDQvuMMZNZw4N4J-TO0zR1MGFsoMd5pgNhVx7C8O_ZlMkOv0pABluAZLsjl4Vr7AjXsdXpKKrmIz_Pg6QvEWtyg3niS8U" ref="nofollow noopener noreferrer">1</a>][<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.google.com%2Furl%3Fsa%3DE%26q%3Dhttps%253A%252F%252Fvertexaisearch.cloud.google.com%252Fgrounding-api-redirect%252FAUZIYQFYu_2zwukIiw8ai2BfvlaTCI17E9en3WIh12d5D5fU6PponFSjtJWFtIWPeelsoSHEL2gmD4pR-VAv8PigBXTedgdlibOlysvVTFtkALDwGQAtaDT361ZpFGkZo-2bRMOuSeYIXScMvHmv246OBkmqZD_LZfxMd-rsIcIzTx3QCwP7HiqvmHZxD3uqrUwjHwd1WksIW7uvK3OXJBJQGShslw%253D%253D" target="_blank" title="https://www.google.com/url?sa=E&amp;q=https%3A%2F%2Fvertexaisearch.cloud.google.com%2Fgrounding-api-redirect%2FAUZIYQFYu_2zwukIiw8ai2BfvlaTCI17E9en3WIh12d5D5fU6PponFSjtJWFtIWPeelsoSHEL2gmD4pR-VAv8PigBXTedgdlibOlysvVTFtkALDwGQAtaDT361ZpFGkZo-2bRMOuSeYIXScMvHmv246OBkmqZD_LZfxMd-rsIcIzTx3QCwP7HiqvmHZxD3uqrUwjHwd1WksIW7uvK3OXJBJQGShslw%3D%3D" ref="nofollow noopener noreferrer">2</a>][<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.google.com%2Furl%3Fsa%3DE%26q%3Dhttps%253A%252F%252Fvertexaisearch.cloud.google.com%252Fgrounding-api-redirect%252FAUZIYQGv0l_98-Ff2aihGC0vH2igcbQMSZbD2Yft1OOZCLmEHZXc19JFOmU_YyIqiXy_sriuVZQ4eXd8shtHCmJ1WUi-UfWx8YmI0b86IDH_0znw2kC7ANNQtA%253D%253D" target="_blank" title="https://www.google.com/url?sa=E&amp;q=https%3A%2F%2Fvertexaisearch.cloud.google.com%2Fgrounding-api-redirect%2FAUZIYQGv0l_98-Ff2aihGC0vH2igcbQMSZbD2Yft1OOZCLmEHZXc19JFOmU_YyIqiXy_sriuVZQ4eXd8shtHCmJ1WUi-UfWx8YmI0b86IDH_0znw2kC7ANNQtA%3D%3D" ref="nofollow noopener noreferrer">3</a>]</p>
<ul>
<li>
<p><strong>身份：</strong>  斯普林菲尔德小学 (Springfield Elementary) 的二年级学生，这也是警察局长克兰西·维格姆 (Chief Wiggum) 的儿子。</p>
</li>
<li>
<p><strong>性格特征：</strong></p>
<ul>
<li>
<p><strong>天真与怪诞：</strong>  Ralph 是剧中典型的“大智若愚”或纯粹“脱线”的角色。他经常说出一些毫无逻辑、与当下情境无关的经典台词（Non-sequiturs），既好笑又带有一种奇怪的诗意。</p>
</li>
<li>
<p><strong>单纯善良：</strong>  尽管他经常被视为“由于某种原因不太聪明”的孩子，但他心地非常善良，几乎没有恶意。</p>
</li>
<li>
<p><strong>经典台词：</strong></p>
<ul>
<li>"I'm in danger!" (我即使身处险境也只会傻笑地说这句话，已成为极著名的互联网迷因/表情包)</li>
<li>"Me fail English? That's unpossible!" (我英语挂科了？那是不可能的！——语法本身就是错的)</li>
<li>"My cat's breath smells like cat food." (我猫咪的嘴巴闻起来像猫粮。)</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr/>
<h3 data-id="heading-2">2. 工具介绍：Ralph (AI Coding Agent / Workflow)</h3>
<p> <strong>The Ralph Wiggum Technique</strong> (拉尔夫[<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.google.com%2Furl%3Fsa%3DE%26q%3Dhttps%253A%252F%252Fvertexaisearch.cloud.google.com%252Fgrounding-api-redirect%252FAUZIYQFituw0EQEANs5tUm0fBhF0ohGW-yc4l9MklnAfs5wVnYRdvexWDQvuMMZNZw4N4J-TO0zR1MGFsoMd5pgNhVx7C8O_ZlMkOv0pABluAZLsjl4Vr7AjXsdXpKKrmIz_Pg6QvEWtyg3niS8U" target="_blank" title="https://www.google.com/url?sa=E&amp;q=https%3A%2F%2Fvertexaisearch.cloud.google.com%2Fgrounding-api-redirect%2FAUZIYQFituw0EQEANs5tUm0fBhF0ohGW-yc4l9MklnAfs5wVnYRdvexWDQvuMMZNZw4N4J-TO0zR1MGFsoMd5pgNhVx7C8O_ZlMkOv0pABluAZLsjl4Vr7AjXsdXpKKrmIz_Pg6QvEWtyg3niS8U" ref="nofollow noopener noreferrer">1</a>][<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.google.com%2Furl%3Fsa%3DE%26q%3Dhttps%253A%252F%252Fvertexaisearch.cloud.google.com%252Fgrounding-api-redirect%252FAUZIYQFYu_2zwukIiw8ai2BfvlaTCI17E9en3WIh12d5D5fU6PponFSjtJWFtIWPeelsoSHEL2gmD4pR-VAv8PigBXTedgdlibOlysvVTFtkALDwGQAtaDT361ZpFGkZo-2bRMOuSeYIXScMvHmv246OBkmqZD_LZfxMd-rsIcIzTx3QCwP7HiqvmHZxD3uqrUwjHwd1WksIW7uvK3OXJBJQGShslw%253D%253D" target="_blank" title="https://www.google.com/url?sa=E&amp;q=https%3A%2F%2Fvertexaisearch.cloud.google.com%2Fgrounding-api-redirect%2FAUZIYQFYu_2zwukIiw8ai2BfvlaTCI17E9en3WIh12d5D5fU6PponFSjtJWFtIWPeelsoSHEL2gmD4pR-VAv8PigBXTedgdlibOlysvVTFtkALDwGQAtaDT361ZpFGkZo-2bRMOuSeYIXScMvHmv246OBkmqZD_LZfxMd-rsIcIzTx3QCwP7HiqvmHZxD3uqrUwjHwd1WksIW7uvK3OXJBJQGShslw%3D%3D" ref="nofollow noopener noreferrer">2</a>][<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.google.com%2Furl%3Fsa%3DE%26q%3Dhttps%253A%252F%252Fvertexaisearch.cloud.google.com%252Fgrounding-api-redirect%252FAUZIYQHyFXfMFoR2N52qXupW_4xSPkY5qwA30y31gOpp581kPsWsFArIFVaSvkvPsq9pr8RQxQvEWuVHKfx7NjnzfECysVTjxZ-j6CphwEq_ZDiXfnQTrKYTdE1pKN-65oLHCiLO5wOb3tBFR_e-zGofSBV8oWoMMw%253D%253D" target="_blank" title="https://www.google.com/url?sa=E&amp;q=https%3A%2F%2Fvertexaisearch.cloud.google.com%2Fgrounding-api-redirect%2FAUZIYQHyFXfMFoR2N52qXupW_4xSPkY5qwA30y31gOpp581kPsWsFArIFVaSvkvPsq9pr8RQxQvEWuVHKfx7NjnzfECysVTjxZ-j6CphwEq_ZDiXfnQTrKYTdE1pKN-65oLHCiLO5wOb3tBFR_e-zGofSBV8oWoMMw%3D%3D" ref="nofollow noopener noreferrer">4</a>][<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.google.com%2Furl%3Fsa%3DE%26q%3Dhttps%253A%252F%252Fvertexaisearch.cloud.google.com%252Fgrounding-api-redirect%252FAUZIYQGIk9jnzUUOAqVhhzlBaaDerJUat5AESijp0zWmdoLjN-Z_Sx2BSQ-lnFr8pxvo3nsdtEKU8_j-XJIRIVNa2YBQzg2-N-Zkbm2aw3rq24aJtNYt-6FcWQq0y9H9e7ePVQZOx9oIfJw8qrbx9e8%253D" target="_blank" title="https://www.google.com/url?sa=E&amp;q=https%3A%2F%2Fvertexaisearch.cloud.google.com%2Fgrounding-api-redirect%2FAUZIYQGIk9jnzUUOAqVhhzlBaaDerJUat5AESijp0zWmdoLjN-Z_Sx2BSQ-lnFr8pxvo3nsdtEKU8_j-XJIRIVNa2YBQzg2-N-Zkbm2aw3rq24aJtNYt-6FcWQq0y9H9e7ePVQZOx9oIfJw8qrbx9e8%3D" ref="nofollow noopener noreferrer">5</a>]·维格姆技术) 或 <strong>Ralph Loop</strong>，是近期（2024-2025年）在 AI 辅助编程领域兴起的一种工具/工作流概念。[<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.google.com%2Furl%3Fsa%3DE%26q%3Dhttps%253A%252F%252Fvertexaisearch.cloud.google.com%252Fgrounding-api-redirect%252FAUZIYQFYu_2zwukIiw8ai2BfvlaTCI17E9en3WIh12d5D5fU6PponFSjtJWFtIWPeelsoSHEL2gmD4pR-VAv8PigBXTedgdlibOlysvVTFtkALDwGQAtaDT361ZpFGkZo-2bRMOuSeYIXScMvHmv246OBkmqZD_LZfxMd-rsIcIzTx3QCwP7HiqvmHZxD3uqrUwjHwd1WksIW7uvK3OXJBJQGShslw%253D%253D" target="_blank" title="https://www.google.com/url?sa=E&amp;q=https%3A%2F%2Fvertexaisearch.cloud.google.com%2Fgrounding-api-redirect%2FAUZIYQFYu_2zwukIiw8ai2BfvlaTCI17E9en3WIh12d5D5fU6PponFSjtJWFtIWPeelsoSHEL2gmD4pR-VAv8PigBXTedgdlibOlysvVTFtkALDwGQAtaDT361ZpFGkZo-2bRMOuSeYIXScMvHmv246OBkmqZD_LZfxMd-rsIcIzTx3QCwP7HiqvmHZxD3uqrUwjHwd1WksIW7uvK3OXJBJQGShslw%3D%3D" ref="nofollow noopener noreferrer">2</a>][<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.google.com%2Furl%3Fsa%3DE%26q%3Dhttps%253A%252F%252Fvertexaisearch.cloud.google.com%252Fgrounding-api-redirect%252FAUZIYQGv0l_98-Ff2aihGC0vH2igcbQMSZbD2Yft1OOZCLmEHZXc19JFOmU_YyIqiXy_sriuVZQ4eXd8shtHCmJ1WUi-UfWx8YmI0b86IDH_0znw2kC7ANNQtA%253D%253D" target="_blank" title="https://www.google.com/url?sa=E&amp;q=https%3A%2F%2Fvertexaisearch.cloud.google.com%2Fgrounding-api-redirect%2FAUZIYQGv0l_98-Ff2aihGC0vH2igcbQMSZbD2Yft1OOZCLmEHZXc19JFOmU_YyIqiXy_sriuVZQ4eXd8shtHCmJ1WUi-UfWx8YmI0b86IDH_0znw2kC7ANNQtA%3D%3D" ref="nofollow noopener noreferrer">3</a>]</p>
<p><strong>背景与命名来源：</strong><br/>
这个工具/技术的命名正是致敬了上述的《辛普森一家》角色 Ralph Wiggum。开发者之所以这样命名，是因为这个 AI 代理的工作方式就像 Ralph 一样——<strong>虽然它可能一开始看起来笨笨的，总是犯错（比如代码跑不通），但它非常执着（Persistent），会一直尝试直到把事情做对。</strong></p>
<p><strong>核心功能与用途：</strong></p>
<ul>
<li>
<p><strong>不仅仅是聊天机器人：</strong>  它是基于 <strong>Claude Code</strong> (Anthropic 推出的 CLI 工具) 或类似 LLM 的一种自动化脚本或插件。</p>
</li>
<li>
<p><strong>死循环纠错 (The Loop)：</strong>  它的核心是一个 Bash 循环 (Loop)。当你给它一个编程任务（比如“修复这个 bug”或“重构这个模块”），它不仅是写一次代码，而是会：</p>
<ol>
<li>写代码。[<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.google.com%2Furl%3Fsa%3DE%26q%3Dhttps%253A%252F%252Fvertexaisearch.cloud.google.com%252Fgrounding-api-redirect%252FAUZIYQHyFXfMFoR2N52qXupW_4xSPkY5qwA30y31gOpp581kPsWsFArIFVaSvkvPsq9pr8RQxQvEWuVHKfx7NjnzfECysVTjxZ-j6CphwEq_ZDiXfnQTrKYTdE1pKN-65oLHCiLO5wOb3tBFR_e-zGofSBV8oWoMMw%253D%253D" target="_blank" title="https://www.google.com/url?sa=E&amp;q=https%3A%2F%2Fvertexaisearch.cloud.google.com%2Fgrounding-api-redirect%2FAUZIYQHyFXfMFoR2N52qXupW_4xSPkY5qwA30y31gOpp581kPsWsFArIFVaSvkvPsq9pr8RQxQvEWuVHKfx7NjnzfECysVTjxZ-j6CphwEq_ZDiXfnQTrKYTdE1pKN-65oLHCiLO5wOb3tBFR_e-zGofSBV8oWoMMw%3D%3D" ref="nofollow noopener noreferrer">4</a>][<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.google.com%2Furl%3Fsa%3DE%26q%3Dhttps%253A%252F%252Fvertexaisearch.cloud.google.com%252Fgrounding-api-redirect%252FAUZIYQEcnUvxl3_eYgtZf94US3BKguEIFiTBg_PgJCrg3qWvzmM-VIfClzWJqPrs0bO58DfV_D_Dq1F5zcCXhFrDhy2CvpybTdoVsYVvzizU3NXQ29QCpIbyZGry2nmzWzMcPxsBTTf5sY8%253D" target="_blank" title="https://www.google.com/url?sa=E&amp;q=https%3A%2F%2Fvertexaisearch.cloud.google.com%2Fgrounding-api-redirect%2FAUZIYQEcnUvxl3_eYgtZf94US3BKguEIFiTBg_PgJCrg3qWvzmM-VIfClzWJqPrs0bO58DfV_D_Dq1F5zcCXhFrDhy2CvpybTdoVsYVvzizU3NXQ29QCpIbyZGry2nmzWzMcPxsBTTf5sY8%3D" ref="nofollow noopener noreferrer">6</a>]</li>
<li>运行测试/命令。[<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.google.com%2Furl%3Fsa%3DE%26q%3Dhttps%253A%252F%252Fvertexaisearch.cloud.google.com%252Fgrounding-api-redirect%252FAUZIYQHyFXfMFoR2N52qXupW_4xSPkY5qwA30y31gOpp581kPsWsFArIFVaSvkvPsq9pr8RQxQvEWuVHKfx7NjnzfECysVTjxZ-j6CphwEq_ZDiXfnQTrKYTdE1pKN-65oLHCiLO5wOb3tBFR_e-zGofSBV8oWoMMw%253D%253D" target="_blank" title="https://www.google.com/url?sa=E&amp;q=https%3A%2F%2Fvertexaisearch.cloud.google.com%2Fgrounding-api-redirect%2FAUZIYQHyFXfMFoR2N52qXupW_4xSPkY5qwA30y31gOpp581kPsWsFArIFVaSvkvPsq9pr8RQxQvEWuVHKfx7NjnzfECysVTjxZ-j6CphwEq_ZDiXfnQTrKYTdE1pKN-65oLHCiLO5wOb3tBFR_e-zGofSBV8oWoMMw%3D%3D" ref="nofollow noopener noreferrer">4</a>][<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.google.com%2Furl%3Fsa%3DE%26q%3Dhttps%253A%252F%252Fvertexaisearch.cloud.google.com%252Fgrounding-api-redirect%252FAUZIYQEcnUvxl3_eYgtZf94US3BKguEIFiTBg_PgJCrg3qWvzmM-VIfClzWJqPrs0bO58DfV_D_Dq1F5zcCXhFrDhy2CvpybTdoVsYVvzizU3NXQ29QCpIbyZGry2nmzWzMcPxsBTTf5sY8%253D" target="_blank" title="https://www.google.com/url?sa=E&amp;q=https%3A%2F%2Fvertexaisearch.cloud.google.com%2Fgrounding-api-redirect%2FAUZIYQEcnUvxl3_eYgtZf94US3BKguEIFiTBg_PgJCrg3qWvzmM-VIfClzWJqPrs0bO58DfV_D_Dq1F5zcCXhFrDhy2CvpybTdoVsYVvzizU3NXQ29QCpIbyZGry2nmzWzMcPxsBTTf5sY8%3D" ref="nofollow noopener noreferrer">6</a>]</li>
<li>如果报错，它会读取错误信息。</li>
<li><strong>自动再次尝试修复</strong>，直到测试通过（Exit code 0）。</li>
</ol>
</li>
<li>
<p><strong>"Shipping Code" (交付代码)：</strong>  标题中的 "get Ralph working and shipping code" 指的是配置好这个自动化循环，让 AI 能够在你睡觉或做其他事时，不知疲倦地通过成百上千次试错，最终交付可运行的代码。</p>
</li>
</ul>
<p>它由Geoffrey Huntley创建，并在<a href="https://link.juejin.cn?target=https%3A%2F%2Fghuntley.com%2Fralph" target="_blank" title="https://ghuntley.com/ralph" ref="nofollow noopener noreferrer">他的原始帖子</a>中宣布。Ralph反复运行AmpCode（或你选择的其他AI代理），直到所有任务完成。</p>
<p>每次迭代都使用全新的上下文窗口（保持对话线程小而高效）。记忆通过git历史和文本文件持久化。</p>
<h2 data-id="heading-3">工作原理</h2>
<p>Ralph是一个bash循环，执行以下步骤：</p>
<ol>
<li>将提示传递给AI代理</li>
<li>代理从prd.json中选择下一个任务</li>
<li>代理实现该任务</li>
<li>代理运行类型检查和测试</li>
<li>如果通过，代理提交代码</li>
<li>代理标记任务完成</li>
<li>代理记录学习成果</li>
<li>循环重复直到所有任务完成</li>
</ol>
<p>记忆仅通过以下方式持久化：</p>
<ul>
<li>Git提交</li>
<li>progress.txt（学习成果）</li>
<li>prd.json（任务状态）</li>
</ul>
<h2 data-id="heading-4">文件结构</h2>
<pre><code class="hljs language-bash" lang="bash">scripts/ralph/
├── ralph.sh      <span class="hljs-comment"># 主脚本</span>
├── prompt.md     <span class="hljs-comment"># 每次迭代的指令</span>
├── prd.json      <span class="hljs-comment"># 任务列表</span>
└── progress.txt  <span class="hljs-comment"># 进度日志</span>
</code></pre>
<h2 data-id="heading-5">详细文件说明</h2>
<h3 data-id="heading-6">ralph.sh</h3>
<p>主循环脚本：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-built_in">set</span> -e

MAX_ITERATIONS=<span class="hljs-variable">${1:-10}</span>
SCRIPT_DIR=<span class="hljs-string">"<span class="hljs-subst">$(cd <span class="hljs-string">"<span class="hljs-subst">$(dirname 
  <span class="hljs-string">"<span class="hljs-variable">${BASH_SOURCE[0]}</span>"</span>)</span>"</span> &amp;&amp; pwd)</span>"</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"🚀 Starting Ralph"</span>

<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> $(<span class="hljs-built_in">seq</span> 1 <span class="hljs-variable">$MAX_ITERATIONS</span>); <span class="hljs-keyword">do</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"═══ Iteration <span class="hljs-variable">$i</span> ═══"</span>
  
  OUTPUT=$(<span class="hljs-built_in">cat</span> <span class="hljs-string">"<span class="hljs-variable">$SCRIPT_DIR</span>/prompt.md"</span> \
    | amp --dangerously-allow-all 2&gt;&amp;1 \
    | <span class="hljs-built_in">tee</span> /dev/stderr) || <span class="hljs-literal">true</span>
  
  <span class="hljs-keyword">if</span> <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$OUTPUT</span>"</span> | \
    grep -q <span class="hljs-string">"&lt;promise&gt;COMPLETE&lt;/promise&gt;"</span>
  <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"✅ Done!"</span>
    <span class="hljs-built_in">exit</span> 0
  <span class="hljs-keyword">fi</span>
  
  <span class="hljs-built_in">sleep</span> 2
<span class="hljs-keyword">done</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"⚠️ Max iterations reached"</span>
<span class="hljs-built_in">exit</span> 1
</code></pre>
<p>使其可执行：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">chmod</span> +x scripts/ralph/ralph.sh
</code></pre>
<p>支持的其他代理：</p>
<ul>
<li>Claude Code: <code>claude --dangerously-skip-permissions</code></li>
</ul>
<h3 data-id="heading-7">prompt.md</h3>
<p>每次迭代的指令：</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section"># Ralph Agent Instructions</span>

<span class="hljs-section">## 你的任务</span>

<span class="hljs-bullet">1.</span> 读取 <span class="hljs-code">`scripts/ralph/prd.json`</span>
<span class="hljs-bullet">2.</span> 读取 <span class="hljs-code">`scripts/ralph/progress.txt`</span>（先查看代码库模式）
<span class="hljs-bullet">3.</span> 检查你是否在正确的分支上
<span class="hljs-bullet">4.</span> 选择优先级最高且 <span class="hljs-code">`passes: false`</span> 的任务
<span class="hljs-bullet">5.</span> 实现那一个任务
<span class="hljs-bullet">6.</span> 运行类型检查和测试
<span class="hljs-bullet">7.</span> 使用学习成果更新AGENTS.md文件
<span class="hljs-bullet">8.</span> 提交：<span class="hljs-code">`feat: [ID] - [Title]`</span>
<span class="hljs-bullet">9.</span> 更新prd.json：<span class="hljs-code">`passes: true`</span>
<span class="hljs-bullet">10.</span> 将学习成果追加到progress.txt

<span class="hljs-section">## 进度格式</span>

追加到progress.txt：


<span class="hljs-section">## [日期] - [任务ID]</span>
<span class="hljs-bullet">-</span> 实现了什么
<span class="hljs-bullet">-</span> 更改了哪些文件
<span class="hljs-bullet">-</span> <span class="hljs-strong">**学习成果：**</span>
<span class="hljs-bullet">  -</span> 发现的模式
<span class="hljs-section">  - 遇到的问题
---</span>


<span class="hljs-section">## 代码库模式</span>

将可重用模式添加到progress.txt的顶部：


<span class="hljs-section">## Codebase Patterns</span>
<span class="hljs-bullet">-</span> 迁移：使用IF NOT EXISTS
<span class="hljs-bullet">-</span> React：useRef<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Timeout</span> | <span class="hljs-attr">null</span>&gt;</span></span>(null)


<span class="hljs-section">## 停止条件</span>

如果所有任务都通过，回复：

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">promise</span>&gt;</span></span>COMPLETE<span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">promise</span>&gt;</span></span>


否则正常结束。
</code></pre>
<h3 data-id="heading-8">prd.json</h3>
<p>任务列表：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"branchName"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ralph/feature"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"userStories"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"US-001"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"添加登录表单"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"acceptanceCriteria"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-string">"邮箱/密码字段"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-string">"验证邮箱格式"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-string">"类型检查通过"</span>
      <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"priority"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"passes"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"notes"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>关键字段：</p>
<ul>
<li><code>branchName</code> — 使用的分支</li>
<li><code>priority</code> — 数值越小优先级越高</li>
<li><code>passes</code> — 完成时设置为true</li>
</ul>
<h3 data-id="heading-9">progress.txt</h3>
<p>开始时包含上下文：</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section"># Ralph Progress Log</span>
Started: 2024-01-15

<span class="hljs-section">## Codebase Patterns</span>
<span class="hljs-bullet">-</span> 迁移：IF NOT EXISTS
<span class="hljs-bullet">-</span> 类型：从actions.ts导出

<span class="hljs-section">## Key Files</span>
<span class="hljs-bullet">-</span> db/schema.ts
<span class="hljs-section">- app/auth/actions.ts
---</span>
</code></pre>
<p>Ralph在每个任务后追加内容，模式在迭代中累积。</p>
<h2 data-id="heading-10">运行Ralph</h2>
<pre><code class="hljs language-bash" lang="bash">./scripts/ralph/ralph.sh 25
</code></pre>
<p>运行最多25次迭代。Ralph将：</p>
<ul>
<li>创建功能分支</li>
<li>逐个完成任务</li>
<li>每个任务完成后提交</li>
<li>当所有任务通过时停止</li>
</ul>
<h2 data-id="heading-11">成功的关键因素</h2>
<h3 data-id="heading-12">1. 小任务</h3>
<p>必须适合一个上下文窗口：</p>
<pre><code class="hljs language-shell" lang="shell">❌ 太大：
<span class="hljs-meta prompt_">&gt; </span><span class="bash"><span class="hljs-string">"构建整个认证系统"</span></span>
✅ 合适大小：
<span class="hljs-meta prompt_">&gt; </span><span class="bash"><span class="hljs-string">"添加登录表单"</span></span>
<span class="hljs-meta prompt_">&gt; </span><span class="bash"><span class="hljs-string">"添加邮箱验证"</span></span>
<span class="hljs-meta prompt_">&gt; </span><span class="bash"><span class="hljs-string">"添加认证服务器操作"</span></span>
</code></pre>
<h3 data-id="heading-13">2. 反馈循环</h3>
<p>Ralph需要快速反馈：</p>
<ul>
<li><code>npm run typecheck</code></li>
<li><code>npm test</code></li>
</ul>
<p>没有这些，错误的代码会不断累积。</p>
<h3 data-id="heading-14">3. 明确的标准</h3>
<pre><code class="hljs language-shell" lang="shell">❌ 模糊：
<span class="hljs-meta prompt_">&gt; </span><span class="bash"><span class="hljs-string">"用户可以登录"</span></span>
✅ 明确：
<span class="hljs-meta prompt_">&gt; </span><span class="bash">- 邮箱/密码字段</span>
<span class="hljs-meta prompt_">&gt; </span><span class="bash">- 验证邮箱格式</span>
<span class="hljs-meta prompt_">&gt; </span><span class="bash">- 失败时显示错误</span>
<span class="hljs-meta prompt_">&gt; </span><span class="bash">- 类型检查通过</span>
<span class="hljs-meta prompt_">&gt; </span><span class="bash">- 在localhost:<span class="hljs-variable">$PORT</span>/login验证（PORT默认为3000）</span>
</code></pre>
<h3 data-id="heading-15">4. 学习成果累积</h3>
<p>到第10个任务时，Ralph已经知道了任务1-9的模式。</p>
<p>学习成果的两个位置：</p>
<ol>
<li>progress.txt — Ralph迭代的会话记忆</li>
<li>AGENTS.md — 人类和未来代理的永久文档</li>
</ol>
<p>在提交之前，Ralph会更新已编辑文件所在目录的AGENTS.md文件（如果发现可重用模式、问题或约定）。</p>
<h3 data-id="heading-16">5. AGENTS.md更新</h3>
<p>当Ralph学到值得保留的东西时，会更新AGENTS.md：</p>
<pre><code class="hljs language-diff" lang="diff">✅ 好的添加：
<span class="hljs-deletion">- "修改X时，也要更新Y"</span>
<span class="hljs-deletion">- "这个模块使用模式Z"</span>
<span class="hljs-deletion">- "测试需要开发服务器运行"</span>
❌ 不要添加：
<span class="hljs-deletion">- 特定任务的细节</span>
<span class="hljs-deletion">- 临时笔记</span>
<span class="hljs-deletion">- 已在progress.txt中的信息</span>
</code></pre>
<h3 data-id="heading-17">6. 浏览器测试</h3>
<p>对于UI更改，使用<a href="https://link.juejin.cn?target=https%3A%2F%2Fx.com%2F%40sawyerhood" target="_blank" title="https://x.com/@sawyerhood" ref="nofollow noopener noreferrer">@sawyerhood</a>的<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FSawyerHood%2Fdev-browser" target="_blank" title="https://github.com/SawyerHood/dev-browser" ref="nofollow noopener noreferrer">dev-browser技能</a>。使用<code>Load the dev-browser skill</code>加载它，然后：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 启动浏览器服务器</span>
~/.config/amp/skills/dev-browser/server.sh &amp;
<span class="hljs-comment"># 等待"Ready"消息</span>

<span class="hljs-comment"># 使用 heredocs 编写脚本</span>
<span class="hljs-built_in">cd</span> ~/.config/amp/skills/dev-browser &amp;&amp; npx tsx &lt;&lt;<span class="hljs-string">'EOF'</span>
import { connect, waitForPageLoad } from <span class="hljs-string">"@/client.js"</span>;

const client = await connect();
const page = await client.page(<span class="hljs-string">"test"</span>);
await page.setViewportSize({ width: 1280, height: 900 });
const port = process.env.PORT || <span class="hljs-string">"3000"</span>;
await page.goto(`http://localhost:<span class="hljs-variable">${port}</span>/your-page`);
await waitForPageLoad(page);
await page.screenshot({ path: <span class="hljs-string">"tmp/screenshot.png"</span> });
await client.disconnect();
EOF
</code></pre>
<p>只有通过截图验证才算完成。</p>
<h2 data-id="heading-18">常见问题</h2>
<ul>
<li>
<p><strong>幂等迁移：</strong></p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">ADD</span> <span class="hljs-keyword">COLUMN</span> IF <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> email TEXT;
</code></pre>
</li>
<li>
<p><strong>交互式提示：</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">echo</span> -e <span class="hljs-string">"\n\n\n"</span> | npm run db:generate
</code></pre>
</li>
<li>
<p><strong>模式更改：</strong>
编辑模式后，检查：</p>
<ul>
<li>服务器操作</li>
<li>UI组件</li>
<li>API路由</li>
</ul>
</li>
<li>
<p><strong>修复相关文件是可以的：</strong>
如果类型检查需要其他更改，可以进行这些更改，这不算是范围蔓延。</p>
</li>
</ul>
<h2 data-id="heading-19">监控</h2>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 任务状态</span>
<span class="hljs-built_in">cat</span> scripts/ralph/prd.json | \
jq <span class="hljs-string">'.userStories[] | {id, passes}'</span>
<span class="hljs-comment"># 学习成果</span>
<span class="hljs-built_in">cat</span> scripts/ralph/progress.txt
<span class="hljs-comment"># 提交记录</span>
git <span class="hljs-built_in">log</span> --oneline -10
</code></pre>
<h2 data-id="heading-20">实际结果</h2>
<p>我们构建了一个评估系统：</p>
<ul>
<li>13个用户故事</li>
<li>约15次迭代</li>
<li>每次2-5分钟</li>
<li>总共约1小时</li>
</ul>
<p>学习成果会累积。到第10个任务时，Ralph已经了解了我们的模式。</p>
<h2 data-id="heading-21">不适合使用的场景</h2>
<ul>
<li>探索性工作</li>
<li>没有明确标准的重大重构</li>
<li>安全关键代码</li>
<li>需要人工审查的任何内容</li>
</ul>
<h2 data-id="heading-22">视频教程</h2>
<p>有关如何使用Ralph的精彩视频演练，请查看<a href="https://link.juejin.cn?target=https%3A%2F%2Fx.com%2F%40mattpocockuk" target="_blank" title="https://x.com/@mattpocockuk" ref="nofollow noopener noreferrer">@mattpocockuk</a>的视频...</p>
<blockquote>
<p>My Ralph Wiggum breakdown went viral. It's a keep-it-simple-stupid approach to AI coding that lets you ship while you sleep. So here's a full explanation, example code, and demo.</p>
</blockquote>
<p><em>15:51 视频时长</em></p>
<h2 data-id="heading-23">关于作者</h2>
<p>Ryan Carson - 父亲、CEO、创始人、开发者</p>
<p>关注他：<a href="https://link.juejin.cn?target=https%3A%2F%2Fx.com%2Fryancarson" target="_blank" title="https://x.com/ryancarson" ref="nofollow noopener noreferrer">@ryancarson</a></p>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[iOS应用（App）生命周期、视图控制器（UIViewController）生命周期和视图（UIView）生命周期]]></title>    <link>https://juejin.cn/post/7592127014188351488</link>    <guid>https://juejin.cn/post/7592127014188351488</guid>    <pubDate>2026-01-07T02:32:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592127014188351488" data-draft-id="7592176349712957478" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="iOS应用（App）生命周期、视图控制器（UIViewController）生命周期和视图（UIView）生命周期"/> <meta itemprop="keywords" content="iOS"/> <meta itemprop="datePublished" content="2026-01-07T02:32:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="茅根竹蔗水__"/> <meta itemprop="url" content="https://juejin.cn/user/1073569923886071"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            iOS应用（App）生命周期、视图控制器（UIViewController）生命周期和视图（UIView）生命周期
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1073569923886071/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    茅根竹蔗水__
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-07T02:32:03.000Z" title="Wed Jan 07 2026 02:32:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    7
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p><strong>清晰的理解它们能帮你更好地管理应用状态和资源。</strong></p>
</blockquote>
<h3 data-id="heading-0">一、iOS 应用（App）生命周期</h3>
<p>应用生命周期描述了 App 从启动到终止的整个过程，由<code>UIApplicationDelegate</code>（应用代理）来管理。</p>
<h4 data-id="heading-1">核心阶段与代理方法（按执行顺序）</h4>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">import</span> UIKit

<span class="hljs-keyword">@UIApplicationMain</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">AppDelegate</span>: <span class="hljs-title class_">UIResponder</span>, <span class="hljs-title class_">UIApplicationDelegate</span> {

    <span class="hljs-keyword">var</span> window: <span class="hljs-type">UIWindow</span>?

    <span class="hljs-comment">// 1. App启动完成（最核心的入口）</span>
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">application</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">application</span>: <span class="hljs-type">UIApplication</span>, <span class="hljs-params">didFinishLaunchingWithOptions</span> <span class="hljs-params">launchOptions</span>: [<span class="hljs-type">UIApplication</span>.<span class="hljs-params">LaunchOptionsKey</span>: <span class="hljs-keyword">Any</span>]<span class="hljs-operator">?</span>) -&gt; <span class="hljs-type">Bool</span> {

        <span class="hljs-built_in">print</span>(<span class="hljs-string">"应用启动完成 - didFinishLaunchingWithOptions"</span>)

        <span class="hljs-comment">// 通常在这里初始化根视图控制器、配置全局设置等</span>

        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>

    }


    <span class="hljs-comment">// 2. App即将进入前台（还未激活，可做界面刷新）</span>
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">applicationWillEnterForeground</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">application</span>: <span class="hljs-type">UIApplication</span>) {
    
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"即将进入前台 - applicationWillEnterForeground"</span>)

    }


    <span class="hljs-comment">// 3. App已进入前台并激活（用户可交互）</span>
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">applicationDidBecomeActive</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">application</span>: <span class="hljs-type">UIApplication</span>) {

        <span class="hljs-built_in">print</span>(<span class="hljs-string">"已激活 - applicationDidBecomeActive"</span>)

        <span class="hljs-comment">// 恢复定时器、重新开始播放音频、刷新数据等</span>

    }

    <span class="hljs-comment">// 4. App即将进入后台（用户按Home键/切换App）</span>
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">applicationWillResignActive</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">application</span>: <span class="hljs-type">UIApplication</span>) {

        <span class="hljs-built_in">print</span>(<span class="hljs-string">"即将失活 - applicationWillResignActive"</span>)

        <span class="hljs-comment">// 暂停定时器、保存临时数据、暂停音频播放等</span>

    }


    <span class="hljs-comment">// 5. App已进入后台</span>
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">applicationDidEnterBackground</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">application</span>: <span class="hljs-type">UIApplication</span>) {

        <span class="hljs-built_in">print</span>(<span class="hljs-string">"已进入后台 - applicationDidEnterBackground"</span>)

        <span class="hljs-comment">// 持久化数据、释放不必要的资源（有大约5秒时间，耗时操作需申请后台任务）</span>

    }

    <span class="hljs-comment">// 6. App即将终止（仅在后台时可能触发，如系统回收内存）</span>
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">applicationWillTerminate</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">application</span>: <span class="hljs-type">UIApplication</span>) {

        <span class="hljs-built_in">print</span>(<span class="hljs-string">"即将终止 - applicationWillTerminate"</span>)

        <span class="hljs-comment">// 最终的资源清理、数据保存</span>

    }

}
</code></pre>
<h4 data-id="heading-2">关键说明</h4>
<ul>
<li><strong>启动流程</strong>：用户点击 App 图标 → 系统加载可执行文件 → 调用<code>didFinishLaunchingWithOptions</code> → 显示界面 → 进入活跃状态。</li>
<li><strong>后台与前台切换</strong>：活跃 → 失活（<code>WillResignActive</code>）→ 后台（<code>DidEnterBackground</code>）→ 前台（<code>WillEnterForeground</code>）→ 活跃（<code>DidBecomeActive</code>）。</li>
<li><strong>终止</strong>：后台状态下系统回收内存，触发<code>applicationWillTerminate</code>（若 App 在前台，直接终止，不触发此方法）。</li>
</ul>
<h3 data-id="heading-3">二、UIViewController 生命周期</h3>
<p>视图控制器是管理 UIView 的核心，其生命周期围绕视图的创建、显示、隐藏、销毁展开，是 iOS 开发中最常接触的生命周期。</p>
<h4 data-id="heading-4">核心方法（按执行顺序）</h4>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">import</span> UIKit

<span class="hljs-keyword">class</span> <span class="hljs-title class_">ViewController</span>: <span class="hljs-title class_">UIViewController</span> {

    <span class="hljs-comment">// 1. 初始化（创建VC对象）</span>
    <span class="hljs-keyword">init?</span>(<span class="hljs-params">coder</span>: <span class="hljs-type">NSCoder</span>) {
        <span class="hljs-keyword">super</span>.<span class="hljs-keyword">init</span>(coder: coder)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"1. 初始化 - init"</span>)
        <span class="hljs-comment">// 初始化非UI相关的属性</span>
    }

    <span class="hljs-comment">// 2. 加载视图（首次访问view属性时触发）</span>
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">loadView</span>() {
        <span class="hljs-keyword">super</span>.loadView()
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"2. 加载视图 - loadView"</span>)
        <span class="hljs-comment">// 手动创建view（若不重写，系统会加载storyboard/xib的view）</span>
        <span class="hljs-keyword">self</span>.view <span class="hljs-operator">=</span> <span class="hljs-type">UIView</span>(frame: <span class="hljs-type">UIScreen</span>.main.bounds)
        <span class="hljs-keyword">self</span>.view.backgroundColor <span class="hljs-operator">=</span> .white
    }

    <span class="hljs-comment">// 3. 视图加载完成（view已创建完成）</span>
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">viewDidLoad</span>() {
        <span class="hljs-keyword">super</span>.viewDidLoad()
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"3. 视图加载完成 - viewDidLoad"</span>)
        <span class="hljs-comment">// 初始化UI控件、绑定数据、添加监听（只执行一次）</span>
    }

    <span class="hljs-comment">// 4. 视图即将布局子视图（view的bounds变化时触发，如旋转屏幕）</span>
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">viewWillLayoutSubviews</span>() {
        <span class="hljs-keyword">super</span>.viewWillLayoutSubviews()
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"4. 视图即将布局子视图 - viewWillLayoutSubviews"</span>)
        <span class="hljs-comment">// 调整控件布局（执行多次）</span>
    }

    <span class="hljs-comment">// 5. 视图已布局子视图</span>
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">viewDidLayoutSubviews</span>() {
        <span class="hljs-keyword">super</span>.viewDidLayoutSubviews()
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"5. 视图已布局子视图 - viewDidLayoutSubviews"</span>)
        <span class="hljs-comment">// 获取控件最终的frame（执行多次）</span>
    }

    <span class="hljs-comment">// 6. 视图即将显示在屏幕上（每次显示都触发，如push/pop后重新显示）</span>
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">viewWillAppear</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">animated</span>: <span class="hljs-type">Bool</span>) {
        <span class="hljs-keyword">super</span>.viewWillAppear(animated)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"6. 视图即将显示 - viewWillAppear"</span>)
        <span class="hljs-comment">// 刷新数据、开始动画、注册通知等</span>
    }

    <span class="hljs-comment">// 7. 视图已显示在屏幕上</span>
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">viewDidAppear</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">animated</span>: <span class="hljs-type">Bool</span>) {
        <span class="hljs-keyword">super</span>.viewDidAppear(animated)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"7. 视图已显示 - viewDidAppear"</span>)
        <span class="hljs-comment">// 启动定时器、请求网络数据、播放视频等</span>
    }

    <span class="hljs-comment">// 8. 视图即将从屏幕上消失</span>
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">viewWillDisappear</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">animated</span>: <span class="hljs-type">Bool</span>) {
        <span class="hljs-keyword">super</span>.viewWillDisappear(animated)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"8. 视图即将消失 - viewWillDisappear"</span>)
        <span class="hljs-comment">// 暂停动画、移除通知、保存数据等</span>
    }

    <span class="hljs-comment">// 9. 视图已从屏幕上消失</span>
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">viewDidDisappear</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">animated</span>: <span class="hljs-type">Bool</span>) {
        <span class="hljs-keyword">super</span>.viewDidDisappear(animated)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"9. 视图已消失 - viewDidDisappear"</span>)
        <span class="hljs-comment">// 释放不必要的资源（如图片缓存）</span>
    }

    <span class="hljs-comment">// 10. 内存警告（系统内存不足时触发）</span>
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">didReceiveMemoryWarning</span>() {
        <span class="hljs-keyword">super</span>.didReceiveMemoryWarning()
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"10. 内存警告 - didReceiveMemoryWarning"</span>)
        <span class="hljs-comment">// 释放缓存、非必要的视图等</span>
    }

    <span class="hljs-comment">// 11. 视图控制器销毁（deinit）</span>
    <span class="hljs-keyword">deinit</span> {
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"11. 视图控制器销毁 - deinit"</span>)
        <span class="hljs-comment">// 最终的资源释放（如移除监听、取消网络请求）</span>
    }
}
</code></pre>
<h4 data-id="heading-5">关键说明</h4>
<ul>
<li><strong>核心流程</strong>：初始化 → 加载视图 → 视图加载完成 → 布局子视图 → 即将显示 → 已显示 → 即将消失 → 已消失 → 销毁。</li>
<li><strong>viewDidLoad</strong>：只执行一次，适合做一次性初始化；<strong>viewWillAppear/viewDidAppear</strong>：每次显示都执行，适合刷新动态数据。</li>
<li><strong>内存警告</strong>：<code>didReceiveMemoryWarning</code>中需主动释放非必要资源，避免 App 被系统杀死。</li>
<li><strong>deinit</strong>：只有当 VC 的引用计数为 0 时才会触发，需确保无循环引用（如闭包未捕获 self 为 weak/unowned）。</li>
</ul>
<h3 data-id="heading-6">三、UIView 生命周期</h3>
<p>UIView 的生命周期依附于视图控制器，核心是 “创建 - 布局 - 绘制 - 销毁”，重点关注布局和绘制相关方法。</p>
<h4 data-id="heading-7">核心阶段与方法</h4>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">import</span> UIKit

<span class="hljs-keyword">class</span> <span class="hljs-title class_">CustomView</span>: <span class="hljs-title class_">UIView</span> {

    <span class="hljs-comment">// 1. 初始化（创建View）</span>
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">init</span>(<span class="hljs-params">frame</span>: <span class="hljs-type">CGRect</span>) {
        <span class="hljs-keyword">super</span>.<span class="hljs-keyword">init</span>(frame: frame)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"1. View初始化 - init(frame:)"</span>)
        <span class="hljs-comment">// 设置默认属性（如背景色、圆角）</span>
        <span class="hljs-keyword">self</span>.backgroundColor <span class="hljs-operator">=</span> .lightGray
    }

    <span class="hljs-keyword">required</span> <span class="hljs-keyword">init?</span>(<span class="hljs-params">coder</span>: <span class="hljs-type">NSCoder</span>) {
        <span class="hljs-keyword">super</span>.<span class="hljs-keyword">init</span>(coder: coder)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"1. View初始化 - init(coder:)"</span>)
    }

    <span class="hljs-comment">// 2. 准备布局（iOS 6+，替代autoresizingMask）</span>
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">prepareForLayout</span>() {
        <span class="hljs-keyword">super</span>.prepareForLayout()
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"2. 准备布局 - prepareForLayout"</span>)
        <span class="hljs-comment">// 布局前的准备工作（如设置约束优先级）</span>
    }

    <span class="hljs-comment">// 3. 布局子视图（bounds变化时触发，如frame、center修改）</span>
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">layoutSubviews</span>() {
        <span class="hljs-keyword">super</span>.layoutSubviews()
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"3. 布局子视图 - layoutSubviews"</span>)
        <span class="hljs-comment">// 手动调整子视图frame（若不用AutoLayout）</span>
        <span class="hljs-keyword">for</span> subview <span class="hljs-keyword">in</span> <span class="hljs-keyword">self</span>.subviews {
            subview.center <span class="hljs-operator">=</span> <span class="hljs-keyword">self</span>.center
        }
    }

    <span class="hljs-comment">// 4. 绘制内容（首次显示/setNeedsDisplay()触发）</span>
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">draw</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">rect</span>: <span class="hljs-type">CGRect</span>) {
        <span class="hljs-keyword">super</span>.draw(rect)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"4. 绘制内容 - draw(_:)"</span>)
        <span class="hljs-comment">// 手动绘制图形（如绘制线条、文字）</span>
        <span class="hljs-keyword">let</span> context <span class="hljs-operator">=</span> <span class="hljs-type">UIGraphicsGetCurrentContext</span>()
        context<span class="hljs-operator">?</span>.setStrokeColor(<span class="hljs-type">UIColor</span>.red.cgColor)
        context<span class="hljs-operator">?</span>.stroke(<span class="hljs-type">CGRect</span>(x: <span class="hljs-number">10</span>, y: <span class="hljs-number">10</span>, width: <span class="hljs-number">100</span>, height: <span class="hljs-number">100</span>))
    }

    <span class="hljs-comment">// 5. 即将添加到父视图</span>
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">willMove</span>(<span class="hljs-params">toSuperview</span> <span class="hljs-params">newSuperview</span>: <span class="hljs-type">UIView</span>?) {
        <span class="hljs-keyword">super</span>.willMove(toSuperview: newSuperview)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"5. 即将添加到父视图 - willMove(toSuperview:)"</span>)
        <span class="hljs-comment">// 父视图变化前的处理</span>
    }

    <span class="hljs-comment">// 6. 已添加到父视图</span>
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">didMoveToSuperview</span>() {
        <span class="hljs-keyword">super</span>.didMoveToSuperview()
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"6. 已添加到父视图 - didMoveToSuperview"</span>)
        <span class="hljs-comment">// 父视图变化后的处理（如根据父视图调整自身大小）</span>
    }

    <span class="hljs-comment">// 7. 即将添加到窗口</span>
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">willMove</span>(<span class="hljs-params">toWindow</span> <span class="hljs-params">newWindow</span>: <span class="hljs-type">UIWindow</span>?) {
        <span class="hljs-keyword">super</span>.willMove(toWindow: newWindow)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"7. 即将添加到窗口 - willMove(toWindow:)"</span>)
    }

    <span class="hljs-comment">// 8. 已添加到窗口</span>
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">didMoveToWindow</span>() {
        <span class="hljs-keyword">super</span>.didMoveToWindow()
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"8. 已添加到窗口 - didMoveToWindow"</span>)
        <span class="hljs-comment">// 只有添加到window后，View才会真正显示在屏幕上</span>
    }

    <span class="hljs-comment">// 9. 销毁（deinit）</span>
    <span class="hljs-keyword">deinit</span> {
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"9. View销毁 - deinit"</span>)
        <span class="hljs-comment">// 释放View相关资源（如移除子视图、取消动画）</span>
    }
}

</code></pre>
<h4 data-id="heading-8">关键说明</h4>
<ul>
<li><strong>layoutSubviews</strong>：最常用的方法，每次 View 的尺寸变化都会触发，适合手动调整子视图布局（若使用 AutoLayout，系统会自动处理，无需重写）。</li>
<li><strong>draw(_:)</strong> ：仅在需要手动绘制内容时重写，避免在其中做耗时操作（会影响渲染性能）；调用<code>setNeedsDisplay()</code>可触发重新绘制。</li>
<li><strong>Window 关联</strong>：View 只有添加到<code>UIWindow</code>（应用的主窗口）后，才会被渲染并显示在屏幕上；<code>didMoveToWindow</code>是 View 真正 “可见” 的标志。</li>
<li><strong>销毁</strong>：当 View 从父视图移除且无强引用时，<code>deinit</code>触发，需确保子视图也被正确释放。</li>
</ul>
<h3 data-id="heading-9">总结</h3>
<ol>
<li><strong>应用生命周期</strong>：全局层面，管理 App 从启动到终止的状态，核心是<code>UIApplicationDelegate</code>的代理方法，关注前台 / 后台切换和资源保存。</li>
<li><strong>视图控制器生命周期</strong>：页面层面，核心是<code>viewDidLoad</code>（一次性初始化）、<code>viewWillAppear</code>（每次显示刷新）、<code>deinit</code>（资源释放），是业务逻辑的主要载体。</li>
<li><strong>视图生命周期</strong>：控件层面，依附于 VC，核心是<code>layoutSubviews</code>（布局）和<code>draw(_:)</code>（绘制），关注控件尺寸调整和视觉渲染。</li>
</ol>
<p>三者的关联：App 启动后创建根 VC → VC 创建并加载 View → View 添加到 Window 显示 → App 进入前台活跃状态；App 进入后台时，VC 的 View 会被隐藏，资源可按需释放。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[面向Java程序员的思维链（CoT）提示词写法学习指南]]></title>    <link>https://juejin.cn/post/7592251792651534363</link>    <guid>https://juejin.cn/post/7592251792651534363</guid>    <pubDate>2026-01-07T03:07:45.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592251792651534363" data-draft-id="7592251792651468827" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="面向Java程序员的思维链（CoT）提示词写法学习指南"/> <meta itemprop="keywords" content="Java"/> <meta itemprop="datePublished" content="2026-01-07T03:07:45.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="帅气的你"/> <meta itemprop="url" content="https://juejin.cn/user/1626932940649534"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            面向Java程序员的思维链（CoT）提示词写法学习指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1626932940649534/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    帅气的你
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-07T03:07:45.000Z" title="Wed Jan 07 2026 03:07:45 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    8
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读40分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">面向Java程序员的思维链（CoT）提示词写法学习指南</h2>
<h3 data-id="heading-1">目录</h3>
<ol>
<li><a href="#1-%E6%80%9D%E7%BB%B4%E9%93%BEcot%E6%8F%90%E7%A4%BA%E8%AF%8D%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5%E8%AE%B2%E8%A7%A3" title="#1-%E6%80%9D%E7%BB%B4%E9%93%BEcot%E6%8F%90%E7%A4%BA%E8%AF%8D%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5%E8%AE%B2%E8%A7%A3">思维链（CoT）提示词基础概念讲解</a></li>
<li><a href="#2-java%E5%BC%80%E5%8F%91%E5%9C%BA%E6%99%AF%E4%B8%8Bcot%E6%8F%90%E7%A4%BA%E8%AF%8D%E7%9A%84%E5%85%B3%E9%94%AE%E6%9E%84%E6%88%90%E8%A6%81%E7%B4%A0%E6%8B%86%E8%A7%A3" title="#2-java%E5%BC%80%E5%8F%91%E5%9C%BA%E6%99%AF%E4%B8%8Bcot%E6%8F%90%E7%A4%BA%E8%AF%8D%E7%9A%84%E5%85%B3%E9%94%AE%E6%9E%84%E6%88%90%E8%A6%81%E7%B4%A0%E6%8B%86%E8%A7%A3">Java开发场景下CoT提示词的关键构成要素拆解</a></li>
<li><a href="#3-%E5%A4%8D%E6%9D%82java%E6%8A%80%E6%9C%AF%E9%9C%80%E6%B1%82%E6%8B%86%E8%A7%A3%E4%B8%BAai%E5%8F%AF%E7%90%86%E8%A7%A3%E6%AD%A5%E9%AA%A4%E7%9A%84%E5%AE%9E%E6%93%8D%E6%A1%88%E4%BE%8B" title="#3-%E5%A4%8D%E6%9D%82java%E6%8A%80%E6%9C%AF%E9%9C%80%E6%B1%82%E6%8B%86%E8%A7%A3%E4%B8%BAai%E5%8F%AF%E7%90%86%E8%A7%A3%E6%AD%A5%E9%AA%A4%E7%9A%84%E5%AE%9E%E6%93%8D%E6%A1%88%E4%BE%8B">复杂Java技术需求拆解为AI可理解步骤的实操案例</a></li>
<li><a href="#4-java%E5%BC%80%E5%8F%91%E4%BA%BA%E5%91%98%E4%BD%BF%E7%94%A8cot%E6%8F%90%E7%A4%BA%E8%AF%8D%E7%9A%84%E9%81%BF%E5%9D%91%E6%8C%87%E5%8D%97%E4%B8%8E%E4%BC%98%E5%8C%96%E6%8A%80%E5%B7%A7" title="#4-java%E5%BC%80%E5%8F%91%E4%BA%BA%E5%91%98%E4%BD%BF%E7%94%A8cot%E6%8F%90%E7%A4%BA%E8%AF%8D%E7%9A%84%E9%81%BF%E5%9D%91%E6%8C%87%E5%8D%97%E4%B8%8E%E4%BC%98%E5%8C%96%E6%8A%80%E5%B7%A7">Java开发人员使用CoT提示词的避坑指南与优化技巧</a></li>
<li><a href="#5-%E5%AE%9E%E6%88%98%E7%BB%83%E4%B9%A0%E4%BB%BB%E5%8A%A1%E8%AE%BE%E8%AE%A1" title="#5-%E5%AE%9E%E6%88%98%E7%BB%83%E4%B9%A0%E4%BB%BB%E5%8A%A1%E8%AE%BE%E8%AE%A1">实战练习任务设计</a></li>
</ol>
<hr/>
<h3 data-id="heading-2">1. 思维链（CoT）提示词基础概念讲解</h3>
<h4 data-id="heading-3">1.1 CoT提示词的核心定义</h4>
<p><strong>思维链（Chain of Thought，CoT）提示词</strong>是一种引导AI进行逐步推理的提示词编写方法。其核心思想是将复杂问题拆解为一系列逻辑连贯的中间步骤，让AI按照人类思考问题的方式，逐步推导出最终答案。</p>
<p>对于Java开发人员而言，CoT提示词的本质可以类比为<strong>代码逻辑流程</strong>：</p>
<ul>
<li><strong>传统提示词</strong>：类似于直接调用一个黑盒方法，只关注输入输出，不关心内部实现</li>
<li><strong>CoT提示词</strong>：类似于编写一个包含多个步骤的方法，每一步都有明确的逻辑和中间结果，最终组合成完整的解决方案</li>
</ul>
<p><strong>类比示例</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 传统提示词（黑盒调用）</span>
<span class="hljs-type">String</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> processComplexBusiness(data); <span class="hljs-comment">// AI直接给出结果，过程不透明</span>

<span class="hljs-comment">// CoT提示词（步骤化推理）</span>
<span class="hljs-comment">// 步骤1：数据校验</span>
<span class="hljs-keyword">if</span> (!validateInput(data)) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ValidationException</span>(<span class="hljs-string">"输入数据不合法"</span>);
}
<span class="hljs-comment">// 步骤2：业务逻辑处理</span>
<span class="hljs-type">BusinessResult</span> <span class="hljs-variable">businessResult</span> <span class="hljs-operator">=</span> executeBusinessLogic(data);
<span class="hljs-comment">// 步骤3：结果封装</span>
<span class="hljs-type">String</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> formatResult(businessResult);
</code></pre>
<h4 data-id="heading-4">1.2 CoT提示词在Java开发场景中的价值</h4>
<h5 data-id="heading-5">1.2.1 辅助解决复杂Java问题</h5>
<p><strong>场景1：多线程并发调试</strong></p>
<ul>
<li><strong>无CoT提示词</strong>：直接询问"如何解决Java多线程死锁问题？"</li>
<li><strong>有CoT提示词</strong>：
<ol>
<li>先分析死锁产生的条件（互斥资源、持有并等待、不可抢占、循环等待）</li>
<li>使用jstack或jvisualvm定位死锁线程</li>
<li>分析线程调用栈，找出资源竞争点</li>
<li>提供解决方案（避免嵌套锁、使用超时锁、调整锁顺序）</li>
</ol>
</li>
</ul>
<p><strong>场景2：框架源码分析</strong></p>
<ul>
<li><strong>无CoT提示词</strong>：询问"Spring Boot自动配置原理是什么？"</li>
<li><strong>有CoT提示词</strong>：
<ol>
<li>从@SpringBootApplication注解入手</li>
<li>分析@EnableAutoConfiguration的导入机制</li>
<li>追踪spring.factories文件的加载流程</li>
<li>理解条件注解（@ConditionalOnClass等）的匹配逻辑</li>
<li>总结自动配置的完整链路</li>
</ol>
</li>
</ul>
<h5 data-id="heading-6">1.2.2 生成结构化技术方案</h5>
<p><strong>场景：Spring Boot项目架构设计</strong></p>
<p><strong>CoT提示词示例</strong>：</p>
<pre><code class="hljs language-diff" lang="diff">请帮我设计一个Spring Boot微服务项目的架构方案，请按以下步骤思考：

步骤1：明确业务边界
<span class="hljs-deletion">- 识别核心业务模块（用户服务、订单服务、支付服务）</span>
<span class="hljs-deletion">- 确定服务间的依赖关系</span>

步骤2：技术选型
<span class="hljs-deletion">- Web框架：Spring Boot 3.x</span>
<span class="hljs-deletion">- 服务注册与发现：Nacos</span>
<span class="hljs-deletion">- 配置中心：Nacos Config</span>
<span class="hljs-deletion">- 网关：Spring Cloud Gateway</span>
<span class="hljs-deletion">- 数据库：MySQL 8.0 + Redis 7.0</span>
<span class="hljs-deletion">- 消息队列：RocketMQ</span>

步骤3：分层架构设计
<span class="hljs-deletion">- Controller层：RESTful API设计</span>
<span class="hljs-deletion">- Service层：业务逻辑封装</span>
<span class="hljs-deletion">- Repository层：数据访问抽象</span>
<span class="hljs-deletion">- 公共模块：统一响应格式、异常处理、工具类</span>

步骤4：非功能性需求
<span class="hljs-deletion">- 接口限流：使用Sentinel</span>
<span class="hljs-deletion">- 分布式事务：Seata</span>
<span class="hljs-deletion">- 日志追踪：SkyWalking</span>
<span class="hljs-deletion">- 监控告警：Prometheus + Grafana</span>

请按照以上步骤，输出完整的架构设计方案。
</code></pre>
<h5 data-id="heading-7">1.2.3 优化AI生成代码的准确性</h5>
<p><strong>场景：避免语法错误和设计模式问题</strong></p>
<p><strong>无CoT提示词</strong>：直接要求"写一个单例模式"</p>
<p><strong>有CoT提示词</strong>：</p>
<pre><code class="hljs language-diff" lang="diff">请实现一个线程安全的单例模式，请按以下步骤思考：

步骤1：选择实现方式
<span class="hljs-deletion">- 考虑场景：是否需要延迟加载？是否需要序列化支持？</span>
<span class="hljs-deletion">- 推荐：双重检查锁定（DCL）或枚举单例</span>

步骤2：实现核心逻辑
<span class="hljs-deletion">- 私有化构造函数</span>
<span class="hljs-deletion">- 提供静态获取实例方法</span>
<span class="hljs-deletion">- 添加volatile关键字保证可见性（如使用DCL）</span>

步骤3：考虑边界情况
<span class="hljs-deletion">- 反射攻击防护</span>
<span class="hljs-deletion">- 序列化/反序列化防护</span>
<span class="hljs-deletion">- 多线程环境下的安全性验证</span>

步骤4：编写单元测试
<span class="hljs-deletion">- 验证单例性</span>
<span class="hljs-deletion">- 验证线程安全性</span>

请按照以上步骤，输出完整的代码实现和测试用例。
</code></pre>
<hr/>
<h3 data-id="heading-8">2. Java开发场景下CoT提示词的关键构成要素拆解</h3>
<p>一个高质量的Java开发CoT提示词应包含以下四个核心模块：</p>
<h4 data-id="heading-9">2.1 模块1：需求边界定义</h4>
<p><strong>作用</strong>：明确问题的范围、约束条件和预期目标，避免AI生成范围偏差或不符合实际需求的代码。</p>
<p><strong>Java场景示例</strong>：实现基于Redis的Java缓存工具类</p>
<p><strong>无边界定义</strong>：</p>
<pre><code class="hljs">写一个Redis缓存工具类
</code></pre>
<p><strong>有边界定义的CoT提示词</strong>：</p>
<pre><code class="hljs language-diff" lang="diff">请实现一个基于Redis的Java缓存工具类，请先明确以下边界条件：

边界1：功能范围
<span class="hljs-deletion">- 支持String、Object类型的缓存读写</span>
<span class="hljs-deletion">- 支持设置过期时间（支持固定时间和相对时间）</span>
<span class="hljs-deletion">- 支持批量操作（批量读取、批量删除）</span>
<span class="hljs-deletion">- 不支持分布式锁功能（后续单独实现）</span>

边界2：异常处理要求
<span class="hljs-deletion">- Redis连接失败：抛出自定义CacheException，包含原始异常信息</span>
<span class="hljs-deletion">- 序列化失败：记录日志并返回null，不中断业务流程</span>
<span class="hljs-deletion">- 键值对不存在：返回null，不抛异常</span>

边界3：与Spring框架集成方式
<span class="hljs-deletion">- 使用Spring Data Redis作为底层客户端</span>
<span class="hljs-deletion">- 支持通过@Autowired注入使用</span>
<span class="hljs-deletion">- 配置类使用@Configuration，支持条件装配（@ConditionalOnClass(RedisTemplate.class)）</span>

边界4：性能要求
<span class="hljs-deletion">- 批量操作使用Pipeline减少网络往返</span>
<span class="hljs-deletion">- 对象序列化使用Jackson（避免Java原生序列化的性能问题）</span>

请按照以上边界条件，设计并实现该缓存工具类。
</code></pre>
<h4 data-id="heading-10">2.2 模块2：技术栈限定</h4>
<p><strong>作用</strong>：指定具体的技术版本和依赖，确保AI生成的代码符合当前项目技术栈，减少适配成本。</p>
<p><strong>Java场景示例</strong>：微服务接口开发</p>
<p><strong>无技术栈限定</strong>：</p>
<pre><code class="hljs">开发一个用户查询接口
</code></pre>
<p><strong>有技术栈限定的CoT提示词</strong>：</p>
<pre><code class="hljs language-diff" lang="diff">请开发一个用户查询接口，技术栈要求如下：

技术栈限定：
<span class="hljs-deletion">- Java版本：Java 17（使用record类型定义DTO）</span>
<span class="hljs-deletion">- Web框架：Spring Boot 3.2.0</span>
<span class="hljs-deletion">- 数据库：MySQL 8.0</span>
<span class="hljs-deletion">- ORM框架：MyBatis-Plus 3.5.3</span>
<span class="hljs-deletion">- 参数校验：Hibernate Validator 8.0.0</span>
<span class="hljs-deletion">- 响应格式：统一使用Result&lt;T&gt;封装（code、message、data字段）</span>
<span class="hljs-deletion">- 日志框架：SLF4J + Logback</span>

请按照以上技术栈，输出完整的接口代码（Controller、Service、Mapper、实体类）。
</code></pre>
<h4 data-id="heading-11">2.3 模块3：步骤化推理引导</h4>
<p><strong>作用</strong>：将复杂需求拆解为清晰的步骤序列，引导AI按照Java开发的标准流程输出代码。</p>
<p><strong>Java场景示例</strong>：开发Java接口并实现数据校验</p>
<p><strong>无步骤引导</strong>：</p>
<pre><code class="hljs">开发一个用户注册接口，需要数据校验
</code></pre>
<p><strong>有步骤引导的CoT提示词</strong>：</p>
<pre><code class="hljs language-markdown" lang="markdown">请开发一个用户注册接口并实现数据校验，请按以下步骤实现：

步骤1：定义接口请求参数实体类
<span class="hljs-bullet">-</span> 创建UserRegisterRequest类
<span class="hljs-bullet">-</span> 使用Hibernate Validator注解标注校验规则：
<span class="hljs-bullet">  *</span> @NotNull + @Size：用户名（3-20字符）
<span class="hljs-bullet">  *</span> @NotNull + @Email：邮箱格式校验
<span class="hljs-bullet">  *</span> @NotNull + @Pattern：手机号格式校验（11位数字）
<span class="hljs-bullet">  *</span> @NotNull + @Size(min=8)：密码长度校验

步骤2：编写接口Controller层
<span class="hljs-bullet">-</span> 使用@RestController + @RequestMapping
<span class="hljs-bullet">-</span> 方法参数使用@Valid注解触发校验
<span class="hljs-bullet">-</span> 方法参数使用@RequestBody接收JSON请求

步骤3：编写接口Service层逻辑
<span class="hljs-bullet">-</span> 实现用户注册业务逻辑
<span class="hljs-bullet">-</span> 检查用户名、邮箱、手机号是否已存在
<span class="hljs-bullet">-</span> 密码使用BCrypt加密存储
<span class="hljs-bullet">-</span> 返回用户ID

步骤4：全局异常处理校验失败场景
<span class="hljs-bullet">-</span> 创建@ControllerAdvice全局异常处理器
<span class="hljs-bullet">-</span> 捕获MethodArgumentNotValidException
<span class="hljs-bullet">-</span> 提取校验失败的字段和错误信息
<span class="hljs-bullet">-</span> 返回统一的错误响应格式（code=400，message包含具体校验错误）

步骤5：编写单元测试
<span class="hljs-bullet">-</span> 测试正常注册场景
<span class="hljs-bullet">-</span> 测试各种校验失败场景（用户名过短、邮箱格式错误等）

请按照以上步骤，输出完整的代码实现。
</code></pre>
<h4 data-id="heading-12">2.4 模块4：输出格式要求</h4>
<p><strong>作用</strong>：明确AI输出的格式和规范，确保生成的代码可直接复用，符合团队编码规范。</p>
<p><strong>Java场景示例</strong>：缓存工具类实现</p>
<p><strong>无输出格式要求</strong>：</p>
<pre><code class="hljs">实现一个缓存工具类
</code></pre>
<p><strong>有输出格式要求的CoT提示词</strong>：</p>
<pre><code class="hljs language-markdown" lang="markdown">请实现一个Redis缓存工具类，输出格式要求如下：

输出格式要求：
<span class="hljs-bullet">1.</span> 代码结构
<span class="hljs-bullet">   -</span> 完整的类代码（包含package、import、类注释）
<span class="hljs-bullet">   -</span> 关键方法需包含JavaDoc注释（@param、@return、@throws）
<span class="hljs-bullet">   -</span> 代码需符合阿里巴巴Java开发手册规范：
<span class="hljs-bullet">     *</span> 类名使用UpperCamelCase
<span class="hljs-bullet">     *</span> 方法名使用lowerCamelCase
<span class="hljs-bullet">     *</span> 常量使用UPPER<span class="hljs-emphasis">_SNAKE_</span>CASE
<span class="hljs-bullet">     *</span> 每行代码不超过120字符

<span class="hljs-bullet">2.</span> 关键步骤注释
<span class="hljs-bullet">   -</span> 每个核心方法内部需添加步骤注释，说明逻辑流程
<span class="hljs-bullet">   -</span> 复杂逻辑需解释设计思路（如为什么使用Pipeline）

<span class="hljs-bullet">3.</span> 测试用例
<span class="hljs-bullet">   -</span> 提供JUnit 5测试类
<span class="hljs-bullet">   -</span> 包含正常场景和异常场景的测试用例
<span class="hljs-bullet">   -</span> 测试类命名：CacheUtilTest

<span class="hljs-bullet">4.</span> 使用示例
<span class="hljs-bullet">   -</span> 提供Spring Boot配置类示例
<span class="hljs-bullet">   -</span> 提供Controller中使用缓存工具类的示例代码

请按照以上格式要求，输出完整的实现代码。
</code></pre>
<hr/>
<h3 data-id="heading-13">3. 复杂Java技术需求拆解为AI可理解步骤的实操案例</h3>
<h4 data-id="heading-14">案例1：实现分布式事务（Seata）在微服务中的集成</h4>
<h5 data-id="heading-15">第一步：明确需求核心痛点</h5>
<p><strong>核心痛点</strong>：</p>
<ul>
<li>微服务架构下，跨服务的数据一致性难以保证</li>
<li>部分服务执行成功、部分服务执行失败时，已成功的数据无法回滚</li>
<li>需要实现分布式事务的ACID特性（特别是原子性和一致性）</li>
</ul>
<p><strong>业务场景示例</strong>：</p>
<ul>
<li>订单服务创建订单</li>
<li>库存服务扣减库存</li>
<li>支付服务处理支付</li>
<li>任何一个服务失败，都需要回滚所有已执行的操作</li>
</ul>
<h5 data-id="heading-16">第二步：拆解技术实现子步骤</h5>
<p><strong>步骤拆解</strong>：</p>
<pre><code class="hljs language-markdown" lang="markdown">步骤1：引入Seata依赖（指定版本）
<span class="hljs-bullet">-</span> 在订单服务、库存服务、支付服务的pom.xml中添加Seata依赖
<span class="hljs-bullet">-</span> 使用Seata 1.7.1版本（与Spring Boot 3.x兼容）
<span class="hljs-bullet">-</span> 依赖包括：seata-spring-boot-starter、seata-all

步骤2：配置Seata事务组、注册中心地址
<span class="hljs-bullet">-</span> 在application.yml中配置：
<span class="hljs-bullet">  *</span> seata.application-id：应用ID
<span class="hljs-bullet">  *</span> seata.tx-service-group：事务组名称（需与Seata Server配置一致）
<span class="hljs-bullet">  *</span> seata.config.type：配置中心类型（nacos/file）
<span class="hljs-bullet">  *</span> seata.registry.type：注册中心类型（nacos/eureka）
<span class="hljs-bullet">  *</span> seata.registry.nacos.server-addr：Nacos地址

步骤3：编写业务服务（含@GlobalTransactional注解使用）
<span class="hljs-bullet">-</span> 在订单服务中创建订单方法上添加@GlobalTransactional注解
<span class="hljs-bullet">-</span> 调用库存服务和支付服务时，确保使用Feign或RestTemplate进行HTTP调用
<span class="hljs-bullet">-</span> 注意：@GlobalTransactional只能标注在发起事务的服务方法上

步骤4：配置数据源代理
<span class="hljs-bullet">-</span> 配置Seata的数据源代理，替换原有的DataSource
<span class="hljs-bullet">-</span> 使用SeataDataSourceBeanPostProcessor自动代理数据源
<span class="hljs-bullet">-</span> 注意：需排除Spring Boot的自动数据源配置，避免冲突

步骤5：测试事务回滚场景
<span class="hljs-bullet">-</span> 模拟库存服务抛出异常
<span class="hljs-bullet">-</span> 验证订单服务和支付服务的数据是否被回滚
<span class="hljs-bullet">-</span> 查看Seata Server的事务日志，确认事务状态
</code></pre>
<h5 data-id="heading-17">第三步：标注每个子步骤的技术关键点</h5>
<p><strong>技术关键点标注</strong>：</p>
<ul>
<li><strong>步骤1关键点</strong>：Seata版本需与Spring Boot版本匹配，Spring Boot 3.x需使用Seata 1.7.1+</li>
<li><strong>步骤2关键点</strong>：tx-service-group需在Seata Server的file.conf中配置对应的集群名称</li>
<li><strong>步骤3关键点</strong>：@GlobalTransactional注解需放在事务发起方，被调用方不需要添加</li>
<li><strong>步骤4关键点</strong>：数据源代理配置需注意与Spring Boot自动配置的兼容，避免数据源冲突；需配置undo_log表用于存储回滚日志</li>
<li><strong>步骤5关键点</strong>：测试时需确保Seata Server正常运行，且各服务的注册中心配置正确</li>
</ul>
<h5 data-id="heading-18">第四步：设计对应的CoT提示词</h5>
<p><strong>完整CoT提示词</strong>：</p>
<pre><code class="hljs language-diff" lang="diff">请帮我实现Seata分布式事务在Spring Boot微服务中的集成，请按以下步骤思考并实现：

【需求背景】
我需要在一个包含订单服务、库存服务、支付服务的微服务系统中，实现分布式事务。
当订单服务创建订单后，需要调用库存服务扣减库存，然后调用支付服务处理支付。
如果任何一个服务失败，都需要回滚所有已执行的操作。

【技术栈限定】
<span class="hljs-deletion">- Spring Boot 3.2.0</span>
<span class="hljs-deletion">- Java 17</span>
<span class="hljs-deletion">- Seata 1.7.1</span>
<span class="hljs-deletion">- Nacos 2.2.0（作为注册中心和配置中心）</span>
<span class="hljs-deletion">- MySQL 8.0</span>
<span class="hljs-deletion">- MyBatis-Plus 3.5.3</span>

【实现步骤】

步骤1：引入Seata依赖
<span class="hljs-deletion">- 在三个服务的pom.xml中添加Seata相关依赖</span>
<span class="hljs-deletion">- 指定Seata版本为1.7.1（确保与Spring Boot 3.x兼容）</span>
<span class="hljs-deletion">- 依赖包括：seata-spring-boot-starter、seata-all</span>

步骤2：配置Seata事务组和注册中心
<span class="hljs-deletion">- 在application.yml中配置Seata相关参数：</span>
  * seata.application-id：各服务的应用ID（order-service、inventory-service、payment-service）
  * seata.tx-service-group：事务组名称（my_test_tx_group）
  * seata.config.type：nacos
  * seata.config.nacos.server-addr：127.0.0.1:8848
  * seata.registry.type：nacos
  * seata.registry.nacos.server-addr：127.0.0.1:8848
<span class="hljs-deletion">- 注意：tx-service-group需与Seata Server的file.conf中配置的集群名称一致</span>

步骤3：编写业务服务代码
<span class="hljs-deletion">- 在订单服务的OrderService中创建createOrder方法</span>
<span class="hljs-deletion">- 方法上添加@GlobalTransactional(rollbackFor = Exception.class)注解</span>
<span class="hljs-deletion">- 方法内部依次调用：</span>
  1. 本地数据库插入订单记录
  2. 通过Feign调用库存服务扣减库存
  3. 通过Feign调用支付服务处理支付
<span class="hljs-deletion">- 注意：@GlobalTransactional只能标注在事务发起方（订单服务），被调用方不需要添加</span>

步骤4：配置数据源代理
<span class="hljs-deletion">- 创建SeataConfig配置类</span>
<span class="hljs-deletion">- 使用@Configuration注解</span>
<span class="hljs-deletion">- 配置SeataDataSourceBeanPostProcessor自动代理数据源</span>
<span class="hljs-deletion">- 排除Spring Boot的自动数据源配置（使用@SpringBootApplication(exclude = DataSourceAutoConfiguration.class)）</span>
<span class="hljs-deletion">- 在各服务的数据库中创建undo_log表（用于存储Seata的回滚日志）</span>

步骤5：测试事务回滚场景
<span class="hljs-deletion">- 编写测试用例，模拟库存服务抛出异常</span>
<span class="hljs-deletion">- 验证订单服务的数据是否被回滚（订单记录不应存在）</span>
<span class="hljs-deletion">- 查看Seata Server的控制台，确认事务状态为Rollbacked</span>

【输出要求】
1. 提供三个服务的完整配置代码（application.yml）
2. 提供订单服务的完整业务代码（Controller、Service、Mapper）
3. 提供SeataConfig配置类代码
4. 提供undo_log表的SQL脚本
5. 提供测试用例代码
6. 代码需符合阿里巴巴Java开发手册规范，包含必要的注释

请按照以上步骤，输出完整的实现方案。
</code></pre>
<h5 data-id="heading-19">第五步：对比"无CoT提示词"与"有CoT提示词"的AI输出差异</h5>
<p><strong>无CoT提示词</strong>：</p>
<pre><code class="hljs">请帮我集成Seata分布式事务
</code></pre>
<p><strong>AI输出特点</strong>：</p>
<ul>
<li>可能只给出部分配置代码，缺少关键步骤</li>
<li>没有说明@GlobalTransactional的使用位置</li>
<li>缺少数据源代理配置</li>
<li>没有提供测试用例</li>
<li>代码注释不完整</li>
</ul>
<p><strong>有CoT提示词</strong>：</p>
<ul>
<li>输出完整的三个服务的配置和代码</li>
<li>明确说明@GlobalTransactional的使用场景和注意事项</li>
<li>包含数据源代理配置和undo_log表创建脚本</li>
<li>提供完整的测试用例</li>
<li>代码包含详细注释和关键点说明</li>
<li>输出结构清晰，可直接按照步骤实施</li>
</ul>
<hr/>
<h4 data-id="heading-20">案例2：开发Java定时任务并实现动态启停与参数调整</h4>
<h5 data-id="heading-21">第一步：明确需求核心痛点</h5>
<p><strong>核心痛点</strong>：</p>
<ul>
<li>传统@Scheduled注解实现的定时任务无法动态启停</li>
<li>任务执行参数需要重启应用才能修改</li>
<li>需要支持多个定时任务的管理，每个任务可独立控制</li>
</ul>
<h5 data-id="heading-22">第二步：拆解技术实现子步骤</h5>
<p><strong>步骤拆解</strong>：</p>
<pre><code class="hljs language-diff" lang="diff">步骤1：设计定时任务管理接口
<span class="hljs-deletion">- 定义TaskScheduler接口，包含启动、停止、更新参数方法</span>
<span class="hljs-deletion">- 使用ThreadPoolTaskScheduler作为任务调度器</span>
<span class="hljs-deletion">- 使用ScheduledFuture保存任务句柄，用于后续停止任务</span>

步骤2：实现任务配置存储
<span class="hljs-deletion">- 创建TaskConfig实体类（任务名称、cron表达式、是否启用、任务参数）</span>
<span class="hljs-deletion">- 使用数据库存储任务配置（支持动态修改）</span>
<span class="hljs-deletion">- 提供TaskConfigService用于配置的CRUD操作</span>

步骤3：实现动态任务调度核心逻辑
<span class="hljs-deletion">- 创建DynamicTaskScheduler类，实现TaskScheduler接口</span>
<span class="hljs-deletion">- 实现startTask方法：根据配置创建ScheduledFuture并启动任务</span>
<span class="hljs-deletion">- 实现stopTask方法：通过ScheduledFuture取消任务</span>
<span class="hljs-deletion">- 实现updateTask方法：先停止旧任务，再启动新任务</span>

步骤4：实现任务配置变更监听
<span class="hljs-deletion">- 使用@EventListener监听配置变更事件</span>
<span class="hljs-deletion">- 当配置变更时，自动更新对应的定时任务</span>
<span class="hljs-deletion">- 支持任务的启用/禁用切换</span>

步骤5：提供管理接口
<span class="hljs-deletion">- 创建TaskManageController，提供RESTful API</span>
<span class="hljs-deletion">- 接口包括：启动任务、停止任务、更新任务配置、查询任务状态</span>
<span class="hljs-deletion">- 使用统一响应格式封装返回结果</span>
</code></pre>
<h5 data-id="heading-23">第三步：标注每个子步骤的技术关键点</h5>
<p><strong>技术关键点</strong>：</p>
<ul>
<li><strong>步骤1关键点</strong>：ThreadPoolTaskScheduler需配置线程池大小，避免任务过多导致线程耗尽</li>
<li><strong>步骤2关键点</strong>：任务参数使用JSON格式存储，方便扩展；需考虑配置的并发修改问题</li>
<li><strong>步骤3关键点</strong>：ScheduledFuture的cancel方法需传入true参数，确保正在执行的任务也能被中断</li>
<li><strong>步骤4关键点</strong>：配置变更监听需考虑事务提交时机，避免配置已更新但任务未更新的不一致状态</li>
<li><strong>步骤5关键点</strong>：管理接口需添加权限控制，避免未授权用户操作定时任务</li>
</ul>
<h5 data-id="heading-24">第四步：设计对应的CoT提示词</h5>
<p><strong>完整CoT提示词</strong>：</p>
<pre><code class="hljs language-markdown" lang="markdown">请帮我实现Java定时任务的动态启停与参数调整功能，请按以下步骤思考并实现：

【需求背景】
我需要实现一个定时任务管理系统，支持：
<span class="hljs-bullet">1.</span> 动态启动和停止定时任务（无需重启应用）
<span class="hljs-bullet">2.</span> 动态修改任务的执行参数和cron表达式
<span class="hljs-bullet">3.</span> 支持多个定时任务的独立管理
<span class="hljs-bullet">4.</span> 任务配置存储在数据库中，支持持久化

【技术栈限定】
<span class="hljs-bullet">-</span> Spring Boot 3.2.0
<span class="hljs-bullet">-</span> Java 17
<span class="hljs-bullet">-</span> MySQL 8.0
<span class="hljs-bullet">-</span> MyBatis-Plus 3.5.3
<span class="hljs-bullet">-</span> Spring Task（使用ThreadPoolTaskScheduler）

【实现步骤】

步骤1：设计定时任务管理接口
<span class="hljs-bullet">-</span> 创建TaskScheduler接口，定义以下方法：
<span class="hljs-bullet">  *</span> void startTask(String taskName)：启动指定任务
<span class="hljs-bullet">  *</span> void stopTask(String taskName)：停止指定任务
<span class="hljs-bullet">  *</span> void updateTask(String taskName, TaskConfig config)：更新任务配置
<span class="hljs-bullet">  *</span> TaskStatus getTaskStatus(String taskName)：获取任务状态
<span class="hljs-bullet">-</span> 使用ThreadPoolTaskScheduler作为底层调度器
<span class="hljs-bullet">-</span> 使用ConcurrentHashMap<span class="xml">&lt;String, ScheduledFuture&gt;</span>保存任务句柄，key为任务名称

步骤2：实现任务配置存储
<span class="hljs-bullet">-</span> 创建TaskConfig实体类，包含字段：
<span class="hljs-bullet">  *</span> taskName：任务名称（唯一）
<span class="hljs-bullet">  *</span> cronExpression：cron表达式
<span class="hljs-bullet">  *</span> enabled：是否启用
<span class="hljs-bullet">  *</span> taskParams：任务参数（JSON格式存储）
<span class="hljs-bullet">  *</span> description：任务描述
<span class="hljs-bullet">-</span> 创建task<span class="hljs-emphasis">_config表，使用MyBatis-Plus进行CRUD操作
- 创建TaskConfigService，提供配置的增删改查方法

步骤3：实现动态任务调度核心逻辑
- 创建DynamicTaskScheduler类，实现TaskScheduler接口
- 实现startTask方法：
  1. 从数据库查询任务配置
  2. 检查任务是否已存在，如存在则先停止
  3. 根据cron表达式创建ScheduledFuture
  4. 将ScheduledFuture保存到Map中
- 实现stopTask方法：
  1. 从Map中获取ScheduledFuture
  2. 调用cancel(true)取消任务（true表示中断正在执行的任务）
  3. 从Map中移除任务句柄
- 实现updateTask方法：
  1. 更新数据库中的任务配置
  2. 调用stopTask停止旧任务
  3. 调用startTask启动新任务

步骤4：实现任务配置变更监听
- 创建TaskConfigChangeEvent事件类
- 在TaskConfigService的更新方法中发布事件
- 创建TaskConfigChangeListener，使用@EventListener监听事件
- 监听器中调用DynamicTaskScheduler的updateTask方法更新任务

步骤5：提供管理接口
- 创建TaskManageController，提供以下RESTful API：
  * POST /api/task/start/{taskName}：启动任务
  * POST /api/task/stop/{taskName}：停止任务
  * PUT /api/task/{taskName}：更新任务配置
  * GET /api/task/{taskName}/status：查询任务状态
  * GET /api/task/list：查询所有任务列表
- 使用统一响应格式Result<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">T</span>&gt;</span></span>封装返回结果
- 添加参数校验和异常处理

【输出要求】
1. 提供完整的实体类、Service、Controller代码
2. 提供数据库表创建SQL脚本
3. 提供ThreadPoolTaskScheduler的配置类代码
4. 提供使用示例（如何定义一个可动态管理的定时任务）
5. 代码需包含详细注释，说明关键逻辑
6. 提供API测试用例（使用Postman或curl命令）

请按照以上步骤，输出完整的实现方案。
</span></code></pre>
<hr/>
<h4 data-id="heading-25">案例3：优化Java项目中MySQL慢查询（含SQL改写、索引设计）</h4>
<h5 data-id="heading-26">第一步：明确需求核心痛点</h5>
<p><strong>核心痛点</strong>：</p>
<ul>
<li>生产环境出现慢查询，影响系统性能</li>
<li>需要识别慢查询SQL，分析执行计划</li>
<li>通过SQL改写和索引优化提升查询性能</li>
</ul>
<h5 data-id="heading-27">第二步：拆解技术实现子步骤</h5>
<p><strong>步骤拆解</strong>：</p>
<pre><code class="hljs language-diff" lang="diff">步骤1：开启MySQL慢查询日志
<span class="hljs-deletion">- 配置slow_query_log=ON</span>
<span class="hljs-deletion">- 设置long_query_time阈值（如1秒）</span>
<span class="hljs-deletion">- 配置slow_query_log_file路径</span>

步骤2：分析慢查询SQL
<span class="hljs-deletion">- 使用mysqldumpslow工具分析慢查询日志</span>
<span class="hljs-deletion">- 识别高频慢查询SQL</span>
<span class="hljs-deletion">- 使用EXPLAIN分析SQL执行计划</span>

步骤3：SQL改写优化
<span class="hljs-deletion">- 避免SELECT *，只查询需要的字段</span>
<span class="hljs-deletion">- 使用JOIN替代子查询</span>
<span class="hljs-deletion">- 避免在WHERE子句中使用函数</span>
<span class="hljs-deletion">- 使用LIMIT限制返回结果集大小</span>

步骤4：索引设计优化
<span class="hljs-deletion">- 分析WHERE、ORDER BY、GROUP BY字段</span>
<span class="hljs-deletion">- 创建合适的索引（单列索引、复合索引）</span>
<span class="hljs-deletion">- 注意索引的选择性和覆盖索引的使用</span>
<span class="hljs-deletion">- 避免创建过多索引（影响写入性能）</span>

步骤5：验证优化效果
<span class="hljs-deletion">- 对比优化前后的执行时间</span>
<span class="hljs-deletion">- 使用EXPLAIN对比执行计划变化</span>
<span class="hljs-deletion">- 监控慢查询日志，确认慢查询数量减少</span>
</code></pre>
<h5 data-id="heading-28">第三步：标注每个子步骤的技术关键点</h5>
<p><strong>技术关键点</strong>：</p>
<ul>
<li><strong>步骤1关键点</strong>：生产环境开启慢查询日志需注意磁盘空间，定期清理日志文件</li>
<li><strong>步骤2关键点</strong>：EXPLAIN重点关注type字段（ALL最差，index最好）、key字段（是否使用索引）、rows字段（扫描行数）</li>
<li><strong>步骤3关键点</strong>：SQL改写需保证业务逻辑不变，建议先在测试环境验证</li>
<li><strong>步骤4关键点</strong>：复合索引遵循最左前缀原则；索引字段顺序需考虑查询频率和选择性</li>
<li><strong>步骤5关键点</strong>：优化后需持续监控，避免出现新的慢查询</li>
</ul>
<h5 data-id="heading-29">第四步：设计对应的CoT提示词</h5>
<p><strong>完整CoT提示词</strong>：</p>
<pre><code class="hljs language-sql" lang="sql">请帮我优化Java项目中的MySQL慢查询问题，请按以下步骤分析并优化：

【问题背景】
生产环境出现慢查询，影响系统性能。需要识别慢查询<span class="hljs-keyword">SQL</span>，通过<span class="hljs-keyword">SQL</span>改写和索引优化提升查询性能。

【当前环境】
<span class="hljs-operator">-</span> MySQL <span class="hljs-number">8.0</span>
<span class="hljs-operator">-</span> Spring Boot <span class="hljs-number">3.2</span><span class="hljs-number">.0</span>
<span class="hljs-operator">-</span> MyBatis<span class="hljs-operator">-</span>Plus <span class="hljs-number">3.5</span><span class="hljs-number">.3</span>
<span class="hljs-operator">-</span> 主要慢查询表：<span class="hljs-keyword">order</span>表（<span class="hljs-number">1000</span>万数据）、<span class="hljs-keyword">user</span>表（<span class="hljs-number">500</span>万数据）

【优化步骤】

步骤<span class="hljs-number">1</span>：开启MySQL慢查询日志
<span class="hljs-operator">-</span> 在MySQL配置文件中设置：
  <span class="hljs-operator">*</span> slow_query_log <span class="hljs-operator">=</span> <span class="hljs-keyword">ON</span>
  <span class="hljs-operator">*</span> long_query_time <span class="hljs-operator">=</span> <span class="hljs-number">1</span>（超过<span class="hljs-number">1</span>秒的查询记录为慢查询）
  <span class="hljs-operator">*</span> slow_query_log_file <span class="hljs-operator">=</span> <span class="hljs-operator">/</span>var<span class="hljs-operator">/</span>log<span class="hljs-operator">/</span>mysql<span class="hljs-operator">/</span>slow<span class="hljs-operator">-</span>query.log
<span class="hljs-operator">-</span> 提供开启慢查询日志的<span class="hljs-keyword">SQL</span>命令和配置文件示例

步骤<span class="hljs-number">2</span>：分析慢查询<span class="hljs-keyword">SQL</span>
<span class="hljs-operator">-</span> 使用mysqldumpslow工具分析慢查询日志：
  <span class="hljs-operator">*</span> mysqldumpslow <span class="hljs-operator">-</span>s t <span class="hljs-operator">-</span>t <span class="hljs-number">10</span> slow<span class="hljs-operator">-</span>query.log（按执行时间排序，显示前<span class="hljs-number">10</span>条）
<span class="hljs-operator">-</span> 识别高频慢查询<span class="hljs-keyword">SQL</span>，重点关注：
  <span class="hljs-operator">*</span> 执行次数最多的<span class="hljs-keyword">SQL</span>
  <span class="hljs-operator">*</span> 平均执行时间最长的<span class="hljs-keyword">SQL</span>
  <span class="hljs-operator">*</span> 总耗时最长的<span class="hljs-keyword">SQL</span>
<span class="hljs-operator">-</span> 对每个慢查询<span class="hljs-keyword">SQL</span>使用EXPLAIN分析执行计划：
  <span class="hljs-operator">*</span> 重点关注type字段（<span class="hljs-keyword">ALL</span>表示全表扫描，需优化）
  <span class="hljs-operator">*</span> 关注key字段（是否使用了索引）
  <span class="hljs-operator">*</span> 关注<span class="hljs-keyword">rows</span>字段（扫描的行数）

步骤<span class="hljs-number">3</span>：<span class="hljs-keyword">SQL</span>改写优化
针对以下常见慢查询场景，提供<span class="hljs-keyword">SQL</span>改写方案：
<span class="hljs-operator">-</span> 场景<span class="hljs-number">1</span>：<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">order</span> <span class="hljs-keyword">WHERE</span> user_id <span class="hljs-operator">=</span> ? <span class="hljs-keyword">AND</span> create_time <span class="hljs-operator">&gt;</span> ?
  <span class="hljs-operator">*</span> 改写：只查询需要的字段，避免全字段查询
<span class="hljs-operator">-</span> 场景<span class="hljs-number">2</span>：<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">order</span> <span class="hljs-keyword">WHERE</span> id <span class="hljs-keyword">IN</span> (<span class="hljs-keyword">SELECT</span> order_id <span class="hljs-keyword">FROM</span> order_item <span class="hljs-keyword">WHERE</span> product_id <span class="hljs-operator">=</span> ?)
  <span class="hljs-operator">*</span> 改写：使用<span class="hljs-keyword">JOIN</span>替代子查询
<span class="hljs-operator">-</span> 场景<span class="hljs-number">3</span>：<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">order</span> <span class="hljs-keyword">WHERE</span> <span class="hljs-type">DATE</span>(create_time) <span class="hljs-operator">=</span> <span class="hljs-string">'2024-01-01'</span>
  <span class="hljs-operator">*</span> 改写：避免在<span class="hljs-keyword">WHERE</span>子句中使用函数，改为范围查询
<span class="hljs-operator">-</span> 场景<span class="hljs-number">4</span>：<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">order</span> <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> create_time <span class="hljs-keyword">DESC</span> LIMIT <span class="hljs-number">10</span>
  <span class="hljs-operator">*</span> 改写：如果只需要前<span class="hljs-number">10</span>条，确保有索引支持排序

步骤<span class="hljs-number">4</span>：索引设计优化
针对<span class="hljs-keyword">order</span>表和<span class="hljs-keyword">user</span>表，设计合适的索引：
<span class="hljs-operator">-</span> <span class="hljs-keyword">order</span>表索引设计：
  <span class="hljs-operator">*</span> 主键索引：id（已存在）
  <span class="hljs-operator">*</span> 复合索引：(user_id, create_time) <span class="hljs-operator">-</span> 用于用户订单查询和排序
  <span class="hljs-operator">*</span> 单列索引：status <span class="hljs-operator">-</span> 用于订单状态筛选
  <span class="hljs-operator">*</span> 注意：避免创建过多索引，影响<span class="hljs-keyword">INSERT</span><span class="hljs-operator">/</span><span class="hljs-keyword">UPDATE</span>性能
<span class="hljs-operator">-</span> <span class="hljs-keyword">user</span>表索引设计：
  <span class="hljs-operator">*</span> 主键索引：id（已存在）
  <span class="hljs-operator">*</span> 唯一索引：email <span class="hljs-operator">-</span> 用于登录查询
  <span class="hljs-operator">*</span> 复合索引：(phone, status) <span class="hljs-operator">-</span> 用于手机号和状态联合查询
<span class="hljs-operator">-</span> 索引创建<span class="hljs-keyword">SQL</span>示例：
  <span class="hljs-operator">*</span> <span class="hljs-keyword">CREATE</span> INDEX idx_user_create_time <span class="hljs-keyword">ON</span> <span class="hljs-keyword">order</span>(user_id, create_time);
  <span class="hljs-operator">*</span> <span class="hljs-keyword">CREATE</span> INDEX idx_status <span class="hljs-keyword">ON</span> <span class="hljs-keyword">order</span>(status);

步骤<span class="hljs-number">5</span>：验证优化效果
<span class="hljs-operator">-</span> 对比优化前后的执行时间：
  <span class="hljs-operator">*</span> 使用<span class="hljs-keyword">SELECT</span> BENCHMARK(<span class="hljs-number">1000000</span>, <span class="hljs-keyword">SQL</span>)测试执行时间
  <span class="hljs-operator">*</span> 或使用EXPLAIN ANALYZE（MySQL <span class="hljs-number">8.0</span><span class="hljs-number">.18</span><span class="hljs-operator">+</span>）查看实际执行时间
<span class="hljs-operator">-</span> 使用EXPLAIN对比执行计划变化：
  <span class="hljs-operator">*</span> 优化前：type<span class="hljs-operator">=</span><span class="hljs-keyword">ALL</span>, <span class="hljs-keyword">rows</span><span class="hljs-operator">=</span><span class="hljs-number">10000000</span>
  <span class="hljs-operator">*</span> 优化后：type<span class="hljs-operator">=</span><span class="hljs-keyword">ref</span>, <span class="hljs-keyword">rows</span><span class="hljs-operator">=</span><span class="hljs-number">100</span>, key<span class="hljs-operator">=</span>idx_user_create_time
<span class="hljs-operator">-</span> 监控慢查询日志，确认慢查询数量减少

【输出要求】
<span class="hljs-number">1.</span> 提供MySQL慢查询日志配置示例（my.cnf或my.ini）
<span class="hljs-number">2.</span> 提供慢查询分析脚本（shell脚本或Python脚本）
<span class="hljs-number">3.</span> 提供至少<span class="hljs-number">3</span>个<span class="hljs-keyword">SQL</span>改写示例（改写前后的<span class="hljs-keyword">SQL</span>对比）
<span class="hljs-number">4.</span> 提供完整的索引设计<span class="hljs-keyword">SQL</span>脚本
<span class="hljs-number">5.</span> 提供索引设计说明文档（说明每个索引的设计理由）
<span class="hljs-number">6.</span> 提供优化效果验证方法（包括测试<span class="hljs-keyword">SQL</span>和预期结果）
<span class="hljs-number">7.</span> 提供Java代码层面的优化建议（如使用MyBatis<span class="hljs-operator">-</span>Plus的批量查询、分页查询优化）

请按照以上步骤，输出完整的优化方案。
</code></pre>
<hr/>
<h3 data-id="heading-30">4. Java开发人员使用CoT提示词的避坑指南与优化技巧</h3>
<h4 data-id="heading-31">4.1 常见问题及优化方案</h4>
<h5 data-id="heading-32">问题1：步骤拆解过于笼统</h5>
<p><strong>问题表现</strong>：</p>
<pre><code class="hljs">请开发一个Java缓存工具类
</code></pre>
<p><strong>问题分析</strong>：</p>
<ul>
<li>未拆解缓存更新策略、并发安全处理等关键步骤</li>
<li>AI可能输出简单粗糙的实现，缺少必要的功能</li>
<li>没有明确技术选型和异常处理要求</li>
</ul>
<p><strong>优化方案</strong>：</p>
<p><strong>优化后的CoT提示词</strong>：</p>
<pre><code class="hljs language-diff" lang="diff">请开发一个Java缓存工具类，请按以下步骤实现：

步骤1：定义缓存接口
<span class="hljs-deletion">- 定义Cache接口，包含get、put、delete、clear方法</span>
<span class="hljs-deletion">- 考虑泛型设计，支持不同类型的缓存值</span>

步骤2：实现核心缓存逻辑
<span class="hljs-deletion">- 使用ConcurrentHashMap作为底层存储（保证线程安全）</span>
<span class="hljs-deletion">- 实现基本的get、put、delete方法</span>
<span class="hljs-deletion">- 考虑缓存容量限制（LRU淘汰策略）</span>

步骤3：实现缓存过期机制
<span class="hljs-deletion">- 为每个缓存项添加过期时间字段</span>
<span class="hljs-deletion">- 实现定时清理过期缓存的机制（使用ScheduledExecutorService）</span>
<span class="hljs-deletion">- 在get方法中检查是否过期，过期则返回null并删除</span>

步骤4：处理并发安全
<span class="hljs-deletion">- 使用ConcurrentHashMap保证并发读写安全</span>
<span class="hljs-deletion">- 对于缓存更新操作，使用synchronized或ReentrantLock保证原子性</span>
<span class="hljs-deletion">- 考虑缓存穿透问题（对不存在的key也进行缓存，设置较短的过期时间）</span>

步骤5：编写单元测试
<span class="hljs-deletion">- 测试基本功能（get、put、delete）</span>
<span class="hljs-deletion">- 测试过期机制</span>
<span class="hljs-deletion">- 测试并发场景（使用CountDownLatch模拟多线程）</span>

请按照以上步骤，输出完整的代码实现。
</code></pre>
<p><strong>优化要点</strong>：</p>
<ul>
<li>按"定义接口→实现核心逻辑→处理异常→编写测试"的Java开发流程拆解步骤</li>
<li>每个步骤补充1-2个技术细节（如使用ConcurrentHashMap、LRU策略）</li>
<li>明确异常场景的处理方式（缓存穿透）</li>
</ul>
<hr/>
<h5 data-id="heading-33">问题2：未限定技术细节</h5>
<p><strong>问题表现</strong>：</p>
<pre><code class="hljs">请实现文件上传功能
</code></pre>
<p><strong>问题分析</strong>：</p>
<ul>
<li>未说明使用Java NIO还是传统IO流</li>
<li>未指定文件存储方式（本地存储、OSS、MinIO）</li>
<li>AI可能生成不符合项目技术选型的代码</li>
</ul>
<p><strong>优化方案</strong>：</p>
<p><strong>优化后的CoT提示词</strong>：</p>
<pre><code class="hljs language-markdown" lang="markdown">请实现文件上传功能，技术细节要求如下：

【技术栈限定】
<span class="hljs-bullet">-</span> 使用Spring Boot 3.2.0
<span class="hljs-bullet">-</span> 文件存储：本地文件系统（不使用OSS或MinIO）
<span class="hljs-bullet">-</span> 文件处理：使用Apache Commons FileUpload（不使用Java NIO）
<span class="hljs-bullet">-</span> 文件大小限制：单个文件最大10MB，总请求大小最大50MB
<span class="hljs-bullet">-</span> 支持的文件类型：jpg、png、pdf、doc、docx

【实现步骤】

步骤1：配置文件上传参数
<span class="hljs-bullet">-</span> 在application.yml中配置：
<span class="hljs-bullet">  *</span> spring.servlet.multipart.max-file-size: 10MB
<span class="hljs-bullet">  *</span> spring.servlet.multipart.max-request-size: 50MB
<span class="hljs-bullet">  *</span> spring.servlet.multipart.enabled: true

步骤2：实现文件上传Controller
<span class="hljs-bullet">-</span> 使用@PostMapping接收multipart/form-data请求
<span class="hljs-bullet">-</span> 使用@RequestParam("file") MultipartFile接收文件
<span class="hljs-bullet">-</span> 文件类型校验：检查文件扩展名是否在允许列表中
<span class="hljs-bullet">-</span> 文件大小校验：检查文件大小是否超过限制

步骤3：实现文件存储逻辑
<span class="hljs-bullet">-</span> 创建FileStorageService服务类
<span class="hljs-bullet">-</span> 生成唯一文件名（UUID + 原始文件扩展名）
<span class="hljs-bullet">-</span> 将文件保存到指定目录（如：/data/uploads/yyyy/MM/dd/）
<span class="hljs-bullet">-</span> 按日期创建子目录，避免单个目录文件过多

步骤4：实现文件信息记录
<span class="hljs-bullet">-</span> 创建FileInfo实体类（文件名、原始文件名、文件路径、文件大小、上传时间）
<span class="hljs-bullet">-</span> 将文件信息保存到数据库（用于后续文件管理和下载）

步骤5：异常处理
<span class="hljs-bullet">-</span> 文件大小超限：抛出FileSizeLimitExceededException
<span class="hljs-bullet">-</span> 文件类型不支持：抛出UnsupportedFileTypeException
<span class="hljs-bullet">-</span> 文件保存失败：抛出FileStorageException
<span class="hljs-bullet">-</span> 使用@ControllerAdvice统一处理异常，返回错误响应

请按照以上技术细节和步骤，输出完整的实现代码。
</code></pre>
<p><strong>优化要点</strong>：</p>
<ul>
<li>明确指定技术选型（本地存储、Commons FileUpload）</li>
<li>限定具体的技术参数（文件大小、支持类型）</li>
<li>说明每个步骤的技术实现细节</li>
</ul>
<hr/>
<h5 data-id="heading-34">问题3：忽略异常场景引导</h5>
<p><strong>问题表现</strong>：</p>
<pre><code class="hljs">请实现Redis缓存工具类
</code></pre>
<p><strong>问题分析</strong>：</p>
<ul>
<li>未要求AI考虑Redis连接超时、序列化失败等异常场景</li>
<li>生成的代码可能缺乏健壮性，生产环境容易出问题</li>
</ul>
<p><strong>优化方案</strong>：</p>
<p><strong>优化后的CoT提示词</strong>：</p>
<pre><code class="hljs language-markdown" lang="markdown">请实现Redis缓存工具类，请特别关注异常场景的处理：

【技术栈限定】
<span class="hljs-bullet">-</span> Spring Boot 3.2.0
<span class="hljs-bullet">-</span> Spring Data Redis
<span class="hljs-bullet">-</span> Jackson序列化

【实现步骤】

步骤1：实现基本缓存操作
<span class="hljs-bullet">-</span> 实现get、put、delete、exists方法
<span class="hljs-bullet">-</span> 使用RedisTemplate进行操作

步骤2：处理Redis连接异常场景
<span class="hljs-bullet">-</span> Redis连接超时：捕获RedisConnectionFailureException
<span class="hljs-bullet">  *</span> 记录错误日志（包含原始异常信息）
<span class="hljs-bullet">  *</span> 返回null或false，不中断业务流程
<span class="hljs-bullet">  *</span> 考虑实现降级策略（连接失败时使用本地缓存）
<span class="hljs-bullet">-</span> Redis命令执行失败：捕获RedisException
<span class="hljs-bullet">  *</span> 记录错误日志
<span class="hljs-bullet">  *</span> 根据异常类型决定是否重试（如网络超时可重试，命令错误不重试）

步骤3：处理序列化异常场景
<span class="hljs-bullet">-</span> 对象序列化失败：捕获JsonProcessingException
<span class="hljs-bullet">  *</span> 记录错误日志（包含序列化失败的key和对象类型）
<span class="hljs-bullet">  *</span> 返回null，不抛异常
<span class="hljs-bullet">  *</span> 考虑使用try-catch包裹序列化操作
<span class="hljs-bullet">-</span> 对象反序列化失败：捕获JsonMappingException
<span class="hljs-bullet">  *</span> 记录错误日志
<span class="hljs-bullet">  *</span> 返回null，并删除该key（避免下次再次反序列化失败）

步骤4：处理缓存穿透场景
<span class="hljs-bullet">-</span> 对于查询不存在的key，也进行缓存（缓存null值，设置较短过期时间）
<span class="hljs-bullet">-</span> 使用布隆过滤器（BloomFilter）预先判断key是否存在（可选）

步骤5：编写异常场景测试用例
<span class="hljs-bullet">-</span> 测试Redis连接断开场景
<span class="hljs-bullet">-</span> 测试序列化失败场景
<span class="hljs-bullet">-</span> 测试缓存穿透场景
<span class="hljs-bullet">-</span> 验证异常情况下系统不会崩溃

【输出要求】
<span class="hljs-bullet">-</span> 代码需包含完整的异常处理逻辑
<span class="hljs-bullet">-</span> 每个异常场景都需有对应的日志记录
<span class="hljs-bullet">-</span> 提供异常场景的测试用例
<span class="hljs-bullet">-</span> 说明异常处理的设计思路

请按照以上步骤，输出完整的实现代码。
</code></pre>
<p><strong>优化要点</strong>：</p>
<ul>
<li>明确列出需要处理的异常场景（连接超时、序列化失败等）</li>
<li>要求AI为每个异常场景提供处理方案</li>
<li>要求提供异常场景的测试用例</li>
</ul>
<hr/>
<h4 data-id="heading-35">4.2 通用优化技巧总结</h4>
<h5 data-id="heading-36">技巧1：使用"先分析后实现"的CoT结构</h5>
<p><strong>模板</strong>：</p>
<pre><code class="hljs language-diff" lang="diff">请帮我实现[功能描述]，请按以下步骤思考：

步骤1：需求分析
<span class="hljs-deletion">- 明确功能的核心目标</span>
<span class="hljs-deletion">- 识别关键的技术难点</span>
<span class="hljs-deletion">- 列出需要处理的边界情况</span>

步骤2：技术选型
<span class="hljs-deletion">- 选择合适的技术方案</span>
<span class="hljs-deletion">- 说明选型理由</span>
<span class="hljs-deletion">- 列出技术栈版本要求</span>

步骤3：详细设计
<span class="hljs-deletion">- 设计类结构和接口</span>
<span class="hljs-deletion">- 设计数据模型</span>
<span class="hljs-deletion">- 设计异常处理机制</span>

步骤4：编码实现
<span class="hljs-deletion">- 按照设计实现代码</span>
<span class="hljs-deletion">- 添加必要的注释</span>
<span class="hljs-deletion">- 遵循编码规范</span>

步骤5：测试验证
<span class="hljs-deletion">- 编写单元测试</span>
<span class="hljs-deletion">- 编写集成测试</span>
<span class="hljs-deletion">- 验证边界情况</span>

请按照以上步骤，输出完整的实现方案。
</code></pre>
<h5 data-id="heading-37">技巧2：使用"对比优化"的CoT结构</h5>
<p><strong>模板</strong>：</p>
<pre><code class="hljs language-diff" lang="diff">请帮我优化[现有功能]，请按以下步骤分析：

步骤1：现状分析
<span class="hljs-deletion">- 分析当前实现的优缺点</span>
<span class="hljs-deletion">- 识别性能瓶颈</span>
<span class="hljs-deletion">- 找出潜在问题</span>

步骤2：优化方案设计
<span class="hljs-deletion">- 设计优化方案</span>
<span class="hljs-deletion">- 对比优化前后的差异</span>
<span class="hljs-deletion">- 评估优化效果</span>

步骤3：实施优化
<span class="hljs-deletion">- 按照优化方案修改代码</span>
<span class="hljs-deletion">- 保持功能兼容性</span>
<span class="hljs-deletion">- 添加必要的注释</span>

步骤4：验证优化效果
<span class="hljs-deletion">- 对比优化前后的性能指标</span>
<span class="hljs-deletion">- 验证功能正确性</span>
<span class="hljs-deletion">- 确认无回归问题</span>

请按照以上步骤，输出优化方案和代码。
</code></pre>
<h5 data-id="heading-38">技巧3：使用"场景驱动"的CoT结构</h5>
<p><strong>模板</strong>：</p>
<pre><code class="hljs language-css" lang="css">请帮我实现<span class="hljs-selector-attr">[功能描述]</span>，请针对以下场景分别设计解决方案：

场景<span class="hljs-number">1</span>：<span class="hljs-selector-attr">[场景描述]</span>
- 需求特点：<span class="hljs-selector-attr">[特点说明]</span>
- 实现方案：<span class="hljs-selector-attr">[方案说明]</span>
- 关键技术点：<span class="hljs-selector-attr">[技术点说明]</span>

场景<span class="hljs-number">2</span>：<span class="hljs-selector-attr">[场景描述]</span>
- 需求特点：<span class="hljs-selector-attr">[特点说明]</span>
- 实现方案：<span class="hljs-selector-attr">[方案说明]</span>
- 关键技术点：<span class="hljs-selector-attr">[技术点说明]</span>

...

请针对每个场景，输出对应的实现代码和说明。
</code></pre>
<hr/>
<h3 data-id="heading-39">5. 实战练习任务设计</h3>
<h4 data-id="heading-40">5.1 练习任务</h4>
<p><strong>任务描述</strong>：</p>
<p>请按照本指南所学的方法，自行拆解以下复杂Java需求，并设计对应的CoT提示词：</p>
<p><strong>需求</strong>：开发一个基于RabbitMQ的Java消息队列生产者/消费者，实现消息可靠投递（含确认机制、死信队列）与延迟消息功能。</p>
<p><strong>要求</strong>：</p>
<ol>
<li>将需求拆解为5-7个清晰的步骤</li>
<li>每个步骤需包含技术细节说明</li>
<li>明确技术栈限定和输出格式要求</li>
<li>考虑异常场景的处理</li>
<li>设计完整的CoT提示词</li>
</ol>
<hr/>
<h4 data-id="heading-41">5.2 参考拆解思路</h4>
<h5 data-id="heading-42">第一步：明确需求核心痛点</h5>
<p><strong>核心痛点</strong>：</p>
<ul>
<li>消息在传输过程中可能丢失（网络故障、服务重启）</li>
<li>消费者处理消息失败后，消息需要重新投递或进入死信队列</li>
<li>需要支持延迟消息功能（如订单30分钟未支付自动取消）</li>
</ul>
<h5 data-id="heading-43">第二步：拆解技术实现子步骤</h5>
<p><strong>步骤拆解</strong>：</p>
<pre><code class="hljs language-markdown" lang="markdown">步骤1：引入RabbitMQ依赖和配置连接
<span class="hljs-bullet">-</span> 在pom.xml中添加spring-boot-starter-amqp依赖
<span class="hljs-bullet">-</span> 配置RabbitMQ连接信息（host、port、username、password、virtual-host）
<span class="hljs-bullet">-</span> 配置RabbitMQTemplate和ConnectionFactory

步骤2：实现消息可靠投递机制（生产者端）
<span class="hljs-bullet">-</span> 开启发布确认模式（publisher-confirm-type: correlated）
<span class="hljs-bullet">-</span> 实现ConfirmCallback回调，处理消息发送成功/失败的回调
<span class="hljs-bullet">-</span> 开启返回模式（publisher-returns: true），处理路由失败的消息
<span class="hljs-bullet">-</span> 实现ReturnCallback回调，处理路由失败的消息
<span class="hljs-bullet">-</span> 消息持久化：设置delivery-mode为2（持久化）

步骤3：实现消息确认机制（消费者端）
<span class="hljs-bullet">-</span> 设置手动确认模式（acknowledge-mode: manual）
<span class="hljs-bullet">-</span> 在消费者方法中使用Channel.basicAck确认消息
<span class="hljs-bullet">-</span> 实现消息处理失败时的拒绝机制（basicNack或basicReject）
<span class="hljs-bullet">-</span> 设置requeue参数，决定是否重新入队

步骤4：实现死信队列机制
<span class="hljs-bullet">-</span> 创建死信交换机（DLX）和死信队列（DLQ）
<span class="hljs-bullet">-</span> 在业务队列上绑定死信交换机，设置x-dead-letter-exchange参数
<span class="hljs-bullet">-</span> 配置消息进入死信队列的条件（消息被拒绝且不重新入队、消息过期、队列达到最大长度）
<span class="hljs-bullet">-</span> 创建死信队列的消费者，处理死信消息（记录日志、告警等）

步骤5：实现延迟消息功能
<span class="hljs-bullet">-</span> 方案1：使用RabbitMQ延迟消息插件（rabbitmq-delayed-message-exchange）
<span class="hljs-bullet">  *</span> 安装延迟消息插件
<span class="hljs-bullet">  *</span> 创建延迟交换机（类型为x-delayed-message）
<span class="hljs-bullet">  *</span> 发送消息时设置x-delay头部（延迟时间，单位毫秒）
<span class="hljs-bullet">-</span> 方案2：使用TTL+死信队列实现延迟消息
<span class="hljs-bullet">  *</span> 创建延迟队列，设置TTL
<span class="hljs-bullet">  *</span> 延迟队列的消息过期后进入死信队列（实际是目标队列）
<span class="hljs-bullet">  *</span> 消费者从目标队列消费消息

步骤6：实现消息生产者服务
<span class="hljs-bullet">-</span> 创建MessageProducerService服务类
<span class="hljs-bullet">-</span> 实现sendMessage方法，发送普通消息
<span class="hljs-bullet">-</span> 实现sendDelayedMessage方法，发送延迟消息
<span class="hljs-bullet">-</span> 实现sendReliableMessage方法，发送可靠消息（带确认回调）

步骤7：实现消息消费者服务
<span class="hljs-bullet">-</span> 创建MessageConsumerService服务类
<span class="hljs-bullet">-</span> 使用@RabbitListener注解监听队列
<span class="hljs-bullet">-</span> 实现消息处理逻辑，包含异常处理
<span class="hljs-bullet">-</span> 处理成功后调用basicAck确认，失败后调用basicNack拒绝
</code></pre>
<h5 data-id="heading-44">第三步：标注每个子步骤的技术关键点</h5>
<p><strong>技术关键点</strong>：</p>
<ul>
<li><strong>步骤1关键点</strong>：RabbitMQ版本需与Spring Boot版本匹配，Spring Boot 3.x需使用RabbitMQ 3.12+</li>
<li><strong>步骤2关键点</strong>：发布确认模式需在配置类中设置RabbitTemplate的ConfirmCallback和ReturnCallback</li>
<li><strong>步骤3关键点</strong>：手动确认模式下，必须调用basicAck，否则消息会一直留在队列中；异常情况下需调用basicNack并设置requeue=false，让消息进入死信队列</li>
<li><strong>步骤4关键点</strong>：死信队列的绑定需在队列声明时设置参数，不能后续修改</li>
<li><strong>步骤5关键点</strong>：延迟消息插件方案更简单直接，但需要安装插件；TTL方案无需插件，但实现较复杂</li>
<li><strong>步骤6关键点</strong>：消息持久化需同时设置delivery-mode和队列的durable属性</li>
<li><strong>步骤7关键点</strong>：消费者方法需捕获异常，避免异常导致消息丢失；建议使用try-catch包裹业务逻辑</li>
</ul>
<h5 data-id="heading-45">第四步：设计对应的CoT提示词</h5>
<p><strong>完整CoT提示词</strong>：</p>
<pre><code class="hljs language-markdown" lang="markdown">请帮我实现基于RabbitMQ的Java消息队列生产者/消费者，实现消息可靠投递和延迟消息功能，请按以下步骤思考并实现：

【需求背景】
我需要实现一个消息队列系统，要求：
<span class="hljs-bullet">1.</span> 消息可靠投递：确保消息不丢失，支持发送确认和消费确认
<span class="hljs-bullet">2.</span> 死信队列：处理失败的消息，避免消息丢失
<span class="hljs-bullet">3.</span> 延迟消息：支持延迟指定时间后投递消息（如订单30分钟未支付自动取消）

【技术栈限定】
<span class="hljs-bullet">-</span> Spring Boot 3.2.0
<span class="hljs-bullet">-</span> Java 17
<span class="hljs-bullet">-</span> RabbitMQ 3.12.0
<span class="hljs-bullet">-</span> Spring AMQP（spring-boot-starter-amqp）

【实现步骤】

步骤1：引入RabbitMQ依赖和配置连接
<span class="hljs-bullet">-</span> 在pom.xml中添加spring-boot-starter-amqp依赖
<span class="hljs-bullet">-</span> 在application.yml中配置RabbitMQ连接信息：
<span class="hljs-bullet">  *</span> spring.rabbitmq.host: 127.0.0.1
<span class="hljs-bullet">  *</span> spring.rabbitmq.port: 5672
<span class="hljs-bullet">  *</span> spring.rabbitmq.username: guest
<span class="hljs-bullet">  *</span> spring.rabbitmq.password: guest
<span class="hljs-bullet">  *</span> spring.rabbitmq.virtual-host: /
<span class="hljs-bullet">-</span> 配置RabbitMQTemplate和ConnectionFactory（使用自动配置即可）

步骤2：实现消息可靠投递机制（生产者端）
<span class="hljs-bullet">-</span> 在application.yml中开启发布确认和返回模式：
<span class="hljs-bullet">  *</span> spring.rabbitmq.publisher-confirm-type: correlated
<span class="hljs-bullet">  *</span> spring.rabbitmq.publisher-returns: true
<span class="hljs-bullet">-</span> 创建RabbitMQConfig配置类：
<span class="hljs-bullet">  *</span> 配置RabbitTemplate的ConfirmCallback，处理消息发送成功/失败的回调
<span class="hljs-bullet">  *</span> 配置RabbitTemplate的ReturnCallback，处理路由失败的消息
<span class="hljs-bullet">  *</span> 设置mandatory=true，确保路由失败的消息能触发ReturnCallback
<span class="hljs-bullet">-</span> 消息持久化设置：
<span class="hljs-bullet">  *</span> 在发送消息时设置MessageProperties的delivery-mode为2（持久化）
<span class="hljs-bullet">  *</span> 声明队列时设置durable=true

步骤3：实现消息确认机制（消费者端）
<span class="hljs-bullet">-</span> 在application.yml中设置手动确认模式：
<span class="hljs-bullet">  *</span> spring.rabbitmq.listener.simple.acknowledge-mode: manual
<span class="hljs-bullet">-</span> 在消费者方法中：
<span class="hljs-bullet">  *</span> 使用@RabbitListener注解监听队列
<span class="hljs-bullet">  *</span> 方法参数包含Channel和Message（或使用@Payload和@Header）
<span class="hljs-bullet">  *</span> 消息处理成功后调用channel.basicAck(deliveryTag, false)确认消息
<span class="hljs-bullet">  *</span> 消息处理失败时调用channel.basicNack(deliveryTag, false, false)拒绝消息（不重新入队，进入死信队列）

步骤4：实现死信队列机制
<span class="hljs-bullet">-</span> 创建死信交换机（DLX）和死信队列（DLQ）：
<span class="hljs-bullet">  *</span> 死信交换机名称：dlx.exchange
<span class="hljs-bullet">  *</span> 死信队列名称：dlq.queue
<span class="hljs-bullet">  *</span> 绑定关系：dlq.queue绑定到dlx.exchange，routing-key为dlq.routing.key
<span class="hljs-bullet">-</span> 在业务队列声明时设置死信参数：
<span class="hljs-bullet">  *</span> x-dead-letter-exchange: dlx.exchange
<span class="hljs-bullet">  *</span> x-dead-letter-routing-key: dlq.routing.key
<span class="hljs-bullet">-</span> 创建死信队列的消费者：
<span class="hljs-bullet">  *</span> 监听dlq.queue队列
<span class="hljs-bullet">  *</span> 处理死信消息（记录日志、发送告警、持久化到数据库等）

步骤5：实现延迟消息功能
<span class="hljs-bullet">-</span> 使用RabbitMQ延迟消息插件方案（推荐）：
<span class="hljs-bullet">  *</span> 安装rabbitmq-delayed-message-exchange插件
<span class="hljs-bullet">  *</span> 在RabbitMQConfig中声明延迟交换机（类型为x-delayed-message，arguments包含x-delayed-type: direct）
<span class="hljs-bullet">  *</span> 创建延迟队列，绑定到延迟交换机
<span class="hljs-bullet">  *</span> 发送消息时设置x-delay头部（延迟时间，单位毫秒）
<span class="hljs-bullet">-</span> 如果无法安装插件，使用TTL+死信队列方案：
<span class="hljs-bullet">  *</span> 创建延迟队列，设置TTL（通过队列参数x-message-ttl或消息属性expiration）
<span class="hljs-bullet">  *</span> 延迟队列绑定到死信交换机，设置x-dead-letter-exchange和x-dead-letter-routing-key指向目标队列
<span class="hljs-bullet">  *</span> 消息在延迟队列中过期后，自动进入目标队列

步骤6：实现消息生产者服务
<span class="hljs-bullet">-</span> 创建MessageProducerService服务类：
<span class="hljs-bullet">  *</span> 注入RabbitTemplate
<span class="hljs-bullet">  *</span> 实现sendMessage方法：发送普通消息到指定队列
<span class="hljs-bullet">  *</span> 实现sendDelayedMessage方法：发送延迟消息（设置x-delay头部）
<span class="hljs-bullet">  *</span> 实现sendReliableMessage方法：发送可靠消息（设置delivery-mode=2，持久化）
<span class="hljs-bullet">-</span> 消息发送方法需包含异常处理：
<span class="hljs-bullet">  *</span> 捕获AmqpException异常
<span class="hljs-bullet">  *</span> 记录错误日志
<span class="hljs-bullet">  *</span> 考虑实现重试机制（使用Spring Retry）

步骤7：实现消息消费者服务
<span class="hljs-bullet">-</span> 创建MessageConsumerService服务类：
<span class="hljs-bullet">  *</span> 使用@RabbitListener注解监听业务队列
<span class="hljs-bullet">  *</span> 方法参数：@Payload String message, Channel channel, @Header(AmqpHeaders.DELIVERY<span class="hljs-emphasis">_TAG) long deliveryTag
  * 实现消息处理逻辑，使用try-catch包裹：
    - 处理成功：调用channel.basicAck(deliveryTag, false)
    - 处理失败：调用channel.basicNack(deliveryTag, false, false)，让消息进入死信队列
  * 记录处理日志（成功和失败都要记录）

【异常场景处理】
1. RabbitMQ连接失败：
   - 捕获AmqpConnectException异常
   - 记录错误日志
   - 考虑实现连接重试机制

2. 消息发送失败：
   - 在ConfirmCallback中处理发送失败的回调
   - 记录失败消息内容，考虑持久化到数据库，后续重试

3. 消息消费异常：
   - 捕获业务异常，调用basicNack拒绝消息
   - 记录异常日志，包含消息内容和异常堆栈
   - 避免无限重试，设置最大重试次数

4. 死信队列消息处理：
   - 死信消息需持久化到数据库，便于后续分析和人工处理
   - 发送告警通知（邮件、短信等）

【输出要求】
1. 提供完整的配置文件（application.yml）
2. 提供RabbitMQConfig配置类代码（包含交换机、队列声明，ConfirmCallback、ReturnCallback配置）
3. 提供MessageProducerService服务类代码（包含所有发送方法）
4. 提供MessageConsumerService服务类代码（包含消费者方法和异常处理）
5. 提供死信队列消费者的代码
6. 提供数据库表设计（用于存储死信消息）
7. 提供使用示例（Controller中调用生产者服务发送消息）
8. 代码需符合阿里巴巴Java开发手册规范，包含详细注释
9. 提供测试用例（使用@SpringBootTest测试消息发送和消费）

请按照以上步骤，输出完整的实现方案。
</span></code></pre>
<hr/>
<h4 data-id="heading-46">5.3 自我检查清单</h4>
<p>完成CoT提示词设计后，请对照以下清单检查：</p>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> <strong>需求边界是否清晰</strong>：是否明确了功能范围、技术约束、异常处理要求？</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> <strong>技术栈是否限定</strong>：是否指定了具体的版本号和依赖？</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> <strong>步骤是否细化</strong>：每个步骤是否包含具体的技术实现细节？</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> <strong>关键点是否标注</strong>：是否说明了每个步骤的技术关键点和注意事项？</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> <strong>异常场景是否考虑</strong>：是否列出了需要处理的异常场景和处理方案？</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> <strong>输出格式是否明确</strong>：是否要求了代码格式、注释规范、测试用例等？</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> <strong>实用性是否足够</strong>：生成的提示词是否可以直接用于AI交互，解决实际问题？</li>
</ul>
<hr/>
<h3 data-id="heading-47">总结</h3>
<p>通过本指南的学习，Java开发人员应掌握：</p>
<ol>
<li><strong>CoT提示词的核心概念</strong>：理解CoT提示词的本质是步骤化推理，类似于代码逻辑流程</li>
<li><strong>CoT提示词的构成要素</strong>：掌握需求边界定义、技术栈限定、步骤化推理引导、输出格式要求四个核心模块</li>
<li><strong>复杂需求的拆解方法</strong>：学会将复杂Java技术需求拆解为AI可理解的步骤序列</li>
<li><strong>避坑技巧</strong>：了解常见问题（步骤过于笼统、未限定技术细节、忽略异常场景）及优化方案</li>
<li><strong>实战应用能力</strong>：能够独立设计高质量的CoT提示词，解决实际开发问题</li>
</ol>
<p><strong>下一步行动建议</strong>：</p>
<ul>
<li>在实际工作中尝试使用CoT提示词解决技术问题</li>
<li>根据实际效果不断优化和调整提示词结构</li>
<li>积累不同场景下的CoT提示词模板，形成个人知识库</li>
<li>与团队成员分享CoT提示词的使用经验，共同提升AI辅助开发的效率</li>
</ul>
<hr/>
<p><strong>附录：常用CoT提示词模板</strong></p>
<h4 data-id="heading-48">模板1：功能开发类</h4>
<pre><code class="hljs language-css" lang="css">请帮我实现<span class="hljs-selector-attr">[功能描述]</span>，请按以下步骤思考并实现：

【需求背景】
<span class="hljs-selector-attr">[详细描述需求背景和业务场景]</span>

【技术栈限定】
- <span class="hljs-selector-attr">[技术1]</span>：<span class="hljs-selector-attr">[版本号]</span>
- <span class="hljs-selector-attr">[技术2]</span>：<span class="hljs-selector-attr">[版本号]</span>
- ...

【实现步骤】
步骤<span class="hljs-number">1</span>：<span class="hljs-selector-attr">[步骤描述]</span>
- <span class="hljs-selector-attr">[技术细节1]</span>
- <span class="hljs-selector-attr">[技术细节2]</span>

步骤<span class="hljs-number">2</span>：<span class="hljs-selector-attr">[步骤描述]</span>
- <span class="hljs-selector-attr">[技术细节1]</span>
- <span class="hljs-selector-attr">[技术细节2]</span>

...

【异常场景处理】
<span class="hljs-number">1</span>. <span class="hljs-selector-attr">[异常场景1]</span>：<span class="hljs-selector-attr">[处理方案]</span>
<span class="hljs-number">2</span>. <span class="hljs-selector-attr">[异常场景2]</span>：<span class="hljs-selector-attr">[处理方案]</span>

【输出要求】
<span class="hljs-number">1</span>. <span class="hljs-selector-attr">[要求1]</span>
<span class="hljs-number">2</span>. <span class="hljs-selector-attr">[要求2]</span>
...

请按照以上步骤，输出完整的实现方案。
</code></pre>
<h4 data-id="heading-49">模板2：问题优化类</h4>
<pre><code class="hljs language-css" lang="css">请帮我优化<span class="hljs-selector-attr">[现有功能/问题]</span>，请按以下步骤分析并优化：

【问题背景】
<span class="hljs-selector-attr">[描述当前存在的问题和影响]</span>

【现状分析】
- <span class="hljs-selector-attr">[现状1]</span>
- <span class="hljs-selector-attr">[现状2]</span>

【优化目标】
- <span class="hljs-selector-attr">[目标1]</span>
- <span class="hljs-selector-attr">[目标2]</span>

【优化步骤】
步骤<span class="hljs-number">1</span>：<span class="hljs-selector-attr">[步骤描述]</span>
- <span class="hljs-selector-attr">[优化方案]</span>
- <span class="hljs-selector-attr">[关键技术点]</span>

步骤<span class="hljs-number">2</span>：<span class="hljs-selector-attr">[步骤描述]</span>
- <span class="hljs-selector-attr">[优化方案]</span>
- <span class="hljs-selector-attr">[关键技术点]</span>

...

【验证方法】
- <span class="hljs-selector-attr">[验证方法1]</span>
- <span class="hljs-selector-attr">[验证方法2]</span>

【输出要求】
<span class="hljs-number">1</span>. <span class="hljs-selector-attr">[要求1]</span>
<span class="hljs-number">2</span>. <span class="hljs-selector-attr">[要求2]</span>
...

请按照以上步骤，输出优化方案和代码。
</code></pre>
<hr/>
<p><em>本文档持续更新中，欢迎反馈和改进建议。</em></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[[深度学习]LSTM模型的构建模块(如何添加层)]]></title>    <link>https://juejin.cn/post/7592134330312425515</link>    <guid>https://juejin.cn/post/7592134330312425515</guid>    <pubDate>2026-01-07T03:15:47.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592134330312425515" data-draft-id="7592133956733747241" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="[深度学习]LSTM模型的构建模块(如何添加层)"/> <meta itemprop="keywords" content="深度学习"/> <meta itemprop="datePublished" content="2026-01-07T03:15:47.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="import_random"/> <meta itemprop="url" content="https://juejin.cn/user/2013961033882312"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            [深度学习]LSTM模型的构建模块(如何添加层)
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2013961033882312/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    import_random
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-07T03:15:47.000Z" title="Wed Jan 07 2026 03:15:47 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    8
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">问题:我想使用lstm模型架构, 但是我不知道这个模型中有哪些模块, 比如我应该在神经网络中添加什么层?这个层是起到了什么作用?我应该在什么情况下添加什么层</h2>
<p>LSTM（长短期记忆网络）是一种特殊的循环神经网络（RNN），用于处理序列数据。它通过引入<code>门控机制</code>来解决传统RNN在<code>长序列训练中</code>可能出现的<code>梯度消失或爆炸</code>问题。下面我将详细介绍LSTM模型中的关键模块，以及如何构建一个LSTM网络。</p>
<h3 data-id="heading-1">LSTM模型中的关键模块</h3>
<ol>
<li>
<p><strong>LSTM单元（LSTM Cell）</strong> ：这是LSTM的核心，每个LSTM单元包含以下部分：</p>
<ul>
<li><strong>遗忘门（Forget Gate）</strong> ：决定从细胞状态中丢弃哪些信息。</li>
<li><strong>输入门（Input Gate）</strong> ：决定哪些新信息被存储在细胞状态中。</li>
<li><strong>输出门（Output Gate）</strong> ：基于细胞状态，决定输出什么信息。</li>
</ul>
<p>每个门都包含一个sigmoid激活函数，输出在0到1之间，表示信息的通过比例。此外，还有一个tanh激活函数用于生成新的候选值。</p>
</li>
<li>
<p><strong>循环层（Recurrent Layer）</strong> ：LSTM单元按照时间步展开，形成循环层，使得网络能够处理序列数据。</p>
</li>
</ol>
<h3 data-id="heading-2">构建LSTM网络时通常添加的层</h3>
<p>在构建LSTM模型时，除了LSTM层本身，我们通常还会添加其他类型的层。</p>
<p>以下是一个典型的LSTM网络结构：</p>
<ol>
<li>
<p><strong>嵌入层（Embedding Layer，可选）</strong> ：当处理<code>文本数据</code>时，通常首先将单词索引转换为密集向量表示,也就是embedding表示(稠密,低维的向量)。嵌入层可以学习到单词之间的语义关系。</p>
<ul>
<li>作用：将离散的符号（如单词）映射到连续的向量空间。</li>
<li>使用情况：处理文本分类、语言模型等任务时，如果输入是整数序列（例如单词索引），则添加嵌入层。</li>
</ul>
</li>
<li>
<p><strong>LSTM层（LSTM Layer）</strong> ：这是处理序列数据的主要层。</p>
<ul>
<li>作用：从输入序列中提取特征，并保持时间步之间的状态信息。</li>
<li>参数：通常需要指定隐藏状态的大小（即LSTM单元的数量）。</li>
<li>使用情况：处理任何序列数据，如时间序列预测、自然语言处理等。</li>
</ul>
</li>
<li>
<p><strong>Dropout层（可选）</strong> ：为了防止过拟合，可以在LSTM层<code>之后</code>添加Dropout层。</p>
<ul>
<li>作用：在训练过程中随机丢弃一部分神经元，以减少对特定神经元的依赖，提高泛化能力。</li>
<li>使用情况：当模型出现过拟合时，可以添加Dropout层。</li>
</ul>
</li>
<li>
<p><strong>重复LSTM层（可选）</strong> ：可以堆叠多个LSTM层，<code>以增加模型的复杂度。</code></p>
<ul>
<li>作用：深层LSTM可以学习更复杂的序列模式。</li>
<li>使用情况：当问题比较复杂，单层LSTM不足以捕捉模式时。</li>
</ul>
</li>
<li>
<p><strong>全连接层（Dense Layer）</strong> ：通常用于最终的输出。</p>
<ul>
<li>作用：将LSTM层的输出映射到所需的输出维度，例如<code>分类任务</code>中，使用<code>softmax激活函数</code>输出每个类别的概率。</li>
<li>使用情况：几乎所有的LSTM网络在最后都会添加全连接层，用于分类或回归。</li>
</ul>
</li>
</ol>
<h3 data-id="heading-3">示例代码（使用Keras）</h3>
<p>下面是一个简单的LSTM模型示例，用于文本分类：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> tensorflow.keras.models <span class="hljs-keyword">import</span> Sequential  <span class="hljs-comment"># 序列模型</span>
<span class="hljs-keyword">from</span> tensorflow.keras.layers <span class="hljs-keyword">import</span> Embedding, LSTM, Dense, Dropout

<span class="hljs-comment"># 初始化一个空的序列模型</span>
model = Sequential()

<span class="hljs-comment"># 嵌入层，假设词汇表大小为10000，嵌入维度为128，输入序列长度为100</span>
model.add(Embedding(input_dim=<span class="hljs-number">10000</span>, 
                    output_dim=<span class="hljs-number">128</span>, 
                    input_length=<span class="hljs-number">100</span>))


<span class="hljs-comment"># 第一层LSTM，返回整个序列的输出，以便传递给下一层</span>
model.add(LSTM(units=<span class="hljs-number">64</span>, return_sequences=<span class="hljs-literal">True</span>))


<span class="hljs-comment"># 可以添加Dropout</span>
model.add(Dropout(<span class="hljs-number">0.5</span>))

<span class="hljs-comment"># 第二层LSTM，只返回最后一个时间步的输出</span>
model.add(LSTM(units=<span class="hljs-number">64</span>))

<span class="hljs-comment"># 又加了一层dropout层, 防止过拟合</span>
model.add(Dropout(<span class="hljs-number">0.5</span>))

<span class="hljs-comment"># 全连接层，假设是二分类问题</span>
model.add(Dense(units=<span class="hljs-number">1</span>, activation=<span class="hljs-string">'sigmoid'</span>))

model.<span class="hljs-built_in">compile</span>(optimizer=<span class="hljs-string">'adam'</span>, loss=<span class="hljs-string">'binary_crossentropy'</span>, metrics=[<span class="hljs-string">'accuracy'</span>])
model.summary()

</code></pre>
<h3 data-id="heading-4">如何选择添加什么层？</h3>
<ul>
<li><strong>嵌入层</strong>：当输入是离散的符号（如单词）且没有预训练的词向量时，可以添加嵌入层。如果有预训练的词向量（如Word2Vec、GloVe），可以使用预训练的权重初始化嵌入层。</li>
<li><strong>LSTM层</strong>：根据问题的复杂性选择LSTM单元的数量和层数。对于简单问题，一层LSTM可能足够；对于复杂问题，可以堆叠多层LSTM。</li>
<li><strong>Dropout层</strong>：如果模型在训练集上表现良好，但在验证集上表现差（过拟合），则可以添加Dropout层。通常Dropout率设置在0.2到0.5之间。</li>
<li><strong>全连接层</strong>：根据任务类型选择。例如，多分类问题使用softmax激活函数，二分类使用sigmoid，回归问题不使用激活函数。</li>
</ul>
<h3 data-id="heading-5">注意事项</h3>
<ul>
<li>当堆叠多层LSTM时，需要设置前一层LSTM的<code>return_sequences=True</code>，以便将序列输出传递给下一层。</li>
<li>LSTM层的单元数量（即隐藏状态大小）是一个重要的超参数，需要根据任务调整。</li>
</ul>
<p>希望这些信息能帮助你构建LSTM模型。根据具体任务，你可能需要调整层数、每层的单元数、Dropout率等超参数。</p>
<hr/>
<hr/>
<hr/>
<p>我来详细解释LSTM模型的构建模块，帮助你理解何时该添加什么层。</p>
<h3 data-id="heading-6"><strong>LSTM模型的核心模块</strong></h3>
<h4 data-id="heading-7"><strong>1. 输入层 (Input Layer)</strong></h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># Keras示例</span>
<span class="hljs-keyword">from</span> tensorflow.keras.layers <span class="hljs-keyword">import</span> Input
input_layer = Input(shape=(sequence_length, features))
</code></pre>
<p><strong>作用</strong>：定义模型输入数据的形状
<strong>何时添加</strong>：总是需要，作为第一层</p>
<h4 data-id="heading-8"><strong>2. 嵌入层 (Embedding Layer) - 文本处理专用</strong></h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> tensorflow.keras.layers <span class="hljs-keyword">import</span> Embedding
embedding = Embedding(
    input_dim=vocab_size,  <span class="hljs-comment"># 词汇表大小</span>
    output_dim=embedding_dim,  <span class="hljs-comment"># 词向量维度</span>
    input_length=sequence_length
)
</code></pre>
<p><strong>作用</strong>：将离散的单词索引转换为密集向量表示
<strong>何时添加</strong>：处理文本数据时，在Input层之后</p>
<h4 data-id="heading-9"><strong>3. LSTM层 (核心层)</strong></h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> tensorflow.keras.layers <span class="hljs-keyword">import</span> LSTM

<span class="hljs-comment"># 基础LSTM</span>
lstm_layer = LSTM(units=<span class="hljs-number">64</span>, return_sequences=<span class="hljs-literal">False</span>)

<span class="hljs-comment"># 返回完整序列（用于堆叠多层LSTM）</span>
lstm_layer = LSTM(units=<span class="hljs-number">64</span>, return_sequences=<span class="hljs-literal">True</span>)

<span class="hljs-comment"># 双向LSTM（效果通常更好）</span>
<span class="hljs-keyword">from</span> tensorflow.keras.layers <span class="hljs-keyword">import</span> Bidirectional
bilstm = Bidirectional(LSTM(units=<span class="hljs-number">64</span>))
</code></pre>
<p><strong>作用</strong>：处理序列数据，捕捉时间依赖关系
<strong>参数说明</strong>：</p>
<ul>
<li><code>units</code>：隐藏状态的维度（通常32-512）</li>
<li><code>return_sequences</code>：
<ul>
<li><code>False</code>：只返回最后一个时间步的输出（用于分类）</li>
<li><code>True</code>：返回所有时间步的输出（用于序列标注或堆叠多层）</li>
</ul>
</li>
<li><code>dropout</code>：输入丢弃率</li>
<li><code>recurrent_dropout</code>：循环丢弃率</li>
</ul>
<p><strong>何时添加</strong>：总是需要，至少要有一层LSTM</p>
<h4 data-id="heading-10"><strong>4. Dropout层 / 正则化层</strong></h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> tensorflow.keras.layers <span class="hljs-keyword">import</span> Dropout, BatchNormalization

dropout = Dropout(<span class="hljs-number">0.5</span>)  <span class="hljs-comment"># 丢弃50%的神经元</span>
batch_norm = BatchNormalization()
</code></pre>
<p><strong>作用</strong>：防止过拟合，提高泛化能力
<strong>何时添加</strong>：</p>
<ul>
<li>模型在训练集表现好但验证集差时</li>
<li>数据集较小或模型较复杂时</li>
<li>通常在LSTM层后或Dense层前</li>
</ul>
<h4 data-id="heading-11"><strong>5. 全连接层 (Dense Layer)</strong></h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> tensorflow.keras.layers <span class="hljs-keyword">import</span> Dense

<span class="hljs-comment"># 分类任务</span>
dense_layer = Dense(units=num_classes, activation=<span class="hljs-string">'softmax'</span>)

<span class="hljs-comment"># 回归任务</span>
dense_layer = Dense(units=<span class="hljs-number">1</span>, activation=<span class="hljs-string">'linear'</span>)
</code></pre>
<p><strong>作用</strong>：将学习到的特征映射到输出空间
<strong>何时添加</strong>：</p>
<ul>
<li>输出层：总是需要（分类或回归）</li>
<li>中间层：需要增加模型复杂度时</li>
</ul>
<h4 data-id="heading-12"><strong>6. 其他辅助层</strong></h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 卷积层（用于提取局部特征）</span>
<span class="hljs-keyword">from</span> tensorflow.keras.layers <span class="hljs-keyword">import</span> Conv1D
conv = Conv1D(filters=<span class="hljs-number">64</span>, kernel_size=<span class="hljs-number">3</span>, activation=<span class="hljs-string">'relu'</span>)

<span class="hljs-comment"># 池化层（用于降维）</span>
<span class="hljs-keyword">from</span> tensorflow.keras.layers <span class="hljs-keyword">import</span> MaxPooling1D
pooling = MaxPooling1D(pool_size=<span class="hljs-number">2</span>)

<span class="hljs-comment"># 注意力层（用于关注重要部分）</span>
<span class="hljs-keyword">from</span> tensorflow.keras.layers <span class="hljs-keyword">import</span> Attention
attention = Attention()
</code></pre>
<h3 data-id="heading-13"><strong>不同场景下的模型架构示例</strong></h3>
<h4 data-id="heading-14"><strong>场景1：文本分类（单层LSTM）</strong></h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> tensorflow.keras.models <span class="hljs-keyword">import</span> Sequential
<span class="hljs-keyword">from</span> tensorflow.keras.layers <span class="hljs-keyword">import</span> *

model = Sequential([
    Embedding(vocab_size=<span class="hljs-number">10000</span>, output_dim=<span class="hljs-number">128</span>, input_length=<span class="hljs-number">100</span>),
    LSTM(units=<span class="hljs-number">64</span>, dropout=<span class="hljs-number">0.2</span>, recurrent_dropout=<span class="hljs-number">0.2</span>),
    Dropout(<span class="hljs-number">0.5</span>),
    Dense(<span class="hljs-number">64</span>, activation=<span class="hljs-string">'relu'</span>),
    Dense(<span class="hljs-number">3</span>, activation=<span class="hljs-string">'softmax'</span>)  <span class="hljs-comment"># 3分类</span>
])
</code></pre>
<h4 data-id="heading-15"><strong>场景2：时间序列预测（多层LSTM）</strong></h4>
<pre><code class="hljs language-python" lang="python">model = Sequential([
    Input(shape=(<span class="hljs-number">30</span>, <span class="hljs-number">1</span>)),  <span class="hljs-comment"># 30个时间步，每个步长1个特征</span>
    LSTM(units=<span class="hljs-number">50</span>, return_sequences=<span class="hljs-literal">True</span>),
    BatchNormalization(),
    LSTM(units=<span class="hljs-number">50</span>, return_sequences=<span class="hljs-literal">False</span>),
    Dropout(<span class="hljs-number">0.3</span>),
    Dense(<span class="hljs-number">25</span>, activation=<span class="hljs-string">'relu'</span>),
    Dense(<span class="hljs-number">1</span>)  <span class="hljs-comment"># 预测1个值</span>
])
</code></pre>
<h4 data-id="heading-16"><strong>场景3：序列标注（双向LSTM）</strong></h4>
<pre><code class="hljs language-python" lang="python">model = Sequential([
    Embedding(<span class="hljs-number">10000</span>, <span class="hljs-number">128</span>),
    Bidirectional(LSTM(<span class="hljs-number">64</span>, return_sequences=<span class="hljs-literal">True</span>)),  <span class="hljs-comment"># 返回完整序列</span>
    Dropout(<span class="hljs-number">0.3</span>),
    TimeDistributed(Dense(<span class="hljs-number">32</span>, activation=<span class="hljs-string">'relu'</span>)),  <span class="hljs-comment"># 每个时间步独立处理</span>
    Dense(num_tags, activation=<span class="hljs-string">'softmax'</span>)  <span class="hljs-comment"># 每个时间步的分类</span>
])
</code></pre>
<h4 data-id="heading-17"><strong>场景4：复杂任务（CNN + LSTM）</strong></h4>
<pre><code class="hljs language-python" lang="python">model = Sequential([
    Conv1D(filters=<span class="hljs-number">64</span>, kernel_size=<span class="hljs-number">3</span>, activation=<span class="hljs-string">'relu'</span>, 
           input_shape=(<span class="hljs-number">100</span>, <span class="hljs-number">1</span>)),  <span class="hljs-comment"># 提取局部特征</span>
    MaxPooling1D(pool_size=<span class="hljs-number">2</span>),  <span class="hljs-comment"># 降维</span>
    LSTM(<span class="hljs-number">50</span>, return_sequences=<span class="hljs-literal">True</span>),
    LSTM(<span class="hljs-number">50</span>),
    Dense(<span class="hljs-number">1</span>)
])
</code></pre>
<h3 data-id="heading-18"><strong>层添加决策流程</strong></h3>
<pre><code class="hljs language-ini" lang="ini">是否需要处理文本数据？
├── 是：添加 Embedding 层
└── 否：直接使用数值特征

添加第一层LSTM：
├── 需要后续LSTM层？设置 <span class="hljs-attr">return_sequences</span>=<span class="hljs-literal">True</span>
└── 不需要？设置 <span class="hljs-attr">return_sequences</span>=<span class="hljs-literal">False</span>

是否需要捕捉双向信息？
├── 是：使用 Bidirectional(LSTM())
└── 否：使用普通 LSTM()

模型是否过拟合？
├── 是：添加 Dropout(0.2-0.5) 或 BatchNormalization
└── 否：跳过

是否需要更复杂的特征表示？
├── 是：添加更多 LSTM 层 或 Dense 层
└── 否：直接连接输出层

任务类型是什么？
├── 分类：最后一层用 softmax（多分类）或 sigmoid（二分类）
├── 回归：最后一层用 linear 激活
└── 序列标注：用 TimeDistributed 包装输出层
</code></pre>
<h3 data-id="heading-19"><strong>实用建议</strong></h3>
<ol>
<li>
<p><strong>从简单开始</strong>：先尝试单层LSTM + Dropout + 输出层</p>
</li>
<li>
<p><strong>逐步复杂化</strong>：如果效果不好，再添加更多层</p>
</li>
<li>
<p><strong>通用推荐架构</strong>：</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-selector-tag">Input</span> → <span class="hljs-selector-attr">[Embedding]</span> → <span class="hljs-built_in">LSTM</span>(<span class="hljs-number">64</span>-<span class="hljs-number">128</span>) → <span class="hljs-built_in">Dropout</span>(<span class="hljs-number">0.2</span>-<span class="hljs-number">0.5</span>) → <span class="hljs-built_in">Dense</span>(output)
</code></pre>
</li>
<li>
<p><strong>超参数设置</strong>：</p>
<ul>
<li>LSTM units：32, 64, 128, 256（逐渐增加）</li>
<li>Dropout率：0.2-0.5</li>
<li>学习率：0.001（Adam优化器默认）</li>
</ul>
</li>
<li>
<p><strong>调试技巧</strong>：</p>
<ul>
<li>过拟合？增加Dropout或减少LSTM单元数</li>
<li>欠拟合？增加LSTM层数或单元数</li>
<li>训练慢？减少批大小或序列长度</li>
</ul>
</li>
</ol>
<p>需要我针对你的具体任务类型（文本分类、时间序列预测等）提供更详细的架构建议吗？</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[AI 智能体高可靠设计模式：竞争代理组合]]></title>    <link>https://juejin.cn/post/7592094314473127971</link>    <guid>https://juejin.cn/post/7592094314473127971</guid>    <pubDate>2026-01-07T03:32:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592094314473127971" data-draft-id="7592147128215781428" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AI 智能体高可靠设计模式：竞争代理组合"/> <meta itemprop="keywords" content="人工智能"/> <meta itemprop="datePublished" content="2026-01-07T03:32:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="俞凡"/> <meta itemprop="url" content="https://juejin.cn/user/290747765274222"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AI 智能体高可靠设计模式：竞争代理组合
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/290747765274222/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    俞凡
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-07T03:32:59.000Z" title="Wed Jan 07 2026 03:32:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p><em>本系列介绍增强现代智能体系统可靠性的设计模式，以直观方式逐一介绍每个概念，拆解其目的，然后实现简单可行的版本，演示其如何融入现实世界的智能体系统。本系列一共 14 篇文章，这是第 6 篇。原文：<a href="https://link.juejin.cn?target=https%3A%2F%2Flevelup.gitconnected.com%2Fbuilding-the-14-key-pillars-of-agentic-ai-229e50f65986" title="https://levelup.gitconnected.com/building-the-14-key-pillars-of-agentic-ai-229e50f65986" target="_blank" ref="nofollow noopener noreferrer">Building the 14 Key Pillars of Agentic AI</a></em></p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6261c3c1eec64cfd94d619d91b102e1f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-e5Yeh:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768361579&amp;x-signature=Zt5MiopkMp6Otnwv0XNYlH7cVBA%3D" alt="" loading="lazy"/></p>
<p>优化智能体解决方案需要软件工程确保组件协调、并行运行并与系统高效交互。例如<a href="https://link.juejin.cn?target=https%3A%2F%2Fen.wikipedia.org%2Fwiki%2FSpeculative_execution" title="https://en.wikipedia.org/wiki/Speculative_execution" target="_blank" ref="nofollow noopener noreferrer">预测执行</a>，会尝试处理可预测查询以<strong>降低延迟</strong>，或者进行<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.arm.com%2Fcommunity%2Farm-community-blogs%2Fb%2Fembedded-and-microcontrollers-blog%2Fposts%2Fcomparing-lock-step-redundant-execution-versus-split-lock-technologies" title="https://developer.arm.com/community/arm-community-blogs/b/embedded-and-microcontrollers-blog/posts/comparing-lock-step-redundant-execution-versus-split-lock-technologies" target="_blank" ref="nofollow noopener noreferrer">冗余执行</a>，即<strong>对同一智能体重复执行多次</strong>以防单点故障。其他增强现代智能体系统可靠性的模式包括：</p>
<ul>
<li><strong>并行工具</strong>：智能体同时执行独立 API 调用以隐藏 I/O 延迟。</li>
<li><strong>层级智能体</strong>：管理者将任务拆分为由执行智能体处理的小步骤。</li>
<li><strong>竞争性智能体组合</strong>：多个智能体提出答案，系统选出最佳。</li>
<li><strong>冗余执行</strong>：即两个或多个智能体解决同一任务以检测错误并提高可靠性。</li>
<li><strong>并行检索和混合检索</strong>：多种检索策略协同运行以提升上下文质量。</li>
<li><strong>多跳检索</strong>：智能体通过迭代检索步骤收集更深入、更相关的信息。</li>
</ul>
<p>还有很多其他模式。</p>
<p>本系列将实现最常用智能体模式背后的基础概念，以直观方式逐一介绍每个概念，拆解其目的，然后实现简单可行的版本，演示其如何融入现实世界的智能体系统。</p>
<p>所有理论和代码都在 GitHub 仓库里：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FFareedKhan-dev%2Fagentic-parallelism" title="https://github.com/FareedKhan-dev/agentic-parallelism" target="_blank" ref="nofollow noopener noreferrer">🤖 Agentic Parallelism: A Practical Guide 🚀</a></p>
<p>代码库组织如下：</p>
<pre><code class="hljs language-erlang" lang="erlang">agentic-parallelism/
    ├── <span class="hljs-number">01</span>_parallel_tool_use.ipynb
    ├── <span class="hljs-number">02</span>_parallel_hypothesis.ipynb
    ...
    ├── <span class="hljs-number">06</span>_competitive_agent_ensembles.ipynb
    ├── <span class="hljs-number">07</span>_agent_assembly_line.ipynb
    ├── <span class="hljs-number">08</span>_decentralized_blackboard.ipynb
    ...
    ├── <span class="hljs-number">13</span>_parallel_context_preprocessing.ipynb
    └── <span class="hljs-number">14</span>_parallel_multi_hop_retrieval.ipynb
</code></pre>
<hr/>
<h2 data-id="heading-0">竞争代理组合</h2>
<p>在智能体解决方案中，每个 AI 智能体都有其特定偏见、优势和劣势。</p>
<p>使用多样化代理组合可以降低单一代理产生次优或缺陷输出的风险。</p>
<p>通过结合多模型或提示策略，系统更具韧性，避免单点故障，更有可能产出高质量输出。</p>
<p>这种模式相当于人工智能寻求 “第二意见” 或进行竞争性设计流程。</p>
<p>我们将构建三个风格迥异的文案代理组合，负责撰写产品描述，然后看看评估器如何基于这些代理的输出进行推理，选择最佳方案，从而显著提升质量控制流程。</p>
<p>首先，组合的力量来自其成员的多样性。我们将利用两个不同的 LLM 家族创建三种不同的文案“角色”，以最大化多样性。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> langchain_huggingface <span class="hljs-keyword">import</span> HuggingFacePipeline
<span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> AutoTokenizer, AutoModelForCausalLM, pipeline
<span class="hljs-keyword">from</span> langchain_google_vertexai <span class="hljs-keyword">import</span> ChatVertexAI
<span class="hljs-keyword">import</span> torch

<span class="hljs-comment"># LLM 1: Llama 3 8B Instruct (开源, 通过 Hugging Face 本地部署)</span>
<span class="hljs-comment"># 为两个角色赋能</span>
model_id = <span class="hljs-string">"meta-llama/Meta-Llama-3-8B-Instruct"</span>
tokenizer = AutoTokenizer.from_pretrained(model_id)
hf_model = AutoModelForCausalLM.from_pretrained(
    model_id,
    torch_dtype=torch.bfloat16,
    device_map=<span class="hljs-string">"auto"</span>,
    load_in_4bit=<span class="hljs-literal">True</span>
)
pipe = pipeline(<span class="hljs-string">"text-generation"</span>, model=hf_model, tokenizer=tokenizer, max_new_tokens=<span class="hljs-number">1024</span>, do_sample=<span class="hljs-literal">True</span>, temperature=<span class="hljs-number">0.7</span>, top_p=<span class="hljs-number">0.9</span>)
llama3_llm = HuggingFacePipeline(pipeline=pipe)

<span class="hljs-comment"># LLM 2: Claude 3.5 Sonnet on Vertex AI (专有, 基于云服务)</span>
<span class="hljs-comment"># 使用来自不同厂商的模型和训练方法引入了显著的多样性</span>
claude_sonnet_llm = ChatVertexAI(model_name=<span class="hljs-string">"claude-3-5-sonnet@001"</span>, temperature=<span class="hljs-number">0.7</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"LLMs Initialized: Llama 3 and Claude 3.5 Sonnet are ready to compete."</span>)
</code></pre>
<p>通过使用两个完全不同的模型 —— 开源的 Llama 3 和谷歌的 Claude 3.5 Sonnet，确保组合拥有真正的多样性。这些代理拥有不同写作风格、知识门槛和固有偏见，而这正是我们想要的强有力竞争过程。</p>
<p>接下来定义 Pydantic 模型，以结构化文案代理和最终评估器的产出。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> langchain_core.pydantic_v1 <span class="hljs-keyword">import</span> BaseModel, Field
<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">List</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">ProductDescription</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):
    <span class="hljs-string">"""有标题和正文的结构化产品描述，是文案代理的输出"""</span>
    headline: <span class="hljs-built_in">str</span> = Field(description=<span class="hljs-string">"A catchy, attention-grabbing headline for the product."</span>)
    body: <span class="hljs-built_in">str</span> = Field(description=<span class="hljs-string">"A short paragraph (2-3 sentences) detailing the product's benefits and features."</span>)

<span class="hljs-keyword">class</span> <span class="hljs-title class_">FinalEvaluation</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):
    <span class="hljs-string">"""评估器代理的结构化输出，包含最佳描述和详细评论"""</span>
    best_description: ProductDescription = Field(description=<span class="hljs-string">"The winning product description chosen by the judge."</span>)
    critique: <span class="hljs-built_in">str</span> = Field(description=<span class="hljs-string">"A detailed, point-by-point critique explaining why the winner was chosen over the other options, referencing the evaluation criteria."</span>)
    winning_agent: <span class="hljs-built_in">str</span> = Field(description=<span class="hljs-string">"The name of the agent that produced the winning description (e.g., 'Claude_Sonnet_Creative', 'Llama3_Direct', 'Llama3_Luxury')."</span>)
</code></pre>
<p>这些数据模型就是通信协议。</p>
<ol>
<li><code>ProductDescription</code> 模版确保三家竞争者以相同且一致的格式提交输出。</li>
<li><code>FinalEvaluation</code> 模版更为关键，迫使评估器代理不仅要选择一个 <code>winning_agent</code>，还要提供详细评审（<code>critique</code>），使决策过程透明且可审计。</li>
</ol>
<p>现在定义 <code>GraphState</code> 和代理节点。节点将通过辅助功能创建，以减少重复代码。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> TypedDict, Annotated, <span class="hljs-type">Dict</span>
<span class="hljs-keyword">import</span> operator
<span class="hljs-keyword">import</span> time

<span class="hljs-keyword">class</span> <span class="hljs-title class_">GraphState</span>(<span class="hljs-title class_ inherited__">TypedDict</span>):
    product_name: <span class="hljs-built_in">str</span>
    product_category: <span class="hljs-built_in">str</span>
    features: <span class="hljs-built_in">str</span>
    <span class="hljs-comment"># 字典存储来自竞争代理的结果，并通过 operator.update 合并</span>
    competitor_results: Annotated[<span class="hljs-type">Dict</span>[<span class="hljs-built_in">str</span>, ProductDescription], operator.update]
    final_evaluation: FinalEvaluation
    performance_log: Annotated[<span class="hljs-type">List</span>[<span class="hljs-built_in">str</span>], operator.add]

<span class="hljs-comment"># 创建竞争节点的辅助“工厂”函数</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">create_competitor_node</span>(<span class="hljs-params">agent_name: <span class="hljs-built_in">str</span>, llm, prompt</span>):
    <span class="hljs-comment"># 每个竞争者都是一条链：提示词 -&gt; LLM -&gt; Pydantic 结构化输出</span>
    chain = prompt | llm.with_structured_output(ProductDescription)
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">competitor_node</span>(<span class="hljs-params">state: GraphState</span>):
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"--- [COMPETITOR: <span class="hljs-subst">{agent_name}</span>] Starting generation... ---"</span>)
        start_time = time.time()
        result = chain.invoke({
            <span class="hljs-string">"product_name"</span>: state[<span class="hljs-string">'product_name'</span>],
            <span class="hljs-string">"product_category"</span>: state[<span class="hljs-string">'product_category'</span>],
            <span class="hljs-string">"features"</span>: state[<span class="hljs-string">'features'</span>]
        })
        execution_time = time.time() - start_time
        log = <span class="hljs-string">f"[<span class="hljs-subst">{agent_name}</span>] Completed in <span class="hljs-subst">{execution_time:<span class="hljs-number">.2</span>f}</span>s."</span>
        <span class="hljs-built_in">print</span>(log)
        <span class="hljs-comment"># 输出键与代理名称匹配，以便于聚合</span>
        <span class="hljs-keyword">return</span> {<span class="hljs-string">"competitor_results"</span>: {agent_name: result}, <span class="hljs-string">"performance_log"</span>: [log]}
    <span class="hljs-keyword">return</span> competitor_node
</code></pre>
<p><code>create_competitor_node</code> 是构建多元化组合的最简单方式，输入名称、LLM 和提示符，返回一个完备的、支持结构化输出的 <code>LangGraph</code> 节点。让我们能够轻松定义三位竞争对手，让每个都有独特的模型和个性。</p>
<p>现在创建三个竞争节点和最终评估器节点。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 使用工厂创建三个竞争节点</span>
<span class="hljs-comment"># 每个都有不同的模型和提示词组合，以确保多样性</span>
claude_creative_node = create_competitor_node(<span class="hljs-string">"Claude_Sonnet_Creative"</span>, claude_sonnet_llm, claude_creative_prompt)
llama3_direct_node = create_competitor_node(<span class="hljs-string">"Llama3_Direct"</span>, llama3_llm, llama3_direct_prompt)
llama3_luxury_node = create_competitor_node(<span class="hljs-string">"Llama3_Luxury"</span>, llama3_llm, llama3_luxury_prompt)

<span class="hljs-comment"># 评估器节点</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">judge_node</span>(<span class="hljs-params">state: GraphState</span>):
    <span class="hljs-string">"""评估所有竞争者的结果并选出获胜者"""</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"--- [JUDGE] Evaluating competing descriptions... ---"</span>)
    start_time = time.time()
    
    <span class="hljs-comment"># 根据评估器提示，将不同描述格式化</span>
    descriptions_to_evaluate = <span class="hljs-string">""</span>
    <span class="hljs-keyword">for</span> name, desc <span class="hljs-keyword">in</span> state[<span class="hljs-string">'competitor_results'</span>].items():
        descriptions_to_evaluate += <span class="hljs-string">f"--- Option from <span class="hljs-subst">{name}</span> ---\nHeadline: <span class="hljs-subst">{desc.headline}</span>\nBody: <span class="hljs-subst">{desc.body}</span>\n\n"</span>
    
    <span class="hljs-comment"># 创建评估链</span>
    judge_chain = judge_prompt | llm.with_structured_output(FinalEvaluation)
    evaluation = judge_chain.invoke({
        <span class="hljs-string">"product_name"</span>: state[<span class="hljs-string">'product_name'</span>],
        <span class="hljs-string">"descriptions_to_evaluate"</span>: descriptions_to_evaluate
    })
    
    execution_time = time.time() - start_time
    log = <span class="hljs-string">f"[Judge] Completed evaluation in <span class="hljs-subst">{execution_time:<span class="hljs-number">.2</span>f}</span>s."</span>
    <span class="hljs-built_in">print</span>(log)
    
    <span class="hljs-keyword">return</span> {<span class="hljs-string">"final_evaluation"</span>: evaluation, <span class="hljs-string">"performance_log"</span>: [log]}
</code></pre>
<p>现在确定了组合里的三个代理，有三个不同的文案节点，每个节点都针对不同风格设计，还有一个评估节点负责根据收集到的输出进行最终关键评估。</p>
<p>最后用“扇出扇入”架构组装图。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> langgraph.graph <span class="hljs-keyword">import</span> StateGraph, END

workflow = StateGraph(GraphState)

<span class="hljs-comment"># 添加三个竞争节点</span>
workflow.add_node(<span class="hljs-string">"claude_creative"</span>, claude_creative_node)
workflow.add_node(<span class="hljs-string">"llama3_direct"</span>, llama3_direct_node)
workflow.add_node(<span class="hljs-string">"llama3_luxury"</span>, llama3_luxury_node)

<span class="hljs-comment"># 添加最终评估节点</span>
workflow.add_node(<span class="hljs-string">"judge"</span>, judge_node)

<span class="hljs-comment"># 入口点是节点列表，告诉 LangGraph 并行运行这些节点</span>
workflow.set_entry_point([<span class="hljs-string">"claude_creative"</span>, <span class="hljs-string">"llama3_direct"</span>, <span class="hljs-string">"llama3_luxury"</span>])

<span class="hljs-comment"># 列表中的边意味着图在继续之前会等待所有边完成，这就是扇入</span>
workflow.add_edge([<span class="hljs-string">"claude_creative"</span>, <span class="hljs-string">"llama3_direct"</span>, <span class="hljs-string">"llama3_luxury"</span>], <span class="hljs-string">"judge"</span>)

<span class="hljs-comment"># 最后一步是评估器决策</span>
workflow.add_edge(<span class="hljs-string">"judge"</span>, END)
app = workflow.<span class="hljs-built_in">compile</span>()
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/33cd82e577c24078bebdd977cfe4091c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-e5Yeh:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768361579&amp;x-signature=rj656UU%2FwKEwM3HUt4k9vauyTtg%3D" alt="组合代理" loading="lazy"/></p>
<p>现在进行最后的一对一分析，审视这三种竞争性描述及评估器的最终决定，以理解该组合的好处。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> json

<span class="hljs-built_in">print</span>(<span class="hljs-string">"="</span>*<span class="hljs-number">60</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"            THE COMPETING PRODUCT DESCRIPTIONS"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"="</span>*<span class="hljs-number">60</span>)


<span class="hljs-keyword">for</span> name, desc <span class="hljs-keyword">in</span> final_state[<span class="hljs-string">'competitor_results'</span>].items():
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\n--- [<span class="hljs-subst">{name}</span>] ---"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"Headline: <span class="hljs-subst">{desc[<span class="hljs-string">'headline'</span>]}</span>"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"Body: <span class="hljs-subst">{desc[<span class="hljs-string">'body'</span>]}</span>"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"\n"</span> + <span class="hljs-string">"="</span>*<span class="hljs-number">60</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"                  THE JUDGE'S FINAL VERDICT"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"="</span>*<span class="hljs-number">60</span>)
final_eval = final_state[<span class="hljs-string">'final_evaluation'</span>]
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"\nWinning Agent: <span class="hljs-subst">{final_eval[<span class="hljs-string">'winning_agent'</span>]}</span>\n"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"Winning Description:"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"  - Headline: <span class="hljs-subst">{final_eval[<span class="hljs-string">'best_description'</span>][<span class="hljs-string">'headline'</span>]}</span>"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"  - Body: <span class="hljs-subst">{final_eval[<span class="hljs-string">'best_description'</span>][<span class="hljs-string">'body'</span>]}</span>\n"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"Judge's Critique:"</span>)
<span class="hljs-built_in">print</span>(final_eval[<span class="hljs-string">'critique'</span>])
<span class="hljs-built_in">print</span>(<span class="hljs-string">"\n"</span> + <span class="hljs-string">"-"</span>*<span class="hljs-number">60</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"                      PERFORMANCE ANALYSIS"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"-"</span>*<span class="hljs-number">60</span>)


competitor_times = [<span class="hljs-number">7.33</span>, <span class="hljs-number">6.12</span>, <span class="hljs-number">6.45</span>]
judge_time = <span class="hljs-number">8.91</span>
parallel_time = <span class="hljs-built_in">max</span>(competitor_times)
sequential_time = <span class="hljs-built_in">sum</span>(competitor_times)
total_time = parallel_time + judge_time
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"\nTotal Execution Time: <span class="hljs-subst">{total_time:<span class="hljs-number">.2</span>f}</span> seconds\n"</span>)
</code></pre>
<p>输出：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment">#### 输出 ####</span>
============================================================
            THE COMPETING PRODUCT DESCRIPTIONS
============================================================

--- [Claude_Sonnet_Creative] ---
Headline: Your Life, Unlocked. Your Wellness, Understood.
Body: The Aura Smart Ring <span class="hljs-keyword">is</span> more than a tracker; its your silent wellness partner. Crafted <span class="hljs-keyword">from</span> durable titanium, it deciphers your body signals-sleep, activity, <span class="hljs-keyword">and</span> heart rate-translating them into insights that empower your every day. With a <span class="hljs-number">7</span>-day battery, its always on, always learning, always you.
--- [Llama3_Direct] ---
Headline: Track Everything. Wear Nothing.
Body: Meet the Aura Smart Ring. Get elite sleep <span class="hljs-keyword">and</span> activity tracking, <span class="hljs-number">24</span>/<span class="hljs-number">7</span> heart rate monitoring, <span class="hljs-keyword">and</span> a <span class="hljs-number">7</span>-day battery. Built <span class="hljs-keyword">from</span> tough titanium, it delivers powerful health insights without the bulk of a watch.
--- [Llama3_Luxury] ---
Headline: Master Your Narrative.
Body: For the discerning individual, the Aura Smart Ring <span class="hljs-keyword">is</span> an emblem of effortle...ously engineered <span class="hljs-keyword">from</span> aerospace-grade titanium, it provides a seamless interface to your personal biometrics. Command your well-being <span class="hljs-keyword">with</span> seven days of uninterrupted power <span class="hljs-keyword">and</span> unparalleled insight.

============================================================
                  THE JUDGES FINAL VERDICT
============================================================
Winning Agent: Claude_Sonnet_Creative
Winning Description:
  - Headline: Your Life, Unlocked. Your Wellness, Understood.
  - Body: The Aura Smart Ring <span class="hljs-keyword">is</span> more than a tracker; its your silent wellness partner. Crafted <span class="hljs-keyword">from</span> durable titanium, it deciphers your body<span class="hljs-string">'s signals-sleep, activity, and heart rate-translating them into insights that empower your every day. With a 7-day battery, it'</span>s always on, always learning, always you.

------------------------------------------------------------
                      PERFORMANCE ANALYSIS
------------------------------------------------------------
Total Execution Time: <span class="hljs-number">16.24</span> seconds
</code></pre>
<p>最终分析强调了竞争组合模式的两个关键优势。</p>
<ol>
<li><strong>通过多样性+评估器实现高质量</strong>：三个代理产生了明显不同的输出 Llama3_Direct（有力）、Llama3_Luxury（理想）和 Claude_Sonnet_Creative（利益驱动）。这种多样性为评估器代理提供了更强有力的评估工具。其最终选择体现了对权衡的明确推理，表明质量来自过程（竞争+评估），而非单一模型。</li>
<li><strong>通过并行性实现高性能</strong>：所有代理并行运行使流水线速度比顺序执行快了 63%，仅以最慢代理的时间开销，就获得了多样化输出，带来更高的质量和更高的运行效率。</li>
</ol>
<hr/>
<blockquote>
<p>Hi，我是俞凡，一名兼具技术深度与管理视野的技术管理者。曾就职于 Motorola，现任职于 Mavenir，多年带领技术团队，聚焦后端架构与云原生，持续关注 AI 等前沿方向，也关注人的成长，笃信持续学习的力量。在这里，我会分享技术实践与思考。欢迎关注公众号「DeepNoMind」，星标不迷路。也欢迎访问独立站 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.deepnomind.com" title="https://www.deepnomind.com" target="_blank" ref="nofollow noopener noreferrer">www.DeepNoMind.com</a>，一起交流成长。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[AI 智能体高可靠设计模式：层级代理组]]></title>    <link>https://juejin.cn/post/7592152007839203328</link>    <guid>https://juejin.cn/post/7592152007839203328</guid>    <pubDate>2026-01-07T03:36:50.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592152007839203328" data-draft-id="7592147128215814196" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AI 智能体高可靠设计模式：层级代理组"/> <meta itemprop="keywords" content="人工智能"/> <meta itemprop="datePublished" content="2026-01-07T03:36:50.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="俞凡"/> <meta itemprop="url" content="https://juejin.cn/user/290747765274222"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AI 智能体高可靠设计模式：层级代理组
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/290747765274222/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    俞凡
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-07T03:36:50.000Z" title="Wed Jan 07 2026 03:36:50 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p><em>本系列介绍增强现代智能体系统可靠性的设计模式，以直观方式逐一介绍每个概念，拆解其目的，然后实现简单可行的版本，演示其如何融入现实世界的智能体系统。本系列一共 14 篇文章，这是第 5 篇。原文：<a href="https://link.juejin.cn?target=https%3A%2F%2Flevelup.gitconnected.com%2Fbuilding-the-14-key-pillars-of-agentic-ai-229e50f65986" title="https://levelup.gitconnected.com/building-the-14-key-pillars-of-agentic-ai-229e50f65986" target="_blank" ref="nofollow noopener noreferrer">Building the 14 Key Pillars of Agentic AI</a></em></p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/16530e258342413a913dfb58891b15bb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-e5Yeh:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768361810&amp;x-signature=tleMAM4PToXcrx2XhCsA2NDcssc%3D" alt="" loading="lazy"/></p>
<p>优化智能体解决方案需要软件工程确保组件协调、并行运行并与系统高效交互。例如<a href="https://link.juejin.cn?target=https%3A%2F%2Fen.wikipedia.org%2Fwiki%2FSpeculative_execution" title="https://en.wikipedia.org/wiki/Speculative_execution" target="_blank" ref="nofollow noopener noreferrer">预测执行</a>，会尝试处理可预测查询以<strong>降低时延</strong>，或者进行<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.arm.com%2Fcommunity%2Farm-community-blogs%2Fb%2Fembedded-and-microcontrollers-blog%2Fposts%2Fcomparing-lock-step-redundant-execution-versus-split-lock-technologies" title="https://developer.arm.com/community/arm-community-blogs/b/embedded-and-microcontrollers-blog/posts/comparing-lock-step-redundant-execution-versus-split-lock-technologies" target="_blank" ref="nofollow noopener noreferrer">冗余执行</a>，即<strong>对同一智能体重复执行多次</strong>以防单点故障。其他增强现代智能体系统可靠性的模式包括：</p>
<ul>
<li><strong>并行工具</strong>：智能体同时执行独立 API 调用以隐藏 I/O 时延。</li>
<li><strong>层级智能体</strong>：管理者将任务拆分为由执行智能体处理的小步骤。</li>
<li><strong>竞争性智能体组合</strong>：多个智能体提出答案，系统选出最佳。</li>
<li><strong>冗余执行</strong>：即两个或多个智能体解决同一任务以检测错误并提高可靠性。</li>
<li><strong>并行检索和混合检索</strong>：多种检索策略协同运行以提升上下文质量。</li>
<li><strong>多跳检索</strong>：智能体通过迭代检索步骤收集更深入、更相关的信息。</li>
</ul>
<p>还有很多其他模式。</p>
<p>本系列将实现最常用智能体模式背后的基础概念，以直观方式逐一介绍每个概念，拆解其目的，然后实现简单可行的版本，演示其如何融入现实世界的智能体系统。</p>
<p>所有理论和代码都在 GitHub 仓库里：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FFareedKhan-dev%2Fagentic-parallelism" title="https://github.com/FareedKhan-dev/agentic-parallelism" target="_blank" ref="nofollow noopener noreferrer">🤖 Agentic Parallelism: A Practical Guide 🚀</a></p>
<p>代码库组织如下：</p>
<pre><code class="hljs language-erlang" lang="erlang">agentic-parallelism/
    ├── <span class="hljs-number">01</span>_parallel_tool_use.ipynb
    ├── <span class="hljs-number">02</span>_parallel_hypothesis.ipynb
    ...
    ├── <span class="hljs-number">06</span>_competitive_agent_ensembles.ipynb
    ├── <span class="hljs-number">07</span>_agent_assembly_line.ipynb
    ├── <span class="hljs-number">08</span>_decentralized_blackboard.ipynb
    ...
    ├── <span class="hljs-number">13</span>_parallel_context_preprocessing.ipynb
    └── <span class="hljs-number">14</span>_parallel_multi_hop_retrieval.ipynb
</code></pre>
<hr/>
<h2 data-id="heading-0">层级代理组，追求卓越质量</h2>
<p>到目前为止，我们已经探讨了智能体如何同时生成并评估想法。</p>
<p>但复杂任务往往会意料之外或不可预见，需要智能体决定执行什么以及何时执行，从而导致计划与行动之间的延迟。</p>
<p><strong>专业化与解耦架构模式</strong>是解决问题的正确方法。</p>
<ol>
<li>复杂任务被分配给高层<strong>编排器</strong>（或<strong>管理器</strong>）代理，代理本身并不执行任务，职责是进行规划。</li>
<li>代理将复杂任务分解为更小、更明确的子任务，并委派给一组专业<strong>执行器</strong>代理。</li>
<li>执行器通常可以同时完成任务。最后，编排器将执行器的结果综合成统一的输出。</li>
</ol>
<p>我们将直接比较<strong>单体代理</strong>与<strong>分层组</strong>在投资报告生成任务中的表现，以证明分层式方法不仅更快，而且在细节、结构和准确性上都更优于最终报告。</p>
<p>首先，需要定义作为代理之间通信协议的结构化数据模型，结构化输出是将多智能体系统粘合在一起的纽带。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> langchain_core.pydantic_v1 <span class="hljs-keyword">import</span> BaseModel, Field
<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">Optional</span>, <span class="hljs-type">List</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">FinancialData</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):
    <span class="hljs-string">"""金融分析代理的结构化输出 Pydantic 模型。"""</span>
    price: <span class="hljs-built_in">float</span> = Field(description=<span class="hljs-string">"Current stock price."</span>)
    market_cap: <span class="hljs-built_in">int</span> = Field(description=<span class="hljs-string">"Total market capitalization."</span>)
    pe_ratio: <span class="hljs-built_in">float</span> = Field(description=<span class="hljs-string">"Price-to-Earnings ratio."</span>)
    volume: <span class="hljs-built_in">int</span> = Field(description=<span class="hljs-string">"Average trading volume."</span>)

<span class="hljs-keyword">class</span> <span class="hljs-title class_">NewsAndMarketAnalysis</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):
    <span class="hljs-string">"""新闻与市场分析代理的结构化输出 Pydantic 模型。"""</span>
    summary: <span class="hljs-built_in">str</span> = Field(description=<span class="hljs-string">"A concise summary of the most important recent news and market trends."</span>)
    competitors: <span class="hljs-type">List</span>[<span class="hljs-built_in">str</span>] = Field(description=<span class="hljs-string">"A list of the company's main competitors."</span>)

<span class="hljs-keyword">class</span> <span class="hljs-title class_">FinalReport</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):
    <span class="hljs-string">"""首席分析师最终综合投资报告的 Pydantic 模型。"""</span>
    company_name: <span class="hljs-built_in">str</span> = Field(description=<span class="hljs-string">"The name of the company."</span>)
    financial_summary: <span class="hljs-built_in">str</span> = Field(description=<span class="hljs-string">"A paragraph summarizing the key financial data."</span>)
    news_and_market_summary: <span class="hljs-built_in">str</span> = Field(description=<span class="hljs-string">"A paragraph summarizing the news, market trends, and competitive landscape."</span>)
    recommendation: <span class="hljs-built_in">str</span> = Field(description=<span class="hljs-string">"A final investment recommendation (e.g., 'Strong Buy', 'Hold', 'Sell') with a brief justification."</span>)
</code></pre>
<p>这些 Pydantic 模型是定义信息如何在专业代理与最终协调器之间传递的正式合约。例如，<code>FinancialData</code> 模型确保金融分析代理始终提供四个具体的数值数据点。这些结构化数据比简单的文本块更可靠，也更容易让最终合成器代理工作。</p>
<p>接下来为分层组定义 <code>GraphState</code>，跟踪每个专业执行器的输出。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> TypedDict, Annotated

<span class="hljs-keyword">class</span> <span class="hljs-title class_">TeamGraphState</span>(<span class="hljs-title class_ inherited__">TypedDict</span>):
    company_symbol: <span class="hljs-built_in">str</span>
    company_name: <span class="hljs-built_in">str</span>
    <span class="hljs-comment"># 'financial_data' 将保存金融分析代理的结构化输出</span>
    financial_data: <span class="hljs-type">Optional</span>[FinancialData]
    <span class="hljs-comment"># 'news_analysis' 将保存新闻和市场分析代理的结构化输出</span>
    news_analysis: <span class="hljs-type">Optional</span>[NewsAndMarketAnalysis]
    <span class="hljs-comment"># 'final_report' 是合成器的最终产物</span>
    final_report: <span class="hljs-type">Optional</span>[FinalReport]
    performance_log: Annotated[<span class="hljs-type">List</span>[<span class="hljs-built_in">str</span>], operator.add]
</code></pre>
<p><code>TeamGraphState</code> 是分析代理组的共享工作空间，为每个专业代理（<code>financial_data</code>、<code>news_analysis</code>）的交付物设置了具体字段，确保当最终合成器代理激活时，拥有一套干净、组织良好的输入可供工作。</p>
<p>我们定义一下“专业执行器代理”，每个代理都是自成一体、使用工具的代理，且提示非常聚焦。我们创建一下金融分析代理节点。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> langchain.agents <span class="hljs-keyword">import</span> create_tool_calling_agent, AgentExecutor
<span class="hljs-keyword">import</span> time

<span class="hljs-comment"># 为金融分析代理创建独立代理执行器</span>
<span class="hljs-comment"># 提示符高度集中在单一任务上</span>
financial_analyst_prompt = ChatPromptTemplate.from_messages([
    (<span class="hljs-string">"system"</span>, <span class="hljs-string">"You are an expert financial analyst. Your sole job is to use the provided tool to get key financial metrics for a company and return them in a structured format."</span>),
    (<span class="hljs-string">"human"</span>, <span class="hljs-string">"Get the financial data for the company with stock symbol: {symbol}"</span>)
])

<span class="hljs-comment"># 该代理只能访问 'get_financial_data' 工具</span>
financial_agent = create_tool_calling_agent(llm, [get_financial_data], financial_analyst_prompt)

<span class="hljs-comment"># 最后强制代理输出到 'FinancialData' Pydantic 模型中</span>
financial_executor = AgentExecutor(agent=financial_agent, tools=[get_financial_data]) | llm.with_structured_output(FinancialData)

<span class="hljs-keyword">def</span> <span class="hljs-title function_">financial_analyst_node</span>(<span class="hljs-params">state: TeamGraphState</span>):
    <span class="hljs-string">"""用于获取和构造金融数据的专门节点"""</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"--- [Financial Analyst] Starting analysis... ---"</span>)
    start_time = time.time()
    result = financial_executor.invoke({<span class="hljs-string">"symbol"</span>: state[<span class="hljs-string">'company_symbol'</span>]})
    execution_time = time.time() - start_time
    log = <span class="hljs-string">f"[Financial Analyst] Completed in <span class="hljs-subst">{execution_time:<span class="hljs-number">.2</span>f}</span>s."</span>
    <span class="hljs-built_in">print</span>(log)
    <span class="hljs-keyword">return</span> {<span class="hljs-string">"financial_data"</span>: result, <span class="hljs-string">"performance_log"</span>: [log]}
</code></pre>
<p><code>financial_analyst_node</code> 提示词范围狭窄，工具集有限。通过将代理限制在单一任务中，大大提高了输出的可靠性。最后的 <code>.with_structured_output(FinancialData)</code> 调用是一个关键质量门槛，确保其交付内容始终以正确的格式呈现。</p>
<p><code>news_analyst_node</code> 遵循完全相同的模式，但配备了自己的专用提示和工具。</p>
<p>最后定义编排器代理。该代理（即 <code>report_synthesizer_node</code>），接收并行执行器的结构化输出，执行最终的综合步骤。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 为合成器/编排器创建链</span>
report_synthesizer_prompt = ChatPromptTemplate.from_messages([
    (<span class="hljs-string">"system"</span>, <span class="hljs-string">"You are the Chief Investment Analyst. Your job is to synthesize the structured financial data and market analysis provided by your specialist team into a final, comprehensive investment report, including a justified recommendation."</span>),
    (<span class="hljs-string">"human"</span>, <span class="hljs-string">"Please create the final report for {company_name}.\n\nFinancial Data:\n{financial_data}\n\nNews and Market Analysis:\n{news_analysis}"</span>)
])
synthesizer_chain = report_synthesizer_prompt | llm.with_structured_output(FinalReport)

<span class="hljs-keyword">def</span> <span class="hljs-title function_">report_synthesizer_node</span>(<span class="hljs-params">state: TeamGraphState</span>):
    <span class="hljs-string">"""接受结构化执行器输出并合成最终报告的编排器节点"""</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"--- [Chief Analyst] Synthesizing final report... ---"</span>)
    start_time = time.time()
    
    <span class="hljs-comment"># 该节点从状态中读取结构化数据</span>
    report = synthesizer_chain.invoke({
        <span class="hljs-string">"company_name"</span>: state[<span class="hljs-string">'company_name'</span>],
        <span class="hljs-string">"financial_data"</span>: state[<span class="hljs-string">'financial_data'</span>].json(),
        <span class="hljs-string">"news_analysis"</span>: state[<span class="hljs-string">'news_analysis'</span>].json()
    })
    
    execution_time = time.time() - start_time
    log = <span class="hljs-string">f"[Chief Analyst] Completed report in <span class="hljs-subst">{execution_time:<span class="hljs-number">.2</span>f}</span>s."</span>
    <span class="hljs-built_in">print</span>(log)
    <span class="hljs-keyword">return</span> {<span class="hljs-string">"final_report"</span>: report, <span class="hljs-string">"performance_log"</span>: [log]}
</code></pre>
<p><code>report_synthesizer_node</code> 是负责组装最终产品的管理器，不需要调用任何工具，执行单纯的综合工作。</p>
<p>通过从状态中获取清晰、结构化的 <code>FinancialData</code> 和 <code>NewsAndMarketAnalysis</code> 对象，可以专注于构建连贯叙述并做出最终且有根据的推荐的高级任务。</p>
<p>现在，用“扇出扇入”架构来组装图。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> langgraph.graph <span class="hljs-keyword">import</span> StateGraph, END

<span class="hljs-comment"># 初始化图</span>
workflow = StateGraph(TeamGraphState)

<span class="hljs-comment"># 为两个专业执行器和最后的合成器添加节点</span>
workflow.add_node(<span class="hljs-string">"financial_analyst"</span>, financial_analyst_node)
workflow.add_node(<span class="hljs-string">"news_analyst"</span>, news_analyst_node)
workflow.add_node(<span class="hljs-string">"report_synthesizer"</span>, report_synthesizer_node)

<span class="hljs-comment"># 入口点是一个列表，告诉 LangGraph 并行运行两个专业执行器</span>
workflow.set_entry_point([<span class="hljs-string">"financial_analyst"</span>, <span class="hljs-string">"news_analyst"</span>])

<span class="hljs-comment"># 节点列表中的一条边意味着图将等待所有节点完成后再继续</span>
<span class="hljs-comment"># 这是“扇入”或同步步骤</span>
workflow.add_edge([<span class="hljs-string">"financial_analyst"</span>, <span class="hljs-string">"news_analyst"</span>], <span class="hljs-string">"report_synthesizer"</span>)

<span class="hljs-comment"># 合成器是最后一步</span>
workflow.add_edge(<span class="hljs-string">"report_synthesizer"</span>, END)

<span class="hljs-comment"># 编译图</span>
app = workflow.<span class="hljs-built_in">compile</span>()

<span class="hljs-comment"># 执行流</span>
inputs = {
    <span class="hljs-string">"company_symbol"</span>: <span class="hljs-string">"TSLA"</span>,
    <span class="hljs-string">"company_name"</span>: <span class="hljs-string">"Tesla"</span>,
    <span class="hljs-string">"performance_log"</span>: []
}

start_time = time.time()
team_result = <span class="hljs-literal">None</span>
<span class="hljs-keyword">for</span> output <span class="hljs-keyword">in</span> app.stream(inputs, stream_mode=<span class="hljs-string">"values"</span>):
    team_result = output
end_time = time.time()
team_time = end_time - start_time
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3324734110294e35a0fc0a7e24af261c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-e5Yeh:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768361810&amp;x-signature=2sp7ee29Mc3ALSwCX7dQ9eUg5zM%3D" alt="层级代理" loading="lazy"/></p>
<p>现在进行最后的一对一分析，比较最终报告的质量和两套系统的性能。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-built_in">print</span>(<span class="hljs-string">"="</span>*<span class="hljs-number">60</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"                AGENT OUTPUT COMPARISON"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"="</span>*<span class="hljs-number">60</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"\n"</span> + <span class="hljs-string">"-"</span>*<span class="hljs-number">60</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"            MONOLITHIC AGENT REPORT"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"-"</span>*<span class="hljs-number">60</span> + <span class="hljs-string">"\n"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"'<span class="hljs-subst">{monolithic_result[<span class="hljs-string">'output'</span>]}</span>'"</span>)


<span class="hljs-built_in">print</span>(<span class="hljs-string">"\n"</span> + <span class="hljs-string">"-"</span>*<span class="hljs-number">60</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"            HIERARCHICAL TEAM REPORT"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"-"</span>*<span class="hljs-number">60</span> + <span class="hljs-string">"\n"</span>)
<span class="hljs-built_in">print</span>(json.dumps(team_result[<span class="hljs-string">'final_report'</span>], indent=<span class="hljs-number">4</span>, default=<span class="hljs-keyword">lambda</span> o: o.<span class="hljs-built_in">dict</span>()))
<span class="hljs-built_in">print</span>(<span class="hljs-string">"\n"</span> + <span class="hljs-string">"="</span>*<span class="hljs-number">60</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"                      ACCURACY &amp; QUALITY ANALYSIS"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"="</span>*<span class="hljs-number">60</span> + <span class="hljs-string">"\n"</span>)

<span class="hljs-built_in">print</span>(<span class="hljs-string">"="</span>*<span class="hljs-number">60</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"                      PERFORMANCE ANALYSIS"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"="</span>*<span class="hljs-number">60</span> + <span class="hljs-string">"\n"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"Monolithic Agent Total Time: <span class="hljs-subst">{monolithic_time:<span class="hljs-number">.2</span>f}</span> seconds"</span>) <span class="hljs-comment"># (Assuming monolithic_time is from the notebook run)</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"Hierarchical Team Total Time: <span class="hljs-subst">{team_time:<span class="hljs-number">.2</span>f}</span> seconds\n"</span>) <span class="hljs-comment"># (Assuming team_time is from the notebook run)</span>
time_saved = monolithic_time - team_time
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"Time Saved: <span class="hljs-subst">{time_saved:<span class="hljs-number">.2</span>f}</span> seconds (<span class="hljs-subst">{time_saved/monolithic_time*<span class="hljs-number">100</span>:<span class="hljs-number">.0</span>f}</span>% faster)\n"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"Analysis of Parallelism:"</span>)

<span class="hljs-comment"># (从笔记本的性能日志中提取工作时间)</span>
worker_times = [<span class="hljs-number">6.89</span>, <span class="hljs-number">8.12</span>] 
parallel_worker_time = <span class="hljs-built_in">max</span>(worker_times)
sequential_worker_time = <span class="hljs-built_in">sum</span>(worker_times)
</code></pre>
<p>这是得到的输出……</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment">#### 输出 ####</span>
============================================================
                AGENT OUTPUT COMPARISON
============================================================

------------------------------------------------------------
            MONOLITHIC AGENT REPORT
------------------------------------------------------------
Tesla (TSLA) <span class="hljs-keyword">is</span> currently trading at around $<span class="hljs-number">177.48</span>. Recent news suggests the company <span class="hljs-keyword">is</span> facing competition <span class="hljs-keyword">from</span> other EV makers but <span class="hljs-keyword">is</span> also expanding its Gigafactory network. The recommendation <span class="hljs-keyword">is</span> to Hold the stock <span class="hljs-keyword">and</span> monitor the competitive landscape.
------------------------------------------------------------
            HIERARCHICAL TEAM REPORT
------------------------------------------------------------
{
    <span class="hljs-string">"final_report"</span>: {
        <span class="hljs-string">"company_name"</span>: <span class="hljs-string">"Tesla"</span>,
        <span class="hljs-string">"financial_summary"</span>: <span class="hljs-string">"Tesla's current stock price is 177.48, with a total market capitalization of 566,310,215,680. It exhibits a trailing Price-to-Earnings (P/E) ratio of 45.4..."</span>,
...ndation based on synthesizing multiple data points. The Monolithic agents analysis was superficial by comparison.
**Conclusion:** The decomposition of the task <span class="hljs-keyword">and</span> the use of specialist agents led to a provably higher-quality <span class="hljs-keyword">and</span> more accurate output. The structure imposed by the hierarchy <span class="hljs-keyword">and</span> Pydantic models forced a more rigorous <span class="hljs-keyword">and</span> detailed analysis.
============================================================
                      PERFORMANCE ANALYSIS
============================================================
Monolithic Agent Total Time: <span class="hljs-number">18.34</span> seconds
Hierarchical Team Total Time: <span class="hljs-number">13.57</span> seconds
Time Saved: <span class="hljs-number">4.77</span> seconds (<span class="hljs-number">26</span>% faster)
Analysis of Parallelism:
The two specialist workers ran <span class="hljs-keyword">in</span> parallel. If run sequentially, this stage would have taken <span class="hljs-number">15.01</span> seconds. By running them <span class="hljs-keyword">in</span> parallel, the stage took only <span class="hljs-number">8.12</span> seconds (the time of the longest worker). This parallelism <span class="hljs-keyword">is</span> the primary reason the more <span class="hljs-built_in">complex</span>, higher-quality hierarchical system was also significantly faster.
</code></pre>
<p>两个专业执行器并行运行……</p>
<p>金融分析代理用了 6.89s，新闻分析代理用了 8.12s，最终报告更为详细，如果按顺序进行，这一阶段大约需要 15.01s。</p>
<p>通过并行运行，该阶段仅用时 8.12s（最长执行器的时间）。这种并行性是更复杂、更高质量的层级系统速度显著更快的主要原因。</p>
<hr/>
<blockquote>
<p>Hi，我是俞凡，一名兼具技术深度与管理视野的技术管理者。曾就职于 Motorola，现任职于 Mavenir，多年带领技术团队，聚焦后端架构与云原生，持续关注 AI 等前沿方向，也关注人的成长，笃信持续学习的力量。在这里，我会分享技术实践与思考。欢迎关注公众号「DeepNoMind」，星标不迷路。也欢迎访问独立站 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.deepnomind.com" title="https://www.deepnomind.com" target="_blank" ref="nofollow noopener noreferrer">www.DeepNoMind.com</a>，一起交流成长。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Flutter 测试框架对比指南]]></title>    <link>https://juejin.cn/post/7592234632482439177</link>    <guid>https://juejin.cn/post/7592234632482439177</guid>    <pubDate>2026-01-07T03:53:09.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592234632482439177" data-draft-id="7592241336288870451" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Flutter 测试框架对比指南"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-07T03:53:09.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="阿东在coding"/> <meta itemprop="url" content="https://juejin.cn/user/2260251635353528"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Flutter 测试框架对比指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2260251635353528/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    阿东在coding
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-07T03:53:09.000Z" title="Wed Jan 07 2026 03:53:09 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    11
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">概述</h2>
<p>Flutter 提供了多种测试框架，适用于不同的测试场景。本文档详细对比各测试框架的特点、使用场景和最佳实践。</p>
<hr/>
<h2 data-id="heading-1">测试框架对比表</h2>

































































<table><thead><tr><th>特性</th><th>flutter_test</th><th>integration_test</th><th>flutter_driver (已弃用)</th></tr></thead><tbody><tr><td><strong>测试类型</strong></td><td>单元测试 / Widget 测试</td><td>集成测试 / E2E 测试</td><td>E2E 测试</td></tr><tr><td><strong>运行环境</strong></td><td>测试虚拟机 (VM)</td><td>真机 / 模拟器</td><td>真机 / 模拟器</td></tr><tr><td><strong>执行速度</strong></td><td>⚡ 极快 (毫秒级)</td><td>🐢 较慢 (秒级)</td><td>🐢 较慢 (秒级)</td></tr><tr><td><strong>UI 渲染</strong></td><td>虚拟渲染 (无真实屏幕)</td><td>真实渲染</td><td>真实渲染</td></tr><tr><td><strong>网络访问</strong></td><td>需 Mock</td><td>✅ 真实网络</td><td>✅ 真实网络</td></tr><tr><td><strong>平台 API</strong></td><td>需 Mock</td><td>✅ 真实平台 API</td><td>✅ 真实平台 API</td></tr><tr><td><strong>CI/CD 支持</strong></td><td>✅ 优秀</td><td>✅ 良好</td><td>⚠️ 复杂</td></tr><tr><td><strong>调试能力</strong></td><td>✅ 完整</td><td>⚠️ 有限</td><td>❌ 困难</td></tr><tr><td><strong>官方推荐</strong></td><td>✅ 推荐</td><td>✅ 推荐</td><td>❌ 已弃用</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-2">1. flutter_test（单元测试 / Widget 测试）</h2>
<h3 data-id="heading-3">简介</h3>
<p><code>flutter_test</code> 是 Flutter SDK 内置的测试框架，用于编写<strong>单元测试</strong>和 <strong>Widget 测试</strong>。它在 Dart VM 中运行，不需要真实设备。</p>
<h3 data-id="heading-4">适用场景</h3>
<ul>
<li>✅ 业务逻辑测试（Controller、Service、Utils）</li>
<li>✅ 单个 Widget 的 UI 测试</li>
<li>✅ 状态管理测试（GetX、Riverpod、Bloc）</li>
<li>✅ 数据模型测试</li>
<li>✅ 纯 Dart 代码测试</li>
</ul>
<h3 data-id="heading-5">项目配置</h3>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># pubspec.yaml</span>
<span class="hljs-attr">dev_dependencies:</span>
  <span class="hljs-attr">flutter_test:</span>
    <span class="hljs-attr">sdk:</span> <span class="hljs-string">flutter</span>
</code></pre>
<h3 data-id="heading-6">目录结构</h3>
<pre><code class="hljs language-bash" lang="bash">project/
├── lib/
│   └── src/
│       └── utils/
│           └── calculator.dart
└── <span class="hljs-built_in">test</span>/                          <span class="hljs-comment"># 测试目录</span>
    └── utils/
        └── calculator_test.dart   <span class="hljs-comment"># 以 _test.dart 结尾</span>
</code></pre>
<h3 data-id="heading-7">代码示例</h3>
<h4 data-id="heading-8">单元测试</h4>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// test/utils/calculator_test.dart</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">'package:flutter_test/flutter_test.dart'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">'package:my_app/src/utils/calculator.dart'</span>;

<span class="hljs-keyword">void</span> main() {
  group(<span class="hljs-string">'Calculator 测试'</span>, () {
    <span class="hljs-keyword">late</span> Calculator calculator;

    setUp(() {
      calculator = Calculator();
    });

    test(<span class="hljs-string">'加法运算正确'</span>, () {
      expect(calculator.add(<span class="hljs-number">2</span>, <span class="hljs-number">3</span>), equals(<span class="hljs-number">5</span>));
    });

    test(<span class="hljs-string">'减法运算正确'</span>, () {
      expect(calculator.subtract(<span class="hljs-number">5</span>, <span class="hljs-number">3</span>), equals(<span class="hljs-number">2</span>));
    });

    test(<span class="hljs-string">'除以零抛出异常'</span>, () {
      expect(
        () =&gt; calculator.divide(<span class="hljs-number">10</span>, <span class="hljs-number">0</span>),
        throwsA(isA&lt;ArgumentError&gt;()),
      );
    });
  });
}
</code></pre>
<h4 data-id="heading-9">Widget 测试</h4>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// test/widgets/counter_widget_test.dart</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">'package:flutter/material.dart'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">'package:flutter_test/flutter_test.dart'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">'package:my_app/src/widgets/counter_widget.dart'</span>;

<span class="hljs-keyword">void</span> main() {
  group(<span class="hljs-string">'CounterWidget 测试'</span>, () {
    testWidgets(<span class="hljs-string">'初始值为0'</span>, (WidgetTester tester) <span class="hljs-keyword">async</span> {
      <span class="hljs-keyword">await</span> tester.pumpWidget(
        <span class="hljs-keyword">const</span> MaterialApp(home: CounterWidget()),
      );

      expect(find.text(<span class="hljs-string">'0'</span>), findsOneWidget);
    });

    testWidgets(<span class="hljs-string">'点击加号按钮后数值增加'</span>, (WidgetTester tester) <span class="hljs-keyword">async</span> {
      <span class="hljs-keyword">await</span> tester.pumpWidget(
        <span class="hljs-keyword">const</span> MaterialApp(home: CounterWidget()),
      );

      <span class="hljs-comment">// 点击加号按钮</span>
      <span class="hljs-keyword">await</span> tester.tap(find.byIcon(Icons.add));
      <span class="hljs-keyword">await</span> tester.pump(); <span class="hljs-comment">// 触发重建</span>

      expect(find.text(<span class="hljs-string">'1'</span>), findsOneWidget);
    });

    testWidgets(<span class="hljs-string">'长按按钮显示提示'</span>, (WidgetTester tester) <span class="hljs-keyword">async</span> {
      <span class="hljs-keyword">await</span> tester.pumpWidget(
        <span class="hljs-keyword">const</span> MaterialApp(home: CounterWidget()),
      );

      <span class="hljs-keyword">await</span> tester.longPress(find.byType(ElevatedButton));
      <span class="hljs-keyword">await</span> tester.pumpAndSettle(); <span class="hljs-comment">// 等待动画完成</span>

      expect(find.text(<span class="hljs-string">'长按提示'</span>), findsOneWidget);
    });
  });
}
</code></pre>
<h3 data-id="heading-10">运行命令</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 运行所有测试</span>
flutter <span class="hljs-built_in">test</span>

<span class="hljs-comment"># 运行指定文件</span>
flutter <span class="hljs-built_in">test</span> <span class="hljs-built_in">test</span>/utils/calculator_test.dart

<span class="hljs-comment"># 运行指定目录</span>
flutter <span class="hljs-built_in">test</span> <span class="hljs-built_in">test</span>/widgets/

<span class="hljs-comment"># 生成覆盖率报告</span>
flutter <span class="hljs-built_in">test</span> --coverage
</code></pre>
<h3 data-id="heading-11">常用 API</h3>













































































<table><thead><tr><th>API</th><th>说明</th></tr></thead><tbody><tr><td><code>test()</code></td><td>定义单个测试用例</td></tr><tr><td><code>testWidgets()</code></td><td>定义 Widget 测试用例</td></tr><tr><td><code>group()</code></td><td>测试分组</td></tr><tr><td><code>setUp()</code></td><td>每个测试前执行</td></tr><tr><td><code>tearDown()</code></td><td>每个测试后执行</td></tr><tr><td><code>setUpAll()</code></td><td>所有测试前执行一次</td></tr><tr><td><code>tearDownAll()</code></td><td>所有测试后执行一次</td></tr><tr><td><code>expect()</code></td><td>断言</td></tr><tr><td><code>find.text()</code></td><td>查找文本 Widget</td></tr><tr><td><code>find.byType()</code></td><td>按类型查找 Widget</td></tr><tr><td><code>find.byKey()</code></td><td>按 Key 查找 Widget</td></tr><tr><td><code>find.byIcon()</code></td><td>按图标查找 Widget</td></tr><tr><td><code>tester.tap()</code></td><td>模拟点击</td></tr><tr><td><code>tester.enterText()</code></td><td>模拟输入文本</td></tr><tr><td><code>tester.drag()</code></td><td>模拟拖动</td></tr><tr><td><code>tester.pump()</code></td><td>触发帧重建</td></tr><tr><td><code>tester.pumpAndSettle()</code></td><td>等待所有动画完成</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-12">2. integration_test（集成测试）</h2>
<h3 data-id="heading-13">简介</h3>
<p><code>integration_test</code> 是 Flutter 官方推荐的<strong>集成测试/E2E 测试</strong>框架。它在真实设备或模拟器上运行完整的应用，可以测试完整的用户流程。</p>
<h3 data-id="heading-14">适用场景</h3>
<ul>
<li>✅ 端到端用户流程测试</li>
<li>✅ 需要真实网络请求的测试</li>
<li>✅ 需要平台特定功能的测试（相机、GPS、推送等）</li>
<li>✅ 多页面导航测试</li>
<li>✅ 性能测试</li>
<li>✅ 屏幕截图测试</li>
</ul>
<h3 data-id="heading-15">项目配置</h3>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># pubspec.yaml</span>
<span class="hljs-attr">dev_dependencies:</span>
  <span class="hljs-attr">flutter_test:</span>
    <span class="hljs-attr">sdk:</span> <span class="hljs-string">flutter</span>
  <span class="hljs-attr">integration_test:</span>
    <span class="hljs-attr">sdk:</span> <span class="hljs-string">flutter</span>
</code></pre>
<h3 data-id="heading-16">目录结构</h3>
<pre><code class="hljs language-bash" lang="bash">project/
├── lib/
│   └── main.dart
├── integration_test/              <span class="hljs-comment"># 集成测试专用目录</span>
│   ├── app_test.dart
│   └── login_flow_test.dart
└── <span class="hljs-built_in">test</span>/
    └── ...                        <span class="hljs-comment"># 单元/Widget测试</span>
</code></pre>
<h3 data-id="heading-17">代码示例</h3>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// integration_test/login_flow_test.dart</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">'package:flutter/material.dart'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">'package:flutter_test/flutter_test.dart'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">'package:integration_test/integration_test.dart'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">'package:my_app/main.dart'</span> <span class="hljs-keyword">as</span> app;

<span class="hljs-comment">/// <span class="markdown">每步之间的延迟时间</span></span>
<span class="hljs-keyword">const</span> stepDelay = <span class="hljs-built_in">Duration</span>(seconds: <span class="hljs-number">2</span>);

<span class="hljs-comment">/// <span class="markdown">延迟函数 - 等待指定时间并保持UI响应</span></span>
Future&lt;<span class="hljs-keyword">void</span>&gt; delay(WidgetTester tester, [<span class="hljs-built_in">Duration</span> duration = stepDelay]) <span class="hljs-keyword">async</span> {
  <span class="hljs-keyword">await</span> tester.pump(duration);
}

<span class="hljs-keyword">void</span> main() {
  <span class="hljs-comment">// 初始化集成测试绑定（必须）</span>
  IntegrationTestWidgetsFlutterBinding.ensureInitialized();

  group(<span class="hljs-string">'登录流程测试'</span>, () {
    testWidgets(<span class="hljs-string">'用户可以成功登录'</span>, (WidgetTester tester) <span class="hljs-keyword">async</span> {
      <span class="hljs-comment">// 1. 启动应用</span>
      <span class="hljs-built_in">print</span>(<span class="hljs-string">'📱 步骤1: 启动应用...'</span>);
      app.main();
      <span class="hljs-keyword">await</span> tester.pumpAndSettle();
      <span class="hljs-keyword">await</span> delay(tester);

      <span class="hljs-comment">// 2. 验证登录页面加载</span>
      <span class="hljs-built_in">print</span>(<span class="hljs-string">'📱 步骤2: 验证登录页面...'</span>);
      expect(find.text(<span class="hljs-string">'登录'</span>), findsOneWidget);
      <span class="hljs-keyword">await</span> delay(tester);

      <span class="hljs-comment">// 3. 输入用户名</span>
      <span class="hljs-built_in">print</span>(<span class="hljs-string">'📱 步骤3: 输入用户名...'</span>);
      <span class="hljs-keyword">final</span> usernameField = find.byKey(<span class="hljs-keyword">const</span> Key(<span class="hljs-string">'username_field'</span>));
      <span class="hljs-keyword">await</span> tester.enterText(usernameField, <span class="hljs-string">'testuser'</span>);
      <span class="hljs-keyword">await</span> tester.pumpAndSettle();
      <span class="hljs-keyword">await</span> delay(tester);

      <span class="hljs-comment">// 4. 输入密码</span>
      <span class="hljs-built_in">print</span>(<span class="hljs-string">'📱 步骤4: 输入密码...'</span>);
      <span class="hljs-keyword">final</span> passwordField = find.byKey(<span class="hljs-keyword">const</span> Key(<span class="hljs-string">'password_field'</span>));
      <span class="hljs-keyword">await</span> tester.enterText(passwordField, <span class="hljs-string">'password123'</span>);
      <span class="hljs-keyword">await</span> tester.pumpAndSettle();
      <span class="hljs-keyword">await</span> delay(tester);

      <span class="hljs-comment">// 5. 点击登录按钮</span>
      <span class="hljs-built_in">print</span>(<span class="hljs-string">'📱 步骤5: 点击登录...'</span>);
      <span class="hljs-keyword">final</span> loginButton = find.byKey(<span class="hljs-keyword">const</span> Key(<span class="hljs-string">'login_button'</span>));
      <span class="hljs-keyword">await</span> tester.tap(loginButton);
      <span class="hljs-keyword">await</span> tester.pumpAndSettle(<span class="hljs-keyword">const</span> <span class="hljs-built_in">Duration</span>(seconds: <span class="hljs-number">5</span>)); <span class="hljs-comment">// 等待网络请求</span>
      <span class="hljs-keyword">await</span> delay(tester);

      <span class="hljs-comment">// 6. 验证跳转到首页</span>
      <span class="hljs-built_in">print</span>(<span class="hljs-string">'📱 步骤6: 验证首页...'</span>);
      expect(find.text(<span class="hljs-string">'首页'</span>), findsOneWidget);
      <span class="hljs-keyword">await</span> delay(tester);

      <span class="hljs-built_in">print</span>(<span class="hljs-string">'✅ 测试通过：登录流程正常'</span>);
    });

    testWidgets(<span class="hljs-string">'输入错误密码显示错误提示'</span>, (WidgetTester tester) <span class="hljs-keyword">async</span> {
      app.main();
      <span class="hljs-keyword">await</span> tester.pumpAndSettle();

      <span class="hljs-comment">// 输入用户名</span>
      <span class="hljs-keyword">await</span> tester.enterText(
        find.byKey(<span class="hljs-keyword">const</span> Key(<span class="hljs-string">'username_field'</span>)),
        <span class="hljs-string">'testuser'</span>,
      );
      
      <span class="hljs-comment">// 输入错误密码</span>
      <span class="hljs-keyword">await</span> tester.enterText(
        find.byKey(<span class="hljs-keyword">const</span> Key(<span class="hljs-string">'password_field'</span>)),
        <span class="hljs-string">'wrong_password'</span>,
      );
      
      <span class="hljs-comment">// 点击登录</span>
      <span class="hljs-keyword">await</span> tester.tap(find.byKey(<span class="hljs-keyword">const</span> Key(<span class="hljs-string">'login_button'</span>)));
      <span class="hljs-keyword">await</span> tester.pumpAndSettle(<span class="hljs-keyword">const</span> <span class="hljs-built_in">Duration</span>(seconds: <span class="hljs-number">3</span>));

      <span class="hljs-comment">// 验证错误提示</span>
      expect(find.text(<span class="hljs-string">'密码错误'</span>), findsOneWidget);
    });
  });
}
</code></pre>
<h3 data-id="heading-18">运行命令</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 在连接的设备/模拟器上运行</span>
flutter <span class="hljs-built_in">test</span> integration_test/login_flow_test.dart

<span class="hljs-comment"># 指定设备运行</span>
flutter <span class="hljs-built_in">test</span> integration_test/ -d &lt;device_id&gt;

<span class="hljs-comment"># 指定环境变量</span>
flutter <span class="hljs-built_in">test</span> integration_test/ --dart-define=ENV=dev

<span class="hljs-comment"># 运行并生成报告</span>
flutter <span class="hljs-built_in">test</span> integration_test/ --reporter json &gt; test_results.json
</code></pre>
<h3 data-id="heading-19">高级用法</h3>
<h4 data-id="heading-20">截图测试</h4>
<pre><code class="hljs language-dart" lang="dart">testWidgets(<span class="hljs-string">'首页UI截图'</span>, (WidgetTester tester) <span class="hljs-keyword">async</span> {
  <span class="hljs-keyword">final</span> binding = IntegrationTestWidgetsFlutterBinding.ensureInitialized();
  
  app.main();
  <span class="hljs-keyword">await</span> tester.pumpAndSettle();

  <span class="hljs-comment">// 截图</span>
  <span class="hljs-keyword">await</span> binding.takeScreenshot(<span class="hljs-string">'home_page'</span>);
});
</code></pre>
<h4 data-id="heading-21">性能测试</h4>
<pre><code class="hljs language-dart" lang="dart">testWidgets(<span class="hljs-string">'列表滚动性能'</span>, (WidgetTester tester) <span class="hljs-keyword">async</span> {
  <span class="hljs-keyword">final</span> binding = IntegrationTestWidgetsFlutterBinding.ensureInitialized();
  
  app.main();
  <span class="hljs-keyword">await</span> tester.pumpAndSettle();

  <span class="hljs-comment">// 开始追踪</span>
  <span class="hljs-keyword">await</span> binding.traceAction(() <span class="hljs-keyword">async</span> {
    <span class="hljs-comment">// 滚动列表</span>
    <span class="hljs-keyword">await</span> tester.fling(
      find.byType(ListView),
      <span class="hljs-keyword">const</span> Offset(<span class="hljs-number">0</span>, <span class="hljs-number">-500</span>),
      <span class="hljs-number">1000</span>,
    );
    <span class="hljs-keyword">await</span> tester.pumpAndSettle();
  });
});
</code></pre>
<hr/>
<h2 data-id="heading-22">3. flutter_driver（已弃用）</h2>
<h3 data-id="heading-23">⚠️ 重要提示</h3>
<p><strong><code>flutter_driver</code> 已被 Flutter 官方弃用</strong>，推荐使用 <code>integration_test</code> 替代。</p>
<h3 data-id="heading-24">历史背景</h3>
<p><code>flutter_driver</code> 是早期的 E2E 测试框架，采用客户端-服务器架构：</p>
<ul>
<li>测试脚本运行在主机（Host）</li>
<li>应用运行在设备上</li>
<li>通过 WebSocket 通信</li>
</ul>
<h3 data-id="heading-25">为什么被弃用</h3>
<ol>
<li><strong>架构复杂</strong>：需要两个进程协作</li>
<li><strong>调试困难</strong>：无法直接访问 Widget 树</li>
<li><strong>功能受限</strong>：只能通过有限的 Finder 查找元素</li>
<li><strong>维护成本高</strong>：需要同时维护 <code>app.dart</code> 和测试脚本</li>
</ol>
<h3 data-id="heading-26">迁移建议</h3>
<p>如果项目中还在使用 <code>flutter_driver</code>，建议迁移到 <code>integration_test</code>：</p>

























<table><thead><tr><th>flutter_driver</th><th>integration_test</th></tr></thead><tbody><tr><td><code>driver.tap(find.byValueKey('key'))</code></td><td><code>tester.tap(find.byKey(Key('key')))</code></td></tr><tr><td><code>driver.enterText(find, 'text')</code></td><td><code>tester.enterText(find, 'text')</code></td></tr><tr><td><code>driver.waitFor(find)</code></td><td><code>expect(find, findsOneWidget)</code></td></tr><tr><td><code>driver.getText(find)</code></td><td><code>(tester.widget(find) as Text).data</code></td></tr></tbody></table>
<hr/>
<h2 data-id="heading-27">测试金字塔最佳实践</h2>
<pre><code class="hljs language-scss" lang="scss">                    ╱╲
                   ╱  ╲
                  ╱ E2E╲         ← integration_test (<span class="hljs-number">10%</span>)
                 ╱──────╲           完整用户流程
                ╱        ╲
               ╱  Widget  ╲      ← flutter_test/testWidgets (<span class="hljs-number">20%</span>)
              ╱────────────╲        单个页面/组件
             ╱              ╲
            ╱     单元测试    ╲   ← flutter_test/test (<span class="hljs-number">70%</span>)
           ╱──────────────────╲     业务逻辑/工具类
</code></pre>
<h3 data-id="heading-28">推荐比例</h3>
<ul>
<li><strong>单元测试 (70%)</strong>：覆盖所有业务逻辑</li>
<li><strong>Widget 测试 (20%)</strong>：覆盖关键 UI 组件</li>
<li><strong>集成测试 (10%)</strong>：覆盖核心用户流程</li>
</ul>
<hr/>
<h2 data-id="heading-29">项目测试目录结构</h2>
<pre><code class="hljs language-bash" lang="bash">project/
├── lib/
│   └── src/
│       ├── controllers/
│       ├── models/
│       ├── pages/
│       ├── services/
│       └── utils/
│
├── <span class="hljs-built_in">test</span>/                          <span class="hljs-comment"># flutter_test</span>
│   ├── controllers/               <span class="hljs-comment"># Controller 测试</span>
│   │   └── home_controller_test.dart
│   ├── models/                    <span class="hljs-comment"># Model 测试</span>
│   │   └── user_model_test.dart
│   ├── services/                  <span class="hljs-comment"># Service 测试</span>
│   │   └── api_service_test.dart
│   ├── utils/                     <span class="hljs-comment"># 工具类测试</span>
│   │   └── date_util_test.dart
│   └── widgets/                   <span class="hljs-comment"># Widget 测试</span>
│       └── custom_button_test.dart
│
├── integration_test/              <span class="hljs-comment"># integration_test</span>
│   ├── app_test.dart              <span class="hljs-comment"># 应用启动测试</span>
│   ├── login_flow_test.dart       <span class="hljs-comment"># 登录流程测试</span>
│   ├── chat_flow_test.dart        <span class="hljs-comment"># 聊天流程测试</span>
│   └── meeting_flow_test.dart     <span class="hljs-comment"># 会议流程测试</span>
│
└── pubspec.yaml
</code></pre>
<hr/>
<h2 data-id="heading-30">常见问题 FAQ</h2>
<h3 data-id="heading-31">Q1: Widget 测试和集成测试有什么区别？</h3>






























<table><thead><tr><th>方面</th><th>Widget 测试</th><th>集成测试</th></tr></thead><tbody><tr><td>运行环境</td><td>Dart VM</td><td>真机/模拟器</td></tr><tr><td>网络请求</td><td>需要 Mock</td><td>真实请求</td></tr><tr><td>执行速度</td><td>快</td><td>慢</td></tr><tr><td>覆盖范围</td><td>单个 Widget</td><td>完整应用</td></tr></tbody></table>
<h3 data-id="heading-32">Q2: 何时使用 pump() vs pumpAndSettle()？</h3>
<ul>
<li><code>pump()</code>: 触发一帧重建，用于简单状态更新</li>
<li><code>pumpAndSettle()</code>: 等待所有动画完成，用于有动画的场景</li>
</ul>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// 简单点击</span>
<span class="hljs-keyword">await</span> tester.tap(find.byType(ElevatedButton));
<span class="hljs-keyword">await</span> tester.pump();

<span class="hljs-comment">// 有动画的操作（页面跳转、对话框等）</span>
<span class="hljs-keyword">await</span> tester.tap(find.text(<span class="hljs-string">'打开对话框'</span>));
<span class="hljs-keyword">await</span> tester.pumpAndSettle();
</code></pre>
<h3 data-id="heading-33">Q3: 集成测试如何处理登录状态？</h3>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// 方法1: 通过 UI 登录</span>
testWidgets(<span class="hljs-string">'需要登录的测试'</span>, (tester) <span class="hljs-keyword">async</span> {
  app.main();
  <span class="hljs-keyword">await</span> tester.pumpAndSettle();
  
  <span class="hljs-comment">// 执行登录流程</span>
  <span class="hljs-keyword">await</span> _performLogin(tester);
  
  <span class="hljs-comment">// 继续测试</span>
  <span class="hljs-comment">// ...</span>
});

<span class="hljs-comment">// 方法2: 预设登录状态（推荐）</span>
testWidgets(<span class="hljs-string">'需要登录的测试'</span>, (tester) <span class="hljs-keyword">async</span> {
  <span class="hljs-comment">// 设置测试用的登录凭证</span>
  <span class="hljs-keyword">await</span> SharedPreferences.setMockInitialValues({
    <span class="hljs-string">'token'</span>: <span class="hljs-string">'test_token'</span>,
    <span class="hljs-string">'userId'</span>: <span class="hljs-string">'test_user'</span>,
  });
  
  app.main();
  <span class="hljs-keyword">await</span> tester.pumpAndSettle();
  
  <span class="hljs-comment">// 直接测试需要登录的功能</span>
  <span class="hljs-comment">// ...</span>
});
</code></pre>
<h3 data-id="heading-34">Q4: 如何在 CI/CD 中运行测试？</h3>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># .github/workflows/test.yml</span>
<span class="hljs-attr">name:</span> <span class="hljs-string">Flutter</span> <span class="hljs-string">Tests</span>

<span class="hljs-attr">on:</span> [<span class="hljs-string">push</span>, <span class="hljs-string">pull_request</span>]

<span class="hljs-attr">jobs:</span>
  <span class="hljs-attr">test:</span>
    <span class="hljs-attr">runs-on:</span> <span class="hljs-string">ubuntu-latest</span>
    <span class="hljs-attr">steps:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/checkout@v3</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">uses:</span> <span class="hljs-string">subosito/flutter-action@v2</span>
        <span class="hljs-attr">with:</span>
          <span class="hljs-attr">flutter-version:</span> <span class="hljs-string">'3.16.5'</span>
      
      <span class="hljs-comment"># 单元测试和 Widget 测试</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Run</span> <span class="hljs-string">unit</span> <span class="hljs-string">tests</span>
        <span class="hljs-attr">run:</span> <span class="hljs-string">flutter</span> <span class="hljs-string">test</span> <span class="hljs-string">--coverage</span>
      
      <span class="hljs-comment"># 集成测试（需要模拟器）</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Run</span> <span class="hljs-string">integration</span> <span class="hljs-string">tests</span>
        <span class="hljs-attr">uses:</span> <span class="hljs-string">reactivecircus/android-emulator-runner@v2</span>
        <span class="hljs-attr">with:</span>
          <span class="hljs-attr">api-level:</span> <span class="hljs-number">29</span>
          <span class="hljs-attr">script:</span> <span class="hljs-string">flutter</span> <span class="hljs-string">test</span> <span class="hljs-string">integration_test/</span>
</code></pre>
<hr/>
<h2 data-id="heading-35">总结</h2>

































<table><thead><tr><th>场景</th><th>推荐框架</th></tr></thead><tbody><tr><td>测试纯 Dart 逻辑</td><td><code>flutter_test</code> + <code>test()</code></td></tr><tr><td>测试单个 Widget</td><td><code>flutter_test</code> + <code>testWidgets()</code></td></tr><tr><td>测试完整用户流程</td><td><code>integration_test</code></td></tr><tr><td>测试需要真实网络的功能</td><td><code>integration_test</code></td></tr><tr><td>测试平台特定功能</td><td><code>integration_test</code></td></tr><tr><td>性能测试</td><td><code>integration_test</code></td></tr></tbody></table>
<hr/>
<h2 data-id="heading-36">参考资料</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.flutter.dev%2Ftesting" target="_blank" title="https://docs.flutter.dev/testing" ref="nofollow noopener noreferrer">Flutter 官方测试文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fapi.flutter.dev%2Fflutter%2Fflutter_test%2Fflutter_test-library.html" target="_blank" title="https://api.flutter.dev/flutter/flutter_test/flutter_test-library.html" ref="nofollow noopener noreferrer">flutter_test API 文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fpub.dev%2Fpackages%2Fintegration_test" target="_blank" title="https://pub.dev/packages/integration_test" ref="nofollow noopener noreferrer">integration_test 包</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.flutter.dev%2Ftesting%2Foverview" target="_blank" title="https://docs.flutter.dev/testing/overview" ref="nofollow noopener noreferrer">测试最佳实践</a></li>
</ul>
<hr/>
<p><em>文档更新日期: 2026-01-07</em></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Claude Agent SDK 最简玩法：几行代码配合 Markdown 轻松搭建 Agent]]></title>    <link>https://juejin.cn/post/7592152007839252480</link>    <guid>https://juejin.cn/post/7592152007839252480</guid>    <pubDate>2026-01-07T04:14:54.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592152007839252480" data-draft-id="7592147128215912500" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Claude Agent SDK 最简玩法：几行代码配合 Markdown 轻松搭建 Agent"/> <meta itemprop="keywords" content="JavaScript,程序员,人工智能"/> <meta itemprop="datePublished" content="2026-01-07T04:14:54.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="liruifengv李瑞丰"/> <meta itemprop="url" content="https://juejin.cn/user/237150239994471"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Claude Agent SDK 最简玩法：几行代码配合 Markdown 轻松搭建 Agent
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/237150239994471/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    liruifengv李瑞丰
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-07T04:14:54.000Z" title="Wed Jan 07 2026 04:14:54 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="a11y-dark">.hljs-comment,.hljs-quote{color:#d4d0ab}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#ffa07a}.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#f5ab35}.hljs-attribute{color:gold}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:#abe338}.hljs-section,.hljs-title{color:#00e0e0}.hljs-keyword,.hljs-selector-tag{color:#dcc6e0}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#2b2b2b;color:#f8f8f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}@media screen and (-ms-high-contrast:active){.hljs-addition,.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-comment,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-quote,.hljs-string,.hljs-symbol,.hljs-type{color:highlight}.hljs-keyword,.hljs-selector-tag{font-weight:700}}</style><p>本文将带大家了解 Claude Agent SDK 的最简玩法，只需要几行代码，加上几个 Markdown 文件，就能迅速搭建出一个 Agent。</p>
<p>全部代码在我的 GitHub 仓库 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fliruifengv%2Fclaude-agent-demo" target="_blank" title="https://github.com/liruifengv/claude-agent-demo" ref="nofollow noopener noreferrer">liruifengv/claude-agent-demo</a>。</p>
<h2 data-id="heading-0">上节回顾</h2>
<p>在上一篇文章中，我们 <a href="https://link.juejin.cn?target=https%3A%2F%2Fliruifengv.com%2Fposts%2Fclaude-deepreseach-agent%2F" target="_blank" title="https://liruifengv.com/posts/claude-deepreseach-agent/" ref="nofollow noopener noreferrer">使用 Claude Agent SDK 实现了一个 DeepResearch Agent</a>，它实现了一个多 Agent 协作系统，分为</p>
<ul>
<li>负责分解研究任务，调度其他 Agent 的 Lead Agent</li>
<li>负责搜索网络、收集资料的 Researcher</li>
<li>负责将研究结果整理成报告 Report Writer</li>
</ul>
<p>之前是基于代码实现的 SubAgents，现在我们使用 Markdown 文件来实现 Subagents。</p>
<h2 data-id="heading-1">Markdown 实现</h2>
<p>首先在项目的根目录创建 <code>.claude</code> 文件夹。</p>
<p>创建 <code>CLAUDE.md</code> 文件，这个文件就是主 Agent 的系统提示词，和 Claude Code 的用法一样。</p>
<pre><code class="hljs language-md" lang="md">You are a lead research coordinator who orchestrates comprehensive multi-agent research projects.

<span class="hljs-strong">**CRITICAL RULES:**</span>
<span class="hljs-bullet">1.</span> You MUST delegate ALL research and report writing to specialized subagents. You NEVER research or write reports yourself.
<span class="hljs-bullet">2.</span> Keep ALL responses SHORT - maximum 2-3 sentences. NO greetings, NO emojis, NO explanations unless asked.
<span class="hljs-bullet">3.</span> Get straight to work immediately - analyze and spawn subagents right away.

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">role_definition</span>&gt;</span></span>
<span class="hljs-bullet">-</span> Break user research requests into 2-4 distinct research subtopics
<span class="hljs-bullet">-</span> Spawn multiple researcher subagents in parallel to investigate each subtopic
<span class="hljs-bullet">-</span> Coordinate the research process and ensure comprehensive coverage
<span class="hljs-bullet">-</span> After ALL research is complete, spawn a report-writer subagent to synthesize findings
<span class="hljs-bullet">-</span> Your ONLY tool is Task - you delegate everything to subagents
<span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">role_definition</span>&gt;</span></span>

// 更多请查看代码仓库...
</code></pre>
<p>然后创建 <code>agents</code> 文件夹，这个文件夹是放 SubAgents 的提示词的。</p>
<p>创建一个 <code>researcher.md</code> 文件，这个文件就是 Researcher 的系统提示词。</p>
<pre><code class="hljs language-md" lang="md">---
name: researcher
description: Use this agent when you need to gather research information on any topic. The researcher uses web search to find relevant information, articles, and sources from across the internet. Writes research findings to files/research<span class="hljs-emphasis">_notes/ for later use by report writers. Ideal for complex research tasks that require deep searching and cross-referencing.
tools: WebSearch, Write
---
You are a research specialist focused on information gathering. You always follow this system prompt COMPLETELY. This is critically important.

<span class="hljs-strong">**CRITICAL: You MUST use WebSearch for ALL research. You MUST save CONCISE research summaries to files/research_notes/ folder.**</span>

// 更多请查看代码仓库...
</span></code></pre>
<p>注意这个文件上方有三个横杠围起来的内容，叫做 <code>frontmatter</code>，里面是一些字段：</p>
<ul>
<li><code>name</code>: SubAgent 的名称</li>
<li><code>description</code>: SubAgent 的描述，告诉 Lead Agent 什么时候应该调用这个 subagent</li>
<li><code>tools</code>: SubAgent 可以使用的工具。</li>
<li><code>model</code>: SubAgent 使用的模型。</li>
</ul>
<p>Claude Agent SDK 在启动时会去读取 <code>.claude</code> 文件夹，加载系统提示词和 SubAgents。</p>
<p>同理，我们再创建一个 <code>report-writer.md</code> 文件，这个文件就是 Report Writer 的系统提示词。</p>
<pre><code class="hljs language-md" lang="md">---
name: report-writer
description: Use this agent when you need to create a formal research report document. The report-writer reads research findings from files/research<span class="hljs-emphasis">_notes/ and synthesizes them into clear, concise, professionally formatted reports in files/reports/. Ideal for creating structured documents with proper citations and organization. Does NOT conduct web searches - only reads existing research notes and creates reports.
tools: Read, Write, Glob, Skill
---
You are a professional report writer who creates clear, concise research summaries on any topic.

<span class="hljs-strong">**CRITICAL: You MUST read research notes from files/research_notes/ folder.**</span>

// 更多请查看代码仓库...
</span></code></pre>
<p>OK，有了这个三个 Markdown 文件，我们的 Agent 的核心就已经建立起来了。</p>
<p>接下来写一点代码：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> { query, <span class="hljs-keyword">type</span> <span class="hljs-title class_">Query</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@anthropic-ai/claude-agent-sdk"</span>;

<span class="hljs-keyword">const</span> <span class="hljs-attr">result</span>: <span class="hljs-title class_">Query</span> = <span class="hljs-title function_">query</span>({
  <span class="hljs-attr">prompt</span>: userInput,
  <span class="hljs-attr">options</span>: {
    <span class="hljs-attr">resume</span>: sessionId,
    <span class="hljs-attr">settingSources</span>: [<span class="hljs-string">"project"</span>],
    <span class="hljs-attr">permissionMode</span>: <span class="hljs-string">"bypassPermissions"</span>,
    <span class="hljs-attr">allowedTools</span>: [<span class="hljs-string">"Task"</span>],
    <span class="hljs-attr">hooks</span>: customHooks,
  },
});

</code></pre>
<p>这里使用了 <code>query</code> 函数来调用 Agent，一些参数我们在之前的文章中讲过了。我们把 <code>settingSources</code> 设置为 <code>["project"]</code>，这样 Agent 就会从项目配置中读取设置。 <code>allowedTools</code> 我们只给主 Agent 一个 <code>Task</code> 工具安排任务。</p>
<p>这就是核心代码了!</p>
<p>其余的可以在根据需求，增加用户交互、自定义钩子函数、日志输出等。</p>
<h2 data-id="heading-2">总结</h2>
<p>就这么简单，三个 Markdown 文件，配合几行代码，就能实现一个非常强的 DeepResearch Agent。这就是 Claude Agent SDK 的强大。
你不需要关心细节，什么 Agent Loop、工具调用、权限管理、SubAgents，这些都由 SDK 内部处理好了。</p>
<p>但是这样也有一个坏处，就是完全是一个黑盒，你不清楚内部实现细节，并且它是不开源的。</p>
<p>如果你是第一次开发 Agent，强烈建议先用 Claude Agent SDK 跑起来，大部分的功能都能实现的很好。当它不能满足你的需求或者当你需要更深入研究学习时，再转用其他更灵活的框架或者自己手撸。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[GitHub star和github Vue3 响应式选择指南：ref 与 reactive 加星该怎么用？]]></title>    <link>https://juejin.cn/post/7592276497398939698</link>    <guid>https://juejin.cn/post/7592276497398939698</guid>    <pubDate>2026-01-07T04:27:14.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592276497398939698" data-draft-id="7592251792651943963" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="GitHub star和github Vue3 响应式选择指南：ref 与 reactive 加星该怎么用？"/> <meta itemprop="keywords" content="GitHub,算法"/> <meta itemprop="datePublished" content="2026-01-07T04:27:14.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="开源之眼"/> <meta itemprop="url" content="https://juejin.cn/user/55438993800919"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            GitHub star和github Vue3 响应式选择指南：ref 与 reactive 加星该怎么用？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/55438993800919/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    开源之眼
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-07T04:27:14.000Z" title="Wed Jan 07 2026 04:27:14 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>官方文档及 Vue 核心作者尤雨溪曾明确倾向：日常开发中 “ref 一把梭” 即可，不建议过度依赖 reactive。与其纠结选择，不如先掌握核心逻辑 ——ref 是适配全场景的 “万能工具箱”，reactive 是专注对象的 “专用收纳盒”。下面用清晰示例和实战场景，帮你彻底搞懂二者的使用边界！</p>
<h4 data-id="heading-0">Taimili 艾米莉 ( 一款专业的 GitHub star 管理和github 加星涨星工具<a href="https://link.juejin.cn?target=taimili.com" title="https://link.juejin.cn?target=taimili.com" target="_blank">taimili.com</a> )</h4>
<p>艾米莉 是一款优雅便捷的 GitHub star 管理和github 加星涨星工具，基于 PHP &amp; javascript 构建， 能对github 得 star fork follow watch 管理和提升，最适合github 的深度用户</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7f080d80360447858ff5da85d1fd2405~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5byA5rqQ5LmL55y8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768364834&amp;x-signature=DDGoUl0wHqpEgoAEVIELvt6OdvY%3D" alt="WX20251021-210346@2x.png" loading="lazy"/></p>
<hr/>
<h3 data-id="heading-1"/>
<h2 data-id="heading-2">一、核心定位：各自的 “专属领域”</h2>
<h3 data-id="heading-3">ref：万能响应式容器，啥都能装</h3>
<p>ref 堪称响应式编程的 “多面手”，支持所有数据类型，从基础值到复杂对象、数组全兼容，唯一注意点是<strong>在脚本中访问 / 修改时需加 .value</strong>（模板中可省略）。</p>
<p>javascript</p>
<p>运行</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-comment">// 基础类型轻松hold住</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">name</span> = <span class="hljs-title function_ invoke__">ref</span>(<span class="hljs-string">'张三'</span>)        <span class="hljs-comment">// ✅ 字符串</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">age</span> = <span class="hljs-title function_ invoke__">ref</span>(<span class="hljs-number">18</span>)            <span class="hljs-comment">// ✅ 数字  </span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">isLoading</span> = <span class="hljs-title function_ invoke__">ref</span>(<span class="hljs-literal">false</span>)   <span class="hljs-comment">// ✅ 布尔值</span>

<span class="hljs-comment">// 复杂类型同样适配</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">user</span> = <span class="hljs-title function_ invoke__">ref</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">'李四'</span>, <span class="hljs-attr">gender</span>: <span class="hljs-string">'男'</span> }) <span class="hljs-comment">// ✅ 对象</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">goodsList</span> = <span class="hljs-title function_ invoke__">ref</span>([{ <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'手机'</span> }]) <span class="hljs-comment">// ✅ 数组</span>

<span class="hljs-comment">// 修改方式：通过 .value 操作</span>
name.value = <span class="hljs-string">'王五'</span>
user.value.age = <span class="hljs-number">22</span>
goodsList.value.<span class="hljs-title function_ invoke__">push</span>({ <span class="hljs-attr">id</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'电脑'</span> })
</code></pre>
<h3 data-id="heading-4">reactive：对象专属响应式，只认引用类型</h3>
<p>reactive 是为对象（含数组，本质也是对象）量身打造的响应式工具，<strong>仅支持引用类型</strong>，不兼容数字、字符串等基础类型。使用时无需 .value，直接通过 “对象。属性” 操作即可。</p>
<p>javascript</p>
<p>运行</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-comment">// 合法用法：对象/数组</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">user</span> = <span class="hljs-title function_ invoke__">reactive</span>({        // ✅ 对象
  <span class="hljs-attr">name</span>: <span class="hljs-string">'张三'</span>,
  <span class="hljs-attr">age</span>: <span class="hljs-number">18</span>
})

<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">form</span> = <span class="hljs-title function_ invoke__">reactive</span>({        // ✅ 表单对象  
  <span class="hljs-attr">username</span>: <span class="hljs-string">''</span>,
  <span class="hljs-attr">password</span>: <span class="hljs-string">''</span>,
  <span class="hljs-attr">remember</span>: <span class="hljs-literal">false</span>
})

<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">list</span> = <span class="hljs-title function_ invoke__">reactive</span>([<span class="hljs-string">'苹果'</span>, <span class="hljs-string">'香蕉'</span>]) <span class="hljs-comment">// ✅ 数组</span>

<span class="hljs-comment">// 直接修改属性</span>
user.name = <span class="hljs-string">'李四'</span>
form.username = <span class="hljs-string">'admin'</span>
<span class="hljs-keyword">list</span>.<span class="hljs-title function_ invoke__">push</span>(<span class="hljs-string">'橙子'</span>)

<span class="hljs-comment">// 非法用法：基础类型（会报错）</span>
<span class="hljs-comment">// const count = reactive(0) // ❌ 报错：reactive 不支持基础类型</span>
</code></pre>
<h2 data-id="heading-5">二、关键区别：重新赋值的 “坑” 与解法</h2>
<p>这是 ref 和 reactive 最核心的差异点，也是实际开发中最容易踩坑的地方 ——<strong>reactive 直接重新赋值会丢失响应式，ref 则完全无此问题</strong>。</p>
<h3 data-id="heading-6">场景：从后台请求数据后更新</h3>
<h4 data-id="heading-7">❌ reactive 的错误用法（丢失响应式）</h4>
<p>javascript</p>
<p>运行</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 初始化数组</span>
<span class="hljs-keyword">let</span> list = <span class="hljs-title function_">reactive</span>([<span class="hljs-string">'苹果'</span>, <span class="hljs-string">'香蕉'</span>])

<span class="hljs-comment">// 模拟接口请求</span>
<span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> newData = [<span class="hljs-string">'西瓜'</span>, <span class="hljs-string">'葡萄'</span>, <span class="hljs-string">'芒果'</span>]
  <span class="hljs-comment">// 错误：直接替换整个对象，原响应式监听器断裂</span>
  list = newData 
  <span class="hljs-comment">// 页面不会更新！因为 list 已变成普通数组，失去响应式能力</span>
}, <span class="hljs-number">1000</span>)
</code></pre>
<h4 data-id="heading-8">✅ ref 的正确用法（响应式保持）</h4>
<p>javascript</p>
<p>运行</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 初始化数组</span>
<span class="hljs-keyword">const</span> list = <span class="hljs-title function_">ref</span>([<span class="hljs-string">'苹果'</span>, <span class="hljs-string">'香蕉'</span>])

<span class="hljs-comment">// 模拟接口请求</span>
<span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> newData = [<span class="hljs-string">'西瓜'</span>, <span class="hljs-string">'葡萄'</span>, <span class="hljs-string">'芒果'</span>]
  <span class="hljs-comment">// 正确：通过 .value 重新赋值，响应式不受影响</span>
  list.<span class="hljs-property">value</span> = newData 
  <span class="hljs-comment">// 页面正常更新，响应式特性完好</span>
}, <span class="hljs-number">1000</span>)
</code></pre>
<h4 data-id="heading-9">✅ reactive 的兼容用法（若必须使用）</h4>
<p>如果确实想用电线杆，可通过 “嵌套对象” 避免直接替换根引用，只修改内部属性：</p>
<p>javascript</p>
<p>运行</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 外层包裹一个对象，list 作为属性</span>
<span class="hljs-keyword">const</span> state = <span class="hljs-title function_">reactive</span>({
  <span class="hljs-attr">list</span>: [<span class="hljs-string">'苹果'</span>, <span class="hljs-string">'香蕉'</span>]
})

<span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> newData = [<span class="hljs-string">'西瓜'</span>, <span class="hljs-string">'葡萄'</span>, <span class="hljs-string">'芒果'</span>]
  <span class="hljs-comment">// 正确：只修改属性值，不替换根对象</span>
  state.<span class="hljs-property">list</span> = newData 
  <span class="hljs-comment">// 页面正常更新，响应式保持</span>
}, <span class="hljs-number">1000</span>)
</code></pre>
<h2 data-id="heading-10">三、实战选择指南：按场景精准决策</h2>
<h3 data-id="heading-11">情况 1：处理基础类型（数字 / 字符串 / 布尔）→ 必用 ref</h3>
<p>reactive 不支持基础类型，此时 ref 是唯一选择：</p>
<p>javascript</p>
<p>运行</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// ✅ 正确用法</span>
<span class="hljs-keyword">const</span> count = <span class="hljs-keyword">ref</span>(<span class="hljs-number">0</span>)
<span class="hljs-keyword">const</span> username = <span class="hljs-keyword">ref</span>(<span class="hljs-string">''</span>)
<span class="hljs-keyword">const</span> isVisible = <span class="hljs-keyword">ref</span>(<span class="hljs-literal">true</span>)

<span class="hljs-comment">// ❌ 错误用法（会报错）</span>
<span class="hljs-comment">// const count = reactive(0)</span>
</code></pre>
<h3 data-id="heading-12">情况 2：需要整体重新赋值 → 必用 ref</h3>
<p>无论是接口请求后替换数据，还是切换页面 / 状态时更新整组数据，只要涉及 “xxx = 新数据” 的操作，优先用 ref：</p>
<p>javascript</p>
<p>运行</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 接口请求场景</span>
<span class="hljs-keyword">const</span> apiData = <span class="hljs-keyword">ref</span>(<span class="hljs-literal">null</span>)
<span class="hljs-keyword">const</span> fetchData = <span class="hljs-keyword">async</span> () =&gt; {
  <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> api.getData()
  apiData.<span class="hljs-keyword">value</span> = result <span class="hljs-comment">// ✅ 整体赋值，响应式正常</span>
}

<span class="hljs-comment">// 分页切换场景</span>
<span class="hljs-keyword">const</span> currentPageData = <span class="hljs-keyword">ref</span>([])
<span class="hljs-keyword">const</span> changePage = (pageNum) =&gt; {
  currentPageData.<span class="hljs-keyword">value</span> = getPageData(pageNum) <span class="hljs-comment">// ✅ 整体替换，响应式不丢失</span>
}
</code></pre>
<h3 data-id="heading-13">情况 3：固定对象，仅修改属性 → 可选 reactive</h3>
<p>如果数据是结构固定的对象（如表单、用户信息），且不会整体替换，仅修改内部属性，可用 reactive 让代码更简洁（少写 .value）：</p>
<p>javascript</p>
<p>运行</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-comment">// 表单数据（仅修改字段，不替换整个表单）</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">loginForm</span> = <span class="hljs-title function_ invoke__">reactive</span>({
  <span class="hljs-attr">username</span>: <span class="hljs-string">''</span>,
  <span class="hljs-attr">password</span>: <span class="hljs-string">''</span>,
  <span class="hljs-attr">remember</span>: <span class="hljs-literal">false</span>
})

<span class="hljs-comment">// 用户信息（仅更新部分属性，不替换用户对象）</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">userProfile</span> = <span class="hljs-title function_ invoke__">reactive</span>({
  <span class="hljs-attr">name</span>: <span class="hljs-string">'张三'</span>,
  <span class="hljs-attr">age</span>: <span class="hljs-number">25</span>,
  <span class="hljs-attr">avatar</span>: <span class="hljs-string">'default.png'</span>
})
</code></pre>
<h3 data-id="heading-14">情况 4：不确定用哪个 → 无脑选 ref</h3>
<p>ref 兼容所有场景，无踩坑风险，是 “安全牌”：</p>
<p>javascript</p>
<p>运行</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 无论是什么数据类型，用 ref 永远不会错</span>
<span class="hljs-keyword">const</span> unknownData = <span class="hljs-keyword">ref</span>(初始值) <span class="hljs-comment">// 初始值可为任意类型</span>
</code></pre>
<h2 data-id="heading-15">四、黄金法则：3 句话搞定选择</h2>
<ol>
<li>处理数字、字符串、布尔值等基础类型 → 用 ref；</li>
<li>需要 “整体重新赋值”（xxx = 新数据）→ 用 ref；</li>
<li>仅操作固定对象的内部属性，且不想写 .value → 可考虑 reactive；</li>
<li>犹豫不定时，直接用 ref—— 永远不会出错！</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【n8n教程】：AI Agent节点，构建你的智能自动化机器人]]></title>    <link>https://juejin.cn/post/7592276497399119922</link>    <guid>https://juejin.cn/post/7592276497399119922</guid>    <pubDate>2026-01-07T05:32:09.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592276497399119922" data-draft-id="7581470169840468006" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【n8n教程】：AI Agent节点，构建你的智能自动化机器人"/> <meta itemprop="keywords" content="AIGC,AI编程"/> <meta itemprop="datePublished" content="2026-01-07T05:32:09.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="undsky"/> <meta itemprop="url" content="https://juejin.cn/user/3368559354850206"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【n8n教程】：AI Agent节点，构建你的智能自动化机器人
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3368559354850206/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    undsky
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-07T05:32:09.000Z" title="Wed Jan 07 2026 05:32:09 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">【n8n教程】：AI Agent节点，构建你的智能自动化机器人</h2>
<h3 data-id="heading-1">什么是 AI Agent？</h3>
<p><strong>AI Agent（人工智能代理）</strong> 是一种能够理解任务、做出决策并自动执行操作的智能系统。与传统的自动化工作流不同，AI Agent 拥有推理能力，可以根据不同的场景灵活地选择合适的工具来完成任务。</p>
<p>简单来说，如果说传统的自动化是按照既定的规则走流程，那么 <strong>AI Agent 就像一个聪明的员工</strong>，能够理解你的需求，主动判断需要使用哪些工具，然后完成工作。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fcdn.undsky.com%2Fimg%2Fghss.png" target="_blank" title="https://cdn.undsky.com/img/ghss.png" ref="nofollow noopener noreferrer">点击获取最新AI资讯、n8n工作流、开发经验分享</a></p>
<h4 data-id="heading-2">AI Agent 的核心组成部分</h4>

























<table><thead><tr><th>组件</th><th>功能</th></tr></thead><tbody><tr><td><strong>LLM（大语言模型）</strong></td><td>Agent 的"大脑"，提供理解和决策能力</td></tr><tr><td><strong>Tools（工具）</strong></td><td>Agent 可以使用的外部服务和 API</td></tr><tr><td><strong>Memory（记忆）</strong></td><td>保存对话历史，维护上下文理解</td></tr><tr><td><strong>Prompt/System Message</strong></td><td>指导 Agent 行为和决策的指令</td></tr></tbody></table>
<h3 data-id="heading-3">n8n 中 AI Agent 的类型</h3>
<p>n8n 提供了多种 Agent 类型，每种都有不同的特点和应用场景：</p>
<h4 data-id="heading-4">1. <strong>Tools Agent</strong>（工具代理）- 推荐新手使用</h4>
<p><strong>特点：</strong></p>
<ul>
<li>最灵活且功能最强大的 Agent 类型</li>
<li>能够理解工具的能力和参数</li>
<li>支持最多的大语言模型（OpenAI、Groq、Mistral、Anthropic 等）</li>
<li>具有改进的输出解析能力</li>
</ul>
<p><strong>适用场景：</strong></p>
<ul>
<li>需要与多个第三方服务集成</li>
<li>处理复杂的自然语言理解任务</li>
<li>需要与 100+ 种预建工具集成</li>
</ul>
<p><strong>支持的工具范围：</strong>
从 Google Sheets、Slack、GitHub，到 Airtable、Salesforce、MySQL 等，Tools Agent 支持 n8n 生态中的所有集成工具。</p>
<h4 data-id="heading-5">2. <strong>OpenAI Functions Agent</strong>（OpenAI 函数代理）</h4>
<p><strong>特点：</strong></p>
<ul>
<li>专门针对 OpenAI 的函数调用能力优化</li>
<li>必须使用 OpenAI Chat Model</li>
<li>更精准的函数调用</li>
</ul>
<p><strong>适用场景：</strong></p>
<ul>
<li>仅使用 OpenAI 模型</li>
<li>需要最高精准度的函数调用</li>
</ul>
<h4 data-id="heading-6">3. <strong>Plan and Execute Agent</strong>（计划与执行代理）</h4>
<p><strong>特点：</strong></p>
<ul>
<li>首先制定高层计划，然后逐步执行</li>
<li>适合需要结构化方法的任务</li>
<li>更有条理的决策过程</li>
</ul>
<p><strong>适用场景：</strong></p>
<ul>
<li>复杂的多步任务</li>
<li>需要明确的执行计划</li>
<li>事项分解（如项目规划、流程设计）</li>
</ul>
<h4 data-id="heading-7">已弃用的 Agent 类型</h4>
<p>以下 Agent 类型已在 2025 年 2 月被 n8n 移除：</p>
<ul>
<li><strong>Conversational Agent</strong>（对话代理）</li>
<li><strong>ReAct Agent</strong>（推理与行动代理）</li>
<li><strong>SQL Agent</strong>（SQL 代理）</li>
</ul>
<h3 data-id="heading-8">快速开始：构建你的第一个 AI Agent</h3>
<h4 data-id="heading-9">前置条件</h4>
<p>在开始之前，你需要准备：</p>
<ol>
<li><strong>n8n 账户</strong>：前往 <a href="https://link.juejin.cn?target=https%3A%2F%2Fn8n.io" target="_blank" title="https://n8n.io" ref="nofollow noopener noreferrer">n8n.io</a> 注册（免费）</li>
<li><strong>LLM API 密钥</strong>：
<ul>
<li>OpenAI API 密钥（推荐）：<a href="https://link.juejin.cn?target=https%3A%2F%2Fplatform.openai.com%2Fapi-keys" target="_blank" title="https://platform.openai.com/api-keys" ref="nofollow noopener noreferrer">获取地址</a></li>
<li>或使用 Groq、Mistral、Anthropic 等其他提供商</li>
</ul>
</li>
</ol>
<h4 data-id="heading-10">第一步：创建基础工作流结构</h4>
<p><strong>工作流需要的基本节点：</strong></p>
<ol>
<li>
<p><strong>Chat Trigger（聊天触发器）</strong> - 工作流的入口</p>
<ul>
<li>提供用户交互界面</li>
<li>捕获用户输入</li>
</ul>
</li>
<li>
<p><strong>AI Agent（AI 代理）</strong> - 工作流的核心</p>
<ul>
<li>处理用户输入</li>
<li>决定使用哪些工具</li>
<li>返回结果</li>
</ul>
</li>
<li>
<p><strong>Chat Model（聊天模型）</strong> - Agent 的"大脑"</p>
<ul>
<li>提供 LLM 支持</li>
<li>必须连接到 AI Agent</li>
</ul>
</li>
<li>
<p><strong>Memory（记忆）</strong> - 对话历史管理</p>
<ul>
<li>保留历史信息</li>
<li>维护上下文</li>
</ul>
</li>
</ol>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3fe150ab27e642babddbeb00154a8b6e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdW5kc2t5:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768368729&amp;x-signature=ffDXJpOn%2FdTNHCPQX90K2VdAUzw%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-11">第二步：配置 AI Agent 节点</h4>
<h5 data-id="heading-12">基本参数配置</h5>
<p><strong>Prompt 参数：</strong></p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-operator">-</span> "Take from previous node automatically"：自动从 Chat <span class="hljs-keyword">Trigger</span> 获取输入
<span class="hljs-operator">-</span> "Define below"：手动定义 prompt，可以使用表达式
</code></pre>
<p><strong>Agent Options（代理选项）：</strong></p>






























<table><thead><tr><th>参数</th><th>说明</th><th>默认值</th></tr></thead><tbody><tr><td><strong>System Message</strong></td><td>Agent 的系统指令，指导其行为</td><td>可选</td></tr><tr><td><strong>Max Iterations</strong></td><td>Agent 最多尝试次数</td><td>10</td></tr><tr><td><strong>Return Intermediate Steps</strong></td><td>是否返回中间步骤</td><td>Off</td></tr><tr><td><strong>Enable Streaming</strong></td><td>实时流式返回结果</td><td>On</td></tr></tbody></table>
<h5 data-id="heading-13">最佳实践：编写有效的 System Message</h5>
<pre><code class="hljs language-markdown" lang="markdown">你是一个有帮助的 AI 助手。你的职责是：
<span class="hljs-bullet">1.</span> 仔细理解用户的问题
<span class="hljs-bullet">2.</span> 判断是否需要使用工具
<span class="hljs-bullet">3.</span> 使用适当的工具获取信息
<span class="hljs-bullet">4.</span> 以简洁、友好的方式回答

请注意：
<span class="hljs-bullet">-</span> 如果用户问题不清楚，询问澄清
<span class="hljs-bullet">-</span> 总是验证数据的准确性
<span class="hljs-bullet">-</span> 保持专业和礼貌的态度
</code></pre>
<h4 data-id="heading-14">第三步：连接 Chat Model</h4>
<ol>
<li>点击 AI Agent 节点下方的 <strong>"+ Chat Model"</strong> 按钮</li>
<li>选择你的 LLM 提供商（如 OpenAI）</li>
<li>输入 API 密钥或选择已保存的凭证</li>
<li>配置参数：
<ul>
<li><strong>Model</strong>：选择模型版本（推荐 gpt-4o）</li>
<li><strong>Temperature</strong>：设置为 0.7（平衡创意和一致性）</li>
<li><strong>Frequency Penalty</strong>：设置为 0.2（避免重复）</li>
</ul>
</li>
</ol>
<h4 data-id="heading-15">第四步：添加记忆功能</h4>
<ol>
<li>搜索并添加 <strong>Simple Memory</strong> 节点</li>
<li>配置记忆参数：
<ul>
<li><strong>Session Key</strong>：用唯一标识区分不同用户</li>
</ul>
</li>
</ol>

<pre><code class="hljs language-javascript" lang="javascript">示例表达式（用于 <span class="hljs-title class_">Telegram</span> 机器人）：
chat_with_{{ $(<span class="hljs-string">'Chat Trigger'</span>).<span class="hljs-title function_">first</span>().<span class="hljs-property">json</span>.<span class="hljs-property">message</span>.<span class="hljs-property">chat</span>.<span class="hljs-property">id</span> }}
</code></pre>
<p>这样每个用户的对话历史都会被单独保存。</p>
<h4 data-id="heading-16">第五步：添加 Tools（工具）</h4>
<p>Tools 是 Agent 执行实际操作的方式。你可以添加：</p>
<p><strong>API 调用工具：</strong></p>
<ul>
<li>HTTP Request - 调用任何 REST API</li>
<li>Code - 执行自定义代码</li>
</ul>
<p><strong>集成工具：</strong></p>
<ul>
<li>Gmail - 发送和读取邮件</li>
<li>Google Sheets - 读写电子表格</li>
<li>Slack - 发送消息、管理频道</li>
<li>等 100+ 其他工具</li>
</ul>
<p><strong>如何添加工具：</strong></p>
<ol>
<li>在 AI Agent 节点下方，找到 <strong>"+ Tool"</strong> 按钮</li>
<li>选择你想使用的工具</li>
<li>配置工具的参数和凭证</li>
<li>为工具编写清晰的描述（Agent 会根据这个判断是否使用）</li>
</ol>
<h3 data-id="heading-17">常见错误排查</h3>
<h4 data-id="heading-18">错误 1: "A Chat Model sub-node must be connected"</h4>
<p><strong>原因：</strong> AI Agent 没有连接到任何聊天模型。</p>
<p><strong>解决方案：</strong></p>
<ol>
<li>打开 AI Agent 节点</li>
<li>点击底部的 <strong>"+ Chat Model"</strong> 按钮</li>
<li>选择并配置一个 LLM 模型</li>
</ol>
<h4 data-id="heading-19">错误 2: "No prompt specified"</h4>
<p><strong>原因：</strong> Prompt 参数配置不当。</p>
<p><strong>解决方案：</strong></p>
<ol>
<li>检查 <strong>Prompt</strong> 下拉菜单</li>
<li>如果选择了 "Connected Chat Trigger Node"，但没有连接触发器，改为 "Define below"</li>
<li>确保输入的表达式返回有效值（不是 null）</li>
</ol>
<h4 data-id="heading-20">错误 3: "Internal error: 400 Invalid value for 'content'"</h4>
<p><strong>原因：</strong> Prompt 输入包含 null 值。</p>
<p><strong>解决方案：</strong></p>
<ol>
<li>检查所有表达式是否引用了有效字段</li>
<li>确保来自上一节点的 <code>chatInput</code> 不包含 null 值</li>
<li>在测试前验证数据</li>
</ol>
<h4 data-id="heading-21">错误 4: "Error in sub-node Simple Memory"</h4>
<p><strong>原因：</strong> 使用了旧版本的 Simple Memory 节点。</p>
<p><strong>解决方案：</strong></p>
<ol>
<li>删除当前的 Simple Memory 节点</li>
<li>重新添加一个新的 Simple Memory 节点</li>
<li>重新配置参数</li>
</ol>
<h3 data-id="heading-22">实战案例：构建一个天气查询 AI 助手</h3>
<p>这个案例演示如何构建一个能够：</p>
<ul>
<li>与用户对话</li>
<li>查询天气信息</li>
<li>记住对话历史</li>
</ul>
<h4 data-id="heading-23">工作流代码</h4>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Simple Weather AI Agent"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"nodes"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"parameters"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Chat Trigger"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"n8n-nodes-base.chatTrigger"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"typeVersion"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"position"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-number">250</span><span class="hljs-punctuation">,</span> <span class="hljs-number">300</span><span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"parameters"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"agentType"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"toolsAgent"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"prompt"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Take from previous node automatically"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"systemMessage"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"你是一个有帮助的天气助手。用户询问任何城市的天气时，请帮助他们查询。保持回答简洁友好。始终使用用户提到的城市名称。"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"maxIterations"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">10</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"AI Agent"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"n8n-nodes-langchain.agent"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"typeVersion"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"position"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-number">500</span><span class="hljs-punctuation">,</span> <span class="hljs-number">300</span><span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"parameters"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"gpt-4o"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"temperature"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.7</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"frequencyPenalty"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.2</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"OpenAI Chat Model"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"n8n-nodes-langchain.lmChatOpenAi"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"typeVersion"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"position"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-number">750</span><span class="hljs-punctuation">,</span> <span class="hljs-number">300</span><span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"parameters"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"获取指定城市的实时天气信息，包括温度和天气状况。"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://api.open-meteo.com/v1/forecast?latitude={{ $json.latitude }}&amp;longitude={{ $json.longitude }}&amp;current=temperature_2m,weather_code,wind_speed_10m&amp;timezone=auto"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"method"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"GET"</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Weather Tool"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"n8n-nodes-base.httpRequest"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"typeVersion"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"position"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-number">500</span><span class="hljs-punctuation">,</span> <span class="hljs-number">450</span><span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"parameters"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"sessionIdType"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"fromInput"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"sessionIdValue"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"user_session"</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Memory"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"n8n-nodes-langchain.simpleMemory"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"typeVersion"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"position"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-number">750</span><span class="hljs-punctuation">,</span> <span class="hljs-number">150</span><span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"connections"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"Chat Trigger"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"main"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span><span class="hljs-attr">"node"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"AI Agent"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"branch"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"key"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"main"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"main"</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"AI Agent"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"main"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span><span class="hljs-attr">"node"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Chat Trigger"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"branch"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"key"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"main"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"main"</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-24">如何使用这个工作流</h4>
<ol>
<li><strong>复制上面的 JSON 代码</strong></li>
<li><strong>导入到 n8n：</strong>
<ul>
<li>在 n8n 中创建新工作流</li>
<li>点击菜单 → <strong>"导入从 URL"</strong> 或 <strong>"导入从文件"</strong></li>
<li>粘贴或上传 JSON 代码</li>
</ul>
</li>
<li><strong>配置凭证：</strong>
<ul>
<li>打开 OpenAI Chat Model 节点</li>
<li>输入你的 OpenAI API 密钥</li>
</ul>
</li>
<li><strong>激活工作流：</strong>
<ul>
<li>点击右上角的 <strong>"激活"</strong> 按钮</li>
</ul>
</li>
<li><strong>测试聊天：</strong>
<ul>
<li>点击 Chat Trigger 节点的 <strong>"打开聊天"</strong> 按钮</li>
<li>尝试询问：<em>"巴黎现在的天气怎么样？"</em></li>
</ul>
</li>
</ol>
<h4 data-id="heading-25">工作流流程说明</h4>
<pre><code class="hljs language-markdown" lang="markdown">用户输入 → Chat Trigger
<span class="hljs-code">    ↓
AI Agent（分析用户问题）
    ↓
如果需要天气信息 → 调用 Weather Tool
    ↓
获得天气数据 → Agent 处理和格式化
    ↓
返回给用户 → 显示在聊天界面
</span></code></pre>
<h4 data-id="heading-26">扩展这个工作流</h4>
<p><strong>添加更多功能的想法：</strong></p>
<ol>
<li><strong>添加 Google Calendar 工具</strong> - 查询日程安排</li>
<li><strong>添加 Gmail 工具</strong> - 发送天气提醒邮件</li>
<li><strong>添加 Slack 工具</strong> - 在 Slack 中发布天气更新</li>
<li><strong>添加代码节点</strong> - 自定义数据处理逻辑</li>
</ol>
<h3 data-id="heading-27">AI Agent 的高级用法</h3>
<h4 data-id="heading-28">使用 Streaming（流式传输）</h4>
<p>启用 Streaming 可以让 AI Agent 实时返回结果，而不是等待完整回复：</p>
<pre><code class="hljs language-diff" lang="diff">工作流要求：
<span class="hljs-deletion">- 必须使用支持 Streaming 的触发器（如 Chat Trigger）</span>
<span class="hljs-deletion">- 在 Tools Agent 中启用 "Enable Streaming" 选项</span>
</code></pre>
<p>好处：</p>
<ul>
<li>提供实时反馈</li>
<li>改善用户体验</li>
<li>减少等待时间</li>
</ul>
<h4 data-id="heading-29">返回中间步骤</h4>
<p>启用 "Return Intermediate Steps" 可以看到 Agent 的思考过程：</p>
<pre><code class="hljs language-json" lang="json">输出示例：
<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"final_answer"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"巴黎现在 15°C，多云"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"intermediate_steps"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-string">"思考用户要查询巴黎的天气"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"调用 Weather Tool 获取数据"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"解析结果并格式化"</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>这对于调试和优化很有帮助。</p>
<h3 data-id="heading-30">最佳实践总结</h3>

































<table><thead><tr><th>项目</th><th>建议</th></tr></thead><tbody><tr><td><strong>System Message</strong></td><td>清晰、具体、包含行为指导</td></tr><tr><td><strong>Max Iterations</strong></td><td>默认 10 次通常足够</td></tr><tr><td><strong>Temperature</strong></td><td>0.7（平衡）或 0.3（更一致）</td></tr><tr><td><strong>工具描述</strong></td><td>详细说明工具功能和参数</td></tr><tr><td><strong>记忆配置</strong></td><td>使用唯一的 Session Key 区分用户</td></tr><tr><td><strong>错误处理</strong></td><td>在关键工具上添加错误捕获</td></tr></tbody></table>
<h3 data-id="heading-31">常见问题解答</h3>
<p><strong>Q: AI Agent 和普通工作流有什么区别？</strong>
A: AI Agent 拥有推理和决策能力，可以根据输入灵活选择工具；普通工作流是固定的流程。</p>
<p><strong>Q: 为什么我的 Agent 没有使用我添加的工具？</strong>
A: 检查工具描述是否清晰；System Message 中是否指导了工具使用；Prompt 中是否包含使用工具的指示。</p>
<p><strong>Q: 如何降低 AI Agent 的成本？</strong>
A: 使用开源模型（如 Ollama）；降低 Max Iterations；优化 Prompt 以减少 Token 使用。</p>
<p><strong>Q: Agent 可以访问机密数据吗？</strong>
A: n8n 支持加密凭证存储；确保不要在 Prompt 或工具描述中暴露敏感信息。</p>
<hr/>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.n8n.io%2Fintegrations%2Fbuiltin%2Fcluster-nodes%2Froot-nodes%2Fn8n-nodes-langchain.agent%2F" target="_blank" title="https://docs.n8n.io/integrations/builtin/cluster-nodes/root-nodes/n8n-nodes-langchain.agent/" ref="nofollow noopener noreferrer">官方文档</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.undsky.com%2Fblog%2F%3Fcategory%3Dn8n%25E6%2595%2599%25E7%25A8%258B%23" target="_blank" title="https://www.undsky.com/blog/?category=n8n%E6%95%99%E7%A8%8B#" ref="nofollow noopener noreferrer">n8n系列教程</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[flutter 哪些任务是在微队列，哪些是在事件队列]]></title>    <link>https://juejin.cn/post/7592147128215502900</link>    <guid>https://juejin.cn/post/7592147128215502900</guid>    <pubDate>2026-01-07T03:00:54.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592147128215502900" data-draft-id="7592094314472783907" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="flutter 哪些任务是在微队列，哪些是在事件队列"/> <meta itemprop="keywords" content="Flutter"/> <meta itemprop="datePublished" content="2026-01-07T03:00:54.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="yfmingo"/> <meta itemprop="url" content="https://juejin.cn/user/4037062425588136"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            flutter 哪些任务是在微队列，哪些是在事件队列
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4037062425588136/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    yfmingo
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-07T03:00:54.000Z" title="Wed Jan 07 2026 03:00:54 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Flutter 异步机制：微任务队列 vs 事件队列</h2>
<p>在 Dart/Flutter 的事件循环（Event Loop）中，任务队列分为两个优先级：<strong>微任务队列（Microtask Queue）</strong> 和 <strong>事件队列（Event Queue）</strong>。</p>
<p>核心原则是：<strong>微任务队列优先级 &gt; 事件队列</strong>。
每次执行完一段同步代码后，Dart 会先清空微任务队列中的<strong>所有</strong>任务，然后再去事件队列取<strong>一个</strong>任务执行。</p>
<p>以下是具体的分类：</p>
<h3 data-id="heading-1">1. 微任务队列 (Microtask Queue)</h3>
<p>这里面的任务非常“急”，通常用于内部状态的更新，或者希望在下一次 UI 渲染或 IO 操作前立即执行的代码。</p>
<ul>
<li><code>scheduleMicrotask()</code>: <code>dart:async</code> 库中直接调度微任务的方法。</li>
<li><code>Future.microtask()</code>: 创建一个旨在微任务中运行的 Future。</li>
<li><code>Future.then()</code> / <code>.catchError()</code> / <code>.whenComplete()</code> 的回调:
<ul>
<li>当一个 Future 完成（complete）时，它的后续回调方法会被加入微任务队列。</li>
<li><strong>注意</strong>：如果是 <code>Future.value()</code> 这种立即完成的 Future，它的 <code>.then</code> 也会立刻进入微任务队列。</li>
</ul>
</li>
<li><code>async</code>/<code>await</code> 的恢复执行:
<ul>
<li>当 <code>await</code> 等待的 Future 完成后，<code>async</code> 函数体内的后续代码（恢复执行部分）实际上被视为微任务调度。</li>
</ul>
</li>
</ul>
<h3 data-id="heading-2">2. 事件队列 (Event Queue)</h3>
<p>这里主要包含外部事件、I/O 和定时器，是大部分异步任务发生的地方。</p>
<ul>
<li><strong>I/O 事件</strong>: 文件读写完成、网络请求返回数据等。</li>
<li><strong>定时器</strong>: <code>Future.delayed()</code>、<code>Timer.run()</code>、<code>Timer.periodic()</code>。
<ul>
<li><strong>注意</strong>：<code>Future.delayed</code> 即使延时为 0，也是进入事件队列，因此它肯定比微任务晚执行。</li>
</ul>
</li>
<li><strong><code>Future()</code> 构造函数</strong>:
<ul>
<li>例如 <code>Future(() { ... })</code>，这种普通的构造函数会将任务放入事件队列。</li>
</ul>
</li>
<li><strong>UI / 手势事件</strong>: 点击、滑动、键盘输入等（由 Engine 层传递给 Framework）。</li>
<li><strong>绘制指令</strong>: VSync 信号到来时触发的绘制任务。</li>
<li><strong>Isolate 消息</strong>: 其他 Isolate 发送到 <code>ReceivePort</code> 的消息。</li>
</ul>
<hr/>
<h3 data-id="heading-3">简单对比总结</h3>


















































<table><thead><tr><th align="left">任务来源</th><th align="left">队列归属</th><th align="left">优先级</th></tr></thead><tbody><tr><td align="left"><code>scheduleMicrotask(...)</code></td><td align="left"><strong>Microtask</strong></td><td align="left">高 (插队执行)</td></tr><tr><td align="left"><code>Future.microtask(...)</code></td><td align="left"><strong>Microtask</strong></td><td align="left">高</td></tr><tr><td align="left"><code>Future.then(...)</code></td><td align="left"><strong>Microtask</strong></td><td align="left">高</td></tr><tr><td align="left"><code>Future.value(...).then</code></td><td align="left"><strong>Microtask</strong></td><td align="left">高</td></tr><tr><td align="left"><code>Timer.run(...)</code></td><td align="left"><strong>Event</strong></td><td align="left">低 (排队执行)</td></tr><tr><td align="left"><code>Future.delayed(...)</code></td><td align="left"><strong>Event</strong></td><td align="left">低</td></tr><tr><td align="left"><code>Future(() =&gt; ...)</code></td><td align="left"><strong>Event</strong></td><td align="left">低</td></tr><tr><td align="left">点击、IO、网络</td><td align="left"><strong>Event</strong></td><td align="left">低</td></tr></tbody></table>
<h3 data-id="heading-4">避坑指南</h3>
<p><strong>⚠️ 风险提示</strong>：如果在微任务队列中无限循环添加微任务（例如递归调用 <code>scheduleMicrotask</code>），那么事件队列永远没有机会执行。
会导致：</p>
<ol>
<li>App 界面卡死（因为 UI 绘制事件在事件队列）。</li>
<li>点击无反应（手势事件在事件队列）。</li>
<li>网络请求不回调（IO 事件在事件队列）。</li>
</ol>
<h3 data-id="heading-5">代码示例</h3>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">import</span> <span class="hljs-string">'dart:async'</span>; <span class="hljs-comment">// 必须导入这个库</span>

<span class="hljs-keyword">void</span> main() {
  <span class="hljs-built_in">print</span>(<span class="hljs-string">'1. 同步代码开始'</span>);

  <span class="hljs-comment">// 事件队列</span>
  Future(() =&gt; <span class="hljs-built_in">print</span>(<span class="hljs-string">'6. Future() 去事件队列'</span>));
  Future.delayed(<span class="hljs-built_in">Duration</span>.zero, () =&gt; <span class="hljs-built_in">print</span>(<span class="hljs-string">'7. Future.delayed 去事件队列'</span>));

  <span class="hljs-comment">// 微任务队列</span>
  scheduleMicrotask(() =&gt; <span class="hljs-built_in">print</span>(<span class="hljs-string">'3. scheduleMicrotask 去微任务队列'</span>));
  Future.microtask(() =&gt; <span class="hljs-built_in">print</span>(<span class="hljs-string">'4. Future.microtask 去微任务队列'</span>));
  
  <span class="hljs-comment">// Future.value 是立即完成，.then 进入微任务</span>
  Future.value().then((_) =&gt; <span class="hljs-built_in">print</span>(<span class="hljs-string">'5. Future.value().then 去微任务队列'</span>));

  <span class="hljs-built_in">print</span>(<span class="hljs-string">'2. 同步代码结束'</span>);
}
</code></pre>
<p>打印结果：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1f426508b1634efe98f334eb14daef7c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeWZtaW5nbw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768359654&amp;x-signature=pgUtES3gkFmuFU9roYjetqNrFxg%3D" alt="image.png" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[FreeRTOS/RT-Thread双教程：嵌入式开发者入门到实战（2025版）]]></title>    <link>https://juejin.cn/post/7592094358658170914</link>    <guid>https://juejin.cn/post/7592094358658170914</guid>    <pubDate>2026-01-07T03:14:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592094358658170914" data-draft-id="7592152007839039488" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="FreeRTOS/RT-Thread双教程：嵌入式开发者入门到实战（2025版）"/> <meta itemprop="keywords" content="嵌入式"/> <meta itemprop="datePublished" content="2026-01-07T03:14:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="冤大头编程之路"/> <meta itemprop="url" content="https://juejin.cn/user/1848709609694988"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            FreeRTOS/RT-Thread双教程：嵌入式开发者入门到实战（2025版）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1848709609694988/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    冤大头编程之路
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-07T03:14:48.000Z" title="Wed Jan 07 2026 03:14:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    2
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、为什么学FreeRTOS/RT-Thread？嵌入式开发者必看</h2>
<p>嵌入式开发从“裸机”到“多任务”的跨越，核心是掌握实时操作系统（RTOS）。FreeRTOS和RT-Thread是目前国内嵌入式领域最主流的两款RTOS：FreeRTOS以“轻量、稳定、资料多”成为入门首选，RT-Thread以“国产、中文生态、组件丰富”适配国内工业场景。本文从零基础讲起，对比两款RTOS的核心用法，帮你快速落地项目。</p>
<h3 data-id="heading-1">1.1 两款RTOS核心差异（新手选型必看）</h3>



































<table><thead><tr><th>维度</th><th>FreeRTOS</th><th>RT-Thread</th></tr></thead><tbody><tr><td>开源协议</td><td>MIT开源（完全免费，商用无限制）</td><td>Apache 2.0（国产开源，合规性高）</td></tr><tr><td>核心特点</td><td>内核精简（核心代码仅数万行），专注实时调度</td><td>模块化设计，内置文件系统、网络、GUI等组件</td></tr><tr><td>生态支持</td><td>全球社区，英文文档为主，STM32适配最佳</td><td>中文社区，官方教程完善，适配国产MCU（如华大、复旦微）</td></tr><tr><td>适用场景</td><td>消费电子、IoT低功耗设备、小型工业控制</td><td>国内工业控制、智能家居、车载设备</td></tr><tr><td>学习成本</td><td>低（入门案例多，易上手）</td><td>中（组件多，需掌握模块化使用）</td></tr></tbody></table>
<h3 data-id="heading-2">1.2 学习前提（避免走弯路）</h3>
<ul>
<li>具备基础C语言和STM32裸机开发能力（会配置GPIO、串口、定时器）；</li>
<li>准备硬件：STM32F103/STM32F407开发板（两款RTOS均完美适配）；</li>
<li>开发环境：Keil MDK 5.x 或 STM32CubeIDE（本文以Keil为例）。</li>
</ul>
<h2 data-id="heading-3">二、FreeRTOS入门：从环境搭建到多任务点灯</h2>
<h3 data-id="heading-4">2.1 FreeRTOS工程搭建（STM32F103为例）</h3>
<h4 data-id="heading-5">步骤1：下载FreeRTOS源码</h4>
<p>从FreeRTOS官网（<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.freertos.org%2F%25EF%25BC%2589%25E4%25B8%258B%25E8%25BD%25BD%25E6%259C%2580%25E6%2596%25B0%25E7%2589%2588%25E6%25BA%2590%25E7%25A0%2581%25EF%25BC%258C%25E8%25A7%25A3%25E5%258E%258B%25E5%2590%258E%25E6%2589%25BE%25E5%2588%25B0%2560FreeRTOS%2FSource%2560%25E7%259B%25AE%25E5%25BD%2595%25EF%25BC%258C%25E6%25A0%25B8%25E5%25BF%2583%25E6%2596%2587%25E4%25BB%25B6%25E5%258C%2585%25E6%258B%25AC%25EF%25BC%259A" target="_blank" title="https://www.freertos.org/%EF%BC%89%E4%B8%8B%E8%BD%BD%E6%9C%80%E6%96%B0%E7%89%88%E6%BA%90%E7%A0%81%EF%BC%8C%E8%A7%A3%E5%8E%8B%E5%90%8E%E6%89%BE%E5%88%B0%60FreeRTOS/Source%60%E7%9B%AE%E5%BD%95%EF%BC%8C%E6%A0%B8%E5%BF%83%E6%96%87%E4%BB%B6%E5%8C%85%E6%8B%AC%EF%BC%9A" ref="nofollow noopener noreferrer">www.freertos.org/）下载最新版源码，解压…</a></p>
<ul>
<li>内核文件：<code>tasks.c</code>（任务调度）、<code>queue.c</code>（消息队列）、<code>semphr.c</code>（信号量/互斥锁）；</li>
<li>端口文件：<code>portable/ARM/Cortex-M3/port.c</code>（适配Cortex-M3内核）；</li>
<li>内存管理：<code>portable/MemMang/heap_4.c</code>（推荐使用，解决内存碎片）。</li>
</ul>
<h4 data-id="heading-6">步骤2：移植到STM32工程</h4>
<ol>
<li>新建STM32F103裸机工程（配置时钟、GPIO、串口）；</li>
<li>将FreeRTOS核心文件添加到工程，新建<code>FreeRTOS</code>分组，加入上述文件；</li>
<li>添加头文件路径：<code>FreeRTOS/Source/include</code>、<code>FreeRTOS/Source/portable/ARM/Cortex-M3</code>；</li>
<li>复制<code>FreeRTOSConfig.h</code>到工程（关键配置文件，文末附模板）。</li>
</ol>
<h4 data-id="heading-7">步骤3：核心配置（FreeRTOSConfig.h关键宏）</h4>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">define</span> configUSE_PREEMPTION        1    <span class="hljs-comment">// 开启抢占式调度（必开）</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> configUSE_TIME_SLICING      1    <span class="hljs-comment">// 开启时间片轮转</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> configTICK_RATE_HZ          100  <span class="hljs-comment">// 系统节拍100Hz（时间片10ms）</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> configMAX_PRIORITIES        16   <span class="hljs-comment">// 任务最大优先级（0-15，15最高）</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> configMINIMAL_STACK_SIZE    128  <span class="hljs-comment">// 最小任务栈大小</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> configTOTAL_HEAP_SIZE       ((size_t)10*1024) <span class="hljs-comment">// 堆大小10KB</span></span>
</code></pre>
<h3 data-id="heading-8">2.2 FreeRTOS第一个例程：多任务点灯</h3>
<p>核心目标：创建两个任务，LED1每500ms闪烁，LED2每1000ms闪烁，体现多任务并发。</p>
<h4 data-id="heading-9">步骤1：硬件初始化（LED引脚配置）</h4>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// LED1接PA0，LED2接PA1</span>
<span class="hljs-type">void</span> <span class="hljs-title function_">LED_Init</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span>
{
    GPIO_InitTypeDef GPIO_InitStruct;
    RCC_APB2PeriphClockCmd(RCC_APB2Periph_GPIOA, ENABLE);
    
    GPIO_InitStruct.GPIO_Pin = GPIO_Pin_0 | GPIO_Pin_1;
    GPIO_InitStruct.GPIO_Mode = GPIO_Mode_Out_PP;
    GPIO_InitStruct.GPIO_Speed = GPIO_Speed_50MHz;
    GPIO_Init(GPIOA, &amp;GPIO_InitStruct);
    
    GPIO_SetBits(GPIOA, GPIO_Pin_0 | GPIO_Pin_1); <span class="hljs-comment">// 初始灭灯</span>
}
</code></pre>
<h4 data-id="heading-10">步骤2：创建任务函数</h4>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// 任务1：LED1闪烁（优先级1）</span>
<span class="hljs-type">void</span> <span class="hljs-title function_">LED1_Task</span><span class="hljs-params">(<span class="hljs-type">void</span> *pvParameters)</span>
{
    <span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>)
    {
        GPIO_ResetBits(GPIOA, GPIO_Pin_0); <span class="hljs-comment">// 亮灯</span>
        vTaskDelay(<span class="hljs-number">500</span>); <span class="hljs-comment">// 延时500ms（释放CPU）</span>
        GPIO_SetBits(GPIOA, GPIO_Pin_0);   <span class="hljs-comment">// 灭灯</span>
        vTaskDelay(<span class="hljs-number">500</span>);
    }
}

<span class="hljs-comment">// 任务2：LED2闪烁（优先级1）</span>
<span class="hljs-type">void</span> <span class="hljs-title function_">LED2_Task</span><span class="hljs-params">(<span class="hljs-type">void</span> *pvParameters)</span>
{
    <span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>)
    {
        GPIO_ResetBits(GPIOA, GPIO_Pin_1);
        vTaskDelay(<span class="hljs-number">1000</span>);
        GPIO_SetBits(GPIOA, GPIO_Pin_1);
        vTaskDelay(<span class="hljs-number">1000</span>);
    }
}
</code></pre>
<h4 data-id="heading-11">步骤3：在main函数中启动调度器</h4>
<pre><code class="hljs language-c" lang="c"><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span>
{
    NVIC_PriorityGroupConfig(NVIC_PriorityGroup_4); <span class="hljs-comment">// 中断分组（必配）</span>
    LED_Init();
    USART1_Init(<span class="hljs-number">115200</span>); <span class="hljs-comment">// 串口初始化（可选，用于调试）</span>
    
    <span class="hljs-comment">// 创建任务</span>
    xTaskCreate(LED1_Task, <span class="hljs-string">"LED1_Task"</span>, <span class="hljs-number">128</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-number">1</span>, <span class="hljs-literal">NULL</span>);
    xTaskCreate(LED2_Task, <span class="hljs-string">"LED2_Task"</span>, <span class="hljs-number">128</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-number">1</span>, <span class="hljs-literal">NULL</span>);
    
    vTaskStartScheduler(); <span class="hljs-comment">// 启动调度器（从此任务接管CPU）</span>
    
    <span class="hljs-comment">// 调度器启动后，以下代码不会执行</span>
    <span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>);
}
</code></pre>
<h4 data-id="heading-12">关键说明</h4>
<ul>
<li><code>vTaskDelay()</code>是FreeRTOS延时函数，会释放CPU，让其他任务执行（区别于裸机for循环延时）；</li>
<li>任务优先级数值越大，优先级越高；同优先级任务按时间片轮转执行；</li>
<li>任务栈大小设为128（单位：字，STM32中1字=4字节），避免栈溢出。</li>
</ul>
<h2 data-id="heading-13">三、RT-Thread入门：从移植到FinSH控制台</h2>
<p>RT-Thread的核心优势是“组件化”和“中文生态”，入门重点是掌握其内核用法和FinSH控制台（调试神器）。</p>
<h3 data-id="heading-14">3.1 RT-Thread工程搭建（STM32F103为例）</h3>
<h4 data-id="heading-15">步骤1：下载RT-Thread源码</h4>
<p>从RT-Thread官网（<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.rt-thread.org%2F%25EF%25BC%2589%25E4%25B8%258B%25E8%25BD%25BD%2560RT-Thread" target="_blank" title="https://www.rt-thread.org/%EF%BC%89%E4%B8%8B%E8%BD%BD%60RT-Thread" ref="nofollow noopener noreferrer">www.rt-thread.org/）下载`RT-Thre…</a> Standard`版本，核心目录：</p>
<ul>
<li><code>kernel</code>：内核文件（任务、调度、IPC通信）；</li>
<li><code>components</code>：组件（finsh、dfs文件系统、lwip网络）；</li>
<li><code>bsp/stm32/stm32f103-template</code>：STM32F103模板工程（直接复用）。</li>
</ul>
<h4 data-id="heading-16">步骤2：快速移植（复用官方模板）</h4>
<ol>
<li>复制<code>bsp/stm32/stm32f103-template</code>到本地，用Keil打开工程；</li>
<li>配置芯片型号为<code>STM32F103C8T6</code>，修改时钟配置为72MHz；</li>
<li>开启FinSH控制台：在<code>rtconfig.h</code>中开启<code>#define RT_USING_FINSH</code>，并配置串口1为FinSH端口。</li>
</ol>
<h3 data-id="heading-17">3.2 RT-Thread第一个例程：多任务点灯+FinSH调试</h3>
<h4 data-id="heading-18">步骤1：创建点灯线程（RT-Thread中“任务”称为“线程”）</h4>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;rtthread.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"stm32f10x.h"</span></span>

<span class="hljs-meta">#<span class="hljs-keyword">define</span> LED1_PIN    GET_PIN(A, 0)</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> LED2_PIN    GET_PIN(A, 1)</span>

<span class="hljs-comment">// 线程1：LED1闪烁</span>
<span class="hljs-type">void</span> <span class="hljs-title function_">led1_thread_entry</span><span class="hljs-params">(<span class="hljs-type">void</span> *parameter)</span>
{
    rt_pin_mode(LED1_PIN, PIN_MODE_OUTPUT);
    <span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>)
    {
        rt_pin_write(LED1_PIN, PIN_LOW);
        rt_thread_mdelay(<span class="hljs-number">500</span>); <span class="hljs-comment">// RT-Thread延时函数</span>
        rt_pin_write(LED1_PIN, PIN_HIGH);
        rt_thread_mdelay(<span class="hljs-number">500</span>);
    }
}

<span class="hljs-comment">// 线程2：LED2闪烁</span>
<span class="hljs-type">void</span> <span class="hljs-title function_">led2_thread_entry</span><span class="hljs-params">(<span class="hljs-type">void</span> *parameter)</span>
{
    rt_pin_mode(LED2_PIN, PIN_MODE_OUTPUT);
    <span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>)
    {
        rt_pin_write(LED2_PIN, PIN_LOW);
        rt_thread_mdelay(<span class="hljs-number">1000</span>);
        rt_pin_write(LED2_PIN, PIN_HIGH);
        rt_thread_mdelay(<span class="hljs-number">1000</span>);
    }
}
</code></pre>
<h4 data-id="heading-19">步骤2：初始化线程并启动</h4>
<pre><code class="hljs language-c" lang="c"><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span>
{
    <span class="hljs-comment">// 创建线程1（优先级10，栈大小1024）</span>
    <span class="hljs-type">rt_thread_t</span> led1_thread = rt_thread_create(<span class="hljs-string">"led1"</span>,
                                             led1_thread_entry,
                                             RT_NULL,
                                             <span class="hljs-number">1024</span>,
                                             <span class="hljs-number">10</span>,
                                             <span class="hljs-number">10</span>);
    <span class="hljs-comment">// 创建线程2</span>
    <span class="hljs-type">rt_thread_t</span> led2_thread = rt_thread_create(<span class="hljs-string">"led2"</span>,
                                             led2_thread_entry,
                                             RT_NULL,
                                             <span class="hljs-number">1024</span>,
                                             <span class="hljs-number">10</span>,
                                             <span class="hljs-number">10</span>);
    <span class="hljs-comment">// 启动线程</span>
    <span class="hljs-keyword">if</span> (led1_thread != RT_NULL)
        rt_thread_startup(led1_thread);
    <span class="hljs-keyword">if</span> (led2_thread != RT_NULL)
        rt_thread_startup(led2_thread);
    
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<h4 data-id="heading-20">步骤3：FinSH控制台调试（RT-Thread核心优势）</h4>
<p>编译下载程序后，通过串口助手连接开发板（波特率115200），输入<code>list_thread</code>可查看所有线程状态：</p>
<pre><code class="hljs language-arduino" lang="arduino">msh &gt; list_thread
thread     pri  status      sp     stack size max used left tick  error
---------- ---  ------- ---------- ----------  ------  ---------- ---
led2       <span class="hljs-number">10</span>   suspend <span class="hljs-number">0x00000070</span> <span class="hljs-number">0x00000400</span>    <span class="hljs-number">23</span>%   <span class="hljs-number">999</span>         <span class="hljs-number">000</span>
led1       <span class="hljs-number">10</span>   suspend <span class="hljs-number">0x00000070</span> <span class="hljs-number">0x00000400</span>    <span class="hljs-number">23</span>%   <span class="hljs-number">499</span>         <span class="hljs-number">000</span>
tshell     <span class="hljs-number">20</span>   running <span class="hljs-number">0x00000100</span> <span class="hljs-number">0x00001000</span>    <span class="hljs-number">10</span>%   <span class="hljs-number">999</span>         <span class="hljs-number">000</span>
idle       <span class="hljs-number">31</span>   ready   <span class="hljs-number">0x00000020</span> <span class="hljs-number">0x00000100</span>    <span class="hljs-number">0</span>%    <span class="hljs-number">999</span>         <span class="hljs-number">000</span>
</code></pre>
<p>通过FinSH可实时查看线程、修改参数，大幅降低调试难度。</p>
<h2 data-id="heading-21">四、FreeRTOS/RT-Thread核心功能对比（实战必学）</h2>
<h3 data-id="heading-22">4.1 任务/线程管理（核心用法）</h3>






























<table><thead><tr><th>功能</th><th>FreeRTOS API</th><th>RT-Thread API</th></tr></thead><tbody><tr><td>创建任务</td><td>xTaskCreate()</td><td>rt_thread_create()/rt_thread_init()</td></tr><tr><td>启动任务</td><td>vTaskStartScheduler()</td><td>rt_thread_startup()</td></tr><tr><td>延时</td><td>vTaskDelay()</td><td>rt_thread_mdelay()</td></tr><tr><td>挂起/恢复</td><td>vTaskSuspend()/vTaskResume()</td><td>rt_thread_suspend()/rt_thread_resume()</td></tr></tbody></table>
<h3 data-id="heading-23">4.2 任务同步与通信（解决多任务协作）</h3>
<h4 data-id="heading-24">1. 消息队列（任务间传数据）</h4>
<ul>
<li>FreeRTOS示例：</li>
</ul>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// 创建队列（长度5，每个元素4字节）</span>
QueueHandle_t xQueue = xQueueCreate(<span class="hljs-number">5</span>, <span class="hljs-keyword">sizeof</span>(<span class="hljs-type">uint32_t</span>));
<span class="hljs-comment">// 发送数据</span>
<span class="hljs-type">uint32_t</span> data = <span class="hljs-number">100</span>;
xQueueSend(xQueue, &amp;data, portMAX_DELAY);
<span class="hljs-comment">// 接收数据</span>
<span class="hljs-type">uint32_t</span> recv_data;
xQueueReceive(xQueue, &amp;recv_data, portMAX_DELAY);
</code></pre>
<ul>
<li>RT-Thread示例：</li>
</ul>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// 创建队列</span>
<span class="hljs-type">rt_mq_t</span> mq = rt_mq_create(<span class="hljs-string">"mq"</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, RT_IPC_FLAG_FIFO);
<span class="hljs-comment">// 发送数据</span>
<span class="hljs-type">uint32_t</span> data = <span class="hljs-number">100</span>;
rt_mq_send(mq, &amp;data, <span class="hljs-keyword">sizeof</span>(data));
<span class="hljs-comment">// 接收数据</span>
<span class="hljs-type">uint32_t</span> recv_data;
rt_mq_recv(mq, &amp;recv_data, <span class="hljs-keyword">sizeof</span>(recv_data), RT_WAITING_FOREVER);
</code></pre>
<h4 data-id="heading-25">2. 信号量（解决资源竞争）</h4>
<ul>
<li>FreeRTOS示例：</li>
</ul>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// 创建二值信号量</span>
SemaphoreHandle_t xSemaphore = xSemaphoreCreateBinary();
<span class="hljs-comment">// 获取信号量</span>
xSemaphoreTake(xSemaphore, portMAX_DELAY);
<span class="hljs-comment">// 释放信号量</span>
xSemaphoreGive(xSemaphore);
</code></pre>
<ul>
<li>RT-Thread示例：</li>
</ul>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// 创建信号量</span>
<span class="hljs-type">rt_sem_t</span> sem = rt_sem_create(<span class="hljs-string">"sem"</span>, <span class="hljs-number">1</span>, RT_IPC_FLAG_FIFO);
<span class="hljs-comment">// 获取信号量</span>
rt_sem_take(sem, RT_WAITING_FOREVER);
<span class="hljs-comment">// 释放信号量</span>
rt_sem_release(sem);
</code></pre>
<h2 data-id="heading-26">五、实战项目：FreeRTOS/RT-Thread实现串口数据采集+处理</h2>
<h3 data-id="heading-27">5.1 需求说明</h3>
<ul>
<li>任务1（串口接收）：接收上位机发送的数据，放入消息队列；</li>
<li>任务2（数据处理）：从队列中取数据，解析并打印；</li>
<li>要求：避免串口资源竞争，保证数据不丢失。</li>
</ul>
<h3 data-id="heading-28">5.2 FreeRTOS实现核心代码</h3>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// 定义队列句柄</span>
QueueHandle_t xUartQueue;

<span class="hljs-comment">// 串口中断服务函数（接收数据）</span>
<span class="hljs-type">void</span> <span class="hljs-title function_">USART1_IRQHandler</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span>
{
    <span class="hljs-type">uint8_t</span> ch;
    <span class="hljs-keyword">if</span>(USART_GetITStatus(USART1, USART_IT_RXNE) != RESET)
    {
        ch = USART_ReceiveData(USART1);
        <span class="hljs-comment">// 中断中发送数据到队列（用FromISR版本）</span>
        xQueueSendFromISR(xUartQueue, &amp;ch, <span class="hljs-literal">NULL</span>);
        USART_ClearITPendingBit(USART1, USART_IT_RXNE);
    }
}

<span class="hljs-comment">// 任务1：串口初始化（略）</span>
<span class="hljs-comment">// 任务2：数据处理任务</span>
<span class="hljs-type">void</span> <span class="hljs-title function_">DataProcess_Task</span><span class="hljs-params">(<span class="hljs-type">void</span> *pvParameters)</span>
{
    <span class="hljs-type">uint8_t</span> recv_ch;
    <span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>)
    {
        <span class="hljs-comment">// 从队列取数据</span>
        <span class="hljs-keyword">if</span>(xQueueReceive(xUartQueue, &amp;recv_ch, portMAX_DELAY))
        {
            <span class="hljs-built_in">printf</span>(<span class="hljs-string">"接收数据：%c\n"</span>, recv_ch);
        }
    }
}

<span class="hljs-comment">// main函数中创建队列和任务</span>
xUartQueue = xQueueCreate(<span class="hljs-number">32</span>, <span class="hljs-keyword">sizeof</span>(<span class="hljs-type">uint8_t</span>));
xTaskCreate(DataProcess_Task, <span class="hljs-string">"DataProcess"</span>, <span class="hljs-number">128</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-number">2</span>, <span class="hljs-literal">NULL</span>);
</code></pre>
<h3 data-id="heading-29">5.3 RT-Thread实现核心差异</h3>
<ul>
<li>串口中断中发送数据到消息队列，使用<code>rt_mq_send_from_isr()</code>；</li>
<li>线程优先级配置：数据处理线程优先级高于串口接收线程，保证数据及时处理。</li>
</ul>
<h2 data-id="heading-30">六、学习误区与进阶方向</h2>
<h3 data-id="heading-31">6.1 新手常见误区</h3>
<ol>
<li>死记API不理解原理：比如分不清<code>vTaskDelay()</code>和裸机延时的区别，核心是前者释放CPU，后者占用CPU；</li>
<li>任务栈设置过小：FreeRTOS/RT-Thread任务栈建议至少128字（FreeRTOS）/1024字节（RT-Thread）；</li>
<li>滥用全局变量：多任务间传数据必须用队列/信号量，避免全局变量冲突；</li>
<li>忽略中断优先级：FreeRTOS/RT-Thread中断优先级需低于<code>configMAX_SYSCALL_INTERRUPT_PRIORITY</code>。</li>
</ol>
<h3 data-id="heading-32">6.2 进阶学习方向</h3>
<ol>
<li>FreeRTOS：深入内存管理（heap_4/heap_5）、优先级继承、低功耗模式；</li>
<li>RT-Thread：学习设备驱动框架、LWIP网络协议栈、DFS文件系统；</li>
<li>项目落地：基于FreeRTOS做IoT传感器节点，基于RT-Thread做工业控制终端。</li>
</ol>
<h2 data-id="heading-33">七、附：FreeRTOSConfig.h极简模板（STM32F103）</h2>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">ifndef</span> FREERTOS_CONFIG_H</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> FREERTOS_CONFIG_H</span>

<span class="hljs-meta">#<span class="hljs-keyword">define</span> configUSE_PREEMPTION            1</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> configUSE_PORT_OPTIMISED_TASK_SELECTION 0</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> configUSE_TICKLESS_IDLE         0</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> configCPU_CLOCK_HZ              (72000000)</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> configTICK_RATE_HZ              (100)</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> configMAX_PRIORITIES            (16)</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> configMINIMAL_STACK_SIZE        (128)</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> configTOTAL_HEAP_SIZE           ((size_t)(10*1024))</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> configMAX_TASK_NAME_LEN         (16)</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> configUSE_16_BIT_TICKS          0</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> configIDLE_SHOULD_YIELD         1</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> configUSE_TASK_NOTIFICATIONS    1</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> configUSE_MUTEXES               1</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> configUSE_RECURSIVE_MUTEXES     1</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> configUSE_COUNTING_SEMAPHORES   1</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> configUSE_ALTERNATIVE_API       0</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> configQUEUE_REGISTRY_SIZE       8</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> configUSE_QUEUE_SETS            0</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> configUSE_TIME_SLICING          1</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> configUSE_NEWLIB_REENTRANT      0</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> configENABLE_BACKWARD_COMPATIBILITY 1</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> configNUM_THREAD_LOCAL_STORAGE_POINTERS 5</span>

<span class="hljs-comment">// 中断优先级配置</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> configPRIO_BITS                 4</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> configLIBRARY_LOWEST_INTERRUPT_PRIORITY   15</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> configLIBRARY_MAX_SYSCALL_INTERRUPT_PRIORITY 5</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> configKERNEL_INTERRUPT_PRIORITY (configLIBRARY_LOWEST_INTERRUPT_PRIORITY &lt;&lt; (8 - configPRIO_BITS))</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> configMAX_SYSCALL_INTERRUPT_PRIORITY (configLIBRARY_MAX_SYSCALL_INTERRUPT_PRIORITY &lt;&lt; (8 - configPRIO_BITS))</span>

<span class="hljs-comment">// 钩子函数</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> configUSE_IDLE_HOOK             0</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> configUSE_TICK_HOOK             0</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> configCHECK_FOR_STACK_OVERFLOW  0</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> configUSE_MALLOC_FAILED_HOOK    0</span>

<span class="hljs-comment">// 调试配置</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> configASSERT( x ) <span class="hljs-keyword">if</span>( ( x ) == 0 ) { taskDISABLE_INTERRUPTS(); for( ;; ); }</span>

<span class="hljs-comment">// 包含头文件</span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"stm32f10x.h"</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">endif</span> <span class="hljs-comment">/* FREERTOS_CONFIG_H */</span></span>
</code></pre>
<h2 data-id="heading-34">总结</h2>
<p>FreeRTOS和RT-Thread的核心都是“多任务调度”，入门先掌握任务创建、队列/信号量用法，再结合实战项目深化。新手建议先学FreeRTOS打基础，再学RT-Thread掌握组件化开发；国内项目优先选RT-Thread（适配国产芯片+中文支持），海外项目优先选FreeRTOS（生态更通用）。学习过程中多动手调试，比如用FinSH查看RT-Thread线程状态，用<code>vTaskList()</code>查看FreeRTOS任务状态，能快速定位问题。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[MyBatis批量插入从5分钟优化到3秒，我做了这3件事]]></title>    <link>https://juejin.cn/post/7592166340380786703</link>    <guid>https://juejin.cn/post/7592166340380786703</guid>    <pubDate>2026-01-07T05:44:43.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592166340380786703" data-draft-id="7592147128216141876" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="MyBatis批量插入从5分钟优化到3秒，我做了这3件事"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-07T05:44:43.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="神奇小汤圆"/> <meta itemprop="url" content="https://juejin.cn/user/1151943919285431"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            MyBatis批量插入从5分钟优化到3秒，我做了这3件事
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1151943919285431/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    神奇小汤圆
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-07T05:44:43.000Z" title="Wed Jan 07 2026 05:44:43 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>上周接了个数据迁移的活，要把10万条数据从老系统导入新系统。</p>
<p>写了个简单的批量插入，跑起来一看——<strong>5分钟</strong>。</p>
<p>领导说太慢了，能不能快点？</p>
<p>折腾了一下午，最后优化到<strong>3秒</strong>，记录一下过程。</p>
<hr/>
<h2 data-id="heading-0">最初的代码（5分钟）</h2>
<p>最开始写的很简单，foreach循环插入：</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// 方式1：循环单条插入（最慢）</span>
for (User user : userList) {
    userMapper<span class="hljs-selector-class">.insert</span>(user);
}
</code></pre>
<p>10万条数据，每条都要走一次网络请求、一次SQL解析、一次事务提交。</p>
<p>算一下：假设每条插入需要3ms，10万条就是300秒 = 5分钟。</p>
<p><strong>这是最蠢的写法</strong>，但我见过很多项目都这么写。</p>
<hr/>
<h2 data-id="heading-1">第一次优化：批量SQL（30秒）</h2>
<p>把循环插入改成批量SQL：</p>
<pre><code class="hljs language-ini" lang="ini">&lt;!-- Mapper.xml --&gt;
&lt;insert <span class="hljs-attr">id</span>=<span class="hljs-string">"batchInsert"</span>&gt;
    INSERT INTO user (name, age, email) VALUES
    &lt;foreach <span class="hljs-attr">collection</span>=<span class="hljs-string">"list"</span> item=<span class="hljs-string">"item"</span> separator=<span class="hljs-string">","</span>&gt;
        (<span class="hljs-comment">#{item.name}, #{item.age}, #{item.email})</span>
    &lt;/foreach&gt;
&lt;/insert&gt;
// 分批插入，每批1000条
int <span class="hljs-attr">batchSize</span> = <span class="hljs-number">1000</span><span class="hljs-comment">;</span>
for (int <span class="hljs-attr">i</span> = <span class="hljs-number">0</span><span class="hljs-comment">; i &lt; userList.size(); i += batchSize) {</span>
    int <span class="hljs-attr">end</span> = Math.min(i + batchSize, userList.size())<span class="hljs-comment">;</span>
    List&lt;User&gt; <span class="hljs-attr">batch</span> = userList.subList(i, end)<span class="hljs-comment">;</span>
    userMapper.batchInsert(batch)<span class="hljs-comment">;</span>
}
</code></pre>
<p>从5分钟降到<strong>30秒</strong>，提升10倍。</p>
<p><strong>原理</strong>：一条SQL插入多条数据，减少网络往返次数。</p>
<p><strong>但还有问题</strong>：30秒还是太慢。</p>
<hr/>
<h2 data-id="heading-2">第二次优化：<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D267822032%26content_type%3DArticle%26match_order%3D1%26q%3DJDBC%25E6%2589%25B9%25E5%25A4%2584%25E7%2590%2586%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=267822032&amp;content_type=Article&amp;match_order=1&amp;q=JDBC%E6%89%B9%E5%A4%84%E7%90%86&amp;zhida_source=entity" ref="nofollow noopener noreferrer">JDBC批处理</a>（8秒）</h2>
<p>MySQL有个参数叫<code>rewriteBatchedStatements</code>，开启后可以把多条INSERT合并成一条。</p>
<p><strong>第一步：修改数据库连接URL</strong></p>
<pre><code class="hljs language-bash" lang="bash">jdbc:mysql://localhost:3306/test?rewriteBatchedStatements=<span class="hljs-literal">true</span>
</code></pre>
<p><strong>第二步：使用<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D267822032%26content_type%3DArticle%26match_order%3D1%26q%3DMyBatis%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=267822032&amp;content_type=Article&amp;match_order=1&amp;q=MyBatis&amp;zhida_source=entity" ref="nofollow noopener noreferrer">MyBatis</a>的批处理模式</strong></p>
<pre><code class="hljs language-ini" lang="ini">@Autowired
private SqlSessionFactory sqlSessionFactory<span class="hljs-comment">;</span>

public void batchInsertWithExecutor(List&lt;User&gt; userList) {
    try (SqlSession <span class="hljs-attr">sqlSession</span> = sqlSessionFactory.openSession(ExecutorType.BATCH)) {
        UserMapper <span class="hljs-attr">mapper</span> = sqlSession.getMapper(UserMapper.class)<span class="hljs-comment">;</span>
        
        int <span class="hljs-attr">batchSize</span> = <span class="hljs-number">1000</span><span class="hljs-comment">;</span>
        for (int <span class="hljs-attr">i</span> = <span class="hljs-number">0</span><span class="hljs-comment">; i &lt; userList.size(); i++) {</span>
            mapper.insert(userList.get(i))<span class="hljs-comment">;</span>
            
            if ((i + 1) % <span class="hljs-attr">batchSize</span> == <span class="hljs-number">0</span>) {
                sqlSession.flushStatements()<span class="hljs-comment">;</span>
                sqlSession.clearCache()<span class="hljs-comment">;</span>
            }
        }
        sqlSession.flushStatements()<span class="hljs-comment">;</span>
        sqlSession.commit()<span class="hljs-comment">;</span>
    }
}
</code></pre>
<p>从30秒降到<strong>8秒</strong>。</p>
<p><strong>原理</strong>：<code>ExecutorType.BATCH</code>模式下，MyBatis会缓存SQL，最后一次性发送给数据库执行。配合<code>rewriteBatchedStatements=true</code>，MySQL驱动会把多条INSERT合并。</p>
<hr/>
<h2 data-id="heading-3">第三次优化：多线程并行（3秒）</h2>
<p>8秒还是不够快，上多线程：</p>
<pre><code class="hljs language-ini" lang="ini">public void parallelBatchInsert(List&lt;User&gt; userList) {
    int <span class="hljs-attr">threadCount</span> = <span class="hljs-number">4</span><span class="hljs-comment">;  // 根据数据库连接池大小调整</span>
    int <span class="hljs-attr">batchSize</span> = userList.size() / threadCount<span class="hljs-comment">;</span>
    
    ExecutorService <span class="hljs-attr">executor</span> = Executors.newFixedThreadPool(threadCount)<span class="hljs-comment">;</span>
    List&lt;Future&lt;?&gt;&gt; <span class="hljs-attr">futures</span> = new ArrayList&lt;&gt;()<span class="hljs-comment">;</span>
    
    for (int <span class="hljs-attr">i</span> = <span class="hljs-number">0</span><span class="hljs-comment">; i &lt; threadCount; i++) {</span>
        int <span class="hljs-attr">start</span> = i * batchSize<span class="hljs-comment">;</span>
        int <span class="hljs-attr">end</span> = (i == threadCount - <span class="hljs-number">1</span>) ? userList.size() : (i + <span class="hljs-number">1</span>) * batchSize<span class="hljs-comment">;</span>
        List&lt;User&gt; <span class="hljs-attr">subList</span> = userList.subList(start, end)<span class="hljs-comment">;</span>
        
        futures.add(executor.submit(() -&gt; {
            batchInsertWithExecutor(subList)<span class="hljs-comment">;</span>
        }))<span class="hljs-comment">;</span>
    }
    
    // 等待所有任务完成
    for (Future&lt;?&gt; future : futures) {
        try {
            future.get()<span class="hljs-comment">;</span>
        } catch (Exception e) {
            throw new RuntimeException(e)<span class="hljs-comment">;</span>
        }
    }
    
    executor.shutdown()<span class="hljs-comment">;</span>
}
</code></pre>
<p>从8秒降到<strong>3秒</strong>。</p>
<p><strong>注意事项</strong>：</p>
<ol>
<li>线程数不要超过数据库连接池大小</li>
<li>如果需要事务一致性，这个方案不适用</li>
<li>要考虑主键冲突的问题</li>
</ol>
<hr/>
<h2 data-id="heading-4">优化效果对比</h2>






























<table><thead><tr><th>方案</th><th>耗时</th><th>提升倍数</th></tr></thead><tbody><tr><td>循环单条插入</td><td>300秒</td><td>基准</td></tr><tr><td>批量SQL</td><td>30秒</td><td>10倍</td></tr><tr><td>JDBC批处理</td><td>8秒</td><td>37倍</td></tr><tr><td>多线程并行</td><td>3秒</td><td>100倍</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-5">踩过的坑</h2>
<h3 data-id="heading-6">坑1：foreach拼接SQL过长</h3>
<pre><code class="hljs language-ini" lang="ini">&lt;foreach <span class="hljs-attr">collection</span>=<span class="hljs-string">"list"</span> item=<span class="hljs-string">"item"</span> separator=<span class="hljs-string">","</span>&gt;
</code></pre>
<p>如果一次插入太多条，SQL会非常长，可能超过<code>max_allowed_packet</code>限制。</p>
<p><strong>解决</strong>：分批插入，每批500-1000条。</p>
<h3 data-id="heading-7">坑2：rewriteBatchedStatements不生效</h3>
<p>检查几个点：</p>
<ol>
<li>URL参数是否正确：<code>rewriteBatchedStatements=true</code></li>
<li>是否使用了<code>ExecutorType.BATCH</code></li>
<li>MySQL驱动版本是否太旧</li>
</ol>
<h3 data-id="heading-8">坑3：自增主键返回问题</h3>
<p>批量插入时想获取自增主键：</p>
<pre><code class="hljs language-ini" lang="ini">&lt;insert <span class="hljs-attr">id</span>=<span class="hljs-string">"batchInsert"</span> useGeneratedKeys=<span class="hljs-string">"true"</span> keyProperty=<span class="hljs-string">"id"</span>&gt;
</code></pre>
<p><strong>注意</strong>：<code>rewriteBatchedStatements=true</code>时，自增主键返回可能有问题，需要升级MySQL驱动到8.0.17+。</p>
<h3 data-id="heading-9">坑4：内存溢出</h3>
<p>10万条数据一次性加载到内存，可能OOM。</p>
<p><strong>解决</strong>：分页读取 + 分批插入。</p>
<pre><code class="hljs language-ini" lang="ini">int <span class="hljs-attr">pageSize</span> = <span class="hljs-number">10000</span><span class="hljs-comment">;</span>
int <span class="hljs-attr">total</span> = countTotal()<span class="hljs-comment">;</span>
for (int <span class="hljs-attr">i</span> = <span class="hljs-number">0</span><span class="hljs-comment">; i &lt; total; i += pageSize) {</span>
    List&lt;User&gt; <span class="hljs-attr">page</span> = selectByPage(i, pageSize)<span class="hljs-comment">;</span>
    batchInsertWithExecutor(page)<span class="hljs-comment">;</span>
}
</code></pre>
<hr/>
<h2 data-id="heading-10">最终方案代码</h2>
<pre><code class="hljs language-ini" lang="ini">@Service
public class BatchInsertService {
    
    @Autowired
    private SqlSessionFactory sqlSessionFactory<span class="hljs-comment">;</span>
    
    /**
     * 高性能批量插入
     * 10万条数据约3秒
     */
    public void highPerformanceBatchInsert(List&lt;User&gt; userList) {
        if (<span class="hljs-attr">userList</span> == null || userList.isEmpty()) {
            return<span class="hljs-comment">;</span>
        }
        
        int <span class="hljs-attr">threadCount</span> = Math.min(<span class="hljs-number">4</span>, Runtime.getRuntime().availableProcessors())<span class="hljs-comment">;</span>
        int <span class="hljs-attr">batchSize</span> = (int) Math.ceil((double) userList.size() / threadCount)<span class="hljs-comment">;</span>
        
        ExecutorService <span class="hljs-attr">executor</span> = Executors.newFixedThreadPool(threadCount)<span class="hljs-comment">;</span>
        CountDownLatch <span class="hljs-attr">latch</span> = new CountDownLatch(threadCount)<span class="hljs-comment">;</span>
        
        for (int <span class="hljs-attr">i</span> = <span class="hljs-number">0</span><span class="hljs-comment">; i &lt; threadCount; i++) {</span>
            int <span class="hljs-attr">start</span> = i * batchSize<span class="hljs-comment">;</span>
            int <span class="hljs-attr">end</span> = Math.min((i + <span class="hljs-number">1</span>) * batchSize, userList.size())<span class="hljs-comment">;</span>
            
            if (start &gt;= userList.size()) {
                latch.countDown()<span class="hljs-comment">;</span>
                continue<span class="hljs-comment">;</span>
            }
            
            List&lt;User&gt; <span class="hljs-attr">subList</span> = new ArrayList&lt;&gt;(userList.subList(start, end))<span class="hljs-comment">;</span>
            
            executor.submit(() -&gt; {
                try {
                    doBatchInsert(subList)<span class="hljs-comment">;</span>
                } finally {
                    latch.countDown()<span class="hljs-comment">;</span>
                }
            })<span class="hljs-comment">;</span>
        }
        
        try {
            latch.await()<span class="hljs-comment">;</span>
        } catch (InterruptedException e) {
            Thread.currentThread().interrupt()<span class="hljs-comment">;</span>
        }
        
        executor.shutdown()<span class="hljs-comment">;</span>
    }
    
    private void doBatchInsert(List&lt;User&gt; userList) {
        try (SqlSession <span class="hljs-attr">sqlSession</span> = sqlSessionFactory.openSession(ExecutorType.BATCH, <span class="hljs-literal">false</span>)) {
            UserMapper <span class="hljs-attr">mapper</span> = sqlSession.getMapper(UserMapper.class)<span class="hljs-comment">;</span>
            
            for (int <span class="hljs-attr">i</span> = <span class="hljs-number">0</span><span class="hljs-comment">; i &lt; userList.size(); i++) {</span>
                mapper.insert(userList.get(i))<span class="hljs-comment">;</span>
                
                if ((i + 1) % <span class="hljs-attr">1000</span> == <span class="hljs-number">0</span>) {
                    sqlSession.flushStatements()<span class="hljs-comment">;</span>
                    sqlSession.clearCache()<span class="hljs-comment">;</span>
                }
            }
            
            sqlSession.flushStatements()<span class="hljs-comment">;</span>
            sqlSession.commit()<span class="hljs-comment">;</span>
        }
    }
}
</code></pre>
<hr/>
<h2 data-id="heading-11">总结</h2>





















<table><thead><tr><th>优化点</th><th>关键配置</th></tr></thead><tbody><tr><td>批量SQL</td><td>foreach拼接，分批1000条</td></tr><tr><td>JDBC批处理</td><td>rewriteBatchedStatements=true + ExecutorType.BATCH</td></tr><tr><td>多线程</td><td>线程数 ≤ 连接池大小</td></tr></tbody></table>
<p><strong>核心原则</strong>：减少网络往返 + 减少事务次数 + 并行处理。</p>
<hr/>
<p><em>有其他批量操作的优化经验，欢迎评论区交流~</em></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[React 18实战：这5个新特性让我的开发效率提升了40%]]></title>    <link>https://juejin.cn/post/7592127014188826624</link>    <guid>https://juejin.cn/post/7592127014188826624</guid>    <pubDate>2026-01-07T04:17:04.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592127014188826624" data-draft-id="7592152007839268864" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="React 18实战：这5个新特性让我的开发效率提升了40%"/> <meta itemprop="keywords" content="后端,前端,人工智能"/> <meta itemprop="datePublished" content="2026-01-07T04:17:04.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="阿橙的百宝箱"/> <meta itemprop="url" content="https://juejin.cn/user/1638743356481367"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            React 18实战：这5个新特性让我的开发效率提升了40%
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1638743356481367/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    阿橙的百宝箱
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-07T04:17:04.000Z" title="Wed Jan 07 2026 04:17:04 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>React 18实战：这5个新特性让我的开发效率提升了40%</strong></h2>
<h2 data-id="heading-1">引言</h2>
<p>React 18的发布无疑是前端开发领域的一次重大升级。作为React生态系统的核心维护者，Facebook团队在这一版本中引入了一系列旨在提升性能、开发体验和并发能力的创新特性。在实际项目中采用React 18后，我发现某些关键特性的合理运用确实能带来显著的效率提升。本文将深入剖析5个最具价值的React 18新特性，通过真实案例展示它们如何帮助我将开发效率提升了40%，同时也会分享一些高级实践技巧和潜在陷阱。</p>
<h2 data-id="heading-2">一、自动批处理（Automatic Batching）：减少不必要的渲染</h2>
<h3 data-id="heading-3">1.1 什么是自动批处理？</h3>
<p>React 17及之前版本仅在浏览器事件处理程序中进行状态更新的批处理，而在promises、setTimeout等异步代码中则不会。React 18通过自动批处理解决了这一限制，将同一作用域内的所有状态更新合并为单个重新渲染。</p>
<h3 data-id="heading-4">1.2 实战价值</h3>
<p>在我们的电商项目中，商品详情页有多个独立的状态更新：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">handleAddToCart</span>(<span class="hljs-params"/>) {
  <span class="hljs-title function_">setIsLoading</span>(<span class="hljs-literal">true</span>);       <span class="hljs-comment">// 更新1</span>
  <span class="hljs-title function_">addToCart</span>(productId).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-title function_">setCartCount</span>(<span class="hljs-function"><span class="hljs-params">prev</span> =&gt;</span> prev + <span class="hljs-number">1</span>); <span class="hljs-comment">// 更新2</span>
    <span class="hljs-title function_">setIsLoading</span>(<span class="hljs-literal">false</span>);    <span class="hljs-comment">// 更新3</span>
    <span class="hljs-title function_">showNotification</span>(<span class="hljs-string">'Added to cart'</span>); <span class="hljs-comment">// 更新4</span>
  });
}
</code></pre>
<p>在React 17中这会触发3次渲染（then回调内的更新不会批量处理），而React 18只会触发1次。在复杂场景下，这种优化可以减少50%以上的无效渲染。</p>
<h3 data-id="heading-5">1.3 进阶技巧</h3>
<ul>
<li><strong>强制同步刷新</strong>：使用<code>flushSync</code>可退出自动批处理</li>
<li><strong>SSR注意事项</strong>：服务端渲染时批处理行为略有不同</li>
</ul>
<p>##二、过渡更新（Transitions）：区分紧急与非紧急更新</p>
<p>###2.1 Concurrent模式的核心机制
Transition API (<code>startTransition</code>)允许我们将UI更新标记为"非紧急"，使高优先级交互（如输入、点击）不被阻塞。</p>
<p>###2.2搜索框优化案例</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> [input, setInput] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">''</span>);
<span class="hljs-keyword">const</span> [results, setResults] = <span class="hljs-title function_">useState</span>([]);

<span class="hljs-keyword">function</span> <span class="hljs-title function_">handleChange</span>(<span class="hljs-params">e</span>) {
 <span class="hljs-title function_">setInput</span>(e.<span class="hljs-property">target</span>.<span class="hljs-property">value</span>); <span class="hljs-comment">// 紧急更新</span>
 
 <span class="hljs-title function_">startTransition</span>(<span class="hljs-function">() =&gt;</span> {
   <span class="hljs-title function_">fetchResults</span>(e.<span class="hljs-property">target</span>.<span class="hljs-property">value</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> {
     <span class="hljs-title function_">setResults</span>(data); <span class="hljs-comment">//非紧急过渡更新</span>
   });
 });
}
</code></pre>
<p>实测显示，这种模式让我们的搜索接口响应延迟从300ms降至80ms以下，同时避免了输入卡顿。</p>
<p>###2.3性能调优建议</p>
<ul>
<li><strong>结合Suspense使用</strong>效果更佳</li>
<li><strong>合理设置timeoutMs</strong>平衡响应性与后台任务</li>
</ul>
<p>##三、服务器组件（Server Components）：革命性架构突破</p>
<p>###3.1运行原理浅析
Server Components在服务端静态编译为特殊格式，客户端只接收渲染结果而非组件代码。</p>
<p>###3.2电商首页性能提升40%
将商品推荐列表改造为Server Component后：</p>
<ul>
<li>Bundle大小减少218KB</li>
<li>TTI(Time To Interactive)从4.2s降至2.5s</li>
<li>SEO爬虫解析时间缩短60%</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ProductRecommendations.server.jsx</span>
<span class="hljs-keyword">import</span> db <span class="hljs-keyword">from</span> <span class="hljs-string">'server-db'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">ProductRecommendations</span>(<span class="hljs-params"/>) {
 <span class="hljs-keyword">const</span> products = db.<span class="hljs-title function_">query</span>(<span class="hljs-string">'SELECT * FROM products WHERE featured = true'</span>);
 <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">ProductList</span> <span class="hljs-attr">products</span>=<span class="hljs-string">{products}</span> /&gt;</span></span>;
}
</code></pre>
<p>###3.3最佳实践指南
✅适合用于：
-数据获取密集型组件
-依赖服务端资源的组件
-低交互性内容区块</p>
<p>❌不适合：
-需要丰富交互的UI
-依赖浏览器API的组件</p>
<p>##四、新的Hooks API：精细化控制能力</p>
<p>###4.1 useId：解决SSR hydration问题
生成跨服务端/客户端一致的唯一ID，完美解决表单label关联问题。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Checkbox</span>(<span class="hljs-params"/>) {  
 <span class="hljs-keyword">const</span> id = <span class="hljs-title function_">useId</span>();
 <span class="hljs-keyword">return</span> (
   <span class="xml"><span class="hljs-tag">&lt;&gt;</span>
     <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">id</span>=<span class="hljs-string">{id}</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"checkbox"</span> /&gt;</span>
     <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">htmlFor</span>=<span class="hljs-string">{id}</span>&gt;</span>Accept terms<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
   <span class="hljs-tag">&lt;/&gt;</span></span>
 );
}
</code></pre>
<p>###4.2 useSyncExternalStore
简化外部状态集成，Redux等库已基于此Hook重构。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> store = <span class="hljs-title function_">useSyncExternalStore</span>(
 subscribe,
 <span class="hljs-function">() =&gt;</span> snapshot.<span class="hljs-title function_">getState</span>()
);
</code></pre>
<p>##五、改进的Suspense与流式SSR</p>
<p>###5.1 Selective Hydration创新机制
现在可以：
1️⃣优先hydrate关键内容<br/>
2️⃣并行下载JS和其他资源<br/>
3️⃣按需hydrate非关键部分</p>
<p>我们的管理后台采用此方案后：
-LCP优化37%<br/>
-TBT总阻塞时间降低52%</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">Layout</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">NavBar</span> /&gt;</span> {/* Eager hydration */}
 <span class="hljs-tag">&lt;<span class="hljs-name">Suspense</span> <span class="hljs-attr">fallback</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">Spinner</span> /&gt;</span>}&gt;
   <span class="hljs-tag">&lt;<span class="hljs-name">Sidebar</span> /&gt;</span> {/* Lazy hydration */}
 <span class="hljs-tag">&lt;/<span class="hljs-name">Suspense</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">Layout</span>&gt;</span>
</code></pre>
<p>##六、深度整合应用策略</p>
<p>要实现40%的效率提升不能仅靠单一特性：</p>
<p>🔄 <strong>工作流重构</strong>：</p>
<pre><code class="hljs language-arduino" lang="arduino">传统流程 → React18优化流程   
│           │   
├─数据获取 → <span class="hljs-built_in">Server</span> Components   
├─状态管理 → Automatic Batching + Transitions   
└─性能优化 → Suspense边界 + Selective Hydration  
</code></pre>
<p>📊 <strong>量化收益矩阵</strong>：</p>





























<table><thead><tr><th>指标</th><th>优化前</th><th>优化后</th><th>提升幅度</th></tr></thead><tbody><tr><td>平均渲染次数/操作</td><td>3.7x</td><td>1.2x</td><td>67%↓</td></tr><tr><td>Bundle体积(Main)</td><td>412KB</td><td>246KB</td><td>40%↓</td></tr><tr><td>交互响应延迟(ms)</td><td>210ms</td><td>85ms</td><td>60%↓</td></tr></tbody></table>
<p>##七、升级避坑指南</p>
<p>⚠️ <strong>常见问题解决方案</strong>：</p>
<p>1. StrictMode双重调用问题<br/>
👉启用<code>suppressHydrationWarning</code></p>
<p>2. TypeScript类型报错<br/>
👉升级@types/react到最新版</p>
<p>3.测试环境异常<br/>
👉配置jest.setup.js模拟新API</p>
<p>##结语</p>
<p>React18的创新远不止表面列出的这些功能点。通过将这些特性有机组合应用——特别是自动批处理+Transition+Suspense的铁三角组合——我们不仅获得了显著的性能提升，更重要的是建立了面向未来的前端架构范式。建议团队采用渐进式迁移策略：先启用auto batching验证基础功能稳定；再逐步引入Server Components；最后在有经验的模块尝试高级并发特性</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[aio_periodic 重构与优化实战：构建高性能 Python 定时任务客户端]]></title>    <link>https://juejin.cn/post/7592040819818692649</link>    <guid>https://juejin.cn/post/7592040819818692649</guid>    <pubDate>2026-01-07T04:21:08.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592040819818692649" data-draft-id="7592134330312605739" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="aio_periodic 重构与优化实战：构建高性能 Python 定时任务客户端"/> <meta itemprop="keywords" content="Python,Haskell"/> <meta itemprop="datePublished" content="2026-01-07T04:21:08.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Lupino"/> <meta itemprop="url" content="https://juejin.cn/user/3051900006579256"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            aio_periodic 重构与优化实战：构建高性能 Python 定时任务客户端
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3051900006579256/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Lupino
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-07T04:21:08.000Z" title="Wed Jan 07 2026 04:21:08 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1. 项目概览</h2>
<p><code>aio_periodic</code> 是一个基于 <code>asyncio</code> 的 Python 3 客户端，专为与 Periodic 任务调度系统（通常由 Haskell 编写）进行交互而设计。它支持 TCP 和 Unix Domain Socket 连接，内置了基于 RSA 和 AES 的混合加密安全传输层，并提供了完整的 <code>Client</code>（任务提交者）和 <code>Worker</code>（任务执行者）实现，以及集群和连接池管理功能。</p>
<p>在本次重构中，我们对整个代码库进行了深度的现代化改造，重点解决了<strong>加密传输层的阻塞问题</strong>、<strong>数据读取的缓冲逻辑</strong>、<strong>连接池的死锁隐患</strong>以及<strong>并发数据结构的效率问题</strong>。</p>
<h2 data-id="heading-1">2. 核心架构层级</h2>
<p>项目采用了分层架构设计，各模块职责清晰：</p>
<ol>
<li>
<p><strong>Transport Layer (<code>transport.py</code>)</strong> : 最底层的通信基石。</p>
<ul>
<li>处理 TCP/Unix Socket 连接。</li>
<li>实现 RSA 握手与身份验证。</li>
<li>实现 AES 加密会话（AES-256-CTR）。</li>
<li><strong>关键改进</strong>: 引入线程池处理加密/解密，防止阻塞 asyncio 事件循环。</li>
</ul>
</li>
<li>
<p><strong>Protocol Layer (<code>base_client.py</code>, <code>agent.py</code>, <code>command.py</code>, <code>job.py</code>)</strong> : 协议解析与多路复用。</p>
<ul>
<li><code>BaseClient</code>: 维护长连接、心跳（Ping/Pong）和断线重连。</li>
<li><code>Agent</code>: 基于 <code>msgid</code> 实现请求/响应的多路复用。</li>
<li><code>Job</code> &amp; <code>Command</code>: 定义二进制协议的序列化与反序列化格式。</li>
</ul>
</li>
<li>
<p><strong>Application Layer (<code>worker.py</code>, <code>client.py</code>, <code>blueprint.py</code>)</strong> : 业务逻辑接口。</p>
<ul>
<li><code>Worker</code>: 注册任务函数，通过 <code>GrabJob</code> 拉取任务，支持同步/异步任务执行，支持分布式锁。</li>
<li><code>Client</code>: 提交任务 (<code>submit_job</code>)，查询状态 (<code>status</code>)。</li>
<li><code>Blueprint</code>: 提供类似 Flask 的路由装饰器，用于组织任务逻辑。</li>
</ul>
</li>
<li>
<p><strong>Utility Layer (<code>pool.py</code>, <code>utils.py</code>, <code>rsp.py</code>)</strong> : 辅助工具。</p>
<ul>
<li>连接池管理、二进制编码工具、响应对象封装。</li>
</ul>
</li>
</ol>
<h2 data-id="heading-2">3. 关键优化与修复</h2>
<p>本次重构主要针对以下痛点进行了优化：</p>
<h3 data-id="heading-3">3.1. 传输层重构 (<code>transport.py</code>)</h3>
<p>这是本次优化的核心。原有的实现存在两个严重问题：</p>
<ol>
<li>
<p><strong>阻塞事件循环</strong>: RSA/AES 运算是 CPU 密集型的，直接在 <code>async</code> 函数中运行会导致整个 loop 卡顿。</p>
<ul>
<li><strong>优化</strong>: 使用 <code>loop.run_in_executor</code> 将加密/解密操作卸载到线程池中执行。</li>
</ul>
</li>
<li>
<p><strong>读取逻辑缺陷</strong>: 分组密码（如 RSA）或带头部的协议需要读取完整的数据块。</p>
<ul>
<li><strong>修复</strong>: 重写了 <code>SecureStreamReader.readexactly</code>。引入内部缓冲区 <code>_decrypted_buffer</code>，确保在处理加密数据块（Block）与上层请求字节数（Byte）不一致时，数据不会丢失或截断。</li>
</ul>
</li>
</ol>
<h3 data-id="heading-4">3.2. 协议与并发优化 (<code>base_client.py</code> &amp; <code>agent.py</code>)</h3>
<ul>
<li><strong>消除手动缓冲循环</strong>: 移除了 <code>BaseClient</code> 中低效的 <code>while</code> 循环手动拼接 buffer 的逻辑，转而使用 <code>asyncio.StreamReader.readexactly</code>，大幅提升 I/O 效率并简化代码。</li>
<li><strong>O(1) 队列操作</strong>: 在 <code>Agent</code> 类中，将 <code>list</code> 替换为 <code>collections.deque</code>。原先的 <code>insert(0, ...)</code> 是 O(N) 操作，在高并发下是性能瓶颈；改为 <code>deque</code> 后，头部插入和尾部弹出的复杂度降为 O(1)。</li>
</ul>
<h3 data-id="heading-5">3.3. 连接池死锁修复 (<code>pool.py</code>)</h3>
<p>原有的 <code>Pool.get()</code> 逻辑存在潜在死锁：它在获取信号量（Semaphore）之前就获取了锁（Lock）。如果连接池已满，新的请求会持有锁并等待信号量，导致正在使用的连接无法释放（因为释放逻辑可能也需要锁，或者其他检查逻辑被锁阻塞）。</p>
<ul>
<li><strong>修复</strong>: 调整顺序，先获取信号量（预定名额），再获取锁（创建连接），并增加了 <code>try...finally</code> 确保资源释放。</li>
</ul>
<h3 data-id="heading-6">3.4. Worker 执行模型改进 (<code>worker.py</code>)</h3>
<ul>
<li><strong>同步任务非阻塞化</strong>: 当 Worker 执行非 <code>async</code> 的普通函数任务时，现在会自动使用 <code>loop.run_in_executor</code> 放入线程池执行，防止单个耗时任务卡死整个 Worker 节点。</li>
<li><strong>类型定义优化</strong>: 引入 <code>TaskFunc</code>, <code>LockerFunc</code> 等类型别名，使函数签名更加清晰。</li>
</ul>
<h3 data-id="heading-7">3.5. 代码质量与规范</h3>
<ul>
<li>
<p><strong>PEP 8 规范</strong>: 所有文件均强制执行每行不超过 79 字符的限制，提升代码可读性。</p>
</li>
<li>
<p><strong>现代化语法</strong>:</p>
<ul>
<li>使用 <code>super().__init__()</code> 替代旧式类调用。</li>
<li>使用 <code>json.dumps().encode()</code> 替代繁琐的类型检查转换。</li>
<li>移除 <code>pyproject.toml</code> 和 <code>setup.py</code> 中多余的 <code>asyncio</code> 依赖（它是标准库）。</li>
</ul>
</li>
<li>
<p><strong>类型安全</strong>: 全面补充 Type Hinting（如 <code>Optional</code>, <code>Union</code>, <code>Coroutine</code>），修复 MyPy 报错。</p>
</li>
</ul>
<h2 data-id="heading-8">4. 总结</h2>
<p>经过本次重构，<code>aio_periodic</code> 从一个功能性的客户端进化为一个生产级的高性能库。它现在具备了更强的抗并发能力、更安全的加密传输处理以及更健壮的错误恢复机制。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【免费网盘】1分钟快速搭建免费专属网盘，旧电脑&旧手机均可使用~]]></title>    <link>https://juejin.cn/post/7592144524308135942</link>    <guid>https://juejin.cn/post/7592144524308135942</guid>    <pubDate>2026-01-07T04:54:54.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592144524308135942" data-draft-id="7587965800273199130" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【免费网盘】1分钟快速搭建免费专属网盘，旧电脑&amp;旧手机均可使用~"/> <meta itemprop="keywords" content="开源"/> <meta itemprop="datePublished" content="2026-01-07T04:54:54.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="一念杂记"/> <meta itemprop="url" content="https://juejin.cn/user/3386151546131533"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【免费网盘】1分钟快速搭建免费专属网盘，旧电脑&amp;旧手机均可使用~
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3386151546131533/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    一念杂记
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-07T04:54:54.000Z" title="Wed Jan 07 2026 04:54:54 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>你是否也在为网盘收费、空间不足等问题苦恼？</p>
<p>你是否也有闲置的手机、电脑等资源？</p>
<p>今天分享的内容为如何利用免费开源的网盘项目在自己的手机、电脑上部署一套专属你个人或者团队的网盘工具。</p>
<p>这类项目也有不少好用的，今天首先分享的工具是——<strong>Cloudreve</strong>。</p>
<p>如果你对闲置的旧手机、电脑利用感兴趣，也可以看看个人以下分享内容：</p>
<p><a href="https://juejin.cn/post/7459816593230397494" target="_blank" title="https://juejin.cn/post/7459816593230397494">juejin.cn/post/745981…</a></p>
<p><a href="https://juejin.cn/post/7563976534441082914" target="_blank" title="https://juejin.cn/post/7563976534441082914">juejin.cn/post/756397…</a></p>
<h2 data-id="heading-0">Cloudreve是什么</h2>
<p>Cloudreve 可以助你即刻构建出兼备自用或公用的网盘服务，通过多种存储策略的支持、虚拟文件系统等特性实现灵活的文件管理体验。</p>
<p>说白了就是一个可以一键让你拥有你自己专属网盘的工具，支持文件、图片、音频、视频、文档等所有常规格式问题、同时支持拖转上传、离线下载、文件分享等所有网盘的功能。</p>
<p><strong>网站地址</strong>：</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fcloudreve.org%2F" target="_blank" title="https://cloudreve.org/" ref="nofollow noopener noreferrer">cloudreve.org/</a></p>
<p><strong>文档地址</strong>：</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.cloudreve.org%2Fzh%2F" target="_blank" title="https://docs.cloudreve.org/zh/" ref="nofollow noopener noreferrer">docs.cloudreve.org/zh/</a></p>
<h2 data-id="heading-1">Cloudreve的优势</h2>
<ul>
<li>开源免费使用</li>
<li>离线使用，可以联网、单机、局域网等使用</li>
<li>支持多种存储方式，本地磁盘、对象存储（如 S3/OSS/COS）、OneDrive 等多种存储服务都可以</li>
<li>灵活的权限控制和分享机制，提供用户/用户组权限控制、共享链接设置（可设置密码、有效期等），适合个人与团队协作场景</li>
<li>功能全面，常规网盘工具几乎一应俱全</li>
<li>跨平台支持，支持多个操作系统、手机app、网页访问等</li>
<li>......</li>
</ul>
<h2 data-id="heading-2">Cloudreve安装使用</h2>
<h3 data-id="heading-3">1、Cloudreve下载</h3>
<p>在下方链接中可以根据你电脑所使用的操作系统，下载到对应版本的工具，截止目前最新版本为4.10.1。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fcloudreve%2Fcloudreve%2Freleases" target="_blank" title="https://github.com/cloudreve/cloudreve/releases" ref="nofollow noopener noreferrer">github.com/cloudreve/c…</a></p>
<p>注：如果你无法访问github站点，文末也提供了高速免费下载</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3247e79329a6431f9468fbea0a7d85cd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5b-15p2C6K6w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768366494&amp;x-signature=WJKqf9tFOO1tH3W%2BnsTT6500yLU%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-4">2、安装Cloudreve</h3>
<p>由于我是Windows系统的电脑，所以这里下载的是amd64的zip包，这里注意不要下载错了，下面是arm的包。 下载解压到你想使用的目录即可。</p>
<p>（注：默认启动安装后会在当前目录创建data文件夹存放数据，如果不希望使用这个路径，可以后续在站点中配置）</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3dc20ee8b27b4e6ca9d14c7a94397ea6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5b-15p2C6K6w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768366494&amp;x-signature=ik6DDoisX3mXkND0TFGafWnWdiE%3D" alt="image.png" loading="lazy"/></p>
<p>Windows版本的Cloudreve可以说是免安装的，所以可以不用关注。</p>
<h3 data-id="heading-5">3、启动Cloudreve</h3>
<p>启动也是非常的简单，打开命令行工具，进入解压后的工具目录直接运行cloudreve.exe文件即可启动。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f7e76fff7b68489aa411d91b968708a6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5b-15p2C6K6w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768366494&amp;x-signature=DN2rjHPcXtA1chazXw2UwFkt%2FVY%3D" alt="image.png" loading="lazy"/></p>
<p>启动后默认监听的是5212端口，所以这个时候打开你的浏览器，访问<a href="https://link.juejin.cn?target=http%3A%2F%2Flocalhost%3A5212" target="_blank" title="http://localhost:5212" ref="nofollow noopener noreferrer">http://localhost:5212</a> 即可访问到你的网盘项目。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/639ba6b45ef64650934ea3cac083692b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5b-15p2C6K6w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768366494&amp;x-signature=wduigehKcMXsSBlRjRV%2BoNrOey4%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-6">4、登录Cloudreve</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b685c1e863f64f47b72816694cd4651e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5b-15p2C6K6w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768366494&amp;x-signature=%2FHLoR9EKG9iyHPaa5pJBqFQJ3YA%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c0bf3f0dbdb946c1850a0fbb711af481~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5b-15p2C6K6w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768366494&amp;x-signature=X4D20NtS1M%2BuuSr4IAScNdTlfek%3D" alt="image.png" loading="lazy"/></p>
<p>到这里你就可以尽情的享受的网盘服务了，比如拖转各类型文件上传。</p>
<h2 data-id="heading-7">Cloudreve使用扩展</h2>
<p>按照上述方式你基本可以在本地通过<a href="https://link.juejin.cn?target=http%3A%2F%2Flocalhost%3A5212" target="_blank" title="http://localhost:5212" ref="nofollow noopener noreferrer">http://localhost:5212</a> 以及 <a href="https://link.juejin.cn?target=http%3A%2F%2Fip%3A5212" target="_blank" title="http://ip:5212" ref="nofollow noopener noreferrer">http://ip:5212</a> 访问你的网盘了，但是这样也仅仅限于本机或者局域网使用，如果要想其他设备能够访问管理、上传、下载文件还需要更多设置。</p>
<p>以下是部分Cloudreve的设置方式：</p>
<h3 data-id="heading-8">1、后台管理面板</h3>
<p>通过界面左侧的“管理面板”功能可以进入后台管理。</p>
<p>在这里可以配置你的站点地址、服务器信息、管理用户权限、站点外观样式等等。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0036d9d0727646429572861599f8d9f3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5b-15p2C6K6w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768366494&amp;x-signature=Uiwv92aENGrXalNRze8ePvDCJdQ%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-9">2、外网访问</h3>
<p>这里如果要想你的网盘外网也能够访问，有两种方式：</p>
<p><strong>方式一：</strong></p>
<p>将你的网盘项目部署到公网上，这样只要有网络的设备都可以正常访问了。</p>
<p><strong>方式二：</strong></p>
<p>使用内网穿透项目，将你的站点代理出来给公网访问。内网穿透的工具有不少，可以网上检索也可以查看我较早的一次分享内容：</p>
<p><a href="https://juejin.cn/post/7487244533182103592" target="_blank" title="https://juejin.cn/post/7487244533182103592">juejin.cn/post/748724…</a></p>
<h3 data-id="heading-10">3、手机客户端使用</h3>
<p>由于Cloudreve默认没有Android手机客户端，这里推荐一个开源项目，支持Android客户端操作。</p>
<p>项目地址：</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2F4x-China%2FAstralCloud" target="_blank" title="https://github.com/4x-China/AstralCloud" ref="nofollow noopener noreferrer">github.com/4x-China/As…</a></p>
<p>同样如果你无法访问下载，文末也提供了高速下载链接供使用~</p>
<h2 data-id="heading-11">软件下载</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FEz3pOibQT5t1cE5_DHa22A" target="_blank" title="https://mp.weixin.qq.com/s/Ez3pOibQT5t1cE5_DHa22A" ref="nofollow noopener noreferrer">mp.weixin.qq.com/s/Ez3pOibQT…</a></p>
<h2 data-id="heading-12">最后</h2>
<p>网盘项目除开Cloudreve还有其他的，感兴趣的也可以去了解一下，毕竟现在的的网盘收费确实不太划算，同时如果你是团队，建立一个私享网盘，将团队资料、软件等统一管理起来，也是一种非常不错的选择。</p>
<h2 data-id="heading-13">推荐阅读</h2>
<p><a href="https://juejin.cn/post/7459816593230397494" target="_blank" title="https://juejin.cn/post/7459816593230397494">旧Android手机改个人服务器，不需要root</a></p>
<p><a href="https://juejin.cn/post/7467043353399672883" target="_blank" title="https://juejin.cn/post/7467043353399672883">旧Android手机改个人服务器，不需要root（2）——内网穿透</a></p>
<p><a href="https://juejin.cn/post/7472305493501247503" target="_blank" title="https://juejin.cn/post/7472305493501247503">手机秒变无线移动硬盘，用Samba轻松实现高速文件共享、远程编辑！</a></p>
<p><a href="https://juejin.cn/post/7480797795785949184" target="_blank" title="https://juejin.cn/post/7480797795785949184">Windows密码忘记了咋办？1分钟快速破解和修改指南来了</a></p>
<p><a href="https://juejin.cn/post/7540184817918476329" target="_blank" title="https://juejin.cn/post/7540184817918476329">【免费可商用系列】1小时快速完成专属于你的网站&amp;小程序&amp;APP&amp;后台管理系统搭建，你值得拥有~</a></p>
<p><a href="https://juejin.cn/post/7555464418449768475" target="_blank" title="https://juejin.cn/post/7555464418449768475">【完全免费】超级爽的免费开源手机电脑投屏控制神器推荐（3）</a></p>
<p><a href="https://juejin.cn/post/7563209548392316954" target="_blank" title="https://juejin.cn/post/7563209548392316954">【免费使用】常用几款远程控制工具汇总对比，总有一款适合你~</a></p>
<p><a href="https://juejin.cn/post/7563976534441082914" target="_blank" title="https://juejin.cn/post/7563976534441082914">小白也会的旧手机一键安装Widnows系统，让你的手机重获新生</a></p>
<p><a href="https://juejin.cn/post/7571829822339924019" target="_blank" title="https://juejin.cn/post/7571829822339924019">【完全免费】不用服务器、不买域名！免费搭建专属网站，新手也能 10 分钟搞定</a></p>
<p><a href="https://juejin.cn/post/7587342664077475855" target="_blank" title="https://juejin.cn/post/7587342664077475855">【实战系列】一篇文章教你如何快速使用LineageOS编译你想要的Android版本系统（附模拟器镜像编译、启动、移植实例）</a></p>
<p><a href="https://juejin.cn/post/7588022226738905138" target="_blank" title="https://juejin.cn/post/7588022226738905138">【实战系列】快速使用LineageOS自定义你的手机系统（附小米6固件编译步骤）</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[2025，我的「Vibe Coding」时刻]]></title>    <link>https://juejin.cn/post/7592058764120735763</link>    <guid>https://juejin.cn/post/7592058764120735763</guid>    <pubDate>2026-01-07T03:08:26.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592058764120735763" data-draft-id="7592144524307709958" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="2025，我的「Vibe Coding」时刻"/> <meta itemprop="keywords" content="人工智能,AIGC,前端"/> <meta itemprop="datePublished" content="2026-01-07T03:08:26.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="LeonGao"/> <meta itemprop="url" content="https://juejin.cn/user/3976252950591149"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            2025，我的「Vibe Coding」时刻
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3976252950591149/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    LeonGao
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-07T03:08:26.000Z" title="Wed Jan 07 2026 03:08:26 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body blockquote&gt;:first-child{margin-top:0}.markdown-body blockquote&gt;:last-child{margin-bottom:0}.markdown-body{overflow:hidden;line-height:1.75;font-size:15px;background-image:linear-gradient(90deg,rgba(72,42,10,.05) 5%,rgba(72,42,10,0) 0),linear-gradient(1turn,rgba(72,42,10,.05) 5%,rgba(72,42,10,0) 0);background-size:20px 20px;background-position:50%;padding-top:0!important}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{position:relative;display:flex;border-bottom:5px solid #6d4e00;line-height:35px;letter-spacing:1px;font-size:25px;padding-left:25px;color:#664900;text-shadow:1px 1px 1px #8a6200;padding-bottom:0}.markdown-body h1:before{content:"";display:flex;position:absolute;left:0;top:3px;bottom:0;margin:auto;width:20px;height:20px;background-size:20px 20px;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAMAAACahl6sAAAAQlBMVEVHcEwlRnqtZBj76q4lRnolRnolRnolRnolRnokRnr/gGtrVUeLXDBKTl+hYSHasW7Ik0zs0JG4dCvUdEE0SW+rYxrLQJfjAAAACnRSTlMA////0H/xUaMi5MCoTwAACfVJREFUeNrtnQl3qygUgJ9GXAqosfL//+pgmgXwXmRNJGdu55xO+6rx8+6I8O9fehmGriN93zdN07bVXdpW/ih/SbpuGP6dXbpOXv7z2i3S9ISck2eQOnAhMHG64VQQbmrAaM4B05GmipaGdB+m6BNQPBXzMYtKR3EPbB/RS5eY4g+lIW9WBqnySCvVMrzRpqqs0g9nwVg5p1KYlHEchRT5bftp+y3n6xlQDjAkABtrKULU9f377ev+4/1/NiT+URRiZRhrcZP6WLa/Gq005BORaqXsdYEuHPIP798ZxSyt6d5sVfxJESRCsvB32lfXwhRjnUBGmKXNoJQe04VIASJqRC/9G7yDsyQMiloYz+0pHYghEoPISAGgpDSvHsCoMwmA0mfjSG5UOsqah2RodkljzMkhZZdamiEDB8+Nsbk9T04yGNljDXGOZZ6u0+Tj9DuvbyNJBuPO0ABtLNPlJtfZJ4CNNCWJoY8gddwxNpm9YrHh9DEkBoeMud4Kma8XRZaYpBJOYvg59U9wOsblMvmGrzQe30dyqFZ1dxPfO0FT5BOdw989THVs4q1TFk+iN4PMu7CaLpd4EJOExNaJLE4d0xQKYpJ0cY5Ozcwwu6WOu2cs9TUYxPB4b4fvLRzTUXbT1HH7y0BnB0j6CAehkPFfFzd1TMsi6sU1/P4VM9NiISHBlYnBMR+kad075sXlmMehj1twnfTUqJH4GJfqIKte7S72emPnHbdiYHIB0e6ATjKq1UoTaFh6wBL2csMIVo9fH/v6QRHAgoxrOHQQxG/36tC1ODmGOeBGBRmXalgcdhDQ1xF1vI6a3DF2d4r7G1enOUgNOshlFq7qUCxrca9ldiCam7ilxRbP6JbOYsYtfLFmkcXEgLG1DN/6eroxHjqh5bh+Uw27e1oWVK7pN+AqwzUcq/UYTPw8nWufLFBHN2zcxLRYlmGPs6rA2Wy0uJe/E7TknbHIa1WH1bLA8DAj3JpxET+FCNCWZ5uNT6jxTPZK/1mXoCBeKlGLRT2lP69XN3XdqqCojKX1ZVda6iD2McjeXSHa0I+AHd2InGAJgjRVM6gOBfygDrarRJnho6eQBbrns+HkcNUCWtYClJa66qFgPbqqZEBTCOAgRqxCOhQBWpZeIC6QBq91hEoI5unTjsMsK9DCFigY9WNn19hgVCrELalrTw6WnYMYzjHhQ2/7G2xTx1HvwpzSe4cVi5ORQQwMW9+72FU5L4gGsa6Yu1RcDeIhs64Qs8izt0vGH+n9/IKaIlYpM2UqkYOrwwq5CgBjWpyGtxaonxe4KaJ3hx+7O0HaqVkxLBPj8FmBVmjNevIUFhUuDmMq5NDV9RwyPe/95IvxAhG7ymqxHGE5sZJL2kPLUhUinkXfrnFwGFwXD99djNLSFh/meXEb2B6Oyiwm0I7BC+OlTlOVPk9K8CIYzu5YHwKDTI6XAo5lz3WEqEXwQRKhh5cyLa6D81P4PXBw984as9YaGXHwx4Ba8rmOldUat/BHt9cQ38AaljnBdCJqs60OcXVDJZP//ZwSWtV9FpHNtgg22KuYx/U2tB5Mcp1TYOiphNhiFjgWeJ3DL2OZpuuUisIoUyzZEJ76I+LmyqWdv8LwnEiwMYczihjxeqtBsuFJSTg2oD1ETQx4v6D1VleSZW1xCwvAfVGWpQ069kgrQksAUW2rReYzsboIjSABuDQX0QJwB9cnZVgWVgE31vrklAJnEmVObykgYCk/VGX5OlpuKb5eiovUAvJ2tMstw0kIkNdpiSA91K6XA6K8CVCyr4PePhTo65q3DyX7OpTbSVk1PB62mhJ9HSpSqtKaESxsFRm0tLBVcvTV+vbBrLRK4hC7aitN9B0ZpX6vNMgjGIt5ZdmMv32KrmprD1afsPd4FEhThK0+WfTl3kpd482AGvG3jQdZK1+t8ireDswhofigRb3fxfI/4jj+xkffUX/1ccxxhEP9qyyBEH9Cx9vhf8TB7eiSpBHjZVSa4whQMJC1TqIR6q8RERtjOr2ID0yx3oYi0oAIvZCPz4eG64p3ObuREeOHUIR3MBVJwq9yll5P7KHdiPBOiOoRa/AjXz21J3k04l+i8OjErj4kaXWQiIVO/EvA+KLRAEnUVomtjPd6SvR3RLoeMT54nKFH1EqtkkEGFaQuTlSQrsxhRiOIt51S/Ho8B11+FUlwRaHnU4utEI38/mgSjRJ8PhWEtN6Z6WcncQOU4efjKoh3zfi7/+DfhPrwOZ9a/iYBiVJJxPlei3CqIDTYEqAPFow5/c71fAdVIwmo4n+cTIGbr2n9NULAE5ifcNNS63hvEOFk0wxYnICBBZ0I9xERBVILF0uggNdxuOkR4S6ngvgPmArzHv4KpMKGQFjQ+Rw6q9dC6R6dgZaJF7RVWIH0BTY9h+fz0ohHOyLuy+He/hN4GUR3/RxcBx2f76izarI9CaXmzRmhNQuSfIgJkva5GzN6HJbhQxCNsDGDSh56plmef6sg2eaXPsYBt5W+H6VE6omG6hOS1w4hiTWiThbJ1YO+RSO1vrpMlomf6nhQGz0m7qT6W04XOUHyzhZ4rkG+0hxL66oDW9mnPWyL3TMmssxyQUwr01CHX7b2OvUIaqS48TnMtAoEQTQixJeAlDfSiGmk/l8jpwIpTyFqOfeNIHWBooC036ERtUQp2tm/CKT5jjySbxTlvUVj2yhjvyWDVL3yfKRojXwLSEWUp7q0PBAKPp7m5YGoT3WH7wAZ1BeOywNZv3Gak/LIqriwxbQ5jaTcsEW1eb+FvoWo+zr5V/IUOvNtsapU2zJXSyj0xVB13sPfq0kkZA7dubIIKXIlJ8Cy7u+BN22RVcr+peOuxHdcBbA04FAVmEoEtO5vX55K4KVZS1QJvBBzU1rgUl8JapBNYIowLoZtD9NWRTWKqqe36L48BSz8QPH9epqqIDehlh2UuqocEmrdV7AvhuRoM74m80yeDIEX3ppreNN235FxV58DNjhswn5K8zK21+5ctjut6NmUIoy9tVvitnHr2VDM3ahtW8KQ/Vbsp9GGiWHfk8skyTSFz9/HdxhHe4uR/RxX/mG1SGXwypcDJNmCMfucZ/C1CuCQUbiBUDYbe7tiRkZX8GIat50d+wqR1fdN7ygGzrHrcN4kGFHK02cil5M6INgQVsvnNz77T5PqUFYJJInYmIBplJfP5On4eiOwYfhuCD44oLyYVs43rI1rk3H7usttzq8Qo3j84vavN9mOkAeuq8dHEd9NtCVKX51Oen+MM6IEYvz5StOehKLpIjD+nKU5AQWJpLizdB+1sb5LQvFRxbSJVGHmSdK/0WWaPguEYmcSJ68aWkK6rAw6jwSSCmrTWVHT96R7HwHANEgqybVJL+E2vE2q7Uu91Gr73SbbNUvZDtiOlCeIv4r/AI+0XUwz1lvcAAAAAElFTkSuQmCC")}.markdown-body h2{position:relative;padding:0 0 0 20px;font-size:20px;font-weight:700;color:#614500}.markdown-body h2:before{content:"";position:absolute;top:3px;bottom:0;left:0;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAMAAACahl6sAAAAQlBMVEVHcEwlRnqtZBj76q4lRnolRnolRnolRnolRnokRnr/gGtrVUeLXDBKTl+hYSHasW7Ik0zs0JG4dCvUdEE0SW+rYxrLQJfjAAAACnRSTlMA////0H/xUaMi5MCoTwAACfVJREFUeNrtnQl3qygUgJ9GXAqosfL//+pgmgXwXmRNJGdu55xO+6rx8+6I8O9fehmGriN93zdN07bVXdpW/ih/SbpuGP6dXbpOXv7z2i3S9ISck2eQOnAhMHG64VQQbmrAaM4B05GmipaGdB+m6BNQPBXzMYtKR3EPbB/RS5eY4g+lIW9WBqnySCvVMrzRpqqs0g9nwVg5p1KYlHEchRT5bftp+y3n6xlQDjAkABtrKULU9f377ev+4/1/NiT+URRiZRhrcZP6WLa/Gq005BORaqXsdYEuHPIP798ZxSyt6d5sVfxJESRCsvB32lfXwhRjnUBGmKXNoJQe04VIASJqRC/9G7yDsyQMiloYz+0pHYghEoPISAGgpDSvHsCoMwmA0mfjSG5UOsqah2RodkljzMkhZZdamiEDB8+Nsbk9T04yGNljDXGOZZ6u0+Tj9DuvbyNJBuPO0ABtLNPlJtfZJ4CNNCWJoY8gddwxNpm9YrHh9DEkBoeMud4Kma8XRZaYpBJOYvg59U9wOsblMvmGrzQe30dyqFZ1dxPfO0FT5BOdw989THVs4q1TFk+iN4PMu7CaLpd4EJOExNaJLE4d0xQKYpJ0cY5Ozcwwu6WOu2cs9TUYxPB4b4fvLRzTUXbT1HH7y0BnB0j6CAehkPFfFzd1TMsi6sU1/P4VM9NiISHBlYnBMR+kad075sXlmMehj1twnfTUqJH4GJfqIKte7S72emPnHbdiYHIB0e6ATjKq1UoTaFh6wBL2csMIVo9fH/v6QRHAgoxrOHQQxG/36tC1ODmGOeBGBRmXalgcdhDQ1xF1vI6a3DF2d4r7G1enOUgNOshlFq7qUCxrca9ldiCam7ilxRbP6JbOYsYtfLFmkcXEgLG1DN/6eroxHjqh5bh+Uw27e1oWVK7pN+AqwzUcq/UYTPw8nWufLFBHN2zcxLRYlmGPs6rA2Wy0uJe/E7TknbHIa1WH1bLA8DAj3JpxET+FCNCWZ5uNT6jxTPZK/1mXoCBeKlGLRT2lP69XN3XdqqCojKX1ZVda6iD2McjeXSHa0I+AHd2InGAJgjRVM6gOBfygDrarRJnho6eQBbrns+HkcNUCWtYClJa66qFgPbqqZEBTCOAgRqxCOhQBWpZeIC6QBq91hEoI5unTjsMsK9DCFigY9WNn19hgVCrELalrTw6WnYMYzjHhQ2/7G2xTx1HvwpzSe4cVi5ORQQwMW9+72FU5L4gGsa6Yu1RcDeIhs64Qs8izt0vGH+n9/IKaIlYpM2UqkYOrwwq5CgBjWpyGtxaonxe4KaJ3hx+7O0HaqVkxLBPj8FmBVmjNevIUFhUuDmMq5NDV9RwyPe/95IvxAhG7ymqxHGE5sZJL2kPLUhUinkXfrnFwGFwXD99djNLSFh/meXEb2B6Oyiwm0I7BC+OlTlOVPk9K8CIYzu5YHwKDTI6XAo5lz3WEqEXwQRKhh5cyLa6D81P4PXBw984as9YaGXHwx4Ba8rmOldUat/BHt9cQ38AaljnBdCJqs60OcXVDJZP//ZwSWtV9FpHNtgg22KuYx/U2tB5Mcp1TYOiphNhiFjgWeJ3DL2OZpuuUisIoUyzZEJ76I+LmyqWdv8LwnEiwMYczihjxeqtBsuFJSTg2oD1ETQx4v6D1VleSZW1xCwvAfVGWpQ069kgrQksAUW2rReYzsboIjSABuDQX0QJwB9cnZVgWVgE31vrklAJnEmVObykgYCk/VGX5OlpuKb5eiovUAvJ2tMstw0kIkNdpiSA91K6XA6K8CVCyr4PePhTo65q3DyX7OpTbSVk1PB62mhJ9HSpSqtKaESxsFRm0tLBVcvTV+vbBrLRK4hC7aitN9B0ZpX6vNMgjGIt5ZdmMv32KrmprD1afsPd4FEhThK0+WfTl3kpd482AGvG3jQdZK1+t8ireDswhofigRb3fxfI/4jj+xkffUX/1ccxxhEP9qyyBEH9Cx9vhf8TB7eiSpBHjZVSa4whQMJC1TqIR6q8RERtjOr2ID0yx3oYi0oAIvZCPz4eG64p3ObuREeOHUIR3MBVJwq9yll5P7KHdiPBOiOoRa/AjXz21J3k04l+i8OjErj4kaXWQiIVO/EvA+KLRAEnUVomtjPd6SvR3RLoeMT54nKFH1EqtkkEGFaQuTlSQrsxhRiOIt51S/Ho8B11+FUlwRaHnU4utEI38/mgSjRJ8PhWEtN6Z6WcncQOU4efjKoh3zfi7/+DfhPrwOZ9a/iYBiVJJxPlei3CqIDTYEqAPFow5/c71fAdVIwmo4n+cTIGbr2n9NULAE5ifcNNS63hvEOFk0wxYnICBBZ0I9xERBVILF0uggNdxuOkR4S6ngvgPmArzHv4KpMKGQFjQ+Rw6q9dC6R6dgZaJF7RVWIH0BTY9h+fz0ohHOyLuy+He/hN4GUR3/RxcBx2f76izarI9CaXmzRmhNQuSfIgJkva5GzN6HJbhQxCNsDGDSh56plmef6sg2eaXPsYBt5W+H6VE6omG6hOS1w4hiTWiThbJ1YO+RSO1vrpMlomf6nhQGz0m7qT6W04XOUHyzhZ4rkG+0hxL66oDW9mnPWyL3TMmssxyQUwr01CHX7b2OvUIaqS48TnMtAoEQTQixJeAlDfSiGmk/l8jpwIpTyFqOfeNIHWBooC036ERtUQp2tm/CKT5jjySbxTlvUVj2yhjvyWDVL3yfKRojXwLSEWUp7q0PBAKPp7m5YGoT3WH7wAZ1BeOywNZv3Gak/LIqriwxbQ5jaTcsEW1eb+FvoWo+zr5V/IUOvNtsapU2zJXSyj0xVB13sPfq0kkZA7dubIIKXIlJ8Cy7u+BN22RVcr+peOuxHdcBbA04FAVmEoEtO5vX55K4KVZS1QJvBBzU1rgUl8JapBNYIowLoZtD9NWRTWKqqe36L48BSz8QPH9epqqIDehlh2UuqocEmrdV7AvhuRoM74m80yeDIEX3ppreNN235FxV58DNjhswn5K8zK21+5ctjut6NmUIoy9tVvitnHr2VDM3ahtW8KQ/Vbsp9GGiWHfk8skyTSFz9/HdxhHe4uR/RxX/mG1SGXwypcDJNmCMfucZ/C1CuCQUbiBUDYbe7tiRkZX8GIat50d+wqR1fdN7ygGzrHrcN4kGFHK02cil5M6INgQVsvnNz77T5PqUFYJJInYmIBplJfP5On4eiOwYfhuCD44oLyYVs43rI1rk3H7usttzq8Qo3j84vavN9mOkAeuq8dHEd9NtCVKX51Oen+MM6IEYvz5StOehKLpIjD+nKU5AQWJpLizdB+1sb5LQvFRxbSJVGHmSdK/0WWaPguEYmcSJ68aWkK6rAw6jwSSCmrTWVHT96R7HwHANEgqybVJL+E2vE2q7Uu91Gr73SbbNUvZDtiOlCeIv4r/AI+0XUwz1lvcAAAAAElFTkSuQmCC");background-size:100% 100%;background-repeat:no-repeat;width:15px;height:15px;margin:auto}.markdown-body h3{width:100%;text-align:left;margin:20px 10px 0 0;font-size:18px;font-weight:700;display:inline-block;padding-left:10px;padding-bottom:0;border-left:5px solid #8f6600;color:#614500}.markdown-body h4,.markdown-body h5,.markdown-body h6{font-weight:700;color:#a37400}.markdown-body h4{font-size:17px}.markdown-body h5,.markdown-body h6{display:flex;align-items:center}.markdown-body h5:after,.markdown-body h6:after{display:inline-block;border:2px solid #fff6e0;color:rgba(189,134,0,.5);border-radius:50%;text-align:center;margin-left:5px}.markdown-body h5{font-size:14px}.markdown-body h5:after{content:"5";width:15px;height:15px;line-height:15px;font-size:13px}.markdown-body h6{font-size:12px}.markdown-body h6:after{content:"6";width:13px;height:13px;line-height:13px;font-size:12px}.markdown-body p{color:#412c0c;letter-spacing:1px;font-weight:400;margin-bottom:16px}.markdown-body img{max-width:100%;display:block;margin:auto}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#755300;font-weight:400;border-bottom:1px solid #755300;font-weight:bolder;text-decoration:none}.markdown-body table{width:100%!important;margin:0;font-size:12px;width:auto;max-width:100%;overflow:auto;border-collapse:collapse;border-spacing:0}.markdown-body table img{box-shadow:none}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body thead tr th{text-align:center}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px;box-sizing:border-box;border:1px solid rgba(72,42,10,.1)}.markdown-body blockquote{position:relative;text-size-adjust:100%;line-height:25px;font-weight:400;border-radius:10px;font-style:normal;text-align:left;box-sizing:inherit;border:1px solid #ffd87a;background-color:rgba(189,134,0,.5);margin:20px 0;padding:20px}.markdown-body blockquote p{color:#fff6e0;letter-spacing:2px;margin:0}.markdown-body blockquote:after,.markdown-body blockquote:before{position:absolute;color:#cc9100;font-size:34px;font-weight:700}.markdown-body blockquote:before{content:"❝";top:8px;left:5px}.markdown-body blockquote:after{content:"❞";right:5px;bottom:-5px}.markdown-body strong{color:#c28a00;font-weight:bolder}.markdown-body strong:before{content:"「"}.markdown-body strong:after{content:"」"}.markdown-body em{color:#c28a00}.markdown-body em strong{font-style:normal;color:#c28a00;background-color:#8a6200}.markdown-body s{color:#c28a00}.markdown-body hr{border-top:1px solid #805b00}.markdown-body code,.markdown-body li code,.markdown-body p code{color:#996d00;background-color:rgba(130,98,0,.3)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit;color:#858585;font-family:bold;letter-spacing:1px}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection,.markdown-body img::selection{color:rgba(189,134,0,.5);background-color:#fff}.markdown-body a::selection,.markdown-body b::selection,.markdown-body del::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:transparent}.markdown-body pre&gt;code::selection{background-color:rgba(189,134,0,.5)}.markdown-body .math .math-inline::selection,.markdown-body blockquote::selection,.markdown-body ol::selection,.markdown-body p::selection,.markdown-body strong::selection,.markdown-body table::selection,.markdown-body ul::selection{background-color:rgba(189,134,0,.5)}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>2025 对我来说，是一次“技术觉醒”的年份。<br/>
在过去的四年多里，我一路从传统前端开发到 AI 驱动的生产力革命，从门户网站建设、<code>jQuery</code> 时代的刀耕火种，到 <code>React</code>、<code>Vue</code> 的组件化繁荣，再到 <code>SSR</code>、大型 B 端项目、<code>Canvas</code> 与 <code>Three.js</code> 的可视化探索，直到今天——全职投入「Vibe Coding」的浪潮里。</p>
<p>每一段经历都像是一次迭代：<br/>
从“写好代码”，到“写对产品”，再到“赋能想法落地”。</p>
<hr/>
<h2 data-id="heading-0">🧠 Agent 革命：从“效率提升”到“思维升级”</h2>
<p>还记得去年初第一次用上 <strong>Claude Code</strong>、<strong>Codex</strong> 和 <strong>Trae</strong> 的那一天。<br/>
那种感受非常奇妙——像是给思维装上了涡轮增压器。</p>
<p>过去，写代码是一种劳动密集型生产。需求来了，理解、设计、实现、调试，一个周期各司其职；<br/>
现在，我的「开发链条」已经彻底改变：</p>
<ul>
<li><strong>Claude Code</strong> 是我的对话式工程师，可以帮我快速推演复杂逻辑、生成接口 mock 数据、优化算法实现；</li>
<li><strong>Codex / GPT 模型</strong> 成了我「代码语境中的大脑延伸」，写文档、写 Hook、写单测，几乎无缝切换；</li>
<li>而 <strong>Trae</strong>，则像是一位技术副手，理解上下文后能帮我评审设计、生成架构决策报告。</li>
</ul>
<p>过去我需要几天才能完成的前端数据可视化 Demo，如今几个 prompt + 快速验证就能落地。<br/>
代码生产力已经不是我的瓶颈。<br/>
技术的壁垒在消融，而真正的差异，开始回到“人”的层面：你能否用 AI 做出别人做不出的东西。</p>
<hr/>
<h2 data-id="heading-1">🧩 从工程师到“Vibe Coder”：我找到技术的第二曲线</h2>
<p>有一个瞬间，让我意识到自己已经从“敲代码”转向“做产品”了。</p>
<p>那是一个为 B 端可视化平台做用户行为追踪的项目。<br/>
以往，我可能会纠结于埋点逻辑、页面渲染性能，而现在，我更在意的是 <strong>“用户到底点了什么按钮”</strong> 、 <strong>“交互反馈是否直观”</strong> 、 <strong>“用户流的动线合理吗”</strong> 。</p>
<p>AI 帮我免去了重复劳动，我有更多时间投入 <strong>分析、创造、验证</strong>。<br/>
我开始用 Claude 帮我生成用户行为统计脚本，用 GPT 辅助做数据可视化报告，甚至自动生成 A/B 测试的方案。</p>
<p>这一刻，我意识到：</p>
<blockquote>
<p>我不再是写代码的“手”，而是让代码去表达我思考的“脑”。</p>
</blockquote>
<p>这大概就是「Vibe Coding」的意义——<br/>
不是盲信技术本身的炫酷，而是通过技术，让创造这件事重新变得“有温度、有自由、有节奏”。</p>
<hr/>
<h2 data-id="heading-2">🔍 产品视角养成：AI 时代的差异化竞争力</h2>
<p>很多人担心 AI 会取代程序员。<br/>
但是我越用，越确信：</p>
<blockquote>
<p>AI 只会取代 <strong>廉价的程序员</strong>，不会取代 <strong>有思考的技术人</strong>。</p>
</blockquote>
<p>为什么？<br/>
因为 “代码” 本质上就是一种表达方式，而表达背后的逻辑、体验判断力、用户洞察力，依旧是人类独有的。</p>
<p>有前端、交互、三维场景、AI 应用开发的经验积累，让我比工具更理解「上下文」。<br/>
AI 能写出同样的页面，但它不知道这个动效为什么要流畅到 240ms，也不知道 hover 手势背后是激发了什么行为动机。</p>
<p>所谓「有经验的人」，其实就是能用更高的抽象层次，与 AI 协作，把机器的力量变成人类的表达。</p>
<hr/>
<h2 data-id="heading-3">🌈 向未来，继续冲在「Vibe Coding」的路上</h2>
<p>如果说以前的我，是辛勤编码的“建设者”；<br/>
那么现在的我，更像是技术与产品之间的“翻译者”。</p>
<p>我把 AI 当作团队的一员，它不是工具，而是协作者；<br/>
我用它生成组件、构思交互、撰写设计稿、调优用户体验；<br/>
我让 <code>Claude</code> 做需求澄清文档，让 <code>GPT</code> 参与代码评审，让 <code>Trae</code> 做自动化发布。</p>
<p>生成式时代的「全栈」不再是技术的广度，而是 <strong>认知与创造力的深度融合</strong>。</p>
<p>2026 年，我不打算再追逐框架更新的速度。<br/>
我要用「Vibe Coding 的心态」去创造真正有价值的东西 ——<br/>
不只是项目，而是 <strong>体验、节奏、和人与技术共舞的韵律</strong>。</p>
<hr/>
<h2 data-id="heading-4">⚡ 结语</h2>
<p>AI 已经能胜任绝大部分场景，<br/>
但真正稀缺的，从来不是代码，而是「创造的灵魂」。</p>
<p>我相信未来的程序员，不是被取代的那一群，<br/>
而是懂得如何与 AI 一起，写出更有温度、更有人性的代码的那一群。</p>
<blockquote>
<p>所以，冲吧。<br/>
2026，继续 Vibe Coding。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[🧭 一、全栈能力的重心正在从“实现” → “指令 + 验证”转移]]></title>    <link>https://juejin.cn/post/7592088192517161003</link>    <guid>https://juejin.cn/post/7592088192517161003</guid>    <pubDate>2026-01-07T03:11:18.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592088192517161003" data-draft-id="7592144524307742726" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="🧭 一、全栈能力的重心正在从“实现” → “指令 + 验证”转移"/> <meta itemprop="keywords" content="前端,人工智能,全栈"/> <meta itemprop="datePublished" content="2026-01-07T03:11:18.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="LeonGao"/> <meta itemprop="url" content="https://juejin.cn/user/3976252950591149"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            🧭 一、全栈能力的重心正在从“实现” → “指令 + 验证”转移
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3976252950591149/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    LeonGao
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-07T03:11:18.000Z" title="Wed Jan 07 2026 03:11:18 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body blockquote&gt;:first-child{margin-top:0}.markdown-body blockquote&gt;:last-child{margin-bottom:0}.markdown-body{overflow:hidden;line-height:1.75;font-size:15px;background-image:linear-gradient(90deg,rgba(72,42,10,.05) 5%,rgba(72,42,10,0) 0),linear-gradient(1turn,rgba(72,42,10,.05) 5%,rgba(72,42,10,0) 0);background-size:20px 20px;background-position:50%;padding-top:0!important}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{position:relative;display:flex;border-bottom:5px solid #6d4e00;line-height:35px;letter-spacing:1px;font-size:25px;padding-left:25px;color:#664900;text-shadow:1px 1px 1px #8a6200;padding-bottom:0}.markdown-body h1:before{content:"";display:flex;position:absolute;left:0;top:3px;bottom:0;margin:auto;width:20px;height:20px;background-size:20px 20px;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAMAAACahl6sAAAAQlBMVEVHcEwlRnqtZBj76q4lRnolRnolRnolRnolRnokRnr/gGtrVUeLXDBKTl+hYSHasW7Ik0zs0JG4dCvUdEE0SW+rYxrLQJfjAAAACnRSTlMA////0H/xUaMi5MCoTwAACfVJREFUeNrtnQl3qygUgJ9GXAqosfL//+pgmgXwXmRNJGdu55xO+6rx8+6I8O9fehmGriN93zdN07bVXdpW/ih/SbpuGP6dXbpOXv7z2i3S9ISck2eQOnAhMHG64VQQbmrAaM4B05GmipaGdB+m6BNQPBXzMYtKR3EPbB/RS5eY4g+lIW9WBqnySCvVMrzRpqqs0g9nwVg5p1KYlHEchRT5bftp+y3n6xlQDjAkABtrKULU9f377ev+4/1/NiT+URRiZRhrcZP6WLa/Gq005BORaqXsdYEuHPIP798ZxSyt6d5sVfxJESRCsvB32lfXwhRjnUBGmKXNoJQe04VIASJqRC/9G7yDsyQMiloYz+0pHYghEoPISAGgpDSvHsCoMwmA0mfjSG5UOsqah2RodkljzMkhZZdamiEDB8+Nsbk9T04yGNljDXGOZZ6u0+Tj9DuvbyNJBuPO0ABtLNPlJtfZJ4CNNCWJoY8gddwxNpm9YrHh9DEkBoeMud4Kma8XRZaYpBJOYvg59U9wOsblMvmGrzQe30dyqFZ1dxPfO0FT5BOdw989THVs4q1TFk+iN4PMu7CaLpd4EJOExNaJLE4d0xQKYpJ0cY5Ozcwwu6WOu2cs9TUYxPB4b4fvLRzTUXbT1HH7y0BnB0j6CAehkPFfFzd1TMsi6sU1/P4VM9NiISHBlYnBMR+kad075sXlmMehj1twnfTUqJH4GJfqIKte7S72emPnHbdiYHIB0e6ATjKq1UoTaFh6wBL2csMIVo9fH/v6QRHAgoxrOHQQxG/36tC1ODmGOeBGBRmXalgcdhDQ1xF1vI6a3DF2d4r7G1enOUgNOshlFq7qUCxrca9ldiCam7ilxRbP6JbOYsYtfLFmkcXEgLG1DN/6eroxHjqh5bh+Uw27e1oWVK7pN+AqwzUcq/UYTPw8nWufLFBHN2zcxLRYlmGPs6rA2Wy0uJe/E7TknbHIa1WH1bLA8DAj3JpxET+FCNCWZ5uNT6jxTPZK/1mXoCBeKlGLRT2lP69XN3XdqqCojKX1ZVda6iD2McjeXSHa0I+AHd2InGAJgjRVM6gOBfygDrarRJnho6eQBbrns+HkcNUCWtYClJa66qFgPbqqZEBTCOAgRqxCOhQBWpZeIC6QBq91hEoI5unTjsMsK9DCFigY9WNn19hgVCrELalrTw6WnYMYzjHhQ2/7G2xTx1HvwpzSe4cVi5ORQQwMW9+72FU5L4gGsa6Yu1RcDeIhs64Qs8izt0vGH+n9/IKaIlYpM2UqkYOrwwq5CgBjWpyGtxaonxe4KaJ3hx+7O0HaqVkxLBPj8FmBVmjNevIUFhUuDmMq5NDV9RwyPe/95IvxAhG7ymqxHGE5sZJL2kPLUhUinkXfrnFwGFwXD99djNLSFh/meXEb2B6Oyiwm0I7BC+OlTlOVPk9K8CIYzu5YHwKDTI6XAo5lz3WEqEXwQRKhh5cyLa6D81P4PXBw984as9YaGXHwx4Ba8rmOldUat/BHt9cQ38AaljnBdCJqs60OcXVDJZP//ZwSWtV9FpHNtgg22KuYx/U2tB5Mcp1TYOiphNhiFjgWeJ3DL2OZpuuUisIoUyzZEJ76I+LmyqWdv8LwnEiwMYczihjxeqtBsuFJSTg2oD1ETQx4v6D1VleSZW1xCwvAfVGWpQ069kgrQksAUW2rReYzsboIjSABuDQX0QJwB9cnZVgWVgE31vrklAJnEmVObykgYCk/VGX5OlpuKb5eiovUAvJ2tMstw0kIkNdpiSA91K6XA6K8CVCyr4PePhTo65q3DyX7OpTbSVk1PB62mhJ9HSpSqtKaESxsFRm0tLBVcvTV+vbBrLRK4hC7aitN9B0ZpX6vNMgjGIt5ZdmMv32KrmprD1afsPd4FEhThK0+WfTl3kpd482AGvG3jQdZK1+t8ireDswhofigRb3fxfI/4jj+xkffUX/1ccxxhEP9qyyBEH9Cx9vhf8TB7eiSpBHjZVSa4whQMJC1TqIR6q8RERtjOr2ID0yx3oYi0oAIvZCPz4eG64p3ObuREeOHUIR3MBVJwq9yll5P7KHdiPBOiOoRa/AjXz21J3k04l+i8OjErj4kaXWQiIVO/EvA+KLRAEnUVomtjPd6SvR3RLoeMT54nKFH1EqtkkEGFaQuTlSQrsxhRiOIt51S/Ho8B11+FUlwRaHnU4utEI38/mgSjRJ8PhWEtN6Z6WcncQOU4efjKoh3zfi7/+DfhPrwOZ9a/iYBiVJJxPlei3CqIDTYEqAPFow5/c71fAdVIwmo4n+cTIGbr2n9NULAE5ifcNNS63hvEOFk0wxYnICBBZ0I9xERBVILF0uggNdxuOkR4S6ngvgPmArzHv4KpMKGQFjQ+Rw6q9dC6R6dgZaJF7RVWIH0BTY9h+fz0ohHOyLuy+He/hN4GUR3/RxcBx2f76izarI9CaXmzRmhNQuSfIgJkva5GzN6HJbhQxCNsDGDSh56plmef6sg2eaXPsYBt5W+H6VE6omG6hOS1w4hiTWiThbJ1YO+RSO1vrpMlomf6nhQGz0m7qT6W04XOUHyzhZ4rkG+0hxL66oDW9mnPWyL3TMmssxyQUwr01CHX7b2OvUIaqS48TnMtAoEQTQixJeAlDfSiGmk/l8jpwIpTyFqOfeNIHWBooC036ERtUQp2tm/CKT5jjySbxTlvUVj2yhjvyWDVL3yfKRojXwLSEWUp7q0PBAKPp7m5YGoT3WH7wAZ1BeOywNZv3Gak/LIqriwxbQ5jaTcsEW1eb+FvoWo+zr5V/IUOvNtsapU2zJXSyj0xVB13sPfq0kkZA7dubIIKXIlJ8Cy7u+BN22RVcr+peOuxHdcBbA04FAVmEoEtO5vX55K4KVZS1QJvBBzU1rgUl8JapBNYIowLoZtD9NWRTWKqqe36L48BSz8QPH9epqqIDehlh2UuqocEmrdV7AvhuRoM74m80yeDIEX3ppreNN235FxV58DNjhswn5K8zK21+5ctjut6NmUIoy9tVvitnHr2VDM3ahtW8KQ/Vbsp9GGiWHfk8skyTSFz9/HdxhHe4uR/RxX/mG1SGXwypcDJNmCMfucZ/C1CuCQUbiBUDYbe7tiRkZX8GIat50d+wqR1fdN7ygGzrHrcN4kGFHK02cil5M6INgQVsvnNz77T5PqUFYJJInYmIBplJfP5On4eiOwYfhuCD44oLyYVs43rI1rk3H7usttzq8Qo3j84vavN9mOkAeuq8dHEd9NtCVKX51Oen+MM6IEYvz5StOehKLpIjD+nKU5AQWJpLizdB+1sb5LQvFRxbSJVGHmSdK/0WWaPguEYmcSJ68aWkK6rAw6jwSSCmrTWVHT96R7HwHANEgqybVJL+E2vE2q7Uu91Gr73SbbNUvZDtiOlCeIv4r/AI+0XUwz1lvcAAAAAElFTkSuQmCC")}.markdown-body h2{position:relative;padding:0 0 0 20px;font-size:20px;font-weight:700;color:#614500}.markdown-body h2:before{content:"";position:absolute;top:3px;bottom:0;left:0;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAMAAACahl6sAAAAQlBMVEVHcEwlRnqtZBj76q4lRnolRnolRnolRnolRnokRnr/gGtrVUeLXDBKTl+hYSHasW7Ik0zs0JG4dCvUdEE0SW+rYxrLQJfjAAAACnRSTlMA////0H/xUaMi5MCoTwAACfVJREFUeNrtnQl3qygUgJ9GXAqosfL//+pgmgXwXmRNJGdu55xO+6rx8+6I8O9fehmGriN93zdN07bVXdpW/ih/SbpuGP6dXbpOXv7z2i3S9ISck2eQOnAhMHG64VQQbmrAaM4B05GmipaGdB+m6BNQPBXzMYtKR3EPbB/RS5eY4g+lIW9WBqnySCvVMrzRpqqs0g9nwVg5p1KYlHEchRT5bftp+y3n6xlQDjAkABtrKULU9f377ev+4/1/NiT+URRiZRhrcZP6WLa/Gq005BORaqXsdYEuHPIP798ZxSyt6d5sVfxJESRCsvB32lfXwhRjnUBGmKXNoJQe04VIASJqRC/9G7yDsyQMiloYz+0pHYghEoPISAGgpDSvHsCoMwmA0mfjSG5UOsqah2RodkljzMkhZZdamiEDB8+Nsbk9T04yGNljDXGOZZ6u0+Tj9DuvbyNJBuPO0ABtLNPlJtfZJ4CNNCWJoY8gddwxNpm9YrHh9DEkBoeMud4Kma8XRZaYpBJOYvg59U9wOsblMvmGrzQe30dyqFZ1dxPfO0FT5BOdw989THVs4q1TFk+iN4PMu7CaLpd4EJOExNaJLE4d0xQKYpJ0cY5Ozcwwu6WOu2cs9TUYxPB4b4fvLRzTUXbT1HH7y0BnB0j6CAehkPFfFzd1TMsi6sU1/P4VM9NiISHBlYnBMR+kad075sXlmMehj1twnfTUqJH4GJfqIKte7S72emPnHbdiYHIB0e6ATjKq1UoTaFh6wBL2csMIVo9fH/v6QRHAgoxrOHQQxG/36tC1ODmGOeBGBRmXalgcdhDQ1xF1vI6a3DF2d4r7G1enOUgNOshlFq7qUCxrca9ldiCam7ilxRbP6JbOYsYtfLFmkcXEgLG1DN/6eroxHjqh5bh+Uw27e1oWVK7pN+AqwzUcq/UYTPw8nWufLFBHN2zcxLRYlmGPs6rA2Wy0uJe/E7TknbHIa1WH1bLA8DAj3JpxET+FCNCWZ5uNT6jxTPZK/1mXoCBeKlGLRT2lP69XN3XdqqCojKX1ZVda6iD2McjeXSHa0I+AHd2InGAJgjRVM6gOBfygDrarRJnho6eQBbrns+HkcNUCWtYClJa66qFgPbqqZEBTCOAgRqxCOhQBWpZeIC6QBq91hEoI5unTjsMsK9DCFigY9WNn19hgVCrELalrTw6WnYMYzjHhQ2/7G2xTx1HvwpzSe4cVi5ORQQwMW9+72FU5L4gGsa6Yu1RcDeIhs64Qs8izt0vGH+n9/IKaIlYpM2UqkYOrwwq5CgBjWpyGtxaonxe4KaJ3hx+7O0HaqVkxLBPj8FmBVmjNevIUFhUuDmMq5NDV9RwyPe/95IvxAhG7ymqxHGE5sZJL2kPLUhUinkXfrnFwGFwXD99djNLSFh/meXEb2B6Oyiwm0I7BC+OlTlOVPk9K8CIYzu5YHwKDTI6XAo5lz3WEqEXwQRKhh5cyLa6D81P4PXBw984as9YaGXHwx4Ba8rmOldUat/BHt9cQ38AaljnBdCJqs60OcXVDJZP//ZwSWtV9FpHNtgg22KuYx/U2tB5Mcp1TYOiphNhiFjgWeJ3DL2OZpuuUisIoUyzZEJ76I+LmyqWdv8LwnEiwMYczihjxeqtBsuFJSTg2oD1ETQx4v6D1VleSZW1xCwvAfVGWpQ069kgrQksAUW2rReYzsboIjSABuDQX0QJwB9cnZVgWVgE31vrklAJnEmVObykgYCk/VGX5OlpuKb5eiovUAvJ2tMstw0kIkNdpiSA91K6XA6K8CVCyr4PePhTo65q3DyX7OpTbSVk1PB62mhJ9HSpSqtKaESxsFRm0tLBVcvTV+vbBrLRK4hC7aitN9B0ZpX6vNMgjGIt5ZdmMv32KrmprD1afsPd4FEhThK0+WfTl3kpd482AGvG3jQdZK1+t8ireDswhofigRb3fxfI/4jj+xkffUX/1ccxxhEP9qyyBEH9Cx9vhf8TB7eiSpBHjZVSa4whQMJC1TqIR6q8RERtjOr2ID0yx3oYi0oAIvZCPz4eG64p3ObuREeOHUIR3MBVJwq9yll5P7KHdiPBOiOoRa/AjXz21J3k04l+i8OjErj4kaXWQiIVO/EvA+KLRAEnUVomtjPd6SvR3RLoeMT54nKFH1EqtkkEGFaQuTlSQrsxhRiOIt51S/Ho8B11+FUlwRaHnU4utEI38/mgSjRJ8PhWEtN6Z6WcncQOU4efjKoh3zfi7/+DfhPrwOZ9a/iYBiVJJxPlei3CqIDTYEqAPFow5/c71fAdVIwmo4n+cTIGbr2n9NULAE5ifcNNS63hvEOFk0wxYnICBBZ0I9xERBVILF0uggNdxuOkR4S6ngvgPmArzHv4KpMKGQFjQ+Rw6q9dC6R6dgZaJF7RVWIH0BTY9h+fz0ohHOyLuy+He/hN4GUR3/RxcBx2f76izarI9CaXmzRmhNQuSfIgJkva5GzN6HJbhQxCNsDGDSh56plmef6sg2eaXPsYBt5W+H6VE6omG6hOS1w4hiTWiThbJ1YO+RSO1vrpMlomf6nhQGz0m7qT6W04XOUHyzhZ4rkG+0hxL66oDW9mnPWyL3TMmssxyQUwr01CHX7b2OvUIaqS48TnMtAoEQTQixJeAlDfSiGmk/l8jpwIpTyFqOfeNIHWBooC036ERtUQp2tm/CKT5jjySbxTlvUVj2yhjvyWDVL3yfKRojXwLSEWUp7q0PBAKPp7m5YGoT3WH7wAZ1BeOywNZv3Gak/LIqriwxbQ5jaTcsEW1eb+FvoWo+zr5V/IUOvNtsapU2zJXSyj0xVB13sPfq0kkZA7dubIIKXIlJ8Cy7u+BN22RVcr+peOuxHdcBbA04FAVmEoEtO5vX55K4KVZS1QJvBBzU1rgUl8JapBNYIowLoZtD9NWRTWKqqe36L48BSz8QPH9epqqIDehlh2UuqocEmrdV7AvhuRoM74m80yeDIEX3ppreNN235FxV58DNjhswn5K8zK21+5ctjut6NmUIoy9tVvitnHr2VDM3ahtW8KQ/Vbsp9GGiWHfk8skyTSFz9/HdxhHe4uR/RxX/mG1SGXwypcDJNmCMfucZ/C1CuCQUbiBUDYbe7tiRkZX8GIat50d+wqR1fdN7ygGzrHrcN4kGFHK02cil5M6INgQVsvnNz77T5PqUFYJJInYmIBplJfP5On4eiOwYfhuCD44oLyYVs43rI1rk3H7usttzq8Qo3j84vavN9mOkAeuq8dHEd9NtCVKX51Oen+MM6IEYvz5StOehKLpIjD+nKU5AQWJpLizdB+1sb5LQvFRxbSJVGHmSdK/0WWaPguEYmcSJ68aWkK6rAw6jwSSCmrTWVHT96R7HwHANEgqybVJL+E2vE2q7Uu91Gr73SbbNUvZDtiOlCeIv4r/AI+0XUwz1lvcAAAAAElFTkSuQmCC");background-size:100% 100%;background-repeat:no-repeat;width:15px;height:15px;margin:auto}.markdown-body h3{width:100%;text-align:left;margin:20px 10px 0 0;font-size:18px;font-weight:700;display:inline-block;padding-left:10px;padding-bottom:0;border-left:5px solid #8f6600;color:#614500}.markdown-body h4,.markdown-body h5,.markdown-body h6{font-weight:700;color:#a37400}.markdown-body h4{font-size:17px}.markdown-body h5,.markdown-body h6{display:flex;align-items:center}.markdown-body h5:after,.markdown-body h6:after{display:inline-block;border:2px solid #fff6e0;color:rgba(189,134,0,.5);border-radius:50%;text-align:center;margin-left:5px}.markdown-body h5{font-size:14px}.markdown-body h5:after{content:"5";width:15px;height:15px;line-height:15px;font-size:13px}.markdown-body h6{font-size:12px}.markdown-body h6:after{content:"6";width:13px;height:13px;line-height:13px;font-size:12px}.markdown-body p{color:#412c0c;letter-spacing:1px;font-weight:400;margin-bottom:16px}.markdown-body img{max-width:100%;display:block;margin:auto}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#755300;font-weight:400;border-bottom:1px solid #755300;font-weight:bolder;text-decoration:none}.markdown-body table{width:100%!important;margin:0;font-size:12px;width:auto;max-width:100%;overflow:auto;border-collapse:collapse;border-spacing:0}.markdown-body table img{box-shadow:none}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body thead tr th{text-align:center}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px;box-sizing:border-box;border:1px solid rgba(72,42,10,.1)}.markdown-body blockquote{position:relative;text-size-adjust:100%;line-height:25px;font-weight:400;border-radius:10px;font-style:normal;text-align:left;box-sizing:inherit;border:1px solid #ffd87a;background-color:rgba(189,134,0,.5);margin:20px 0;padding:20px}.markdown-body blockquote p{color:#fff6e0;letter-spacing:2px;margin:0}.markdown-body blockquote:after,.markdown-body blockquote:before{position:absolute;color:#cc9100;font-size:34px;font-weight:700}.markdown-body blockquote:before{content:"❝";top:8px;left:5px}.markdown-body blockquote:after{content:"❞";right:5px;bottom:-5px}.markdown-body strong{color:#c28a00;font-weight:bolder}.markdown-body strong:before{content:"「"}.markdown-body strong:after{content:"」"}.markdown-body em{color:#c28a00}.markdown-body em strong{font-style:normal;color:#c28a00;background-color:#8a6200}.markdown-body s{color:#c28a00}.markdown-body hr{border-top:1px solid #805b00}.markdown-body code,.markdown-body li code,.markdown-body p code{color:#996d00;background-color:rgba(130,98,0,.3)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit;color:#858585;font-family:bold;letter-spacing:1px}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection,.markdown-body img::selection{color:rgba(189,134,0,.5);background-color:#fff}.markdown-body a::selection,.markdown-body b::selection,.markdown-body del::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:transparent}.markdown-body pre&gt;code::selection{background-color:rgba(189,134,0,.5)}.markdown-body .math .math-inline::selection,.markdown-body blockquote::selection,.markdown-body ol::selection,.markdown-body p::selection,.markdown-body strong::selection,.markdown-body table::selection,.markdown-body ul::selection{background-color:rgba(189,134,0,.5)}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>以前的全栈是：会写代码、会上线、能干到底。<br/>
现在的全栈是：能清晰描述让 AI 落地的目标，并能验证产出是否达标。</p>
</blockquote>
<h3 data-id="heading-0">✅ 新全栈的“核心循环”变成了：</h3>
<ol>
<li>
<p><strong>Prompt Engineering（问题的建模能力）</strong><br/>
你需要清晰、结构化地告诉 AI：目标是什么、上下文是什么、边界在哪。</p>
<blockquote>
<p>这是“AI协作”时代的沟通与设计能力，本质对应的是架构师思维。</p>
</blockquote>
</li>
<li>
<p><strong>验证与裁剪（判断与迭代能力）</strong><br/>
AI 生成的结果永远是“基础版本”，你需要有经验判断它是否合理、是否可演进、会不会留下隐患。</p>
<blockquote>
<p>决定你“AI 工具产出质量”的，不是模型，而是你的思维图谱。</p>
</blockquote>
</li>
<li>
<p><strong>Glue 能力（用 AI+工具链 组合方案）</strong><br/>
随着 AI 融入 CI/CD、API Gateway、前端脚手架等领域，全栈工程师要能：</p>
<ul>
<li>快速拼接各类工具（LangChain、Vercel AI SDK、Supabase、Replicate 等）；</li>
<li>掌握 Glue Script 思维：写少量代码，连接大量服务；</li>
<li>保留领域深度（前端用户体验 / 后端架构安全 / 数据逻辑）。</li>
</ul>
</li>
</ol>
<hr/>
<h2 data-id="heading-1">🧠 二、AI 背景下的全栈能力结构图（重心比例）</h2>
<p>可以这样分配你未来的精力重点（五维模型）：</p>



































<table><thead><tr><th>能力维度</th><th>说明</th><th>2026 推荐权重</th></tr></thead><tbody><tr><td>🧩 <strong>AI + 工具化开发</strong></td><td>熟悉 Claude Code、GPT-4/5、Trae、Cursor、v0.dev 等自动化开发流；懂模型工作流与 API 组合</td><td><strong>25%</strong></td></tr><tr><td>🧠 <strong>系统与业务建模</strong></td><td>能将复杂需求抽象为数据流 + 组件模型，用 AI 指令生成并维护架构</td><td><strong>25%</strong></td></tr><tr><td>🎨 <strong>用户体验与产品理解</strong></td><td>你从“写功能”转向“设计体验”——让界面与交互逻辑服务于更真实的目标</td><td><strong>20%</strong></td></tr><tr><td>⚙️ <strong>AI Infrastructure 基础</strong></td><td>理解 RAG、embedding、函数调用、Agent 环路、隐私安全等底层机制</td><td><strong>15%</strong></td></tr><tr><td>🚀 <strong>自动化与交付心智</strong></td><td>将 AI 产出的代码快速上线验证：Vercel、Cloudflare、Supabase、GitHub Actions</td><td><strong>15%</strong></td></tr></tbody></table>
<p>过去“全栈”的主战场在“代码”，<br/>
而未来“全栈”的主战场在“思考层”与“验证层”：<br/>
——<strong>即 AI 干体力，人干判断与创新。</strong></p>
<hr/>
<h2 data-id="heading-2">🔍 三、要重点演进的三个核心技能</h2>
<h3 data-id="heading-3">1. 「思维的 API 化」</h3>
<p>你要学会把思维拆成可调用的步骤：</p>
<ul>
<li>我在想什么；</li>
<li>要告诉 AI 什么；</li>
<li>验证标准是什么；</li>
<li>如何快速纠错。<br/>
这套思维结构会让你在多智能体（multi-agent）时代如鱼得水。</li>
</ul>
<h3 data-id="heading-4">2. 「人机共创的 UI/UX 感知」</h3>
<p>前端出身的你，其实天然具备优势。<br/>
未来用户界面大部分由 AI 构建，但真正打动人的，是<strong>节奏的把握、交互的情感、反馈的节制</strong>。<br/>
➡️ 这部分正是人类设计师和全栈开发者的“差异化壁垒”。</p>
<h3 data-id="heading-5">3. 「自动化构件链思维」</h3>
<p>熟悉“自己”写 Node 服务，不如熟悉“调度”工具链。<br/>
能结合：</p>
<ul>
<li>AI SDK / LangGraph；</li>
<li>自动化集成（Github Copilot Workspace / Replit Agents）；</li>
<li>快速部署平台（Vercel, Fly.io, Cloudflare Workers）；<br/>
让指令到上线之间的链路闭环缩到分钟级。</li>
</ul>
<hr/>
<h2 data-id="heading-6">🌈 四、全栈开发者的新定位：技术导演</h2>
<p>如果说传统全栈开发者是“独奏者”，<br/>
那 AI 时代的全栈是 <strong>“技术导演”</strong> ：</p>
<ul>
<li>你定义剧情（需求 + 场景）；</li>
<li>指挥演员（各类 AI 模型与工具）；</li>
<li>剪辑成片（验证、整合、上线）。</li>
</ul>
<p>未来程序员不是被取代，而是“升级为导演”。<br/>
AI 只是你的“拍摄团队”，<br/>
你决定方向、节奏与质感。</p>
<hr/>
<h2 data-id="heading-7">⚡ 总结一句话：</h2>
<blockquote>
<p>AI 时代的全栈能力，不是“写更多代码”，<br/>
而是 <strong>让机器写得更好，同时让你思考得更深。</strong></p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[有赞AI研发全流程落地实践]]></title>    <link>https://juejin.cn/post/7592094358658138146</link>    <guid>https://juejin.cn/post/7592094358658138146</guid>    <pubDate>2026-01-07T03:11:51.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592094358658138146" data-draft-id="7592094358657974306" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="有赞AI研发全流程落地实践"/> <meta itemprop="keywords" content="人工智能"/> <meta itemprop="datePublished" content="2026-01-07T03:11:51.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="有赞技术"/> <meta itemprop="url" content="https://juejin.cn/user/4283353032038253"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            有赞AI研发全流程落地实践
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4283353032038253/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    有赞技术
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-07T03:11:51.000Z" title="Wed Jan 07 2026 03:11:51 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读33分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1. AI 时代的研发变革</h2>
<h3 data-id="heading-1">1.1 AI编程的火爆</h3>
<p>25年可以说是 AI 应用的元年，在编程领域从最基础的代码补全到辅助编程，到 AI 工程师，再到 AI 开发团队，各种概念层出不穷。</p>
<p>编程工具迭代涌现，从老牌的 Github Copilot 到爆火的 Cursor，再到 Claude Code，和最新出的 Codex。</p>
<p>对应的用户规模也爆发增长，Github Copilot 用户超过 2000 万，Cursor 用户超过 230 万，Claude Code 在短短 3 个月用户增长 10倍，Github Copilot 年度 ARR 超过 3 亿美元，而 Cursor 和 Claude Code 都超过了 5 亿美元。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/306c683e8e2f4743a14554d094ca80a5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyJ6LWe5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768360310&amp;x-signature=B3xvap8PH%2F3I%2Fyju%2Fp4YHQceAmY%3D" alt="" loading="lazy"/></p>
<p>随着编程工具的发展，编程门槛被大幅降低，<strong>氛围编程(Vide Coding)开始兴起，让更多非专业开发者专注创意和结果</strong>。</p>
<p>在有赞内部有产品同学开始用代码交付交互式的 PRD，在一些创新型项目中这会成为第一版代码。</p>
<h3 data-id="heading-2">1.2 AI对企业研发的变革</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/10c67c8f1ea246428b82f6ac935847c2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyJ6LWe5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768360310&amp;x-signature=uYcFeQAeUdhrru7qQ3PCHRWQN60%3D" alt="" loading="lazy"/></p>
<p>我们开始思考，AI 对企业研发意味着什么？</p>
<p>首先，传统软件研发生产要素，由人力、技术、信息组成，核心逻辑是多招人，就能多做项目，就有更多产出。 围绕人这个要素存在一系列问题：好人才难招、新人要培养、人才会流失、个体的动性、人的协作效率。</p>
<p>AI 时代人力开始向算力转移，增长逻辑编程多买显卡，获取更多算力，就能有更多产出。大部分体力工作<strong>向算力迁移</strong>，部分脑力工作可<strong>沉淀到算力中</strong>，算力能快速扩大。</p>
<p>最近看到一些新闻，硅谷的大厂一边裁员，一边争相购买显卡。</p>
<p>在这个过程中，<strong>人从直接产出转为对算力的设计与编排。</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5ab15aab44934f5f8962ff427f317332~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyJ6LWe5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768360310&amp;x-signature=mY3PgtX%2B2MCuGlPuVVNZeTP%2FMo4%3D" alt="" loading="lazy"/></p>
<p>“让子弹飞”是一部经典的电影，这里引用其中一张截图，模糊度恰到好处。</p>
<p>远看是火车即将超越马，近看是马在拉着火车，这很有意思。和我们目前落地 AI 有点相似，“朋友圈”看起来各种炫酷，实际落地需要大批人马参与。</p>
<p>但这就意味着火车不如马吗？</p>
<p>显然不是，我们都知道<strong>最终火车一定会超越马，亦或，马拉火车的方式本身就错了</strong>。</p>
<h3 data-id="heading-3">1.3 有赞研发的AI+</h3>
<p>出于对 AI 趋势的坚信，在有赞研发内部，我们有大量的 AI 探索与实践。</p>
<p>横跨研发的完整流程，包括需求、设计、编码、测试、上线的各个阶段。</p>
<p>所有这些实践可以，归纳为三类：AI Coding、AI Test、AI DevOps， 以及围绕 Agent 本身的研发与评测。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/32a7aa1db3684eb98960773e86ff4c7d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyJ6LWe5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768360310&amp;x-signature=LYbr5ouTd2wHFoyLeMhkBj6ZFJc%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-4">1.4 AI编程小案例</h3>
<p>在 AI 探索的初期我们遇到了两个很有意思的小故事。</p>
<h4 data-id="heading-5">1.4.1 一位产品的氛围编程之路</h4>
<p>第一个故事是，我们的一位产品同学用氛围编程做了一个简单的日常需求，他给了一个反馈：<strong>严重缺乏安全感</strong>。</p>
<p>我们深入了解后发现来源于三点：</p>
<ul>
<li>
<p><strong>心理不可接受</strong>：由于企业级工程规模大、系统复杂度高，系统/功能间依赖关系较深。非专业人员面对生产稳定性和大量线上用户压力时，心理负担急剧增加。本质是判断力缺失；</p>
</li>
<li>
<p><strong>效率不可持续</strong>：判断力缺失也导致效率不可持续，导致需要频繁的和开发者沟通，氛围编程变成了 AI 和开发者之间的传声筒。编程的耗时被极大的转换成了沟通确认的耗时，最终效率不升反降；</p>
</li>
<li>
<p><strong>质量不可信赖</strong>：虽然 AI 做对了效果，但是实现方案不合理，最后返工。现代企业级软件工程，除了完成需求外，还需考虑健壮性、可维护性、架构一致性等因素。AI 由于缺少上下文输入，这方面做得并不好；</p>
</li>
</ul>
<h4 data-id="heading-6">1.4.2 一位开发带领的编程团队</h4>
<p>第二个故事是，五月 Claude Code 发布后，我们看到一些开发者编程模式的变化，如图是一位同学的 Cli 工具：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ea087eb4fdab4838aa6d7f0f78f98fb9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyJ6LWe5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768360310&amp;x-signature=MV0ViLutp3FdBPw%2BxyQ8HI9TZwM%3D" alt="" loading="lazy"/></p>
<p>左侧是 4 个 Agent 分别在完成一个项目的 4 子需求，右侧是他在验证和提交代码。</p>
<p>这种模式类似一位技术 Leader 带领一个小团队做项目，由 Leader 负责任务拆分、方案设计、过程把控和代码CR。</p>
<p>过去需要几个人的小组，现在一位开发者加上多个 AI Agent 就可以做到了。</p>
<p>这给了我们不少启发，我们开始思考如何把这种模式推广到更多项目中。</p>
<h3 data-id="heading-7">1.5 企业级软件工程四大特点</h3>
<p>在经过了初步的观察和尝试后，我们总结了 AI Coding 落地需要解决的关键问题，归纳为四点：</p>
<ul>
<li>
<p><strong>大规模</strong>：这对 LLM 的多仓库理解、上下文窗口提出了要求；</p>
</li>
<li>
<p><strong>高复杂</strong>：通常涉及多个业务系统、历史兼容等，需要解决 LLM 的注意力缺失问题、准召率低问题；</p>
</li>
<li>
<p><strong>多协作</strong>：一个项目往往涉及多职能、多部门的协作，不同团队间对 AI 的理解和应用有深浅，如何协同？以及，人在哪些环节以怎样的力度监督 AI？需要合理地规划 AI 落地的节奏以及人机协作模式；</p>
</li>
<li>
<p><strong>私有化</strong>：企业内部有大量分散在各处的信息，不透明、不标准，难以被 AI 检索，需要建设内部知识库、对接内部工具；</p>
</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cd136b25ddf948d98b45d2f7258318f4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyJ6LWe5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768360310&amp;x-signature=WRDAwiY6Gsr9CouukaAGPFdpUjE%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-8">1.6 AI落地的三个阶段</h3>
<p>明确关键问题后，我们将 AI 落地划分为了三个阶段：</p>
<ul>
<li>
<p><strong>AI 增强阶段</strong>：人主导 AI 辅助，此阶段重点聚焦用 AI 做单点提效；</p>
</li>
<li>
<p><strong>AI 驱动阶段</strong>：AI 主导人监督，此阶段 AI 有能力接管单一研发环节；</p>
</li>
<li>
<p><strong>AI 自主阶段</strong>：AI 自主人少量介入；</p>
</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/717646a3d23e4368af48e0dc8fdb5b79~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyJ6LWe5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768360310&amp;x-signature=KZDMGv3FIcsTn2gIyxMN1%2FbzWJE%3D" alt="" loading="lazy"/></p>
<p>对于不同的场景应该匹配适合的阶段，过度追求 AI 适得其反，我们踩过不少坑，<strong>AI 的落地无法一蹴而就，需要循序渐进</strong>。</p>
<p>目前我们的实践大量在 AI 增强阶段，有少量能到 AI 驱动阶段。</p>
<h2 data-id="heading-9">2. AI Coding：从个人助手到规模协同</h2>
<h3 data-id="heading-10">2.2 设计路线</h3>
<p>首先，是关于 AI Coding 的设计路线，我们有两个选择：以人为主 Agent 为辅、以 Agent 为主人监督。</p>
<p>我们观察了一些开发者的辅助编程模式，我们发现以人为主的模式存在一些问题：</p>
<ul>
<li>
<p>协作还是以人为中心，相互沟通靠声音、工具调用靠手速，<strong>信息传递效率低</strong>；</p>
</li>
<li>
<p>个人经验内化不共享，Agent 配置没有复用，<strong>信息分布式存储</strong>；</p>
</li>
<li>
<p>另外，人的<strong>规模化需要时间</strong>；</p>
</li>
</ul>
<p>因此，我们选择了第二条路线，其可以系统化解决以上三个问题，并且“天花板”更高。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/be5306825a594fe58e0b9418af8d4832~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyJ6LWe5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768360310&amp;x-signature=DppjBp12ModVP%2BKfrxeHaU7yQFM%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-11">2.3 构建框架</h3>
<p>明确了设计路线后，让我们开始构建 Coding Agent，这个过程类似从 0 到 1 搭建一个开发团队：</p>
<ul>
<li>
<p>它们都需要有<strong>好用的工具</strong>，无论是硬件、软件还是技术选型；</p>
</li>
<li>
<p>它们都由<strong>专业的个体</strong>组成；</p>
</li>
<li>
<p>并且这些个体能<strong>高效协同</strong>完成复杂的任务；</p>
</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ebe0c96701ec4f2b871f2fb2de94b853~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyJ6LWe5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768360310&amp;x-signature=SklR7rYClJF7JTWqf1xE9tCbx2U%3D" alt="" loading="lazy"/></p>
<p>让我们先从设计一个专业的 Agent 开始！</p>
<h3 data-id="heading-12">2.4 设计演进</h3>
<p>通用 AI Agent 和计算机很相似：</p>
<ul>
<li>
<p>它们都有计算单元，一个是 CPU，一个是 LLM；</p>
</li>
<li>
<p>它们都有短期存储，一个是内存，一个是上下文；</p>
</li>
<li>
<p>它们都需要获取外部信息，一个通过网络，一个通过搜索工具；</p>
</li>
<li>
<p>它们也都可以多节点进行协同，完成复杂任务；</p>
</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3caa2f5d3397444e8379759130a6cc0e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyJ6LWe5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768360310&amp;x-signature=OpzCtwKd1WDMHx12dl%2FzZmOydls%3D" alt="" loading="lazy"/></p>
<p>当我们把通用 AI Agent 细化到 Coding Agent，一些选型会更具体：</p>
<ul>
<li>
<p>LLM 需要选用垂直的编程 LLM；</p>
</li>
<li>
<p>上下文需要引入企业的开发规范/约束；</p>
</li>
<li>
<p>长期存储需要对接企业内部知识库；</p>
</li>
<li>
<p>搜索工具聚焦在代码仓库的搜索和理解；</p>
</li>
<li>
<p>工具需要对接企业内部的工具链和平台；</p>
</li>
<li>
<p>协同系统的拆分应该以企业内部的协作流程或领域分工来拆分；</p>
</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5217bf897ace48a8a5fa265412718d4e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyJ6LWe5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768360310&amp;x-signature=hbaTFbamAD%2BbG72mPXfXRejf%2Btg%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-13">2.4.1 选型与选择</h4>
<p>在明确了核心模块后，需要先回答两个问题：方案的选型、自研的选择。</p>
<p>在 AI 时代行业解决方案百花齐放，无论是大模型还是配套的技术，且迭代速度极快，比如近期的Gemini3（11月18日）、Nano Banana Pro（11月20日）。</p>
<p><strong>做的越多越容易陷入追赶的局面，最大程度的借助行业能力，并将其与企业内部资源串联是关键</strong>。</p>
<p>我们的<strong>核心策略是将通识的交给行业，集中资源做私有部分，通过行业迭代来提升底层能力</strong>。</p>
<h4 data-id="heading-14">2.4.2 Base Agent &amp; System Prompt</h4>
<p>明确策略之后，首先是基础模型的选择，在25年初时我们基本有共识，LLM 应该交给大厂，我们则专注于应用。</p>
<p>到了 5 月份我们发现 Agent 系统也有不错的行业实践，因此问题被延展成了<strong>选择基础模型还是选择基础 Agent？</strong> 也就是 Claude 还是 ClaudeCode？</p>
<p>围绕这个问题我们做了一些研究，发现 Claude Code 作为通用编程 Agent，在子 Agent 调度、MCP 集成、通用开发工具、上下文压缩方面已经做得不错了。</p>
<p>因此，我们选择了 Claude Code 作为基础 Agent 的底座，通过其强大的扩展能力，将其连接到我们内部的研发体系。</p>
<p>首先是系统提示词，这方面 Claude Code 已经做的不错了，我们仅做了少量扩展，总共不到 200 行，主要是一些内部的编程规范、特定约束。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6137a430534a4fdc8470e81a71cd025a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyJ6LWe5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768360310&amp;x-signature=vQE%2BjTbt8cWnyKcQou81MoK9nUM%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-15">2.4.3 Dev Tools</h4>
<p>接着是工具，和人一样，Agent 也需要开发工具。比如，当开发者让其参考历史需求，它需要能访问需求管理平台查看。又比如，它可以通过飞书文档创建一篇技术方案给开发者审阅。</p>
<p>这些工具散落在内部的各个系统、平台，有些在外部，我们通过 <strong>MCP</strong> 将这些工具集成到一起，交由 Agent 决策使用。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a41d72a6446f4b9892463c908e78d352~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyJ6LWe5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768360310&amp;x-signature=S0j5olJSr3ES1ReNFRp1WAxYvVE%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-16">2.4.4 Codebase Search</h4>
<p>有了工具后，接着是代码理解能力，这也是 Coding Agent 的关键能力之一。</p>
<p>我们将其分为了三层：<strong>目标仓库定位</strong>、<strong>跨仓库依赖代码召回</strong>、<strong>工作区代码理解</strong>。目标仓库定位比较简单，我们用的是知识库 RAG 的方案。</p>
<p>在代码理解上，业内常见的方案有：<strong>向量索引检索（RAG）</strong>、<strong>抽象语法树（AST）</strong>、<strong>文本搜索（grep）</strong>、<strong>预生成文档（deepWiki）</strong>，在实际应用中有不少组合的情况。</p>
<p>Cursor 选择的是 RAG 方案，好处是速度快，适合大的单体仓库，缺点是精度丢失（向量化），实时性不高。</p>
<p>Claude Code 则选择比较纯粹的文本搜索方案，和人很像，好处是精度高、实时性强，但性能会差一些。</p>
<p>在有赞对于跨仓库依赖代码，由于仓库数量庞大，采用的是 RAG 方案，同时更新频率没有 Cursor 这么高，我们基于 Git 的提交记录进行增了更新。对于工作区代码理解，由于基础 Agent 是 Claude Code，直接采用它的文本搜索。</p>
<p>另外，<strong>代码安全也十分重要</strong>，无论是发送给向量嵌入模型还是大模型的代码片段，都通过安全扫描进行脱敏。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/47e825ec1dbe46b98f8fd68455fe1208~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyJ6LWe5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768360310&amp;x-signature=%2F763lutZ7qxWZTYEA92IFAFG%2BSI%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-17">2.4.5 Knowledge Base</h4>
<p>有了代码，接着是内部知识，和开发者一样 Agent 需要理解业务知识，比如产品模块有哪些、业务术语是什么意思。也需要理解专业知识，比如技术选型用了什么、编程规范是怎样的，以及工程现状。</p>
<p>这些额外的上下文可以让 Agent 的编码更符合预期，避免写出“与众不同”的代码。</p>
<p>过往企业知识库建设有两大痛点，一是<strong>信息孤岛（无法统一检索/重复建设严重），二是内容老旧（因为缺少审核/运营机制，大量过期/错误内容）</strong>。</p>
<p>为此，我们内部成立了专门做知识工程的团队，由他们推动知识透明和更新。他们围绕知识增长、内容质量、知识使用进行建设，为上层应用提供高质量的知识。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/39b0d42cc15e4cba9f4f8b092f0ad653~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyJ6LWe5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768360310&amp;x-signature=cXZFEW9qPQ9KiDcsKj6hIsOHg7c%3D" alt="" loading="lazy"/></p>
<p>至此，一个 MVP 版本的 Coding Agent 完成了。我们拿去做了一些需求，发现效果并不好，原因是还<strong>有大量经验在开发者的头脑中</strong>。</p>
<h4 data-id="heading-18">2.4.6 Long-term Memory</h4>
<p>为此，我们会 Agent 打造了基于长期记忆的学习系统。简单来说，就是将开发者和 Agent 的监督对话提取为长期记忆，后续遇到类似场景时进行召回使用，这也可以实现跨会话的复用。</p>
<p>这就如同一个经验丰富的老员工手把手带教实习生，整个过程分为：</p>
<ul>
<li>
<p><strong>记忆提取</strong>，该阶段重点关注符合事实、保留细节、不归纳泛化。</p>
</li>
<li>
<p><strong>记忆储存</strong>，我们采用自然语言+标签的形式储存而非结构化，并且保留了原文引用。</p>
</li>
<li>
<p><strong>记忆合并</strong>，定期将类似记忆归纳合并。</p>
</li>
<li>
<p><strong>记忆检索</strong>，业内根据场景不同常见的有：向量数据库、知识图谱、分层存储，我们采用的是向量数据库。</p>
</li>
<li>
<p><strong>记忆遗忘</strong>，随着记忆数量的增加，根据时间和使用频次进行遗忘。对于高频使用的<strong>记忆经过泛化后转化为知识</strong>。</p>
</li>
</ul>
<p>虽然设定了很多提取规则和后处理，但在实际应用中，通过<strong>人工标注及修正的方式，可以较快加速记忆的可用性</strong>。</p>
<p>我们在 AI Coding 做了测试，同类任务未接入记忆需要 5-10 轮对话修正，接入记忆后仅需 1-3 轮，有较大提升。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e031694446d94b54aebfaf34fb510a0e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyJ6LWe5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768360310&amp;x-signature=UC3i3aY%2BEW%2FM4j55Nabe1vMatQ4%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-19">2.4.7 Cloud Sandbox</h4>
<p>Agent 构建完成后，无论是运行、调用工具、拉取代码等等，都需要一个环境，如同为开发者配置一台电脑一样。</p>
<p>通过对本地辅助编程的观察，我们发现本地运行存在一些问题：复杂环境导致额外上下文、工程化适配问题、安全与监管难解决。</p>
<p>因此，我们选择了云端部署的方案，为每个 Agent 的<strong>每次会话分配了独立且标准化的沙箱（Sandbox）</strong>，其中包含了开发环境，以实现交付结果预览。</p>
<p>同时对会话及沙箱做了无状态化，实现水平扩容能力。我们将会话存储在共享存储中，当开发者开启或继续一个会话时，会动态分配随机沙箱，并从共享存储中恢复会话。</p>
<p>这一切都需要<strong>通过统一网关，以解决安全和监管问题</strong>。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1f3149ca8fa54180b57003f50eeb2a01~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyJ6LWe5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768360310&amp;x-signature=aUf7YNOjr6jP3GDbKxqR5UpieL8%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-20">2.4.8 Multi Agents System</h4>
<p>随着接入环节的增加，我们发现单一 Agent 面对个多环节，由于 LLM 上下文长度导致了遗忘、性能等问题。</p>
<p>为此，我们引入了多 Agent 系统，将这些<strong>复杂度分而治之</strong>。</p>
<ul>
<li>
<p>在 <strong>Agent 的编排</strong>上有 Workflow 和 Agentic 两种方式。由于企业级工程对稳定性、观测性的要求较高，我们采用 Workflow 串联多个 Agent。在部分 Agent 内部通过 ReAct 模式发挥 LLM 的自规划能力。</p>
</li>
<li>
<p>在 <strong>Agent 的拆分</strong>上有流程拆分和领域拆分两种方式。我们都做了尝试，从落地情况看按流程拆分基本可以解决大部分问题。</p>
</li>
</ul>
<p>同时，我们为每个 Agent 做了<strong>差异化的基模选择</strong>，主要根据 Agent 的任务特点、LLM 的优劣势以及成本。</p>
<ul>
<li>
<p>需求解析和仓库定位较简单用 GTP-4o；</p>
</li>
<li>
<p>代码定位用向量嵌入模型 voyage-code-3 并配合 deepseek-v3 做一些后处理；</p>
</li>
<li>
<p>方案和编码则用 Claude-sonnet-4.5，其中记忆用 GTP-5 效果出色；</p>
</li>
<li>
<p>代码审查则用 Gemini 2.5 它的上下文窗口较大，可以把更多代码片段给到 LLM；</p>
</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/575350ec8ccd4742b69f5bf96faf4360~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyJ6LWe5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768360310&amp;x-signature=QtWjogqLx7j9NuKGaltVodMgjto%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-21">2.4.9 人工监督(HITL)</h4>
<p>整个 Agent 系统的运行离不开<strong>人工监督（Human in the loop）</strong>，我们面向开发者、管理者分别设计了两套监督系统。</p>
<ul>
<li>
<p>面向开发者的监督系统主要基于飞书 IM，它是一个天然的对话流，同时结合飞书文档、GitLab。开发者可以在 Agent 的每个阶段对产物进行审核，包括：需求清单、技术方案、改动代码、实际效果等，并通过多轮对话进行修正；</p>
</li>
<li>
<p>面向控制者的监督系统主要基于多维表格及其仪表盘，管理者对每个需求的情况一目了然，包括：交付率、对话轮次、Token 消耗、对话明细等；</p>
</li>
</ul>
<p>其中，对话明细可以转化为评测集，用于后续 Agent 的评测。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/15f97bb501ce485cb5985c2dd7a81a25~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyJ6LWe5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768360310&amp;x-signature=Ty%2FJE1bEIWctsbEXbPB1jsBLAoQ%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-22">2.4.10 对接发布系统</h4>
<p>最后，我们通过部署发布 Agent，打通了发布系统。如图所示，通过对话就可以很方便的部署到预发，或发布至生产：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7058a9fa3fd14e49b8350a62a7dd006d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyJ6LWe5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768360310&amp;x-signature=EWc34RfSrdx7a3%2Fyc78pxQjVIwM%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-23">2.5 产品形态</h3>
<p>这就是我们最终的产品形态，已经交付了不少需求。当然实际落地中，这种人机交互模式也有局限性，因此我们正在开发 Web 端，类似 manus 的效果。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fbfc282a3e534c8baab18193134d1257~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyJ6LWe5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768360310&amp;x-signature=H6jycOhdH%2FY%2Bl%2BsNQ6g9RkIhWHQ%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-24">2.6 需求选择与落地</h3>
<p>在 AI Coding 落地的需求选择上，我们分了三个维度：<strong>多职能、多仓库、需求规模</strong>，和新人一样在 Agent 能力还不够时，先从单职能单仓库的日常需求开始。通过<strong>做小需求验证 Agent 并积累数据</strong>，同时小需求因优先级不高而积累，用 AI 来做具有提效价值。</p>
<p>在我们将 AI Coding 推广到兄弟团队时，发现大家对 AI 期望很高，大家会给它做非常有挑战的需求，我们需要理解** AI 不是万能的，人做不了的它也是**。</p>
<p>目前我们的 AI Coding 已经可以实现单职能多仓库的日常需求，已交付近百个需求。综合提效 30%，包括人工监督的耗时，单个需求 Token 费用不到 100 人民币。</p>
<p>接下来我们会重点向多职能多仓库、项目级需求两个方向迭代。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/54868f867d654e1689fa4478b88fe029~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyJ6LWe5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768360310&amp;x-signature=RcGxW7guO7kFzOzFweczZ5tyNYM%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-25">2.7 实践案例</h3>
<h4 data-id="heading-26">2.7.1 翻译型事务</h4>
<p>在落地过程中，我们也发现了一些特别适合 AI 做的共性需求。</p>
<p>第一类我们称之为：翻译型任务。 已经有明确方案且较为简单的任务，AI 可以快速完成，且质量还不错。比如：技术债务治理。</p>
<p>有一个基础库升级的案例，涉及基础库、业务库和23个业务应用的升级，原本需要超过50人日，通过 AI 几十分钟就好了。</p>
<h4 data-id="heading-27">2.7.2 降低开发门槛</h4>
<p>第二类是跨域编程，我们工作中经常会需要跨团队、跨领域支援，过往人的学习和熟悉过程会有额外的时间。通过 AI Coding 我们的开发者进行了不少的跨域编程，这部分时间几乎被抹平。</p>
<h4 data-id="heading-28">2.7.3 小插曲：移动编程</h4>
<p>另外有个比较有意思的小插曲分享一下：</p>
<p>相信程序员都有共鸣，随身携带电脑是大家的痛点之一。在我们落地 AI Coding 的过程中发生了另外一个小案例，有个开发同学出去聚餐没带电脑，这时候来了个 Bug：</p>
<ul>
<li>
<p>他掏出手机打开飞书用聊天唤起了一个 Agent</p>
</li>
<li>
<p>把 Jira 和说明丢过去</p>
</li>
<li>
<p>让 Agent 先改着，就先吃饭了</p>
</li>
<li>
<p>过了几分钟 Agent 改完了</p>
</li>
<li>
<p>他看了没问题就让 Agent 发布了</p>
</li>
</ul>
<p>这虽然只是很小很小很小的案例，但确实让我们看到了 AI 正在慢慢改变我们的编程方式。</p>
<h3 data-id="heading-29">2.8 完整架构</h3>
<p>以上，就是我们在 AI Coding 方面的实践：</p>
<ul>
<li>
<p>首先，我们做了好用的工具，也就是云端 Sandbox；</p>
</li>
<li>
<p>其次，基于上下文工程，我们打造了专业的 Agent 个体；</p>
</li>
<li>
<p>最后，通过 MAS 让他们协同工作；</p>
</li>
<li>
<p>另外我们也做了人机交互界面，让人可以监督 Agent；</p>
</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fb6883bb1fba4cbaba9ddd572de3f622~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyJ6LWe5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768360310&amp;x-signature=OASqaqb%2FCZ9TuosHyf1Ko6GOJAM%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-30">3. AI Test：从自动化到智能化</h2>
<h3 data-id="heading-31">3.1 传统测试的局限</h3>
<p>在开始之前，先简单回顾下传统测试的挑战：技术栈多样化、设备终端碎片化、工程规模增大，因此<strong>对测试效率提出了要求</strong>。</p>
<p>自动化测试被引入，提升了一些效率，但有一些局限：编写有门槛、维护成本高、难扩展复用、失败排查困难。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/85a3d1036e334b9db30135500b932337~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyJ6LWe5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768360310&amp;x-signature=Y%2FFqg76Jivi%2FgNa8BTyQGtBMU4o%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-32">3.2 AI时代的新挑战</h3>
<p>在 AI 时代，随着编码效率提升，<strong>对测试效率提出了更高的要求</strong>。同时由于 AI 生成代码不确定，影响面和风险更大，对测试带来了新挑战。</p>
<p>同样 AI 也对测试带来了新的可能：</p>
<ul>
<li>
<p>在测试设计阶段，能做 AI 用例生成、AI 用例优化、AI 用例选择（精准测试）等；</p>
</li>
<li>
<p>在测试执行阶段，能做 AI 数据构造、AI 驱动执行、AI 增强录制、AI 无参考测试等；</p>
</li>
<li>
<p>在评估优化阶段，能做 AI 失败归因、AI 用例修复、AI 分析报告等；</p>
</li>
</ul>
<p>我们在这方面踩了不少坑，也有些在部分场景落地了。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/851826f1387d4193a33e42144bc750d8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyJ6LWe5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768360310&amp;x-signature=e%2FvGExw9virnExzthnsD6IwD3Fk%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-33">3.3 AI用例标准化</h3>
<p>首先是，AI 用例标准化，在我们开始<strong>结合 AI 和测试时，碰到的第一个问题就是：用例</strong>。</p>
<p>过往历史用例缺乏维护，质量参差不齐，如左图各种隐式步骤、断言缺失。另外用例还分散在各个平台，比如文本和自动化用例互不相通。</p>
<p>这就导致了<strong>GIGO（Garbage in, Garbage out）的现象</strong>，你给 LLM 的输入质量低，它的输出质量也低，幻觉严重。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/39e079a624374e9197503fe46e64d32e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyJ6LWe5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768360310&amp;x-signature=LaizA%2FTNDSZNp%2BbconfhLKNm%2BWQ%3D" alt="" loading="lazy"/></p>
<p>于是，我们开始思考如何解决用例的问题，我们发现 LLM 本身有强大的自然语言理解能力。这让传统文本用例和自动化用例的融合成为可能，也就是<strong>自然语言用例</strong>，让用例<strong>兼具语意性和可执行性</strong>。</p>
<p>我们探索了两个方向：AI 存量用例优化、AI 增量用例生成。</p>
<p>首先是存量用例优化，根据已有的测试目标和测试步骤由 LLM 生成更规范的用例名、标签等，同时逐步优化用例步骤、补充断言。</p>
<p>其次对于增量的用例，我们结合业务知识库，并参考现有用例进行生成。</p>
<p>所有的这些<strong>自然语言用例放在一起，它们本身就是一个高质量的测试知识库</strong>。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/52a317d60e674e8db994f2d40ee5de0f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyJ6LWe5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768360310&amp;x-signature=CsE6Ms3C9XAKYD3VlYmtCMaSqa8%3D" alt="" loading="lazy"/></p>
<p>一个新的用例生成过程分为三步：</p>
<ul>
<li>
<p>填写基本信息：测试目标、开启 AI 规划；</p>
</li>
<li>
<p>选择参考用例：从历史用例库选择供 LLM 参考；</p>
</li>
<li>
<p>用例生成：LLM 会生成用例的基础信息，以及完整的测试步骤，这里的步骤是自然语言，一目了然，且可被执行；</p>
</li>
</ul>
<p>目前，用例生成的准确度和覆盖场景还有很大空间，仍处于探索阶段。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d99e6a9f680f4e6eb48f57daf4b12f3b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyJ6LWe5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768360310&amp;x-signature=Zw79g%2FclL6ZnCfe5VY8KhrqBhh4%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-34">3.4 AI增强录制</h3>
<p>我们还有不少用例是录制的，因此我们做了 AI 增强录制。</p>
<p>首先先简单回顾下传统录制的局限：定位不精确、录制步骤冗余、需要人工校准、维护成本高。如下图：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/474913121e4145ee8b9d2694a384fbfa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyJ6LWe5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768360310&amp;x-signature=xmtwEhxh7ooYE%2BIUDhI0owBWIbA%3D" alt="" loading="lazy"/></p>
<p>通过 AI 增强后，测试步骤可以精确识别用户的意图：输入价格1、输入划线价2，且较为精炼：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1a46346a13884eb59dc70d94be1bbfe9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyJ6LWe5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768360310&amp;x-signature=O%2FyuN3vcCqiYeymhEhhlIsfGT7g%3D" alt="" loading="lazy"/></p>
<p>整个增强过程大致分为几步：</p>
<ul>
<li><strong>DOM+截图输入</strong>：首先是捕捉用户的操作，将完整 DOM 和截图丢给多模态 LLM，目前通用多模态 LLM 已经比较强大了，我们第一版就能做到 70% 准确率。即使不提供 DOM，LLM 也可仅依赖截图识别，从而支持跨平台录制。但这个方案的 Token 消耗是巨大的，且上下文太长会带来一些幻觉导致不稳定；</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/28a373f0691746f1b5ebd8830167241a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyJ6LWe5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768360310&amp;x-signature=oXbczhNhnIwcIu1kJmFAQjZqgNQ%3D" alt="" loading="lazy"/></p>
<ul>
<li><strong>DOM 预处理：<strong>通过对</strong> DOM 进行裁切</strong>，降低噪音和 Token 消耗，同时标注重要内容提升大模型注意力。另外一些敏感的信息和代码也会被过滤。做完这些后我们的上下文能裁切大约 99%；</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/188539d74bcf4bc28d9308fd148b615c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyJ6LWe5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768360310&amp;x-signature=WelGmUbVBgyRI3XmQwANKs7b3lc%3D" alt="" loading="lazy"/></p>
<ul>
<li><strong>交互区域标注</strong>：接着我们把 70% 准确率进一步提升，遇到了一些问题。在用户操作无交互表现的情况下，LLM 无法很好的理解，如左图，这里点击“…”没有交互状态变化，LLM 只理解到“点击空白区域”。我们通过增加<strong>交互区域标注</strong>来解决，这让 LLM 可以准确理解用户交互的区域，效果如右图，LLM 可以理解到“点击更多按钮”；</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5ad1f079ee6f41f698e36743274563d5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyJ6LWe5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768360310&amp;x-signature=TnRICdSZOJpvRjSyTIKUFd5FnXM%3D" alt="" loading="lazy"/></p>
<ul>
<li><strong>父级元素标注</strong>：虽然增加了交互标注，但在一些复杂业务，元素之间是有关联的。如左图，“？”的图标，LLM 可以理解到是“帮助”，但它并不理解是“退款资金状态的帮助”，如果一个页面中有多个类似图标就不准确了。为此，我们增加了<strong>父级元素标注</strong>，把交互区域前后的父级 DOM 元素一起给到 LLM，让其理解更多上下文关系。如右图，增加后 LLM 可以理解到“点击退款资金状态的帮助”；</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/806fec88fa16417daa8cd7172afcc1e8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyJ6LWe5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768360310&amp;x-signature=sSr%2BRoegFp70YRYvnH8D3YrEU6w%3D" alt="" loading="lazy"/></p>
<p>做完这些后，我们的准确率可以做到 89%，单次增强的耗时在 5-10 秒之间，这<strong>得益于模型能力的提升</strong>，从 Qwen2.5-VL 的 20 秒到 GTP-4o 的 10 秒以内。</p>
<p>目前这套方案是跨全平台的，包括Web、Pad、桌面等设备，Android、iOS、鸿蒙等系统，以及各类小程序。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a39aa1dcbbe74930b498cccc79974da5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyJ6LWe5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768360310&amp;x-signature=87542vyRhKceNE5EUUFG1uclV2U%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-35">3.5 AI用例执行</h3>
<p>有了用例之后，接下来是用例的执行。目前我们的用例执行都会统一注册到任务中心，由其下发到两大集群，分别执行浏览器任务、App任务（包括小程序）。</p>
<p>AI 在执行方面有天然的优势，<strong>跨平台支持</strong>，具备一定<strong>自适应能力</strong>，比如一些设备有像素抖动的情况，LLM 可以识别提升用例稳定性。</p>
<p>目前我们的用例执行量超过每天 10 万次，任务成功率 96%。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/474f204343ae4eb9a5b96fc96f8bb5b2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyJ6LWe5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768360310&amp;x-signature=Qdx9t1gQ5%2Bfd9TlzAouKlAQIFuE%3D" alt="" loading="lazy"/></p>
<p>当然，这个过程中也遇到了一些问题：模型执行速度慢、模型幻觉问题、模型识别精度问题。</p>
<ul>
<li>
<p><strong>解决“模型执行速度慢”</strong>：我们先做了基于图像和 Prompt 的<strong>识别缓存</strong>。但未命中缓存时 AI 指令的秒级，和程序指令的百毫秒级差距依旧很大。因此我们做了 AI 提速，用例解析后首先程序执行，失败时 <strong>AI 兜底执行</strong>，执行成功后由 AI 进行自愈，提取成功的信息更新程序脚本；</p>
</li>
<li>
<p><strong>解决“模型幻觉问题”</strong>：幻觉问题不是太大，通过 LLM 二次优化步骤 Prompt，同时采用更准确的 AI 指令（如 Midscene 中用 AI Input 替代 AI Action）基本可以解决；</p>
</li>
<li>
<p><strong>解决“模型识别精确问题”</strong>：看下图中右上角的图，红框是 Qwen-vl-max，绿框是UI-TARS-1.5，它们对于小元素的识别精度差异很大。从我们时间来看 Qwen-vl-max 对小图标识别能力较差，开启 deepThink 有所改善。UI-TARS-1.5 具备较强的探索能力，它们在断言方面都不如 GTP-4o。我们也从元素定位、元素断言、内容提取、任务规划方面，测试了 5 个主流端，<strong>UI-TARS-1.5 在元素定位精度和移动端表现较好</strong>，也是我们目前的选型；</p>
</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/36f0cb4dd38b44e2ab0f726dfde95526~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyJ6LWe5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768360310&amp;x-signature=LZGzfgAyJO%2BOeHSOMc%2FpoL8nOIA%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-36">3.6 AI无参考测试</h3>
<p>做了 AI 执行后，我们开始思考 LLM 本身具备常识，也知道企业内部知识，是否可以做 AI 无参考测试？</p>
<p>我们做了探索，首先要做无参考测试，<strong>对模型精度要求较高，通用的多模态 LLM 较难满足</strong>。</p>
<p>因此，我们引入了<strong>监督微调（SFT LoRA）</strong>，主要让 LLM：具备更细化的任务定义、明确输出格式便于工程化对接、注入内部知识和评判标准。</p>
<p>我们的算法团队做了不少建设，让业务团队可以聚焦在微调数据集。一条微调数据包括：Instruction、Input、Output，下图是一个最简单的案例：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d682a89771414c529cad0b27de72d4af~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyJ6LWe5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768360310&amp;x-signature=yrMGJJWrgYdhRL3zWegxOyWb34E%3D" alt="" loading="lazy"/></p>
<p>当然这条微调数据并不好，它的 Output 缺少了很多内容， 比如：作答风格、结构化输出、内部知识、分析的过程和原因。我们从<strong>指令微调</strong>、<strong>思维链微调</strong>两部分对这条数据进行优化，如下图：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0b9ca85b712c4da69ab03d71c39c0de4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyJ6LWe5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768360310&amp;x-signature=AGQ7afs%2B%2FnKIIw6%2BHu1AcvnjwwU%3D" alt="" loading="lazy"/></p>
<p>定义了数据结构，接着是如何生成大量的微调数据，一般需要<strong>训练集、验证集和测试集</strong>，前两者用于训练过程，后者用于最后的评估。</p>
<p>整个数据集包括正样本、负样本和混合样本，一般比例为 1:3，避免模型过度偏向“总是发现问题”。</p>
<p>数据集通过 LLM 合成，首先通过脚本抓取线上的原始样本（正样本），然后通过程序合成多个负样本。</p>
<p>结合样本图片和特定的 Prompt 用 LLM 来生成 Output，Prompt 中包括我们的内部知识、预期输出结构、作答风格。</p>
<p>目前我们的垂直模型正在微调中。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1479bf9faa964d1884d873db866f360a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyJ6LWe5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768360310&amp;x-signature=lQ85Cr%2BSmT02ArLzd%2FSRAj7Zaok%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-37">3.7 AI归因归类</h3>
<p>当用例执行完成后，我们需要对失败用例进行分析，过往需要人工分析效率较低，100 条失败需要15分钟。</p>
<p>我们通过 AI 来提速这个过程，首先由 LLM 将单个失败总结核心原因，然后将类似原因的分组归类。</p>
<p>如右下图，一共 85 条失败用例，被快速归为了 3 组，且标明了核心原因。</p>
<p>人工可以非常快速的进行分析，100 条仅需 1 分钟。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/08a1af2aa06f44048a374f3f24127250~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyJ6LWe5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768360310&amp;x-signature=h6%2FZGUph9RG3b5jqyZYGYoncZX8%3D" alt="" loading="lazy"/></p>
<p>整个归因归类过程，首先是对用例执行报告进行<strong>程序预处理。</strong></p>
<p>程序主要将失败图片进行切片、步骤进行拆分。前者解决多模态 LLM 在大图下的幻觉及不稳定性，后者解决性能问题。</p>
<p>接着切片交给图片归因 Agent、步骤归因 Agent，进行<strong>并发分析。</strong></p>
<p>再由总结 Agent 对原因进行合并总结，最后归类 Agent 对原因类似用例进行分组。</p>
<p>目前我们线上用例已 100% 覆盖 AI 归因归类，归因准确率为 85%。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6e976b13f21b44af8345a34da43d4dbe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyJ6LWe5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768360310&amp;x-signature=0Pz1RCyZSuwDKq9hYlM0pAYhNc4%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-38">3.8 AI用例修复</h3>
<p>做了 AI 归因归类后，我们发现既然原因都知道了，何不让 LLM 自己修复？</p>
<p>因此，我们正在探索了 AI 用例修复，目前主要针对像素差异率波动、非核心元素变化的场景实现了修复。</p>
<p>如下图，AI 会对可修复场景进行建议，人工确认无误可一键修复。目前修复准确率 60%。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1c3d934b29f44c51ba2523a93f38dd47~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyJ6LWe5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768360310&amp;x-signature=mlVouCuMXTihmQVLyb8cHzN2Cjc%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-39">3.9 与 AI Coding 结合</h3>
<p>以上就是我们在 AI Test 方向的实践，后续我们计划串联 AI Coding 和 AI Test。由 Coding Agent 生成测试目标，交由 Test Agent 对用例进行召回和生成，并完成后续的自动化测试工作。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/209cced3fade49d7937b93b2dcde62f8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyJ6LWe5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768360310&amp;x-signature=LX0j8Zu67Q%2FKuUx%2FOrM67%2BWbNRo%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-40">4. Agent 评测：从炫酷飞起到生产落地</h2>
<p>在 AI Coding 和 AI Test 中我们构建了大量的 Agent，需要一套 Agent 评测体系对它们进行评估反馈。</p>
<h3 data-id="heading-41">4.1 为什么需要评测</h3>
<p>先看一张大家都很熟悉的图，我们看别人的 Agent 时都会觉得好炫酷跃跃欲试，然后自己也开始手搓 Agent。</p>
<p>做完后在开发环境或者小范围测试中表现也不错。</p>
<p>发布到生产后，各种奇奇怪怪的情况，用户提问的思路无法捉摸，最后还是要转人工。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8a2acbe1b3b14f7b8f09e64f762fd529~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyJ6LWe5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768360310&amp;x-signature=j3Uj49TX7LRi4O3HVqhh7%2F0etlU%3D" alt="" loading="lazy"/></p>
<p>我们需要知道，Agent 和传统软件不同，没办法列举完整的用例来保障效果。</p>
<p>软件测试目标固定、标准化、可复现，而 Agent 评测具有不确定性、开放性（比如用户提问）、多样化（比如模型回答）。</p>
<p>发布标准上，传统软件主要看功能点完成度，测试通过与否。 Agent 则需要用评测集进行多维度的指标评估。</p>
<p><strong>Agent 开发完并不意味着达到生产发布标准，应该用评测指标作为依据。</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dad5d343df5f48568f6b9eff61ff51b0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyJ6LWe5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768360310&amp;x-signature=4pTKuy%2BVHMzIVhPKAJHsO7d7aR0%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-42">4.2 评测集</h3>
<p>开始 Agent 评测，首先需要准备评测集， 评测集的类型有：有参考、无参考、参考资料三种。</p>
<p>接着是评测集的构造，常见的方法有：人工标注、LLM 泛化、线上采样。</p>
<p>一个全新的 Agent 没有线上采样数据，我们可以通过人工标注 50-100 条的种子集，然后让 LLM 进行泛化。</p>
<p>评测集根据场景不同，也可以划分为：种子集、Badcase集（一般来源于用户反馈）、扩展集、对抗集、场景集（一般由业务场景决定）。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/263c223c599f413d95bdf78f4baa9a68~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyJ6LWe5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768360310&amp;x-signature=WB9cmNBLkgrhMUSCHl8grIR2i%2FM%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-43">4.3 评测器</h3>
<p>有了评测集之后是评测器，评测可以分为两种：人工评测、自动化评测。新的 Agent 初期由于评测标准不确定，可结合人工评测，<strong>随着调用增加，将人工评测维度沉淀为自动化评测</strong>。相较于人工，自动化评判尺度统一、主观偏差少。</p>
<p>自动化评测器包括： 托管（平台自带的评测器，可以快速启动评测项目）、 自定义（自行根据业务编写 Prompt 的裁判模型）、外部（由外部平台/服务提供）。自动化评测器可以由 LLM 作为裁判，可以是特定的算法验证（如 BLEU、CLIPScore等），也可以是业务逻辑验证。</p>
<p>评测器设计一般包括：评估步骤、打分标准、推理指令、少样本提示(正例/反例)、边界案例、基于业务的判断要点(如合规、医疗等场景)。评测打分用 0-5 分制<strong>归一，可以兼顾可解释性和区分度，让不同评测维度可以横向对比</strong>。另外，为裁判模型<strong>添加 CoT 可以提升可解释性</strong>、一致性，便于后续人工分析和优化。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2caf42d2e3c647b0b267e7ad8a999358~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyJ6LWe5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768360310&amp;x-signature=YKG%2BHB%2FpHL4wtn0UvcfFM%2FZTG5E%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-44">4.4 评测指标</h3>
<p>接着是评测指标的设定，首先需要先明确评测主体，可以是：基础模型、提示词版本、工具版本、召回的记忆等。</p>
<p>围绕主题设定评测指标，通常有四类：效果指标、技术指标、用户指标、业务指标。</p>
<p>另外<strong>裁判模型自身需要有评测指标</strong>：</p>
<ul>
<li>
<p>人工一致性， 衡量模型评分与人工标注结果的一致程度；</p>
</li>
<li>
<p>评分方差，衡量模型打分的稳定性；</p>
</li>
<li>
<p>异常打分率；</p>
</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3be218df505e4636bce564183a953cbd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyJ6LWe5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768360310&amp;x-signature=wsGABIkq54FqzOxKkC5h3MR7t0k%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-45">4.5 反馈系统</h3>
<p>除了人工评测、自动化评测外，生产中<strong>用户真实的反馈至关重要</strong>。能够帮助我们发现 Agnet 在实际应用中遇到的各种边界场景和潜在问题。</p>
<p>一般有两种方式：</p>
<ul>
<li>
<p><strong>显示反馈</strong>：需要用户明确操作(点赞/点踩)反馈，意图明确但反馈率较低；</p>
</li>
<li>
<p><strong>隐式反馈</strong>：是用户使用流程中的行为数据，被采集并解释为反馈，可以获得较高反馈率，比如 AIGC 生成多张图片时，用户选用其中一张图；</p>
</li>
</ul>
<p>对于反馈率低的问题，<strong>通过预设标签来减少用户行动成本，通过预设高评分来增加用户反馈意愿</strong>（人们更倾向吐槽而非夸赞）。</p>
<h3 data-id="heading-46">4.6 评测体系</h3>
<p>以上这些组合在一起构成了我们完整的评测体系。</p>
<ul>
<li>
<p><strong>项目启动</strong>：由专门的评测人员和项目组成员，共同设定评测维度、创建评测器、建立种子集、泛化评测集，基于评测不断迭代/验证/反馈 Agent；</p>
</li>
<li>
<p><strong>开发过程</strong>：在 Agent 迭代过程中，通过评测集和评测器进行线下实验；</p>
</li>
<li>
<p><strong>生产环境</strong>： Agent 会产生日志和反馈，日志会通过评测器进行线上评测，Trace 可采样沉淀到评测集，另外反馈的 Badcase 也会沉淀到评测集；</p>
</li>
</ul>
<p>所有 <strong>Agent 发布前都需要经过评测验证</strong>。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c7a7feb7de8245db9e372b2c40ef5837~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyJ6LWe5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768360310&amp;x-signature=Aa%2BdnpAz8tRKRn8A9%2FtDiSaOSX4%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-47">5. AI落地的一些经验</h2>
<h3 data-id="heading-48">5.1 AI与程序的结合</h3>
<p>首先是 AI 与程序，常见构建 Agent 的模块包括：程序计算节点、单一 LLM 节点、Workflow、Agentic。</p>
<p>可能有些人会觉得，Agentic 比 Workflow 好，Workflow 比单一 LLM 节点好，单一 LLM 节点比程序好。从我们实践来看，这四者之间<strong>没有绝对的优劣，通常需要根据业务场景进行多选和组合</strong>，其取决于场景对确定性、稳定性、创造性、自主性的侧重。</p>
<p>另外，程序和 LLM 也并非替代关系，LLM 更适合理解、规划、生成类任务，程序更适合确定性、稳定性、高性能任务。通过<strong>程序规避 LLM 的弱项是必要的，避免过度追求 AI 含量</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3faa0c1f75114b0ea494b4e17636dbae~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyJ6LWe5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768360310&amp;x-signature=Zr6sNyjF35W8tw8KACY8jqZ5ISA%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-49">5.2 AI与人的陷阱</h3>
<p>接着是，AI与人，需要警惕两个陷阱：</p>
<ul>
<li>
<p>在落地 AI Coding 的过程中，出现开发者对 LLM 生成代码的依赖，甚至出现不作判断直接提交的情况。<strong>保持开发团队的主观判断力非常必要</strong>。另外分场景追求 AI 生码，比如核心业务逻辑人写，非核心交由 AI 写；</p>
</li>
<li>
<p>在落地 AI Agent 的过程中，需要人工监督，应该**警惕人工监督大于迭代 Agent **的情况，将监督数据用于 Agent 迭代；</p>
</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b1f0804c876f46b4812e80c2d5f6d4f5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyJ6LWe5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768360310&amp;x-signature=f5xOpe4nJl4fOuicHLNAZ5mvypk%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-50">5.3 AI落地经验</h3>
<p>最后总结下 AI 落地的关键经验：</p>
<ul>
<li>
<p>区分创造性和执行性工作，<strong>现阶段 LLM 可以较好的完成执行性工作</strong>，这类场景较为合适；</p>
</li>
<li>
<p>落地从传统研发流程切入，寻求<strong>快速出 MVP 进行单点突破；</strong></p>
</li>
<li>
<p>现阶段 AI 仍需大量人参与，过程中<strong>充分考虑人机协作</strong>，比如人机交互（人好用）、知识外化（人转化）、责任归属（人敢用）；</p>
</li>
<li>
<p>同步建设私有化的 AI 基建，<strong>将行业能力与企业内部能力串联；</strong></p>
</li>
<li>
<p>Agent 的迭代不能先方案再开发，应该<strong>基于测试集和上下文工程快速试错；</strong></p>
</li>
<li>
<p>最后在不同的场景<strong>分阶段落地</strong>，不要一蹴而就；</p>
</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4e5193e86b9b41b4b9beabe880d88dd8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyJ6LWe5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768360310&amp;x-signature=2kzwBzSTYNhLs2qvK8M2ZsT8aQQ%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-51">6. AI实践全景</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6e0c636543014eec86215b51d6e7450a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyJ6LWe5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768360310&amp;x-signature=Rnkh3npi6zQeg46GvBJkqcOD%2FV4%3D" alt="" loading="lazy"/></p>
<p>以上是我们在研发全流程落地 AI 的实践：</p>
<ul>
<li>
<p>我们<strong>通过软件工程（Software Engineering）和上下文工程（Context Engineering），将程序与 LLM 结合</strong>；</p>
</li>
<li>
<p>围绕研发的设计、编码、测试阶段落地 AI 能力；</p>
</li>
<li>
<p>过程中建设了 Agent 评测体系，不断反馈，持续迭代；</p>
</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[嫌市面上的刷题App太丑，我让Comate帮我写了个“考证神器”]]></title>    <link>https://juejin.cn/post/7592094314473062435</link>    <guid>https://juejin.cn/post/7592094314473062435</guid>    <pubDate>2026-01-07T03:28:50.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592094314473062435" data-draft-id="7592147128215371828" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="嫌市面上的刷题App太丑，我让Comate帮我写了个“考证神器”"/> <meta itemprop="keywords" content="前端,产品"/> <meta itemprop="datePublished" content="2026-01-07T03:28:50.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="文心快码BaiduComate"/> <meta itemprop="url" content="https://juejin.cn/user/992209294070809"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            嫌市面上的刷题App太丑，我让Comate帮我写了个“考证神器”
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/992209294070809/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    文心快码BaiduComate
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-07T03:28:50.000Z" title="Wed Jan 07 2026 03:28:50 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>作者：</p>
<p>林春辉，互联网教育行业产品运营，AI 辅助开发的实践者。不满足于纸上谈兵的产品方案，热衷于借助 AI Coding 跨越技术门槛，将业务灵感直接转化为可用的产品雏形，致力于探索非技术人员如何通过 AI 拓展能力边界，实现从“想法”到“产品”的高效闭环。作品「业余无线电考试题库」获得“CCF程序员大会码力全开：AI加速营”活动季军。</p>
</blockquote>
<p>在2025年12月，我报名参加 “CCF程序员大会码力全开：AI加速营”比赛，在这场比赛中，我交出了我的作品《业余无线电考试题库》App。</p>
<p>“业余无线电考试题库” 是一款专为业余无线电爱好者量身打造的 iOS 备考与实用工具应用。它不仅是一个刷题软件，更是一个聚合了摩尔斯电码练习、天线计算、频率查询等硬核功能的“口袋工具箱”。 本项目旨在解决业余无线电操作证书考试（A/B/C类）资料分散、练习体验差的痛点，帮助更多人轻松跨过门槛，走进这个充满温度的无线电通信世界。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b94ce8a462fa41169b3f70bd86e1bbae~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paH5b-D5b-r56CBQmFpZHVDb21hdGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768361330&amp;x-signature=KKLZU%2ByabbfrfZy8XZ2M4hfNiKk%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>在比赛完成后，我才发现“一个人+一个AI”的上限居然还可以这么高，也很荣幸在这个比赛中获得了三等奖。</p>
<p>回头来看，最初报名参加 “CCF程序员大会码力全开：AI加速营” 的时候，我的动机很不纯粹。</p>
<p>一方面是手痒，想看看现在的AI编程助手到底进化到了什么程度；另一方面，纯粹是因为我最近在考业余无线电操作证书（HAM），被市面上现有的刷题App丑到了。满屏的贴皮广告、更新还极慢的题库……那种感觉，就像你准备了一桌好菜，结果对方扔给你一双发霉的筷子。</p>
<p>我的的强迫症让我无法忍受，但独立开发的巨大工作量又让我望而却步。但我脑子里突然蹦出一个疯狂的念头： 既然比赛要求可以用AI提效，那我能不能把这个App作为赛题？把那些让我头秃的“脏活累活”全扔给AI，看看在一周时间的极限高压下，一个人+一个AI，能不能独立完成这款产品？</p>
<p>于是，这场为了“偷懒”而开始的硬仗，开打了，这次我选择了我和百度Comate一起作战。</p>
<h2 data-id="heading-0">01 不仅要有想法，更要有落地的章法</h2>
<p>既然是要上线的产品，就不能止步于“能跑就行”的粗糙Demo。我要的是那种逻辑严密、功能闭环，能让用户觉得“这是一个成熟产品”的完整度。</p>
<p>在过去，光是梳理题库逻辑、设计复习算法和规划模拟考规则，就能耗掉我一周的精力。但这次，我坐在电脑前，把产品构思的焦虑抛在一边，对百度的Comate下令：</p>
<blockquote>
<p>“我需要开发一款业余无线电考试助手，请帮我生成一份详细的产品功能方案。要包含题库管理、基于艾宾浩斯遗忘曲线的智能练习模式，以及全真模拟考试系统。”</p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3c414e7942664ed59cd518be55f635a2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paH5b-D5b-r56CBQmFpZHVDb21hdGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768361330&amp;x-signature=uQdMNaLOq7XCEAI66ucvLFEoGOQ%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>Comate的回复：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f993443a8f0649cb951d6a92b8b8ba1a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paH5b-D5b-r56CBQmFpZHVDb21hdGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768361330&amp;x-signature=1uWe9%2F6vEiTdEMoUHpFWI7DO9kA%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>Comate 吐出文档的那一刻，我确实被惊到了。</p>
<p>它不仅帮我构建了清晰的Markdown 目录结构，甚至在细节策划上比我考虑得更周全——看看屏幕右侧生成的方案：包括了清晰严谨的产品方法，清晰的功能模块拆解</p>
<ul>
<li>合理的用户使用路径</li>
<li>针对 A / B / C 类执照</li>
<li>不同考试时长</li>
<li>不同及格标准</li>
<li>不同题目分布</li>
</ul>
<p>甚至连：</p>
<ul>
<li>错题归因逻辑</li>
<li>复习提醒策略</li>
<li>练习 → 模拟考 → 查漏补缺的完整闭环</li>
</ul>
<p>都帮我提前想好了。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/56537859beef470d82122db261780bd5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paH5b-D5b-r56CBQmFpZHVDb21hdGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768361330&amp;x-signature=XZyn3PKINbnOHQFXGAEUlahDE7s%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>在项目的立项混沌期，Comate帮我省下的不是打字的时间，而是从“灵光一现”到“严谨方案”之间巨大的思维内耗。它让我的产品地基，从第一行代码开始就是稳固的。</p>
<h2 data-id="heading-1">02 始于颜值，终于“像素级”还原</h2>
<p>做独立开发的朋友都知道，最让人头秃的往往不是后台逻辑，而是把脑海里那个“好看的皮囊”完美落地到屏幕上。 调色、阴影、圆角、渐变、适配暗黑模式……这些事情重要，但是繁琐且很难一次到位。 在比赛现场，我没有在复杂的 SwiftUI 参数里打转，而是结合使用了 Comate 的 Figma 插件。我只需要做 2 件事：</p>
<p>• 在 Figma 里画出设计稿</p>
<p>• 用自然语言描述设计意图。</p>
<p>这一步简直是降维打击。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2a00c20af8994a54a61c37d544cba8ea~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paH5b-D5b-r56CBQmFpZHVDb21hdGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768361330&amp;x-signature=0I0lLEXCfXORT%2FPyx2Y6GvNzLOw%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>我不再需要手写冗长的样式代码，而是直接让 Comate解析设计意图：</p>
<blockquote>
<p>“实现深邃的极光渐变背景，配合通透的拟态卡片效果。” 代码生成的那一刻，不仅是还原，更是升华。它让我能够以极低的成本实现极具高级感的UI效果，这种流畅的视觉体验构建过程，确实远超我用过的同类工具。</p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aa33e55792b14d23bc81ee2f326ed50a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paH5b-D5b-r56CBQmFpZHVDb21hdGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768361330&amp;x-signature=JzBRLGeoxt7ZX5qb0Fxlmsb%2FaHg%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>我把死磕像素偏移的时间省下来，去思考怎么让交互更打动人心。</p>
<h2 data-id="heading-2">03 当AI遇到“知识盲区”，Context7救了命</h2>
<p>比赛中途遇到了一个大坑。 由于iOS版本迭代太快，AI生成的某些API在最新的Xcode里被废弃了，报错一片红。这时候最搞心态，往往一卡就是半天。</p>
<p>这时候，Comate的 Context7 (MCP) 功能成了我的“外挂”。 它不是在瞎猜，而是允许我让AI“联网”去查最新的官方文档。包括：</p>
<ol>
<li>读取最新的 Apple 官方文档</li>
<li>理解 API 的变更原因</li>
<li>给出符合当前版本的替代写法</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9302db5e15e34e10a392dd433f8d11fe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paH5b-D5b-r56CBQmFpZHVDb21hdGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768361330&amp;x-signature=nIQe60zYwYx0Z58eQZJZkrh9Jpk%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>报错 -&gt; 唤起Context7 -&gt; 读取Apple最新Developer文档 -&gt; 修正代码。 这一套连招下来，直接把“幻觉”变成了“标准答案”。</p>
<p>这个功能真真好用！这个尝试也让我第一次意识到，MCP 并不是“某一个功能”，而是一种可持续扩展 AI 能力边界的入口。当我发现 Context7 可以解决 iOS API 更新这种现实问题时，我开始反过来思考：在自己的项目中，还有哪些“反复查资料、容易出错、却高度依赖权威信息”的环节，也同样适合通过 MCP 接入？一旦养成这种习惯，开发效率的上限不再取决于模型本身，而取决于你是否主动去寻找、配置并使用更多合适的 MCP 来辅助开发。强烈推荐给每一位vibe coding的小伙伴！</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/535f38435096475e884a821a8e4819c4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paH5b-D5b-r56CBQmFpZHVDb21hdGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768361330&amp;x-signature=LF4oMDZmsSSRIBSomaIRggmWryU%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<h2 data-id="heading-3">04 给技术注入灵魂</h2>
<p>﻿如果只是刷题，那这个App毫无意义。 作为一名HAM，我深知无线电的浪漫，不仅在于考试，更在于电波划破长空的那一刻。</p>
<p>既然基础功能AI都帮我搞定了，在比赛剩下的时间里，我开始“夹带私货”。我让Comate帮我写算法，实现了一些硬核功能，让《业余无线电考试题库》App具备一些离线工具箱的能力：</p>
<ul>
<li>摩尔斯电码训练器： 听音抄收，致敬电报时代的传奇。</li>
<li>天线计算器： 输入频率，直接算出偶极子天线的剪裁长度。</li>
</ul>
<p>我这样跟Comate沟通：</p>
<blockquote>
<p>“你作为一名优秀的iOS开发工程师，同时也是一名无线电爱好者，现在需要你为app开发工具箱页面，工具箱页面需要有2个功能，分别是“1.摩尔斯编码解码器；2.天线计算器。”，请你先不着急写代码，先进行这2个功能的实现方案构思，要站在用户的角度进行思考产品，给到用户啊哈时刻”</p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e4682cc632ce4911b12c46c1b08a6a71~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paH5b-D5b-r56CBQmFpZHVDb21hdGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768361330&amp;x-signature=YgsVx6Bcx2dhPc%2BJPAlq0XdXZNM%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>很快，Comate给出了它的方案，我对方案很满意，于是指令Comate，让它按照这个方案进行开发。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4c4f8061fd4f4ccf80ae209fffb543fb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paH5b-D5b-r56CBQmFpZHVDb21hdGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768361330&amp;x-signature=rBKrdj%2FGldVKIatxs02WWjkjbyA%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>最终功能实现了，这些原本需要查阅物理手册、调试音频算法的复杂功能，在Comate的辅助下，可以非常低成本地把一个想法直接实现出来，哪怕它最终被否定，也几乎没有心理负担。正是这种“尝试变得足够便宜”的状态，让我敢于不断实验、不断微调。开发不再是“想清楚再动手”，而是变成了高质量 Prompt + 快速验证的循环。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/04205d7b46fe468c8cc8d5b7c254e59d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paH5b-D5b-r56CBQmFpZHVDb21hdGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768361330&amp;x-signature=EMHsGsihh70yvYj7PAUWdCi9Wfc%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>我把省下来的每一分钟，都花在了打磨“UI体验”上。最终这两个功能也已成功上线。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/66fa6c2063174144b678fa99fabb1403~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paH5b-D5b-r56CBQmFpZHVDb21hdGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768361330&amp;x-signature=VY%2Bjl5%2BVAgEa5s%2F5Bafxhf3BPRQ%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<h2 data-id="heading-4">写在最后</h2>
<p>这场CCF比赛，与其说是一场竞技，不如说是一次对AI时代百度的AI编码助手Comate“验证”。它验证了在AI时代，一个人的队伍，也可以像一支军队。 《业余无线电考试助手》就是这个答案。 它没有大厂的预算，没有复杂的团队，只有一个“想偷懒”的程序员，和一个不知疲倦的AI助手。</p>
<p>目前App已上架iOS，可以直接在iOS App Store“业余无线电考试题库”体验下这款由Comate开发的iOS App。</p>
<p>iOS下载链接：</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fapps.apple.com%2Fus%2Fapp%2F%25E4%25B8%259A%25E4%25BD%2599%25E6%2597%25A0%25E7%25BA%25BF%25E7%2594%25B5%25E8%2580%2583%25E8%25AF%2595%25E9%25A2%2598%25E5%25BA%2593%2Fid6755412986" target="_blank" title="https://apps.apple.com/us/app/%E4%B8%9A%E4%BD%99%E6%97%A0%E7%BA%BF%E7%94%B5%E8%80%83%E8%AF%95%E9%A2%98%E5%BA%93/id6755412986" ref="nofollow noopener noreferrer">apps.apple.com/us/app/%E4%…</a></p>
<p>这不仅是为了比赛，更是为了让所有想成为HAM的朋友，在入门的路上少被绊倒一次。</p>
<p>如果你也“一人+AI”的开发模式感兴趣，或者你也向往电波的世界，欢迎下载体验。这是我在CCF赛场上交出的答卷，也是给所有HAM的一封情书。</p>
<p>73!（业余无线电通信中通用的祝福术语）</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[读《纳瓦尔宝典》的一些真实想法]]></title>    <link>https://juejin.cn/post/7592144524307972102</link>    <guid>https://juejin.cn/post/7592144524307972102</guid>    <pubDate>2026-01-07T03:48:09.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592144524307972102" data-draft-id="7592058764120915987" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="读《纳瓦尔宝典》的一些真实想法"/> <meta itemprop="keywords" content="AIGC"/> <meta itemprop="datePublished" content="2026-01-07T03:48:09.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="暖阳_"/> <meta itemprop="url" content="https://juejin.cn/user/1662117312465406"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            读《纳瓦尔宝典》的一些真实想法
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1662117312465406/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    暖阳_
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-07T03:48:09.000Z" title="Wed Jan 07 2026 03:48:09 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>读《纳瓦尔宝典》的一些真实想法</p>
<p>去年11月，我在北京租的那个小房间里买的这本书。那会儿刚跳槽到新公司，工资也上涨了一些，本来应该高兴的，但看着手机里推送的房价——三环外都要六万一平，再看看朋友圈里那个做自媒体的大学同学，人家已经在北京买房了。心里特别不是滋味，真的。</p>
<p>晚上躺在床上刷抖音，刷到好几个人都在推荐这本书，说什么"财富密码"、"财务自由必读"。我就想，买来看看吧，万一有用呢。第二天中午在公司楼下等外卖的时候，用手机下单了。</p>
<p>收到书那天是周末，我坐在那个只有十平米的小房间里，花了三个小时一口气看完。看完之后，我的第一反应是：<strong>这都什么跟什么啊？</strong></p>
<p>不是说书不好，而是...它跟我预期的不太一样。我以为会看到一堆"如何快速致富"的干货，结果看到的是"财富不是靠工作赚来的，而是靠资产创造的"这种话。当时我就想，这不是废话吗？谁不知道啊？还用你说？</p>
<p>但奇怪的是，这句话在我脑子里转了好几天。上班写代码的时候在想，坐地铁的时候在想，甚至晚上刷牙的时候也在想。</p>
<p>我开始回想自己这些年是怎么赚钱的。2018年大学毕业，我一直在做前端开发，工资从五千涨到两万二，看起来不错对吧？但我发现一个问题：我赚的每一分钱，都是用时间换来的。今天不工作，今天就没收入。明天不工作，明天就没收入。这种模式，说白了就是"用时间换钱"，而且是有上限的。你再怎么加班，一天也就24小时。</p>
<p>纳瓦尔说的"杠杆"，我一开始真的没理解。后来慢慢琢磨，才意识到他说的杠杆不是借钱炒股那种，而是...是一种"一次投入，持续产出"的机制。</p>
<p>比如写代码。我写一个程序，如果只能给一个公司用，那就是用时间换钱。但如果我写一个SaaS产品，或者开源一个框架，那这个代码就能同时服务很多人，这就是杠杆。代码本身成了我的资产，而不是我的时间。</p>
<p>这个认知转变，挺痛苦的。因为这意味着我之前五年的工作方式，可能都是错的。我一直在优化"如何更高效地工作"，但从来没想过"如何让工作成果变成资产"。五年啊，我浪费了五年时间。</p>
<p>当然，我也知道，不是每个人都能做产品、做开源。但纳瓦尔说的另一个点，更实用：<strong>产品化自己</strong>。</p>
<p>这个我理解了很久。最开始我以为是要做IP、做网红，后来才明白，他说的"产品化"是指把你的能力、知识、经验，打包成可以重复销售的东西。比如，你擅长做数据分析，那你可以：</p>
<ul>
<li>写课程（一次制作，多次销售）</li>
<li>做咨询（虽然还是用时间，但单价更高）</li>
<li>开发工具（自动化你的工作流程）</li>
</ul>
<p>我现在就在尝试做第三件事。虽然还没什么成果，但至少方向对了。上个月我写了一个小工具，能自动生成报表，虽然还没人用，但至少是个开始。</p>
<p>不过，这本书也不是完美的。有些地方太理想化了。比如他说"幸福是一种技能"，这个我认同。但他说"财富自由后就能更幸福"，这个...不一定。</p>
<p>我见过一些已经财务自由的人，他们其实也挺焦虑的。因为财富自由不是终点，而是一个新的起点。你有了钱，但可能失去了目标，或者发现钱解决不了你真正的问题。我那个做自媒体的同学，现在也焦虑，焦虑的是怎么保持热度，怎么不被淘汰。</p>
<p>所以，纳瓦尔可能把"财富"和"幸福"的关系说得太简单了。财富是工具，不是目的。这个区别很重要。</p>
<p>还有一点，这本书对普通人来说，可能有点"站着说话不腰疼"。纳瓦尔是硅谷的顶级投资人，他的起点和资源，跟大多数人不一样。他说的很多方法，比如"用专长、责任感和杠杆效应"，听起来都对，但执行起来，门槛其实挺高的。</p>
<p>比如"专长"。不是每个人都有那种可以产品化的专长。很多人就是做普通工作，没有特别突出的技能。那怎么办？纳瓦尔没说。他可能觉得这太基础了，不需要说。</p>
<p>对于普通人来说，可能第一步不是找杠杆，而是先把自己的基础打牢。把本职工作做好，积累经验和资源，然后再考虑如何产品化。这个过程可能需要五年、十年，甚至更久。但至少，这本书给了我一个方向。让我知道，除了"用时间换钱"，还有另一种可能。</p>
<p>现在我在尝试做一些改变。虽然还没看到明显效果，但至少心态变了。以前我焦虑的是"怎么赚更多钱"，现在我想的是"怎么让我的工作成果变成资产"。</p>
<p>这个转变，可能比赚到钱本身更重要。也可能不重要，谁知道呢。</p>
<p>如果你也在看这本书，别指望它能给你一个"财富密码"。它更像是一面镜子，让你看清楚自己现在的赚钱模式，然后自己去想怎么改变。</p>
<p>改变很难，但至少，我们知道有改变的可能了。虽然我也不知道能不能成功，但试试总比不试强。</p>
<hr/>
<p><em>凌晨两点写的，失眠了，脑子里一直在想这些事。可能有些地方逻辑不太顺，但这就是我真实的想法。</em></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[TDDL、Amoeba、Cobar、MyCAT 架构比较]]></title>    <link>https://juejin.cn/post/7592147054786412595</link>    <guid>https://juejin.cn/post/7592147054786412595</guid>    <pubDate>2026-01-07T02:14:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592147054786412595" data-draft-id="7592164124659515442" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="TDDL、Amoeba、Cobar、MyCAT 架构比较"/> <meta itemprop="keywords" content="数据库"/> <meta itemprop="datePublished" content="2026-01-07T02:14:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="小王和八蛋"/> <meta itemprop="url" content="https://juejin.cn/user/1658510348133944"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            TDDL、Amoeba、Cobar、MyCAT 架构比较
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1658510348133944/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    小王和八蛋
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-07T02:14:59.000Z" title="Wed Jan 07 2026 02:14:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、文档说明</h2>
<p>本文聚焦业界流行的 MySQL 分布式数据库中间件（TDDL、Amoeba、Cobar、MyCAT），重点对比其架构差异，展现中间件的发展与演进路线。网上关于各产品的基础介绍资料较多，本文仅围绕架构核心展开分析。</p>
<h2 data-id="heading-1">二、各产品架构及核心特点</h2>
<h4 data-id="heading-2">1. TDDL</h4>
<ul>
<li>定位：非独立中间件，仅为中间层，以 Jar 包形式提供给应用调用，属于 JDBC Shard 思想范畴。</li>
<li>架构位置：夹在业务层和 JDBC 中间（纠正网上部分资料将其画在 JDBC 下层的错误定位）。</li>
<li>社区状态：处于停滞状态。</li>
</ul>
<h4 data-id="heading-3">2. Amoeba</h4>
<ul>
<li>定位：真正的独立中间件，应用连接 Amoeba 操作 MySQL 集群时，体验与操作单个 MySQL 一致。</li>
<li>架构特点：属于中间件早期产品，后端依赖 JDBC Driver。</li>
<li>社区状态：处于停滞状态。</li>
</ul>
<h4 data-id="heading-4">3. Cobar</h4>
<ul>
<li>架构特点：后端去掉 JDBC Driver，不再支持 JDBC 规范，无法适配 Oracle、PostgreSQL 等数据库；采用原生通信协议，支持主备切换、读写分离、异步操作等扩展功能。</li>
<li>聚合功能支持：可支持 Order By、Group By、limit 语法，但仅简单返回结果，不做聚合处理，需业务系统自行完成聚合逻辑。</li>
<li>社区状态：处于停滞状态。</li>
</ul>
<h4 data-id="heading-5">4. MyCAT</h4>
<ul>
<li>
<p>发展基础：基于 Cobar 演进而来。</p>
</li>
<li>
<p>核心改进：</p>
<ol>
<li>后端由 BIO 改为 NIO，并发量大幅提升；</li>
<li>完善聚合功能支持，可直接处理 Order By、Group By、limit 等操作（无需业务系统额外处理）。</li>
</ol>
</li>
<li>
<p>社区状态：非常活跃。</p>
</li>
</ul>
<h2 data-id="heading-6">三、关键总结</h2>
<ol>
<li>产品渊源：Amoeba、Cobar、MyCAT 三者渊源较深，均因前序产品停更或核心团队变动而逐步迭代：Amoeba 停更后 Cobar 出现，Cobar 核心团队解散后 MyCAT 另起炉灶。</li>
<li>开源现状：国内开源项目众多，但能持续维护的较少，MyCAT 活跃的社区状态较为难得。</li>
<li>架构演进核心：从依赖 JDBC Driver（Amoeba）→ 原生通信协议（Cobar）→ NIO 优化 + 完善聚合功能（MyCAT），逐步提升扩展性、并发能力和功能完整性。</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Electron 在乌班图上打包 —— AI辅助]]></title>    <link>https://juejin.cn/post/7592119218024824867</link>    <guid>https://juejin.cn/post/7592119218024824867</guid>    <pubDate>2026-01-06T06:02:13.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592119218024824867" data-draft-id="7587398857536290879" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Electron 在乌班图上打包 —— AI辅助"/> <meta itemprop="keywords" content="前端,Electron"/> <meta itemprop="datePublished" content="2026-01-06T06:02:13.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="PBitW"/> <meta itemprop="url" content="https://juejin.cn/user/3048261967153544"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Electron 在乌班图上打包 —— AI辅助
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3048261967153544/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    PBitW
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-06T06:02:13.000Z" title="Tue Jan 06 2026 06:02:13 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    59
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>接上一篇：
<a href="https://juejin.cn/spost/7591806035758628906" target="_blank" title="https://juejin.cn/spost/7591806035758628906">Electron 初体验</a></p>
<h3 data-id="heading-0">代码完善</h3>
<p>上一篇中，简单的让AI写了一些demo内容，菜鸟又在其上加上了不少功能。但感觉从<code>vue</code>到初次开发<code>electron</code>真正需要注意的，还是那些读取文件、连接数据库之类的东西。</p>
<p>而上一篇中就是主要介绍的就是这些，其实看懂一个，后面的都是以此类推即可！</p>
<p>这里之所以要写，是因为菜鸟感觉读取文件的方案还是不好，改成了连接数据库，让后端直接在服务器上安装了<code>mySQL</code>，直接用electron去连接即可。</p>
<p>菜鸟也对之前写的代码进行了抽离，目录结构变成了这样：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d63c78f1db754cad98c4354ab71610e2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUEJpdFc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768292808&amp;x-signature=rLrYPfG7jpIpaGaB0IzDpwLtOIs%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-1">代码如下</h4>
<p><strong>main.js</strong></p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> { app, <span class="hljs-title class_">BrowserWindow</span>, ipcMain, dialog } = <span class="hljs-built_in">require</span>(<span class="hljs-string">"electron"</span>);
<span class="hljs-keyword">const</span> { join } = <span class="hljs-built_in">require</span>(<span class="hljs-string">"path"</span>);
<span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">"path"</span>);
<span class="hljs-keyword">const</span> { exec, spawn } = <span class="hljs-built_in">require</span>(<span class="hljs-string">"child_process"</span>);
<span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">"fs"</span>);
<span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">"express"</span>);
<span class="hljs-keyword">const</span> mysql = <span class="hljs-built_in">require</span>(<span class="hljs-string">"mysql2/promise"</span>);

<span class="hljs-comment">// 提出去的读写文件操作</span>
<span class="hljs-keyword">const</span> { selectPath } = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./modules/selectPath.js"</span>);
<span class="hljs-keyword">const</span> { runScript, runScriptNoWait } = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./modules/runScript.js"</span>);
<span class="hljs-keyword">const</span> { readDir } = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./modules/readDir.js"</span>);
<span class="hljs-keyword">const</span> { readConfig } = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./modules/readConfig.js"</span>);
<span class="hljs-keyword">const</span> { writeConfig } = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./modules/writeConfig.js"</span>);
<span class="hljs-keyword">const</span> { saveImageToUserData } = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./modules/saveImageToUserData.js"</span>);
<span class="hljs-keyword">const</span> { loadImageAsBase64 } = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./modules/loadImageAsBase64.js"</span>);
<span class="hljs-keyword">const</span> { getSeqChipPath } = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./modules/getSeqChipPath.js"</span>);
<span class="hljs-keyword">const</span> { readFa, readBFile, readCFile } = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./modules/readFa.js"</span>);

<span class="hljs-comment">// 提出去的API</span>
<span class="hljs-keyword">const</span> { loginApi } = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./api/login.js"</span>);
<span class="hljs-keyword">const</span> { appraisalRecordAddApi } = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./api/appraisalRecordAdd.js"</span>);
<span class="hljs-keyword">const</span> { appraisalRecordListApi } = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./api/appraisalRecordList.js"</span>);

<span class="hljs-comment">// 屏蔽安全警告</span>
<span class="hljs-comment">// ectron Security Warning (Insecure Content-Security-Policy)</span>
process.<span class="hljs-property">env</span>[<span class="hljs-string">"ELECTRON_DISABLE_SECURITY_WARNINGS"</span>] = <span class="hljs-string">"true"</span>;

<span class="hljs-comment">// 创建浏览器窗口时，调用这个函数。</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">createWindow</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">const</span> win = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BrowserWindow</span>({
    <span class="hljs-attr">width</span>: <span class="hljs-number">1920</span>,
    <span class="hljs-attr">height</span>: <span class="hljs-number">1080</span>,
    <span class="hljs-attr">fullscreen</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// 👈 一启动就全屏</span>
    <span class="hljs-attr">autoHideMenuBar</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">webPreferences</span>: {
      <span class="hljs-attr">preload</span>: path.<span class="hljs-title function_">join</span>(__dirname, <span class="hljs-string">"preload.js"</span>),
      <span class="hljs-attr">contextIsolation</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-attr">nodeIntegration</span>: <span class="hljs-literal">false</span>
    }
  });

  <span class="hljs-comment">// 启动时最大化（保留窗口按钮）</span>
  win.<span class="hljs-title function_">maximize</span>();

  <span class="hljs-comment">// win.loadURL('http://localhost:3000')</span>
  <span class="hljs-comment">// development模式</span>
  <span class="hljs-keyword">if</span> (process.<span class="hljs-property">env</span>.<span class="hljs-property">VITE_DEV_SERVER_URL</span>) {
    win.<span class="hljs-title function_">loadURL</span>(process.<span class="hljs-property">env</span>.<span class="hljs-property">VITE_DEV_SERVER_URL</span>);
    <span class="hljs-comment">// 开启调试台</span>
    win.<span class="hljs-property">webContents</span>.<span class="hljs-title function_">openDevTools</span>();
  } <span class="hljs-keyword">else</span> {
    win.<span class="hljs-title function_">loadFile</span>(<span class="hljs-title function_">join</span>(__dirname, <span class="hljs-string">"../dist/index.html"</span>));
  }
};

<span class="hljs-comment">// Electron 会在初始化后并准备</span>
app.<span class="hljs-title function_">whenReady</span>().<span class="hljs-title function_">then</span>(<span class="hljs-keyword">async</span> () =&gt; {
  <span class="hljs-keyword">await</span> <span class="hljs-title function_">startLocalApi</span>(); <span class="hljs-comment">// ⭐ 启动本地 API</span>
  <span class="hljs-title function_">createWindow</span>();
  app.<span class="hljs-title function_">on</span>(<span class="hljs-string">"activate"</span>, <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">if</span> (<span class="hljs-title class_">BrowserWindow</span>.<span class="hljs-title function_">getAllWindows</span>().<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) <span class="hljs-title function_">createWindow</span>();
  });
});

app.<span class="hljs-title function_">on</span>(<span class="hljs-string">"window-all-closed"</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">if</span> (process.<span class="hljs-property">platform</span> !== <span class="hljs-string">"darwin"</span>) app.<span class="hljs-title function_">quit</span>();
});

<span class="hljs-comment">// 保存配置 - 用于设置脚本执行目录</span>
<span class="hljs-keyword">const</span> userDataPath = app.<span class="hljs-title function_">getPath</span>(<span class="hljs-string">"userData"</span>);
<span class="hljs-keyword">const</span> scriptDir = path.<span class="hljs-title function_">join</span>(userDataPath, <span class="hljs-string">"scripts"</span>); <span class="hljs-comment">// 目标文件夹</span>
<span class="hljs-keyword">const</span> defaultScriptDir = path.<span class="hljs-title function_">join</span>(__dirname, <span class="hljs-string">"scripts"</span>); <span class="hljs-comment">// 源文件夹</span>
<span class="hljs-comment">// 如果目标文件夹不存在，先创建</span>
<span class="hljs-keyword">if</span> (!fs.<span class="hljs-title function_">existsSync</span>(scriptDir)) {
  fs.<span class="hljs-title function_">mkdirSync</span>(scriptDir, { <span class="hljs-attr">recursive</span>: <span class="hljs-literal">true</span> }); <span class="hljs-comment">// 递归创建目录</span>
}
<span class="hljs-comment">// 读取默认目录下的文件列表，逐个拷贝</span>
fs.<span class="hljs-title function_">readdirSync</span>(defaultScriptDir).<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">file</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> srcFile = path.<span class="hljs-title function_">join</span>(defaultScriptDir, file);
  <span class="hljs-keyword">const</span> destFile = path.<span class="hljs-title function_">join</span>(scriptDir, file);
  <span class="hljs-comment">// 只拷贝文件</span>
  <span class="hljs-keyword">if</span> (fs.<span class="hljs-title function_">lstatSync</span>(srcFile).<span class="hljs-title function_">isFile</span>()) {
    fs.<span class="hljs-title function_">copyFileSync</span>(srcFile, destFile);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${file}</span> has copy to scripts`</span>);
  }
});

<span class="hljs-comment">// 选择路径</span>
<span class="hljs-title function_">selectPath</span>(ipcMain, dialog);
<span class="hljs-comment">// 运行脚本 -- 等待结果</span>
<span class="hljs-title function_">runScript</span>(ipcMain, app, path, fs, exec);
<span class="hljs-comment">// 运行脚本 -- 不等待结果</span>
<span class="hljs-title function_">runScriptNoWait</span>(ipcMain, app, path, fs, spawn);
<span class="hljs-comment">// 读取某个文件夹下是否有文件</span>
<span class="hljs-title function_">readDir</span>(ipcMain, fs);
<span class="hljs-comment">// 读取配置文件</span>
<span class="hljs-title function_">readConfig</span>(ipcMain, app, path, fs);
<span class="hljs-comment">// 写入配置文件</span>
<span class="hljs-title function_">writeConfig</span>(ipcMain, app, path, fs);
<span class="hljs-comment">// 保存用户上传的图片到用户目录 —— 防止用户删除</span>
<span class="hljs-title function_">saveImageToUserData</span>(ipcMain, app, path, fs);
<span class="hljs-comment">// 加载图片作为 base64 编码 —— </span>
<span class="hljs-title function_">loadImageAsBase64</span>(ipcMain, app, path, fs);
<span class="hljs-comment">// 获取配置文件下的测序路径，并将下面的文件返回成select可以使用的选项</span>
<span class="hljs-title function_">getSeqChipPath</span>(ipcMain, app, path, fs);
<span class="hljs-comment">// 读取 FA 文件</span>
<span class="hljs-title function_">readFa</span>(ipcMain, fs, path);
<span class="hljs-comment">// 读取 B 文件</span>
<span class="hljs-title function_">readBFile</span>(ipcMain, fs, path);
<span class="hljs-comment">// 读取 C 文件</span>
<span class="hljs-title function_">readCFile</span>(ipcMain, fs, path);


<span class="hljs-comment">// 连接数据库 -- 重点</span>
<span class="hljs-keyword">let</span> apiServer;
<span class="hljs-keyword">let</span> apiPort;
<span class="hljs-keyword">let</span> mysqlPool;

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">startLocalApi</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> api = <span class="hljs-title function_">express</span>();
  api.<span class="hljs-title function_">use</span>(express.<span class="hljs-title function_">json</span>());

  <span class="hljs-comment">// ⚠️ MySQL 连接池（只初始化一次）</span>
  mysqlPool = mysql.<span class="hljs-title function_">createPool</span>({
    <span class="hljs-attr">host</span>: <span class="hljs-string">"xxx.xx.xxx.xx"</span>, <span class="hljs-comment">// 数据库地址</span>
    <span class="hljs-attr">port</span>: <span class="hljs-number">13306</span>, <span class="hljs-comment">// 端口</span>
    <span class="hljs-attr">user</span>: <span class="hljs-string">"barcode_for_medicinal"</span>, <span class="hljs-comment">// 数据库账号</span>
    <span class="hljs-attr">password</span>: <span class="hljs-string">"xxxxxxxx"</span>, <span class="hljs-comment">// 数据库密码</span>
    <span class="hljs-attr">database</span>: <span class="hljs-string">"barcode_for_medicinal"</span>, <span class="hljs-comment">// 数据库名称</span>
    <span class="hljs-attr">connectionLimit</span>: <span class="hljs-number">5</span> <span class="hljs-comment">// 连接池最大连接数</span>
  });

  <span class="hljs-comment">// 解决跨域</span>
  api.<span class="hljs-title function_">use</span>(<span class="hljs-function">(<span class="hljs-params">req, res, next</span>) =&gt;</span> {
    res.<span class="hljs-title function_">setHeader</span>(<span class="hljs-string">"Access-Control-Allow-Origin"</span>, <span class="hljs-string">"*"</span>);
    res.<span class="hljs-title function_">setHeader</span>(<span class="hljs-string">"Access-Control-Allow-Methods"</span>, <span class="hljs-string">"GET,POST,PUT,DELETE,OPTIONS"</span>);
    res.<span class="hljs-title function_">setHeader</span>(<span class="hljs-string">"Access-Control-Allow-Headers"</span>, <span class="hljs-string">"Content-Type"</span>);
    <span class="hljs-title function_">next</span>();
  });

  <span class="hljs-comment">// 登录接口</span>
  <span class="hljs-title function_">loginApi</span>(api, mysqlPool);
  <span class="hljs-comment">// 鉴定记录添加接口</span>
  <span class="hljs-title function_">appraisalRecordAddApi</span>(api, mysqlPool);
  <span class="hljs-comment">// 鉴定记录列表接口</span>
  <span class="hljs-title function_">appraisalRecordListApi</span>(api, mysqlPool);

  <span class="hljs-comment">// ⭐ 随机端口，只监听本机</span>
  apiServer = api.<span class="hljs-title function_">listen</span>(<span class="hljs-number">0</span>, <span class="hljs-string">"127.0.0.1"</span>, <span class="hljs-function">() =&gt;</span> {
    apiPort = apiServer.<span class="hljs-title function_">address</span>().<span class="hljs-property">port</span>;
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"Local API started on port:"</span>, apiPort);
  });
}

<span class="hljs-comment">// 获取本地 API 端口</span>
ipcMain.<span class="hljs-title function_">handle</span>(<span class="hljs-string">"getApiPort"</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">return</span> apiPort;
});
</code></pre>
<h3 data-id="heading-2">如何使用接口？</h3>
<p>菜鸟直接将API的端口存在了pinia中，避免每次调用还要去和electron通信</p>
<p><strong>port.js</strong></p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { ref } <span class="hljs-keyword">from</span> <span class="hljs-string">"vue"</span>;
<span class="hljs-keyword">import</span> { defineStore } <span class="hljs-keyword">from</span> <span class="hljs-string">"pinia"</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> usePortStore = <span class="hljs-title function_">defineStore</span>(<span class="hljs-string">"port"</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">let</span> port = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">null</span>);

  <span class="hljs-comment">// 异步 action</span>
  <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">fetchPort</span>(<span class="hljs-params"/>) {
    port.<span class="hljs-property">value</span> = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">window</span>.<span class="hljs-property">electronAPI</span>.<span class="hljs-title function_">getApiPort</span>();
  }

  <span class="hljs-keyword">function</span> <span class="hljs-title function_">getPort</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> port.<span class="hljs-property">value</span>;
  }

  <span class="hljs-keyword">return</span> { port, fetchPort, getPort };
});
</code></pre>
<p>简单列举一个登录的例子</p>
<p><strong>login.vue</strong></p>
<pre><code class="hljs language-js" lang="js">&lt;script setup&gt;
<span class="hljs-keyword">import</span> router <span class="hljs-keyword">from</span> <span class="hljs-string">"@/router"</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">NForm</span>, <span class="hljs-title class_">NFormItemRow</span>, <span class="hljs-title class_">NInput</span>, <span class="hljs-title class_">NButton</span>, useMessage } <span class="hljs-keyword">from</span> <span class="hljs-string">"naive-ui"</span>;
<span class="hljs-keyword">import</span> { reactive, ref } <span class="hljs-keyword">from</span> <span class="hljs-string">"vue"</span>;
<span class="hljs-keyword">import</span> logo <span class="hljs-keyword">from</span> <span class="hljs-string">"@/assets/img/logo.png"</span>;

<span class="hljs-keyword">import</span> { usePortStore } <span class="hljs-keyword">from</span> <span class="hljs-string">"@/stores/port"</span>;
<span class="hljs-keyword">import</span> { useUserStore } <span class="hljs-keyword">from</span> <span class="hljs-string">"@/stores/user"</span>;
<span class="hljs-keyword">const</span> portStore = <span class="hljs-title function_">usePortStore</span>();
<span class="hljs-keyword">const</span> userStore = <span class="hljs-title function_">useUserStore</span>();

<span class="hljs-keyword">const</span> message = <span class="hljs-title function_">useMessage</span>();
<span class="hljs-keyword">const</span> formData = <span class="hljs-title function_">reactive</span>({
  <span class="hljs-attr">username</span>: <span class="hljs-string">"xxx"</span>,
  <span class="hljs-attr">password</span>: <span class="hljs-string">"xxxxx"</span>
});

<span class="hljs-keyword">const</span> rules = <span class="hljs-title function_">reactive</span>({
  <span class="hljs-attr">username</span>: [{ <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">message</span>: <span class="hljs-string">"请输入用户名"</span>, <span class="hljs-attr">trigger</span>: [<span class="hljs-string">"blur"</span>] }],
  <span class="hljs-attr">password</span>: [{ <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">message</span>: <span class="hljs-string">"请输入密码"</span>, <span class="hljs-attr">trigger</span>: [<span class="hljs-string">"blur"</span>] }]
});

<span class="hljs-keyword">const</span> formRef = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">null</span>);
<span class="hljs-keyword">const</span> <span class="hljs-title function_">login</span> = (<span class="hljs-params"/>) =&gt; {
  formRef.<span class="hljs-property">value</span>?.<span class="hljs-title function_">validate</span>(<span class="hljs-keyword">async</span> (errors) =&gt; {
    <span class="hljs-keyword">if</span> (!errors) {
      <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`http://127.0.0.1:<span class="hljs-subst">${portStore.getPort()}</span>/login`</span>, {
          <span class="hljs-attr">method</span>: <span class="hljs-string">"POST"</span>,
          <span class="hljs-attr">headers</span>: { <span class="hljs-string">"Content-Type"</span>: <span class="hljs-string">"application/json"</span> },
          <span class="hljs-attr">body</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({ <span class="hljs-attr">username</span>: formData.<span class="hljs-property">username</span>, <span class="hljs-attr">password</span>: formData.<span class="hljs-property">password</span> })
        });

        <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> res.<span class="hljs-title function_">json</span>();
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"登录响应:"</span>, result);

        <span class="hljs-keyword">if</span> (result.<span class="hljs-property">ok</span>) {
          <span class="hljs-comment">// 可以存到 Pinia 或 localStorage</span>
          userStore.<span class="hljs-title function_">setUser</span>(result.<span class="hljs-property">user</span>);
          router.<span class="hljs-title function_">replace</span>(<span class="hljs-string">"/home"</span>);
        } <span class="hljs-keyword">else</span> {
          message.<span class="hljs-title function_">error</span>(<span class="hljs-string">"登录失败:"</span> + result.<span class="hljs-property">message</span>);
        }
      } <span class="hljs-keyword">catch</span> (err) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"请求错误:"</span>, err);
      }
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(errors);
    }
  });
};

<span class="hljs-keyword">const</span> model = <span class="hljs-title function_">ref</span>({
  <span class="hljs-attr">leftLogo</span>: [
    {
      <span class="hljs-attr">url</span>: logo
    }
  ],
  <span class="hljs-attr">rightLogo</span>: [
    {
      <span class="hljs-attr">url</span>: logo
    }
  ]
});
<span class="hljs-comment">// 读取配置文件</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">readConfig</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> config = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">window</span>.<span class="hljs-property">electronAPI</span>.<span class="hljs-title function_">readConfig</span>();
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"读取到的配置:"</span>, config);

    <span class="hljs-keyword">if</span> (config.<span class="hljs-property">leftLogo</span>[<span class="hljs-number">0</span>]?.<span class="hljs-property">name</span>) {
      model.<span class="hljs-property">value</span>.<span class="hljs-property">leftLogo</span> = [
        {
          <span class="hljs-attr">url</span>: <span class="hljs-keyword">await</span> <span class="hljs-variable language_">window</span>.<span class="hljs-property">electronAPI</span>.<span class="hljs-title function_">loadImageAsBase64</span>(config.<span class="hljs-property">leftLogo</span>[<span class="hljs-number">0</span>].<span class="hljs-property">name</span>)
        }
      ];
    }

    <span class="hljs-keyword">if</span> (config.<span class="hljs-property">rightLogo</span>[<span class="hljs-number">0</span>]?.<span class="hljs-property">name</span>) {
      model.<span class="hljs-property">value</span>.<span class="hljs-property">rightLogo</span> = [
        {
          <span class="hljs-attr">url</span>: <span class="hljs-keyword">await</span> <span class="hljs-variable language_">window</span>.<span class="hljs-property">electronAPI</span>.<span class="hljs-title function_">loadImageAsBase64</span>(config.<span class="hljs-property">rightLogo</span>[<span class="hljs-number">0</span>].<span class="hljs-property">name</span>)
        }
      ];
    }

    <span class="hljs-comment">// 文本类配置（直接覆盖没问题）</span>
    <span class="hljs-keyword">if</span> (config?.<span class="hljs-property">supportText</span>) {
      model.<span class="hljs-property">value</span>.<span class="hljs-property">supportText</span> = config.<span class="hljs-property">supportText</span>;
    }

    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"配置后的模型:"</span>, model.<span class="hljs-property">value</span>);
  } <span class="hljs-keyword">catch</span> (err) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"读取配置文件失败:"</span>, err);
  }
};
<span class="hljs-title function_">readConfig</span>();
&lt;/script&gt;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"flex h-full flex-col items-center justify-center"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">header</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"w-full"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"mb-4 flex items-center justify-evenly"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"w-[200px]"</span> <span class="hljs-attr">:src</span>=<span class="hljs-string">"model.leftLogo[0]?.url"</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">"logo"</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"w-[200px]"</span> <span class="hljs-attr">:src</span>=<span class="hljs-string">"model.rightLogo[0]?.url"</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">"logo"</span> /&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">header</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">main</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"loginBox relative h-[70%] w-full"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span>
        <span class="hljs-attr">class</span>=<span class="hljs-string">"loginForm absolute top-[50%] left-[80%] w-[400px] translate-x-[-50%] translate-y-[-50%] rounded-[10px] bg-white p-[30px]"</span>
      &gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">n-form</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"formRef"</span> <span class="hljs-attr">:model</span>=<span class="hljs-string">"formData"</span> <span class="hljs-attr">:rules</span>=<span class="hljs-string">"rules"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">n-form-item-row</span> <span class="hljs-attr">label</span>=<span class="hljs-string">"用户名"</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"username"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">n-input</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"请输入用户名"</span> <span class="hljs-attr">v-model:value</span>=<span class="hljs-string">"formData.username"</span> /&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">n-form-item-row</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">n-form-item-row</span> <span class="hljs-attr">label</span>=<span class="hljs-string">"密码"</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"password"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">n-input</span>
              <span class="hljs-attr">type</span>=<span class="hljs-string">"password"</span>
              <span class="hljs-attr">show-password-on</span>=<span class="hljs-string">"mousedown"</span>
              <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"请输入密码"</span>
              <span class="hljs-attr">v-model:value</span>=<span class="hljs-string">"formData.password"</span>
            /&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">n-form-item-row</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">n-form</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">n-button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"primary"</span> <span class="hljs-attr">block</span> <span class="hljs-attr">secondary</span> <span class="hljs-attr">strong</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"login"</span>&gt;</span> 登录 <span class="hljs-tag">&lt;/<span class="hljs-name">n-button</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">main</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">footer</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text-center whitespace-pre-line"</span>&gt;</span>
        {{ model.supportText }}
      <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">footer</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></span>

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="css">
<span class="hljs-selector-class">.loginBox</span> {
  <span class="hljs-attribute">background-image</span>: <span class="hljs-built_in">url</span>(<span class="hljs-string">"@/assets/img/bg.jpg"</span>);
  <span class="hljs-attribute">background-size</span>: <span class="hljs-number">100%</span> <span class="hljs-number">100%</span>;
}
<span class="hljs-selector-class">.loginForm</span> {
  <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">10px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.5</span>);
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span></span>
</code></pre>
<p>菜鸟这个主要就是读取配置文件、连接数据库读写数据，没有很复杂的操作，所以基本上使用到的electron就是这些！</p>
<h2 data-id="heading-3">在乌班图上打包</h2>
<p>上一篇有说，windows上打包有缺陷，所以这里菜鸟用的方式是：让公司给开一个乌班图的服务器，在服务器上配置一下node环境，将本地代码搞成压缩包传到服务器，在服务器上解压后执行<code>npm i</code>，并打包！</p>
<h3 data-id="heading-4">配置服务器上的node环境</h3>
<p>这个菜鸟其实也是一窍不通，但是幸好有AI，问一下怎么在服务器上配置的node环境，就可以出现</p>
<p>第一步：</p>
<p>在乌班图的浏览器上，访问：<a href="https://link.juejin.cn?target=https%3A%2F%2Fnodejs.org%2Fzh-cn%2Fdownload%255D" target="_blank" title="https://nodejs.org/zh-cn/download%5D" ref="nofollow noopener noreferrer">nodejs.org/zh-cn/downl…</a> ，并选择对应的版本下载即可！</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/10cd97604c7f4f8a9e08c55d73acc9cd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUEJpdFc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768292808&amp;x-signature=T6gTp3Gu7QoQ1XYzBRGAMbeYegY%3D" alt="image.png" loading="lazy"/></p>
<p>第二步：</p>
<p>进入下载目录解压，解压后将其转移到 <code>/usr/local/node</code> 目录</p>
<pre><code class="hljs language-shell" lang="shell">cd yourDwonloadPath
tar -xvf node-vxx.xx.xx-linux-x64.tar.xz
</code></pre>
<p>移动目录</p>
<pre><code class="hljs language-shell" lang="shell">sudo mv node-vxx.xx.xx-linux-x64 /usr/local/node
</code></pre>
<p>第三步：</p>
<p>设置环境变量</p>
<pre><code class="hljs language-shell" lang="shell">vim ~/.bashrc
</code></pre>
<p>并添加</p>
<pre><code class="hljs language-shell" lang="shell">export NODE_HOME=/usr/local/node
export PATH=$NODE_HOME/bin:$PATH
</code></pre>
<p>让其生效</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">source</span> ~/.bashrc
</code></pre>
<p>然后就可以 <code>node -v</code> 和 <code>npm -v</code> 看看是否真的生效了！</p>
<h3 data-id="heading-5">运行</h3>
<p>将本地代码，打包并上传到乌班图服务器</p>
<p>这里也是直接问AI，服务器上可以支持解压7z吗？怎么操作，就可以得到！</p>
<p>解压之前需要下载解压软件</p>
<pre><code class="hljs language-shell" lang="shell">sudo apt update
sudo apt install -y p7zip-full
</code></pre>
<p>解压</p>
<pre><code class="hljs language-shell" lang="shell">cd 你上传的文件路径

解压到当前目录
7z x file.7z

解压到指定目录
7z x file.7z -o/home/p/output
</code></pre>
<p>然后执行<code>npm i</code>、<code>npm run dev</code> 看能不能运行</p>
<h4 data-id="heading-6">运行白屏</h4>
<p>这里菜鸟不知道为什么，反正运行时会<strong>出现白屏</strong>，问GPT发现需要修改 main.js，多加上这几行</p>
<pre><code class="hljs language-js" lang="js">……
<span class="hljs-keyword">const</span> { appraisalRecordListApi } = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./api/appraisalRecordList.js"</span>);

<span class="hljs-comment">// 打包其实这几个配置无效 —— 如果需要在linux系统上npm run dev运行，要加上 —— 后面有说明（见下方deb包）</span>
<span class="hljs-comment">// 禁 GPU（消掉噪音） -- 新增</span>
app.<span class="hljs-title function_">disableHardwareAcceleration</span>();
<span class="hljs-comment">// 关 sandbox（关键）-- 新增</span>
app.<span class="hljs-property">commandLine</span>.<span class="hljs-title function_">appendSwitch</span>(<span class="hljs-string">"disable-gpu"</span>);
app.<span class="hljs-property">commandLine</span>.<span class="hljs-title function_">appendSwitch</span>(<span class="hljs-string">"no-sandbox"</span>);
app.<span class="hljs-property">commandLine</span>.<span class="hljs-title function_">appendSwitch</span>(<span class="hljs-string">"disable-setuid-sandbox"</span>);

<span class="hljs-comment">// 屏蔽安全警告</span>
……
</code></pre>
<p>修改后，会发现可以运行，但是连不上数据库！</p>
<p>这时候是可以看见报错的，直接将报错给GPT，就会告诉我们要修改 main.js 中连接数据库的地方，不能再用ip地址了，要用本地ip地址</p>
<pre><code class="hljs language-js" lang="js">……
<span class="hljs-comment">// 连接数据库</span>
<span class="hljs-keyword">let</span> apiServer;
<span class="hljs-keyword">let</span> apiPort;
<span class="hljs-keyword">let</span> mysqlPool;

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">startLocalApi</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> api = <span class="hljs-title function_">express</span>();
  api.<span class="hljs-title function_">use</span>(express.<span class="hljs-title function_">json</span>());

  <span class="hljs-comment">// ⚠️ MySQL 连接池（只初始化一次）</span>
  mysqlPool = mysql.<span class="hljs-title function_">createPool</span>({
    <span class="hljs-attr">host</span>: <span class="hljs-string">"127.0.0.1"</span>, <span class="hljs-comment">// 修改成这个或者localhost</span>
    <span class="hljs-attr">port</span>: <span class="hljs-number">13306</span>,
    <span class="hljs-attr">user</span>: <span class="hljs-string">"barcode_for_medicinal"</span>, <span class="hljs-comment">// 数据库账号</span>
    <span class="hljs-attr">password</span>: <span class="hljs-string">"xxxx"</span>, <span class="hljs-comment">// 数据库密码</span>
    <span class="hljs-attr">database</span>: <span class="hljs-string">"barcode_for_medicinal"</span>, <span class="hljs-comment">// 数据库名称</span>
    <span class="hljs-attr">connectionLimit</span>: <span class="hljs-number">5</span> <span class="hljs-comment">// 连接池最大连接数</span>
  });

  api.<span class="hljs-title function_">use</span>(<span class="hljs-function">(<span class="hljs-params">req, res, next</span>) =&gt;</span> {
    res.<span class="hljs-title function_">setHeader</span>(<span class="hljs-string">"Access-Control-Allow-Origin"</span>, <span class="hljs-string">"*"</span>);
    res.<span class="hljs-title function_">setHeader</span>(<span class="hljs-string">"Access-Control-Allow-Methods"</span>, <span class="hljs-string">"GET,POST,PUT,DELETE,OPTIONS"</span>);
    res.<span class="hljs-title function_">setHeader</span>(<span class="hljs-string">"Access-Control-Allow-Headers"</span>, <span class="hljs-string">"Content-Type"</span>);
    <span class="hljs-title function_">next</span>();
  });

  <span class="hljs-comment">// 登录接口</span>
  <span class="hljs-title function_">loginApi</span>(api, mysqlPool);
  <span class="hljs-comment">// 鉴定记录添加接口</span>
  <span class="hljs-title function_">appraisalRecordAddApi</span>(api, mysqlPool);
  <span class="hljs-comment">// 鉴定记录列表接口</span>
  <span class="hljs-title function_">appraisalRecordListApi</span>(api, mysqlPool);

  <span class="hljs-comment">// ⭐ 随机端口，只监听本机</span>
  apiServer = api.<span class="hljs-title function_">listen</span>(<span class="hljs-number">0</span>, <span class="hljs-string">"127.0.0.1"</span>, <span class="hljs-function">() =&gt;</span> {
    apiPort = apiServer.<span class="hljs-title function_">address</span>().<span class="hljs-property">port</span>;
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"Local API started on port:"</span>, apiPort);
  });
}
</code></pre>
<p>整个功能可以正常使用后，就可以到打包这一步了。</p>
<h3 data-id="heading-7">打包</h3>
<p>需要修改<code>package.json</code>（这里已经是菜鸟试错多次，并问GPT后修改好的文件了，所以就不一一列举是怎么踩坑的了，反正基本是报错就问GPT）</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"barcode-medicinal"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"productName"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Barcode Medicinal"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1.0.0"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"private"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"homepage"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"http://xxx.xxx.xxx.xx:5050/other/barcodeformedicinal.git"</span><span class="hljs-punctuation">,</span> <span class="hljs-comment">// 一定要有，不然会报错(随便放个git地址即可)</span>
  <span class="hljs-attr">"main"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ElectronSrc/main.js"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"engines"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"node"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^20.19.0 || &gt;=22.12.0"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"scripts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"dev"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"vite"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"dev:electron"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"electron ."</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"dev:full"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"npm run dev &amp; npm run dev:electron"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"build:vue"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"vite build"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"build:electron"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"electron-builder"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"build"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"npm run build:vue &amp;&amp; npm run build:electron -- --linux"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"preview"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"vite preview"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"lint"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"eslint . --fix --cache"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"format"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"prettier --write src/"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"build"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"appId"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"com.example.barcodeformedicinal"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"productName"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"barcode-medicinal"</span><span class="hljs-punctuation">,</span> <span class="hljs-comment">// 一定要用英文，windows上可以中文</span>
    <span class="hljs-attr">"asar"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"directories"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"output"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"dist_electron"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"files"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
      <span class="hljs-string">"dist/**"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-string">"ElectronSrc/**"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-string">"package.json"</span>
    <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
    <span class="hljs-comment">// 这样写可以打包4个出来</span>
    <span class="hljs-attr">"linux"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"target"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">"target"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"deb"</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"arch"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
            <span class="hljs-string">"x64"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-string">"arm64"</span>
          <span class="hljs-punctuation">]</span>
        <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
        <span class="hljs-string">"AppImage"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-comment">// 可不要</span>
        <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">"target"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"rpm"</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"arch"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
            <span class="hljs-string">"x64"</span>
          <span class="hljs-punctuation">]</span>
        <span class="hljs-punctuation">}</span>
      <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"category"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Utility"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Barcode Medicinal Electron"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"maintainer"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Your Name &lt;youremail@example.com&gt;"</span> <span class="hljs-comment">// 必须写，假的也行，不然报错</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"dependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    ……
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"devDependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    ……
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>执行 <code>npm run build</code>，你会得到三个文件，打包后的文件，在<code>package.json</code>中的这里</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-attr">"directories"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"output"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"dist_electron"</span>
<span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
</code></pre>
<p>里面应该有几个乌班图可以运行的文件</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2250c43301bb4806b4e0bd5c74a81b88~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUEJpdFc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768292808&amp;x-signature=gq91E%2BGEva%2BH0%2Bw0qcLONQZ3r6Q%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-8">运行AppImage</h4>
<p>这里需要问AI，如何在服务器上，用命令行运行<code>AppImage</code>文件，执行后会发现运行不起来，把报错贴给GPT，就能得到如下回答。</p>
<p>其中<code>AppImage</code>文件运行需要下载<code>libfuse2</code></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d00b923cf6de4e1484d0c8360bf09382~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUEJpdFc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768292808&amp;x-signature=oS0RoLzFqnbv8FEomreSd%2Bz5dfE%3D" alt="image.png" loading="lazy"/></p>
<pre><code class="hljs language-shell" lang="shell">sudo apt update
sudo apt install libfuse2

cd dist_electron
chmod +x xxxx.AppImage
./xxxx.AppImage
</code></pre>
<p>GPT给了第二种方式，但是菜鸟试了不行</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f2e6e62378904459a17ed497a702a01a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUEJpdFc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768292808&amp;x-signature=oxpM6NIdEPczNh%2Bcxu9Jq6KPms8%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-9">运行deb</h4>
<p>这里也是直接问GPT，如何在服务器上运行<code>deb</code>文件</p>
<pre><code class="hljs language-cmd" lang="cmd">sudo dpkg -i dist_electron/barcode-medicinal_1.0.0_amd64.deb
</code></pre>
<p>就会自动帮你安装，<em>如果看到 依赖错误，则继续执行下面的代码（一般不会）</em></p>
<pre><code class="hljs language-cmd" lang="cmd">sudo apt -f install
</code></pre>
<h4 data-id="heading-10">卸载</h4>
<p>安装后想删除？</p>
<p>这里还挺复杂，不同的安装方式，删除不一样，这里菜鸟只给出用<code>sudo dpkg</code>安装的卸载方法！</p>
<pre><code class="hljs language-shell" lang="shell">一般执行这一个就行了
sudo apt purge 你的应用名（就是package.json中build中的productName）

清理垃圾 —— 可不执行
sudo apt autoremove
sudo apt autoclean

确保卸载
dpkg -l | grep barcode（没有输出就是正确的）
</code></pre>
<h5 data-id="heading-11">槽点</h5>
<p>这里有一个槽点，你就算执行了清理垃圾这步操作，其实用户数据还是会存在，需要手动删除</p>
<pre><code class="hljs language-shell" lang="shell">cd ~/.config

ll

cd 你的软件名
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b0e838764bd54ad1b148d407c245549e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUEJpdFc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768292808&amp;x-signature=VsR4kb4og2UJBMYaL4P%2BMyFKLCI%3D" alt="image.png" loading="lazy"/></p>
<p>至于更深层的菜鸟就没搞了</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/80a021a26c6343e2a9051f738d81cf7d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUEJpdFc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768292808&amp;x-signature=0vE4vZe5Q4%2F7ENKRmUTmRTiR0A4%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-12">打包白屏</h3>
<p>这里不管是哪一种，打包后运行出来都是白屏！</p>
<p>菜鸟实在是没有办法，GPT没办法读取整个项目，所以用<code>Trae</code>查看我的整个项目。</p>
<p>下面就是Trae在查看完我的项目后，结合我说打包后运行出来是白屏给出的代码（<strong>完全不知道原因</strong>）</p>
<pre><code class="hljs language-shell" lang="shell">sudo apt install -y libnss3 libatk-bridge2.0-0 libxss1 libgbm-dev libx11-xcb1 libxcomposite1 libxcursor1 libxdamage1 libxi6 libxtst6 libxrandr2 libpangocairo-1.0-0 libgtk-3-0 libdrm2 libxkbcommon0 libwayland-client0 libwayland-server0

./barcode-medicinal-1.0.0.AppImage --disable-dev-shm-usage --no-sandbox --disable-gpu
</code></pre>
<p>结果真成功运行出来了，但是用户肯定不会这样运行啊！</p>
<p>所以还是要看<code>deb</code>，怎么搞？</p>
<h3 data-id="heading-13">deb包</h3>
<p>一开始菜鸟，按照GPT说的加上了</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/294bc3a963364da7899e034a6957e7ec~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUEJpdFc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768292808&amp;x-signature=b9zKJ%2BIrP%2FskhoQv04%2BHZZ6T%2BAg%3D" alt="image.png" loading="lazy"/></p>
<p>却没有任何效果，后面才发现在main.js上加，在打包过程中会直接被忽略，应该写在<code>package.json</code>中的linux配置里，打包好后再按照上面的deb运行方式就可以运行不白屏了！</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-attr">"linux"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"target"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"target"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"deb"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"arch"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-string">"x64"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-string">"arm64"</span>
      <span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"AppImage"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-comment">// 可不要</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"target"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"rpm"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"arch"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-string">"x64"</span>
      <span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"executableArgs"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-string">"--no-sandbox"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"--disable-setuid-sandbox"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"--disable-dev-shm-usage"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"--disable-gpu"</span>
  <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"category"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Utility"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Barcode Medicinal Electron"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"maintainer"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Your Name &lt;youremail@example.com&gt;"</span> <span class="hljs-comment">// 必须写，假的也行，不然报错</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-14">AppImage包 —— 骚操作</h3>
<p>一开始菜鸟是试的deb不行，突发奇想，直接自己创建一个桌面快捷键，然后运行面的命令不就行了？</p>
<p>所以就问了GPT，然后GPT给出的一步一步的流程比较复杂，且vim也不是很会用，所以直接让GPT给了一个一次性输入就行的命令（需要带上自己的包名、路径，不然GPT给的还是不能直接copy）</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">创建 .desktop 文件</span>
cat &gt; ~/.local/share/applications/barcode-medicinal.desktop &lt;&lt;EOL
[Desktop Entry]
Name=Barcode Medicinal
Comment=Barcode Medicinal App
Exec=/home/bnzycjd/xxx/dist_electron/barcode-medicinal-1.0.0.AppImage --disable-dev-shm-usage --no-sandbox --disable-gpu
Icon=/home/bnzycjd/Pictures/logo.png
Terminal=false
Type=Application
Categories=Utility;
StartupWMClass=barcode-medicinal
EOL
<span class="hljs-meta prompt_">
# </span><span class="bash">赋予执行权限</span>
chmod +x ~/.local/share/applications/barcode-medicinal.desktop
<span class="hljs-meta prompt_">
# </span><span class="bash">标记为可信任</span>
gio set ~/.local/share/applications/barcode-medicinal.desktop metadata::trusted true
<span class="hljs-meta prompt_">
# </span><span class="bash">刷新应用菜单</span>
update-desktop-database ~/.local/share/applications
</code></pre>
<p>这个icon如果一开始没写，后面写了也可能半天不刷新。</p>
<p>这里有一个骚操作，就是在Show Apps里右键先将其Pin to Dash，然后再弄回来就好了！</p>
<h3 data-id="heading-15">问GPT为什么？</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c928ae47e2374694a74291f2f5882166~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUEJpdFc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768292808&amp;x-signature=Vx00c9thYM%2Bi5IiuAUorwIXdSug%3D" alt="image.png" loading="lazy"/></p>
<p>反正菜鸟感觉是服务器里面东西不全，所以导致需要这些操作，感觉和代码没啥关系！</p>
<h3 data-id="heading-16">总结</h3>
<p>到此，整个项目算是彻底结束，全程我只负责给AI打下手，主要的Electron逻辑全部由AI生成。这种开发方式，更像是一种「人与 AI 的协作模式」：我不断向 AI 解释业务背景、拆解需求并校正实现方向，由它完成 Electron 层面的具体实现；而前端部分，由于我本身比较熟悉，且界面逻辑相对简单，仍然主要由我自己负责。</p>
<p>回头看这一年的变化，只能说 AI 的成长速度既让人感到压力，又很难不为之兴奋。</p>
<p>在实际实践中，AI 在代码编写、代码提示、Bug 排查以及问题定位等方面，确实为开发者带来了极大的便利。无论是快速生成可运行的示例代码，还是在遇到复杂报错时给出清晰的排查思路，都显著缩短了从“问题出现”到“问题解决”的时间成本。</p>
<p>从我的感受来说，AI 并不是在取代开发者，而是在持续介入我们的思考过程 —— 甚至在某些时候，让人产生一种“自己越来越不用动脑子”的错觉。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5f7f73bc244c4d5896134488840747fb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUEJpdFc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768292808&amp;x-signature=d7f4RKxX0kgAy3BeFQu0C2uxd1I%3D" alt="image.png" loading="lazy"/></p>
<p>但冷静下来会发现，AI 真正取代的，往往只是那些简单、重复、缺乏上下文理解的逻辑书写者；它并不能淘汰业务梳理者、需求沟通者和系统架构的搭建者。</p>
<p>从我让AI写electron的读取文件代码、写接口代码，基本都是一次就过可以看出，后端的CRUD仔更容易被替换，这些固定逻辑，其实AI可以很好的写出来了，前端感觉只要界面复杂，那么不可替代性还是比较高的！</p>
<p>从使用 Trae 生成复杂项目的过程也能看出来：无论Trae公共方法写得多完善、GPT写的文件读取逻辑多么标准，AI 都无法直接交付一个真正可运行、符合个性化需求的完整系统，更无法独立完成复杂业务和界面层面的设计，但是也确实让技术越来越不值钱了。</p>
<p>可以看我的这两篇文章</p>
<ol>
<li><a href="https://juejin.cn/post/7472044324965761062" target="_blank" title="https://juejin.cn/post/7472044324965761062">Trae 初体验 - vscode要被替代了！强推Trae！</a></li>
<li><a href="https://juejin.cn/post/7572340344509251610" target="_blank" title="https://juejin.cn/post/7572340344509251610">升级了SOLO，对SOLO的一些建议！👍SOLO真的很不错！</a></li>
</ol>
<p>都是Trae无法生成整体复杂项目，但是Trae也有很大的优点，就是可以全局读取整个项目，整体分析，是copilot、GPT无法完成的，cursor或许更强，但是收费就挡住了很多人！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[别再看碎片的Cocos开发教程了，这份可能是全网最细打螺丝教程]]></title>    <link>https://juejin.cn/post/7591799107486007306</link>    <guid>https://juejin.cn/post/7591799107486007306</guid>    <pubDate>2026-01-06T02:05:12.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591799107486007306" data-draft-id="7591801024009093129" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="别再看碎片的Cocos开发教程了，这份可能是全网最细打螺丝教程"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-06T02:05:12.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="亿元程序员"/> <meta itemprop="url" content="https://juejin.cn/user/1972988307323236"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            别再看碎片的Cocos开发教程了，这份可能是全网最细打螺丝教程
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1972988307323236/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    亿元程序员
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-06T02:05:12.000Z" title="Tue Jan 06 2026 02:05:12 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f730b31565934586ada7874a18a2d9b9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768269912&amp;x-signature=E1OGf8lafLAM3fCSqpu0klOXGqs%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<h2 data-id="heading-0">引言</h2>
<p><strong>哈喽大家好</strong>，今天笔者做了一个重要决定：</p>
<blockquote>
<p><strong>把我的打螺丝游戏核心玩法（源码+教程）全部分享给大家。</strong></p>
</blockquote>
<p>**《打螺丝》**这款游戏，成功把现象级的“进厂”概念，从网络热梗拉到了游戏中去。</p>
<p><strong>它通过</strong>简单、解压的玩法，让小伙伴们可以<strong>上班摸鱼时打、下班休闲时打、睡觉前再打两把</strong>，成为了一款非常受欢迎的轻量级游戏。</p>
<p><strong>目前</strong>在小游戏畅玩榜上，依旧可以看到它及其各种变种玩法的身影，证明了其核心机制的生命力。</p>
<p><strong>言归正传</strong>，今天给大家介绍一下如何在<strong>Cocos Creator3.8.7中实现打螺丝游戏的核心玩法</strong>，学废的小伙伴帮忙点个赞和爱心，让更多的小伙伴也学废。</p>
<p><strong>本文源工程在文末获取，小伙伴们自行前往。</strong></p>
<h2 data-id="heading-1">一. 螺丝</h2>
<p><strong>螺丝</strong>是可交互的核心物件。它的实现需要包含以下特性：</p>
<h3 data-id="heading-2">1.物理属性</h3>
<p><strong>需要</strong>添加 <strong>RigidBody2D</strong>（刚体）和 <strong>CircleCollider2D</strong>（碰撞体），使其能产生物理效果与木板发生碰撞。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2b96de45bd6b4f058900b877ff2a297e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768269912&amp;x-signature=RMJ7ualU94dzYf09U%2FVKcOxExgk%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-3">2.抓取与移动</h3>
<p><strong>抓取</strong>的实现比较简单，分别准备按下和拔起两种状态的图片。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/82c7103570b84eaf93eb0ed6da80b23d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768269912&amp;x-signature=UCY449gM%2F%2BBvJzod4wE04QpnBfs%3D" alt="" loading="lazy"/></p>
<p><strong>通过</strong>监听点击事件，分别在按下和拔起的状态下隐藏和显示对应的图片即可。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/27bfcf8f1db84b9c82878631e90bb14e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768269912&amp;x-signature=LFxs3%2F1m6Lfup2SKaRfHpXT1JCo%3D" alt="" loading="lazy"/></p>
<p><strong>效果如下：</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/67741b99cd6349ba9a8f2aef8f87633d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768269912&amp;x-signature=OE%2Ff3gbqZl7Pcl7S18K4o2HHq0s%3D" alt="" loading="lazy"/></p>
<p><strong>移动</strong>的实现也比较简单，先拔起螺丝，然后点击对应没有阻挡的螺丝孔时，按下螺丝并且移动到新的孔位。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fe789cf1797242d0a5551fb67e123cb4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768269912&amp;x-signature=4lJt6OQiyKWUBStyedxcMXzL0QQ%3D" alt="" loading="lazy"/></p>
<p><strong>效果如下：</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f62f3a7ea91e4003a589a2ecbdd91a71~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768269912&amp;x-signature=yzX7Vcl4wf3IC%2Fk%2Bd4CFi7ejPUU%3D" alt="" loading="lazy"/></p>
<p><strong>移动</strong>的难点在于动态移除旧关节，移动到新孔位生成新的关节，下面我们会在关节中介绍。</p>
<h3 data-id="heading-4">3.动画效果</h3>
<p><strong>当</strong>螺丝无法移动时播放震动动画，给予用户视觉反馈。震动效果我们可以通过<code>Tween</code>动画实现。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/262bab3c858743f6bf04fb0ba4f2e4a2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768269912&amp;x-signature=Cm3CvWUINqmBYBDk2QPhv%2Fd2lrA%3D" alt="" loading="lazy"/></p>
<p><strong>效果如下:</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/961d5fa82b86403aa260665b68f59088~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768269912&amp;x-signature=ogZeRmbIlkrgdO8hYuuROCohoZk%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-5">二.螺丝孔</h2>
<p><strong>螺丝孔</strong>是螺丝的“归宿”，通常固定在墙上。</p>
<p><strong>关于螺丝孔</strong>，最主要是要知道点击时，点击的是哪个孔，我们只需要给孔添加点击事件即可。</p>
<p><strong>但是</strong>很多情况下，孔会被木板遮挡，所以我们可以选择遍历所有孔通过距离找到我们需要的孔。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/badf376da7c14dfb8e2710900b82efae~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768269912&amp;x-signature=JSR1KjWU%2FpIkro8MB1JWH3O5Vug%3D" alt="" loading="lazy"/></p>
<p><strong>此外</strong>，我们想要判断木板上的孔是否遮挡螺丝孔，我们可以通过两个圆的圆心距离在合适的阈值范围内进行判断。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6770b9ea69bc41acb79d67e1b83b5ce4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768269912&amp;x-signature=YpOQ3DUu%2Bf6xT7%2BhUuD80U9Hqi4%3D" alt="图中蓝线段的距离" loading="lazy"/></p>
<p><strong>代码如下：</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/117747c432f3435b9dcafb52cbaf54a3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768269912&amp;x-signature=YJsG9KTNywW2hQmpeHt%2BJRP3nso%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-6">三.木板</h2>
<p><strong>木板</strong>是整个游戏的承载基础，上面通常会有若干个孔，螺丝通过它把木板固定在墙上。</p>
<h3 data-id="heading-7">1.物理属性</h3>
<p><strong>和</strong>螺丝一样，需要添加 <strong>RigidBody2D</strong>（刚体）和 <strong>BoxCollider2D</strong>（碰撞体），使其能产生物理效果。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/61879f16e0e047e1862c1ba7299a99e9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768269912&amp;x-signature=Yjp%2F1DC%2FCAQebx3Xb2RTAu8A8f0%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-8">2.位置判断</h3>
<p><strong>我们</strong>的螺丝是否能移动到某个螺丝孔，很大层度取决于孔是否被木板阻挡，因此我们需要进行判断。</p>
<p><strong>首先</strong>是木板与孔的位置判断。需要分成<code>2</code>步判断：</p>
<ul>
<li><strong>1.判断孔与木板是否相交</strong></li>
<li><strong>2.判断孔是否在木板内</strong></li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4653483dd7514c0c8067ed1fa2ab4a99~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768269912&amp;x-signature=iVCkhJIKNGBP8wym8H5FtI6h23E%3D" alt="1板外，2相交，3板内" loading="lazy"/></p>
<p><strong>代码如下：</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/28e479ee9e5b4c1ab7aef72c878e4e87~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768269912&amp;x-signature=4wSvCzAU0F%2FRcNoBDj8SNIho8RE%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-9">四.关节</h2>
<p><strong>在Cocos游戏开发中的物理系统</strong>，想要一个物体围绕某个点旋转，我们可以使用铰链关节。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/66ec6cb8bb924d90b759835a816b540f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768269912&amp;x-signature=LtQgeGqCIBC16ad2iGK5f%2Ffx%2BfE%3D" alt="来源于Cocos官方文档" loading="lazy"/></p>
<p><strong>关于</strong>关节的使用，我们通常需要指定它连接的节点，以及节点的相对位置。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c51b8aa1599749e795b20bcd4e450333~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768269912&amp;x-signature=7kTHcUFrhVDyBJebjv3rL1Jmucw%3D" alt="" loading="lazy"/></p>
<p><strong>例如</strong>，在木板上，我们需要添加两个关节节点，方便在代码中找到指定的关节，和它的相对位置。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/27abe5f57f6e4c7a9a61fcb4874d156c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768269912&amp;x-signature=A1%2FJNOXEKT60zonybGppDXvkqlU%3D" alt="" loading="lazy"/></p>
<p><strong>这样</strong>我们就可以得到木板受重力影响的运动效果：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f2b1569db5dc4c8cb23de7237f0fd0c3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768269912&amp;x-signature=iGcjfGA%2B2NgMEj5g20yU5oyt7NU%3D" alt="" loading="lazy"/></p>
<p><strong>上面提到的</strong>关节的动态添加：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c3ad3058814549c2a7a0cda3a807dd10~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768269912&amp;x-signature=XWqTEso2JyJAyeVLkl2U9lOyv80%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-10">五.效果演示</h2>
<p><strong>关卡1：</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/91e66622205541109f9ea5fe2ffc85bc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768269912&amp;x-signature=Q9t6%2BXukT%2BtAJrAqRQ7GXn56mIk%3D" alt="" loading="lazy"/></p>
<p><strong>关卡2：</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a1fe4407fd51424cbc8e294b4bb744ce~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768269912&amp;x-signature=WuKDlpnXohQq34rSkCZeHldFJlY%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<h2 data-id="heading-11">结语</h2>
<p><strong>以上</strong>就是我的打螺丝游戏核心玩法的全部分享。</p>
<p><strong>不知道小伙伴们都学废了吗？</strong></p>
<p>本文<strong>实战源码</strong>可通过<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FFOi5gCiGzF3LnT03DpPMXA" target="_blank" title="https://mp.weixin.qq.com/s/FOi5gCiGzF3LnT03DpPMXA" ref="nofollow noopener noreferrer"><strong>阅读原文</strong></a>获取，内含体验链接。</p>
<hr/>
<p><strong>我是"亿元程序员"，一位有着8年游戏行业经验的主程。在游戏开发中，希望能给到您帮助, 也希望通过您能帮助到大家。</strong></p>
<p>AD:笔者线上的小游戏《打螺丝闯关》《贪吃蛇掌机经典》《重力迷宫球》《填色之旅》《方块掌机经典》大家可以自行点击搜索体验。</p>
<p>实不相瞒，想要个<strong>赞</strong>和<strong>爱心</strong>！请把该文章<strong>分享</strong>给你觉得有需要的其他小伙伴。谢谢！</p>
<p>推荐文章：</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FFOi5gCiGzF3LnT03DpPMXA" target="_blank" title="https://mp.weixin.qq.com/s/FOi5gCiGzF3LnT03DpPMXA" ref="nofollow noopener noreferrer">亿元Cocos小游戏实战合集</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FXLCknL3fJDubec2GW6KLFA" target="_blank" title="https://mp.weixin.qq.com/s/XLCknL3fJDubec2GW6KLFA" ref="nofollow noopener noreferrer">Cocos游戏如何接入安卓穿山甲广告变现？</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F3_VrSld4KnDKY_7hxjSoKg" target="_blank" title="https://mp.weixin.qq.com/s/3_VrSld4KnDKY_7hxjSoKg" ref="nofollow noopener noreferrer">你知道和不知道的微信小游戏常用API整理，赶紧收藏用起来~</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F0Lj24VHJ-pL8z82hHqQLiA" target="_blank" title="https://mp.weixin.qq.com/s/0Lj24VHJ-pL8z82hHqQLiA" ref="nofollow noopener noreferrer">Cocos游戏如何快速接入抖音小游戏广告变现？</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FZ7DusUJA2v1IFZDFtBsueg" target="_blank" title="https://mp.weixin.qq.com/s/Z7DusUJA2v1IFZDFtBsueg" ref="nofollow noopener noreferrer">如何在CocosCreator3.8中实现割绳子游戏效果</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F3BzzFBzeVAO-a6LPTeFTrA" target="_blank" title="https://mp.weixin.qq.com/s/3BzzFBzeVAO-a6LPTeFTrA" ref="nofollow noopener noreferrer">如何在CocosCreator3.8中实现动态切割模型？</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FZIph332u_r24OTY4r6_jow" target="_blank" title="https://mp.weixin.qq.com/s/ZIph332u_r24OTY4r6_jow" ref="nofollow noopener noreferrer">Cocos游戏开发中的贴花效果</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[构建 “按版本触发、自动发布、自动回写” 的前端组件发布流水线]]></title>    <link>https://juejin.cn/post/7592017365141618740</link>    <guid>https://juejin.cn/post/7592017365141618740</guid>    <pubDate>2026-01-06T03:33:31.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592017365141618740" data-draft-id="7591786340321165346" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="构建 “按版本触发、自动发布、自动回写” 的前端组件发布流水线"/> <meta itemprop="keywords" content="前端,CI/CD,NPM"/> <meta itemprop="datePublished" content="2026-01-06T03:33:31.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="雨夜寻晴天"/> <meta itemprop="url" content="https://juejin.cn/user/1943592288391496"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            构建 “按版本触发、自动发布、自动回写” 的前端组件发布流水线
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1943592288391496/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    雨夜寻晴天
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-06T03:33:31.000Z" title="Tue Jan 06 2026 03:33:31 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#2b2b2b;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(159,219,252,.15) 3%,transparent 0),linear-gradient(1turn,rgba(159,219,252,.15) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin-top:35px;margin-bottom:10px;color:#4dd0e1}.markdown-body h1{font-size:30px;text-align:center;position:relative;width:max-content;margin:0 auto}.markdown-body h1:before{position:absolute;content:"";z-index:-1;top:-20px;height:100%;width:100px;left:0;right:0;margin:0 auto;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA6CAYAAAAOeSEWAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAABkLSURBVGhDtZoHnJ1llcbP3Om9ZiYzmfSQhCQQIbRQVQKI9CYC68qKriJK0UXcZRcINqStIoiIqKCi1NACQihBWiCkkJ5MJlMyvd7p7d759v989/sy34yTbIj48Atz71ff855znvOc971xDrB/EtoGI7a9Z8Aq+wZML0mNj7dE95NZ1OKsj1dHo1GbnJpss9OTbWJyonvun4VP1Njuoagtb+m0it4By0iIt8LEeMvkr8XFWcfgkA1gYDLf47i2PzpsyU7UspKSLDoctagTZ7Vc08MzClMS7awJ2ZaflBB78CeET8TYla1dtrKt2w5KS7YCDGzEoz2RqKUmhGw6x2bhuXyOp2BoRXef1Q1E7Lj8TIsMD1sbxu1kcnYSAX1810RMTUmyMB7f2j1gC7NS7byinNiL/kH8Q8a+2NRh77b32El56VaPAe0YeGR2mh2bm+FdMRqP1rbZe+3dFsHT35qcb/Oz0rwzo7Gxs9feYPLS4kM2h8lawee5hPmlJXneFQeGAzJ2F564v7rFzi7Msu3d/Xgjzq5g8ArX8VCNN2vJ28daey0zZJabmGCLslP5HOf+Oygr3UzDGOf+JxrauXfQjslJt+dbuuyMgiwmk+sPAB/b2Lt2NdoMZnuY21qHIvbvUyZ4Z0ZQiXGrWjvsmPxsK4R0nmHA8ZCTQvxVQn5eRipklIBtcVbV1WtHYsjati47ZWKuTUpP9Z4yGk/xDBGe3v1mW4/dOrvYO7P/2G9jRSjf31FnXyaUXiB8r51WaJkM3kcfOSa2FR6qarIenooTLQHPLcC4mYThyw1tVpKWYlVERlZ8nC3Oz3Jzdn1nn5uvQ8OOHYvhR/CvsqffJbkCkZTvcYZ6Z0WTfTovw5Y1dtjXp+TbFPhgf7FfxpYxuMfr2uwo8rEtMmwXF+d6Z8wGmIR2PLyjo8cqOFffP2SLGexJEJCP9R29thkPXlpa4A5Y3w/jmuVNYYwO2QkY7WMtz3mVcE1hkualJdmSolzX8GnpKd4VZq80d1o7zN0RdWxGaqItgbn3B/+vsasgh/UMNBOvzYMZDxtDKp289KGaVguFQvb1yQWWwuB97GaSXqUUnVaYbSUwrDCEBz/C2CM8EhNrP13fbkeSh3OJgCAe2N1CWXKsGOc6TOr5U4q8MwYhDtkTda02MyPN+nnGBQEH7A37NHYz5KOZVv08qyjbSseEzKauPnsMj98wc6Ibcj5UUv7M8QWZTE52jEwGOVaD8U1Dw1YNWX0qM8VKyb80L/TrOPYOzH4KBJQTrK8M7+7KZjuM63sHBt17FubGoibCuf+tarWFGUmuwWeT8/vCXo1tZOYeZcazCaez8MwEzzM+HqhqtiJI5twxL1jeGLYk7jmKMF1JOCbg6Qj5nAdRqX7q3BYm8VAmQvW1lfcMc58IT95uIA3q+gftrDHPXUXJWkVEHJme5Bp5UmHsvIZ/O3l8ECE/FWcsItX2hr0ae8O2Wjs+J43QTbOZzGYQ/7Wtxq6eXjRK3r0By4YJ6Ty8EiYSJqcm2eGeV4Pox/ANENJR49RiEdfqcLflUJrEBZqgxYHrBjn2ExFURqKdVETN9YirJxKxR2rbrYeQv5ISmB6IsiDGNfZGWPeMgkzr58xnPaJ5p6XDZPKz4T77wayJ7jGhhXLwanOHTWBgq5n5q6YUwNJ7l3kKcRl7OJ7fF56l1GzvHbSD8dghTPi0wIRfv6XafjJ3ssv0PnZQ7nZx/etwzO1zJ3lHR2OETTw8x0tOx1AN3De0D7YV+63oGthjaJQ5Ur7eVVZjcdGInUyuaT73ZWg3efV8fZs7cc2E777Qi5eunVbghvPPymrt/krKGfcLd8ybYjdxrK6333Z09rjHZkNuLYzz0uIc+xWCZzz8nbHbe4dsY1e/XUOY+nimvtUaSazv4jXhaQasSbmYmpuenGwHZ8TKggSEQm08rMD7ahBOoExcMqXQegjnZ+CEvaEa1ZQUQkt39dj0zDS7krq+ARmpdws/nlNqD9WFbWN7l5u3wr9MyrcXKUsqWy3jTOaoML4DdaQ83YIoT4VYpEXvYQZLmbX5SLohBrgOj186Kc/iKTUPUhq+Rrm5ekOl3TWv1Mr6hqwbY0VOQXwEo+Moq4Z47q5qsU489G944LyJOW4LOLZOKtT/iI6+nGe/0dhuEd4ltj2NmiuCU4hnk5fHIi7+RK4uTEu0e+s7rAiRcw1CYy3OejvcYz+eXeI9MYY9nu3lYZl0KavJJ7Vjibzgjp319rUZE20j7CkJqFr5JQYgQ39f3eQaKpQk0afy8nl4uBzvjUUTRk7k3iebOm0pabDiyFn2XGu3dRME41CGVeBVqSiVnc6hIUpekp1VjHLDSOEcQlui5W/U8C7IKREjv1Gabw3wRwUTvpv7jybPtzHmIPZ49q6KRjuccqBQVCOtGvqXhrCFUUXJzOYSHt7Kw5Ix9H08dSje1o1JyL73IYXpEMmE5CRbw6wuykx2pR+Pd6/J4JpLiJKV6N9OnrcQNfQ0Zem6qQX2MmFXyWTE+DMO0kGx4e08DEjnXbsYuOq7niHB8jdY/wQ8Srm2XCZZUrOakF1CY5EKX0h93Tu/1J4kRdbDMT8MamgZK9xe3uDcvrPe++Y4f61rcZr7B53rN1c5N2ytcV5rCrvHt3T2Og19g+5nH7dvq3bqunr4NOwgK2MHA1jeEDuG7HNuLmtw7qpocl5t6nCPvdTQ7v4N4u3WTqeyu9cZHIo4f6lqdFoHh7wzMbzDeeGv3Hvzjlrnh2W1zofhHuftxpFn3VFe7zxS0+p0DlKVPbhhvBxhvwiFMgfP+mjHA08gEC4pybeLyK1iZldh8zC5VJQyUl8l59KZ0WJk2xaiYWxNrkXXJhA8r3PvZRur7ZZZRfadaRPsfiTmX9HGajC2tXd6V8dQTMhX0h8rNdJx9Ra8F8SbRNLzhPRnJmTZIUTYueTyWxyr7uv3rjC3OkzE8495oS+4xq6D5WoI0bO5WVCOSerl8rIeBrOI/Hkaw6ME5W1zSuzx2la3CRdWi3zIG+FDBvUp9LMgI/vggUmE7KkT81yGvOOgEYa/aUahhRAF5xLec3OzbF1r2O17BbVxIi7hzJIC64IYhXdJA+nh/5xVbOmE9J0QqjSxWk0pp37M2YEtgjS8GpimACu7xkqxdKJ6fEXyYl2Lre0ZtC8yELVewtWUnbfCPIhrvgDFz8WI5yhJKgcnFMZWEFrwhgzo5uWDDDA1oGSOzcu0xfx7vTlsv6posIMpJ6cGWPiw/BxL4PU7vbrpjgf8bMdu5OYwOdhm83DARUSa0ELknYIeEAaILuWxlhGa0M8+EuJCrpJT+ymENhN60pXBxa3LZ5TsucnlGaCmIEQ4Evru91yuz0xMtKaeXluI5zdh9Mm8vAlBn4aR07X64EH3vEKdXQkZJXPP/JxMvNRpLxEtHZ5RQgmNewnpouvVTpYTHdfOnmy5kFUGnpRTfEhXD9DiBdFFJB0/YWS9aj6pmc89r0BaQmgTRkgI+EsdKsYasJZOBF+QqTH474NK7LbyBvf7W+RgOxNyxfQY2/2hrp2+NkroxrzrQ55fSZkpJIa28znCgF6rb7H1hOSslATyvNflAh9pvHcX3lVE/Ya8FjTJIexa2Rq77nfU96unTnD7aME3+TAm6BFKYrPnqCNIqV5sq0ZGCiEV+Db+qWMQqpFgb5KPx48R6omeDl2EuP9DTYt9iGA/f1KBS1w/La+H4ktsSmLItvZHXLUkrCeflVtJ9DVVg1H7+sxiGvVM975rZpfabuqHVhuP5F1vewav5O8GamUe91yDanoYw47FWzC929O+DJnKA2opFY1Rjru5CE7kOcO0jJtQVUIynzuZEMeb+1CEOFXN8iFSGeRpCm1BTlJxVg49Azm819SO7Bu0axEbwn27GuxMck+TMQHDP8fn48gfDVIL4R8xKVPJ73MQBUIfA/Z54LMw5vmlE+w+VFo2A78X/SsyPA/RMD0z3e2qVLtfo7aeBslpMX0N0TEnLcUlKym1jyBFqSohmYntI5enBhYB9CY/2kNarhwJhNiMtRGyWnkQdKaCFyQwgydjyNUw4VchKxXv2/DoKdC+lkQbCX1NlKCGvJiBJkSGbCus6jfo4yGBNySgr+u7e20BCsxdVAcFlJ/tHd32+cIsNxSXUULUUx+dg/d47g7OPYFw2MxkSuyMwLHVTI6PBN6dS8Sppw45zHJSgDXV3aQzmz40Z6fDgBfiAXU0uZxby2zejee+j3eltoQMzhV6qSBogXwrEXDj7ElWxUQ8RrnSaoU0dxIsKaiMvMykXTu90NqJsGHP4z78SdLigUrLKat32nFwy/E07pfDFRdQ/7N5r57pQ1482uvWhMGhQcviGkVrKDUp0ToCxfhQal5n4Hs/g1jOgH4LWdwFOd1b1WzHET4vLZppv+Czjxo840OrDlG8jAJzv2tp5mLK1dsU/lfIOeWy5NxFxfl2BoYImlQtx9QF6mJRQKBsQYYuO2yaLYPBUXvu/VqYPxtHhNy7Y4hCkNLGPtKSklzCVKSHtMQxcqm5Kw1DhI2PTGZtcGDAvoLQ/u7MifYtWFBlxz2H9zo8RkwKzC5UYiG+p44ccqE62YAxLeT/TOpf8MXx8Qk0IJFRY1Go+viQVJpE5Ehjf49xfAZeqGIy/7us3nqxwQfCkjZypPxobVr/6YpQHIalUvuCyEwbSXC9PC8QnkFcXlrgLpoLIhIfKuaqlQkYIAwQnr/f3eyu7KttOw2lNpv8/BPHyjzVNER3o72gvEBKqRMTflndbP8BMweRDyeciEj5bFayFXqTLzheivgYJC0jwzwHa0MDDEotm48ndze5BBBElAnxxcRYHAFh3FfZaA9UNRmC354kNwUx8eHkmVj5dcTE5ZMnuEyr1QqlhtaJLuOYZv4v3KNo0TKrGPUZ1NILPKuWcvVn5Trv10SMB6h0j/ARMnlOuafCBIfnSWEx/Raif3HDzofYMM31dOyY9LBaLK3TjoX2fEqT4+2qaUVWSTQvyM6wC8nNJyEetXIyuLKrx04P7MKNnbJZlKUtNAIHo7i2dA/YU3Vtdi5l6jCepXy8hOedSSSsI8/HQg5Q+gxTKXwkMHkbESo+hjG0lbRRzQ3Fc5LOzDuFhs3Ptumpie7ilRDhlEJOq/hjsZljCxjkt7fWuPS/EekpXMggJQIk0G+eN9Xu2VmHWIkJe0nJRN4ptBBit2yutG9ML7J1DHAxebiAMrZ4VZlduqGS8I2tJc2iborUxmIN79c+kTovFxivPvrcSaP3n7RSKYTUmKt4N3rMOcw4JOneD3sP956jNaMglIeTER5Xbdlt15Tm2W10NEsYrA/N5JLCHHsR9tSqwxq08G3bqm1ZTbOtagnbo6SLvH/VzBL7W7jPzqFea0LmMLFzUuLtdwumuO3i1Vtq7OK15Xgw3l1PDmIXak+6QBEkvB9YJIzBcc/L20JIYaSZ/qAzVm5Ut4oowk3QehC+N3xo/1wTqt7zsYawfX9no9XjqdPXVLhrwyo/wucJYQkE1e4j8rLcBuHUItQQKqgMXb6LGvxFQlXw33AdZLR0V5P9Fr29lP73scNnosoyvdWPv4fPJ+uJrLVtMakqaL1M1cTvv0OLIZE6wk2a2IcIRUQh+DaejpdcXepBa7bKDRGM9PIVxTl2EwarZ72rooVuY4RQtMypdk6e1lLLehhY2lt7QEd7WxlCDvdIli6E9B4+ZIodmZEMccUGqgiZOqru9tkR3iJ8nCcXRWRZCSPMLPEjlx2LjQL1OM5qKAm+vhSuRqSfV5Ttrg8FdWcrnhMqCTex7DEM6qTsVEuM1+8hovaHQ6e6a1Fz0xLd3nUt4ToWWuzWNkhcoAIIjUx2ZpxjLzWF9+SYmngR1lok4TEoJxGfuijhI/7OICoFmadl2llcL9b1oRVJtbD+JLlv1KrhHG5811t9ELbzgk14ICUwqE+TDzftqHPz98vUSy3jSIwP8dCpkNqLDPTx+rArz4T5qLG3G2PrvJKKPoLBWE501NC3ilUX5mVjVIb9nIbgWcpPMiSXjbcL8K62UkR86m1/yfkSeMaHFuK04X0CE3J6SWzFUxw0BSNHlSzi3RmIRJwHq5udO3c16quLp6sbnffbupxbt+12vzOrzuvNHc7ycRbIxuJHgYU7YSASdQgxp7qz2ynv6HJeqW91doa7nLruXof+17sqhhu31Xif9o7HalqczV29Dnrb/f5EXZvzdH27U98/6LR5i3N0UM5zjHU71/lwjRWWltU5CAIn7F1MqLp/r9hQ5RoaxG+qmrxP4yNKcfsFLwuiprffeb2l03m2scO5h3Or2rudzjGrhk8x4Cqu2xcexilBvNEcdi5Yu4tKF3Ue4tzPy+td5/1md4tzw5iJ27NuXEYobYUdlb8z6GTWkdxaCvk2zHjd5mpKQ459mv5TkAp6mQb9Aq9HHQ8S6mrZnuc6vUG6WHusIhCJGNXl9byvnJyaiE7+Eoz8c5TYNQiUveENGpJpcIJ+biS8R0+rlcazGNs7pKB+zPLTOSX2KNWhlDAf4r2Spj72JORB5OyHULX+dlD/FOky/HFy5ygYU0sey/i8moeqdunXK1qC3RuaMOYHlI/raQMl3M+EeTV5WxD3Km8a8PkM8nr648sQ9+esKbf5e/nxiKBfAOQkxbv3SU9LYmqPV9V/Pn+V20VwTyVjTqCI6edEQUOFUXs9WmfSll8DyX2dt7GlnwkswaM3l9XZ0oNK3MTXbxpOV2sGk69s6XCJw4cY8KbyRrt9TrHt7Bm0rRBQe1+fHUWNfaapU0KbqxzbORC1M/LS3dJwIl3KOrwykQG/E+61q+isgniztdOKqNOziDgZqZIzFwPvqGiyg5NCtoCqoG5NxHhPZTOsnORulKskjoKMDeLuXQ3OmnC3syxARFXdfc57LR3OrdtrvSOOs55rnqhtcdoGhpxHdjc5EfJUuHZTlftX+G15rXPlhkrnLe59F7Lz8VGHdg8c5y2OLeMZ126qduq9XC3v7nd+FchLvYPJd15gPCu8XQnh/qpm59WGVudZzvvQO97kXTcGxhnEuJvR39tWY8cwK4uhcikk4a3Gdstg9l5B2t0wfaTdWkEou5vCPOV5PH73vFL3+DfXltnh6OxjkJD6Wd5F3g88tMe6CW/7YmI99VIL4u0oqUK8ocW4d8hFrXMVoOQU8s3U97MnjvDD/XRYkyhHM1MT3GVZQR2Tdv70U8EbA5vlo+CaPAaaSWoZXm50otGodxQ6L6txGKxzw5ZYORrBsPPrykZKQIy1n8bTjwb2fO4Te3ue7x6KOKvaYns1wtIddd4nx3mwot55qyl2360cp81zurg+CGqwU8v4/Of5uAVvPgObrwvHomY8jOtZ4fXWLnefdHVXv9044+8ZklCx75DXwcV1Sb27y+vInUQEuVYSaMgRJYfAwtoj0raFxIUW1A8nz35f02qLc9Lc9lG7CBkwtUR7bf+A+5uL6ehnH9Lat+5sIEfj3Cbj3NKRvP7Rjlo7FSmqavKvpSP8MRZ7NVbQYLSkqlC9ZW4sPH18gBTcORjrhMWmQWzFmK2UsvO90qQ1oZcI8UhkCLZPtRqMy0NirobAvjIpb4/sW06qKGyPR2oGIdlazjOOTk+kLYzaaYGSp63Wz6HsXsQ51wd+LTAuZOy+8GBNq7tF+IOdDU4kENJthNID5YRafZtzZ3mDs9LbRgzixcZ2l1h83OKFbDmEd0/FiFp7DWHgp0AQGzq6nf8hPF+oa3EehOz0ziCWcm4NpBRMhX1hn571oR9wqVVSDVPtUi32sQ0vbu7scZdY9aOt2ZSEL9BEBIW+dv20AKDd9/ep09oimYqHpyImkKDuRllS4PrlHNuIqDmCJmNJQba7q1joEaUQJuR/WdXsLrJrq/L6cdJsPOyXscJ7GLKqo8cOpqhrO//yQG6oS3kZwS9xPkRB3wi7diFMtDN+PLk5m1ath+8f0Fy80dbjhvVXub+U5mEqeal27UP+dWpPlknNxW79Ak6/7Tg3UMOF52j1xA1qK7Trd6nXC+8P9ttYQcumIonLSnJtBdJNa77axw1C2x3qR4Wqnj73x9f6MbV+CCYFBZO6y51aSh3gzVrsmwzJnULEbCJC1oZ7vIZ/9Iqmfvn2u5oWO5n8fApxcuWUApum5diPgY9lrA9EtvUNOzYf8vqAcJPsU5iOh7XtXQgt2uZhjKU2amF7HQyfEYWcZk5yQ1RDKNrLcq02k/9IGmldrB93KiokPw8EB2SsoKWXO5FmxXhlckqi+3vEUvLqwok5PHVkIWAszlqzy1p54zuLpnPZ3q9bod08JlLSb5DrNxDm38Sbvsg5EBywsT7oH+3XNW3uasGirFSrxRNdCllKiPZHZzJYLZb5qEcpae3pxMCuu9oibS5/QCOiLcYUrp+MmtJeURjFdVlxzqiae6D4h40NQt54HyGv3JRo10aVfv8YhtC0pSlVKcPFuxIXahr08mzCO4VzMlLSsZuomZ+RaucU0rXsw/sfF5+osUFonWob/7TrLdaUgdpV93fl9X+VIC0Y6tek2uI8OD3J5gT2Vj9ZmP0f4IM4iY7RQ5gAAAAASUVORK5CYII=) no-repeat 50%;background-size:64px 64px;opacity:.84}.markdown-body h1:after{position:absolute;content:"";width:150%;left:-25%;height:50%;bottom:12px;border-radius:50%;background:linear-gradient(transparent 80%,rgba(77,208,225,.8));background-size:400% 200%;opacity:.6;animation:h1Animate 6s linear infinite}@keyframes h1Animate{0%{background-position:100% 100%}50%{background-position:100% 50%}to{background-position:100% 100%}}.markdown-body h2{display:block;border-bottom:4px solid #4dd0e1;position:relative;font-size:24px;padding:12px 32px;margin:30px 0}.markdown-body h2:before{width:24px;height:24px;left:0;top:0;margin:auto;background-size:24px 24px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADGklEQVRYR81X32vTYBQ999s6mFjQgQ+DrbHiVFZYU4cDcQ/6pGhTFVYFEXGi82H+Bz448UnEF1Fx9ccEEcXpZE3d5tP2ooKiTacTHaLNpigMHDgnU9tcSbrWrkwWR0sbyEOSe885ObnfvV8IRT6oyPwoLQHBx+OVM5WJvSyEVAhnBOjt7yU/+/rr6r6l8TMO+F/EN0JQhICqQpD/xaRpcpAc9tS+M+9lBCia/oqBamK+zeDuQogQZaKJk3wcQjxSva7tGQGB2Ke1zIk3DNyMyNL+QpCnMQOaPsDAVuGAp9cjvbYc8Ec/bCYSg0zoiHilk1tHxqsqEsYlML4kjIpT/eurJxRNPweQU5VdrWaOEo1fgKAVbBgXIz73kF3R/ph+ghgdzMYWM29eAWlBJqgZaFlFYtC6nhWpaDqnSGlIlV1WjJ3DloDNgyNLncudqgX//Ucg3LxuStHGuhi8pqKCW3rqV342rwFjRznKm+/LNaN2yC237ThgF2wxcfMLeP6+ncrKzoPoKTGeLQbYbg4TNoC5iZPJY5HGVRdSNZAWYBclD3FzBQzrR8hACAKdzBzKA/4/IYioDQaOskBbpEG6PO8qKKSAEi3CnEb0Pw4oMf0OmKbTDWqh3Lw6EIiNBZi5lxh3wz4puBD5ovqAMvxhHSdFKxE1CQe3m/07TeTX4lcJdAhE+1Sv65Z5P/ByvIGTRowIZ9igbtXnmrOsbTvgj+kHBNMuBu9OdVw8EeU4nC1A0cYmAHZOTRrLhra4Z8ywnSN6vZHAFTA2WnnMfQB3qz73ddsOZM8CACFDIPSgQXqebXEgqgeZcAeEe6pXasm1f8ew3igMtAHWac0Uc/jYdyAaP0xEBwFsmgUPqbJ0NE2UKj4EGcahiOzuyhagaHpnmtgcVgTcCMuua7YdyAHbA3ArQNscVFbb4635aD6fnYaTvxxi9UNP7ddMXaRWVBdAcaLk6bDXPZCNZ9uBXEsDUX1T2Cc9yjig6Z0EHg3LK8/aqf6MwJKchkXfks1+0+JtSq3qLPa23BRR1B+T/6nkfMaW1r9hPt/MLtYfTLEpP+T9FNoAAAAASUVORK5CYII=)}.markdown-body h2:after,.markdown-body h2:before{content:"";display:block;position:absolute;bottom:0}.markdown-body h2:after{right:0;width:400px;height:10px;border-top-right-radius:24px;background:linear-gradient(90deg,#fff,#4dd0e1);max-width:50vw}.markdown-body h3{margin:30px 0;font-size:18px;position:relative;padding:4px 32px;width:max-content}.markdown-body h3:before{border-bottom:2px solid #4dd0e1;width:100%;content:"";display:block;height:28px;position:absolute;left:0;top:0;bottom:-2px;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);background-repeat:no-repeat;animation:h3AnimationBefore 2s infinite alternate}@keyframes h3AnimationBefore{0%{width:28px}25%{width:100%}50%{width:100%}to{width:100%}}.markdown-body h3:after{content:"";display:block;width:28px;height:28px;position:absolute;border:2px solid #4dd0e1;border-radius:50%;right:-15px;top:0;bottom:0;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);animation:h3AnimationAfter 2s infinite alternate}@keyframes h3AnimationAfter{0%{transform:rotate(0)}10%{transform:rotate(0)}50%{transform:rotate(-1turn)}to{transform:rotate(-1turn)}}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin:22px 0;letter-spacing:2px;font-size:14px;word-spacing:2px}.markdown-body img{max-width:80%;border-radius:6px;display:block;margin:20px auto!important;object-fit:contain;box-shadow:0 0 16px hsla(0,0%,43.1%,.45)}.markdown-body figcaption{display:block;font-size:13px;color:#2b2b2b}.markdown-body figcaption:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEVHcExAuPtAuPpAuPtAuPpAuPtAvPxAuPokzOX5AAAAB3RSTlMAkDLqNegkoiUM7wAAAGBJREFUKM9jYBhcgMkBTUDVBE1BeDGqEtXychNUBeXlKEqACsrLQxB8lnCQQClCiWt5OYoSiAIkJVAF5eVBqAqAShTAAs7l5ShKWMwRAmAlSArASpAVgJUkCqIAscESHwCVVjMBK9JnbQAAAABJRU5ErkJggg==);display:inline-block;width:18px;height:18px;background-size:18px;background-repeat:no-repeat;background-position:50%;margin-right:5px;margin-bottom:-5px}.markdown-body hr{border:none;border-top:1px solid #4dd0e1;margin-top:32px;margin-bottom:32px}.markdown-body del{color:#4dd0e1}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(77,208,225,.08);color:#26c6da;padding:.195em .4em}.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#4dd0e1;border-bottom:1px solid #4dd0e1;font-weight:400;text-decoration:none;margin:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(77,208,225,.1)}.markdown-body strong{color:#26c6da}.markdown-body strong:before{content:"「"}.markdown-body strong:after{content:"」"}.markdown-body em{font-style:normal;color:#4dd0e1;font-weight:700}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(77,208,225,.05)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{margin:2em 0;padding:24px 32px;border-left:4px solid #26c6da;background:rgba(77,208,225,.15);position:relative}.markdown-body blockquote:before{content:"❝";top:8px;left:8px;color:#4dd0e1;font-size:30px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"❞";font-size:30px;position:absolute;right:8px;bottom:0;color:#4dd0e1;opacity:.7}.markdown-body blockquote p{color:#595959;line-height:2}.markdown-body ol,.markdown-body ul{color:#595959;padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>一套工作流，统一发布多个仓库下的多个组件；以 “版本号变化” 为唯一触发；发布成功后自动回写配置并生成 PR。新增组件只需改两处配置，剩下交给 CI。</p>
</blockquote>
<h2 data-id="heading-0">背景与目标</h2>
<ul>
<li>前端组件分散在不同仓库，人工发布易错、流程冗长；</li>
<li>需要 “改版本 → 自动构建发布 → 自动同步配置” 的一条龙流程；</li>
<li>通过 GitHub Actions + 集中配置文件，搭建一套稳健、可扩展的发布流水线。</li>
</ul>
<p>本文基于两份核心文件：</p>
<ul>
<li>工作流：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Finfinilabs%2Fci%2F.github%2Fworkflows%2Fcoco-app-web.yml" target="_blank" title="https://github.com/infinilabs/ci/.github/workflows/coco-app-web.yml" ref="nofollow noopener noreferrer">coco-app-web.yml</a></li>
<li>组件清单：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Finfinilabs%2Fci%2Fconfigs%2Fcomponents.json" target="_blank" title="https://github.com/infinilabs/ci/configs/components.json" ref="nofollow noopener noreferrer">components.json</a></li>
</ul>
<h2 data-id="heading-1">架构一览</h2>
<ul>
<li>集中配置文件管理组件的构建/发布参数。</li>
<li>工作流读取配置与触发输入，根据 “版本变化” 生成发布矩阵。</li>
<li>按矩阵逐仓库逐组件执行构建与 npm publish。</li>
<li>发布结束后自动回写工作流默认值与组件 current_version，并提自动合并 PR。</li>
</ul>
<p>核心思想：</p>
<ul>
<li>“版本号变化” 是唯一发布触发条件；</li>
<li>配置集中在 components.json，组件级可覆盖仓库级默认值；</li>
<li>发布完成后自动回写，确保 “配置=事实”。</li>
</ul>
<h2 data-id="heading-2">核心文件与关键片段</h2>
<h3 data-id="heading-3">工作流输入（workflow_dispatch）</h3>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">on:</span>
  <span class="hljs-attr">workflow_dispatch:</span>
    <span class="hljs-attr">inputs:</span>
      <span class="hljs-attr">SEARCH_CHAT_VERSION:</span> { <span class="hljs-attr">description:</span> <span class="hljs-string">'search-chat Version'</span>, <span class="hljs-attr">required:</span> <span class="hljs-literal">true</span>, <span class="hljs-attr">default:</span> <span class="hljs-string">"1.3.10"</span> }
      <span class="hljs-attr">UI_WEB_CLI_VERSION:</span> { <span class="hljs-attr">description:</span> <span class="hljs-string">'ui-web-cli Version'</span>, <span class="hljs-attr">required:</span> <span class="hljs-literal">true</span>, <span class="hljs-attr">default:</span> <span class="hljs-string">"0.0.43"</span> }
      <span class="hljs-attr">FILTER_VERSION:</span> { <span class="hljs-attr">description:</span> <span class="hljs-string">'filter Version'</span>, <span class="hljs-attr">required:</span> <span class="hljs-literal">true</span>, <span class="hljs-attr">default:</span> <span class="hljs-string">"0.0.11"</span> }
      <span class="hljs-attr">SEARCH_RESULTS_VERSION:</span> { <span class="hljs-attr">description:</span> <span class="hljs-string">'search-results Version'</span>, <span class="hljs-attr">required:</span> <span class="hljs-literal">true</span>, <span class="hljs-attr">default:</span> <span class="hljs-string">"0.0.11"</span> }
      <span class="hljs-attr">ENTITY_UI_VERSION:</span> { <span class="hljs-attr">description:</span> <span class="hljs-string">'entity-ui Version'</span>, <span class="hljs-attr">required:</span> <span class="hljs-literal">true</span>, <span class="hljs-attr">default:</span> <span class="hljs-string">"0.0.10"</span> }
      <span class="hljs-attr">CUSTOM_ICONS_VERSION:</span> { <span class="hljs-attr">description:</span> <span class="hljs-string">'custom-icons Version'</span>, <span class="hljs-attr">required:</span> <span class="hljs-literal">true</span>, <span class="hljs-attr">default:</span> <span class="hljs-string">"0.0.10"</span> }
      <span class="hljs-attr">DROPDOWNLIST_VERSION:</span> { <span class="hljs-attr">description:</span> <span class="hljs-string">'dropdownlist Version'</span>, <span class="hljs-attr">required:</span> <span class="hljs-literal">true</span>, <span class="hljs-attr">default:</span> <span class="hljs-string">"1.3.5"</span> }
      <span class="hljs-attr">DATEPICKER_VERSION:</span> { <span class="hljs-attr">description:</span> <span class="hljs-string">'datepicker Version'</span>, <span class="hljs-attr">required:</span> <span class="hljs-literal">true</span>, <span class="hljs-attr">default:</span> <span class="hljs-string">"0.0.10"</span> }
      <span class="hljs-attr">AI_ANSWER_VERSION:</span> { <span class="hljs-attr">description:</span> <span class="hljs-string">'ai-answer Version'</span>, <span class="hljs-attr">required:</span> <span class="hljs-literal">true</span>, <span class="hljs-attr">default:</span> <span class="hljs-string">"0.0.1"</span> }
</code></pre>
<p>命名约定：组件名通过 “全大写 + 短横线改下划线 + 后缀 <code>_VERSION</code>”生成输入键，例如 ai-answer → AI_ANSWER_VERSION。</p>
<h3 data-id="heading-4">组件集中配置（components.json）</h3>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"ui-common"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"repo_private"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"build_cmd"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"pnpm build"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"publish_cmd"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"npm publish"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"version_file"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"package.json"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"adapter_script"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"components"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"ai-answer"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"current_version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"0.0.1"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"work_dir"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"packages/AIAnswer"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"dist_dir"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"packages/AIAnswer"</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>说明：</p>
<ul>
<li>work_dir 为构建发生地；</li>
<li>dist_dir 为 npm publish 的目录；</li>
<li>version_file 默认为 package.json，也可覆盖为 tsup.config.ts。</li>
</ul>
<h2 data-id="heading-5">工作流执行路径与原理</h2>
<h3 data-id="heading-6">1. 生成发布矩阵（prepare-matrix）</h3>
<p>位置与逻辑：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Finfinilabs%2Fci%2F.github%2Fworkflows%2Fcoco-app-web.yml%23L33-L100" target="_blank" title="https://github.com/infinilabs/ci/.github/workflows/coco-app-web.yml#L33-L100" ref="nofollow noopener noreferrer">coco-app-web.yml</a></p>
<ul>
<li>遍历 components.json 的所有仓库与组件；</li>
<li>将组件名映射为输入键（如 ai-answer → AI_ANSWER_VERSION）；</li>
<li>对比输入版本与 current_version，不一致者纳入矩阵；</li>
<li>输出矩阵 JSON 与 has_repos 标记。</li>
</ul>
<p>优点：仅发布 “发生版本变化” 的组件，避免无效构建。</p>
<h3 data-id="heading-7">2. 构建与发布（publish）</h3>
<p>位置与逻辑：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Finfinilabs%2Fci%2F.github%2Fworkflows%2Fcoco-app-web.yml%23L101-L221" target="_blank" title="https://github.com/infinilabs/ci/.github/workflows/coco-app-web.yml#L101-L221" ref="nofollow noopener noreferrer">coco-app-web.yml</a></p>
<ul>
<li>checkout CI 仓库与目标仓库（支持私仓 SSH 私钥）。</li>
<li>通过 jq 实现“组件优先、仓库兜底”的配置继承。</li>
<li>写入版本：
<ul>
<li>若 version_file 为 tsup.config.ts：用 sed 更新 <code>version: "x.y.z"</code>；</li>
<li>否则用 jq 写 package.json 的 <code>version</code> 字段。</li>
</ul>
</li>
<li>在 work_dir 执行 <code>pnpm install</code> 与 <code>build_cmd</code>；</li>
<li>进入 dist_dir 执行 <code>publish_cmd</code>（npm publish）；</li>
<li>记录发布元数据到 <code>release_info/&lt;component&gt;.txt</code>，格式 <code>REPO|COMP|KEY|VER</code>。</li>
</ul>
<h3 data-id="heading-8">3. 自动回写与 PR（update-workflow）</h3>
<p>位置与逻辑：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Finfinilabs%2Fci%2F.github%2Fworkflows%2Fcoco-app-web.yml%23L224-L304" target="_blank" title="https://github.com/infinilabs/ci/.github/workflows/coco-app-web.yml#L224-L304" ref="nofollow noopener noreferrer">coco-app-web.yml</a></p>
<ul>
<li>下载并遍历所有 release-info；</li>
<li>用 sed 回写工作流 inputs 的默认版本；</li>
<li>用 jq 回写 components.json 的 current_version；</li>
<li>生成并自动合并 PR，确保“配置=事实”。</li>
</ul>
<h3 data-id="heading-9">4. 失败通知（notify_on_failure）</h3>
<p>位置：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Finfinilabs%2Fci%2F.github%2Fworkflows%2Fcoco-app-web.yml%23L305-L320" target="_blank" title="https://github.com/infinilabs/ci/.github/workflows/coco-app-web.yml#L305-L320" ref="nofollow noopener noreferrer">coco-app-web.yml</a></p>
<ul>
<li>通过飞书机器人推送失败状态与链接。</li>
</ul>
<h2 data-id="heading-10">如何新增组件</h2>
<p>以新增 ui-common 下的 ai-answer 为例：</p>
<h3 data-id="heading-11">npm 仓库配置 OIDC</h3>
<p>先第一次手动发布，在 npm 生成对应组件库的地址，然后修改一下配置，如图：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2595ec90a7544ea0a636d79201f0330f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5aSc5a-75pm05aSp:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768275211&amp;x-signature=kg%2FQI6aE1%2Bc%2BLlU89OFyDvACNa0%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-12">在 components.json 添加组件条目（路径、版本与目录）</h3>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"ui-common"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"components"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"ai-answer"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"current_version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"0.0.1"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"work_dir"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"packages/AIAnswer"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"dist_dir"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"packages/AIAnswer"</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-13">在工作流 inputs 增加对应键（命名约定）</h3>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">AI_ANSWER_VERSION:</span> { <span class="hljs-attr">description:</span> <span class="hljs-string">'ai-answer Version'</span>, <span class="hljs-attr">required:</span> <span class="hljs-literal">true</span>, <span class="hljs-attr">default:</span> <span class="hljs-string">"0.0.1"</span> }
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f4bfb021dcf042b8a30e3846f8c892e4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5aSc5a-75pm05aSp:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768275211&amp;x-signature=X22ZaL6AdDDpsQqqm%2F1p%2B1xiEd4%3D" alt="image.png" loading="lazy"/></p>
<p>校验与发布：</p>
<ul>
<li>手动触发 workflow_dispatch，传入一个“不同于 current_version”的版本号（如 0.0.2）；</li>
<li>观察日志出现 <code>Processing: ai-answer (ui-common)</code>；</li>
<li>发布完成后自动生成并合并 PR，回写工作流默认值与 components.json 的 current_version。</li>
</ul>
<h2 data-id="heading-14">好处与设计取舍</h2>
<ul>
<li>统一入口：一个工作流覆盖多仓库多组件的发布。</li>
<li>精准触发：仅版本变化的组件进入矩阵，节省时间与算力。</li>
<li>自动同步：发布后自动回写配置与默认值，杜绝版本 “事实与配置” 不一致。</li>
<li>配置集中：components.json 管理构建/发布命令与目录，组件可覆盖仓库默认，保持最少差异。</li>
<li>高扩展：新增组件只需改两处配置，无需动工作流逻辑。</li>
</ul>
<p>设计要点：</p>
<ul>
<li>键名映射（SAFE_NAME + <code>_VERSION</code>）保证 inputs 与组件名稳定对应；</li>
<li>jq 层级读取（组件优先、仓库兜底）降低重复配置；</li>
<li>release-info 作为 “事实记录”，update-workflow 根据事实回写配置，实现幂等与自愈。</li>
</ul>
<h2 data-id="heading-15">常见坑位与排查</h2>
<ul>
<li>键名不匹配
<ul>
<li>ai-answer 的键必须为 <code>AI_ANSWER_VERSION</code>；漏下划线或命名不一致会导致 INPUT_VER 为 null。</li>
</ul>
</li>
<li>目录错误
<ul>
<li>work_dir 用于构建，dist_dir 用于发布；两者必须存在且正确。</li>
</ul>
</li>
<li>版本写法不匹配
<ul>
<li>tsup.config.ts 必须存在形如 <code>version: "x.y.z"</code> 的明确字段；否则请改用 package.json。</li>
</ul>
</li>
<li>私有仓库
<ul>
<li>repo_private 为 true 时需配置 SSH 私钥，checkout 才能访问。</li>
</ul>
</li>
<li>npm 凭据
<ul>
<li>确保目标仓库/流水线具备 npm 发布权限（token 或 OIDC）。</li>
</ul>
</li>
<li>组织变量
<ul>
<li><code>vars.GIT_REPO</code> 必须指向组织路径（如 <code>github.com/&lt;org&gt;</code>），否则 checkout 失败。</li>
</ul>
</li>
<li>适配脚本
<ul>
<li><code>adapter_script</code> 仅在特殊仓库需要（如 coco-app），默认关闭避免误改。</li>
</ul>
</li>
</ul>
<h2 data-id="heading-16">小结</h2>
<ul>
<li>这套流水线以 “版本变化” 为核心驱动力，结合集中配置、自动回写与 PR，构建出稳健、可扩展的多组件发布通道。</li>
<li>新增组件的心智负担被压缩为 “加配置 + 加输入键”，其余交给 CI 自动完成。</li>
<li>对于多个组件分布在多仓库的场景，这是一个低成本、高收益的发布实践。</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[你是怎么理解ES6中Proxy的？使用场景有哪些?]]></title>    <link>https://juejin.cn/post/7591744411739291648</link>    <guid>https://juejin.cn/post/7591744411739291648</guid>    <pubDate>2026-01-06T01:48:13.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591744411739291648" data-draft-id="7591744411739258880" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" 你是怎么理解ES6中Proxy的？使用场景有哪些?"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-06T01:48:13.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="大知闲闲i"/> <meta itemprop="url" content="https://juejin.cn/user/3799545205237111"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             你是怎么理解ES6中Proxy的？使用场景有哪些?
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3799545205237111/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    大知闲闲i
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-06T01:48:13.000Z" title="Tue Jan 06 2026 01:48:13 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    28
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、Proxy 的核心概念</h2>
<h3 data-id="heading-1">定义与本质</h3>
<p>Proxy（代理）是 ES6 引入的元编程特性，用于创建对象的代理，从而<strong>拦截并自定义对象的基本操作</strong>。这些操作包括属性访问、赋值、枚举、函数调用等。</p>
<h3 data-id="heading-2">元编程的意义</h3>
<ul>
<li>
<p><strong>元编程</strong>是指程序能够编写、操作其他程序（或自身）的编程范式</p>
</li>
<li>
<p>Proxy 允许在语言层面修改默认行为，无需修改源代码</p>
</li>
<li>
<p>优势：提高开发效率，增加程序灵活度，实现动态行为控制</p>
</li>
</ul>
<h3 data-id="heading-3">基本语法</h3>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">proxy</span> = new Proxy(target, handler)<span class="hljs-comment">;</span>
</code></pre>
<ul>
<li>
<p><code>target</code>：要包装的目标对象</p>
</li>
<li>
<p><code>handler</code>：包含拦截器（traps）的对象</p>
</li>
</ul>
<h2 data-id="heading-4">二、核心拦截器详解</h2>
<h3 data-id="heading-5">1. get() - 拦截属性读取</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> handler = {
  <span class="hljs-title function_">get</span>(<span class="hljs-params">target, property, receiver</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`读取属性: <span class="hljs-subst">${property}</span>`</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">get</span>(target, property, receiver);
  }
};
​
<span class="hljs-keyword">const</span> proxy = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Proxy</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">'张三'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">25</span> }, handler);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(proxy.<span class="hljs-property">name</span>); <span class="hljs-comment">// 输出: 读取属性: name → 张三</span>
</code></pre>
<p><strong>特殊应用 - 数组负索引访问：</strong></p>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">createNegativeArray</span> = (arr) =&gt; new Proxy(arr, {
  get(target, index, receiver) {
    const <span class="hljs-attr">idx</span> = parseInt(index)<span class="hljs-comment">;</span>
    if (idx &lt; 0) {
      return target<span class="hljs-section">[target.length + idx]</span><span class="hljs-comment">;</span>
    }
    return Reflect.get(target, index, receiver)<span class="hljs-comment">;</span>
  }
})<span class="hljs-comment">;</span>
​
const <span class="hljs-attr">arr</span> = createNegativeArray([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>])<span class="hljs-comment">;</span>
console.log(arr<span class="hljs-section">[-1]</span>)<span class="hljs-comment">; // 4</span>
console.log(arr<span class="hljs-section">[-2]</span>)<span class="hljs-comment">; // 3</span>
</code></pre>
<h3 data-id="heading-6">2. set() - 拦截属性赋值</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">createValidatedObject</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Proxy</span>({}, {
    <span class="hljs-title function_">set</span>(<span class="hljs-params">target, property, value, receiver</span>) {
      <span class="hljs-comment">// 年龄验证：必须是 0-150 之间的整数</span>
      <span class="hljs-keyword">if</span> (property === <span class="hljs-string">'age'</span>) {
        <span class="hljs-keyword">if</span> (!<span class="hljs-title class_">Number</span>.<span class="hljs-title function_">isInteger</span>(value) || value &lt; <span class="hljs-number">0</span> || value &gt; <span class="hljs-number">150</span>) {
          <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'年龄必须为 0-150 之间的整数'</span>);
        }
      }
      
      <span class="hljs-comment">// 邮箱格式验证</span>
      <span class="hljs-keyword">if</span> (property === <span class="hljs-string">'email'</span>) {
        <span class="hljs-keyword">const</span> emailRegex = <span class="hljs-regexp">/^[^\s@]+@[^\s@]+\.[^\s@]+$/</span>;
        <span class="hljs-keyword">if</span> (!emailRegex.<span class="hljs-title function_">test</span>(value)) {
          <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'邮箱格式不正确'</span>);
        }
      }
      
      <span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">set</span>(target, property, value, receiver);
    }
  });
};
​
<span class="hljs-keyword">const</span> user = <span class="hljs-title function_">createValidatedObject</span>();
user.<span class="hljs-property">age</span> = <span class="hljs-number">25</span>;     <span class="hljs-comment">// 成功</span>
user.<span class="hljs-property">age</span> = <span class="hljs-number">200</span>;    <span class="hljs-comment">// 抛出错误</span>
</code></pre>
<h3 data-id="heading-7">3. deleteProperty() - 拦截删除操作</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">createProtectedObject</span> = (<span class="hljs-params">obj</span>) =&gt; {
  <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">PROTECTED_PROPS</span> = [<span class="hljs-string">'id'</span>, <span class="hljs-string">'createdAt'</span>];
  
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Proxy</span>(obj, {
    <span class="hljs-title function_">deleteProperty</span>(<span class="hljs-params">target, property</span>) {
      <span class="hljs-keyword">if</span> (<span class="hljs-variable constant_">PROTECTED_PROPS</span>.<span class="hljs-title function_">includes</span>(property)) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">`属性 "<span class="hljs-subst">${property}</span>" 受保护，不可删除`</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
      }
      
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`删除属性: <span class="hljs-subst">${property}</span>`</span>);
      <span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">deleteProperty</span>(target, property);
    }
  });
};
​
<span class="hljs-keyword">const</span> data = <span class="hljs-title function_">createProtectedObject</span>({ <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'张三'</span>, <span class="hljs-attr">createdAt</span>: <span class="hljs-string">'2024-01-01'</span> });
<span class="hljs-keyword">delete</span> data.<span class="hljs-property">name</span>;     <span class="hljs-comment">// 成功</span>
<span class="hljs-keyword">delete</span> data.<span class="hljs-property">id</span>;       <span class="hljs-comment">// 警告：属性 "id" 受保护，不可删除</span>
</code></pre>
<h3 data-id="heading-8">4. apply() - 拦截函数调用</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">createLoggingFunction</span> = (<span class="hljs-params">fn</span>) =&gt; {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Proxy</span>(fn, {
    <span class="hljs-title function_">apply</span>(<span class="hljs-params">target, thisArg, argumentsList</span>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`调用函数: <span class="hljs-subst">${target.name}</span>`</span>);
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'参数:'</span>, argumentsList);
      <span class="hljs-keyword">const</span> start = performance.<span class="hljs-title function_">now</span>();
      <span class="hljs-keyword">const</span> result = <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">apply</span>(target, thisArg, argumentsList);
      <span class="hljs-keyword">const</span> end = performance.<span class="hljs-title function_">now</span>();
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`执行时间: <span class="hljs-subst">${end - start}</span>ms`</span>);
      <span class="hljs-keyword">return</span> result;
    }
  });
};
​
<span class="hljs-keyword">const</span> calculateSum = <span class="hljs-title function_">createLoggingFunction</span>(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> a + b);
<span class="hljs-title function_">calculateSum</span>(<span class="hljs-number">5</span>, <span class="hljs-number">3</span>);
<span class="hljs-comment">// 输出:</span>
<span class="hljs-comment">// 调用函数: calculateSum</span>
<span class="hljs-comment">// 参数: [5, 3]</span>
<span class="hljs-comment">// 执行时间: 0.05ms</span>
<span class="hljs-comment">// 返回: 8</span>
</code></pre>
<h3 data-id="heading-9">5. 其他常用拦截器</h3>
<ul>
<li>
<p><code>construct()</code>：拦截 <code>new</code> 操作符</p>
</li>
<li>
<p><code>has()</code>：拦截 <code>in</code> 操作符</p>
</li>
<li>
<p><code>ownKeys()</code>：拦截 <code>Object.getOwnPropertyNames()</code> 等</p>
</li>
<li>
<p><code>getPrototypeOf()</code>：拦截 <code>Object.getPrototypeOf()</code></p>
</li>
</ul>
<h2 data-id="heading-10">三、Reflect API 的配合使用</h2>
<p>Reflect 提供了与 Proxy 拦截器一一对应的静态方法，用于执行默认操作：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> proxy = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Proxy</span>({}, {
  <span class="hljs-title function_">get</span>(<span class="hljs-params">target, property, receiver</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`访问属性: <span class="hljs-subst">${property}</span>`</span>);
    <span class="hljs-comment">// 使用 Reflect 执行默认的 get 操作</span>
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">get</span>(target, property, receiver);
  },
  
  <span class="hljs-title function_">set</span>(<span class="hljs-params">target, property, value, receiver</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`设置属性: <span class="hljs-subst">${property}</span> = <span class="hljs-subst">${value}</span>`</span>);
    <span class="hljs-comment">// 使用 Reflect 执行默认的 set 操作</span>
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">set</span>(target, property, value, receiver);
  }
});
</code></pre>
<h2 data-id="heading-11">四、实际应用场景</h2>
<h3 data-id="heading-12">1. 数据验证与格式化</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">createValidatedForm</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Proxy</span>({}, {
    <span class="hljs-title function_">set</span>(<span class="hljs-params">target, property, value</span>) {
      <span class="hljs-comment">// 电话号码格式化和验证</span>
      <span class="hljs-keyword">if</span> (property === <span class="hljs-string">'phone'</span>) {
        <span class="hljs-keyword">const</span> cleaned = value.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/\D/g</span>, <span class="hljs-string">''</span>);
        <span class="hljs-keyword">if</span> (cleaned.<span class="hljs-property">length</span> !== <span class="hljs-number">11</span>) {
          <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'电话号码必须为11位数字'</span>);
        }
        value = cleaned.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/(\d{3})(\d{4})(\d{4})/</span>, <span class="hljs-string">'$1-$2-$3'</span>);
      }
      
      <span class="hljs-comment">// 日期格式化</span>
      <span class="hljs-keyword">if</span> (property === <span class="hljs-string">'birthday'</span> &amp;&amp; value <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Date</span>) {
        value = value.<span class="hljs-title function_">toISOString</span>().<span class="hljs-title function_">split</span>(<span class="hljs-string">'T'</span>)[<span class="hljs-number">0</span>];
      }
      
      <span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">set</span>(target, property, value);
    }
  });
};
</code></pre>
<h3 data-id="heading-13">2. 私有属性保护</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">createPrivateAPI</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">const</span> privateData = {
    <span class="hljs-attr">_apiKey</span>: <span class="hljs-string">'secret-key-12345'</span>,
    <span class="hljs-attr">_tokens</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>()
  };
  
  <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">PUBLIC_METHODS</span> = [<span class="hljs-string">'fetchData'</span>, <span class="hljs-string">'submitData'</span>];
  <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">PRIVATE_PROPS</span> = [<span class="hljs-string">'_apiKey'</span>, <span class="hljs-string">'_tokens'</span>];
  
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Proxy</span>(privateData, {
    <span class="hljs-title function_">get</span>(<span class="hljs-params">target, property</span>) {
      <span class="hljs-keyword">if</span> (<span class="hljs-variable constant_">PRIVATE_PROPS</span>.<span class="hljs-title function_">includes</span>(property)) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`无权访问私有属性: <span class="hljs-subst">${property}</span>`</span>);
      }
      
      <span class="hljs-keyword">if</span> (<span class="hljs-variable constant_">PUBLIC_METHODS</span>.<span class="hljs-title function_">includes</span>(property)) {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span>(<span class="hljs-params">...args</span>) {
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`调用 <span class="hljs-subst">${property}</span>，使用密钥: <span class="hljs-subst">${privateData._apiKey.slice(<span class="hljs-number">0</span>, <span class="hljs-number">5</span>)}</span>...`</span>);
          <span class="hljs-comment">// 实际的方法实现</span>
        };
      }
      
      <span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">get</span>(target, property);
    },
    
    <span class="hljs-title function_">set</span>(<span class="hljs-params">target, property, value</span>) {
      <span class="hljs-keyword">if</span> (<span class="hljs-variable constant_">PRIVATE_PROPS</span>.<span class="hljs-title function_">includes</span>(property)) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`无权修改私有属性: <span class="hljs-subst">${property}</span>`</span>);
      }
      <span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">set</span>(target, property, value);
    },
    
    <span class="hljs-title function_">ownKeys</span>(<span class="hljs-params">target</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(target).<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">key</span> =&gt;</span> !<span class="hljs-variable constant_">PRIVATE_PROPS</span>.<span class="hljs-title function_">includes</span>(key));
    }
  });
};
</code></pre>
<h3 data-id="heading-14">3. 实现观察者模式</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">createObservable</span> = (<span class="hljs-params">initialState = {}</span>) =&gt; {
  <span class="hljs-keyword">const</span> observers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>();
  
  <span class="hljs-keyword">const</span> observable = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Proxy</span>(initialState, {
    <span class="hljs-title function_">set</span>(<span class="hljs-params">target, property, value, receiver</span>) {
      <span class="hljs-keyword">const</span> oldValue = target[property];
      <span class="hljs-keyword">const</span> result = <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">set</span>(target, property, value, receiver);
      
      <span class="hljs-comment">// 值发生变化时通知所有观察者</span>
      <span class="hljs-keyword">if</span> (oldValue !== value) {
        observers.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">observer</span> =&gt;</span> {
          <span class="hljs-title function_">observer</span>(property, oldValue, value);
        });
      }
      
      <span class="hljs-keyword">return</span> result;
    }
  });
  
  <span class="hljs-keyword">return</span> {
    observable,
    <span class="hljs-attr">subscribe</span>: <span class="hljs-function">(<span class="hljs-params">observer</span>) =&gt;</span> {
      observers.<span class="hljs-title function_">add</span>(observer);
      <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> observers.<span class="hljs-title function_">delete</span>(observer);
    },
    <span class="hljs-attr">unsubscribe</span>: <span class="hljs-function">(<span class="hljs-params">observer</span>) =&gt;</span> observers.<span class="hljs-title function_">delete</span>(observer)
  };
};
​
<span class="hljs-comment">// 使用示例</span>
<span class="hljs-keyword">const</span> { observable, subscribe } = <span class="hljs-title function_">createObservable</span>({ <span class="hljs-attr">count</span>: <span class="hljs-number">0</span> });
​
<span class="hljs-comment">// 订阅状态变化</span>
<span class="hljs-keyword">const</span> unsubscribe = <span class="hljs-title function_">subscribe</span>(<span class="hljs-function">(<span class="hljs-params">key, oldValue, newValue</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${key}</span> 从 <span class="hljs-subst">${oldValue}</span> 变为 <span class="hljs-subst">${newValue}</span>`</span>);
});
​
observable.<span class="hljs-property">count</span> = <span class="hljs-number">1</span>; <span class="hljs-comment">// 输出: count 从 0 变为 1</span>
observable.<span class="hljs-property">count</span> = <span class="hljs-number">2</span>; <span class="hljs-comment">// 输出: count 从 1 变为 2</span>
​
<span class="hljs-comment">// 取消订阅</span>
<span class="hljs-title function_">unsubscribe</span>();
observable.<span class="hljs-property">count</span> = <span class="hljs-number">3</span>; <span class="hljs-comment">// 无输出</span>
</code></pre>
<h3 data-id="heading-15">4. API 请求拦截与缓存</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">createCachedAPI</span> = (<span class="hljs-params">apiClient</span>) =&gt; {
  <span class="hljs-keyword">const</span> cache = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();
  
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Proxy</span>(apiClient, {
    <span class="hljs-title function_">apply</span>(<span class="hljs-params">target, thisArg, argumentsList</span>) {
      <span class="hljs-keyword">const</span> [endpoint, params] = argumentsList;
      <span class="hljs-keyword">const</span> cacheKey = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({ endpoint, params });
      
      <span class="hljs-comment">// 检查缓存</span>
      <span class="hljs-keyword">if</span> (cache.<span class="hljs-title function_">has</span>(cacheKey)) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`从缓存读取: <span class="hljs-subst">${endpoint}</span>`</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(cache.<span class="hljs-title function_">get</span>(cacheKey));
      }
      
      <span class="hljs-comment">// 执行实际请求</span>
      <span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">apply</span>(target, thisArg, argumentsList)
        .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> {
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`缓存响应: <span class="hljs-subst">${endpoint}</span>`</span>);
          cache.<span class="hljs-title function_">set</span>(cacheKey, response);
          <span class="hljs-keyword">return</span> response;
        });
    }
  });
};
</code></pre>
<h3 data-id="heading-16">5. 性能监控与分析</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">createProfiledObject</span> = (<span class="hljs-params">obj</span>) =&gt; {
  <span class="hljs-keyword">const</span> accessStats = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();
  
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Proxy</span>(obj, {
    <span class="hljs-title function_">get</span>(<span class="hljs-params">target, property</span>) {
      <span class="hljs-comment">// 记录访问统计</span>
      <span class="hljs-keyword">const</span> count = accessStats.<span class="hljs-title function_">get</span>(property) || <span class="hljs-number">0</span>;
      accessStats.<span class="hljs-title function_">set</span>(property, count + <span class="hljs-number">1</span>);
      
      <span class="hljs-comment">// 记录访问时间</span>
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">time</span>(<span class="hljs-string">`访问 <span class="hljs-subst">${property}</span>`</span>);
      <span class="hljs-keyword">const</span> result = <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">get</span>(target, property);
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">timeEnd</span>(<span class="hljs-string">`访问 <span class="hljs-subst">${property}</span>`</span>);
      
      <span class="hljs-keyword">return</span> result;
    },
    
    <span class="hljs-comment">// 获取性能报告</span>
    <span class="hljs-title function_">getStats</span>(<span class="hljs-params"/>) {
      <span class="hljs-keyword">return</span> <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(accessStats.<span class="hljs-title function_">entries</span>())
        .<span class="hljs-title function_">sort</span>(<span class="hljs-function">(<span class="hljs-params">[, a], [, b]</span>) =&gt;</span> b - a)
        .<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">[prop, count]</span>) =&gt;</span> ({ <span class="hljs-attr">property</span>: prop, <span class="hljs-attr">accessCount</span>: count }));
    }
  });
};
</code></pre>
<h2 data-id="heading-17">五、注意事项与最佳实践</h2>
<h3 data-id="heading-18">1. 性能考虑</h3>
<ul>
<li>
<p>Proxy 会引入额外的性能开销，在性能敏感场景需谨慎使用</p>
</li>
<li>
<p>避免在频繁调用的热路径中使用复杂的代理逻辑</p>
</li>
</ul>
<h3 data-id="heading-19">2. 透明性原则</h3>
<ul>
<li>
<p>确保代理对象的行为与原始对象保持一致</p>
</li>
<li>
<p>避免违反使用者的预期行为</p>
</li>
</ul>
<h3 data-id="heading-20">3. 错误处理</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">createSafeProxy</span> = (<span class="hljs-params">target</span>) =&gt; {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Proxy</span>(target, {
    <span class="hljs-title function_">get</span>(<span class="hljs-params">target, property</span>) {
      <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">get</span>(target, property);
      } <span class="hljs-keyword">catch</span> (error) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`访问属性 <span class="hljs-subst">${property}</span> 失败:`</span>, error);
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>; <span class="hljs-comment">// 或返回默认值</span>
      }
    }
  });
};
</code></pre>
<h3 data-id="heading-21">4. 撤销代理</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> { proxy, revoke } = <span class="hljs-title class_">Proxy</span>.<span class="hljs-title function_">revocable</span>({}, {
  <span class="hljs-title function_">get</span>(<span class="hljs-params">target, property</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-string">`访问 <span class="hljs-subst">${property}</span>`</span>;
  }
});
​
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(proxy.<span class="hljs-property">message</span>); <span class="hljs-comment">// "访问 message"</span>
<span class="hljs-title function_">revoke</span>(); <span class="hljs-comment">// 撤销代理</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(proxy.<span class="hljs-property">message</span>); <span class="hljs-comment">// TypeError: Cannot perform 'get' on a proxy that has been revoked</span>
</code></pre>
<h2 data-id="heading-22">六、总结</h2>
<p>ES6 Proxy 是一个强大的元编程工具，它允许开发者：</p>
<ul>
<li>
<p><strong>拦截和自定义对象操作</strong>，实现高级抽象</p>
</li>
<li>
<p><strong>增强代码的安全性</strong>，通过验证和保护机制</p>
</li>
<li>
<p><strong>实现复杂的编程模式</strong>，如观察者、缓存、AOP等</p>
</li>
<li>
<p><strong>提高代码的可维护性</strong>，通过关注点分离</p>
</li>
</ul>
<p>在实际应用中，Proxy 特别适合以下场景：</p>
<ol>
<li>
<p>数据验证和格式化</p>
</li>
<li>
<p>访问控制和权限管理</p>
</li>
<li>
<p>缓存和性能优化</p>
</li>
<li>
<p>监控和日志记录</p>
</li>
<li>
<p>API 封装和适配</p>
</li>
</ol>
<p>合理使用 Proxy 可以显著提升代码的灵活性和可维护性，但也要注意其性能影响和复杂性成本。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[内网环境下 Web 离线地图的实现方案与合规性探讨]]></title>    <link>https://juejin.cn/post/7592164124659630130</link>    <guid>https://juejin.cn/post/7592164124659630130</guid>    <pubDate>2026-01-07T02:19:21.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592164124659630130" data-draft-id="7592176349712810022" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="内网环境下 Web 离线地图的实现方案与合规性探讨"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-07T02:19:21.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="三小河"/> <meta itemprop="url" content="https://juejin.cn/user/4222562141210478"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            内网环境下 Web 离线地图的实现方案与合规性探讨
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4222562141210478/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    三小河
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-07T02:19:21.000Z" title="Wed Jan 07 2026 02:19:21 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在政企内网、涉密园区、封闭办公区等无法访问外网的场景中，基于高德、百度等商业地图 API 的 Web 地图方案往往无法落地 —— 这类 API 的 Key 校验、瓦片加载等核心环节均依赖外网访问。本文将详细介绍基于开源瓦片数据 + Leaflet 的 Web 离线地图实现方案，并重点探讨该方案的法律风险与使用注意事项。</p>
<h2 data-id="heading-0">一、技术实现方案</h2>
<h3 data-id="heading-1">1. 核心思路</h3>
<p>离线地图的核心是摆脱对商业地图 API 外网服务的依赖，通过以下步骤实现：</p>
<ol>
<li>下载开源地图瓦片数据（卫星图、标注层）；</li>
<li>将瓦片数据部署到内网存储（本地项目 / MinIO / 内网服务器）；</li>
<li>基于 Leaflet 加载内网瓦片，实现地图展示、打点、画线等核心功能。</li>
</ol>
<h3 data-id="heading-2">2. 瓦片数据准备</h3>
<h4 data-id="heading-3">（1）数据下载工具</h4>
<p>推荐使用「全能地图下载器」或「水经注地图下载器」，这类工具支持：</p>
<ul>
<li>选择地图层级（建议 1-10 级，层级越高数据量越大）；</li>
<li>框选下载区域（如全国、某省份）；</li>
<li>导出瓦片为<code>{z}/{x}/{y}.jpg/png</code>格式（符合 Leaflet 瓦片加载规范）。</li>
</ul>
<h4 data-id="heading-4">（2）数据存储方式</h4>
<ul>
<li><strong>轻量场景</strong>：层级≤5、区域较小的瓦片，可直接放入前端项目的<code>public</code>目录；</li>
<li><strong>中大型场景</strong>：层级高、区域大的瓦片，建议部署到 MinIO（内网对象存储）或内网 HTTP 服务器，通过内网地址访问。</li>
</ul>
<h3 data-id="heading-5">3. 前端核心实现（Vue+Leaflet）</h3>
<p>以下是完整的离线地图实现代码，包含地图初始化、多图层切换、点位标记、弹窗交互等核心功能
vue</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"offline-map-container"</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 地图容器 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"mapContainer"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"map-container"</span> /&gt;</span>
    <span class="hljs-comment">&lt;!-- 图层切换控件 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"controls"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"switchLayer('satellite')"</span>&gt;</span>卫星图<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"switchLayer('hybrid')"</span>&gt;</span>混合模式<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"switchLayer('overlay')"</span>&gt;</span>仅标注<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> L <span class="hljs-keyword">from</span> <span class="hljs-string">'leaflet'</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">'leaflet/dist/leaflet.css'</span>
<span class="hljs-comment">// 自定义标记图标（需自行准备）</span>
<span class="hljs-keyword">import</span> blueIcon <span class="hljs-keyword">from</span> <span class="hljs-string">'@/assets/map/marker-icon.png'</span>
<span class="hljs-keyword">import</span> redIcon <span class="hljs-keyword">from</span> <span class="hljs-string">'@/assets/map/marker-icon-red.png'</span>
<span class="hljs-keyword">import</span> shadowIcon <span class="hljs-keyword">from</span> <span class="hljs-string">'@/assets/map/marker-shadow.png'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">name</span>: <span class="hljs-string">'OfflineMap'</span>,
  <span class="hljs-title function_">data</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">map</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-attr">satelliteLayer</span>: <span class="hljs-literal">null</span>, <span class="hljs-comment">// 卫星图图层</span>
      <span class="hljs-attr">overlayLayer</span>: <span class="hljs-literal">null</span>,   <span class="hljs-comment">// 标注图层</span>
      <span class="hljs-attr">currentLayerType</span>: <span class="hljs-string">'hybrid'</span>, <span class="hljs-comment">// 默认混合图层</span>
      <span class="hljs-attr">chinaCenter</span>: [<span class="hljs-number">35.8617</span>, <span class="hljs-number">104.1954</span>], <span class="hljs-comment">// 中国地理中心点</span>
      <span class="hljs-attr">defaultZoom</span>: <span class="hljs-number">6</span>, <span class="hljs-comment">// 默认缩放级别</span>
      <span class="hljs-comment">// 模拟点位数据（实际可替换为业务数据）</span>
      <span class="hljs-attr">markerDataList</span>: [
        { <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'北京'</span>, <span class="hljs-attr">lat</span>: <span class="hljs-number">39.9042</span>, <span class="hljs-attr">lng</span>: <span class="hljs-number">116.4074</span>, <span class="hljs-attr">desc</span>: <span class="hljs-string">'中国首都，政治文化中心'</span> },
        { <span class="hljs-attr">id</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'上海'</span>, <span class="hljs-attr">lat</span>: <span class="hljs-number">31.2304</span>, <span class="hljs-attr">lng</span>: <span class="hljs-number">121.4737</span>, <span class="hljs-attr">desc</span>: <span class="hljs-string">'国际化大都市，经济中心'</span> },
        { <span class="hljs-attr">id</span>: <span class="hljs-number">3</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'广州'</span>, <span class="hljs-attr">lat</span>: <span class="hljs-number">23.1291</span>, <span class="hljs-attr">lng</span>: <span class="hljs-number">113.2644</span>, <span class="hljs-attr">desc</span>: <span class="hljs-string">'华南门户，商贸中心'</span> },
        { <span class="hljs-attr">id</span>: <span class="hljs-number">4</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'深圳'</span>, <span class="hljs-attr">lat</span>: <span class="hljs-number">22.5431</span>, <span class="hljs-attr">lng</span>: <span class="hljs-number">114.0579</span>, <span class="hljs-attr">desc</span>: <span class="hljs-string">'科技创新之都，经济特区'</span> },
        { <span class="hljs-attr">id</span>: <span class="hljs-number">5</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'成都'</span>, <span class="hljs-attr">lat</span>: <span class="hljs-number">30.5728</span>, <span class="hljs-attr">lng</span>: <span class="hljs-number">104.0668</span>, <span class="hljs-attr">desc</span>: <span class="hljs-string">'西南重镇，天府之国'</span> },
        { <span class="hljs-attr">id</span>: <span class="hljs-number">6</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'重庆'</span>, <span class="hljs-attr">lat</span>: <span class="hljs-number">29.5628</span>, <span class="hljs-attr">lng</span>: <span class="hljs-number">106.5516</span>, <span class="hljs-attr">desc</span>: <span class="hljs-string">'直辖市，山城雾都'</span> },
        { <span class="hljs-attr">id</span>: <span class="hljs-number">7</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'西安'</span>, <span class="hljs-attr">lat</span>: <span class="hljs-number">34.3416</span>, <span class="hljs-attr">lng</span>: <span class="hljs-number">108.9398</span>, <span class="hljs-attr">desc</span>: <span class="hljs-string">'十三朝古都，历史文化名城'</span> },
        { <span class="hljs-attr">id</span>: <span class="hljs-number">8</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'武汉'</span>, <span class="hljs-attr">lat</span>: <span class="hljs-number">30.5928</span>, <span class="hljs-attr">lng</span>: <span class="hljs-number">114.3055</span>, <span class="hljs-attr">desc</span>: <span class="hljs-string">'九省通衢，中部核心城市'</span> },
        { <span class="hljs-attr">id</span>: <span class="hljs-number">9</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'杭州'</span>, <span class="hljs-attr">lat</span>: <span class="hljs-number">30.2741</span>, <span class="hljs-attr">lng</span>: <span class="hljs-number">120.1551</span>, <span class="hljs-attr">desc</span>: <span class="hljs-string">'电商之都，风景旅游城市'</span> },
        { <span class="hljs-attr">id</span>: <span class="hljs-number">10</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'南京'</span>, <span class="hljs-attr">lat</span>: <span class="hljs-number">32.0603</span>, <span class="hljs-attr">lng</span>: <span class="hljs-number">118.7969</span>, <span class="hljs-attr">desc</span>: <span class="hljs-string">'六朝古都，华东重要城市'</span> }
      ],
      <span class="hljs-attr">markers</span>: [], <span class="hljs-comment">// 存储标记实例</span>
      <span class="hljs-attr">activeMarkerId</span>: <span class="hljs-literal">null</span> <span class="hljs-comment">// 当前激活的点位ID</span>
    }
  },
  <span class="hljs-title function_">mounted</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">initMap</span>()
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">initDefaultMarkers</span>()
  },
  <span class="hljs-title function_">beforeUnmount</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// 组件销毁时清理地图资源，避免内存泄漏</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">map</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">markers</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">map</span>.<span class="hljs-title function_">removeLayer</span>(item.<span class="hljs-property">marker</span>))
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">map</span>.<span class="hljs-title function_">remove</span>()
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">map</span> = <span class="hljs-literal">null</span>
    }
  },
  <span class="hljs-attr">methods</span>: {
    <span class="hljs-comment">// 初始化地图</span>
    <span class="hljs-title function_">initMap</span>(<span class="hljs-params"/>) {
      <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">$refs</span>.<span class="hljs-property">mapContainer</span>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'地图容器不存在！'</span>)
        <span class="hljs-keyword">return</span>
      }

      <span class="hljs-comment">// 创建地图实例并定位到中国中心</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">map</span> = L.<span class="hljs-title function_">map</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">$refs</span>.<span class="hljs-property">mapContainer</span>).<span class="hljs-title function_">setView</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">chinaCenter</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">defaultZoom</span>)

      <span class="hljs-comment">// 加载内网卫星图瓦片（替换为你的内网瓦片地址）</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">satelliteLayer</span> = L.<span class="hljs-title function_">tileLayer</span>(<span class="hljs-string">'#######/juicefs-vol-001/public/demo/map/satellite/{z}/{x}/{y}.jpg'</span>, {
        <span class="hljs-attr">minZoom</span>: <span class="hljs-number">1</span>,
        <span class="hljs-attr">maxZoom</span>: <span class="hljs-number">10</span>,
        <span class="hljs-attr">tileSize</span>: <span class="hljs-number">256</span>,
        <span class="hljs-attr">noWrap</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 禁止地图循环显示</span>
        <span class="hljs-attr">attribution</span>: <span class="hljs-string">'离线地图数据'</span>
      })

      <span class="hljs-comment">// 加载内网标注瓦片</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">overlayLayer</span> = L.<span class="hljs-title function_">tileLayer</span>(<span class="hljs-string">'#######/juicefs-vol-001/public/demo/map/overlay/{z}/{x}/{y}.png'</span>, {
        <span class="hljs-attr">minZoom</span>: <span class="hljs-number">1</span>,
        <span class="hljs-attr">maxZoom</span>: <span class="hljs-number">5</span>,
        <span class="hljs-attr">tileSize</span>: <span class="hljs-number">256</span>,
        <span class="hljs-attr">noWrap</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">pane</span>: <span class="hljs-string">'overlayPane'</span>, <span class="hljs-comment">// 标注层独立面板</span>
        <span class="hljs-attr">opacity</span>: <span class="hljs-number">0.8</span>, <span class="hljs-comment">// 标注透明度</span>
        <span class="hljs-attr">attribution</span>: <span class="hljs-string">''</span>
      })

      <span class="hljs-comment">// 默认显示混合图层（卫星图+标注）</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">satelliteLayer</span>.<span class="hljs-title function_">addTo</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">map</span>)
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">overlayLayer</span>.<span class="hljs-title function_">addTo</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">map</span>)

      <span class="hljs-comment">// 添加比例尺控件</span>
      L.<span class="hljs-property">control</span>.<span class="hljs-title function_">scale</span>().<span class="hljs-title function_">addTo</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">map</span>)

      <span class="hljs-comment">// 瓦片加载失败处理</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">satelliteLayer</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">'tileerror'</span>, <span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">'卫星图瓦片加载失败:'</span>, error)
      })
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">overlayLayer</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">'tileerror'</span>, <span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">'标注瓦片加载失败:'</span>, error)
      })
    },

    <span class="hljs-comment">// 初始化点位标记</span>
    <span class="hljs-title function_">initDefaultMarkers</span>(<span class="hljs-params"/>) {
      <span class="hljs-comment">// 定义默认图标和激活态图标</span>
      <span class="hljs-keyword">const</span> defaultIcon = L.<span class="hljs-title function_">icon</span>({
        <span class="hljs-attr">iconUrl</span>: blueIcon,
        <span class="hljs-attr">shadowUrl</span>: shadowIcon,
        <span class="hljs-attr">iconSize</span>: [<span class="hljs-number">25</span>, <span class="hljs-number">41</span>],
        <span class="hljs-attr">iconAnchor</span>: [<span class="hljs-number">12</span>, <span class="hljs-number">41</span>],
        <span class="hljs-attr">popupAnchor</span>: [<span class="hljs-number">1</span>, -<span class="hljs-number">34</span>]
      })

      <span class="hljs-keyword">const</span> activeRedIcon = L.<span class="hljs-title function_">icon</span>({
        <span class="hljs-attr">iconUrl</span>: redIcon,
        <span class="hljs-attr">shadowUrl</span>: shadowIcon,
        <span class="hljs-attr">iconSize</span>: [<span class="hljs-number">25</span>, <span class="hljs-number">41</span>],
        <span class="hljs-attr">iconAnchor</span>: [<span class="hljs-number">12</span>, <span class="hljs-number">41</span>],
        <span class="hljs-attr">popupAnchor</span>: [<span class="hljs-number">1</span>, -<span class="hljs-number">34</span>]
      })

      <span class="hljs-comment">// 遍历创建点位标记</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">markerDataList</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">markerData</span> =&gt;</span> {
        <span class="hljs-keyword">const</span> marker = L.<span class="hljs-title function_">marker</span>([markerData.<span class="hljs-property">lat</span>, markerData.<span class="hljs-property">lng</span>], {
          <span class="hljs-attr">icon</span>: defaultIcon,
          <span class="hljs-attr">draggable</span>: <span class="hljs-literal">false</span> <span class="hljs-comment">// 禁止拖拽，如需开启可改为true</span>
        }).<span class="hljs-title function_">addTo</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">map</span>)

        <span class="hljs-comment">// 点位点击事件：切换激活态+显示弹窗</span>
        marker.<span class="hljs-title function_">on</span>(<span class="hljs-string">'click'</span>, <span class="hljs-function">() =&gt;</span> {
          <span class="hljs-comment">// 恢复上一个激活点位的默认样式</span>
          <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">activeMarkerId</span> !== <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">const</span> prevActiveMarker = <span class="hljs-variable language_">this</span>.<span class="hljs-property">markers</span>.<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item.<span class="hljs-property">id</span> === <span class="hljs-variable language_">this</span>.<span class="hljs-property">activeMarkerId</span>)
            <span class="hljs-keyword">if</span> (prevActiveMarker) {
              prevActiveMarker.<span class="hljs-property">marker</span>.<span class="hljs-title function_">setIcon</span>(defaultIcon)
            }
          }

          <span class="hljs-comment">// 设置当前点位为激活态</span>
          marker.<span class="hljs-title function_">setIcon</span>(activeRedIcon)
          <span class="hljs-variable language_">this</span>.<span class="hljs-property">activeMarkerId</span> = markerData.<span class="hljs-property">id</span>

          <span class="hljs-comment">// 绑定并打开自定义弹窗</span>
          marker.<span class="hljs-title function_">bindPopup</span>(<span class="hljs-string">`
            &lt;div class="marker-popup"&gt;
              &lt;h3 style="margin:0 0 8px 0; color:#e53935;"&gt;<span class="hljs-subst">${markerData.name}</span>&lt;/h3&gt;
              &lt;p style="margin:4px 0;"&gt;经纬度：<span class="hljs-subst">${markerData.lat.toFixed(<span class="hljs-number">4</span>)}</span>, <span class="hljs-subst">${markerData.lng.toFixed(<span class="hljs-number">4</span>)}</span>&lt;/p&gt;
              &lt;p style="margin:4px 0;"&gt;详情：<span class="hljs-subst">${markerData.desc}</span>&lt;/p&gt;
            &lt;/div&gt;
          `</span>).<span class="hljs-title function_">openPopup</span>()
        })

        <span class="hljs-comment">// 存储点位实例，方便后续管理</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">markers</span>.<span class="hljs-title function_">push</span>({
          <span class="hljs-attr">id</span>: markerData.<span class="hljs-property">id</span>,
          <span class="hljs-attr">marker</span>: marker,
          <span class="hljs-attr">data</span>: markerData
        })
      })
    },

    <span class="hljs-comment">// 切换地图图层</span>
    <span class="hljs-title function_">switchLayer</span>(<span class="hljs-params">type</span>) {
      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">currentLayerType</span> === type) <span class="hljs-keyword">return</span>

      <span class="hljs-comment">// 移除所有瓦片图层</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">map</span>.<span class="hljs-title function_">eachLayer</span>(<span class="hljs-function">(<span class="hljs-params">layer</span>) =&gt;</span> {
        <span class="hljs-keyword">if</span> (layer <span class="hljs-keyword">instanceof</span> L.<span class="hljs-property">TileLayer</span>) {
          <span class="hljs-variable language_">this</span>.<span class="hljs-property">map</span>.<span class="hljs-title function_">removeLayer</span>(layer)
        }
      })

      <span class="hljs-comment">// 根据类型添加对应图层</span>
      <span class="hljs-keyword">switch</span> (type) {
        <span class="hljs-keyword">case</span> <span class="hljs-string">'satellite'</span>:
          <span class="hljs-variable language_">this</span>.<span class="hljs-property">satelliteLayer</span>.<span class="hljs-title function_">addTo</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">map</span>)
          <span class="hljs-keyword">break</span>
        <span class="hljs-keyword">case</span> <span class="hljs-string">'overlay'</span>:
          <span class="hljs-variable language_">this</span>.<span class="hljs-property">overlayLayer</span>.<span class="hljs-title function_">addTo</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">map</span>)
          <span class="hljs-keyword">break</span>
        <span class="hljs-keyword">case</span> <span class="hljs-string">'hybrid'</span>:
          <span class="hljs-variable language_">this</span>.<span class="hljs-property">satelliteLayer</span>.<span class="hljs-title function_">addTo</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">map</span>)
          <span class="hljs-variable language_">this</span>.<span class="hljs-property">overlayLayer</span>.<span class="hljs-title function_">addTo</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">map</span>)
          <span class="hljs-keyword">break</span>
      }

      <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentLayerType</span> = type
    }
  }
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="css">
<span class="hljs-selector-class">.offline-map-container</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">100vh</span>;
  <span class="hljs-attribute">position</span>: relative;
}

<span class="hljs-selector-class">.map-container</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
}

<span class="hljs-selector-class">.controls</span> {
  <span class="hljs-attribute">position</span>: absolute;
  <span class="hljs-attribute">top</span>: <span class="hljs-number">10px</span>;
  <span class="hljs-attribute">right</span>: <span class="hljs-number">10px</span>;
  <span class="hljs-attribute">z-index</span>: <span class="hljs-number">1000</span>;
  <span class="hljs-attribute">background</span>: white;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">10px</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">5px</span>;
  <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">2px</span> <span class="hljs-number">10px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.2</span>);
}

<span class="hljs-selector-class">.controls</span> <span class="hljs-selector-tag">button</span> {
  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> <span class="hljs-number">5px</span>;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">5px</span> <span class="hljs-number">10px</span>;
  <span class="hljs-attribute">cursor</span>: pointer;
  <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#ccc</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">4px</span>;
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#fff</span>;
  <span class="hljs-attribute">transition</span>: all <span class="hljs-number">0.2s</span>;
}

<span class="hljs-selector-class">.controls</span> <span class="hljs-selector-tag">button</span><span class="hljs-selector-pseudo">:hover</span> {
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#f5f5f5</span>;
  <span class="hljs-attribute">border-color</span>: <span class="hljs-number">#999</span>;
}

<span class="hljs-comment">/* 美化Leaflet弹窗样式 */</span>
:<span class="hljs-built_in">deep</span>(.leaflet-popup-content-wrapper) {
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">8px</span>;
  <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">3px</span> <span class="hljs-number">10px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.15</span>);
}

:<span class="hljs-built_in">deep</span>(.leaflet-popup-content) {
  <span class="hljs-attribute">margin</span>: <span class="hljs-number">12px</span> <span class="hljs-number">16px</span>;
  <span class="hljs-attribute">width</span>: <span class="hljs-number">220px</span> <span class="hljs-meta">!important</span>;
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</code></pre>
<p>效果如下</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/de71f0cdfa37441a950a004533beb80a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiJ5bCP5rKz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768357160&amp;x-signature=VFnqlhQ9cU2aTtfcIjCkGF2qVDY%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dd3c4812d7644084b524166999161053~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiJ5bCP5rKz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768357160&amp;x-signature=LNvV1OqdCDPuvACt3nIoYhLtAxo%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-6">当然也支持 地图打点自定义组件 和 画线</h3>
<pre><code class="hljs language-js" lang="js">
&lt;template&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"offline-map-container"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"mapContainer"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"map-container"</span> /&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"controls"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"switchLayer('satellite')"</span>&gt;</span>卫星图<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"switchLayer('hybrid')"</span>&gt;</span>混合模式<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"switchLayer('overlay')"</span>&gt;</span>仅标注<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
&lt;/template&gt;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Vue</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> L <span class="hljs-keyword">from</span> <span class="hljs-string">'leaflet'</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">'leaflet/dist/leaflet.css'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">MapMarker</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./MapMarker.vue'</span> <span class="hljs-comment">// 确保路径正确</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">name</span>: <span class="hljs-string">'OfflineMap'</span>,
  <span class="hljs-title function_">data</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">map</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-attr">satelliteLayer</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-attr">overlayLayer</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-attr">currentLayerType</span>: <span class="hljs-string">'hybrid'</span>,
      <span class="hljs-attr">chinaCenter</span>: [<span class="hljs-number">35.8617</span>, <span class="hljs-number">104.1954</span>],
      <span class="hljs-attr">defaultZoom</span>: <span class="hljs-number">5</span>,
      <span class="hljs-attr">markerDataList</span>: [
        { <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'北京'</span>, <span class="hljs-attr">lat</span>: <span class="hljs-number">39.9042</span>, <span class="hljs-attr">lng</span>: <span class="hljs-number">116.4074</span>, <span class="hljs-attr">desc</span>: <span class="hljs-string">'中国首都'</span> },
        { <span class="hljs-attr">id</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'上海'</span>, <span class="hljs-attr">lat</span>: <span class="hljs-number">31.2304</span>, <span class="hljs-attr">lng</span>: <span class="hljs-number">121.4737</span>, <span class="hljs-attr">desc</span>: <span class="hljs-string">'经济中心'</span> },
        { <span class="hljs-attr">id</span>: <span class="hljs-number">3</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'广州'</span>, <span class="hljs-attr">lat</span>: <span class="hljs-number">23.1291</span>, <span class="hljs-attr">lng</span>: <span class="hljs-number">113.2644</span>, <span class="hljs-attr">desc</span>: <span class="hljs-string">'华南门户'</span> },
        { <span class="hljs-attr">id</span>: <span class="hljs-number">4</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'深圳'</span>, <span class="hljs-attr">lat</span>: <span class="hljs-number">22.5431</span>, <span class="hljs-attr">lng</span>: <span class="hljs-number">114.0579</span>, <span class="hljs-attr">desc</span>: <span class="hljs-string">'科技创新之都'</span> },
        { <span class="hljs-attr">id</span>: <span class="hljs-number">5</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'成都'</span>, <span class="hljs-attr">lat</span>: <span class="hljs-number">30.5728</span>, <span class="hljs-attr">lng</span>: <span class="hljs-number">104.0668</span>, <span class="hljs-attr">desc</span>: <span class="hljs-string">'天府之国'</span> },
        { <span class="hljs-attr">id</span>: <span class="hljs-number">6</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'重庆'</span>, <span class="hljs-attr">lat</span>: <span class="hljs-number">29.5628</span>, <span class="hljs-attr">lng</span>: <span class="hljs-number">106.5516</span>, <span class="hljs-attr">desc</span>: <span class="hljs-string">'山城雾都'</span> },
        { <span class="hljs-attr">id</span>: <span class="hljs-number">7</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'西安'</span>, <span class="hljs-attr">lat</span>: <span class="hljs-number">34.3416</span>, <span class="hljs-attr">lng</span>: <span class="hljs-number">108.9398</span>, <span class="hljs-attr">desc</span>: <span class="hljs-string">'十三朝古都'</span> },
        { <span class="hljs-attr">id</span>: <span class="hljs-number">8</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'武汉'</span>, <span class="hljs-attr">lat</span>: <span class="hljs-number">30.5928</span>, <span class="hljs-attr">lng</span>: <span class="hljs-number">114.3055</span>, <span class="hljs-attr">desc</span>: <span class="hljs-string">'九省通衢'</span> },
        { <span class="hljs-attr">id</span>: <span class="hljs-number">9</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'杭州'</span>, <span class="hljs-attr">lat</span>: <span class="hljs-number">30.2741</span>, <span class="hljs-attr">lng</span>: <span class="hljs-number">120.1551</span>, <span class="hljs-attr">desc</span>: <span class="hljs-string">'电商之都'</span> },
        { <span class="hljs-attr">id</span>: <span class="hljs-number">10</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'南京'</span>, <span class="hljs-attr">lat</span>: <span class="hljs-number">32.0603</span>, <span class="hljs-attr">lng</span>: <span class="hljs-number">118.7969</span>, <span class="hljs-attr">desc</span>: <span class="hljs-string">'六朝古都'</span> }
      ],
      <span class="hljs-attr">markers</span>: [],
      <span class="hljs-attr">lines</span>: [], <span class="hljs-comment">// 存储线段实例</span>
      <span class="hljs-attr">activeMarkerId</span>: <span class="hljs-literal">null</span>
    }
  },
  <span class="hljs-title function_">mounted</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">initMap</span>()
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">initDefaultMarkers</span>()
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">initPolylines</span>() <span class="hljs-comment">// 初始化各种样式的线</span>
  },
  <span class="hljs-title function_">beforeUnmount</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">map</span>) {
      <span class="hljs-comment">// 销毁 Vue 实例，防止内存泄漏</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">markers</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> {
        <span class="hljs-keyword">if</span> (item.<span class="hljs-property">vueInstance</span>) item.<span class="hljs-property">vueInstance</span>.$destroy()
      })
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">map</span>.<span class="hljs-title function_">remove</span>()
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">map</span> = <span class="hljs-literal">null</span>
    }
  },
  <span class="hljs-attr">methods</span>: {
    <span class="hljs-title function_">initMap</span>(<span class="hljs-params"/>) {
      <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">$refs</span>.<span class="hljs-property">mapContainer</span>) <span class="hljs-keyword">return</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">map</span> = L.<span class="hljs-title function_">map</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">$refs</span>.<span class="hljs-property">mapContainer</span>).<span class="hljs-title function_">setView</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">chinaCenter</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">defaultZoom</span>)

      <span class="hljs-comment">// 离线瓦片图层</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">satelliteLayer</span> = L.<span class="hljs-title function_">tileLayer</span>(<span class="hljs-string">'##########/juicefs-vol-001/public/demo/map/satellite/{z}/{x}/{y}.jpg'</span>, {
        <span class="hljs-attr">minZoom</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">maxZoom</span>: <span class="hljs-number">10</span>, <span class="hljs-attr">tileSize</span>: <span class="hljs-number">256</span>, <span class="hljs-attr">noWrap</span>: <span class="hljs-literal">true</span>
      })
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">overlayLayer</span> = L.<span class="hljs-title function_">tileLayer</span>(<span class="hljs-string">'##########/juicefs-vol-001/public/demo/map/overlay/{z}/{x}/{y}.png'</span>, {
        <span class="hljs-attr">minZoom</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">maxZoom</span>: <span class="hljs-number">5</span>, <span class="hljs-attr">tileSize</span>: <span class="hljs-number">256</span>, <span class="hljs-attr">noWrap</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">pane</span>: <span class="hljs-string">'overlayPane'</span>
      })

      <span class="hljs-variable language_">this</span>.<span class="hljs-property">satelliteLayer</span>.<span class="hljs-title function_">addTo</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">map</span>)
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">overlayLayer</span>.<span class="hljs-title function_">addTo</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">map</span>)
      L.<span class="hljs-property">control</span>.<span class="hljs-title function_">scale</span>().<span class="hljs-title function_">addTo</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">map</span>)
    },

    <span class="hljs-title function_">initDefaultMarkers</span>(<span class="hljs-params"/>) {
      <span class="hljs-keyword">const</span> <span class="hljs-title class_">MarkerConstructor</span> = <span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">extend</span>(<span class="hljs-title class_">MapMarker</span>)

      <span class="hljs-variable language_">this</span>.<span class="hljs-property">markerDataList</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">markerData</span> =&gt;</span> {
        <span class="hljs-comment">// 创建并挂载 Vue 组件</span>
        <span class="hljs-keyword">const</span> instance = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MarkerConstructor</span>({
          <span class="hljs-attr">propsData</span>: { <span class="hljs-attr">name</span>: markerData.<span class="hljs-property">name</span>, <span class="hljs-attr">active</span>: <span class="hljs-literal">false</span> }
        }).$mount()

        <span class="hljs-comment">// 使用 L.divIcon 承载 Vue 组件的 DOM</span>
        <span class="hljs-keyword">const</span> icon = L.<span class="hljs-title function_">divIcon</span>({
          <span class="hljs-attr">html</span>: instance.<span class="hljs-property">$el</span>,
          <span class="hljs-attr">className</span>: <span class="hljs-string">'custom-leaflet-icon'</span>, <span class="hljs-comment">// 必须在 CSS 中重置样式</span>
          <span class="hljs-attr">iconSize</span>: [<span class="hljs-number">30</span>, <span class="hljs-number">30</span>],
          <span class="hljs-attr">iconAnchor</span>: [<span class="hljs-number">15</span>, <span class="hljs-number">15</span>]
        })

        <span class="hljs-keyword">const</span> marker = L.<span class="hljs-title function_">marker</span>([markerData.<span class="hljs-property">lat</span>, markerData.<span class="hljs-property">lng</span>], { icon }).<span class="hljs-title function_">addTo</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">map</span>)

        marker.<span class="hljs-title function_">on</span>(<span class="hljs-string">'click'</span>, <span class="hljs-function">() =&gt;</span> {
          <span class="hljs-comment">// 切换状态逻辑</span>
          <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">activeMarkerId</span> !== <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">const</span> prev = <span class="hljs-variable language_">this</span>.<span class="hljs-property">markers</span>.<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">m</span> =&gt;</span> m.<span class="hljs-property">id</span> === <span class="hljs-variable language_">this</span>.<span class="hljs-property">activeMarkerId</span>)
            <span class="hljs-keyword">if</span> (prev) prev.<span class="hljs-property">vueInstance</span>.<span class="hljs-property">active</span> = <span class="hljs-literal">false</span>
          }
          instance.<span class="hljs-property">active</span> = <span class="hljs-literal">true</span>
          <span class="hljs-variable language_">this</span>.<span class="hljs-property">activeMarkerId</span> = markerData.<span class="hljs-property">id</span>

          marker.<span class="hljs-title function_">bindPopup</span>(<span class="hljs-string">`&lt;b&gt;<span class="hljs-subst">${markerData.name}</span>&lt;/b&gt;&lt;br&gt;<span class="hljs-subst">${markerData.desc}</span>`</span>).<span class="hljs-title function_">openPopup</span>()
        })

        <span class="hljs-variable language_">this</span>.<span class="hljs-property">markers</span>.<span class="hljs-title function_">push</span>({ <span class="hljs-attr">id</span>: markerData.<span class="hljs-property">id</span>, marker, <span class="hljs-attr">vueInstance</span>: instance })
      })
    },

    <span class="hljs-title function_">initPolylines</span>(<span class="hljs-params"/>) {
      <span class="hljs-keyword">const</span> <span class="hljs-title function_">getPos</span> = (<span class="hljs-params">id</span>) =&gt; {
        <span class="hljs-keyword">const</span> d = <span class="hljs-variable language_">this</span>.<span class="hljs-property">markerDataList</span>.<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">m</span> =&gt;</span> m.<span class="hljs-property">id</span> === id)
        <span class="hljs-keyword">return</span> [d.<span class="hljs-property">lat</span>, d.<span class="hljs-property">lng</span>]
      }

      <span class="hljs-comment">// 1. 普通白色实线 (北京 - 南京)</span>
      L.<span class="hljs-title function_">polyline</span>([<span class="hljs-title function_">getPos</span>(<span class="hljs-number">1</span>), <span class="hljs-title function_">getPos</span>(<span class="hljs-number">10</span>)], {
        <span class="hljs-attr">color</span>: <span class="hljs-string">'white'</span>, <span class="hljs-attr">weight</span>: <span class="hljs-number">3</span>, <span class="hljs-attr">opacity</span>: <span class="hljs-number">0.6</span>
      }).<span class="hljs-title function_">addTo</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">map</span>)

      <span class="hljs-comment">// 2. 红色虚线 (上海 - 杭州)</span>
      L.<span class="hljs-title function_">polyline</span>([<span class="hljs-title function_">getPos</span>(<span class="hljs-number">2</span>), <span class="hljs-title function_">getPos</span>(<span class="hljs-number">9</span>)], {
        <span class="hljs-attr">color</span>: <span class="hljs-string">'#ff5252'</span>, <span class="hljs-attr">weight</span>: <span class="hljs-number">3</span>, <span class="hljs-attr">dashArray</span>: <span class="hljs-string">'10, 10'</span>
      }).<span class="hljs-title function_">addTo</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">map</span>)

      <span class="hljs-comment">// 3. 蓝色流光动画线 (西安 - 武汉 - 广州)</span>
      L.<span class="hljs-title function_">polyline</span>([<span class="hljs-title function_">getPos</span>(<span class="hljs-number">7</span>), <span class="hljs-title function_">getPos</span>(<span class="hljs-number">8</span>), <span class="hljs-title function_">getPos</span>(<span class="hljs-number">3</span>)], {
        <span class="hljs-attr">color</span>: <span class="hljs-string">'#00e5ff'</span>,
        <span class="hljs-attr">weight</span>: <span class="hljs-number">4</span>,
        <span class="hljs-attr">dashArray</span>: <span class="hljs-string">'15, 15'</span>,
        <span class="hljs-attr">className</span>: <span class="hljs-string">'polyline-path-flow'</span> <span class="hljs-comment">// 对应 CSS 动画</span>
      }).<span class="hljs-title function_">addTo</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">map</span>)

      <span class="hljs-comment">// 4. 黄色宽线 (成都 - 重庆)</span>
      L.<span class="hljs-title function_">polyline</span>([<span class="hljs-title function_">getPos</span>(<span class="hljs-number">5</span>), <span class="hljs-title function_">getPos</span>(<span class="hljs-number">6</span>)], {
        <span class="hljs-attr">color</span>: <span class="hljs-string">'#ffeb3b'</span>, <span class="hljs-attr">weight</span>: <span class="hljs-number">8</span>, <span class="hljs-attr">opacity</span>: <span class="hljs-number">0.3</span>
      }).<span class="hljs-title function_">addTo</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">map</span>)
    },

    <span class="hljs-title function_">switchLayer</span>(<span class="hljs-params">type</span>) {
      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">currentLayerType</span> === type) <span class="hljs-keyword">return</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">map</span>.<span class="hljs-title function_">eachLayer</span>(<span class="hljs-function"><span class="hljs-params">layer</span> =&gt;</span> {
        <span class="hljs-keyword">if</span> (layer <span class="hljs-keyword">instanceof</span> L.<span class="hljs-property">TileLayer</span>) <span class="hljs-variable language_">this</span>.<span class="hljs-property">map</span>.<span class="hljs-title function_">removeLayer</span>(layer)
      })
      <span class="hljs-keyword">if</span> (type === <span class="hljs-string">'satellite'</span> || type === <span class="hljs-string">'hybrid'</span>) <span class="hljs-variable language_">this</span>.<span class="hljs-property">satelliteLayer</span>.<span class="hljs-title function_">addTo</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">map</span>)
      <span class="hljs-keyword">if</span> (type === <span class="hljs-string">'overlay'</span> || type === <span class="hljs-string">'hybrid'</span>) <span class="hljs-variable language_">this</span>.<span class="hljs-property">overlayLayer</span>.<span class="hljs-title function_">addTo</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">map</span>)
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentLayerType</span> = type
    }
  }
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="css">
<span class="hljs-selector-class">.offline-map-container</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">100vh</span>;
  <span class="hljs-attribute">position</span>: relative;
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#001529</span>;
  <span class="hljs-comment">/* 深色底色让线条更明显 */</span>
}

<span class="hljs-selector-class">.map-container</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
}

<span class="hljs-selector-class">.controls</span> {
  <span class="hljs-attribute">position</span>: absolute;
  <span class="hljs-attribute">top</span>: <span class="hljs-number">10px</span>;
  <span class="hljs-attribute">right</span>: <span class="hljs-number">10px</span>;
  <span class="hljs-attribute">z-index</span>: <span class="hljs-number">1000</span>;
  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0.9</span>);
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">10px</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">4px</span>;
}

<span class="hljs-comment">/* 关键：重置 Leaflet divIcon 的默认样式 */</span>
:<span class="hljs-built_in">deep</span>(.custom-leaflet-icon) {
  <span class="hljs-attribute">background</span>: transparent <span class="hljs-meta">!important</span>;
  <span class="hljs-attribute">border</span>: none <span class="hljs-meta">!important</span>;
}

<span class="hljs-comment">/* 线条流光动画 */</span>
:<span class="hljs-built_in">deep</span>(.polyline-path-flow) {
  stroke-dasharray: <span class="hljs-number">20</span>, <span class="hljs-number">20</span>;
  <span class="hljs-attribute">animation</span>: line-flow <span class="hljs-number">10s</span> linear infinite;
}

<span class="hljs-keyword">@keyframes</span> line-flow {
  <span class="hljs-selector-tag">from</span> {
    stroke-dashoffset: <span class="hljs-number">400</span>;
  }

  <span class="hljs-selector-tag">to</span> {
    stroke-dashoffset: <span class="hljs-number">0</span>;
  }
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>

</span></code></pre>
<pre><code class="hljs language-js" lang="js">
&lt;template&gt;
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"custom-marker"</span> <span class="hljs-attr">:class</span>=<span class="hljs-string">"{ 'is-active': active }"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"marker-container"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"marker-icon"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>{{ name[0] }}<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"marker-shadow"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
&lt;/template&gt;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
    <span class="hljs-attr">props</span>: [<span class="hljs-string">'name'</span>, <span class="hljs-string">'active'</span>]
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="css">
<span class="hljs-selector-class">.custom-marker</span> {
    <span class="hljs-attribute">width</span>: <span class="hljs-number">30px</span>;
    <span class="hljs-attribute">height</span>: <span class="hljs-number">30px</span>;
    <span class="hljs-attribute">cursor</span>: pointer;
}

<span class="hljs-selector-class">.marker-container</span> {
    <span class="hljs-attribute">position</span>: relative;
    <span class="hljs-attribute">display</span>: flex;
    <span class="hljs-attribute">justify-content</span>: center;
}

<span class="hljs-selector-class">.marker-icon</span> {
    <span class="hljs-attribute">width</span>: <span class="hljs-number">30px</span>;
    <span class="hljs-attribute">height</span>: <span class="hljs-number">30px</span>;
    <span class="hljs-attribute">background</span>: <span class="hljs-number">#2196f3</span>;
    <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">50%</span> <span class="hljs-number">50%</span> <span class="hljs-number">50%</span> <span class="hljs-number">0</span>;
    <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">rotate</span>(-<span class="hljs-number">45deg</span>);
    <span class="hljs-attribute">display</span>: flex;
    <span class="hljs-attribute">align-items</span>: center;
    <span class="hljs-attribute">justify-content</span>: center;
    <span class="hljs-attribute">color</span>: white;
    <span class="hljs-attribute">border</span>: <span class="hljs-number">2px</span> solid white;
    <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">2px</span> <span class="hljs-number">5px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.3</span>);
    <span class="hljs-attribute">transition</span>: all <span class="hljs-number">0.3s</span>;
}

<span class="hljs-selector-class">.marker-icon</span> <span class="hljs-selector-tag">span</span> {
    <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">rotate</span>(<span class="hljs-number">45deg</span>);
    <span class="hljs-attribute">font-size</span>: <span class="hljs-number">12px</span>;
    <span class="hljs-attribute">font-weight</span>: bold;
}

<span class="hljs-comment">/* 激活状态样式 */</span>
<span class="hljs-selector-class">.is-active</span> <span class="hljs-selector-class">.marker-icon</span> {
    <span class="hljs-attribute">background</span>: <span class="hljs-number">#e53935</span>;
    <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">rotate</span>(-<span class="hljs-number">45deg</span>) <span class="hljs-built_in">scale</span>(<span class="hljs-number">1.2</span>);
}

<span class="hljs-comment">/* 呼吸动画 */</span>
<span class="hljs-selector-class">.is-active</span> <span class="hljs-selector-class">.marker-shadow</span> {
    <span class="hljs-attribute">position</span>: absolute;
    <span class="hljs-attribute">top</span>: <span class="hljs-number">50%</span>;
    <span class="hljs-attribute">left</span>: <span class="hljs-number">50%</span>;
    <span class="hljs-attribute">width</span>: <span class="hljs-number">20px</span>;
    <span class="hljs-attribute">height</span>: <span class="hljs-number">20px</span>;
    <span class="hljs-attribute">margin-left</span>: -<span class="hljs-number">10px</span>;
    <span class="hljs-attribute">margin-top</span>: -<span class="hljs-number">10px</span>;
    <span class="hljs-attribute">background</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">229</span>, <span class="hljs-number">57</span>, <span class="hljs-number">53</span>, <span class="hljs-number">0.4</span>);
    <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">50%</span>;
    <span class="hljs-attribute">animation</span>: pulse <span class="hljs-number">1.5s</span> infinite;
}

<span class="hljs-keyword">@keyframes</span> pulse {
    <span class="hljs-number">0%</span> {
        <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">scale</span>(<span class="hljs-number">1</span>);
        <span class="hljs-attribute">opacity</span>: <span class="hljs-number">1</span>;
    }

    <span class="hljs-number">100%</span> {
        <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">scale</span>(<span class="hljs-number">3</span>);
        <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0</span>;
    }
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span></span>

</code></pre>
<p>效果如下</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f6d9d7c8fa6d4062a843b7d3fdd1764f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiJ5bCP5rKz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768357160&amp;x-signature=qDbWd0tOu4tD0rezFpHi2pDZjks%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-7">4. 核心功能说明</h3>
<ul>
<li><strong>多图层切换</strong>：支持卫星图、标注层、混合模式三种图层切换；</li>
<li><strong>点位标记</strong>：自定义图标样式，点击点位切换激活态并显示详情弹窗；</li>
<li><strong>资源清理</strong>：组件销毁时清理地图实例和标记，避免内存泄漏；</li>
<li><strong>异常处理</strong>：添加瓦片加载失败监听，便于排查内网瓦片访问问题。</li>
</ul>
<h2 data-id="heading-8">二、法律风险与使用注意事项</h2>
<p>离线地图方案虽能解决内网使用需求，但地图数据涉及测绘、地理信息安全等敏感领域，<strong>切勿 “拿来主义”</strong> ，需重点关注以下合规要求：</p>
<h3 data-id="heading-9">1. 核心法律风险</h3>
<h4 data-id="heading-10">（1）测绘资质合规风险</h4>
<p>根据《中华人民共和国测绘法》，地图数据属于测绘成果，未经许可下载、使用、传播测绘成果可能涉嫌违法：</p>
<ul>
<li>禁止使用无合法来源的地图瓦片数据；</li>
<li>企业若自行采集、处理地理信息数据，需取得对应的测绘资质；</li>
<li>严禁下载、使用涉密地理信息（如军事禁区、重要设施坐标）。</li>
</ul>
<h4 data-id="heading-11">（2）数据来源合规风险</h4>
<ul>
<li>避免使用盗版下载工具获取地图数据；</li>
<li>拒绝使用未经授权的商业地图瓦片（如高德、百度未授权的离线瓦片），否则可能涉及著作权侵权；</li>
<li>优先选择有合法授权的开源地图数据（如 OpenStreetMap），并遵守其使用协议。</li>
</ul>
<h4 data-id="heading-12">（3）数据使用范围风险</h4>
<ul>
<li>离线地图数据仅限<strong>内网自用</strong>，禁止对外提供、传播或用于商业盈利；</li>
<li>若涉及国境线、行政区域划分等敏感内容，需确保数据符合国家测绘标准，避免出现 “问题地图”。</li>
</ul>
<h3 data-id="heading-13">2. 合规使用建议</h3>
<ol>
<li>
<p><strong>数据来源审核</strong>：</p>
<ul>
<li>确认地图瓦片数据的合法授权，保留授权文件；</li>
<li>优先使用国家测绘局认可的地图数据，避免使用境外未经审核的地图数据。</li>
</ul>
</li>
<li>
<p><strong>使用范围管控</strong>：</p>
<ul>
<li>在内网部署时设置访问权限，仅限授权人员使用；</li>
<li>明确数据使用目的，仅用于企业内部业务，不扩散、不商用。</li>
</ul>
</li>
<li>
<p><strong>合规审查</strong>：</p>
<ul>
<li>涉及敏感区域（如边境、军事区）的地图数据，需提交测绘主管部门审查；</li>
<li>企业建立地图数据使用台账，记录数据来源、使用范围、责任人。</li>
</ul>
</li>
<li>
<p><strong>替代方案</strong>：</p>
<ul>
<li>若有条件，优先采购有内网部署授权的商业地图服务（如高德 / 百度的内网地图解决方案），降低合规风险；</li>
<li>对于非核心场景，可使用开源地图框架（如 Leaflet+OpenStreetMap）的合规瓦片，避免法律风险。</li>
</ul>
</li>
</ol>
<h2 data-id="heading-14">三、总结</h2>
<p>内网 Web 离线地图的实现核心是 “开源瓦片 + Leaflet”，该方案能有效解决外网依赖问题，但<strong>法律合规是前提</strong>。总结核心要点：</p>
<ol>
<li>技术层面：通过下载瓦片、内网部署、Leaflet 加载，可快速实现离线地图的展示、打点、画线等功能；</li>
<li>合规层面：严禁无授权使用地图数据，避免 “问题地图”，仅限内网自用，不扩散、不商用；</li>
<li>风险管控：优先选择合法授权的数据来源，涉及敏感内容需提交审查，降低法律风险。</li>
</ol>
<p>在实际落地中，需平衡技术实现与合规要求，切勿因追求功能而忽视地理信息安全与法律规定，确保离线地图的使用符合国家法律法规和企业合规要求。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Head First 单例模式]]></title>    <link>https://juejin.cn/post/7592251792650977307</link>    <guid>https://juejin.cn/post/7592251792650977307</guid>    <pubDate>2026-01-07T02:08:18.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592251792650977307" data-draft-id="7591681023907233801" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Head First 单例模式"/> <meta itemprop="keywords" content="后端,设计模式"/> <meta itemprop="datePublished" content="2026-01-07T02:08:18.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="用户9381691255360"/> <meta itemprop="url" content="https://juejin.cn/user/3485906645565271"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Head First 单例模式
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3485906645565271/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    用户9381691255360
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-07T02:08:18.000Z" title="Wed Jan 07 2026 02:08:18 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、定义</h2>
<p>单例模式：确保一个类只有一个实例，并提供一个全局访问点。<br/>
来看看下面的类图：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9914cd356b15469f8bd3adea4aa00bd5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3OTM4MTY5MTI1NTM2MA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768356498&amp;x-signature=00g9SVUY9uTQJFVeJcR1e9K%2FaNo%3D" alt="singleton.png" loading="lazy"/></p>
<p><strong>单例模式有三种不同的实现，应对不同的场景</strong></p>
<h4 data-id="heading-1">1、懒汉式（也叫延迟实例化）</h4>
<p><strong>为什么叫懒汉式？</strong><br/>
因为类实例化的代码是在运行时真正用到的时候才执行的。就好像人不会提前准备好，等用到的时候才着手干。</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">LazySingleton</span> {

    <span class="hljs-comment">/**
     * 静态的变量，持有LazySingleton的实例
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> LazySingleton instance;

    <span class="hljs-comment">/**
     * 私有构造方法
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-title">LazySingleton</span>()</span> {}

    <span class="hljs-comment">/**
     * 这个方法是线程不安全的
     * @return
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> LazySingleton <span class="hljs-title">getInstance</span>()</span> {
        <span class="hljs-keyword">if</span> (instance == <span class="hljs-literal">null</span>) {
            instance = <span class="hljs-keyword">new</span> LazySingleton();
        }
        <span class="hljs-keyword">return</span> instance;
    }
}
</code></pre>
<blockquote>
<p>在上述代码中，实现了懒汉式的单例模式。但是它<strong>不是线程安全</strong>的。当在多线程环境下运行时，可能导致会有多个实例对象。</p>
</blockquote>
<h2 data-id="heading-2">下面就要将上述代码改造成线程安全的。</h2>
<blockquote>
<p><strong>第一种方法：使用同步锁synchronized</strong><br/>
通过增加syncronized关键字到getInstance方法中，迫使每个线程在进入这个方法之前，要先等候别的线程离开该方法。</p>
</blockquote>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">SafeLazySingleton</span> {

    <span class="hljs-comment">/**
     * 静态的变量，持有SafeLazySingleton的实例
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> SafeLazySingleton instance;

    <span class="hljs-comment">/**
     * 私有构造方法
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-title">SafeLazySingleton</span>()</span> {}

    <span class="hljs-comment">/**
     * 这个方法通过使用同步锁synchronized确保是线程安全的，但是会导致性能降低
     * @return
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> synchronized SafeLazySingleton <span class="hljs-title">getInstance</span>()</span> {
        <span class="hljs-keyword">if</span> (instance == <span class="hljs-literal">null</span>) {
            instance = <span class="hljs-keyword">new</span> SafeLazySingleton();
        }
        <span class="hljs-keyword">return</span> instance;
    }
}
</code></pre>
<blockquote>
<p><strong>第二种方法：在JVM初次加载类时就完成实例化</strong><br/>
依赖JVM在加载这个类时马上创建唯一的单件实例。JVM保证在任何线程访问instance静态变量之前，一定先创建此实例。</p>
</blockquote>
<h4 data-id="heading-3">2、饿汉式</h4>
<p><strong>为什么叫饿汉式？</strong><br/>
不是在需要时才创建实例，而是在JVM加载类时马上创建实例，表现出非常急切的状态。就像人饿久了就会非常急切的想吃饭一样。</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">HungrySingleton</span> {
    <span class="hljs-comment">// 在静态初始化器中创建单件。这行代码保证了线程安全</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> HungrySingleton instance = <span class="hljs-keyword">new</span> HungrySingleton();

    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-title">HungrySingleton</span>()</span> {}

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> HungrySingleton <span class="hljs-title">getInstance</span>()</span> {
        <span class="hljs-keyword">return</span> instance;
    }
}
</code></pre>
<blockquote>
<p><strong>第三种方法：使用双重检查加锁</strong><br/>
利用双重检查加锁，首先检查是否实例已经创建了，如果尚未创建，才进行同步。这样一来，只会第一次同步。</p>
</blockquote>
<h4 data-id="heading-4">3、双重检查加锁</h4>
<p>指的是：volatile关键字和同步锁synchronized<br/>
volatile关键字确保当instance变量被初始化成Singleton实例时，多个线程正确的处理instance变量。
synchronized关键字确保多线程同步执行。</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">DoubleCheckLockSingleton</span> {

    <span class="hljs-comment">// 使用volatile关键字确保instance是线程安全的</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">volatile</span> DoubleCheckLockSingleton instance;
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-title">DoubleCheckLockSingleton</span>()</span> {}

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> DoubleCheckLockSingleton <span class="hljs-title">getInstance</span>()</span> {
        <span class="hljs-keyword">if</span> (instance == <span class="hljs-literal">null</span>) {
            <span class="hljs-comment">// 只有在instance是null的时候才会进入使用同步锁</span>
            synchronized (DoubleCheckLockSingleton.<span class="hljs-keyword">class</span>) {
                <span class="hljs-keyword">if</span> (instance == <span class="hljs-literal">null</span>) {
                    instance = <span class="hljs-keyword">new</span> DoubleCheckLockSingleton();
                }
            }
        }
        <span class="hljs-keyword">return</span> instance;
    }
}
</code></pre>





























<table><thead><tr><th>线程安全方式</th><th>优点</th><th>缺点</th><th>使用场景</th></tr></thead><tbody><tr><td>synchronized关键字</td><td>简单又有效的实现线程安全</td><td>严重降低性能。其实只有第一次调用getInstance方法时才真正需要同步。一旦设置好instance变量，就不需要同步了。但是现状是每次调用都会同步</td><td>应用程序可以接受synchronized带来的额外负担，并且genInstance方法并不会被频繁调用</td></tr><tr><td>饿汉式单例</td><td>线程安全</td><td>过早的创建实例，如果实例一直没有被用到或者实例占用资源很大，容易造成资源浪费</td><td>1. 应用程序总是创建并使用单件实例。2. 应用程序在创建和运行时方面的负担不太繁重，想要急切的创建单件实例。</td></tr><tr><td>双重检查加锁</td><td>1. 线程安全。2. 只有第一次访问时会使用syncronized锁，所以并不会降低性能。</td><td>代码实现比前两种复杂</td><td>任何需要单例类的场景中</td></tr></tbody></table>
<h2 data-id="heading-5">二、使用场景</h2>
<h3 data-id="heading-6">1、SpringBoot中的单例模式</h3>
<p>在SpringBoot中，单例模式是依赖注入容器默认管理Bean的方式，通过@Service、@Component等注解标记的类会被自动注册为单例Bean，确保在整个应用上下文中仅存在一个实例。<br/>
<strong>实现方式与默认行为</strong>：SpringBoot使用IoC容器管理Bean的生命周期，默认作用域为单例。例如：使用@Service注解的类：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GreetingServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">GreetingService</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">greet</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> name</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"Hello, "</span> + name + <span class="hljs-string">"!"</span>;
    }
}
</code></pre>
<p>通过@Autowired注入时，无论在多少个组件中使用，获取的都是同一个实例。<br/>
<strong>线程安全与最佳实践</strong>：单例Bean必须是<strong>无状态的</strong>，避免在实例中保存用户相关数据，否则可能引发线程安全问题。正确做法是将状态存储在方法参数或者局部变量中，而非成员变量。<br/>
<strong>自定义作用域与延迟加载</strong>：虽然默认为单例，但可通过@Scope("prototype")显示指定为多例模式（每次获取新实例）。对于单例Bean，可通过使用@Lazy注解实现懒加载，延迟初始化直到首次注入时才创建实例。<br/>
<strong>与传统单例模式的区别</strong>：Spring的单例由容器管理，无需手动编写getInstance方法或同步锁，简化了代码并避免了线程安全问题，同时提供了更灵活的配置选项。</p>
<h2 data-id="heading-7">三、分布式架构中如何使用单例模式？如何确保全局只有一个实例？</h2>
<p>在分布式系统中，单例模式的核心目标是确保某个类在整个系统中只有一个实例。例如，你可能需要一个全局的ID生成器、配置管理中心或任务调度器。但分布式环境的跨节点特性使得传统单例（例如Java JVM内的单例）失效。因为每个节点可以独自加载类并创建实例。因此，需要借助外部协调机制来实现全局唯一性。<br/>
<strong>分布式单例的核心就是把单例的控制权从单JVM延伸到多JVM。</strong><br/>
以下是几种主流的解决方案：</p>
<p><strong>1. 借助外部中间件实现</strong><br/>
这是最常用、最专业的做法。思想是让一个外部系统来决定哪个实例是主实例。<br/>
<strong>1.1 使用Zookeeper/Etcd实现</strong><br/>
Zookeeper的<strong>临时节点</strong>和<strong>watch机制</strong>非常适合实现分布式锁和Leader选举。<br/>
<strong>1.2 使用Redis实现</strong>
利用Redis的<code>set key value NX PX timeout</code>命令实现分布式锁。</p>
<p><strong>2. 将单例服务化</strong><br/>
这是一种更彻底，更符合微服务架构思想的方案。</p>
<ul>
<li><strong>实现原理</strong></li>
</ul>
<ol>
<li>将需要单例的功能（例如ID生成、全局配置）独立出来，部署成一个单独的服务。</li>
<li>这个服务本身可以是一个集群，但其内部状态是统一的（例如：ID生成器使用数据库序列号或者Redis原子操作）。</li>
<li>其他所有服务都通过RPC或http来调用这个单一的服务，从而在逻辑上保证了单例效果。</li>
</ol>
<p>参考文章：<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fyitiaoxianyuyu%2Farticle%2Fdetails%2F155395663" target="_blank" title="https://blog.csdn.net/yitiaoxianyuyu/article/details/155395663" ref="nofollow noopener noreferrer">blog.csdn.net/yitiaoxiany…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Apache Hudi 在京东的最新架构演进]]></title>    <link>https://juejin.cn/post/7592088192516980779</link>    <guid>https://juejin.cn/post/7592088192516980779</guid>    <pubDate>2026-01-07T02:19:10.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592088192516980779" data-draft-id="7592069113223053331" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Apache Hudi 在京东的最新架构演进"/> <meta itemprop="keywords" content="架构"/> <meta itemprop="datePublished" content="2026-01-07T02:19:10.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="京东零售技术"/> <meta itemprop="url" content="https://juejin.cn/user/4233576972293643"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Apache Hudi 在京东的最新架构演进
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4233576972293643/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    京东零售技术
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-07T02:19:10.000Z" title="Wed Jan 07 2026 02:19:10 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读18分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong>本文导读</strong></p>
<p>本文详细介绍京东数据湖现状、最新自研技术特性、业务实践、社区贡献与未来规划，展示京东如何通过数据湖技术推动数据资产准实时化，提升数据资产的价值。</p>
<h2 data-id="heading-0">一、京东数据湖现状</h2>
<p>京东数据湖团队近年一直在利用数据湖能力推进整个集团数据的准实时化，帮助京东零售、京东科技、京东物流等子集团的核心数据资产提升数据时效，入湖的数据规模已达到500PB以上，支撑这些的是强大的底层技术架构和平台产品能力。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d0822f5c36804dc1aa38ea4b815237af~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic6Zu25ZSu5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768357150&amp;x-signature=ZBsdNi1rfzIDhvIDkFNh7qbT%2Bj0%3D" alt="image.png" loading="lazy"/>
京东数据湖能力全景图</p>
<p>京东数据湖构建于HDFS等分布式存储系统之上，利用Hudi高性能的读写能力和文件组织来支撑准实时化加工链路，承接消息队列、Binlog、Hive、Hudi等数据源，支持高性能的流、批及OLAP查询。在底层技术之上，京东大数据平台提供全生命周期的产品能力，从表的创建、集成入湖、数据开发、任务调度，到数据查询、数据质量，到湖表替换Hive表的切换工具，通过提供相应的产品能力，来支持各个BGBU的数据团队进行准实时化改进。</p>
<p>京东Hudi基于社区0.13.1版本进行研发，旨在满足京东业务的特定需求。为此，我们在Hudi内核的组织协议层、IO传输层等多个关键模块，实施一系列自主研发的优化措施。</p>
<p><strong>组织协议层</strong></p>
<ol>
<li>
<p>索引方面，社区提供Bucket、BloomFilter等索引，京东自研分区级Bucket索引，差异化控制分区的Bucket数量，有效解决分区倾斜问题；此外创新性的自研外键索引，并基于外键索引实现流式的外键关联能力；</p>
</li>
<li>
<p>Merge Engine方面，在0.13.1中以PayLoad为主，社区提供了OverwriteWithLatest、EventTimeBased、PartialUpdate等，京东自研Multiple Ts支持多字段的合并逻辑，也对Partial Update做了增强。现在社区主推RecordMerger，后续京东也会补齐相关的实现。</p>
</li>
<li>
<p>表格式方面，社区CoW与MoR已在京东实现生产实践。社区版MoR采用Base文件与Log文件相结合的组织模式，其中Log文件以Avro格式进行行存储。京东在实际应用中发现，社区版MoR在性能方面存在一定瓶颈。为此，京东自主研发基于LSM-Tree组织协议的MoR，采用分层管理机制，所有Log文件均以Parquet格式存储，其读写性能相较社区版提升了2至10倍。</p>
</li>
<li>
<p>并发控制方面，社区提供了OCC和MVCC两种并发控制的模式， 京东自研的LSM-Tree组织协议实现了无锁并发更新的效果。</p>
</li>
<li>
<p>文件布局方面，京东自主研发混合存储的布局方案，支持将一张表的数据分布于多个存储位置。其中一部分被称为缓冲层，用于存储如deltacommit等高频写入的数据，通常选择低延迟的高性能存储系统，如HDFS或ChubaoFS；另一部分则称为持久层，缓冲层中的数据通过表服务迁移至持久层。在读取时，系统会将缓冲层与持久层的数据进行联合，生成统一的文件视图。</p>
</li>
<li>
<p>表服务方面，京东在社区版基础上实现增量式的表服务机制，有效避免因分区数量持续增长而导致的表服务耗时增加问题，从而显著降低对写入端的阻塞时间。</p>
</li>
</ol>
<p><strong>IO传输层</strong></p>
<p>IO传输层的核心优化思路是减少序列化/反序列化的开销，京东自研二进制流拷贝Clustering，跳过计算引擎与Parquet文件间的行列转换，直接进行二进制流复制实现文件聚合；利用Engine-Native优化使用计算引擎的数据格式，避免行格式间的互转；利用ZSTD降低文件压缩过程中的CPU损耗。</p>
<h2 data-id="heading-1">二、最新自研技术特性</h2>
<p><strong>01. Hudi MoR LSM-Tree</strong></p>
<p>在京东的业务实践中，随着数据规模的持续扩大与实时性要求的不断提升，Hudi MoR表在面对高并发、高吞吐的实时数据处理时，逐渐显现出多项性能与稳定性瓶颈，具体表现为：</p>
<ol>
<li>
<p>写入性能瓶颈：高流量数据写入时，MoR表执行更新需将增量数据与基础文件合并写回，难以兼顾低延迟与大吞吐量的并发写入，成为实时数据接入的关键制约。</p>
</li>
<li>
<p>索引效率低下：当采用Bucket索引且分桶数量较多时，每次写入Log文件均需频繁执行耗时的List操作，严重影响写入性能。</p>
</li>
<li>
<p>查询效率不足：底层使用的Avro行式存储格式无法有效下推查询，即使仅访问少数列也需读取整行数据，产生大量无效IO，导致查询效率低下。</p>
</li>
<li>
<p>资源竞争与运维复杂：流式任务中写操作与Compaction共享资源，相互抢占常引发作业失败，往往需独立部署Compaction作业，增加了运维复杂性与成本。</p>
</li>
<li>
<p>架构并发能力受限：缺乏并发更新能力，进行数据回溯或故障修复时必须暂停实时任务，影响业务连续性；同时受表级并发写入能力限制，同一张表的多个加工任务只能串行执行，导致数据产出延迟累积，难以满足高时效性要求。</p>
</li>
</ol>
<p>为应对京东实时数据业务，特别是流量洪峰下的实时数仓、多流融合等场景对性能、稳定性与并发处理能力提出的更高要求，京东数据湖团队基于LSM-Tree思想对Hudi进行架构升级，旨在突破现有瓶颈，更高效地支撑日益增长的实时数据业务需求。</p>
<p><strong>基本设计原则</strong></p>
<p>LSM-Tree是一种通过顺序写入和分层合并来优化读写性能的存储结构。在Hudi底层改造中，以Bucket索引为基础，将每个FileGroup内的文件组织成一棵两层LSM-Tree。新写入的数据首先进入L0层，通过两类合并（Compaction）机制提升查询效率、减轻读时合并压力：</p>
<p>Minor Compaction：用于将L0层的小文件合并为更大的L0文件，高效控制小文件数量，执行频率高且速度快。</p>
<p>Major Compaction：周期性将所有文件合并至唯一的L1层文件中，从而在保持数据全局一致性的同时，降低合并操作的执行频率。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b0944a0c34d140cf8041485eeb087c1f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic6Zu25ZSu5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768357150&amp;x-signature=kGWo0Cy%2FwBG8mQLGLveY%2FtraBNk%3D" alt="image.png" loading="lazy"/></p>
<p>在数据流转过程中，JD-Hudi采用计算引擎原生的行格式（如Spark InternalRow、Flink RowData），避免此前由于Avro序列化和反序列化操作而带来的额外开销。此外，增量更新数据以创建（Create）新Parquet文件的方式，替代原先的Log文件追加（Append），从而避免数据写入前繁重的File List操作，同时支持多任务并发更新。</p>
<p>FileSystemView构建逻辑</p>
<p>FileSystemView（以下简称FSView）是Hudi的元数据抽象层，通过提供统一的查询接口，屏蔽底层文件组织细节，使引擎能够基于逻辑视图高效构建查询分片，为快照隔离和数据一致性提供关键支撑。改造后的FSView构建逻辑可以通过以下公式表示：</p>
<p align="center">𝐹𝑆𝑉𝑖𝑒𝑤 at 𝑇=𝐶𝑜𝑚𝑚𝑖𝑡𝑒𝑑𝐿𝑜𝑔𝑠−(𝐿𝑜𝑔.</p>
<p align="center">𝑏𝑎𝑠𝑒𝐼𝑛𝑠𝑡𝑎𝑛𝑡&gt;𝑇)−(𝑅𝑒𝑝𝑙𝑎𝑐𝑒𝑑𝐿𝑜𝑔.𝑏𝑎𝑠𝑒𝐼𝑛𝑠𝑡𝑎𝑛𝑡≤𝑇 )</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/65fcde7d4fc44f699219a8fd0c71a3a0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic6Zu25ZSu5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768357150&amp;x-signature=64MCch%2BLs1T%2F9fu4ZrJ22wTQl6A%3D" alt="image.png" loading="lazy"/></p>
<p>以图中所示的多任务并发更新场景为例，所有已提交的文件包括 File 1 ～ 10 以及 File 15。在 T_i 时刻，提交时间晚于该时刻的文件为 File 15，而提交时间早于或等于该时刻且因 Compaction 操作被替代的文件为 File 1 至 File 5。因此，可根据相关公式计算得出 T_i 时刻所对应的逻辑快照视图，该视图由文件 File 6 ～ 10 构成。</p>
<p><strong>写流程设计</strong></p>
<p>以Flink流式写入为例，写流程主要包含重分区、排序、去重、IO四个核心阶段。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/daf70c87c3aa43f9b664551d2979c4ab~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic6Zu25ZSu5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768357150&amp;x-signature=CPtr5o6%2BHGtFtEaxpHHna6L4DdA%3D" alt="image.png" loading="lazy"/></p>
<ol>
<li>
<p>统一数据表示：全流程数据流转均采用Flink原生RowData格式，减轻序列化及格式转换开销。</p>
</li>
<li>
<p>均衡数据分布：针对Bucket分布不均问题，提出基于全局视角的Remote Partitioner机制，实现写入负载的动态均衡。</p>
</li>
<li>
<p>异步处理架构：在Sink算子中引入Disruptor环形队列，解耦数据生产与消费，显著提升处理性能，有效应对生产速率高于消费的场景。</p>
</li>
<li>
<p>高效内存管理：集成Flink内置MemorySegmentPool与BinaryInMemorySortBuffer，实现内存精细化管控与高效排序，大幅降低GC压力与排序开销。</p>
</li>
</ol>
<p><strong>读流程设计</strong></p>
<p>在LSM-Tree结构中，底层文件内部的数据记录都是有序的，因此高效的多路归并排序算法是提升查询性能的关键。最小堆和败者树是用于归并排序最为常用的数据结构。当合并路数（K）较大时，败者树每次调整仅需约log₂K次比较，而最小堆需要约2log₂K次，理论比较次数减少近一半，在数据流规模较大时优势明显。</p>
<p>为进一步提升合并效率，京东数据湖团队采用基于状态机的败者树实现。通过为每个节点定义明确状态（如“就绪”、“已选出”等），并在每次比较时驱动状态转换，同时动态记录相同主键对应的叶子节点索引，其好处是：</p>
<ul>
<li>避免重复调整：当识别到相同主键时，可直接基于索引复用比较过的路径，无需重新遍历树结构。</li>
<li>批量合并输出：在一次调整中，可定位并输出当前树中所有相同主键的记录，支持合并函数一次性完成聚合。</li>
<li>消除深拷贝：通过索引直接引用数据位置，无需进行对象复制，大幅降低内存与CPU开销。</li>
</ul>
<p>该方案在实际测试中带来约15%的读取性能提升，有效支撑LSM-Tree架构下高吞吐、低延迟的查询需求。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9ec591449f8442c1a5cbec0d8a1b9732~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic6Zu25ZSu5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768357150&amp;x-signature=JizmMYYghVLwGtV1TicmScnZxIg%3D" alt="image.png" loading="lazy"/></p>
<p><strong>Compaction优化</strong></p>
<p>Hudi Compaction 是面向 MoR 表设计的一项核心后台服务，其主要功能是将行式增量日志文件与列式基础文件进行合并，以生成新版、更高效的基础文件。在 Hudi-LSM Tree 的研发过程中，针对其排期阶段目前存在的性能及稳定性瓶颈，做出如下两项主要优化：</p>
<p><strong>1. 增量排期</strong></p>
<p>排期阶段主要工作是划定哪些分区的哪些File Slices将参与Compaction，然后生成一个计划（Compaction Plan）保存到Timeline。实际在这个过程中，仅需针对有新增数据的分区执行即可。然而，原有Compaction策略无论分区是否存在新数据，都会全盘扫描所有分区，导致不必要的资源消耗，且随着分区数量增加，还可能引发任务失败。为此，在LSM版本中引入了Incremental Compaction策略， 其核心工作流程如下：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3e8ef6c680df401794e74585f3997d09~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic6Zu25ZSu5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768357150&amp;x-signature=WZC0Ouduasvfiz4t0b3ZtAizgOo%3D" alt="image.png" loading="lazy"/></p>
<p>首先，将从上一次完成Compaction到当前时刻的这段时间视为一个增量窗口，在此期间通过deltacommit提交的分区，即为写入了增量数据的分区。如图中所示，若在T5时刻进行调度，则(T1, T5)即为增量窗口，其中在T2、T3时刻写入的Partition4与Partition5需纳入本次合并计划。</p>
<p>其次，需关注在上一次调度时因IO限制而未完全处理的分区，这些分区信息会被记录在Compaction plan的MissingPartitions中。如图所示，在T5时刻进行调度时，需考虑T1时刻plan中记录的Partition3。</p>
<p>此外，在并发场景下，还需考虑那些在调度时刻之前已生成但尚未完成提交的数据，相关信息保存在Compaction plan的MissingInstants中，也应在调度时予以纳入。例如，T1时刻plan中记录的T0时刻未提交的Partition1，以及在T5时刻调度时，将未完成提交的T4时刻记录至本次计划。</p>
<p>最终，在T5时刻调度中，所有需参与合并的分区包括：Partition1、Partition3、Partition4、Partition5。</p>
<p><strong>2. Flink 流式排期</strong></p>
<p>原有排期机制的执行时序设定于 Commit 操作完成后、新 Instant 生成前，且全流程均在 JobManager（JM）节点上执行。该模式存在两项突出弊端：其一，会阻塞新 Instant 的正常生成流程，进而导致数据消费链路中断；其二，若排期环节发生异常故障，将直接造成整个任务执行失败。</p>
<p>针对上述痛点问题，新采用的流式排期方案进行关键性优化调整：方案将排期核心逻辑单独抽离，封装为独立算子并部署至 TaskManager（TM）节点执行。通过架构层面的根本性优化，彻底攻克原有模式的两大核心痛点。如下图所示，为 Flink 流式排期的拓扑结构示意图。其中，获取排期分区、列出待合并文件、生成 compaction plan 等排期核心操作，均由独立算子负责执行完成。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b41f75a9b81240dcac68fe0c4a3b8f4d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic6Zu25ZSu5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768357150&amp;x-signature=kN0ETrUndZwuY2zXtef0GMo%2FdGc%3D" alt="image.png" loading="lazy"/></p>
<p><strong>Benchmark</strong></p>
<p>基于TPCDS与Nexmark标准数据集，在统一测试环境下对以下三种表格式进行benchmark评测：MoR-LSM（JD-Hudi优化版本）、MoR-Avro（JD-Hudi原生版本）与PK Table（Paimon 1.0.1），以任务执行时间或数据消费时间为评估指标，结果如下：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c65ee6c2cda747c8b5b5574575eb87a8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic6Zu25ZSu5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768357150&amp;x-signature=Mb8B6BCC7LtOn75eF7jVpnSrPkw%3D" alt="image.png" loading="lazy"/></p>
<p><strong>02. Partial Update Foreign-Key Join</strong></p>
<p><strong>业务背景</strong></p>
<p>基于前期数据资产准实时化改造，上游链路商品基础明细目前已具备准实时时效。当前需持续推进下游链路中商品宽表的准实时化改造工作。商品宽表以SKU信息为核心基础，需通过流式处理方式扩展相关维度信息，涉及非主键关联更新的场景。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/62ab7d54fe7c4fb1b3bfdad576e2e81d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic6Zu25ZSu5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768357150&amp;x-signature=yolPjF64d7VXBBQvxT19%2BD%2F5xI4%3D" alt="image.png" loading="lazy"/></p>
<p><strong>常规方案</strong></p>
<p>实时：使用Flink流式Join，海量数据场景下状态存储巨大，维护成本高、运维复杂</p>
<p>离线：定期执行Spark Join，数据时效退化为调度周期+执行时间</p>
<p>上述两种方案难以在海量数据 Join 的场景下同时保障链路的稳定性与数据的时效性。为此，京东内部设计并引入外键索引方案。</p>
<p><strong>外键索引方案</strong></p>
<p>在 Hudi 中，Partial Update 在流式主键关联场景下，能够大状态下推至存储层，从而保障实时任务的稳定性。只要具备外键索引能力，即可通过外键值高效地查询对应的主键，从而满足业务需求。</p>
<p>京东内部设计一种外键索引：具备通过外键值快速定位主键值的能力，支持并发更新操作，具备高效的点查性能，并具有可扩展性与可插拔的索引存储机制。最终的整体链路流程如下：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/51880468c0aa4937ba89c538756c7b56~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic6Zu25ZSu5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768357150&amp;x-signature=%2BTac8d0wtuGsuDC5vbHhUS50GbE%3D" alt="image.png" loading="lazy"/></p>
<p>SKU 数据流实时更新维护外键索引，并 Partial Update 下发到 Hudi 商品宽表</p>
<p>SPU 数据流实时查询外键索引，获取所有相关主键，展开后 Partial Update 下发到 Hudi 商品宽表</p>
<p>最终满足业务分钟级时效</p>
<p><strong>03. 数据湖 + AI 探索：Hudi NativeIO SDK</strong></p>
<p>当前训练引擎的 IO 层尚未具备面向数据湖的原生适配能力（即“NativeIO”能力），致使在数据读取过程中出现 IO 放大现象，序列化与反序列化的开销较高，从而进一步限制训练效率的提升。</p>
<p>随着业务场景对模型实时性与精准性要求的不断提升，亟需打通样本训练引擎与数据湖之间的直接对接通道。通过构建适配 Hudi 的 NativeIO SDK，使训练引擎能够跳过中间同步环节，直接基于 Hudi 湖表进行样本读取，深度复用数据湖在增量更新、高效过滤等方面的能力。同时，通过 NativeIO 层面的优化手段，如列式存储适配、批量数据直读以及减少数据拷贝等，有效降低 IO 损耗，从根本上提升样本数据的时效性与获取效率，从而推动模型效果的持续优化。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b99359f87b9349e08eccdfb97142f838~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic6Zu25ZSu5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768357150&amp;x-signature=KN3r%2FMSrHNL9Gx9HdxsBmoel5Rc%3D" alt="image.png" loading="lazy"/></p>
<p>京东内部 Hudi NativeIO SDK 采用分层解耦的架构设计，整体划分为数据调用层、跨语言 Transformation 层、Hudi 视图管理层以及高性能查询层四大核心模块。各模块职责明确、边界清晰，自上而下协同运作，既确保用户操作的便捷性，又实现对湖表数据的高效读取与高时效响应，最终有效支撑样本训练引擎直接对接 Hudi 湖表，实现高效训练。</p>
<p><strong>最终效果</strong></p>
<p>基于 NativeIO SDK 读取 Parquet 文件，相较于 Spark 向量化读取 Parquet 文件，性能提升约 2 倍。</p>
<p>该性能优化有效解决 AI 场景下样本引擎在数据读取环节的关键瓶颈，从而显著提升了整体处理时效。</p>
<h2 data-id="heading-2">三、业务实践</h2>
<p><strong>流量数仓ADM数据湖升级</strong></p>
<p>流量业务当前存在实时、离线两套开发链路，存在运维和开发成本高，口径不一致等问题； 离线链路各场域基于埋点数据自行加工存在口径不一致和数据存储冗余等问题；同时当前不具备满足准实时数据场景。流量业务存在如数据倾斜严重、数据规模超大、并发修数等挑战，基于数据湖Hudi建设统一流量公共层准实时链路，实时链路统一口径加工将实时数据入湖，提供准实时数据分析能力，在链路升级过程中做了大量的内核优化。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a9ad5b8b76284eec8e8540aaf2b84ea3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic6Zu25ZSu5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768357150&amp;x-signature=WWfySbBxmAQ3%2FmMoKmqe25o3eJw%3D" alt="image.png" loading="lazy"/></p>
<ol>
<li>基于Bucket Index的MoR表在流量数据生产链路存在将桶分配至写Write Task时不均匀导致部分Task负载高、部分Task空闲，并发资源利用低，影响流量作业的写入性能；同时流量业务分区数据倾斜TB-&gt;MB，Fix Bucket模式导致小数据量分区产生过多的小文件</li>
</ol>
<p><strong>解决方案：</strong></p>
<p>自研基于TimelineService的Remote Partitioner功能,采用集中式分区+桶分配策略，解决桶分配倾斜</p>
<p>自研分区级分桶，按照业务分区数据特性自定义分区桶数，并实现原地桶扩缩容</p>
<ol start="2">
<li>流量曝光业务日更新数据量级千亿级，MoR(Avro) Compaction性能、读时合并、更新性能无法满足，SLA压力大；社区原生MoR不支持并发更新，回溯修数场景需停生产无法满足流量业务准实时需求</li>
</ol>
<p><strong>解决方案：</strong></p>
<p>自研LSM-Tree数据组织格式，基于LSM顺序读写及分层合并的核心优势，提升MoR读、写、合并性能；</p>
<p>基于LSM-Tree文件隔离机制，解决元数据冲突、 JM与TM通信冲突、以及Hive元数据同步的冲突，实现轻量级的无锁并发Upsert</p>
<p>3.流量业务链路中实时关联SKU维度信息，SKU实时变更，天级别分区内不同主键相同SKU的维度信息不一致，依赖T+1离线修数</p>
<p>**解决方案： **</p>
<p>自研Hudi外键索引 + Partial Update，实现SKU维度信息变更时的主键回刷，保持同一个分区内SKU信息数据的一致性</p>
<h2 data-id="heading-3">四、社区贡献及未来规划</h2>
<p><strong>社区贡献</strong></p>
<p>目前京东Hudi团队累计向社区贡献109个PR，其中包含一些重要的工作，例如RFC-83 Incremental Table Service、RFC-89 Partition Level Bucket Index、HUDI-6212 Hudi Spark 3.0.x integration等，充分体现了团队在 Hudi 项目中的重要作用及持续贡献能力。目前团队包含一名Hudi PMC，一名Hudi Committer，Hudi前100名源码贡献者中团队占6人，发展成为Hudi社区的重要力量之一。</p>
<p><strong>未来规划</strong></p>
<ul>
<li>基于社区最新版本，推进JD内部Hudi版本演进</li>
<li>数据湖支持多模态能力，支持非结构化数据存储以及向量索引等能力支撑 AI 场景</li>
<li>基于Rust+Arrow推进NativeIO能力</li>
<li>探索湖流一体技术方案</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[SpringSecurity入门篇（1）]]></title>    <link>https://juejin.cn/post/7592251792651042843</link>    <guid>https://juejin.cn/post/7592251792651042843</guid>    <pubDate>2026-01-07T02:15:14.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592251792651042843" data-draft-id="7591441637050515506" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="SpringSecurity入门篇（1）"/> <meta itemprop="keywords" content="后端,架构"/> <meta itemprop="datePublished" content="2026-01-07T02:15:14.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="加洛斯"/> <meta itemprop="url" content="https://juejin.cn/user/1084596182848299"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            SpringSecurity入门篇（1）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1084596182848299/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    加洛斯
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-07T02:15:14.000Z" title="Wed Jan 07 2026 02:15:14 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{position:relative;word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#333}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:30px;margin-bottom:5px}.markdown-body h2{font-size:24px;display:inline-block;font-weight:700;background:#ef7060;color:#fff;padding:6px 8px 0 0;border-top-right-radius:6px;margin-right:2px;box-shadow:6px 3px 0 0 rgba(239,112,96,.2)}.markdown-body h2:before{content:" ";display:inline-block;width:8px}.markdown-body h2:after{content:" ";position:absolute;display:block;width:calc(100% - 50px);border-bottom:3px solid #ef7060}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #3e3e3e;margin-top:32px;margin-bottom:32px;height:1px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(27,31,35,.05);color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:JetBranins Mono,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px;background-color:#fdfdfd}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#fdfdfd}.markdown-body a{text-decoration:none;font-weight:700;color:#ef7060;border-bottom:1px solid #ef7060}.markdown-body a:active,.markdown-body a:hover{color:#ef2d26}.markdown-body table tr td,.markdown-body table tr th{border:1px solid #ccc;padding:5px 10px}.markdown-body table{display:block!important;width:auto;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{background:#f0f0f0;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#f8f8f8}.markdown-body blockquote{margin-inline-start:0;margin-inline-end:0;border-left:3px solid #ef7060;background:#fff9f9;padding:1px 20px;margin-top:20px}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="a11y-dark">.hljs-comment,.hljs-quote{color:#d4d0ab}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#ffa07a}.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#f5ab35}.hljs-attribute{color:gold}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:#abe338}.hljs-section,.hljs-title{color:#00e0e0}.hljs-keyword,.hljs-selector-tag{color:#dcc6e0}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#2b2b2b;color:#f8f8f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}@media screen and (-ms-high-contrast:active){.hljs-addition,.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-comment,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-quote,.hljs-string,.hljs-symbol,.hljs-type{color:highlight}.hljs-keyword,.hljs-selector-tag{font-weight:700}}</style><blockquote>
<p>大家好，我是加洛斯，是一名全栈工程师👨‍💻，这里是我的知识笔记与分享，旨在把复杂的东西讲明白。如果发现有误🔍，万分欢迎你帮我指出来！废话不多说，正文开始 👇</p>
</blockquote>
<h2 data-id="heading-0">一、初识SpringSecurity</h2>
<h3 data-id="heading-1">1.1 什么是SpringSecurity</h3>
<p><code>SpringSecurity</code>是一个<code>Java</code>框架，用于保护应用程序的安全性。它提供了一套全面的安全解决方案，包括<strong>身份验证、授权、防止攻击</strong>等功能。</p>
<p><code>SpringSecurity</code>基于<strong>过滤器链</strong>的概念，可以轻松地集成到任何基于<code>Spring</code>的应用程序中。它支持<strong>多种身份验证选项和授权策略</strong>，开发人员可以根据需要选择适合的方式。</p>
<h3 data-id="heading-2">1.2 SpringSecurity初体验</h3>
<p>首先我们新建一个Spring Boot项目，<strong>选择依赖时，只需要勾选</strong>：<code>Spring Web</code> 和 <code>Spring Security</code>。</p>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/13fa04a533724dfc9a17b59a89a3ad7c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Yqg5rSb5pav:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768356913&amp;x-signature=O85QD%2BiHM5QPTy5r35dQ3y2Lds0%3D" alt="image.png" width="70%" loading="lazy"/>
<p>勾选后，我们可以在<code>pom</code>文件中看到我们的<code>SpringSecurity</code>依赖</p>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c9bed24abe7545bea960424f1fc35d23~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Yqg5rSb5pav:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768356913&amp;x-signature=pn6QPyhzAsMXk7LLfA7vbKGENR8%3D" alt="image.png" width="70%" loading="lazy"/>
<p>接下来我们直接写一个controller</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@RestController</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserController</span> {

    <span class="hljs-meta">@RequestMapping("/user")</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getUser</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"用户信息"</span>;
    }
}
</code></pre>
<p>然后启动项目，在启动日志那块，我们可以看到生成了一串莫名其妙的东西，这串东西就是SpringSecurity自动为我们生成的初始密码。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cc836e96f4cb4d818467109d7c21c55b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Yqg5rSb5pav:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768356913&amp;x-signature=B6w6pSzkqLoRrltS%2FkR1%2F5d6CZs%3D" alt="image.png" loading="lazy"/></p>
<p>按理来说我们访问<code>http://localhost:8080/user</code> 应该能看到我们controller返回的结果，但是并没有，<strong>而是会看到一个登录页面</strong>！这就是Spring Security入门的第一步：<strong>它默认保护了你的所有请求</strong>。</p>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d3d03f2c24b94f8b92f8c216f4e20712~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Yqg5rSb5pav:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768356913&amp;x-signature=GPlDtzhqV4HWQ1lpjFUgX%2FsxHT0%3D" alt="image.png" width="70%" loading="lazy"/>
系统为你的应用**自动生成**了一个默认用户：**用户名**：`user`，**密码**：在项目启动的控制台日志中，登录后你就能看到我们所返回的信息了！
<blockquote>
<p>至此，一个最简单也最直观的Spring Security入门案例已经为大家展示完毕了，它能体验Spring Security最基础的  <strong>“认证”</strong>  流程。在没有任何配置的情况下，它做了三件关键事:</p>





















<table><thead><tr><th>自动行为</th><th>说明</th></tr></thead><tbody><tr><td><strong>1. 启用安全过滤</strong></td><td>为所有请求挂上了安全“安检”流程。</td></tr><tr><td><strong>2. 生成默认用户</strong></td><td>创建了一个临时的、内存中的用户（<code>user</code>）。</td></tr><tr><td><strong>3. 弹出登录页</strong></td><td>对于未认证的请求，自动重定向到内置登录页。</td></tr></tbody></table>
</blockquote>
<h2 data-id="heading-3">二、过滤器链</h2>
<blockquote>
<p>SpringSecurity的核心工作模式，本质上是一系列串联在Web请求前的过滤器(Filter)。每个请求都要经过这些安全检查，就像进地铁前要依次经过安检门、验票闸机一样</p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4025d0191ece407cbc2221e5bc422aa1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Yqg5rSb5pav:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768356913&amp;x-signature=loTFsJAy16OUlcboLM2144bdpKY%3D" alt="deepseek_mermaid_20260105_de7083.png" loading="lazy"/></p>
<p>要彻底理解Spring Security的过滤器链，我们需要先纠正一个常见的错误观念，并抓住<strong>四个最核心的组件</strong>。很多人认为“过滤器链”就是一长串 <code>Filter</code> 直接排好队，但这是不准确的。</p>
<p>我们观看上面的那张图片，真正嵌进 Servlet 容器的只有 1 个，那就是<code>DelegatingFilterProxy</code>，它把请求转给 Spring 管理的 <code>FilterChainProxy</code>，再由后者挑选本次请求应该走哪一条<code>SecurityFilterChain</code></p>
<p><code>SpringSecurity</code>有<code>15</code>个默认内置过滤器，其在接收请求后执行顺序如下：</p>





































































































































<table><thead><tr><th>顺序</th><th>过滤器 (Filter)</th><th>核心职责</th><th>是否关键</th><th>6.x常见配置/变化</th><th/></tr></thead><tbody><tr><td>1</td><td><code>ChannelProcessingFilter</code></td><td>强制请求使用HTTPS等安全通道。</td><td>可选</td><td>通过 <code>.requiresChannel()</code> 配置。</td><td/></tr><tr><td>2</td><td><code>WebAsyncManagerIntegrationFilter</code></td><td>集成Spring异步请求（如<code>@Async</code>）的安全上下文。</td><td>低</td><td>通常无需配置。</td><td/></tr><tr><td>3</td><td><code>SecurityContextPersistenceFilter</code></td><td><strong>关键</strong>：在每个请求的<strong>开始和结束时</strong>，负责从存储（如Session、JWT令牌）中<strong>恢复或清除用户认证信息</strong>（<code>SecurityContext</code>），并将其绑定到当前线程（<code>SecurityContextHolder</code>）。</td><td>是</td><td>前后端分离项目中，可配合无Session策略自定义存储方式。</td><td/></tr><tr><td>4</td><td><code>HeaderWriterFilter</code></td><td>向响应写入安全相关的HTTP头，如<code>X-Content-Type-Options</code>。</td><td>可选</td><td>可通过 <code>.headers()</code> 配置自定义。</td><td/></tr><tr><td>5</td><td><code>CsrfFilter</code></td><td>防护跨站请求伪造攻击，对非幂等的<code>POST</code>、<code>PUT</code>等请求校验CSRF令牌。</td><td>可选</td><td><strong>前后端分离API项目常通过 <code>.csrf().disable()</code> 禁用。</strong></td><td/></tr><tr><td>6</td><td><code>LogoutFilter</code></td><td>处理注销请求（默认<code>/logout</code>），清理认证信息。</td><td>是</td><td>可通过 <code>.logout()</code> 自定义注销URL、成功处理器等。</td><td/></tr><tr><td>7</td><td><code>UsernamePasswordAuthenticationFilter</code></td><td><strong>关键</strong>：处理<strong>表单登录</strong>（默认<code>/login</code> POST请求），是核心的认证入口之一。</td><td>是</td><td>可被自定义登录过滤器（如手机验证码登录）<strong>替换或扩展</strong>。</td><td/></tr><tr><td>8</td><td><code>DefaultLoginPageGeneratingFilter</code></td><td>自动生成默认登录页。</td><td>可选</td><td><strong>生产环境通常通过配置自定义登录页来间接禁用此过滤器。</strong></td><td/></tr><tr><td>9</td><td><code>BasicAuthenticationFilter</code></td><td>处理HTTP Basic认证（请求头带<code>Authorization: Basic ...</code>）。</td><td>可选</td><td>可通过 <code>.httpBasic()</code> 启用或自定义。</td><td/></tr><tr><td>10</td><td><code>RequestCacheAwareFilter</code></td><td>用户登录成功后，恢复因未登录而被缓存的原始请求（“回到刚才想看的页面”）。</td><td>可选</td><td>前后端分离项目或无状态API中<strong>作用有限</strong>。</td><td/></tr><tr><td>11</td><td><code>SecurityContextHolderAwareRequestFilter</code></td><td>对<code>HttpServletRequest</code>进行包装，增加安全相关方法（如<code>isUserInRole</code>）。</td><td>低</td><td>通常无需配置。</td><td/></tr><tr><td>12</td><td><code>AnonymousAuthenticationFilter</code></td><td><strong>关键</strong>：如果请求至此仍未认证，则自动注入一个“匿名用户”身份，保证<code>SecurityContext</code>非空。</td><td>是</td><td>可自定义匿名用户的权限细节。</td><td/></tr><tr><td>13</td><td><code>SessionManagementFilter</code></td><td>管理用户会话，如防止会话固定攻击、控制并发登录数量。</td><td>可选</td><td>通过 <code>.sessionManagement()</code> 配置会话控制策略。</td><td/></tr><tr><td>14</td><td><code>ExceptionTranslationFilter</code></td><td><strong>关键</strong>：捕获下游过滤器（主要是<code>AuthorizationFilter</code>）抛出的<strong>认证和授权异常</strong>，并转化为对应的HTTP响应（如重定向到登录页、返回401/403）。</td><td>是</td><td><strong>是“认证失败跳登录页”和“权限不足返回403”的幕后导演</strong>。</td><td/></tr><tr><td>15</td><td><code>AuthorizationFilter</code></td><td><strong>最核心</strong>：执行<strong>URL级别</strong>的授权检查。它根据<code>HttpSecurity</code>中<code>.authorizeHttpRequests()</code>配置的规则，<strong>决定当前用户是否有权访问当前请求的URL</strong>。</td><td>是</td><td><strong>Spring Security 6.x中，取代了旧版的<code>FilterSecurityInterceptor</code>。</strong>  绝大多数URL权限规则在此生效。</td><td/></tr></tbody></table>
<h2 data-id="heading-4">三、登录认证</h2>
<p>我们上面的登录都是基于Spring Security自带的用户与密码登录的，那实际开发中肯定是要从数据库中获取用户登录的，接下来我们讲一下如何让登录请求发送到我们定义的代码当中。</p>
<h3 data-id="heading-5">3.1 新增依赖</h3>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- Spring Security --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-security<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- Spring Web --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- MySQL --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.mysql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mysql-connector-j<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>runtime<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- MyBatis --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.0.3<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- Lombok --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.projectlombok<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>lombok<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">optional</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">optional</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.security<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-security-test<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.projectlombok<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>lombok<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>provided<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>
</code></pre>
<h3 data-id="heading-6">3.2 新增配置文件yml</h3>
<pre><code class="hljs language-yml" lang="yml"><span class="hljs-attr">server:</span>
  <span class="hljs-attr">port:</span> <span class="hljs-number">8080</span>
  <span class="hljs-attr">servlet:</span>
    <span class="hljs-attr">context-path:</span> <span class="hljs-string">/</span>

<span class="hljs-attr">spring:</span>
  <span class="hljs-attr">application:</span>
    <span class="hljs-attr">name:</span> <span class="hljs-string">dlyk-server</span>
  <span class="hljs-attr">datasource:</span>
    <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://localhost:3306/learn?useUnicode=true&amp;characterEncoding=utf-8&amp;zeroDateTimeBehavior=convertToNull&amp;transformedBitIsBoolean=true&amp;allowMultiQueries=true&amp;useSSL=false&amp;allowPublicKeyRetrieval=true&amp;serverTimezone=Asia/Shanghai</span>
    <span class="hljs-attr">username:</span> <span class="hljs-string">root</span>
    <span class="hljs-attr">password:</span> <span class="hljs-string">root</span>
    <span class="hljs-attr">driver-class-name:</span> <span class="hljs-string">com.mysql.cj.jdbc.Driver</span>
    <span class="hljs-attr">hikari:</span>
      <span class="hljs-attr">maximum-pool-size:</span> <span class="hljs-number">30</span>
      <span class="hljs-attr">minimum-idle:</span> <span class="hljs-number">30</span>
      <span class="hljs-attr">connection-timeout:</span> <span class="hljs-number">30000</span>
      <span class="hljs-attr">idle-timeout:</span> <span class="hljs-number">0</span>
      <span class="hljs-attr">max-lifetime:</span> <span class="hljs-number">18000000</span>
  <span class="hljs-attr">data:</span>
    <span class="hljs-attr">redis:</span>
      <span class="hljs-attr">host:</span> <span class="hljs-number">115.190</span><span class="hljs-number">.212</span><span class="hljs-number">.212</span>
      <span class="hljs-attr">port:</span> <span class="hljs-number">6379</span>
      <span class="hljs-attr">database:</span> <span class="hljs-number">1</span>
      <span class="hljs-attr">timeout:</span> <span class="hljs-string">2000ms</span>
      <span class="hljs-attr">lettuce:</span>
        <span class="hljs-attr">pool:</span>
          <span class="hljs-attr">max-active:</span> <span class="hljs-number">8</span>
          <span class="hljs-attr">max-idle:</span> <span class="hljs-number">8</span>
          <span class="hljs-attr">min-idle:</span> <span class="hljs-number">0</span>
          <span class="hljs-attr">max-wait:</span> <span class="hljs-string">-1ms</span>
<span class="hljs-attr">mybatis:</span>
  <span class="hljs-attr">mapper-locations:</span> <span class="hljs-string">classpath:mapper/*.xml</span>
  <span class="hljs-attr">type-aliases-package:</span> <span class="hljs-string">com.example.entity</span>
</code></pre>
<h3 data-id="heading-7">3.3 导入数据库</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> <span class="hljs-keyword">user</span>
(
    id                     <span class="hljs-type">int</span> auto_increment comment <span class="hljs-string">'主键，自动增长，用户ID'</span> <span class="hljs-keyword">primary</span> key,
    login_act              <span class="hljs-type">varchar</span>(<span class="hljs-number">32</span>) <span class="hljs-keyword">null</span> comment <span class="hljs-string">'登录账号'</span>,
    login_pwd              <span class="hljs-type">varchar</span>(<span class="hljs-number">64</span>) <span class="hljs-keyword">null</span> comment <span class="hljs-string">'登录密码'</span>,
    name                   <span class="hljs-type">varchar</span>(<span class="hljs-number">32</span>) <span class="hljs-keyword">null</span> comment <span class="hljs-string">'用户姓名'</span>,
    account_no_expired     <span class="hljs-type">int</span>         <span class="hljs-keyword">null</span> comment <span class="hljs-string">'账户是否没有过期，0已过期 1正常'</span>,
    credentials_no_expired <span class="hljs-type">int</span>         <span class="hljs-keyword">null</span> comment <span class="hljs-string">'密码是否没有过期，0已过期 1正常'</span>,
    account_no_locked      <span class="hljs-type">int</span>         <span class="hljs-keyword">null</span> comment <span class="hljs-string">'账号是否没有锁定，0已锁定 1正常'</span>,
    account_enabled        <span class="hljs-type">int</span>         <span class="hljs-keyword">null</span> comment <span class="hljs-string">'账号是否启用，0禁用 1启用'</span>
)
    comment <span class="hljs-string">'用户表'</span>;
</code></pre>
<p>明文密码是：123456</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> learn.user (id, login_act, login_pwd, name, account_no_expired, credentials_no_expired, account_no_locked, account_enabled) <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">1</span>, <span class="hljs-string">'zhangsan'</span>, <span class="hljs-string">'$2a$10$6RI/P5q12twVyzfwxN1Un.Hc0GOXFmdfY4zUwwt8.kpjwG5.ftUS2'</span>, <span class="hljs-string">'张三'</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>);
</code></pre>
<h3 data-id="heading-8">3.4 导入entity、service、mapper</h3>
<p>实体类LoginUser，这个没什么好说的，与数据库保持一致就行</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Data</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LoginUser</span> {
    <span class="hljs-comment">// 主键</span>
    <span class="hljs-keyword">private</span> Integer id;
    <span class="hljs-comment">// 登录账号</span>
    <span class="hljs-keyword">private</span> String login_act;
    <span class="hljs-comment">// 登录密码</span>
    <span class="hljs-keyword">private</span> String login_pwd;
    <span class="hljs-comment">// 昵称</span>
    <span class="hljs-keyword">private</span> String name;
    <span class="hljs-comment">// 账户是否没有过期，0已过期 1正常</span>
    <span class="hljs-keyword">private</span> Integer account_no_expired;
    <span class="hljs-comment">// 密码是否没有过期，0已过期 1正常</span>
    <span class="hljs-keyword">private</span> Integer credentials_no_expired;
    <span class="hljs-comment">// 账号是否没有锁定，0已锁定 1正常</span>
    <span class="hljs-keyword">private</span> Integer account_no_locked;
    <span class="hljs-comment">// 账号是否启用，0禁用 1启用</span>
    <span class="hljs-keyword">private</span> Integer account_enabled;
}
</code></pre>
<p>接下来是service，我们看到了它继承了<strong>UserDetailsService</strong>，它是 <code>Spring Security</code> 框架里最核心的<strong>用户源</strong>接口，根据用户名（或用户标识）把<strong>这个用户是谁、密码是什么、有哪些权限</strong>查出来，交给<code>Spring Security</code>做后续认证与鉴权。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.springframework.security.core.userdetails.UserDetailsService;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">LoginUserService</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">UserDetailsService</span> {

}
</code></pre>
<p>这个接口只有一个方法：
<code>UserDetails loadUserByUsername(String username) throws UsernameNotFoundException;</code>。他的返回值是<code>UserDetails</code>也是一个接口，包含：</p>
<ul>
<li><code>String getPassword()</code></li>
<li><code>String getUsername()</code></li>
<li><code>Collection&lt;? extends GrantedAuthority&gt; getAuthorities()</code></li>
<li><code>boolean isAccountNonExpired/NonLocked/CredentialsNonExpired/Enabled()</code></li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.service.impl;

<span class="hljs-keyword">import</span> com.example.entity.LoginUser;
<span class="hljs-keyword">import</span> com.example.mapper.LoginUserMapper;
<span class="hljs-keyword">import</span> com.example.service.LoginUserService;
<span class="hljs-keyword">import</span> jakarta.annotation.Resource;
<span class="hljs-keyword">import</span> org.springframework.security.core.authority.AuthorityUtils;
<span class="hljs-keyword">import</span> org.springframework.security.core.userdetails.User;
<span class="hljs-keyword">import</span> org.springframework.security.core.userdetails.UserDetails;
<span class="hljs-keyword">import</span> org.springframework.security.core.userdetails.UsernameNotFoundException;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Service;

<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LoginUserServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">LoginUserService</span> {

    <span class="hljs-meta">@Resource</span>
    <span class="hljs-keyword">private</span> LoginUserMapper loginUserMapper;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> UserDetails <span class="hljs-title function_">loadUserByUsername</span><span class="hljs-params">(String username)</span> <span class="hljs-keyword">throws</span> UsernameNotFoundException {
        <span class="hljs-type">LoginUser</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> loginUserMapper.getUserByUsername(username);
        <span class="hljs-keyword">if</span> (user == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UsernameNotFoundException</span>(<span class="hljs-string">"用户不存在"</span>);
        }
        <span class="hljs-keyword">return</span> User.builder()
                .username(user.getLogin_act())
                .password(user.getLogin_pwd())
                .authorities(AuthorityUtils.NO_AUTHORITIES) <span class="hljs-comment">// 权限为空</span>
                .build();
    }
}
</code></pre>
<p>注意我们返回的<code>User</code>是<code>org.springframework.security.core.userdetails.User</code>这个包下的，它实现了<code>UserDetails</code>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/73dc484a7298407888c5db07b1d82ff0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Yqg5rSb5pav:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768356913&amp;x-signature=HWENenR7xHS2FwdRlXGaTt35rhE%3D" alt="image.png" loading="lazy"/></p>
<p><code>Spring Security</code>拿到<code>UserDetails</code>后，会把前端传来的密码与它做比对，比对通过就登录成功，并把<code>authorities</code>写入<code>Authentication</code>，供后续鉴权使用。</p>
<blockquote>
<p><strong>配置类什么都不用做，Spring Boot 发现存在 UserDetailsService Bean 就会自动使用。</strong></p>
</blockquote>
<p>接下来是mapper，也没什么好说的了。</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"UTF-8"</span>?&gt;</span>
<span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">mapper</span>
        <span class="hljs-keyword">PUBLIC</span> <span class="hljs-string">"-//mybatis.org//DTD Mapper 3.0//EN"</span>
        <span class="hljs-string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">"com.example.mapper.LoginUserMapper"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"getUserByUsername"</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">"com.example.entity.LoginUser"</span>&gt;</span>
        SELECT
            u.id,
            u.login_act,
            u.login_pwd,
            u.name,
            u.account_no_expired,
            u.credentials_no_expired,
            u.account_no_locked,
            u.account_enabled
        FROM user u
        where u.login_act = #{username}
    <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">mapper</span>&gt;</span>
</code></pre>
<h3 data-id="heading-9">3.5 试运行</h3>
<p>接下来启动程序，然后在跳转到<code>8080</code>页面进入到默认的登录页登录，输入<code>zhangsan</code>，密码为：<code>123456</code>，我们可以看到请求已经跳转到我们刚刚重写的<code>loadUserByUsername</code>方法中，并且成功拿到了前台传递的<code>zhangsan</code>，我们也再数据库中找到了这条数据。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cdd9230cf8714af095a81f88287cea52~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Yqg5rSb5pav:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768356913&amp;x-signature=ELDJAHimU6OBXjmB4Y3iNqmy3nc%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-10">3.6密码加密器</h3>
<p>在上述代码运行完毕后，我们的控制台会报一个错误:<code>Given that there is no default password encoder configured, each password must have a password encoding prefix. Please either prefix this password with '{noop}' or set a default password encoder in DelegatingPasswordEncoder</code>.这个异常是 Spring Security 5 以后对“密码必须显式标明编码方式”的强制要求</p>
<blockquote>
<p>这个错误翻译就是：<strong>由于未配置任何默认密码编码器，每组密码都必须带有密码编码前缀。请要么将此密码前缀设为‘{noop}’，要么在 <code>DelegatingPasswordEncoder</code> 中设置一个默认密码编码器。</strong></p>
</blockquote>
<p>所以我们在配置类中配置一个BCrypt算法来校验密码！<strong>PasswordEncoder 是 Spring Security 的核心接口，专门用于密码的加密和验证。</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.springframework.context.annotation.Bean;
<span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;
<span class="hljs-keyword">import</span> org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;
<span class="hljs-keyword">import</span> org.springframework.security.crypto.password.PasswordEncoder;

<span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SecurityConfig</span> {

    <span class="hljs-comment">/**
     * 创建一个密码编码器（加密器）供 Spring Security 使用
     */</span>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> PasswordEncoder <span class="hljs-title function_">passwordEncoder</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BCryptPasswordEncoder</span>();
    }
}
</code></pre>
<p>Spring Security 5以上默认使用 <code>DelegatingPasswordEncoder</code>，它内部会：</p>
<ul>
<li>先到容器里找有没有 <strong>id 叫 passwordEncoder 的 PasswordEncoder Bean</strong>；</li>
<li>找到就拿它当“默认编码器”（即匹配不带 <code>{xxx}</code> 前缀的密码）；</li>
<li>找不到就抛异常，提示你 “no default password encoder configured”。</li>
</ul>
<p>所以当我们成功注册这个<code>bean</code>之后，<code>Spring Security</code>就不会再抛找不到密码加密器异常了。</p>
<h3 data-id="heading-11">3.7 运行</h3>
<p>我们重启服务器，打开网站：<a href="https://link.juejin.cn?target=http%3A%2F%2Flocalhost%3A8080%2Fuser" target="_blank" title="http://localhost:8080/user" ref="nofollow noopener noreferrer">http://localhost:8080/user</a> 之后他会自动跳转到<a href="https://link.juejin.cn?target=http%3A%2F%2Flocalhost%3A8080%2Flogin" target="_blank" title="http://localhost:8080/login" ref="nofollow noopener noreferrer">http://localhost:8080/login</a> 登录页面，然后我们输入用户zhangsan，密码123456，即可登录成功并且自动返回结果。</p>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2a38ef433d6c478e94bfeaf992996be9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Yqg5rSb5pav:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768356913&amp;x-signature=4VqmWJoCC3zx2fP0Nxm5tKVy60E%3D" alt="image.png" width="70%" loading="lazy"/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[前端组件封装封神指南：16条实战原则，面试、项目双加分]]></title>    <link>https://juejin.cn/post/7592088192516915243</link>    <guid>https://juejin.cn/post/7592088192516915243</guid>    <pubDate>2026-01-07T01:57:44.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592088192516915243" data-draft-id="7592069113222955027" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="前端组件封装封神指南：16条实战原则，面试、项目双加分"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-07T01:57:44.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="海云前端1"/> <meta itemprop="url" content="https://juejin.cn/user/963618991244365"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            前端组件封装封神指南：16条实战原则，面试、项目双加分
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/963618991244365/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    海云前端1
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-07T01:57:44.000Z" title="Wed Jan 07 2026 01:57:44 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>作为前端开发，你是否遇到过这些坑？封装的组件复用性差，换个项目就得重构；面试时被问 <strong>组件设计思路</strong>，只能<strong>支支吾吾说不出核心</strong>；合作开发时，自己写的组件被同事吐槽 <strong>难用又难改</strong></p>
<p>其实，优质的组件封装不仅能提升项目开发效率，更是面试中的 <strong>加分利器</strong>， 大厂面试官格外看重候选人的组件设计思维，这直接反映了代码功底和工程化能力。</p>
<p>结合我多年一线开发经验，以及对 antd、element-plus、vant 等顶尖组件库的深度拆解，总结出 <strong>16条实战级组件封装原则</strong>。不管你用 React 还是 Vue，掌握这些技巧，既能让你的代码更优雅易维护，更能在面试中脱颖而出，拿下心仪 Offer</p>
<h2 data-id="heading-0">一、基础属性：兜底设计，兼容灵活扩展</h2>
<p>任何组件都该默认支持 <code>className</code> 和 <code>style</code> 两个基础属性，这是组件灵活性的 “底线”。通过属性继承，让使用者能轻松自定义样式，无需修改组件源码。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> classNames <span class="hljs-keyword">from</span> <span class="hljs-string">'classnames'</span>;
<span class="hljs-comment">// 公共属性接口，可复用</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">CommonProps</span> {
  <span class="hljs-comment">/** 自定义类名 */</span>
  className?: <span class="hljs-built_in">string</span>;
  <span class="hljs-comment">/** 自定义内联样式 */</span>
  style?: <span class="hljs-title class_">React</span>.<span class="hljs-property">CSSProperties</span>;
}
<span class="hljs-comment">// 业务组件属性继承公共属性</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">MyInputProps</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">CommonProps</span> {
  <span class="hljs-comment">/** 输入框值 */</span>
  <span class="hljs-attr">value</span>: <span class="hljs-built_in">any</span>;
}
<span class="hljs-keyword">const</span> <span class="hljs-title class_">MyInput</span> = <span class="hljs-title function_">forwardRef</span>(<span class="hljs-function">(<span class="hljs-params">props: MyInputProps, ref: React.LegacyRef&lt;HTMLDivElement&gt;</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> { className, ...rest } = props;
  <span class="hljs-comment">// 合并默认类名和自定义类名</span>
  <span class="hljs-keyword">const</span> displayClassName = <span class="hljs-title function_">classNames</span>(<span class="hljs-string">'chc-input'</span>, className);
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">{ref}</span> {<span class="hljs-attr">...rest</span>} <span class="hljs-attr">className</span>=<span class="hljs-string">{displayClassName}</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
});
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">MyInput</span>;
</code></pre>
<h2 data-id="heading-1">二、注释规范：清晰易懂，提升协作效率</h2>
<p>组件的 <code>props</code> 和 <code>ref</code> 属性必须加注释，而且要避免使用 <code>//</code> 单行注释（TS 无法识别，鼠标悬浮无提示）。推荐用 JSDoc 风格注释，关键参数补充 <code>@description</code>（描述）、<code>@version</code>（版本）、<code>@deprecated</code>（废弃说明）、<code>@default</code>（默认值），国际化组件优先用英文注释。</p>
<p>反面示例：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">interface</span> <span class="hljs-title">MyInputsProps</span> {
  <span class="hljs-comment">// 自定义class（TS无法识别，协作坑）</span>
  className?: <span class="hljs-built_in">string</span>;
}
</code></pre>
<p>正面示例：</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">MyInputsProps</span> </span>{
  <span class="hljs-comment">/** Custom class name */</span>
  className?: <span class="hljs-keyword">string</span>;
  <span class="hljs-comment">/**
   * <span class="hljs-doctag">@description</span> Custom inline style
   * <span class="hljs-doctag">@version</span> 2.6.0
   * <span class="hljs-doctag">@default</span> ''
   */</span>
  style?: React.CSSProperties;
  <span class="hljs-comment">/**
   * <span class="hljs-doctag">@description</span> Custom title style
   * <span class="hljs-doctag">@deprecated</span> 2.5.0 (No longer supported)
   * <span class="hljs-doctag">@default</span> ''
   */</span>
  customTitleStyle?: React.CSSProperties;
}
</code></pre>
<h2 data-id="heading-2">三、导出规范：明确命名，便于调试定位</h2>
<p>组件的 <code>props</code> 类型、<code>ref</code> 类型（若用 <code>useImperativeHandle</code>）必须 <code>export</code> 导出，方便使用者复用类型。组件本身要设置明确名称，避免匿名导出 —— 否则报错时无法定位具体组件，调试效率极低。</p>
<p>反面示例：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">MyInputProps</span> { ... }
<span class="hljs-comment">// 匿名组件，报错无明确提示</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> (<span class="hljs-attr">props</span>: <span class="hljs-title class_">MyInputProps</span>) =&gt; {
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;
};
</code></pre>
<p>正面示例：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 导出类型，方便外部复用</span>
<span class="hljs-keyword">export</span> interface <span class="hljs-title class_">MyInputProps</span> { ... }
<span class="hljs-comment">// 命名组件，便于调试</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">MyInput</span>(<span class="hljs-params">props: MyInputProps</span>) {
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;
}
<span class="hljs-comment">// 开发环境设置显示名称</span>
<span class="hljs-keyword">if</span> (process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span> !== <span class="hljs-string">'production'</span>) {
  <span class="hljs-title class_">MyInput</span>.<span class="hljs-property">displayName</span> = <span class="hljs-string">'MyInput'</span>;
}
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">MyInput</span>;

<span class="hljs-comment">// index.ts 统一导出，方便引入</span>
<span class="hljs-keyword">export</span> * <span class="hljs-keyword">from</span> <span class="hljs-string">'./input'</span>;
<span class="hljs-keyword">export</span> { <span class="hljs-keyword">default</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">MyInput</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./input'</span>;
</code></pre>
<p>如果需要获取其他组件的类型，可通过 <code>ComponentProps</code> 和 <code>ComponentRef</code> 快速获取：</p>
<pre><code class="hljs language-ini" lang="ini">type <span class="hljs-attr">DialogProps</span> = ComponentProps&lt;typeof Dialog&gt;<span class="hljs-comment">;</span>
type <span class="hljs-attr">DialogRef</span> = ComponentRef&lt;typeof Dialog&gt;<span class="hljs-comment">;</span>
</code></pre>
<h2 data-id="heading-3">四、入参约束：精准定义，减少使用错误</h2>
<p>入参类型要明确，避免用 <code>string</code>、<code>number</code> 等宽泛类型 “一笔带过”；公共组件尽量不用枚举（使用者需额外引入，增加成本）；数值类型需说明取值范围，降低使用门槛。</p>
<p>反面示例：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">InputProps</span> {
  <span class="hljs-attr">status</span>: <span class="hljs-built_in">string</span>; <span class="hljs-comment">// 类型模糊，不知道支持哪些值</span>
  <span class="hljs-attr">count</span>: <span class="hljs-built_in">number</span>; <span class="hljs-comment">// 无取值范围，容易传错</span>
}
</code></pre>
<p>正面示例：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">interface</span> <span class="hljs-title">InputProps</span> {
  status: <span class="hljs-string">'success'</span> | <span class="hljs-string">'fail'</span>; <span class="hljs-comment">// 明确支持的状态值</span>
  <span class="hljs-comment">/** 总数（取值范围：0-999） */</span>
  count: number;
}
</code></pre>
<h2 data-id="heading-4">五、样式设计：隔离冲突，支持主题定制</h2>
<p>禁用 CSS Module（会导致使用者无法修改内部样式），Vue 可使用 <code>scoped</code> 避免样式污染；组件内部 <code>class</code> 加统一前缀（如 <code>my-input-</code>），防止命名冲突；class 名称要语义化，禁用 <code>!important</code>；预留 CSS 变量，支持主题切换。</p>
<p>反面示例：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> styles <span class="hljs-keyword">from</span> <span class="hljs-string">'./index.module.less'</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">MyInput</span>(<span class="hljs-params">props: MyInputProps</span>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{styles.input_box}</span>&gt;</span> {/* 无法外部修改样式 */}
      <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{styles.detail}</span>&gt;</span>内容<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}
</code></pre>
<p>正面示例：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> <span class="hljs-string">'./index.less'</span>;
<span class="hljs-keyword">const</span> prefixCls = <span class="hljs-string">'my-input'</span>; <span class="hljs-comment">// 统一前缀</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">MyInput</span>(<span class="hljs-params">props: MyInputProps</span>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{</span>`${<span class="hljs-attr">prefixCls</span>}<span class="hljs-attr">-box</span>`}&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{</span>`${<span class="hljs-attr">prefixCls</span>}<span class="hljs-attr">-detail</span>`}&gt;</span>内容<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}

<span class="hljs-comment">// 样式文件预留CSS变量</span>
.<span class="hljs-property">my</span>-input-box {
  <span class="hljs-attr">height</span>: 100px;
  <span class="hljs-attr">background</span>: <span class="hljs-title function_">var</span>(--my-input-box-background, #<span class="hljs-number">000</span>); <span class="hljs-comment">// 支持外部定制</span>
}
</code></pre>
<h2 data-id="heading-5">六、继承透传：兼容扩展，减少维护成本</h2>
<p>二次封装组件时，不要逐个提取属性绑定到基础组件 —— 基础组件更新后，需手动同步属性，维护成本高。推荐用 <code>extends</code> 继承基础组件属性，用 <code>...rest</code> 承接所有传入属性，自动透传。</p>
<p>反面示例：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Input</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'某组件库'</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">MyInputProps</span> {
  <span class="hljs-attr">value</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">limit</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-attr">state</span>: <span class="hljs-built_in">string</span>;
}
<span class="hljs-keyword">const</span> <span class="hljs-title function_">MyInput</span> = (<span class="hljs-params">props: Partial&lt;MyInputProps&gt;</span>) =&gt; {
  <span class="hljs-keyword">const</span> { value, limit, state } = props;
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Input</span> <span class="hljs-attr">value</span>=<span class="hljs-string">{value}</span> <span class="hljs-attr">limit</span>=<span class="hljs-string">{limit}</span> <span class="hljs-attr">state</span>=<span class="hljs-string">{state}</span> /&gt;</span></span>; <span class="hljs-comment">// 需手动同步属性</span>
};
</code></pre>
<p>正面示例：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Input</span>, <span class="hljs-title class_">InputProps</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'某组件库'</span>;
<span class="hljs-comment">// 继承基础组件所有属性</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">MyInputProps</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">InputProps</span> {
  <span class="hljs-attr">value</span>: <span class="hljs-built_in">string</span>;
}
<span class="hljs-keyword">const</span> <span class="hljs-title function_">MyInput</span> = (<span class="hljs-params">props: Partial&lt;MyInputProps&gt;</span>) =&gt; {
  <span class="hljs-keyword">const</span> { value, ...rest } = props;
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Input</span> <span class="hljs-attr">value</span>=<span class="hljs-string">{value}</span> {<span class="hljs-attr">...rest</span>} /&gt;</span></span>; <span class="hljs-comment">// 自动透传所有属性</span>
};
</code></pre>
<h2 data-id="heading-6">七、事件配套：钩子齐全，提升可控性</h2>
<p>组件内部操作导致 UI 变化时，必须提供对应的事件钩子（如 <code>onChange</code>、<code>onShowChange</code>），让使用者能感知状态变化并做自定义处理，提升组件可控性。</p>
<p>反面示例：</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-function"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> function <span class="hljs-title">MyInput</span><span class="hljs-params">(props: MyInputProps)</span> </span>{
  <span class="hljs-type">const</span> [open, setOpen] = <span class="hljs-built_in">useState</span>(<span class="hljs-literal">false</span>);
  <span class="hljs-type">const</span> onCheckOpen = () =&gt; {
    <span class="hljs-built_in">setOpen</span>(!open); <span class="hljs-comment">// 内部状态变化，外部无感知</span>
  };
  <span class="hljs-keyword">return</span> &lt;div onClick={onCheckOpen}&gt;{open ? <span class="hljs-string">'打开'</span> : <span class="hljs-string">'关闭'</span>}&lt;/div&gt;;
}
</code></pre>
<p>正面示例：</p>
<pre><code class="hljs language-ini" lang="ini">export default function MyInput(props: MyInputProps) {
  const { onChange } = props<span class="hljs-comment">;</span>
  const <span class="hljs-section">[open, setOpen]</span> = useState(false)<span class="hljs-comment">;</span>
  const <span class="hljs-attr">onCheckOpen</span> = () =&gt; {
    const <span class="hljs-attr">newState</span> = !open<span class="hljs-comment">;</span>
    setOpen(newState)<span class="hljs-comment">;</span>
    onChange?.(newState)<span class="hljs-comment">; // 暴露事件钩子，外部可响应</span>
  }<span class="hljs-comment">;</span>
  return &lt;div <span class="hljs-attr">onClick</span>={<span class="hljs-literal">on</span>CheckOpen}&gt;{open ? <span class="hljs-string">'打开'</span> : <span class="hljs-string">'关闭'</span>}&lt;/div&gt;<span class="hljs-comment">;</span>
}
</code></pre>
<h2 data-id="heading-7">八、Ref 绑定：预留接口，避免报错警告</h2>
<p>组件需支持 <code>ref</code> 绑定，否则使用者挂载 <code>ref</code> 会出现控制台警告。原创组件可通过 <code>useImperativeHandle</code> 暴露自定义方法，或直接绑定根节点；二次封装组件直接绑定基础组件。</p>
<p>原创组件示例：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">ChcInputRef</span> {
  <span class="hljs-attr">setValidView</span>: <span class="hljs-function">(<span class="hljs-params">isShow?: <span class="hljs-built_in">boolean</span></span>) =&gt;</span> <span class="hljs-built_in">void</span>;
  <span class="hljs-attr">field</span>: <span class="hljs-title class_">Field</span>;
}
<span class="hljs-keyword">const</span> <span class="hljs-title class_">ChcInput</span> = forwardRef&lt;<span class="hljs-title class_">ChcInputRef</span>, <span class="hljs-title class_">MyProps</span>&gt;(<span class="hljs-function">(<span class="hljs-params">props, ref</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> { className, ...rest } = props;
  <span class="hljs-comment">// 暴露自定义方法</span>
  <span class="hljs-title function_">useImperativeHandle</span>(ref, <span class="hljs-function">() =&gt;</span> ({
    <span class="hljs-title function_">setValidView</span>(<span class="hljs-params">isShow = <span class="hljs-literal">false</span></span>) {
      <span class="hljs-title function_">setIsCheckBalloonVisible</span>(isShow);
    },
    field
  }), []);
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{displayClassName}</span> {<span class="hljs-attr">...rest</span>}&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;
});
</code></pre>
<p>二次封装组件示例：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Input</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'某组件库'</span>;
<span class="hljs-keyword">const</span> <span class="hljs-title class_">ChcInput</span> = <span class="hljs-title function_">forwardRef</span>(<span class="hljs-function">(<span class="hljs-params">props: InputProps, ref: React.LegacyRef&lt;Input&gt;</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> { className, ...rest } = props;
  <span class="hljs-keyword">const</span> displayClassName = <span class="hljs-title function_">classNames</span>(<span class="hljs-string">'chc-input'</span>, className);
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Input</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">{ref}</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{displayClassName}</span> {<span class="hljs-attr">...rest</span>} /&gt;</span></span>;
});
</code></pre>
<h2 data-id="heading-8">九、自定义扩展：预留入口，灵活适配场景</h2>
<p>组件内部的固定渲染逻辑或计算逻辑，需预留自定义入口（如 <code>render</code> 函数），让使用者能覆盖默认逻辑，无需修改组件源码，提升组件适配性。</p>
<p>反面示例：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">MyInput</span>(<span class="hljs-params">props: MyInputProps</span>) {
  <span class="hljs-keyword">const</span> { value } = props;
  <span class="hljs-keyword">const</span> detailText = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-comment">// 固定逻辑，无法自定义</span>
    <span class="hljs-keyword">return</span> value.<span class="hljs-title function_">split</span>(<span class="hljs-string">','</span>).<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> <span class="hljs-string">`内部逻辑：<span class="hljs-subst">${item}</span>`</span>).<span class="hljs-title function_">join</span>(<span class="hljs-string">'\n'</span>);
  }, [value]);
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>{detailText}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;
}
</code></pre>
<p>正面示例：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">MyInput</span>(<span class="hljs-params">props: MyInputProps</span>) {
  <span class="hljs-keyword">const</span> { value, render } = props;
  <span class="hljs-keyword">const</span> detailText = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-comment">// 优先使用自定义渲染逻辑，否则用默认逻辑</span>
    <span class="hljs-keyword">return</span> render ? <span class="hljs-title function_">render</span>(value) : value.<span class="hljs-title function_">split</span>(<span class="hljs-string">','</span>).<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> <span class="hljs-string">`内部逻辑：<span class="hljs-subst">${item}</span>`</span>).<span class="hljs-title function_">join</span>(<span class="hljs-string">'\n'</span>);
  }, [value]);
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>{detailText}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;
}
</code></pre>
<h2 data-id="heading-9">十、受控非受控：双模式支持，降低使用门槛</h2>
<p>组件需同时支持受控模式（外部控制状态）和非受控模式（内部管理状态）：非受控模式方便快速使用，受控模式支持复杂场景自定义，兼顾易用性和灵活性。</p>
<p>示例：</p>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">prefixCls</span> = <span class="hljs-string">'my-input'</span><span class="hljs-comment">;</span>
export default function MyInput(props: MyInputProps) {
  const { value, <span class="hljs-attr">defaultValue</span> = <span class="hljs-literal">true</span>, className, style, <span class="hljs-literal">on</span>Change } = props<span class="hljs-comment">;</span>
  // 非受控模式：内部管理状态
  const <span class="hljs-section">[open, setOpen]</span> = useState(value || defaultValue)<span class="hljs-comment">;</span>
  // 受控模式：外部控制状态
  useEffect(() =&gt; {
    if (typeof <span class="hljs-attr">value</span> === <span class="hljs-string">'boolean'</span>) setOpen(value)<span class="hljs-comment">;</span>
  }, <span class="hljs-section">[value]</span>)<span class="hljs-comment">;</span>
  const <span class="hljs-attr">onCheckOpen</span> = () =&gt; {
    const <span class="hljs-attr">newState</span> = !open<span class="hljs-comment">;</span>
    onChange?.(newState)<span class="hljs-comment">;</span>
    // 非受控模式下，内部更新状态
    if (typeof value !== 'boolean') setOpen(newState)<span class="hljs-comment">;</span>
  }<span class="hljs-comment">;</span>
  return (
    &lt;div <span class="hljs-attr">className</span>={classNames(className, `<span class="hljs-variable">${prefixCls}</span>-box`, { [`<span class="hljs-variable">${prefixCls}</span>-open`]: open })} 
         <span class="hljs-attr">style</span>={style} <span class="hljs-literal">on</span>Click={<span class="hljs-literal">on</span>CheckOpen}&gt;
      内容
    &lt;/div&gt;
  )<span class="hljs-comment">;</span>
}
</code></pre>
<h2 data-id="heading-10">十一、最小依赖：减少耦合，提升兼容性</h2>
<p>组件封装遵循 “最小依赖” 原则，简单功能优先手写实现，避免引入不必要的依赖包（如 <code>ahooks</code>），减少组件体积和耦合度。若必须引入，优先使用项目已有的依赖，或自行实现核心逻辑。</p>
<p>反面示例：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { useLatest } <span class="hljs-keyword">from</span> <span class="hljs-string">'ahooks'</span>; <span class="hljs-comment">// 新增依赖，增加项目体积</span>
<span class="hljs-keyword">import</span> classNames <span class="hljs-keyword">from</span> <span class="hljs-string">'classnames'</span>;
<span class="hljs-keyword">const</span> <span class="hljs-title class_">ChcInput</span> = <span class="hljs-title function_">forwardRef</span>(<span class="hljs-function">(<span class="hljs-params">props: InputProps, ref</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> funcRef = <span class="hljs-title function_">useLatest</span>(func);
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{classNames(</span>'<span class="hljs-attr">chc-input</span>', <span class="hljs-attr">props.className</span>)} {<span class="hljs-attr">...props</span>}&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;
});
</code></pre>
<p>正面示例：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 自行实现核心逻辑，无需新增依赖</span>
<span class="hljs-keyword">import</span> { useRef } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">useLatest</span>(<span class="hljs-params">value</span>) {
  <span class="hljs-keyword">const</span> ref = <span class="hljs-title function_">useRef</span>(value);
  ref.<span class="hljs-property">current</span> = value;
  <span class="hljs-keyword">return</span> ref;
}

<span class="hljs-comment">// 组件中使用</span>
<span class="hljs-keyword">import</span> { useLatest } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/hooks'</span>;
<span class="hljs-keyword">import</span> classNames <span class="hljs-keyword">from</span> <span class="hljs-string">'classnames'</span>;
<span class="hljs-keyword">const</span> <span class="hljs-title class_">ChcInput</span> = <span class="hljs-title function_">forwardRef</span>(<span class="hljs-function">(<span class="hljs-params">props: InputProps, ref</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> funcRef = <span class="hljs-title function_">useLatest</span>(func);
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{classNames(</span>'<span class="hljs-attr">chc-input</span>', <span class="hljs-attr">props.className</span>)} {<span class="hljs-attr">...props</span>}&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;
});
</code></pre>
<h2 data-id="heading-11">十二、单一职责：拆分功能，提升复用性</h2>
<p>组件不要 “大包大揽”，一个组件只处理一个核心功能（业务组件除外，可整合多个组件完成单一业务）。复杂功能拆分成独立公共组件，提升复用性和维护性。</p>
<p>反面示例：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 一个组件包含表格和图例功能，职责混乱</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">MyShowPage</span> = <span class="hljs-title function_">forwardRef</span>(<span class="hljs-function">(<span class="hljs-params">props, ref</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> { data, imgList, ...rest } = props;
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Table</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">{ref}</span> <span class="hljs-attr">data</span>=<span class="hljs-string">{data}</span> {<span class="hljs-attr">...rest</span>}&gt;</span>
        {/* 表格逻辑... */}
      <span class="hljs-tag">&lt;/<span class="hljs-name">Table</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>{/* 图例逻辑... */}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
});
</code></pre>
<p>正面示例：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 拆分独立组件，各司其职</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">MyShowPage</span> = <span class="hljs-title function_">forwardRef</span>(<span class="hljs-function">(<span class="hljs-params">props, ref</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> { data, imgList, ...rest } = props;
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">MyTable</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">{ref}</span> <span class="hljs-attr">data</span>=<span class="hljs-string">{data}</span> {<span class="hljs-attr">...rest</span>} /&gt;</span> {/* 仅处理表格功能 */}
      <span class="hljs-tag">&lt;<span class="hljs-name">MyImg</span> <span class="hljs-attr">data</span>=<span class="hljs-string">{imgList}</span> /&gt;</span> {/* 仅处理图片展示 */}
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
});
</code></pre>
<h2 data-id="heading-12">十三、业务组件：内置逻辑，降低使用成本</h2>
<p>业务组件要 “去业务化暴露”—— 将复杂业务逻辑内置到组件内部，避免使用者重复编写业务代码，降低使用门槛。使用者只需传入原始数据，组件自行处理业务规则。</p>
<p>反面示例：</p>
<pre><code class="hljs language-ini" lang="ini">// 组件未处理业务逻辑，使用者需手动处理
const <span class="hljs-attr">MyTable</span> = forwardRef((props, ref) =&gt; {
  const { data, ...rest } = props<span class="hljs-comment">;</span>
  return (
    &lt;Table <span class="hljs-attr">ref</span>={ref} data={data} {...rest}&gt;
      &lt;Table.Column <span class="hljs-attr">dataIndex</span>=<span class="hljs-string">"test1"</span> title=<span class="hljs-string">"标题1"</span> /&gt;
      &lt;Table.Column <span class="hljs-attr">dataIndex</span>=<span class="hljs-string">"data"</span> title=<span class="hljs-string">"值"</span> /&gt;
    &lt;/Table&gt;
  )<span class="hljs-comment">;</span>
})<span class="hljs-comment">;</span>

// 使用者需手动处理业务逻辑（<span class="hljs-attr">type</span>=<span class="hljs-number">1</span>时data乘<span class="hljs-number">2</span>）
const <span class="hljs-attr">data</span> = res.map(item =&gt; ({
  ...item,
  data: <span class="hljs-attr">item.type</span> === <span class="hljs-number">1</span> ? item.data * <span class="hljs-number">2</span> : item.data
}))<span class="hljs-comment">;</span>
&lt;MyTable <span class="hljs-attr">data</span>={data} /&gt;
</code></pre>
<p>正面示例：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 组件内置业务逻辑，使用者直接传原始数据</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">MyTable</span> = <span class="hljs-title function_">forwardRef</span>(<span class="hljs-function">(<span class="hljs-params">props, ref</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> { data, ...rest } = props;
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">dataRender</span> = (<span class="hljs-params">item</span>) =&gt; {
    <span class="hljs-keyword">return</span> item.<span class="hljs-property">type</span> === <span class="hljs-number">1</span> ? item.<span class="hljs-property">data</span> * <span class="hljs-number">2</span> : item.<span class="hljs-property">data</span>; <span class="hljs-comment">// 内置业务规则</span>
  };
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Table</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">{ref}</span> <span class="hljs-attr">data</span>=<span class="hljs-string">{data}</span> {<span class="hljs-attr">...rest</span>}&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Table.Column</span> <span class="hljs-attr">dataIndex</span>=<span class="hljs-string">"test1"</span> <span class="hljs-attr">title</span>=<span class="hljs-string">"标题1"</span> /&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Table.Column</span> <span class="hljs-attr">dataIndex</span>=<span class="hljs-string">"data"</span> <span class="hljs-attr">title</span>=<span class="hljs-string">"值"</span> <span class="hljs-attr">render</span>=<span class="hljs-string">{dataRender}</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">Table</span>&gt;</span></span>
  );
});

<span class="hljs-comment">// 使用者无需关心业务逻辑</span>
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">MyTable</span> <span class="hljs-attr">data</span>=<span class="hljs-string">{res}</span> /&gt;</span></span>
</code></pre>
<h2 data-id="heading-13">十四、深度扩展：递归处理，支持无限层级</h2>
<p>若组件需处理树形、嵌套等有深度的数据，需通过递归实现无限层级支持，避免固定层级导致的局限性。</p>
<p>反面示例：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 仅支持两层嵌套，局限性大</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Columns</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">TableColumnProps</span> {
  <span class="hljs-attr">columns</span>: <span class="hljs-title class_">TableColumnProps</span>[];
}
<span class="hljs-keyword">const</span> <span class="hljs-title class_">MyTable</span> = <span class="hljs-title function_">forwardRef</span>(<span class="hljs-function">(<span class="hljs-params">props, ref</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> { columns = [] } = props;
  <span class="hljs-keyword">const</span> renderColumn = columns.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> {
    <span class="hljs-keyword">return</span> item.<span class="hljs-property">columns</span> ? (
      <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Table.Column</span> {<span class="hljs-attr">...item</span>}&gt;</span>{item.columns.map(col =&gt; <span class="hljs-tag">&lt;<span class="hljs-name">Table.Column</span> {<span class="hljs-attr">...col</span>} /&gt;</span>)}<span class="hljs-tag">&lt;/<span class="hljs-name">Table.Column</span>&gt;</span></span>
    ) : <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Table.Column</span> {<span class="hljs-attr">...item</span>} /&gt;</span></span>;
  });
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Table</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">{ref}</span> {<span class="hljs-attr">...props</span>}&gt;</span>{renderColumn}<span class="hljs-tag">&lt;/<span class="hljs-name">Table</span>&gt;</span></span>;
});
</code></pre>
<p>正面示例：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 递归渲染，支持无限层级</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Columns</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">TableColumnProps</span> {
  <span class="hljs-attr">columns</span>: <span class="hljs-title class_">Columns</span>[]; <span class="hljs-comment">// 继承自身，支持嵌套</span>
}
<span class="hljs-keyword">const</span> <span class="hljs-title function_">MyColumn</span> = (<span class="hljs-params">props: { columns: Columns[] }</span>) =&gt; {
  <span class="hljs-keyword">const</span> { columns = [] } = props;
  <span class="hljs-keyword">return</span> columns.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Table.Column</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{item.key}</span> {<span class="hljs-attr">...item</span>}&gt;</span>
      {item.columns &amp;&amp; <span class="hljs-tag">&lt;<span class="hljs-name">MyColumn</span> <span class="hljs-attr">columns</span>=<span class="hljs-string">{item.columns}</span> /&gt;</span>} {/* 递归渲染 */}
    <span class="hljs-tag">&lt;/<span class="hljs-name">Table.Column</span>&gt;</span></span>
  ));
};
<span class="hljs-keyword">const</span> <span class="hljs-title class_">MyTable</span> = <span class="hljs-title function_">forwardRef</span>(<span class="hljs-function">(<span class="hljs-params">props, ref</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> { columns = [], ...rest } = props;
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Table</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">{ref}</span> {<span class="hljs-attr">...rest</span>}&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">MyColumn</span> <span class="hljs-attr">columns</span>=<span class="hljs-string">{columns}</span> /&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">Table</span>&gt;</span></span>;
});
</code></pre>
<h2 data-id="heading-14">十五、多语言适配：可配置化，兼容国际化</h2>
<p>组件内部所有文案需支持自定义，默认推荐英文，兼容多语言场景。文案较多时，可暴露 <code>strings</code> 对象统一配置。</p>
<p>反面示例：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">MyInput</span>(<span class="hljs-params">props: MyInputProps</span>) {
  <span class="hljs-keyword">const</span> { title = <span class="hljs-string">'标题'</span> } = props;
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>{title}<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>详情<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span> {/* 固定文案，无法国际化 */}
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}
</code></pre>
<p>正面示例：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">MyInput</span>(<span class="hljs-params">props: MyInputProps</span>) {
  <span class="hljs-keyword">const</span> { title = <span class="hljs-string">'Title'</span>, detail = <span class="hljs-string">'Detail'</span> } = props; <span class="hljs-comment">// 支持自定义文案</span>
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>{title}<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>{detail}<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}

<span class="hljs-comment">// 文案较多时，用strings统一配置</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">MyInputProps</span> {
  strings?: {
    <span class="hljs-attr">title</span>: <span class="hljs-built_in">string</span>;
    <span class="hljs-attr">detail</span>: <span class="hljs-built_in">string</span>;
  };
}
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">MyInput</span>(<span class="hljs-params">props: MyInputProps</span>) {
  <span class="hljs-keyword">const</span> { strings = { <span class="hljs-attr">title</span>: <span class="hljs-string">'Title'</span>, <span class="hljs-attr">detail</span>: <span class="hljs-string">'Detail'</span> } } = props;
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>{strings.title}<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>{strings.detail}<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}
</code></pre>
<h2 data-id="heading-15">十六、语义化命名：清晰易懂，降低理解成本</h2>
<p>组件名、API、方法名、变量名都要遵循语义化原则，见名知意。例如：<code>MyInput</code>（输入框组件）、<code>onChange</code>（状态变化事件）、<code>prefixCls</code>（类名前缀），避免模糊命名（如 <code>data1</code>、<code>func2</code>）。</p>
<hr/>
<h3 data-id="heading-16">为什么这些原则能帮你拿下 Offer？</h3>
<p>大厂面试中，“组件设计” 是高频考点，面试官通过你的回答，判断你是否具备工程化思维、代码复用能力和协作意识。能把这 16 条原则融会贯通，不仅能写出高质量代码，面试时还能有条理地阐述设计思路，轻松和其他候选人拉开差距</p>
<h3 data-id="heading-17">前端简历面试辅导+求职陪跑</h3>
<p>如果你想：</p>
<ul>
<li>让简历突出组件设计、工程化等核心亮点，精准匹配大厂 JD；</li>
<li>面试时从容应对组件封装、源码解析等难点问题；</li>
<li>避开求职坑，高效拿到心仪 Offer；</li>
</ul>
<p>我提供「前端简历面试辅导」和「求职陪跑计划」，结合我的一线开发经验和大厂面试逻辑，帮你针对性优化简历、模拟面试、拆解考点，全程陪伴你从求职准备到拿到 Offer，让你少走弯路，早日上岸</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[aosp14分屏分割线区域部分深入剖析-framework实战干货]]></title>    <link>https://juejin.cn/post/7592147054786445363</link>    <guid>https://juejin.cn/post/7592147054786445363</guid>    <pubDate>2026-01-07T02:17:54.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592147054786445363" data-draft-id="7592176349712924710" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="aosp14分屏分割线区域部分深入剖析-framework实战干货"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-07T02:17:54.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="用户8127482815120"/> <meta itemprop="url" content="https://juejin.cn/user/2711830721731422"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            aosp14分屏分割线区域部分深入剖析-framework实战干货
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2711830721731422/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    用户8127482815120
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-07T02:17:54.000Z" title="Wed Jan 07 2026 02:17:54 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">背景：</h2>
<p>原来在学习分屏课程期间，当时没有对分屏分割线的区域部分进行详细介绍。
本篇文章就针对这个块的知识进行详细的补充讲解，首先可以通过下图所示分割线情况，这样有一个初步的认识
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/93799d9868184c38b87f51ae084e2521~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3ODEyNzQ4MjgxNTEyMA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768357074&amp;x-signature=Xv66YBWPp1%2FrmS5qEfm7MGK8aLo%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p>简单说分屏情况下分割线是可以拖拉到不同的档位区域，而且竖屏和横屏的分割线区域还有差别，比如竖屏可以有5分档，而横屏只有3分档。</p>
<p>注意：这个5分档，3分档一般来说包含边际的两个分档，但是边际的分档一般看不见，所以说真的可以见分档线其实都需要减2，比如竖屏可见是3个分割线，横屏1各分割线
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d27a6f4d5334494792c42feed0ba2df6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3ODEyNzQ4MjgxNTEyMA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768357074&amp;x-signature=%2FEyePTDPxkJ21qa%2Bw49tszx%2F%2FP4%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<h2 data-id="heading-1">剖析分割线构建SnapTarget源码</h2>
<p>代码位置：
frameworks/base/core/java/com/android/internal/policy/DividerSnapAlgorithm.java</p>
<p>这个DividerSnapAlgorithm是专门管理分割线位置相关的算法类
分割线的代表类SnapTarget：</p>
<pre><code class="hljs language-cpp" lang="cpp">
    <span class="hljs-comment">/**
     * Represents a snap target for the divider.
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SnapTarget</span> {
        <span class="hljs-keyword">public</span> <span class="hljs-type">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> FLAG_NONE = <span class="hljs-number">0</span>;

        <span class="hljs-comment">/** If the divider reaches this value, the left/top task should be dismissed. */</span>
        <span class="hljs-keyword">public</span> <span class="hljs-type">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> FLAG_DISMISS_START = <span class="hljs-number">1</span>;

        <span class="hljs-comment">/** If the divider reaches this value, the right/bottom task should be dismissed */</span>
        <span class="hljs-keyword">public</span> <span class="hljs-type">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> FLAG_DISMISS_END = <span class="hljs-number">2</span>;

        <span class="hljs-comment">/** Position of this snap target. The right/bottom edge of the top/left task snaps here. */</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> position;

        <span class="hljs-comment">/**
         * Like {@link #position}, but used to calculate the task bounds which might be different
         * from the stack bounds.
         */</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> taskPosition;

        <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> flag;

        <span class="hljs-keyword">public</span> boolean isMiddleTarget;

        <span class="hljs-comment">/**
         * Multiplier used to calculate distance to snap position. The lower this value, the harder
         * it's to snap on this target
         */</span>
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">float</span> distanceMultiplier;

        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">SnapTarget</span><span class="hljs-params">(<span class="hljs-type">int</span> position, <span class="hljs-type">int</span> taskPosition, <span class="hljs-type">int</span> flag)</span> </span>{
            <span class="hljs-built_in">this</span>(position, taskPosition, flag, <span class="hljs-number">1f</span>);
        }

        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">SnapTarget</span><span class="hljs-params">(<span class="hljs-type">int</span> position, <span class="hljs-type">int</span> taskPosition, <span class="hljs-type">int</span> flag, <span class="hljs-type">float</span> distanceMultiplier)</span> </span>{
            <span class="hljs-keyword">this</span>.position = position;
            <span class="hljs-keyword">this</span>.taskPosition = taskPosition;
            <span class="hljs-keyword">this</span>.flag = flag;
            <span class="hljs-keyword">this</span>.distanceMultiplier = distanceMultiplier;
        }
    }

</code></pre>
<p>几个重要参数：</p>
<p>position 即代表分割线位置</p>
<p>flag  主要代表是来针对区分边际分割线，主要有FLAG_DISMISS_START（上）和FLAG_DISMISS_END（下），其他都是FLAG_NONE</p>
<p>distanceMultiplier 这个属于一个放大因子，就是针对首尾分割线的有到达距离的放大，让首尾分割线不会因为不小心误触很容易进入</p>
<p>具体计算分割线方法如下：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-type">void</span> <span class="hljs-title">calculateTargets</span><span class="hljs-params">(boolean isHorizontalDivision, <span class="hljs-type">int</span> dockedSide)</span> </span>{
        mTargets.<span class="hljs-built_in">clear</span>();
        <span class="hljs-type">int</span> dividerMax = isHorizontalDivision
                ? mDisplayHeight
                : mDisplayWidth;
        <span class="hljs-type">int</span> startPos = -mDividerSize;
        <span class="hljs-keyword">if</span> (dockedSide == DOCKED_RIGHT) {
            startPos += mInsets.left;
        }
        <span class="hljs-comment">//首先添加SnapTarget.FLAG_DISMISS_START的SnapTarget</span>
        mTargets.<span class="hljs-built_in">add</span>(<span class="hljs-keyword">new</span> <span class="hljs-built_in">SnapTarget</span>(startPos, startPos, SnapTarget.FLAG_DISMISS_START,
                <span class="hljs-number">0.35f</span>));
        <span class="hljs-keyword">switch</span> (mSnapMode) {<span class="hljs-comment">//这里需要根据mSnapMode来分别创建分割情况</span>
            <span class="hljs-keyword">case</span> SNAP_MODE_16_9:<span class="hljs-comment">//正常竖屏就是SNAP_MODE_16_9，一般会创建3个分割线</span>
                <span class="hljs-built_in">addRatio16_9Targets</span>(isHorizontalDivision, dividerMax);
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> SNAP_FIXED_RATIO:
                <span class="hljs-built_in">addFixedDivisionTargets</span>(isHorizontalDivision, dividerMax);
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> SNAP_ONLY_1_1:<span class="hljs-comment">//正常横屏就是SNAP_ONLY_1_1，所以只有中间一个分割线</span>
                <span class="hljs-built_in">addMiddleTarget</span>(isHorizontalDivision);
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> SNAP_MODE_MINIMIZED:
                <span class="hljs-built_in">addMinimizedTarget</span>(isHorizontalDivision, dockedSide);
                <span class="hljs-keyword">break</span>;
        }
        
        <span class="hljs-comment">//最后添加SnapTarget.FLAG_DISMISS_END的SnapTarget</span>
        mTargets.<span class="hljs-built_in">add</span>(<span class="hljs-keyword">new</span> <span class="hljs-built_in">SnapTarget</span>(dividerMax, dividerMax, SnapTarget.FLAG_DISMISS_END, <span class="hljs-number">0.35f</span>));
    }
</code></pre>
<p>参数isHorizontalDivision，代表是当前分割线是横着显示还是竖着显示，所以这里注意不是指的横竖屏幕，刚好是相反的，竖屏分割线是横着显示isHorizontalDivision =true，横屏isHorizontalDivision=false。</p>
<p>mSnapMode这个变量是在DividerSnapAlgorithm构造时候从res中config获取的
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/87e0707a9f474d6d881de6f9c309286e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3ODEyNzQ4MjgxNTEyMA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768357074&amp;x-signature=mLCeljlt%2BMptkfzZwbOxrjwHhxU%3D" alt="在这里插入图片描述" loading="lazy"/>通过搜索dockedStackDividerSnapMode发现如下：<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d694cb91839740f8908bd780cfa9bc7a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3ODEyNzQ4MjgxNTEyMA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768357074&amp;x-signature=VlqAsD%2FAU4Rc9mBlimumgpW9dTk%3D" alt="在这里插入图片描述" loading="lazy"/>竖屏值一般是0，横屏值一般是2</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c9622e4635fe4210a34b27aea87c0280~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3ODEyNzQ4MjgxNTEyMA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768357074&amp;x-signature=ZNpr1CaprZLOZcDnNFbLyCTsU2k%3D" alt="在这里插入图片描述" loading="lazy"/>
先看看简单的SNAP_ONLY_1_1的实现方法直接就是addMiddleTarget</p>
<pre><code class="hljs language-cpp" lang="cpp">    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-type">void</span> <span class="hljs-title">addMiddleTarget</span><span class="hljs-params">(boolean isHorizontalDivision)</span> </span>{
        <span class="hljs-type">int</span> position = DockedDividerUtils.<span class="hljs-built_in">calculateMiddlePosition</span>(isHorizontalDivision,
                mInsets, mDisplayWidth, mDisplayHeight, mDividerSize);
        mTargets.<span class="hljs-built_in">add</span>(<span class="hljs-keyword">new</span> <span class="hljs-built_in">SnapTarget</span>(position, position, SnapTarget.FLAG_NONE));
    }
   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">static</span> <span class="hljs-type">int</span> <span class="hljs-title">calculateMiddlePosition</span><span class="hljs-params">(boolean isHorizontalDivision, Rect insets,
            <span class="hljs-type">int</span> displayWidth, <span class="hljs-type">int</span> displayHeight, <span class="hljs-type">int</span> dividerSize)</span> </span>{
        <span class="hljs-type">int</span> start = isHorizontalDivision ? insets.top : insets.left;
        <span class="hljs-type">int</span> end = isHorizontalDivision
                ? displayHeight - insets.bottom
                : displayWidth - insets.right;
        <span class="hljs-keyword">return</span> start + (end - start) / <span class="hljs-number">2</span> - dividerSize / <span class="hljs-number">2</span>;
    }
</code></pre>
<p>这里可以看出来就是通过calculateMiddlePosition计算出来中间位置positon，再用这个positon构建对应的SnapTarget添加到mTargets。</p>
<p>同理看看竖屏的3个snap的计算方法addRatio16_9Targets</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-type">void</span> <span class="hljs-title">addRatio16_9Targets</span><span class="hljs-params">(boolean isHorizontalDivision, <span class="hljs-type">int</span> dividerMax)</span> </span>{
    <span class="hljs-type">int</span> start = isHorizontalDivision ? mInsets.top : mInsets.left;
    <span class="hljs-type">int</span> end = isHorizontalDivision
            ? mDisplayHeight - mInsets.bottom
            : mDisplayWidth - mInsets.right;
    <span class="hljs-type">int</span> startOther = isHorizontalDivision ? mInsets.left : mInsets.top;
    <span class="hljs-type">int</span> endOther = isHorizontalDivision
            ? mDisplayWidth - mInsets.right
            : mDisplayHeight - mInsets.bottom;
    <span class="hljs-type">float</span> size = <span class="hljs-number">9.0f</span> / <span class="hljs-number">16.0f</span> * (endOther - startOther);
    <span class="hljs-type">int</span> sizeInt = (<span class="hljs-type">int</span>) Math.<span class="hljs-built_in">floor</span>(size);
    <span class="hljs-type">int</span> topPosition = start + sizeInt;
    <span class="hljs-type">int</span> bottomPosition = end - sizeInt - mDividerSize;
    <span class="hljs-comment">//注意这里计算了topPosition，bottomPosition两个位置，这里就是3分割线的上下分割线位置</span>
    <span class="hljs-built_in">addNonDismissingTargets</span>(isHorizontalDivision, topPosition, bottomPosition, dividerMax);
}

  <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-type">void</span> <span class="hljs-title">addNonDismissingTargets</span><span class="hljs-params">(boolean isHorizontalDivision, <span class="hljs-type">int</span> topPosition,
            <span class="hljs-type">int</span> bottomPosition, <span class="hljs-type">int</span> dividerMax)</span> </span>{
        <span class="hljs-built_in">maybeAddTarget</span>(topPosition, topPosition - <span class="hljs-built_in">getStartInset</span>());
        <span class="hljs-built_in">addMiddleTarget</span>(isHorizontalDivision);
        <span class="hljs-built_in">maybeAddTarget</span>(bottomPosition,
                dividerMax - <span class="hljs-built_in">getEndInset</span>() - (bottomPosition + mDividerSize));
    }
</code></pre>
<p>这里addRatio16_9Targets核心就是计算出来了topPosition，bottomPosition，然后再使用addNonDismissingTargets方法进行构建SnapTarget。</p>
<p>核心看看这里的topPosition，bottomPosition是怎么计算的，刚好也可以解释为啥这里名字有16_9这个字符，其实本质就是计算个topPosition位置，拿竖屏来举例的话，这里因为想要屏幕宽度固定的，为了美观程度，所以一般topPosition这个区域要固定为一个16：9区域</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aaaf50ea96544140a70706cd9baaf569~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3ODEyNzQ4MjgxNTEyMA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768357074&amp;x-signature=nqEWRyzvf0yfCL%2BoJEziszg166w%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p>addNonDismissingTargets方法主要就是有了topPosition，bottomPosition，在额外加上个middle，这样整体3个SnapTarget就构造成功。</p>
<p>创建后的分割线SnapTarget都会被放入到mTargets这个集合中去。</p>
<h2 data-id="heading-2">寻找合适分割线算法</h2>
<p>上面已经分析出了分割线的几个SnapTarget，这些SnapTarget都是有固定位置的，那么接下来分析一下分割线如何到对应的SnapTarget。</p>
<p><strong>外部传递一个比例值情况</strong>
一般这种情况是在启动分屏时候，需要设置好一个上下分屏比例ratio,主要通过如下方法：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">/** Updates divide position and split bounds base on the ratio within root bounds. */</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">void</span> <span class="hljs-title">setDivideRatio</span><span class="hljs-params">(<span class="hljs-type">float</span> ratio)</span> </span>{
    <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> position = <span class="hljs-built_in">isLandscape</span>()
            ? mRootBounds.left + (<span class="hljs-type">int</span>) (mRootBounds.<span class="hljs-built_in">width</span>() * ratio)
            : mRootBounds.top + (<span class="hljs-type">int</span>) (mRootBounds.<span class="hljs-built_in">height</span>() * ratio);
    <span class="hljs-keyword">final</span> DividerSnapAlgorithm.SnapTarget snapTarget =
            mDividerSnapAlgorithm.<span class="hljs-built_in">calculateNonDismissingSnapTarget</span>(position);
    <span class="hljs-built_in">setDividePosition</span>(snapTarget.position, <span class="hljs-literal">false</span> <span class="hljs-comment">/* applyLayoutChange */</span>);
}
</code></pre>
<p>可以看到这里会先根据ratio计算出一个位置position,但是这个position并不是直接的SnapTarget的position，需要把这个position传递到calculateNonDismissingSnapTarget方法计算出SnapTarget，然后在使用SnapTarget的position。
即比如传递ratio进去是0.25，那么计算的position就是2960 * 0.25 = 740，但是正常的top的SnapTarget的position一般是810+84 = 894。
看看这里的calculateNonDismissingSnapTarget方法</p>
<pre><code class="hljs language-cpp" lang="cpp">   <span class="hljs-function"><span class="hljs-keyword">public</span> SnapTarget <span class="hljs-title">calculateNonDismissingSnapTarget</span><span class="hljs-params">(<span class="hljs-type">int</span> position)</span> </span>{
        SnapTarget target = <span class="hljs-built_in">snap</span>(position, <span class="hljs-literal">false</span> <span class="hljs-comment">/* hardDismiss */</span>);<span class="hljs-comment">//主要调用snap</span>
        <span class="hljs-keyword">if</span> (target == mDismissStartTarget) {
            <span class="hljs-keyword">return</span> mFirstSplitTarget;
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (target == mDismissEndTarget) {
            <span class="hljs-keyword">return</span> mLastSplitTarget;
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">return</span> target;
        }
    }
</code></pre>
<p>看看snap方法：</p>
<pre><code class="hljs language-cpp" lang="cpp">    <span class="hljs-function"><span class="hljs-keyword">private</span> SnapTarget <span class="hljs-title">snap</span><span class="hljs-params">(<span class="hljs-type">int</span> position, boolean hardDismiss)</span> </span>{
        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">shouldApplyFreeSnapMode</span>(position)) {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">SnapTarget</span>(position, position, SnapTarget.FLAG_NONE);
        }
        <span class="hljs-type">int</span> minIndex = <span class="hljs-number">-1</span>;
        <span class="hljs-type">float</span> minDistance = Float.MAX_VALUE;
        <span class="hljs-type">int</span> size = mTargets.<span class="hljs-built_in">size</span>();
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; size; i++) {
            SnapTarget target = mTargets.<span class="hljs-built_in">get</span>(i);
            <span class="hljs-type">float</span> distance = Math.<span class="hljs-built_in">abs</span>(position - target.position);
            <span class="hljs-keyword">if</span> (hardDismiss) {
                distance /= target.distanceMultiplier;
            }
            <span class="hljs-keyword">if</span> (distance &lt; minDistance) {<span class="hljs-comment">//这里会计算传递进来position和SnapTarget.position的距离</span>
                minIndex = i;
                minDistance = distance;
            }
        }
        <span class="hljs-keyword">return</span> mTargets.<span class="hljs-built_in">get</span>(minIndex);
    }

</code></pre>
<p>这里snap方法本质就是根据传递进来的position，与mTargets集合的所有position进行比较距离，离谁最近就选谁。</p>
<p>更多framework请关注“千里马学框架”</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[🎉历时1年，TinyEditor v4.0 正式发布！]]></title>    <link>https://juejin.cn/post/7592089325913522176</link>    <guid>https://juejin.cn/post/7592089325913522176</guid>    <pubDate>2026-01-07T02:28:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592089325913522176" data-draft-id="7591465142452469812" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="🎉历时1年，TinyEditor v4.0 正式发布！"/> <meta itemprop="keywords" content="前端,TypeScript,开源"/> <meta itemprop="datePublished" content="2026-01-07T02:28:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="前端开源星球"/> <meta itemprop="url" content="https://juejin.cn/user/1504599026445150"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            🎉历时1年，TinyEditor v4.0 正式发布！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1504599026445150/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    前端开源星球
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-07T02:28:46.000Z" title="Wed Jan 07 2026 02:28:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>你好，我是 Kagol，个人公众号：<code>前端开源星球</code>。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fopentiny.github.io%2Ftiny-editor%2F" target="_blank" title="https://opentiny.github.io/tiny-editor/" ref="nofollow noopener noreferrer">TinyEditor</a> 是一个基于 Quill 2.0 的富文本编辑器，在 Quill 基础上扩展了丰富的模块和格式，框架无关、功能强大、开箱即用。</p>
<ul>
<li>源码：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fopentiny%2Ftiny-editor%2F" target="_blank" title="https://github.com/opentiny/tiny-editor/" ref="nofollow noopener noreferrer">github.com/opentiny/ti…</a></li>
<li>官网：<a href="https://link.juejin.cn?target=https%3A%2F%2Fopentiny.github.io%2Ftiny-editor%2F" target="_blank" title="https://opentiny.github.io/tiny-editor/" ref="nofollow noopener noreferrer">opentiny.github.io/tiny-editor…</a></li>
</ul>
<p>去年1月2日，我们发布了 v3.25 版本，功能基本已经完备，之后 v3.x 版本进入了维护期，同时开启了漫长的 v4.0 版本的开发，v4.0 的核心目标是体验优化和稳定性提升，并支持多人协同编辑。</p>
<p>在长达1年的开发和打磨后，我们荣幸地宣布 <strong>TinyEditor v4.0</strong> 正式发布！这个版本汇聚了团队的心血，带来了激动人心多人协同编辑新功能、以及大量体验优化和稳定性改进。</p>
<p>重点特性：</p>
<ul>
<li>支持多人协同编辑：一起在编辑器写（玩）文档（贪吃蛇游戏摸鱼）🐶</li>
<li>基于 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fquill-modules%2Fquill-table-up" target="_blank" title="https://github.com/quill-modules/quill-table-up" ref="nofollow noopener noreferrer">quill-table-up</a> 的新表格方案：表格操作体验++⚡️</li>
<li>基于 <code>emoji-mart</code> 的 Emoji 表情：表情党最爱😍</li>
<li>支持斜杆菜单和丰富的快捷键：键盘流的福音😄</li>
<li>图片/视频/文件上传体验优化🌄</li>
</ul>
<p>详细的 Release Notes 请参考：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fopentiny%2Ftiny-editor%2Freleases%2Ftag%2Fv4.0.0" target="_blank" title="https://github.com/opentiny/tiny-editor/releases/tag/v4.0.0" ref="nofollow noopener noreferrer">github.com/opentiny/ti…</a></p>
<p>欢迎安装 v4.0 版本体验：</p>
<pre><code class="hljs language-shell" lang="shell">npm i @opentiny/fluent-editor@4.0.0
</code></pre>
<h2 data-id="heading-0">1 亮点特性</h2>
<h3 data-id="heading-1">1.1 多人协作编辑</h3>
<p>v4.0 最重磅的功能之一是引入了<strong>完整的协作编辑能力</strong>。我们集成了 quill-cursor 模块，支持多人实时协作编辑，并提供了独立的 npm 包供开发者集成。无论是需要离线支持还是云端协作，TinyEditor 都能胜任。</p>
<p>你可以在我们的演示项目中进行体验：<a href="https://link.juejin.cn?target=https%3A%2F%2Fopentiny.github.io%2Ftiny-editor%2Fprojects%2F" target="_blank" title="https://opentiny.github.io/tiny-editor/projects/" ref="nofollow noopener noreferrer">opentiny.github.io/tiny-editor…</a></p>
<p>效果如下：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5f5877094758471cae8f5098e8a82052~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5byA5rqQ5pif55CD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768357725&amp;x-signature=cxikW09j%2BhFqcFJ5WIYxzOya0Bg%3D" alt="TinyEditor 协同编辑效果" loading="lazy"/></p>
<p>关于协同编辑更详细的介绍，参考：<a href="https://juejin.cn/post/7565940210149064756" target="_blank" title="https://juejin.cn/post/7565940210149064756">如何使用 TinyEditor 快速部署一个多人协同富文本编辑器？</a></p>
<h3 data-id="heading-2">1.2 表格能力升级</h3>
<p>集成了 <strong>table-up</strong> 模块，大幅提升了表格编辑和操作能力，支持更复杂的表格场景。</p>
<p>体验地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fopentiny.github.io%2Ftiny-editor%2Fdocs%2Fdemo%2Ftable-up" target="_blank" title="https://opentiny.github.io/tiny-editor/docs/demo/table-up" ref="nofollow noopener noreferrer">opentiny.github.io/tiny-editor…</a></p>
<p>效果如下：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0dbc39ec97f244b9b259517aacb4d683~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5byA5rqQ5pif55CD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768357725&amp;x-signature=eSdfQ63Xv54PUxK3QR5YqdWONn4%3D" alt="TinyEditor 表格模块效果" loading="lazy"/></p>
<p>详细介绍可以参考之前的文章：<a href="https://juejin.cn/post/7527182608340484139#heading-0" target="_blank" title="https://juejin.cn/post/7527182608340484139#heading-0">更强大的表格</a></p>
<h3 data-id="heading-3">1.3 更丰富的 Emoji 表情😘</h3>
<ul>
<li>集成 <strong>emoji-mart</strong>，提供丰富的表情选择</li>
<li>修复了插入表情后的光标位置问题</li>
<li>完善了表情插入的交互体验</li>
</ul>
<p>体验地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fopentiny.github.io%2Ftiny-editor%2Fdocs%2Fdemo%2Femoji" target="_blank" title="https://opentiny.github.io/tiny-editor/docs/demo/emoji" ref="nofollow noopener noreferrer">opentiny.github.io/tiny-editor…</a></p>
<p>效果如下：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a7b7f590ed114d46b5fb1185f6537854~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5byA5rqQ5pif55CD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768357725&amp;x-signature=ntI6K0zJVyK6vear4RUpXOodM1Y%3D" alt="TinyEditor Emoji 表情" loading="lazy"/></p>
<p>详细介绍可以参考之前的文章：<a href="https://juejin.cn/post/7527182608340484139#heading-1" target="_blank" title="https://juejin.cn/post/7527182608340484139#heading-1">更丰富的表情</a></p>
<h3 data-id="heading-4">1.4 快捷键和快速菜单</h3>
<p>新增了强大的快捷键系统和快速菜单功能，让高级用户能够更高效地操作编辑器。</p>
<p>体验地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fopentiny.github.io%2Ftiny-editor%2Fprojects%2F" target="_blank" title="https://opentiny.github.io/tiny-editor/projects/" ref="nofollow noopener noreferrer">opentiny.github.io/tiny-editor…</a></p>
<p>效果如下：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/addf8f3ab20b4b74b371eb45300968e3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5byA5rqQ5pif55CD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768357725&amp;x-signature=EL%2F7o4la6ffhzn2%2FlZ7nNV5uSsk%3D" alt="快捷键.gif" loading="lazy"/></p>
<h3 data-id="heading-5">1.5 颜色选择器升级</h3>
<p>自定义颜色选择器现在能保存当前选择，并支持添加更多颜色。</p>
<p>效果如下：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a40da4b35d2543c6bff39fbf1a61c66a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5byA5rqQ5pif55CD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768357725&amp;x-signature=DMZbLG7yeY8wVbjPi%2Fkb8VpOGDE%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-6">1.6 文本模板与国际化</h3>
<ul>
<li>支持 i18n 文本模板替换</li>
<li>完善了国际化翻译（header、picker 等组件）</li>
<li>更好的多语言支持体验</li>
</ul>
<h3 data-id="heading-7">1.7 图片和文件增强</h3>
<ul>
<li><strong>图片工具栏</strong>：选中图片时显示专门的操作工具栏</li>
<li><strong>自定义上传</strong>：增加 <code>allowInvalidUrl</code> 选项，支持 Electron 等特定场景</li>
<li><strong>改进的上传逻辑</strong>：优化了失败状态的处理</li>
</ul>
<h2 data-id="heading-8">2 技术改进</h2>
<h3 data-id="heading-9">2.1 构建和工程化</h3>
<ul>
<li>修复了 SSR 构建问题</li>
<li>优化了 Vite 配置，解决了 PostCSS 和 Tailwind 的兼容性问题</li>
<li>改进了 SCSS 文件引入方式</li>
<li>输出文件名称优化</li>
</ul>
<h3 data-id="heading-10">2.2 依赖管理</h3>
<ul>
<li>外部化 emoji-mart 和 floating-ui 依赖，减少包体积</li>
<li>移除了 better-table 和 lodash-es，优化依赖树</li>
</ul>
<h3 data-id="heading-11">2.3 代码质量</h3>
<ul>
<li>完整的测试覆盖率提升</li>
<li>重构优化：移除冗余代码</li>
<li>API 标准化：<code>scrollIntoView</code> → <code>scrollSelectionIntoView</code></li>
<li>示例代码 <code>async/await</code> 改造，代码现代化</li>
</ul>
<h3 data-id="heading-12">2.4 类型安全</h3>
<ul>
<li>修复了因 TypeScript 类型导致的编译错误</li>
<li>改进了类型定义</li>
</ul>
<h3 data-id="heading-13">2.5 API 导出增强</h3>
<p>v4.0 导出了工具栏配置常量，方便开发者定制：</p>
<ul>
<li><code>DEFAULT_TOOLBAR</code>：默认工具栏配置</li>
<li><code>FULL_TOOLBAR</code>：完整工具栏配置</li>
</ul>
<h3 data-id="heading-14">2.6 增加自动发包工作流</h3>
<ul>
<li>增加 auto-publish / auto-deploy 等自动化工作流，支持打 tag 之后自动发版本、生成 Release Notes</li>
<li>PR 门禁在单元测试基础上增加 npm 包和网站构建，确保合入 PR 之前，npm 包构建和网站构建是正常的，通过自动化方式保障版本质量。</li>
</ul>
<h2 data-id="heading-15">3 问题修复</h2>
<p>v4.0 修复了大量已知问题，包括：</p>
<ul>
<li>工具栏选择器不跟随光标变化的问题</li>
<li>行高作用域问题</li>
<li>列表样式显示不正确</li>
<li>背景色 SVG 图标问题</li>
<li>VitePress 默认样式影响的问题</li>
<li>自定义上传失败时表格数据结构破坏的问题</li>
<li>多项文档和国际化翻译问题</li>
</ul>
<h2 data-id="heading-16">4 社区贡献</h2>
<p>感谢所有为 v4.0 做出贡献的开发者！你们的辛勤付出让 TinyEditor 变得更好！</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fchenxi-20" target="_blank" title="https://github.com/chenxi-20" ref="nofollow noopener noreferrer">@chenxi-20</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FGaoNeng-wWw" target="_blank" title="https://github.com/GaoNeng-wWw" ref="nofollow noopener noreferrer">@GaoNeng-wWw</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fjany55555" target="_blank" title="https://github.com/jany55555" ref="nofollow noopener noreferrer">@jany55555</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fqwangry" target="_blank" title="https://github.com/qwangry" ref="nofollow noopener noreferrer">@qwangry</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fshenyaofeng" target="_blank" title="https://github.com/shenyaofeng" ref="nofollow noopener noreferrer">@shenyaofeng</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fvaebe" target="_blank" title="https://github.com/vaebe" ref="nofollow noopener noreferrer">@vaebe</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fwuyiping0628" target="_blank" title="https://github.com/wuyiping0628" ref="nofollow noopener noreferrer">@wuyiping0628</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FYinlin124" target="_blank" title="https://github.com/Yinlin124" ref="nofollow noopener noreferrer">@Yinlin124</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fzzxming" target="_blank" title="https://github.com/zzxming" ref="nofollow noopener noreferrer">@zzxming</a></li>
</ul>
<blockquote>
<p>注：排名不分先后，按名字首字母排序。</p>
</blockquote>
<p>如果你有任何建议或反馈，欢迎通过 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fopentiny%2Ftiny-editor%2Fissues" target="_blank" title="https://github.com/opentiny/tiny-editor/issues" ref="nofollow noopener noreferrer">GitHub Issues</a> 与我们联系。</p>
<h2 data-id="heading-17">往期推荐文章</h2>
<ul>
<li><a href="https://juejin.cn/post/7403618336952418314" target="_blank" title="https://juejin.cn/post/7403618336952418314">👍TinyEditor：一个基于 Quill 2.0 的富文本编辑器，功能强大、开箱即用！</a></li>
<li><a href="https://juejin.cn/post/7430505409176289320" target="_blank" title="https://juejin.cn/post/7430505409176289320">🎈TinyEditor 富文本开源2个月的总结：增加格式刷、截屏、TypeScript 类型声明等新特性</a></li>
<li><a href="https://juejin.cn/post/7436030236784214068" target="_blank" title="https://juejin.cn/post/7436030236784214068">🥳重磅更新！TinyEditor 开源富文本支持 LaTeX 可编辑公式啦~</a></li>
<li><a href="https://juejin.cn/post/7406347285901426728" target="_blank" title="https://juejin.cn/post/7406347285901426728">🎉喜报！TinyEditor 开源富文本迎来了第一位贡献者</a></li>
<li><a href="https://juejin.cn/post/7442330442606051338" target="_blank" title="https://juejin.cn/post/7442330442606051338">👏让我们一起来建设 TinyEditor 开源富文本编辑器吧！</a></li>
<li><a href="https://juejin.cn/post/7455243039655067657" target="_blank" title="https://juejin.cn/post/7455243039655067657">✨TinyEditor v3.25.0 正式发布！2025年第一个版本，增加标题列表导航、分隔线等实用特性</a></li>
<li><a href="https://juejin.cn/post/7527182608340484139" target="_blank" title="https://juejin.cn/post/7527182608340484139">⚡️TinyEditor v4.0 alpha 版本发布：更强大的表格、更丰富的表情、更好的上传体验</a></li>
</ul>
<h2 data-id="heading-18">联系我们</h2>
<p>GitHub：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fopentiny%2Ftiny-editor" target="_blank" title="https://github.com/opentiny/tiny-editor" ref="nofollow noopener noreferrer">github.com/opentiny/ti…</a>（欢迎 Star ⭐）</p>
<p>官网：<a href="https://link.juejin.cn?target=https%3A%2F%2Fopentiny.github.io%2Ftiny-editor" target="_blank" title="https://opentiny.github.io/tiny-editor" ref="nofollow noopener noreferrer">opentiny.github.io/tiny-editor</a></p>
<p>个人博客：<a href="https://link.juejin.cn?target=https%3A%2F%2Fkagol.github.io%2Fblogs%2F" target="_blank" title="https://kagol.github.io/blogs/" ref="nofollow noopener noreferrer">kagol.github.io/blogs/</a></p>
<p>小助手微信：opentiny-official</p>
<p>公众号：OpenTiny</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[JS中 escape urlencodeComponent urlencode 区别]]></title>    <link>https://juejin.cn/post/7592147054786576435</link>    <guid>https://juejin.cn/post/7592147054786576435</guid>    <pubDate>2026-01-07T02:33:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592147054786576435" data-draft-id="7592176349713006630" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="JS中 escape urlencodeComponent urlencode 区别"/> <meta itemprop="keywords" content="前端,JavaScript"/> <meta itemprop="datePublished" content="2026-01-07T02:33:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="小王和八蛋"/> <meta itemprop="url" content="https://juejin.cn/user/1658510348133944"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            JS中 escape urlencodeComponent urlencode 区别
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1658510348133944/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    小王和八蛋
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-07T02:33:56.000Z" title="Wed Jan 07 2026 02:33:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252b3a}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px;color:#5e7ce0}.markdown-body h1{font-size:24px;margin-bottom:5px;margin-top:80px;position:relative;text-align:center}.markdown-body h2{font-size:20px;padding-bottom:12px;border-bottom:1px solid #dfe1e6}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h4{font-size:16px;margin-top:30px}.markdown-body h5{font-size:14px;margin-top:20px}.markdown-body h6{font-size:14px;margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #dfe1e6;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#ffeeed;color:#c73636;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#252b3a;background:#f8f8f8}.markdown-body a{position:relative;text-decoration:none;color:#5e7ce0;padding-right:18px;padding-bottom:4px}.markdown-body a[href^=http]:after{position:absolute;display:inline-block;width:16px;height:16px;margin-left:2px;margin-top:6px;content:"";background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAIRlWElmTU0AKgAAAAgABQESAAMAAAABAAEAAAEaAAUAAAABAAAASgEbAAUAAAABAAAAUgEoAAMAAAABAAIAAIdpAAQAAAABAAAAWgAAAAAAAABIAAAAAQAAAEgAAAABAAOgAQADAAAAAQABAACgAgAEAAAAAQAAACCgAwAEAAAAAQAAACAAAAAAX7wP8AAAAAlwSFlzAAALEwAACxMBAJqcGAAAAVlpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IlhNUCBDb3JlIDYuMC4wIj4KICAgPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICAgICAgPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIKICAgICAgICAgICAgeG1sbnM6dGlmZj0iaHR0cDovL25zLmFkb2JlLmNvbS90aWZmLzEuMC8iPgogICAgICAgICA8dGlmZjpPcmllbnRhdGlvbj4xPC90aWZmOk9yaWVudGF0aW9uPgogICAgICA8L3JkZjpEZXNjcmlwdGlvbj4KICAgPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KGV7hBwAABWVJREFUWAnlVktsVFUY/s85997pC9BOTKxRWnEKsXWlxjWJj0RWJjrFAAXjAlewYWOkgauACVu7a2IiNUEyExM3yoZE3Wmi7qgPJthJBDE6JUNpO3Mf5/j95/bOTOcBlBgXejJ37rn/Of/7O/9/iP7vQ/zTAcjnC4ry+a5ii1OkiYTpuvjvEc0Gp51uivP+ZW+QBuSW4QjW5rptAa1Ey0uOGKOxwPetVyafN6p/52/PkNBbjdAhGaGEpMRjLZTryB8+9MUSYSGNRIcBvm8kBAY9tHYlHz78nTs392xIkwv9FA3Oe33bdoX1ZZKOS0bH0CXI6RugYLW6BwIu5gskkQ4sEG0wYF25PjBzbZfSYY6kDLUmWMt7FR7Lw3xYUkaTdjxHfTPnPwav0iEGYADVa9XIRIEyxrAA0jIQxgFL22gYwF7A8/DAzNVdksJvJaTEUZ2kYnZWziN5s1ADPHneEIXByotYuMSrf9JEbbsuv7VcvbaKML8plXtQR0EdIYDqWEmtOgAomZFH8EjWSnek2ulmtljljttHbmaIHCCCHzd9MjwfsmscBeZH9Jyd10nMvz92UQrtCBKvMF06mQy0SiEdRMEGg8mN0YjAlgoDDkPrMI5qJKSkKKydpbB2CZjJkhIBvOBw2CGQgii85bpx//dMqFRKam5uvH7w+K97oe+Cl0HO68uIBH0qyEzpOMwIbZIcFq0I+9cwoElizCjk2KFI1y7Nnx614W1db58fOXIlMzs7Xn/jeDmvBV2Q0mXjGf554O/m4LZHp2N8r61WPMvLZWLdiC4GMAk5BjeeB5lhv39l6+BIbu3m760hXMDKBD08XBKzR8fr04nygnIypOOAJUx/fHrsi0Mnys+vVK+V4VUohaiyPCo2Q9DFALvF/ikw8WS4QvVZALS5ksw47/7R8ejgTPk1UFqU6/3zp8bOM7B/kdu/fkguPGU5JibW+F0sTjWOUw8DklRrg4BiLGeBqbaRLxjlT4no0InFV402RcftJz41cH/f/JnHP3kZaaF6VX/liwist9vYG5+NU9Cg3MNkt/+lU5wS8fTxq3mc7ILjDlAE4CJpe89BOWPiIjBhi9O6PI4G1jsc6RGB3lZwmS76k8H0zOKTkFboG8jS2krFKCX2fvTeaPHIBwAkMHHgncURnL3nuCSnxSopdIzN5th0BIonJ0Lf9yUA9iMkzdRWl3BixOusfDcwQVcS4UKIFwYfGPnM8wY/DyP9NFMXaTE5BU39tGkDgGZz+fJJG0oYcSaOafLcqdECY4LzfSObSzyUOgxqtyisr8SSNOOAkubWoh3TTaeA2YtFEXPnm5x81/j+6MI6JqyS25WSNU6hbCMKHG84marJbdR+vwakRhQLRuQpbzHRLjmpmijI+OmWCtq+LzWtnX5v30gHSsqmWne74DtiACi2+Wz0iXbuLt9D2cDyoPEkWOiyp5XUIwLMi/wJY1FbH5B9ONtdC1KrsD/Q0MCQAS0wccILORDW25amAeOtooAj/KQxfzF17uwTSQ1v3dJ7jnLINwdZYRDa4tPU0sHVXFo/vxFF5BqFqxRfOmgPCk4ft2NgKTCy2Y47JIEg+MIhjYsLy5I25qUYTQlCjMRHsr/UwdYwIK33UO1J5fFNB9XNO6akcywJofVmXQDP2wfrSPcI2xG5BSs3I+IosHr4EtvO1TDAu16xHQq5+ykMblfRXLbhEoFIdDTBdhldvzl+3CMg60ZktI2vNzLW6IIp0waLklot9L63yzuUp8dJd7bglPFe3hIXstBEP58/s6Ocyr4rH2+866ZNbriTzA0RSOWCwakMl1QJgculxPt8Z7O5GLdtW6bvU8R/nO1vb+hMExVAVtEAAAAASUVORK5CYII=");background-size:100%}.markdown-body a:active,.markdown-body a:hover{border-bottom:2px solid #5e7ce0}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #5e7ce0;border-spacing:0}.markdown-body thead{color:#fff;text-align:left}.markdown-body thead tr{background:#5e7ce0}.markdown-body thead th{border-bottom:1px solid #dfe1e6}.markdown-body tr{background-color:#fff}.markdown-body tr:nth-child(2n){background-color:#f2f5fc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#252b3a;padding:1px 23px;margin:22px 0;border-left:4px solid #5e7ce0;background-color:#f2f5fc}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{padding-left:10px;margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#5e7ce0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body ul li::marker{content:"•";color:#5e7ce0}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}.markdown-body input[type=checkbox]:before{display:inline-block;width:16px;height:16px;content:"";background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEIAAABCCAYAAADjVADoAAAK2GlDQ1BJQ0MgUHJvZmlsZQAASImVlwdUU9kWhs+96Y0WiHRC70gngJTQQxGkg6iEJJBQYkgIKmJnUMGxoCKCZcSKKFhGQMaCWLANAopdJ8igoD4HC6Ki5t3AI8zMW++99fZaJ+dbO/vss/e55671XwAoYWyRKBdWAyBPWCCODQ2gJ6ek0nHPAQRgQAI2wIHNkYiYMTGRALHJ+a/28S4Sjdhte0Wuf///v5oGlyfhAAClIZzBlXDyEG5DxkuOSFwAAOoI4jddUCBScBfCmmKkQIR/V3DWBH9ScMY4o8njMfGxgQjTAcCT2WxxFgBkO8RPL+RkIXnIih4chVyBEOFihH05fDYX4TMI2+XlzVfwIMJWSLwIAApyOoCR8aecWX/Jn6HMz2ZnKXmir3HDBwkkolz2ov/zaP635eVKJ/ewQAaZLw6LVeyHnN/9nPkRShZmzIyeZAF3oiYF86VhCZPMkQSmTjKXHRShXJs7M3KSMwUhLGWeAlb8JPMkwXGTLJ4fq9wrUxzInGS2eHxfIsIyaU6C0s/nsZT5i/jxSZNcKEicOcmSnLiIqZhApV8sjVXWzxOGBkztG6LsPU/yp34FLOXaAn58mLJ39lT9PCFzKqckWVkblxcUPBWToIwXFQQo9xLlxijjebmhSr+kME65tgC5nFNrY5RnmM0Oj5lkIABRgA04dNVJAqCAt7BA0UjgfNEisSCLX0BnIm8bj84Schzs6M6Ozs4AKN7dievwnjb+TkK061O+NYjHr10ul5+e8oUi9/i4KfJYbk35LCsAUNUD4Op+jlRcOOFDK34wyNNTBZpABxgCU2AF7IEzcAfewB8Eg3AQDeJBCpiL1MoHeUAMFoBisAKUgnKwEWwF1WA32AsOgaPgBGgGZ8AFcAXcAF2gFzwCMjAAXoFh8BGMQRCEgygQFdKBjCBzyBZyhhiQLxQMRUKxUAqUDmVBQkgKFUOroHKoAqqG9kB10HHoNHQBugZ1Qw+gPmgIegd9gVEwGdaEDWALeDrMgJlwBBwPz4Gz4Hy4CC6B18NVcC18BG6CL8A34F5YBr+CR1AARULRUMYoexQDFYiKRqWiMlFi1FJUGaoSVYtqQLWiOlC3UTLUa9RnNBZNRdPR9mhvdBg6Ac1B56OXotehq9GH0E3oS+jb6D70MPo7hoLRx9hivDAsTDImC7MAU4qpxBzAnMJcxvRiBjAfsVgsDWuJ9cCGYVOw2djF2HXYndhGbBu2G9uPHcHhcDo4W5wPLhrHxhXgSnHbcUdw53E9uAHcJzwJb4R3xofgU/FC/Ep8Jf4w/hy+B/8CP0ZQI5gTvAjRBC5hEWEDYR+hlXCLMEAYI6oTLYk+xHhiNnEFsYrYQLxMfEx8TyKRTEiepFkkAWk5qYp0jHSV1Ef6TNYg25ADyWlkKXk9+SC5jfyA/J5CoVhQ/CmplALKekod5SLlKeWTClXFQYWlwlVZplKj0qTSo/JGlaBqrspUnatapFqpelL1luprNYKahVqgGlttqVqN2mm1e2oj6lR1J/Vo9Tz1deqH1a+pD2rgNCw0gjW4GiUaezUuavRTUVRTaiCVQ11F3Ue9TB3QxGpaarI0szXLNY9qdmoOa2louWolai3UqtE6qyWjoWgWNBYtl7aBdoJ2l/ZlmsE05jTetLXTGqb1TBvV1tP21+Zpl2k3avdqf9Gh6wTr5Ohs0mnWeaKL1rXRnaW7QHeX7mXd13qaet56HL0yvRN6D/VhfRv9WP3F+nv1b+qPGBgahBqIDLYbXDR4bUgz9DfMNtxieM5wyIhq5GskMNpidN7oJV2LzqTn0qvol+jDxvrGYcZS4z3GncZjJpYmCSYrTRpNnpgSTRmmmaZbTNtNh82MzKLMis3qzR6aE8wZ5nzzbeYd5qMWlhZJFqstmi0GLbUtWZZFlvWWj60oVn5W+Va1VnessdYM6xzrndZdNrCNmw3fpsbmli1s624rsN1p222HsfO0E9rV2t2zJ9sz7Qvt6+37HGgOkQ4rHZod3kw3m546fdP0junfHd0ccx33OT5y0nAKd1rp1Or0ztnGmeNc43zHheIS4rLMpcXlrautK891l+t9N6pblNtqt3a3b+4e7mL3BvchDzOPdI8dHvcYmowYxjrGVU+MZ4DnMs8znp+93L0KvE54/eFt753jfdh7cIblDN6MfTP6fUx82D57fGS+dN903598ZX7Gfmy/Wr9n/qb+XP8D/i+Y1sxs5hHmmwDHAHHAqYDRQK/AJYFtQaig0KCyoM5gjeCE4OrgpyEmIVkh9SHDoW6hi0PbwjBhEWGbwu6xDFgcVh1rONwjfEn4pQhyRFxEdcSzSJtIcWRrFBwVHrU56vFM85nCmc3RIJoVvTn6SYxlTH7ML7Ows2Jm1cx6HusUWxzbEUeNmxd3OO5jfED8hvhHCVYJ0oT2RNXEtMS6xNGkoKSKJFny9OQlyTdSdFMEKS2puNTE1AOpI7ODZ2+dPZDmllaadneO5ZyFc67N1Z2bO/fsPNV57Hkn0zHpSemH07+yo9m17JEMVsaOjGFOIGcb5xXXn7uFO8Tz4VXwXmT6ZFZkDmb5ZG3OGuL78Sv5rwWBgmrB2+yw7N3ZoznROQdz5LlJuY15+Lz0vNNCDWGO8NJ8w/kL53eLbEWlIlm+V/7W/GFxhPiABJLMkbQUaCIi6abUSvqDtK/Qt7Cm8NOCxAUnF6ovFC68uchm0dpFL4pCivYvRi/mLG4vNi5eUdy3hLlkz1JoacbS9mWmy0qWDSwPXX5oBXFFzopfVzqurFj5YVXSqtYSg5LlJf0/hP5QX6pSKi69t9p79e416DWCNZ1rXdZuX/u9jFt2vdyxvLL86zrOuus/Ov1Y9aN8feb6zg3uG3ZtxG4Ubry7yW/ToQr1iqKK/s1Rm5u20LeUbfmwdd7Wa5Wulbu3EbdJt8mqIqtatptt37j9azW/urcmoKZxh/6OtTtGd3J39uzy39Ww22B3+e4vPwl+ur8ndE9TrUVt5V7s3sK9z/cl7uvYz9hfd0D3QPmBbweFB2WHYg9dqvOoqzusf3hDPVwvrR86knak62jQ0ZYG+4Y9jbTG8mPgmPTYy+Ppx++eiDjRfpJxsuFn8593nKKeKmuCmhY1DTfzm2UtKS3dp8NPt7d6t576xeGXg2eMz9Sc1Tq74RzxXMk5+fmi8yNtorbXF7Iu9LfPa390MfninUuzLnVejrh89UrIlYsdzI7zV32unrnmde30dcb15hvuN5puut089avbr6c63Tubbnncauny7GrtntF9rsev58LtoNtX7rDu3Oid2dt9N+Hu/Xtp92T3ufcHH+Q+ePuw8OHYo+WPMY/Lnqg9qXyq/7T2N+vfGmXusrN9QX03n8U9e9TP6X/1u+T3rwMlzynPK18YvagbdB48MxQy1PVy9suBV6JXY69L/6H+jx1vrN78/If/HzeHk4cH3orfyt+te6/z/uAH1w/tIzEjTz/mfRwbLfuk8+nQZ8bnji9JX16MLfiK+1r1zfpb6/eI74/leXK5iC1mj0sBFDLgzEwA3h1EtHEKAFRElxNnT2jrcYMmvgfGCfwnntDf4+YOQAMyKWQR0x+Akwo5i8wqyKyQRPH+AHZxUY5/mSTTxXkiFxlRlphPcvl7AwBwrQB8E8vlYzvl8m/7kGIfANCWP6HpFYZFtHyD3vJRg6LbPe3g7zah9//U499noKjAFfx9/ieoZhkWVvYkwwAAAGxlWElmTU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAIdpAAQAAAABAAAATgAAAAAAAACQAAAAAQAAAJAAAAABAAKgAgAEAAAAAQAAAEKgAwAEAAAAAQAAAEIAAAAAgodoEQAAAAlwSFlzAAAWJQAAFiUBSVIk8AAAAhRJREFUeAHtnLEuBFEUhs9cu7JCskEhIrZAgYZGoREPwBuIygOoPITKA6jEG/AAolFoaFCgICIKZBNiY8Pyz5rNOWe9wNz5T7N3Z2eT/b/7zZlpziat3xKWBDJoEyh5EDd3DTk5r8vV7Yc8vzbl6zvfwvSERIYHyzI90SeLc1WZrFV85PR9oi+N/YMnOT6t/3tiLAeXFqqytjrSFacDYmfvQS6u37tOiPHA7FS/bK6PmWhpj4AJRYGA9MiKzLpK6An+cqiNVmRleUhArrec6PNzt/5sttLgh0cvcvfY6Px+ZNY9I6Ax6gKErY1xmZ8ZyD0E5MJGIgsyIZsunT3g7qALJuTdAp0nWyMTsunS2QNukbpwOcRaPpvOHvxzQow2ZBvrs+nsfLL8o0QQBJFdMO1XGkEjaIQlQCMsD/YIGkEjLAEaYXmwR9AIGmEJ0AjLgz2CRtAIS4BGWB7sETSCRlgCNMLyYI+gETTCEqARlgd7BI2gEZYAjbA82CNoBI2wBGiE5cEeQSNohCVAIywP9ggaQSMsARphebBH0AgaYQnQCMsjYC5SF2agYi2fTWcPGA7VFfO0n8+mswdMyOrCNJwnpz/P6xqZkE2Xzh4w8qcLI4Hbu/dydvkWBRAAQBZk0uOOyKyzp5PARRiF1puNtR+NTh+oMCvtJ+D8F2N6j6x+PrwzG46gRTDDm5BtsAGBg0X924Qfj7i23p7HNgQAAAAASUVORK5CYII=");background-size:100%;position:relative;right:2px;top:-5px}.markdown-body input[type=checkbox]:checked:before{background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEIAAABCCAYAAADjVADoAAAK2GlDQ1BJQ0MgUHJvZmlsZQAASImVlwdUU9kWhs+96Y0WiHRC70gngJTQQxGkg6iEJJBQYkgIKmJnUMGxoCKCZcSKKFhGQMaCWLANAopdJ8igoD4HC6Ki5t3AI8zMW++99fZaJ+dbO/vss/e55671XwAoYWyRKBdWAyBPWCCODQ2gJ6ek0nHPAQRgQAI2wIHNkYiYMTGRALHJ+a/28S4Sjdhte0Wuf///v5oGlyfhAAClIZzBlXDyEG5DxkuOSFwAAOoI4jddUCBScBfCmmKkQIR/V3DWBH9ScMY4o8njMfGxgQjTAcCT2WxxFgBkO8RPL+RkIXnIih4chVyBEOFihH05fDYX4TMI2+XlzVfwIMJWSLwIAApyOoCR8aecWX/Jn6HMz2ZnKXmir3HDBwkkolz2ov/zaP635eVKJ/ewQAaZLw6LVeyHnN/9nPkRShZmzIyeZAF3oiYF86VhCZPMkQSmTjKXHRShXJs7M3KSMwUhLGWeAlb8JPMkwXGTLJ4fq9wrUxzInGS2eHxfIsIyaU6C0s/nsZT5i/jxSZNcKEicOcmSnLiIqZhApV8sjVXWzxOGBkztG6LsPU/yp34FLOXaAn58mLJ39lT9PCFzKqckWVkblxcUPBWToIwXFQQo9xLlxijjebmhSr+kME65tgC5nFNrY5RnmM0Oj5lkIABRgA04dNVJAqCAt7BA0UjgfNEisSCLX0BnIm8bj84Schzs6M6Ozs4AKN7dievwnjb+TkK061O+NYjHr10ul5+e8oUi9/i4KfJYbk35LCsAUNUD4Op+jlRcOOFDK34wyNNTBZpABxgCU2AF7IEzcAfewB8Eg3AQDeJBCpiL1MoHeUAMFoBisAKUgnKwEWwF1WA32AsOgaPgBGgGZ8AFcAXcAF2gFzwCMjAAXoFh8BGMQRCEgygQFdKBjCBzyBZyhhiQLxQMRUKxUAqUDmVBQkgKFUOroHKoAqqG9kB10HHoNHQBugZ1Qw+gPmgIegd9gVEwGdaEDWALeDrMgJlwBBwPz4Gz4Hy4CC6B18NVcC18BG6CL8A34F5YBr+CR1AARULRUMYoexQDFYiKRqWiMlFi1FJUGaoSVYtqQLWiOlC3UTLUa9RnNBZNRdPR9mhvdBg6Ac1B56OXotehq9GH0E3oS+jb6D70MPo7hoLRx9hivDAsTDImC7MAU4qpxBzAnMJcxvRiBjAfsVgsDWuJ9cCGYVOw2djF2HXYndhGbBu2G9uPHcHhcDo4W5wPLhrHxhXgSnHbcUdw53E9uAHcJzwJb4R3xofgU/FC/Ep8Jf4w/hy+B/8CP0ZQI5gTvAjRBC5hEWEDYR+hlXCLMEAYI6oTLYk+xHhiNnEFsYrYQLxMfEx8TyKRTEiepFkkAWk5qYp0jHSV1Ef6TNYg25ADyWlkKXk9+SC5jfyA/J5CoVhQ/CmplALKekod5SLlKeWTClXFQYWlwlVZplKj0qTSo/JGlaBqrspUnatapFqpelL1luprNYKahVqgGlttqVqN2mm1e2oj6lR1J/Vo9Tz1deqH1a+pD2rgNCw0gjW4GiUaezUuavRTUVRTaiCVQ11F3Ue9TB3QxGpaarI0szXLNY9qdmoOa2louWolai3UqtE6qyWjoWgWNBYtl7aBdoJ2l/ZlmsE05jTetLXTGqb1TBvV1tP21+Zpl2k3avdqf9Gh6wTr5Ohs0mnWeaKL1rXRnaW7QHeX7mXd13qaet56HL0yvRN6D/VhfRv9WP3F+nv1b+qPGBgahBqIDLYbXDR4bUgz9DfMNtxieM5wyIhq5GskMNpidN7oJV2LzqTn0qvol+jDxvrGYcZS4z3GncZjJpYmCSYrTRpNnpgSTRmmmaZbTNtNh82MzKLMis3qzR6aE8wZ5nzzbeYd5qMWlhZJFqstmi0GLbUtWZZFlvWWj60oVn5W+Va1VnessdYM6xzrndZdNrCNmw3fpsbmli1s624rsN1p222HsfO0E9rV2t2zJ9sz7Qvt6+37HGgOkQ4rHZod3kw3m546fdP0junfHd0ccx33OT5y0nAKd1rp1Or0ztnGmeNc43zHheIS4rLMpcXlrautK891l+t9N6pblNtqt3a3b+4e7mL3BvchDzOPdI8dHvcYmowYxjrGVU+MZ4DnMs8znp+93L0KvE54/eFt753jfdh7cIblDN6MfTP6fUx82D57fGS+dN903598ZX7Gfmy/Wr9n/qb+XP8D/i+Y1sxs5hHmmwDHAHHAqYDRQK/AJYFtQaig0KCyoM5gjeCE4OrgpyEmIVkh9SHDoW6hi0PbwjBhEWGbwu6xDFgcVh1rONwjfEn4pQhyRFxEdcSzSJtIcWRrFBwVHrU56vFM85nCmc3RIJoVvTn6SYxlTH7ML7Ows2Jm1cx6HusUWxzbEUeNmxd3OO5jfED8hvhHCVYJ0oT2RNXEtMS6xNGkoKSKJFny9OQlyTdSdFMEKS2puNTE1AOpI7ODZ2+dPZDmllaadneO5ZyFc67N1Z2bO/fsPNV57Hkn0zHpSemH07+yo9m17JEMVsaOjGFOIGcb5xXXn7uFO8Tz4VXwXmT6ZFZkDmb5ZG3OGuL78Sv5rwWBgmrB2+yw7N3ZoznROQdz5LlJuY15+Lz0vNNCDWGO8NJ8w/kL53eLbEWlIlm+V/7W/GFxhPiABJLMkbQUaCIi6abUSvqDtK/Qt7Cm8NOCxAUnF6ovFC68uchm0dpFL4pCivYvRi/mLG4vNi5eUdy3hLlkz1JoacbS9mWmy0qWDSwPXX5oBXFFzopfVzqurFj5YVXSqtYSg5LlJf0/hP5QX6pSKi69t9p79e416DWCNZ1rXdZuX/u9jFt2vdyxvLL86zrOuus/Ov1Y9aN8feb6zg3uG3ZtxG4Ubry7yW/ToQr1iqKK/s1Rm5u20LeUbfmwdd7Wa5Wulbu3EbdJt8mqIqtatptt37j9azW/urcmoKZxh/6OtTtGd3J39uzy39Ww22B3+e4vPwl+ur8ndE9TrUVt5V7s3sK9z/cl7uvYz9hfd0D3QPmBbweFB2WHYg9dqvOoqzusf3hDPVwvrR86knak62jQ0ZYG+4Y9jbTG8mPgmPTYy+Ppx++eiDjRfpJxsuFn8593nKKeKmuCmhY1DTfzm2UtKS3dp8NPt7d6t576xeGXg2eMz9Sc1Tq74RzxXMk5+fmi8yNtorbXF7Iu9LfPa390MfninUuzLnVejrh89UrIlYsdzI7zV32unrnmde30dcb15hvuN5puut089avbr6c63Tubbnncauny7GrtntF9rsev58LtoNtX7rDu3Oid2dt9N+Hu/Xtp92T3ufcHH+Q+ePuw8OHYo+WPMY/Lnqg9qXyq/7T2N+vfGmXusrN9QX03n8U9e9TP6X/1u+T3rwMlzynPK18YvagbdB48MxQy1PVy9suBV6JXY69L/6H+jx1vrN78/If/HzeHk4cH3orfyt+te6/z/uAH1w/tIzEjTz/mfRwbLfuk8+nQZ8bnji9JX16MLfiK+1r1zfpb6/eI74/leXK5iC1mj0sBFDLgzEwA3h1EtHEKAFRElxNnT2jrcYMmvgfGCfwnntDf4+YOQAMyKWQR0x+Akwo5i8wqyKyQRPH+AHZxUY5/mSTTxXkiFxlRlphPcvl7AwBwrQB8E8vlYzvl8m/7kGIfANCWP6HpFYZFtHyD3vJRg6LbPe3g7zah9//U499noKjAFfx9/ieoZhkWVvYkwwAAAGxlWElmTU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAIdpAAQAAAABAAAATgAAAAAAAACQAAAAAQAAAJAAAAABAAKgAgAEAAAAAQAAAEKgAwAEAAAAAQAAAEIAAAAAgodoEQAAAAlwSFlzAAAWJQAAFiUBSVIk8AAABMtJREFUeAHtXM2KFDEQzrQKruIu4mEXRFlUVLz4A4K7B99AcO8io0/gwQfxDVzFuwu+gQf34EG8iOAPKAh6EFlBFMSf/qa2uqszlVR6ZtYxM5PDJNVVSer78nU6KrHzpyxuVlwx44AY2O0T8eb9D7f5fMu9fPvdff7y0/36nbdgdhUdd+jgHnf62JxbObvgjh/d60Pu2R35ajx49Mk9frqlBk7Kw8sXF9y1K4t9cCoi7tz/4F68/tYXMIkPzpzY725dP9yA1tsjoIRpIQHogRWYZSmwJ4Reh06nI2Nd7rYEA8zAzqXAxhgq/pc1d9vHKbEX+Dr4JbzypJDc/YxXYi/wifRLeOXpU5q7n/FK7EXsnBBeeRoqd7/EHj1ZhleeiMjdz8pArRKR+0pb+UsCuK0SkftKW/kzeFmrRHCAxWzufsaJOkqExWzufpOI8EpP1jnCJCK80pN1jjCJ4ICwMigidz/jRD3bI7bZUInIfaWt/KUSuK0SEd4jqFvufgYva5UIDrCYzd3POFFHifhfV/7k8lwPw7D5mUSEV3r854ju2pK7ffOIWzk/X+Go803Lr+ooGqoiwkyP9xzRXVt0q9sE3CgJYTLqfNPyE/irpkoEe2um6ck4bSiBSeD8JBl41jY/Hgd1lIiaaeoyLlsjgUGAjEH3DB4DtUpEW2Z3Mj5GAgA8efbVvXpX/200nln5IMYvKhHDrvylcwdc9+pSNdeg46WQsP7wo2s7fpWYaPT926fw9ZiVk4BpywYJkGuvlJs4EuWS0p/HTyHh3kbzH2najM85cR0lgpPiYMtukFB26m1u5Ua+vkFkWP3Zn0KCJDg1Px6f42Wtvhrhdyz8ncanrFKCmGH1wrwDMCrh/uxPIUFTAvdHbeVPsc1fVRE+c7Ud/k6fWt7XHFlYqcqQ5wTRvWpiY4wrIZwfDUL+akDRUBXB/jCzFCH9SHCzTDRUmsro7z+cEvrHwxOZn2ZTL/pVFcEBtRLoiWXfxQ5ehvoHHx4vpIwUEuJKSMvPz5/zQq0qwmIy5m+rjBQSwnsCQYnlgwjfT72av6oifOba2qnKcOXeGVIP0rT3BALTNr8mBWSpRHAgmJSTtLGhDHwj+A9GPCbX2DNiBSRoShg0H8zl5y/njxIhJ0WntralDJmIbO+UEvz85Zwt9wj7HIDB5Ttp7RkyGbRDSqC49vOjX50P9aexmr+qInzmajvtO13H02SpyrCVMNj8dT7/4BwByDXzRIC0LWXEldA/njVfip9GpV9VERxQM0lPhrVDyrCVMJr5/fwZJ+qWewR1lSuNJ21sXxnjVgIhck5VhM/cqG1WBpIAMX4Z9Xz+eP58sFUiOBArLQcZpQ0CNCXt1HzA5OfPOFGrrwYHyKTwbNJsxolaJUJbKeo0mu/4uMeXBHBbJSK88qP5jo97fAYva5UIDgivHEXk7mecqKNEhFeOhsjdbxKR+0pb+UsCuK0qIveVtvJn8LJWieAAi9nc/YwTdZQIi9nc/SYR4ZWenSO2yZvgcwTuRYZKWBnUI3e/xF7gcmio5L4HWPlL7AVuyPol95W28me8EnuBa8J+sZjM3c94JfYCd6VxTXjaCjDLe+K9cwTuSuOa8LQUYPXvh1d3w0HC7JK8kMK0/rcJfwHkVMYgi4xhOgAAAABJRU5ErkJggg==");background-size:100%}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">1. 一段话总结</h3>
<p>JavaScript 中有 <strong>escape、encodeURI、encodeURIComponent</strong> 三个编码函数及对应的 <strong>unescape、decodeURI、decodeURIComponent</strong> 解码函数，三者编码范围不同（不编码字符数分别为 69 个、82 个、71 个），适用场景有别：<strong>encodeURIComponent</strong> 因能编码特殊字符且适配 UTF-8 解码，是最常用的参数传递工具；<strong>encodeURI</strong> 适用于整体 URL 跳转，不编码 URL 关键分隔符；<strong>escape</strong> 适用于内部数据存储（如收藏历史），编码非 ASCII 字符为 % u**** 格式，且应尽量避免在表单或服务器交互中使用。</p>
<hr/>
<h3 data-id="heading-1">2. 思维导图</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f33ace03f3da411c96c7601cd1e0e863~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP546L5ZKM5YWr6JuL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768358036&amp;x-signature=Osges1Ns18AnlsOpT8SicahpC4Y%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-2">3. 详细总结</h3>
<h4 data-id="heading-3">一、函数组基础信息</h4>
<p>JavaScript 中用于文字编码的 3 个核心函数及对应解码函数，构成完整的编码解码体系，具体对应关系如下：</p>

























<table><thead><tr><th align="center">编码函数</th><th align="center">对应解码函数</th><th align="center">核心编码逻辑</th></tr></thead><tbody><tr><td align="center">escape</td><td align="center">unescape</td><td align="center">非 ASCII 字符编码为 % XX 格式，0-255 外 Unicode 编码为 % u****</td></tr><tr><td align="center">encodeURI</td><td align="center">decodeURI</td><td align="center">仅编码 URI 中非法字符，保留关键分隔符，基于 UTF-8 编码</td></tr><tr><td align="center">encodeURIComponent</td><td align="center">decodeURIComponent</td><td align="center">编码 URI 中所有特殊字符（含分隔符），基于 UTF-8 编码</td></tr></tbody></table>
<h4 data-id="heading-4">二、三大函数核心差异（不编码字符对比）</h4>
<p>三者的核心区别在于不编码的字符范围，直接决定其适用场景，具体统计如下：</p>
<ol>
<li><strong>escape</strong>：不编码字符共 69 个，包括：*、+、-、.、/、@、_、0-9（10 个）、a-z（26 个）、A-Z（26 个）</li>
<li><strong>encodeURI</strong>：不编码字符共 82 个，包括：!、#、$、&amp;、'、(、)、*、+、,、-、.、/、:、;、=、?、@、_、~、0-9（10 个）、a-z（26 个）、A-Z（26 个）</li>
<li><strong>encodeURIComponent</strong>：不编码字符共 71 个，包括：!、'、(、)、*、-、.、_、~、0-9（10 个）、a-z（26 个）、A-Z（26 个）</li>
</ol>
<h4 data-id="heading-5">三、适用场景及示例</h4>
<ol>
<li><strong>encodeURIComponent（最常用）</strong>
<ul>
<li>适用场景：URL 参数传递（避免 #、&amp; 等特殊字符截断参数）</li>
<li>示例代码：<code>&lt;script language="javascript"&gt;document.write('&lt;a href="http://passport.baidu.com/?logout&amp;aid=7&amp;u=' + encodeURIComponent("http://cang.baidu.com/bruce42") + '"&gt;退出&lt;/a&gt;');&lt;/script&gt;</code></li>
<li>关键说明：编码结果适配 UTF-8 格式，需后台解码时支持 UTF-8（与表单 / 页面编码一致）</li>
</ul>
</li>
<li><strong>encodeURI</strong>
<ul>
<li>适用场景：整体 URL 跳转（保留 URL 原有结构，如 :、/ 分隔符）</li>
<li>示例代码：<code>Location.href=encodeURI("http://cang.baidu.com/do/s?word=百度&amp;ct=21");</code></li>
<li>关键说明：不对 URL 核心分隔符（:、/、;、? 等）编码，确保跳转路径有效</li>
</ul>
</li>
<li><strong>escape</strong>
<ul>
<li>适用场景：JS 内部数据存储（如收藏夹历史记录）</li>
<li>示例场景：存储用户操作历史中的特殊字符文本</li>
<li>关键说明：避免在表单提交或服务器交互中使用，因 + 字符会被服务器解析为空格</li>
</ul>
</li>
</ol>
<h4 data-id="heading-6">四、使用注意事项</h4>
<ol>
<li>编码格式兼容性：encodeURI 和 encodeURIComponent 基于 UTF-8 编码，后台接收参数时需确保解码方式一致，否则会出现乱码；</li>
<li>escape 局限性：因不编码 @、/、+ 等字符，且 + 字符的特殊解析问题，实际开发中应优先选择 encodeURIComponent 替代；</li>
<li>路径编码禁忌：encodeURIComponent 会编码 / 等路径分隔符，若用于编码完整 URL 路径（如 "/FOLDER1/FOLDER2"），会导致服务器请求失效。</li>
</ol>
<hr/>
<h3 data-id="heading-7">4. 关键问题</h3>
<h4 data-id="heading-8">问题 1：JS 中 encodeURI 和 encodeURIComponent 的核心区别是什么？适用场景分别是什么？</h4>
<ul>
<li>答案：核心区别在于<strong>不编码字符范围</strong>和<strong>对 URL 分隔符的处理</strong>：encodeURI 不编码 :、/、;、? 等 URL 关键分隔符（不编码字符共 82 个），适用于<strong>整体 URL 跳转</strong>；encodeURIComponent 会编码所有 URL 特殊字符（含分隔符，不编码字符共 71 个），适用于<strong>URL 参数传递</strong>。例如，跳转时用 <code>encodeURI("http://xxx.com?word=百度")</code>，传参时用 <code>encodeURIComponent("http://xxx.com")</code> 避免参数截断。</li>
</ul>
<h4 data-id="heading-9">问题 2：为什么实际开发中更推荐使用 encodeURIComponent 而非 escape？</h4>
<ul>
<li>答案：主要有两个核心原因：① <strong>编码兼容性</strong>：encodeURIComponent 基于 UTF-8 编码，能适配后台常见的解码方式，而 escape 采用 ISO 拉丁字符集编码，对中文、韩文等特殊字符支持不佳；② <strong>字符解析风险</strong>：escape 不编码 + 字符，该字符在服务器端会被解析为空格，导致参数传递错误；③ <strong>适用场景覆盖</strong>：encodeURIComponent 可满足参数传递、特殊字符编码等大部分场景，而 escape 仅适用于内部数据存储，使用场景极窄。</li>
</ul>
<h4 data-id="heading-10">问题 3：若需编码完整的 URL 路径（如 "<a href="https://link.juejin.cn?target=http%3A%2F%2Fcang.baidu.com%2Fdo%2Fs%3Fword%3D%25E7%2599%25BE%25E5%25BA%25A6" target="_blank" title="http://cang.baidu.com/do/s?word=%E7%99%BE%E5%BA%A6" ref="nofollow noopener noreferrer">cang.baidu.com/do/s?word=百…</a> "），应选择哪个函数？为什么？</h4>
<ul>
<li>答案：应选择 <strong>encodeURI</strong>。原因：完整 URL 路径依赖 :、/、? 等分隔符维持结构有效性，而 encodeURI 不会编码这些关键分隔符，能保证编码后 URL 可正常跳转；若使用 encodeURIComponent，会将 /、? 等字符编码为 %2F、%3F，导致 URL 结构破坏，服务器无法识别路径；而 escape 因编码格式和字符支持问题，同样不适合完整 URL 编码。</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Git 查询 Tag 列表]]></title>    <link>https://juejin.cn/post/7592088192517079083</link>    <guid>https://juejin.cn/post/7592088192517079083</guid>    <pubDate>2026-01-07T02:36:54.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592088192517079083" data-draft-id="7592058764120621075" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Git 查询 Tag 列表"/> <meta itemprop="keywords" content="Android"/> <meta itemprop="datePublished" content="2026-01-07T02:36:54.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="louisgeek"/> <meta itemprop="url" content="https://juejin.cn/user/1099167357208151"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Git 查询 Tag 列表
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1099167357208151/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    louisgeek
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-07T02:36:54.000Z" title="Wed Jan 07 2026 02:36:54 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Git 查询 Tag 列表.md</h2>
<ul>
<li>很奇怪，TortoiseGit 和 SourceTree 怎么都没有直观展示区分远程和本地 Tag 的功能</li>
</ul>
<h3 data-id="heading-1">查询远程 Tag</h3>
<ul>
<li>过滤关键字不区分大小写</li>
</ul>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># Git Bash</span>
git ls-remote --tags origin | grep -i <span class="hljs-string">"release_"</span>
<span class="hljs-comment"># Cmd</span>
git ls-remote --tags origin | findstr /i <span class="hljs-string">"release_"</span>
<span class="hljs-comment"># PowerShell</span>
git ls-remote --tags origin | Select-String <span class="hljs-string">"release_"</span>
</code></pre>
<ul>
<li>区分大小写</li>
</ul>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># Git Bash</span>
git ls-remote --tags origin | grep <span class="hljs-string">"release_"</span>
<span class="hljs-comment"># Cmd</span>
git ls-remote --tags origin | findstr <span class="hljs-string">"release_"</span>
<span class="hljs-comment"># PowerShell</span>
git ls-remote --tags origin | Select-String -CaseSensitive <span class="hljs-string">"release_"</span>
</code></pre>
<h3 data-id="heading-2">查询本地 Tag</h3>
<ul>
<li>过滤关键字不区分大小写</li>
</ul>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># Git Bash</span>
git show-ref --tags  |  grep -i <span class="hljs-string">"release_"</span>
<span class="hljs-comment"># Cmd</span>
git show-ref --tags  |  findstr /i <span class="hljs-string">"release_"</span>
<span class="hljs-comment"># PowerShell</span>
git show-ref --tags  |  Select-String <span class="hljs-string">"release_"</span>
</code></pre>
<ul>
<li>区分大小写</li>
</ul>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># Git Bash</span>
git show-ref --tags  |  grep <span class="hljs-string">"release_"</span>
<span class="hljs-comment"># Cmd</span>
git show-ref --tags  |  findstr <span class="hljs-string">"release_"</span>
<span class="hljs-comment"># PowerShell</span>
git show-ref --tags  |  Select-String -CaseSensitive <span class="hljs-string">"release_"</span>
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue开发必考：defineComponent与defineAsyncComponent，你真的掌握吗？]]></title>    <link>https://juejin.cn/post/7592152708250845222</link>    <guid>https://juejin.cn/post/7592152708250845222</guid>    <pubDate>2026-01-07T02:39:09.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592152708250845222" data-draft-id="7592147054786674739" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vue开发必考：defineComponent与defineAsyncComponent，你真的掌握吗？"/> <meta itemprop="keywords" content="前端,Vue.js"/> <meta itemprop="datePublished" content="2026-01-07T02:39:09.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="前端大鱼"/> <meta itemprop="url" content="https://juejin.cn/user/395479916219517"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vue开发必考：defineComponent与defineAsyncComponent，你真的掌握吗？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/395479916219517/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    前端大鱼
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-07T02:39:09.000Z" title="Wed Jan 07 2026 02:39:09 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>大家好，我是前端大鱼。今天聊点实在的——Vue 3里两个名字很像但用途完全不同的函数：<code>defineComponent</code>和<code>defineAsyncComponent</code>。</p>
<p>你是不是也曾经在代码里见过它们，然后心里嘀咕：“这俩货有什么区别？我该用哪个？”</p>
<p>别急，今天我用最直白的话给你讲明白。</p>
<hr/>
<h2 data-id="heading-0">先看名字，其实已经剧透了</h2>
<p><strong><code>defineComponent</code></strong> - <strong>定义</strong>组件<br/>
<strong><code>defineAsyncComponent</code></strong> - 定义<strong>异步</strong>组件</p>
<p>名字已经很明显了对不对？一个是普通组件的“身份证”，一个是需要“等会儿再加载”组件的特殊通行证。</p>
<hr/>
<h2 data-id="heading-1">defineComponent：每个组件的“出生证明”</h2>
<p>咱们先说说你天天在用的<code>defineComponent</code>。</p>
<p><strong>它就是个登记处</strong>。你写的每个Vue组件，都需要在它这里“登记注册”，告诉Vue：“嘿，这是个正经组件，给个合法身份。”</p>
<h3 data-id="heading-2">两种常见写法</h3>
<p><strong>传统写法（现在用得少了）：</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { defineComponent } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineComponent</span>({
  <span class="hljs-attr">name</span>: <span class="hljs-string">'MyButton'</span>,
  <span class="hljs-attr">props</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span> },
  <span class="hljs-title function_">setup</span>(<span class="hljs-params">props</span>) {
    <span class="hljs-comment">// 你的逻辑</span>
    <span class="hljs-keyword">return</span> { <span class="hljs-comment">/* 返回给模板用的东西 */</span> }
  }
})
</code></pre>
<p><strong>现代写法（95%项目都在用）：</strong></p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-comment">// 注意！这里没有显式调用 defineComponent</span>
<span class="hljs-comment">// 但Vue编译器在背后帮你调用了</span>

<span class="hljs-title function_">defineProps</span>({ <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span> })
<span class="hljs-comment">// 直接写逻辑，清爽！</span>
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<blockquote>
<p><strong>重要知识点</strong>：当你用<code>&lt;script setup&gt;</code>时，虽然没写<code>defineComponent</code>，但Vue编译器在打包时<strong>自动给你加上了</strong>。</p>
</blockquote>
<h3 data-id="heading-3">它主要干什么用？</h3>
<ol>
<li><strong>给TypeScript提供类型提示</strong>（最重要的功能）</li>
<li>统一组件定义规范</li>
</ol>
<p>说白了，<code>defineComponent</code>就是组件的<strong>基础建设</strong>，没有它，你的组件在Vue世界里就是“黑户”。</p>
<hr/>
<h2 data-id="heading-4">defineAsyncComponent：性能优化的“秘密武器”</h2>
<p>现在来聊聊今天的主角——<code>defineAsyncComponent</code>。</p>
<p><strong>这是能让你的应用加载速度翻倍的家伙。</strong></p>
<h3 data-id="heading-5">它解决了什么问题？</h3>
<p>想象一下这个场景：你的电商网站有个“用户订单分析”页面，里面用了一个超级复杂的图表库，代码有500KB。</p>
<p>如果用户只是来首页看商品，<strong>为什么要把图表库的代码也一起下载下来？</strong></p>
<p>这就是<code>defineAsyncComponent</code>要解决的问题：<strong>“你需要的时候，我再给你加载。”</strong></p>
<h3 data-id="heading-6">基本用法：简单到不可思议</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { defineAsyncComponent } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-comment">// 就这么简单！</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">HeavyChart</span> = <span class="hljs-title function_">defineAsyncComponent</span>(<span class="hljs-function">() =&gt;</span>
  <span class="hljs-keyword">import</span>(<span class="hljs-string">'./components/HeavyChart.vue'</span>)  <span class="hljs-comment">// 这是一个独立的代码块</span>
)
</code></pre>
<p>用了这个，<code>HeavyChart</code>组件会被打包成<strong>独立的文件</strong>，只有当你真正要用它的时候，浏览器才会去下载这个文件。</p>
<h3 data-id="heading-7">高级用法：给用户更好的体验</h3>
<p>更专业的用法可以配置加载状态：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> <span class="hljs-title class_">AsyncPopup</span> = <span class="hljs-title function_">defineAsyncComponent</span>({
  <span class="hljs-attr">loader</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'./ExpensivePopup.vue'</span>),
  <span class="hljs-attr">loadingComponent</span>: <span class="hljs-title class_">LoadingSkeleton</span>,    <span class="hljs-comment">// 加载时显示骨架屏</span>
  <span class="hljs-attr">errorComponent</span>: <span class="hljs-title class_">ErrorDisplay</span>,         <span class="hljs-comment">// 加载失败显示错误提示</span>
  <span class="hljs-attr">delay</span>: <span class="hljs-number">200</span>,                           <span class="hljs-comment">// 延迟200ms再显示loading</span>
  <span class="hljs-attr">timeout</span>: <span class="hljs-number">3000</span>                         <span class="hljs-comment">// 加载超时时间（3秒）</span>
})
</code></pre>
<h3 data-id="heading-8">实际项目中最常见的用法</h3>
<p>其实你<strong>可能已经在用</strong>异步组件了，只是没意识到：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 在Vue Router路由配置里</span>
<span class="hljs-keyword">const</span> routes = [
  {
    <span class="hljs-attr">path</span>: <span class="hljs-string">'/dashboard'</span>,
    <span class="hljs-comment">// 看！这就是异步组件加载</span>
    <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'@/views/Dashboard.vue'</span>)
  }
]
</code></pre>
<p>Vue Router的<code>import()</code>语法，底层就是用的<code>defineAsyncComponent</code>。</p>
<hr/>
<h2 data-id="heading-9">一图看懂区别</h2>






























<table><thead><tr><th>方面</th><th>defineComponent</th><th>defineAsyncComponent</th></tr></thead><tbody><tr><td><strong>做什么</strong></td><td>给组件上户口</td><td>给组件发“按需加载”许可证</td></tr><tr><td><strong>加载方式</strong></td><td>跟主包一起加载</td><td>独立分包，用时才加载</td></tr><tr><td><strong>性能影响</strong></td><td>增加主包体积</td><td><strong>减少首屏体积，加快加载</strong></td></tr><tr><td><strong>你用得多吗</strong></td><td>天天用（或间接用）</td><td>路由懒加载时就在用</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-10">什么时候该用哪个？</h2>
<p>记住这个简单的原则：</p>
<h3 data-id="heading-11">用 defineComponent（或<code>&lt;script setup&gt;</code>）</h3>
<p><strong>所有常规组件都用这个</strong>，这是默认选择。</p>
<h3 data-id="heading-12">用 defineAsyncComponent</h3>
<p>在以下三种情况用它：</p>
<ol>
<li><strong>路由页面组件</strong>（必须用！这是性能优化底线）</li>
<li><strong>体积大的非首屏组件</strong>（如图表、编辑器、PDF预览）</li>
<li><strong>用户操作才显示的组件</strong>（如复杂弹窗、侧边栏）</li>
</ol>
<hr/>
<h2 data-id="heading-13">我项目里的真实案例</h2>
<p>之前接手一个复杂的后台管理系统，首屏加载要<strong>5秒多</strong>。我做了三件事：</p>
<ol>
<li>把所有路由组件改为异步加载</li>
<li>把报表页的复杂图表组件异步加载</li>
<li>把“帮助文档”弹窗异步加载</li>
</ol>
<p><strong>改造后，首屏加载降到2秒</strong>。用户打开系统就能操作，图表和文档等需要时才加载。</p>
<p><strong>这就是异步组件的威力</strong>——不是让代码跑更快，而是让浏览器<strong>少干活</strong>。</p>
<hr/>
<h2 data-id="heading-14">一个容易踩的坑</h2>
<p>注意！异步组件<strong>默认没有包裹<code>&lt;Suspense&gt;</code></strong>。如果你需要在加载时显示fallback内容，要手动处理：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">Suspense</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">default</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">AsyncUserProfile</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">fallback</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>加载中...<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">Suspense</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
</code></pre>
<p>或者直接在<code>defineAsyncComponent</code>里配<code>loadingComponent</code>。</p>
<hr/>
<h2 data-id="heading-15">总结</h2>
<ul>
<li><strong><code>defineComponent</code></strong> 是<strong>定义</strong>组件，给组件合法身份</li>
<li><strong><code>defineAsyncComponent</code></strong> 是<strong>优化加载</strong>组件，提升用户体验</li>
</ul>
<p>它们俩的关系就像：</p>
<ul>
<li><code>defineComponent</code> = 造一辆车</li>
<li><code>defineAsyncComponent</code> = 决定这辆车是随时能开，还是需要时才从车库取出来</li>
</ul>
<p>在现在的前端开发中，<strong>路由级别的异步加载已经是标配</strong>。如果你的项目还没做这个优化，今天下班前就能加上，立竿见影。</p>
<hr/>
<p><strong>今日思考：</strong><br/>
你的项目里有哪些“重型”组件可以做成异步加载？在评论区分享你的优化思路吧。</p>
<p>如果觉得有用，转发给你的团队小伙伴，一起提升用户体验。</p>
<hr/>
<p>关注我的公众号" <strong>大前端历险记</strong>"，掌握更多前端开发干货姿势！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【节点】[NormalStrength节点]原理解析与实际应用]]></title>    <link>https://juejin.cn/post/7592152708250910758</link>    <guid>https://juejin.cn/post/7592152708250910758</guid>    <pubDate>2026-01-07T02:44:10.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592152708250910758" data-draft-id="7592176349713170470" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【节点】[NormalStrength节点]原理解析与实际应用"/> <meta itemprop="keywords" content="游戏开发,图形学,Unity3D"/> <meta itemprop="datePublished" content="2026-01-07T02:44:10.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="SmalBox"/> <meta itemprop="url" content="https://juejin.cn/user/2218166695237532"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【节点】[NormalStrength节点]原理解析与实际应用
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2218166695237532/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    SmalBox
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-07T02:44:10.000Z" title="Wed Jan 07 2026 02:44:10 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fchenghai37%2Fcategory_13074589.html%3Ffromshare%3Dblogcolumn%26sharetype%3Dblogcolumn%26sharerId%3D13074589%26sharerefer%3DPC%26sharesource%3Dchenghai37%26sharefrom%3Dfrom_link" target="_blank" title="https://blog.csdn.net/chenghai37/category_13074589.html?fromshare=blogcolumn&amp;sharetype=blogcolumn&amp;sharerId=13074589&amp;sharerefer=PC&amp;sharesource=chenghai37&amp;sharefrom=from_link" ref="nofollow noopener noreferrer">【Unity Shader Graph 使用与特效实现】</a><strong>专栏-直达</strong></p>
</blockquote>
<h2 data-id="heading-0">节点功能概述</h2>
<p>NormalStrength节点是Unity URP Shader Graph中用于精确控制法线贴图强度的核心工具。该节点通过<strong>Strength</strong>参数线性调节法线贴图的凹凸表现，在保持法线向量物理正确性的前提下实现细节的动态调整。其核心价值体现在：</p>
<ul>
<li><strong>强度无损控制</strong>：当Strength值为1时完全保留原始法线信息，为0时返回空白法线贴图</li>
<li><strong>光照兼容性</strong>：通过数学变换保持法线向量归一化，确保光照计算准确性</li>
<li><strong>性能优化</strong>：避免重新计算法线贴图，仅通过强度参数实现动态效果</li>
<li><strong>实时调节能力</strong>：支持在运行时动态调整强度参数，为游戏中的动态材质效果提供可能</li>
</ul>
<h2 data-id="heading-1">端口与参数详解</h2>
<p><img src="https://docs.unity.cn/cn/Packages-cn/com.unity.shadergraph@14.0/manual/images/NormalStrengthNodeThumb.png" alt="" loading="lazy"/></p>
<h3 data-id="heading-2">端口配置</h3>

































<table><thead><tr><th>端口名称</th><th>方向</th><th>数据类型</th><th>绑定</th><th>描述</th></tr></thead><tbody><tr><td>In</td><td>输入</td><td>Vector 3</td><td>无</td><td>输入法线向量</td></tr><tr><td>Strength</td><td>输入</td><td>Float</td><td>无</td><td>强度调节值（0-1范围）</td></tr><tr><td>Out</td><td>输出</td><td>Vector 3</td><td>无</td><td>调整后的法线向量</td></tr></tbody></table>
<h3 data-id="heading-3">参数特性</h3>
<ul>
<li><strong>强度范围</strong>：0-1的线性区间，0表示完全平坦表面，1表示原始法线强度</li>
<li><strong>数学原理</strong>：通过<code>In.rg * Strength</code>修改XY分量（切线空间中的水平偏移），同时用<code>lerp(1, In.b, saturate(Strength))</code>保持Z分量的稳定性</li>
<li><strong>物理正确性</strong>：确保输出向量始终为单位长度，避免光照计算异常</li>
<li><strong>插值精度</strong>：使用lerp函数确保在强度变化时Z分量的平滑过渡，避免视觉突变</li>
</ul>
<h2 data-id="heading-4">技术原理解析</h2>
<h3 data-id="heading-5">数学公式推导</h3>
<p>该节点的核心运算可表示为：</p>
<p><code>Out = (In.rg * Strength, lerp(1, In.b, saturate(Strength)))</code></p>
<p>其中：</p>
<ul>
<li><strong>In.rg</strong>：法线向量的XY分量（切线空间中的凹凸方向）</li>
<li><strong>Strength</strong>：强度系数，控制凹凸程度</li>
<li><strong>lerp函数</strong>：在原始Z分量和1之间插值，保持向量长度</li>
<li><strong>saturate函数</strong>：确保强度值始终在有效范围内，防止数值溢出</li>
</ul>
<h3 data-id="heading-6">生成代码解析</h3>
<p>Unity提供的HLSL实现展示了其底层逻辑：</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-type">void</span> <span class="hljs-title function_">Unity_NormalStrength_float</span><span class="hljs-params">(float3 In, <span class="hljs-type">float</span> Strength, out float3 Out)</span>
{
    Out = {precision}<span class="hljs-number">3</span>(In.rg * Strength, lerp(<span class="hljs-number">1</span>, In.b, saturate(Strength)));
}
</code></pre>
<p>该代码通过<code>precision</code>修饰符确保浮点精度，<code>saturate(Strength)</code>将强度限制在0-1范围，防止数值溢出。在实际编译中，<code>precision</code>会根据目标平台自动选择half或float精度，确保性能与质量的平衡。</p>
<h2 data-id="heading-7">应用场景与实战案例</h2>
<h3 data-id="heading-8">材质细节动态调节</h3>
<p><strong>场景</strong>：武器磨损程度可视化</p>
<ul>
<li>通过动画控制Strength参数，实现从崭新到磨损的渐变效果</li>
<li>配合法线混合节点，组合不同磨损程度的法线贴图</li>
<li>结合时间轴工具，创建基于使用时间的自动磨损效果</li>
</ul>
<h3 data-id="heading-9">性能优化策略</h3>
<p><strong>场景</strong>：移动端LOD切换</p>
<ul>
<li>在低细节级别时降低Strength值，减少法线计算量</li>
<li>结合URP的LOD系统，实现动态性能优化</li>
<li>针对不同设备性能自动调整强度参数，确保流畅体验</li>
</ul>
<h3 data-id="heading-10">动态变形效果</h3>
<p><strong>场景</strong>：角色肌肉膨胀动画</p>
<ul>
<li>使用时间节点驱动Strength参数，创建肌肉膨胀的视觉效果</li>
<li>配合顶点动画，实现更真实的物理变形</li>
<li>结合角色状态（如受伤、发力）动态调整不同部位的法线强度</li>
</ul>
<h3 data-id="heading-11">环境交互效果</h3>
<p><strong>场景</strong>：湿润表面效果</p>
<ul>
<li>根据环境湿度动态增强法线强度，模拟水珠积聚效果</li>
<li>配合反射率调整，实现完整的湿润材质表现</li>
<li>使用距离场控制强度变化，实现局部湿润效果</li>
</ul>
<h2 data-id="heading-12">使用技巧与注意事项</h2>
<h3 data-id="heading-13">强度与光照关系</h3>
<ul>
<li>当Strength值超过1时，法线向量可能失去归一化特性，导致光照异常</li>
<li>建议使用<code>saturate(Strength)</code>确保强度在0-1范围内</li>
<li>在HDRP管线中，需要考虑强度参数与物理光照模型的兼容性</li>
</ul>
<h3 data-id="heading-14">与其他节点配合</h3>
<ul>
<li><strong>法线混合节点</strong>：组合多个法线贴图时，NormalStrength可控制各贴图的贡献比例</li>
<li><strong>高度转法线节点</strong>：用于程序化生成法线时，调整高度图的凹凸强度</li>
<li><strong>时间节点</strong>：创建动态变化的法线效果，如水面波纹、布料飘动</li>
</ul>
<h3 data-id="heading-15">常见问题解决</h3>
<ul>
<li><strong>光照闪烁</strong>：检查Strength值是否超出有效范围，或法线贴图是否损坏</li>
<li><strong>性能下降</strong>：避免在片段着色器中频繁修改Strength参数</li>
<li><strong>视觉异常</strong>：确保输入法线向量格式正确，避免切线空间转换错误</li>
</ul>
<h3 data-id="heading-16">高级应用技巧</h3>
<ul>
<li><strong>多层材质融合</strong>：使用多个NormalStrength节点分别控制不同材质层的法线强度</li>
<li><strong>程序化内容生成</strong>：结合噪声纹理和强度参数，动态生成复杂的表面细节</li>
<li><strong>艺术风格控制</strong>：通过非标准的强度值范围，创造独特的视觉风格</li>
</ul>
<h2 data-id="heading-17">总结与拓展应用</h2>
<p>NormalStrength节点是URP Shader Graph中实现法线细节控制的利器，其核心优势在于：</p>
<ul>
<li>精确调节法线强度而不破坏物理特性</li>
<li>与URP渲染管线无缝兼容</li>
<li>支持动态效果和性能优化</li>
<li>提供艺术家友好的参数控制界面</li>
</ul>
<p><strong>拓展应用方向</strong>：</p>
<ul>
<li>环境交互：根据角色运动强度动态调整法线细节</li>
<li>艺术风格化：通过非传统强度值创建独特视觉效果</li>
<li>跨平台优化：针对不同硬件平台调整强度参数</li>
<li>实时渲染创新：结合最新的实时渲染技术，探索法线强度在虚拟现实、增强现实等新兴领域的应用潜力</li>
</ul>
<p>通过合理利用该节点，开发者可以在保持物理正确性的前提下，创建更具表现力和性能优化的材质效果。随着实时渲染技术的不断发展，NormalStrength节点在材质表现和性能优化方面的重要性将进一步提升。</p>
<p><strong>未来发展趋势</strong>：</p>
<ul>
<li>与机器学习技术结合，实现智能法线强度调节</li>
<li>支持更复杂的多维度强度控制</li>
<li>与物理模拟系统深度集成，提供更真实的材质交互效果</li>
</ul>
<hr/>
<blockquote>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fchenghai37%2Fcategory_13074589.html%3Ffromshare%3Dblogcolumn%26sharetype%3Dblogcolumn%26sharerId%3D13074589%26sharerefer%3DPC%26sharesource%3Dchenghai37%26sharefrom%3Dfrom_link" target="_blank" title="https://blog.csdn.net/chenghai37/category_13074589.html?fromshare=blogcolumn&amp;sharetype=blogcolumn&amp;sharerId=13074589&amp;sharerefer=PC&amp;sharesource=chenghai37&amp;sharefrom=from_link" ref="nofollow noopener noreferrer">【Unity Shader Graph 使用与特效实现】</a><strong>专栏-直达</strong>
（欢迎<em>点赞留言</em>探讨，更多人加入进来能更加完善这个探索的过程，🙏）</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[面向可观测数据融合的 Exemplar]]></title>    <link>https://juejin.cn/post/7592133956733108265</link>    <guid>https://juejin.cn/post/7592133956733108265</guid>    <pubDate>2026-01-07T01:39:45.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592133956733108265" data-draft-id="7589564203872616511" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="面向可观测数据融合的 Exemplar "/> <meta itemprop="keywords" content="后端,监控"/> <meta itemprop="datePublished" content="2026-01-07T01:39:45.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="货拉拉技术"/> <meta itemprop="url" content="https://juejin.cn/user/1768489241815070"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            面向可观测数据融合的 Exemplar 
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1768489241815070/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    货拉拉技术
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-07T01:39:45.000Z" title="Wed Jan 07 2026 01:39:45 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读20分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、可观测性的"最后一公里"难题</h2>
<p>在可观测性领域，指标、日志与链路数据因其不同的数据特性与访问模式，通常采用异构存储架构：</p>
<ul>
<li><strong>时序数据库</strong>（如 Prometheus、InfluxDB）承载指标数据；</li>
<li><strong>日志存储</strong>（如 Elasticsearch、Loki）处理日志流；</li>
<li><strong>分布式追踪系统</strong>（如 Jaeger、Tempo、Skwalking）管理链路数据。</li>
</ul>
<p>这种基于数据特性的存储分层设计虽能优化各自场景的性能与成本，但也导致了跨数据类型关联分析的固有障碍。</p>
<p>当前货拉拉的 Monitor 系统已实现三种基础关联能力：</p>
<p>（1）通过应用名称+指标类型+标签组合实现框架<strong>指标与链路</strong>的关联检索；</p>
<p>（2）依托 ClickHouse 日志引擎原生指标能力支撑中间件（如 Kong）的<strong>指标-日志关</strong>联；</p>
<p>（3）基于预设保留字段完成<strong>业务</strong> <strong>订单与链路</strong>的定向检索。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/94e4dd90fe5d4b0bbbd5404fce28cab8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LSn5ouJ5ouJ5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768354785&amp;x-signature=F5SZGJ7t0e56uPGyuzPNlZQuoOg%3D" alt="whiteboard_exported_image (22).png" loading="lazy"/>
然而，架构评估表明，在指标-链路、指标-日志的核心融合路径上，现有方案的完成度仍存在显著提升空间。</p>





























<table><thead><tr><th><strong>数据维度</strong></th><th><strong>构建形式</strong></th><th><strong>数据流</strong></th><th><strong>完成度</strong></th></tr></thead><tbody><tr><td><strong>指标 &amp; 日志</strong></td><td><strong>双向跳转</strong></td><td>在 ck 日志指标的看板中，可以根据点击曲线查看到日志的细节；在分析日志时，可以进行 top、时间线图、饼图等分析；</td><td>用户需要先使用 ck 日志才能具备这个能力，对绝大多数 vm 指标不适用；</td></tr><tr><td><strong>指标 &amp; 链路</strong></td><td><strong>基于约定的指标单向跳转到链路</strong></td><td>在应用指标上，用户可以通过点击曲线展开相关指标类型、时间的 trace 数据；</td><td>适配框架指标、定制化的订单数据，对业务指标不适用；</td></tr><tr><td><strong>链路 &amp; 日志</strong></td><td><strong>基于约定的双向跳转</strong></td><td>查看链路时根据 trace-id 搜索相关日志；查看日志根据 trace-id 跳转到链路数据；</td><td>暂没有更深入的可观测需求</td></tr></tbody></table>
<p>当用户面对指标异常时，仍需在多个子系统中手动拼接上下文，这不仅延长了 MTTR，更暴露了当前可观测体系在数据融合维度的深层缺陷：<strong>缺乏一种轻量级、标准化的端到端关联机制</strong>。Exemplar 技术正是针对这一问题的核心解法——它通过在指标数据中内嵌结构化上下文标识（如 TraceID、关键业务标签），构建从聚合指标到原始观测数据的可追溯路径，从而在保持存储架构优势的同时，实现跨数据类型的无缝融合。下文将详细探讨该技术的实践路径。</p>
<h2 data-id="heading-1">二、对行业主流方案的探索与思考</h2>
<ol>
<li>
<h3 data-id="heading-2">OpenTelemetry Exemplar 方案</h3>
</li>
</ol>
<p>OpenTelemetry 作为可观测性领域的开源标准，其 Exemplar 机制通过在指标数据中嵌入 TraceID 和 SpanID 等上下文信息，实现指标与分布式追踪的关联。技术实现上，Exemplar 作为指标样本点的附加属性，支持单个时间序列存储多个 Exemplar 样本，通过 Exemplar Reservoir 机制进行采样和存储管理。该方案的优势在于标准化程度高，与 CNCF 生态深度集成。</p>
<ol start="2">
<li>
<h3 data-id="heading-3">Grafana Exemplar 实践</h3>
</li>
</ol>
<p>Grafana 在可视化层面对 Exemplar 进行了深度整合。在指标图表中，包含 Exemplar 的数据点会以高亮标记（如星形图标）显示，用户点击后可直接跳转至关联的 Trace 详情。该方案依赖后端存储系统（如 Prometheus 2.27+、Mimir）对 Exemplar 的原生支持，通过 Explore 功能提供分析能力，而非独立页面。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c66e0aa7ac0d4c298def4bf73916f3a5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LSn5ouJ5ouJ5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768354785&amp;x-signature=I4NrAPPJ41iw5Utxx12DDRoSpoY%3D" alt="" loading="lazy"/></p>
<ol start="3">
<li>
<h3 data-id="heading-4">Dynatrace OneAgent 方案</h3>
</li>
</ol>
<p>Dynatrace 通过 OneAgent 代理实现了全栈自动化的数据关联能力。OneAgent 能够自动为日志记录添加 TraceID 和 SpanID 等上下文标识，实现日志与追踪的自动关联。该方案的核心特点是通过统一代理架构收集事件、日志、指标和追踪数据，并将它们统一呈现在单一工作负载相关的视图中。</p>
<ol start="4">
<li>
<h3 data-id="heading-5">行业方案的局限性</h3>
</li>
</ol>
<p>我们通过对 OpenTelemetry、Grafana、Dynatrace OneAgent 等主流方案的深入分析，现有 Exemplar 实现存在三个根本性局限，制约了其在复杂业务场景中的价值发挥：</p>
<p><strong>定位局限：增强属性而非独立维度</strong></p>
<p>当前行业方案普遍将 Exemplar 定位为指标的增强属性，而非独立的观测维度。OpenTelemetry 规范中 Exemplar 作为指标样本点的附加字段存在，Grafana 的实现必须依附于指标图表进行交互，Dynatrace 虽实现自动关联但仍将 Exemplar 视为上下文补充。这种设计导致：</p>
<ul>
<li>分析路径单一：只能从指标异常触发 Exemplar 查询，无法反向从 Exemplar 数据发现指标趋势；</li>
<li>查询能力受限：缺乏对 Exemplar 数据本身的聚合、过滤、统计等日志式分析能力；</li>
<li>价值挖掘不足：Exemplar 中蕴含的业务上下文（如订单 ID、用户特征）难以作为独立维度进行分析；</li>
</ul>
<hr/>
<p><strong>架构局限：存储耦合与使用门槛</strong></p>
<p>现有方案在存储架构上存在显著缺陷：</p>
<ul>
<li>存储强耦合：OpenTelemetry 的 Exemplar 必须存储在兼容 Prometheus remote write 的时序数据库中，与指标数据绑定，无法独立扩展</li>
<li>查询体验割裂：Grafana 虽提供 Trace 跳转，但 Exemplar 数据本身无法在 Explore 等通用分析界面中独立使用</li>
<li>接入成本高：现有的 Opentelemetry、Prometheus SDK 难以直接让用户接入 exemplar 。</li>
</ul>
<hr/>
<p><strong>价值局限：场景覆盖不足</strong></p>
<p>行业方案未能充分释放 Exemplar 的潜力：</p>
<ul>
<li>被动关联为主：仅在指标异常时提供上下文，无法主动发现业务模式（如特定用户群的性能退化）</li>
<li>日志能力缺失：Exemplar 虽本质是结构化日志，但现有方案未提供日志检索、字段提取、模式发现等基础能力</li>
</ul>
<hr/>
<ol start="5">
<li>
<h3 data-id="heading-6">我们的思考：Exemplar 作为独立观测维度</h3>
</li>
</ol>
<p>基于上述局限，我们提出 Exemplar as a Dimension 的核心理念：</p>
<ul>
<li>
<p><strong>双重身份</strong>：Exemplar 既是指标与链路/日志的关联桥梁，也是可独立分析的结构化日志流（即在指标-&gt;链路的映射关系之上，建立指标-&gt;日志的映射关系）</p>
</li>
<li>
<p><strong>降维使用</strong>：在异构存储背景下，Exemplar 可作为结构化日志使用，降低接入门槛——无需完整部署日志系统，即可获得关键业务上下文</p>
</li>
<li>
<p><strong>场景扩展</strong>：支持从 Exemplar 数据反向聚合生成指标（如统计特定业务场景的错误率），实现观测维度的自由切换</p>
</li>
</ul>
<h2 data-id="heading-7">三、货拉拉 Exemplar 架构</h2>
<ol>
<li>
<h3 data-id="heading-8">技术选型</h3>
</li>
</ol>
<p>我们选择 VictoriaLogs（以下简称 VLog）作为 Exemplar 的专用存储引擎，基于货拉拉实际业务场景重构内部组件，构建了从数据写入到查询分析的完整链路。这一选型主要基于三点核心考量：</p>
<ul>
<li>
<p><strong>Schemaless</strong>：VictoriaLogs 自动索引所有出现的字段，业务团队无需预先定义日志结构，新业务字段可立即用于查询，较 Ck 日志使用门槛大幅降低；</p>
</li>
<li>
<p><strong>VictoriaMetrics 生态协同</strong>：货拉拉已在全球多个 Region 完成指标系统向 VictoriaMetrics 的迁移。VLog 作为同源产品，共享一致的运维体系，团队无需新增运维技能栈。其简化的 LogQL 语法（与 PromQL 风格统一）大幅降低查询使用门槛；</p>
</li>
<li>
<p><strong>性能出色</strong>：实测，单位相同日志量下，综合成本大约为 ElasticSearch 的 1/10。</p>
</li>
</ul>
<ol start="2">
<li>
<h3 data-id="heading-9">文本传输协议</h3>
</li>
</ol>
<p>我们借鉴了 OpenMetrics 的行协议，以实现对 Prometheus 行协议的前向兼容。</p>















<table><thead><tr><th/><th><strong>Opentelemetry</strong></th><th><strong>货拉拉 Exemplar 行协议</strong></th></tr></thead><tbody><tr><td><strong>核心数据结构</strong></td><td>-   Exemplars 必须由一个 LabelSet 和一个值组成，并且可以有一个时间戳</td><td/></tr></tbody></table>
<ul>
<li>每个 exemplar 如果附加到 TimeSeries，必须包含一个值，可能包含时间戳 | -   必须包含值（counter 中 IncrOnce 对应为 1，histogram 中对应为 observce 的值）</li>
<li>必须包含时间戳（ 最高支持 ns） |
| <strong>Trace 上下文标识</strong> | OpenMetrics Exemplars 必须使用<code>trace_id</code>和<code>span_id</code>键分别表示 trace 和 span ID                             | <code>trace_id</code>和<code>segment_id</code>键分别表示 skwalking 中的 trace 和 segment ID                         |
| <strong>格式兼容性</strong>       | 使用 <code>#</code> 注释跟随在 series 行后                                                                          | 使用 <code># Exemplar</code>独立行跟随在具体的 series 行后，多个 Exemplar 使用多个独立的行                              |</li>
</ul>
<p>其格式如下：</p>
<pre><code class="hljs language-lua" lang="lua"># TYPE foo_request_duration_seconds histogram
foo_request_duration_seconds_bucket{app=<span class="hljs-string">"foo-service"</span>,env=<span class="hljs-string">"prod"</span>,instance=<span class="hljs-string">"10.0.0.1"</span>,method=<span class="hljs-string">"GET"</span>,<span class="hljs-built_in">status</span>=<span class="hljs-string">"200"</span>,le=<span class="hljs-string">"0.005"</span>} <span class="hljs-number">0</span>
foo_request_duration_seconds_bucket{app=<span class="hljs-string">"foo-service"</span>,env=<span class="hljs-string">"prod"</span>,instance=<span class="hljs-string">"10.0.0.1"</span>,method=<span class="hljs-string">"GET"</span>,<span class="hljs-built_in">status</span>=<span class="hljs-string">"200"</span>,le=<span class="hljs-string">"0.01"</span>} <span class="hljs-number">2</span>
foo_request_duration_seconds_bucket{app=<span class="hljs-string">"foo-service"</span>,env=<span class="hljs-string">"prod"</span>,instance=<span class="hljs-string">"10.0.0.1"</span>,method=<span class="hljs-string">"GET"</span>,<span class="hljs-built_in">status</span>=<span class="hljs-string">"200"</span>,le=<span class="hljs-string">"0.025"</span>} <span class="hljs-number">5</span>
# Exemplar {trace_id=<span class="hljs-string">"abc123def4567890"</span>,segment_id=<span class="hljs-string">"xyz789"</span>,user_id=<span class="hljs-string">"user-123"</span>,endpoint=<span class="hljs-string">"/api/v1/query"</span>,client_ip=<span class="hljs-string">"192.168.1.100"</span>,} <span class="hljs-number">0.008456</span> <span class="hljs-number">1700000000123456789</span>
# Exemplar {trace_id=<span class="hljs-string">"def456ghi7890123"</span>,segment_id=<span class="hljs-string">"uvw456"</span>,user_id=<span class="hljs-string">"user-456"</span>,endpoint=<span class="hljs-string">"/api/v1/query_range"</span>,client_ip=<span class="hljs-string">"192.168.1.101"</span>,} <span class="hljs-number">0.018723</span> <span class="hljs-number">1700000000234567890</span>

# TYPE foo_database_query_seconds histogram
foo_database_query_seconds_bucket{service=<span class="hljs-string">"foo-db"</span>,env=<span class="hljs-string">"prod"</span>,query_type=<span class="hljs-string">"select"</span>,database=<span class="hljs-string">"main"</span>,le=<span class="hljs-string">"0.05"</span>} <span class="hljs-number">3</span>
foo_database_query_seconds_bucket{service=<span class="hljs-string">"foo-db"</span>,env=<span class="hljs-string">"prod"</span>,query_type=<span class="hljs-string">"select"</span>,database=<span class="hljs-string">"main"</span>,le=<span class="hljs-string">"0.1"</span>} <span class="hljs-number">8</span>
# Exemplar {trace_id=<span class="hljs-string">"ghi789jkl0123456"</span>,segment_id=<span class="hljs-string">"rst123"</span>,query_id=<span class="hljs-string">"query-789"</span>,<span class="hljs-built_in">table</span>=<span class="hljs-string">"users"</span>,client_app=<span class="hljs-string">"web-frontend"</span>,} <span class="hljs-number">0.042158</span> <span class="hljs-number">1700000000345678901</span>
# Exemplar {trace_id=<span class="hljs-string">"jkl012mno3456789"</span>,segment_id=<span class="hljs-string">"opq789"</span>,query_id=<span class="hljs-string">"query-012"</span>,<span class="hljs-built_in">table</span>=<span class="hljs-string">"orders"</span>,client_app=<span class="hljs-string">"mobile-app"</span>,} <span class="hljs-number">0.087634</span> <span class="hljs-number">1700000000456789012</span>
</code></pre>
<p>3.  ### SDK 数据上报</p>
<p>针对 Exemplar 数据的高吞吐、不可聚合的特性，我们摒弃了 Prometheus 传统的 pull 模型，在 sdk 中新增了一条面向 exemplar 数据的数据流通道，采用 push 机制向后端 collector 发送数据。</p>
<p>由于不同应用场景产生的 Exemplar 日志类型差异显著——单条日志大小可能从几百字节到几十 KB 不等，简单的定时 flush 或基于固定行数的 flush 策略均难以平衡实时性与资源消耗。因此，我们需要设计一套精细的自适应 push 策略，能够根据日志体积、业务重要性和系统负载动态调整推送节奏。</p>
<ul>
<li>
<p><strong>Cache Size 驱动</strong>：SDK 内置滑动窗口缓存，当 Exemplar 数据量达到阈值（默认 10MB）或时间窗口到期（默认 10 秒）时，自动批量推送数据；</p>
</li>
<li>
<p><strong>反压保护</strong>：当后端处理异常时，SDK 自动重试，极端情况下，丢弃以保证服务的稳定性；</p>
</li>
<li>
<p><strong>数据压缩</strong>：采用 gzip 压缩替代原始文本格式，降低网络带宽的占用；</p>
</li>
</ul>
<p>在 golang 中，我们通过扩展既有的 Meter 接口，实现了 Exemplar 数据的标准化上报。该机制将 Exemplar 标签与数值精准附着到对应的指标时间序列上，其调用规范如下：</p>
<ul>
<li><strong>上下文参数</strong>：首个参数必须为 <code>context.Context</code>，用于自动捕获分布式追踪上下文（如 SkyWalking 的 TraceID/SegmentID）；</li>
<li><strong>业务</strong> <strong>标识参数</strong>：第二个参数为关键业务标识字符串（如完整 URL、SQL 、请求入参等等），作为 Exemplar 的核心描述内容；</li>
<li><strong>结构化标签集合</strong>：后续参数为可变数量的 <code>slog</code> 标签，通过 <code>slog.String()</code>/<code>slog.Int64()</code> 等方法定义业务维度标签；</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1e260edb62e94710b168864734b3f126~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LSn5ouJ5ouJ5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768354785&amp;x-signature=SFchNZVzHk%2Bgvr3UBCotzmXw3YA%3D" alt="" loading="lazy"/></p>
<p>在 Java<code> SpringBoot Actuator</code> 中，默认是集成<code>Micrometer</code>作为指标数据上报的标准 API。我们通过扩展 PrometheusMeterRegistry、Counter、Timer 默认实现，在指标数据记录 Value 的同时，实现 Exemplar 数据的上报。具体使用规范如下：</p>
<ul>
<li>
<p>使用**<code>LalaMetricRegistry</code>**<code>#XXbuilder</code>构建</p>
<ul>
<li><em>默认携带</em> <em><code>trace_id</code></em> <em>、</em> <em><code>segment_id</code></em> <em>链路信息；</em></li>
<li>构建可直接放在方法体重复执行，同一个 Meter （Name+Tag 区分）只会创建一次；</li>
<li>Counter 类型按照规范：指标名称，默认会自动添加"_total"后缀（名称已有则不会重复添加），如不需要可添加<code>.withoutTotalSuffix()</code>方法</li>
</ul>
</li>
<li>
<p>Exemplar 扩展信息类型支持长文本（<code>withExemplarMsg</code>方法）、KV 键值对（<code>withExemplarTag</code>）类型，如 KV 键值对，推荐使用内置<code>ExemplarTag</code> 构建输入；</p>
</li>
<li>
<p>支持通过 Endpoint 查看 Exemplar 统计信息和待上报文本内容，需显示配置开启 exemplar、exemplar-data 两个端点；</p>
</li>
<li>
<p>使用示例：</p>
</li>
</ul>

<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@GetMapping</span>(<span class="hljs-string">"/exemplar"</span>)
public String <span class="hljs-built_in">exemplarTest</span>() {
    <span class="hljs-comment">//Histogram 方式1 计时开始位置</span>
    <span class="hljs-selector-tag">Timer</span><span class="hljs-selector-class">.Sample</span> <span class="hljs-selector-tag">sample</span> = <span class="hljs-selector-tag">Timer</span><span class="hljs-selector-class">.start</span>();<span class="hljs-comment">//开始计时位置</span>
    
    <span class="hljs-comment">// Counter 计数器构建，直接放在方法体中，无需提前创建，</span>
    <span class="hljs-comment">// 注意 指标名称，默认会自动添加"_total"后缀，如不需要可添加.withoutTotalSuffix()</span>
    <span class="hljs-selector-tag">LalaMetricRegistry</span><span class="hljs-selector-class">.counterBuilder</span>(<span class="hljs-string">"exemplar_counter_test"</span>)
            <span class="hljs-selector-class">.withoutTotalSuffix</span>() <span class="hljs-comment">// 如显示指定，则不会添加 _total 后缀，建议都加上（防止名称有差异）</span>
            <span class="hljs-selector-class">.tag</span>(<span class="hljs-string">"city_id"</span>, <span class="hljs-string">"13333"</span>)<span class="hljs-comment">//这是指标的label，必须保证收敛</span>
            <span class="hljs-selector-class">.tags</span>(<span class="hljs-string">"business_type"</span>, <span class="hljs-string">"driver"</span>)
            <span class="hljs-selector-class">.register</span>()
            <span class="hljs-selector-class">.withExemplarTag</span>( <span class="hljs-string">"userId"</span> , <span class="hljs-string">"uid123445"</span> ) <span class="hljs-comment">//这是exemplar的扩展信息</span>
<span class="hljs-selector-class">.withExemplarTag</span>(ExemplarTag. int_  ( <span class="hljs-string">"cost_amount"</span> , <span class="hljs-number">3000</span> ))
            <span class="hljs-selector-class">.increment</span>();
     
    <span class="hljs-comment">//Histogram 方式1 终止计时，自定义Bucket 支持serviceLevelObjectives 配置</span>
    <span class="hljs-selector-tag">sample</span><span class="hljs-selector-class">.stop</span>(LalaMetricRegistry.<span class="hljs-built_in">timerBuilder</span>(<span class="hljs-string">"exemplar_timer_test"</span>)
            .<span class="hljs-built_in">tag</span>(<span class="hljs-string">"city_id"</span>, <span class="hljs-string">"1333"</span>)<span class="hljs-comment">//这是指标的label，必须保证收敛</span>
            .<span class="hljs-built_in">serviceLevelObjectives</span>(Duration.<span class="hljs-built_in">ofMillis</span>(<span class="hljs-number">3</span>L), Duration.<span class="hljs-built_in">ofMillis</span>(<span class="hljs-number">6</span>L), Duration.<span class="hljs-built_in">ofMillis</span>(<span class="hljs-number">10</span>L), Duration.<span class="hljs-built_in">ofMillis</span>(<span class="hljs-number">15</span>L), Duration.<span class="hljs-built_in">ofMillis</span>(<span class="hljs-number">25</span>L), Duration.<span class="hljs-built_in">ofMillis</span>(<span class="hljs-number">50</span>L), Duration.<span class="hljs-built_in">ofMillis</span>(<span class="hljs-number">100</span>L), Duration.<span class="hljs-built_in">ofMillis</span>(<span class="hljs-number">1000</span>L))
            .<span class="hljs-built_in">register</span>()
            .<span class="hljs-built_in">withExemplarMsg</span>( <span class="hljs-string">"自定义文本内容"</span> ) <span class="hljs-comment">//有长度限制，1024</span>
.<span class="hljs-built_in">withExemplarTag</span>( <span class="hljs-string">"orderId"</span> , <span class="hljs-string">"did123456"</span> )
.<span class="hljs-built_in">withExemplarTag</span>( <span class="hljs-string">"payId"</span> , <span class="hljs-string">"pid123456"</span> ) );
    
    <span class="hljs-comment">// Histogram 方式2  </span>
    <span class="hljs-selector-tag">LalaMetricRegistry</span><span class="hljs-selector-class">.timerBuilder</span>(<span class="hljs-string">"exemplar_timer_test3"</span>)
        <span class="hljs-selector-class">.tags</span>(<span class="hljs-string">"city_id"</span>, <span class="hljs-string">"13555"</span>)
        <span class="hljs-selector-class">.serviceLevelObjectives</span>(BucketConfigs.<span class="hljs-built_in">getInstance</span>().<span class="hljs-built_in">getDurations</span>(HllBucketType.API))
        <span class="hljs-selector-class">.register</span>()
    <span class="hljs-selector-class">.withExemplarMsg</span>( <span class="hljs-string">"plain text"</span> )
<span class="hljs-selector-class">.withExemplarTag</span>( <span class="hljs-string">"userId"</span> , <span class="hljs-string">"123456"</span> )
        <span class="hljs-selector-class">.record</span>(Duration.<span class="hljs-built_in">ofMillis</span>(<span class="hljs-number">15</span>));  <span class="hljs-comment">//记录耗时   </span>
            
    <span class="hljs-selector-tag">return</span> "<span class="hljs-selector-tag">SUCCESS</span>";
}
</code></pre>
<ul>
<li><strong>两种 Label 的对比：</strong></li>
</ul>



































<table><thead><tr><th>特性</th><th>Meter Labels</th><th>Exemplar Labels</th></tr></thead><tbody><tr><td>存储机制</td><td>每个唯一组合生成独立时间序列</td><td>附加在样本上的键值对，不影响时间序列</td></tr><tr><td>基数限制</td><td>严格限制（具备采集防御）</td><td>无限制（Victoria-Logs全采样）</td></tr><tr><td>查询场景</td><td>聚合分析（如sum by(appid)）</td><td>单点详情追溯（点击曲线查看日志）</td></tr><tr><td>资源消耗</td><td>高（序列数直接影响性能）</td><td>低（仅存储样本时的附加信息）</td></tr><tr><td>保留策略</td><td>半年</td><td>7天</td></tr></tbody></table>
<ol start="4">
<li>
<h3 data-id="heading-10">Exemplar-Collector</h3>
</li>
</ol>
<p>Exemplar-Collector 是一个轻量化的数据接收处理组件，作为 VictoriaMetrics 指标体系与 VictoriaLogs 日志系统的桥梁，它承担两个核心职责：</p>
<p><strong>数据写入处理</strong></p>
<ul>
<li>
<p><strong>relabeling</strong>：接收应用 SDK 推送的 Exemplar 数据，流式解析文本协议，混合 series labels 与 exemplar labels，使用<code>internal/insert</code> 接口进行数据写入；丢弃无用标签如 <code>job</code>、<code>instance</code>等；</p>
</li>
<li>
<p><strong>元数据记录</strong>：记录应用（appid）与指标（metric）的关联关系到 MySQL，用于后续查询优化，如 histogram 复合指标的支持，智能关联等；</p>
</li>
</ul>
<p><strong>数据查询</strong> <strong>处理</strong></p>
<ul>
<li>
<p><strong>统一查询接口</strong>：提供直方图分布、时间序列、饼图、TopN 统计等预置分析模式，屏蔽底层存储差异；</p>
</li>
<li>
<p><strong>语法兼容层</strong>：自动将 PromQL 指标查询转换为 LogsQL 日志查询，使业务团队点击 promethues 图表便能转换到 exemplar 查询；</p>
</li>
<li>
<p><strong>智能关联</strong>：根据指标与应用的元数据映射，为存量的图表自动注入 Exemplar 跳转能力，实现"指标→Trace/日志"一键穿透；</p>
</li>
</ul>
<h2 data-id="heading-11">四、可视化交互</h2>
<p>可视化交互是释放 Exemplar 价值的核心环节。依托货拉拉全自研的 Lala-Monitor 监控系统（集成指标、日志、链路、告警的统一可观测平台），我们突破了 Grafana 等通用工具的交互限制，构建了深度优化的 Exemplar 分析界面。</p>
<p>我们的交互设计围绕 Exemplar 的结构化日志特性展开，实现四大核心能力：</p>
<ul>
<li>
<p><strong>智能关联</strong>：自动关联图表与 Exemplar，同时支持业务人员手动指定 logsql 进行关联；</p>
</li>
<li>
<p><strong>Drill-down</strong>：从指标→Exemplar 日志→trace 的无缝穿透；</p>
</li>
<li>
<p><strong>日志分析</strong>：提供完整的日志检索页面，支持类似 ES 的全文检索、字段过滤和模式发现，可直接分析 Exemplar 结构化日志内容；</p>
</li>
<li>
<p><strong>多维统计图表：</strong> 基于 Exemplar 数据自动生成时序统计图、排行榜、饼图及柱状图，直观展示业务维度分布（如错误类型占比、慢请求地域分布）；</p>
</li>
</ul>
<ol>
<li>
<h3 data-id="heading-12">智能关联</h3>
</li>
</ol>
<p>当业务指标启用 Exemplar 功能后，Lala-Monitor 会在对应图表上自动添加 Exemplar 标识。此时，用户可直接点击指标曲线上的数据点，查看关联的 Exemplar 日志。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/097c4244c75d40bcbdc908f723204edf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LSn5ouJ5ouJ5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768354785&amp;x-signature=TpptRtPdL0QtTBN4h%2FAOhGh2MQw%3D" alt="" loading="lazy"/></p>
<p>除业务指标外，Lala-Monitor 还为所有已配置的看板图表提供自动联动查询能力。系统定期扫描全量看板，识别包含 Exemplar 数据的指标，并为相关图表开启联动查询能力——无需任何人工配置，用户即可直接点击指标曲线查看关联的 Exemplar 日志。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9de92303df0f474fb848a5b6b865b75c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LSn5ouJ5ouJ5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768354785&amp;x-signature=rYfQObM3IJY6gXXKUT5UaIjB%2BdQ%3D" alt="" loading="lazy"/></p>
<p>在绝大多数场景下，系统内置的自动关联机制能够准确建立指标与 Exemplar 的映射关系。但在特殊情况下——例如多个应用 ID（appid）共享相同指标名称，或需要与看板变量进行复杂联动时——用户可通过手动指定 appid 和 LogSQL 查询条件来精确控制关联逻辑，确保 Exemplar 数据的准确提取与展示。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/92503151435545ee89801a504b2cf770~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LSn5ouJ5ouJ5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768354785&amp;x-signature=X2Uk7wrsKgKzD9kYr15DYja2IWk%3D" alt="" loading="lazy"/></p>
<ol start="2">
<li>
<h3 data-id="heading-13">Drill-Down 下钻分析</h3>
</li>
</ol>
<p>类似 Grafana 的 drilldown 机制，Lala-Monitor 实现了基于 Exemplar 的深度下钻分析能力。用户可直接点击指标曲线上的数据点，系统会自动携带该点的标签信息和 PromQL 查询条件，精准跳转至关联的 Trace 详情页和 Exemplar 日志分析界面，实现从宏观指标到微观上下文的无缝穿透。</p>
<p>如下图所示，当用户在 HTTP RT 监控曲线中发现性能突刺点（红色标记处），只需点击该数据点，Lala-Monitor 将自动触发 Exemplar drill-down 流程：系统智能捕获该时间点的指标上下文（包括 hll_ip、route 等关键标签），并携带精确的时间窗口（10:28:30.000 ～ 10:29:30.000）跳转至 Exemplar 日志分析界面。在此界面中，用户可直接查看与性能异常相关的结构化日志，包括 TraceID、请求参数及响应时间等关键信息；</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/08b491c7064348dea7364ca5ae216963~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LSn5ouJ5ouJ5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768354785&amp;x-signature=%2BvLCFV3iMUFIubSLV6wfLcfsz4s%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a90f7126aa28432abf1350187981a274~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LSn5ouJ5ouJ5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768354785&amp;x-signature=Crie7ckIbRnHx5Zs8BfmIBHbJq0%3D" alt="" loading="lazy"/></p>
<p>系统会基于当前 PromQL 查询特征智能推荐聚合函数（如图中自动推荐 max），用户也可通过下拉菜单灵活切换 sum、avg、p99 等多种聚合方式，对查询窗口内的 Exemplar 数据进行多维度统计分析，精准识别性能异常点与业务关键特征。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b4ff3f2df6d144978c93301484c38f17~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LSn5ouJ5ouJ5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768354785&amp;x-signature=5B6jP2GqBpkGFe%2FHQe0oKy0oHc0%3D" alt="" loading="lazy"/></p>
<ol start="3">
<li>
<h3 data-id="heading-14">日志分析</h3>
</li>
</ol>
<p>除指标 drill-down 作为主要入口外，Lala-Monitor 提供独立的 Exemplar 日志分析页面，支持完整的日志检索能力。该界面具备与 Elasticsearch 相似的交互体验：支持交互式搜索、字段过滤、关键词排除、正则匹配及 TopN 统计分析，同时针对 Exemplar 结构化特性优化了聚合操作。</p>
<p>在性能方面，Vlog 的在亿级日志行规模下仍保持秒级响应。这得益于当前的数据分片策略：每个 Exemplar 流（_stream）由<code>appid+metric-name</code>唯一标识，确保单个数据流规模可控。例如，"order-service+http_request_duration"流仅包含该服务的 HTTP 延迟数据，避免了跨业务、跨类型日志混杂数据量膨胀导致的性能衰减。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fee58b2ef3ea465f8beea8c7ae61e8d2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LSn5ouJ5ouJ5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768354785&amp;x-signature=nef3qTodOZJP7BQD4EjTSsHuq6s%3D" alt="" loading="lazy"/></p>
<ol start="4">
<li>
<h3 data-id="heading-15"><strong>Drill-Up 多维统计</strong></h3>
</li>
</ol>
<p>多维统计将 Exemplar 结构化日志转化为可视化图表，实现高基数维度的聚合分析。与 Prometheus 指标要求维度可枚举、基数收敛的特性不同，Exemplar 支持对 user_id、driver_id 等高发散性业务维度进行实时统计，使研发能够从海量日志中快速识别异常模式和业务特征，突破指标系统在维度分析上的限制。</p>
<p>以下的时序图可用来对多个维度进行 group by 的统计，类似 prometheus 的 range query</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4480559aeed84520ac7a2a112acaa5eb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LSn5ouJ5ouJ5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768354785&amp;x-signature=Foxrg1dKpROBHtEcq55UUIHNFb8%3D" alt="" loading="lazy"/></p>
<p>而排行榜和饼图的功能基本一致，可进行总量计算，类似 promethues 的 instant query</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a31fa8ec9d404298a39395435221d406~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LSn5ouJ5ouJ5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768354785&amp;x-signature=oyK8phxTV9%2F8IvyGMeO54KITUg0%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-16">五、Exemplar 在货拉拉的落地</h2>
<p>在完成 Client SDK 和 Server Collector 建设后，我们首先在内部监控平台上线验证，效果符合预期。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d5aea542461c4c8ab34303f061d811a1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LSn5ouJ5ouJ5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768354785&amp;x-signature=gkjAK%2FMPZOsunqaA6Nhzd2IyuAs%3D" alt="" loading="lazy"/></p>
<ul>
<li>针对业务自定义指标场景，重点解决高基数问题。业务定位时需通过用户 ID、司机 ID、订单 ID 等关键属性下钻，但传统指标无法将此类高基数数据放入 Label。通过 Exemplar 机制，我们可以直接在指标采样中携带业务 ID 及关联 Trace 信息，使问题分析能从业务属性直接切入，无需跨系统转换查找 Trace。</li>
<li>目前核心订单服务的订单统计指标、企业业务的异常统计指标等几十个核心服务已完成上线，业务团队反馈问题定位效率显著提升，获得一线同学的一致认可。</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a869ab8357e04ca3a12827cea949654b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LSn5ouJ5ouJ5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768354785&amp;x-signature=sxF1VSC8ssV9yOK5%2B1wVFy02K4g%3D" alt="" loading="lazy"/></p>
<p>接下来，我们将把 Exemplar 能力下沉至基础组件（如 SOA、MySQL/Redis 客户端），覆盖更多基础设施层指标。</p>
<hr/>
<h2 data-id="heading-17">六、未来展望</h2>
<p>过去几个月，我们已初步落地 Exemplar 技术，覆盖部分核心业务场景。2026 年，我们将重点深化 Exemplar 在数据融合领域的应用价值：</p>
<ol>
<li>
<h3 data-id="heading-18">框架指标→链路的精准关联</h3>
</li>
</ol>
<p>当前货拉拉 Java 框架中，链路数据通过 SkyWalking 的 gRPC 通道上报 Trace，框架指标数据则依赖 Micrometer 采集。两者虽能基于接口类型、方法名等维度进行关联，但存在显著缺陷：</p>
<ul>
<li>数据粒度不匹配：指标层面的接口聚合会丢失明细特征，而链路数据保持原始粒度；</li>
<li>维度定义差异：指标与链路在埋点时的维度命名、取值逻辑存在不一致；</li>
<li>检索能力受限：现有的 trace 存储方案仅支持 Segment 级 RT 倒序，缺乏 Span 级精细化排序能力；</li>
</ul>
<p>这些缺陷导致点击指标时难以精准下钻至关键 Trace，影响问题定位效率。明年，我们将重构关联机制，通过 Exemplar 标准化上报 TraceID 与 SpanID，实现框架指标与链路的精准映射。</p>
<ol start="2">
<li>
<h3 data-id="heading-19">基于 Exemplar 数据的故障定位</h3>
</li>
</ol>
<p>Exemplar 的核心价值不仅在于实现指标与上下文的关联，更在于其作为结构化日志所具备的分析潜力。在此基础上，我们将重点在明年进行基于 Exemplar 进行自动化推导链设计，将可观测数据真正转化为可执行的故障洞察。</p>
<p>该推导链以报警、巡检、人工触发为起点，以根因为终点，通过以下环节进行自动推理：</p>
<ul>
<li><strong>报警触发与 Exemplar 抽样</strong>：当指标报警触发时，系统自动回溯该指标在异常窗口内的所有 Exemplar 数据。得益于 Exemplar 与指标样本的原生绑定，无需额外关联逻辑即可获取高质量上下文样本；</li>
<li><strong>Trace 自动关联</strong>：从 Exemplar 中提取 <code>trace_id</code> 集合，批量查询分布式链路系统，还原完整调用拓扑。由于 Exemplar 已携带精确时间戳与服务上下文，可避免模糊检索带来的噪声；</li>
<li><strong>异常维度收敛</strong>：复用已实现的指标下钻分析，结合关联 Trace 的结构化字段（如 <code>service_name</code>、<code>endpoint</code>、<code>error_code</code>）进行实时聚合，识别高频异常维度。例如，若 80% 的 Trace 均包含 <code>error_code=DB_TIMEOUT</code>，则将其标记为候选根因；</li>
<li><strong>多指标协同折叠</strong>：当某个 appid 多个指标同时报警时，计算其 Exemplar 中 <code>trace_id</code> 的交集。若交集显著，则判定为同一底层故障，并将多个告警折叠为单一事件，避免告警风暴；</li>
<li><strong>结构化推导输出</strong>：最终生成包含“异常指标—关联 Trace—收敛维度—影响范围”的完整证据链，直接嵌入报警通知或运维工单，为故障处理提供可操作的上下文，而非仅仅堆砌几个相关的 trace。</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[揭秘 Spring Boot 事务：动态增强的底层实现与核心组件]]></title>    <link>https://juejin.cn/post/7592069113222512659</link>    <guid>https://juejin.cn/post/7592069113222512659</guid>    <pubDate>2026-01-06T23:34:13.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592069113222512659" data-draft-id="7591792747775246346" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="揭秘 Spring Boot 事务：动态增强的底层实现与核心组件"/> <meta itemprop="keywords" content="Spring Boot"/> <meta itemprop="datePublished" content="2026-01-06T23:34:13.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="闲煮光阴"/> <meta itemprop="url" content="https://juejin.cn/user/1523239911963420"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            揭秘 Spring Boot 事务：动态增强的底层实现与核心组件
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1523239911963420/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    闲煮光阴
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-06T23:34:13.000Z" title="Tue Jan 06 2026 23:34:13 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在分布式系统和复杂业务场景中，事务管理是保障数据一致性的核心技术之一。Spring Boot 提供的声明式事务机制，通过 “动态” 方式简化了事务配置，让开发者无需手动编写事务控制代码，仅通过简单注解即可实现事务管理。本文将从 “问题本质 - 基础知识 - 实现流程 - 底层原理” 四个维度，层层拆解 Spring Boot 动态事务的实现逻辑。</p>
<h2 data-id="heading-0">一、如何实现动态事务？—— 问题本质与核心思路</h2>
<p>动态事务的核心诉求是：让程序自动识别需要事务的方法，并自动完成事务的开启、提交、回滚等操作。这个过程本质是 “标记识别 + 逻辑执行” 的组合，我们可以通过生活化的场景理解其核心思路：</p>
<ol>
<li>
<p><strong>如何识别需要事务的方法？—— 给方法打 “事务标记”</strong></p>
<p>要让程序知道哪个方法需要事务，最直接的方式是给方法添加一个 “显性标记”。就像超市里的商品标签：无论商品是零食、日用品还是生鲜，只要贴上 “促销” 标签，就会被纳入促销活动；同理，无论方法是查询、新增还是修改操作，只要打上特定标记，就会被程序识别为 “需要事务支持” 的方法。这个标记在 Spring Boot 中，就是@Transactional注解。</p>
</li>
<li>
<p><strong>如何处理 “事务标记”？—— 编写 “标记解析器”</strong></p>
<p>仅有标记不够，还需要一个能 “读懂” 标记的程序，来执行标记对应的逻辑（开启事务、执行方法、提交 / 回滚事务）。这就像收到一份带 “加急” 标记的文件：首先需要识别 “加急” 标记，然后执行 “优先处理、限时完成” 的逻辑；如果没有这个解析逻辑，“加急” 标记就只是一个无效符号。在 Spring Boot 中，这个 “标记解析器” 就是TransactionInterceptor（事务拦截器）。</p>
</li>
</ol>
<p>综上，动态事务的实现只需<strong>两个核心要素</strong>：</p>
<ul>
<li><strong>标记：</strong> 告诉程序 “谁需要事务”（对应@Transactional注解）；</li>
<li><strong>解析器：</strong> 告诉程序 “遇到事务标记该做什么”（对应TransactionInterceptor）。</li>
</ul>
<p>这一思路也贯穿了 Spring 体系的核心设计思想 —— 大多数 Spring 特性（如 AOP、缓存、异步任务），都是通过 “注解标记 + 解析器” 的组合模式实现的。</p>
<h2 data-id="heading-1">二、Spring Boot 事务实现的基础知识储备</h2>
<p>要理解动态事务的底层逻辑，需要先掌握三个核心基础知识，它们是事务实现的 “地基”：</p>
<ol>
<li>
<p><strong>Spring Boot 查找 Bean 的流程</strong></p>
<p>Spring Boot 的核心是 IoC 容器，所有被管理的对象（Bean）都会通过容器初始化、注册、获取。事务管理的前提是：需要事务支持的 Bean 必须被 Spring IoC 容器管理（即 “交给 Spring 管”），否则容器无法对其进行事务增强。核心流程包括：扫描指定包路径→解析类上的@Component、@Service等注解→创建 Bean 实例→注册到 IoC 容器。</p>
</li>
<li>
<p><strong>Spring Context 初始化流程</strong></p>
<p>Spring Context（应用上下文）是 IoC 容器的具体实现，其初始化过程会触发一系列关键操作：加载配置类→扫描 Bean 定义→实例化 Bean→执行 Bean 的后置处理器（BeanPostProcessor）。事务的动态增强，正是通过 “Bean 后置处理器” 在 Bean 初始化后期完成的。</p>
</li>
<li>
<p><strong>Spring AOP 流程</strong></p>
<p>Spring 事务的底层依赖 AOP（面向切面编程）。AOP 通过 “动态代理” 机制，在不修改目标方法源码的前提下，对方法进行增强（如添加事务控制逻辑）。</p>
</li>
</ol>
<h2 data-id="heading-2">三、Spring Boot 事务的具体实现流程</h2>
<p>基于上述基础知识，Spring Boot 实现事务的流程可简化为 4 步，且大部分步骤由框架自动完成，开发者仅需少量配置：</p>
<ol>
<li>
<p><strong>将目标对象交给 Spring 管理</strong></p>
<p>在业务类（如UserService）上添加@Service注解，让 Spring 在初始化时扫描并创建该类的 Bean 实例，纳入 IoC 容器管理。这是事务增强的前提 —— 只有容器管理的 Bean，才能被 AOP 动态代理。</p>
</li>
<li>
<p><strong>给目标方法添加事务标记</strong></p>
<p>在需要事务支持的方法（如addUser()）上添加@Transactional注解。该注解可配置事务传播行为（如propagation = Propagation.REQUIRED）、隔离级别（如isolation = Isolation.READ_COMMITTED）、回滚条件（如rollbackFor = Exception.class）等属性，精准控制事务行为。</p>
</li>
<li>
<p><strong>Spring 自动加载事务解析器</strong></p>
<p>开发者无需手动编写事务解析逻辑，Spring Boot 通过 “自动配置” 机制，默认加载TransactionInterceptor（事务拦截器）。该拦截器封装了事务的核心逻辑：开启事务→执行目标方法→若方法正常执行则提交事务→若抛出异常则回滚事务。</p>
</li>
<li>
<p><strong>Spring AOP 自动完成切面织入</strong></p>
<p>Spring Boot 自动将@Transactional注解解析为切入点（Pointcut），将TransactionInterceptor作为通知（Advice），组合成切面（Advisor）。随后通过 AOP 动态代理机制，为目标 Bean 生成代理对象 —— 当调用目标方法时，实际执行的是代理对象的方法，代理对象会先触发TransactionInterceptor的事务逻辑，再执行目标方法。</p>
</li>
</ol>
<p><strong>总结：</strong> 开发者仅需完成 “添加@Service注解” 和 “添加@Transactional注解” 两步，Spring Boot 会自动完成 “加载解析器” 和 “AOP 织入”，实现事务的动态增强。</p>
<h2 data-id="heading-3">四、Spring Boot 事务的底层实现原理</h2>
<p>上述流程的核心是 “自动配置” 和 “AOP 动态代理”，下面通过源码拆解关键步骤，揭秘其底层逻辑（重点解析流程 3 和流程 4）。</p>
<h3 data-id="heading-4">1. 事务自动配置的入口：TransactionAutoConfiguration</h3>
<p>Spring Boot 的自动配置依赖META-INF/spring.factories文件，其中注册了TransactionAutoConfiguration（事务自动配置类）。当 Spring Boot 启动时，会扫描该文件并加载该类，开启事务管理能力。</p>
<p>TransactionAutoConfiguration的核心内部类EnableTransactionManagementConfiguration，通过@EnableTransactionManagement注解触发事务相关 Bean 的加载，代码如下：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@ConditionalOnClass(PlatformTransactionManager.class)</span>
<span class="hljs-meta">@AutoConfigureAfter({JtaAutoConfiguration.class, HibernateJpaAutoConfiguration.class})</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TransactionAutoConfiguration</span> {

    <span class="hljs-comment">// 内部类：启用事务管理的配置</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EnableTransactionManagementConfiguration</span> {

        <span class="hljs-comment">// CGLIB动态代理配置（默认启用）</span>
        <span class="hljs-meta">@Configuration(proxyBeanMethods = false)</span>
        <span class="hljs-meta">@EnableTransactionManagement(proxyTargetClass = true)</span>
        <span class="hljs-meta">@ConditionalOnProperty(
            prefix = "spring.aop", 
            name = "proxy-target-class", 
            havingValue = "true", 
            matchIfMissing = true
        )</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CglibAutoProxyConfiguration</span> {
        }

        <span class="hljs-comment">// JDK动态代理配置（需手动设置spring.aop.proxy-target-class=false）</span>
        <span class="hljs-meta">@Configuration(proxyBeanMethods = false)</span>
        <span class="hljs-meta">@EnableTransactionManagement(proxyTargetClass = false)</span>
        <span class="hljs-meta">@ConditionalOnProperty(
            prefix = "spring.aop", 
            name = "proxy-target-class", 
            havingValue = "false"
        )</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JdkDynamicAutoProxyConfiguration</span> {
        }
    }
}
</code></pre>
<p>关键说明：</p>
<ul>
<li><strong>@EnableTransactionManagement：</strong> 事务实现的核心注解，用于加载事务管理相关的 Bean；</li>
<li><strong>proxyTargetClass = true：</strong> 默认使用 CGLIB 动态代理（可代理类和接口），false时使用 JDK 动态代理（仅代理接口）。</li>
</ul>
<h3 data-id="heading-5">2. @EnableTransactionManagement的核心作用：加载两大关键组件</h3>
<p>@EnableTransactionManagement通过Import注解，导入了两个核心类：ProxyTransactionManagementConfiguration和AutoProxyRegistrar，二者共同完成事务的 AOP 增强。</p>
<p><strong>（1）ProxyTransactionManagementConfiguration：</strong> 创建事务切面（Advisor）该类是一个配置类，通过@Bean注解注册了三个核心 Bean，最终组合成事务切面：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ProxyTransactionManagementConfiguration</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractTransactionManagementConfiguration</span> {

    <span class="hljs-comment">// 1. 注册事务切面（Advisor）：切入点 + 通知的组合</span>
    <span class="hljs-meta">@Bean(name = TransactionManagementConfigUtils.TRANSACTION_ADVISOR_BEAN_NAME)</span>
    <span class="hljs-meta">@Role(BeanDefinition.ROLE_INFRASTRUCTURE)</span>
    <span class="hljs-keyword">public</span> BeanFactoryTransactionAttributeSourceAdvisor <span class="hljs-title function_">transactionAdvisor</span><span class="hljs-params">(
            TransactionAttributeSource transactionAttributeSource,
            TransactionInterceptor transactionInterceptor)</span> {
        <span class="hljs-type">BeanFactoryTransactionAttributeSourceAdvisor</span> <span class="hljs-variable">advisor</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BeanFactoryTransactionAttributeSourceAdvisor</span>();
        <span class="hljs-comment">// 绑定切入点：通过TransactionAttributeSource识别@Transactional注解</span>
        advisor.setTransactionAttributeSource(transactionAttributeSource);
        <span class="hljs-comment">// 绑定通知：通过TransactionInterceptor执行事务逻辑</span>
        advisor.setAdvice(transactionInterceptor);
        <span class="hljs-comment">// 设置切面优先级（可通过@EnableTransactionManagement的order属性配置）</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.enableTx != <span class="hljs-literal">null</span>) {
            advisor.setOrder(<span class="hljs-built_in">this</span>.enableTx.&lt;Integer&gt;getNumber(<span class="hljs-string">"order"</span>));
        }
        <span class="hljs-keyword">return</span> advisor;
    }

    <span class="hljs-comment">// 2. 注册TransactionAttributeSource：解析@Transactional注解的属性</span>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-meta">@Role(BeanDefinition.ROLE_INFRASTRUCTURE)</span>
    <span class="hljs-keyword">public</span> TransactionAttributeSource <span class="hljs-title function_">transactionAttributeSource</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// AnnotationTransactionAttributeSource专门用于解析@Transactional注解</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AnnotationTransactionAttributeSource</span>();
    }

    <span class="hljs-comment">// 3. 注册TransactionInterceptor：事务拦截器（核心通知逻辑）</span>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-meta">@Role(BeanDefinition.ROLE_INFRASTRUCTURE)</span>
    <span class="hljs-keyword">public</span> TransactionInterceptor <span class="hljs-title function_">transactionInterceptor</span><span class="hljs-params">(TransactionAttributeSource transactionAttributeSource)</span> {
        <span class="hljs-type">TransactionInterceptor</span> <span class="hljs-variable">interceptor</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TransactionInterceptor</span>();
        <span class="hljs-comment">// 绑定注解解析器，用于获取@Transactional的配置属性（如隔离级别、回滚条件）</span>
        interceptor.setTransactionAttributeSource(transactionAttributeSource);
        <span class="hljs-comment">// 绑定事务管理器（如DataSourceTransactionManager，默认自动配置）</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.txManager != <span class="hljs-literal">null</span>) {
            interceptor.setTransactionManager(<span class="hljs-built_in">this</span>.txManager);
        }
        <span class="hljs-keyword">return</span> interceptor;
    }
}
</code></pre>
<p>三个 Bean 的作用分工：</p>
<ul>
<li><strong>TransactionAttributeSource：</strong> 解析@Transactional注解的属性（如rollbackFor、propagation），将注解信息封装为TransactionAttribute对象；</li>
<li><strong>TransactionInterceptor：</strong> 事务的核心执行逻辑，实现了MethodInterceptor接口，在目标方法执行前后拦截：
执行前：根据TransactionAttribute开启事务；执行后：若方法无异常，提交事务；若抛出异常，根据rollbackFor配置回滚事务；</li>
<li><strong>BeanFactoryTransactionAttributeSourceAdvisor：</strong> 切面类，将 “@Transactional切入点” 与 “TransactionInterceptor通知” 绑定，供 AOP 框架识别。</li>
</ul>
<p><strong>（2）AutoProxyRegistrar：开启 AOP 动态代理能力</strong></p>
<p>AutoProxyRegistrar的核心作用是向 Spring 容器注册AnnotationAwareAspectJAutoProxyCreator对象，该对象是 AOP 动态代理的核心处理器，实现了BeanPostProcessor接口（Bean 后置处理器）。</p>
<p>在 Spring Context 初始化流程中，当 Bean 实例化完成后，会调用BeanPostProcessor的postProcessAfterInitialization方法，AnnotationAwareAspectJAutoProxyCreator重写了该方法，核心逻辑如下：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AnnotationAwareAspectJAutoProxyCreator</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AspectJAwareAdvisorAutoProxyCreator</span> {

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">postProcessAfterInitialization</span><span class="hljs-params">(<span class="hljs-meta">@Nullable</span> Object bean, String beanName)</span> {
        <span class="hljs-keyword">if</span> (bean != <span class="hljs-literal">null</span>) {
            <span class="hljs-comment">// 生成Bean的缓存Key（基于类名+Bean名称）</span>
            <span class="hljs-type">Object</span> <span class="hljs-variable">cacheKey</span> <span class="hljs-operator">=</span> getCacheKey(bean.getClass(), beanName);
            <span class="hljs-comment">// 避免重复代理（早期代理引用已存在时直接返回）</span>
            <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.earlyProxyReferences.remove(cacheKey) != bean) {
                <span class="hljs-comment">// 核心逻辑：判断Bean是否需要被代理，若需要则生成代理对象</span>
                <span class="hljs-keyword">return</span> wrapIfNecessary(bean, beanName, cacheKey);
            }
        }
        <span class="hljs-keyword">return</span> bean;
    }

    <span class="hljs-keyword">protected</span> Object <span class="hljs-title function_">wrapIfNecessary</span><span class="hljs-params">(Object bean, String beanName, Object cacheKey)</span> {
        <span class="hljs-comment">// 1. 检查Bean是否已被代理，或是否为Spring内部Bean（如事务管理器），无需代理则直接返回</span>
        <span class="hljs-keyword">if</span> (beanName != <span class="hljs-literal">null</span> &amp;&amp; <span class="hljs-built_in">this</span>.targetSourcedBeans.contains(beanName)) {
            <span class="hljs-keyword">return</span> bean;
        }
        <span class="hljs-keyword">if</span> (Boolean.FALSE.equals(<span class="hljs-built_in">this</span>.advisedBeans.get(cacheKey))) {
            <span class="hljs-keyword">return</span> bean;
        }
        <span class="hljs-comment">// 2. 检查Bean是否符合切入点条件（是否带有@Transactional注解）</span>
        <span class="hljs-keyword">if</span> (isInfrastructureClass(bean.getClass()) || shouldSkip(bean.getClass(), beanName)) {
            <span class="hljs-built_in">this</span>.advisedBeans.put(cacheKey, Boolean.FALSE);
            <span class="hljs-keyword">return</span> bean;
        }

        <span class="hljs-comment">// 3. 查找所有匹配的切面（Advisor）：此处会找到TransactionAdvisor</span>
        Object[] specificInterceptors = getAdvicesAndAdvisorsForBean(bean.getClass(), beanName, <span class="hljs-literal">null</span>);
        <span class="hljs-keyword">if</span> (specificInterceptors != DO_NOT_PROXY) {
            <span class="hljs-built_in">this</span>.advisedBeans.put(cacheKey, Boolean.TRUE);
            <span class="hljs-comment">// 4. 生成代理对象（CGLIB或JDK动态代理）</span>
            <span class="hljs-type">Object</span> <span class="hljs-variable">proxy</span> <span class="hljs-operator">=</span> createProxy(
                bean.getClass(), beanName, specificInterceptors, <span class="hljs-keyword">new</span> <span class="hljs-title class_">SingletonTargetSource</span>(bean));
            <span class="hljs-built_in">this</span>.proxyTypes.put(cacheKey, proxy.getClass());
            <span class="hljs-keyword">return</span> proxy;
        }

        <span class="hljs-built_in">this</span>.advisedBeans.put(cacheKey, Boolean.FALSE);
        <span class="hljs-keyword">return</span> bean;
    }
}
</code></pre>
<p>核心逻辑说明：</p>
<ul>
<li>wrapIfNecessary方法会先判断 Bean 是否需要代理（即是否带有@Transactional注解）；</li>
<li>若需要代理，会查找所有匹配的切面（此处即TransactionAdvisor）；</li>
<li>通过createProxy方法生成代理对象（默认 CGLIB 代理）；</li>
<li>后续调用目标 Bean 的方法时，实际执行的是代理对象的方法，代理对象会先触发TransactionInterceptor的事务逻辑，再执行目标方法。</li>
</ul>
<h3 data-id="heading-6">3. 事务执行的完整链路总结</h3>
<ol>
<li>Spring Boot 启动，加载TransactionAutoConfiguration，通过@EnableTransactionManagement导入</li>
<li>ProxyTransactionManagementConfiguration和AutoProxyRegistrar；ProxyTransactionManagementConfiguration注册TransactionAttributeSource（解析注解）、TransactionInterceptor（事务逻辑）、TransactionAdvisor（切面）；</li>
<li>AutoProxyRegistrar注册AnnotationAwareAspectJAutoProxyCreator（AOP 代理处理器）；</li>
<li>Spring 扫描@Service注解的类，创建目标 Bean 实例；</li>
<li>AnnotationAwareAspectJAutoProxyCreator在 Bean 初始化后，通过wrapIfNecessary方法检测到 Bean 带有@Transactional注解，生成代理对象；</li>
<li>开发者调用目标方法时，实际调用代理对象的方法；</li>
<li>代理对象触发TransactionInterceptor：
<ul>
<li>解析@Transactional注解属性，通过事务管理器开启事务；</li>
<li>执行目标方法；</li>
<li>目标方法正常返回：提交事务；</li>
<li>目标方法抛出异常：根据rollbackFor配置回滚事务。</li>
</ul>
</li>
</ol>
<h2 data-id="heading-7">五、Spring Boot 事务实现原理图示</h2>
<ol>
<li>核心组件注册</li>
</ol>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    %% 启动初始化阶段
    A["Spring Boot 启动"] --&gt; B["扫描 spring.factories 文件"]
    B --&gt; C["加载 TransactionAutoConfiguration 自动配置类"]
    C --&gt; D["@EnableTransactionManagement 注解生效"]
    
    %% 核心组件加载阶段
    D --&gt; D1["导入 ProxyTransactionManagementConfiguration"]
    D --&gt; D2["导入 AutoProxyRegistrar"]
    
    %% ProxyTransactionManagementConfiguration 注册Bean
    D1 --&gt; E1["注册 TransactionAttributeSource &lt;br/&gt;（解析@Transactional注解）"]
    D1 --&gt; E2["注册 TransactionInterceptor&lt;br/&gt;（事务拦截器：开启/提交/回滚）"]
    D1 --&gt; E3["注册 TransactionAdvisor&lt;br/&gt;（切面=切入点+通知）"]
    E1 &amp; E2 &amp; E3 --&gt; E4["组合为事务切面"]  
  
    %% AutoProxyRegistrar 开启AOP代理
    D2 --&gt; F["注册 AnnotationAwareAspectJAutoProxyCreator&lt;br/&gt;（AOP代理处理器，实现BeanPostProcessor）"]
</code></pre>
<ol start="2">
<li>生成代理对象</li>
</ol>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
  %% Bean初始化与代理生成阶段
    G["扫描@Service等注解"] --&gt; H["创建目标Bean实例（如UserService）"]
    H --&gt; I["触发 BeanPostProcessor 后置处理"]
    I --&gt; J["AnnotationAwareAspectJAutoProxyCreator &lt;br/&gt;执行 postProcessAfterInitialization"]
    J --&gt; K{"目标Bean方法是否有&lt;br/&gt;@Transactional注解？"}
    K --&gt;|否| L["直接返回原始Bean"]
    K --&gt;|是| M["查找匹配的 TransactionAdvisor 切面"]
    M --&gt; N["生成动态代理对象（默认CGLIB）"]
</code></pre>
<ol start="3">
<li>处理事务流程</li>
</ol>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD

    %% 事务执行阶段
    O["开发者调用目标方法（如addUser()）"] --&gt; P["实际调用代理对象方法"]
    P --&gt; Q["TransactionInterceptor 拦截方法"]
    Q --&gt; R["通过 TransactionAttributeSource 解析&lt;br/&gt;@Transactional属性（传播行为/隔离级别等）"]
    R --&gt; S["事务管理器开启事务"]
    S --&gt; T["执行目标方法核心业务逻辑"]
    
    %% 事务结果处理
    T --&gt; U{"方法执行是否成功？"}
    U --&gt;|"成功（无异常）"| V["事务管理器提交事务"]
    U --&gt;|"失败（抛异常）"| W["根据@Transactional的rollbackFor&lt;br/&gt;配置判断是否回滚"]
    W --&gt;|"满足回滚条件"| X["事务管理器回滚事务"]
    W --&gt;|"不满足回滚条件"| V["事务管理器提交事务"]
    
    %% 流程结束
    V &amp; X --&gt; Y["事务执行完成"]
</code></pre>
<h2 data-id="heading-8">总结</h2>
<p>Spring Boot 动态事务的实现，本质是 “注解标记 + AOP 动态代理 + 自动配置” 的组合：</p>
<ul>
<li>注解（@Transactional）提供 “事务标记”，明确需要增强的方法；</li>
<li>AOP 通过动态代理生成代理对象，拦截目标方法调用；</li>
<li>事务拦截器（TransactionInterceptor）封装事务核心逻辑，实现 “开启 - 执行 - 提交 / 回滚” 的自动化；</li>
<li>自动配置（TransactionAutoConfiguration）简化开发者配置，让整个流程 “开箱即用”。</li>
</ul>
<p>理解这一原理，不仅能帮助开发者正确使用@Transactional注解（避免踩代理失效、事务传播行为错误等坑），还能举一反三，理解 Spring 体系中 “注解驱动” 特性的通用设计思想。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[🌴 Go企业级全栈式框架：Goyave入门和使用介绍]]></title>    <link>https://juejin.cn/post/7592130164965408806</link>    <guid>https://juejin.cn/post/7592130164965408806</guid>    <pubDate>2026-01-07T00:29:31.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592130164965408806" data-draft-id="7590961898399121446" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="🌴 Go企业级全栈式框架：Goyave入门和使用介绍"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-07T00:29:31.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="golang学习记"/> <meta itemprop="url" content="https://juejin.cn/user/4371313964100990"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            🌴 Go企业级全栈式框架：Goyave入门和使用介绍
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4371313964100990/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    golang学习记
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-07T00:29:31.000Z" title="Wed Jan 07 2026 00:29:31 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">🥥 什么是 Goyave？</h2>
<p>Goyave（读作 /ɡoʊˈjɑːveɪ/，像 “go-yah-vay”）是一个专为 <strong>Go 语言 REST API 开发</strong> 打造的全功能 Web 框架。</p>
<blockquote>
<p>⚠️ 注意：它不是「Go + Java + Vue」的缝合怪；而是 <strong>Go 自己生的娃</strong>，基因纯正，自带「简洁+可靠」属性。</p>
</blockquote>
<p>它的口号可以翻译成：</p>
<blockquote>
<p>✅ 你只管写业务逻辑<br/>
❌ 我帮你挡住配置地狱、验证爆炸、中间件乱炖、JWT 糊脸……</p>
</blockquote>
<p>就像你去健身房请了个私教——他不替你举铁，但会骂你别偷懒、帮你调呼吸、还顺手递蛋白粉。</p>
<hr/>
<h2 data-id="heading-1">🌊 为什么叫 Goyave？名字里有玄机！</h2>
<p>Goyave 是法语里「番石榴」（Guava）的意思……<br/>
但更妙的是——<strong>Go + Ya + Ve</strong> 可以强行解读为：</p>
<blockquote>
<p><strong>Go, Yet Another Very Elegant</strong> framework.</p>
</blockquote>
<p>（Go：又一个非常优雅的框架——谦虚中带着一丝凡尔赛 😎）</p>
<hr/>
<h2 data-id="heading-2">🚀 五分钟上手：写个“会呼吸”的注册登录 API</h2>
<blockquote>
<p>🧠 <em>哲学小剧场</em>：<br/>
人类渴望连接，于是发明了 API；<br/>
API 渴望安全，于是发明了 JWT；<br/>
程序员渴望下班，于是发明了——<strong>Goyave</strong>。</p>
</blockquote>
<h3 data-id="heading-3">Step 1：安装</h3>
<pre><code class="hljs language-bash" lang="bash">go get -u goyave.dev/goyave/v5
</code></pre>
<blockquote>
<p>💡 Goyave v5 是目前最新稳定版（截至 2026），v3 用户别急——升级指南比泡面说明书还短。</p>
</blockquote>
<hr/>
<h3 data-id="heading-4">Step 2：模型定义（User：人类在数字世界的分身）</h3>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">type</span> User <span class="hljs-keyword">struct</span> {
    ID       <span class="hljs-type">uint</span>   <span class="hljs-string">`gorm:"primaryKey"`</span>
    Username <span class="hljs-type">string</span> <span class="hljs-string">`gorm:"type:varchar(100);unique;not null"`</span>
    Password <span class="hljs-type">string</span> <span class="hljs-string">`gorm:"type:varchar(100);not null"`</span>
}
</code></pre>
<blockquote>
<p>🍌 小贴士：<code>Password</code> 字段千万别存明文！Goyave 内置 <code>auth.HashPassword()</code>，像给密码穿上「凯夫拉防弹衣」。</p>
</blockquote>
<hr/>
<h3 data-id="heading-5">Step 3：注册请求验证（防杠精专用）</h3>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">type</span> RegisterRequest <span class="hljs-keyword">struct</span> {
    Username <span class="hljs-type">string</span> <span class="hljs-string">`validate:"required|min:4|max:100"`</span>
    Password <span class="hljs-type">string</span> <span class="hljs-string">`validate:"required|min:8"`</span> <span class="hljs-comment">// 拒绝 "123456" 入侵！</span>
}
</code></pre>
<p>Goyave 的验证规则<strong>自解释性极强</strong>，连产品经理看了都能点头：“嗯，用户名不能叫 <code>a</code>，合理。”</p>
<blockquote>
<p>🧩 类比时间：<br/>
<code>validate:"required|min:4"</code> ≈ 你妈：“相亲对象至少得有房、有社保、会做饭——三样缺一不可！”（<code>required|min:3</code> 😂）</p>
</blockquote>
<hr/>
<h3 data-id="heading-6">Step 4：注册控制器 —— 比相亲成功率还高的代码</h3>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Register</span><span class="hljs-params">(res *goyave.Response, req *goyave.Request)</span></span> {
    reg := &amp;RegisterRequest{}
    <span class="hljs-keyword">if</span> err := req.ToStruct(reg); err != <span class="hljs-literal">nil</span> {
        res.JSON(err.Status, err)
        <span class="hljs-keyword">return</span>
    }

    user := &amp;User{
        Username: reg.Username,
        Password: auth.HashPassword(reg.Password), <span class="hljs-comment">// 暗号加密！</span>
    }

    <span class="hljs-keyword">if</span> err := database.GetConnection().Create(user).Error; err != <span class="hljs-literal">nil</span> {
        res.Error(err)
        <span class="hljs-keyword">return</span>
    }

    res.JSON(http.StatusCreated, <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-keyword">interface</span>{}{
        <span class="hljs-string">"id"</span>:       user.ID,
        <span class="hljs-string">"username"</span>: user.Username,
        <span class="hljs-comment">// ✨ 不返回密码！连 hint 都不给黑客！</span>
    })
}
</code></pre>
<blockquote>
<p>✅ 这段代码干了三件事：</p>
<ol>
<li>解析并校验输入（防手滑党）</li>
<li>存入 DB（带盐哈希，咸得黑客流泪）</li>
<li>温柔地返回结果（连 HTTP 状态码都选 <code>201 Created</code>，仪式感拉满）</li>
</ol>
</blockquote>
<hr/>
<h3 data-id="heading-7">Step 5：登录 + JWT 认证（门禁卡自动化）</h3>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Login</span><span class="hljs-params">(res *goyave.Response, req *goyave.Request)</span></span> {
    loginReq := &amp;LoginRequest{}
    <span class="hljs-keyword">if</span> err := req.ToStruct(loginReq); err != <span class="hljs-literal">nil</span> {
        res.JSON(err.Status, err)
        <span class="hljs-keyword">return</span>
    }

    user := &amp;User{}
    <span class="hljs-keyword">if</span> err := database.Where(<span class="hljs-string">"username = ?"</span>, loginReq.Username).First(user).Error; err != <span class="hljs-literal">nil</span> {
        res.JSON(http.StatusUnauthorized, <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">string</span>{<span class="hljs-string">"error"</span>: <span class="hljs-string">"用户名或密码错误"</span>})
        <span class="hljs-keyword">return</span>
    }

    <span class="hljs-keyword">if</span> !auth.CheckPassword(user.Password, loginReq.Password) {
        res.JSON(http.StatusUnauthorized, <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">string</span>{<span class="hljs-string">"error"</span>: <span class="hljs-string">"用户名或密码错误"</span>})
        <span class="hljs-keyword">return</span>
    }

    token, _ := auth.GenerateToken(user.ID) <span class="hljs-comment">// ← 生成 JWT，像颁发 VIP 电子手环</span>
    res.JSON(http.StatusOK, <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">string</span>{<span class="hljs-string">"token"</span>: token})
}
</code></pre>
<blockquote>
<p>🔐 认证中间件一键挂载：</p>
<pre><code class="hljs language-go" lang="go">authMiddleware := &amp;auth.Middleware{}
router.Get(<span class="hljs-string">"/protected"</span>, ProtectedEndpoint).Middleware(authMiddleware)
</code></pre>
<p>→ 从此 <code>/protected</code> 路由只认「Token 手环」，没手环？请去前台登记（即 <code>/login</code>）。</p>
</blockquote>
<hr/>
<h2 data-id="heading-8">🧰 高阶技能彩蛋</h2>
<h3 data-id="heading-9">✅ 动态分页 &amp; 过滤</h3>
<p>Goyave 原生支持 <code>?page=2&amp;page_size=10&amp;sort=-created_at&amp;filter[name]=John</code><br/>
——URL 里写 SQL 条件？不，这叫 <strong>RESTful 黑话</strong>。</p>
<h3 data-id="heading-10">✅ DTO 映射 &amp; 模型转换</h3>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">type</span> UserDTO <span class="hljs-keyword">struct</span> {
    ID       <span class="hljs-type">uint</span>   <span class="hljs-string">`json:"id"`</span>
    Username <span class="hljs-type">string</span> <span class="hljs-string">`json:"name"`</span> <span class="hljs-comment">// 前端想要 name？安排。</span>

}
</code></pre>
<h3 data-id="heading-11">✅ 结构化日志 + 错误追踪</h3>
<pre><code class="hljs language-log" lang="log">INFO 2026-01-04T12:00:00Z Request: POST /register
ERROR 2026-01-04T12:00:01Z duplicate key value violates unique constraint (username)
</code></pre>
<p>——日志清晰到能帮你写事故复盘 PPT 📊</p>
<hr/>
<h2 data-id="heading-12">🌱 项目结构建议（“整洁架构”爱好者狂喜）</h2>
<pre><code class="hljs language-bash" lang="bash">/project
├── config/          <span class="hljs-comment"># 配置：像菜谱，决定咸淡</span>
├── database/
│   ├── models/      <span class="hljs-comment"># 数据模型：世界的“骨架”</span>
│   └── migrations/  <span class="hljs-comment"># 迁移脚本：给 DB 做微创手术</span>
├── http/
│   ├── controllers/ <span class="hljs-comment"># 业务逻辑：大脑皮层</span>
│   ├── middleware/  <span class="hljs-comment"># 中间件：安检门 + 礼宾台</span>
│   └── routes.go    <span class="hljs-comment"># 路由：城市交通图</span>
└── main.go          <span class="hljs-comment"># 入口：点火按钮 🔥</span>
</code></pre>
<blockquote>
<p>🪴 设计哲学：<strong>“约定优于配置”</strong> ——<br/>
框架给你搭好脚手架，你专注砌墙；<br/>
若你想自己烧砖？也留了逃生舱口（可高度自定义）。</p>
</blockquote>
<hr/>
<h2 data-id="heading-13">🎯 适合谁用？</h2>

























<table><thead><tr><th>你是……</th><th>Goyave 说……</th></tr></thead><tbody><tr><td>初学 Go 想快速写 API</td><td>“来，我扶你上车，安全带已扣好 🚗”</td></tr><tr><td>老司机厌倦了手搓 middleware</td><td>“这些脏活我包了，你去喝杯椰子水 🥥”</td></tr><tr><td>团队需要统一规范</td><td>“我的 lint + test + validate 三件套，保你 Code Review 少吵架”</td></tr><tr><td>性能洁癖患者</td><td>“零反射路由 + GORM + 连接池 = 起飞 🚀”</td></tr></tbody></table>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[285. Java Stream API - 通过 Supplier 创建 Stream]]></title>    <link>https://juejin.cn/post/7592059801885081643</link>    <guid>https://juejin.cn/post/7592059801885081643</guid>    <pubDate>2026-01-07T00:56:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592059801885081643" data-draft-id="7592059801885048875" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="285. Java Stream API - 通过 Supplier 创建 Stream"/> <meta itemprop="keywords" content="前端,后端"/> <meta itemprop="datePublished" content="2026-01-07T00:56:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Cache技术分享"/> <meta itemprop="url" content="https://juejin.cn/user/1662117313262776"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            285. Java Stream API - 通过 Supplier 创建 Stream
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1662117313262776/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Cache技术分享
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-07T00:56:37.000Z" title="Wed Jan 07 2026 00:56:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">285. Java Stream API - 通过 Supplier 创建 Stream</h2>
<hr/>
<h4 data-id="heading-1">✅ 基本概念</h4>
<p><code>Java</code> 的 <code>Stream</code> 接口提供了两个用于从 <strong>Supplier（供应者）</strong> 创建流的工厂方法，其中之一就是：</p>
<pre><code class="hljs language-java" lang="java">Stream.generate(Supplier&lt;T&gt; supplier)
</code></pre>
<p>这个方法用于 <strong>生成无限流（infinite stream）</strong>：每当流需要一个新元素时，<code>Supplier</code> 就会被调用一次来“供应”这个元素。</p>
<hr/>
<h4 data-id="heading-2">🧪 示例代码</h4>
<pre><code class="hljs language-java" lang="java">Stream&lt;String&gt; generated = Stream.generate(() -&gt; <span class="hljs-string">"+"</span>);
List&lt;String&gt; strings = generated.limit(<span class="hljs-number">5L</span>).toList();
System.out.println(<span class="hljs-string">"strings = "</span> + strings);
</code></pre>
<h5 data-id="heading-3">💻 输出结果：</h5>
<pre><code class="hljs language-java" lang="java">strings = [+, +, +, +, +]
</code></pre>
<hr/>
<h4 data-id="heading-4">⚠️ 小心！这是个无限流！</h4>
<blockquote>
<p>❗ 如果你去掉 <code>.limit(5L)</code>，这个程序将永远不会停止运行！</p>
</blockquote>
<pre><code class="hljs language-java" lang="java">Stream&lt;String&gt; generated = Stream.generate(() -&gt; <span class="hljs-string">"+"</span>);
generated.forEach(System.out::println); <span class="hljs-comment">// ❌ 小心，死循环</span>
</code></pre>
<p>🚨 它将不停地生成 <code>+</code>，直到你的内存耗尽，甚至抛出 <code>OutOfMemoryError</code>！</p>
<hr/>
<h4 data-id="heading-5">🎯 正确使用方式：结合 <strong>限制操作（short-circuiting）</strong></h4>
<p>在 <code>Stream API</code> 中，像 <code>limit()</code> 这样的操作被称为 <strong>短路操作（short-circuiting operations）</strong>。它的作用是“提前终止流的生成或处理”。</p>
<blockquote>
<p>✅ 加上 <code>limit(n)</code>，我们就可以从无限流中“截取”前 <code>n</code> 个元素使用。</p>
</blockquote>
<pre><code class="hljs language-java" lang="java">Stream&lt;Double&gt; randoms = Stream.generate(Math::random);
List&lt;Double&gt; topFive = randoms.limit(<span class="hljs-number">5</span>).toList();
System.out.println(topFive); <span class="hljs-comment">// 打印 5 个随机数</span>
</code></pre>
<hr/>
<h4 data-id="heading-6">🧠 学习要点</h4>

























<table><thead><tr><th>关键点</th><th>说明</th></tr></thead><tbody><tr><td><code>Stream.generate(...)</code></td><td>会创建一个 <strong>无限</strong> 的流</td></tr><tr><td><strong>必须</strong>使用 <code>limit()</code> 或其他短路操作</td><td>否则程序会永远运行或耗尽资源</td></tr><tr><td>适合生成固定模式、常量、随机数等</td><td>比如 <code>"++++++++"</code> 或随机数序列</td></tr><tr><td>每次调用都会重新获取一个值</td><td>这与 <code>of(...)</code> 或 <code>Arrays.stream(...)</code> 是 <strong>静态集合</strong> 不同</td></tr></tbody></table>
<hr/>
<h4 data-id="heading-7">📌 示例：生成时间戳</h4>
<pre><code class="hljs language-java" lang="java">Stream&lt;String&gt; timeStream = Stream.generate(() -&gt; Instant.now().toString());
List&lt;String&gt; timestamps = timeStream.limit(<span class="hljs-number">3</span>).toList();
System.out.println(timestamps);
</code></pre>
<blockquote>
<p>输出三个不同时间戳，适合用于日志采样、延迟任务等场景。</p>
</blockquote>
<hr/>
<h4 data-id="heading-8">🧪 小练习题（可做培训互动）</h4>
<p>问：以下代码会输出几个 <code>"Hello"</code>？</p>
<pre><code class="hljs language-java" lang="java">Stream.generate(() -&gt; <span class="hljs-string">"Hello"</span>)
      .limit(<span class="hljs-number">3</span>)
      .forEach(System.out::println);
</code></pre>
<p>答案：</p>
<pre><code class="hljs language-java" lang="java">Hello
Hello
Hello
</code></pre>
<hr/>
<h4 data-id="heading-9">📚 小结</h4>
<ul>
<li><code>Stream.generate(...)</code> = 无限供应机，每次都生产一个元素。</li>
<li>不加限制操作就是“失控的水龙头 💦”，必须加上 <code>.limit()</code>、<code>.takeWhile()</code> 等手段节流。</li>
<li>适合用于生成常量、重复元素、随机值、当前时间等“动态”数据。</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[C 语言指针从入门到实战：吃透核心，避开 90% 的坑]]></title>    <link>https://juejin.cn/post/7592251792630710299</link>    <guid>https://juejin.cn/post/7592251792630710299</guid>    <pubDate>2026-01-07T01:05:24.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592251792630710299" data-draft-id="7592089325912326144" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="C 语言指针从入门到实战：吃透核心，避开 90% 的坑"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-07T01:05:24.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="小杨同学49"/> <meta itemprop="url" content="https://juejin.cn/user/1189004976589664"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            C 语言指针从入门到实战：吃透核心，避开 90% 的坑
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1189004976589664/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    小杨同学49
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-07T01:05:24.000Z" title="Wed Jan 07 2026 01:05:24 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">C 语言指针从入门到实战：吃透核心，避开 90% 的坑</h2>
<p>指针是 C 语言的灵魂，也是初学者的 “拦路虎”。它赋予程序直接操作内存的强大能力，是实现高效数据传递、复杂数据结构（链表、树）的核心基础。很多人觉得指针抽象难懂，其实只要抓住 “地址” 这个本质，再结合实际场景练习，就能彻底打通任督二脉。本文结合指针学习的核心逻辑，从基础概念到实战案例，再到避坑指南，帮你系统掌握指针的用法。</p>
<h3 data-id="heading-1">一、指针基础：看透 “地址” 的本质</h3>
<h4 data-id="heading-2">1. 指针是什么？</h4>
<p>指针的本质是<strong>存储内存地址的变量</strong>。我们可以用一个通俗的比喻理解：</p>
<ul>
<li>内存 = 快递仓库（每个存储单元有唯一编号，即地址）；</li>
<li>变量 = 仓库里的包裹（存储具体数据）；</li>
<li>指针 = 快递单（上面写着包裹的具体地址）；</li>
<li>解引用（*）= 快递员按地址找到包裹并打开。</li>
</ul>
<h4 data-id="heading-3">2. 核心操作：&amp; 和 * 的用法</h4>
<p>c</p>
<p>运行</p>
<pre><code class="hljs language-perl" lang="perl"><span class="hljs-comment">#include &lt;stdio.h&gt;</span>
<span class="hljs-keyword">int</span> main() {
    <span class="hljs-keyword">int</span> num = <span class="hljs-number">10</span>;  <span class="hljs-regexp">//</span> 变量：内存中存储<span class="hljs-number">10</span>的“包裹”
    <span class="hljs-keyword">int</span> *p = &amp;num; <span class="hljs-regexp">//</span> 指针p：存储num的地址（&amp;是取地址运算符）
    
    <span class="hljs-keyword">printf</span>(<span class="hljs-string">"变量num的值：%d\n"</span>, num);      <span class="hljs-regexp">//</span> 直接访问包裹：<span class="hljs-number">10</span>
    <span class="hljs-keyword">printf</span>(<span class="hljs-string">"变量num的地址：%p\n"</span>, &amp;num);  <span class="hljs-regexp">//</span> 查看包裹地址：<span class="hljs-number">0x7fff</span>...（随系统变化）
    <span class="hljs-keyword">printf</span>(<span class="hljs-string">"指针p存储的地址：%p\n"</span>, p);   <span class="hljs-regexp">//</span> 查看快递单地址：与&amp;num一致
    <span class="hljs-keyword">printf</span>(<span class="hljs-string">"指针p指向的值：%d\n"</span>, *p);    <span class="hljs-regexp">//</span> 按地址取包裹：<span class="hljs-number">10</span>（*是解引用运算符）
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<ul>
<li><code>&amp;变量名</code>：获取变量的内存地址；</li>
<li><code>*指针名</code>：通过指针存储的地址，访问或修改目标变量的值；</li>
<li>指针变量本身也占内存（通常 4 或 8 字节，取决于系统架构）。</li>
</ul>
<h4 data-id="heading-4">3. 指针类型的意义</h4>
<p>指针声明时必须指定类型（如<code>int*</code>、<code>char*</code>），它决定了两件关键事：</p>
<ul>
<li>内存访问粒度：<code>int*</code>每次访问 4 字节（int 类型大小），<code>char*</code>每次访问 1 字节；</li>
<li>指针运算规则：<code>p++</code>时，<code>int*</code>指针地址 + 4，<code>char*</code>指针地址 + 1，确保指向有效数据。</li>
</ul>
<h3 data-id="heading-5">二、核心应用：指针的 3 大实用场景</h3>
<h4 data-id="heading-6">1. 指针与数组：天生一对</h4>
<p>数组和指针是 C 语言中最亲密的组合，数组名本质是<strong>指向首元素的常量指针</strong>，二者在很多场景下可互换使用。</p>
<h5 data-id="heading-7">关键关系</h5>
<ul>
<li><code>arr[i]</code> 等价于 <code>*(arr + i)</code>：数组下标访问本质是指针偏移运算；</li>
<li>数组名是常量指针，不能重新赋值（如<code>arr = p</code> 报错），但指针变量可以自由指向（如<code>p = arr</code> 合法）；</li>
<li>函数传参时，数组会退化为指针，函数接收的实际是数组首元素地址。</li>
</ul>
<h5 data-id="heading-8">实战：指针遍历数组</h5>
<p>c</p>
<p>运行</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span>
<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-type">int</span> arr[<span class="hljs-number">5</span>] = {<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>};
    <span class="hljs-type">int</span> *p = arr; <span class="hljs-comment">// 指针指向数组首元素</span>
    
    <span class="hljs-comment">// 指针遍历（比下标更高效）</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++) {
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"%d "</span>, *(p + i)); <span class="hljs-comment">// 输出：1 2 3 4 5</span>
    }
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<h4 data-id="heading-9">2. 指针与函数：高效传参</h4>
<p>C 语言函数默认是 “值传递”（传递副本），而指针传递能直接操作原始数据，解决两大问题：</p>
<ul>
<li>修改外部变量：无需返回值即可改变函数外变量的值；</li>
<li>突破单返回值限制：通过多个指针参数，间接返回多个结果。</li>
</ul>
<h5 data-id="heading-10">实战 1：指针传递实现两数交换</h5>
<p>c</p>
<p>运行</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span>
<span class="hljs-comment">// 指针传递：接收变量地址，直接操作原始数据</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">swap</span><span class="hljs-params">(<span class="hljs-type">int</span> *a, <span class="hljs-type">int</span> *b)</span> </span>{
    <span class="hljs-type">int</span> temp = *a;
    *a = *b;
    *b = temp;
}
<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-type">int</span> x = <span class="hljs-number">5</span>, y = <span class="hljs-number">10</span>;
    <span class="hljs-built_in">swap</span>(&amp;x, &amp;y); <span class="hljs-comment">// 传递变量地址</span>
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"x=%d, y=%d\n"</span>, x, y); <span class="hljs-comment">// 输出：x=10, y=5（交换成功）</span>
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<h5 data-id="heading-11">实战 2：二级指针修改指针指向</h5>
<p>如果想在函数中改变指针本身的指向（而非指向的值），需要用到二级指针（指向指针的指针）：</p>
<p>c</p>
<p>运行</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span>
<span class="hljs-comment">// 二级指针：改变一级指针的指向</span>
<span class="hljs-type">void</span> <span class="hljs-title function_">changePtr</span><span class="hljs-params">(<span class="hljs-type">int</span> **pp)</span> {
    *pp = (<span class="hljs-type">int</span>*)<span class="hljs-built_in">malloc</span>(<span class="hljs-keyword">sizeof</span>(<span class="hljs-type">int</span>)); <span class="hljs-comment">// 分配新内存</span>
    **pp = <span class="hljs-number">20</span>; <span class="hljs-comment">// 给新内存赋值</span>
}
<span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> {
    <span class="hljs-type">int</span> *p = <span class="hljs-literal">NULL</span>;
    changePtr(&amp;p); <span class="hljs-comment">// 传递一级指针的地址</span>
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"p指向的值：%d\n"</span>, *p); <span class="hljs-comment">// 输出：20</span>
    <span class="hljs-built_in">free</span>(p); <span class="hljs-comment">// 释放内存</span>
    p = <span class="hljs-literal">NULL</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<h4 data-id="heading-12">3. 指针数组：高效管理字符串</h4>
<p>指针数组是 “存储指针的数组”，最经典的用途是管理一组字符串 —— 无需移动字符串本身，只需交换指针指向，大幅提升效率。</p>
<h5 data-id="heading-13">实战：指针数组排序字符串</h5>
<p>c</p>
<p>运行</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment">#include &lt;stdio.h&gt;</span>
<span class="hljs-comment">#include &lt;string.h&gt;</span>
// 选择排序：按字典序降序排列字符串
void sortStrings(char *arr<span class="hljs-section">[]</span>, int n) {
    for (int <span class="hljs-attr">i</span> = <span class="hljs-number">0</span><span class="hljs-comment">; i &lt; n - 1; i++) {</span>
        int <span class="hljs-attr">maxIdx</span> = i<span class="hljs-comment">;</span>
        // 查找当前最大字符串
        for (int <span class="hljs-attr">j</span> = i + <span class="hljs-number">1</span><span class="hljs-comment">; j &lt; n; j++) {</span>
            if (strcmp(arr<span class="hljs-section">[j]</span>, arr<span class="hljs-section">[maxIdx]</span>) &gt; 0) {
                <span class="hljs-attr">maxIdx</span> = j<span class="hljs-comment">;</span>
            }
        }
        // 交换指针（不移动字符串）
        char *<span class="hljs-attr">temp</span> = arr[i]<span class="hljs-comment">;</span>
        arr<span class="hljs-section">[i]</span> = arr<span class="hljs-section">[maxIdx]</span><span class="hljs-comment">;</span>
        arr<span class="hljs-section">[maxIdx]</span> = temp<span class="hljs-comment">;</span>
    }
}
int main() {
    char *strs<span class="hljs-section">[]</span> = {"hello", "world", "c", "pointer", "array"}<span class="hljs-comment">;</span>
    int <span class="hljs-attr">n</span> = sizeof(strs) / sizeof(strs[<span class="hljs-number">0</span>])<span class="hljs-comment">;</span>
    
    sortStrings(strs, n)<span class="hljs-comment">;</span>
    // 输出排序结果：world pointer hello array c
    for (int <span class="hljs-attr">i</span> = <span class="hljs-number">0</span><span class="hljs-comment">; i &lt; n; i++) {</span>
        printf("%s ", strs<span class="hljs-section">[i]</span>)<span class="hljs-comment">;</span>
    }
    return 0<span class="hljs-comment">;</span>
}
</code></pre>
<h3 data-id="heading-14">三、避坑指南：5 个致命错误千万别犯</h3>
<p>指针虽强，但稍有不慎就会导致程序崩溃或内存泄漏，以下是初学者最易踩的坑：</p>
<h4 data-id="heading-15">1. 野指针：未初始化的 “流浪指针”</h4>
<p>c</p>
<p>运行</p>
<pre><code class="hljs language-ini" lang="ini">// 错误：指针p未初始化，指向随机地址
int *p<span class="hljs-comment">;</span>
*<span class="hljs-attr">p</span> = <span class="hljs-number">10</span><span class="hljs-comment">; // 程序崩溃风险！</span>

// 正确：要么初始化指向合法地址，要么置空
int <span class="hljs-attr">x</span> = <span class="hljs-number">5</span><span class="hljs-comment">;</span>
int *<span class="hljs-attr">p</span> = &amp;x<span class="hljs-comment">; // 指向有效变量</span>
// 或
int *<span class="hljs-attr">p</span> = NULL<span class="hljs-comment">; // 明确指向空地址</span>
</code></pre>
<h4 data-id="heading-16">2. 内存泄漏：分配后忘记释放</h4>
<p>c</p>
<p>运行</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// 错误：malloc分配的内存未free，函数结束后永久丢失</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">func</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-type">int</span> *p = (<span class="hljs-type">int</span>*)<span class="hljs-built_in">malloc</span>(<span class="hljs-number">4</span>);
    *p = <span class="hljs-number">10</span>;
    <span class="hljs-comment">// 未执行free(p)</span>
}

<span class="hljs-comment">// 正确：分配与释放成对出现，释放后置空</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">func</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-type">int</span> *p = (<span class="hljs-type">int</span>*)<span class="hljs-built_in">malloc</span>(<span class="hljs-number">4</span>);
    *p = <span class="hljs-number">10</span>;
    <span class="hljs-built_in">free</span>(p); <span class="hljs-comment">// 释放内存</span>
    p = <span class="hljs-literal">NULL</span>; <span class="hljs-comment">// 避免悬空指针</span>
}
</code></pre>
<h4 data-id="heading-17">3. 解引用空指针：访问不存在的地址</h4>
<p>c</p>
<p>运行</p>
<pre><code class="hljs language-ini" lang="ini">// 错误：空指针不能解引用
int *<span class="hljs-attr">p</span> = NULL<span class="hljs-comment">;</span>
*<span class="hljs-attr">p</span> = <span class="hljs-number">100</span><span class="hljs-comment">; // 程序崩溃！</span>

// 正确：使用前先判断
int *<span class="hljs-attr">p</span> = NULL<span class="hljs-comment">;</span>
if (p != NULL) {
    *<span class="hljs-attr">p</span> = <span class="hljs-number">100</span><span class="hljs-comment">;</span>
}
</code></pre>
<h4 data-id="heading-18">4. 数组越界：指针偏移超出有效范围</h4>
<p>c</p>
<p>运行</p>
<pre><code class="hljs language-ini" lang="ini">// 错误：数组只有5个元素，循环条件i&lt;=5导致越界
int arr<span class="hljs-section">[5]</span> = {1,2,3,4,5}<span class="hljs-comment">;</span>
int *<span class="hljs-attr">p</span> = arr<span class="hljs-comment">;</span>
for (int <span class="hljs-attr">i</span> = <span class="hljs-number">0</span><span class="hljs-comment">; i &lt;= 5; i++) {</span>
    printf("%d ", *p++)<span class="hljs-comment">; // 访问无效内存</span>
}

// 正确：循环条件严格控制在有效范围内
for (int <span class="hljs-attr">i</span> = <span class="hljs-number">0</span><span class="hljs-comment">; i &lt; 5; i++) {</span>
    printf("%d ", *p++)<span class="hljs-comment">;</span>
}
</code></pre>
<h4 data-id="heading-19">5. 混淆数组指针与指针数组</h4>
<p>c</p>
<p>运行</p>
<pre><code class="hljs language-css" lang="css">// 数组指针：指向数组的指针（本质是指针）
int (*<span class="hljs-selector-tag">p</span>)<span class="hljs-selector-attr">[10]</span>; // <span class="hljs-selector-tag">p</span>指向包含<span class="hljs-number">10</span>个int的数组

// 指针数组：存储指针的数组（本质是数组）
int *<span class="hljs-selector-tag">p</span><span class="hljs-selector-attr">[10]</span>; // <span class="hljs-selector-tag">p</span>是数组，包含<span class="hljs-number">10</span>个int*指针

// 记忆技巧：()优先级高于<span class="hljs-selector-attr">[]</span>，先结合*是指针，先结合<span class="hljs-selector-attr">[]</span>是数组
</code></pre>
<h3 data-id="heading-20">四、总结：指针学习的 3 个关键</h3>
<ol>
<li>抓本质：指针就是 “地址容器”，所有操作都围绕 “存储地址” 和 “通过地址访问数据” 展开；</li>
<li>多实践：数组、函数、字符串是指针的核心应用场景，每个场景至少编写 3 个实战案例；</li>
<li>避陷阱：牢记野指针、内存泄漏、越界这三大 “红线”，养成初始化、配对释放的习惯。</li>
</ol>
<p>指针是 C 语言的 “屠龙刀”，一旦掌握，你就能突破很多基础语法的限制，写出更高效、更灵活的代码。刚开始学习时遇到困惑很正常，多画图梳理地址关系，多调试观察指针变化，慢慢就会豁然开朗。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>